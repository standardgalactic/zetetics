A Unified Framework to Enforce, Discover, and Promote
Symmetry in Machine Learning
Samuel E. Otto
ottoncdr@uw.edu
AI Institute in Dynamic Systems
University of Washington
Seattle, WA 98195-4322, USA
Nicholas Zolman
nzolman@uw.edu
AI Institute in Dynamic Systems
Mechanical Engineering
University of Washington
Seattle, WA 98195-4322, USA
J. Nathan Kutz
kutz@uw.edu
AI Institute in Dynamic Systems
Applied Mathematics
University of Washington
Seattle, WA 98195-4322, USA
Steven L. Brunton
sbrunton@uw.edu
AI Institute in Dynamic Systems
Mechanical Engineering
University of Washington
Seattle, WA 98195-4322, USA
Abstract
Symmetry is present throughout nature and continues to play an increasingly central role in physics
and machine learning. Fundamental symmetries, such as PoincarÃ© invariance, allow physical laws
discovered in laboratories on Earth to be extrapolated to the farthest reaches of the universe.
Symmetry is essential to achieving this extrapolatory power in machine learning applications. For
example, translation invariance in image classification allows models with fewer parameters, such
as convolutional neural networks, to be trained on smaller data sets and achieve state-of-the-art
performance. In this paper, we provide a unifying theoretical and methodological framework for
incorporating symmetry into machine learning models in three ways: 1. enforcing known symmetry
when training a model; 2. discovering unknown symmetries of a given model or data set; and
3. promoting symmetry during training by learning a model that breaks symmetries within a
user-specified group of candidates when there is sufficient evidence in the data. We show that
these tasks can be cast within a common mathematical framework whose central object is the Lie
derivative associated with fiber-linear Lie group actions on vector bundles. We extend and unify
several existing results by showing that enforcing and discovering symmetry are linear-algebraic tasks
that are dual with respect to the bilinear structure of the Lie derivative. We also propose a novel
way to promote symmetry by introducing a class of convex regularization functions based on the Lie
derivative and nuclear norm relaxation to penalize symmetry breaking during training of machine
learning models. We explain how these ideas can be applied to a wide range of machine learning
models including basis function regression, dynamical systems discovery, multilayer perceptrons,
and neural networks acting on spatial fields such as images.
Keywords: Symmetries, machine learning, Lie groups, manifolds, invariance, equivariance, neural
networks, deep learning
1
arXiv:2311.00212v1  [cs.LG]  1 Nov 2023

Contents
1
Introduction
3
2
Related work
5
2.1
Enforcing symmetry
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
5
2.2
Discovering symmetry . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
5
2.3
Promoting symmetry . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
6
2.4
Additional approaches and applications . . . . . . . . . . . . . . . . . . . . . . . . . .
6
3
Elementary theory of matrix Lie group actions
7
3.1
Matrix Lie groups and subgroups . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
7
3.2
Group representations, actions, and infinitesimal generators . . . . . . . . . . . . . .
8
4
Fundamental operators for studying symmetry
11
5
Enforcing symmetry with linear constraints
13
5.1
Multilayer perceptrons . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
13
5.2
Neural networks acting on fields . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
13
6
Discovering symmetry by computing nullspaces
15
6.1
Symmetries of submanifolds . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
16
6.2
Symmetries of functions as symmetries of submanifolds . . . . . . . . . . . . . . . . .
17
6.3
Symmetries and conservation laws of dynamical systems . . . . . . . . . . . . . . . .
18
7
Promoting symmetry with convex penalties
20
7.1
Discrete symmetries
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
20
7.2
Continuous symmetries . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
21
7.3
Promoting symmetry in basis function regression . . . . . . . . . . . . . . . . . . . .
21
7.4
Promoting symmetry in neural networks . . . . . . . . . . . . . . . . . . . . . . . . .
22
8
Discretizing the operators
23
8.1
Numerical quadrature and Monte-Carlo
. . . . . . . . . . . . . . . . . . . . . . . . .
24
8.2
Subspaces of polynomials
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
24
9
Generalization to sections of vector bundles
25
9.1
Vector fields . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
28
9.2
Tensor fields . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
29
9.3
Hamiltonian dynamics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
30
9.4
Equivariant integral operators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
32
10 Invariant submanifolds and tangency
34
10.1 Symmetry of submanifolds . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
34
10.2 The Lie derivative as a projection . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
35
11 Conclusion
36
A Proofs of minor results
43
B Proof of Proposition 17
44
C Proof of Proposition 20
45
D Proof of Theorem 21
48
E Proof of Theorem 22
49
F Proof of Theorem 30
49
G Proof of Theorem 31
51
H Proof of Theorem 34
52
2

1 Introduction
Symmetry is present throughout nature, and according to David Gross (1996) the discovery of
fundamental symmetries has played an increasingly central role in physics since the beginning of the
20th century. He asserts that
â€œEinsteinâ€™s great advance in 1905 was to put symmetry first, to regard the symmetry principle as
the primary feature of nature that constrains the allowable dynamical laws.â€
According to Einsteinâ€™s special theory of relativity, physical laws including those of electromagnetism
and quantum mechanics are PoincarÃ©-invariant, meaning that after predictable transformations
(actions of the PoincarÃ© group), these laws can be applied in any non-accelerating reference frame,
anywhere in the universe, at all times. Specifically these transformations form a ten-parameter
group including four translations of space-time, three rotations of space, and three shifts or â€œboostsâ€
in velocity. For small boosts of velocity, these transformations become the Galilean symmetries of
classical mechanics. Similarly, the theorems of Euclidean geometry are unchanged after arbitrary
translations, rotations, and reflections, comprising the Euclidean group. In fluid mechanics, the
conformal (angle-preserving) symmetry of Laplaceâ€™s equation is used to reduce the study of idealized
flows in complicated geometries to canonical flows in simple domains.
In dynamical systems,
the celebrated theorem of Noether (1918) establishes a correspondence between symmetries and
conservation laws, an idea which has become a central pillar of mechanics (Abraham and Marsden,
2008). These examples illustrate the diversity of symmetry groups and their physical applications.
More importantly, they illustrate how symmetric models and theories in physics automatically
extrapolate in explainable ways to environments beyond the available data.
In machine learning, models that exploit symmetry can be trained with less data and use fewer
parameters compared to their asymmetric counterparts. Early examples include augmenting data
with known transformations (see Shorten and Khoshgoftaar (2019); Van Dyk and Meng (2001)) or
using convolutional neural networks (CNNs) to achieve translation invariance for image processing
tasks (see Fukushima (1980); LeCun et al. (1989)). More recently, equivariant neural networks
respecting Euclidean symmetries have achieved state-of-the-art performance for predicting potentials
in molecular dynamics Batzner et al. (2022). As with physical laws, symmetries and invariances allow
machine learning models to extrapolate beyond the training data, and achieve high performance
with fewer modeling parameters.
However, many problems are only weakly symmetric. Gravity, friction, and other external forces
can cause some or all of the PoincarÃ© or Galilean symmetries to be broken. Interactions between
particles can be viewed as breaking symmetries possessed by non-interacting particles. Written
characters have translation and scaling symmetry, but not rotation (cf. 6 and 9, d and p, N and Z) or
reflection (cf. b and d, b and p). One of the main contributions of this work is to propose a method
of enforcing a new principle of parsimony in machine learning. This principal of parsimony by
maximal symmetry states that a model should break a symmetry within a set of physically reasonable
transformations (such as PoincarÃ©, Galilean, Euclidean, or conformal symmetry) only when there is
sufficient evidence in the data.
In this paper, we provide a unifying theoretical and methodological framework for incorporating
symmetry into machine learning models in the following three ways:
Task 1. Enforce. Train a model with known symmetry.
Task 2. Discover. Identify the symmetries of a given model or data set.
Task 3. Promote. Train a model with as many symmetries as possible (from among candidates),
breaking symmetries only when there is sufficient evidence in the data.
3

While these tasks have been studied to varying extents separately, we show how they can
be situated within a common mathematical framework whose central object is the Lie derivative
associated with fiber-linear Lie group actions on vector bundles. As a special case, the Lie derivative
recovers the linear constraints derived by Finzi et al. (2021) for weights in equivariant multilayer
perceptrons. In full generality, we show that known symmetries can be enforced as linear constraints
derived from Lie derivatives for a large class of problems including learning vector and tensor fields
on manifolds as well as learning equivariant integral operators acting on such fields. For example the
kernels of â€œsteerableâ€ CNNs developed by Weiler et al. (2018); Weiler and Cesa (2019) are constructed
to automatically satisfy these constraints for the groups SO(3) (rotations in three dimensions) and
SE(2) (rotations and translations in two dimensions). We show how analogous steerable networks
for other groups, such as subgroups of SE(n), can be constructed by numerically enforcing linear
constraints derived from the Lie derivative on integral kernels defining each layer. Symmetries,
conservation laws, and symplectic structure can also be enforced when learning dynamical systems
via linear constraints on the vector field. Again these constraints come from the Lie derivative and
can be incorporated into neural network architectures and basis function regression models such as
Sparse Identification of Nonlinear Dynamics (SINDy) (Brunton et al., 2016).
Moskalev et al. (2022) identifies the connected subgroup of symmetries of a trained neural network
by computing the nullspace of a linear operator. Likewise, Kaiser et al. (2018, 2021) recovers the
symmetries and conservation laws of a dynamical system by computing the nullspace of a different
linear operator. We observe that these operators and others whose nullspaces encode the symmetries
of more general models can be derived directly from the Lie derivative in a manner dual to the
construction of operators used to enforce symmetry. Specifically, the nullspaces of the operators we
construct reveal the largest connected subgroups of symmetries for enormous classes of models. This
extends work by Gruver et al. (2022) using the Lie derivative to test whether a trained neural network
is equivariant with respect to a given one-parameter group, e.g., rotation of images. Generalizing
the ideas in Cahill et al. (2023), we also show that the symmetries of point clouds approximating
underlying submanifolds can be recovered by computing the nullspaces of associated linear operators.
This allows for the unsupervised mining of data for hidden symmetries.
The idea of relaxed symmetry has been introduced recently by Wang et al. (2022), along
with architecture-specific symmetry-promoting regularization functions involving sums or integrals
over the candidate group of transformations. The Augerino method introduced by Benton et al.
(2020) uses regularization to promote equivariance with respect to a larger collection of candidate
transformations. Promoting physical constraints through the loss function is also a core concept
of Physics-Informed Neural Networks (PINNs) introduced by Raissi et al. (2019). Our approach
to the third task (promoting symmetry) is to introduce a unified and broadly applicable class of
convex regularization functions based on the Lie derivative to penalize symmetry breaking during
training of machine learning models. As we describe above, the Lie derivative yields an operator
whose nullspace corresponds to the symmetries of a given model. Hence, the lower the rank of this
operator, the more symmetric the model is. The nuclear norm has been used extensively as a convex
relaxation of the rank with favorable theoretical properties for compressed sensing and low-rank
matrix recovery (Recht et al., 2010; Gross, 2011), as well as in robust PCA (CandÃ¨s et al., 2011;
Bouwmans et al., 2018). Penalizing the nuclear norm of our symmetry-encoding operator yields a
convex regularization function that can be added to the loss when training machine learning models,
including basis function regression and neural networks. Likewise, we use a nuclear norm penalty
to promote conservation laws and Hamiltonicity with respect to candidate symplectic structures
when fitting dynamical systems to data. This lets us train the model and enforce data-consistent
symmetries simultaneously.
4

2 Related work
2.1 Enforcing symmetry
Data-augmentation, as reviewed by Shorten and Khoshgoftaar (2019); Van Dyk and Meng (2001), is
one of the simplest ways to incorporate known symmetry into machine learning models. Usually
this entails training a neural network architecture on training data to which known transformations
have been applied. The theoretical foundations of these methods are explored by Chen et al. (2020).
Data-augmentation has also been used by Benton et al. (2020) to construct equivariant neural
networks by averaging the networkâ€™s output over transformations applied to the data.
Symmetry can also be enforced directly on the machine learning architecture. For example,
Convolutional Neural Networks (CNNs), introduced by Fukushima (1980) and popularized by LeCun
et al. (1989), achieve translational equivariance by employing convolutional filters with trainable
kernels in each layer. CNNs have been generalized to provide equivariance with respect to symmetry
groups other than translation. Group-Equivariant CNNs (G-CNNs) (Cohen and Welling, 2016)
provide equivariance with respect to arbitrary discrete groups generated by translations, reflections,
and rotations. Rotational equivariance can be enforced on three-dimensional scalar, vector, or tensor
fields using the 3D Steerable CNNs developed by Weiler et al. (2018). Spherical CNNs Cohen et al.
(2018); Esteves et al. (2018) allow for rotation-equivariant maps to be learned for fields (such as
projected images of 3D objects) on spheres. Essentially any group equivariant linear map (defining a
layer of an equivariant neural network) acting fields can be described by group convolution (Kondor
and Trivedi, 2018; Cohen et al., 2019), with the spaces of appropriate convolution kernel characterized
by Cohen et al. (2019). Finzi et al. (2020) provides a practical way to construct convolutional layers
that are equivariant with respect to arbitrary Lie groups and for general data types. For dynamical
systems, Marsden and Ratiu (1999); Rowley et al. (2003); Abraham and Marsden (2008) describe
techniques for symmetry reduction of the original problem to a quotient space where the known
symmetry group has been factored out. Related approaches have been used by Peitz et al. (2023);
Steyert (2022) to approximate Koopman operators for symmetric dynamical systems (see Koopman
(1931); MeziÄ‡ (2005); Mauroy et al. (2020); Otto and Rowley (2021); Brunton et al. (2022)).
A general method for constructing equivariant neural networks is introduced by Finzi et al. (2021),
and relies on the observation that equivariance can be enforced through a set of linear constraints.
For graph neural networks, Maron et al. (2018) characterizes the subspaces of linear layers satisfying
permutation equivariance. Similarly, Ahmadi and Khadir (2020) shows that discrete symmetries and
other types of side information can be enforced via linear or convex constraints in learning problems
for dynamical systems. Our work builds on the results of Finzi et al. (2021), Weiler et al. (2018),
Cohen et al. (2019), and Ahmadi and Khadir (2020) by showing that equivariance can be enforced in
a systematic and unified way via linear constraints for large classes of functions and neural networks.
2.2 Discovering symmetry
Early work by Rao and Ruderman (1999); Miao and Rao (2007) used nonlinear optimization to learn
infinitesimal generators describing transformations between images. Later, it was recognized by Cahill
et al. (2023) that linear algebraic methods could be used to uncover the generators of continuous
linear symmetries of arbitrary point clouds in Euclidean space. Similarly, Kaiser et al. (2018) and
Moskalev et al. (2022) show how conserved quantities of dynamical systems and invariances of trained
neural networks can be revealed by computing the nullspaces of associated linear operators. We
connect these linear-algebraic methods to the Lie derivative, and provide generalizations to nonlinear
group actions on manifolds. The Lie derivative has been used by Gruver et al. (2022) to quantify the
extent to which a trained network is equivariant with respect to a given one-parameter subgroup of
5

transformations. Our results show how the Lie derivative can reveal the entire connected subgroup
of symmetries of a trained model via symmetric eigendecomposition.
More sophisticated nonlinear optimization techniques use Generative Adversarial Networks
(GANs) to learn the transformations that leave a data distribution unchanged. These methods
include SymmetryGAN developed by Desai et al. (2022) and LieGAN developed by Yang et al.
(2023). In contrast, our methods for detecting symmetry are entirely linear-algebraic.
Liu and Tegmark (2022) discover hidden symmetries by optimizing nonlinear transformations
into spaces where candidate symmetries hold. Similar to our approach for promoting symmetry,
they use a cost function to measure whether a given symmetry holds. In contrast, our regularization
functions enable subgroups of candidate symmetry groups to be identified.
2.3 Promoting symmetry
Biasing a network towards increased symmetry is discussed by Wang et al. (2022), along with
architecture-specific methods, including regularization functions involving summations or integrals
over the candidate group of symmetries. While our regularization functions resemble these for
discrete groups, we use a radically different regularization for continuous Lie groups. By leveraging
the Lie algebra, our regularization functions eliminate the need to numerically integrate complicated
functions over the group â€” a task that is already prohibitive for the 10-dimensional non-compact
group of Galilean symmetries in classical mechanics.
Automated data augmentation techniques introduced by Cubuk et al. (2019); Hataya et al.
(2020); Benton et al. (2020) are another class of methods that arguably promote symmetry. These
techniques optimize the distribution of transformations applied to augment the data during training.
For example â€œAugerinoâ€ is an elegant method developed by Benton et al. (2020) which averages an
arbitrary networkâ€™s output over the augmentation distribution and relies on regularization to prevent
the distribution of transformations from becoming concentrated near the identity. In essence, the
regularization biases the averaged network towards increased symmetry.
In contrast, our regularization functions promote symmetry on an architectural level for the
original network. This eliminates the need to perform averaging, which grows more costly for larger
collections of symmetries. While a distribution over symmetries can be useful for learning interesting
partial symmetries (e.g. 6 stays 6 for small rotations, before turning into 9), as is done by Benton
et al. (2020), it is not clear how to use a continuous distribution over transformations to identify
lower-dimensional subgroups which have measure zero. On the other hand, our linear-algebraic
approach easily identifies and promotes symmetries in lower-dimensional connected subgroups.
2.4 Additional approaches and applications
There are several other approaches that incorporate various aspects of enforcing, discovering, and
promoting symmetries. For example, Baddoo et al. (2023) developed algorithms to enforce and
promote known symmetries in dynamic mode decomposition, through manifold constrained learning
and regularization, respectively.
Baddoo et al. (2023) also showed that discovering unknown
symmetries is a dual problem to enforcing symmetry. Exploiting symmetry has also been a central
theme in the reduced-order modeling of fluids for decades (Holmes et al., 2012). As machine learning
methods are becoming widely used to develop these models (Brunton et al., 2020), the themes of
enforcing and discovering symmetries in machine models are increasingly relevant. Known fluid
symmetries have been enforced in SINDy for fluid systems (Loiseau and Brunton, 2018) through linear
equality constraints; this approach was generalized to enforce more complex constraints (Champion
et al., 2020). Unknown symmetries were similarly uncovered for electroconvective flows (Guan et al.,
2021). Symmetry breaking is also important in many turbulent flows (Callaham et al., 2022).
6

3 Elementary theory of matrix Lie group actions
This section provides background and notation required to understand the main results of this
paper in the less abstract, but still remarkably useful setting of matrix Lie groups acting on vector
spaces. In Section 4 we use this theory to study the symmetries of smooth functions between vector
spaces. Such functions form the basic building blocks of many machine learning models such as
basis functions regression models, the layers of multilayer perceptrons, and the kernels of integral
operators acting on spatial fields such as images. We emphasize that this is not the most general
setting for our results, but we provide this section and simpler versions of our main Theorems in
Section 4 in order to make the presentation more accessible. We develop our main results in the
more general and abstract setting of fiber-linear Lie group actions on sections of vector bundles in
Section 9.
3.1 Matrix Lie groups and subgroups
Matrix Lie groups are ubiquitous in science and engineering. Some familiar examples include the
general linear group GL(n) consisting of all real, invertible, n Ã— n matrices; the orthogonal group
O(n) =

Q âˆˆRnÃ—n : QT Q = I
	
;
(1)
and the special Euclidean group
SE(n) =
Q
b
0
1

: Q âˆˆRnÃ—n, b âˆˆRn, QT Q = I, det(Q) = 1

,
(2)
which represents rotations and translations in an n-dimensional vector space. Observe that these sets
are closed under matrix multiplication and inversion, making them into (non-commutative) groups.
They are also smooth manifolds, which makes them Lie groups (Abraham et al., 1988). While Lie
groups need not consist of matrices (this general case is the setting in Section 9), we confine our
attention for now to â€œmatrix Lie groupsâ€, as they require less abstract machinery. Following Hall
(2015), a matrix Lie group G is defined as any closed subset of GL(n) with the property that G
contains the identity matrix and is closed under matrix multiplication and matrix inversion. All
matrix Lie groups are smooth, embedded submanifolds of GL(n) thanks to a result known as the
closed subgroup theorem (Corollary 3.45, also see Theorem 20.12 in Lee (2013)).
The most useful and profound property of a Lie group is the fact that it is almost entirely
characterized by an associated vector space called the Lie algebra. This allows global nonlinear
questions about the group â€” such as which elements leave a function unchanged â€” to be answered
using linear algebra. The Lie algebra, denoted Lie(G), of a matrix Lie group G is equal to the
tangent space TIG to the manifold G at the identity matrix I (Corollary 3.46). The identity element
of a group is usually denoted e for â€œeinselementâ€, and we shall do this too. This real vector space is
closed under commutation, defined by the â€œLie bracketâ€:
[X, Y ] = XY âˆ’Y X âˆˆLie(G),
(3)
for every X, Y âˆˆLie(G) (Theorem 3.20). For example, the Lie algebra of the orthogonal group O(n)
consists of all skew-symmetric matrices, and is denoted
o(n) =

S âˆˆRnÃ—n : S + ST = 0
	
.
(4)
7

The key tool relating global properties of a matrix Lie group to its Lie algebra is the matrix
exponential, defined by the absolutely convergent series
eA =
âˆ
X
k=0
1
k!Ak.
(5)
Restricting the matrix exponential to the Lie algebra yields the exponential map
exp : Lie(G) â†’G,
which provides a diffeomorphism of an open neighborhood of the origin 0 in Lie(G) and an open
neighborhood of the identity element e in G (Corollary 3.44). The connected component of G
containing the identity element is called the â€œidentity componentâ€ of the Lie group and is denoted G0.
Any element in this component can be expressed as a finite product of exponentials (Corollary 3.47),
that is
G0 =

exp (X1) Â· Â· Â· exp (XN) : X1, . . . , XN âˆˆLie(G), N = 1, 2, 3, . . .
	
.
(6)
The identity component is a normal subgroup of G (Proposition 1.10) and all of the other connected
components of G are diffeomorphic cosets of G0 (Proposition 7.15 in Lee (2013)), as we illustrate
in Figure 1. For example, the special Euclidean group SE(n) is connected, and thus equal to its
identity component. On the other hand, the orthogonal group O(n) has two components consisting of
orthogonal matrices Q whose determinants are 1 and âˆ’1. The identity component of the orthogonal
group is called the special orthogonal group and is denoted SO(n). The special orthogonal group is
compact. It is a general fact that when a Lie group is connected and compact, it is equal to the
image of the exponential map without the need to consider products of exponentials, see Tao (2011)
and Appendix C.1 of Lezcano-Casado and MartÄ±nez-Rubio (2019).
A subgroup H of a Lie group G is called a â€œLie subgroupâ€ when H is an immersed submanifold
of G and the group operations are smooth when restricted to H. An immersed submanifold does
not necessarily inherit its topology as a subset of G, but rather H has a topology and smooth
structure such that the derivative of the inclusion Ä±H : H ,â†’G is injective (see Lee (2013), and
also Theorem 5.23). When G is a matrix Lie group in GL(n), Lie subgroups H cannot generally be
regarded as matrix Lie groups in GL(n), owing to the fact that they may not be closed in GL(n)
(see Section 5.9 in Hall (2015)). When H is a closed Lie subgroup of G, then H is automatically a
matrix Lie group in GL(n). Interestingly, it does turn out that even when H is not closed in GL(n),
H can always be embedded as a matrix Lie group in a larger GL(nâ€²), nâ€² â‰¥n thanks to Theorem 9
in GotÃ´ (1950).
The tangent space to a Lie subgroup H âŠ‚G at the identity, defined as TeH = Range(d Ä±H(I)) âŠ‚
Lie(G), is closed under the Lie bracket and thus forms a â€œLie subalgebraâ€ of Lie(G), denoted Lie(H).
A fundamental result in Lie theory (Theorem 5.20) says that every Lie subalgebra h âŠ‚Lie(G) comes
from a unique connected Lie subgroup of G. These subgroups will correspond to specific model
symmetries in the context of machine learning.
3.2 Group representations, actions, and infinitesimal generators
A matrix Lie group homomorphism is a smooth map Î¦ : G1 â†’G2 between matrix Lie groups that
respects matrix multiplication, that is,
Î¦(g1g2) = Î¦(g1)Î¦(g2).
(7)
8

Lie group, G
G0
TeG âˆ¼= Lie(G)
e
exp(tÎ¾)
Î¾
g1
g1G0
g2
g2G0
Manifold, M
TxM
x
Ë†Î¸(Î¾)(x)
Î¸exp(tÎ¾)(x)
Action, Î¸
Figure 1: A Lie group G and its action Î¸ on a manifold M. The Lie group G consists of three
connected components with G0 being the one that contains the identity element e. Each
non-identity component of G is a coset giG0 formed by translating the identity component
by an arbitrary element gi in the component. The Lie algebra Lie(G) is identified with the
tangent space TeG and an exponential curve exp(tÎ¾) generated by an element Î¾ âˆˆLie(G)
is shown. The infinitesimal generator Ë†Î¸(Î¾) is the vector field on M whose flow corresponds
with the action Î¸exp(tÎ¾) of group elements along exp(tÎ¾).
The tangent map Ï• := d Î¦(e) : Lie(G1) â†’Lie(G2) is a Lie algebra homomorphism (Theorem 3.28),
meaning that it is a linear map respecting the Lie bracket:
Ï•
 [Î¾1, Î¾2]

=

Ï•(Î¾1), Ï•(Î¾2)

.
(8)
Moreover, the Lie group homomorphism and its induced Lie algebra homomorphism are related by
the exponential maps on G1 and G2 via the identity
Î¦
 exp(Î¾)

= exp
 Ï•(Î¾)

.
(9)
Another fundamental result (Theorem 5.6) is that any Lie algebra homomorphism Lie(G1) â†’Lie(G2)
corresponds to a unique Lie group homomorphism G1 â†’G2 when G1 is simply connected. When
G2 is the general linear group on a vector space, then the Lie group and Lie algebra homomorphisms
are called Lie group and Lie algebra â€œrepresentationsâ€.
A Lie group G can act on a vector space V via a representation Î¦ : G â†’GL(V) according to
Î¸ : (x, g) 7â†’Î¦(gâˆ’1)x,
(10)
with x âˆˆV and g âˆˆG. More generally, a nonlinear right action of a Lie group G on a manifold M
is any smooth map Î¸ : M Ã— G â†’M satisfying
Î¸(Î¸(x, g1), g2) = Î¸(x, g1g2)
and
Î¸(x, e) = x
(11)
9

for every x âˆˆM and g1, g2 âˆˆG. Figure 1 depicts the action of a Lie group on a manifold. We
make frequent use of the maps Î¸g = Î¸(Â·, g), which have smooth inverses Î¸gâˆ’1, and the â€œorbit mapsâ€
Î¸(x) = Î¸(x, Â·). For example, using a representation Î¦ : SE(3) â†’GL(R7), the position q and velocity
v of a particle in R3 can be rotated and translated via the action
Î¸
ï£«
ï£­
Q
b
0
1

,
ï£®
ï£°
q
v
1
ï£¹
ï£»
ï£¶
ï£¸= Î¦
QT
âˆ’QT b
0
1
 ï£®
ï£°
q
v
1
ï£¹
ï£»=
ï£®
ï£°
QT
0
âˆ’QT b
0
QT
0
0
0
1
ï£¹
ï£»
ï£®
ï£°
q
v
1
ï£¹
ï£»=
ï£®
ï£°
QT (q âˆ’b)
QT v
1
ï£¹
ï£».
The positions and velocities of n particles arranged as a vector (q1, . . . , qn, v1, . . . , vn, 1) can be
simultaneously rotated and translated via an analogous representation Î¦ : SE(n) â†’GL(R6n+1).
Group actions can be defined more generally, but to avoid abstraction, we temporarily confine
ourselves to group actions defined by representations. The general setting is considered later in
Section 9.
The key fact about a group action is that it is almost completely characterized by a linear map
called the infinitesimal generator. This map Ë†Î¸ assigns to each element Î¾ âˆˆLie(G) in the Lie algebra,
a vector field Ë†Î¸(Î¾) on M defined by
Ë†Î¸(Î¾)(x) = d
d t

t=0
Î¸exp(tÎ¾)(x) = d Î¸(x)(e)Î¾.
(12)
The infinitesimal generator and its relation to the group action are illustrated in Figure 1. For
the linear action in Eq. 10, the infinitesimal generator is the linear vector field Ë†Î¸(Î¾)(x) = âˆ’Ï•(Î¾)x.
Crucially, the flow of the generator recovers the group action along the exponential curve exp(tÎ¾),
i.e.,
Flt
Ë†Î¸(Î¾)(x) = Î¸exp(tÎ¾)(x).
(13)
For the linear right action in Eq. 10, this is easily verified by differentiation, applying Eq. 9, and the
fact that solutions of smooth ordinary differential equations are unique. For a nonlinear right action
this follows from Lemma 20.14 and Proposition 9.13 in Lee (2013).
Remark 1 In contrast to a â€œrightâ€ action Î¸ : M Ã— G â†’M, a â€œleftâ€ action Î¸ : G Ã— M â†’M
satisfies Î¸(g2, Î¸(g1, x)) = Î¸(g2g1, x). While our main results work for left actions too, e.g. Î¸(g, x) =
Î¦(g)x, right actions are slightly more natural because the infintesimal generator is a Lie alegbra
homomorphism, i.e.,
Ë†Î¸([Î¾, Î·]) = [Ë†Î¸(Î¾), Ë†Î¸(Î·)],
(14)
whereas this holds with a sign change for left actions. Every left action Î¸L can be converted into an
equivalent right action defined by Î¸R(x, g) = Î¸L(gâˆ’1, x), and vice versa.
10

4 Fundamental operators for studying symmetry
Here we introduce our main theoretical results for studying symmetries of machine learning models
by focusing on a concrete and useful special case. The basic building blocks of the machine learning
models we consider here are smooth functions F : V â†’W between finite-dimensional vector spaces.
These functions could be layers of a multilayer neural network, integral kernels to be applied to
spatio-temporal fields, or simply linear combinations of user-specified basis functions in a regression
task as in Brunton et al. (2016). General versions of our results for smooth sections of vector bundles
are developed later in Section 9. Our main results show that two families of fundamental linear
operators encode the symmetries of these functions. The fundamental operators allow us to enforce,
promote, and discover symmetry in machine learning models as we describe in Sections 5, 6, and 7.
We consider representations Î¦V : G â†’GL(V) and Î¦W : G â†’GL(W) of a matrix Lie group
G along with their associated actions on the domain V and codomain W of F. The definition of
equivariance, the symmetry group of a function, and the first family of fundamental operators are
introduced by the following:
Definition 2 We say that F is equivariant with respect to a group element g âˆˆG if
(KgF)(x) := Î¦W(g)F(Î¦V(g)âˆ’1x) = F(x)
(15)
for every x âˆˆV. These elements form a subgroup of G denoted SymG(F).
The transformation operators Kg are linear maps of smooth functions to smooth functions with
addition and scalar multiplication defined point-wise. These fundamental operators form a group
with composition KgKh = Kgh and inversion Kâˆ’1
g
= Kgâˆ’1. Thus, g 7â†’Kg is an infinite-dimensional
representation of G. These operators are useful for studying discrete symmetries of functions, as it
is impractical to work directly with the uncountable family {Kg}gâˆˆG of a continuous group G.
The second family of fundamental operators are the key objects we use to study continuous
symmetries of functions. These are the Lie derivatives defined for each Î¾ âˆˆLie(G) by
(LÎ¾F)(x) = d
d t

t=0
 Kexp(tÎ¾)F

(x) = Ï•W(Î¾)F(x) âˆ’âˆ‚F(x)
âˆ‚x
Ï•V(Î¾)x.
(16)
We observe that the Lie derivative is linear with respect to both Î¾ and F. The fundamental operators
and the construction of the Lie derivative are depicted in Figure 2. It turns out (see Proposition 20)
that Î¾ 7â†’LÎ¾ is the Lie algebra representation corresponding to g 7â†’Kg, meaning that
d
d t Kexp(tÎ¾)F = LÎ¾Kexp(tÎ¾)F = Kexp(tÎ¾)LÎ¾F.
and
L[Î¾,Î·] = LÎ¾LÎ· âˆ’LÎ·LÎ¾.
(17)
The first relation together with the closed subgroup theorem are key to proving our two main
theoretical results in the setting of smooth maps between vector spaces. The results stated below
are special cases of more general results developed later in Section 9.
Our first main result provides necessary and sufficient conditions for a smooth map F : V â†’W
to be equivariant with respect to the Lie group actions on V and W. This generalizes the constraints
derived by Finzi et al. (2021) for the linear layers of equivariant multilayer perceptrons.
Theorem 3 Let {Î¾i}dim(G)
i=1
be a basis for the Lie algebra Lie(G) and let {gj}nGâˆ’1
j=1
contain one
element from each non-identity component of G. Then a smooth map F : V â†’W is G-equivariant if
and only if
LÎ¾iF = 0
and
KgjF âˆ’F = 0
(18)
11

V
x
Î¦V(exp(tÎ¾))âˆ’1x
W
F(x)
LÎ¾F(x)
Kexp(tÎ¾)F(x)
W
F
 Î¦V(exp(tÎ¾))âˆ’1x

Î¦W(exp(tÎ¾))
Figure 2: The fundamental operators for functions between vector spaces and linear Lie group
actions defined by representations. The finite transformation operators Kg act on the
function F : V â†’W by composing it with the linear transformation Î¦V(g)âˆ’1 and then
applying Î¦W(g) to the values in W. The function is g-equivariant when this process does
not alter the function. The Lie derivative LÎ¾ is formed by differentiating t 7â†’Kexp(tÎ¾) at
t = 0. Geometrically, LÎ¾F(x) is the vector in W tangent to the curve t 7â†’Kexp(tÎ¾)F(x) in
W passing through F(x) at t = 0.
for every i = 1, . . . , dim(G) and every j = 1, . . . , nG âˆ’1. This is a special case of Theorem 21.
Since the fundamental operators LÎ¾ and Kg are linear, these yield linear constraints for a smooth
map F to be G-equivariant.
Our second main result shows that the continuous symmetries of a given smooth function
F : V â†’W are encoded by its Lie derivatives.
Theorem 4 The symmetry group SymG(F) is a closed, embedded Lie subgroup of G with Lie
subalgebra
symG(F) = {Î¾ âˆˆLie(G) : LÎ¾F = 0} .
(19)
This is a special case of Theorem 22.
This result completely characterizes the identity component of the symmetry group SymG(F) because
the connected Lie subgroups of G are in one-to-one correspondence with Lie subalgebras of Lie(G)
(see Theorem 5.20 in Hall (2015) or Theorem 19.26 in Lee (2013)). Since the condition LÎ¾F = 0 is
linear with respect to Î¾, the Lie subalgebra of the subgroup of symmetries of F can be identified via
linear algebra. In particular it is found by computing the nullspace of the linear operator
LF : Î¾ 7â†’LÎ¾F.
(20)
This operator is defined on the Lie algebra and takes values in the space Câˆ(V; W) of smooth
functions V â†’W.
The preceding two theorems already show the duality between enforcing and discovering con-
tinuous symmetries with respect to the Lie derivative, viewed as a bilinear form (Î¾, F) 7â†’LÎ¾F. To
discover symmetries, we seek generators Î¾ âˆˆLie(G) satisfying LÎ¾F = 0 for a known function F. On
the other hand, to enforce a connected group of symmetries, we seek functions F satisfying LÎ¾iF = 0
with known generators Î¾1, . . . , Î¾dim(G) spanning Lie(G).
12

5 Enforcing symmetry with linear constraints
Methods to enforce symmetry in neural networks and other machine learning models have been
studied extensively, as we reviewed briefly in Section 2.1. A unifying theme in these techniques has
been the use of linear constraints to enforce symmetry (Finzi et al., 2021; Loiseau and Brunton,
2018; Weiler et al., 2018; Cohen et al., 2019; Ahmadi and Khadir, 2020). The purpose of this section
is to show how several of these methods can be understood in terms of the fundamental operators
and linear constraints provided by Theorem 3.
5.1 Multilayer perceptrons
Enforcing symmetry in multilayer percetrons was studied by Finzi et al. (2021). They provide a
practical method based on enforcing linear constraints on the weights defining each layer of a neural
network. The network uses specialized nonlinearities that are automatically equivariant, meaning
that the constraints need only be enforced on the linear component of each layer. We show that the
constraints derived by Finzi et al. (2021) are the same as those given by Theorem 3.
Specifically, each linear layer F (l) : Vlâˆ’1 â†’Vl, for l = 1, . . . , L, is defined by
F (l)(x) = W (l)x + b(l),
(21)
where W (l) are weight matrices and b(l) are bias vectors. Defining group representations Î¦l : G â†’
GL(Vl) for each layer, yields fundamental operators given by
KgF (l)(x) âˆ’F (l)(x) =
 Î¦l(g)W (l)Î¦lâˆ’1(g)âˆ’1 âˆ’W (l)
x + Î¦l(g)b(l) âˆ’b(l)
(22)
LÎ¾F (l)(x) =
 Ï•l(Î¾)W (l) âˆ’W (l)Ï•lâˆ’1(Î¾)

x + Ï•l(Î¾)b(l).
(23)
Let {Î¾i}dim(G)
i=1
be a basis for Lie(G) and let {gj}nGâˆ’1
j=1
consist of an element from each non-identity
component of G. Using the fundamental operators and Theorem 3, it follows that the layer F (l) is
G-equivariant if and only if the weights and biases satisfy
Ï•l(Î¾i)W (l) = W (l)Ï•lâˆ’1(Î¾i),
and
Î¦l(gj)W (l) = W (l)Î¦lâˆ’1(gj),
(24)
Ï•l(Î¾i)b(l) = 0,
and
Î¦l(gj)b(l) = b(l)
(25)
for every i = 1, . . . , dim(G) and j = 1, . . . , ng âˆ’1. These are the same as the linear constraints one
derives using the method by Finzi et al. (2021). The equivariant linear layers are then combined
with specialized equivariant nonlinearities Ïƒ(l) : Vl â†’Vl to produce an equivariant network
F = Ïƒ(L) â—¦F (L) â—¦Â· Â· Â· â—¦Ïƒ(1) â—¦F (1) : V0 â†’VL.
(26)
The composition of equivariant functions is equivariant, as one can easily check using Definition 2.
5.2 Neural networks acting on fields
Enforcing symmetry in neural networks acting on spatial fields has been studied extensively by Weiler
et al. (2018); Cohen et al. (2018); Esteves et al. (2018); Kondor and Trivedi (2018); Cohen et al.
(2019) among others. Many of these techniques use integral operators to define equivariant linear
layers, which are coupled with equivariant nonlinearities, such as the gated nonlinearities proposed
by Weiler et al. (2018). The key task is to identify appropriate bases for equivariant kernels. For
certain groups, such as the Special Euclidean group G = SE(3), bases can be constructed explicitly
13

using spherical harmonics, as in Weiler et al. (2018). We show that equivariance with respect to
arbitrary group actions can be enforced via linear constraints on the integral kernels derived using
the fundamental operators introduced in Section 4. Appropriate bases of kernel functions can then
be constructed numerically by computing an appropriate nullspace, as is done by Finzi et al. (2021)
for multilayer perceptrons.
For the sake of simplicity we consider integral operators acting on vector-valued functions
F : Rm â†’V, where V is a finite-dimensional vector space. Later on in Section 9.4 we study higher-
order integral operators acting on sections of vector bundles. If W is another finite-dimensional
vector space, an integral operator acting on F to produce a new function Rn â†’W is defined by
TKF(x) =
Z
Rm K(x, y)F(y) d y,
(27)
where K(x, y) : V â†’W are linear maps. In other words, this kernel is a function K : Rn Ã— Rm â†’
W âŠ—Vâˆ—, where Vâˆ—denotes the dual space of V. In machine learning applications, we seek to optimize
the kernel functions K defining one or more layers of a neural network.
With group actions defined by representations on Rm, Rn, V, W, functions F : Rm â†’V transform
according to
K(Rm,V)
g
F(x) = Î¦V(g)F(Î¦Rm(g)âˆ’1x)
(28)
for g âˆˆG. Likewise, functions Rn â†’W transform via an analogous operator K(Rn,W)
g
.
Definition 5 The integral operator TK in Eq. 27 is equivariant with respect to g âˆˆG when
K(Rn,W)
g
â—¦TK â—¦K(Rm,V)
gâˆ’1
= TK.
(29)
The elements g satisfying this equation form a subgroup of G denoted SymG(TK).
By changing variables in the integral, the operator on the left is given by
K(Rn,W)
g
â—¦TK â—¦K(Rm,V)
gâˆ’1
F(x) =
Z
Rm KgK(x, y)F(y) d y,
(30)
where
KgK(x, y) = Î¦W(g)K
 Î¦Rn(g)âˆ’1x, Î¦Rm(g)âˆ’1y

Î¦V(g)âˆ’1 det

Î¦Rm(g)âˆ’1
.
(31)
The following result provides equivariance conditions in terms of the kernel, generalizing Lemma 1
in Weiler et al. (2018).
Proposition 6 Let K be continuous and suppose that TK acts on a function space containing all
smooth, compactly supported fields. Then
SymG(TK) = {g âˆˆG : KgK = K} .
(32)
We give a proof in Appendix A
The Lie derivative of the kernel is given by
LÎ¾K(x, y) = Ï•W(Î¾)K(x, y) âˆ’K(x, y)Ï•V(Î¾) âˆ’K(x, y) Tr[Ï•Rm(Î¾)]
âˆ’âˆ‚K(x, y)
âˆ‚x
Ï•Rn(Î¾)x âˆ’âˆ‚K(x, y)
âˆ‚y
Ï•Rm(Î¾)y
(33)
14

The operators Kg and LÎ¾ are the fundamental operators from Section 4 because the transformation
law for the kernel can be written as
KgK = Î¦WâŠ—Vâˆ—(g)K â—¦Î¦RmÃ—Rm(g)âˆ’1,
(34)
where
Î¦RnÃ—Rm(g) : (x, y) 7â†’(Î¦Rn(g)x, Î¦Rm(g)y) ,
Î¦WâŠ—Vâˆ—(g) : T 7â†’Î¦W(g)TÎ¦V(g)âˆ’1 det

Î¦Rm(g)âˆ’1
(35)
are representations of G in Rm Ã— Rm and W âŠ—Vâˆ—.
As an immediate consequence of Theorem 3, we have the following corollary establishing linear
constraints for the kernel to produce an equivariant integral operator.
Corollary 7 Let {Î¾i}dim(G)
i=1
be a basis for the Lie algebra Lie(G) and let {gj}nGâˆ’1
j=1
contain one
element from each non-identity component of G. Under the same hypotheses as Proposition 6, the
integral operator TK in Eq. 27 is G-equivariant in the sense of Definition 5 if and only if
LÎ¾iK = 0
and
KgjK âˆ’K = 0
(36)
for every i = 1, . . . , dim(G) and every j = 1, . . . , nG âˆ’1.
These linear constraint equations must be satisfied to enforced equivariance with respect to a known
symmetry G in the machine learning process. By discretizing the operators Kg and LÎ¾, as discussed
later in Section 8, one can solve these constraints numerically to construct a basis of kernel functions
for equivariant integral operators.
As an immediate consequence of Theorem 4, the following result shows that the Lie derivative
encodes the continuous symmetries of a given integral kernel.
Corollary 8 Under the same hypotheses as Proposition 6, SymG(TK) is a closed, embedded Lie
subgroup of G whose Lie subalgebra is
symG(TK) = {Î¾ âˆˆLie(G) : LÎ¾K = 0} .
(37)
This result will be useful for methods that promote symmetry of the integral operator, as we describe
later in Section 7.
6 Discovering symmetry by computing nullspaces
In this section we show that in a wide range of settings, the continuous symmetries of a manifold,
point cloud, or map can be recovered by computing the nullspace of a linear operator. For functions,
this is already covered by Theorem 4, which allows us to compute the connected subgroup of
symmetries by identifying its Lie subalgebra
symG(F) = Null(LF )
(38)
where LF : Î¾ 7â†’LÎ¾ is the linear operator defined by Eq. 20. Hence, if a machine learning model F
has a symmetry group SymG(F), then its Lie algebra is equal to the nullspace of LF .
This section explains how this is actually a special case of a more general result allowing us to
reveal the symmetries of submanifolds via the nullspace of a closely related operator. We begin with
the more general case where we study the symmetries of a submanifold of Euclidean space, and we
explain how to recover symmetries from point clouds approximating submanifolds. The Lie derivative
15

described in Section 4 is then recovered when the submanifold is the graph of a function. We also
briefly describe how the fundamental operators from Section 4 can be used to recover symmetries
and conservation laws of dynamical systems.
6.1 Symmetries of submanifolds
We begin by studying the symmetries of submanifolds M of Euclidean space Rd using an approach
similar to Cahill et al. (2023). However, we use a different operator that generalizes more naturally
to nonlinear group actions on arbitrary manifolds (see Section 10) and recovers the Lie derivative
(see Section 6.2). With a representation Î¦ : G â†’GL(Rd) of a Lie group, we define invariance of a
submanifold as follows:
Definition 9 A submanifold M âŠ‚Rd is invariant with respect to a group element g âˆˆG if
Î¦(g)z âˆˆM
(39)
for every z âˆˆM. These elements form a subgroup of G denoted SymG(M).
The subgroup of symmetries of a submanifold is characterized by the following theorem.
Theorem 10 Let M be a smooth, closed, embedded submanifold of Rd. Then SymG(M) is a closed,
embedded Lie subgroup of G whose Lie subalgebra is
symG(M) = {Î¾ âˆˆLie(G) : Ï•(Î¾)z âˆˆTzM
âˆ€z âˆˆM}.
(40)
This is a special case of Theorem 31.
The meaning of this result and its practical use for detecting symmetry are illustrated in Figure 3.
To reveal the connected component of SymG(M), we let Pz : Rd â†’Rd be a family of linear
projections onto TzM âŠ‚Rd. These are assumed to vary continuously with respect to z âˆˆM.
Then under the assumptions of the above theorem, symG(M) is the nullspace of the symmetric,
positive-semidefinite operator SM : Lie(G) â†’Lie(G) defined by

Î·, SMÎ¾

Lie(G) =
Z
M
zT Ï•(Î·)T (I âˆ’Pz)T (I âˆ’Pz)Ï•(Î¾)z d Âµ(z)
(41)
for every Î·, Î¾ âˆˆLie(G). We see in Figure 3 that (I âˆ’Pz)Ï•(Î¾)z measures the component of the
infinitesimal generator not tangent to the submanifold at z. Here, Âµ is any strictly positive measure
on M that makes all of these integrals finite. The above formula is useful for computing the matrix
of SM in an orthonormal basis for Lie(G).
Alternatively, when the dimension of G is large, one can compute the nullspace using a Krylov
algorithm such as the one described in Finzi et al. (2021). Such algorithms rely solely on queries of
SM acting on vectors Î¾ âˆˆLie(G), which can be obtained explicitly by
SMÎ¾ =
Z
M
d Î¦(e)âˆ—
(I âˆ’Pz)T (I âˆ’Pz)Ï•(Î¾)zzT 
d Âµ(z),
(42)
where d Î¦(e)âˆ—: RdÃ—d â†’Lie(G) is the adjoint of d Î¦(e) : Lie(G) â†’RdÃ—d.
In practice, one can use sample points zi on the manifold to obtain a Monte-Carlo estimate of
SM with approximate projections Pzi computed using local principal component analysis (PCA), as
described in Cahill et al. (2023). More accurate estimates of the tangent spaces can be obtained
16

M
TzM
z
Ë†Î¸(Î¾)(z) = Ï•(Î¾)z
Î¸exp(tÎ¾)(z)
M
TzM
z
Pz Ë†Î¸(Î¾)(z)
(I âˆ’Pz)Ë†Î¸(Î¾)(z)
Ë†Î¸(Î¾)(z) = Ï•(Î¾)z
Î¸exp(tÎ¾)(z)
Figure 3: Tangency of infinitesimal generators and symmetries of submanifolds. The infinitesimal
generator Ë†Î¸(Î¾) is everywhere tangent to the submanifold M if and only if the curves
t 7â†’Î¸exp(tÎ¾)(z), with z âˆˆM, lie in M for all t. The Lie algebra elements Î¾ satisfying this
tangency condition form the Lie subalgebra of symmetries of M. To test for tangency
of the infinitesimal generator we use a family of projections Pz onto the tangent spaces
TzM for every z âˆˆM. Specifically, (I âˆ’Pz)Ë†Î¸(Î¾) is the component of the infinitesimal
generator that does not lie tangent to M. Hence, Î¾ generates a symmetry of M if and
only if (I âˆ’Pz)Ë†Î¸(Î¾) = 0 for all z âˆˆM.
using the methods in Berry and Giannakis (2020). Assuming the Pzi are accurate, the results of
Section 8, below, can be used to show that the correct nullspace is obtained from finitely many
sample points zi almost surely.
6.2 Symmetries of functions as symmetries of submanifolds
The method described above for studying symmetries of submanifolds can be applied to reveal the
symmetries of smooth maps between vector spaces by identifying the map F : V â†’W with its graph
gr(F) = {(x, F(x)) âˆˆV Ã— W : x âˆˆV}.
(43)
The graph is a smooth, closed, embedded submanifold of the space V Ã— W by Proposition 5.7 in Lee
(2013). We show that this approach recovers the Lie derivative and our result in Theorem 4. By
choosing bases for the domain and codomain, it suffices to consider smooth functions F : Rm â†’Rn.
Supposing that we have representations Î¦Rm and Î¦Rn of G in the domain and codomain, we
consider a combined representation
Î¦ : g 7â†’
Î¦Rm(g)
0
0
Î¦Rn(g)

.
(44)
Defining a smoothly-varying family of projections
P(x,F(x)) =

I
0
d F(x)
0

(45)
17

onto T(x,F(x)) gr(F), it is easy to check that

0
LÎ¾F(x)

=
I
0
0
I

âˆ’

I
0
d F(x)
0

|
{z
}
Iâˆ’P(x,F (x))
Ï•Rm(Î¾)
0
0
Ï•Rn(Î¾)

|
{z
}
Ï•(Î¾)
 x
F(x)

.
(46)
We note that this is a special case of Theorem 34 describing the Lie derivative in terms of a projection
onto the tangent space of a functionâ€™s graph. The resulting operator Sgr(F) defined by Eq. 41 is
given by

Î·, Sgr(F)Î¾

Lie(G) =
Z
Rm(LÎ·F(x))T LÎ¾F(x) d Âµ(x),
(47)
for Î·, Î¾ âˆˆLie(G) and an appropriate positive measure Âµ on Rm that makes the integrals finite.
Therefore, Theorem 4 is recovered from our result about symmetries of submanifolds stated in
Theorem 10.
Related quantities have been used to study the symmetries of trained neural networks, with
the F being the network and its derivatives computed via back-propagation.
The quantity

Î¾, Sgr(F)Î¾

Lie(G) = âˆ¥LÎ¾Fâˆ¥L2(Âµ) was used by Gruver et al. (2022) to construct the Local Equiv-
ariant Error or (LEE), measuring the extent to which a trained neural network F fails to respect
symmetries in the one-parameter group {exp(tÎ¾)}tâˆˆR. The nullspace of Î¾ 7â†’LÎ¾F in the special
case where Î¦Rn(g) = I acts trivially was used by Moskalev et al. (2022) to identify the connected
subgroup with respect to which a given network is invariant.
By viewing a function as a submanifold, we obtain a simple data-driven technique for estimating
the Lie derivative and subgroup of symmetries of the function. To approximate LÎ¾F, Sgr(F), and
symG(F) using input-output pairs (xi, yi = F(xi)), one simply needs to approximate the projection
in Eq. 45 using these data. To do this, we can obtain matrices Ui with m columns spanning
T(xi,yi) gr(F) by applying local PCA to the data zi = (xi, yi), or by pruning the frames computed in
Berry and Giannakis (2020). With E =

ImÃ—m
0mÃ—n

the projection in Eq. 45 is given by
Pzi = Ui(EUi)âˆ’1E
(48)
because any projection is uniquely determined by its range and nullspace (see Section 5.9 of Meyer
(2000)). This gives us a simple way to approximate (LÎ¾F)(zi), Sgr(F), and symG(F) using the
input-output pairs. However, many such pairs are needed since the tangent space to the graph of
F at xi is well-approximated by local PCA only when there are at least m neighboring samples
sufficiently close to xi. Even more samples are needed when they are noisy. The convergence
properties of the spectral methods in Berry and Giannakis (2020) are better, but they still require
enough samples to obtain accurate Monte-Carlo or quadrature-based estimates of integrals, in this
case over Rm.
6.3 Symmetries and conservation laws of dynamical systems
Here, we consider the case when F : Rn â†’Rn is a smooth function defining a dynamical system
d
d t x(t) = F(x(t))
(49)
with state variables x(t) âˆˆRn. The solution of this equation is described by the flow map Fl :
(t, x(Ï„)) 7â†’x(Ï„ +t), which is defined on a maximal connected open set D containing 0Ã—Rn. In many
18

cases we write Flt(Â·) = Fl(t, Â·). Given a Lie group representation Î¦ : G â†’GL(Rn), equivariance for
the dynamical system is defined as follows:
Definition 11 The dynamical system in Eq. 49 is equivariant with respect to a group element
g âˆˆG if the flow map satisfies
Kg Flt(x) := Î¦(g) Flt(Î¦(g)âˆ’1x) = Flt(x)
(50)
for every (t, x) âˆˆD.
Differentiating at t = 0 shows that equivariance of the dynamical system implies that F is equivariant
in the sense of Definition 2. The converse is also true thanks to Corollary 9.14 in Lee (2013), meaning
that equivariance for the dynamical system is equivalent to equivariance of F. Therefore, we can
study equivariance of the dynamical system in Eq. 49 by directly applying the tools developed in
Section 4 to the function F. Thanks to Theorem 4, identifying the connected subgroup of symmetries
for the dynamical system is a simple matter of computing the nullspace of the linear map Î¾ 7â†’LÎ¾F,
that is
symG(F) = {Î¾ âˆˆLie(G) : LÎ¾F = 0}.
(51)
Here, the Lie derivative is given by
LÎ¾F(x) = Ï•(Î¾)F(x) âˆ’âˆ‚F(x)
âˆ‚x
Ï•(Î¾)x = [Ë†Î¸(Î¾), F](x),
(52)
where [Ë†Î¸(Î¾), F] is the Lie bracket of the infinitesimal generator defined by Ë†Î¸(Î¾)(x) = âˆ’Ï•(Î¾)x and the
vector field F. Symmetries can also be enforced as linear constraints on F described by Theorem 3.
This was done by Ahmadi and Khadir (2020) for polynomial dynamical systems with discrete
symmetries. Later on in Section 9.1 we show that analogous results apply to dynamical systems
defined by vector fields on manifolds and nonlinear Lie group actions.
A conserved quantity for the system in Eq. 49 is defined as follows:
Definition 12 A scalar valued quantity f : Rn â†’R is said to be conserved when
Ktf(x) := f(Flt(x)) = f(x)
âˆ€(t, x) âˆˆD.
(53)
In this setting, the composition operators Kt are often referred to as Koopman operators (see
Koopman (1931); MeziÄ‡ (2005); Mauroy et al. (2020); Otto and Rowley (2021); Brunton et al.
(2022)). It is easy to see that a smooth function f is conserved if and only if
LF f := d
d t

t=0
Ktf = âˆ‚f
âˆ‚xF = 0.
(54)
This relation is used by Kaiser et al. (2018, 2021) to identify conserved quantities by computing
the nullspace of LF restricted to finite-dimensional spaces of candidate functions. When the flow is
defined for all t âˆˆR, the operators Kt and LF can be viewed as the fundamental operators for the
nonlinear action of the flow map described later on in Section 9. These are the fundamental operators
from Section 4 for representations Î¦V(t) = eâˆ’At and Î¦W(t) = I of the Lie group G = (R, +) when
F(x) = Ax is a linear dynamical system.
Remark 13 For Hamiltonian dynamical systems Noetherâ€™s theorem establishes a remarkable equiva-
lence between the symmetries of the Hamiltonian and conserved quantities of the system. We study
Hamiltonian systems later in Section 9.3.
19

7 Promoting symmetry with convex penalties
In this section we show how to design custom convex regularization functions to promote symmetries
within a given candidate group during training of a machine learning model. This allows us to
train a model with as many symmetries as possible from among the candidates, while breaking
candidate symmetries only when the data provides sufficient evidence. We study both discrete and
continuous groups of candidate symmetries. We quantify the extent to which symmetries within the
candidate group are broken using the fundamental operators described in Section 4. For discrete
groups we use the transformation operators {Kg}gâˆˆG and for continuous groups we use the Lie
derivatives {LÎ¾}Î¾âˆˆLie(G). In the continuous case we penalize a convex relaxation of the codimension
of the subgroup of symmetries given by a nuclear norm (Schatten 1-norm) of the operator Î¾ 7â†’LÎ¾F
defined by Eq. 20; minimizing this codimension via the proxy nuclear norm will promote the largest
nullspace possible, and hence the largest admissible symmetry group. Once these regularization
functions are developed abstractly in Sections 7.1 and 7.2, we show how the approach can be applied
to basis function regression (Section 7.3) and neural networks (Section 7.4).
As in Section 4, the basic building blocks of the machine learning models we consider are smooth
functions F : V â†’W between finite-dimensional vector spaces. While we consider this restricted
setting here, our results readily generalize to smooth sections of vector bundles, as we describe
later in Section 9. These functions could be layers of a multilayer perceptron, integral kernels to be
applied to spatio-temporal fields, or simply linear combinations of user-specified basis functions in a
regression task. One does not usually optimize over all smooth functions, instead constraining F to
lie in a given subspace F âŠ‚Câˆ(V; W). Working within a finite-dimensional subspace of smooth
functions will be important when we seek to discretize the fundamental operators in Section 8
The candidate symmetries are described by a Lie group G acting on the domain and codomain of
functions F âˆˆF via group representations Î¦V : G â†’GL(V) and Î¦W : G â†’GL(W). Equivariance
in this setting is described by Definition 2. When fitting the function F to data, our regularization
functions penalize the size of G \ SymG(F). For reasons that will become clear, we use different
penalties corresponding to different notions of â€œsizeâ€ when G is a discrete group versus when G is
continuous. The main result describing the continuous symmetries of F is Theorem 4.
7.1 Discrete symmetries
When the group G has finitely many elements, one can measure the size of G \ SymG(F) simply by
counting its elements:
RG,0(F) = |G \ SymG(F)|.
(55)
However, this penalty is impractical for optimization owing to its discrete values and nonconvexity.
Letting âˆ¥Â· âˆ¥be any norm on the space Fâ€² = span{KgF : g âˆˆG, F âˆˆF} yields a convex relaxation
of the above penalty given by
RG,1(F) =
X
gâˆˆG
âˆ¥KgF âˆ’Fâˆ¥.
(56)
This is a convex function on F because Kg is a linear operator. For example, if c = (c1, . . . , cN) are
the coefficients of F in a basis for Fâ€² and K
K
Kg is the matrix of Kg in this basis, then the Euclidean
norm can be used to define
RG,1(F) =
X
gâˆˆG
âˆ¥K
K
Kgc âˆ’câˆ¥2.
(57)
This is directly analogous to the group sparsity penalty proposed in Yuan and Lin (2006).
20

7.2 Continuous symmetries
We now consider the case where G is a Lie group of dimension greater than zero. Here we use
the dimension of SymG(F) to measure the symmetry of F, seeking to penalize the complementary
dimension or â€œcodimensionâ€, given by
RG,0(F) = codim(SymG(F)) = dim(G) âˆ’dim(SymG(F)).
(58)
We take this approach in the continuous case because it is no longer possible to simply count the
number of broken symmetries. While is is possible in principle to replace the sum in Eq. 56 by
an integral, the numerical quadrature required to approximate it becomes prohibitive for higher-
dimensional candidate groups. This is complicated even further by the fact that SymG(F) is a
set of measure zero in G whenever dim(SymG(F)) < dim(G) and our empirical observation that
âˆ¥F âˆ’KgFâˆ¥often increases very rapidly as g leaves the set SymG(F).
The dimension of SymG(F) is equal to that of its Lie algebra. Thanks to Theorem 4, this is the
nullspace of a linear operator LF : Lie(G) â†’Câˆ(V; W) defined by
LF : Î¾ 7â†’LÎ¾F,
(59)
where LÎ¾ is the Lie derivative in Eq. 16. By the rank and nullity theorem, the codimension of
SymG(F) is equal to the rank of this operator:
RG,0(F) = codim(SymG(F)) = rank(LF ).
(60)
Penalizing the rank of an operator is impractical for optimization owing to its discrete values and
nonconvexity. A commonly used convex relaxation of the rank is provided by the Schatten 1-norm,
also known as the â€œnuclear normâ€, given by
RG,âˆ—(F) = âˆ¥LF âˆ¥âˆ—=
dim(G)
X
i=1
Ïƒi(LF ).
(61)
Here Ïƒi(LF ) denotes the ith singular value of LF with respect to inner products on Lie(G) and
Fâ€²â€² = span{LÎ¾F : Î¾ âˆˆLie(G), F âˆˆF}. For certain rank minimization problems, penalizing the
nuclear norm is guaranteed to recover the true minimum rank solution (Recht et al., 2010; Gross,
2011).
Eq. 61 is a convex function on F because F 7â†’LF is linear. For example, if (c1, . . . , cN) are the
coefficients of F in a basis {F1, . . . , FN} for F and LLLFi are the matrices of LFi in orthonormal bases
for Lie(G) and Fâ€²â€², then
RG,âˆ—(F) = âˆ¥c1LLLF1 + Â· Â· Â· + cNLLLFN âˆ¥âˆ—.
(62)
With {Î¾1, . . . , Î¾dim(G)} and {u1, . . . , uNâ€²â€²} being the orthonormal bases for Lie(G) and Fâ€²â€², one can
compute a store the rank-3 tensor [LLLFi]j,k = âŸ¨uj, LÎ¾kFiâŸ©Fâ€²â€².
7.3 Promoting symmetry in basis function regression
Here we consider regression problems for maps F : Rm â†’Rn of the form F(x) = WD(x) where
D : Rm â†’RN is a dictionary consisting of user-specified smooth functions and W âˆˆRnÃ—N is a
weight matrix we seek to fit. For example, the sparse identification of nonlinear dynamics (SINDy)
algorithm (Brunton et al., 2016) belongs to this type of learning, among other machine learning
21

algorithms (Brunton and Kutz, 2022). For such maps we have
(KgF)(x) âˆ’F(x) = Î¦Rn(g)âˆ’1WD(Î¦Rm(g)x) âˆ’WD(x)
(63)
(LÎ¾F)(x) = W âˆ‚D(x)
âˆ‚x
Ï•Rm(Î¾)x âˆ’Ï•Rn(Î¾)WD(x),
(64)
which can be used in Eq. 56 and Eq. 61 to construct symmetry-promoting regularization functions
RG(W) that are convex with respect to the weight matrix W. Given a collection of data consisting
of input-output pairs {(xj, yj)}M
j=1 we can seek a regularized least-squares fit by solving the convex
optimization problem
minimize
WâˆˆRnÃ—N
1
M
M
X
j=1
âˆ¥yj âˆ’WD(xj)âˆ¥2 + Î³RG(WD).
(65)
Here, Î³ â‰¥0 is a parameter controlling the strength of the regularization that can be determined
using cross-validation.
Remark 14 The solutions F = WD of Eq. 65 do not depend on how the dictionary functions are
normalized due to the fact that the function being minimized can be written entirely in terms of
F and the data (xj, yj). This is in contrast to other types of regularized regression problems that
penalize the weights W directly, and therefore depend on how the functions in D are normalized.
7.4 Promoting symmetry in neural networks
In this section we describe a convex regularizing penalty to promote G-equivariance in feed-forward
neural networks
F = F (L) â—¦Â· Â· Â· â—¦F (1)
(66)
composed of layers F (l) : Vlâˆ’1 â†’Vl with group representations Î¦l : G â†’GL(Vl). Since the
composition is g-equivariant if every layer is g-equivariant, the main idea is to measure the symmetries
shared by all of the layers. Specifically, we aim to maximize the â€œsizeâ€ of the subgroup
L
\
l=1
SymG
 F (l)
= {g âˆˆG : KgF (l) = F (l), l = 1, . . . , L} âŠ‚SymG(F),
(67)
where the notion of â€œsizeâ€ we adopt depends on whether G is discrete or continuous. The same
ideas can be applied to neural networks acting on fields with layers defined by integral operators as
described in Section 5.2. In this case we consider symmetries shared by all of the integral kernels.
We consider the case in which the trainable layers are elements of vector spaces Fl, over which
the optimization is carried out. For example, each layer may be given by F (l) = W (l)D(l) as in
Section 7.3, where W (l) is a trainable weight matrix and D(l) is a fixed dictionary of nonlinear
functions. Alternatively, we could follow Finzi et al. (2021) and use trainable linear layers composed
with fixed G-equivariant nonlinearities. In contrast with Finzi et al. (2021), we do not force the
linear layers to be G-equivariant. Rather, we penalize the breaking of G-symmetries in the linear
layers as a means to regularize the neural network and to learn which subgroup of symmetries are
compatible with the data and which are not.
22

As in Section 7.1, when G is a discrete group with finitely many elements, a convex relaxation of
the cardinality of G \ TL
l=1 SymG(F (l)) is
RG,1
 F (1), . . . , F (l)
=
X
gâˆˆG
v
u
u
t
L
X
l=1
KgF (l) âˆ’F (l)2.
(68)
Again, this is analogous to the group-LASSO penalty developed in Yuan and Lin (2006).
When G is a Lie group with nonzero dimension, we follow the approach in Section 7.2 using the
following observation:
Proposition 15 The subgroup in Eq. 67 is closed and embedded in G; its Lie subalgebra is
L
\
l=1
symG
 F (l)
=
n
Î¾ âˆˆLie(G) : LÎ¾F (l) = 0, l = 1, . . . , L
o
.
(69)
We provide a proof in Appendix A.
The Lie subalgebra in the proposition is equal to the nullspace of the linear operator LF (1),...,F (L) :
Lie(G) â†’LL
l=1 Câˆ(Vlâˆ’1; Vl) defined by
LF (1),...,F (L) : Î¾ 7â†’
 LÎ¾F (1), . . . , LÎ¾F (L)
.
(70)
By the rank and nullity theorem, minimizing the rank of this operator is equivalent to maximizing
the dimension of the subgroup of symmetries shared by all of the layers in the network. As in
Section 7.2, a convex relaxation of the rank is provided by the nuclear norm
RG,âˆ—
 F (1), . . . , F (l)
=
LF (1),...,F (L)

âˆ—=

ï£®
ï£¯ï£°
LLLF (1)
...
LLLF (L)
ï£¹
ï£ºï£»

âˆ—
,
(71)
where LLLF (l) are the matrices of LF (l) in orthonormal bases for Lie(G) and the associated spaces Fâ€²â€²
l .
8 Discretizing the operators
This section describes how to construct matrices for the operators LÎ¾ and LF for smooth functions
F in a user-specified finite-dimensional subspace F âŠ‚Câˆ(V; W). By choosing bases for the the
finite-dimensional vector spaces V and W, it suffices without loss of generality to consider the case
in which V = Rm and W = Rn. We focus on constructing the matrix of LÎ¾ since the matrix of Kg
can be obtained in an analogous way with respect to appropriate bases. We assume that Lie(G) and
F are endowed with inner products and that {Î¾1, . . . Î¾dim(G)} and {F1, . . . Fdim(F)} are orthonormal
bases for these spaces, respectively. The key task is to endow the subspace
Fâ€² = span {LÎ¾F : Î¾ âˆˆLie(G), F âˆˆF} âŠ‚Câˆ(Rm; Rn)
(72)
with a convenient inner product. Once this is done, an orthonormal basis {u1, . . . , uN} can be
constructed for Fâ€² by applying a Gram-Schmidt process to the functions LÎ¾iFj. Matrices for LÎ¾ and
23

LF are then easily obtained by computing

LLLÎ¾

i,j =

ui, LÎ¾Fj

Fâ€²,

LLLF

i,k =

ui, LÎ¾kF

Fâ€².
(73)
The issue at hand is to choose the inner product on Fâ€² in a way that makes computing these matrices
easy. A natural choice is to equip Fâ€² with an L2(Rm, Âµ; Rn) inner product where Âµ is a positive
measure on Rm (such as a Guassian distribution) for which the L2 norms of function in Fâ€² are finite.
The problem is that it is usually challenging or inconvenient to compute the required inner products

LÎ¾iFj, LÎ¾kFl

L2(Âµ) =
Z
Rm
 LÎ¾iFj

(x)T  LÎ¾kFl

(x) d Âµ(x)
(74)
analytically. In this section we discuss inner products that are easy to compute in practice.
8.1 Numerical quadrature and Monte-Carlo
When Eq. 74 cannot be computed analytically, one can resort to a numerical quadrature or Monte-
Carlo approximation. In both cases the integral is approximated by a weighted sum, yielding a
semi-inner product
âŸ¨f, gâŸ©L2(ÂµM) = 1
M
M
X
i=1
wif(xi)T g(xi)
(75)
that converges to âŸ¨f, gâŸ©L2(Âµ) as M â†’âˆfor f, g within certain function spaces. The following
proposition means that we do not have to pass to the limit M â†’âˆin order to obtain a valid inner
product defined by Eq. 75 on Fâ€².
Proposition 16 Suppose that Fâ€² is a finite-dimensional and âŸ¨f, gâŸ©L2(ÂµM) â†’âŸ¨f, gâŸ©L2(Âµ) as M â†’âˆ
for every f, g âˆˆFâ€². Then there is an M0 such that Eq. 75 is an inner product on Fâ€² for every
M â‰¥M0. We give a proof in Appendix A.
For example, in Monte-Carlo approximation, the samples xi are drawn independently from a
distribution Î½ with the assumption that both Âµ and Î½ are Ïƒ-finite and Âµ is absolutely continuous
with respect to Î½. The weights are given by the Radon-Nikodym derivative wi = d Âµ
d Î½ (xi). Then for
every f, g âˆˆL2(Âµ) the approximate integral converges âŸ¨f, gâŸ©L2(ÂµM) â†’âŸ¨f, gâŸ©L2(Âµ) as M â†’âˆalmost
surely thanks to the strong law of large numbers (see Theorem 7.7 in Koralov and Sinai (2012)). By
the proposition, there is almost surely a finite M0 such that Eq. 75 is an inner product on Fâ€² for
every M â‰¥M0.
8.2 Subspaces of polynomials
Here we consider the special case when F is a finite-dimensional subspace consisting of polynomial
functions Rm â†’Rn. Examining the expression in Eq. 16, it is evident that LÎ¾F is also a polynomial
function Rm â†’Rn with degree not greater than that of F âˆˆF. Thus, Fâ€² is also a space of
polynomial functions with degree not exceeding the maximum degree in F. Since a polynomial that
vanishes on an open set must be identically zero, we can take the integrals defining the inner product
in Eq. 75 over a cube, such as [0, 1]m âŠ‚Rm. This is convenient because polynomial integrals over
the cube can be calculated analytically.
We can also use the sample-based inner product in Eq. 75 with randomly chosen points xi and
positive weights wi. The following proposition tells us exactly how many sample points we need.
24

Proposition 17 Let Fâ€² be a space of real polynomial functions Rm â†’Rn and let Ï€i : Rn â†’R be
the ith coordinate projection Ï€(c1, . . . , cn) = ci. Let
M â‰¥M0 = max
1â‰¤iâ‰¤n dim(Ï€i(Fâ€²))
(76)
and let w1, . . . , wM > 0 be positive weights. Then for almost every set of points (x1, . . . , xM) âˆˆ(Rm)M
with respect to Lebesgue measure, Eq. 75 is an inner product on Fâ€². We give a proof in Appendix B.
This means that we can draw M â‰¥M0 sample points independently from any absolutely continuous
measure (such as a Gaussian distribution or the uniform distribution on a cube), and with probability
one, Eq. 75 will be an inner product on Fâ€². When F consists of polynomials with degree at most d,
then taking
M â‰¥
d
X
k=0
k + m âˆ’1
m âˆ’1

(77)
is sufficient.
9 Generalization to sections of vector bundles
The machinery for promoting, discovering, and enforcing symmetry of maps F : V â†’W between
finite-dimensional vector spaces is a special case of more general machinery for sections of vector
bundles presented here. Applications of this more general framework include studying the symmetries
of vector and tensor fields on manifolds with respect to nonlinear group actions (Abraham et al.,
1988). Our analysis pertains to all finite-dimensional real Lie groups, and is not confined to matrix
Lie groups acting via representations as in Section 7. We rely heavily on background, definitions,
and results that can be found in Lee (2013) and KolÃ¡Å™ et al. (1993). All manifolds and maps are
assumed to be smooth, that is infinitely continuously differentiable, Câˆ.
First, we provide some background on vector bundles that can be found in Lee (2013, Chapter 10).
A rank-k vector bundle E is a collection of k-dimensional vector spaces Ep, called â€œfibersâ€, organized
smoothly over a base manifold M. This fibers are organized by the â€œbundle projectionâ€ Ï€ : E â†’M,
a surjective map whose preimages are the fibers Ep = Ï€âˆ’1(p). The smoothness of this organization
means that Ï€ is a smooth submersion where E is a smooth manifold covered by smooth local
trivializations
ÏˆÎ± : Ï€âˆ’1(UÎ±) âŠ‚E â†’UÎ± Ã— Rk
with {UÎ±}Î±âˆˆA being open subsets covering M. The transition functions between local trivializations
are Rk-linear, meaning that there are smooth matrix-valued functions TTT Î±,Î² : UÎ± âˆ©UÎ² â†’RkÃ—k
satisfying
ÏˆÎ± â—¦Ïˆâˆ’1
Î² (p, v) = (p,TTT Î±,Î²(p)v)
(78)
for every p âˆˆUÎ± âˆ©UÎ² and v âˆˆRk. The bundle with this structure is often denoted Ï€ : E â†’M.
A â€œsectionâ€ of the rank-k vector bundle Ï€ : E â†’M is a map F : M â†’E satisfying Ï€ â—¦F = IdM.
The space of smooth sections, denoted Î£(E), is a vector space with addition and scalar multiplication
defined pointwise in each fiber Ep. A vector bundle and a section are depicted in Figure 4, along
with the fundamental operators for a group action that we introduce below.
We consider a â€œfiber-linearâ€ right G-action Î˜ : E Ã— G â†’E, meaning that every Î˜g = Î˜(Â·, g) :
E â†’E is a vector bundle homomorphism. In other words, Î˜ descends under the bundle projection
25

M
p
q = Î¸exp(tÎ¾)(p)
Ep
F(p)
LÎ¾F(p)
Kexp(tÎ¾)F(p)
Eq
F(q)
Î˜exp(âˆ’tÎ¾)
E
Ï€
Figure 4: Fundamental operators for sections of vector bundles equipped with fiber-linear Lie group
actions. The action Î˜g is linear on each fiber Ep and descends under the bundle projection
Ï€ : E â†’M to an action Î¸g on M. Given a section F : M â†’E, the finite transformation
operators Kg produce a new section KgF whose value at p is given by evaluating F at
q = Î¸g(p) and pulling the value in Eq back to Ep via the linear map Î˜gâˆ’1 on Eq. The
operators Kg are linear thanks to linearity of Î˜gâˆ’1 on every Eq. The Lie derivative LÎ¾ is
the operator on sections formed by differentiating t 7â†’Kexp(tÎ¾) at t = 0. Geometrically,
LÎ¾F(p) is the vector in Ep lying tangent to the curve t 7â†’Kexp(tÎ¾)F(p) in Ep passing
through F(p) at t = 0.
Ï€ to a unique right G-action Î¸ : M Ã— G â†’M so that the diagram
E
E
M
M
Î˜g
Ï€
Ï€
Î¸g
(79)
commutes and the restricted maps Î˜g|Ep : Ep â†’EÎ¸(p,g) are linear. We define what it means for a
section to be symmetric with respect to this action as follows:
Definition 18 A section F âˆˆÎ£(E) is equivariant with respect to a transformation g âˆˆG if
KgF := Î˜gâˆ’1 â—¦F â—¦Î¸g = F.
(80)
These transformations form a subgroup of G denoted SymG(F).
26

The operators Kg are depicted in Figure 4. Thanks to the vector bundle homomorphism properties
of Î˜gâˆ’1, the operators Kg : Î£(E) â†’Î£(E) are well-defined and linear. Moreover, they form a group
under composition Kg1Kg2 = Kg1Â·g2, with inverses given by Kâˆ’1
g
= Kgâˆ’1.
The â€œinfinitesimal generatorâ€ of the group action is the linear map Ë†Î˜ : Lie(G) â†’X(E) defined by
Ë†Î˜(Î¾) = d
d t

t=0
Î˜exp(tÎ¾).
(81)
It turns out that this vector field is Î˜-related to 0 Ã— Î¾ âˆˆX(M Ã— G) (see Lemma 5.13 in KolÃ¡Å™ et al.
(1993), Lemma 20.14 in Lee (2013)), meaning that the flow of Ë†Î˜(Î¾) is given by
Flt
Ë†Î˜(Î¾) = Î˜exp(tÎ¾).
(82)
Likewise, Î¸exp(tÎ¾) is the flow of Ë†Î¸(Î¾) =
d
d t

t=0 Î¸exp(tÎ¾) âˆˆX(M), which is Ï€-related to Ë†Î˜(Î¾).
Differentiating the smooth curves t 7â†’Kexp(tÎ¾)F(p) lying in Ep for each p âˆˆM gives rise to the
Lie derivative LÎ¾ : Î£(E) â†’Î£(E) along Î¾ âˆˆLie(G) defined by
LÎ¾F = d
d t

t=0
Kexp(tÎ¾)F = lim
tâ†’0
1
t
 Î˜exp(âˆ’tÎ¾) â—¦F â—¦Î¸exp(tÎ¾) âˆ’F

,
(83)
where the derivative and limit are understood pointwise and we identify TF(p)Ep âˆ¼= Ep. This
construction is illustrated in Figure 4. We recover Eq. 16 from Eq. 83 in the special case where a
smooth function F : V â†’W is viewed as a section x 7â†’(x, F(x)) of the bundle Ï€ : V Ã— W â†’V and
acted upon by group representations. Critically, the Lie derivative LÎ¾, as defined above, is a linear
operator on sections of the vector bundle E. This allows us to formulate convex symmetry-promoting
regularization functions as in Section 7 using Lie derivatives in the broader setting of vector bundle
sections.
Remark 19 (Lie derivatives using flows) Thanks to Eq. 82, the Lie derivative defined in Eq. 83
only depends on the infinitesimal generator Ë†Î˜(Î¾) âˆˆX(E), and its flow for small time t. Hence, any
vector field in X(E) whose flow is fiber-linear, but not necessarily defined for all t âˆˆR, gives rise
to an analogously-defined Lie derivative acting linearly on Î£(E). These are the so-called â€œlinear
vector fieldsâ€ described by KolÃ¡Å™ et al. (1993) in Section 47.9. In fact, more general versions of the
Lie derivative based on flows for maps between manifolds are described by KolÃ¡Å™ et al. (1993) in
Chapter 11. However, these generalizations are nonlinear operators, destroying the convex properties
of the symmetry-promoting regularization functions in Section 7.
In addition to linearity, the key properties of the operators Kg and LÎ¾ for studying symmetries
of sections are:
Proposition 20 For every F âˆˆÎ£(E), Î¾, Î· âˆˆLie(G), and Î±, Î², t âˆˆR, we have
d
d t Kexp(tÎ¾)F = LÎ¾Kexp(tÎ¾)F = Kexp(tÎ¾)LÎ¾F,
(84)
LÎ±Î¾+Î²Î· = Î±LÎ¾ + Î²LÎ·,
(85)
and
L[Î¾,Î·] = LÎ¾LÎ· âˆ’LÎ·LÎ¾.
(86)
We give a proof in Appendix C.
27

Taken together, these results mean that Î  : g 7â†’Kg and Î âˆ—: Î¾ 7â†’LÎ¾ are (infinite-dimensional)
representations of G and Lie(G).
The main results of this section are the following two theorems. The first gives necessary and
sufficient conditions for a section to be G-equivariant, while the second completely characterizes the
identity component of SymG(F) by correspondence with its Lie subgalgebra.
Theorem 21 Let G0 be the identity component of G. A section F âˆˆÎ£(E) is G0-equivariant if and
only if
LÎ¾F = 0
âˆ€Î¾ âˆˆLie(G).
(87)
If, in addition, we have KgiF = F for a single gi from each non-identity component of G, then F is
G-equivariant. We give a proof in Appendix D.
Theorem 22 If F âˆˆÎ£(E) is a section, then SymG(F) is a closed, embedded Lie subgroup of G
whose Lie subalgebra is
symG(F) = {Î¾ âˆˆLie(G) : LÎ¾F = 0} .
(88)
We give a proof in Appendix E.
These results allow us to promote, enforce, and discover symmetries for sections of vector bundles
in fundamentally the same way we did for maps between finite-dimensional vector spaces in Sec-
tions 5, 6, and 7. In particular, symmetry can be enforced through analogous linear constraints,
discovered through nullspaces of analogous operators, and promoted through analogous convex
penalties based on the nuclear norm.
Remark 23 (Left actions) Theorems 21 and 22 hold without any modification for left G-actions
Î˜L : G Ã— E â†’E. This is because we can define a corresponding right G-action by Î˜R(p, g) =
Î˜L(gâˆ’1, p) with associated operators related by
KR
g = KL
gâˆ’1
and
LR
Î¾ = âˆ’LL
Î¾ .
(89)
The symmetry group SymG(F) does not depend on whether it is defined by the condition KR
g F = F
or by KL
g F = F. It is slighly less natural to work with left actions because Î L : g 7â†’KL
g and
Î L
âˆ—: Î¾ 7â†’LL
Î¾ are Lie group and Lie algebra anti-homomorphisms, that is,
Î L(g1g2) = Î L(g2)Î L(g1)
and
Î L
âˆ—
 [Î¾, Î·]

=

Î L
âˆ—(Î·), Î L
âˆ—(Î¾)

.
(90)
9.1 Vector fields
Here we study the symmetries of a vector field V âˆˆX(M) under a right G-action Î¸ : M Ã— G â†’M.
This allows us to extend the discussion in Section 6.3 to dynamical systems described by vector
fields on smooth manifolds and acted upon nonlinearly by arbitrary Lie groups. The tangent map
of the diffeomorhpism Î¸g = Î¸(Â·, g) : M â†’M transforms vector fields via the pushforward map
(Î¸g)âˆ—: X(M) â†’X(M) defined by
((Î¸g)âˆ—V )pÂ·g = d Î¸g(p)Vp
(91)
for every p âˆˆM.
Definition 24 Given g âˆˆG, we say that a vector field V âˆˆX(M) is g-invariant if and only if
(Î¸g)âˆ—V = V , that is,
VpÂ·g = d Î¸g(p)Vp
âˆ€p âˆˆM.
(92)
28

Because (Î¸gâˆ’1)âˆ—(Î¸g)âˆ—= (Î¸gâˆ’1 â—¦Î¸g)âˆ—= IdX(M), it is clear that a vector field is g-invariant if and only
if it is gâˆ’1-invariant.
Recall that vector fields V âˆˆX(M) are smooth sections of the tangent bundle E = TM. The
right G-action Î¸ on M induces a right G-action Î˜ : TM Ã— G â†’TM on the tangent bundle defined
by
Î˜g(vp) = d Î¸g(p)vp.
(93)
It is easy to see that each Î˜g is a vector bundle homomorphism descending to Î¸g under the bundle
projection Ï€. Crucially, we have
KgV = Î˜gâˆ’1 â—¦V â—¦Î¸g = (Î¸gâˆ’1)âˆ—V,
(94)
meaning that a vector field V âˆˆX(M) is g-invariant if and only if it is g-equivariant as a section of
TM with respect to the action Î˜. Recall that (by Lemma 20.14 in Lee (2013)) the left-invariant
vector field Î¾ âˆˆLie(G) âŠ‚X(G) and its infinitesimal generator Ë†Î¸(Î¾) âˆˆX(M) are Î¸(p)-related,
where Î¸(p) : g 7â†’Î¸(p, g) is the orbit map. This means that Î¸exp(tÎ¾) is the time-t flow of Ë†Î¸(Î¾) by
Proposition 9.13 in Lee (2013). As a result, the Lie derivative in Eq. 83 agrees with the standard Lie
derivative of V along Ë†Î¸(Î¾) (see Lee (2013, p.228)), that is,
LÎ¾V (p) = lim
tâ†’0
1
t
h
d Î¸exp(âˆ’tÎ¾)(Î¸exp(tÎ¾)(p))VÎ¸exp(tÎ¾)(p) âˆ’Vp
i
= [Ë†Î¸(Î¾), V ]p,
(95)
where the expression on the right is the Lie bracket of Ë†Î¸(Î¾) and V .
9.2 Tensor fields
Symmetries of a tensor field can also be revealed using our framework. This will be useful for our
study of Hamiltonian dynamics in Section 9.3 and for our study of integral operators, whose kernels
can be viewed as tensor fields, in Section 9.4. For simplicity, we consider a rank-k covariant tensor
field A âˆˆTk(M), although our results extend to contravariant and mixed tensor fields with minimal
modification. We rely on the basic definitions and machinery found in Lee (2013, Chapter 12). Under
a right G-action Î¸ on M, the tensor field transforms via the pullback map Î¸âˆ—
g : Tk(M) â†’Tk(M)
defined by
(Î¸âˆ—
gA)p(v1, . . . , vk) = (d Î¸g(p)âˆ—ApÂ·g)(v1, . . . , vk) = ApÂ·g(d Î¸g(p)v1, . . . , d Î¸g(p)vk)
(96)
for every v1, . . . , vk âˆˆTpM.
Definition 25 Given g âˆˆG, a tensor field A âˆˆTk(M) is g-invariant if and only if Î¸âˆ—
gA = A, that
is,
ApÂ·g(d Î¸g(p)v1, . . . , d Î¸g(p)vk) = Ap(v1, . . . , vk)
âˆ€p âˆˆM.
(97)
To study the invariance of tensor fields in our framework, we recall that a tensor field is a section
of the tensor bundle E = T kT âˆ—M = `
pâˆˆM(T âˆ—
p M)âŠ—k, a vector bundle over M, where T âˆ—
p M is the
dual space of TpM. The right G-action Î¸ on M induces a right G-action Î˜ : T kTM Ã— G â†’T kTM
defined by
Î˜g(Ap) = d Î¸gâˆ’1(Î¸g(p))âˆ—Ap.
(98)
29

It is clear that each Î˜g is a homomorphism of the vector bundle T kT âˆ—M descending to Î¸g under
the bundle projection. Crucially, we have
KgA = Î˜gâˆ’1 â—¦A â—¦Î¸g = Î¸âˆ—
gA,
(99)
meaning that A âˆˆTk(M) is g-invariant if and only if it is g-equivariant as a section of T kT âˆ—M with
respect to the action Î˜. Since Î¸exp(tÎ¾) gives the time-t flow of the vector field Ë†Î¸(Î¾) âˆˆX(M), the Lie
derivative in Eq. 83 for this action agrees with the standard Lie derivative of A âˆˆTk(M) along Ë†Î¸(Î¾)
(see Lee (2013, p.321)), that is
(LÎ¾A)p = lim
tâ†’0
1
t
h
d Î¸exp(tÎ¾)(p)âˆ—AÎ¸exp(tÎ¾)(p) âˆ’Ap
i
= (LË†Î¸(Î¾)A)p.
(100)
The Lie derivative for arbitrary covariant tensor fields can be computed by applying Proposition 12.32
in Lee (2013) and its corollaries. More generally, thanks to 6.16-18 in KolÃ¡Å™ et al. (1993), the Lie
derivative for any tensor product of sections of natural vector bundles can be computed via the
formula
LÎ¾(A1 âŠ—A2) = (LÎ¾A1) âŠ—A2 + A1 âŠ—(LÎ¾A2).
(101)
For example, this holds when A1, A2 are arbitrary smooth tensor fields of mixed types. The Lie
derivative of a differential form Ï‰ on M can be computed by Cartanâ€™s magic formula
LÎ¾Ï‰ = Ë†Î¸(Î¾) âŒŸ(d Ï‰) + d(Ë†Î¸(Î¾) âŒŸÏ‰),
(102)
where d is the exterior derivative.
9.3 Hamiltonian dynamics
The dynamics of frictionless mechanical systems can be described by Hamiltonian vector fields on
symplectic manifolds. Roughly speaking, these encompass systems that conserve energy, such as
motion of rigid bodies and particles interacting via conservative forces. The celebrated theorem of
Noether (1918) says that conserved quantities of Hamiltonian systems correspond with symmetries
of the energy function (the systemâ€™s Hamiltonian). In this section, we briefly illustrate how to
enforce Hamiltonicity constraints on learned dynamical systems and how to promote, discover, and
enforce conservation laws. A thorough treatment of classical mechanics, symplectic manifolds, and
Hamiltonian systems can be found in Abraham and Marsden (2008); Marsden and Ratiu (1999).
This includes methods for reduction of systems with known symmetries and conservation laws. The
following brief introduction follows Chapter 22 of Lee (2013).
Hamiltonian systems are defined on symplectic manifolds. That is, a smooth even-dimensional
manifold S together with a smooth nondegenerate differential 2-form Ï‰, called the symplectic form.
Nondegeneracy means that the map Ë†Ï‰p : v 7â†’Ï‰p(v, Â·) is a bijective linear map of TpS onto its dual
T âˆ—
p S for every p âˆˆS. Thanks to nondegeneracy, any smooth function H âˆˆCâˆ(S) gives rise to a
smooth vector field
VH = Ë†Ï‰âˆ’1(d H)
(103)
called the â€œHamiltonian vector fieldâ€ of H. A vector field V âˆˆX(S) is said to be Hamiltonian if
V = VH for some function H, called the Hamiltonian of V . A vector field is locally Hamiltonian if it
is Hamiltonian in neighborhood of each point of S.
The symplectic manifolds considered in classical mechanics usually consist of the cotangent
bundle S = T âˆ—M of an m-dimensional manifold M describing the â€œconfigurationâ€ of the system,
30

e.g., the positions of particles. The cotangent bundle has a canonical symplectic form given by
Ï‰ =
m
X
i=1
d xi âˆ§d Î¾i,
(104)
where (xi, Î¾i) are any choice of natural coordinates on a patch of T âˆ—M (see Proposition 22.11 in
Lee (2013)). Here, each xi is a generalized coordinate describing the configuration and Î¾i is its
â€œconjugateâ€ or â€œgeneralizedâ€ momentum. The Darboux theorem (Theorem 22.13 in Lee (2013)) says
that any symplectic form on a manifold can be put into the form of Eq. 104 by a choice of local
coordinates. In these â€œDarbouxâ€ coordinates, the dynamics of a Hamiltonian system are governed by
the equations
d
d t xi = VH(xi) = âˆ‚H
âˆ‚Î¾i
,
d
d t Î¾i = VH(Î¾i) = âˆ’âˆ‚H
âˆ‚xi ,
(105)
which should be familiar to anyone who has studied undergraduate mechanics.
Enforcing local Hamiltonicity on a vector field V âˆˆX(S) is equivalent to the linear constraint
LV Ï‰ = 0
(106)
thanks to Proposition 22.17 in Lee (2013). Here LV is the Lie derivative of the tensor field Ï‰ âˆˆT2(S),
i.e., Eq. 100 with Î¸ being the flow of V and its generator being the identity Ë†Î¸(V ) = V . Note that
the Lie derivative still makes sense even when the orbits t 7â†’Î¸t(p) = Î¸exp(t1)(p) are only defined for
small t âˆˆ(âˆ’Îµ, Îµ). In Darboux coordinates, this constraint is equivalent to the set of equations
âˆ‚V (xi)
âˆ‚xj
+ âˆ‚V (Î¾j)
âˆ‚Î¾i
= 0,
âˆ‚V (Î¾i)
âˆ‚xj
âˆ’âˆ‚V (Î¾j)
âˆ‚xi
= 0,
âˆ‚V (xi)
âˆ‚Î¾j
âˆ’âˆ‚V (xj)
âˆ‚Î¾i
= 0
(107)
for all 1 â‰¤i, j â‰¤m. When the first de Rham cohomology group satisfies H1
dR(S) = 0, for example
when S is contractible, local Hamilonicity implies the existence of a global Hamiltonian for V , unique
on each component of S up to addition of a constant by Lee (2013, Proposition 22.17).
Of course our approach also makes it possible to promote Hamiltonicity with respect to candidate
symplectic structures when learning a vector field V . To do this, we can penalize the nuclear norm
of LV restricted to a subspace Ëœâ„¦of candidate 2-forms using the regularization function
RËœâ„¦,âˆ—(V ) =
 LV |Ëœâ„¦

âˆ—.
(108)
The strength of this penalty can be increased when solving a regression problem for V until there is
a non-degenerate 2-form in the nullspace Null(LV ) âˆ©Ëœâ„¦. This gives a symplectic form with respect
to which V is locally Hamiltonian.
Another option is to learn a (globally-defined) Hamiltonian function H directly by fitting VH to
data. In this case, we can regularize the learning problem by penalizing the breaking of conservation
laws. The time-derivative of a quantity, that is, a smooth function f âˆˆCâˆ(S) under the flow of VH
is given by the Poisson bracket
{f, H} := Ï‰(Vf, VH) = d f(VH) = VH(f) = âˆ’Vf(H).
(109)
Hence, f is a conserved quantity if and only if H is invariant under the flow of Vf â€” this is Noetherâ€™s
theorem. It is also evident that the Poisson bracket is linear with respect to both of its arguments.
In fact, the Poisson bracket turns Câˆ(S) into a Lie algebra with f 7â†’Vf being a Lie algebra
homomorphism, i.e., V{f,g} = [Vf, Vg].
31

As a result of these basic properties of the Poisson bracket, the quantities conserved by a given
Hamiltonian vector field VH form a Lie subalgebra given by the nullspace of a linear operator
LH : Câˆ(S) 7â†’Câˆ(S) defined by
LH : f 7â†’{f, H}.
(110)
To promote conservation of quantities in a given subalgebra g âŠ‚Câˆ(S) when learning a Hamiltonian
H, we can penalize the nuclear norm of LH restricted to g, that is
Rg,âˆ—(H) =
 LH|g

âˆ—.
(111)
For example, we might expect a mechanical system to conserve angular momentum about some axes,
but not others due to applied torques. In the absence of data to the contrary, it often makes sense
to assume that various linear and angular momenta are conserved.
9.4 Equivariant integral operators
In this section we provide machinery to study the symmetries of linear and nonlinear integral
operators acting on sections of vector bundles, yielding far-reaching generalizations of our results
in Section 5.2. Such operators can form the layers of neural networks acting on various vector and
tensor fields supported on manifolds.
Let Ï€0 : E0 â†’M0 and Ï€j : Ej â†’Mj be vector bundles with Mj being dj-dimensional orientable
Riemannian manifolds with volume forms dVj âˆˆâ„¦dj(T âˆ—Mj), j = 1, . . . , r. Note that here, dVj does
not denote the exterior derivative of a (dj âˆ’1)-form. A section K of the bundle
E = E0 âŠ—Eâˆ—
1 âŠ—Â· Â· Â· âŠ—Eâˆ—
r :=
a
(p,q1,...,qr)âˆˆM0Ã—Â·Â·Â·Ã—Mr
E0,p âŠ—Eâˆ—
1,q1 âŠ—Â· Â· Â· âŠ—Eâˆ—
r,qr
(112)
can be viewed as a smooth family of r-multilinear maps
K(p, q1, . . . , qr) :
r
M
j=1
Ej,qj â†’E0,p.
(113)
The section K can serve as the kernel to define an r-multilinear integral operator TK : D(TK) âŠ‚
Lr
j=1 Î£(Ej) â†’Î£(E0) with action on (F1, . . . , Fr) âˆˆD(TK) given by
TK[F1, . . . , Fr](p) =
Z
M1Ã—Â·Â·Â·Ã—Mr
K(p, q1, . . . , qr)

F1(q1), . . . , Fr(qr)

dV1(q1) âˆ§Â· Â· Â· âˆ§dVr(qr). (114)
This operator is linear when r = 1. When r > 1 and E1 = Â· Â· Â· = Er, Eq. 114 can be used to define a
nonlinear integral operator Î£(E1) â†’Î£(E0) with action F 7â†’TK[F, . . . , F].
Given fiber-linear right G-actions Î˜j : Ej Ã— G â†’Ej, there is an induced fiber-linear right
G-action Î˜ : E Ã— G â†’E on E defined by
Î˜g(Kp,q1,...,qr)

v1, . . . , vr

= Î˜0,g
 Kp,q1,...,qr

Î˜1,gâˆ’1(v1), . . . , Î˜r,gâˆ’1(vr)

(115)
for Kp,q1,...,qr âˆˆE viewed as an r-multilinear map E1,q1 âŠ•Â· Â· Â· âŠ•Er,qr â†’E0,p and vj âˆˆEj,Î¸j,g(qj).
Sections Fj âˆˆÎ£(Ej) transform according to
KEj
g Fj = Î˜j,gâˆ’1 â—¦Fj â—¦Î¸j,g,
(116)
32

with the section defining the integral kernel transforming according to
KE
g K(p, q1, . . . , qr)[vq1, . . . , vqr] =
Î˜0,gâˆ’1
n
K
 Î¸0,g(p), Î¸1,g(q1), . . . , Î¸r,g(qr)

Î˜1,g(vq1), . . . , Î˜r,g(vqr)
o
.
(117)
Using these transformation laws, we define equivariance for the integral operator as follows:
Definition 26 The integral operator in Eq. 114 is equivariant with respect to g âˆˆG if
KE0
g TK

KE1
gâˆ’1F1, . . . , KEr
gâˆ’1Fr

= TK

F1, . . . , Fr

(118)
for every (F1, . . . , Fr) âˆˆD(TK).
Using the fact that the integral is invariant under pullbacks by diffeomorphisms, we can express
the left-hand-side of the equivariance condition as
K0,gTK

K1,gâˆ’1F1, . . . , Kr,gâˆ’1Fr

(p) =
Î˜0,gâˆ’1
( Z
M1Ã—Â·Â·Â·Ã—Mr
K(Î¸0,g(p), q1, . . . , qr)

Î˜1,g â—¦F1 â—¦Î¸1,gâˆ’1(q1), . . . , Î˜r,g â—¦Fr â—¦Î¸r,gâˆ’1(qr)

dV1(q1) âˆ§Â· Â· Â· âˆ§dVr(qr).
)
=
Î˜0,gâˆ’1
( Z
M1Ã—Â·Â·Â·Ã—Mr
K(Î¸0,g(p), Î¸1,g(q1), . . . , Î¸r,g(qr))

Î˜1,g â—¦F1(q1), . . . , Î˜r,g â—¦Fr(qr)

Î¸âˆ—
1,g dV1(q1) âˆ§Â· Â· Â· âˆ§Î¸âˆ—
r,g dVr(qr).
)
=
Z
M1Ã—Â·Â·Â·Ã—Mr
KE
g K(p, q1, . . . , qr)

F1(q1), . . . , Fr(qr)

Î¸âˆ—
1,g dV1(q1) âˆ§Â· Â· Â· âˆ§Î¸âˆ—
r,g dVr(qr). (119)
Hence, the condition for equivariance of TK is equivalent to
Kg
 K dV1 âˆ§Â· Â· Â· âˆ§Vr

:= KE
g (K) Î¸âˆ—
1,g dV1 âˆ§Â· Â· Â· âˆ§Î¸âˆ—
r,g dVr = K dV1 âˆ§Â· Â· Â· âˆ§dVr,
(120)
where we note that Kâ„¦
g (dVj) = Î¸âˆ—
j,g dVj is the natural transformation of the differential form
dVj âˆˆâ„¦dj(T âˆ—Mj) (a covariant tensor field) described in Section 9.2. The Lie derivative of the
action on volume forms is given by
Lâ„¦
Î¾ dV = d
 Ë†Î¸(Î¾) âŒŸdV

= div Ë†Î¸(Î¾) dV
(121)
thanks to Cartanâ€™s magic formula and the definition of divergence (see Lee (2013)). Therefore,
differentiating Eq. 120 along the curve g(t) = exp(tÎ¾) yields the Lie derivative
LÎ¾
 K dV1 âˆ§Â· Â· Â· âˆ§dVr

=

LE
Î¾ (K) + K
r
X
j=1
div Ë†Î¸j(Î¾)

dV1 âˆ§Â· Â· Â· âˆ§dVr .
(122)
For the integral operators discussed in Section 5.2, the formulas derived here recover Eqs. 31 and 33.
33

10 Invariant submanifolds and tangency
Studying the symmetries of maps can be cast into a more general framework in which we study
the symmetries of submanifolds. Specifically, the symmetries of a map F : M0 â†’M1 between
manifolds correspond to symmetries of its graph, gr(F), and the symmetries of a section of a vector
bundle F âˆˆÎ£(E) correspond to symmetries of its image, im(F) â€” both of which are properly
embedded submanifolds of M0 Ã— M1 and E, respectively. We show that symmetries of a large class
of submanifolds, including the above, are revealed by checking whether the infinitesimal generators
of the group action are tangent to the submanifold. In this setting, the Lie derivative of F âˆˆÎ£(E)
has a geometric interpretation as a projection of the infintesimal generator onto the tangent space of
the image im(F), viewed as a submanifold of the bundle.
10.1 Symmetry of submanifolds
In this section we study the infinitesimal conditions for a submanifold to be invariant under the
action of a Lie group. Suppose that N is a manifold and Î¸ : N Ã— G â†’N is a right action of a
Lie group G on N. Sometimes we denote this action by p Â· g = Î¸(p, g) when there is no ambiguity.
Though our results also hold for left actions, as we discuss later in Remark 32, working with right
actions is standard in this context and allows us to leverage results from Lee (2013) more naturally
in our proofs. Fixing p âˆˆN, the orbit map of this action is denoted Î¸(p) : G â†’N. Fixing g âˆˆG,
the map Î¸g : N â†’N defined by Î¸g : p 7â†’Î¸(p, g) is a diffeomorphism with inverse Î¸gâˆ’1.
Definition 27 A subset M âŠ‚N is G-invariant if and only if Î¸(p, g) âˆˆM for every g âˆˆG and
p âˆˆM.
Sometimes we will denote M Â· G = {Î¸(p, g) : p âˆˆM, g âˆˆG}, in which case G-invariance of M can
be stated as M Â· G âŠ‚M.
We study the group invariance of submanifolds of the following type:
Definition 28 Let M be a weakly embedded m-dimensional submanifold of an n-dimensional mani-
fold N. We say that M is arcwise-closed if any smooth curve Î³ : [a, b] â†’N satisfying Î³((a, b)) âŠ‚M
must also satisfy Î³([a, b]) âŠ‚M.
Submanifolds of this type include all properly embedded submanifolds of N because properly
embedded submanifolds are closed subsets (Proposition 5.5 in Lee (2013)). More interestingly, we
have the following:
Proposition 29 The leaves of any (nonsingular) foliation of N are arcwise-closed. We provide a
proof in Appendix A.
This means that the kinds of submanifolds we are considering include all possible Lie subgroups
(Lee (2013, Theorem 19.25)) as well as their orbits under free and proper group actions (Lee (2013,
Proposition 21.7)). The leaves of singular foliations associated with integrable distributions of
nonconstant rank (see KolÃ¡Å™ et al. (1993, Sections 3.18â€“25)) can fail to be arcwise-closed. For
example, the distribution spanned by the vector field x âˆ‚
âˆ‚x on R has maximal integral manifolds
(âˆ’âˆ, 0), {0}, and (0, âˆ) forming a singular foliation of R. Obviously, the leaves (âˆ’âˆ, 0) and (0, âˆ)
are not arcwise-closed.
The following theorem provides necessary and sufficient conditions for arcwise-closed weakly-
embedded submanifolds to be G-invariant.
34

Theorem 30 Let M be an arcwise-closed weakly-embedded submanifold of N and let Î¸ : N Ã—G â†’N
be a right action of a Lie group G on N with infinitesimal generator Ë†Î¸ : Lie(G) â†’X(N). Let G0 be
the identity component of G. Then M is G0-invariant if and only if
Ë†Î¸(Î¾)p âˆˆTpM
âˆ€p âˆˆM
âˆ€Î¾ âˆˆLie(G).
(123)
If, in addition, we have M Â· gi âŠ‚M for a single gi from each non-identity component of G, then M
is G-invariant. A proof is provided in Appendix F.
Since the infinitesimal generator Ë†Î¸ is a linear map and TpM is a subspace of TpN, the tangency
condition expressed in Eq. 123 can be viewed as a set of linear constraints satisfied by the elements
of the Lie algebra.
Given a candidate Lie group G and a submanifold M âŠ‚N with unknown symmetries, we can
ask which elements of the Lie algebra Lie(G) satisfy the tangency conditions. The following theorem
shows that these elements form the subalgebra corresponding to the largest connected Lie subgroup
of symmetries of M in G.
Theorem 31 Let M be an immersed submanifold of N and let Î¸ : N Ã— G â†’N be a right action
of a Lie group G on N with infinitesimal generator Ë†Î¸ : Lie(G) â†’X(N). Then
symG(M) =

Î¾ âˆˆLie(G) : Ë†Î¸(Î¾)p âˆˆTpM
âˆ€p âˆˆM
	
(124)
is the Lie subalgebra of a unique connected Lie subgroup SymG(M)0 âŠ‚G. If M is weakly-embedded
and arcwise-closed in N, then this subgroup has the following properties:
(i) M Â· SymG(M)0 âŠ‚M
(ii) If H is a connected Lie subgroup of G such that M Â· H âŠ‚M, then H âŠ‚SymG(M)0.
If M is properly embedded in N then SymG(M)0 is the identity component of the closed, properly
embedded Lie subgroup
SymG(M) = {g âˆˆG : M Â· g âŠ‚M}.
(125)
A proof is provided in Appendix G.
Remark 32 (Left actions) When the group G acts on N from the left according to Î¸L : G Ã— N â†’
N, we can always construct an equivalent right-action Î¸R : N Ã— N â†’N by setting Î¸R(p, g) =
Î¸L(gâˆ’1, p). The corresponding infinitesimal generators are related by Ë†Î¸R = âˆ’Ë†Î¸L. Since Ë†Î¸L(Î¾)p âˆˆTpM
if and only if Ë†Î¸R(Î¾)p âˆˆTpM, Theorems 30 and 31 hold without modification for left G-actions.
10.2 The Lie derivative as a projection
We provide a geometric interpretation of the Lie derivative in Eq. 83 by expressing it in terms of a
projection of the infinitesimal generator of the group action onto the tangent space of im(F). This
allows us to connect the Lie derivative to the tangency conditions for symmetry of submanifolds
presented in Section 10.1.
The Lie derivative LÎ¾F(p) lies in Ep, while TF(p) im(F) is a subspace of TF(p)E. To relate
quantities in these different spaces, the following lemma introduces a lifting of each Ep to a subspace
of TF(p)E.
35

Lemma 33 For every section F âˆˆÎ£(E) there is a well-defined injective vector bundle homomorphism
Ä±F : E â†’TE that is expressed in any local trivialization Î¦ : Ï€âˆ’1(U) â†’U Ã— Rk as
d Î¦ â—¦Ä±F â—¦Î¦âˆ’1 : U Ã— Rk â†’T(U Ã— Rk)
(p, v) 7â†’(0, v)Î¦(F(p)).
(126)
We give a proof in Appendix H.
This is a special case of the â€œvertical liftâ€ of E into the vertical bundle V E = {v âˆˆTE : d Ï€v = 0}
described by KolÃ¡Å™ et al. (1993) in Section 6.11. The â€œvertical projectionâ€ vprE : V E â†’E provides
a left-inverse satisfying vprE â—¦Ä±F = IdE.
The following result relates the Lie derivative to a projection via the vertical lifting.
Theorem 34 Given F âˆˆÎ£(E) and p âˆˆM, the map PF(p) := d(F â—¦Ï€)(F(p)) : TF(p)E â†’TF(p)E is
a linear projection onto TF(p) im(F) and for every Î¾ âˆˆLie(G) we have
Ä±F â—¦(LÎ¾F)(p) = âˆ’

I âˆ’PF(p)
Ë†Î˜(Î¾)F(p).
(127)
We give a proof in Appendix H.
For the special case of smooth maps F : Rm â†’Rn viewed a sections x 7â†’(x, F(x)) of the bundle
Ï€ : Rm Ã— Rn â†’Rm, this theorem reproduces Eq. 46. The following corollary provides a link between
our main results for sections of vector bundles and our main results for symmetries of submanifolds.
Corollary 35 For every F âˆˆÎ£(E), Î¾ âˆˆLie(G), and p âˆˆM we have
(LÎ¾F)(p) = 0
â‡”
Ë†Î˜(Î¾)F(p) âˆˆTF(p) im(F).
(128)
In particular, this means that Theorems 21 and 22 are special cases of Theorems 30 and 31.
11 Conclusion
This paper provides a unified theoretical approach to enforce, discover, and promote symmetries in
machine learning models. In particular, we provide theoretical foundations for Lie group symmetry
in machine learning from a linear-algebraic viewpoint. This perspective unifies and generalizes
several leading approaches in the literature, including approaches for incorporating and uncovering
symmetries in neural networks and more general machine learning models. The central objects
in this work are linear operators describing the finite and infinitesimal transformations of smooth
sections of vector bundles with fiber-linear Lie group actions. To make the paper accessible to a wide
range of practitioners, Sections 3â€“8 deal with the special case where the machine learning models are
built using smooth functions between vector spaces acted upon by matrix Lie group representations.
Our main results establish that the infinitesimal operators â€” the Lie derivatives â€” fully encode the
connected subgroup of symmetries for sections of vector bundles (resp. functions between vector
spaces). In other words, the Lie derivatives encode symmetries that the machine learning models are
equivariant with respect to. We illustrate that promoting and enforcing continuous symmetries in
large classes of machine learning models are dual problems with respect to the bilinear structure
of the Lie derivative. Moreover, we describe how symmetries can be promoted as inductive biases
during training of these models using convex penalties based on the fundamental operators. Finally,
we show how the linear algebraic framework for discovering continuous symmetries extends to identify
continuous symmetries of arbitrary submanifolds. When the submanifold is the image of a section of
36

a vector bundle (resp., the graph of a function between vector spaces) the fundamental operator for
the submanfold recovers the Lie derivative. We describe rigorous data-driven methods for discretizing
and approximating the fundamental operators to accomplish the tasks of enforcing, promoting,
and discovering symmetry. Importantly, these theoretical concepts, while extremely general, admit
efficient computational implementations via simple linear algebra.
The main limitations of our approach come from the need to make appropriate choices for key
objects including the candidate group G, the space of functions F defining the machine learning
model, and appropriate inner products for discretizing the fundamental operators. For example, it is
possible that the only G-symmetric functions in F are trivial, meaning that enforcing symmetry
results in learning only trivial models. One open question is whether our framework can be used in
such cases to learn relaxed symmetries, as described by Wang et al. (2022). In other words, we may
hope to find elements in F that are nearly symmetric, and to bound the degree of asymmetry based
on the quantities derived from the fundamental operators, such as their norms. Our proposed convex
penalization methods are likely affected by the choice of G and the discretization of the fundamental
operators. A natural question is whether a large candidate group of symmetries can be used without
biasing the model towards undesirable or nonphysical symmetries. Additionally, the choice of inner
products associated with the discretization of the fundamental operators could affect the results of
nuclear norm penalization. Our reliance on the Lie algebra to study continuous symmetries also
limits the ability of our proposed methods to account for partial symmetries, such as the invariance
in classifying the characters â€œZâ€ and â€œNâ€ to rotations by small angles, but not large angles.
In a follow-up paper we will apply the proposed methods to a wide range of examples, explaining
in detail how to implement the methods in practice. A main goal will be to study to what extent
the nuclear norm relaxation can recover underlying symmetry groups and reduce the amount of data
required to train accurate machine learning models. Additionally, we will examine how the proposed
techniques perform in the presence of noisy data, with the goal of understanding the empirical
effects of problem dimension, noise level, and the candidate symmetry group. The follow-up will also
explore different choices of inner products in the discretization of the fundamental operators and the
effect this has on the performance of the proposed symmetry-promoting regularization methods.
Other important avenues of future work include investigating computationally efficient approaches
to discretize the fundamental operators and use them to enforce, discover, and promote symmetry
within our framework. This could involve leveraging sparse structure of the discretized operators
in certain bases to enable the use of efficient Krylov subspace algorithms. It will also be useful to
identify efficient optimization algorithms for training symmetry-constrained or symmetry-regularized
machine learning models. Promising candidates include projected gradient descent, proximal splitting
algorithms, and the Iteratively Reweighted Least Squares (IRLS) algorithms described by Mohan
and Fazel (2012). Using IRLS could enable symmetry-promoting penalties to be based on non-convex
Schatten p-norms with 0 < p < 1, potentially improving the recovery of underlying symmetry groups
compared to the nuclear norm where p = 1.
There are also several avenues we plan to explore in future theoretical work. These include
extending the techniques presented here via jet bundle prolongation to study symmetries in machine
learning for Partial Differential Equations (PDEs). Combining analogues of our proposed methods
in this setting with techniques using the weak formulation proposed by Messenger and Bortz (2021);
Reinbold et al. (2020) could provide robust ways to identify symmetric PDEs in the presence
of high noise and limited training data. We also aim to study the perturbative effects of noisy
data in algorithms to discover and promote symmetry with the goal of understanding the effects
of problem dimension, noise level, and number of data points on recovery of symmetry groups.
Another important direction of theoretical study will be to build on the work of Peitz et al. (2023);
Steyert (2022) by studying symmetry in the setting of Koopman operators for dynamical systems.
37

The connection between the fundamental operators in this paper and Koopman operators may be
strengthened by establishing that the fundamental operators {Kg}gâˆˆG form a strongly continuous
group in an L2 space of sections of the appropriate vector bundle, and that the corresponding
infinitesimal generators are given by closures of the Lie derivatives. One could then show that the
Koopman operators of symmetric systems commute with these generators, and use this information
to constrain the spectral projections of the Koopman operators. This might be used to discover
underlying symmetries based on Koopman operators, as well as to enhance algorithms to approximate
Koopman operators by enforcing and promoting symmetry. To do this, one might follow the program
set forth by Colbrook (2023), where the measure preserving property of certain dynamical systems is
exploited to enhance the Extended Dynamic Mode Decomposition (EDMD) algorithm of Williams
et al. (2015).
Acknowledgements
The authors acknowledge support from the National Science Foundation AI Institute in Dynamic
Systems (grant number 2112085). SLB acknowledges support from the Army Research Office (ARO
W911NF-19-1-0045). The authors would also like to acknowledge valuable discussions with Tess
Smidt and Matthew Colbrook.
References
R. Abraham, J. E. Marsden, and T. Ratiu. Manifolds, Tensor Analysis, and Applications, volume 75
of Applied Mathematical Sciences. Springer-Verlag, 1988.
Ralph Abraham and Jerrold E Marsden. Foundations of mechanics. AMS Chelsea Publishing, 2
edition, 2008.
Amir Ali Ahmadi and Bachir El Khadir.
Learning dynamical systems with side information.
In Proceedings of the 2nd Conference on Learning for Dynamics and Control, volume 120 of
Proceedings of Machine Learning Research, pages 718â€“727. PMLR, 10â€“11 Jun 2020. URL https:
//proceedings.mlr.press/v120/ahmadi20a.html.
Peter J Baddoo, Benjamin Herrmann, Beverley J McKeon, J Nathan Kutz, and Steven L Brunton.
Physics-informed dynamic mode decomposition. Proceedings of the Royal Society A, 479(2271):
20220576, 2023.
Simon Batzner, Albert Musaelian, Lixin Sun, Mario Geiger, Jonathan P Mailoa, Mordechai Kornbluth,
Nicola Molinari, Tess E Smidt, and Boris Kozinsky. E(3)-equivariant graph neural networks for
data-efficient and accurate interatomic potentials. Nature communications, 13(1):2453, 2022.
Gregory Benton, Marc Finzi, Pavel Izmailov, and Andrew G Wilson. Learning invariances in neural
networks from training data. Advances in neural information processing systems, 33:17605â€“17616,
2020.
Tyrus Berry and Dimitrios Giannakis. Spectral exterior calculus. Communications on Pure and
Applied Mathematics, 73(4):689â€“770, 2020.
Thierry Bouwmans, Sajid Javed, Hongyang Zhang, Zhouchen Lin, and Ricardo Otazo. On the
applications of robust PCA in image and video processing. Proceedings of the IEEE, 106(8):
1427â€“1457, 2018.
38

S. L. Brunton and J. N. Kutz. Data-Driven Science and Engineering: Machine Learning, Dynamical
Systems, and Control. Cambridge University Press, 2nd edition, 2022.
Steven L Brunton, Joshua L Proctor, and J Nathan Kutz. Discovering governing equations from
data by sparse identification of nonlinear dynamical systems. Proceedings of the national academy
of sciences, 113(15):3932â€“3937, 2016.
Steven L. Brunton, Bernd R. Noack, and Petros Koumoutsakos. Machine learning for fluid mechanics.
Annual Review of Fluid Mechanics, 52:477â€“508, 2020.
Steven L Brunton, Marko BudiÅ¡iÄ‡, Eurika Kaiser, and J Nathan Kutz. Modern Koopman theory for
dynamical systems. SIAM Review, 64(2):229â€“340, 2022.
Jameson Cahill, Dustin G Mixon, and Hans Parshall. Lie PCA: Density estimation for symmetric
manifolds. Applied and Computational Harmonic Analysis, 2023.
Jared L Callaham, Georgios Rigas, Jean-Christophe Loiseau, and Steven L Brunton. An empirical
mean-field model of symmetry-breaking in a turbulent wake. Science Advances, 8(eabm4786),
2022.
Emmanuel J CandÃ¨s, Xiaodong Li, Yi Ma, and John Wright. Robust principal component analysis?
Journal of the ACM (JACM), 58(3):1â€“37, 2011.
Richard Caron and Tim Traynor.
The zero set of a polynomial.
WSMR Report 05-02,
2005.
URL
https://www.researchgate.net/profile/Richard-Caron-3/publication/
281285245_The_Zero_Set_of_a_Polynomial/links/55df56b608aecb1a7cc1a043/
The-Zero-Set-of-a-Polynomial.pdf.
Kathleen Champion, Peng Zheng, Aleksandr Y Aravkin, Steven L Brunton, and J Nathan Kutz. A
unified sparse optimization framework to learn parsimonious physics-informed models from data.
IEEE Access, 8:169259â€“169271, 2020.
Shuxiao Chen, Edgar Dobriban, and Jane H. Lee. A group-theoretic framework for data augmentation.
J. Mach. Learn. Res., 21(1), jan 2020. ISSN 1532-4435.
Taco Cohen and Max Welling. Group equivariant convolutional networks. In Maria Florina Balcan
and Kilian Q. Weinberger, editors, Proceedings of The 33rd International Conference on Machine
Learning, volume 48 of Proceedings of Machine Learning Research, pages 2990â€“2999, New York,
New York, USA, 20â€“22 Jun 2016. PMLR. URL https://proceedings.mlr.press/v48/cohenc16.
html.
Taco S Cohen, Mario Geiger, Jonas KÃ¶hler, and Max Welling. Spherical CNNs. arXiv preprint
arXiv:1801.10130, 2018.
Taco S Cohen, Mario Geiger, and Maurice Weiler.
A general theory of equivariant CNNs on
homogeneous spaces. Advances in neural information processing systems, 32, 2019.
Matthew J Colbrook. The mpEDMD algorithm for data-driven computations of measure-preserving
dynamical systems. SIAM Journal on Numerical Analysis, 61(3):1585â€“1608, 2023.
Ekin D Cubuk, Barret Zoph, Dandelion Mane, Vijay Vasudevan, and Quoc V Le. Autoaugment:
Learning augmentation strategies from data. In Proceedings of the IEEE/CVF conference on
computer vision and pattern recognition, pages 113â€“123, 2019.
Krish Desai, Benjamin Nachman, and Jesse Thaler. Symmetry discovery with deep learning. Physical
Review D, 105(9):096031, 2022.
39

Carlos Esteves, Christine Allen-Blanchette, Ameesh Makadia, and Kostas Daniilidis. Learning SO(3)
equivariant representations with spherical CNNs. In Proceedings of the European Conference on
Computer Vision (ECCV), pages 52â€“68, 2018.
Marc Finzi, Samuel Stanton, Pavel Izmailov, and Andrew Gordon Wilson. Generalizing convolutional
neural networks for equivariance to Lie groups on arbitrary continuous data. In International
Conference on Machine Learning, pages 3165â€“3176. PMLR, 2020.
Marc Finzi, Max Welling, and Andrew Gordon Wilson.
A practical method for constructing
equivariant multilayer perceptrons for arbitrary matrix groups. In International Conference on
Machine Learning, pages 3318â€“3328. PMLR, 2021.
Kunihiko Fukushima. Neocognitron: A self-organizing neural network model for a mechanism of
pattern recognition unaffected by shift in position. Biological cybernetics, 36(4):193â€“202, 1980.
Morikuni GotÃ´. Faithful representations of Lie groups II. Nagoya mathematical journal, 1:91â€“107,
1950.
David Gross. Recovering low-rank matrices from few coefficients in any basis. IEEE Transactions
on Information Theory, 57(3):1548â€“1566, 2011.
David J Gross. The role of symmetry in fundamental physics. Proceedings of the National Academy
of Sciences, 93(25):14256â€“14259, 1996.
Nate Gruver, Marc Anton Finzi, Micah Goldblum, and Andrew Gordon Wilson. The Lie derivative
for measuring learned equivariance.
In The Eleventh International Conference on Learning
Representations, 2022.
Yifei Guan, Steven L Brunton, and Igor Novosselov. Sparse nonlinear models of chaotic electrocon-
vection. Royal Society Open Science, 8(8):202367, 2021.
Brian C. Hall. Lie Groups, Lie Algebras, and Representations: An Elementary Introduction. Springer,
2015.
Ryuichiro Hataya, Jan Zdenek, Kazuki Yoshizoe, and Hideki Nakayama. Faster autoaugment:
Learning augmentation strategies using backpropagation. In Computer Visionâ€“ECCV 2020: 16th
European Conference, Glasgow, UK, August 23â€“28, 2020, Proceedings, Part XXV 16, pages 1â€“16.
Springer, 2020.
P. J. Holmes, J. L. Lumley, G. Berkooz, and C. W. Rowley.
Turbulence, coherent structures,
dynamical systems and symmetry. Cambridge Monographs in Mechanics. Cambridge University
Press, Cambridge, England, 2nd edition, 2012.
Roger A. Horn and Charles R. Johnson. Matrix Analysis. Cambridge University Press, 2 edition,
2013.
Eurika Kaiser, J Nathan Kutz, and Steven L Brunton. Discovering conservation laws from data for
control. In 2018 IEEE Conference on Decision and Control (CDC), pages 6415â€“6421. IEEE, 2018.
Eurika Kaiser, J Nathan Kutz, and Steven L Brunton. Data-driven discovery of koopman eigenfunc-
tions for control. Machine Learning: Science and Technology, 2(3):035023, 2021.
Ivan KolÃ¡Å™, Peter W. Michor, and Jan SlovÃ¡k. Natural Operations in Differential Geometry. Springer-
Verlag, 1993.
40

Risi Kondor and Shubhendu Trivedi. On the generalization of equivariance and convolution in neural
networks to the action of compact groups. In International Conference on Machine Learning,
pages 2747â€“2755. PMLR, 2018.
B. O. Koopman. Hamiltonian systems and transformations in Hilbert space. Proceedings of the
National Academy of Sciences, 17:315â€“318, 1931.
Leonid B. Koralov and Yakov G. Sinai. Theory of Probability and Random Processes. Springer, 2
edition, 2012.
Yann LeCun, Bernhard Boser, John S Denker, Donnie Henderson, Richard E Howard, Wayne
Hubbard, and Lawrence D Jackel. Backpropagation applied to handwritten zip code recognition.
Neural computation, 1(4):541â€“551, 1989.
John M. Lee. Introduction to Smooth Manifolds: Second Edition. Springer, 2013.
Mario Lezcano-Casado and David MartÄ±nez-Rubio. Cheap orthogonal constraints in neural networks:
A simple parametrization of the orthogonal and unitary group. In International Conference on
Machine Learning, pages 3794â€“3803. PMLR, 2019.
Ziming Liu and Max Tegmark. Machine learning hidden symmetries. Phys. Rev. Lett., 128:180201,
May 2022. doi: 10.1103/PhysRevLett.128.180201. URL https://link.aps.org/doi/10.1103/
PhysRevLett.128.180201.
J.-C. Loiseau and S. L. Brunton. Constrained sparse Galerkin regression. Journal of Fluid Mechanics,
838:42â€“67, 2018.
Haggai Maron, Heli Ben-Hamu, Nadav Shamir, and Yaron Lipman. Invariant and equivariant graph
networks. arXiv preprint arXiv:1812.09902, 2018.
J. E. Marsden and T. S. Ratiu. Introduction to mechanics and symmetry. Springer-Verlag, 2nd
edition, 1999.
Alexandre Mauroy, Y Susuki, and I MeziÄ‡. Koopman operator in systems and control. Springer,
2020.
Daniel A Messenger and David M Bortz. Weak SINDy: Galerkin-based data-driven model selection.
Multiscale Modeling & Simulation, 19(3):1474â€“1497, 2021.
Carl D Meyer. Matrix analysis and applied linear algebra, volume 71. Siam, 2000.
Igor MeziÄ‡. Spectral properties of dynamical systems, model reduction and decompositions. Nonlinear
Dynamics, 41:309â€“325, 2005.
Xu Miao and Rajesh PN Rao. Learning the Lie groups of visual invariance. Neural computation, 19
(10):2665â€“2693, 2007.
Karthik Mohan and Maryam Fazel. Iterative reweighted algorithms for matrix rank minimization.
Journal of Machine Learning Research, 13(1):3441â€“3473, 2012.
Artem Moskalev, Anna Sepliarskaia, Ivan Sosnovik, and Arnold Smeulders. LieGG: Studying learned
Lie group generators. Advances in Neural Information Processing Systems, 35:25212â€“25223, 2022.
E Noether.
Invariante variationsprobleme nachr. d. kÃ¶nig. gesellsch. d. wiss. zu gÃ¶ttin-
gen, math-phys. klasse 1918:
235-257.
English Reprint:
physics/0503066, http://dx. doi.
org/10.1080/00411457108231446, page 57, 1918.
41

Samuel E Otto and Clarence W Rowley. Koopman operators for estimation and control of dynamical
systems. Annual Review of Control, Robotics, and Autonomous Systems, 4:59â€“87, 2021.
Sebastian Peitz, Hans Harder, Feliks NÃ¼ske, Friedrich Philipp, Manuel Schaller, and Karl Worthmann.
Partial observations, coarse graining and equivariance in Koopman operator theory for large-scale
dynamical systems. arXiv preprint arXiv:2307.15325, 2023.
Maziar Raissi, Paris Perdikaris, and George Em Karniadakis. Physics-informed neural networks:
A deep learning framework for solving forward and inverse problems involving nonlinear partial
differential equations. Journal of Computational physics, 378:686â€“707, 2019.
Rajesh Rao and Daniel Ruderman. Learning Lie groups for invariant visual perception. Advances in
neural information processing systems, 11, 1999.
Benjamin Recht, Maryam Fazel, and Pablo A. Parrilo. Guaranteed minimum-rank solutions of linear
matrix equations via nuclear norm minimization. SIAM Review, 52(3):471â€“501, 2010.
Patrick AK Reinbold, Daniel R Gurevich, and Roman O Grigoriev. Using noisy or incomplete data
to discover models of spatiotemporal dynamics. Physical Review E, 101(010203), 2020.
Clarence W. Rowley, Ioannis G. Kevrekidis, Jerrold E. Marsden, and Kurt Lust. Reduction and
reconstruction for self-similar dynamical systems. Nonlinearity, 16(4):1257, 2003.
Connor Shorten and Taghi M Khoshgoftaar. A survey on image data augmentation for deep learning.
Journal of big data, 6(1):1â€“48, 2019.
Vivian T Steyert. Uncovering Structure with Data-driven Reduced-Order Modeling. PhD thesis,
Princeton University, 2022.
Terence Tao. Two small facts about Lie groups. https://terrytao.wordpress.com/2011/06/25/
two-small-facts-about-lie-groups/, 6 2011.
David A Van Dyk and Xiao-Li Meng. The art of data augmentation. Journal of Computational and
Graphical Statistics, 10(1):1â€“50, 2001.
Rui Wang, Robin Walters, and Rose Yu. Approximately equivariant networks for imperfectly
symmetric dynamics. In International Conference on Machine Learning, pages 23078â€“23091.
PMLR, 2022.
Maurice Weiler and Gabriele Cesa. General E(2)-equivariant steerable CNNs. Advances in neural
information processing systems, 32, 2019.
Maurice Weiler, Mario Geiger, Max Welling, Wouter Boomsma, and Taco S Cohen. 3D steer-
able CNNs: Learning rotationally equivariant features in volumetric data. Advances in Neural
Information Processing Systems, 31, 2018.
Matthew O Williams, Ioannis G Kevrekidis, and Clarence W Rowley. A data-driven approximation
of the Koopman operator: extending dynamic mode decomposition. Journal of Nonlinear Science,
6:1307â€“1346, 2015.
Jianke Yang, Robin Walters, Nima Dehmamy, and Rose Yu. Generative adversarial symmetry
discovery. arXiv preprint arXiv:2302.00236, 2023.
Ming Yuan and Yi Lin. Model selection and estimation in regression with grouped variables. Journal
of the Royal Statistical Society: Series B (Statistical Methodology), 68(1):49â€“67, 2006.
42

Appendix A. Proofs of minor results
Proof [Proposition 6] Obviously, if KgK = K then K(W)
g
â—¦TK â—¦K(V)
gâˆ’1 = TK. On the other hand,
suppose that KgK(x0, y0) Ì¸= K(x0, y0) for some (x0, y0) âˆˆRn Ã— Rm. Hence, there are vectors v âˆˆV
and w âˆˆWâˆ—such that âŸ¨w, KgK(x0, y0)v âˆ’K(x0, y0)vâŸ©> 0. This remains true for all y in a
neighborhood U of y0 by continuity of K and KgK. Letting F(x) = vÏ†(x) where Ï† is a smooth,
nonnegative, function with Ï†(y0) > 0 and support in U, we obtain

w, K(W)
g
â—¦TK â—¦K(V)
gâˆ’1F(x) âˆ’TKF(x)

=
Z
Rm

w, KgK(x, y)v âˆ’K(x, y)v

Ï†(y) d y > 0,
(129)
meaning K(W)
g
â—¦TK â—¦K(V)
gâˆ’1 Ì¸= TK. Therefore, KgK = K if and only if K(W)
g
â—¦TK â—¦K(V)
gâˆ’1 = TK.
Proof [Proposition 15] As an intersection of closed subgroups, H := TL
l=1 SymG
 F (l)
is a closed
subgroup of G. By the closed subgroup theorem (see Theorem 20.12 in Lee (2013)), H is an embedded
Lie subgroup, whose Lie subalgebra we denote by h. If Î¾ âˆˆh then exp(tÎ¾) âˆˆSymG
 F (l)
for all
t âˆˆR and every l = 1, . . . , L. Differentiating Kexp(tÎ¾)F (l) = F (l) at t = 0 proves that LÎ¾F (l) = 0, i.e.,
Î¾ âˆˆsymG(F (l)) by Theorem 4. Conversely, if LÎ¾F (l) = 0 for every l = 1, . . . , L, then by Theorem 4,
exp(tÎ¾) âˆˆH. Since H is a Lie subgroup, differentiating exp(tÎ¾) at t = 0 proves that Î¾ âˆˆh.
Proof [Proposition 16] Let f1, . . . , fN be a basis for Fâ€². Consider the sequence of Gram matrices
GGGM with entries
[GGGM]i,j = âŸ¨fi, fjâŸ©L2(ÂµM) .
(130)
It suffices to show that GGGM is positive-definite for sufficiently large M. Since the L2(Âµ) inner product
is positive-definite on Fâ€², it follows that the Gram matrix GGG with entries
[GGG]i,j = âŸ¨fi, fjâŸ©L2(Âµ)
(131)
is positive-definite. Hence, its smallest eigenvalue Î»min(GGG) is positive. Since the ordered eigen-
values of symmetric matrices are continuous with respect to their entries (see Corollary 4.3.15
in Horn and Johnson (2013)) and [GGGM]i,j â†’[GGG]i,j for all 1 â‰¤i, j â‰¤N by assumption, we have
Î»min(GGGM) â†’Î»min(GGG) as M â†’âˆ. Therefore, there is an M0 so that for every M â‰¥M0 we have
Î»min(GGGM) > 0, i.e., GGGM is positive-definite.
Proof [Proposition 29] Consider a leaf M of an m-dimensional foliation on the n-dimensional
manifold N and let Î³ : [a, b] â†’N be a smooth curve satisfying Î³((a, b)) âŠ‚M. First, it is clear
that M is a weakly embedded submanifold of N since M is an integral manifold of an involutive
distribution (Lee (2013, Proposition 19.19)) and the local structure theorem for integral manifolds
(Lee (2013, Proposition 19.16)) shows that they are weakly embedded.
By continuity of Î³, any neighborhood of Î³(b) in N must have nonempty intersection with M. By
definition of a foliation (see Lee (2013)), there is a coordinate chart (U, x) for N with Î³(b) âˆˆU such
that x(U) is a coordinate-aligned cube in Rn and M âˆ©U consists of countably many slices of the
form xm+1 = cm+1, . . . , xn = cn for constants cm+1, . . . , cn. Since Î³ is continuous, there is a Î´ > 0
so that Î³((b âˆ’Î´, b]) âŠ‚U, and in particular, Î³((b âˆ’Î´, b)) âŠ‚M âˆ©U. By continuity of Î³, there are
constants cm+1, . . . , cn such that xi(Î³(t)) = ci for every i = m + 1, . . . , n and t âˆˆ(b âˆ’Î´, b). Hence,
43

we have
xi(Î³(b)) = lim
tâ†’b xi(Î³(t)) = ci,
i = m + 1, . . . , n,
(132)
meaning that Î³(b) âˆˆM. An analogous argument shows that Î³(a) âˆˆM, completing the proof that
M is arcwise-closed.
Appendix B. Proof of Proposition 17
Our proof relies on the following lemma:
Lemma 36 Let P denote a finite-dimensional vector space of polynomials Rm â†’R. If M â‰¥dim(P)
then the evaluation map T : P â†’RM defined by
T(x1,...,xM) : P 7â†’(P(x1), . . . , P(xM))
(133)
is injective for almost every (x1, . . . , xM) âˆˆ(Rm)M with respect to Lebesgue measure.
Proof Letting M0 = dim(P) and choosing a basis P1, . . . , PM0 for P, injectivity of T(x1,...,xM) is
equivalent to injectivity of the M Ã— M0 matrix
TTT (x1,...,xM) =
ï£®
ï£¯ï£°
P1(x1)
Â· Â· Â·
PM0(x1)
...
...
...
P1(xM)
Â· Â· Â·
PM0(xM)
ï£¹
ï£ºï£».
(134)
Finally, this is equivalent to
Ï•(x1, . . . , xM) = det
 (TTT (x1,...,xM))TTTT (x1,...,xM)

(135)
taking a nonzero value. We observe that Ï• is a polynomial on the Euclidean space (Rm)M.
Suppose there exists a set of points (Â¯x1, . . . , Â¯xM) âˆˆ(Rm)M such that T(Â¯x1,...,Â¯xM) is injective. Then
for this set Ï•(Â¯x1, . . . , Â¯xM) Ì¸= 0. Obviously, Ï•(0, . . . , 0) = 0, meaning that Ï• cannot be constant.
Thanks to the main result in Caron and Traynor (2005), this means that each level set of Ï• has zero
Lebesgue measure in (Rm)M. In particular, the level set Ï•âˆ’1(0), consisting of those x1, . . . , xM for
which T(x1,...,xM) fails to be injective, has zero Lebesgue measure. Therefore, it suffices to prove that
there exists (Â¯x1, . . . , Â¯xM) âˆˆ(Rm)M such that T(Â¯x1,...,Â¯xM) is injective. We do this by induction.
It is clear that there exists Â¯x1 so that the 1 Ã— 1 matrix
TTT 1 =

P1(Â¯x1)

(136)
has full rank since P1 cannot be the zero polynomial. Proceeding by induction, we assume that there
exists Â¯x1, . . . , Â¯xs so that
TTT s =
ï£®
ï£¯ï£°
P1(Â¯x1)
Â· Â· Â·
Ps(Â¯x1)
...
...
...
P1(Â¯xs)
Â· Â· Â·
Ps(Â¯xs)
ï£¹
ï£ºï£»
(137)
44

has full rank. Suppose that the matrix
ËœTËœTËœT s+1(x) =
ï£®
ï£¯ï£¯ï£¯ï£°
P1(Â¯x1)
Â· Â· Â·
Ps(Â¯x1)
Ps+1(Â¯x1)
...
...
...
...
P1(Â¯xs)
Â· Â· Â·
Ps(Â¯xs)
Ps+1(Â¯xs)
P1(x)
Â· Â· Â·
Ps(x)
Ps+1(x)
ï£¹
ï£ºï£ºï£ºï£»
(138)
has rank < s + 1 for every x âˆˆRm. Since the upper left s Ã— s block of ËœTËœTËœT s+1(x) is TTT s, we must
always have rank( ËœTËœTËœT s+1(x)) = s. The nullspace of ËœTËœTËœT s+1(x) is contained in the nullspace of the upper
s Ã— (s + 1) block of ËœTËœTËœT s+1(x). Since both nullspaces are one-dimensional, they are equal. The upper
s Ã— (s + 1) block of ËœTËœTËœT s+1(x) does not depend on x, so there is a fixed nonzero vector v âˆˆRs+1 so
that ËœTËœTËœT s+1(x)v = 0 for every x âˆˆRm. The last row of this expression reads
v1P1(x) + Â· Â· Â· + vs+1Ps+1(x) = 0
âˆ€x âˆˆRm,
(139)
contradicting the linear independence of P1, . . . , Ps+1. Therefore there exists Â¯xs+1 so that TTT s+1 =
ËœTËœTËœT s+1(Â¯xs+1) has full rank. It follows by induction on s that there exists Â¯x1, . . . Â¯xM0 âˆˆRm so that
TTT (Â¯x1,...Â¯xM0) = TTT M0 has full rank. Choosing any M âˆ’M0 additional vectors yields an injective
TTT (Â¯x1,...Â¯xM), which completes the proof.
Proof [Proposition 17] The sum in Eq. 75 clearly defines a symmetric, positive-semidefinite bilinear
form on Fâ€². It remains to show that this bilinear form is positive-definite. Suppose that there
is a function f âˆˆFâ€² such that âŸ¨f, fâŸ©L2(ÂµM) = 0. Thanks to Lemma 36, our assumption that
M â‰¥dim(Ï€i(Fâ€²)) means that the evaluation operator T(x1,...,xM) is injective on Ï€i(Fâ€²) for almost
every (x1, . . . , xM) âˆˆ(Rm)M with respect to Lebesgue measure. Since a countable (in this case
finite) intersection of sets of measure zero has measure zero, it follows that for almost every
(x1, . . . , xM) âˆˆ(Rm)M with respect to Lebesgue measure, T(x1,...,xM) is injective on every Ï€i(Fâ€²),
i = 1, . . . , n. Defining the positive diagonal matrix
D
D
D =
1
âˆš
N
ï£®
ï£¯ï£°
âˆšw1
...
âˆšwM
ï£¹
ï£ºï£»,
(140)
and using Eq. 75 yields
0 = âŸ¨f, fâŸ©L2(ÂµM) =
n
X
j=1
 D
D
DT(x1,...,xM)Ï€jf
TD
D
DT(x1,...,xM)Ï€jf.
(141)
This implies that T(x1,...,xM)Ï€jf = 0 for j = 1, . . . , n. Since T(x1,...,xM) is injective on each Ï€j(Fâ€²) it
follows that each Ï€jf = 0, meaning that f = 0. This completes the proof.
Appendix C. Proof of Proposition 20
We begin by proving
d
d t Kexp(tÎ¾)F = LÎ¾Kexp(tÎ¾)F = Kexp(tÎ¾)LÎ¾F.
(142)
45

The first equality follows from the composition law for the operators Kg and the definition of the Lie
derivative in Eq. 83, yielding
d
d t

t=t0
Kexp(tÎ¾)F = lim
tâ†’0
1
t

Kexp(tÎ¾)Kexp(t0Î¾)F âˆ’Kexp(t0Î¾)F

= LÎ¾Kexp(t0Î¾)F.
(143)
To prove the second equality, we choose p âˆˆM, let pâ€² = Î¸exp(t0Î¾)(p), and compute
d
d t

t=t0
 Kexp(tÎ¾)F

(p) = lim
tâ†’0
1
t
 Kexp(t0Î¾)Kexp(tÎ¾)F

(p) âˆ’
 Kexp(t0Î¾)F

(p)

= lim
tâ†’0
1
t Î˜exp(âˆ’t0Î¾) â—¦
 Kexp(tÎ¾)F âˆ’F

â—¦Î¸exp(t0Î¾)(p)
= Î˜exp(âˆ’t0Î¾)

lim
tâ†’0
1
t
 Kexp(tÎ¾)F

(pâ€²) âˆ’F(pâ€²)

= Î˜exp(âˆ’t0Î¾)
 LÎ¾F(pâ€²)

=
 Kexp(t0Î¾)LÎ¾F

(p).
(144)
In the third equality, we used the fact that Î˜exp(âˆ’t0Î¾) is a continuous vector bundle homomorphism.
Next, we prove
LÎ±Î¾+Î²Î· = Î±LÎ¾ + Î²LÎ·.
(145)
To do this, we choose F âˆˆÎ£(E), p âˆˆM, and define the map h : G â†’Ep by
h : g 7â†’KgF(p) = Î˜
 F(Î¸(p, g)), gâˆ’1
.
(146)
As a composition of smooth maps, h is smooth, and its derivative at the identity is
d h(e)Î¾e = d
d t

t=0
h(exp(tÎ¾)) = LÎ¾F(p)
(147)
for every Î¾e âˆˆTeG âˆ¼= Lie(G). Since the derivative is linear, it follows that Î¾ 7â†’LÎ¾F(p) is linear.
Finally, we prove that
L[Î¾,Î·] = 1
2
d2
d t2

t=0
Kexp(tÎ¾)Kexp(tÎ·)Kexp(âˆ’tÎ¾)Kexp(âˆ’tÎ·) = LÎ¾LÎ· âˆ’LÎ·LÎ¾.
(148)
Recall that Flt
Î¾ : g 7â†’g Â· exp(tÎ¾) gives the flow of the left-invariant vector field Î¾ âˆˆLie(G) (see
Theorem 4.18(3) in KolÃ¡Å™ et al. (1993)). By Theorem 3.16 in KolÃ¡Å™ et al. (1993) the curve Î³ : R â†’G
given by
Î³(t) = Flt
âˆ’Î· â—¦Flt
âˆ’Î¾ â—¦Flt
Î· â—¦Flt
Î¾(e) = exp(tÎ¾) exp(tÎ·) exp(âˆ’tÎ¾) exp(âˆ’tÎ·).
(149)
satisfies Î³(0) = e, Î³â€²(0) = 0, and
1
2Î³â€²â€²(0) = [Î¾, Î·]e âˆˆTeG
(150)
in the sense that Î³â€²â€²(0) : f 7â†’(f â—¦Î³)â€²â€²(0) is a derivation on Câˆ(G). Composing with the map in
Eq. 146 yields
0 = d h(e)Î³â€²(0) = (h â—¦Î³)â€²(0) = d
d t

t=0
KÎ³(t)F(p).
(151)
46

Combining Eq. 150 and Eq. 147 (noting the definition of the tangent map d h(e) acting on derivations,
as in KolÃ¡Å™ et al. (1993), Lee (2013)) gives
L[Î¾,Î·]F(p) = 1
2 d h(e)Î³â€²â€²(0) = 1
2(h â—¦Î³)â€²â€²(0) = 1
2
d2
d t2

t=0
KÎ³(t)F(p).
(152)
This proves the first equality in Eq. 148 thanks to the composition law
KÎ³(t) = Kexp(tÎ¾)Kexp(tÎ·)Kexp(âˆ’tÎ¾)Kexp(âˆ’tÎ·).
(153)
To differentiate the above expression, we use the following observations. If Ft âˆˆÎ£(E) is such that
(t, p) 7â†’Ft(p) is smooth for (t, p) âˆˆRÃ—M, then obviously
d
d t Ft âˆˆÎ£(E) with the usual identification
TEp âˆ¼= Ep. Moreover, we have
d
d t KgFt(p) = d
d t Î˜gâˆ’1
 Ft(Î¸g(p))

= Î˜gâˆ’1
 d
d t Ft(Î¸g(p))

= Kg
 d
d t Ft

(p)
(154)
because Ft(Î¸g(p)) âˆˆEÎ¸g(p) for all t âˆˆR and Î˜gâˆ’1 is linear on EÎ¸g(p). Using this, we obtain
d
d t LÎ¾Ft(p) = d
d t
d
d Ï„

Ï„=0
Kexp(Ï„Î¾)Ft(p)
=
d
d Ï„

Ï„=0
d
d t Kexp(Ï„Î¾)Ft(p)
=
d
d Ï„

Ï„=0
Kexp(Ï„Î¾)
 d
d t Ft

(p) = LÎ¾
 d
d t Ft

(p)
(155)
because (t, Ï„) 7â†’Kexp(Ï„Î¾)Ft(p) lies in the vector space Ep, allowing us to exchanged the order of
differentiation. Since (t1, t2, t3, t4) 7â†’Kexp(tÎ¾)Kexp(tÎ·)Kexp(âˆ’tÎ¾)Kexp(âˆ’tÎ·)F(p) lies in the vector space
Ep for all (t1, t2, t3, t4) âˆˆR4, we can apply the chain rule and Eq. 154 to obtain
d
d t KÎ³(t) =
âˆ‚
âˆ‚t1

t1=t
Kexp(t1Î¾)Kexp(tÎ·)Kexp(âˆ’tÎ¾)Kexp(âˆ’tÎ·)
+ Kexp(tÎ¾)
âˆ‚
âˆ‚t2

t2=t
Kexp(t2Î·)Kexp(âˆ’tÎ¾)Kexp(âˆ’tÎ·)
+ Kexp(tÎ¾)Kexp(tÎ·)
âˆ‚
âˆ‚t3

t3=t
Kexp(âˆ’t3Î¾)Kexp(âˆ’tÎ·)
+ Kexp(tÎ¾)Kexp(tÎ·)Kexp(âˆ’tÎ¾)
âˆ‚
âˆ‚t4

t4=t
Kexp(âˆ’t4Î·). (156)
47

Using Eq. 142 gives
d
d t KÎ³(t) = LÎ¾
KÎ³(t)
z
}|
{
Kexp(tÎ¾)Kexp(tÎ·)Kexp(âˆ’tÎ¾)Kexp(âˆ’tÎ·)
+ Kexp(tÎ¾)LÎ·Kexp(tÎ·)Kexp(âˆ’tÎ¾)Kexp(âˆ’tÎ·)
+ Kexp(tÎ¾)Kexp(tÎ·)Lâˆ’Î¾Kexp(âˆ’tÎ¾)Kexp(âˆ’tÎ·)
+ Kexp(tÎ¾)Kexp(tÎ·)Kexp(âˆ’tÎ¾)Kexp(âˆ’tÎ·)
|
{z
}
KÎ³(t)
Lâˆ’Î·. (157)
Applying the same technique to differentiate a second time and using the linearity in Eq. 145 to
cancel terms yields
d2
d t2

t=0
KÎ³(t) = LÎ¾
d
d t

t=0
KÎ³(t)
|
{z
}
0
+ LÎ¾LÎ· + LÎ·Lâˆ’Î¾ + LÎ·Lâˆ’Î¾ + Lâˆ’Î¾Lâˆ’Î·
|
{z
}
2
 LÎ¾LÎ·âˆ’LÎ·LÎ¾

+ d
d t

t=0
KÎ³(t)
|
{z
}
0
Lâˆ’Î·,
(158)
which completes the proof.
â– 
Appendix D. Proof of Theorem 21
If F âˆˆÎ£(E) is G0-equivariant, then Kexp(tÎ¾)F = F for all Î¾ âˆˆLie(G) and t âˆˆR. Differentiating
with respect to t at t = 0 gives LÎ¾F = 0. Conversely, suppose that LÎ¾F = 0 for all Î¾ âˆˆLie(G).
Choosing Î¾ âˆˆLie(G) and p âˆˆM, the smooth curve Î³ : R â†’Ep defined by Î³(t) = Kexp(tÎ¾)F(p)
satisfies Î³(0) = F(p) and
Î³â€²(t) = d
d t Kexp(tÎ¾)F(p) = Kexp(tÎ¾)LÎ¾F(p) = 0 âˆˆEp
(159)
thanks to Eq. 84 of Proposition 20.
Therefore, Î³(t) = F(p) for all t âˆˆR, and in particular
Î³(1) = F(p), meaning that
Kexp(Î¾)F = F,
âˆ€Î¾ âˆˆLie(G).
(160)
We show by induction that KgF = F for every finite product g = hm, . . . , h1 of elements hi = exp(Î¾i).
Supposing this holds for any product g of m elements in the range of the exponential map and
choosing hm+1 = exp(Î¾m+1) we have
Khm+1gF = Khm+1KgF = Khm+1F = F,
(161)
proving the claim. The conclusion of the theorem now follows immediately from Lemma 37, below,
since G is the union of its connected components.
â– 
Lemma 37 Let G0 be the identity component of a Lie group G. Then every element g âˆˆG0 can
be expressed as a finite product g = hm Â· Â· Â· h1 of elements hi = exp(Î¾i) for Î¾i âˆˆLie(G). Let Gi be a
connected component of G and let gi âˆˆGi. Then every element g âˆˆGi can be expressed as g = g0gi
for some g0 âˆˆG0.
Proof By the inverse function theorem (more specifically by Proposition 20.8(f) in Lee (2013)), the
range of the exponential map contains an open, connected neighborhood U of the identity element
e âˆˆG. The inverses of the elements in U also belong to the range of the exponential map thanks
48

to Proposition 20.8(c) in Lee (2013). By Proposition 7.14(b) and Proposition 7.15 in Lee (2013),
it follows that U generates the identity component G0 of G. That is, any element g âˆˆG0 can be
written as a finite product of elements in U and their inverses, which proves the first claim.
By Proposition 7.15 in Lee (2013), G0 is a normal subgroup of G and every connected component
of G is diffeomorphic to G0. In fact in the proof of this result it is shown that every connected
component of G is a coset of G0. Therefore, if Gi is a non-identity connected component of G and
gi âˆˆGi then Gi = G0 Â· gi, which proves the second claim.
Appendix E. Proof of Theorem 22
We begin by showing that SymG(F) is a closed subgroup of G. It is obviously a subgroup, for if
g1, g2 âˆˆSymG(F) then
Kg1g2F = Kg1Kg2F = Kg1F = F,
(162)
meaning that g1g2 âˆˆSymG(F). To show that SymG(F) is closed, we observe that for each p âˆˆM,
the map hp : G â†’E defined by
hp : g 7â†’KgF(p) = Î˜
 F(Î¸(p, g)), gâˆ’1
(163)
is smooth, as it is a composition of smooth maps. As F(p) is a single point in E, the preimage set
hâˆ’1
p
 {F(p)}

is closed in G. Since SymG(F) is an intersection,
SymG(F) =
\
pâˆˆM
hâˆ’1
p
 {F(p)}

,
(164)
of closed sets, it follows that SymG(F) is closed in G. By the closed subgroup theorem (Theorem 20.12
in Lee (2013)) it follows that SymG(F) is an embedded Lie subgroup of G.
Let h = Lie(SymG(F)) be the Lie algebra of SymG(F). By Theorem 21, (or simply by differ-
entiating Kexp(tÎ¾)F = F with respect to t) we have LÎ¾F = 0 for every Î¾ âˆˆh. This means that
h âŠ‚symG(F), as defined by Eq. 88. To show the reverse containment, choose Î¾ âˆˆsymG(F), and
observe that Eq. 84 in Proposition 20 implies that
d
d t Kexp(tÎ¾)F = Kexp(tÎ¾)LÎ¾F = 0
âˆ€t âˆˆR.
(165)
It follows that Kexp(tÎ¾)F = F, that is, exp(tÎ¾) âˆˆSymG(F) for all t âˆˆR. Differentiating at t = 0
proves that Î¾ âˆˆh. Therefore, h = symG(F), completing the proof.
â– 
Appendix F. Proof of Theorem 30
Our proof of the theorem relies on the following technical lemma concerning the integral curves of
vector fields tangent to weakly embedded, arcwise-closed submanifolds.
Lemma 38 Let M be an arcwise-closed weakly embedded submanifold of a manifold N.
Let
V âˆˆX(N) be a vector field tangent to M, that is
Vp âˆˆTpM
âˆ€p âˆˆM.
(166)
If Î³ : I â†’N is a maximal integral curve of V that intersects M, then Î³ lies in M.
49

Proof By the translation lemma (Lemma 9.4 in Lee (2013)), we can assume without loss of generality
that 0 âˆˆI and p0 = Î³(0) âˆˆM. Let Ä±M : M ,â†’N denote the inclusion map. Since M is an immersed
submanifold of N and V is tangent to M, there is a unique smooth vector field V |M âˆˆX(M) that
is Ä±M-related to V thanks to Proposition 8.23 in Lee (2013). Let ËœÎ³ : ËœI â†’M be the maximal integral
curve of V |M with ËœÎ³(0) = p0. By the naturality of integral curves (Proposition 9.6 in Lee (2013))
Ä±M â—¦ËœÎ³ is an integral curve of V with Ä±M â—¦ËœÎ³(0) = p0. Since integral curves of smooth vector fields
starting at the same point are unique (Theorem 9.12, part (a) in Lee (2013)) we have ËœI âŠ‚I and
Ä±M â—¦ËœÎ³(t) = Î³(t)
âˆ€t âˆˆËœI.
(167)
Therefore, it remains to show that ËœI = I.
By the local existence of integral curves (Proposition 9.2 in Lee (2013)), the domains I and ËœI of
the maximal integral curves Î³ and ËœÎ³ are open intervals in R. Suppose, for the sake of producing
a contradiction, that there exists t âˆˆI with t > ËœI. Then it follows that the least upper bound
b = sup ËœI is an element of I. By Eq. 167 and continuity of Î³ we have
q0 = Î³(b) = lim
tâ†’b Ä±M â—¦ËœÎ³(t).
(168)
Since M is arcwise-closed, it follows that q0 âˆˆM.
To complete the proof, we use the local existence of an integral curve for V |M starting at q0 to
contradict the maximality of ËœÎ³. By the local existence of integral curves (Proposition 9.2 in Lee
(2013)) and the translation lemma (Lemma 9.4 in Lee (2013)), there is an Îµ > 0 and an integral
curve Ë†Î³ : (b âˆ’Îµ, b + Îµ) â†’M of V |M such that Ë†Î³(b) = q0 = Î³(b). Shrinking the interval, we take
0 < Îµ < b âˆ’a. Again, by nauturality and uniqueness of integral curves we must have Ä±M â—¦Ë†Î³(t) = Î³(t)
for all t âˆˆ(b âˆ’Îµ, b + Îµ). Hence, by Eq. 167 and injectivity of Ä±M it follows that Ë†Î³(t) = ËœÎ³(t) for
all t âˆˆ(b âˆ’Îµ, b). Applying the gluing lemma (Corollary 2.8 in Lee (2013)) to ËœÎ³ and Ë†Î³ yields an
extension of ËœÎ³ to the larger open interval ËœI âˆª(b âˆ’Îµ, b + Îµ). Since this contradicts the maximality of
ËœÎ³, there is no t âˆˆI with t > ËœI. The same argument shows that there is no t âˆˆI with t < ËœI, and so
we must have ËœI = I.
Proof [Theorem 30] First, suppose that M is G0-invariant. In particular, this means that for every
p âˆˆM and Î¾ âˆˆLie(G), the smooth curve Î³(p)
Î¾
: R â†’N defined by
Î³(p)
Î¾ (t) = p Â· exp(tÎ¾)
(169)
lies in M. Since M is weakly embedded in N, Î³(p)
Î¾
is also smooth as a map into M. Specifically,
there is a smooth curve ËœÎ³(p)
Î¾
: R â†’M so that Î³(p)
Î¾
= Ä±M â—¦ËœÎ³(p)
Î¾
where Ä±M : M ,â†’N is the inclusion
map. Differentiating at t = 0 yields
Ë†Î¸(Î¾)p = d
d t Î³(p)
Î¾ (t)

t=0
= d Ä±M(p) d
d t ËœÎ³(p)
Î¾ (t)

t=0
,
(170)
which lies in TpM = Range (d Ä±M(p)).
Conversely, suppose that the tangency condition expressed in Eq. 123 holds. By Lemma 20.14
in Lee (2013) the vector fields Î¾ âˆˆLie(G) and Ë†Î¾ = Ë†Î¸(Î¾) are Î¸(p)-related for every p âˆˆN. By the
50

naturality of integral curves (Proposition 9.6 in Lee (2013)) it follows that Î³(p)
Î¾
: R â†’N defined by
Î³(p)
Î¾ (t) = p Â· exp(tÎ¾)
(171)
is the unique maximal integral curve of Ë†Î¾ passing through p at t = 0. When p âˆˆM, this integral
curve lies in M thanks to Lemma 38. This means that M is invariant under the action of any group
element in the range of the exponential map on G.
Proceeding by induction, suppose that G is invariant under the action of any product of m group
elements in the range of the exponential map. If g = h1 Â· Â· Â· hm Â· hm+1 is a product of m + 1 elements
hi âˆˆRange(exp) âŠ‚G, then it follows from associativity and the induction hypothesis that
M Â· (h1 Â· Â· Â· hm Â· hm+1) = (M Â· h1 Â· Â· Â· hm) Â· hm+1 âŠ‚M Â· hm+1 âŠ‚M.
(172)
Therefore, M is invariant under the action of any finite product of group elements in the range of
the exponential map by induction on m. Thanks to Lemma 37, it follows that M is G0-invariant,
proving the first claim of the theorem.
Now suppose in addition that for each connected component Gi of G there is an element gi âˆˆGi
satisfying M Â· gi âŠ‚M. By Lemma 37, we have Gi = G0 Â· gi. Therefore,
M Â· Gi = M Â· G0 Â· gi âŠ‚M Â· gi âŠ‚M,
(173)
proving that M is invariant under Gi. Since G is the union of its connected components it follows
that M is G-invariant.
Appendix G. Proof of Theorem 31
The set symG(M) is a subspace of Lie(G), for if Î¾1, Î¾2 âˆˆsymG(M) and a1, a2 âˆˆR then
Ë†Î¸(a1Î¾1 + a2Î¾2)p = a1 Ë†Î¸(Î¾1)
| {z }
âˆˆTpM
+a2 Ë†Î¸(Î¾2)
| {z }
âˆˆTpM
âˆˆTpM
(174)
thanks to linearity of the infinitesimal generator Ë†Î¸. To show that symG(M) is a Lie subalgrebra, we
must show that it is also closed under the Lie bracket. Recall that Ë†Î¸ is a Lie algebra homomorphism
(see Theorem 20.15 in Lee (2013)), and so Ë†Î¸([Î¾1, Î¾2]) = [Ë†Î¸(Î¾1), Ë†Î¸(Î¾1)]. Since the Lie bracket of
two vector fields tangent to an immersed submanifold is also tangent to the submanifold (see
Corollary 8.32 in Lee (2013)), it follows that [Ë†Î¸(Î¾1), Ë†Î¸(Î¾1)] is tangent to M. Hence, symG(M) is
closed under the Lie bracket and is therefore a Lie subalgebra of Lie(G). By Theorem 19.26 in
Lee (2013), there is a unique connected Lie subgroup of SymG(M)0 âŠ‚G whose Lie subalgebra is
symG(M).
Now suppose that M is weakly embedded and arcwise-closed in N. Since SymG(M)0 is connected,
it is equal to its identity component. Applying Theorem 30 to the induced action of SymG(M)0
on M, we immediately obtain M Â· SymG(M)0 âŠ‚M. Suppose that H is another connected Lie
subgroup of G such that M Â· H âŠ‚M. Choosing any p âˆˆM and Î¾ âˆˆLie(H), we have
p Â· exp(tÎ¾) âˆˆM
âˆ€t âˆˆR.
(175)
51

Since M is weakly embedded in N, this defines a smooth curve Î³ : R â†’M such that Ä±M â—¦Î³(t) =
p Â· exp(tÎ¾). Differentiating and using the definition of the infinitesimal generator gives
Ë†Î¸(Î¾)p = d
d t

t=0
p Â· exp(tÎ¾) = d Ä±M(p) d
d t

t=0
Î³(t) âˆˆTpM.
(176)
Therefore, Lie(H) âŠ‚symG(M) which implies that H âŠ‚SymG(M)0 by Theorem 19.26 in Lee (2013).
Now suppose that M is properly embedded in N and denote
SymG(M) = {g âˆˆG : M Â· g âŠ‚M} =
\
pâˆˆM
 Î¸(p)âˆ’1(M).
(177)
The equality of these expressions is a simple matter of unwinding their definitions. It is clear that
SymG(M) is a subgroup of G, for if g1, g2 âˆˆSymG(M) then the composition law for the group
action gives M Â· (g1 Â· g2) = (M Â· g1) Â· g2 âŠ‚M Â· g1 âŠ‚M. Since M is properly embedded, it is closed
in M (see Lee (2013, Proposition 5.5)), meaning that each preimge set
 Î¸(p)âˆ’1(M) is closed in G
by continuity of Î¸(p). As an intersection of closed subsets, it follows that SymG(M) is closed in G.
By the closed subgroup theorem (Lee (2013, Theorem 20.12)), SymG(M) is a properly embedded
Lie subgroup of G. The same holds for the identity component H0 of SymG(M) since H0 is closed
in SymG(M), which implies that H0 is closed in G thanks to the closure of SymG(M) in G.
Next we show that SymG(M)0 = H0 is the identity component of SymG(M). First, we observe
that SymG(M)0 âŠ‚H0 because SymG(M)0 is connected and contained in SymG(M). The reverse
containment follows from the fact that H0 is a connected Lie subgroup satisfying M Â· H0 âŠ‚M,
which by our earlier result implies that H0 âŠ‚SymG(M)0.
â– 
Appendix H. Proof of Theorem 34
Proof [Lemma 33] The map Ä±F defined in a local trivialization Î¦ by Eq. 126 is injective. It is a
vector bundle homomorphism because d Î¦ â—¦Ä±F â—¦Î¦âˆ’1, Î¦, and d Î¦ are vector bundle homomorphisms
and Î¦ and d Î¦ are invertible. It remains to show that the definition of Ä±F does not depend on the
choice of local trivialization. Given two local trivializations Î¦ and ËœÎ¦ defined on Ï€âˆ’1(U) âŠ‚E where
U is an open subset of M, it suffices to show that the following diagram commutes:
U Ã— Rk
Ï€âˆ’1(U) âŠ‚E
U Ã— Rk
T(U Ã— Rk)
T(Ï€âˆ’1(U)) âŠ‚TE
T(U Ã— Rk)
Ä±F
Ä±Î¦â—¦F
Ä±ËœÎ¦â—¦F
Î¦
d Î¦
ËœÎ¦
d ËœÎ¦
(178)
Since ËœÎ¦ â—¦Î¦âˆ’1 is a bundle homomorphism descending to the identity, it can be written as
ËœÎ¦ â—¦Î¦âˆ’1 : (p, v) 7â†’(p,TTT(p)v)
(179)
for a matrix-valued function TTT : U â†’RkÃ—k. Moreover, the matrices are invertible because the local
trivializations are bundle isomorphisms. Differentiating, we obtain
d ËœÎ¦ â—¦d Î¦âˆ’1 : (wp, w)(p,v) 7â†’
 wp, dTTT(p)wp + TTT(p)w

ËœÎ¦â—¦Î¦âˆ’1(p,v),
(180)
52

where wp âˆˆTpU. Composing this with Ä±Î¦â—¦F : (p, v) 7â†’(0, v)Î¦(F(p)), we obtain
d ËœÎ¦ â—¦d Î¦âˆ’1 â—¦Ä±Î¦â—¦F (p, v) = (0,TTT(p)v)ËœÎ¦(F(p)) = Ä±ËœÎ¦â—¦F (p,TTT(p)v) = Ä±ËœÎ¦â—¦F â—¦ËœÎ¦ â—¦Î¦âˆ’1(p, v),
(181)
proving that the diagram commutes.
Proof [Theorem 34] We observe that F â—¦Ï€ : E â†’E is a smooth idempotent map whose image is
im(F) âŠ‚E. By differentiating the expression (F â—¦Ï€) â—¦(F â—¦Ï€) = F â—¦Ï€ at a point F(p) âˆˆim(F), we
obtain
d(F â—¦Ï€)(F(p)) d(F â—¦Ï€)(F(p)) = d(F â—¦Ï€)(F(p)),
(182)
meaning that d(F â—¦Ï€)(F(p)) : TF(p)E â†’TF(p)E is a linear projection. Since
d(F â—¦Ï€)(F(p)) = d F(p) d Ï€(F(p)),
(183)
we have Range
 d(F â—¦Ï€)(F(p))

âŠ‚Range(d F(p)) = TF(p) im(F). Differentiating F = (F â—¦Ï€) â—¦F
yields
d F(p) = d(F â—¦Ï€)(F(p)) d F(p),
(184)
meaning that TF(p) im(F) âŠ‚Range
 d(F â—¦Ï€)(F(p))

. Since Range
 d(F â—¦Ï€)(F(p))

= TF(p) im(F)
it follows that d(F â—¦Ï€)(F(p)) is a linear projection onto TF(p) im(F).
We observe that the generalized Lie derivative in Eq. 83 can be expressed as
(LÎ¾F)(p) = lim
tâ†’0
1
t

Î˜exp(âˆ’tÎ¾)(F(Î¸exp(tÎ¾)(p))) âˆ’F(p)

= lim
tâ†’0 Î˜

exp(âˆ’tÎ¾), 1
t

F(Î¸exp(tÎ¾)(p)) âˆ’Î˜exp(tÎ¾)(F(p))

= lim
tâ†’0
1
t

F(Î¸exp(tÎ¾)(p)) âˆ’Î˜exp(tÎ¾)(F(p))

.
(185)
The first equality follows because Î˜gâˆ’1 is a vector bundle homomorphism, meaning that the
restricted map Î˜gâˆ’1|EpÂ·g : EpÂ·g â†’Ep is linear; here g = exp(tÎ¾). The second equality follows because
Î˜ : E Ã— G â†’E is continuous. Note that in the first expression the limit is taken in the vector space
Ep, whereas in the last expression the limit must be taken in E.
We proceed by expressing everything in a local trivialization Î¦ : Ï€âˆ’1(U) â†’U Ã— Rk of an open
neighborhood U âŠ‚M of p âˆˆM. Since the maps Î˜g, Î¦, and Î¦âˆ’1 are vector bundle homomorphisms,
there is a matrix-valued function TTT g : U â†’RkÃ—k such that
ËœÎ˜g = Î¦ â—¦Î˜g â—¦Î¦âˆ’1 : (p, v) 7â†’(Î¸g(p), TTT g(p)v).
(186)
Differentiating ËœÎ˜exp(tÎ¾)(p, v) with respect to t yields the generator
Ë†ËœÎ˜(Î¾)(p,v) = d
d t

t=0
ËœÎ˜exp(tÎ¾)(p, v) =

Ë†Î¸(Î¾)p, Ë†TË†TË†T(Î¾)pv

(p,v) ,
(187)
where Ë†TË†TË†T(Î¾)p =
d
d t

t=0 TTT exp(tÎ¾)(p). We define the function Ëœ
F : U â†’Rk by
(p, Ëœ
F (p)) = Î¦ â—¦F(p)
âˆ€p âˆˆU.
(188)
53

Using the above definitions, we can express the generalized Lie derivative in the local trivialization:
Î¦ â—¦(LÎ¾F)(p) = lim
tâ†’0

Î¸exp(tÎ¾)(p), 1
t
h
Ëœ
F (Î¸exp(tÎ¾)(p)) âˆ’TTT exp(tÎ¾) Ëœ
F (p)
i
=

p, d Ëœ
F (p)Ë†Î¸(Î¾)p âˆ’Ë†TË†TË†T(Î¾)p Ëœ
F (p)

.
(189)
Applying Lemma 33 allows us to express the left-hand-side of Eq. 127 as
d Î¦ [Ä±F â—¦(LÎ¾F)(p)] =

0, d Ëœ
F (p)Ë†Î¸(Î¾)p âˆ’Ë†TË†TË†T(Î¾)p Ëœ
F (p)

Î¦(F(p)) .
(190)
We can also express the quantities on the right-hand-side of Eq. 127 in the local trivialization. To
do this, we compute
d Î¦(F(p)) d(F â—¦Ï€)(F(p))Ë†Î˜(Î¾)F(p) = d
d t

t=0
Î¦ â—¦F â—¦Ï€ â—¦Î˜exp(tÎ¾)(F(p))
= d
d t

t=0
Î¦ â—¦F(Î¸exp(tÎ¾)(p))
=

Ë†Î¸(Î¾)p, d Ëœ
F (p)Ë†Î¸(Î¾)p

Î¦(F(p))
(191)
and
d Î¦(F(p))Ë†Î˜(Î¾)F(p) = d
d t

t=0
Î¦ â—¦Î˜exp(tÎ¾) â—¦Î¦âˆ’1 â—¦Î¦ â—¦F(p)
= Ë†ËœÎ˜(Î¾)Î¦(F(p)) =

Ë†Î¸(Î¾)p, Ë†TË†TË†T(Î¾)p Ëœ
F (p)

Î¦(F(p)) .
(192)
Subtracting these yields
d Î¦
h
d(F â—¦Ï€)(F(p)) âˆ’IdTF (p)E

Ë†Î˜(Î¾)F(p)
i
=

0, d Ëœ
F (p)Ë†Î¸(Î¾)p âˆ’Ë†TË†TË†T(Î¾)p Ëœ
F (p)

Î¦(F(p)) ,
(193)
which, upon comparison with Eq. 190 completes the proof.
54

