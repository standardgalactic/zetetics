FUNCTORIAL SEMANTICS FOR PARTIAL THEORIES
IVAN DI LIBERTI, FOSCO LOREGIAN, CHAD NESTER, AND PAWEL SOBOCIŃSKI
Abstract. We provide a Lawvere-style deﬁnition for partial theories, extending the classical notion
of equational theory by allowing partially deﬁned operations. As in the classical case, our deﬁnition
is syntactic: we use an appropriate class of string diagrams as terms. This allows for equational
reasoning about the class of models deﬁned by a partial theory. We demonstrate the expressivity
of such equational theories by considering a number of examples, including partial combinatory
algebras and cartesian closed categories. Moreover, despite the increase in expressivity of the syntax
we retain a well-behaved notion of semantics: we show that our categories of models are precisely
locally ﬁnitely presentable categories, and that free models exist.
Acknowledgements. Di Liberti was supported by the Grant Agency of the Czech Republic project
EXPRO 20-31529X and RVO: 67985840. Loregian, Nester and Sobociński were supported by the
ESF funded Estonian IT Academy research measure (project 2014-2020.4.05.19-0001).
1. Introduction
Mathematicians interested in, say, the theory of monoids or the theory of groups work in an
axiomatic setting, asserting the presence of a collection of 𝑛-ary operations on an ambient set 𝐴—
i.e. (total) functions 𝐴𝑛→𝐴for some 𝑛: N — that satisfy a number of axioms. This data can
be packaged up into an equational theory: a pair (Σ, 𝐸) where Σ is the signature, consisting of
operation symbols, each with a speciﬁed arity, and 𝐸is a collection of equations — i.e. pairs of
terms built up from the signature Σ and auxiliary variables — that provide the axioms. An ambient
equational theory is thus the bread and butter of an algebraist, that together with the principles of
equational reasoning provides the basic calculus of mathematical investigation into the structure of
interest.
Birkhoﬀ[Bir35] discovered that a substantial amount of mathematics can be done at the level of
generality of an equational theory. Given an equational theory (Σ, 𝐸), a model is a set together with
an interpretation of the function symbols Σ that satisﬁes the equations 𝐸. A monoid is nothing
but a model of the equational theory of monoids, a group is a model of the equational theory of
groups, and so on. The semantics of an equational theory, i.e. its class of models, is called a variety.
Birkhoﬀshowed that certain results (e.g. the so-called isomorphism theorems, existence of free
models) can be derived uniformly for generic varieties, independent of the equational theory at hand.
Most spectacularly, a class of sets-with-structure can be determined to be a variety through purely
structural means; this is often referred to as Birkhoﬀ’s Variety Theorem or the HSP Theorem.
The resulting ﬁeld is known as universal algebra. Its mathematical objects of study are equational
theories and varieties. Given its goal of uncovering methodological and technical similarities of a
large swathe of contemporary algebra, universal algebra is in the intersection of mathematics and
mathematical logic. It has inﬂuenced computer science, especially programming language theory,
as a formal and generic treatment of syntax, terms, equational reasoning, etc.
Lawvere [Law63], and the subsequent development of categorical universal algebra, addressed
some of the perceived shortcomings of the classical account. It is well known that a single variety
can have many diﬀerent axiomatic presentations, and in this sense the choice of a particular
Key words and phrases. Lawvere theory, categories of partial maps, syntax, semantics, variety theorem.
1
arXiv:2011.06644v1  [cs.LO]  12 Nov 2020

2
IVAN DI LIBERTI, FOSCO LOREGIAN, CHAD NESTER, AND PAWEL SOBOCIŃSKI
commutative comonoids
F op
Lawvere theory
classical terms
Varieties
Finite × categories
§2.4
2.26
2.9
§2.5
Adjunction 2.35
§2.22
2.24
2.21
Algebraic structure
Free c. on 1
Speciﬁcation
Syntax
Semantics
Universal property
partial Frobenius algebras
Par(F op)
partial Lawvere theory
string diagrams
LFP categories
DCR categories
§4.2
§5
§6
4.6
Adjunction §7
3.11
§4.1
4.4
Algebraic structure
Free c. on 1
Speciﬁcation
Syntax
Semantics
Universal property
Figure 1. Elements of classical functorial semantics on the left, and our contribu-
tion on the right.
presentation may seem ad hoc. The requirement that models be sets-with-structure is also restrictive,
since algebraic structures appear in other mathematical contexts as well. A Lawvere theory is a
category L that serves as a presentation-independent way of capturing the speciﬁcation of a variety.
A central conceptual role is played by cartesian categories, i.e. categories with ﬁnite products.
The free cartesian category on one object often appears in the very deﬁnition of a Lawvere theory
– the “one object” here capturing single-sortedness. Finite products track arities and ensure that
operations are total functions. Functorial semantics gives us the correct generalisation of varieties:
a model is cartesian functor L →Set. This point of view is ﬂexible (e.g. Set can be replaced with
another cartesian category) and leads to a rich theory [HP07, Law63, ALR03], where the study of
varieties and their speciﬁcations can take place at a high level of generality.
The beautiful abstract picture painted by Lawvere can be used to give a post-hoc explanation of
the elements of classical equational theories. Every equational theory yields a Lawvere theory. Free
equational theories, i.e. those where 𝐸= ∅, are Lawvere theories whose arrows can be concretely
described as (tuples of) terms. Indeed, it is well-known that terms are closely connected to the
universal property of products. The abstract mathematics, therefore, explains the structure of terms
and justiﬁes the use of ordinary equational reasoning. The elements of Lawvere’s approach to
universal algebra are illustrated in the left side of Fig. 1.
In this paper we are concerned with partial algebraic structures, i.e. those where the operations
are not, in general, deﬁned on their whole domain. Partiality is important in mathematics: the very
notion of category itself is a partial algebraic structure, since only compatible pairs of arrows can be
composed. Even more so, partiality is an essential property of computation, and partial functions
play a role in many diﬀerent parts of computer science, starting with initial forays into recursion
theory at the birth of the subject, and being ever present in more recent developments, for example
arising as an essential ingredient in the study of ﬁxpoints [BÉ93]. From the start it was clear that
additional care is necessary for partial operations, the terms built up from them, and the associated
principles of (partial) equational reasoning. An example is the principle of Kleene equality: using
𝑠= 𝑡to assert that whenever one side is deﬁned, so is the other, and they are equal, or the use of
notation −|𝑋to restrict the domain of deﬁnition of a function. In general, reasoning about partially
deﬁned terms can be quite subtle.
Our contribution is summarised on the right hand side of Fig. 1 and follows Lawvere’s approach
closely. A key question that we address is what replaces the central notion of cartesian category.

FUNCTORIAL SEMANTICS FOR PARTIAL THEORIES
3
This turns out to be the notion of discrete cartesian restriction (DCR) category, which arose from
research on the structure of partiality [CGH12]. Just as the free cartesian category on one object
plays a central role in the deﬁnition of Lawvere theory, the free DCR category on one object plays a
central role in the deﬁnition of partial Lawvere theory that we propose. In our development, the
category of sets and partial functions Par replaces Set as the universe of models. Much of the
richness of the classical picture is unchanged: e.g. we obtain free models just as in the classical
setting. Moreover, we prove a variety theorem that characterises partial varieties as locally ﬁnitely
presentable (LFP) categories.
Props [ML65, Lac04] and their associated string diagrams, play a crucial technical role. Props
are a convenient categorical structure that capture generic monoidal theories. Monoidal theories
diﬀer from equational theories in that, roughly speaking, in that we are able to consider more general
monoidal structures other than the cartesian one. String diagrams are the syntax of props, and they
are a bona ﬁde syntax not far removed from traditional terms. For example, they can be recursively
deﬁned and enjoy similar properties as free objects, e.g. the principle of structural induction. The
connective tissue between the classical story and string diagrams is Fox’s Theorem [Fox76], which
states that the structure of cartesian categories can be captured by the presence of local algebraic
structure: a coherent and natural commutative comonoid structure on each object. This implies
several things: (i) that classical terms can be seen as particular kinds of string diagrams, (ii) that
classical equational reasoning can be seen as diagrammatic reasoning on these string diagrams and
(iii) that the prop induced from the monoidal theory of commutative comonoids — well-known
to coincide with F op, the opposite of the prop of ﬁnite sets and functions — is the free cartesian
category on one object. The correspondence goes further: as shown in [BSZ18], Lawvere theories
are particular kinds of monoidal theories.
We are able to identify the nature of the free DCR category on one object by proving a result
similar to Fox’s Theorem, but for DCR categories instead of cartesian categories. Instead of
commutative comonoids, we identify the algebraic structure of interest as partial Frobenius algebras.
The free DCR category on one object is the prop induced from this monoidal theory, and it can be
characterised as Par(F op): the prop of partial functions in F op. This informs our deﬁnition of partial
Lawvere theory. Crucially, just as the mathematics of ordinary Lawvere theories serves as a post
hoc justiﬁcation for equational theories, we identify the precise class of string diagrams that serve as
partial terms, which lets us deﬁne a partial equational theory in a familiar way as pair of signature
and equations. We give several examples, from partial commutative monoids, to several examples
important in computer science, notably the theory of partial combinatory algebras [Bet88], the
theory of pairing functions, and the theory of cartesian closed categories.
To summarise, the original contributions of this paper are:
• A “Fox theorem” for DCR categories, which uses the notion of partial Frobenius algebra
and leads to the characterisation of the free DCR category on one object as Par(F op);
• The deﬁnitions of partial Lawvere theory and partial equational theory, which use string
diagrammatic syntax informed by the aforementioned Fox theorem;
• The coupling of these notions into a comprehensive framework for partial algebraic theories,
analogous to the work of Lawvere on classical algebraic theories, as illustrated in Fig. 1;
• The existence of free models, and—more generally–a variety theorem, building on known
results about DCR categories, and the Gabriel-Ulmer duality.
Related work. There are a number of formalisms in the literature that aim at providing a rigorous
way of specifying partial algebraic structure. Freyd’s essentially algebraic theories [Fre72] were
introduced informally, but were subsequently formalised and generalised in various ways [AR94,
PV07, ARV11]. A diﬀerent, but equally expressive approach is via ﬁnite limit sketches [AR94].
Nevertheless, none of these approaches can claim to have the foundational status of classical

4
IVAN DI LIBERTI, FOSCO LOREGIAN, CHAD NESTER, AND PAWEL SOBOCIŃSKI
equational theories - e.g. they do not, per se, provide a canonical notion of syntax to replace classical
terms, nor a calculus for (partial) equational reasoning about the categories of models they deﬁne.
Tout court, none of them can claim to be equational. Interestingly, the semantic landscape (i.e.
the corresponding notion of partial variety) is better understood than the syntax. The class of
models of essentially algebraic theories and ﬁnite limit sketches are closely related to Gabriel-Ulmer
duality [Cen04], which asserts a contravariant (bi)equivalence between the category of categories
with ﬁnite limits and the category of locally ﬁnitely presentable (LFP) categories.
Partial Frobenius algebras, which arise in our characterisation of DCR categories, are spe-
cial/separable Frobenius algebras without units. The version with units was originally studied
in [CW87], is deeply connected to the relational algebra [FS90], characterises 2-dimensional
TQFTs [Koc03], and has been used extensively in categorical approaches to the study of quantum
information and quantum computing, such as the ZX calculus [CD08]. In a similar way to the
use of partial Frobenius algebras in this paper, they are used in the recently proposed Frobenius
theories [BPS17], which are algebraic theories that take their models in the category of relations
Rel, and are guided by the structure of cartesian bicategories of relations [CW87].
Restriction categories were introduced in [CL02] as a general framework for reasoning about
categories of partial maps. Cartesian restriction (CR) categories are those with a certain sort
of formal ﬁnite product structure – restriction products – introduced in [CL07]. Notably, the
p-categories of [RR88] arise as restriction categories with restriction products. Discrete cartesian
restriction (DCR) categories – named for a similarity to categories of discrete topological spaces –
arise in [CGH12] as the restriction categories with ﬁnite latent limits – again a sort of formal limit.
DCR categories are closely connected to the discrete inverse categories considered in [Gil14] which
are presentable in terms of semi-Frobenius algebras, being those special/separable commutative
Frobenius algebras with neither a unit nor a counit.
Structure of the paper. In §2 we lay the foundations by recalling the basic concepts of universal
algebra, props and string diagrams, Fox’s theorem, and functorial semantics. In §3, after recalling
the basics of restriction category theory, we prove Theorem 3.6, which is to DCR categories what
Fox’s theorem is to cartesian categories. In §4 we propose our original deﬁnitions: partial Lawvere
theories and their varieties. Next, §5 is devoted to the associated notion of partial equational theory,
and several examples, continued in §6 with multi-sorted examples. Our variety theorem is in §7
where we also treat other semantic aspects, e.g. the existence of free models.
2. Background material
2.1. Overview of classical universal algebra. Universal algebra is the study of equational theories
and of their semantics, varieties. In this section we recall the basic concepts and deﬁnitions.
Deﬁnition 2.1. A signature is a pair (Σ, 𝛼) where Σ is a set and 𝛼a function Σ →N that assigns to
every element 𝑡: Σ a natural number 𝛼(𝑛) : N called the arity of the function symbol 𝑡.
Notation 2.2. The arity “slices” the set Σ of function symbols. The slice Σ𝑛⊆Σ contains operations
of arity 𝑛, and 𝑡: Σ𝑛is a synonym for “𝑡is a 𝑛-ary operation”. We will sometimes write 𝑡𝑛for a
generic element of Σ𝑛. We shall refer to the signature as just Σ if the arity function is understood
from the context. For example the signature ΣM of monoids is {𝑚, 𝑒}, with 𝛼(𝑚) = 2 and 𝛼(𝑒) = 0.
Deﬁnition 2.3. A Σ-algebra is a pair (𝐴, ⟦−⟧𝐴) where 𝐴is a set and ⟦−⟧𝐴is a function sending
function symbols 𝑡: Σ𝑛to functions ⟦𝑡⟧𝐴: 𝐴𝑛→𝐴. The function ⟦𝑡⟧𝐴is called the 𝑛-ary
operation on 𝐴associated to the function symbol 𝑡: Σ𝑛. We refer to 𝐴as the carrier of the
Σ-algebra. A Σ-algebra homomorphism from (𝐴, ⟦−⟧𝐴) to (𝐵, ⟦−⟧𝐵) is a function 𝑓: 𝐴→𝐵that

FUNCTORIAL SEMANTICS FOR PARTIAL THEORIES
5
respects the Σ structure: i.e. for every 𝑛∈N and 𝑡: Σ𝑛, the following diagram commutes:
𝐴𝑛
𝐵𝑛
𝐴
𝐵.
⟦𝑡⟧𝐴
𝑓𝑛
⟦𝑡⟧𝐵
𝑓
Remark 2.4. Σ-algebras and their homomorphisms deﬁne a category VΣ.
Of course, an algebraic structure isn’t just about operations, but also about properties enjoyed by
those operations. To express this we ﬁrst need the notion of term. Fixing a signature Σ, we recall
the usual recursive construction of the set of terms 𝑇𝑉
Σ , for some set of variables 𝑉:
𝑇𝑉
Σ
::= 𝑉| 𝑡0 | 𝑡1(𝑇𝑉
Σ ) | 𝑡2(𝑇𝑉
Σ ,𝑇𝑉
Σ ) | . . . | 𝑡𝑛(𝑇𝑉
Σ , . . . ,𝑇𝑉
Σ ) | . . .
In the above, each 𝑡𝑖ranges over the function symbols in Σ𝑖. For any 𝑉, 𝑇𝑉
Σ carries a canonical
Σ-algebra structure: ⟦𝑡⟧(𝑡1, 𝑡2, . . . , 𝑡𝑛𝑡)
def= 𝑡(𝑡1, 𝑡2, . . . , 𝑡𝑛𝑡). We call this the term Σ-algebra over 𝑉.
Observation 2.5. The term Σ-algebra 𝑇𝑉
Σ enjoys a universal property: given a Σ-algebra (𝐴, ⟦−⟧𝐴)
and function 𝑣: 𝑉→𝐴, there is a unique extension to a homomorphism of algebras ¯𝑣: 𝑇𝑉
Σ →𝐴.
This is just the induction principle associated to the recursive deﬁnition of terms.
Deﬁnition 2.6 (Σ-equation). Fixing 𝑉, a Σ-equation is a pair (𝑠, 𝑡) ∈𝑇𝑉
Σ × 𝑇𝑉
Σ ; we usually write
‘𝑠= 𝑡’. A Σ-equation 𝑠= 𝑡holds in Σ-algebra (𝐴, ⟦−⟧𝐴) if for all 𝑣: 𝑉→𝐴we have ¯𝑣(𝑠) = ¯𝑣(𝑡)
in 𝐴.
Given the signature of monoids, we can express properties such as associativity: 𝑚(𝑥, 𝑚(𝑦, 𝑧)) =
𝑚(𝑚(𝑥, 𝑦), 𝑧); or commutativity: 𝑚(𝑥, 𝑦) = 𝑚(𝑦, 𝑥); etc. The idea is that a set of Σ-equations
constrains the choice of algebras (𝐴, ⟦−⟧𝐴) to those where every equation holds.
Deﬁnition 2.7 (Equational Theory and Variety). A pair (Σ, 𝐸) where Σ is a signature and 𝐸a set
of Σ-equations is called an equational theory. A model of (Σ, 𝐸) is a Σ-algebra where every 𝑒: 𝐸
holds. The class of models for an equational theory is called a variety.
Example 2.8. The equational theory of commutative monoids is
( {𝑚, 𝑒}, { 𝑚(𝑚(𝑥, 𝑦), 𝑧) = 𝑚(𝑥, 𝑚(𝑦, 𝑧)), 𝑚(𝑥, 𝑦) = 𝑚(𝑦, 𝑥), 𝑚(𝑒, 𝑥) = 𝑥} ).
The corresponding variety is the class of commutative monoids.
Some of the most famous results of universal algebra characterise varieties. For example:
Theorem 2.9 (Birkhoﬀ[Bir35]). A class of Σ-algebras is a variety if and only if it is closed under
homomorphic images, subalgebras and products.
2.2. Props and monoidal theories. Our development is informed by the diﬀerences between the
algebraic structure of total functions and partial functions. Given the focus on algebra, the notion
of prop is useful as a categorical gadget on which to hang an algebraic structure. Moreover, the
associated notion of string diagram will lead us to a syntax with which to express partial equational
theories by appropriately generalising classical terms. Here we recall the basic deﬁnitions of props
[Lac04], string diagrams and some of the algebraic structures that are prominent in subsequent
sections.
Deﬁnition 2.10 (Prop [ML65, Ch. 5]). A prop is a symmetric strict monoidal category with set of
objects the natural numbers N, where the monoidal product on objects is addition: 𝑚⊗𝑛:= 𝑚+ 𝑛.
A homomorphism of props is an identity-on-objects symmetric strict monoidal functor.

6
IVAN DI LIBERTI, FOSCO LOREGIAN, CHAD NESTER, AND PAWEL SOBOCIŃSKI
Example 2.11. An important example is the prop F of ﬁnite ordinal numbers. In the following,
[𝑚]
def= {1, 2, . . . , 𝑚}. The F -arrows 𝑚→𝑛are all functions [𝑚] →[𝑛]: composition is function
composition, and the monoidal product is “disjoint union”; i.e. for 𝑓1 : 𝑚1 →𝑛1 and 𝑓2 : 𝑚2 →𝑛2,
( 𝑓1 ⊗𝑓2)(𝑖) : 𝑚1 + 𝑚2 →𝑛1 + 𝑛2
def=
(
𝑓1(𝑖)
if 𝑖≤𝑚1
𝑓2(𝑖−𝑚1) + 𝑛1
otherwise.
Free props generated from some signature of operations are of particular importance.
Deﬁnition 2.12 (Monoidal signature). A monoidal signature Γ is a collection of generators 𝛾: Γ,
each with an arity ar(𝛾) : N and coarity coar(𝛾) : N.
Concrete terms can be given a BNF description, as follows:
(1)
𝑐::= 𝛾∈Γ |
|
|
| 𝑐⊗𝑐| 𝑐# 𝑐
Arities and coarities are not handled in the BNF but with an associated sorting discipline, shown
below. We only consider terms that have a sort, which is unique if it exists.
𝛾: (ar(𝛾), coar(𝛾))
: (0, 0)
: (1, 1)
: (2, 2)
𝑐: (𝑛, 𝑧)
𝑑: (𝑧, 𝑚)
𝑐# 𝑑: (𝑛, 𝑚)
𝑐: (𝑛, 𝑚)
𝑑: (𝑟, 𝑧)
𝑐⊗𝑑: (𝑛+𝑟, 𝑚+𝑧)
The idea is that the sort 𝑐: (𝑚, 𝑛) counts the number of “dangling wires” of each term. Every
sortable term generated from (1) has a diagrammatic representation. The convention for 𝛾: Γ is to
draw it as a box with ar(𝛾) “dangling wires” on the left and coar(𝛾) on the right:
ar(𝛾)
n
𝛾
...
...
o
coar(𝛾)
The conventions for the (1) operations are: 𝑐# 𝑐′ is drawn
c
c0
...
...
...
and 𝑐⊗𝑐′ is drawn
c
c0
...
...
...
...
.
The sorting discipline ensures that the convention for # makes sense.
Example 2.13. Consider the following signature, where the (co)arities are apparent from the
(CMG)
Γ
def=
n
,
o
glyphs. The term (
⊗(
⊗
)) #((
⊗
) #
) has sort (3, 2) and diagram:
where the “dotted line” boxes serve the role of parentheses.
Terms of (1) are quotiented by the laws of symmetric strict monoidal categories. We do not go
into the details here, but these are closely connected with the diagrammatic conventions. Indeed,

FUNCTORIAL SEMANTICS FOR PARTIAL THEORIES
7
they allow us to discard the “dotted line” boxes and focus only on the connectivity between the
generators. For example the following two diagrams are in the same equivalence class of terms:
=
We refer to equivalence classes [𝑐] : 𝑚→𝑛as string diagrams.
Deﬁnition 2.14. The free prop XΓ on Γ has as arrows 𝑚→𝑛string diagrams [𝑐] : (𝑚, 𝑛).
String diagrams can be used to specify additional equations that specify algebraic structure.
Deﬁnition 2.15 (Monoidal theory [Lac04]). For a monoidal signature Γ, a Γ-equation is a pair
([𝑐], [𝑑]) of equally-sorted string diagrams; we usually write ‘[𝑐] = [𝑑]’. A monoidal theory is a
pair (Γ, 𝐹) where 𝐹is a set of Γ-equations.
Given a monoidal theory (Γ, 𝐹), the induced prop X(Γ,𝐹) can be obtained by taking a coequaliser
in Cat. It can alternatively be given an explicit description as follows: as arrows [𝑚] →[𝑛] it has
arrows of XΓ quotiented by the smallest congruence containing 𝐹.
Example 2.16. Consider the signature (CMG) and the following set of equations:
(CM)
𝐸
def=
n
=
,
=
,
=
o
.
The resulting prop CM is the prop of commutative monoids. The equations, from left to right,
express associativity, commutativity and unitality.
Remark 2.17. String diagrams in X(Γ,𝐹) are amenable to equational reasoning, often referred to
as diagrammatic reasoning in this context: if ([𝑐], [𝑑]) ∈𝐹then substituting 𝑐for 𝑑inside any
context is sound. For example in CM the set of equations contains only one of the unit laws. The
other may be derived:
=
=
=
=
=
=
=
We typically omit the “dotted line” boxes in such chains of reasoning.
Interestingly, CM can be seen as the algebraic characterisation of F .
Observation 2.18 ([Lac04]). As props, F  CM.
Remark 2.19. In fact, arrows of CM can be intuitively understood as “pictures of functions”. For
example, the function 𝑓: 2 →2 where 𝑓(1) = 𝑓(2) = 1 is drawn
Example 2.20. The theory of commutative comonoids plays an important role for us. The data is:
(CCMG)
(CCM)
=
=
=
Let CC be the prop induced from the monoidal theory ((CCMG),(CCM)).

8
IVAN DI LIBERTI, FOSCO LOREGIAN, CHAD NESTER, AND PAWEL SOBOCIŃSKI
Given that (CCMG) and (CCM) are mirrored (CMG) and (CM), Observation 2.18 gives:
Observation 2.21. As props, F op  CC.
While we have specialised our discussion of string diagrams as the syntax of props, it is
well-known that they can be used as a sound calculus in any symmetric (strict) monoidal category.
Roughly speaking, objects are represented by wires, and morphisms by boxes.
2.3. Fox’s theorem. Equational and monoidal theories are linked by Fox’s theorem ([Fox76]),
recalled here – this will be explained in §2.6. Cartesian categories are categories with ﬁnite
products, and cartesian functors preserve them. Fox showed that cartesian categories are exactly
those that have a certain algebraic structure.
A commutative comonoid on an object 𝑋of a symmetric monoidal category X is a triple
(𝑋, 𝛿𝑋, 𝜀𝑋) s.t. 𝛿𝑋: 𝑋→𝑋⊗𝑋and 𝜀𝑋: 𝑋→𝐼, depicted as
and
respectively, and these
satisfy (CCM). If all objects are so equipped, then the structures are coherent if for all objects 𝑋,𝑌:
(coherent)
𝑋⊗𝑌
𝑋⊗𝑌
𝑋⊗𝑌
𝑋
𝑌
𝑋
𝑋
𝑌
𝑌
=
𝑋⊗𝑌
𝑋
𝑌
=
Further, we say that the 𝛿and 𝜀are natural if for any arrow 𝑓: 𝑋→𝑌of X, we have:
(natural)
𝑓
𝑋
𝑌
𝑌
𝑓
𝑓
𝑋
𝑌
𝑌
=
𝑓
𝑋
=
Theorem 2.22 ([Fox76]). A cartesian category is the same thing as a symmetric monoidal category
where every object is equipped with a (coherent) and (natural) commutative comonoid structure.
In light of Observation 2.21, we know that a commutative comonoid structure on 𝑋is equivalently
a cartesian functor X : F op →X where X[1] = 𝑋. The action of X on objects is determined by its
action on 1, and the generators give arrows X(
) = 𝛿𝑋: 𝑋→𝑋⊗𝑋and X(𝑋
) = 𝜀𝑋: 𝑋→𝐼
of X which satisfy (CCM). Thus we may specialize Theorem 2.22, to props as follows:
Corollary 2.23. A prop X is cartesian (with categorical product the monoidal product) if and only
if there is a homomorphism of props F op →X and the picked out comonoid structure is (natural).
It is easy to show that a coherent and natural commutative comonoid structure, if it exists, is
unique. An easy consequence of Theorem 2.22 is that a cartesian functor is precisely a symmetric
monoidal functor that preserves the comonoid structure. This, combined with Corollary 2.23, gives:
Proposition 2.24. The prop F op is the free cartesian category on a single object.
2.4. Lawvere theories. We recall Lawvere’s approach [Law63] of functorial semantics of algebraic
theories in the rest of the section. Lawvere’s approach is centered on the theory of cartesian categories.
Deﬁnition 2.25 (Lawvere theory). A Lawvere theory is a cartesian prop. A morphism of Lawvere
theories is a cartesian prop homomorphism. Lawvere theories and homomorphisms deﬁne the
category Law.
Finite products do two jobs: they keep track of arities of operations, and—less obviously—they
ensure the totality and single-valuedness of the interpretation of function symbols in any model.
Free categories with products play a leading role. Recall from Proposition 2.24 that F op is the
free category with products on one object. Spelled out, a Lawvere theory is a cartesian category

FUNCTORIAL SEMANTICS FOR PARTIAL THEORIES
9
L and an identity-on-objects cartesian functor F op →L. A morphism of Lawvere theories is a
functor ℎ: L →M s.t. the following triangle commutes:
F op
L
M.
𝑞
𝑝
ℎ
Remark 2.26. Every equational theory gives rise to a Lawvere theory. For the case of no equations
(Σ, ∅), this Lawvere theory LΣ is the free category with products on Σ. It also has a simple,
concrete description that uses Σ-terms. An arrow 𝑚→𝑛is an 𝑛-tuple
(2)
(𝑡1, 𝑡2, . . . , 𝑡𝑛)
where each
𝑡𝑖: 𝑇[𝑚]
Σ
i.e. where each term in the tuple may use formal variables from the set {1, . . . , 𝑚}. Composition of
(𝑠1, . . . , 𝑠𝑘) : 𝑚→𝑘with (𝑡1, . . . , 𝑡𝑛) : 𝑘→𝑛is via substitution:
(𝑡1[𝑠1/1, . . . 𝑠𝑘/𝑘], . . . , 𝑡𝑛[𝑠1/1, . . . , 𝑠𝑘/𝑘]) : 𝑚→𝑛.
Given a set of equations 𝐸, ordering the variables in each 𝑠= 𝑡: 𝐸induces pairs of arrows
𝑠, 𝑡: 𝑚→1 (where 𝑚is the number of variables appearing in 𝑠and 𝑡). Then L(Σ,𝐸) is obtained by
“equating” 𝑠and 𝑡–this can be computed via a coequaliser, or directly as in (2) where terms are
taken modulo the smallest congruence containing the required equations. We omit the details.
The Lawvere theory induced from the empty equational theory (∅, ∅) is F op.
2.5. Semantics for algebraic theories. Here we recall some of the basic elements of functorial
semantics.
Deﬁnition 2.27 (Model of a Lawvere theory). A model for a Lawvere theory L is a cartesian
functor 𝐿: L →Set. A model homomorphism 𝐿→𝐿′ is a natural transformation 𝛼: 𝐿⇒𝐿′.
This deﬁnes the category of models ModL of a Lawvere theory L.
Remark 2.28. There are forgetful functors 𝑈: ModL →Set, given by evaluating on the terminal
object 𝐹↦→𝐹(1). Intuitively, 𝑈forgets the algebraic structure, returning the underlying carrier set.
Deﬁnition 2.27 is compatible with its classical counterpart: the data required to give a model of
(Σ, 𝐸), in the sense of Deﬁnition 2.7, is precisely that required to give a functor L(Σ, 𝐸) →Set.
The functorial approach lends itself to generalisations: e.g. replacing Set with another cartesian
category. Moreover, it allows for further structural analysis.
Observation 2.29. ModL is closed under limits computed in the category of all functors [L, Set],
because limits commute with limits. For a similar reason it is closed under sifted colimits. Thus the
inclusion ModL ↩→[L, Set] creates limits and sifted colimits1.
Remark 2.30 (Multi-sorted, unsorted). The codomain of 𝑈: ModL →Set betrays that our
presentation is single sorted. Indeed when L is 𝑆-sorted we obtain a functor 𝑈: ModL →[𝑆, Set].
Historically, syntactic aspects are single sorted, while categorical variety theorems are most crisp in
the unsorted case. It is thus worthwhile to focus on these concepts in more detail.
An 𝑆-sorted Lawvere theory is a cartesian 𝑆-coloured prop. Spelled out, it is an identity-on-objects
cartesian functor F (𝑆) →L, where F (𝑆) is the free cartesian category on 𝑆.
An unsorted Lawvere theory is simply a (small) category with products.
1Sifted J-indexed colimits satisfy the following property: given a functor 𝐸: 𝐼× J →Set, s.t. the category 𝐼is
discrete (namely, it is just a set), the following isomorphism holds:
colimJ lim𝐼𝐸(𝐼, 𝐽)  lim𝐼colimJ 𝐸(𝐼, 𝐽).
In other words, sifted colimits are those that commute with ﬁnite products in Set.

10
IVAN DI LIBERTI, FOSCO LOREGIAN, CHAD NESTER, AND PAWEL SOBOCIŃSKI
In the remainder of this section we focus on the unsorted version, because the treatment is
notationally and technically simpliﬁed. Nevertheless, much of the following is sort-agnostic.
Observation 2.31. A theory morphism ℎ: L →L′ induces a (contravariant) functor
Modℎ: ModL′ →ModL
taking 𝐹: L′ →Set to 𝐹· ℎ: L →Set. The functor Modℎalways admits a left adjoint: Modℎ
preserves limits and sifted colimits because they are computed in the underlying functor category.
The special adjoint functor theorem can now be used to obtain a left adjoint 𝐿ℎ: ModL →ModL′.
Example 2.32. For intuition, we consider a concrete example. Consider the inclusion 𝑖of the
theory of monoids in commutative monoids. Then Mod𝑖is the functor that “forgets” commutativity.
Its left adjoint takes a monoid and “forces” commutativity by quotienting the underlying carrier set.
Observation 2.33. Lawvere theories have free models. Let 𝑝: F op →L be a Lawvere theory.
Observation 2.31 gives an adjunction
𝐹: ModF op ⇆ModL : Mod𝑝.
Then Mod𝑝coincides with the forgetful functor of Remark 2.28. The left adjoint 𝐹gives free
objects.
Because of Observation 2.31, it is natural to take adjunctions as the notion of variety morphism.
Below, by unsorted-variety we mean a category equivalent to ModL for L with ﬁnite products.
Deﬁnition 2.34. Let V, W be two (unsorted) varieties; a morphism of varieties is a functor
𝑅: V →W satisfying the following:
mv1) 𝑅admits a left adjoint 𝐿: W →V;
mv2) 𝑅commutes with sifted colimits.
Given that adjunctions compose, this data yields a category Var.
Let Prod be the 2-category whose objects are small cartesian categories, morphisms are cartesian
functors and 2-cells are natural transformations. Then Observation 2.31 boils down to deﬁning a
2-functor Mod: Prodop →Var. The following captures the relationship between Law and Var.
Theorem 2.35 ([ALR03, Theorem 4.1]). There exists a 2-adjunction whose unit is an equivalence:
Th : Var ⇆Prodop : Mod
Remark 2.36. One obtains the 𝑆-sorted version of Theorem 2.35 by slicing on both sides over the
free category with products on 𝑆. This is given in more detail for partial Lawvere theories in §7.1.
2.6. Equational theories as monoidal theories. Given that Lawvere theories are cartesian props,
Theorem 2.22 suggests how to consider them as monoidal theories.
We recall the recipe
from [BSZ18]: the idea is to characterise Σ-terms as certain string diagrams, and then—through
this lens—turn any equational theory into a monoidal theory.
Recipe 2.37. Fix a signature Σ. A Σ-term 𝑡: 𝑇[𝑛]
Σ
is the same thing as a string diagram 𝑛→1 in
the prop induced by the monoidal theory with
• generators Γ
def= Σ + (CCMG)
• (CCM) together with equations that ensure naturality with respect to the comonoid structure.
The latter can be easily added as two additional equations for each 𝜎: Σ:
(SN𝜎)
𝜎
𝜎
𝜎
=
𝜎
𝑚
𝑚
𝑚
𝑚
=

FUNCTORIAL SEMANTICS FOR PARTIAL THEORIES
11
The Lawvere theory induced by equational theory (Σ, 𝐸) can now be seen as the prop induced by
the monoidal theory (Γ, 𝐹) where 𝐹is the set of equations obtained by translating the equations in
𝐸to string diagrams, together with (CCM), and (SN𝜎) for each 𝜎: Σ.
It is important to build an intuition behind this translation. An obvious diﬀerence between terms
and string diagrams is that the latter do not have named variables. The translation ensures that wires
play the role of variables, and the comonoid structure plays the role of “variable management”. We
illustrate this with an example below.
Example 2.38. The prop corresponding to the Lawvere theory induced by the equational theory
of commutative monoids (Example 2.8) is the same as the prop of commutative bialgebra. For
example, the term 𝑚(𝑚(𝑥, 𝑥), 𝑦) in the theory of commutative monoids can be depicted as
𝑚
𝑚
In the term we have considered, the variable 𝑥appears twice. In the corresponding diagram, the
wire corresponding to 𝑥starts with a comultiplication that witnesses the “copying of 𝑥”.
3. Algebra of partial maps
We have seen that ﬁnite products are central in classical universal algebra. It is therefore
natural to begin our development of its partial analogue by identifying the corresponding universal
property in the partial setting. We will see that this amounts to replacing the class of cartesian
categories with the class of discrete cartesian restriction categories (DCR categories) [CGH12].
Next, we characterise DCR categories in terms of algebraic structure, analogous to 2.22 for cartesian
categories.
3.1. Partial functions. The starting point of our journey is the (2-)category Par of sets and partial
functions. Just as Set was the semantic universe for ordinary equational theories, Par is the semantic
universe for partial equational theories. We ﬁrst recall an elementary, set theoretic presentation:
Deﬁnition 3.1. Par has sets as objects and partial functions 𝑓: 𝑋⇀𝑌as arrows, where a
partial function 𝑓is a pair (dom 𝑓, def 𝑓) where dom 𝑓⊆𝑋is the domain of deﬁnition of 𝑓and
def 𝑓: dom 𝑓→𝑌is a (total) function. Given a partial function 𝑓: 𝑋⇀𝑌, and some 𝑋′ ⊆𝑋we
write 𝑓|𝑋′ for the partial function (dom 𝑓∩𝑋′, 𝑓′) where 𝑓′: dom 𝑓∩𝑋′ →𝑌is def 𝑓restricted
to the (potentially smaller) domain of deﬁnition dom 𝑓∩𝑋′. Similarly, given 𝑌′ ⊆𝑌, write
𝑓−1(𝑌′) = {𝑥∈dom 𝑓
| def 𝑓(𝑥) ∈𝑌′}. Given 𝑓: 𝑋⇀𝑌and 𝑔: 𝑌⇀𝑍, their composite is
deﬁned by 𝑓# 𝑔= ( 𝑓−1(dom𝑔), (def 𝑓| 𝑓−1(dom𝑔) # def𝑔). The identity on 𝑋is (𝑋, id𝑋).
There is a natural partial order between partial functions 𝑋⇀𝑌:
𝑓≤𝑔
def=
dom 𝑓⊆dom𝑔∧𝑔|dom 𝑓= 𝑓.
It is straightforward to verify that this data makes Par a category, and with ≤, a 2-category.
Categorifying partiality has long history (see e.g., [RR88, CL02]). We recall a classical approach:
Deﬁnition 3.2. Suppose that C has ﬁnite limits. Its 2-category of partial maps, Par(C) has:
1) objects are objects of C.
2) arrows are equivalence classes [𝑚, 𝑓] : 𝑋→𝑌of spans 𝑋
𝑚
←−𝐴
𝑓−→𝑌where 𝑚is monic.
We equate (𝑚, 𝑓) ∼(𝑚′, 𝑓′) iﬀthere is an isomorphism 𝛼s.t. the following diagram
commutes:
𝐴
𝐴′
𝑋
𝑌.
𝑚
𝑓
𝛼
𝑚′
𝑓′

12
IVAN DI LIBERTI, FOSCO LOREGIAN, CHAD NESTER, AND PAWEL SOBOCIŃSKI
3) 2-cells: [𝑚, 𝑓] ≤[𝑚′, 𝑓′] when there exists any 𝛼that makes the diagram commute.
4) composition is deﬁned by pullback. Explicitly, the composite of (𝑚, 𝑓) : 𝐴→𝐵and
(𝑚′, 𝑔) : 𝐵→𝐶is the outer span of the diagram on the left
𝑋∧𝑋′
𝑋
𝑋′
𝐴
𝐵
𝐶
𝜋0
𝜋1
𝑚
𝑓
𝑚′
𝑔
where the square with top 𝑋∧𝑋′ is a pullback in C. Note that it doesn’t matter which
pullback, since any two choices will give isomorphic spans, and therefore equal morphisms.
5) Identities are diagonal spans (1𝐴, 1𝐴) : 𝐴→𝐴.
Given a morphism (𝑚, 𝑓) : 𝐴→𝐵in Par(C), we think of the monic 𝑚: 𝑋→𝐴as a subobject,
specifying which part of 𝐴the morphism is deﬁned on, and then 𝑓: 𝑋→𝐵tells us what it does.
The following is a straightforward sanity check:
Observation 3.3. There is an isomorphism of (2-)categories Par  Par(Set).
Just as a model of a total operation of arity 𝑛is a function 𝐴𝑛→𝐴(an arrow in Set), a model of
a partial operation ought to be a partial function 𝐴𝑛⇀𝐴(an arrow in Par). For this reason, it is
important to understand the mathematical status of the cartesian product in Par. Interestingly, Par
has categorical products, but these do not correspond to the cartesian product of sets.2
3.2. Cartesian Restriction Categories. It is by focusing on the universal property of the cartesian
product in Par that we are able to identify a generalisation of Lawvere’s approach to partial
operations. This is the goal of this section.
Restriction categories were devised to study partial phenomena in an axiomatic setting. Here
we give a whirlwind tour, more details can be found in [CL02, CL07, CGH12]. In a restriction
category, every arrow 𝑓: 𝐴→𝐵has an associated idempotent 𝑓: 𝐴→𝐴, thought of as the
identity function restricted to the domain of deﬁnition of 𝑓. We call them domain idempotents.
Arrows where 𝑓= 1𝐴are called total, and form a subcategory. Further, we have:
Remark 3.4. Any restriction category is poset-enriched, with the ordering deﬁned by
𝑓≤𝑔⇔𝑓# 𝑔= 𝑓
Functors 𝐹that preserve domain idempotents (𝐹𝑓= 𝐹𝑓) are called restriction functors.
Restriction categories and restriction functors form a category. This extends to a 2-category in
which the 2-cells are lax transformations. A lax transformation 𝛼: 𝐹→𝐺of restriction functors
𝐹, 𝐺: X →Y consists of a family of total maps 𝛼𝐴: 𝐹𝐴→𝐺𝐴in Y indexed by the objects 𝐴of
X s.t. for every 𝑓: 𝐴→𝐵of X the usual naturality square commutes up to inequality:
𝐹𝐴
𝐺𝐴
𝐹𝐵
𝐺𝐵
𝐹𝑓
𝛼𝐴
𝐺𝑓
𝛼𝐵
≤
where ≤is the ordering introduced above. Call this 2-category RCat≤. Just as categories with ﬁnite
products enjoy a universal property in the 2-category Cat, those with ﬁnite restriction products
have a universal property in RCat≤. In general, formal limits in RCat≤are called restriction
2The categorical product of 𝐴and 𝐵in Par is (𝐴+ {★}) × (𝐵+ {★}) −{(★, ★)}. This can be seen via the equivalence
1/Set ≃Par. Limits in the coslice category 1/Set are calculated pointwise, and the functor 1/Set →Par removes the
point

FUNCTORIAL SEMANTICS FOR PARTIAL THEORIES
13
limits [CL07]. A cartesian restriction (CR) category is a restriction category with ﬁnite restriction
products.
Observation 3.5 ([CL02]). Par is a CR category, with the cartesian product as restriction product.
CR categories have appeared in the literature under a variety of diﬀerent names, including
p-category with a one-element object [RR88] and partially cartesian category [CO89]. For our
development, it is crucial that the data of CR categories can be equivalently captured as follows:
Theorem 3.6 ([CL07]). A CR category is the same thing as a symmetric monoidal category
where every object is equipped with a commutative comonoid structure that is (coherent) and the
comultiplication is natural. That is, for any 𝑓: 𝐴→𝐵we have 𝑓# 𝛿𝐵= 𝛿𝐴#( 𝑓⊗𝑓).
From this perspective a CR category is very close to a cartesian category viewed as a monoidal
category through 2.22. The diﬀerence is that we do not ask for the counit of the comonoid to be
natural. This has profound consequences: for instance, the same symmetric monoidal category may
have more than one such chosen comonoid structure, thus deﬁnining diﬀerent CR categories.
Given the algebraic data, the domain idempotent 𝑓: 𝐴→𝐴of an arrow 𝑓: 𝐴→𝐵in a CR
category is recovered as:
𝑓
𝑓
=
and so in particular the subcategory of X for which the counit is natural is precisely the subcategory
of total maps. Notice that this means the subcategory of total maps of a CR category is cartesian.
Deﬁnition 3.7. A CR functor between two CR categories 𝐹: X →Y is a functor that preserves
the algebraic structure. That is, 𝐹(𝐴⊗𝐵) = 𝐹𝐴⊗𝐹𝐵, 𝐹1 = 1, 𝐹𝛿𝐴= 𝛿𝐹𝐴and 𝐹𝜀𝐴= 𝜀𝐹𝐴.
Remark 3.8. A lax transformation of CR functors may be equivalently speciﬁed as a family of maps
𝛼𝐴: 𝐹𝐴→𝐺𝐴indexed by the objects 𝐴of X s.t. for every 𝑓: 𝐴→𝐵we have 𝐹𝑓# 𝛼𝐵≤𝛼𝐴# 𝐺𝑓.
We do not need to ask that each 𝛼𝐴is total, since if 𝐹and 𝐺preserve the cartesian restriction
structure, then they are automatically total. In particular the diagram on the left gives the inequality
on the right, which gives that 𝛼𝐴is total:
𝐹𝐴
𝐺𝐴
𝐹𝐼
𝐺𝐼
𝐹𝜀𝐴
𝛼𝐴
𝐺𝜀𝐴
𝛼𝐼
≤
FA
≤
↵A
FA
GA
3.3. Discrete Cartesian Restriction Categories. Restriction products do not quite capture all the
properties of Par needed for partial universal algebra. In particular, we require CR categories with
the following extra structure:
Deﬁnition 3.9. A CR category is said to be discrete (DCR category [CGH12]) if for each object 𝐴
there is an arrow 𝜇𝐴: 𝐴⊗𝐴→𝐴that is partial inverse to 𝛿𝐴. That is, 𝛿𝐴# 𝜇𝐴= 𝛿𝐴= 1𝐴and
𝜇𝐴# 𝛿𝐴= 𝜇𝐴.
We give a novel presentation of DCR categories, inspired by the work of [Gil14]. Central to our
presentation is the notion of a commutative special Frobenius algebra in which the monoid does not
have a unit, which we call a partial Frobenius algebra. More precisely:
Deﬁnition 3.10. A partial Frobenius algebra (𝐴, 𝛿𝐴, 𝜇𝐴, 𝜀𝐴) in a symmetric monoidal category
consists of a commutative comonoid (𝐴, 𝛿𝐴, 𝜀𝐴) and a commutative semigroup (𝐴, 𝜇𝐴) s.t.
(𝐴, 𝛿𝐴, 𝜇𝐴) is a semi-Frobenius algebra. Diagramatically, this is the comonoid structure we have

14
IVAN DI LIBERTI, FOSCO LOREGIAN, CHAD NESTER, AND PAWEL SOBOCIŃSKI
already seen together 𝜇𝐴, which we depict as
in our string diagrams, subject to the following
equations:
(MCA)
=
=
(SFROB)
=
=
=
Note that there is some redundancy in the equational presentation above, as discussed in [Car91].
We now extend the characterisation of CR categories given in Theorem 3.6 to DCR categories:
Theorem 3.11. A DCR category is the same thing as a symmetric monoidal category where every
object 𝐴is equipped with a coherent partial Frobenius algebra structure (𝐴, 𝛿𝐴, 𝜀𝐴, 𝜇𝐴) s.t. the
comultiplication is natural. That is, for any 𝑓: 𝐴→𝐵we have 𝑓# 𝛿𝐵= 𝛿𝐴#( 𝑓⊗𝑓).
DCR categories are intimately connected to categories with ﬁnite limits [CGH12]. In particular:
Proposition 3.12. If C is a category with ﬁnite limits, Par(C) is a DCR category.
Deﬁnition 3.13 (the 2-category DCRC≤). It follows that for any CR functor 𝐹: X →Y between
DCR categories, we have 𝐹𝜇𝐴= 𝜇𝐹𝐴. CR functors therefore give the notion of morphism between
DCR categories. We consider the strict 2-category of DCR categories, restriction functors, and lax
transformations, which we call DCRC≤.
4. Partial Lawvere theories
In this section we develop a Lawvere-style approach to partial algebraic theories, where operations
may be partial. Ordinary Lawvere theories are determined by the free cartesian category on a single
object F op; we are thus interested in the analogue of F op in the world of DCR categories.
4.1. The free DCR category on one object. Given Theorem 3.11, we have an explicit description
for the DCR category on one object: it is the prop PF induced from the monoidal theory of partial
Frobenius algebras. That is, it has generators {
,
,
} and equations (MCA), (CCM)
and (SFROB).
It turns out that one can gain a precise intuition on what PF looks like by mimicking the way in
which the props F and its opposite F op describe familiar algebraic structures. In fact, the prop CM
of commutative monoids is isomorphic to the prop F (see Observation 2.18), and similarly, the prop
CC of commutative comonoids is isomorphic to F op (Observation 2.21).
The prop PF of partial Frobenius algebras that we want to describe here can be given a similar
“combinatorial” characterisation relying on the insights of Lack [Lac04]. First, we note that the prop
CAM induced by the monoidal theory of commutative semigroups ({
} and equations (MCA))
is isomorphic to sub-prop F𝑠⊂F of ﬁnite sets and surjective functions.
Observation 4.1. As props, CAM  F𝑠.
This is intuitive: as observed in Remark 2.19, string diagrams of CM allow one to “draw” all
functions [𝑚] →[𝑛]. Doing without the unit means that we can express exactly the surjective ones.
Next, we know from [Lac04] that the prop F ROB induced by the monoidal theory of special
Frobenius algebras with generators {
,
,
,
} and equations (CM), (CCM) and

FUNCTORIAL SEMANTICS FOR PARTIAL THEORIES
15
(SFROB) is isomorphic to the prop of cospans of ﬁnite sets Cospan(F ). An arrow 𝑚→𝑛here is
(an isomorphism class of) a cospan of functions [𝑚]
𝑓−→[𝑘]
𝑔←−[𝑛], and composition is by pushout.
Proposition 4.2 ([Lac04]). As props, F ROB  Cospan(F ).
Given that surjective functions are closed under composition and pushouts in F , we can consider
the subprop Cospan𝑠(F ) of Cospan(F ) with arrows those cospans where the left leg is surjective.
Now, combining Observation 4.1 and Proposition 4.2 yields:
Proposition 4.3. As props, PF  Cospan𝑠(F ).
This gives us a combinatorial characterisation of PF . But there is a more familiar and satisfactory
way of describing Cospan𝑠(F ). Given that cospans in C are spans in Cop, and epimorphisms in C
are monomorphisms in Cop, we see that Cospan𝑠(F ) = Par(F op), since a cospan in F with left leg
surjective is the same thing as a span in F op with left leg a monomorphism. Therefore, we obtain:
Proposition 4.4. As props, PF  Par(F op).
4.2. Partial Lawvere theories. We have seen that F op is central to the deﬁnition of Lawvere
theories, being the free cartesian category on one object. The prop Par(F op), being the free DCR
on one object, plays the corresponding role in the deﬁnition of partial Lawvere theories.
Deﬁnition 4.5. A partial Lawvere theory L is a DCR prop.
Spelled out, a partial Lawvere theory is a DCR category L for which there is an identity-on-objects
CR functor Par(F op) →L. A morphism of partial Lawvere theories is a functor ℎ: L →M s.t.
the following triangle commutes:
Par(F op)
L
M.
𝑞
𝑝
ℎ
This deﬁnes the category pLaw of partial Lawvere theories.
Mimicking also the deﬁnition of model of a Lawvere theory, we obtain at once the notion of
model of a partial Lawvere theory:
Deﬁnition 4.6 (Model of a partial Lawvere theory). A model for a partial Lawvere theory L is a
CR functor 𝐿: L →Par. A homomorphism 𝐿→𝐿′ is a lax natural transformation 𝛼: 𝐿⇒𝐿′.
Deﬁnition 4.7. The category of models and homomorphisms of a partial Lawvere theory L is
denoted pModL. As explained in Remark 3.8, the homomorphisms are total functions.
5. Partial equational theories
In order to consider interesting examples of partial Lawvere theories, we need to introduce the
notion of partial equational theory. For partial structures, these are the syntactic analogue of
equational theories, and yield partial Lawvere theories in a similar way to how equational theories
yield Lawvere theories.
Monoidal signatures (Deﬁnition 2.12) Γ have unrestricted arities and coarities. Instead, a
signature Σ of an equational theory (Deﬁnition 2.1) has function symbols of arbitrary arities,
but—considered as a monoidal signature—all coarities are 1. Partial signatures are an intermediate
concept: as for equational theories, coarities > 1 are redundant, but we need to admit symbols of
coarity 0.
Deﬁnition 5.1. A partial signature Δ
def= Δ0 + Δ1, where Δ0 is the set of operations of coarity 0,
and Δ1 is the set of operations of coarity 1. Each 𝛿: Δ𝑖comes with an arity ar(𝛿) : N.

16
IVAN DI LIBERTI, FOSCO LOREGIAN, CHAD NESTER, AND PAWEL SOBOCIŃSKI
Diﬀerently from ordinary equational theories, we cannot use classical terms, which—as discussed
in Remark 2.26—are tied to an underlying cartesian structure. Instead, we adapt Recipe 2.37 to
DCR categories, obtaining partial terms as particular string diagrams. Before we launch into formal
deﬁnitions, and illustrate them with a variety of examples, let us establish some intuitions for how
to read the string diagrams.
• string diagrams represent partial terms, obtained through composing partial operations,
• equalities and inequalities between them are understood in the sense of Kleene,
• the comonoid structure {
,
} plays a similar role to that described §2
Recipe 5.2. Given a partial signature Δ, the free DCR prop LΔ on Δ is the prop induced from the
monoidal theory with
• generators (Δ + {
,
,
})
• equations (MCA), (CCM) and (SFROB), together with
𝛿
𝛿
𝛿
𝑚
𝑚
=
for each 𝛿: Δ1, where ar(𝛿) = 𝑚.
Deﬁnition 5.3 (Partial Equational Theory). A partial equation is a pair (𝑠, 𝑡) where 𝑠, 𝑡: LΔ(𝑚, 𝑛)
for some 𝑚, 𝑛: N; we usually write ‘𝑠= 𝑡’. A partial equational theory is a pair (Δ, 𝐺) where Δ is
a partial signature and 𝐺is a set of partial equations.
We ﬁrst return to a familiar example.
Example 5.4 ((Partial) Commutative Monoids). We start with the monoidal theory of commutative
monoids (Example 2.16), where the multiplication and unit generators are re-coloured to red to
avoid a clash. In models, the multiplication operation may be partially deﬁned and the unit may be
undeﬁned. To deﬁne the partial theory of total commutative monoids, we’d need to add equations:
(3)
=
=
Example 5.5 (Equational Theories). Any equational theory (Σ, 𝐸) is an example. One follows
Recipe 5.2, adding equations analogous to (3) to specify that every generator in Σ is total. The
category of models of this partial theory then agrees with that of the Lawvere theory L(Σ,𝐸).
The following elementary examples illustrate the novel features of partial Lawvere theories,
highlighting the way in which they diﬀer from classical (i.e., total) Lawvere theories.
Example 5.6 (Equivalence Relations). Consider the partial Lawvere theory consisting of a single
binary operation 𝑅with coarity 0, together with equations expressing symmetry and reﬂexivity:
𝑅:
𝑅
𝑅
=
𝑅
=
Note that inequations of terms, as in Remark 3.4, do not add expressivity. As such, we may use
them freely when specifying partial Lawvere theories. Transitivity is intuitively captured by the
inequation on the left, which, unfolding the deﬁnition of ≤, is precisely the equation on the right:
𝑅
𝑅
𝑅
≤
𝑅
𝑅
𝑅
𝑅
𝑅
=

FUNCTORIAL SEMANTICS FOR PARTIAL THEORIES
17
A model A of this theory consists of a set 𝐴together with an equivalence relation =𝐴⊆𝐴× 𝐴
corresponding to the domain of deﬁnition of A(𝑅). A morphism 𝐹: A →B is a function
𝐹: 𝐴→𝐵with 𝑎=𝐴𝑏⇒𝐹𝑎=𝐵𝐹𝑏, which arises from the requirement that 𝐹is a lax
transformation:
𝑅
𝐴
𝐴
𝐹
𝐹
𝐴
𝐴
𝑅
≤
Thus, the variety corresponding to this theory is the category of Bishop sets (setoids) [Pal09].
Example 5.7 (Partial Combinatory Algebras). A partial combinatory algebra (PCA) is a set 𝐴
with a binary partial operation _ • _ : 𝐴× 𝐴→𝐴, and elements s, k ∈𝐴s.t. for any 𝑥, 𝑦, 𝑧∈𝐴:
(i) (k • 𝑥) • 𝑦= 𝑥
(ii) ((s • 𝑥) • 𝑦) • 𝑧= (𝑥• 𝑧) • (𝑦• 𝑧)
(iii) (s • 𝑥) • 𝑦is deﬁned
where “=” is Kleene equality. The partial Lawvere theory of PCAs has three generators:
𝑘
𝑠
and equations that ensure the totality of 𝑘, 𝑠, i.e. they deﬁne elements of the carrier, and (𝑖𝑖𝑖):
𝑘
=
𝑠
=
𝑠
=
as well as equations for (𝑖) and (𝑖𝑖):
𝑘
=
𝑠
=
The variety here is the category of PCAs and homomorphisms preserving the applicative structure.
Example 5.8 (Pairing Functions). Consider the partial Lawvere theory with two operations which
we think of as pairing and unpairing respectively, subject to the equation on the right:
=
Models are sets equipped with a pairing function, and model morphisms map pairs to pairs. For
example, N and Cantor’s pairing function, or Λ – the set of untyped 𝜆-terms – with the usual pairing
and projection functions. Note that our equation makes pairing a section, and so it is total.
6. Multi-Sorted Equational Theories
In this section we present a progression of multi-sorted partial Lawvere theories for categories
with diﬀerent kinds of structure. While our development of partial Lawvere theories has thus far
focused on the single-sorted case, the move to multi-sorted theories contains no surprises, so we
omit the details. The short version is that props are replaced with coloured props, and the sorting
discipline changes accordingly. The examples that follow are developed incrementally: Each step
adds more categorical structure to the models by adding the appropriate operations and equations to
the theory, culminating in the partial Lawvere theory of cartesian closed categories.

18
IVAN DI LIBERTI, FOSCO LOREGIAN, CHAD NESTER, AND PAWEL SOBOCIŃSKI
Example 6.1 (Directed Graphs). We begin with the partial Lawvere theory of directed graphs,
which has a sort 𝑂of vertices and a sort 𝐴of edges, together with source and target operations:
𝑠
𝐴
𝑂
𝑡
𝐴
𝑂
𝑠
=
𝐴
𝐴
𝑡
=
𝐴
𝐴
The associated variety is the category of directed graphs, as model morphisms 𝐹must satisfy:
𝑠
𝐹
𝐹
𝑠
=
𝑡
𝐹
𝐹
𝑡
=
Example 6.2 (Reﬂexive Graphs). Extending Example 6.1, we ask that each vertex has a self-loop:
id
𝑂
𝐴
id
=
𝑂
𝑂
id
𝑠
𝑂
𝑂
𝑂
𝑂
=
=
id
𝑡
𝑂
𝑂
then morphisms of models are required to preserve the self-loop, so the associated variety is the
category of reﬂexive graphs. Notice that along with Example 6.1, this could also be presented as a
(total) 2-sorted Lawvere theory, since all the operations are total.
Example 6.3 (Categories). To capture categories we extend Example 6.2 with a composition
operator, which is deﬁned when the target of the ﬁrst arrow matches the source of the second:
𝐴
𝐴
𝐴
𝑡
𝑠
=
and equations insisting composition is associative and unital, with identities given by the self-loops:
𝐴
𝐴
𝐴
𝐴=
𝐴
𝐴
𝐴
𝐴
𝑠
id
𝑡
id
𝐴
𝐴
𝐴
𝐴
𝐴
𝐴
=
=
Model morphisms are precisely functors. It is worth noting that this involves an inequality:
𝐹
𝐹
𝐹
≤
This states that if 𝑓and 𝑔are composable then so are 𝐹𝑓and 𝐹𝑔, and in particular 𝐹( 𝑓# 𝑔) = 𝐹𝑓# 𝐹𝑔.
If this were an equality, it would insist also that if 𝐹𝑓and 𝐹𝑔are composable, then so are 𝑓and 𝑔,
which is not always the case. Of course, the associated variety is the category of small categories.
Example 6.4 (Strict Monoidal Categories). Next, we extend Example 6.3 by asking for a functorial
binary operation ⊗on 𝑂and 𝐴together with a unit constant ⊤of 𝑂:
⊤
𝑂:
⊤
=
⊗
𝑂
𝑂
𝑂:
⊗
𝑂
𝑂
𝑂
𝑂
=
⊗
𝐴
𝐴
𝐴
𝐴
=
⊗
𝐴
𝐴
𝑂
𝑠
𝑠
𝑠
⊗
𝐴
𝐴
𝑂
=
⊗
𝐴
𝐴
𝑂
𝑡
𝑡
𝑡
⊗
𝐴
𝐴
𝑂
=
⊗
⊗
⊗
𝐴
𝐴
𝐴
𝐴
𝐴
𝐴
𝐴
𝐴
𝐴
𝐴=
Additionally, we require equations to the eﬀect that ⊗is associative and unital:
⊗⊗
𝑂
𝑂
𝑂
𝑂
⊗⊗
𝑂
𝑂
𝑂
𝑂
=
⊗⊗
𝐴
𝐴
𝐴
𝐴
⊗⊗
𝐴
𝐴
𝐴
𝐴
=

FUNCTORIAL SEMANTICS FOR PARTIAL THEORIES
19
⊤
id ⊗
𝐴
𝐴=
⊤
id ⊗
𝐴
𝐴
⊤⊗
𝑂
𝑂
𝑂
𝑂
⊤⊗
𝑂
𝑂
=
=
Now the associated variety is the category of strict monoidal categories and strict monoidal functors.
Example 6.5 (Symmetric Strict Monoidal Categories). To capture symmetric monoidal categories,
we extend Example 6.4 with a binary operation 𝜎: 𝑂⊗𝑂→𝐴for the braiding maps, subject to:
𝜎
𝑂
𝑂
𝐴:
𝜎
𝑂
𝑂
=
𝜎
𝑠
𝑂
𝑂
𝑂
⊗
𝑂
𝑂
𝑂
=
𝜎
𝑡
𝑂
𝑂
𝑂
⊗
𝑂
𝑂
𝑂
=
𝜎
𝜎
𝑂
𝑂
𝐴=
⊗
id
𝑂
𝑂
𝐴
⊗
𝑡
𝑡
𝜎
⊗
𝑠
𝑠
𝜎
=
𝐴
𝐴
𝐴
𝐴
𝐴
𝐴
This gives the variety of strict monoidal categories and symmetric strict monoidal functors.
Example 6.6 (Cartesian Restriction Categories). In light of 3.6, we can capture CR categories
by extending Example 6.5 with operations 𝛿: 𝑂→𝐴and 𝜀: 𝑂→𝐴corresponding to the
comultiplication and counit of the comonoid structure:
𝛿
𝑂
𝐴:
𝛿
=
𝛿
𝑠
=
𝛿
𝑡
⊗
=
𝜀
𝑂
𝐴:
𝜀
=
𝜀
𝑠
=
𝜀
𝑡
⊤
=
along with equations insisting that 𝛿and 𝜀are coherent with respect to the monoidal structure:
⊗
𝛿
𝛿
𝛿
id
𝜎
id
⊗
⊗
⊗
=
⊗
𝜀
𝜀
𝜀
⊗
=
And ﬁnally equations for the commutative comonoid axioms, and naturality of 𝛿:
𝛿
𝛿
id ⊗
𝛿
id
𝛿⊗
=
𝛿
𝜎
𝛿
=
𝛿
𝜀
id ⊗
𝛿
id
𝜀⊗
=
𝑠
⊗
𝛿
𝑡
𝛿
=
The associated variety is the category of CR categories and CR functors.

20
IVAN DI LIBERTI, FOSCO LOREGIAN, CHAD NESTER, AND PAWEL SOBOCIŃSKI
Example 6.7 (Discrete Cartesian Restriction Categories). 3.11 makes it easy to capture DCR
categories by extending Example 6.6 with 𝜇: 𝑂→𝐴satisfying the Frobenius and special equations:
there is a
𝜇
𝑂
𝐴such that
𝜇
𝑂
𝑂
=
𝜇
𝑠
𝑂
𝑂
⊗
𝑂
𝑂
=
𝜇
𝑡
𝑂
𝑂
𝑂
𝑂
=
𝛿
𝜇
𝑂
𝐴=
id
𝑂
𝐴
𝜇
id
id
𝛿
⊗
⊗
𝑂
𝐴
𝛿
𝜇
𝑂
𝐴
id
𝜇
𝛿
id
⊗
⊗
𝑂
𝐴
=
=
The variety is the category of strict DRC categories and strict CR functors (since they preserve 𝜇).
Example 6.8 (Cartesian Categories). To capture cartesian categories instead, we can extend
Example 6.6 with one equation, ensuring that 𝜀is natural:
𝑡
𝜀
𝐴
𝐴
𝑠
𝜀
𝐴
𝐴
=
Then by Theorem 2.22, this gives the variety of strict cartesian categories and strict cartesian
functors.
Example 6.9 (Cartesian Closed Categories). Finally, to capture cartesian closed categories we
extend Example 6.8 with an operator exp : 𝑂⊗𝑂→𝑂, the idea being that exp(𝐴, 𝐵) is the internal
hom [𝐴, 𝐵], along with an operator ev : 𝑂⊗𝑂→𝑂that gives the corresponding evaluation map:
exp
𝑂
𝑂
𝑂:
exp
=
ev
𝑂
𝑂
𝐴:
ev
=
ev
𝑠
exp
⊗
=
ev
𝑡
=
along with an operation 𝜆and equations stating, intuitively, that 𝜆(𝑋, 𝐴, 𝐵, 𝑓) is deﬁned precisely
in case 𝑓: 𝑋× 𝐴→𝐵, and yields a map 𝜆(𝑋, 𝐴, 𝐵, 𝑓) : 𝑋→[𝐴, 𝐵] as in:
𝜆
𝐴
𝑂
𝑂
𝑂
𝐴
𝜆
⊗
𝑠
𝑡
=
𝜆
𝑠
=
𝜆
𝑡
exp
=

FUNCTORIAL SEMANTICS FOR PARTIAL THEORIES
21
also equations insisting that if 𝑓: 𝑋× 𝐴→𝐵then (𝜆(𝑋, 𝐴, 𝐵, 𝑓) × 1) # ev = 𝑓holds:
id
𝜆
ev
⊗
=
⊗
𝑠
𝑡
and that if 𝑔: 𝑋→[𝐴, 𝐵] then 𝜆(𝑋, 𝐴, 𝐵, (𝑔× 1) # ev) = 𝑔holds:
exp
𝑠
𝑡
=
id
ev
⊗
𝜆
Now the associated variety is the category of strict cartesian closed categories and strict carte-
sian closed functors: these preserve hom-objects and, when 𝜆(𝑋, 𝐴, 𝐵, 𝑓) is deﬁned, satisfy
𝐹𝜆(𝑋, 𝐴, 𝐵, 𝑓) = 𝜆(𝐹𝑋, 𝐹𝐴, 𝐹𝐵, 𝐹𝑓). This presentation of cartesian closed categories is essen-
tially due to Freyd: a version of it is given immediately after the ﬁrst appearance of the notion of
essentially algebraic theory in [Fre72], albeit somewhat informally, and using very diﬀerent syntax.
7. The Variety Theorem for Partial Theories
Here we classify the categories of models of partial Lawvere theories. These turn out to be exactly
the locally ﬁnitely presentable (LFP) categories [AR94, 1A]. LFP categories have an important
position in categorical algebra, due to deep connections with model theory [AR94, Ch. 5] and
[MP89], homotopy theory [Dug01], and universal algebra [AR94, Ch. 3].
Deﬁnition 7.1. In a category C, an object 𝐶is ﬁnitely presentable if the hom-functor C(𝐶,
)
preserves directed colimits (see [AR94, 1.1] for the deﬁnition).
This notion might appear obscure to the reader unfamiliar with categorical logic; [AR94, 1.2]
contains lots of examples to help the reader build their intuition: for instance, an object of the
category of sets is ﬁnitely presentable if and only if it is ﬁnite, and a (commutative) monoid is
ﬁnitely presentable if and only if it admits a presentation ⟨𝐺| 𝑅⟩where both 𝐺(set of generators)
and 𝑅(set of relations) are ﬁnite sets: this happens for many other algebraic structures, and thus
motivates the deﬁnition.
Deﬁnition 7.2 (Locally ﬁnitely presentable category). [AR94, Def. 1.9] A locally ﬁnitely presentable
(LFP) category K is a cocomplete category s.t. there is a small full subcategory A ⊂K of ﬁnitely
presentable objects, and such that every object of K is a directed colimit of objects of A.
As in the classical case (Remark 2.30), the most crisp statement of the variety theorem is for the
unsorted case. Just as an unsorted Lawvere theory is exactly a (small) cartesian category, we deﬁne
an unsorted partial Lawvere theory to be a (small) DCR category, and the corresponding notion of
morphism to be a CR functor. Then:
Categories of models of partial theories are exactly LFP categories.

22
IVAN DI LIBERTI, FOSCO LOREGIAN, CHAD NESTER, AND PAWEL SOBOCIŃSKI
Indeed, we have a similar contravariant adjunction to that of Theorem 2.35, if LFP is a 2-category
having 1-cells 𝑅: K →K′ the right adjoint functors 𝑅preserving directed colimits, and 2-cells all
natural transformations 𝛼: 𝑅⇒𝑅′. A motivation for this apparently peculiar choice of 1-cells can
be found in our Observation 2.31; it is exactly as our Deﬁnition 2.34, provided one replaces “sifted”
colimit with “directed”.
Theorem 7.3. There is a 2-adjunction
(4)
Th : LFP ⇆(DCRC≤)op : Mod,
where DCRC≤is the 2-category of DCR categories of our Deﬁnition 3.13 and LFP is the 2-category
of LFP categories. Moreover, the unit of this adjunction is an equivalence, namely there is a
natural equivalence of categories between K ∈LFP and Mod(Th(K)), i.e. each LFP category is
equivalent to the category of models of its induced theory.
The proof of Theorem 7.3 is split into two parts, as illustrated below:
(5)
(DCRC≤)op
(Lex)op
LFP
1
2
1) we show that Lex –the 2-category of categories A with ﬁnite limits, functors A →A′
preserving ﬁnite limits, and natural transformations– is reﬂective in the 2-category DCRC≤.
This is the original, technical core of Theorem 7.3.
2) we connect Lexop and LFP with a contravariant biequivalence of 2-categories. This is a
classical result called Gabriel-Ulmer duality.
Composing the two, we obtain Theorem 7.3.
We will start from the ﬁrst of the two tasks, providing an adjunction of 2-categories as follows.
𝐾𝑡: DCRC≤⇆Lex : Par
We ﬁrst describe the left adjoint 𝐾𝑡, then the right adjoint Par, and conclude by showing that
they deﬁne an adjunction.
Splitting Domain Idempotents. The functor 𝐾𝑡arises via a modiﬁed Karoubi envelope, also called
Cauchy completion in [BD86]. Recall that an idempotent 𝑎: 𝐴→𝐴in a category splits if there is
a commutative diagram
𝑋
𝐴
𝑋
𝐴
𝑠
𝑠
1𝑋
𝑟
𝑎
Restriction categories in which all of the domain idempotents split are called split restriction
categories. An example is Par(C): for any arrow (𝑚, 𝑓) : 𝐴→𝐵, (𝑚, 𝑓) = (𝑚, 𝑚) : 𝐴→𝐴
splits with 𝑠= (1, 𝑚) and 𝑟= (𝑚, 1). Notice that this means the domain of deﬁnition of (𝑚, 𝑓) is a
subobject of 𝐴. This is a good way to think of split domain idempotents in general: for 𝑓to be split
in a restriction category is for the domain of deﬁnition of 𝑓: 𝐴→𝐵to be a subobject of 𝐴.
For any restriction category X we can construct a split restriction category 𝐾(X) that contains X
as a subcategory. Its subcategory of total maps 𝐾𝑡(X) is of particular interest.
Deﬁnition 7.4. Let X be a DCRC. Then 𝐾𝑡(X) is the category where
1) objects are pairs (𝐴, 𝑎) with 𝐴an object of X and 𝑎: 𝐴→𝐴a domain idempotent in X;
2) arrows 𝑓: (𝐴, 𝑎) →(𝐵, 𝑏) are arrows 𝑓: 𝐴→𝐵of X such that 𝑓= 𝑎and 𝑓# 𝑏= 𝑓;
3) composition is given by composition in X;

FUNCTORIAL SEMANTICS FOR PARTIAL THEORIES
23
4) The identity on (𝐴, 𝑎) is given by 𝑎.
It is routine to verify that this forms a category. Crucially, if X is a DCRC, then the subcategory
𝐾𝑡(X) of total maps of 𝐾(X) has ﬁnite limits [CGH12]:
Lemma 7.5. For any DCRC X, 𝐾𝑡(X) has ﬁnite limits.
We now show that this extends to a 2-functor 𝐾𝑡: DCRC≤→Lex. If X and Y are DCRCs
and 𝐹: X →Y is a CR functor, then there is a functor 𝐾𝑡(𝐹) : 𝐾𝑡(X) →𝐾𝑡(Y ) deﬁned
by 𝐾𝑡(𝐹)(𝐴, 𝑎) = (𝐹𝐴, 𝐹𝑎) on objects and 𝐾𝑡(𝐹)( 𝑓) = 𝑓on arrows.
It follows from our
characterization of CR functors in terms of the partial Frobenius algebra structure that 𝐾𝑡(𝐹)
preserves ﬁnite limits, giving the action of our 2-functor 𝐾𝑡on 1-cells. The action of 𝐾𝑡on 2-cells
is given as follows:
Lemma 7.6. If 𝐹, 𝐺: X →Y are CR functors between DCR categories and 𝛼: 𝐹→𝐺is a lax
transformation, deﬁne 𝐾𝑡(𝛼) : 𝐾𝑡(𝐹) →𝐾𝑡(𝐺) by letting 𝐾𝑡(𝛼) at (𝐴, 𝑎) in 𝐾𝑡(X) be:
𝐾𝑡(𝛼)(𝐴,𝑎) = 𝐹𝑎# 𝛼𝐴: (𝐹𝐴, 𝐹𝑎) →(𝐺𝐴, 𝐺𝑎)
Then 𝐾𝑡(𝛼) is a natural transformation.
At this point we need only show that 𝐾𝑡preserves composition and identities for 1-cells and
2-cells, which in both cases is straightforward.
Lemma 7.7. 𝐾𝑡: DCRC≤→Lex is a 2-functor.
Partial Functions Revisited. Here we show that the Par construction (§3.1) also extends to a 2-functor
Par : Lex →DCRC≤. If C and D are categories with ﬁnite limits and 𝐹: C →D is a ﬁnite-limit
preserving functor, then we obtain a CR functor Par(𝐹) : Par(C) →Par(D), deﬁned on objects by
Par(𝐹)(𝐴) = 𝐹(𝐴), and on arrows by
𝑋
𝐴
𝐵
𝑚
𝑓
Par(𝐹)
↦−→
𝐹𝑋
𝐹𝐴
𝐹𝐵
𝐹𝑚
𝐹𝑓
Since 𝐹preserves ﬁnite limits, we have that Par(𝐹)(𝛿𝐴) = (𝐹1𝐴, 𝐹Δ𝐴) = (1𝐹𝐴, Δ𝐹𝐴) = 𝛿𝐹𝐴=
𝛿Par(𝐹) (𝐴) and Par(𝐹)(𝜀𝐴) = (𝐹1𝐴, 𝐹!𝐴) = (1𝐹𝐴, !𝐹𝐴) = 𝜀Par(𝐹) (𝐴), so Par(𝐹) preserves the CR
structure. This deﬁnes the action of Par on 1-cells. We present the action of Par on 2-cells as a
lemma:
Lemma 7.8. If 𝐹, 𝐺: C →D are ﬁnite limit preserving functors between categories with ﬁnite
limits and 𝛼: 𝐹→𝐺is a natural transformation, deﬁne Par(𝛼) : Par(𝐹) →Par(𝐺) by deﬁning
the component of Par(𝛼) at 𝐴in C to be:
𝐹𝐴
𝐹𝐴
𝐺𝐴
Par(𝛼)𝐴
1𝐹𝐴
𝛼𝐴
Then Par(𝛼) : Par(𝐹) →Par(𝐺) is a lax transformation.
It remains only show that Par preserves composition and identities at the level of 1-cells and
2-cells, which is immediate in both cases. We therefore have:
Lemma 7.9. Par : Lex →DCRC≤is a 2-functor.

24
IVAN DI LIBERTI, FOSCO LOREGIAN, CHAD NESTER, AND PAWEL SOBOCIŃSKI
Adjointness. The following result is original, and builds on [CL02, Corollary 3.5]; however, there
the 2-cells of the categories involved are diﬀerent.
Theorem 7.10. There is a 2-adjunction 𝐾𝑡: DCRC≤⇆Lex : Par.
It is worth describing the unit and counit of our adjunction. The unit 𝜂: 1 →Par · 𝐾𝑡is given by
the canonical inclusion 𝜂X : X →Par(𝐾𝑡(X)) deﬁned by
𝐴
𝑓→𝐵
𝜂X
↦−→
(𝐴, 𝑓)
(𝐴, 1𝐴)
(𝐵, 1𝐵)
𝑓
𝑓
The counit 𝜀: 𝐾𝑡· Par →1 is deﬁned in terms of the equivalence of categories 𝐾(X) ≃X between
any split restriction category X and the result of formally splitting its domain idempotents. In
particular, since Par(C) is always split, we obtain an equivalence of categories 𝐾(Par(C)) ≃Par(C).
Restricting this to the subcategories of total maps gives deﬁnes our counit 𝜀C : 𝐾𝑡(Par(C)) ≃C.
In particular, the fact that the counit is a natural equivalence gives:
Lemma 7.11. Lex is a reﬂective (2-)subcategory of DCRC≤.
Gabriel-Ulmer duality. To complete the triangle (5), we recall a theorem ﬁrst shown by P. Gabriel
and F. Ulmer [GU71], establishing a contravariant equivalence between the 2-category LFP of
locally ﬁnitely presentable categories and the 2-category Lex of categories with ﬁnite limits.
The duality asserts that a locally ﬁnitely presentable category K can be reconstructed from its
subcategory K𝜔of ﬁnitely presentable objects. A good reference for the proof is [CV02, Th. 3.1].
Theorem 7.12 (Gabriel-Ulmer duality). There is a biequivalence of 2-categories
Lexop ⇆LFP
between Lex, the 2-category of small categories with ﬁnite limits, where 1-cells are functors
preserving ﬁnite limits and 2-cells are the natural transformations, and LFP, the 2-category of
locally ﬁnitely presentable categories, where 1-cells are right adjoints preserving directed colimits.
7.1. Sorted Gabriel-Ulmer duality. A similar version of the above theorem holds if, instead of
considering theories of all possible sorts, we ﬁx once and for all a single cardinality for the sorts 𝔖.
Such “relative” version of Gabriel-Ulmer duality is useful to recover the classical Lawvere-style
approach of single- and many-sorted theories.
Deﬁnition 7.13. We call 𝐿𝔖the free category with ﬁnite limits over the discrete set 𝔖. When 𝔖is
the singleton we will use the shortened notation 𝐿1.
Deﬁnition 7.14. A 𝔖-sorted category with ﬁnite limits (A, 𝑝) is an object in (Lex)op/𝐿𝔖whose
specifying functor 𝑝: 𝐿𝔖→A is bĳective on objects. (𝔖-Lex)op is the full 2-subcategory of
𝔖-sorted categories with ﬁnite limits.
Deﬁnition 7.15. A𝔖-sorted locally ﬁnitely presentable category (K,𝑈) is an object in LFP/[𝔖, Set]
whose specifying functor 𝑈: K →[𝔖, Set] is conservative. (𝔖-LFP)op is the full 2-subcategory
of 𝔖-sorted locally ﬁnitely presentable categories.
Theorem 7.16 (Sorted Gabriel-Ulmer duality). There is a biequivalence of 2-categories
Mod𝔖: (𝔖-Lex)op ⇆𝔖-LFP : Th𝔖.

FUNCTORIAL SEMANTICS FOR PARTIAL THEORIES
25
7.1.1. Sorted partial variety theorem. We can use the sorted version of Gabriel-Ulmer duality to
infer the sorted version of the syntax-semantics duality for multi-sorted partial Lawvere theories.
Theorem 7.17. There is an 2-adjunction, whose unit is an equivalence,
𝔖-LFP ⇆(𝔖-pLaw)op,
where 𝔖-pLaw is the 2-category of “𝔖-sorted partial Lawvere theories”, understood as the analogue
of Remark 2.30 for partial theories (see Deﬁnition 4.5), and 𝔖-LFP is the 2-category of 𝔖-sorted
locally ﬁnitely presentable categories.
Sketch of proof. The proof is divided into intermediate steps: each tag on the following two
diagrams indicates the section where the proof of the adjunction, or equivalence, is given.
(𝔖-pLaw)op
(𝔖-Lex)op
(DCRC≤)op
(Lex)op
𝔖-LFP
LFP
★
7.10
7.16
7.12
The claim in (★) is the only one that needs to be proven. Yet it is also the most trivial one. We will
deduce it directly from 7.10. Indeed if Lex is reﬂective in DCRC≤, (Lex)op/𝐿𝔖is coreﬂective in
(DCRC≤)op/Par(𝐿𝔖), now observe that Par(𝐿𝔖) is precisely the free discrete cartesian restriction
category over 𝔖. The desired result follows passing to functors bĳective on objects in the slice.
□
Observation 7.18. In analogy with 2.33, we can show that sorted partial Lawvere theories have
free models. For the single-sorted case, let 𝑝: Par(F op) →L be a partial Lawvere theory. Indeed
we can look at it as a morphism in DCRC≤, then the previous theorem produces an adjunction
𝐹⊣Mod𝑝
𝐹: ModPar(F op) ⇆ModL : Mod𝑝.
The functor Mod𝑝coincides with the forgetful functor. Its left adjoint 𝐹provides free objects.
8. Conclusions and future work
We introduced partial Lawvere theories and their associated notion of partial equational theory.
Our deﬁnitions are guided by the appropriate universal property, replacing cartesian categories
with discrete cartesian restriction categories. Knowing the right universal property determines our
choice of syntax, isolating the correct class of string diagrams that replace classical terms. This
enables the standard methodology of presenting a theory by means of a signature and equations,
while avoiding ad-hoc notations and eliminating the subtleties of reasoning about partial structures.
The extension is conservative: every equational theory yields a partial equational theory such
that the categories of models coincide, even though our models are in Par rather than in Set.
The recently proposed Frobenius theories [BPS17] take their models in the category of relations
Rel, and are guided by the structure of cartesian bicategories of relations [CW87]. Every partial
equational theory yields a Frobenius theory and again, the categories of models coincide. We feel
that our notion is a sweet-spot. First, we have shown that our notion of partial theories is expressive,
capturing a number of important examples. Second, we retain much of the richness of the semantic
picture, via a canonical variety theorem and existence of free models.
There is much future work. The fact that the syntax introduced here is inherently partial makes it
well-suited to applications in computing. In particular there is an evident notion of computable
model for partial Lawvere theories, namely those models valued in the category of sets and partial
recursive functions. The corresponding computable varieties seem to be interesting for programming
language semantics, and therefore worthy of study. A further step would be the lifting of this

26
IVAN DI LIBERTI, FOSCO LOREGIAN, CHAD NESTER, AND PAWEL SOBOCIŃSKI
situation to a more synthetic category of computable functions, such as a Turing category [CH08]
or monoidal computer [Pav13].
An important part of categorical universal algebra is played by monads, a point of view that we
have not considered here. Indeed, Lawvere theories can be seen as ﬁnitary monads [Lin66], with the
category of algebras giving the associated variety. This connection has been a fruitful one, relating
areas of research that are, on the surface, very diﬀerent, see e.g. [Che20, LV12, MSS02]. A natural
question is whether there is an analogous approach for partial algebraic theories. We conjecture that
there is, with certain formal monads [Str72] in the 2-category DCRC≤playing the role of ﬁnitary
monads. We expect that other constructions of categorical universal algebra (e.g. [Fre66, Pow06])
will have corresponding partial accounts.
References
[ALR03] J. Adámek, F.W. Lawvere, and J. Rosick`y, On the duality between varieties and algebraic theories, Algebra
universalis 49 (2003), no. 1, 35–49.
[AR94]
J. Adamek and J. Rosick`y, Locally presentable and accessible categories, London Mathematical Society
Lecture Note Series, Cambridge University Press, 1994.
[ARV11] J. Adámek, J. Rosick`y, and E.M. Vitale, Algebraic theories, Cambridge Tracts in Mathematics 184 (2011), 1.
[BD86]
F. Borceux and D. Dejean, Cauchy completion in category theory, Cahiers de Topologie et Géométrie
Diﬀérentielle Catégoriques 27 (1986), no. 2, 133–146.
[BÉ93]
S. L. Bloom and Z. Ésik, Iteration theories: The equational logic of iterative processes, 1993.
[Bet88]
I. Bethke, Notes on partial combinatory algebras, Ph.D. thesis, Universiteit von Amsterdam, 1988.
[Bir35]
G. Birkhoﬀ, On the structure of abstract algebras, Mathematical proceedings of the Cambridge philosophical
society, vol. 31, Cambridge University Press, 1935, pp. 433–454.
[BPS17]
F. Bonchi, D. Pavlovic, and P. Sobocinski, Functorial semantics for relational theories, arXiv preprint
arXiv:1711.08699 (2017).
[BSZ18] F. Bonchi, P. Sobociński, and F. Zanasi, Deconstructing Lawvere with distributive laws, Journal of Logical
and Algebraic Methods in Programming 95 (2018), 128–146.
[Car91]
A. Carboni, Matrices, relations, and group representations, Journal of Algebra 136 (1991), no. 2, 497–529.
[CD08]
B. Coecke and R. Duncan, Interacting quantum observables, ICALP‘08, 2008, pp. 298–310.
[Cen04]
C. Centazzo, Generalised algebraic models, Generalised algebraic models, Presses universitaires de Louvain,
2004.
[CGH12] J.R.B. Cockett, X. Guo, and J.W Hofstra, P, Range categories II: towards regularity, Theory and Applications
of Categories 26 (2012), 453–500.
[CH08]
J.R.B. Cockett and P.J.W. Hofstra, Introduction to Turing categories, Annals of Pure and Applied Logic 156
(2008), 183–209.
[Che20]
E. Cheng, Distributive laws for Lawvere theories, Compositionality 2 (2020), 1.
[CL02]
J.R.B. Cockett and S. Lack, Restriction categories I: categories of partial maps, Theoretical Computer Science
270 (2002), 223–259.
[CL07]
J.R.B. Cockett and S. Lack, Restriction categories III: colimits, partial limits, and extensivity, Mathematical
Structures in Computer Science 17 (2007), 775–817.
[CO89]
P.L. Curien and A. Obtułowicz, Partiality, cartesian closedness, and toposes, Information and Computation
80 (1989), 50–95.
[CV02]
C. Centazzo and E.M. Vitale, A duality relative to a limit doctrine, Theory and Applications of Categories 10
(2002), 486–497.
[CW87]
A. Carboni and R.F.C. Walters, Cartesian bicategories I, Journal of Pure and Applied Algebra 49 (1987),
11–32.
[Dug01]
D. Dugger, Combinatorial model categories have presentations, Advances in Mathematics 164 (2001), no. 1,
177–201.
[Fox76]
T. Fox, Coalgebras and cartesian categories, Communications in Algebra 4 (1976), 665–667.
[Fre66]
P. Freyd, Algebra valued functors in general and tensor products in particular, Colloquium mathematicum,
vol. 14, Institute of Mathematics Polish Academy of Sciences, 1966, pp. 89–106.
[Fre72]
, Aspects of topoi, Bulletin of the Australian Mathematical Society 7 (1972), no. 1, 1–76.
[FS90]
P.J. Freyd and A. Scedrov, Categories, allegories, North-Holland, 1990.
[Gil14]
B. Giles, An investigation of some theoretical aspects of reversible computing, Ph.D. thesis, The University of
Calgary, 2014.

FUNCTORIAL SEMANTICS FOR PARTIAL THEORIES
27
[GU71]
P. Gabriel and F. Ulmer, Lokal präsentierbare Kategorien, Lecture Notes in Mathematics, Vol. 221, Springer-
Verlag, Berlin, 1971.
[HP07]
M. Hyland and J. Power, The category theoretic understanding of universal algebra: Lawvere theories and
monads, Electronic Notes in Theoretical Computer Science 172 (2007), 437–458.
[Koc03]
J. Kock, Frobenius algebras and 2D topological quantum ﬁeld theories, Cambridge University Press, 2003.
[Lac04]
S. Lack, Composing PROPs, Theory and Applications of Categories 13 (2004), no. 9, 147–163.
[Law63]
F.W. Lawvere, Functorial semantics of algebraic theories, Proceedings of the National Academy of Sciences
of the United States of America 50 (1963), no. 5, 869.
[Lin66]
F.E.J. Linton, Some aspects of equational categories, Proceedings of the Conference on Categorical Algebra
(Berlin, Heidelberg) (S. Eilenberg, D. K. Harrison, S. MacLane, and H. Röhrl, eds.), Springer Berlin Heidelberg,
1966, pp. 84–94.
[LV12]
J.-L. Loday and B. Vallette, Algebraic operads, Grundlehren der Mathematischen Wissenschaften [Fundamental
Principles of Mathematical Sciences], vol. 346, Springer, Heidelberg, 2012.
[ML65]
S. Mac Lane, Categorical algebra, Bulletin of the American Mathematical Society 71 (1965), no. 1, 40–106.
[MP89]
M. Makkai and R. Paré, Accessible categories: the foundations of categorical model theory, Contemporary
Mathematics, vol. 104, American Mathematical Society, Providence, RI, 1989.
[MSS02] M. Markl, S. Shnider, and J. Stasheﬀ, Operads in algebra, topology and physics, Mathematical Surveys and
Monographs, vol. 96, American Mathematical Society, Providence, RI, 2002.
[Pal09]
E. Palmgren, Constructivist and structuralist foundations: Bishop’s and Lawvere’s theories of sets, 2009.
[Pav13]
D. Pavlovic, Monoidal computer I: Basic computability by string diagrams, Information and Computation 226
(2013), 94–116.
[Pow06]
J. Power, Countable Lawvere theories and computational eﬀects, Electronic Notes in Theoretical Computer
Science 161 (2006), 59–71.
[PV07]
E. Palmgren and S.J. Vickers, Partial horn logic and cartesian categories, Annals of Pure and Applied Logic
145 (2007), 314–353.
[RR88]
E.P. Robinson and G. Rosolini, Categories of partial maps, Information and Computation 79 (1988), 94–130.
[Str72]
R. Street, The formal theory of monads, Journal of Pure and Applied Algebra 2 (1972), no. 2, 149–168.
Email address: diliberti.math@gmail.com
Institute of Mathematics,
Czech Academy of Sciences,
Prague, Czech Republic.
Email address: fosco.loregian@taltech.ee
Email address: chad.nester@taltech.ee
Email address: pawel.sobocinski@taltech.ee
Department of Software Science,
Tallinn University of Technology,
Tallinn, Estonia.

