Institute of Mathematical Statistics
LECTURE NOTES–MONOGRAPH SERIES
Volume 56
Pac-Bayesian Supervised
Classiﬁcation: The Thermodynamics
of Statistical Learning
Olivier Catoni
Institute of Mathematical Statistics
Beachwood, Ohio, USA

Institute of Mathematical Statistics
Lecture Notes–Monograph Series
Series Editor:
Anthony C. Davison
The production of the Institute of Mathematical Statistics
Lecture Notes–Monograph Series is managed by the
IMS Oﬃce: Rong Chen, Treasurer and
Elyse Gustafson, Executive Director.
Library of Congress Control Number: 2007939120
International Standard Book Number (10) 0-940600-72-2
International Standard Book Number (13) 978-0-940600-72-0
International Standard Serial Number 0749-2170
DOI: 10.1214/074921707000000391
Copyright c⃝2007 Institute of Mathematical Statistics
All rights reserved
Printed in the Lithuania

Contents
Preface .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
v
Introduction.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
vii
1. Inductive PAC-Bayesian learning .
.
.
.
.
.
.
.
.
.
.
.
1
1.1. Basic inequality .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
2
1.2. Non local bounds
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
5
1.2.1. Unbiased empirical bounds .
.
.
.
.
.
.
.
.
.
.
.
5
1.2.2. Optimizing explicitly the exponential parameter λ
.
.
.
8
1.2.3. Non random bounds
.
.
.
.
.
.
.
.
.
.
.
.
.
.
9
1.2.4. Deviation bounds
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
11
1.3. Local bounds .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
14
1.3.1. Choice of the prior
.
.
.
.
.
.
.
.
.
.
.
.
.
.
14
1.3.2. Unbiased local empirical bounds .
.
.
.
.
.
.
.
.
.
15
1.3.3. Non random local bounds
.
.
.
.
.
.
.
.
.
.
.
.
17
1.3.4. Local deviation bounds
.
.
.
.
.
.
.
.
.
.
.
.
.
18
1.3.5. Partially local bounds
.
.
.
.
.
.
.
.
.
.
.
.
.
22
1.3.6. Two step localization .
.
.
.
.
.
.
.
.
.
.
.
.
.
27
1.4. Relative bounds .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
33
1.4.1. Basic inequalities .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
34
1.4.2. Non random bounds
.
.
.
.
.
.
.
.
.
.
.
.
.
.
37
1.4.3. Unbiased empirical bounds .
.
.
.
.
.
.
.
.
.
.
.
40
1.4.4. Relative empirical deviation bounds
.
.
.
.
.
.
.
.
44
2. Comparing posterior distributions to Gibbs priors
.
.
.
.
51
2.1. Bounds relative to a Gibbs distribution .
.
.
.
.
.
.
.
.
51
2.1.1. Comparing a posterior distribution with a Gibbs prior .
.
52
2.1.2. The eﬀective temperature of a posterior distribution
.
.
55
2.1.3. Analysis of an empirical bound for the eﬀective temperature
56
2.1.4. Adaptation to parametric and margin assumptions
.
.
.
61
2.1.5. Estimating the divergence of a posterior with respect
to a Gibbs prior
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
67
2.2. Playing with two posterior and two local prior distributions
.
.
68
2.2.1. Comparing two posterior distributions
.
.
.
.
.
.
.
68
2.2.2. Elaborate uses of relative bounds between posteriors
.
.
70
2.2.3. Analysis of relative bounds
.
.
.
.
.
.
.
.
.
.
.
75
iii

iv
Contents
2.3. Two step localization.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
89
2.3.1. Two step localization of bounds relative to a Gibbs prior .
89
2.3.2. Analysis of two step bounds relative to a Gibbs prior
.
.
96
2.3.3. Two step localization between posterior distributions
.
.
101
3. Transductive PAC-Bayesian learning .
.
.
.
.
.
.
.
.
.
111
3.1. Basic inequalities
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
111
3.1.1. The transductive setting
.
.
.
.
.
.
.
.
.
.
.
.
111
3.1.2. Absolute bound .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
113
3.1.3. Relative bounds .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
114
3.2. Vapnik bounds for transductive classification
.
.
.
.
.
.
115
3.2.1. With a shadow sample of arbitrary size
.
.
.
.
.
.
.
115
3.2.2. When the shadow sample has the same size as the
training sample .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
118
3.2.3. When moreover the distribution of the augmented sam-
ple is exchangeable
.
.
.
.
.
.
.
.
.
.
.
.
.
.
119
3.3. Vapnik bounds for inductive classification .
.
.
.
.
.
.
.
121
3.3.1. Arbitrary shadow sample size .
.
.
.
.
.
.
.
.
.
.
121
3.3.2. A better minimization with respect to the exponential
parameter .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
123
3.3.3. Equal shadow and training sample sizes .
.
.
.
.
.
.
125
3.3.4. Improvement on the equal sample size bound in the i.i.d. case
125
3.4. Gaussian approximation in Vapnik bounds
.
.
.
.
.
.
.
.
127
3.4.1. Gaussian upper bounds of variance terms
.
.
.
.
.
.
127
3.4.2. Arbitrary shadow sample size .
.
.
.
.
.
.
.
.
.
.
128
3.4.3. Equal sample sizes in the i.i.d. case
.
.
.
.
.
.
.
.
128
4. Support Vector Machines .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
131
4.1. How to build them .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
131
4.1.1. The canonical hyperplane
.
.
.
.
.
.
.
.
.
.
.
.
131
4.1.2. Computation of the canonical hyperplane
.
.
.
.
.
.
132
4.1.3. Support vectors .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
134
4.1.4. The non-separable case .
.
.
.
.
.
.
.
.
.
.
.
.
134
4.1.5. Support Vector Machines
.
.
.
.
.
.
.
.
.
.
.
.
138
4.1.6. Building kernels
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
140
4.2. Bounds for Support Vector Machines
.
.
.
.
.
.
.
.
.
142
4.2.1. Compression scheme bounds
.
.
.
.
.
.
.
.
.
.
.
142
4.2.2. The Vapnik–Cervonenkis dimension of a family of subsets
143
4.2.3. Vapnik–Cervonenkis dimension of linear rules with margin
145
4.2.4. Application to Support Vector Machines .
.
.
.
.
.
.
148
4.2.5. Inductive margin bounds
.
.
.
.
.
.
.
.
.
.
.
.
149
Appendix: Classification by thresholding
.
.
.
.
.
.
.
.
.
155
5.1. Description of the model
.
.
.
.
.
.
.
.
.
.
.
.
.
.
155
5.2. Computation of inductive bounds
.
.
.
.
.
.
.
.
.
.
.
156
5.3. Transductive bounds .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
158
Bibliography.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
161

Preface
This monograph deals with adaptive supervised classiﬁcation, using tools bor-
rowed from statistical mechanics and information theory, stemming from the PAC-
Bayesian approach pioneered by David McAllester and applied to a conception of
statistical learning theory forged by Vladimir Vapnik. Using convex analysis on the
set of posterior probability measures, we show how to get local measures of the
complexity of the classiﬁcation model involving the relative entropy of posterior
distributions with respect to Gibbs posterior measures. We then discuss relative
bounds, comparing the generalization error of two classiﬁcation rules, showing how
the margin assumption of Mammen and Tsybakov can be replaced with some em-
pirical measure of the covariance structure of the classiﬁcation model. We show how
to associate to any posterior distribution an eﬀective temperature relating it to the
Gibbs prior distribution with the same level of expected error rate, and how to esti-
mate this eﬀective temperature from data, resulting in an estimator whose expected
error rate converges according to the best possible power of the sample size adap-
tively under any margin and parametric complexity assumptions. We describe and
study an alternative selection scheme based on relative bounds between estimators,
and present a two step localization technique which can handle the selection of a
parametric model from a family of those. We show how to extend systematically
all the results obtained in the inductive setting to transductive learning, and use
this to improve Vapnik’s generalization bounds, extending them to the case when
the sample is made of independent non-identically distributed pairs of patterns and
labels. Finally we review brieﬂy the construction of Support Vector Machines and
show how to derive generalization bounds for them, measuring the complexity ei-
ther through the number of support vectors or through the value of the transductive
or inductive margin.
Olivier Catoni
CNRS – Laboratoire de Probabilit´es et Mod`eles Al´eatoires, Universit´e Paris 6
(site Chevaleret), 4 place Jussieu – Case 188, 75 252 Paris Cedex 05.
v

to my son Nicolas

Introduction
Among the possible approaches to pattern recognition, statistical learning theory
has received a lot of attention in the last few years. Although a realistic pattern
recognition scheme involves data pre-processing and post-processing that need a
theory of their own, a central role is often played by some kind of supervised learning
algorithm. This central building block is the subject we are going to analyse in these
notes.
Accordingly, we assume that we have prepared in some way or another a sample
of N labelled patterns (Xi, Yi)N
i=1, where Xi ranges in some pattern space X and Yi
ranges in some ﬁnite label set Y. We also assume that we have devised our experi-
ment in such a way that the couples of random variables (Xi, Yi) are independent
(but not necessarily equidistributed). Here, randomness should be understood to
come from the way the statistician has planned his experiment. He may for in-
stance have drawn the Xis at random from some larger population of patterns the
algorithm is meant to be applied to in a second stage. The labels Yi may have
been set with the help of some external expertise (which may itself be faulty or
contain some amount of randomness, so we do not assume that Yi is a function of
Xi, and allow the couple of random variables (Xi, Yi) to follow any kind of joint
distribution). In practice, patterns will be extracted from some high dimensional
and highly structured data, such as digital images, speech signals, DNA sequences,
etc. We will not discuss this pre-processing stage here, although it poses crucial
problems dealing with segmentation and the choice of a representation. The aim
of supervised classiﬁcation is to choose some classiﬁcation rule f : X →Y which
predicts Y from X making as few mistakes as possible on average.
The choice of f will be driven by a suitable use of the information provided by the
sample (Xi, Yi)N
i=1 on the joint distribution of X and Y . Moreover, considering all
the possible measurable functions f from X to Y would not be feasible in practice
and maybe more importantly not well founded from a statistical point of view,
at least as soon as the pattern space X is large and little is known in advance
about the joint distribution of patterns X and labels Y . Therefore, we will consider
parametrized subsets of classiﬁcation rules {fθ : X →Y ; θ ∈Θm}, m ∈M, which
may be grouped to form a big parameter set Θ = 
m∈M Θm.
The subject of this monograph is to introduce to statistical learning theory, and
more precisely to the theory of supervised classiﬁcation, a number of technical tools
akin to statistical mechanics and information theory, dealing with the concepts of
entropy and temperature. A central task will in particular be to control the mutual
information between an estimated parameter and the observed sample. The focus
will not be directly on the description of the data to be classiﬁed, but on the de-
scription of the classiﬁcation rules. As we want to deal with high dimensional data,
we will be bound to consider high dimensional sets of candidate classiﬁcation rules,
and will analyse them with tools very similar to those used in statistical mechanics
vii

viii
Introduction
to describe particle systems with many degrees of freedom. More speciﬁcally, the
sets of classiﬁcation rules will be described by Gibbs measures deﬁned on parameter
sets and depending on the observed sample value. A Gibbs measure is the special
kind of probability measure used in statistical mechanics to describe the state of a
particle system driven by a given energy function at some given temperature. Here,
Gibbs measures will emerge as minimizers of the average loss value under entropy
(or mutual information) constraints. Entropy itself, more precisely the Kullback
divergence function between probability measures, will emerge in conjunction with
the use of exponential deviation inequalities: indeed, the log-Laplace transform may
be seen as the Legendre transform of the Kullback divergence function, as will be
stated in Lemma 1.1.3 (page 4).
To ﬁx notation, let (Xi, Yi)N
i=1 be the canonical process on Ω = (X × Y)N (which
means the coordinate process). Let the pattern space be provided with a sigma-
algebra B turning it into a measurable space (X, B). On the ﬁnite label space Y, we
will consider the trivial algebra B′ made of all its subsets. Let M1
+

(K × Y)N, (B ⊗
B′)⊗N
be our notation for the set of probability measures (i.e. of positive measures
of total mass equal to 1) on the measurable space

(X×Y)N, (B×B′)⊗N
. Once some
probability distribution P ∈M1
+

(X×Y)N, (B⊗B′)⊗N
is chosen, it turns (Xi, Yi)N
i=1
into the canonical realization of a stochastic process modelling the observed sample
(also called the training set). We will assume that P = N
i=1 Pi, where for each
i = 1, . . . , N, Pi ∈M1
+(X × Y, B ⊗B′), to reﬂect the assumption that we observe
independent pairs of patterns and labels. We will also assume that we are provided
with some indexed set of possible classiﬁcation rules
RΘ =

fθ : X →Y; θ ∈Θ

,
where (Θ, T) is some measurable index set. Assuming some indexation of the classi-
ﬁcation rules is just a matter of presentation. Although it leads to heavier notation,
it allows us to integrate over the space of classiﬁcation rules as well as over Ω, us-
ing the usual formalism of multiple integrals. For this matter, we will assume that
(θ, x) →fθ(x) : (Θ × X, B ⊗T) →(Y, B′) is a measurable function.
In many cases, as already mentioned, Θ = 
m∈M Θm will be a ﬁnite (or more
generally countable) union of subspaces, dividing the classiﬁcation model RΘ =

m∈M RΘm into a union of sub-models. The importance of introducing such a
structure has been put forward by V. Vapnik, as a way to avoid making strong
hypotheses on the distribution P of the sample. If neither the distribution of the
sample nor the set of classiﬁcation rules were constrained, it is well known that no
kind of statistical inference would be possible. Considering a family of sub-models is
a way to provide for adaptive classiﬁcation where the choice of the model depends on
the observed sample. Restricting the set of classiﬁcation rules is more realistic than
restricting the distribution of patterns, since the classiﬁcation rules are a processing
tool left to the choice of the statistician, whereas the distribution of the patterns
is not fully under his control, except for some planning of the learning experiment
which may enforce some weak properties like independence, but not the precise
shapes of the marginal distributions Pi which are as a rule unknown distributions
on some high dimensional space.
In these notes, we will concentrate on general issues concerned with a natural
measure of risk, namely the expected error rate of each classiﬁcation rule fθ, ex-
pressed as
(0.1)
R(θ) = 1
N
N

i=1
P

fθ(Xi) ̸= Yi

.

Introduction
ix
As this quantity is unobserved, we will be led to work with the corresponding
empirical error rate
(0.2)
r(θ, ω) = 1
N
N

i=1
1

fθ(Xi) ̸= Yi

.
This does not mean that practical learning algorithms will always try to minimize
this criterion. They often on the contrary try to minimize some other criterion which
is linked with the structure of the problem and has some nice additional properties
(like smoothness and convexity, for example). Nevertheless, and independently of
the precise form of the estimator 	θ : Ω →Θ under study, the analysis of R(	θ) is a
natural question, and often corresponds to what is required in practice.
Answering this question is not straightforward because, although R(θ) is the
expectation of r(θ), a sum of independent Bernoulli random variables, R(	θ) is not
the expectation of r(	θ), because of the dependence of 	θ on the sample, and neither
is r(	θ) a sum of independent random variables. To circumvent this unfortunate
situation, some uniform control over the deviations of r from R is needed.
We will follow the PAC-Bayesian approach to this problem, originated in the
machine learning community and pioneered by McAllester (1998, 1999). It can be
seen as some variant of the more classical approach of M-estimators relying on
empirical process theory — as described for instance in Van de Geer (2000).
It is built on some general principles:
• One idea is to embed the set of estimators of the type 	θ : Ω →Θ into the
larger set of regular conditional probability measures ρ :

Ω, (B ⊗B′)⊗N
→
M1
+(Θ, T). We will call these conditional probability measures posterior dis-
tributions, to follow standard terminology.
• A second idea is to measure the ﬂuctuations of ρ with respect to the sample,
using some prior distribution π ∈M1
+(Θ, T), and the Kullback divergence
function K(ρ, π). The expectation P

K(ρ, π)

measures the randomness of
ρ. The optimal choice of π would be P(ρ), resulting in a measure of the
randomness of ρ equal to the mutual information between the sample and the
estimated parameter drawn from ρ. Anyhow, since P(ρ) is usually not better
known than P, we will have to be content with some less concentrated prior
distribution π, resulting in some looser measure of randomness, as shown by
the identity P

K(ρ, π)

= P

K

ρ, P(ρ)

+ K

P(ρ), π

.
• A third idea is to analyse the ﬂuctuations of the random process θ →r(θ)
from its mean process θ →R(θ) through the log-Laplace transform
−1
λ log

exp

−λr(θ, ω)

π(dθ)P(dω)

,
as would be done in statistical mechanics, where this is called the free energy.
This transform is well suited to relate minθ∈Θ r(θ) to infθ∈Θ R(θ), since for
large enough values of the parameter λ, corresponding to low enough values
of the temperature, the system has small ﬂuctuations around its ground state.
• A fourth idea deals with localization. It consists of considering a prior dis-
tribution π depending on the unknown expected error rate function R. Thus
some central result of the theory will consist in an empirical upper bound for
K

ρ, πexp(−βR)

, where πexp(−βR), deﬁned by its density
d
dπ

πexp(−βR)

=
exp(−βR)
π

exp(−βR)
,

x
Introduction
is a Gibbs distribution built from a known prior distribution π ∈M1
+(Θ, T),
some inverse temperature parameter β ∈R+ and the expected error rate R.
This bound will in particular be used when ρ is a posterior Gibbs distribution,
of the form πexp(−βr). The general idea will be to show that in the case when
ρ is not too random, in the sense that it is possible to ﬁnd a prior (that
is non-random) distribution π such that K(ρ, π) is small, then ρ(r) can be
reliably taken for a good approximation of ρ(R).
This monograph is divided into four chapters. The ﬁrst deals with the inductive
setting presented in these lines. The second is devoted to relative bounds. It shows
that it is possible to obtain a tighter estimate of the mutual information between
the sample and the estimated parameter by comparing prior and posterior Gibbs
distributions. It shows how to use this idea to obtain adaptive model selection
schemes under very weak hypotheses.
The third chapter introduces the transductive setting of V. Vapnik (Vapnik,
1998), which consists in comparing the performance of classiﬁcation rules on the
learning sample with their performance on a test sample instead of their average
performance. The fourth one is a fast introduction to Support Vector Machines.
It is the occasion to show the implications of the general results discussed in the
three ﬁrst chapters when some particular choice is made about the structure of the
classiﬁcation rules.
In the ﬁrst chapter, two types of bounds are shown. Empirical bounds are useful
to build, compare and select estimators. Non random bounds are useful to assess the
speed of convergence of estimators, relating this speed to the behaviour of the Gibbs
prior expected error rate β →πexp(−βR)(R) and to covariance factors related to the
margin assumption of Mammen and Tsybakov when a ﬁner analysis is performed.
We will proceed from the most straightforward bounds towards more elaborate
ones, built to achieve a better asymptotic behaviour. In this course towards more
sophisticated inequalities, we will introduce local bounds and relative bounds.
The study of relative bounds is expanded in the third chapter, where tighter
comparisons between prior and posterior Gibbs distributions are proved. Theorems
2.1.3 (page 54) and 2.2.4 (page 72) present two ways of selecting some nearly opti-
mal classiﬁcation rule. They are both proved to be adaptive in all the parameters
under Mammen and Tsybakov margin assumptions and parametric complexity as-
sumptions. This is done in Corollary 2.1.17 (page 66) of Theorem 2.1.15 (page
65) and in Theorem 2.2.11 (page 88). In the ﬁrst approach, the performance of a
randomized estimator modelled by a posterior distribution is compared with the
performance of a prior Gibbs distribution. In the second approach posterior distri-
butions are directly compared between themselves (and leads to slightly stronger
results, to the price of using a more complex algorithm). When there are more than
one parametric model, it is appropriate to use also some doubly localized scheme:
two step localization is presented for both approaches, in Theorems 2.3.2 (page 93)
and 2.3.9 (page 107) and provides bounds with a decreased inﬂuence of the number
of empirically ineﬃcient models included in the selection scheme.
We would not like to induce the reader into thinking that the most sophisticated
results presented in these ﬁrst two chapters are necessarily the most useful ones,
they are as a rule only more eﬃcient asymptotically, whereas, being more involved,
they use looser constants leading to less precision for small sample sizes. In practice
whether a sample is to be considered small is a question of the ratio between the
number of examples and the complexity (roughly speaking the number of parame-
ters) of the model used for classiﬁcation. Since our aim here is to describe methods

Introduction
xi
appropriate for complex data (images, speech, DNA, . . . ), we suspect that practi-
tioners wanting to make use of our proposals will often be confronted with small
sample sizes; thus we would advise them to try the simplest bounds ﬁrst and only
afterwards see whether the asymptotically better ones can bring some improvement.
We would also like to point out that the results of the ﬁrst two chapters are not
of a purely theoretical nature: posterior parameter distributions can indeed be com-
puted eﬀectively, using Monte Carlo techniques, and there is well-established know-
how about these computations in Bayesian statistics. Moreover, non-randomized
estimators of the classical form 	θ : Ω →Θ can be eﬃciently approximated by pos-
terior distributions ρ : Ω →M1
+(Θ) supported by a fairly narrow neighbourhood
of 	θ, more precisely a neighbourhood of the size of the typical ﬂuctuations of 	θ, so
that this randomized approximation of 	θ will most of the time provide the same
classiﬁcation as 	θ itself, except for a small amount of dubious examples for which
the classiﬁcation provided by 	θ would anyway be unreliable. This is explained on
page 7.
As already mentioned, the third chapter is about the transductive setting, that
is about comparing the performance of estimators on a training set and on a test
set. We show ﬁrst that this comparison can be based on a set of exponential devi-
ation inequalities which parallels the one used in the inductive case. This gives the
opportunity to transport all the results obtained in the inductive case in a system-
atic way. In the transductive setting, the use of prior distributions can be extended
to the use of partially exchangeable posterior distributions depending on the union
of training and test patterns, bringing increased possibilities to adapt to the data
and giving rise to such crucial notions of complexity as the Vapnik–Cervonenkis
dimension.
Having done so, we more speciﬁcally focus on the small sample case, where local
and relative bounds are not expected to be of great help. Introducing a ﬁctitious
(that is unobserved) shadow sample, we study Vapnik-type generalization bounds,
showing how to tighten and extend them with some original ideas, like making no
Gaussian approximation to the log-Laplace transform of Bernoulli random vari-
ables, using a shadow sample of arbitrary size. shrinking from the use of any sym-
metrization trick, and using a suitable subset of the group of permutations to cover
the case of independent non-identically distributed data. The culminating result of
the third chapter is Theorem 3.3.3 (page 125), subsequent bounds showing the sep-
arate inﬂuence of the above ideas and providing an easier comparison with Vapnik’s
original results. Vapnik-type generalization bounds have a broad applicability, not
only through the concept of Vapnik–Cervonenkis dimension, but also through the
use of compression schemes (Little et al., 1986), which are brieﬂy described on page
117.
The beginning of the fourth chapter introduces Support Vector Machines, both
in the separable and in the non-separable case (using the box constraint). We then
describe diﬀerent types of bounds. We start with compression scheme bounds, to
proceed with margin bounds. We begin with transductive margin bounds, recalling
on this occasion in Theorem 4.2.2 (page 144) the growth bound for a family of
classiﬁcation rules with given Vapnik–Cervonenkis dimension. In Theorem 4.2.4
(page 145) we give the usual estimate of the Vapnik–Cervonenkis dimension of a
family of separating hyperplanes with a given transductive margin (we mean by
this that the margin is computed on the union of the training and test sets). We
present an original probabilistic proof inspired by a similar one from Cristianini et
al. (2000), whereas other proofs available usually rely on the informal claim that

xii
Introduction
the simplex is the worst case. We end this short review of Support Vector Machines
with a discussion of inductive margin bounds. Here the margin is computed on the
training set only, and a more involved combinatorial lemma, due to Alon et al.
(1997) and recalled in Lemma 4.2.6 (page 149) is used. We use this lemma and the
results of the third chapter to establish a bound depending on the margin of the
training set alone.
In appendix, we ﬁnally discuss the textbook example of classiﬁcation by thresh-
olding: in this setting, each classiﬁcation rule is built by thresholding a series of
measurements and taking a decision based on these thresholded values. This rel-
atively simple example (which can be considered as an introduction to the more
technical case of classiﬁcation trees) can be used to give more ﬂesh to the results
of the ﬁrst three chapters.
It is a pleasure to end this introduction with my greatest thanks to Anthony
Davison, for his careful reading of the manuscript and his numerous suggestions.

Chapter 1
Inductive PAC-Bayesian
learning
The setting of inductive inference (as opposed to transductive inference to be dis-
cussed later) is the one described in the introduction.
When we will have to take the expectation of a random variable Z : Ω →R as
well as of a function of the parameter h : Θ →R with respect to some probability
measure, we will as a rule use short functional notation instead of resorting to the
integral sign: thus we will write P(Z) for

Ω Z(ω)P(dω) and π(h) for

Θ h(θ)π(dθ).
A more traditional statistical approach would focus on estimators 	θ : Ω →Θ
of the parameter θ and be interested on the relationship between the empirical
error rate r(	θ), deﬁned by equation (0.1, page viii), which is the number of errors
made on the sample, and the expected error rate R(	θ), deﬁned by equation (0.2,
page ix), which is the expected probability of error on new instances of patterns.
The PAC-Bayesian approach instead chooses a broader perspective and allows the
estimator 	θ to be drawn at random using some auxiliary source of randomness to
smooth the dependence of 	θ on the sample. One way of representing the supple-
mentary randomness allowed in the choice of 	θ, is to consider what it is usual to
call posterior distributions on the parameter space, that is probability measures
ρ : Ω →M1
+(Θ, T), depending on the sample, or from a technical perspective,
regular conditional (or transition) probability measures. Let us recall that we use
the model described in the introduction: the training sample is modelled by the
canonical process (Xi, Yi)N
i=1 on Ω =

X × Y
N, and a product probability measure
P = N
i=1 Pi on Ω is considered to reﬂect the assumption that the training sam-
ple is made of independent pairs of patterns and labels. The transition probability
measure ρ, along with P ∈M1
+(Ω), deﬁnes a probability distribution on Ω × Θ and
describes the conditional distribution of the estimated parameter 	θ knowing the
sample (Xi, Yi)N
i=1.
The main subject of this broadened theory becomes to investigate the relation-
ship between ρ(r), the average error rate of 	θ on the training sample, and ρ(R), the
expected error rate of 	θ on new samples. The ﬁrst step towards using some kind
of thermodynamics to tackle this question, is to consider the Laplace transform
of ρ(R) −ρ(r), a well known provider of non-asymptotic deviation bounds. This
transform takes the form
P

exp

λ

ρ(R) −ρ(r)

,
1

2
Chapter 1.
Inductive PAC-Bayesian learning
where some inverse temperature parameter λ ∈R+, as a physicist would call it, is
introduced. This Laplace transform would be easy to bound if ρ did not depend on
ω ∈Ω (namely on the sample), because ρ(R) would then be non-random, and
ρ(r) = 1
N
N

i=1
ρ

Yi ̸= fθ(Xi)

,
would be a sum of independent random variables. It turns out, and this will be
the subject of the next section, that this annoying dependence of ρ on ω can be
quantiﬁed, using the inequality
ρ(R) −ρ(r) ≤λ−1 log

π

exp

λ(R −r)

+ λ−1K(ρ, π),
which holds for any probability measure π ∈M1
+(Θ) on the parameter space;
for our purpose it will be appropriate to consider a prior distribution π that is
non-random, as opposed to ρ, which depends on the sample. Here, K(ρ, π) is the
Kullback divergence of ρ from π, whose deﬁnition will be recalled when we will
come to technicalities; it can be seen as an upper bound for the mutual information
between the (Xi, Yi)N
i=1 and the estimated parameter 	θ . This inequality will allow
us to relate the penalized diﬀerence ρ(R) −ρ(r) −λ−1K(ρ, π) with the Laplace
transform of sums of independent random variables.
1.1. Basic inequality
Let us now come to the details of the investigation sketched above. The ﬁrst thing
we will do is to study the Laplace transform of R(θ) −r(θ), as a starting point for
the more general study of ρ(R) −ρ(r): it corresponds to the simple case where 	θ
is not random at all, and therefore where ρ is a Dirac mass at some deterministic
parameter value θ.
In the setting described in the introduction, let us consider the Bernoulli random
variables σi(θ) = 1

Yi ̸= fθ(Xi)

, which indicates whether the classiﬁcation rule fθ
made an error on the ith component of the training sample. Using independence
and the concavity of the logarithm function, it is readily seen that for any real
constant λ
log

P

exp

−λr(θ)

=
N

i=1
log

P

exp

−λ
N σi

≤N log
 1
N
N

i=1
P

exp

−λ
N σi

.
The right-hand side of this inequality is the log-Laplace transform of a Bernoulli
distribution with parameter
1
N
N
i=1 P(σi) = R(θ). As any Bernoulli distribution is
fully deﬁned by its parameter, this log-Laplace transform is necessarily a function
of R(θ). It can be expressed with the help of the family of functions
(1.1)
Φa(p) = −a−1 log

1 −

1 −exp(−a)

p

,
a ∈R, p ∈(0, 1).
It is immediately seen that Φa is an increasing one-to-one mapping of the unit
interval onto itself, and that it is convex when a > 0, concave when a < 0 and can

1.1.
Basic inequality
3
be deﬁned by continuity to be the identity when a = 0. Moreover the inverse of Φa
is given by the formula
Φ−1
a (q) = 1 −exp(−aq)
1 −exp(−a) ,
a ∈R, q ∈(0, 1).
This formula may be used to extend Φ−1
a
to q ∈R, and we will use this extension
without further notice when required.
Using this notation, the previous inequality becomes
log

P

exp

−λr(θ)

≤−λΦ λ
N

R(θ)

,
proving
Lemma 1.1.1. For any real constant λ and any parameter θ ∈Θ,
P

exp

λ

Φ λ
N

R(θ)

−r(θ)

≤1.
In previous versions of this study, we had used some Bernstein bound, instead
of this lemma. Anyhow, as it will turn out, keeping the log-Laplace transform of a
Bernoulli instead of approximating it provides simpler and tighter results.
Lemma 1.1.1 implies that for any constants λ ∈R+ and ϵ ∈)0, 1),
P

Φ λ
N

R(θ)

+ log(ϵ)
λ
≤r(θ)

≥1 −ϵ.
Choosing λ ∈arg max
R+ Φ λ
N

R(θ)

+ log(ϵ)
λ
, we deduce
Lemma 1.1.2. For any ϵ ∈)0, 1), any θ ∈Θ,
P

R(θ) ≤inf
λ∈R+ Φ−1
λ
N

r(θ) −log(ϵ)
λ

≥1 −ϵ.
We will illustrate throughout these notes the bounds we prove with a small
numerical example: in the case where N = 1000, ϵ = 0.01 and r(θ) = 0.2, we get
with a conﬁdence level of 0.99 that R(θ) ≤.2402, this being obtained for λ = 234.
Now, to proceed towards the analysis of posterior distributions, let us put Uλ(θ,
ω) = λ

Φ λ
N

R(θ)

−r(θ, ω)

for short, and let us consider some prior probability
distribution π ∈M1
+(Θ, T). A proper choice of π will be an important question,
underlying much of the material presented in this monograph, so for the time be-
ing, let us only say that we will let this choice be as open as possible by writing
inequalities which hold for any choice of π . Let us insist on the fact that when we
say that π is a prior distribution, we mean that it does not depend on the training
sample (Xi, Yi)N
i=1. The quantity of interest to obtain the bound we are looking for
is log

P

π

exp(Uλ)

. Using Fubini’s theorem for non-negative functions, we see
that
log

P

π

exp(Uλ)

= log

π

P

exp(Uλ)

≤0.
To relate this quantity to the expectation ρ(Uλ) with respect to any posterior
distribution ρ : Ω →M1
+(Θ), we will use the properties of the Kullback divergence

4
Chapter 1.
Inductive PAC-Bayesian learning
K(ρ, π) of ρ with respect to π, which is deﬁned as
K(ρ, π) =
⎧
⎪
⎨
⎪
⎩

log( dρ
dπ)dρ,
when ρ is absolutely continuous
with respect to π,
+∞,
otherwise.
The following lemma shows in which sense the Kullback divergence function can be
thought of as the dual of the log-Laplace transform.
Lemma 1.1.3.
For any bounded measurable function h : Θ →R, and any proba-
bility distribution ρ ∈M1
+(Θ) such that K(ρ, π) < ∞,
log

π

exp(h)

= ρ(h) −K(ρ, π) + K(ρ, πexp(h)),
where by deﬁnition dπexp(h)
dπ
= exp[h(θ)]
π[exp(h)]. Consequently
log

π

exp(h)]

=
sup
ρ∈M1
+(Θ)
ρ(h) −K(ρ, π).
The proof is just a matter of writing down the deﬁnition of the quantities involved
and using the fact that the Kullback divergence function is non-negative, and can
be found in Catoni (2004, page 160). In the duality between measurable functions
and probability measures, we thus see that the log-Laplace transform with respect
to π is the Legendre transform of the Kullback divergence function with respect to
π. Using this, we get
P

exp

sup
ρ∈M1
+(Θ)
ρ[Uλ(θ)] −K(ρ, π)

≤1,
which, combined with the convexity of λΦ λ
N , proves the basic inequality we were
looking for.
Theorem 1.1.4. For any real constant λ,
P

exp

sup
ρ∈M1
+(Θ)
λ

Φ λ
N

ρ(R)

−ρ(r)

−K(ρ, π)

≤P

exp

sup
ρ∈M1
+(Θ)
λ

ρ

Φ λ
N ◦R

−ρ(r)

−K(ρ, π)

≤1.
We insist on the fact that in this theorem, we take a supremum in ρ ∈M1
+(Θ)
inside the expectation with respect to P, the sample distribution. This means that
the proved inequality holds for any ρ depending on the training sample, that is for
any posterior distribution: indeed, measurability questions set aside,
P

exp

sup
ρ∈M1
+(Θ)
λ

ρ

Uλ(θ)

−K(ρ, π)

=
sup
ρ:Ω→M1
+(Θ)
P

exp

λ

ρ

Uλ(θ)

−K(ρ, π)

,

1.2.
Non local bounds
5
and more formally,
sup
ρ:Ω→M1
+(Θ)
P

exp

λ

ρ

Uλ(θ)

−K(ρ, π)

≤P

exp

sup
ρ∈M1
+(Θ)
λ

ρ

Uλ(θ)

−K(ρ, π)

,
where the supremum in ρ taken in the left-hand side is restricted to regular condi-
tional probability distributions.
The following sections will show how to use this theorem.
1.2. Non local bounds
At least three sorts of bounds can be deduced from Theorem 1.1.4.
The most interesting ones with which to build estimators and tune parameters,
as well as the ﬁrst that have been considered in the development of the PAC-
Bayesian approach, are deviation bounds. They provide an empirical upper bound
for ρ(R) — that is a bound which can be computed from observed data — with
some probability 1−ϵ, where ϵ is a presumably small and tunable parameter setting
the desired conﬁdence level.
Anyhow, most of the results about the convergence speed of estimators to be
found in the statistical literature are concerned with the expectation P

ρ(R)

, there-
fore it is also enlightening to bound this quantity. In order to know at which rate
it may be approaching infΘ R, a non-random upper bound is required, which will
relate the average of the expected risk P

ρ(R)

with the properties of the contrast
function θ →R(θ).
Since the values of constants do matter a lot when a bound is to be used to se-
lect between various estimators using classiﬁcation models of various complexities,
a third kind of bound, related to the ﬁrst, may be considered for the sake of its
hopefully better constants: we will call them unbiased empirical bounds, to stress
the fact that they provide some empirical quantity whose expectation under P can
be proved to be an upper bound for P

ρ(R)

, the average expected risk. The price
to pay for these better constants is of course the lack of formal guarantee given by
the bound: two random variables whose expectations are ordered in a certain way
may very well be ordered in the reverse way with a large probability, so that basing
the estimation of parameters or the selection of an estimator on some unbiased
empirical bound is a hazardous business. Anyhow, since it is common practice to
use the inequalities provided by mathematical statistical theory while replacing the
proven constants with smaller values showing a better practical eﬃciency, consid-
ering unbiased empirical bounds as well as deviation bounds provides an indication
about how much the constants may be decreased while not violating the theory too
much.
1.2.1. Unbiased empirical bounds.
Let ρ : Ω →M1
+(Θ) be some ﬁxed (and
arbitrary) posterior distribution, describing some randomized estimator 	θ : Ω →Θ.
As we already mentioned, in these notes a posterior distribution will always be a
regular conditional probability measure. By this we mean that
• for any A ∈T, the map ω →ρ(ω, A) :

Ω, (B ⊗B′)⊗N
→R+ is assumed to
be measurable;

6
Chapter 1.
Inductive PAC-Bayesian learning
• for any ω ∈Ω, the map A →ρ(ω, A) : T →R+ is assumed to be a probability
measure.
We will also assume without further notice that the σ-algebras we deal with are
always countably generated. The technical implications of these assumptions are
standard and discussed for instance in Catoni (2004, pages 50-54), where, among
other things, a detailed proof of the decomposition of the Kullback Liebler diver-
gence is given.
Let us restrict to the case when the constant λ is positive. We get from Theorem
1.1.4 that
(1.2)
exp

λ

Φ λ
N

P

ρ(R)

−P

ρ(r)

−P

K(ρ, π)

≤1,
where we have used the convexity of the exp function and of Φ λ
N . Since we have
restricted our attention to positive values of the constant λ, equation (1.2) can also
be written
P

ρ(R)

≤Φ−1
λ
N

P

ρ(r) + λ−1K(ρ, π)

,
leading to
Theorem 1.2.1. For any posterior distribution ρ : Ω →M1
+(Θ), for any positive
parameter λ,
P

ρ(R)

≤
1 −exp

−N −1P

λρ(r) + K(ρ, π)

1 −exp(−λ
N )
≤P

λ
N

1 −exp(−λ
N )


ρ(r) + K(ρ, π)
λ

.
The last inequality provides the unbiased empirical upper bound for ρ(R) we were
looking
for,
meaning
that
the
expectation
of
λ
N

1−exp(−λ
N )


ρ(r) + K(ρ,π)
λ

is larger than the expectation of ρ(R). Let us no-
tice that 1 ≤
λ
N

1−exp(−λ
N )
 ≤

1−
λ
2N
−1 and therefore that this coeﬃcient is close
to 1 when λ is signiﬁcantly smaller than N.
If we are ready to believe in this bound (although this belief is not mathematically
well founded, as we already mentioned), we can use it to optimize λ and to choose
ρ. While the optimal choice of ρ when λ is ﬁxed is, according to Lemma 1.1.3 (page
4), to take it equal to πexp(−λr), a Gibbs posterior distribution, as it is sometimes
called, we may for computational reasons be more interested in choosing ρ in some
other class of posterior distributions.
For instance, our real interest may be to select some non-randomized estimator
from a family 	θm : Ω →Θm, m ∈M, of possible ones, where Θm are measurable
subsets of Θ and where M is an arbitrary (non necessarily countable) index set.
We may for instance think of the case when 	θm ∈arg minΘm r. We may slightly
randomize the estimators to start with, considering for any θ ∈Θm and any m ∈M,
Δm(θ) =

θ′ ∈Θm :

fθ′(Xi)
N
i=1 =

fθ(Xi)
N
i=1

,
and deﬁning ρm by the formula
dρm
dπ (θ) = 1

θ ∈Δm(	θm)

π

Δm(	θm)

.

1.2.
Non local bounds
7
Our posterior minimizes K(ρ, π) among those distributions whose support is re-
stricted to the values of θ in Θm for which the classiﬁcation rule fθ is identical
to the estimated one f	θm on the observed sample. Presumably, in many practi-
cal situations, fθ(x) will be ρm almost surely identical to f	θm(x) when θ is drawn
from ρm, for the vast majority of the values of x ∈X and all the sub-models Θm
not plagued with too much overﬁtting (since this is by construction the case when
x ∈{Xi : i = 1, . . . , N}). Therefore replacing 	θm with ρm can be expected to be a
minor change in many situations. This change by the way can be estimated in the
(admittedly not so common) case when the distribution of the patterns (Xi)N
i=1 is
known. Indeed, introducing the pseudo distance
(1.3)
D(θ, θ′) = 1
N
N

i=1
P

fθ(Xi) ̸= fθ′(Xi)

,
θ, θ′ ∈Θ,
one immediately sees that R(θ′) ≤R(θ) + D(θ, θ′), for any θ, θ′ ∈Θ, and therefore
that
R(	θm) ≤ρm(R) + ρm

D(·, 	θm)

.
Let us notice also that in the case where Θm ⊂Rdm, and R happens to be convex on
Δm(	θm), then ρm(R) ≥R

θρm(dθ)

, and we can replace 	θm with θm =

θρm(dθ),
and obtain bounds for R(θm). This is not a very heavy assumption about R, in the
case where we consider 	θm ∈arg minΘm r. Indeed, 	θm, and therefore Δm(	θm), will
presumably be close to arg minΘm R, and requiring a function to be convex in the
neighbourhood of its minima is not a very strong assumption.
Since r(	θm) = ρm(r), and K(ρm, π) = −log

π

Δm(	θm)

, our unbiased empiri-
cal upper bound in this context reads as
λ
N

1 −exp(−λ
N )


r(	θm) −log

π

Δm(	θm)

λ

.
Let us notice that we obtain a complexity factor −log

π

Δm(	θm)

which may be
compared with the Vapnik–Cervonenkis dimension. Indeed, in the case of binary
classiﬁcation, when using a classiﬁcation model with Vapnik–Cervonenkis dimen-
sion not greater than hm, that is when any subset of X which can be split in any
arbitrary way by some classiﬁcation rule fθ of the model Θm has at most hm points,
then

Δm(θ) : θ ∈Θm

is a partition of Θm with at most

eN
hm
hm
components: these facts, if not already
familiar to the reader, will be proved in Theorems 4.2.2 and 4.2.3 (page 144).
Therefore
inf
θ∈Θm −log

π

Δm(θ)

≤hm log
 eN
hm
!
−log

π(Θm)

.
Thus, if the model and prior distribution are well suited to the classiﬁcation task, in
the sense that there is more “room” (where room is measured with π) between the
two clusters deﬁned by 	θm than between other partitions of the sample of patterns
(Xi)N
i=1, then we will have
−log

π

Δm(	θ)

≤hm log
 eN
hm
!
−log

π(Θm)

.

8
Chapter 1.
Inductive PAC-Bayesian learning
An optimal value 	m may be selected so that
	m ∈arg min
m∈M

inf
λ∈R+
λ
N

1 −exp(−λ
N )

"
r(	θm) −log

π

Δm(	θm)

λ
#
.
Since ρ	
m is still another posterior distribution, we can be sure that
P

R(	θ	
m) −ρ	
m

D(·, 	θ	
m)

≤P

ρ	
m(R)

≤inf
λ∈R+ P

λ
N

1 −exp(−λ
N )

"
r(	θ	
m) −log

π

Δ	
m(	θ	
m)

λ
#
.
Taking the inﬁmum in λ inside the expectation with respect to P would be possible
at the price of some supplementary technicalities and a slight increase of the bound
that we prefer to postpone to the discussion of deviation bounds, since they are the
only ones to provide a rigorous mathematical foundation to the adaptive selection
of estimators.
1.2.2. Optimizing explicitly the exponential parameter λ.
In this section
we address some technical issues we think helpful to the understanding of Theorem
1.2.1 (page 6): namely to investigate how the upper bound it provides could be
optimized, or at least approximately optimized, in λ. It turns out that this can be
done quite explicitly.
So we will consider in this discussion the posterior distribution ρ : Ω →M1
+(Θ)
to be ﬁxed, and our aim will be to eliminate the constant λ from the bound by
choosing its value in some nearly optimal way as a function of P

ρ(r)

, the average
of the empirical risk, and of P

K(ρ, π)

, which controls overﬁtting.
Let the bound be written as
ϕ(λ) =

1 −exp(−λ
N )
−1 
1 −exp

−λ
N P

ρ(r)

−N −1P

K(ρ, π)

.
We see that
N ∂
∂λ log

ϕ(λ)

=
P

ρ(r)

exp

λ
N P

ρ(r)

+ N −1P

K(ρ, π)

−1
−
1
exp( λ
N ) −1.
Thus, the optimal value for λ is such that

exp( λ
N ) −1

P

ρ(r)

= exp

λ
N P

ρ(r)

+ N −1P

K(ρ, π)

−1.
Assuming that 1 ≫λ
N P

ρ(r)

≫P[K(ρ,π)]
N
, and keeping only higher order terms, we
are led to choose
λ =
$
2NP

K(ρ, π)

P

ρ(r)

1 −P

ρ(r)
,
obtaining
Theorem 1.2.2. For any posterior distribution ρ : Ω →M1
+(Θ),
P

ρ(R)

≤
1 −exp

−
%
2P[K(ρ,π)]P[ρ(r)]
N{1−P[ρ(r)]}
−P[K(ρ,π)]
N

1 −exp

−
%
2P[K(ρ,π)]
NP[ρ(r)]{1−P[ρ(r)]}

.

1.2.
Non local bounds
9
This result of course is not very useful in itself, since neither of the two quantities
P

ρ(r)

and P

K(ρ, π)

are easy to evaluate. Anyhow it gives a hint that replacing
them boldly with ρ(r) and K(ρ, π) could produce something close to a legitimate
empirical upper bound for ρ(R). We will see in the subsection about deviation
bounds that this is indeed essentially true.
Let us remark that in the third chapter of this monograph, we will see another
way of bounding
inf
λ∈R+ Φ−1
λ
N
 
q + d
λ
!
, leading to
Theorem 1.2.3.
For any prior distribution π ∈M1
+(Θ), for any posterior distri-
bution ρ : Ω →M1
+(Θ),
P

ρ(R)

≤
"
1 + 2P

K(ρ, π)

N
#−1 
P

ρ(r)

+ P

K(ρ, π)

N
+
$
2P

K(ρ, π)

P

ρ(r)

1 −P

ρ(r)

N
+ P

K(ρ, π)
2
N 2

,
as soon as P

ρ(r)

+
$
P

K(ρ, π)

2N
≤1
2,
and P

ρ(R)

≤P

ρ(r)

+
$
P

K(ρ, π)

2N
otherwise.
This theorem enlightens the inﬂuence of three terms on the average expected
risk:
• the average empirical risk, P

ρ(r)

, which as a rule will decrease as the size of
the classiﬁcation model increases, acts as a bias term, grasping the ability of the
model to account for the observed sample itself;
• a variance term
1
N P

ρ(r)

1 −P

ρ(r)

is due to the random ﬂuctuations of
ρ(r);
• a complexity term P

K(ρ, π)

, which as a rule will increase with the size of
the classiﬁcation model, eventually acts as a multiplier of the variance term.
We observed numerically that the bound provided by Theorem 1.2.2 is better
than the more classical Vapnik-like bound of Theorem 1.2.3. For instance, when
N = 1000, P

ρ(r)

= 0.2 and P

K(ρ, π)

= 10, Theorem 1.2.2 gives a bound lower
than 0.2604, whereas the more classical Vapnik-like approximation of Theorem 1.2.3
gives a bound larger than 0.2622. Numerical simulations tend to suggest the two
bounds are always ordered in the same way, although this could be a little tedious
to prove mathematically.
1.2.3. Non random bounds.
It is time now to come to less tentative results and
see how far is the average expected error rate P

ρ(R)

from its best possible value
infΘ R.
Let us notice ﬁrst that
λρ(r) + K(ρ, π) = K(ρ, πexp(−λr)) −log

π

exp(−λr)

.

10
Chapter 1.
Inductive PAC-Bayesian learning
Let us remark moreover that r →log

π

exp(−λr)

is a convex functional, a prop-
erty which from a technical point of view can be dealt with in the following way:
(1.4)
P

log

π

exp(−λr)

= P

sup
ρ∈M1
+(Θ)
−λρ(r) −K(ρ, π)

≥
sup
ρ∈M1
+(Θ)
P

−λρ(r) −K(ρ, π)

=
sup
ρ∈M1
+(Θ)
−λρ(R) −K(ρ, π)
= log

π

exp(−λR)

= −
 λ
0 πexp(−βR)(R)dβ.
These remarks applied to Theorem 1.2.1 lead to
Theorem 1.2.4. For any posterior distribution ρ : Ω →M1
+(Θ), for any positive
parameter λ,
P

ρ(R)

≤
1 −exp

−1
N
 λ
0 πexp(−βR)(R)dβ −1
N P

K(ρ, πexp(−λr))

1 −exp(−λ
N )
≤
1
N

1 −exp(−λ
N )

 λ
0 πexp(−βR)(R)dβ + P

K(ρ, πexp(−λr))

.
This theorem is particularly well suited to the case of the Gibbs posterior distri-
bution ρ = πexp(−λr), where the entropy factor cancels and where P

πexp(−λr)(R)

is shown to get close to infΘ R when N goes to +∞, as soon as λ/N goes to 0 while
λ goes to +∞.
We can elaborate on Theorem 1.2.4 and deﬁne a notion of dimension of (Θ, R),
with margin η ≥0 putting
(1.5)
dη(Θ, R) = sup
β∈R+
β

πexp(−βR)(R) −ess inf
π R −η

≤−log

π

R ≤ess inf
π R + η

.
This last inequality can be established by the chain of inequalities:
βπexp(−βR)(R) ≤
 β
0 πexp(−γR)(R)dγ = −log

π

exp(−βR)

≤β

ess inf
π R + η

−log

π

R ≤ess inf
π R + η

,
where we have used successively the fact that λ →πexp(−λR)(R) is decreasing
(because it is the derivative of the concave function λ →−log

π

exp(−λR)

)
and the fact that the exponential function takes positive values.
In typical “parametric” situations d0(Θ, R) will be ﬁnite, and in all circumstances
dη(Θ, R) will be ﬁnite for any η > 0 (this is a direct consequence of the deﬁnition
of the essential inﬁmum). Using this notion of dimension, we see that
 λ
0
πexp(−βR)(R)dβ ≤λ

ess inf
π R + η

+
 λ
0
dη
β ∧(1 −ess inf
π R −η)

dβ

1.2.
Non local bounds
11
= λ

ess inf
π R + η

+ dη(Θ, R) log

eλ
dη(Θ, R)

1 −ess inf
π R −η

.
This leads to
Corollary 1.2.5 With the above notation, for any margin η ∈R+, for any pos-
terior distribution ρ : Ω →M1
+(Θ),
P

ρ(R)

≤inf
λ∈R+ Φ−1
λ
N
&
ess inf
π R + η + dη
λ log
 eλ
dη
!
+ P

K

ρ, πexp(−λr)

λ
'
.
If one wants a posterior distribution with a small support, the theorem can also
be applied to the case when ρ is obtained by truncating πexp(−λr) to some level
set to reduce its support: let Θp = {θ ∈Θ : r(θ) ≤p}, and let us deﬁne for any
q ∈)0, 1) the level pq = inf{p : πexp(−λr)(Θp) ≥q}, let us then deﬁne ρq by its
density
dρq
dπexp(−λr)
(θ) =
1(θ ∈Θpq)
πexp(−λr)(Θpq),
then ρ0 = πexp(−λr) and for any q ∈(0, 1(,
P

ρq(R)

≤
1 −exp

−1
N
 λ
0 πexp(−βR)(R)dβ −log(q)
N

1 −exp(−λ
N )
≤
1
N

1 −exp(−λ
N )

 λ
0 πexp(−βR)(R)dβ −log(q)

.
1.2.4. Deviation bounds.
They provide results holding under the distribution
P of the sample with probability at least 1−ϵ, for any given conﬁdence level, set by
the choice of ϵ ∈)0, 1(. Using them is the only way to be quite (i.e. with probability
1 −ϵ) sure to do the right thing, although this right thing may be over-pessimistic,
since deviation upper bounds are larger than corresponding non-biased bounds.
Starting again from Theorem 1.1.4 (page 4), and using Markov’s inequality
P

exp(h) ≥1

≤P

exp(h)

, we obtain
Theorem 1.2.6. For any positive parameter λ, with P probability at least 1 −ϵ,
for any posterior distribution ρ : Ω →M1
+(Θ),
ρ(R) ≤Φ−1
λ
N

ρ(r) + K(ρ, π) −log(ϵ)
λ

=
1 −exp

−λρ(r)
N
−K(ρ, π) −log(ϵ)
N

1 −exp

−λ
N

≤
λ
N

1 −exp

−λ
N


ρ(r) + K(ρ, π) −log(ϵ)
λ

.
We see that for a ﬁxed value of the parameter λ, the upper bound is optimized
when the posterior is chosen to be the Gibbs distribution ρ = πexp(−λr).
In this theorem, we have bounded ρ(R), the average expected risk of an estimator
	θ drawn from the posterior ρ. This is what we will do most of the time in this study.
This is the error rate we will get if we classify a large number of test patterns,

12
Chapter 1.
Inductive PAC-Bayesian learning
drawing a new 	θ for each one. However, we can also be interested in the error rate
we get if we draw only one 	θ from ρ and use this single draw of 	θ to classify a
large number of test patterns. This error rate is R(	θ). To state a result about its
deviations, we can start back from Lemma 1.1.1 (page 3) and integrate it with
respect to the prior distribution π to get for any real constant λ
P

π

exp

λ

Φ λ
N

R

−r

≤1.
For any posterior distribution ρ : Ω →M1
+(Θ), this can be rewritten as
P

ρ

exp

λ

Φ λ
N

R

−r

−log

 dρ
dπ

+ log(ϵ)

≤ϵ,
proving
Theorem 1.2.7 For any positive real parameter λ, for any posterior distribution
ρ : Ω →M1
+(Θ), with Pρ probability at least 1 −ϵ,
R(	θ ) ≤Φ−1
λ
N

r(	θ ) + λ−1 log
 
ϵ−1 dρ
dπ
!
≤
λ
N

1 −exp(−λ
N )


r(	θ ) + λ−1 log
 
ϵ−1 dρ
dπ
!
.
Let us remark that the bound provided here is the exact counterpart of the bound
of Theorem 1.2.6, since log

 dρ
dπ

appears as a disintegrated version of the divergence
K(ρ, π). The parallel between the two theorems is particularly striking in the special
case when ρ = πexp(−λr). Indeed Theorem 1.2.6 proves that with P probability at
least 1 −ϵ,
πexp(−λr)(R) ≤Φ−1
λ
N

−log

π

exp

−λr

+ log(ϵ)
λ

,
whereas Theorem 1.2.7 proves that with Pπexp(−λr) probability at least 1 −ϵ
R(	θ ) ≤Φ−1
λ
N

−log

π

exp

−λr

+ log(ϵ)
λ

,
showing that we get the same deviation bound for πexp(−λr)(R) under P and for 	θ
under Pπexp(−λr).
We would like to show now how to optimize with respect to λ the bound given
by Theorem 1.2.6 (the same discussion would apply to Theorem 1.2.7). Let us
notice ﬁrst that values of λ less than 1 are not interesting (because they provide a
bound larger than one, at least as soon as ϵ ≤exp(−1)). Let us consider some real
parameter α > 1, and the set Λ = {αk; k ∈N}, on which we put the probability
measure ν(αk) = [(k+1)(k+2)]−1. Applying Theorem 1.2.6 to λ = αk at conﬁdence
level 1 −
ϵ
(k+1)(k+2), and using a union bound, we see that with probability at least
1 −ϵ, for any posterior distribution ρ,
ρ(R) ≤inf
λ′∈Λ Φ−1
λ′
N
⎧
⎨
⎩ρ(r) +
K(ρ, π) −log(ϵ) + 2 log

log(α2λ′)
log(α)

λ′
⎫
⎬
⎭.

1.2.
Non local bounds
13
Now we can remark that for any λ ∈(1, +∞(, there is λ′ ∈Λ such that α−1λ ≤
λ′ ≤λ. Moreover, for any q ∈(0, 1), β →Φ−1
β (q) is increasing on R+. Thus with
probability at least 1 −ϵ, for any posterior distribution ρ,
ρ(R) ≤
inf
λ∈(1,∞( Φ−1
λ
N

ρ(r) + α
λ

K(ρ, π) −log(ϵ) + 2 log

log(α2λ)
log(α)

=
inf
λ∈(1,∞(
1 −exp

−λ
N ρ(r) −α
N

K(ρ, π) −log(ϵ) + 2 log

log(α2λ)
log(α)

1 −exp(−λ
N )
.
Taking the approximately optimal value
λ =
$
2Nα [K(ρ, π) −log(ϵ)]
ρ(r)[1 −ρ(r)]
,
we obtain
Theorem 1.2.8. With probability 1 −ϵ, for any posterior distribution ρ : Ω →
M1
+(Θ), putting d(ρ, ϵ) = K(ρ, π) −log(ϵ),
ρ(R) ≤inf
k∈N
1 −exp

−αk
N ρ(r) −1
N

d(ρ, ϵ) + log

(k + 1)(k + 2)

1 −exp
 
−αk
N
!
≤
1 −exp
⎧
⎨
⎩−
$
2αρ(r)d(ρ, ϵ)
N[1 −ρ(r)] −α
N
&
d(ρ, ϵ) + 2 log
 log

α2%
2Nαd(ρ,ϵ)
ρ(r)[1−ρ(r)]

log(α)
!'⎫
⎬
⎭
1 −exp
&
−
$
2αd(ρ, ϵ)
Nρ(r)[1 −ρ(r)]
'
.
Moreover with probability at least 1 −ϵ, for any posterior distribution ρ such that
ρ(r) = 0,
ρ(R) ≤1 −exp

−K(ρ, π) −log(ϵ)
N

.
We can also elaborate on the results in an other direction by introducing the
empirical dimension
(1.6)
de = sup
β∈R+
β

πexp(−βr)(r) −ess inf
π r

≤−log

π

r = ess inf
π r

.
There is no need to introduce a margin in this deﬁnition, since r takes at most N
values, and therefore π

r = ess infπ r

is strictly positive. This leads to
Corollary 1.2.9. For any positive real constant λ, with P probability at least
1 −ϵ, for any posterior distribution ρ : Ω →M1
+(Θ),
ρ(R) ≤Φ−1
λ
N
&
ess inf
π r + de
λ log
 eλ
de
!
+ K

ρ, πexp(−λr)

−log(ϵ)
λ
'
.
We could then make the bound uniform in λ and optimize this parameter in a
way similar to what was done to obtain Theorem 1.2.8.

14
Chapter 1.
Inductive PAC-Bayesian learning
1.3. Local bounds
In this section, better bounds will be achieved through a better choice of the prior
distribution. This better prior distribution turns out to depend on the unknown
sample distribution P, and some work is required to circumvent this and obtain
empirical bounds.
1.3.1. Choice of the prior.
As mentioned in the introduction, if one is willing
to minimize the bound in expectation provided by Theorem 1.2.1 (page 6), one is led
to consider the optimal choice π = P(ρ). However, this is only an ideal choice, since
P is in all conceivable situations unknown. Nevertheless it shows that it is possible
through Theorem 1.2.1 to measure the complexity of the classiﬁcation model with
P

K

ρ, P(ρ)

, which is nothing but the mutual information between the random
sample (Xi, Yi)N
i=1 and the estimated parameter ˆθ, under the joint distribution Pρ.
In practice, since we cannot choose π = P(ρ), we have to be content with a
ﬂat prior π, resulting in a bound measuring complexity according to P

K(ρ, π)

=
P

K

ρ, P(ρ)

+K

P(ρ), π

larger by the entropy factor K

P(ρ), π

than the optimal
one (we are still commenting on Theorem 1.2.1).
If we want to base the choice of π on Theorem 1.2.4 (page 10), and if we choose
ρ = πexp(−λr) to optimize this bound, we will be inclined to choose some π such
that
1
λ
 λ
0 πexp(−βR)(R)dβ = −1
λ log

π

exp(−λR)

is as far as possible close to infθ∈Θ R(θ) in all circumstances. To give a more speciﬁc
example, in the case when the distribution of the design (Xi)N
i=1 is known, one can
introduce on the parameter space Θ the metric D already deﬁned by equation
(1.3, page 7) (or some available upper bound for this distance). In view of the fact
that R(θ) −R(θ′) ≤D(θ, θ′), for any θ, θ′ ∈Θ, it can be meaningful, at least
theoretically, to choose π as
π =
∞

k=1
1
k(k + 1)πk,
where πk is the uniform measure on some minimal (or close to minimal) 2−k-net
N(Θ, D, 2−k) of the metric space (Θ, D). With this choice
−1
λ log

π

exp(−λR)

≤inf
θ∈Θ R(θ)
+ inf
k

2−k + log(|N(Θ, D, 2−k)|) + log[k(k + 1)]
λ

.
Another possibility, when we have to deal with real valued parameters, meaning
that Θ ⊂Rd, is to code each real component θi ∈R of θ = (θi)d
i=1 to some
precision and to use a prior μ which is atomic on dyadic numbers. More precisely
let us parametrize the set of dyadic real numbers as
D =

r

s, m, p, (bj)p
j=1

= s2m
 
1 +
p

j=1
bj2−j
!
: s ∈{−1, +1}, m ∈Z, p ∈N, bj ∈{0, 1}

,

1.3.
Local bounds
15
where, as can be seen, s codes the sign, m the order of magnitude, p the precision
and (bj)p
j=1 the binary representation of the dyadic number r

s, m, p, (bj)p
j=1

. We
can for instance consider on D the probability distribution
(1.7)
μ

r

s, m, p, (bj)p
j=1

=

3(|m| + 1)(|m| + 2)(p + 1)(p + 2)2p−1
,
and deﬁne π ∈M1
+(Rd) as π = μ⊗d. This kind of “coding” prior distribution can
be used also to deﬁne a prior on the integers (by renormalizing the restriction of
μ to integers to get a probability distribution). Using μ is somehow equivalent to
picking up a representative of each dyadic interval, and makes it possible to restrict
to the case when the posterior ρ is a Dirac mass without losing too much (when
Θ = (0, 1), this approach is somewhat equivalent to considering as prior distribution
the Lebesgue measure and using as posterior distributions the uniform probabil-
ity measures on dyadic intervals, with the advantage of obtaining non-randomized
estimators). When one uses in this way an atomic prior and Dirac masses as pos-
terior distributions, the bounds proven so far can be obtained through a simpler
union bound argument. This is so true that some of the detractors of the PAC-
Bayesian approach (which, as a newcomer, has sometimes received a suspicious
greeting among statisticians) have argued that it cannot bring anything that ele-
mentary union bound arguments could not essentially provide. We do not share of
course this derogatory opinion, and while we think that allowing for non atomic
priors and posteriors is worthwhile, we also would like to stress that the upcoming
local and relative bounds could hardly be obtained with the only help of union
bounds.
Although the choice of a ﬂat prior seems at ﬁrst glance to be the only alternative
when nothing is known about the sample distribution P, the previous discussion
shows that this type of choice is lacking proper localisation, and namely that we
loose a factor K

P

πexp(−λr)

, π

, the divergence between the bound-optimal prior
P

πexp(−λr)

, which is concentrated near the minima of R in favourable situations,
and the ﬂat prior π. Fortunately, there are technical ways to get around this diﬃ-
culty and to obtain more local empirical bounds.
1.3.2. Unbiased local empirical bounds.
The idea is to start with some ﬂat
prior π ∈M1
+(Θ), and the posterior distribution ρ = πexp(−λr) minimizing the
bound of Theorem 1.2.1 (page 6), when π is used as a prior. To improve the bound,
we would like to use P

πexp(−λr)

instead of π, and we are going to make the guess
that we could approximate it with πexp(−βR) (we have replaced the parameter λ
with some distinct parameter β to give some more freedom to our investigation,
and also because, intuitively, P

πexp(−λr)

may be expected to be less concentrated
than each of the πexp(−λr) it is mixing, which suggests that the best approximation
of P

πexp(−λr)

by some πexp(−βR) may be obtained for some parameter β < λ).
We are then led to look for some empirical upper bound of K

ρ, πexp(−βR)

. This
is happily provided by the following computation
P

K

ρ, πexp(−βR)

= P

K(ρ, π)

+ βP

ρ(R)

+ log

π

exp(−βR)

= P

K

ρ, πexp(−βr)

+ βP

ρ(R −r)

+ log

π

exp(−βR)

−P

log π

exp(−βr)

.

16
Chapter 1.
Inductive PAC-Bayesian learning
Using the convexity of r →log

π

exp(−βr)

as in equation (1.4) on page 10, we
conclude that
0 ≤P

K

ρ, πexp(−βR)

≤βP

ρ(R −r)

+ P

K

ρ, πexp(−βr)

.
This inequality has an interest of its own, since it provides a lower bound for
P

ρ(R)

. Moreover we can plug it into Theorem 1.2.1 (page 6) applied to the prior
distribution πexp(−βR) and obtain for any posterior distribution ρ and any positive
parameter λ that
Φ λ
N

P

ρ(R)

≤P

ρ(r) + β
λρ(R −r) + 1
λP

K

ρ, πexp(−βr)

.
In view of this, it it convenient to introduce the function
Φa,b(p) = (1 −b)−1
Φa(p) −bp

= −(1 −b)−1
a−1 log

1 −p

1 −exp(−a)

+ bp

,
p ∈(0, 1), a ∈)0, ∞(, b ∈(0, 1(.
This is a convex function of p, moreover
Φ′
a,b(0) =

a−1
1 −exp(−a)

−b

(1 −b)−1,
showing that it is an increasing one to one convex map of the unit interval unto
itself as soon as b ≤a−1
1 −exp(−a)

. Its convexity, combined with the value of
its derivative at the origin, shows that
Φa,b(p) ≥a−1
1 −exp(−a)

−b
1 −b
p.
Using this notation and remarks, we can state
Theorem 1.3.1. For any positive real constants β and λ such that 0 ≤β < N[1−
exp(−λ
N )], for any posterior distribution ρ : Ω →M1
+(Θ),
P

ρ(r) −K

ρ, πexp(−βr)

β

≤P

ρ(R)

≤Φ−1
λ
N , β
λ

P

ρ(r) + K

ρ, πexp(−βr)

λ −β

≤
λ −β
N[1 −exp(−λ
N )] −β P

ρ(r) + K

ρ, πexp(−βr)

λ −β

.
Thus (taking λ = 2β), for any β such that 0 ≤β < N
2 ,
P

ρ(R)

≤
1
1 −2β
N
P

ρ(r) + K

ρ, πexp(−βr)

β

.
Note that the last inequality is obtained using the fact that 1−exp(−x) ≥x−x2
2 ,
x ∈R+.

1.3.
Local bounds
17
Corollary 1.3.2. For any β ∈(0, N(,
P

πexp(−βr)(r)

≤P

πexp(−βr)(R)

≤
inf
λ∈(−N log(1−β
N ),∞(
λ −β
N[1 −exp(−λ
N )] −β P

πexp(−βr)(r)

≤
1
1 −2β
N
P

πexp(−βr)(r)

,
the last inequality holding only when β < N
2 .
It is interesting to compare the upper bound provided by this corollary with
Theorem 1.2.1 (page 6) when the posterior is a Gibbs measure ρ = πexp(−βr). We
see that we have got rid of the entropy term K

πexp(−βr), π

, but at the price of
an increase of the multiplicative factor, which for small values of
β
N grows from
(1 −
β
2N )−1 (when we take λ = β in Theorem 1.2.1), to (1 −2β
N )−1. Therefore
non-localized bounds have an interest of their own, and are superseded by localized
bounds only in favourable circumstances (presumably when the sample is large
enough when compared with the complexity of the classiﬁcation model).
Corollary 1.3.2 shows that when 2β
N is small, πexp(−βr)(r) is a tight approximation
of πexp(−βr)(R) in the mean (since we have an upper bound and a lower bound which
are close together).
Another corollary is obtained by optimizing the bound given by Theorem 1.3.1
in ρ, which is done by taking ρ = πexp(−λr).
Corollary 1.3.3. For any positive real constants β and λ such that 0 ≤β <
N[1 −exp(−λ
N )],
P

πexp(−λr)(R)

≤Φ−1
λ
N , β
λ

P

1
λ −β
 λ
β
πexp(−γr)(r)dγ

≤
1
N[1 −exp(−λ
N )] −β P
 λ
β πexp(−γr)(r)dγ

.
Although this inequality gives by construction a better upper bound for
infλ∈R+ P

πexp(−λr)(R)

than Corollary 1.3.2, it is not easy to tell which one of
the two inequalities is the best to bound P

πexp(−λr)(R)

for a ﬁxed (and possibly
suboptimal) value of λ, because in this case, one factor is improved while the other
is worsened.
Using the empirical dimension de deﬁned by equation (1.6) on page 13, we see
that
1
λ −β
 λ
β
πexp(−γr)(r)dγ ≤ess inf
π r + de log
 λ
β
!
.
Therefore, in the case when we keep the ratio λ
β bounded, we get a better depen-
dence on the empirical dimension de than in Corollary 1.2.9 (page 13).
1.3.3. Non random local bounds.
Let us come now to the localization of the
non-random upper bound given by Theorem 1.2.4 (page 10). According to Theorem
1.2.1 (page 6) applied to the localized prior πexp(−βR),

18
Chapter 1.
Inductive PAC-Bayesian learning
λΦ λ
N

P

ρ(R)

≤P

λρ(r) + K(ρ, π) + βρ(R)

+ log

π

exp(−βR)

= P

K

ρ, πexp(−λr)

−log

π

exp(−λr)

+ βρ(R)

+ log

π

exp(−βR)

≤P

K

ρ, πexp(−λr)

+ βρ(R)

−log

π

exp(−λR)

+ log

π

exp(−βR)

,
where we have used as previously inequality (1.4) (page 10). This proves
Theorem 1.3.4. For any posterior distribution ρ : Ω →M1
+(Θ), for any real
parameters β and λ such that 0 ≤β < N

1 −exp(−λ
N )

,
P

ρ(R)

≤Φ−1
λ
N , β
λ

1
λ −β
 λ
β
πexp(−γR)(R)dγ + P
K

ρ, πexp(−λr)

λ −β

≤
1
N

1 −exp(−λ
N )

−β
 λ
β
πexp(−γR)(R)dγ + P

K

ρ, πexp(−λr)

.
Let us notice in particular that this theorem contains Theorem 1.2.4 (page 10)
which corresponds to the case β = 0. As a corollary, we see also, taking ρ = πexp(−λr)
and λ = 2β, and noticing that γ →πexp(−γR)(R) is decreasing, that
P

πexp(−λr)(R)

≤
inf
β,β<N[1−exp(−λ
N )]
β
N

1 −exp(−λ
N )

−β πexp(−βR)(R)
≤
1
1 −λ
N
πexp(−λ
2 R)(R).
We can use this inequality in conjunction with the notion of dimension with margin
η introduced by equation (1.5) on page 10, to see that the Gibbs posterior achieves
for a proper choice of λ and any margin parameter η ≥0 (which can be chosen to
be equal to zero in parametric situations)
(1.8)
inf
λ P

πexp(−λr)(R)

≤ess inf
π R + η + 4dη
N
+ 2
$
2dη

ess infπ R + η

N
+ 4d2η
N 2 .
Deviation bounds to come next will show that the optimal λ can be estimated from
empirical data.
Let us propose a little numerical example as an illustration: assuming that
d0 = 10, N = 1000 and ess infπ R = 0.2, we obtain from equation (1.8) that
infλ P

πexp(−λr)(R)

≤0.373.
1.3.4. Local deviation bounds.
When it comes to deviation bounds, for tech-
nical reasons we will choose a slightly more involved change of prior distribution
and apply Theorem 1.2.6 (page 11) to the prior πexp[−βΦ−β
N
◦R]. The advantage of
tweaking R with the nonlinear function Φ−β
N will appear in the search for an em-
pirical upper bound of the local entropy term. Theorem 1.1.4 (page 4), used with
the above-mentioned local prior, shows that
(1.9)
P

sup
ρ∈M1
+(Θ)
λ

ρ

Φ λ
N ◦R

−ρ(r)

−K

ρ, πexp(−βΦ−β
N
◦R)


≤1.

1.3.
Local bounds
19
Moreover
(1.10)
K

ρ, πexp[−βΦ−β
N
◦R]

= K

ρ, πexp(−βr)

+ βρ

Φ−β
N ◦R −r

+ log

π

exp

−βΦ−β
N ◦R

−log

π

exp(−βr)

,
which is an invitation to ﬁnd an upper bound for log

π

exp

−βΦ−λ
N ◦R

−
log

π

exp(−βr)

. For conciseness, let us call our localized prior distribution π,
thus deﬁned by its density
dπ
dπ (θ) =
exp

−βΦ−β
N

R(θ)

π

exp

−βΦ−β
N ◦R
.
Applying once again Theorem 1.1.4 (page 4), but this time to −β, we see that
(1.11)
P

exp

log

π

exp

−βΦ−β
N ◦R

−log

π

exp(−βr)

= P

exp

log

π

exp

−βΦ−β
N ◦R)

+
inf
ρ∈M1
+(Θ) βρ(r) + K(ρ, π)

≤P

exp

log

π

exp

−βΦ−β
N ◦R)

+ βπ(r) + K(π, π)

= P

exp

β

π(r) −π

Φ−β
N ◦R

+ K(π, π)

≤1.
Combining equations (1.10) and (1.11) and using the concavity of Φ−β
N , we see that
with P probability at least 1 −ϵ, for any posterior distribution ρ : Ω →M1
+(Θ),
0 ≤K(ρ, π) ≤K

ρ, πexp(−βr)

+ β

Φ−β
N

ρ(R)

−ρ(r)

−log(ϵ).
We have proved a lower deviation bound:
Theorem 1.3.5 For any positive real constant β, with P probability at least 1 −ϵ,
for any posterior distribution ρ : Ω →M1
+(Θ),
exp
 β
N

ρ(r) −K[ρ, πexp(−βr)] −log(ϵ)
β

−1
exp

 β
N

−1
≤ρ(R).
We can also obtain a lower deviation bound for 	θ. Indeed equation (1.11) can
also be written as
P

πexp(−βr)

exp

β

r −Φ−β
N ◦R

≤1.
This means that for any posterior distribution ρ : Ω →M1
+(Θ),
P

ρ

exp

β

r −Φ−β
N ◦R

−log

dρ
dπexp(−βr)

≤1.
We have proved

20
Chapter 1.
Inductive PAC-Bayesian learning
Theorem 1.3.6 For any positive real constant β, for any posterior distribution
ρ : Ω →M1
+(Θ), with Pρ probability at least 1 −ϵ,
R(	θ ) ≥Φ−1
−β
N

r(	θ ) −
log

dρ
dπexp(−βr)

−log(ϵ)
β

=
exp
 β
N

r(	θ ) −
log

dρ
dπexp(−βr)

−log(ϵ)
β

−1
exp
 β
N
!
−1
.
Let us now resume our investigation of the upper deviations of ρ(R). Using the
Cauchy-Schwarz inequality to combine equations (1.9, page 18) and (1.11, page 19),
we obtain
(1.12)
P

exp
1
2
sup
ρ∈M1
+(Θ)
λρ

Φ λ
N ◦R

−βρ

Φ−β
N ◦R

−(λ −β)ρ(r) −K

ρ, πexp(−βr)

= P

exp

1
2
sup
ρ∈M1
+(Θ)
 
λ

ρ

Φ λ
N ◦R

−ρ(r)

−K(ρ, π)
!
× exp

1
2
 
log

π

exp

−βΦ−β
N ◦R

−log

π

exp(−βr)
!
≤P

exp

sup
ρ∈M1
+(Θ)
 
λ

ρ

Φ λ
N ◦R

−ρ(r)

−K(ρ, π)
!1/2
× P

exp
 
log

π

exp

−βΦ−β
N ◦R

−log

π

exp(−βr)
!1/2
≤1.
Thus with P probability at least 1 −ϵ, for any posterior distribution ρ,
λΦ λ
N

ρ(R)

−βΦ−β
N

ρ(R)

≤λρ

Φ λ
N ◦R

−βρ

Φ−β
N ◦R

≤(λ −β)ρ(r) + K(ρ, πexp(−βr)) −2 log(ϵ).
(It would have been more straightforward to use a union bound on deviation in-
equalities instead of the Cauchy-Schwarz inequality on exponential moments, any-
how, this would have led to replace −2 log(ϵ) with the worse factor 2 log( 2
ϵ ).) Let
us now recall that
λΦ λ
N (p) −βΦ−β
N (p) = −N log

1 −

1 −exp

−λ
N

p

−N log

1 +

exp

 β
N

−1

p

,
and let us put
B = (λ −β)ρ(r) + K

ρ, πexp(−βr)

−2 log(ϵ)
= K

ρ, πexp(−λr)

+
 λ
β πexp(−ξr)(r)dξ −2 log(ϵ).
Let us consider moreover the change of variables α = 1−exp(−λ
N ) and γ = exp( β
N )−
1. We obtain

1 −αρ(R)

1 + γρ(R)

≥exp(−B
N ), leading to

1.3.
Local bounds
21
Theorem 1.3.7. For any positive constants α, γ, such that 0 ≤γ < α < 1, with P
probability at least 1 −ϵ, for any posterior distribution ρ : Ω →M1
+(Θ), the bound
M(ρ) = −log

(1 −α)(1 + γ)

α −γ
ρ(r) + K(ρ, πexp[−N log(1+γ)r]) −2 log(ϵ)
N(α −γ)
=
K

ρ, πexp[N log(1−α)r]

+
 −N log(1−α)
N log(1+γ)
πexp(−ξr)(r)dξ −2 log(ϵ)
N(α −γ)
,
is such that
ρ(R) ≤α −γ
2αγ
"$
1 +
4αγ
(α −γ)2

1 −exp

−(α −γ)M(ρ)

−1
#
≤M(ρ),
Let us now give an upper bound for R(	θ ). Equation (1.12 page 20) can also be
written as
P

πexp(−βr)

exp

λΦ λ
N ◦R −βΦ−β
N ◦R −(λ −β)r
 1
2 
≤1.
This means that for any posterior distribution ρ : Ω →M1
+(Θ),
P

ρ

exp

λΦ λ
N ◦R −βΦ−β
N ◦R −(λ −β)r −log

dρ
dπexp(−βr)
 1
2 
≤1.
Using the concavity of the square root function, this inequality can be weakened
to
P

ρ

exp

1
2

λΦ λ
N ◦R −βΦ−β
N ◦R −(λ −β)r −log

dρ
dπexp(−βr)

≤1.
We have proved
Theorem 1.3.8.
For any positive real constants λ and β and for any posterior
distribution ρ : Ω →M1
+(Θ), with Pρ probability at least 1 −ϵ,
λΦ λ
N

R(	θ )

−βΦ−β
N

R(	θ )

≤(λ −β) r(	θ ) + log

dρ
dπexp(−βr) (	θ )

−2 log(ϵ).
Putting α = 1 −exp

−λ
N

, γ = exp

 β
N

−1 and
M(θ) = −log

(1 −α)(1 + γ)

α −γ
r(θ) +
log

dρ
dπexp[−N log(1+γ)r] (θ)

−2 log(ϵ)
N(α −γ)
=
log

dρ
dπexp[N log(1−α)r] (θ)

+
 −N log(1−α)
N log(1+γ)
πexp(−ξr)(r) dξ −2 log(ϵ)
N(α −γ)
,
we can also, in the case when γ < α, write this inequality as
R(	θ ) ≤α −γ
2αγ
"$
1 +
4αγ
(α −γ)2

1 −exp

−(α −γ)M(	θ )

−1
#
≤M(	θ).

22
Chapter 1.
Inductive PAC-Bayesian learning
It may be enlightening to introduce the empirical dimension de deﬁned by equa-
tion (1.6) on page 13. It provides the upper bound
 λ
β
πexp(−ξr)(r)dξ ≤(λ −β) ess inf
π r + de log
 λ
β
!
,
which shows that in Theorem 1.3.7 (page 21),
M(ρ) ≤log

(1 + γ)(1 −α)

γ −α
ess inf
π r
+
de log

−log(1−α)
log(1+γ)

+ K

ρ, πexp[N log(1−α)r]

−2 log(ϵ)
N(α −γ)
.
Similarly, in Theorem 1.3.8 above,
M(θ) ≤log

(1 + γ)(1 −α)

γ −α
ess inf
π r
+
de log

−log(1−α)
log(1+γ)

+ log

dρ
dπexp[N log(1−α)r] (θ)

−2 log(ϵ)
N(α −γ)
Let us give a little numerical illustration: assuming that de = 10, N = 1000, and
ess infπ r = 0.2, taking ϵ = 0.01, α = 0.5 and γ = 0.1, we obtain from Theorem
1.3.7 πexp[N log(1−α)r](R) ≃πexp(−693r)(R) ≤0.332 ≤0.372, where we have given
respectively the non-linear and the linear bound. This shows the practical interest
of keeping the non-linearity. Optimizing the values of the parameters α and γ would
not have yielded a signiﬁcantly lower bound.
The following corollary is obtained by taking λ = 2β and keeping only the linear
bound; we give it for the sake of its simplicity:
Corollary 1.3.9. For any positive real constant β such that exp( β
N )+exp(−2β
N ) <
2, which is the case when β < 0.48N, with P probability at least 1 −ϵ, for any pos-
terior distribution ρ : Ω →M1
+(Θ),
ρ(R) ≤βρ(r) + K

ρ, πexp(−βr)

−2 log(ϵ)
N

2 −exp

 β
N

−exp

−2β
N

=
 2β
β
πexp(−ξr)(r)dξ + K

ρ, πexp(−2βr)

−2 log(ϵ)
N

2 −exp( β
N ) −exp(−2β
N )

.
Let us mention that this corollary applied to the above numerical example gives
πexp(−200r)(R) ≤0.475 (when we take β = 100, consistently with the choice γ =
0.1).
1.3.5. Partially local bounds.
Local bounds are suitable when the lowest
values of the empirical error rate r are reached only on a small part of the parameter
set Θ. When Θ is the disjoint union of sub-models of diﬀerent complexities, the
minimum of r will as a rule not be “localized” in a way that calls for the use of
local bounds. Just think for instance of the case when Θ = +M
m=1 Θm, where the
sets Θ1 ⊂Θ2 ⊂· · · ⊂ΘM are nested. In this case we will have infΘ1 r ≥infΘ2 r ≥

1.3.
Local bounds
23
· · · ≥infΘM r, although ΘM may be too large to be the right model to use. In this
situation, we do not want to localize the bound completely. Let us make a more
speciﬁc fanciful but typical pseudo computation. Just imagine we have a countable
collection (Θm)m∈M of sub-models. Let us assume we are interested in choosing
between the estimators 	θm ∈arg minΘm r, maybe randomizing them (e.g. replacing
them with πm
exp(−λr)). Let us imagine moreover that we are in a typically parametric
situation, where, for some priors πm ∈M1
+(Θm), m ∈M, there is a “dimension”
dm such that λ

πm
exp(−λr)(r) −r(	θm)

≃dm. Let μ ∈M1
+(M) be some distribution
on the index set M. It is easy to see that (μπ)exp(−λr) will typically not be properly
local, in the sense that typically
(μπ)exp(−λr)(r) =
μ

πexp(−λr)(r)π

exp(−λr)

μ

π

exp(−λr)

≃

m∈M

(inf
Θm r) + dm
λ

exp

−λ(inf
Θm r) −dm log

 eλ
dm

μ(m)

m∈M
exp

−λ(inf
Θm r) −dm log

 eλ
dm

μ(m)
≃

inf
m∈M(inf
Θm r) + dm
λ log

 eλ
dm

−1
λ log[μ(m)]

+ log
 
m∈M
exp

−dm log( λ
dm )

μ(m)

.
where we have used the approximations
−log

π

exp(−λr)

=
 λ
0
πexp(−βr)(r)dβ
≃
 λ
0
(inf
Θm r) +
 dm
β ∧1

dβ ≃λ(inf
Θm r) + dm

log

 λ
dm

+ 1

,
and

m h(m) exp[−h(m)]ν(m)

m exp[−h(m)]ν(m)
≃inf
m h(m)−log[ν(m)], ν ∈M1
+(M), taking ν(m) =
μ(m) exp

−dm log

 λ
dm


m′ μ(m′) exp

−dm′ log

 λ
dm′
.
These approximations have no pretension to be rigorous or very accurate, but
they nevertheless give the best order of magnitude we can expect in typical situa-
tions, and show that this order of magnitude is not what we are looking for: mixing
diﬀerent models with the help of μ spoils the localization, introducing a multiplier
log

 λ
dm

to the dimension dm which is precisely what we would have got if we had
not localized the bound at all. What we would really like to do in such situations is
to use a partially localized posterior distribution, such as π	
m
exp(−λr), where 	m is an
estimator of the best sub-model to be used. While the most straightforward way to
do this is to use a union bound on results obtained for each sub-model Θm, here
we are going to show how to allow arbitrary posterior distributions on the index
set (corresponding to a randomization of the choice of 	m).
Let us consider the framework we just mentioned: let the measurable parameter
set (Θ, T) be a union of measurable sub-models, Θ = 
m∈M Θm. Let the index set

24
Chapter 1.
Inductive PAC-Bayesian learning
(M, M) be some measurable space (most of the time it will be a countable set). Let
μ ∈M1
+(M) be a prior probability distribution on (M, M). Let π : M →M1
+(Θ) be
a regular conditional probability measure such that π(m, Θm) = 1, for any m ∈M.
Let μπ ∈M1
+(M ×Θ) be the product probability measure deﬁned for any bounded
measurable function h : M × Θ →R by
μπ(h) =

m∈M
 
θ∈Θ
h(m, θ)π(m, dθ)
!
μ(dm).
For any bounded measurable function h : Ω × M × Θ →R, let πexp(h) : Ω × M →
M1
+(Θ) be the regular conditional posterior probability measure deﬁned by
dπexp(h)
dπ
(m, θ) = exp

h(m, θ)

π

m, exp(h)
,
where consistently with previous notation π(m, h) =

Θ h(m, θ)π(m, dθ) (we will
also often use the less explicit notation π(h)). For short, let
U(θ, ω) = λΦ λ
N

R(θ)

−βΦ−β
N

R(θ)

−(λ −β)r(θ, ω).
Integrating with respect to μ equation (1.12, page 20), written in each sub-model
Θm using the prior distribution π(m, ·), we see that
P

exp

sup
ν∈M1
+(M)
sup
ρ:M→M1
+(Θ)
1
2

(νρ)(U) −ν

K(

ρ, πexp(−βr)

−K(ν, μ)

≤P

exp

sup
ν∈M1
+(M)
1
2ν
 
sup
ρ:M→M1
+(Θ)
ρ(U) −K(ρ, πexp(−βr))
!
−K(ν, μ)

= P

μ

exp

1
2
sup
ρ:M→M1
+(Θ)

ρ(U) −K

ρ, πexp(−βr)

= μ

P

exp

1
2
sup
ρ:M→M1
+(Θ)

ρ(U) −K

ρ, πexp(−βr)

≤1.
This proves that
(1.13)
P

exp
&
1
2
sup
ν∈M1
+(M)
sup
ρ:M→M1
+(Θ)
νρ

λΦ λ
N (R) −βΦ−β
N (R)

−(λ −β)νρ(r) −2K(ν, μ) −ν

K

ρ, πexp(−βr)

'
≤1.
Introducing the optimal value of r on each sub-model r⋆(m) = ess infπ(m,·) r and
the empirical dimensions
de(m) = sup
ξ∈R+
ξ

πexp(−ξr)(m, r) −r⋆(m)

,
we can thus state
Theorem 1.3.10. For any positive real constants β < λ, with P probability at least
1 −ϵ, for any posterior distribution ν : Ω →M1
+(M), for any conditional posterior
distribution ρ : Ω × M →M1
+(Θ),
νρ

λΦ λ
N (R) −βΦ−β
N (R)

≤λΦ λ
N

νρ(R)

−βΦ−β
N

νρ(R)

≤B1(ν, ρ),

1.3.
Local bounds
25
where B1(ν, ρ) = (λ −β)νρ(r) + 2K(ν, μ) + ν

K

ρ, πexp(−βr)

−2 log(ϵ)
= ν
 λ
β
πexp(−αr)(r)dα

+ 2K(ν, μ) + ν

K

ρ, πexp(−λr)

−2 log(ϵ)
= −2 log

μ

exp
 
−1
2
 λ
β
πexp(−αr)(r)dα
!
+ 2K

ν, μ
 π[exp(−λr)]
π[exp(−βr)]
1/2

+ ν

K

ρ, πexp(−λr)

−2 log(ϵ),
and therefore B1(ν, ρ) ≤ν

(λ −β)r⋆+ log

λ
β

de

+ 2K(ν, μ)
+ ν

K

ρ, πexp(−λr)

−2 log(ϵ),
as well as B1(ν, ρ) ≤−2 log

μ

exp
 
−(λ−β)
2
r⋆−1
2 log

 λ
β

de
!
+ 2K

ν, μ
π[exp(−λr)]
π[exp(−βr)]
1/2

+ ν

K

ρ, πexp(−λr)

−2 log(ϵ).
Thus, for any real constants α and γ such that 0 ≤γ < α < 1, with P probability
at least 1 −ϵ, for any posterior distribution ν : Ω →M1
+(M) and any conditional
posterior distribution ρ : Ω × M →M1
+(Θ), the bound
B2(ν, ρ) = −
log

(1−α)(1+γ)

α−γ
νρ(r) +
2K(ν,μ)+ν

K

ρ,π(1+γ)−Nr

−2 log(ϵ)
N(α−γ)
=
1
N(α −γ)

2K

ν, μ
π[(1−α)Nr]
π[(1+γ)−Nr]
1/2

+ ν

K

ρ, π(1−α)Nr

−
2
N(α −γ) log

μ
&
exp

−1
2
 −N log(1−α)
N log(1+γ)
πexp(−ξr)(·, r)dξ
'
−
2 log(ϵ)
N(α −γ)
satisﬁes
νρ(R) ≤α −γ
2αγ
"$
1 +
4αγ
(α −γ)2

1 −exp

−(α −γ)B2(ν, ρ)

−1
#
≤B2(ν, ρ).
If one is willing to bound the deviations with respect to Pνρ, it is enough to
remark that the equation preceding equation (1.13, page 24) can also be written as
P

μ
&
πexp(−βr)

exp

λΦ λ
N ◦R −βΦ−β
N ◦R −(λ −β)r
1/2'
≤1.
Thus for any posterior distributions ν : Ω →M1
+(M) and ρ : Ω × M →M1
+(Θ),
P

ν

ρ

exp

λΦ λ
N ◦R −βΦ−β
N ◦R
−(λ −β)r −2 log

 dν
dμ

−log

dρ
dπexp(−βr)
1/2
≤1.

26
Chapter 1.
Inductive PAC-Bayesian learning
Using the concavity of the square root function to pull the integration with respect
to ρ out of the square root, we get
Pνρ

exp
1
2

λΦ λ
N ◦R −βΦ−β
N ◦R
−(λ −β)r −2 log

 dν
dπ

−log

dρ
dπexp(−βr)

≤1.
This leads to
Theorem 1.3.11. For any positive real constants β < λ, for any posterior distri-
butions ν : Ω →M1
+(M) and ρ : Ω × M →M1
+(Θ), with Pνρ probability at least
1 −ϵ,
λΦ λ
N

R( 	m, 	θ )

−βΦ−β
N

R( 	m, 	θ )

≤(λ −β)r( 	m, 	θ)
+ 2 log
 dν
dμ( 	m )

+ log

dρ
dπexp(−βr) ( 	m, 	θ )

−2 log(ϵ)
=
 λ
β
πexp(−αr)(r)dα
+ 2 log
 dν
dμ( 	m)

+ log

dρ
dπexp(−λr) ( 	m, 	θ )

−2 log(ϵ)
= 2 log

μ

exp
 
−1
2
 λ
β
πexp(−αr)(r)dα
!
+ 2 log

dν
dμ
π[exp(−λr)]
π[exp(−βr)]
1/2 ( 	m)

+ log

dρ
dπexp(−λr) ( 	m, 	θ )

−2 log(ϵ).
Another way to state the same inequality is to say that for any real constants α and
γ such that 0 ≤γ < α < 1, with Pνρ probability at least 1 −ϵ,
R( 	m, 	θ)
≤α −γ
2αγ
 $
1 +
4αγ
(α −γ)2

1 −exp

−(α −γ)B( 	m, 	θ)

−1
!
≤B( 	m, 	θ),
where
B( 	m, 	θ) = −log

(1 −α)(1 + γ)

α −γ
r( 	m, 	θ)
+
2 log

dν
dμ( 	m)

+ log

dρ
dπ(1+γ)−Nr ( 	m, 	θ)

−2 log(ϵ)
N(α −γ)
=
2
N(α −γ) log

dν
dμ
π[(1−α)Nr]
π[(1+γ)−Nr]
1/2 ( 	m)

+
log

dρ
dπ(1−α)Nr ( 	m, 	θ)

−2 log(ϵ)
N(α −γ)

1.3.
Local bounds
27
+
2
N(α −γ) log

μ

exp
 
−1
2
 λ
β
πexp(−αr)(r)dα
!
.
Let us remark that in the case when ν = μ
π[(1−α)Nr]
π[(1+γ)−Nr]
1/2 and ρ = π(1−α)Nr, we
get as desired a bound that is adaptively local in all the Θm (at least when M is
countable and μ is atomic):
B(ν, ρ) ≤−
2
N(α−γ) log

μ

exp

N
2 log

(1 + γ)(1 −α)

r⋆
−log

−log(1−α)
log(1+γ)

de
2

−
2 log(ϵ)
N(α −γ)
≤inf
m∈M

−
log

(1−α)(1+γ)

α−γ
r⋆(m)
+ log

−log(1−α)
log(1+γ)

de(m)
N(α−γ) −2
log

ϵμ(m)

N(α−γ)

.
The penalization by the empirical dimension de(m) in each sub-model is as desired
linear in de(m). Non random partially local bounds could be obtained in a way that
is easy to imagine. We leave this investigation to the reader.
1.3.6. Two step localization.
We have seen that the bound optimal choice of
the posterior distribution ν on the index set in Theorem 1.3.10 (page 24) is such
that
dν
dμ(m) ∼
"
π

exp

−λr(m, ·)

π

exp

−βr(m, ·)

# 1
2
= exp

−1
2
 λ
β
πexp(−αr)(m, r)dα

.
This suggests replacing the prior distribution μ with μ deﬁned by its density
(1.14)
dμ
dμ(m) = exp

−h(m)

μ

exp(−h)
 ,
where h(m) = −ξ
 γ
β
πexp(−αΦ−η
N ◦R)

Φ−η
N ◦R(m, ·)

dα.
The use of Φ−η
N ◦R instead of R is motivated by technical reasons which will appear
in subsequent computations. Indeed, we will need to bound
ν
 λ
β
πexp(−αΦ−η
N ◦R)

Φ−η
N ◦R

dα

in order to handle K(ν, μ). In the spirit of equation (1.9, page 18), starting back
from Theorem 1.1.4 (page 4), applied in each sub-model Θm to the prior distribution
πexp(−γΦ−η
N ◦R) and integrated with respect to μ, we see that for any positive real
constants λ, γ and η, with P probability at least 1−ϵ, for any posterior distribution
ν : Ω →M1
+(M) on the index set and any conditional posterior distribution ρ :
Ω × M →M1
+(Θ),

28
Chapter 1.
Inductive PAC-Bayesian learning
(1.15)
νρ

λΦ λ
N ◦R −γΦ−η
N ◦R

≤λνρ(r)
+ νK(ρ, π) + K(ν, μ) + ν

log

π

exp

−γΦ−η
N ◦R

−log(ϵ).
Since x →f(x)
def
= λΦ λ
N −γΦ−η
N (x) is a convex function, it is such that
f(x) ≥xf ′(0) = xN

1 −exp(−λ
N )

+ γ
η

exp( η
N ) −1

.
Thus if we put
(1.16)
γ = η

1 −exp(−λ
N )

exp( η
N ) −1
,
we obtain that f(x) ≥0, x ∈R, and therefore that the left-hand side of equation
(1.15) is non-negative. We can moreover introduce the prior conditional distribution
π deﬁned by
dπ
dπ (m, θ) =
exp

−βΦ−η
N ◦R(θ)

π

m, exp

−βΦ−η
N ◦R
.
With P probability at least 1 −ϵ, for any posterior distributions ν : Ω →M1
+(M)
and ρ : Ω × M →M1
+(Θ),
βνρ(r) + ν

K(ρ, π)

= ν

K

ρ, πexp(−βr)

−ν

log

π

exp(−βr)

≤ν

K

ρ, πexp(−βr)

+ βνπ(r) + ν

K(π, π)

≤ν

K

ρ, πexp(−βr)

+ βνπ

Φ−η
N ◦R

+ β
η

K(ν, μ) −log(ϵ)

+ ν

K(π, π)

= ν

K

ρ, πexp(−βr)

−ν

log

π

exp

−βΦ−η
N ◦R

+ β
η

K(ν, μ) −log(ϵ)

.
Thus, coming back to equation (1.15), we see that under condition (1.16), with P
probability at least 1 −ϵ,
0 ≤(λ −β)νρ(r) + ν

K

ρ, πexp(−βr)

−ν
 γ
β
πexp(−αΦ−η
N ◦R)

Φ−η
N ◦R

dα

+ (1 + β
η )

K(ν, μ) + log( 2
ϵ )

.
Noticing moreover that
(λ −β)νρ(r) + ν

K

ρ, πexp(−βr)

= ν

K

ρ, πexp(−λr)

+ ν
 λ
β
πexp(−αr)(r)dα

,
and choosing ρ = πexp(−λr), we have proved
Theorem 1.3.12. For any positive real constants β, γ
and η, such that
γ
<
η

exp( η
N ) −1
−1,
deﬁning
λ
by
condition
(1.16),
so
that

1.3.
Local bounds
29
λ = −N log

1−γ
η

exp( η
N )−1

, with P probability at least 1−ϵ, for any posterior
distribution ν : Ω →M1
+(M), any conditional posterior distribution ρ : Ω × M →
M1
+(Θ),
ν
 γ
β
πexp(−αΦ−η
N ◦R)

Φ−η
N ◦R

dα

≤ν
 λ
β
πexp(−αr)(r)dα

+

1 + β
η

K(ν, μ) + log

 2
ϵ

.
Let us remark that this theorem does not require that β < γ, and thus provides
both an upper and a lower bound for the quantity of interest:
Corollary 1.3.13. For any positive real constants β, γ and η such that max{β,
γ} < η

exp( η
N )−1
−1, with P probability at least 1−ϵ, for any posterior distributions
ν : Ω →M1
+(M) and ρ : Ω × M →M1
+(Θ),
ν
 γ
−N log{1−β
N [exp( η
N )−1]}
πexp(−αr)(r)dα

−

1 + γ
η

K(ν, μ) + log

 3
ϵ

≤ν
 γ
β
πexp(−αΦ−η
N ◦R)

Φ−η
N ◦R

dα

≤ν
 −N log{1−γ
η [exp( η
N )−1]}
β
πexp(−αr)(r)dα

+

1 + β
η

K(ν, μ) + log

 3
ϵ

.
We can then remember that
K(ν, μ) = ξ

ν −μ
 γ
β
πexp(−αΦ−η
N ◦R)

Φ−η
N ◦R

dα

+ K(ν, μ) −K(μ, μ),
to conclude that, putting
(1.17)
Gη(α) = −N log

1 −α
η

exp

 η
N ) −1

≥α,
α ∈R+,
and
(1.18)
d	ν
dμ(m)
def
= exp

−h(m)

μ

exp(−h)
 where h(m) = ξ
 γ
Gη(β)
πexp(−αr)(m, r)dα,
the divergence of ν with respect to the local prior μ is bounded by

1 −ξ

1 + β
η

K(ν, μ)
≤ξν
 Gη(γ)
β
πexp(−αr)(r)dα

−ξμ
 γ
Gη(β)
πexp(−αr)(r)dα

+ K(ν, μ) −K(μ, μ) + ξ

2 + β+γ
η

log

 3
ϵ

≤ξν
 Gη(γ)
β
πexp(−αr)(r)dα

+ K(ν, μ)
+ log

μ

exp
 
−ξ
 γ
Gη(β)
πexp(−αr)(r)dα
!

30
Chapter 1.
Inductive PAC-Bayesian learning
+ ξ

2 + β+γ
η

log

 3
ϵ

= K(ν, 	ν) + ξν
  Gη(β)
β
+
 Gη(γ)
γ
!
πexp(−αr)(r)dα

+ ξ

2 + β+γ
η

log

 3
ϵ

.
We have proved
Theorem 1.3.14.
For
any
positive
constants
β,
γ
and
η
such
that
max{β, γ} < η

exp( η
N ) −1
−1, with P probability at least 1 −ϵ, for any pos-
terior distribution ν : Ω →M1
+(M) and any conditional posterior distribution
ρ : Ω × M →M1
+(Θ),
K(ν, μ) ≤

1 −ξ

1 + β
η
−1
K(ν, 	ν)
+ ξν
  Gη(β)
β
+
 Gη(γ)
γ
!
πexp(−αr)(r)dα

+ ξ

2 + β+γ
η

log

 3
ϵ

≤

1 −ξ

1 + β
η
−1
K(ν, 	ν)
+ ξν

Gη(γ) −γ + Gη(β) −β

r⋆+ log
 Gη(β)Gη(γ)
βγ
!
de

+ ξ

2 + β+γ
η

log

 3
ϵ

,
where the local prior μ is deﬁned by equation (1.14, page 27) and the local posterior
	ν and the function Gη are deﬁned by equation (1.18, page 29).
We can then use this theorem to give a local version of Theorem 1.3.10 (page 24).
To get something pleasing to read, we can apply Theorem 1.3.14 with constants β′,
γ′ and η chosen so that
2ξ
1−ξ(1+ β′
η ) = 1, Gη(β′) = β and γ′ = λ, where β and λ are
the constants appearing in Theorem 1.3.10. This gives
Theorem 1.3.15.
For any positive real constants β < λ and η such that λ <
η

exp( η
N ) −1
−1, with P probability at least 1 −ϵ, for any posterior distribution
ν : Ω →M1
+(M), for any conditional posterior distribution ρ : Ω × M →M1
+(Θ),
νρ

λΦ λ
N (R) −βΦ−β
N (R)

≤λΦ λ
N

νρ(R)

−βΦ−β
N

νρ(R)

≤B3(ν, ρ),
where B3(ν, ρ) = ν
 Gη(λ)
G−1
η (β)
πexp(−αr)(r)dα

+

3 +
G−1
η
(β)
η

K

ν, μ
exp

−

3+
G−1
η
(β)
η
−1  λ
β πexp(−αr)(r)dα

+ ν

K(ρ, πexp(−λr)

+

4 +
G−1
η (β)+λ
η

log

 4
ϵ

≤ν

Gη(λ) −G−1
η (β)

r⋆+ log

Gη(λ)
G−1
η (β)

de


1.3.
Local bounds
31
+

3 +
G−1
η
(β)
η

K

ν, μ
exp

−

3+
G−1
η
(β)
η
−1  λ
β πexp(−αr)(r)dα

+ ν

K(ρ, πexp(−λr)

+

4 +
G−1
η (β)+λ
η

log

 4
ϵ

,
and where the function Gη is deﬁned by equation (1.17, page 29).
A ﬁrst remark: if we had the stamina to use Cauchy Schwarz inequalities (or more
generally H¨older inequalities) on exponential moments instead of using weighted
union bounds on deviation inequalities, we could have replaced log( 4
ϵ ) with −log(ϵ)
in the above inequalities.
We see that we have achieved the desired kind of localization of Theorem 1.3.10
(page 24), since the new empirical entropy term
K[ν, μexp[−ξ  λ
β πexp(−αr)(r)dα]]
cancels for a value of the posterior distribution on the index set ν which is of the
same form as the one minimizing the bound B1(ν, ρ) of Theorem 1.3.10 (with a
decreased constant, as could be expected). In a typical parametric setting, we will
have
 λ
β
πexp(−αr)(r)dα ≃(λ −β)r⋆(m) + log

λ
β

de(m),
and therefore, if we choose for ν the Dirac mass at
	m ∈arg minm∈M r⋆(m) +
log( λ
β )
λ−β de(m),
and ρ(m, ·) = πexp(−λr)(m, ·), we will get, in the case when the index set M is
countable,
B3(ν, ρ) ≲max
⎧
⎨
⎩

Gη(λ) −G−1
η (β)

, (λ −β)
log
 Gη(λ)
G−1
η
(β)

log( λ
β )
⎫
⎬
⎭
×

r⋆( 	m) +
log( λ
β )
λ−β de( 	m)

+

3 +
G−1
η (β)
η

log
 
m∈M
μ(m)
μ( 	m) exp

−

3 +
G−1
η
(β)
η
−1
×

(λ −β)

r⋆(m) −r⋆( 	m)

+ log

 λ
β

de(m) −de( 	m)

+

4 +
G−1
η (β)+λ
η

log

 4
ϵ

.
This shows that the impact on the bound of the addition of supplementary models
depends on their penalized minimum empirical risk r⋆(m) +
log( λ
β )
λ−β de(m). More
precisely the adaptive and local complexity factor
log
 
m∈M
μ(m)
μ( 	m) exp

−

3 +
G−1
η (β)
η
−1
×

(λ −β)

r⋆(m) −r⋆( 	m)

+ log

 λ
β

de(m) −de( 	m)


32
Chapter 1.
Inductive PAC-Bayesian learning
replaces in this bound the non local factor
K(ν, μ) = −log

μ( 	m)

= log
& 
m∈M
μ(m)
μ( 	m)
'
which appears when applying Theorem 1.3.10 (page 24) to the Dirac mass ν = δ	
m.
Thus in the local bound, the inﬂuence of models decreases exponentially fast when
their penalized empirical risk increases.
One can deduce a result about the deviations with respect to the posterior νρ
from Theorem 1.3.15 (page 30) without much supplementary work: it is enough for
that purpose to remark that with P probability at least 1 −ϵ, for any posterior
distribution ν : Ω →M1
+(M),
ν

log

πexp(−λr)

exp

λΦ λ
N (R) −βΦ−β
N (R)

−ν
" Gη(λ)
G−1
η (β)
πexp(−αr)(r)dα
#
−

3 +
G−1
η
(β)
η

K

ν, μ
exp

−

3+
G−1
η
(β)
η
−1  λ
β πexp(−αr)(r)dα

−

4 +
G−1
η (β)+λ
η

log

4
ϵ

≤0,
this inequality being obtained by taking a supremum in ρ in Theorem 1.3.15 (page
30). One can then take a supremum in ν, to get, still with P probability at least
1 −ϵ,
log

μ
exp

−

3+
G−1
η
(β)
η
−1  λ
β πexp(−αr)(r)dα

&

πexp(−λr)

exp

λΦ λ
N (R) −βΦ−β
N (R)

3+
G−1
η
(β)
η
−1
× exp
"
−

3 +
G−1
η (β)
η
−1  Gη(λ)
G−1
η (β)
πexp(−αr)(r)dα
#'
≤
4 +
G−1
η
(β)+λ
η
3 + G−1
η (β)
η
log

 4
ϵ

.
Using the fact that x →xα is concave when α =

3 +
G−1
η (β)
η
−1 < 1, we get for
any posterior conditional distribution ρ : Ω × M →M1
+(Θ),
μ
exp

−

3+
G−1
η
(β)
η
−1  λ
β πexp(−αr)(r)dα
ρ

exp
&
3 +
G−1
η
(β)
η
−1
"
λΦ λ
N (R) −βΦ−β
N (R) −
 Gη(λ)
G−1
η (β)
πexp(−αr)(r)dα
+ log

dρ
dπexp(−λr)
( 	m, 	θ )
#'

1.4.
Relative bounds
33
≤exp
"
4 +
G−1
η (β)+λ
η
3 + G−1
η (β)
η
log

 4
ϵ

#
.
We can thus state
Theorem 1.3.16. For any ϵ ∈)0, 1(, with P probability at least 1 −ϵ, for any
posterior distribution ν : Ω →M1
+(M) and conditional posterior distribution ρ :
Ω × M →M1
+(Θ), for any ξ ∈)0, 1(, with νρ probability at least 1 −ξ,
λΦ λ
N (R) −βΦ−β
N (R) ≤
 Gη(λ)
G−1
η (β)
πexp(−αr)(r)dα
+

3 +
G−1
η (β)
η

log
⎡
⎢⎢⎣
dν
dμ
exp

−

3+
G−1
η
(β)
η
−1  λ
β πexp(−αr)(r)dα
 ( 	m)
⎤
⎥⎥⎦
+ log

dρ
dπexp(−λr)
( 	m, 	θ )

+

4 +
G−1
η
(β)+λ
η

log

 4
ϵ

−

3 +
G−1
η (β)
η

log(ξ).
Note that the given bound consequently holds with Pνρ probability at least
(1 −ϵ)(1 −ξ) ≥1 −ϵ −ξ.
1.4. Relative bounds
The behaviour of the minimum of the empirical process θ →r(θ) is known to
depend on the covariances between pairs

r(θ), r(θ′)

, θ, θ′ ∈Θ. In this respect,
our previous study, based on the analysis of the variance of r(θ) (or technically
on some exponential moment playing quite the same role), loses some accuracy in
some circumstances (namely when infΘ R is not close enough to zero).
In this section, instead of bounding the expected risk ρ(R) of any posterior
distribution, we are going to upper bound the diﬀerence ρ(R) −infΘ R, and more
generally ρ(R) −R(θ), where θ ∈Θ is some ﬁxed parameter value.
In the next section we will analyse ρ(R) −πexp(−βR)(R), allowing us to compare
the expected error rate of a posterior distribution ρ with the error rate of a Gibbs
prior distribution. We will also analyse ρ1(R) −ρ2(R), where ρ1 and ρ2 are two
arbitrary posterior distributions, using comparison with a Gibbs prior distribution
as a tool, and in particular as a tool to establish the required Kullback divergence
bounds.
Relative bounds do not provide the same kind of results as direct bounds on
the error rate: it is not possible to estimate ρ(R) with an order of precision higher
than (ρ(R)/N)1/2, so that relative bounds cannot of course achieve that, but they
provide a way to reach a faster rate for ρ(R) −infΘ R, that is for the relative
performance of the estimator within a restricted model.
The study of PAC-Bayesian relative bounds was initiated in the second and third
parts of J.-Y. Audibert’s dissertation (Audibert, 2004b).
In this section and the next, we will suggest a series of possible uses of relative
bounds. As usual, we will start with the simplest inequalities and proceed towards
more sophisticated techniques with better theoretical properties, but at the same
time less precise constants, so that which one is the more ﬁtted will depend on the
size of the training sample.

34
Chapter 1.
Inductive PAC-Bayesian learning
The ﬁrst thing we will do is to compute for any posterior distribution ρ : Ω →
M1
+(Θ) a relative performance bound bearing on ρ(R) −infΘ R. We will also com-
pare the classiﬁcation model indexed by Θ with a sub-model indexed by one of
its measurable subsets Θ1 ⊂Θ. For this purpose we will form the diﬀerence
ρ(R) −R(θ), where θ ∈Θ1 is some possibly unobservable value of the parame-
ter in the sub-model deﬁned by Θ1, typically chosen in arg minΘ1 R. If this is so
and ρ(R) −R(θ) = ρ(R) −infΘ1 R, a negative upper bound indicates that it is
deﬁnitely worth using a randomized estimator ρ supported by the larger parameter
set Θ instead of using only the classiﬁcation model deﬁned by the smaller set Θ1.
1.4.1. Basic inequalities.
Relative bounds in this section are based on the
control of r(θ) −r(θ), where θ, θ ∈Θ. These diﬀerences are related to the random
variables
ψi(θ, θ) = σi(θ) −σi(θ) = 1

fθ(Xi) ̸= Yi

−1

fθ(Xi) ̸= Yi

.
Some supplementary technical diﬃculties, as compared to the previous sections,
come from the fact that ψi(θ, θ) takes three values, whereas σi(θ) takes only two.
Let
(1.19)
r′(θ, θ) = r(θ) −r(θ) = 1
N
N

i=1
ψi(θ, θ),
θ, θ ∈Θ,
and R′(θ, θ) = R(θ)−R(θ) = P

r′(θ, θ)

. We have as usual from independence that
log

P

exp

−λr′(θ, θ)

=
N

i=1
log

P

exp

−λ
N ψi(θ, θ)

≤N log
 1
N
N

i=1
P

exp

−λ
N ψi(θ, θ)

.
Let Ci be the distribution of ψi(θ, θ) under P and let ¯C = 1
N
N
i=1 Ci ∈M1
+

{−1, 0,
1}

. With this notation
(1.20)
log

P

exp

−λr′(θ, θ)

≤N log

ψ∈{−1,0,1}
exp

−λ
N ψ

¯C(dψ)

.
The right-hand side of this inequality is a function of ¯C. On the other hand, ¯C
being a probability measure on a three point set, is deﬁned by two parameters, that
we may take equal to

ψ ¯C(dψ) and

ψ2 ¯C(dψ). To this purpose, let us introduce
M ′(θ, θ) =

ψ2 ¯C(dψ) = ¯C(+1) + ¯C(−1) = 1
N
N

i=1
P

ψ2
i (θ, θ)

,
θ, θ ∈Θ.
It is a pseudo distance (meaning that it is symmetric and satisﬁes the triangle
inequality), since it can also be written as
M ′(θ, θ) = 1
N
N

i=1
P
2221

fθ(Xi) ̸= Yi

−1

fθ(Xi) ̸= Yi
222

,
θ, θ ∈Θ.

1.4.
Relative bounds
35
It is readily seen that
N log

exp
 
−λ
N ψ
!
¯C(dψ)

= −λΨ λ
N

R′(θ, θ), M ′(θ, θ)

,
where
Ψa(p, m) = −a−1 log

(1 −m) + m + p
2
exp(−a) + m −p
2
exp(a)

= −a−1 log

1 −sinh(a)

p −m tanh( a
2)

.
(1.21)
Thus plugging this equality into inequality (1.20, page 34) we get
Theorem 1.4.1. For any real parameter λ,
log

P

exp

−λr′(θ, θ)

≤−λΨ λ
N

R′(θ, θ), M ′(θ, θ)

,
θ, θ ∈Θ,
where r′ is deﬁned by equation (1.19, page 34) and Ψ and M ′ are deﬁned just above.
To make a link with previous work of Mammen and Tsybakov — see e.g. Mam-
men et al. (1999) and Tsybakov (2004) — we may consider the pseudo-distance
D on Θ deﬁned by equation (1.3, page 7). This distance only depends on the dis-
tribution of the patterns. It is often used to formulate margin assumptions, in the
sense of Mammen and Tsybakov. Here we are going to work rather with M ′: as it
is dominated by D in the sense that M ′(θ, θ) ≤D(θ, θ), θ, θ ∈Θ, with equality in
the important case of binary classiﬁcation, hypotheses formulated on D induce hy-
potheses on M ′, and working with M ′ may only sharpen the results when compared
to working with D.
Using the same reasoning as in the previous section, we deduce
Theorem 1.4.2. For any real parameter λ, any θ ∈Θ, any prior distribution
π ∈M1
+(Θ),
P

exp

sup
ρ∈M1
+(Θ)
λ

ρ

Ψ λ
N

R′(·, θ ), M ′(·, θ )

−ρ

r′(·, θ)

−K(ρ, π)

≤1.
We are now going to derive some other type of relative exponential inequal-
ity. In Theorem 1.4.2 we obtained an inequality comparing one observed quantity
ρ

r′(·, θ )

with two unobserved ones, ρ

R′(·, θ )

and ρ

M ′(·, θ )

, — indeed, because
of the convexity of the function λΨ λ
N ,
λρ

Ψ λ
N

R′(·, θ ), M ′(·, θ )

≥λΨ λ
N

ρ

R′(·, θ )

, ρ

M ′(·, θ )

.
This may be inconvenient when looking for an empirical bound for ρ

R′(·, θ)

,
and we are going now to seek an inequality comparing ρ

R′(·, θ )

with empirical
quantities only.
This is possible by considering the log-Laplace transform of some modiﬁed ran-
dom variable χi(θ, θ). We may consider more precisely the change of variable deﬁned
by the equation
exp
 
−λ
N χi
!
= 1 −λ
N ψi,

36
Chapter 1.
Inductive PAC-Bayesian learning
which is possible when
λ
N ∈)−1, 1( and leads to deﬁne
χi = −N
λ log
 
1 −λ
N ψi
!
.
We may then work on the log-Laplace transform
log

P
&
exp

−λ
N
N

i=1
χi(θ, θ)
'
= log

P
& N
3
i=1
 
1 −λ
N ψi(θ, θ)
!'
= log

P
&
exp
 N

i=1
log

1 −λ
N ψi(θ, θ)
'
.
We may now follow the same route as previously, writing
log

P
&
exp
 N

i=1
log

1 −λ
N ψi(θ, θ)
'
=
N

i=1
log

1 −λ
N P

ψi(θ, θ)

≤N log

1 −λ
N R′(θ, θ )

.
Let us also introduce the random pseudo distance
(1.22)
m′(θ, θ) = 1
N
N

i=1
ψi(θ, θ)2
= 1
N
N

i=1
2221

fθ(Xi) ̸= Yi

−1

fθ(Xi) ̸= Yi
222,
θ, θ ∈Θ.
This is the empirical counterpart of M ′, implying that P(m′) = M ′. Let us notice
that
1
N
N

i=1
log

1 −λ
N ψi(θ, θ)

= log(1 −λ
N ) −log(1 + λ
N )
2
r′(θ, θ)
+ log(1 −λ
N ) + log(1 + λ
N )
2
m′(θ, θ)
= 1
2 log
"
1 −λ
N
1 + λ
N
#
r′
θ, θ

+ 1
2 log

1 −λ2
N 2

m′
θ, θ

.
Let us put γ = N
2 log
 
1+ λ
N
1−λ
N
!
, so that
λ = N tanh

 γ
N

and N
2 log

1 −λ2
N 2

= −N log

cosh( γ
N )

.
With this notation, we can conveniently write the previous inequality as
P

exp

−N log

1 −tanh

 γ
N

R′(θ, θ)

−γr′
θ, θ

−N log

cosh( γ
N )

m′
θ, θ

≤1.
Integrating with respect to a prior probability measure π ∈M1
+(Θ), we obtain

1.4.
Relative bounds
37
Theorem 1.4.3. For any real parameter γ, for any θ ∈Θ, for any prior probability
distribution π ∈M1
+(Θ),
P

exp
&
sup
ρ∈M1
+(Θ)

−Nρ

log

1 −tanh

 γ
N

R′(·, θ )

−γρ

r′(·, θ )

−N log

cosh( γ
N )

ρ

m′(·, θ )

−K(ρ, π)
'
≤1.
1.4.2. Non random bounds.
Let us ﬁrst deduce a non-random bound from
Theorem 1.4.2 (page 35). This theorem can be conveniently taken advantage of by
throwing the non-linearity into a localized prior, considering the prior probability
measure μ deﬁned by its density
dμ
dπ (θ) =
exp

−λΨ λ
N

R′(θ, θ ), M ′(θ, θ )

+ βR′(θ, θ )

π

exp

−λΨ λ
N

R′(·, θ ), M ′(·, θ )

+ βR′(·, θ )
.
Indeed, for any posterior distribution ρ : Ω →M1
+(Θ),
K(ρ, μ) = K(ρ, π) + λρ

Ψ λ
N

R′(·, θ ), M ′(·, θ )

−βρ

R′(·, θ )

+ log

π

exp

−λΨ λ
N

R′(·, θ ), M ′(·, θ )

+ βR′(·, θ )

.
Plugging this into Theorem 1.4.2 (page 35) and using the convexity of the exponen-
tial function, we see that for any posterior probability distribution ρ : Ω →M1
+(Θ),
βP

ρ

R′(·, θ )

≤λP

ρ

r′(·, θ )

+ P

K(ρ, π)

+ log

π

exp

−λΨ λ
N

R′(·, θ ), M ′(·, θ )

+ βR′(·, θ )

.
We can then recall that
λρ

r′(·, θ )

+ K(ρ, π) = K

ρ, πexp(−λr)

−log

π

exp

−λr′(·, θ )

,
and notice moreover that
−P

log

π

exp

−λr′(·, θ )

≤−log

π

exp

−λR′(·, θ )

,
since R′ = P(r′) and h →log

π

exp(h)

is a convex functional. Putting these two
remarks together, we obtain
Theorem 1.4.4.
For any real positive parameter λ, for any prior distribution
π ∈M1
+(Θ), for any posterior distribution ρ : Ω →M1
+(Θ),
P

ρ

R′(·, θ )

≤1
β P

K(ρ, πexp(−λr))

+ 1
β log

π

exp

−λΨ λ
N

R′(·, θ ), M ′(·, θ )

+ βR′(·, θ )


38
Chapter 1.
Inductive PAC-Bayesian learning
−1
β log

π

exp

−λR′(·, θ )

≤1
β P

K(ρ, πexp(−λr))

+ 1
β log

π

exp

−

N sinh( λ
N ) −β

R′(·, θ )
+ 2N sinh( λ
2N )2M ′(·, θ )

−1
β log

π

exp

−λR′(·, θ )

.
It may be interesting to derive some more suggestive (but slightly weaker) bound
in the important case when Θ1 = Θ and R(θ) = infΘ R. In this case, it is convenient
to introduce the expected margin function
(1.23)
ϕ(x) = sup
θ∈Θ
M ′(θ, θ) −xR′(θ, θ),
x ∈R+.
We see that ϕ is convex and non-negative on R+. Using the bound M ′(θ, θ ) ≤
xR′(θ, θ ) + ϕ(x), we obtain
P

ρ

R′(·, θ )

≤1
β P

K(ρ, πexp(−λr))

+ 1
β log

π

exp

−

N sinh( λ
N )

1 −x tanh( λ
2N )

−β

R′(·, θ )

+ N sinh( λ
N ) tanh( λ
2N )
β
ϕ(x) −1
β log

π

exp

−λR′(·, θ )

.
Let us make the change of variable γ = N sinh( λ
N )

1 −x tanh( λ
2N )

−β to obtain
Corollary 1.4.5. For any real positive parameters x, γ and λ such that x ≤
tanh( λ
2N )−1 and 0 ≤γ < N sinh( λ
N )

1 −x tanh( λ
2N )

,
P

ρ(R)

−inf
Θ R ≤

N sinh( λ
N )

1 −x tanh( λ
2N )

−γ
−1
×
 λ
γ

πexp(−αR)(R) −inf
Θ R

dα
+ N sinh

 λ
N

tanh

 λ
2N

ϕ(x) + P

K(ρ, πexp(−λr))

.
Let us remark that these results, although well suited to study Mammen and
Tsybakov’s margin assumptions, hold in the general case: introducing the convex
expected margin function ϕ is a substitute for making hypotheses about the relations
between R and D.
Using the fact that R′(θ, θ ) ≥0, θ ∈Θ and that ϕ(x) ≥0, x ∈R+, we can
weaken and simplify the preceding corollary even more to get
Corollary 1.4.6. For any real parameters β, λ and x such that x ≥0 and 0 ≤
β < λ −x λ2
2N , for any posterior distribution ρ : Ω →M1
+(Θ),

1.4.
Relative bounds
39
P

ρ(R)

≤inf
Θ R
+

λ −x λ2
2N −β
−1 λ
β

πexp(−αR)(R) −inf
Θ R

dα
+ P

K

ρ, πexp(−λr)

+ ϕ(x) λ2
2N

.
Let us apply this bound under the margin assumption ﬁrst considered by Mam-
men and Tsybakov (Mammen et al., 1999; Tsybakov, 2004), which says that for
some real positive constant c and some real exponent κ ≥1,
(1.24)
R′(θ, θ) ≥cD(θ, θ)κ,
θ ∈Θ.
In the case when κ = 1, then ϕ(c−1) = 0, proving that
P

πexp(−λr)

R′(·, θ )

≤
 λ
β πexp(−γR)

R′(·, θ )

dγ
N sinh( λ
N )

1 −c−1 tanh( λ
2N )

−β
≤
 λ
β πexp(−γR)

R′(·, θ )

dγ
λ −
λ2
2cN −β
.
Taking for example λ = cN
2 , β = λ
2 = cN
4 , we obtain
P

πexp(−2−1cNr)(R)

≤inf R + 8
cN

cN
2
cN
4
πexp(−γR)

R′(·, θ)

dγ
≤inf R + 2πexp(−cN
4 R)

R′(·, θ )

.
If moreover the behaviour of the prior distribution π is parametric, meaning that
πexp(−βR)

R′(·, θ )

≤d
β , for some positive real constant d linked with the dimension
of the classiﬁcation model, then
P

πexp(−cN
2 r)(R)

≤inf R + 8 log(2)d
cN
≤inf R + 5.55 d
cN .
In the case when κ > 1,
ϕ(x) ≤(κ −1)κ−
κ
κ−1 (cx)−
1
κ−1 = (1 −κ−1)(κcx)−
1
κ−1 ,
thus P

πexp(−λr)

R′(·, θ )

≤
 λ
β πexp(−γR)

R′(·, θ )

dγ + (1 −κ−1)(κcx)−
1
κ−1 λ2
2N
λ −xλ2
2N −β
.
Taking for instance β = λ
2 , x = N
2λ, and putting b = (1 −κ−1)(cκ)−
1
κ−1 , we obtain
P

πexp(−λr)(R)

−inf R ≤4
λ
 λ
λ/2
πexp(−γR)

R′(·, θ )

dγ + b
 2λ
N
!
κ
κ−1
.
In the parametric case when πexp(−γR)

R′(·, θ )

≤d
γ , we get
P

πexp(−λr)(R)

−inf R ≤4 log(2)d
λ
+ b
 2λ
N
!
κ
κ−1
.

40
Chapter 1.
Inductive PAC-Bayesian learning
Taking
λ = 2−1
8 log(2)d
 κ−1
2κ−1 (κc)
1
2κ−1 N
κ
2κ−1 ,
we obtain
P

πexp(−λr)(R)

−inf R ≤(2 −κ−1)(κc)−
1
2κ−1
 8 log(2)d
N
!
κ
2κ−1
.
We see that this formula coincides with the result for κ = 1. We can thus reduce
the two cases to a single one and state
Corollary 1.4.7.
Let us assume that for some θ ∈Θ, some positive real constant
c, some real exponent κ ≥1 and for any θ ∈Θ, R(θ) ≥R(θ) + cD(θ, θ)κ. Let us
also assume that for some positive real constant d and any positive real parameter
γ, πexp(−γR)(R) −inf R ≤d
γ . Then
P

π
exp

−2−1[8 log(2)d]
κ−1
2κ−1 (κc)
1
2κ−1 N
κ
2κ−1 r
(R)

≤inf R + (2 −κ−1)(κc)−
1
2κ−1
 8 log(2)d
N
!
κ
2κ−1
.
Let us remark that the exponent of N in this corollary is known to be the mini-
max exponent under these assumptions: it is unimprovable, whatever estimator is
used in place of the Gibbs posterior shown here (at least in the worst case com-
patible with the hypotheses). The interest of the corollary is to show not only the
minimax exponent in N, but also an explicit non-asymptotic bound with reason-
able and simple constants. It is also clear that we could have got slightly better
constants if we had kept the full strength of Theorem 1.4.4 (page 37) instead of
using the weaker Corollary 1.4.6 (page 38).
We will prove in the following empirical bounds showing how the constant λ can
be estimated from the data instead of being chosen according to some margin and
complexity assumptions.
1.4.3. Unbiased empirical bounds.
We are going to deﬁne an empirical coun-
terpart for the expected margin function ϕ. It will appear in empirical bounds having
otherwise the same structure as the non-random bound we just proved. Anyhow,
we will not launch into trying to compare the behaviour of our proposed empiri-
cal margin function with the expected margin function, since the margin function
involves taking a supremum which is not straightforward to handle. When we will
touch the issue of building provably adaptive estimators, we will instead formulate
another type of bounds based on integrated quantities, rather than try to analyse
the properties of the empirical margin function.
Let us start as in the previous subsection with the inequality
βP

ρ

R′(·, θ )

≤P

λρ

r′(·, θ )

+ K(ρ, π)

+ log

π

exp

−λΨ λ
N

R′(·, θ ), M ′(·, θ )

+ βR′(·, θ )

.
We have already deﬁned by equation (1.22, page 36) the empirical pseudo-distance
m′(θ, θ ) = 1
N
N

i=1
ψi(θ, θ )2.

1.4.
Relative bounds
41
Recalling that P

m′(θ, θ )

=
M ′(θ, θ ), and using the convexity of h
→
log

π

exp(h)

, leads to the following inequalities:
log

π

exp

−λΨ λ
N

R′(·, θ ), M ′(·, θ )

+ βR′(·, θ )

≤log

π

exp

−N sinh( λ
N )R′(·, θ )
+ N sinh( λ
N ) tanh( λ
2N )M ′(·, θ ) + βR′(·, θ )

≤P

log

π

exp

−

N sinh( λ
N ) −β

r′(·, θ )
+ N sinh( λ
N ) tanh( λ
2N )m′(·, θ )

.
We may moreover remark that
λρ

r′(·, θ )

+ K(ρ, π) =

β −N sinh( λ
N ) + λ

ρ

r′(·, θ )

+ K

ρ, πexp{−[N sinh( λ
N )−β]r}

−log

π

exp

−

N sinh( λ
N ) −β

r′(·, θ )

.
This establishes
Theorem 1.4.8. For any positive real parameters β and λ, for any posterior dis-
tribution ρ : Ω →M1
+(Θ),
P

ρ

R′(·, θ )

≤P

1 −N sinh( λ
N ) −λ
β

ρ

r′(·, θ )

+
K

ρ, πexp{−[N sinh( λ
N )−β]r}

β
+ β−1 log

πexp{−[N sinh( λ
N )−β]r}

exp

N sinh( λ
N ) tanh( λ
2N )m′(·, θ )

.
Taking β = N
2 sinh( λ
N ), using the fact that sinh(a) ≥a, a ≥0 and expressing
tanh( a
2) = a−14
1 + sinh(a)2−1

and a = log
4
1 + sinh(a)2+sinh(a)

, we deduce
Corollary 1.4.9. For any positive real constant β and any posterior distribution
ρ : Ω →M1
+(Θ),
P

ρ

R′(·, θ )

≤P

N
β log
%
1 + 4β2
N 2 + 2β
N

−1

5
67
8
≤1
ρ

r′(·, θ )

+ 1
β

K

ρ, πexp(−βr)

+ log

πexp(−βr)

exp

N
%
1 + 4β2
N 2 −1

m′(·, θ )

.

42
Chapter 1.
Inductive PAC-Bayesian learning
This theorem and its corollary are really analogous to Theorem 1.4.4 (page 37),
and it could easily be proved that under Mammen and Tsybakov margin assump-
tions we obtain an upper bound of the same order as Corollary 1.4.7 (page 40).
Anyhow, in order to obtain an empirical bound, we are now going to take a supre-
mum over all possible values of θ, that is over Θ1. Although we believe that taking
this supremum will not spoil the bound in cases when over-ﬁtting remains un-
der control, we will not try to investigate precisely if and when this is actually
true, and provide our empirical bound as such. Let us say only that on qualitative
grounds, the values of the margin function quantify the steepness of the contrast
function R or its empirical counterpart r, and that the deﬁnition of the empirical
margin function is obtained by substituting P, the true sample distribution, with
P =

 1
N
N
i=1 δ(Xi,Yi)
⊗N, the empirical sample distribution, in the deﬁnition of
the expected margin function. Therefore, on qualitative grounds, it seems hopeless
to presume that R is steep when r is not, or in other words that a classiﬁcation
model that would be ineﬃcient at estimating a bootstrapped sample according to
our non-random bound would be by some miracle eﬃcient at estimating the true
sample distribution according to the same bound. To this extent, we feel that our
empirical bounds bring a satisfactory counterpart of our non-random bounds. Any-
how, we will also produce estimators which can be proved to be adaptive using
PAC-Bayesian tools in the next section, at the price of a more sophisticated con-
struction involving comparisons between a posterior distribution and a Gibbs prior
distribution or between two posterior distributions.
Let us now restrict discussion to the important case when θ ∈arg minΘ1 R.
To obtain an observable bound, let 	θ ∈arg minθ∈Θ r(θ) and let us introduce the
empirical margin functions
ϕ(x) = sup
θ∈Θ
m′(θ, 	θ) −x

r(θ) −r(	θ)

,
x ∈R+,
ϕ(x) = sup
θ∈Θ1
m′(θ, 	θ) −x

r(θ) −r(	θ)

,
x ∈R+.
Using the fact that m′(θ, θ) ≤m′(θ, 	θ) + m′(	θ, θ), we get
Corollary 1.4.10. For any positive real parameters β and λ, for any posterior
distribution ρ : Ω →M1
+(Θ),
P

ρ(R)

−inf
Θ1 R ≤P

1 −N sinh( λ
N )−λ
β

ρ(r) −r(	θ)

+
K

ρ, πexp{−[N sinh( λ
N )−β]r}

β
+ β−1 log

πexp{−[N sinh( λ
N )−β]r}

exp

N sinh

 λ
N

tanh

 λ
2N

m′(·, 	θ)

+ β−1N sinh( λ
N ) tanh( λ
2N )ϕ

β
N sinh( λ
N ) tanh( λ
2N )
"
1 −N sinh( λ
N ) −λ
β
#
.
Taking β = N
2 sinh( λ
N ), we also obtain
P

ρ(R)

−inf
Θ1 R ≤P

N
β log
%
1 + 4β2
N 2 + 2β
N

−1

5
67
8
≤1

ρ(r) −r(	θ)


1.4.
Relative bounds
43
+ 1
β

K

ρ, πexp(−βr)

+ log

πexp(−βr)

exp

N
%
1 + 4β2
N 2 −1

m′(·, 	θ)

+ N
β
%
1 + 4β2
N 2 −1

ϕ
&log
%
1 + 4β2
N 2 + 2β
N

−β
N
%
1 + 4β2
N 2 −1

'
.
Note that we could also use the upper bound m′(θ, 	θ) ≤x

r(θ) −r(	θ)

+ ϕ(x)
and put α = N sinh( λ
N )

1 −x tanh( λ
2N )

−β, to obtain
Corollary 1.4.11. For any non-negative real parameters x, α and λ, such that
α < N sinh( λ
N )

1 −x tanh( λ
2N )

, for any posterior distribution ρ : Ω →M1
+(Θ),
P

ρ(R)

−inf
Θ1 R
≤P

1 −N sinh( λ
N )

1 −x tanh( λ
2N )

−λ
N sinh( λ
N )

1 −x tanh( λ
2N )

−α

ρ(r) −r(	θ)

+
K

ρ, πexp(−αr)

N sinh( λ
N )

1 −x tanh( λ
2N )

−α
+
N sinh( λ
N ) tanh( λ
2N )
N sinh( λ
N )

1 −x tanh( λ
2N )

−α
×

ϕ(x) + ϕ
 
λ −α
N sinh( λ
N ) tanh( λ
2N )
!
.
Let us notice that in the case when Θ1 = Θ, the upper bound provided by this
corollary has the same general form as the upper bound provided by Corollary 1.4.5
(page 38), with the sample distribution P replaced with the empirical distribution
of the sample P =

 1
N
N
i=1 δ(Xi,Yi)
⊗N. Therefore, our empirical bound can be of
a larger order of magnitude than our non-random bound only in the case when our
non-random bound applied to the bootstrapped sample distribution P would be of
a larger order of magnitude than when applied to the true sample distribution P. In
other words, we can say that our empirical bound is close to our non-random bound
in every situation where the bootstrapped sample distribution P is not harder to
bound than the true sample distribution P. Although this does not prove that our
empirical bound is always of the same order as our non-random bound, this is a good
qualitative hint that this will be the case in most practical situations of interest,
since in situations of “under-ﬁtting”, if they exist, it is likely that the choice of the
classiﬁcation model is inappropriate to the data and should be modiﬁed.
Another reassuring remark is that the empirical margin functions ϕ and ϕ behave
well in the case when infΘ r = 0. Indeed in this case m′(θ, 	θ) = r′(θ, 	θ) = r(θ),
θ ∈Θ, and thus ϕ(1) = ϕ(1) = 0, and
ϕ(x) ≤−(x −1) infΘ1 r, x ≥1.
This shows that in this case we recover the same accuracy as with non-relative local
empirical bounds. Thus the bound of Corollary 1.4.11 does not collapse in presence
of massive over-ﬁtting in the larger model, causing r(	θ) = 0, which is another hint
that this may be an accurate bound in many situations.

44
Chapter 1.
Inductive PAC-Bayesian learning
1.4.4. Relative empirical deviation bounds.
It is natural to make use of
Theorem 1.4.3 (page 37) to obtain empirical deviation bounds, since this theorem
provides an empirical variance term.
Theorem 1.4.3 is written in a way which exploits the fact that ψi takes only the
three values −1, 0 and +1. However, it will be more convenient for the following
computations to use it in its more general form, which only makes use of the fact
that ψi ∈(−1, 1). With notation to be explained hereafter, it can indeed also be
written as
(1.25)
P

exp
&
sup
ρ∈M1
+(Θ)

−Nρ

log

1 −λP(ψ)

+ Nρ

P

log(1 −λψ)

−K(ρ, π)
'
≤1.
We have used the following notation in this inequality. We have put
P = 1
N
N

i=1
δ(Xi,Yi),
so
that
P
is
our
notation
for
the
empirical
distribution
of
the
process
(Xi, Yi)N
i=1. Moreover we have also used
P = P(P) = 1
N
N

i=1
Pi,
where it should be remembered that the joint distribution of the process (Xi, Yi)N
i=1
is P = N
i=1 Pi. We have considered ψ(θ, θ) as a function deﬁned on X × Y as
ψ(θ, θ)(x, y) = 1

y ̸= fθ(x)

−1

y ̸= fθ(x)

, (x, y) ∈X × Y so that it should be
understood that
P(ψ) = 1
N
N

i=1
P

ψi(θ, θ)

= 1
N
N

i=1
P

1

Yi ̸= fθ(Xi)

−1

Yi ̸= fθ(Xi)

= R′(θ, θ).
In the same way
P

log(1 −λψ)

= 1
N
N

i=1
log

1 −λψi(θ, θ)

.
Moreover integration with respect to ρ bears on the index θ, so that
ρ

log

1 −λP(ψ)

=

θ∈Θ
log

1 −λ
N
N

i=1
P

ψi(θ, θ)

ρ(dθ),
ρ

P

log(1 −λψ)

=

θ∈Θ
 1
N
N

i=1
log

1 −λψi(θ, θ)

ρ(dθ).

1.4.
Relative bounds
45
We have chosen concise notation, as we did throughout these notes, in order to
make the computations easier to follow.
To get an alternate version of empirical relative deviation bounds, we need to ﬁnd
some convenient way to localize the choice of the prior distribution π in equation
(1.25, page 44). Here we propose replacing π with μ = πexp{−N log[1+βP (ψ)]}, which
can also be written πexp{−N log[1+βR′(·,θ)]}. Indeed we see that
K(ρ, μ) = Nρ

log

1 + βP(ψ)

+ K(ρ, π)
+ log

π

exp

−N log

1 + βP(ψ)

.
Moreover, we deduce from our deviation inequality applied to −ψ, that (as long as
β > −1),
P

exp

Nμ

P

log(1 + βψ)

−Nμ

log

1 + βP(ψ)

≤1.
Thus
P

exp

log

π

exp

−N log

1 + βP(ψ)

−log

π

exp

−NP

log(1 + βψ)

≤P

exp

−Nμ

log

1 + βP(ψ)

−K(μ, π)
+ Nμ

P

log(1 + βψ)

+ K(μ, π)

≤1.
This can be used to handle K(ρ, μ), making use of the Cauchy–Schwarz inequality
as follows
P

exp
&
1
2

−N log

1 −λρ

P(ψ)

1 + βρ

P(ψ)

+Nρ

P

log(1 −λψ)

−K(ρ, π) −log

π

exp

−NP

log(1 + βψ)
'
≤P

exp
&
−N log

1 −λρ

P(ψ)

+ Nρ

P

log(1 −λψ)

−K(ρ, μ)
'1/2
× P

exp
&
log

π

exp

−N log

1 + βP(ψ)

−log

π

exp

−NP

log(1 + βψ)
'1/2
≤1.

46
Chapter 1.
Inductive PAC-Bayesian learning
This implies that with P probability at least 1 −ϵ,
−N log

1 −λρ

P(ψ)

1 + βρ

P(ψ)

≤−Nρ

P

log(1 −λψ)

+ K(ρ, π) + log

π

exp

−NP

log(1 + βψ)

−2 log(ϵ).
It is now convenient to remember that
P

log(1 −λψ)

= 1
2 log
 1 −λ
1 + λ
!
r′(θ, θ) + 1
2 log(1 −λ2)m′(θ, θ).
We thus can write the previous inequality as
−N log

1 −λρ

R′(·, θ)

1 + βρ

R′(·, θ)

≤N
2 log
 1 + λ
1 −λ
!
ρ

r′(·, θ)

−N
2 log(1 −λ2)ρ

m′(·, θ)

+ K(ρ, π)
+ log

π

exp

−N
2 log
1 + β
1 −β

r′(·, θ)
−N
2 log(1 −β2)m′(·, θ)

−2 log(ϵ).
Let us assume now that θ ∈arg minΘ1 R. Let us introduce 	θ ∈arg minΘ r. Decom-
posing r′(θ, θ) = r′(θ, 	θ) + r′(	θ, θ) and considering that
m′(θ, θ) ≤m′(θ, 	θ) + m′(	θ, θ),
we see that with P probability at least 1 −ϵ, for any posterior distribution ρ : Ω →
M1
+(Θ),
−N log

1 −λρ

R′(·, θ)

1 + βρ

R′(·, θ)

≤N
2 log
 1 + λ
1 −λ
!
ρ

r′(·, 	θ)

−N
2 log(1 −λ2)ρ

m′(·, 	θ)

+ K(ρ, π)
+ log

π

exp

−N
2 log

1+β
1−β

r′(·, 	θ )

−N
2 log(1 −β2)m′(·, 	θ )

+ N
2 log

(1+λ)(1−β)
(1−λ)(1+β)

r(	θ ) −r(θ)

−N
2 log

(1 −λ2)(1 −β2)

m′(	θ , θ) −2 log(ϵ).
Let us now deﬁne for simplicity the posterior ν : Ω →M1
+(Θ) by the identity
dν
dπ (θ) =
exp

−N
2 log

1+λ
1−λ

r′(θ, 	θ) + N
2 log(1 −λ2)m′(θ, 	θ)

π

exp

−N
2 log

1+λ
1−λ

r′(·, 	θ) + N
2 log(1 −λ2)m′(·, 	θ)
.
Let us also introduce the random bound
B = 1
N log

ν

exp

N
2 log

(1+λ)(1−β)
(1−λ)(1+β)

r′(·, 	θ)

1.4.
Relative bounds
47
−N
2 log

(1 −λ2)(1 −β2)

m′(·, 	θ )

+ sup
θ∈Θ1
1
2 log

(1−λ)(1+β)
(1+λ)(1−β)

r′(θ, 	θ )
−1
2 log

(1 −λ2)(1 −β2)

m′(θ, 	θ ) −2
N log(ϵ).
Theorem 1.4.12. Using the above notation, for any real constants 0 ≤β < λ < 1,
for any prior distribution π ∈M1
+(Θ), for any subset Θ1 ⊂Θ, with P probability at
least 1 −ϵ, for any posterior distribution ρ : Ω →M1
+(Θ),
−log

1 −λ

ρ(R) −inf
Θ1 R

1 + β

ρ(R) −inf
Θ1 R

≤K(ρ, ν)
N
+ B.
Therefore,
ρ(R) −inf
Θ1 R
≤λ −β
2λβ
"$
1 + 4
λβ
(λ −β)2

1 −exp
 
−B −K(ρ, ν)
N
!
−1
#
≤
1
λ −β
 
B + K(ρ, ν)
N
!
.
Let us deﬁne the posterior 	ν by the identity
d	ν
dπ (θ) =
exp

−N
2 log

1+β
1−β

r′(θ, 	θ) −N
2 log(1 −β2)m′(θ, 	θ)

π

exp

−N
2 log

1+β
1−β

r′(·, 	θ) −N
2 log(1 −β2)m′(·, 	θ)
.
It is useful to remark that
1
N log

ν

exp
N
2 log
(1 + λ)(1 −β)
(1 −λ)(1 + β)

r′(·, 	θ)
−N
2 log

(1 −λ2)(1 −β2)

m′(·, 	θ)

≤	ν
1
2 log
(1 + λ)(1 −β)
(1 −λ)(1 + β)

r′(·, 	θ)
−1
2 log

(1 −λ2)(1 −β2)

m′(·, 	θ)

.
This inequality is a special case of
log

π

exp(g)

−log

π

exp(h)

=
 1
α=0
πexp[h+α(g−h)](g −h)dα ≤πexp(g)(g −h),
which is a consequence of the convexity of α →log

π

exp

h + α(g −h)

.

48
Chapter 1.
Inductive PAC-Bayesian learning
Let us introduce as previously ϕ(x) = supθ∈Θ m′(θ, 	θ) −x r′(θ, 	θ), x ∈R+. Let
us moreover consider ϕ(x) = supθ∈Θ1 m′(θ, 	θ) −x r′(θ, 	θ), x ∈R+. These functions
can be used to produce a result which is slightly weaker, but maybe easier to read
and understand. Indeed, we see that, for any x ∈R+, with P probability at least
1 −ϵ, for any posterior distribution ρ,
−N log

1 −λρ

R′(·, θ)

1 + βρ

R′(·, θ)

≤N
2 log

(1 + λ)
(1 −λ)(1 −λ2)x

ρ

r′(·, 	θ)

−N
2 log

(1 −λ2)(1 −β2)

ϕ(x) + K(ρ, π)
+ log

π

exp

−N
2 log

(1+β)
(1−β)(1−β2)x

r′(·, 	θ)

−N
2 log

(1 −λ2)(1 −β2)

ϕ
⎛
⎝
log

(1+λ)(1−β)
(1−λ)(1+β)

−log [(1 −λ2)(1 −β2)]
⎞
⎠
−2 log(ϵ)
=

N
2 log
(1+λ)
(1−λ)(1−λ2)x

N
2 log
(1+β)
(1−β)(1−β2)x
 πexp(−αr)

r′(·, 	θ)

dα
+ K(ρ, πexp{−N
2 log[
(1+λ)
(1−λ)(1−λ2)x ]r}) −2 log(ϵ)
−N
2 log

(1 −λ2)(1 −β2)

⎡
⎣ϕ(x) + ϕ
⎛
⎝
log

(1+λ)(1−β)
(1−λ)(1+β)

−log[(1 −λ2)(1 −β2)]
⎞
⎠
⎤
⎦.
Theorem 1.4.13. With the previous notation, for any real constants 0 ≤β < λ <
1, for any positive real constant x, for any prior probability distribution π ∈M1
+(Θ),
for any subset Θ1 ⊂Θ, with P probability at least 1−ϵ, for any posterior distribution
ρ : Ω →M1
+(Θ), putting
B(ρ) =
1
N(λ −β)

N
2 log
(1+λ)
(1−λ)(1−λ2)x

N
2 log
(1+β)
(1−β)(1−β2)x
 πexp(−αr)

r′(·, 	θ)

dα
+
K(ρ, πexp{−N
2 log[
(1+λ)
(1−λ)(1−λ2)x ]r}) −2 log(ϵ)
N(λ −β)
−
1
2(λ −β) log

(1 −λ2)(1 −β2)

⎡
⎣ϕ(x) + ϕ
⎛
⎝
log

(1+λ)(1−β)
(1−λ)(1+β)

−log[(1 −λ2)(1 −β2)]
⎞
⎠
⎤
⎦
≤
1
N(λ −β)de log
⎛
⎝
log

(1+λ)
(1−λ)(1−λ2)x

log

(1+β)
(1−β)(1−β2)x

⎞
⎠
+
K(ρ, πexp{−N
2 log[
(1+λ)
(1−λ)(1−λ2)x ]r}) −2 log(ϵ)
N(λ −β)

1.4.
Relative bounds
49
−
1
2(λ −β) log

(1 −λ2)(1 −β2)

⎡
⎣ϕ(x) + ϕ
⎛
⎝
log

(1+λ)(1−β)
(1−λ)(1+β)

−log[(1 −λ2)(1 −β2)]
⎞
⎠
⎤
⎦,
the following bounds hold true:
ρ(R) −inf
Θ1 R
≤λ −β
2λβ
"$
1 +
4λβ
(λ −β)2

1 −exp

−(λ −β)B(ρ)

−1
#
≤B(ρ).
Let us remark that this alternative way of handling relative deviation bounds
made it possible to carry on with non-linear bounds up to the ﬁnal result. For
instance, if λ = 0.5, β = 0.2 and B(ρ) = 0.1, the non-linear bound gives ρ(R) −
infΘ1 R ≤0.096.

50
Chapter 1.
Inductive PAC-Bayesian learning

Chapter 2
Comparing posterior
distributions to Gibbs priors
2.1. Bounds relative to a Gibbs distribution
We now come to an approach to relative bounds whose performance can be
analysed with PAC-Bayesian tools.
The empirical bounds at the end of the previous chapter involve taking suprema
in θ ∈Θ, and replacing the expected margin function ϕ with some empirical coun-
terparts ϕ or ϕ, which may prove unsafe when using very complex classiﬁcation
models.
We are now going to focus on the control of the divergence K

ρ, πexp(−βR)

. It
is already obvious, we hope, that controlling this divergence is the crux of the
matter, and that it is a way to upper bound the mutual information between
the training sample and the parameter, which can be expressed as K

ρ, P(ρ)

=
K

ρ, πexp(−βR)

−K

P(ρ), πexp(−βR)

, as explained on page 14.
Through the identity
(2.1)
K

ρ, πexp(−βR)

= β

ρ(R) −πexp(−βR)(R)

+ K(ρ, π) −K

πexp(−βR), π

,
we see that the control of this divergence is related to the control of the diﬀerence
ρ(R) −πexp(−βR)(R). This is the route we will follow ﬁrst.
Thus comparing any posterior distribution with a Gibbs prior distribution will
provide a ﬁrst way to build an estimator which can be proved to reach adaptively
the best possible asymptotic error rate under Mammen and Tsybakov margin as-
sumptions and parametric complexity assumptions (at least as long as orders of
magnitude are concerned, we will not discuss the question of asymptotically opti-
mal constants).
Then we will provide an empirical bound for the Kullback divergence K

ρ,
πexp(−βR)

itself. This will serve to address the question of model selection, which
will be achieved by comparing the performance of two posterior distributions possi-
bly supported by two diﬀerent models. This will also provide a second way to build
estimators which can be proved to be adaptive under Mammen and Tsybakov mar-
gin assumptions and parametric complexity assumptions (somewhat weaker than
with the ﬁrst method).
51

52
Chapter 2.
Comparing posterior distributions to Gibbs priors
Finally, we will present two-step localization strategies, in which the performance
of the posterior distribution to be analysed is compared with a two-step Gibbs prior.
2.1.1. Comparing a posterior distribution with a Gibbs prior.
Similarly
to Theorem 1.4.3 (page 37) we can prove that for any prior distribution π ∈M1
+(Θ),
(2.2)
P

π ⊗π

exp

−N log(1 −N tanh

 γ
N

R′)
−γr′ −N log

cosh( γ
N )

m′

≤1.
Replacing π with πexp(−βR) and considering the posterior distribution ρ⊗πexp(−βR),
provides a starting point in the comparison of ρ with πexp(−βR); we can indeed state
with P probability at least 1 −ϵ that
(2.3)
−N log

1 −tanh

 γ
N

ρ(R) −πexp(−βR)(R)

≤γ

ρ(r) −πexp(−βR)(r)

+ N log

cosh( γ
N )

ρ ⊗πexp(−βR)

(m′)
+ K

ρ, πexp(−βR)

−log(ϵ).
Using equation (2.1, page 51) to handle the entropy term, we get
(2.4)
−N log

1 −tanh( γ
N )

ρ(R) −πexp(−βR)(R)

−β

ρ(R) −πexp(−βR)(R)

≤γ

ρ(r) −πexp(−βR)(r)

+ N log

cosh

 γ
N

ρ ⊗πexp(−βR)(m′)
+ K(ρ, π) −K

πexp(−βR), π

−log(ϵ).
We can then decompose in the right-hand side γ

ρ(r) −πexp(−βR)(r)

into (γ −
λ)

ρ(r) −πexp(−βR)(r)

+ λ

ρ(r) −πexp(−βR)(r)

for some parameter λ to be set
later on and use the fact that
λ

ρ(r) −πexp(−βR)(r)

+ N log

cosh( γ
N )

ρ ⊗πexp(−βR)(m′)
+ K(ρ, π) −K

πexp(−βR), π

≤λρ(r) + K(ρ, π) + log

π

exp

−λr + N log

cosh( γ
N )

ρ(m′)

= K

ρ, πexp(−λr)

+ log

πexp(−λr)

exp

N log

cosh( γ
N )

ρ(m′)

,
to get rid of the appearance of the unobserved Gibbs prior πexp(−βR) in most places
of the right-hand side of our inequality, leading to
Theorem 2.1.1.
For any real constants β and γ, with P probability at least 1 −ϵ,
for any posterior distribution ρ : Ω →M1
+(Θ), for any real constant λ,

N tanh( γ
N ) −β

ρ(R) −πexp(−βR)(R)

≤−N log

1 −tanh( γ
N )

ρ(R) −πexp(−βR)(R)

−β

ρ(R) −πexp(−βR)(R)

≤(γ −λ)

ρ(r) −πexp(−βR)(r)

+ K

ρ, πexp(−λr)


2.1.
Bounds relative to a Gibbs distribution
53
+ log

πexp(−λr)

exp

N log

cosh( γ
N )

ρ(m′)

−log(ϵ)
= K

ρ, πexp(−γr)

+ log

πexp(−γr)

exp

(γ −λ)r + N log

cosh( γ
N )

ρ(m′)

−(γ −λ)πexp(−βR)(r) −log(ϵ).
We would like to have a fully empirical upper bound even in the case when λ ̸= γ.
This can be done by using the theorem twice. We will need a lemma.
Lemma 2.1.2 For any probability distribution π ∈M1
+(Θ), for any bounded mea-
surable functions g, h : Θ →R,
πexp(−g)(g) −πexp(−h)(g) ≤πexp(−g)(h) −πexp(−h)(h).
Proof. Let us notice that
0 ≤K(πexp(−g), πexp(−h)) = πexp(−g)(h) + log

π

exp(−h)

+ K(πexp(−g), π)
= πexp(−g)(h) −πexp(−h)(h) −K(πexp(−h), π) + K(πexp(−g), π)
= πexp(−g)(h) −πexp(−h)(h) −K(πexp(−h), π) −πexp(−g)(g) −log

π

exp(−g)

.
Moreover
−log

π

exp(−g)

≤πexp(−h)(g) + K(πexp(−h), π),
which ends the proof. □
For any positive real constants β and λ, we can then apply Theorem 2.1.1 to
ρ = πexp(−λr), and use the inequality
(2.5)
λ
β

πexp(−λr)(r) −πexp(−βR)(r)

≤πexp(−λr)(R) −πexp(−βR)(R)
provided by the previous lemma. We thus obtain with P probability at least 1 −ϵ
−N log

1 −tanh( γ
N ) λ
β

πexp(−λr)(r) −πexp(−βR)(r)

−γ

πexp(−λr)(r) −πexp(−βR)(r)

≤log

πexp(−λr)

exp

N log

cosh( γ
N )

πexp(−λr)(m′)

−log(ϵ).
Let us introduce the convex function
Fγ,α(x) = −N log

1 −tanh( γ
N )x

−αx ≥

N tanh( γ
N ) −α

x.
With P probability at least 1 −ϵ,
−πexp(−βR)(r) ≤inf
λ∈R∗
+

−πexp(−λr)(r)
+ β
λF −1
γ, βγ
λ

log

πexp(−λr)

exp

N log

cosh( γ
N )

πexp(−λr)(m′)

−log(ϵ)

.
Since Theorem 2.1.1 holds uniformly for any posterior distribution ρ, we can apply
it again to some arbitrary posterior distribution ρ. We can moreover make the result
uniform in β and γ by considering some atomic measure ν ∈M1
+(R) on the real
line and using a union bound. This leads to

54
Chapter 2.
Comparing posterior distributions to Gibbs priors
Theorem 2.1.3.
For any atomic probability distribution on the positive real line
ν ∈M1
+(R+), with P probability at least 1 −ϵ, for any posterior distribution ρ :
Ω →M1
+(Θ), for any positive real constants β and γ,

N tanh( γ
N ) −β

ρ(R) −πexp(−βR)(R)

≤Fγ,β

ρ(R) −πexp(−βR)(R)

≤B(ρ, β, γ), where
B(ρ, β, γ) =
inf
λ1∈R+,λ1≤γ
λ2∈R,λ2> βγ
N tanh( γ
N )−1

K

ρ, πexp(−λ1r)

+ (γ −λ1)

ρ(r) −πexp(−λ2r)(r)

+ log

πexp(−λ1r)

exp

N log

cosh( γ
N )

ρ(m′)

−log

ϵν(β)ν(γ)

+ (γ −λ1) β
λ2
F −1
γ, βγ
λ2

log

πexp(−λ2r)

exp

N log

cosh( γ
N )

πexp(−λ2r)(m′)

−log

ϵν(β)ν(γ)

≤
inf
λ1∈R+,λ1≤γ
λ2∈R,λ2> βγ
N tanh( γ
N )−1

K

ρ, πexp(−λ1r)

+ (γ −λ1)

ρ(r) −πexp(−λ2r)(r)

+ log

πexp(−λ1r)

exp

N log

cosh( γ
N )

ρ(m′)

+ β
λ2
(1 −λ1
γ )
 N
γ tanh( γ
N ) −β
λ2
 log

πexp(−λ2r)

exp

N log

cosh( γ
N )

πexp(−λ2r)(m′)

−

1 + β
λ2
(1−λ1
γ )
[ N
γ tanh( γ
N )−β
λ2 ]

log

ϵν(β)ν(γ)


,
where we have written for short ν(β) and ν(γ) instead of ν({β}) and ν({γ}).
Let us notice that B(ρ, β, γ) = +∞when ν(β) = 0 or ν(γ) = 0, the uniformity
in β and γ of the theorem therefore necessarily bears on a countable number of
values of these parameters. We can typically choose distributions for ν such as the
one used in Theorem 1.2.8 (page 13): namely we can put for some positive real ratio
α > 1
ν(αk) =
1
(k + 1)(k + 2),
k ∈N,
or alternatively, since we are interested in values of the parameters less than N, we
can prefer
ν(αk) =
log(α)
log(αN),
0 ≤k < log(N)
log(α) .
We can also use such a coding distribution on dyadic numbers as the one deﬁned
by equation (1.7, page 15).

2.1.
Bounds relative to a Gibbs distribution
55
Following the same route as for Theorem 1.3.15 (page 30), we can also prove the
following result about the deviations under any posterior distribution ρ:
Theorem 2.1.4 For any ϵ ∈)0, 1(, with P probability at least 1−ϵ, for any posterior
distribution ρ : Ω →M1
+(Θ), with ρ probability at least 1 −ξ,
Fγ,β

R(	θ) −πexp(−βR)(R)

≤
inf
λ1∈R+,λ1≤γ,
λ2∈R,λ2> βγ
N tanh( γ
N )−1

log
&
dρ
dπexp(−λ1r)
(	θ )
'
+ (γ −λ1)

r(	θ ) −πexp(−λ2r)(r)

+ log

πexp(−λ1r)

exp

N log

cosh( γ
N )

m′(·, 	θ )

−log

ϵξν(β)ν(γ)

+ (γ −λ1) β
λ2
F −1
γ, βγ
λ2

log

πexp(−λ2r)

exp

N log

cosh( γ
N )

πexp(−λ2r)(m′)

−log

ϵν(β)ν(γ)

.
The only tricky point is to justify that we can still take an inﬁmum in λ1 without
using a union bound. To justify this, we have to notice that the following variant of
Theorem 2.1.1 (page 52) holds: with P probability at least 1 −ϵ, for any posterior
distribution ρ : Ω →M1
+(Θ), for any real constant λ,
ρ

Fγ,β

R −πexp(−βR)(R)

≤K

ρ, πexp(−γr)

+ ρ

inf
λ∈R log

πexp(−γr)

exp

(γ −λ)r + N log

cosh( γ
N

m′(·, 	θ )

−(γ −λ)πexp(−βR)(r)

−log(ϵ).
We leave the details as an exercise.
2.1.2. The effective temperature of a posterior distribution.
Using
the parametric approximation πexp(−αr)(r) −infΘ r ≃
de
α , we get as an order of
magnitude
B(πexp(−λ1r), β, γ) ≲−(γ −λ1)de

λ−1
2
−λ−1
1

+ 2de log
λ1
λ1 −N log

cosh( γ
N )

x
+ 2 β
λ2
(1 −λ1
γ )
 N
γ tanh( γ
N ) −β
λ2
de log
"
λ2
λ2 −N log

cosh( γ
N )

x
#
+ 2N log

cosh( γ
N )

1 + β
λ2
(1 −λ1
γ )
 N
γ tanh( γ
N ) −β
λ2


ϕ(x)
−

1 + β
λ2
(1 −λ1
γ )
[ N
γ tanh( γ
N ) −β
λ2 ]

log

ν(β)ν(γ)ϵ

.

56
Chapter 2.
Comparing posterior distributions to Gibbs priors
Therefore, if the empirical dimension de stays bounded when N increases, we are
going to obtain a negative upper bound for any values of the constants λ1 > λ2 > β,
as soon as γ and N
γ are chosen to be large enough. This ability to obtain negative
values for the bound B(πexp(−λ1r), γ, β), and more generally B(ρ, γ, β), leads the
way to introducing the new concept of the eﬀective temperature of an estimator.
Definition 2.1.1 For any posterior distribution ρ : Ω →M1
+(Θ) we deﬁne the
eﬀective temperature T(ρ) ∈R ∪{−∞, +∞} of ρ by the equation
ρ(R) = πexp(−
R
T (ρ) )(R).
Note that β →πexp(−βR)(R) : R ∪{−∞, +∞} →(0, 1) is continuous and strictly
decreasing from ess supπ R to ess infπ R (as soon as these two bounds do not co-
incide). This shows that the eﬀective temperature T(ρ) is a well-deﬁned random
variable.
Theorem 2.1.3 provides a bound for T(ρ), indeed:
Proposition 2.1.5.
Let
	β(ρ) = sup

β ∈R;
inf
γ,N tanh( γ
N )>β B(ρ, β, γ) ≤0

,
where B(ρ, β, γ) is as in Theorem 2.1.3 (page 54). Then with P probability at least
1−ϵ, for any posterior distribution ρ : Ω →M1
+(Θ), T(ρ) ≤	β(ρ)−1, or equivalently
ρ(R) ≤πexp[−	
β(ρ)R](R).
This notion of eﬀective temperature of a (randomized) estimator ρ is interesting
for two reasons:
• the diﬀerence ρ(R) −πexp(−βR)(R) can be estimated with better accuracy
than ρ(R) itself, due to the use of relative deviation inequalities, leading to
convergence rates up to 1/N in favourable situations, even when infΘ R is not
close to zero;
• and of course πexp(−βR)(R) is a decreasing function of β, thus being able to
estimate ρ(R) −πexp(−βR)(R) with some given accuracy, means being able
to discriminate between values of ρ(R) with the same accuracy, although
doing so through the parametrization β →πexp(−βR)(R), which can neither
be observed nor estimated with the same precision!
2.1.3. Analysis of an empirical bound for the effective temperature.
We are now going to launch into a mathematically rigorous analysis of the bound
B(πexp(−λ1r),β,γ) provided by Theorem 2.1.3 (page 54), to show that infρ∈M1
+(Θ)
πexp[−	
β(ρ)R](R) converges indeed to infΘ R at some optimal rate in favourable sit-
uations.
It is more convenient for this purpose to use deviation inequalities involving M ′
rather than m′. It is straightforward to extend Theorem 1.4.2 (page 35) to
Theorem 2.1.6. For any real constants β and γ, for any prior distributions π, μ ∈
M1
+(Θ), with P probability at least 1 −η, for any posterior distribution ρ : Ω →
M1
+(Θ),
γρ ⊗πexp(−βR)

Ψ γ
N (R′, M ′)

≤γρ ⊗πexp(−βR)(r′) + K(ρ, μ) −log(η).

2.1.
Bounds relative to a Gibbs distribution
57
In order to transform the left-hand side into a linear expression and in the same
time localize this theorem, let us choose μ deﬁned by its density
dμ
dπ (θ1) = C−1 exp

−βR(θ1)
−γ

Θ

Ψ γ
N

R′(θ1, θ2), M ′(θ1, θ2)

−N
γ sinh( γ
N )R′(θ1, θ2)

πexp(−βR)(dθ2)

,
where C is such that μ(Θ) = 1. We get
K(ρ, μ) = βρ(R) + γρ ⊗πexp(−βR)

Ψ γ
N (R′, M ′) −N
γ sinh( γ
N )R′
+ K(ρ, π)
+ log

Θ
exp

−βR(θ1)
−γ

Θ

Ψ γ
N

R′(θ1, θ2), M ′(θ1, θ2)

−N
γ sinh( γ
N )R′(θ1, θ2)

πexp(−βR)(dθ2)

π(dθ1)

= β

ρ(R) −πexp(−βR)(R)

+ γρ ⊗πexp(−βR)

Ψ γ
N (R′, M ′) −N
γ sinh( γ
N )R′
+ K(ρ, π) −K(πexp(−βR), π)
+ log

Θ
exp

−γ

Θ

Ψ γ
N

R′(θ1, θ2), M ′(θ1, θ2)

−N
γ sinh( γ
N )R′(θ1, θ2)

πexp(−βR)(dθ2)

πexp(−βR)(dθ1)

.
Thus with P probability at least 1 −η,
(2.6)

N sinh( γ
N ) −β

ρ(R) −πexp(−βR)(R)

≤γ

ρ(r)−πexp(−βR)(r)

+K(ρ, π)−K(πexp(−βR), π)−log(η)+C(β, γ)
where C(β, γ) = log

Θ
exp

−γ

Θ

Ψ γ
N

R′(θ1, θ2), M ′(θ1, θ2)

−N
γ sinh( γ
N )R′(θ1, θ2)

πexp(−βR)(dθ2)

πexp(−βR)(dθ1)

.
Remarking that
K

ρ, πexp(−βR)

= β

ρ(R) −πexp(−βR)(R)

+ K(ρ, π) −K(πexp(−βR), π),
we deduce from the previous inequality
Theorem 2.1.7.
For any real constants β and γ, with P probability at least 1−η,
for any posterior distribution ρ : Ω →M1
+(Θ),
N sinh( γ
N )

ρ(R) −πexp(−βR)(R)

≤γ

ρ(r) −πexp(−βR)(r)

+ K

ρ, πexp(−βR)

−log(η) + C(β, γ).

58
Chapter 2.
Comparing posterior distributions to Gibbs priors
We can also go into a slightly diﬀerent direction, starting back again from equa-
tion (2.6, page 57) and remarking that for any real constant λ,
λ

ρ(r) −πexp(−βR)(r)

+ K(ρ, π) −K(πexp(−βR), π)
≤λρ(r) + K(ρ, π) + log

π

exp(−λr)

= K

ρ, πexp(−λr)

.
This leads to
Theorem 2.1.8.
For any real constants β and γ, with P probability at least 1−η,
for any real constant λ,

N sinh( γ
N ) −β

ρ(R) −πexp(−βR)(R)

≤(γ −λ)

ρ(r) −πexp(−βR)(r)

+ K

ρ, πexp(−λr)

−log(η) + C(β, γ),
where the deﬁnition of C(β, γ) is given by equation (2.6, page 57).
We can now use this inequality in the case when ρ = πexp(−λr) and combine it
with Inequality (2.5, page 53) to obtain
Theorem 2.1.9 For any real constants β and γ, with P probability at least 1 −η,
for any real constant λ,
 Nλ
β sinh( γ
N ) −γ

πexp(−λr)(r) −πexp(−βR)(r)

≤C(β, γ) −log(η).
We deduce from this theorem
Proposition 2.1.10 For any real positive constants β1, β2 and γ, with P probabil-
ity at least 1 −η, for any real constants λ1 and λ2, such that λ2 < β2
γ
N sinh( γ
N )−1
and λ1 > β1
γ
N sinh( γ
N )−1,
πexp(−λ1r)(r) −πexp(−λ2r)(r) ≤πexp(−β1R)(r) −πexp(−β2R)(r)
+ C(β1, γ) + log(2/η)
Nλ1
β1 sinh( γ
N ) −γ
+ C(β2, γ) + log(2/η)
γ −Nλ2
β2 sinh( γ
N ) .
Moreover, πexp(−β1R) and πexp(−β2R) being prior distributions, with P probability
at least 1 −η,
γ

πexp(−β1R)(r) −πexp(−β2R)(r)

≤γπexp(−β1R) ⊗πexp(−β2R)

Ψ−γ
N (R′, M ′)

−log(η).
Hence
Proposition 2.1.11 For any positive real constants β1, β2 and γ, with P prob-
ability at least 1 −η, for any positive real constants λ1 and λ2 such that λ2 <
β2
γ
N sinh( γ
N )−1 and λ1 > β1
γ
N sinh( γ
N )−1,
πexp(−λ1r)(r) −πexp(−λ2r)(r)
≤πexp(−β1R) ⊗πexp(−β2R)

Ψ−γ
N (R′, M ′)

+
log( 3
η)
γ
+
C(β1, γ) + log( 3
η)
Nλ1
β1 sinh( γ
N ) −γ +
C(β2, γ) + log( 3
η)
γ −Nλ2
β2 sinh( γ
N ) .

2.1.
Bounds relative to a Gibbs distribution
59
In order to achieve the analysis of the bound B(πexp(−λ1r), β, γ) given by Theo-
rem 2.1.3 (page 54), it now remains to bound quantities of the general form
log

πexp(−λr)

exp

N log

cosh( γ
N )

πexp(−λr)(m′)

=
sup
ρ∈M1
+(Θ)
N log

cosh( γ
N )

ρ ⊗πexp(−λ)(m′) −K

ρ, πexp(−λr)

.
Let us consider the prior distribution μ ∈M1
+(Θ × Θ) on couples of parameters
deﬁned by the density
dμ
d(π ⊗π)(θ1, θ2) = C−1 exp

−βR(θ1) −βR(θ2) + αΦ−α
N

M ′(θ1, θ2)

,
where the normalizing constant C is such that μ(Θ×Θ) = 1. Since for ﬁxed values of
the parameters θ and θ′ ∈Θ, m′(θ, θ′), like r(θ), is a sum of independent Bernoulli
random variables, we can easily adapt the proof of Theorem 1.1.4 on page 4, to
establish that with P probability at least 1 −η, for any posterior distribution ρ and
any real constant λ,
αρ ⊗πexp(−λr)(m′) ≤αρ ⊗πexp(−λr)

Φ−α
N (M ′)

+ K(ρ ⊗πexp(−λr), μ) −log(η)
= K

ρ, πexp(−βR)

+ K

πexp(−λr), πexp(−βR)

+ log

πexp(−βR) ⊗πexp(−βR)

exp

αΦ−α
N ◦M ′
−log(η).
Thus for any real constant β and any positive real constants α and γ, with P
probability at least 1 −η, for any real constant λ,
(2.7)
log

πexp(−λr)

exp

N log

cosh( γ
N )

πexp(−λr)(m′)

≤
sup
ρ∈M1
+(Θ)
 
N
α log

cosh( γ
N )

K

ρ, πexp(−βR)

+ K

πexp(−λr), πexp(−βR)

+ log

πexp(−βR) ⊗πexp(−βR)

exp(αΦ−α
N ◦M ′)

−log(η)

−K

ρ, πexp(−λr)
!
.
To
ﬁnish,
we
need
some
appropriate
upper
bound
for
the
entropy
K

ρ, πexp(−βR)

. This question can be handled in the following way: using The-
orem 2.1.7 (page 57), we see that for any positive real constants γ and β, with P
probability at least 1 −η, for any posterior distribution ρ,
K

ρ, πexp(−βR)

= β

ρ(R) −πexp(−βR)(R)

+ K(ρ, π) −K(πexp(−βR), π)
≤
β
N sinh( γ
N )

γ

ρ(r) −πexp(−βR)(r)

+ K

ρ, πexp(−βR)

−log(η) + C(β, γ)

+ K(ρ, π) −K(πexp(−βR), π)
≤K

ρ, πexp(−
βγ
N sinh( γ
N ) r)


60
Chapter 2.
Comparing posterior distributions to Gibbs priors
+
β
N sinh( γ
N )

K

ρ, πexp(−βR)

+ C(β, γ) −log(η)

.
In other words,
Theorem 2.1.12. For any positive real constants β and γ such that β < N ×
sinh( γ
N ), with P probability at least 1 −η, for any posterior distribution ρ : Ω →
M1
+(Θ),
K

ρ, πexp(−βR)

≤
K

ρ, πexp[−β γ
N sinh( γ
N )−1r]

1 −
β
N sinh( γ
N )
+ C(β, γ) −log(η)
N sinh( γ
N )
β
−1
,
where the quantity C(β, γ) is deﬁned by equation (2.6, page 57). Equivalently, it will
be in some cases more convenient to use this result in the form: for any positive real
constants λ and γ, with P probability at least 1 −η, for any posterior distribution
ρ : Ω →M1
+(Θ),
K

ρ, πexp[−λ N
γ sinh( γ
N )R]

≤K

ρ, πexp(−λr)

1 −λ
γ
+
C(λ N
γ sinh( γ
N ), γ) −log(η)
λ
β −1
.
Choosing in equation (2.7, page 59) α = N log

cosh( γ
N )

1 −
β
N sinh( γ
N )
and β = λ N
γ sinh( γ
N ),
so that α = N log

cosh( γ
N )

1 −λ
γ
, we obtain with P probability at least 1 −η,
log

πexp(−λr)

exp

N log

cosh( γ
N )

πexp(−λr)(m′)

≤2λ
γ

C(β, γ) + log( 2
η)

+

1 −λ
γ

log

πexp(−βR) ⊗πexp(−βR)

exp(αΦ−α
N ◦M ′)

+ log( 2
η)

.
This proves
Proposition 2.1.13.
For any positive real constants λ < γ, with P probability at
least 1 −η,
log

πexp(−λr)

exp

N log

cosh( γ
N )

πexp(−λr)(m′)

≤2λ
γ

C( Nλ
γ sinh( γ
N ), γ) + log( 2
η)

+

1 −λ
γ

log

π⊗2
exp[−Nλ
γ
sinh( γ
N )R]

exp
 N log[cosh( γ
N )]
1 −λ
γ
Φ
−
log[cosh( γ
N )]
1−λ
γ
◦M ′
!
+

1 −λ
γ

log( 2
η).

2.1.
Bounds relative to a Gibbs distribution
61
We are now ready to analyse the bound B(πexp(−λ1r), β, γ) of Theorem 2.1.3
(page 54).
Theorem 2.1.14.
For any positive real constants λ1, λ2, β1, β2, β and γ, such
that
λ1 < γ,
β1 < Nλ1
γ
sinh( γ
N ),
λ2 < γ,
β2 > Nλ2
γ
sinh( γ
N ),
β < Nλ2
γ
tanh( γ
N ),
with P probability 1 −η, the bound B(πexp(−λ1r), β, γ) of Theorem 2.1.3 (page 54)
satisﬁes
B(πexp(−λ1r), β, γ)
≤(γ −λ1)

πexp(−β1R) ⊗πexp(−β2R)

Ψ−γ
N (R′, M ′)

+
log( 7
η)
γ
+
C(β1, γ) + log( 7
η)
Nλ1
β1 sinh( γ
N ) −γ +
C(β2, γ) + log( 7
η)
γ −Nλ2
β2 sinh( γ
N )

+ 2λ1
γ

C

 Nλ1
γ
sinh( γ
N ), γ

+ log( 7
η)

+

1 −λ1
γ

log

π⊗2
exp[−Nλ1
γ
sinh( γ
N )R]

exp
 
N log[cosh( γ
N )]
1−λ1
γ
Φ
−
log[cosh( γ
N )]
1−λ1
γ
◦M ′
!
+

1 −λ1
γ

log( 7
η) −log

ν({β})ν({γ})ϵ

+ (γ −λ1) β
λ2 F −1
γ, βγ
λ2

2λ2
γ

C

 Nλ2
γ
sinh( γ
N ), γ

+ log

 7
η

+

1 −λ2
γ

log

π⊗2
exp[−Nλ2
γ
sinh( γ
N )R]

exp
 N log[cosh( γ
N )]
1 −λ2
γ
Φ
−
log[cosh( γ
N )]
1−λ2
γ
◦M ′
!
+

1 −λ2
γ

log

 7
η

−log

ν({β})ν({γ})ϵ


,
where the function C(β, γ) is deﬁned by equation (2.6, page 57).
2.1.4. Adaptation to parametric and margin assumptions.
To help un-
derstand the previous theorem, it may be useful to give linear upper-bounds to the
factors appearing in the right-hand side of the previous inequality. Introducing θ
such that R(θ) = infΘ R (assuming that such a parameter exists) and remembering
that
Ψ−a(p, m) ≤a−1 sinh(a)p + 2a−1 sinh( a
2)2m,
a ∈R+,
Φ−a(p) ≤a−1
exp(a) −1

p,
a ∈R+,

62
Chapter 2.
Comparing posterior distributions to Gibbs priors
Ψa(p, m) ≥a−1 sinh(a)p −2a−1 sinh( a
2)2m,
a ∈R+,
M ′(θ1, θ2) ≤M ′(θ1, θ) + M ′(θ2, θ),
θ1, θ2 ∈Θ,
M ′(θ1, θ) ≤xR′(θ1, θ) + ϕ(x),
x ∈R+, θ1 ∈Θ,
the last inequality being rather a consequence of the deﬁnition of ϕ than a property
of M ′, we easily see that
πexp(−β1R) ⊗πexp(−β2R)

Ψ−γ
N (R′, M ′)

≤N
γ sinh( γ
N )

πexp(−β1R)(R) −πexp(−β2R)(R)

+ 2N
γ sinh( γ
2N )2πexp(−β1R) ⊗πexp(−β2R)(M ′)
≤N
γ sinh( γ
N )

πexp(−β1R)(R) −πexp(−β2R)(R)

+ 2xN
γ
sinh( γ
2N )2
πexp(−β1R)

R′(·, θ)

+ πexp(−β2R)

R′(·, θ)

+ 4N
γ sinh( γ
2N )2ϕ(x),
that
C(β, γ) ≤log

πexp(−βR)

exp

2N sinh

 γ
2N
2πexp(−βR)(M ′)

≤log

πexp(−βR)

exp

2N sinh

 γ
2N
2M ′(·, θ)

+ 2N sinh( γ
2N )2πexp(−βR)

M ′(·, θ)

≤log

πexp(−βR)

exp

2xN sinh( γ
2N )2R′(·, θ)

+ 2xN sinh( γ
2N )2πexp(−βR)

R′(·, θ)

+ 4N sinh( γ
2N )2ϕ(x)
=
 β
β−2xN sinh( γ
2N )2 πexp(−αR)

R′(·, θ)

dα
+ 2xN sinh( γ
2N )2πexp(−βR)

R′(·, θ)

+ 4N sinh( γ
2N )2ϕ(x)
≤4xN sinh( γ
2N )2πexp[−(β−2xN sinh( γ
2N )2)R]

R′(·, θ)

+ 4N sinh( γ
2N )2ϕ(x),
and that
log

π⊗2
exp(−βR)

exp

NαΦ−α◦M ′
≤2 log

πexp(−βR)

exp

N

exp(α) −1

M ′(·, θ)

≤2xN

exp(α) −1

πexp[−(β−xN[exp(α)−1])R]

R′(·, θ)

+ 2xN

exp(α) −1

ϕ(x).
Let us push further the investigation under the parametric assumption that for
some positive real constant d
(2.8)
lim
β→+∞βπexp(−βR)

R′(·, θ)

= d,

2.1.
Bounds relative to a Gibbs distribution
63
This assumption will for instance hold true with d = n
2 when R : Θ →(0, 1) is a
smooth function deﬁned on a compact subset Θ of Rn that reaches its minimum
value on a ﬁnite number of non-degenerate (i.e. with a positive deﬁnite Hessian)
interior points of Θ, and π is absolutely continuous with respect to the Lebesgue
measure on Θ and has a smooth density.
In case of assumption (2.8), if we restrict ourselves to suﬃciently large values of
the constants β, β1, β2, λ1, λ2 and γ (the smaller of which is as a rule β, as we
will see), we can use the fact that for some (small) positive constant δ, and some
(large) positive constant A,
(2.9)
d
α(1 −δ) ≤πexp(−αR)

R′(·, θ)

≤d
α(1 + δ),
α ≥A.
Under this assumption,
πexp(−β1R) ⊗πexp(−β2R)

Ψ−γ
N (R′, M ′)

≤N
γ sinh( γ
N )
 d
β1 (1 + δ) −d
β2 (1 −δ)

+ 2xN
γ
sinh( γ
2N )2(1 + δ)
 d
β1 + d
β2

+ 4N
γ sinh( γ
2N )2ϕ(x).
C(β, γ) ≤d(1 + δ) log

β
β−2xN sinh( γ
2N )2

+ 2xN sinh( γ
2N )2 (1+δ)d
β
+ 4N sinh( γ
2N )2ϕ(x).
log

π⊗2
exp(−βR)

exp

NαΦ−α◦M ′
≤2xN

exp(α) −1

d(1 + δ)
β −xN[exp(α) −1] + 2N

exp(α) −1

ϕ(x).
Thus with P probability at least 1 −η,
B(πexp(−λ1r), β, γ) ≤−(γ −λ1) N
γ sinh( γ
N ) d
β2 (1 −δ)
+ (γ −λ1)

N
γ sinh( γ
N ) (1+δ)d
β1
+ 2xN
γ
sinh( γ
2N )2(1 + δ)
 d
β1 + d
β2

+ 4N
γ sinh( γ
2N )2ϕ(x) +
log( 7
η)
γ
+
4xN sinh( γ
2N )2
(1+δ)d
β1−2xN sinh( γ
2N )2 + 4N sinh( γ
2N )2ϕ(x) + log( 7
η)
Nλ1
β1 sinh( γ
N ) −γ
+
4xN sinh( γ
2N )2
(1+δ)d
β2−2xN sinh( γ
2N )2 + 4N sinh( γ
2N )2ϕ(x) + log( 7
η)
γ −Nλ2
β2 sinh( γ
N )

+ 2λ1
γ

4xN sinh( γ
2N )2
(1+δ)d
Nλ1
γ
sinh( γ
N )−2xN sinh( γ
2N )2
+ 4N sinh( γ
2N )2ϕ(x) + log( 7
η)

+

1 −λ1
γ

2d(1 + δ)
"
λ1 sinh

 γ
N

xγ

exp

log[cosh( γ
N )]
1−λ1
γ

−1
 −1
#−1
+ 2N

exp

log[cosh( γ
N )]
1−λ1
γ

−1

ϕ(x)


64
Chapter 2.
Comparing posterior distributions to Gibbs priors
+

1 −λ1
γ

log( 7
η) −log

ν({β})ν({γ})ϵ

+
1 −λ1
γ
Nλ2
βγ tanh( γ
N ) −1

2λ2
γ

4xN sinh( γ
2N )2
(1+δ)d
Nλ2
γ
sinh( γ
N )−2xN sinh( γ
2N )2
+ 4N sinh( γ
2N )2ϕ(x) + log( 7
η)

+

1 −λ2
γ
&
2d(1 + δ)
"
λ2 sinh

 γ
N

xγ

exp

log[cosh( γ
N )]
1−λ2
γ

−1
 −1
#−1
+ 2N

exp
 log[cosh( γ
N )]
1−λ2
γ

−1

ϕ(x)
'
+

1 −λ2
γ

log( 7
η) −log

ν(β)ν(γ)ϵ


.
Now let us choose for simplicity β2 = 2λ2 = 4β, β1 = λ1/2 = γ/4, and let us
introduce the notation
C1 = N
γ sinh( γ
N ),
C2 = N
γ tanh( γ
N ),
C3 = N 2
γ2

exp( γ2
N 2 ) −1

and
C4 =
2N 2(1 −2β
γ )
γ2

exp

γ2
2N 2(1 −2β
γ )

−1

,
to obtain
B(πexp(−λ1r), β, γ) ≤−C1γ
8β (1 −δ)d
+ C1γ
2

4(1+δ)d
γ
+ x γ
2N (1 + δ)
 4d
γ +
d
4β

+ γ
N ϕ(x)

+ 1
2 log

 7
η

+
1
2C1 −1

(1 + δ)d

N
2xC1γ −1
−1
+ C1
γ2
2N ϕ(x) + 1
2 log( 7
η)

+
1
2 −C1

2(1 + δ)d

8Nβ
xC1γ2 −1
−1
+ C1
γ2
N ϕ(x) + log( 7
η)

+ 2xγ(1 + δ)d
N −xγ
+ C1
γ2
N ϕ(x) + log( 7
η)
+ d(1 + δ)xγ
N
 C1
2C3
−xγ
N
!−1
+ γ2
N C3ϕ(x) +
log( 7
η)
2
−log

ν(β)ν(γ)ϵ

+

4C2 −2
−1

4β
γ

xγ2
N C1(1 + δ)d

2βC1 −xC1
γ2
2N
−1
+ γ2
N ϕ(x) + log( 7
η)

+

1 −2β
γ

2d(1 + δ)xγ
N
4βC1
γC4
 
1 −2β
γ
!
−xγ
N
−1

2.1.
Bounds relative to a Gibbs distribution
65
+
γ2
N(1 −2β
γ )
C4ϕ(x)

+

1 −2β
γ

log( 7
η) −log

ν(β)ν(γ)ϵ


.
This simpliﬁes to
B(πexp(−λ1r), β, γ) ≤−C1
8 (1 −δ)dγ
β
+ 2C1(1 + δ)d + log( 7
η)

2 +
3C1
(4C1−2)(2−C1) +
1 + 2β
γ
4C2 −2

−

1 +
1
4C2−2

log

ν(β)ν(γ)ϵ

+ (1 + δ)dxγ
N

C1 +
1
2C1−1

1
2C1 −γx
N
−1
+ 2

1 −γx
N
−1
+

C1
2C3 −γx
N
−1
+
4C1β
γ(4C2−2)

+ (1 + δ)dxγ2
Nβ

C1
16 +
2
2−C1

8
C1 −xγ2
Nβ
−1
+

1 −2β
γ

1
2C2−1

4C1
C4

1 −2β
γ

−γ2x
βN
−1
+ γ2
N ϕ(x)

3C1
2
+
C1
4C1−2 +
C1
2−C1 + C3 +
4β
γ(4C2−2) +
C4
4C2−2

.
This shows that there exist universal positive real constants A1, A2, B1, B2, B3,
and B4 such that as soon as γ max{x,1}
N
≤A1
β
γ ≤A2,
B(πexp(−λ1r), β, γ) ≤−B1(1 −δ)dγ
β + B2(1 + δ)d
−B3 log

ν(β)ν(γ)ϵ η

+ B4
γ2
N ϕ(x).
Thus πexp(−λ1r)(R) ≤πexp(−βR)(R) ≤infΘ R + (1+δ)d
β
as soon as
β
γ ≤
B1
B2
(1+δ)
(1−δ) + B4
γ2
N ϕ(x)−B3 log[ν(β)ν(γ)ϵη]
(1−δ)d
.
Choosing some real ratio α > 1, we can now make the above result uniform for
any
(2.10)
β, γ ∈Λα
def
=

αk; k ∈N, 0 ≤k < log(N)
log(α)

,
by substituting ν(β) and ν(γ) with
log(α)
log(αN) and −log(η) with −log(η) + 2 ×
log

log(αN)
log(α)

.
Taking η = ϵ for simplicity, we can summarize our result in
Theorem 2.1.15.
There exist positive real universal constants A, B1, B2, B3
and B4 such that for any positive real constants α > 1, d and δ, for any prior

66
Chapter 2.
Comparing posterior distributions to Gibbs priors
distribution π ∈M1
+(Θ), with P probability at least 1 −ϵ, for any β, γ ∈Λα (where
Λα is deﬁned by equation (2.10) above) such that
sup
β′∈R,β′≥β
2222
β′
d

πexp(−β′R)(R) −inf
Θ R

−1
2222 ≤δ
and such that also for some positive real parameter x
γ max{x, 1}
N
≤Aβ
γ
and β
γ ≤
B1
B2
(1+δ)
(1−δ) +
B4
γ2
N ϕ(x)−2B3 log(ϵ)+4B3 log

log(N)
log(α)

(1−δ)d
,
the bound B(πexp(−γ
2 r), β, γ) given by Theorem 2.1.3 on page 54 in the case where we
have chosen ν to be the uniform probability measure on Λα, satisﬁes B(πexp(−γ
2 r), β,
γ) ≤0, proving that 	β(πexp(−γ
2 r)) ≥β and therefore that
πexp(−γ r
2 )(R) ≤πexp(−βR)(R) ≤inf
Θ R + (1 + δ)d
β
.
What is important in this result is that we do not only bound πexp(−γ
2 r)(R),
but also B(πexp(−γ
2 r), β, γ), and that we do it uniformly on a grid of values of β
and γ, showing that we can indeed set the constants β and γ adaptively using the
empirical bound B(πexp(−γ
2 r), β, γ).
Let us see what we get under the margin assumption (1.24, page 39). When
κ = 1, we have ϕ(c−1) ≤0, leading to
Corollary 2.1.16. Assuming that the margin assumption (1.24, page 39) is sat-
isﬁed for κ = 1, that R : Θ →(0, 1) is independent of N (which is the case for
instance when P = P ⊗N), and is such that
lim
β′→+∞β′
πexp(−β′R)(R) −inf
Θ R

= d,
there are universal positive real constants B5 and B6 and N1 ∈N such that for any
N ≥N1, with P probability at least 1 −ϵ
πexp(−	γ r
2 )(R) ≤inf
Θ R + B5d
cN

1 + B6
d log
 log(N)
ϵ
!2
,
where 	γ ∈arg maxγ∈Λ2 max

β ∈Λ2; B(πexp(−γ r
2 ), β, γ) ≤0

, where Λ2 is deﬁned
by equation (2.10, page 65), and B is the bound of Theorem 2.1.3 (page 54).
When κ > 1, ϕ(x) ≤(1 −κ−1)

κcx
−
1
κ−1 , and we can choose γ and x such that
γ2
N ϕ(x) ≃d to prove
Corollary 2.1.17.
Assuming that the margin assumption (1.24, page 39) is sat-
isﬁed for some exponent κ > 1, that R : Θ →(0, 1) is independent of N (which is
for instance the case when P = P ⊗N), and is such that
lim
β′→+∞β′
πexp(−β′R)(R) −inf
Θ R

= d,
there are universal positive constants B7 and B8 and N1 ∈N such that for any
N ≥N1, with P probability at least 1 −ϵ,
πexp(−	γ r
2 )(R) ≤inf
Θ R + B7c−
1
2κ−1

1 + B8
d log
 log(N)
ϵ
!
2κ
2κ−1  d
N
!
κ
2κ−1
,

2.1.
Bounds relative to a Gibbs distribution
67
where 	γ ∈arg maxγ∈Λ2 max

β ∈Λ2; B(πexp(−γ r
2 ), β, γ) ≤0

, Λ2 being deﬁned by
equation (2.10, page 65) and B by Theorem 2.1.3 (page 54).
We ﬁnd the same rate of convergence as in Corollary 1.4.7 (page 40), but this
time, we were able to provide an empirical posterior distribution πexp(−	γ r
2 ) which
achieves this rate adaptively in all the parameters (meaning in particular that we do
not need to know d, c or κ). Moreover, as already mentioned, the power of N in this
rate of convergence is known to be optimal in the worst case (see Mammen et al.
(1999); Tsybakov (2004); Tsybakov et al. (2005), and more speciﬁcally in Audibert
(2004b) — downloadable from its author’s web page — Theorem 3.3, page 132).
2.1.5. Estimating the divergence of a posterior with respect to a
Gibbs prior.
Another interesting question is to estimate K

ρ, πexp(−βR)

using
relative deviation inequalities. We follow here an idea to be found ﬁrst in (Audib-
ert, 2004b, page 93). Indeed, combining equation (2.3, page 52) with equation (2.1,
page 51), we see that for any positive real parameters β and λ, with P probability
at least 1 −ϵ, for any posterior distribution ρ : Ω →M1
+(Θ),
K

ρ, πexp(−βR)

≤
β
N tanh( γ
N )

γ

ρ(r) −πexp(−βR)(r)

+ N log

cosh( γ
N )

ρ ⊗πexp(−βR)(m′)
+ K

ρ, πexp(−βR)

−log(ϵ)

+ K(ρ, π) −K

πexp(−βR), π

≤K

ρ, πexp[−
βγ
N tanh( γ
N ) r]

+
β
N tanh( γ
N )

K

ρ, πexp(−βR)

−log(ϵ)

+ log

πexp[−
βγ
N tanh( γ
N ) r]

exp

β
tanh( γ
N ) log

cosh( γ
N )

ρ(m′)

.
We thus obtain
Theorem 2.1.18.
For any positive real constants β and γ such that β < N ×
tanh( γ
N ), with P probability at least 1 −ϵ, for any posterior distribution ρ : Ω →
M1
+(Θ),
K

ρ, πexp(−βR)

≤
 
1 −β
N tanh
 γ
N
−1!−1
×

K

ρ, πexp[−βγ
N tanh( γ
N )−1r]

−
β
N tanh( γ
N ) log(ϵ)
+ log

πexp[−βγ
N tanh( γ
N )−1r]

exp

β tanh( γ
N )−1 log[cosh( γ
N )]ρ(m′)

.
This theorem provides another way of measuring over-ﬁtting, since it gives an
upper bound for K

πexp[−βγ
N tanh( γ
N )−1r], πexp(−βR)

. It may be used in combination
with Theorem 1.2.6 (page 11) as an alternative to Theorem 1.3.7 (page 21). It will
also be used in the next section.
An alternative parametrization of the same result providing a simpler right-hand
side is also useful:

68
Chapter 2.
Comparing posterior distributions to Gibbs priors
Corollary 2.1.19.
For any positive real constants β and γ such that β < γ,
with P probability at least 1 −ϵ, for any posterior distribution ρ : Ω →M1
+(Θ),
K

ρ, πexp[−N β
γ tanh( γ
N )R]

≤
 
1 −β
γ
!−1
K

ρ, πexp(−βr)

−β
γ log(ϵ)
+ log

πexp(−βr)

exp

N β
γ log

cosh( γ
N )

ρ(m′)

.
2.2. Playing with two posterior and two local prior distributions
2.2.1. Comparing two posterior distributions.
Estimating the eﬀective
temperature of an estimator provides an eﬃcient way to tune parameters in a
model with parametric behaviour. On the other hand, it will not be ﬁtted to choose
between diﬀerent models, especially when they are nested, because as we already
saw in the case when Θ is a union of nested models, the prior distribution πexp(−βR)
does not provide an eﬃcient localization of the parameter in this case, in the sense
that πexp(−βR)(R) does not go down to infΘ R at the desired rate when β goes to
+∞, requiring a resort to partial localization.
Once some estimator (in the form of a posterior distribution) has been chosen
in each sub-model, these estimators can be compared between themselves with the
help of the relative bounds that we will establish in this section. It is also possible
to choose several estimators in each sub-model, to tune parameters in the same
time (like the inverse temperature parameter if we decide to use Gibbs posterior
distributions in each sub-model).
From equation (2.2 page 52) (slightly modiﬁed by replacing π ⊗π with π1 ⊗π2),
we easily obtain
Theorem 2.2.1.
For any positive real constant λ, for any prior distributions
π1, π2 ∈M1
+(Θ), with P probability at least 1 −ϵ, for any posterior distributions ρ1
and ρ2 : Ω →M1
+(Θ),
−N log

1 −tanh

 λ
N

ρ2(R) −ρ1(R)

≤λ

ρ2(r) −ρ1(r)

+ N log

cosh

 λ
N

ρ1 ⊗ρ2(m′)
+ K

ρ1, π1
+ K

ρ2, π2
−log(ϵ).
This is where the entropy bound of the previous section enters into the game,
providing a localized version of Theorem 2.2.1 (page 68). We will use the notation
(2.11)
Ξa(q) = tanh(a)−1
1 −exp(−aq)

≤
a
tanh(a)q,
a, q ∈R.
Theorem 2.2.2.
For any ϵ ∈)0, 1(, any sequence of prior distributions (πi)i∈N ∈
M1
+(Θ)N, any probability distribution μ on N, any atomic probability distribution ν
on R+, with P probability at least 1 −ϵ, for any posterior distributions ρ1, ρ2 : Ω →
M1
+(Θ),
ρ2(R) −ρ1(R) ≤B(ρ1, ρ2), where

2.2.
Playing with two posterior and two local prior distributions
69
B(ρ1, ρ2) =
inf
λ,β1<γ1,β2<γ2∈R+,i,j∈N Ξ λ
N


ρ2(r) −ρ1(r)

+ N
λ log

cosh( λ
N )

ρ1 ⊗ρ2(m′)
+
1
λ

1 −β1
γ1


K

ρ1, πi
exp(−β1r)

+ log

πi
exp(−β1r)

exp

β1 N
γ1 log

cosh( γ1
N )

ρ1(m′)

−β1
γ1
log

ν(γ1)

+
1
λ

1 −β2
γ2


K

ρ2, πj
exp(−β2r)

+ log

πj
exp(−β2r)

exp

β2 N
γ2 log

cosh( γ2
N )

ρ2(m′)

−β2
γ2
log

ν(γ2)

−

 γ1
β1 −1
−1 +

 γ2
β2 −1
−1 + 1
log

3−1ν(β1)ν(β2)ν(λ)μ(i)μ(j)ϵ

λ

.
The sequence of prior distributions (πi)i∈N should be understood to be typically
supported by subsets of Θ corresponding to parametric sub-models, that is sub-
models for which it is reasonable to expect that
lim
β→+∞β

πi
exp(−βR)(R) −ess inf
πi R

exists and is positive and ﬁnite. As there is no reason why the bound B(ρ1, ρ2) pro-
vided by the previous theorem should be sub-additive (in the sense that B(ρ1, ρ3) ≤
B(ρ1, ρ2)+B(ρ2, ρ3)), it is adequate to consider some workable subset P of posterior
distributions (for instance the distributions of the form πi
exp(−βr), i ∈N, β ∈R+),
and to deﬁne the sub-additive chained bound
(2.12)
B(ρ, ρ′) = inf
n−1

k=0
B(ρk, ρk+1); n ∈N∗, (ρk)n
k=0 ∈Pn+1,
ρ0 = ρ, ρn = ρ′

,
ρ, ρ′ ∈P.
Proposition 2.2.3.
With P probability at least 1 −ϵ, for any posterior distribu-
tions ρ1, ρ2 ∈P, ρ2(R)−ρ1(R) ≤B(ρ1, ρ2). Moreover for any posterior distribution
ρ1 ∈P, any posterior distribution ρ2 ∈P such that B(ρ1, ρ2) = infρ3∈P B(ρ1, ρ3) is
unimprovable with the help of B in P in the sense that infρ3∈P B(ρ2, ρ3) ≥0.
Proof. The ﬁrst assertion is a direct consequence of the previous theorem, so only
the second assertion requires a proof: for any ρ3 ∈P, we deduce from the optimality
of ρ2 and the sub-additivity of B that
B(ρ1, ρ2) ≤B(ρ1, ρ3) ≤B(ρ1, ρ2) + B(ρ2, ρ3).
□

70
Chapter 2.
Comparing posterior distributions to Gibbs priors
This proposition provides a way to improve a posterior distribution ρ1 ∈P by
choosing ρ2 ∈arg minρ∈P B(ρ1, ρ) whenever B(ρ1, ρ2) < 0. This improvement is
proved by Proposition 2.2.3 to be one-step: the obtained improved posterior ρ2
cannot be improved again using the same technique.
Let us give some examples of possible starting distributions ρ1 for this improve-
ment scheme: ρ1 may be chosen as the best posterior Gibbs distribution according
to Proposition 2.1.5 (page 56). More precisely, we may build from the prior distrib-
utions πi, i ∈N, a global prior π = 
i∈N μ(i)πi. We can then deﬁne the estimator
of the inverse eﬀective temperature as in Proposition 2.1.5 (page 56) and choose
ρ1 ∈arg minρ∈P 	β(ρ), where P is as suggested above the set of posterior distribu-
tions
P =

πi
exp(−βr); i ∈N, β ∈R+

.
This starting point ρ1 should already be pretty good, at least in an asymptotic
perspective, the only gain in the rate of convergence to be expected bearing on
spurious log(N) factors.
2.2.2. Elaborate uses of relative bounds between posteriors.
More
elaborate uses of relative bounds are described in the third section of the second
chapter of Audibert (2004b), where an algorithm is proposed and analysed, which
allows one to use relative bounds between two posterior distributions as a stand-
alone estimation tool.
Let us give here some alternative way to address this issue. We will assume for
simplicity and without great loss of generality that the working set of posterior
distributions P is ﬁnite (so that among other things any ordering of it has a ﬁrst
element).
It is natural to deﬁne the estimated complexity of any given posterior distribution
ρ ∈P in our working set as the bound for infi∈N K(ρ, πi) used in Theorem 2.2.1
(page 68). This leads to set (given some conﬁdence level 1 −ϵ)
C(ρ) =
inf
β<γ∈R+,i∈N
 
1 −β
γ
!−1
K

ρ, πi
exp(−βr)

+ log

πi
exp(−βr)

exp

β N
γ log

cosh( γ
N )

ρ(m′)

−β
γ log

3−1ν(γ)ν(β)μ(i)ϵ

.
Let us moreover call γ(ρ), β(ρ) and i(ρ) the values achieving this inﬁmum, or
nearly achieving it, which requires a slight change of the deﬁnition of C(ρ) to take
this modiﬁcation into account. For the sake of simplicity, we can assume without
substantial loss of generality that the supports of ν and μ are large but ﬁnite, and
thus that the minimum is reached.
To understand how this notion of complexity comes into play, it may be inter-
esting to keep in mind that for any posterior distributions ρ and ρ′ we can write
the bound in Theorem 2.2.2 (page 68) as
(2.13)
B(ρ, ρ′) = inf
λ∈R+ Ξ λ
N

ρ′(r) −ρ(r) + Sλ(ρ, ρ′)

,
where
Sλ(ρ, ρ′) = Sλ(ρ′, ρ) ≤N
λ log

cosh( λ
N )

ρ ⊗ρ′(m′) + C(ρ) + C(ρ′)
λ
−log(3−1ϵ)
λ

2.2.
Playing with two posterior and two local prior distributions
71
−log

ν

β(ρ)

μ

i(ρ)

λ

1 −β(ρ′)
γ(ρ′)

−log

ν

β(ρ′)

μ

i(ρ′)

λ

1 −β(ρ)
γ(ρ)

−

 γ(ρ)
β(ρ) −1
−1 +

 γ(ρ′)
β(ρ′) −1
−1 + 1
log

ν(λ)

λ
.
(Let us recall that the function Ξ is deﬁned by equation (2.11, page 68).) Thus for
any ρ, ρ′ such that B(ρ′, ρ) > 0, we can deduce from the monotonicity of Ξ λ
N that
ρ′(r) −ρ(r) ≤inf
λ∈R+ Sλ(ρ, ρ′),
proving that the left-hand side is small, and consequently that B(ρ, ρ′) and its
chained counterpart deﬁned by equation (2.12, page 69) are small:
B(ρ, ρ′) ≤B(ρ, ρ′) ≤inf
λ∈R+ Ξ λ
N

2Sλ(ρ, ρ′)

.
It is also worth noticing that B(ρ, ρ′) and B(ρ, ρ′) are upper bounded in terms of
variance and complexity only.
The presence of the ratios γ(ρ)
β(ρ) should not be obnoxious, since their values should
be automatically tamed by the fact that β(ρ) and γ(ρ) should make the estimate
of the complexity of ρ optimal.
As an alternative, it is possible to restrict to set of parameter values β and γ
such that, for some ﬁxed constant ζ > 1, the ratio γ
β is bounded away from 1 by
the inequality γ
β ≥ζ. This leads to an alternative deﬁnition of C(ρ):
C(ρ) =
inf
γ≥ζβ∈R+,i∈N
 
1 −β
γ
!−1
K

ρ, πi
exp(−βr)

+ log

πi
exp(−βr)

exp

β N
γ log

cosh( γ
N )

ρ(m′)

−β
γ log

3−1ν(γ)ν(β)μ(i)ϵ

−log

ν(β)μ(i)

(1 −ζ−1)
−log(3−1ϵ)
2
.
We can even push simpliﬁcation a step further, postponing the optimization of the
ratio γ
β , and setting it to the ﬁxed value ζ. This leads us to adopt the deﬁnition
(2.14)
C(ρ) =
inf
β∈R+,i∈N

1 −ζ−1−1

K

ρ, πi
exp(−βr)

+ log

πi
exp(−βr)

exp
 N
ζ log

cosh( ζβ
N )

ρ(m′)

−ζ + 1
ζ −1

log

ν(β)μ(i)

+ 2−1 log(3−1ϵ)

.
With either of these modiﬁed deﬁnitions of the complexity C(ρ), we get the upper
bound
(2.15)
Sλ(ρ, ρ′) ≤Sλ(ρ, ρ′)
def
= N
λ log

cosh( λ
N )

ρ ⊗ρ′(m′)
+ 1
λ

C(ρ) + C(ρ′) −ζ + 1
ζ −1 log

ν(λ)

.

72
Chapter 2.
Comparing posterior distributions to Gibbs priors
With these deﬁnitions, we have for any posterior distributions ρ and ρ′
B(ρ, ρ′) ≤inf
λ∈R+ Ξ λ
N

ρ′(r) −ρ(r) + Sλ(ρ, ρ′)

.
Consequently in the case when B(ρ′, ρ) > 0, we get
B(ρ, ρ′) ≤B(ρ, ρ′) ≤inf
λ∈R+ Ξ λ
N

2Sλ(ρ, ρ′)

.
To select some nearly optimal posterior distribution in P, it is appropriate to or-
der the posterior distributions of P according to increasing values of their complex-
ity C(ρ) and consider some indexation P = {ρ1, . . . , ρM}, where C(ρk) ≤C(ρk+1),
1 ≤k < M.
Let us now consider for each ρk ∈P the ﬁrst posterior distribution in P which
cannot be proved to be worse than ρk according to the bound B:
(2.16)
t(k) = min

j ∈{1, . . . M} : B(ρj, ρk) > 0

.
In this deﬁnition, which uses the chained bound deﬁned by equation (2.12, page
69), it is appropriate to assume by convention that B(ρ, ρ) = 0, for any posterior
distribution ρ. Let us now deﬁne our estimated best ρ ∈P as ρ	k, where
(2.17)
	k = min(arg max t).
Thus we take the posterior with smallest complexity which can be proved to be bet-
ter than the largest starting interval of P in terms of estimated relative classiﬁcation
error.
The following theorem is a simple consequence of the chosen optimisation scheme.
It is valid for any arbitrary choice of the complexity function ρ →C(ρ).
Theorem 2.2.4.
Let us put 	t = t(	k), where t is deﬁned by equation (2.16) and 	k
is deﬁned by equation (2.17). With P probability at least 1 −ϵ,
ρ	k(R) ≤ρj(R) +
⎧
⎪
⎪
⎪
⎨
⎪
⎪
⎪
⎩
0,
1 ≤j < 	t,
B(ρj, ρt(j)),
	t ≤j < 	k,
B(ρj, ρ	t) + B(ρ	t, ρ	k),
j ∈(arg max t),
B(ρj, ρ	k),
j ∈
	k + 1, . . . , M

\ (arg max t),
where the chained bound B is deﬁned from the bound of Theorem 2.2.2 (page 68)
by equation (2.12, page 69). In the mean time, for any j such that 	t ≤j < 	k,
t(j) < 	t = max t, because j ̸∈(arg max t). Thus
ρ	k(R) ≤ρt(j)(R) ≤ρj(R) + inf
λ∈R+ Ξ λ
N

2Sλ(ρj, ρt(j))

while ρt(j)(r) ≤ρj(r) + inf
λ∈R+ Sλ(ρj, ρt(j)),
where the function Ξ is deﬁned by equation (2.11, page 68) and Sλ is deﬁned by
equation (2.13, page 70). For any j ∈(arg max t), (including notably 	k),
B(ρ	t, ρj) ≥B(ρ	t, ρj) > 0,

2.2.
Playing with two posterior and two local prior distributions
73
B(ρj, ρ	t) ≥B(ρj, ρ	t) > 0,
so in this case
ρ	k(R) ≤ρj(R) + inf
λ∈R+ Ξ λ
N

Sλ(ρj, ρ	t) + Sλ(ρ	t, ρ	k) + Sλ(ρj, ρ	k)

,
while ρ	t(r) ≤ρj(r) + inf
λ∈R+ Sλ(ρj, ρ	t),
ρ	k(r) ≤ρ	t(r) + inf
λ∈R+ Sλ(ρ	t, ρ	k),
and ρ	t(R) ≤ρj(R) + inf
λ∈R+ Ξ λ
N

2Sλ(ρj, ρ	t)

.
Finally in the case when j ∈
	k + 1, . . . , M

\ (arg max t), due to the fact that in
particular j ̸∈(arg max t),
B(ρ	k, ρj) ≥B(ρ	k, ρj) > 0.
Thus in this last case
ρ	k(R) ≤ρj(R) + inf
λ∈R+ Ξ λ
N

2Sλ(ρj, ρ	k)

,
while ρ	k(r) ≤ρj(r) + inf
λ∈R+ Sλ(ρj, ρ	k).
Thus for any j = 1, . . . , M, ρ	k(R)−ρj(R) is bounded from above by an empirical
quantity involving only variance and entropy terms of posterior distributions ρℓsuch
that ℓ≤j, and therefore such that C(ρℓ) ≤C(ρj). Moreover, these distributions ρℓ
are such that ρℓ(r) −ρj(r) and ρℓ(R) −ρj(R) have an empirical upper bound of
the same order as the bound stated for ρ	k(R) −ρj(R) — namely the bound for
ρℓ(r) −ρj(r) is in all circumstances not greater than Ξ−1
λ
N
applied to the bound
stated for ρ	k(R) −ρj(R), whereas the bound for ρℓ(R) −ρj(R) is always smaller
than two times the bound stated for ρ	k(R) −ρj(R). This shows that variance terms
are between posterior distributions whose empirical as well as expected error rates
cannot be much larger than those of ρj.
Let us remark that the estimation scheme described in this theorem is very
general, the same method can be used as soon as some conﬁdence interval for the
relative expected risks
−B(ρ2, ρ1) ≤ρ2(R) −ρ1(R) ≤B(ρ1, ρ2) with P probability at least 1 −ϵ,
is available. The deﬁnition of the complexity is arbitrary, and could in an abstract
context be chosen as
C(ρ1) = inf
ρ2̸=ρ1 B(ρ1, ρ2) + B(ρ2, ρ1).
Proof. The case when 1 ≤j < 	t is straightforward from the deﬁnitions: when
j < 	t, B(ρj, ρ	k) ≤0 and therefore ρ	k(R) ≤ρj(R).
In the second case, that is when 	t ≤j < 	k, j cannot be in arg max t, because of
the special choice of 	k in arg max t. Thus t(j) < 	t and we deduce from the ﬁrst case
that
ρ	k(R) ≤ρt(j)(R) ≤ρj(R) + B(ρj, ρt(j)).

74
Chapter 2.
Comparing posterior distributions to Gibbs priors
Moreover, we see from the deﬁntion of t that B(ρt(j), ρj) > 0, implying
ρt(j)(r) ≤ρj(r) + inf
λ∈R+ Sλ(ρj, ρt(j)),
and therefore that
ρ	k(R) ≤ρj(R) + inf
λ Ξ λ
N

2Sλ(ρj, ρt(j))

.
In the third case j belongs to arg max t. In this case, we are not sure that
B(ρ	k, ρj) > 0, and it is appropriate to involve 	t, which is the index of the ﬁrst
posterior distribution which cannot be improved by ρ	k, implying notably that
B(ρ	t, ρk) > 0 for any k ∈arg max t. On the other hand, ρ	t cannot either improve
any posterior distribution ρk with k ∈(arg max t), because this would imply for any
ℓ< 	t that B(ρℓ, ρ	t) ≤B(ρℓ, ρk) + B(ρk, ρ	t) ≤0, and therefore that t(	t) ≥	t + 1, in
contradiction of the fact that 	t = max t. Thus B(ρk, ρ	t) > 0, and these two remarks
imply that
ρ	t(r) ≤ρj(r) + inf
λ∈R+ Sλ(ρj, ρ	t),
ρ	k(r) ≤ρ	t(r) + inf
λ∈R+ Sλ(ρ	t, ρ	k)
≤ρj(r) + inf
λ∈R+ Sλ(ρj, ρ	t) + inf
λ∈R+ Sλ(ρ	t, ρ	k),
and consequently also that
ρ	k(R) ≤ρj(R) + B(ρj, ρ	k)
≤ρj(R) + inf
λ∈R+ Ξ λ
N

Sλ(ρj, ρ	t) + Sλ(ρ	t, ρ	k) + Sλ(ρj, ρ	k)

and that
ρ	t(R) ≤ρj(R) + inf
λ∈R+ Ξ λ
N

2Sλ(ρj, ρ	t)

≤ρj(R) + 2 inf
λ∈R+ 2Ξ λ
N

Sλ(ρj, ρ	t)

,
the last inequality being due to the fact that Ξ λ
N is a concave function. Let us
notice that it may be the case that 	k < 	t, but that only the case when j ≥	t is to
be considered, since otherwise we already know that ρ	k(R) ≤ρj(R).
In the fourth case, j is greater than 	k, and the complexity of ρj is larger than the
complexity of ρ	k. Moreover, j is not in arg max t, and thus B(ρ	k, ρj) > 0, because
otherwise, the sub-additivity of B would imply that B(ρℓ, ρj) ≤0 for any ℓ≤	t and
therefore that t(j) ≥	t = max t. Therefore
ρ	k(r) ≤ρj(r) + inf
λ∈R+ Sλ(ρj, ρ	k),
and
ρ	k(R) ≤ρj(R) + B(ρj, ρ	k) ≤ρj(R) + inf
λ∈R+ Ξ λ
N

2Sλ(ρj, ρ	k)

.
□

2.2.
Playing with two posterior and two local prior distributions
75
2.2.3. Analysis of relative bounds.
Let us start our investigation of the the-
oretical properties of the algorithm described in Theorem 2.2.4 (page 72) by com-
puting some non-random upper bounds for B(ρ, ρ′), the bound of Theorem 2.2.2
(page 68), and C(ρ), the complexity factor deﬁned by equation (2.14, page 71), for
any ρ, ρ′ ∈P.
This analysis will be done in the case when
P =

πi
exp(−βr) : ν(β) > 0, μ(i) > 0

,
in which it will be possible to get some control on the randomness of any ρ ∈P,
in addition to controlling the other random expressions appearing in the deﬁnition
of B(ρ, ρ′), ρ, ρ′ ∈P. We will also use a simpler choice of complexity function,
removing from equation (2.14 page 71) the optimization in i and β and using
instead the deﬁnition
(2.18)
C(πi
exp(−βr))
def
=

1 −ζ−1−1 log

πi
exp(−βr)

exp

N
ζ log

cosh

 ζβ
N

πi
exp(−βr)(m′)

+ ζ + 1
ζ −1 log

ν(β)μ(i)

.
With this deﬁnition,
Sλ(πi
exp(−βr), πj
exp(−β′r)) ≤N
λ log

cosh( λ
N )

πi
exp(−βr) ⊗πj
exp(−β′r)(m′)
+
C

πi
exp(−βr)

+ C

πj
exp(−β′r)

λ
+ (ζ + 1)
(ζ −1)λ log

3−1ν(λ)ϵ

,
where Sλ is deﬁned by equation (2.13, page 70), so that
B

πi
exp(−βr), πj
exp(−β′r)

= inf
λ∈R+ Ξ λ
N

πj
exp(−β′r)(r) −πi
exp(−βr)(r)
+ Sλ

πi
exp(−βr), πj
exp(−βr)

.
Let us successively bound the various random factors entering into the deﬁni-
tion of B

πi
exp(−βr), πj
exp(−β′r)

. The quantity πj
exp(−β′r)(r) −πi
exp(−βr)(r) can be
bounded using a slight adaptation of Proposition 2.1.11 (page 58).
Proposition 2.2.5.
For any positive real constants λ, λ′ and γ, with P probability
at least 1 −η, for any positive real constants β, β′ such that β < λ γ
N sinh( γ
N )−1
and β′ > λ′ γ
N sinh( γ
N )−1,
πj
exp(−β′r)(r) −πi
exp(−βr)(r)
≤πj
exp(−λ′R) ⊗πi
exp(−λR)

Ψ−γ
N (R′, M ′)

+
log

 3
η

γ
+
Cj(λ′, γ) + log( 3
η)
Nβ′
λ′ sinh( γ
N ) −γ
+
Ci(λ, γ) + log( 3
η)
γ −Nβ
λ sinh( γ
N )
,

76
Chapter 2.
Comparing posterior distributions to Gibbs priors
where
Ci(λ, γ)
def
= log

Θ
exp

−γ

Θ

Ψ γ
N

R′(θ1, θ2), M ′(θ1, θ2)

−N
γ sinh( γ
N )R′(θ1, θ2)

πi
exp(−λR)(dθ2)

πi
exp(−λR)(dθ1)

≤log

πi
exp(−λR)

exp

2N sinh

 γ
2N
2πi
exp(−λR)

M ′
.
As for πi
exp(−βr) ⊗πj
exp(−β′r)(m′), we can write with P probability at least 1 −η,
for any posterior distributions ρ and ρ′ : Ω →M1
+(Θ),
γρ ⊗ρ′(m′) ≤log

πi
exp(−λR) ⊗πj
exp(−λ′R)

exp

γΦ−γ
N (M ′)

+ K

ρ, πi
exp(−λR)

+ K

ρ′, πj
exp(−λ′R)

−log(η).
We can then replace λ with β N
λ sinh( λ
N ) and use Theorem 2.1.12 (page 60) to get
Proposition 2.2.6.
For any positive real constants γ, λ, λ′, β and β′, with P
probability 1 −η,
γρ ⊗ρ′(m′)
≤log

πi
exp[−β N
λ sinh( λ
N )R] ⊗πj
exp[−β′ N
λ′ sinh( λ′
N )R]

exp

γΦ−γ
N (M ′)

+
K

ρ, πi
exp(−βr)

1 −β
λ
+ Ci
β N
λ sinh( λ
N ), λ

−log( η
3)
λ
β −1
+
K

ρ′, πj
exp(−β′r)

1 −β′
λ′
+ Cj
β′ N
λ′ sinh( λ′
N ), λ′
−log( η
3)
λ
β′ −1
−log( η
3).
The last random factor in B(ρ, ρ′) that we need to upper bound is
log

πi
exp(−βr)

exp

β N
γ log

cosh( γ
N )

πi
exp(−βr)(m′)

.
A slight adaptation of Proposition 2.1.13 (page 60) shows that with P probability
at least 1 −η,
log

πi
exp(−βr)

exp

β N
γ log

cosh( γ
N )

πi
exp(−βr)(m′)

≤2β
γ Ci Nβ
γ sinh( γ
N ), γ

+

1 −β
γ

log

πi
exp[−Nβ
γ
sinh( γ
N )R]
⊗2
exp
 N log

cosh( γ
N )

γ
β −1
Φ
−
log[cosh( γ
N )]
γ
β −1
◦M ′
!
+

1 + β
γ

log( 2
η),
where as usual Φ is the function deﬁned by equation (1.1, page 2). This leads us to

2.2.
Playing with two posterior and two local prior distributions
77
deﬁne for any i, j ∈N, any β, β′ ∈R+,
(2.19)
C(i, β)
def
=
2
ζ −1Ci
N
ζ sinh( ζβ
N ), ζβ

+ log

πi
exp[−N
ζ sinh( ζβ
N )R]
⊗2

exp
 N log

cosh( ζβ
N )

ζ −1
Φ
−
log[cosh( ζβ
N )]
ζ−1
◦M ′
!
−ζ + 1
ζ −1

2 log

ν(β)μ(i)

+ log

 η
2

.
Recall that the deﬁnition of Ci(λ, γ) is to be found in Proposition 2.2.5, page 75.
Let us remark that, since
exp

NaΦ−a(p)

= exp

N log

1 +

exp(a) −1

p

≤exp

N

exp(a) −1

p

,
p ∈(0, 1), a ∈R,
we have
C(i, β) ≤
2
ζ −1 log

πi
exp[−N
ζ sinh( ζβ
N )R]

exp

2N sinh

 ζβ
2N
2πi
exp[−N
ζ sinh( ζβ
N )R]

M ′
+ log

πi
exp[−N
ζ sinh( ζβ
N )R]
⊗2
exp

N

exp

(ζ −1)−1 log

cosh

 ζβ
N

−1

M ′
−ζ + 1
ζ −1

2 log

ν(β)μ(i)

+ log

 η
2

.
Let us put
Sλ

(i, β), (j, β′)
 def
= N
λ log

cosh( λ
N )

inf
γ∈R+ γ−1

log

πi
exp[−N
ζ sinh( ζβ
N )R] ⊗πj
exp[−N
ζ sinh( ζβ′
N )R]

exp

γΦ−γ
N (M ′)

+
Ci N
ζ sinh( ζβ
N ), ζβ

−log( η
3)
ζ −1
+
Cj N
ζ sinh( ζβ′
N ), ζβ′
−log( η
3)
ζ −1
−log( η
3)

+ 1
λ

C(i, β) + C(j, β′) −ζ + 1
ζ −1 log

3−1ν(λ)ϵ

,
where
η = ν(γ)ν(β)ν(β′)μ(i)μ(j)η.
Let us remark that

78
Chapter 2.
Comparing posterior distributions to Gibbs priors
Sλ

(i, β), (j, β′)

≤inf
γ∈R+
λ
2Nγ log

πi
exp[−N
ζ sinh( ζβ
N )R] ⊗πj
exp[−N
ζ sinh( ζβ′
N )R]

exp

N

exp

 γ
N

−1

M ′
+
 
λ
2Nγ(ζ −1) +
2
λ(ζ −1)
!
log

πi
exp[−N
ζ sinh( ζβ
N )R]

exp

2N sinh

 ζβ
2N
2πi
exp[−N
ζ sinh( ζβ
N )R]

M ′
+ λ−1 log

πi
exp[−N
ζ sinh( ζβ
N )R]
⊗2
exp

N

exp

(ζ −1)−1 log

cosh

 ζβ
N

−1

M ′
+
 
λ
2Nγ(ζ −1) +
2
λ(ζ −1)
!
log

πj
exp[−N
ζ sinh( ζβ′
N )R]

exp

2N sinh

 ζβ′
2N
2πj
exp[−N
ζ sinh( ζβ′
N )R]

M ′
+ λ−1 log

πj
exp[−N
ζ sinh( ζβ′
N )R]
⊗2
exp

N

exp

(ζ −1)−1 log

cosh

 ζβ′
N

−1

M ′
−
(ζ + 1)λ
2N(ζ −1)γ log

3−1ν(γ)ν(β)ν(β′)μ(i)μ(j)η

−(ζ + 1)
(ζ −1)λ
 
2 log

2−1ν(β)ν(β′)μ(i)μ(j)η

+ log

3−1ν(λ)ϵ
!
.
Let us deﬁne accordingly
B

(i, β), (j, β′)
 def
=
inf
λ Ξ λ
N

inf
α,γ,α′,γ′

πj
exp(−α′R) ⊗πi
exp(−αR)

Ψ−λ
N (R′, M ′)

−log

η
3

λ
+ Cj(α′, γ′) −log

η
3

Nβ′
α′ sinh( γ′
N ) −γ′
+ Ci(α, γ) −log

η
3

γ −Nβ
α sinh( γ
N )

+ Sλ

(i, β), (j, β′)


,
where
η = ν(λ)ν(α)ν(γ)ν(β)ν(α′)ν(γ′)ν(β′)μ(i)μ(j)η.
Proposition 2.2.7.
• With P probability at least 1 −η, for any β ∈R+ and i ∈N,
C(πi
exp(−βr)) ≤C(i, β);
• With P probability at least 1 −3η, for any λ, β, β′ ∈R+, any i, j ∈N,
Sλ

(i, β), (j, β′)

≤Sλ

(i, β), (j, β′)

;

2.2.
Playing with two posterior and two local prior distributions
79
• With P probability at least 1 −4η, for any i, j ∈N, any β, β′ ∈R+,
B(πi
exp(−βr), πj
exp(−β′r)) ≤B

(i, β), (j, β′)

.
It is also interesting to ﬁnd a non-random lower bound for C(πi
exp(−βr)). Let us
start from the fact that with P probability at least 1 −η,
πi
exp(−αR) ⊗πi
exp(−αR)

Φ γ′
N (M ′)

≤πi
exp(−αR) ⊗πi
exp(−αR)(m′) −log(η)
γ′
.
On the other hand, we already proved that with P probability at least 1 −η,
0 ≤
 
1 −
α
N tanh( λ
N )
!
K

ρ, πi
exp(−αR)

≤
α
N tanh( λ
N )

λ

ρ(r) −πi
exp(αR)(r)

+ N log

cosh( λ
N )

ρ ⊗πi
exp(−αR)(m′) −log(η)

+ K

ρ, πi
−K

πi
exp(−αR), πi
.
Thus for any ξ > 0, putting β =
αλ
N tanh( λ
N ), with P probability at least 1 −η,
ξπi
exp(−αR) ⊗πi
exp(−αR)

Φ γ′
N (M ′)

≤πi
exp(−αR)

log

πi
exp(−βr)

exp

β N
λ log

cosh( λ
N )

πi
exp(−βr)(m′) + ξm′
−
 β
λ + ξ
γ′
!
log
 η
2
!
≤log

πi
exp(−βr)

exp

β N
λ log

cosh( λ
N )

πi
exp(−βr)(m′)

× πi
exp(−βr)

exp

β N
λ log

cosh( λ
N )

πi
exp(−βr)(m′) + ξm′
−
 
2β
λ + ξ
γ′
!
log
 η
2
!
≤2 log

πi
exp(−βr)

exp

ξ + β N
λ log

cosh( λ
N )

πi
exp(−βr)(m′)

−
 
2β
λ + ξ
γ′
!
log
 η
2
!
≤2 log

πi
exp(−βr)

exp

ξ + βλ
2N

πi
exp(−βr)(m′)

−
 2β
λ + ξ
γ′
!
log
 η
2
!
.
Taking ξ = βλ
2N , we get with P probability at least 1 −η

80
Chapter 2.
Comparing posterior distributions to Gibbs priors
βλ
4N

πi
exp[−β N
λ tanh( λ
N )R]
⊗2
Φ γ′
N

M ′
≤log

πi
exp(−βr)

exp
βλ
N πi
exp(−βr)(m′)

−
 2β
λ +
βλ
2Nγ′
!
log
 η
2
!
.
Putting
λ = N 2
γ log

cosh( γ
N )

and Υ(γ)
def
=
γ tanh
 N
γ log

cosh( γ
N )

N log

cosh( γ
N )

∼
γ→0 1,
this can be rewritten as
βN
4γ log

cosh( γ
N )

πi
exp(−βΥ(γ)R)
⊗2
Φ γ′
N

M ′
≤log

πi
exp(−βr)

exp

β N
γ log

cosh( γ
N )

πi
exp(−βr)(m′)

−
 
2βγ
N 2 log

cosh( γ
N )
 + βN log

cosh( γ
N )

2γγ′
!
log
 η
2
!
.
It is now tempting to simplify the picture a little bit by setting γ′ = γ, leading to
Proposition 2.2.8. With P probability at least 1 −η, for any i ∈N, any β ∈R+,
C

πi
exp(−βr)

≥C(i, β)
def
=
1
ζ −1

N
4 log

cosh( ζβ
N )

πi
exp(−βΥ(ζβ)R)
⊗2
Φ ζβ
N

M ′
+
"
2ζ2β2
N 2 log

cosh( ζβ
N )
 + N log

cosh( ζβ
N )

2ζβ
#
log

2−1ν(β)μ(i)η

−(ζ + 1)

log

ν(β)μ(i)

+ 2−1 log

3−1ϵ

,
where C

πi
exp(−βr)

is deﬁned by equation (2.18, page 75).
We are now going to analyse Theorem 2.2.4 (page 72). For this, we will also need
an upper bound for Sλ(ρ, ρ′), deﬁned by equation (2.13, page 70), using M ′ and
empirical complexities, because of the special relations between empirical complex-
ities induced by the selection algorithm. To this purpose, a useful alternative to
Proposition 2.2.6 (page 76) is to write, with P probability at least 1 −η,
γρ ⊗ρ′(m′) ≤γρ ⊗ρ′
Φ−γ
N

M ′
+ K

ρ, πi
exp(−λR)

+ K

ρ′, πj
exp(−λ′R)

−log(η),
and thus at least with P probability 1 −3η,

2.2.
Playing with two posterior and two local prior distributions
81
γρ ⊗ρ′(m′) ≤γρ ⊗ρ′
Φ−γ
N

M ′
+ (1 −ζ−1)−1

K

ρ, πi
exp(−βr)

+ log

πi
exp(−βr)

exp
 N
ζ log

cosh

 ζβ
N

ρ(m′)

−ζ−1 log(η)

+ (1 −ζ−1)−1

K

ρ, πj
exp(−β′r)

+ log

πj
exp(−β′r)

exp
 N
ζ log

cosh

 ζβ′
N

ρ(m′)

−ζ−1 log(η)

−log(η).
When ρ = πi
exp(−βr) and ρ′ = πj
exp(−β′r), we get with P probability at least 1 −η,
for any β, β′, γ ∈R+, any i, j ∈N,
γρ ⊗ρ′(m′) ≤γρ ⊗ρ′
Φ−γ
N

M ′
+ C(ρ) + C(ρ′) −ζ + 1
ζ −1

log

3−1ν(γ)η

.
Proposition 2.2.9. With P probability at least 1 −η, for any ρ = πi
exp(−βr), any
ρ′ = πj
exp(−β′r) ∈P,
Sλ(ρ, ρ′) ≤N
λ log

cosh( λ
N )

ρ ⊗ρ′
Φ−γ
N

M ′
+
1 + N
γ log

cosh( λ
N )

λ

C(ρ) + C(ρ′)

−(ζ + 1)
(ζ −1)λ

log

3−1ν(λ)ϵ

+ N
γ log

cosh

 λ
N

log

3−1ν(γ)η

.
In order to analyse Theorem 2.2.4 (page 72), we need to index P =

ρ1, . . . , ρM

in order of increasing empirical complexity C(ρ). To deal in a convenient way with
this indexation, we will write C(i, β) as C

πi
exp(−βr)

, C(i, β) as C

πi
exp(−βr)

, and
S

(i, β), (j, β′)

as S

πi
exp(−βr), πj
exp(−β′r)

.
With P probability at least 1 −ϵ, when 	t ≤j < 	k, as we already saw,
ρ	k(R) ≤ρi(R) ≤ρj(R) + inf
λ∈R+ Ξ λ
N

2Sλ(ρj, ρi)

,
where i = t(j) < 	t. Therefore, with P probability at least 1 −ϵ −η,
ρi(R) ≤ρj(R) + inf
λ∈R+ Ξ λ
N

2N
λ log

cosh

 λ
N

ρj ⊗ρi

Φ−γ
N

M ′
+ 4
1 + N
γ log

cosh

 λ
N

λ
C(ρj)
−(ζ + 1)
(ζ −1)λ

log

3−1ν(λ)ϵ

+ N
γ log

cosh

 λ
N

log

3−1ν(γ)η

.

82
Chapter 2.
Comparing posterior distributions to Gibbs priors
We can now remark that
Ξa(p + q) ≤Ξa(p) + qΞ′
a(p)q ≤Ξa(p) + Ξ′
a(0)q = Ξa(p) +
a
tanh(a)q
and that
Φ−a(p + q) ≤Φ−a(p) + Φ′
−a(0)q = Φ−a(p) + exp(a) −1
a
q.
Moreover, assuming as usual without substantial loss of generality that there exists
θ ∈arg minΘ R, we can split M ′(θ, θ′) ≤M ′(θ, θ) + M ′(θ, θ′). Let us then consider
the expected margin function deﬁned by
ϕ(y) = sup
θ∈Θ
M ′(θ, θ) −yR′(θ, θ),
y ∈R+,
and let us write for any y ∈R+,
ρj ⊗ρi

Φ−λ
N

M ′
≤ρj ⊗ρi

Φ−γ
N

M ′(., θ) + yR′(., θ) + ϕ(y)

≤ρj

Φ−λ
N

M ′(., θ) + ϕ(y)

+ Ny

exp( γ
N ) −1

γ

ρi(R) −R(θ)

and
"
1 −2yN

exp( γ
N ) −1

log

cosh

 λ
N

γ tanh

 λ
N

#

ρi(R) −R(θ)

≤

ρj(R) −R(θ)

+ Ξ λ
N

2N
λ log

cosh

 λ
N

ρj

Φ−γ
N

M ′(., θ) + ϕ(y)

+ 4
1 + N
γ log

cosh

 λ
N

λ
C(ρj)
−2(ζ + 1)
(ζ −1)λ

log

3−1ν(λ)ϵ

+ N
γ log

cosh

 λ
N

log

3−1ν(γ)η

.
With P probability at least 1−ϵ−η, for any λ, γ, x, y ∈R+, any j ∈
	t, . . . , 	k−1

,
ρ	k(R) −R(θ) ≤ρi(R) −R(θ)
≤
"
1 −2yN

exp( γ
N ) −1

log

cosh

 λ
N

γ tanh

 λ
N

#−1
"
1 + 2xN

exp( γ
N ) −1

log

cosh

 λ
N

γ tanh

 λ
N

#

ρj(R) −R(θ)

+ Ξ λ
N
2N
λ log

cosh

 λ
N

Φ−γ
N

ϕ(x) + ϕ(y)

+ 4
1 + N
γ log

cosh

 λ
N

λ
C(ρj)
−2(ζ + 1)
(ζ −1)λ

log

3−1ν(λ)ϵ

+ N
γ log

cosh

 λ
N

log

3−1ν(γ)η

.

2.2.
Playing with two posterior and two local prior distributions
83
Now we have to get an upper bound for ρj(R). We can write ρj = πℓ
exp(−β′r), as we
assumed that all the posterior distributions in P are of this special form. Moreover,
we already know from Theorem 2.1.8 (page 58) that with P probability at least
1 −η,

N sinh

 β′
N

−β′ζ−1
πℓ
exp(−β′r)(R) −πℓ
exp(−β′ζ−1R)(R)

≤Cℓ(β′ζ−1, β′) −log

ν(β′)μ(ℓ)η

.
This proves that with P probability at least 1 −ϵ −2η,
ρ	k(R) ≤R(θ)
+
 
1 −2yN

exp

 γ
N

−1

log

cosh

 λ
N

γ tanh

 λ
N

!−1
 
1 + 2xN

exp

 γ
N

−1

log

cosh

 λ
N

γ tanh

 λ
N

!
×
"
πℓ
exp(−ζ−1β′R)(R) −R(θ) + Cℓ(ζ−1β′, β′) −log

ν(β′)μ(ℓ)η

N sinh( β′
N ) −ζ−1β′
#
+ Ξ λ
N
2N
λ log

cosh

 λ
N

Φ−γ
N

ϕ(x) + ϕ(y)

+ 4
1 + N
γ log

cosh

 λ
N

λ
C(ℓ, β′)
−2(ζ + 1)
(ζ −1)λ

log

3−1ν(λ)ϵ

+ N
γ log

cosh

 λ
N

log

3−1ν(γ)η

.
The case when j ∈
	k +1, . . . , M

\(arg max t) is dealt with exactly in the same
way, with i = t(j) replaced directly with 	k itself, leading to the same inequality.
The case when j ∈(arg max t) is dealt with bounding ﬁrst ρ	k(R)−R(θ) in terms
of ρ	t(R) −R(θ), and this latter in terms of ρj(R) −R(θ). Let us put
A(λ, γ) =
"
1 −2xN

exp

 γ
N

−1

log

cosh

 λ
N

γ tanh

 λ
N

#
,
B(λ, γ) = 1 + 2yN

exp

 γ
N

−1

log

cosh

 λ
N

γ tanh

 λ
N

,
D(λ, γ, ρj) = Ξ λ
N
2N
λ log

cosh

 λ
N

Φ−γ
N

ϕ(x) + ϕ(y)

+4
1 + N
γ log

cosh

 λ
N

λ
C(ρj)
−2(ζ + 1)
(ζ −1)λ

log

3−1ν(λ)ϵ

+N
γ log

cosh

 λ
N

log

3−1ν(γ)η

,
(2.20)
where C(ρj) = C(ℓ, β′) is deﬁned, when ρj = πℓ
exp(−β′r), by equation (2.19, page

84
Chapter 2.
Comparing posterior distributions to Gibbs priors
77). We obtain, still with P probability 1 −ϵ −2η,
ρ	k(R) −R(θ) ≤B(λ, γ)
A(λ, γ)

ρ	t(R) −R(θ)

+ D(λ, γ, ρj)
A(λ, γ)
,
ρ	t(R) −R(θ) ≤B(λ, γ)
A(λ, γ)

ρj(R) −R(θ)

+ D(λ, γ, ρj)
A(λ, γ)
.
The use of the factor D(λ, γ, ρj) in the ﬁrst of these two inequalities, instead of
D(λ, γ, ρ	t), is justiﬁed by the fact that C(ρ	t) ≤C(ρj). Combining the two we get
ρ	k(R) ≤R(θ) + B(λ, γ)2
A(λ, γ)2

ρj(R) −R(θ)

+
B(λ, γ)
A(λ, γ) + 1
D(λ, γ, ρj)
A(λ, γ)
.
Since it is the worst bound of all cases, it holds for any value of j, proving
Theorem 2.2.10.
With P probability at least 1 −ϵ −2η,
ρ	k(R) ≤R(θ ) +
inf
i,β,λ,γ,x,y

B(λ, γ)2
A(λ, γ)2

πi
exp(−βr)(R) −R(θ)

+
B(λ, γ)
A(λ, γ) + 1
D(λ, γ, πi
exp(−βr))
A(λ, γ)

≤R(θ) +
inf
i,β,λ,γ,x,y

B(λ, γ)2
A(λ, γ)2
"
πi
exp(−ζ−1βR)(R) −R(θ) + Ci(ζ−1β, β) −log

ν(β)μ(i)η

N sinh

 β
N

−ζ−1β
#
+
B(λ, γ)
A(λ, γ) + 1
D(λ, γ, πi
exp(−βr))
A(λ, γ)

,
where the notation A(λ, γ), B(λ, γ) and D(λ, γ, ρ) is deﬁned by equation (2.20 page
83) and where the notation Ci(β, γ) is deﬁned in Proposition 2.2.5 (page 75).
The bound is a little involved, but as we will prove next, it gives the same rate
as Theorem 2.1.15 (page 65) and its corollaries, when we work with a single model
(meaning that the support of μ is reduced to one point) and the goal is to choose
adaptively the temperature of the Gibbs posterior, except for the appearance of the
union bound factor −log

ν(β)

which can be made of order log

log(N)

without
spoiling the order of magnitude of the bound.
We will encompass the case when one must choose between possibly several
parametric models. Let us assume that each πi is supported by some measurable
parameter subset Θi ( meaning that πi(Θi) = 1), let us also assume that the
behaviour of πi is parametric in the sense that there exists a dimension di ∈R+
such that
(2.21)
sup
β∈R+
β

πi
exp(−βR)(R) −inf
Θi R

≤di.
Then
Ci(λ, γ) ≤log

πi
exp(−λR)

exp

2N sinh

 γ
2N
2M ′(., θ)


2.2.
Playing with two posterior and two local prior distributions
85
+ 2N sinh

 γ
2N
2πi
exp(−λR)

M ′(., θ)

≤log

πi
exp(−λR)

exp 2xN sinh

 γ
2N
2
R −R(θ)

+ 2xN sinh

 γ
2N
2πi
exp(−λR)

R −R(θ)

+ 4N sinh

 γ
2N
2ϕ(x)
≤2xN sinh

 γ
2N
2πi
exp{−[λ−2xN sinh( γ
2N )2]R}

R −R(θ)

+ 2xN sinh

 γ
2N
2πi
exp(−λR)

R −R(θ)

+ 4N sinh

 γ
2N
2ϕ(x).
Thus
Ci(λ, γ) ≤4N sinh

 γ
2N
2
"
x

inf
Θi R −R(θ)

+ ϕ(x)
+ xdi
2λ +
xdi
2λ −4xN sinh

 γ
2N
2
#
.
In the same way,
C(i, β) ≤
8N
ζ−1 sinh

 ζβ
2N
2
&
x

inf
Θi R −R(θ)

+ ϕ(x)
+
ζxdi
2N sinh

 ζβ
N

 
1 +
1
1 −xζ tanh

 ζβ
2N

!'
+ 2N

exp

ζ2β2
2N 2(ζ−1)

−1
"
ϕ(x) + x

inf
Θi R −R(θ)

+
xζdi
N sinh

 ζβ
N

−xζN

exp

ζ2β2
2N 2(ζ−1)

−1

#
−(ζ + 1)
(ζ −1)

2 log

ν(β)μ(i)

+ log

 η
2

.
In order to keep the right order of magnitude while simplifying the bound, let us
consider
(2.22)
C1 = max

ζ −1,

2N
ζβmax
2
sinh

ζβmax
2N
2
,
2N 2(ζ−1)
ζ2β2max

exp

ζ2β2
max
2N 2(ζ−1)

−1

.
Then, for any β ∈(0, βmax),
C(i, β) ≤inf
y∈R+
3C1ζ2β2
(ζ −1)N
&
y

inf
Θi R −R(θ)

+ ϕ(y) +
ydi
β

1 −
yC1ζ2β
2(ζ−1)N

'
−(ζ + 1)
(ζ −1)

2 log

ν(β)μ(i)

+ log

 η
2

.

86
Chapter 2.
Comparing posterior distributions to Gibbs priors
Thus
D

λ, γ, πi
exp(−βr)

≤
λ
N tanh

 λ
N


λ

exp

 γ
N

−1

γ

ϕ(x) + ϕ(y)

+ 4
1 +
λ2
2Nγ
λ
&
3C1ζ2β2
(ζ −1)N
"
z

inf
Θi R −R(θ)

+ ϕ(z) +
zdi
β

1 −
zC1ζ2β
2(ζ−1)N

#
−(ζ + 1)
(ζ −1)

2 log

ν(β)μ(i)

+ log

 η
2
'
−2(ζ + 1)
(ζ −1)λ

log

3−1ν(λ)ϵ

+
λ2
2Nγ log

3−1ν(γ)η

If we are not seeking tight constants, we can take for the sake of simplicity
λ = γ = β, x = y and ζ = 2.
Let us put
(2.23)
C2 = max

C1, N

exp

 βmax
N

−1

βmax
,
2N log

cosh

 βmax
N

βmax tanh

 βmax
N
 ,
βmax
N tanh

 βmax
N


,
so that
A(β, β)−1 ≤
 
1 −C2xβ
N
!−1
,
B(β, β) ≤1 + C2xβ
N
,
D

β, β, πi
exp(−βr)

≤C2
2
2β
N ϕ(x)
+

4 + 2β
N
C2
β
&
12C1β2
N
"
z

inf
Θi R −R(θ)

+ ϕ(z) +
zdi
β

1 −2zC1β
N

#
−6 log

ν(β)μ(i)

−3 log

 η
2

'
−6C2
β

log

3−1ν(β)ϵ

+ β
2N log

3−1ν(β)η

and
Ci(ζ−1β, β) ≤C1β2
N
 
x

inf
Θi R −R(θ)

+ ϕ(x) +
2xdi
β

1 −xβ
N

!
.
This leads to
ρ	k(R) ≤R(θ) + inf
i,β
"
1 + C2xβ
N
1 −C2xβ
N
#2
2di
β + inf
Θi R −R(θ)
+ 2
β
&
C1β2
N
 
x

inf
Θi R −R(θ

+ ϕ(x) +
2xdi
β

1 −xβ
N

!

2.2.
Playing with two posterior and two local prior distributions
87
−log

ν(β)μ(i)η

'
+
2

1 −C2xβ
N
2

C2
2
2β
N ϕ(x)
+

4 + 2β
N
C2
β
12C1β2
N
 
x

inf
Θi R −R(θ)

+ ϕ(x) +
xdi
β

1 −2xC1β
N

!
−6 log

ν(β)μ(i)

−3 log

 η
2

−6C2
β

log

3−1ν(β)ϵ

+ β
2N log

3−1ν(β)η

.
We see in this expression that, in order to balance the various factors depending
on x it is advisable to choose x such that
inf
Θi R −R(θ) = ϕ(x)
x
,
as long as x ≤
N
4C2β .
Following Mammen and Tsybakov, let us assume that the usual margin assump-
tion holds: for some real constants c > 0 and κ ≥1,
R(θ) −R(θ) ≥c

D(θ, θ)
κ.
As D(θ, θ ) ≥M ′(θ, θ ), this also implies the weaker assumption
R(θ) −R(θ ) ≥c

M ′(θ, θ)
κ,
θ ∈Θ,
which we will really need and use. Let us take βmax = N and
ν =
1
⌈log2(N)⌉
⌈log2(N)⌉

k=1
δ2k.
Then, as we have already seen, ϕ(x) ≤(1−κ−1)

κcx
−
1
κ−1 . Thus ϕ(x)/x ≤bx−
κ
κ−1 ,
where b = (1 −κ−1)

κc
−
1
κ−1 . Let us choose accordingly
x = min

x1
def
=
 infΘi R −R(θ)
b
!−κ−1
κ
, x2
def
=
N
4C2β

.
Using the fact that when r ∈(0, 1
2),

 1+r
1−r
2 ≤1+16r ≤9, we get with P probability
at least 1 −ϵ, for any β ∈supp ν, in the case when x = x1 ≤x2,
ρ	k(R) ≤inf
Θi R + 538 C2
2
β
N b
κ−1
κ 
inf
Θi R −R(θ)
 1
κ
+ C2
β

138 di + 166 log

1 + log2(N)

−134 log

μ(i)

−102 log(ϵ) + 724

,
and in the case when x = x2 ≤x1,

88
Chapter 2.
Comparing posterior distributions to Gibbs priors
ρ	k(R) ≤inf
Θi R + 68C1

inf
Θi R −R(θ)

+ 269 C2
2
β
N ϕ(x)
+ C2
β

138 di + 166 log

1 + log2(N)

−134 log

μ(i)

−102 log(ϵ) + 724

≤inf
Θi R + 541C2
2
β
N ϕ(x)
+ C2
β

138 di + 166 log

1 + log2(N)

−134 log

μ(i)

−102 log(ϵ) + 724

.
Thus with P probability at least 1 −ϵ,
ρ	k(R) ≤inf
Θi R +
inf
β∈(1,N) 1082 C2
2
β
N max

b
κ−1
κ 
inf
Θi R −R(θ)
 1
κ ,
b
 4C2β
N
!
1
κ−1 
+ C2
β

138 di + 166 log

1 + log2(N)

−134 log

μ(i)

−102 log(ϵ) + 724

.
Theorem 2.2.11.
With probability at least 1 −ϵ, for any i ∈N,
ρ	k(R) ≤inf
Θi R
+ max
⎧
⎪
⎪
⎪
⎨
⎪
⎪
⎪
⎩
847C
3
2
2
=
>
>
?b
κ−1
κ 
infΘi R −R(θ)
 1
κ 
di + log

1+log2(N)
ϵμ(i)

+ 5

N
,
2C2

1082 b
 κ−1
2κ−1 4
1
2κ−1
⎧
⎨
⎩
166C2

di + log

1+log2(N)
ϵμ(i)

+ 5

N
⎫
⎬
⎭
κ
2κ−1
⎫
⎪
⎪
⎪
⎬
⎪
⎪
⎪
⎭
,
where C2, given by equation (2.23 page 86), will in most cases be close to 1, and in
any case less than 3.2.
This result gives a bound of the same form as that given in Theorem 2.1.15 (page
65) in the special case when there is only one model — that is when μ is a Dirac
mass, for instance μ(1) = 1, implying that R(θ1)−R(θ) = 0. Morover the parametric
complexity assumption we made for this theorem, given by equation (2.21 page 84),
is weaker than the one used in Theorem 2.1.15 and described by equation (2.8, page
62). When there is more than one model, the bound shows that the estimator makes
a trade-oﬀbetween model accuracy, represented by infΘi R −R(θ), and dimension,
represented by di, and that for optimal parametric sub-models, meaning those for
which infΘi R = infΘ R, the estimator does at least as well as the minimax optimal
convergence speed in the best of these.
Another point is that we obtain more explicit constants than in Theorem 2.1.15.
It is also clear that a more careful choice of parameters could have brought some
improvement in the value of these constants.

2.3.
Two step localization
89
These results show that the selection scheme described in this section is a good
candidate to perform temperature selection of a Gibbs posterior distribution built
within a single parametric model in a rate optimal way, as well as a proposal with
proven performance bound for model selection.
2.3. Two step localization
2.3.1. Two step localization of bounds relative to a Gibbs prior.
Let
us reconsider the case where we want to choose adaptively among a family of
parametric models. Let us thus assume that the parameter set is a disjoint union
of measurable sub-models, so that we can write Θ = ⊔m∈MΘm, where M is some
measurable index set. Let us choose some prior probability distribution on the
index set μ ∈M1
+(M), and some regular conditional prior distribution π : M →
M1
+(Θ), such that π(i, Θi) = 1, i ∈M. Let us then study some arbitrary posterior
distributions ν : Ω →M1
+(M) and ρ : Ω × M :→M1
+(Θ), such that ρ(ω, i, Θi) = 1,
ω ∈Ω, i ∈M. We would like to compare νρ(R) with some doubly localized prior
distribution μexp[−
β
1+ζ2 πexp(−βR)(R)]

πexp(−βR)

(R) (where ζ2 is a positive parameter
to be set as needed later on). To ease notation we will deﬁne two prior distributions
(one being more precisely a conditional distribution) depending on the positive real
parameters β and ζ2, putting
(2.24)
π = πexp(−βR) and μ = μexp[−
β
1+ζ2 π(R)].
Similarly to Theorem 1.4.3 on page 37 we can write for any positive real constants
β and γ
P

(μ π) ⊗(μ π)

exp

−N log

1 −tanh( γ
N )R′
−γr′ −N log

cosh( γ
N )

m′
≤1,
and deduce, using Lemma 1.1.3 on page 4, that
(2.25)
P

exp

sup
ν∈M1
+(M)
sup
ρ:M→M1
+(Θ)

−N log

1 −tanh( γ
N )(νρ −μ π)(R)

−γ(νρ −μ π)(r) −N log

cosh( γ
N )

(νρ) ⊗(μ π)(m′)
−K(ν, μ) −ν

K(ρ, π)

≤1.
This will be our starting point in comparing νρ(R) with μ π(R). However, obtaining
an empirical bound will require some supplementary eﬀorts. For each index of the
model index set M, we can write in the same way
P

π ⊗π

exp

−N log

1 −tanh( γ
N )R′
−γr′ −N log

cosh( γ
N )

m′
≤1.
Integrating this inequality with respect to μ and using Fubini’s lemma for positive
functions, we get
P

μ(π ⊗π)

exp

−N log

1 −tanh( γ
N )R′
−γr′ −N log

cosh( γ
N )

m′
≤1.

90
Chapter 2.
Comparing posterior distributions to Gibbs priors
Note that μ(π ⊗π) is a probability measure on M × Θ × Θ, whereas (μ π) ⊗(μ π)
considered previously is a probability measure on (M × Θ) × (M × Θ). We get as
previously
(2.26)
P

exp

sup
ν∈M1
+(M)
sup
ρ:M→M1
+(Θ)

−N log

1 −tanh( γ
N )ν(ρ −π)(R)

−γν(ρ −π)(r) −N log

cosh( γ
N )

ν(ρ ⊗π)(m′)
−K(ν, μ) −ν

K(ρ, π)

≤1.
Let us ﬁnally recall that
K(ν, μ) =
β
1+ζ2 (ν −μ)π(R) + K(ν, μ) −K(μ, μ),
(2.27)
K(ρ, π) = β(ρ −π)(R) + K(ρ, π) −K(π, π).
(2.28)
From equations (2.25), (2.26) and (2.28) we deduce
Proposition 2.3.1.
For any positive real constants β, γ and ζ2, with P probability
at least 1 −ϵ, for any posterior distribution ν : Ω →M1
+(M) and any conditional
posterior distribution ρ : Ω × M →M1
+(Θ),
−N log

1 −tanh( γ
N )(νρ −μ π)(R)

−βν(ρ −π)(R)
≤γ(νρ −μ π)(r) + N log

cosh( γ
N )

(νρ) ⊗(μ π)(m′)
+ K(ν, μ) + ν

K(ρ, π)

−ν

K(π, π)

+ log

 2
ϵ

.
and
−N log

1 −tanh( γ
N )ν(ρ −π)(R)

≤γν(ρ −π)(r) + N log

cosh( γ
N )

ν(ρ ⊗π)(m′)
+ K(ν, μ) + ν

K(ρ, π)

+ log

 2
ϵ

,
where the prior distribution μ π is deﬁned by equation (2.24) on page 89 and depends
on β and ζ2.
Let us put for short
T = tanh( γ
N ) and C = N log

cosh( γ
N )

.
We will use an entropy compensation strategy for which we need a couple of
entropy bounds. We have according to Proposition 2.3.1, with P probability at
least 1 −ϵ,
ν

K(ρ, π)

= βν(ρ −π)(R) + ν

K(ρ, π) −K(π, π)

≤
β
NT

γν(ρ −π)(r) + Cν(ρ ⊗π)(m′)
+ K(ν, μ) + ν

K(ρ, π)

+ log( 2
ϵ )

+ ν

K(ρ, π) −K(π, π)

.

2.3.
Two step localization
91
Similarly
K(ν, μ) =
β
1 + ζ2
(ν −μ)π(R) + K(ν, μ) −K(μ, μ)
≤
β
(1 + ζ2)NT

γ(ν −μ)π(r) + C(νπ) ⊗(μ π)(m′)
+ K(ν, μ) + log( 2
ϵ )

+ K(ν, μ) −K(μ, μ).
Thus, for any positive real constants β, γ and ζi, i = 1, . . . , 5, with P probability
at least 1 −ϵ, for any posterior distributions ν, ν3 : Ω →M1
+(Θ), any posterior
conditional distributions ρ, ρ1, ρ2, ρ4, ρ5 : Ω × M →M1
+(Θ),
−N log

1 −T(νρ −μ π)(R)

−βν(ρ −π)(R)
≤γ(νρ −μ π)(r) + C(νρ) ⊗(μ π)(m′)
+ K(ν, μ) + ν

K(ρ, π) −K(π, π)

+ log( 2
ϵ ),
ζ1
NT
β μ

K(ρ1, π)

≤ζ1γμ(ρ1 −π)(r) + ζ1Cμ(ρ1 ⊗π)(m′)
+ ζ1μ

K(ρ1, π)

+ ζ1 log( 2
ϵ ) + ζ1
NT
β μ

K(ρ1, π) −K(π, π)

,
ζ2
NT
β ν

K(ρ2, π)

≤ζ2γν(ρ2 −π)(r) + ζ2Cν(ρ2 ⊗π)(m′)
+ ζ2K(ν, μ) + ζ2ν

K(ρ2, π)

+ ζ2 log( 2
ϵ )
+ ζ2
NT
β ν

K(ρ2, π) −K(π, π)

,
ζ3(1 + ζ2)NT
β K(ν3, μ) ≤ζ3γ(ν3 −μ)π(r)
+ ζ3C

(ν3π) ⊗(ν3ρ1) + (ν3ρ1) ⊗(μ π)

(m′) + ζ3K(ν3, μ) + ζ3 log( 2
ϵ )
+ ζ3(1 + ζ2)NT
β

K(ν3, μ) −K(μ, μ)

,
ζ4
NT
β ν3

K(ρ4, π)

≤ζ4γν3(ρ4 −π)(r)
+ ζ4Cν3(ρ4 ⊗π)(m′) + ζ4K(ν3, μ) + ζ4ν3

K(ρ4, π)

+ ζ4 log( 2
ϵ )
+ ζ4
NT
β ν3

K(ρ4, π) −K(π, π)

,
ζ5
NT
β μ

K(ρ5, π)

≤ζ5γμ(ρ5 −π)(r) + ζ5Cμ(ρ5 ⊗π)(m′)
+ ζ5μ

K(ρ5, π)

+ ζ5 log( 2
ϵ ) + ζ5
NT
β μ

K(ρ5, π) −K(π, π)

.
Adding these six inequalities and assuming that
(2.29)
ζ4 ≤ζ3

(1 + ζ2) NT
β −1

,
we ﬁnd
−N log

1 −T(νρ −μ π)(R)

−β(νρ −μ π)(R)
≤−N log

1 −T(νρ −μ π)(R)

−β(νρ −μ π)(R)

92
Chapter 2.
Comparing posterior distributions to Gibbs priors
+ ζ1

 NT
β −1

μ

K(ρ1, π)

+ ζ2

 NT
β −1

ν

K(ρ2, π)

+

ζ3(1 + ζ2) NT
β −ζ3 −ζ4

K(ν3, μ)
+ ζ4

 NT
β −1

ν3

K(ρ4, π)

+ ζ5

 NT
β −1

μ

K(ρ5, π)

≤γ(νρ −μ π)(r) + ζ1γμ(ρ1 −π)(r) + ζ2γν(ρ2 −π)(r)
+ ζ3γ(ν3 −μ)π(r) + ζ4γν3(ρ4 −π)(r) + ζ5γμ(ρ5 −π)(r)
+ C

(νρ) ⊗(μ π) + ζ1μ(ρ1 ⊗π) + ζ2ν(ρ2 ⊗π)
+ ζ3(ν3π) ⊗(ν3ρ1) + ζ3(ν3ρ1) ⊗(μ π)
+ ζ4ν3(ρ4 ⊗π) + ζ5μ(ρ5 ⊗π)

(m′)
+ (1 + ζ2)

K(ν, μ) −K(μ, μ)

+ ν

K(ρ, π) −K(π, π)

+ ζ1 NT
β μ

K(ρ1, π) −K(π, π)

+ ζ2 NT
β ν

K(ρ2, π) −K(π, π)

+ ζ3(1 + ζ2) NT
β

K(ν3, μ) −K(μ, μ)

+ ζ4 NT
β ν3

K(ρ4, π) −K(π, π)

+ ζ5 NT
β μ

K(ρ5, π) −K(π, π)

+ (1 + ζ1 + ζ2 + ζ3 + ζ4 + ζ5) log( 2
ϵ ),
where we have also used the fact (concerning the 11th line of the preceding inequal-
ities) that
−β(νρ −μ π)(R) + K(ν, μ) + ν

K(ρ, π)

≤−β(νρ −μ π)(R) + (1 + ζ2)K(ν, μ) + ν

K(ρ, π)

= (1 + ζ2)

K(ν, μ) −K(μ, μ)

+ ν

K(ρ, π) −K(π, π)

.
Let us now apply to π (we shall later do the same with μ) the following inequalities,
holding for any random functions of the sample and the parameters h : Ω × Θ →R
and g : Ω × Θ →R,
π(g −h) −K(π, π) ≤
sup
ρ:Ω×M→M1
+(Θ)
ρ(g −h) −K(ρ, π)
= log

π

exp(g −h)

= log

π

exp(−h)

+ log

πexp(−h)

exp(g)

= −πexp(−h)(h) −K(πexp(−h), π) + log

πexp(−h)

exp(g)

.
When h and g are observable, and h is not too far from βr ≃βR, this gives a
way to replace π with a satisfactory empirical approximation. We will apply this
method, choosing ρ1 and ρ5 such that μ π is replaced either with μρ1, when it comes
from the ﬁrst two inequalities or with μρ5 otherwise, choosing ρ2 such that νπ is
replaced with νρ2 and ρ4 such that ν3π is replaced with ν3ρ4. We will do so because
it leads to a lot of helpful cancellations. For those to happen, we need to choose
ρi = πexp(−λir), i = 1, 2, 4, where λ1, λ2 and λ4 are such that
(1 + ζ1)γ = ζ1 NT
β λ1,
(2.30)
ζ2γ =

1 + ζ2 NT
β

λ2,
(2.31)
(ζ4 −ζ3)γ = ζ4
NT
β λ4,
(2.32)
ζ3γ = ζ5 NT
β λ5,
(2.33)
and to assume that
(2.34)
ζ4 > ζ3.

2.3.
Two step localization
93
We obtain that with P probability at least 1 −ϵ,
−N log

1 −T(μρ −μ π)(R)

−β(νρ −μ π)(R)
≤γ(νρ −μ ρ1)(r) + ζ3γ(ν3ρ4 −μρ5)(r)
+ ζ1 NT
β μ

log
&
ρ1

exp

C
β
NT ζ1

νρ + ζ1ρ1

(m′)
'
+

1 + ζ2 NT
β

ν

log

ρ2

exp

C
1+ζ2 NT
β ζ2ρ2(m′)
'
+ ζ4 NT
β ν3

log
&
ρ4

exp

C
β
NT ζ4

ζ3ν3ρ1 + ζ4ρ4

(m′)
'
+ ζ5 NT
β μ

log
&
ρ5

exp

C
β
NT ζ5

ζ3ν3ρ1 + ζ5ρ5

(m′)
'
+ (1 + ζ2)

K(ν, μ) −K(μ, μ)

+ ν

K(ρ, π) −K(ρ2, π)

+ ζ3(1 + ζ2) NT
β

K(ν3, μ) −K(μ, μ)

+
 
1 +
5

i=1
ζi
!
log

 2
ϵ

.
In order to obtain more cancellations while replacing μ by some posterior distri-
bution, we will choose the constants such that λ5 = λ4, which can be done by
choosing
(2.35)
ζ5 =
ζ3ζ4
ζ4 −ζ3
.
We can now replace μ with μexp −ξ1ρ1(r)−ξ4ρ4(r), where
ξ1 =
γ
(1 + ζ2)

1 + NT
β ζ3
,
(2.36)
ξ4 =
γζ3
(1 + ζ2)

1 + NT
β ζ3
.
(2.37)
Choosing moreover ν3 = μexp −ξ1ρ1(r)−ξ4ρ4(r), to induce some more cancellations,
we get
Theorem 2.3.2.
Let us use the notation introduced above. For any positive real
constants satisfying equations (2.29, page 91), (2.30, page 92), (2.31, page 92),
(2.32, page 92), (2.33, page 92), (2.34, page 92), (2.35, page 93), (2.36, page 93),
(2.37, page 93), with P probability at least 1 −ϵ, for any posterior distribution
ν : Ω →M1
+(M) and any conditional posterior distribution ρ : Ω × M →M1
+(Θ),
−N log

1 −T(νρ −μ π)(R)

−β(νρ −μ π)(R) ≤B(ν, ρ, β),
where B(ν, ρ, β)
def
= γ(νρ −ν3ρ1)(r)
+ (1 + ζ2)

1 + NT
β ζ3

× log

ν3
&
ρ1

exp

C
β
NT ζ1

νρ + ζ1ρ1

(m′)

ζ1NT
β(1+ζ2)(1+ NT
β
ζ3)

94
Chapter 2.
Comparing posterior distributions to Gibbs priors
× ρ4

exp

C
β
NT ζ5

ζ3ν3ρ1 + ζ5ρ4

(m′)

ζ5NT
β(1+ζ2)(1+ NT
β
ζ3)
'
+

1 + ζ2 NT
β

ν

log

ρ2

exp

C
1+ζ2 NT
β ζ2ρ2(m′)
'
+ ζ4 NT
β ν3

log
&
ρ4

exp

C
β
NT ζ4

ζ3ν3ρ1 + ζ4ρ4

(m′)
'
+ (1 + ζ2)

K(ν, μ) −K(ν3, μ)

+ ν

K(ρ, π) −K(ρ2, π)

+
 
1 +
5

i=1
ζi
!
log

 2
ϵ

.
This theorem can be used to ﬁnd the largest value 	β(νρ) of β such that B(ν, ρ,
β) ≤0, thus providing an estimator for β(νρ) deﬁned as νρ(R) = μβ(νρ)πβ(νρ)(R),
where we have mentioned explicitly the dependence of μ and π in β, the constant
ζ2 staying ﬁxed. The posterior distribution νρ may then be chosen to maximize
	β(νρ) within some manageable subset of posterior distributions P, thus gaining
the assurance that νρ(R) ≤μ	
β(νρ)π	
β(νρ)(R), with the largest parameter 	β(νρ)
that this approach can provide. Maximizing 	β(νρ) is supported by the fact that
limβ→+∞μβπβ(R) = ess infμπ R. Anyhow, there is no assurance (to our knowledge)
that β →μβπβ(R) will be a decreasing function of β all the way, although this may
be expected to be the case in many practical situations.
We can make the bound more explicit in several ways. One point of view is to
put forward the optimal values of ρ and ν. We can thus remark that
ν

γρ(r) + K(ρ, π) −K(ρ2, π)

+ (1 + ζ2)K(ν, μ)
= ν

K

ρ, πexp(−γr)

+ λ2ρ2(r) +
 γ
λ2 πexp(−αr)(r)dα

+ (1 + ζ2)K(ν, μ)
= ν

K

ρ, πexp(−γr)

+ (1 + ζ2)K

ν, μexp

−λ2ρ2(r)
1+ζ2
−
1
1+ζ2
 γ
λ2
πexp(−αr)(r)dα

−(1 + ζ2) log

μ
&
exp

−
λ2
1 + ζ2
ρ2(r) −
1
1 + ζ2
 γ
λ2
πexp(−αr)(r)dα
'
.
Thus
B(ν, ρ, β) = (1 + ζ2)

ξ1ν3ρ1(r) + ξ4ν3ρ4(r)
+ log

μ

exp

−ξ1ρ1(r) −ξ4ρ4(r)

−(1 + ζ2) log

μ
&
exp

−
λ2
1 + ζ2
ρ2(r) −
1
1 + ζ2
 γ
λ2
πexp(−αr)(r)dα
'
−γν3ρ1(r) + (1 + ζ2)

1 + NT
β ζ3

× log

ν3
&
ρ1

exp

C
β
NT ζ1

νρ + ζ1ρ1

(m′)

ζ1NT
β(1+ζ2)(1+ NT
β
ζ3)
× ρ4

exp

C
β
NT ζ5

ζ3ν3ρ1 + ζ5ρ4

(m′)

ζ5NT
β(1+ζ2)(1+ NT
β
ζ3)
'

2.3.
Two step localization
95
+

1 + ζ2 NT
β

ν

log

ρ2

exp

C
1+ζ2 NT
β ζ2ρ2(m′)
'
+ ζ4 NT
β ν3

log
&
ρ4

exp

C
β
NT ζ4

ζ3ν3ρ1 + ζ4ρ4

(m′)
'
+ ν

K

ρ, πexp(−γr)

+ (1 + ζ2)K

ν, μexp

−λ2ρ2(r)
1+ζ2
−
1
1+ζ2
 γ
λ2
πexp(−αr)(r)dα

+
 
1 +
5

i=1
ζi
!
log

 2
ϵ

.
This formula is better understood when thinking about the following upper bound
for the two ﬁrst lines in the expression of B(ν, ρ, β):
(1 + ζ2)

ξ1ν3ρ1(r) + ξ4ν3ρ4(r) + log

μ

exp

−ξ1ρ1(r) −ξ4ρ4(r)

−(1 + ζ2) log

μ
&
exp

−
λ2
1 + ζ2
ρ2(r)
−
1
1 + ζ2
 γ
λ2
πexp(−αr)(r)dα
'
−γν3ρ1(r)
≤ν3

λ2ρ2(r) +
 γ
λ2
πexp(−αr)(r)dα −γρ1(r)

.
Another approach to understanding Theorem 2.3.2 is to put forward ρ0
=
πexp(−λ0r), for some positive real constant λ0 < γ, noticing that
ν

K(ρ0, π) −K(ρ2, π)

= λ0ν(ρ2 −ρ0)(r) −ν

K(ρ2, ρ0)

.
Thus
B(ν, ρ0, β) ≤ν3

(γ −λ0)(ρ0 −ρ1)(r) + λ0(ρ2 −ρ1)(r)

+ (1 + ζ2)

1 + NT
β ζ3

× log

ν3
&
ρ1

exp

C
β
NT ζ1

νρ0 + ζ1ρ1

(m′)

ζ1NT
β(1+ζ2)(1+ NT
β
ζ3)
× ρ4

exp

C
β
NT ζ5

ζ3ν3ρ1 + ζ5ρ4

(m′)

ζ5NT
β(1+ζ2)(1+ NT
β
ζ3)
'
+

1 + ζ2 NT
β

ν

log

ρ2

exp

C
1+ζ2 NT
β ζ2ρ2(m′)
'
+ ζ4 NT
β ν3

log
&
ρ4

exp

C
β
NT ζ4

ζ3ν3ρ1 + ζ4ρ4

(m′)
'
+ (1 + ζ2)K

ν, μexp

−(γ−λ0)ρ0(r)+λ0ρ2(r)
1+ζ2


−ν

K(ρ2, ρ0)

+
 
1 +
5

i=1
ζi
!
log

 2
ϵ

.

96
Chapter 2.
Comparing posterior distributions to Gibbs priors
In the case when we want to select a single model 	m(ω), and therefore to set
ν = δ	
m, the previous inequality engages us to take
	m ∈arg min
m∈M(γ −λ0)ρ0(m, r) + λ0ρ2(m, r).
In parametric situations where
πexp(−λr)(r) ≃r⋆(m) + de(m)
λ
,
we get
(γ −λ0)ρ0(m, r) −λ0ρ2(m, r) ≃γ

r⋆(m) + de(m)

 1
λ0 + λ0−λ2
γλ2

,
resulting in a linear penalization of the empirical dimension of the models.
2.3.2. Analysis of two step bounds relative to a Gibbs prior.
We will
not state a formal result, but will nevertheless give some hints about how to establish
one. This is a rather technical section, which can be skipped at a ﬁrst reading ,
since it will not be used below. We should start from Theorem 1.4.2 (page 35),
which gives a deterministic variance term. From Theorem 1.4.2, after a change
of prior distribution, we obtain for any positive constants α1 and α2, any prior
distributions μ1 and μ2 ∈M1
+(M), for any prior conditional distributions π1 and
π2 : M →M1
+(Θ), with P probability at least 1 −η, for any posterior distributions
ν1ρ1 and ν2ρ2,
α1(ν1ρ1 −ν2ρ2)(R) ≤α2(ν1ρ1 −ν2ρ2)(r)
+ K

(ν1ρ1) ⊗(ν2ρ2), (μ1 π1) ⊗(μ2 π2)

+ log

(μ1 π1) ⊗(μ2 π2)

exp

−α2Ψ α2
N (R′, M ′) + α1R′
−log(η).
Applying this to α1 = 0, we get that
(νρ −ν3ρ1)(r) ≤1
α2

K

(νρ) ⊗(ν3ρ1), (μ π) ⊗(μ3 π1)

+ log

(μ ν) ⊗(μ3 π1)

exp

α2Ψ−α2
N (R′, M ′)

−log(η)

.
In the same way, to bound quantities of the form
log

ν3
&
ρ1

exp

C1(νρ + ζ1ρ1)(m′)
p1
× ρ4

exp

C2

ζ3ν3ρ1 + ζ5ρ4

(m′)
p2'
= sup
ν5

p1 sup
ρ5

C1

(νρ) ⊗(ν5ρ5) + ζ1ν5(ρ1 ⊗ρ5)

(m′) −K(ρ5, ρ1)

+ p2 sup
ρ6

C2

ζ3(ν3ρ1) ⊗(ν5ρ6)
+ ζ5ν5(ρ4 ⊗ρ6)

(m′) −K(ρ6, ρ4)

−K(ν5, ν3)

,

2.3.
Two step localization
97
where C1, C2, p1 and p2 are positive constants, and similar terms, we need to use
inequalities of the type: for any prior distributions μi πi, i = 1, 2, with P probability
at least 1 −η, for any posterior distributions νiρi, i = 1, 2,
α3(ν1ρ1) ⊗(ν2ρ2)(m′) ≤log

(μ1 π1) ⊗(μ2 π2) exp

α3Φ −α3
N (M ′)

+ K

(ν1ρ1) ⊗(ν2ρ2), (μ1 π1) ⊗(μ2 π2)

−log(η).
We need also the variant: with P probability at least 1 −η, for any posterior dis-
tribution ν1 : Ω →M1
+(M) and any conditional posterior distributions ρ1, ρ2 :
Ω × M →M1
+(Θ),
α3ν1(ρ1 ⊗ρ2)(m′) ≤log

μ1

π1 ⊗π2

exp

α3Φ−α3
N (M ′)

+ K(ν1, μ1) + ν1

K

ρ1 ⊗ρ2, π1 ⊗π2

−log(η).
We deduce that
log

ν3
&
ρ1

exp

C1(νρ + ζ1ρ1)(m′)
p1
× ρ4

exp

C2

ζ3ν3ρ1 + ζ5ρ4

(m′)
p2'
≤sup
ν5

p1 sup
ρ5
&
C1
α3

log

(μ π) ⊗(μ5 π5) exp

α3Φ−α3
N (M ′)

+ K

(νρ) ⊗(ν5ρ5), (μ π ⊗(μ5 π5)

+ log( 2
η)
+ ζ1

log

μ5

π1 ⊗π5

exp

α3Φ−α3
N (M ′)

+ K(ν5, μ5) + ν5

K

ρ1 ⊗ρ5, π1 ⊗π5

+ log

 2
η

−K(ρ5, ρ1)
'
+ p2 sup
ρ6
&
C1
α3

log

(μ3 π1) ⊗(μ5 π6) exp

α3Φ−α3
N (M ′)

+ K

(ν3ρ1) ⊗(ν5ρ6), (μ3 π1 ⊗(μ5 π6)

+ log( 2
η)
+ ζ1

log

μ5

π4 ⊗π6

exp

α3Φ−α3
N (M ′)

+ K(ν5, μ5) + ν5

K

ρ4 ⊗ρ6, π4 ⊗π6

+ log

 2
η

−K(ρ6, ρ4)
'
−K(ν5, ν3)

.
We are then left with the need to bound entropy terms like K(ν3ρ1, μ3π1), where
we have the choice of μ3 and π1, to obtain a useful bound. As could be expected,
we decompose it into
K(ν3ρ1, μ3π1) = K(ν3, μ3) + ν3

K(ρ1, π1)

.
Let us look after the second term ﬁrst, choosing π1 = πexp(−β1R):

98
Chapter 2.
Comparing posterior distributions to Gibbs priors
ν3

K(ρ1, π1)

= ν3

β1(ρ1 −π1)(R) + K(ρ1, π) −K(π1, π)

≤β1
α1

α2ν3(ρ1 −π1)(r) + K(ν3, μ3) + ν3

K(ρ1, π1)

+ log

μ3

π⊗2
1

exp

−α2Ψ α2
N (R′, M ′) + α1R′
−log(η)

+ ν3

K(ρ1, π) −K(π1, π)

≤β1
α1

K(ν3, μ3) + ν3

K(ρ1, π1)

+ log

μ3

π⊗2
1

exp

−α2Ψ α2
N (R′, M ′) + α1R′
−log(η)

+ ν3

K

ρ1, πexp(−β1α2
α1
r)

.
Thus, when the constraint λ1 = β1α2
α1
is satisﬁed,
ν3

K(ρ1, π1)

≤

1 −β1
α1
−1 β1
α1

K(ν3, μ3)
+ log

μ3

π⊗2
1

exp

−α2Ψ α2
N (R′, M ′) + α1R′
−log(η)

.
We can further specialize the constants, choosing α1 = N sinh( α2
N ), so that
−α2Ψ α2
N (R′, M ′) + α1R′ ≤2N sinh
 α2
2N
2
M ′.
We can for instance choose α2 = γ, α1 = N sinh( γ
N ) and β1 = λ1 N
γ sinh( γ
N ), leading
to
Proposition 2.3.3. With the notation of Theorem 2.3.2, the constants being set
as explained above, putting π1 = πexp(−λ1 N
γ sinh( γ
N )R), with P probability at least
1 −η,
ν3

K(ρ1, π1)

≤

1 −λ1
γ
−1 λ1
γ

K(ν3, μ3)
+ log

μ3

π⊗2
1

exp

2N sinh( γ
2N )2M ′
−log(η)

.
More generally
ν3

K(ρ, π1)

≤

1 −λ1
γ
−1 λ1
γ

K(ν3, μ3)
+ log

μ3

π⊗2
1

exp

2N sinh( γ
2N )2M ′
−log(η)

+

1 −λ1
γ
−1
ν3

K(ρ, ρ1)

.
In a similar way, let us now choose μ3 = μexp[−α3π(R)]. We can write
K(ν, μ3) = α3(ν −μ3)π(R) + K(ν, μ) −K(μ3, μ)

2.3.
Two step localization
99
≤α3
α1

α2(ν −μ3)π(r) + K(ν, μ3)
+ log

(μ3π) ⊗(μ3π)

exp

−α2Ψ α2
N (R′, M ′) + α1R′
−log(η)

+ K(ν, μ) −K(μ3, μ).
Let us choose α2 = γ, α1 = N sinh( γ
N ), and let us add some other entropy inequal-
ities to get rid of π in a suitable way, the approach of entropy compensation being
the same as that used to obtain the empirical bound of Theorem 2.3.2 (page 93).
This results with P probability at least 1 −η in

1 −α3
α1

K(ν, μ3) ≤α3
α1

γ(ν −μ3)π(r)
+ log

(μ3π) ⊗(μ3π)

exp

−γΨ γ
N (R′, M ′) + α1R′
+ log( 2
η)

+ K(ν, μ) −K(μ3, μ),
ζ6

1 −β
α1

μ3

K(ρ6, π)

≤ζ6
β
α1

γμ3(ρ6 −π)(r)
+ log

μ3

π⊗2
exp

−γΨ γ
N (R′, M ′) + α1R′
+ log( 2
η)

+ ζ6μ3

K(ρ6, π) −K(π, π)

,
ζ7

1 −β
α1

μ3

K(ρ7, π)

≤ζ7
β
α1

γμ3(ρ7 −π)(r)
+ log

μ3

π⊗2
exp

−γΨ γ
N (R′, M ′) + α1R′
+ log( 2
η)

+ ζ7μ3

K(ρ7, π) −K(π, π)

,
ζ8

1 −β
α1

ν

K(ρ8, π)

≤ζ8
β
α1

γν(ρ8 −π)(r) + K(ν, μ3)
+ log

μ3

π⊗2
exp

−γΨ γ
N (R′, M ′) + α1R′
+ log( 2
η)

+ ζ8ν

K(ρ8, π) −K(π, π)

,
ζ9

1 −β
α1

ν

K(ρ9, π)

≤ζ9
β
α1

γν(ρ9 −π)(r) + K(ν, μ3)
+ log

μ3

π⊗2
exp

−γΨ γ
N (R′, M ′) + α1R′
+ log( 2
η)

+ ζ9ν

K(ρ9, π) −K(π, π)

,
where we have introduced a bunch of constants, assumed to be positive, that we
will more precisely set to
x8 + x9 = 1,
(ζ6β + x8α3) γ
α1
= λ6,
(ζ7β + x9α3) γ
α1
= λ7,
(ζ8β −x8α3) γ
α1
= λ8,

100
Chapter 2.
Comparing posterior distributions to Gibbs priors
(ζ9β −x9α3) γ
α1
= λ9.
We get with P probability at least 1 −η,

1 −α3
α1
−(ζ8 + ζ9) β
α1

K(ν, μ3) ≤
α3
α1

γ

ν(x8ρ8 + x9ρ9)(r) −μ3(x8ρ6 + x9ρ7)(r)

+ α3
α1
log

(μ3π) ⊗(μ3π)

exp

−γΨ γ
N (R′, M ′) + α1R′
+ (ζ6 + ζ7 + ζ8 + ζ9) β
α1
log

μ3

π⊗2
exp

−γΨ γ
N (R′, M ′) + α1R′
+ K(ν, μ) −K(μ3, μ) +
α3
α1
+ (ζ6 + ζ7 + ζ8 + ζ9) β
α1

log

 2
η

.
Let us choose the constants so that λ1 = λ7 = λ9, λ4 = λ6 = λ8, α3x9
γ
α1 = ξ1 and
α3x8
γ
α1 = ξ4. This is done by setting
x8 =
ξ4
ξ1 + ξ4
,
x9 =
ξ1
ξ1 + ξ4
,
α3 = N
γ sinh( γ
N )(ξ1 + ξ4),
ζ6 = N
γ sinh( γ
N )(λ4 −ξ4)
β
,
ζ7 = N
γ sinh( γ
N )(λ1 −ξ1)
β
,
ζ8 = N
γ sinh( γ
N )(λ4 + ξ4)
β
,
ζ9 = N
γ sinh( γ
N )(λ1 + ξ1)
β
.
The inequality λ1 > ξ1 is always satisﬁed. The inequality λ4 > ξ4 is required for
the above choice of constants, and will be satisﬁed for a suitable choice of ζ3 and
ζ4.
Under these assumptions, we obtain with P probability at least 1 −η

1 −α3
α1
−(ζ8 + ζ9) β
α1

K(ν, μ3) ≤(ν −μ3)(ξ1ρ1 + ξ4ρ4)(r)
+ α3
α1
log

(μ3π) ⊗(μ3π)

exp

−γΨ γ
N (R′, M ′) + α1R′
+ (ζ6 + ζ7 + ζ8 + ζ9) β
α1
log

μ3

π⊗2
exp

−γΨ γ
N (R′, M ′) + α1R′
+ K(ν, μ) −K(μ3, μ) +
α3
α1
+ (ζ6 + ζ7 + ζ8 + ζ9) β
α1

log

 2
η

.
This proves
Proposition 2.3.4. The constants being set as explained above, with P probability
at least 1 −η, for any posterior distribution ν : Ω →M1
+(M),

2.3.
Two step localization
101
K(ν, μ3) ≤

1 −α3
α1
−(ζ8 + ζ9) β
α1
−1
K(ν, ν3)
+ α3
α1
log

(μ3π) ⊗(μ3π)

exp

−γΨ γ
N (R′, M ′) + α1R′
+ (ζ6 + ζ7 + ζ8 + ζ9) β
α1
log

μ3

π⊗2
exp

−γΨ γ
N (R′, M ′) + α1R′
+
α3
α1
+ (ζ6 + ζ7 + ζ8 + ζ9) β
α1

log

 2
η

.
Thus
K(ν3ρ1, μ3 π1) ≤
1 +

1 −λ1
γ
−1 λ1
γ
1 −α3
α1 −(ζ8 + ζ9) β
α1
×
α3
α1
log

(μ3π ⊗(μ3π)

exp

−γΨ γ
N (R′, M ′) + α1R′
+ (ζ6 + ζ7 + ζ8 + ζ9) β
α1
log

μ3

π⊗2
exp

−γΨ γ
N (R′, M ′) + α1R′
+
α3
α1
+ (ζ6 + ζ7 + ζ8 + ζ9) β
α1

log

 2
η

+

1 −λ1
γ
−1 λ1
γ

log

μ3

π⊗2
1

exp

2N sinh

 γ
2N
2M ′
−log( 2
η)

.
We will not go further, lest it may become tedious, but we hope we have given
suﬃcient hints to state informally that the bound B(ν, ρ, β) of Theorem 2.3.2 (page
93) is upper bounded with P probability close to one by a bound of the same ﬂavour
where the empirical quantities r and m′ have been replaced with their expectations
R and M ′.
2.3.3. Two step localization between posterior distributions.
Here we
work with a family of prior distributions described by a regular conditional prior
distribution π = M →M1
+(Θ), where M is some measurable index set. This family
may typically describe a countable family of parametric models. In this case M = N,
and each of the prior distributions π(i, .), i ∈N satisﬁes some parametric complexity
assumption of the type
lim sup
β→+∞
β

πexp(−βR)(i, .)(R) −ess inf
π(i,.) R

= di < +∞,
i ∈M.
Let us consider also a prior distribution μ ∈M1
+(M) deﬁned on the index set M.
Our aim here will be to compare the performance of two given posterior distri-
butions ν1ρ1 and ν2ρ2, where ν1, ν2 : Ω →M1
+(M), and where ρ1, ρ2 : Ω × M →
M1
+(Θ). More precisely, we would like to establish a bound for (ν1ρ1 −ν2ρ2)(R)
which could be a starting point to implement a selection method similar to the one
described in Theorem 2.2.4 (page 72). To this purpose, we can start with Theorem
2.2.1 (page 68), which says that with P probability at least 1 −ϵ,
−N log

1 −tanh( λ
N )

ν1ρ1 −ν2ρ2

(R)

≤λ(ν1ρ1 −ν2ρ2)(r)
+ N log

cosh( λ
N )

(ν1ρ1) ⊗(ν2ρ2)(m′) + K(ν1, μ) + K(ν2, μ)
+ ν1

K(ρ1, π)

+ ν2

K(ρ2, π)

−log(ϵ),

102
Chapter 2.
Comparing posterior distributions to Gibbs priors
where μ ∈M1
+(M) and π : M →M1
+(Θ) are suitably localized prior distributions
to be chosen later on. To use these localized prior distributions, we need empirical
bounds for the entropy terms K(νi, μ) and νi

K(ρi, π)

, i = 1, 2.
Bounding ν

K(ρ, π)

can be done using the following generalization of Corollary
2.1.19 page 68:
Corollary 2.3.5.
For any positive real constants γ and λ such that γ < λ, for
any prior distribution μ ∈M1
+(M) and any conditional prior distribution π : M →
M1
+(Θ), with P probability at least 1 −ϵ, for any posterior distribution ν : Ω →
M1
+(M), and any conditional posterior distribution ρ : Ω × M →M1
+(Θ),
ν

K

ρ, πexp[−N γ
λ tanh( λ
N )R]

≤K′(ν, ρ, γ, λ, ϵ) +
1
λ
γ −1K(ν, μ),
where
K′(ν, ρ, γ, λ, ϵ)
def
=

1 −γ
λ
−1
ν

K(ρ, πexp(−γr)

−γ
λ log(ϵ) + ν

log

πexp(−γr)

exp

N γ
λ log

cosh( λ
N )

ρ(m′)

.
To apply this corollary to our case, we have to set
π = πexp[−N γ
λ tanh( λ
N )R].
Let us also consider for some positive real constant β the conditional prior distrib-
ution
π = πexp(−βR)
and the prior distribution
μ = μexp[−απ(R)].
Let us see how we can bound, given any posterior distribution ν : Ω →M1
+(M),
the divergence K(ν, μ). We can see that
K(ν, μ) = α(ν −μ)π(R) + K(ν, μ) −K(μ, μ).
Now, let us introduce the conditional posterior distribution
	π = πexp(−γr)
and let us decompose
(ν −μ)

π(R)

= ν

π(R) −	π(R)

+ (ν −μ)

	π(R)

+ μ

	π(R) −π(R)

.
Starting from the exponential inequality
P

μ

π ⊗π

exp

−N log

1 −tanh( γ
N )R′
−γr′ −N log

cosh( γ
N )

m′
≤1,
and reasoning in the same way that led to Theorem 2.1.1 (page 52) in the simple
case when we take in this theorem λ = γ, we get with P probability at least 1 −ϵ,
that

2.3.
Two step localization
103
−N log

1 −tanh( γ
N )ν(π −	π)(R)

+ βν(π −	π)(R)
≤ν

log

	π

exp

N log

cosh( γ
N )	π(m′)

+ K(ν, μ) −log(ϵ).
−N log

1 −tanh( γ
N )μ(	π −π)(R)

−βμ(	π −π)(R)
≤μ

log

	π

exp

N log

cosh( γ
N )	π(m′)

−log(ϵ).
In the meantime, using Theorem 2.2.1 (page 68) and Corollary 2.3.5 above, we
see that with P probability at least 1−2ϵ, for any conditional posterior distribution
ρ : Ω × M →M1
+(Θ),
−N log

1 −tanh( λ
N )(ν −μ)ρ(R)

≤λ(ν −μ)ρ(r)
+ N log

cosh( λ
N )

(νρ) ⊗(μρ)(m′) + (ν + μ)K(ρ, π) + K(ν, μ) −log(ϵ)
≤λ(ν −μ)ρ(r) + N log

cosh( λ
N )

(νρ) ⊗(μρ)(m′) + K(ν, μ) −log(ϵ)
+

1 −γ
λ
−1
(ν + μ)

K

ρ, 	π

+ log

	π

exp

N γ
λ log

cosh( λ
N )

ρ(m′)

+

λ
γ −1
−1
K(ν, μ) −2 log(ϵ)

.
Putting all this together, we see that with P probability at least 1 −3ϵ, for any
posterior distribution ν ∈M1
+(M),

1 −
α
N tanh( γ
N ) + β −
α
N tanh( λ
N )

1 −γ
λ


K(ν, μ) ≤
α

N tanh( γ
N ) + β
−1
ν

log

	π

exp

N log

cosh( γ
N )

	π(m′)

−log(ϵ)

+ α

N tanh( γ
N ) −β
−1
μ

log

	π

exp

N log

cosh( γ
N )

	π(m′)

−log(ϵ)

+ α

N tanh( λ
N )
−1

λ(ν −μ)	π(r) + N log

cosh( λ
N )

(ν	π) ⊗(μ	π)(m′)
+

1 −γ
λ
−1
(ν + μ)

log

	π

exp

N γ
λ log

cosh( λ
N )

	π(m′)

−1 + γ
λ
1 −γ
λ
log(ϵ)

+ K(ν, μ) −K(μ, μ).
Replacing in the right-hand side of this inequality the unobserved prior distribution
μ with the worst possible posterior distribution, we obtain
Theorem 2.3.6. For any positive real constants α, β, γ and λ, using the notation,
π = πexp(−βR),
μ = μexp[−απ(R)],
	π = πexp(−γr),

104
Chapter 2.
Comparing posterior distributions to Gibbs priors
	μ = μexp[−α λ
N tanh( λ
N )−1	π(r)],
with P probability at least 1 −ϵ, for any posterior distribution ν : Ω →M1
+(M),

1 −
α
N tanh( γ
N ) + β −
α
N tanh( λ
N )

1 −γ
λ


K(ν, μ) ≤K(ν, 	μ)
+
α
N tanh( γ
N ) + β

ν

log

	π

exp

N log

cosh( γ
N )

	π(m′)

+
α
N tanh( λ
N )(1 −γ
λ)

ν

log

	π

exp

N γ
λ log

cosh( λ
N )

	π(m′)

+ log

	μ
&
	π

exp

N log

cosh( γ
N )

	π(m′)

α
N tanh( γ
N )−β
×

	π

exp

N γ
λ log

cosh( λ
N )

	π(m′)

α
N tanh( λ
N )(1−γ
λ )
× exp
α log[cosh( λ
N )]
tanh( λ
N )
(ν	π) ⊗	π(m′)
'
+

1
N tanh( γ
N ) + β +
1
N tanh( γ
N ) −β +
1 + γ
λ
N tanh( λ
N )

1 −γ
λ


log

 3
ϵ

.
This result is satisfactory, but in the same time hints at some possible improve-
ment in the choice of the localized prior μ, which is here somewhat lacking a variance
term. We will consider in the remainder of this section the use of
(2.38)
μ = μexp[−απ(R)−ξπ⊗π(M ′),
where ξ is some positive real constant and π = πexp(−
βR) is some appropriate
conditional prior distribution with positive real parameter β. With this new choice
K(ν, μ) = α(ν −μ)π(R) + ξ(ν −μ)(π ⊗π)(M ′) + K(ν, μ) −K(μ, μ).
We already know how to deal with the ﬁrst factor α(ν −μ)π(R), since the com-
putations we made to give it an empirical upper bound were valid for any choice
of the localized prior distribution μ. Let us now deal with ξ(ν −μ)(π ⊗π)(M ′).
Since m′(θ, θ′) is a sum of independent Bernoulli random variables, we can easily
generalize the result of Theorem 1.1.4 (page 4) to prove that with P probability at
least 1 −ϵ
N

1 −exp(−ζ
N )

ν(π ⊗π)(M ′)
≤ζΦ ζ
N

ν(π ⊗π)(M ′)

≤ζν(π ⊗π)(m′) + K(ν, μ) −log(ϵ).
In the same way, with P probability at least 1 −ϵ,
−N

exp( ζ
N ) −1

μ(π ⊗π)(M ′)
≤−ζΦ−ζ
N

μ(π ⊗π)(M ′)

≤−ζμ(π ⊗π)(m′) −log(ϵ).
We would like now to replace (π⊗π)(m′) with an empirical quantity. In order to do
this, we will use an entropy bound. Indeed for any conditional posterior distribution
ρ : Ω × M →M1
+(Θ),

2.3.
Two step localization
105
ν

K(ρ, π)

= βν(ρ −π)(R) + ν

K(ρ, π) −K(π, π)

≤
β
N tanh( γ
N )

γν(ρ −π)(r) + N log

cosh( γ
N )

ν(ρ ⊗π)(m′)
+ K(ν, μ) + ν

K(ρ, π)

−log(ϵ)

+ ν

K(ρ, π) −K(π, π)

.
Thus choosing β = N tanh( γ
N ),
γν(π −ρ)(r) + ν

K(π, π) −K(ρ, π)

≤N log

cosh( γ
N )

ν(ρ ⊗π)(m′) + K(ν, μ) −log(ϵ).
Choosing ρ = 	π, we get
ν

K(π, 	π)

≤N log

cosh( γ
N )

ν(	π ⊗π)(m′) + K(ν, μ) −log(ϵ).
This implies that
ξν(	π ⊗π)(m′) = ν

π

ξ	π(m′)

−K(π, 	π)

+ ν

K(π, 	π)

≤ν

log

	π

exp

ξ	π(m′)

+ N log

cosh( γ
N )

ν(	π ⊗π)(m′) + K(ν, μ) −log(ϵ).
Thus

ξ −N log

cosh( γ
N )

ν(	π ⊗π)(m′)
≤ν

log

	π

exp

ξ	π(m′)

+ K(ν, μ) −log(ϵ)
and
ν

K(π, 	π)

≤
 
ξ
N log[cosh( γ
N )] −1
!−1
ν

log

	π

exp

ξ	π(m′)

+ K(ν, μ) −log(ϵ)

+ K(ν, μ) −log(ϵ).
Taking for simplicity ξ = 2N log

cosh( γ
N )

and noticing that
2N log

cosh( γ
N )

= −N log

1 −
β2
N 2

,
we get
Theorem 2.3.7. Let us put π = πexp(−
βR) and 	π = πexp(−γr), where γ is some
arbitrary positive real constant and β = N tanh( γ
N ), so that γ =
N
2 log

1+ 
β
N
1−
β
N

.
With P probability at least 1 −ϵ,
ν

K(π, 	π)

≤ν

log

	π

exp

2N log

cosh( γ
N )

	π(m′)

+ 2

K(ν, μ) −log(ϵ)

.

106
Chapter 2.
Comparing posterior distributions to Gibbs priors
As a consequence
ζν(π ⊗π)(m′) = ζν(π ⊗π)(m′) −ν

K(π ⊗π, 	π ⊗	π)

+ 2ν

K(π, 	π)

≤ν

log

	π ⊗	π

exp(ζm′)

+ 2ν

log

	π

exp

2N log

cosh( γ
N )

	π(m′)

+ 4

K(ν, μ) −log(ϵ)

.
Let us take for the sake of simplicity ζ = 2N log

cosh( γ
N )

, to get
ζν(π ⊗π)(m′) ≤3ν

log

	π ⊗	π

exp(ζm′)

+ 4

K(ν, μ) −log(ϵ)

.
This proves
Proposition 2.3.8. Let us consider some arbitrary prior distribution μ ∈M1
+(M)
and some arbitrary conditional prior distribution π : M →M1
+(Θ). Let β < N be
some positive real constant. Let us put π = πexp(−
βR) and 	π = πexp(−γr), with
β = N tanh( γ
N ). Moreover let us put ζ = 2N log

cosh( γ
N )

. With P probability at
least 1 −2ϵ, for any posterior distribution ν ∈M1
+(M),
ν(π ⊗π)(M ′) ≤
3ν

log

	π ⊗	π

exp(ζm′)

+ 5

K(ν, μ) −log(ϵ)

N

1 −exp(−ζ
N )

=
1
N tanh( γ
N )2

3ν

log

	π ⊗	π

exp

2N log

cosh( γ
N )

m′
+ 5

K(ν, μ) −log(ϵ)

.
In the same way,
−ζμ(π ⊗π)(m′) ≤μ

log

	π ⊗	π

exp(−ζm′)

+ 2μ

log

	π

exp

2N log

cosh( γ
N )

	π(m′)

−4 log(ϵ)
and thus
−μ(π ⊗π)(M ′) ≤
1
N

exp( ζ
N ) −1


μ

log

	π ⊗	π

exp(−ζm′)

+ 2μ

log

	π

exp

2N log

cosh( γ
N )

	π(m′)

−5 log(ϵ)

.
Here we have purposely kept ζ as an arbitrary positive real constant, to be tuned
later (in order to be able to strengthen more or less the compensation of variance
terms).
We are now properly equipped to estimate the divergence with respect to μ, the
choice of prior distribution made in equation (2.38, page 104). Indeed we can now
write

1 −
α
N tanh( γ
N ) + β −
α
N tanh( λ
N )

1 −γ
λ
 −
5ξ
N tanh( γ
N )2

K(ν, μ)

2.3.
Two step localization
107
≤
α
N tanh( γ
N ) + β

ν

log

	π

exp

N log

cosh( γ
N )

	π(m′)

−log(ϵ)

+
α
N tanh( γ
N ) −β

μ

log

	π

exp

N log

cosh( γ
N )

	π(m′)

−log(ϵ)

+
α
N tanh( λ
N )

λ(ν −μ)	π(r) + N log

cosh( λ
N )

(ν	π) ⊗(μ	π)(m′)
+

1 −γ
λ
−1
(ν + μ)

log

	π

exp

N γ
λ log

cosh( λ
N )

	π(m′)

−1 + γ
N
1 −γ
N
log(ϵ)

+
ξ
N tanh( γ
N )2

3ν

log

	π ⊗	π

exp

2N log

cosh( γ
N )

m′
−5 log(ϵ)

+
ξ
N

exp( ζ
N ) −1


μ

log

	π ⊗	π

exp(−ζm′)

+ 2μ

log

	π

exp

2N log

cosh( γ
N )

	π(m′)

−5 log(ϵ)

.
+ K(ν, μ) −K(μ, μ).
It remains now only to replace in the right-hand side of this inequality μ with
the worst possible posterior distribution to obtain
Theorem 2.3.9.
Let λ > γ > β, ζ, α and ξ be arbitrary positive real constants.
Let us use the notation π = πexp(−βR), π = πexp(−N tanh( γ
N )R), 	π = πexp(−γr), μ =
μexp[−απ(R)−ξπ⊗π(M ′)] and let us deﬁne the posterior distribution 	μ : Ω →M1
+(M)
by
d	μ
dμ ∼exp

−
αλ
N tanh( λ
N )	π(r)
+
ξ
N

exp( ζ
N ) −1
 log

	π ⊗	π

exp(−ζm′)

.
Let us assume moreover that
α
N tanh( γ
N ) + β +
α
N tanh( λ
N )(1 −γ
λ) +
5ξ
N tanh( γ
N )2 < 1.
With P probability at least 1 −ϵ, for any posterior distribution ν : Ω →M1
+(M),
K(ν, μ) ≤

1 −
α
N tanh( γ
N ) + β
−
α
N tanh( λ
N )

1 −γ
λ
 −
5ξ
N tanh( γ
N )2
−1
K(ν, 	μ)
+
α
N tanh( γ
N ) + β

ν

log

	π

exp

N log

cosh( γ
N )

	π(m′)


108
Chapter 2.
Comparing posterior distributions to Gibbs priors
+
α
N tanh( λ
N )

1 −γ
λ


ν

log

	π

exp

N γ
λ log

cosh( λ
N )

	π(m′)

+
ξ
N tanh( γ
N )2

3ν

log

	π ⊗	π

exp

2N log

cosh( γ
N )

m′
+
ξ
N

exp( ζ
N ) −1


ν

log

	π ⊗	π

exp(−ζm′)

+ log

	μ

	π

exp

N log

cosh( γ
N )

	π(m′)

α
N tanh( γ
N )−β
×

	π

exp

N γ
λ log

cosh( λ
N )

	π(m′)

α
N tanh( λ
N )

1−γ
λ

×

	π

exp

2N log

cosh( γ
N )

	π(m′)

2ξ
N

exp( ζ
N )−1

× exp

N log

cosh( λ
N )

(ν	π) ⊗	π

(m′)

+
&
α
N tanh( γ
N ) + β +
α
N tanh( γ
N ) −β +
2α

1 + γ
N

N tanh( λ
N )

1 −γ
λ

+
5ξ
N tanh( γ
N )2 +
5ξ
N

exp( ζ
N ) −1

'
log

 5
ϵ


.
The interest of this theorem lies in the presence of a variance term in the localized
posterior distribution 	μ, which with a suitable choice of parameters seems to be an
interesting option in the case when there are nested models: in this situation there
may be a need to prevent integration with respect to 	μ in the right-hand side to
put weight on wild oversized models with large variance terms. Moreover, the right-
hand side being empirical, parameters can be, as usual, optimized from data using
a union bound on a grid of candidate values.
If one is only interested in the general shape of the result, a simpliﬁed inequality
as the one below may suﬃce:
Corollary 2.3.10.
For any positive real constants λ > γ > β, ζ, α and ξ, let us
use the same notation as in Theorem 2.3.9 (page 107). Let us put moreover
A1 =
α
N tanh( γ
N ) + β +
α
N tanh( λ
N )

1 −γ
λ
 +
5ξ
N tanh( γ
N )2 ,
A2 =
α
N tanh( γ
N ) + β +
α
N tanh( λ
N )

1 −γ
λ
 +
3ξ
N tanh( γ
N )2
A3 =
ξ
N

exp

 ζ
N

−1

A4 =
α
N tanh( γ
N ) −β +
α
N tanh( λ
N )(1 −γ
λ) +
2ξ
N[exp( ζ
N ) −1]
,
A5 =
α
N tanh( γ
N ) + β +
α
N tanh( γ
N ) −β +
2α

1 + γ
N

N tanh( λ
N )

1 −γ
λ

+
5ξ
N tanh( γ
N )2 +
5ξ
N

exp( ζ
N ) −1
,
C1 = 2N log

cosh

 λ
N

,

2.3.
Two step localization
109
C2 = N log

cosh

 λ
N

.
Let us assume that A1 < 1. With P probability at least 1 −ϵ, for any posterior
distribution ν : Ω →M1
+(M),
K(ν, μ) ≤K(ν, α, β, γ, λ, ξ, ζ, ϵ)
def
=

1 −A1
−1

K(ν, 	μ)
+ A2ν

log

	π ⊗	π

exp

C1m′
+ A3ν

log

	π ⊗	π

exp

−ζm′ 
+ log

	μ

	π

exp

C1	π(m′)
A4
exp

C2

(ν	π) ⊗	π

(m′)

+ A5 log

 5
ϵ


.
Putting this corollary together with Corollary 2.3.5 (page 102), we obtain
Theorem 2.3.11. Let us consider the notation introduced in Corollary 2.3.5 (page
102) and in Theorem 2.3.9 (page 107) and its Corollary 2.3.10 (page 108). Let us
consider real positive parameters λ, γ′
1 < λ′
1 and γ′
2 < λ′
2. Let us consider also two
sets of parameters αi, βi, γi, λi, ξi, ζi,where i = 1, 2, both satisfying the conditions
stated in Corollary 2.3.10 (page 108). With P probability at least 1 −ϵ, for any
posterior distributions ν1, ν2 : Ω →M1
+(M), any conditional posterior distributions
ρ1, ρ2 : Ω × M →M1
+

Θ

,
−N log

1 −tanh

 λ
N

ν1ρ1 −ν2ρ2

(R)

≤λ

ν1ρ1 −ν2ρ2

(r)
+ N log

cosh

 λ
N

ν1ρ1

⊗

ν2ρ2

m′ 
+ K′
ν1, ρ1, γ′
1, λ′
1, ϵ
5

+ K′
ν2, ρ2, γ′
2, λ′
2, ϵ
5

+
1
1 −γ′
1
λ′
1
K

ν1, α1, β1, γ1, λ1, ξ1, ζ1, ϵ
5

+
1
1 −γ′
2
λ′
2
K

ν2, α2, β2, γ2, λ2, ξ2, ζ2, ϵ
5

−log

 ϵ
5

.
This theorem provides, using a union bound argument to further optimize the
parameters, an empirical bound for ν1ρ1(R) −ν2ρ2(R), which can serve to build
a selection algorithm exactly in the same way as what was done in Theorem 2.2.4
(page 72). This represents the highest degree of sophistication that we will achieve
in this monograph, as far as model selection is concerned: this theorem shows that
it is indeed possible to derive a selection scheme in which localization is performed
in two steps and in which the localization of the model selection itself, as opposed
to the localization of the estimation in each model, includes a variance term as well
as a bias term, so that it should be possible to localize the choice of nested mod-
els, something that would not have been feasible with the localization techniques
exposed in the previous sections of this study. We should point out however that
more sophisticated does not necessarily mean more eﬃcient: as the reader may
have noticed, sophistication comes at a price, in terms of the complexity of the
estimation schemes, with some possible loss of accuracy in the constants that can
mar the beneﬁts of using an asymptotically more eﬃcient method for small sample
sizes.

110
Chapter 2.
Comparing posterior distributions to Gibbs priors
We will do the hurried reader a favour: we will not launch into a study of the
theoretical properties of this selection algorithm, although it is clear that all the
tools needed are at hand!
We would like as a conclusion to this chapter, to put forward a simple idea:
this approach of model selection revolves around entropy estimates concerned with
the divergence of posterior distributions with respect to localized prior distribu-
tions. Moreover, this localization of the prior distribution is more eﬀectively done
in several steps in some situations, and it is worth mentioning that these situations
include the typical case of selection from a family of parametric models. Finally,
the whole story relies upon estimating the relative generalization error rate of one
posterior distribution with respect to some local prior distribution as well as with
respect to another posterior distribution, because these relative rates can be esti-
mated more accurately than absolute generalization error rates, at least as soon
as no classiﬁcation model of reasonable size provides a good match to the training
sample, meaning that the classiﬁcation problem is either diﬃcult or noisy.

Chapter 3
Transductive PAC-Bayesian
learning
3.1. Basic inequalities
3.1.1. The transductive setting.
In this chapter the observed sample (Xi,
Yi)N
i=1 will be supplemented with a test or shadow sample (Xi, Yi)(k+1)N
i=N+1 . This point
of view, called transductive classiﬁcation, has been introduced by V. Vapnik. It may
be justiﬁed in diﬀerent ways.
On the practical side, one interest of the transductive setting is that it is often a
lot easier to collect examples than it is to label them, so that it is not unrealistic to
assume that we indeed have two training samples, one labelled and one unlabelled.
It also covers the case when a batch of patterns is to be classiﬁed and we are allowed
to observe the whole batch before issuing the classiﬁcation.
On the mathematical side, considering a shadow sample proves technically fruit-
ful. Indeed, when introducing the Vapnik–Cervonenkis entropy and Vapnik–Cervo-
nenkis dimension concepts, as well as when dealing with compression schemes, albeit
the inductive setting is our ﬁnal concern, the transductive setting is a useful detour.
In this second scenario, intermediate technical results involving the shadow sample
are integrated with respect to unobserved random variables in a second stage of the
proofs.
Let us describe now the changes to be made to previous notation to adapt them
to the transductive setting. The distribution P will be a probability measure on the
canonical space Ω = (X×Y)(k+1)N, and (Xi, Yi)(k+1)N
i=1
will be the canonical process
on this space (that is the coordinate process). Unless explicitly mentioned, the
parameter k indicating the size of the shadow sample will remain ﬁxed. Assuming
the shadow sample size is a multiple of the training sample size is convenient without
signiﬁcantly restricting generality. For a while, we will use a weaker assumption than
independence, assuming that P is partially exchangeable, since this is all we need in
the proofs.
Definition 3.1.1. For i = 1, . . . , N, let τi
: Ω →Ω be deﬁned for any
111

112
Chapter 3.
Transductive PAC-Bayesian learning
ω = (ωj)(k+1)N
j=1
∈Ω by
⎧
⎪
⎨
⎪
⎩
τi(ω)i+jN = ωi+(j−1)N,
j = 1, . . . , k,
τi(ω)i = ωi+kN,
and τi(ω)m+jN = ωm+jN,
m ̸= i, m = 1, . . . , N, j = 0, . . . k.
Clearly, if we arrange the (k + 1)N samples in a N × (k + 1) array, τi performs
a circular permutation of k + 1 entries on the ith row, leaving the other rows
unchanged. Moreover, all the circular permutations of the ith row have the form
τ j
i , j ranging from 0 to k.
The probability distribution P is said to be partially exchangeable if for any
i = 1, . . . , N, P ◦τ −1
i
= P.
This means equivalently that for any bounded measurable function h : Ω →R,
P(h ◦τi) = P(h).
In the same way a function h deﬁned on Ω will be said to be partially exchange-
able if h ◦τi = h for any i = 1, . . . , N. Accordingly a posterior distribution ρ : Ω →
M1
+(Θ, T) will be said to be partially exchangeable when ρ(ω, A) = ρ

τi(ω), A

, for
any ω ∈Ω, any i = 1, . . . , N and any A ∈T.
For any bounded measurable function h, let us deﬁne Ti(h) =
1
k+1
k
j=0 h ◦τ j
i .
Let T(h) = TN ◦· · ·◦T1(h). For any partially exchangeable probability distribution
P, and for any bounded measurable function h, P

T(h)

= P(h). Let us put
σi(θ) = 1

fθ(Xi) ̸= Yi

,
indicating the success or failure of fθ
to predict Yi from Xi,
r1(θ) = 1
N
N

i=1
σi(θ),
the empirical error rate of fθ
on the observed sample,
r2(θ) =
1
kN
(k+1)N

i=N+1
σi(θ),
the error rate of fθ on the shadow sample,
r(θ) = r1(θ) + kr2(θ)
k + 1
=
1
(k + 1)N
(k+1)N

i=1
σi(θ),
the global error
rate of fθ,
Ri(θ) = P

fθ(Xi) ̸= Yi

,
the expected error
rate of fθ on the ith input,
R(θ) = 1
N
N

i=1
Ri(θ) = P

r1(θ)

= P

r2(θ)

,
the average expected
error rate of fθ on all inputs.
We will allow for posterior distributions ρ : Ω →M1
+(Θ) depending on the shadow
sample. The most interesting ones will anyhow be independent of the shadow labels
YN+1, . . . , Y(k+1)N. We will be interested in the conditional expected error rate of
the randomized classiﬁcation rule described by ρ on the shadow sample, given the
observed sample, that is, P

ρ(r2)|(Xi, Yi)N
i=1

. This is a natural extension of the
notion of generalization error rate: this is indeed the error rate to be expected
when the randomized classiﬁcation rule described by the posterior distribution ρ
is applied to the shadow sample (which should in this case more purposefully be
called the test sample).

3.1.
Basic inequalities
113
To see the connection with the previously deﬁned generalization error rate, let us
comment on the case when P is invariant by any permutation of any row, meaning
that
P

h(ω ◦s)

= P

h(ω)

for all s ∈S({i + jN; j = 0, . . . , k})
and all i = 1, . . . , N, where S(A) is the set of permutations of A, extended to
{1, . . . , (k + 1)N} so as to be the identity outside of A. In other words, P is as-
sumed to be invariant under any permutation which keeps the rows unchanged.
In this case, if ρ is invariant by any permutation of any row of the shadow sam-
ple, meaning that ρ(ω ◦s) = ρ(ω) ∈M1
+(Θ), s ∈S({i + jN; j = 1, . . . , k}),
i = 1, . . . , N, then P

ρ(r2)|(Xi, Yi)N
i=1

=
1
N
N
i=1 P

ρ(σi+N)|(Xi, Yi)N
i=1

, meaning
that the expectation can be taken on a restricted shadow sample of the same size as
the observed sample. If moreover the rows are equidistributed, meaning that their
marginal distributions are equal, then
P

ρ(r2)|(Xi, Yi)N
i=1

= P

ρ(σN+1)|(Xi, Yi)N
i=1

.
This means that under these quite commonly fulﬁlled assumptions, the expectation
can be taken on a single new object to be classiﬁed, our study thus covers the case
when only one of the patterns from the shadow sample is to be labelled and one is
interested in the expected error rate of this single labelling. Of course, in the case
when P is i.i.d. and ρ depends only on the training sample (Xi, Yi)N
i=1, we fall back
on the usual criterion of performance P

ρ(r2)|(Zi)N
i=1

= ρ(R) = ρ(R1).
3.1.2. Absolute bound.
Using an obvious factorization, and considering for the
moment a ﬁxed value of θ and any partially exchangeable positive real measurable
function λ : Ω →R+, we can compute the log-Laplace transform of r1 under T,
which acts like a conditional probability distribution:
log

T

exp(−λr1)

=
N

i=1
log

Ti

exp(−λ
N σi)

≤N log
 1
N
N

i=1
Ti

exp

−λ
N σi

= −λΦ λ
N (r),
where the function Φ λ
N was deﬁned by equation (1.1, page 2). Remarking that
T

exp

λ

Φ λ
N (r) −r1

= exp

λΦ λ
N (r)

T

exp(−λr1)

we obtain
Lemma 3.1.1. For any θ ∈Θ and any partially exchangeable positive real measur-
able function λ : Ω →R+,
T

exp

λ

Φ λ
N

r(θ)

−r1(θ)

≤1.
We deduce from this lemma a result analogous to the inductive case:
Theorem 3.1.2. For any partially exchangeable positive real measurable function
λ : Ω × Θ →R+, for any partially exchangeable posterior distribution π : Ω →
M1
+(Θ),
P

exp

sup
ρ∈M1
+(Θ)
ρ

λ

Φ λ
N (r) −r1

−K(ρ, π)

≤1.

114
Chapter 3.
Transductive PAC-Bayesian learning
The proof is deduced from the previous lemma, using the fact that π is partially
exchangeable:
P

exp

sup
ρ∈M1
+(Θ)
ρ

λ

Φ λ
N (r) −r1

−K(ρ, π)

= P

π

exp

λ

Φ λ
N (r) −r1

= P

Tπ

exp

λ

Φ λ
N (r) −r1

= P

π

T exp

λ

Φ λ
N (r) −r1

≤1.
3.1.3. Relative bounds.
Introducing in the same way
m′(θ, θ′) = 1
N
N

i=1
2221

fθ(Xi) ̸= Yi

−1

fθ′(Xi) ̸= Yi
222
and
m(θ, θ′) =
1
(k + 1)N
(k+1)N

i=1
2221

fθ(Xi) ̸= Yi

−1

fθ′(Xi) ̸= Yi
222,
we could prove along the same line of reasoning
Theorem 3.1.3. For any real parameter λ, any θ ∈Θ, any partially exchangeable
posterior distribution π : Ω →M1
+(Θ),
P

exp

sup
ρ∈M1
+(Θ)
λ

ρ

Ψ λ
N

r(·) −r(θ), m(·, θ)

−

ρ(r1) −r1(θ)

−K(ρ, π)

≤1,
where the function Ψ λ
N was deﬁned by equation (1.21, page 35).
Theorem 3.1.4. For any real constant γ, for any θ ∈Θ, for any partially ex-
changeable posterior distribution π : Ω →M1
+(Θ),
P

exp
&
sup
ρ∈M1
+(Θ)

−Nρ

log

1 −tanh

 γ
N

r(·) −r(θ)

−γ

ρ(r1) −r1(θ)

−N log

cosh

 γ
N

ρ

m′(·, θ)

−K(ρ, π)
'
≤1.
This last theorem can be generalized to give
Theorem 3.1.5. For any real constant γ, for any partially exchangeable posterior
distributions π1, π2 : Ω →M1
+(Θ),
P

exp
&
sup
ρ1,ρ2∈M1
+(Θ)

−N log

1 −tanh

 γ
N

ρ1(r) −ρ2(r)

−γ

ρ1(r1) −ρ2(r1)

−N log

cosh

 γ
N

ρ1 ⊗ρ2(m′)
−K(ρ1, π1) −K(ρ2, π2)
'
≤1.

3.2.
Vapnik bounds for transductive classiﬁcation
115
To conclude this section, we see that the basic theorems of transductive PAC-
Bayesian classiﬁcation have exactly the same form as the basic inequalities of in-
ductive classiﬁcation, Theorems 1.1.4 (page 4), 1.4.2 (page 35) and 1.4.3 (page 37)
with R(θ) replaced with r(θ), r(θ) replaced with r1(θ) and M ′(θ, θ) replaced with
m(θ, θ).
Thus all the results of the ﬁrst two chapters remain true under the hypotheses
of transductive classiﬁcation, with R(θ) replaced with r(θ), r(θ) replaced with r1(θ)
and M ′(θ, θ ) replaced with m(θ, θ).
Consequently, in the case when the unlabelled shadow sample is observed, it is
possible to improve on the Vapnik bounds to be discussed hereafter by using an ex-
plicit partially exchangeable posterior distribution π and resorting to localized or
to relative bounds (in the case at least of unlimited computing resources, which of
course may still be unrealistic in many real world situations, and with the caveat,
to be recalled in the conclusion of this study, that for small sample sizes and com-
paratively complex classiﬁcation models, the improvement may not be so decisive).
Let us notice also that the transductive setting when experimentally available,
has the advantage that
d(θ, θ′) =
1
(k + 1)N
(k+1)N

i=1
1

fθ′(Xi) ̸= fθ(Xi)

≥m(θ, θ′) ≥r(θ) −r(θ′),
θ, θ′ ∈Θ,
is observable in this context, providing an empirical upper bound for the diﬀerence
r(	θ) −ρ(r) for any non-randomized estimator 	θ and any posterior distribution ρ,
namely
r(	θ) ≤ρ(r) + ρ

d(·, 	θ)

.
Thus in the setting of transductive statistical experiments, the PAC-Bayesian frame-
work provides fully empirical bounds for the error rate of non-randomized estima-
tors 	θ : Ω →Θ, even when using a non-atomic prior π (or more generally a non-
atomic partially exchangeable posterior distribution π), even when Θ is not a vector
space and even when θ →R(θ) cannot be proved to be convex on the support of
some useful posterior distribution ρ.
3.2. Vapnik bounds for transductive classification
In this section, we will stick to plain unlocalized non-relative bounds. As we have
already mentioned, (and as it was put forward by Vapnik himself in his seminal
works), these bounds are not always superseded by the asymptotically better ones
when the sample is of small size: they deserve all our attention for this reason. We
will start with the general case of a shadow sample of arbitrary size. We will then
discuss the case of a shadow sample of equal size to the training set and the case of
a fully exchangeable sample distribution, showing how they can be taken advantage
of to sharpen inequalities.
3.2.1. With a shadow sample of arbitrary size.
The great thing with the
transductive setting is that we are manipulating only r1 and r which can take only
a ﬁnite number of values and therefore are piecewise constant on Θ. This makes it
possible to derive inequalities that will hold uniformly for any value of the parameter

116
Chapter 3.
Transductive PAC-Bayesian learning
θ ∈Θ. To this purpose, let us consider for any value θ ∈Θ of the parameter the
subset Δ(θ) ⊂Θ of parameters θ′ such that the classiﬁcation rule fθ′ answers the
same on the extended sample (Xi)(k+1)N
i=1
as fθ. Namely, let us put for any θ ∈Θ
Δ(θ) =

θ′ ∈Θ; fθ′(Xi) = fθ(Xi), i = 1, . . . , (k + 1)N

.
We see immediately that Δ(θ) is an exchangeable parameter subset on which r1 and
r2 and therefore also r take constant values. Thus for any θ ∈Θ we may consider
the posterior ρθ deﬁned by
dρθ
dπ (θ′) = 1

θ′ ∈Δ(θ)

π

Δ(θ)
−1,
and use the fact that ρθ(r1) = r1(θ) and ρθ(r) = r(θ), to prove that
Lemma 3.2.1. For any partially exchangeable positive real measurable function λ :
Ω × Θ →R such that
(3.1)
λ(ω, θ′) = λ(ω, θ),
θ ∈Θ, θ′ ∈Δ(θ), ω ∈Ω,
and any partially exchangeable posterior distribution π : Ω →M1
+(Θ), with P prob-
ability at least 1 −ϵ, for any θ ∈Θ,
Φ λ
N

r(θ)

+ log

ϵπ

Δ(θ)

λ(θ)
≤r1(θ).
We can then remark that for any value of λ independent of ω, the left-hand side
of the previous inequality is a partially exchangeable function of ω ∈Ω. Thus this
left-hand side is maximized by some partially exchangeable function λ, namely
arg max
λ

Φ λ
N

r(θ)

+ log

ϵπ

Δ(θ)

λ

is partially exchangeable as depending only on partially exchangeable quantities.
Moreover this choice of λ(ω, θ) satisﬁes also condition (3.1) stated in the previous
lemma of being constant on Δ(θ), proving
Lemma 3.2.2. For any partially exchangeable posterior distribution π : Ω →
M1
+(Θ), with P probability at least 1 −ϵ, for any θ ∈Θ and any λ ∈R+,
Φ λ
N

r(θ)

+ log

ϵπ

Δ(θ)

λ
≤r1(θ).
Writing r = r1+kr2
k+1
and rearranging terms we obtain
Theorem 3.2.3. For any partially exchangeable posterior distribution π : Ω →
M1
+(Θ), with P probability at least 1 −ϵ, for any θ ∈Θ,
r2(θ) ≤k + 1
k
inf
λ∈R+
1 −exp
"
−λ
N r1(θ) + log

ϵπ

Δ(θ)

N
#
1 −exp

−λ
N

−r1(θ)
k
.

3.2.
Vapnik bounds for transductive classiﬁcation
117
If we have a set of binary classiﬁcation rules {fθ; θ ∈Θ} whose Vapnik–Cervo-
nenkis dimension is not greater than h, we can choose π such that π

Δ(θ)

is
independent of θ and not less than
 
h
e(k + 1)N
!h
, as will be proved further on in
Theorem 4.2.2 (page 144).
Another important setting where the complexity term −log

π

Δ(θ)

can eas-
ily be controlled is the case of compression schemes, introduced by Little et al.
(1986). It goes as follows: we are given for each labelled sub-sample (Xi, Yi)i∈J,
J ⊂{1, . . . , N}, an estimator of the parameter
	θ

(Xi, Yi)i∈J

= 	θJ,
J ⊂{1, . . . , N}, |J| ≤h,
where
	θ :
N
@
k=1

X × Y
k →Θ
is an exchangeable function providing estimators for sub-samples of arbitrary size.
Let us assume that 	θ is exchangeable, meaning that for any k = 1, . . . , N and any
permutation σ of {1, . . . , k}
	θ

(xi, yi)k
i=1

= 	θ

(xσ(i), yσ(i))k
i=1

,
(xi, yi)k
i=1 ∈

X × Y
k.
In this situation, we can introduce the exchangeable subset

	θJ; J ⊂{1, . . . , (k + 1)N}, |J| ≤h

⊂Θ,
which is seen to contain at most
h

j=0
 (k + 1)N
j
!
≤
 e(k + 1)N
h
!h
classiﬁcation rules — as will be proved later on in Theorem 4.2.3 (page 144). Note
that we had to extend the range of J to all the subsets of the extended sample,
although we will use for estimation only those of the training sample, on which
the labels are observed. Thus in this case also we can ﬁnd a partially exchangeable
posterior distribution π such that
π

Δ(	θJ)

≥
 
h
e(k + 1)N
!h
.
We see that the size of the compression scheme plays the same role in this complexity
bound as the Vapnik–Cervonenkis dimension for Vapnik–Cervonenkis classes.
In these two cases of binary classiﬁcation with Vapnik–Cervonenkis dimension
not greater than h and compression schemes depending on a compression set with
at most h points, we get a bound of
r2(θ) ≤k + 1
k
inf
λ∈R+
1 −exp
⎛
⎝−λ
N r1(θ) −
h log

e(k+1)N
h

−log(ϵ)
N
⎞
⎠
1 −exp

−λ
N

−r1(θ)
k
.

118
Chapter 3.
Transductive PAC-Bayesian learning
Let us make some numerical application: when N = 1000, h = 10, ϵ = 0.01, and
infΘ r1 = r1(	θ) = 0.2, we ﬁnd that r2(	θ) ≤0.4093, for k between 15 and 17,
and values of λ equal respectively to 965, 968 and 971. For k = 1, we ﬁnd only
r2(	θ) ≤0.539, showing the interest of allowing k to be larger than 1.
3.2.2. When the shadow sample has the same size as the training sam-
ple.
In the case when k = 1, we can improve Theorem 3.1.2 by taking advantage
of the fact that Ti(σi) can take only 3 values, namely 0, 0.5 and 1. We see thus that
Ti(σi)−Φ λ
N

Ti(σi)

can take only two values, 0 and 1
2 −Φ λ
N ( 1
2), because Φ λ
N (0) = 0
and Φ λ
N (1) = 1. Thus
Ti(σi) −Φ λ
N

Ti(σi)

=

1 −|1 −2Ti(σi)|
 1
2 −Φ λ
N ( 1
2)

.
This shows that in the case when k = 1,
log

T

exp(−λr1)

= −λr + λ
N
N

i=1
Ti(σi) −Φ λ
N

Ti(σi)

= −λr + λ
N
N

i=1

1 −|1 −2Ti(σi)|
 1
2 −Φ λ
N ( 1
2)

≤−λr + λ
 1
2 −Φ λ
N ( 1
2)

1 −|1 −2r|

.
Noticing that 1
2 −Φ λ
N ( 1
2) = N
λ log

cosh( λ
2N )

, we obtain
Theorem 3.2.4. For any partially exchangeable function λ : Ω×Θ →R+, for any
partially exchangeable posterior distribution π : Ω →M1
+(Θ),
P

exp

sup
ρ∈M1
+(Θ)
ρ

λ(r −r1)
−N log

cosh( λ
2N )

1 −|1 −2r|

−K(ρ, π)

≤1.
As a consequence, reasoning as previously, we deduce
Theorem 3.2.5. In the case when k = 1, for any partially exchangeable posterior
distribution π : Ω →M1
+(Θ), with P probability at least 1 −ϵ, for any θ ∈Θ and
any λ ∈R+,
r(θ) −N
λ log

cosh( λ
2N )

1 −|1 −2r(θ)|

+ log

ϵπ

Δ(θ)

λ
≤r1(θ);
and consequently for any θ ∈Θ,
r2(θ) ≤2 inf
λ∈R+
r1(θ) −log

ϵπ

Δ(θ)

λ
1 −2N
λ log

cosh( λ
2N )
 −r1(θ).
In the case of binary classiﬁcation using a Vapnik–Cervonenkis class of
Vapnik–Cervonenkis dimension not greater than h, we can choose π such that
−log

π

Δ(θ)

≤h log( 2eN
h ) and obtain the following numerical illustration of

3.2.
Vapnik bounds for transductive classiﬁcation
119
this theorem: for N = 1000, h = 10, ϵ = 0.01 and infΘ r1 = r1(	θ) = 0.2, we ﬁnd an
upper bound r2(	θ) ≤0.5033, which improves on Theorem 3.2.3 but still is not un-
der the signiﬁcance level 1
2 (achieved by blind random classiﬁcation). This indicates
that considering shadow samples of arbitrary sizes some noisy situations yields a
signiﬁcant improvement on bounds obtained with a shadow sample of the same size
as the training sample.
3.2.3. When moreover the distribution of the augmented sample is ex-
changeable.
When k = 1 and P is exchangeable meaning that for any bounded
measurable function h : Ω →R and any permutation s ∈S

{1, . . . , 2N}

P

h(ω ◦
s)

= P

h(ω)

, then we can still improve the bound as follows. Let
T ′(h) = 1
N!

s∈S

{N+1,...,2N}
 h(ω ◦s).
Then we can write
1 −|1 −2Ti(σi)| = (σi −σi+N)2 = σi + σi+N −2σiσi+N.
Using this identity, we get for any exchangeable function λ : Ω × Θ →R+,
T

exp

λ(r −r1) −log

cosh( λ
2N )
 N

i=1

σi + σi+N −2σiσi+N

≤1.
Let us put
A(λ) = 2N
λ log

cosh( λ
2N )

,
(3.2)
v(θ) =
1
2N
N

i=1
(σi + σi+N −2σiσi+N).
(3.3)
With this notation
T

exp

λ

r −r1 −A(λ)v

≤1.
Let us notice now that
T ′
v(θ)

= r(θ) −r1(θ)r2(θ).
Let π : Ω →M1
+(Θ) be any given exchangeable posterior distribution. Using the
exchangeability of P and π and the exchangeability of the exponential function, we
get
P

π

exp

λ

r −r1 −A(r −r1r2)

= P

π

exp

λ

r −r1 −AT ′(v)

≤P

π

T ′ exp

λ

r −r1 −Av

= P

T ′π

exp

λ

r −r1 −Av

= P

π

exp

λ

r −r1 −Av

= P

Tπ

exp

λ

r −r1 −Av

= P

π

T exp

λ

r −r1 −Av

≤1.
We are thus ready to state

120
Chapter 3.
Transductive PAC-Bayesian learning
Theorem 3.2.6. In the case when k = 1, for any exchangeable probability dis-
tribution P, for any exchangeable posterior distribution π : Ω →M1
+(Θ), for any
exchangeable function λ : Ω × Θ →R+,
P

exp

sup
ρ∈M1
+(Θ)
ρ

λ

r −r1 −A(λ)(r −r1r2)

−K(ρ, π)

≤1,
where A(λ) is deﬁned by equation (3.2, page 119).
We then deduce as previously
Corollary 3.2.7. For any exchangeable posterior distribution π : Ω →M1
+(Θ),
for any exchangeable probability measure P ∈M1
+(Ω), for any measurable exchange-
able function λ : Ω × Θ →R+, with P probability at least 1 −ϵ, for any θ ∈Θ,
r(θ) ≤r1(θ) + A(λ)

r(θ) −r1(θ)r2(θ)

−log

ϵπ

Δ(θ)

λ
,
where A(λ) is deﬁned by equation (3.2, page 119).
In order to deduce an empirical bound from this theorem, we have to make
some choice for λ(ω, θ). Fortunately, it is easy to show that the bound holds uni-
formly in λ, because the inequality can be rewritten as a function of only one
non-exchangeable quantity, namely r1(θ). Indeed, since r2 = 2r −r1, we see that
the inequality can be written as
r(θ) ≤r1(θ) + A(λ)

r(θ) −2r(θ)r1(θ) + r1(θ)2
−log

ϵπ

Δ(θ)

λ
.
It can be solved in r1(θ), to get
r1(θ) ≥f

λ, r(θ), −log

ϵπ

Δ(θ)

,
where
f(λ, r, d) =

2A(λ)
−1

2rA(λ) −1
+
A
1 −2rA(λ)
2 + 4A(λ)

r

1 −A(λ)

−d
λ

.
Thus we can ﬁnd some exchangeable function λ(ω, θ), such that
f

λ(ω, θ), r(θ), −log

ϵπ

Δ(θ)

= sup
β∈R+
f

β, r(θ), −log

ϵπ

Δ(θ)

.
Applying Corollary 3.2.7 (page 120) to that choice of λ, we see that
Theorem 3.2.8. For any exchangeable probability measure P ∈M1
+(Ω), for any
exchangeable posterior probability distribution π : Ω →M1
+(Θ), with P probability
at least 1 −ϵ, for any θ ∈Θ, for any λ ∈R+,
r(θ) ≤r1(θ) + A(λ)

r(θ) −r1(θ)r2(θ)

−log

ϵπ

Δ(θ)

λ
,
where A(λ) is deﬁned by equation (3.2, page 119).

3.3.
Vapnik bounds for inductive classiﬁcation
121
Solving the previous inequality in r2(θ), we get
Corollary 3.2.9. Under the same assumptions as in the previous theorem, with
P probability at least 1 −ϵ, for any θ ∈Θ,
r2(θ) ≤inf
λ∈R+
r1(θ)

1 + 2N
λ log

cosh( λ
2N )

−2 log

ϵπ

Δ(θ)

λ
1 −2N
λ log

cosh( λ
2N )

1 −2r1(θ)

.
Applying this to our usual numerical example of a binary classiﬁcation model
with Vapnik–Cervonenkis dimension not greater than h = 10, when N = 1000,
infΘ r1 = r1(	θ) = 10 and ϵ = 0.01, we obtain that r2(	θ) ≤0.4450.
3.3. Vapnik bounds for inductive classification
3.3.1. Arbitrary shadow sample size.
We assume in this section that
P =
 N
B
i=1
Pi
!⊗∞
∈M1
+

X × Y
NN
,
where Pi ∈M1
+

X × Y

: we consider an inﬁnite i.i.d. sequence of independent
non-identically distributed samples of size N, the ﬁrst one only being observed.
More precisely, under P each sample (Xi+jN, Yi+jN)N
i=1 is distributed according
to N
i=1 Pi, and they are all independent from each other. Only the ﬁrst sample
(Xi, Yi)N
i=1 is assumed to be observed. The shadow samples will only appear in the
proofs. The aim of this section is to prove better Vapnik bounds, generalizing them
in the same time to the independent non-i.i.d. setting, which to our knowledge has
not been done before.
Let us introduce the notation P′
h(ω)

= P

h(ω) | (Xi, Yi)N
i=1

, where h may be
any suitable (e.g. bounded) random variable, let us also put Ω =

(X × Y)NN.
Definition 3.3.1. For any subset A ⊂N of integers, let C(A) be the set of circular
permutations of the totally ordered set A, extended to a permutation of N by taking
it to be the identity on the complement N \ A of A. We will say that a random
function h : Ω →R is k-partially exchangeable if
h(ω ◦s) = h(ω),
s ∈C

{i + jN ; j = 0, . . . , k}

, i = 1, . . . , N.
In the same way, we will say that a posterior distribution π : Ω →M1
+(Θ) is
k-partially exchangeable if
π(ω ◦s) = π(ω) ∈M1
+(Θ),
s ∈C

{i + jN ; j = 0, . . . , k}

, i = 1, . . . , N.
Note that P itself is k-partially exchangeable for any k in the sense that for any
bounded measurable function h : Ω →R
P

h(ω ◦s)

= P

h(ω)

,
s ∈C

{i + jN ; j = 0, . . . , k}

, i = 1, . . . , N.
Let Δk(θ) =

θ′ ∈Θ ;

fθ′(Xi)
(k+1)N
i=1
=

fθ(Xi)
(k+1)N
i=1

, θ ∈Θ, k ∈N∗, and let
also rk(θ) =
1
(k + 1)N
(k+1)N

i=1
1

fθ(Xi) ̸= Yi

. Theorem 3.1.2 shows that for any

122
Chapter 3.
Transductive PAC-Bayesian learning
positive real parameter λ and any k-partially exchangeable posterior distribution
πk : Ω →M1
+(Θ),
P

exp

sup
θ∈Θ
λ

Φ λ
N (rk) −r1

+ log

ϵπk

Δk(θ)

≤ϵ.
Using the general fact that
P

exp(h)

= P

P′
exp(h)

≥P

exp

P′(h)

,
and the fact that the expectation of a supremum is larger than the supremum of
an expectation, we see that with P probability at most 1 −ϵ, for any θ ∈Θ,
P′
Φ λ
N

rk(θ)

≤r1(θ) −
P′
log

ϵπk

Δk(θ)

λ
.
For short let us put
¯dk(θ) = −log

ϵπk

Δk(θ)

,
d′
k(θ) = −P′
log

ϵπk

Δk(θ)

,
dk(θ) = −P

log

ϵπk

Δk(θ)

.
We can use the convexity of Φ λ
N and the fact that P′(rk) = r1+kR
k+1 , to establish
that
P′
Φ λ
N

rk(θ)

≥Φ λ
N
r1(θ) + kR(θ)
k + 1

.
We have proved
Theorem 3.3.1. Using the above hypotheses and notation, for any sequence πk :
Ω →M1
+(Θ), where πk is a k-partially exchangeable posterior distribution, for any
positive real constant λ, any positive integer k, with P probability at least 1 −ϵ, for
any θ ∈Θ,
Φ λ
N
r1(θ) + kR(θ)
k + 1

≤r1(θ) + d′
k(θ)
λ
.
We can make as we did with Theorem 1.2.6 (page 11) the result of this theorem
uniform in λ ∈{αj ; j ∈N∗} and k ∈N∗(considering on k the prior
1
k(k+1) and on
j the prior
1
j(j+1)), and obtain
Theorem 3.3.2. For any real parameter α > 1, with P probability at least 1 −ϵ,
for any θ ∈Θ,
R(θ) ≤
inf
k∈N∗,j∈N∗
1 −exp

−αj
N r1(θ) −1
N

d′
k(θ) + log

k(k + 1)j(j + 1)

k
k+1

1 −exp

−αj
N

−r1(θ)
k
.

3.3.
Vapnik bounds for inductive classiﬁcation
123
As a special case we can choose πk such that log

πk

Δk(θ)

is independent of
θ and equal to log(Nk), where
Nk =
22
fθ(Xi)
(k+1)N
i=1
; θ ∈Θ
22
is the size of the trace of the classiﬁcation model on the extended sample of size
(k+1)N. With this choice, we obtain a bound involving a new ﬂavour of conditional
Vapnik entropy, namely
d′
k(θ) = P

log(Nk) |(Zi)N
i=1

−log(ϵ).
In the case of binary classiﬁcation using a Vapnik–Cervonenkis class of Vapnik–
Cervonenkis dimension not greater than h = 10, when N = 1000, infΘ r1 = r1(	θ) =
0.2 and ϵ = 0.01, choosing α = 1.1, we obtain R(	θ) ≤0.4271 (for an optimal value
of λ = 1071.8, and an optimal value of k = 16).
3.3.2. A better minimization with respect to the exponential parame-
ter.
If we are not pleased with optimizing λ on a discrete subset of the real line,
we can use a slightly diﬀerent approach. From Theorem 3.1.2 (page 113), we see
that for any positive integer k, for any k-partially exchangeable positive real mea-
surable function λ : Ω × Θ →R+ satisfying equation (3.1, page 116) — with Δ(θ)
replaced with Δk(θ) — for any ϵ ∈)0, 1) and η ∈)0, 1),
P

P′

exp

sup
θ
λ

Φ λ
N (rk) −r1

+ log

ϵηπk

Δk(θ)

≤ϵη,
therefore with P probability at least 1 −ϵ,
P′

exp

sup
θ
λ

Φ λ
N (rk) −r1

+ log

ϵηπk

Δk(θ)

≤η,
and consequently, with P probability at least 1−ϵ, with P′ probability at least 1−η,
for any θ ∈Θ,
Φ λ
N (rk) + log

ϵηπk

Δk(θ)

λ
≤r1.
Now we are entitled to choose
λ(ω, θ) ∈arg max
λ′∈R+ Φ λ′
N (rk) + log

ϵηπk

Δk(θ)

λ′
.
This shows that with P probability at least 1 −ϵ, with P′ probability at least 1 −η,
for any θ ∈Θ,
sup
λ∈R+
Φ λ
N (rk) −
¯dk(θ) −log(η)
λ
≤r1,
which can also be written
Φ λ
N (rk) −r1 −
¯dk(θ)
λ
≤−log(η)
λ
,
λ ∈R+.
Thus with P probability at least 1 −ϵ, for any θ ∈Θ, any λ ∈R+,
P′

Φ λ
N (rk) −r1 −
¯dk(θ)
λ

≤−log(η)
λ
+

1 −r1 + log(η)
λ

η.

124
Chapter 3.
Transductive PAC-Bayesian learning
On the other hand, Φ λ
N being a convex function,
P′

Φ λ
N (rk) −r1 −
¯dk(θ)
λ

≥Φ λ
N

P′(rk)

−r1 −d′
k
λ
= Φ λ
N
 kR + r1
k + 1
!
−r1 −d′
k
λ .
Thus with P probability at least 1 −ϵ, for any θ ∈Θ,
kR + r1
k + 1
≤inf
λ∈R+ Φ−1
λ
N

r1(1 −η) + η + d′
k −log(η)(1 −η)
λ

.
We can generalize this approach by considering a ﬁnite decreasing sequence η0 =
1 > η1 > η2 > · · · > ηJ > ηJ+1 = 0, and the corresponding sequence of levels
Lj = −log(ηj)
λ
, 0 ≤j ≤J,
LJ+1 = 1 −r1 −log(J) −log(ϵ)
λ
.
Taking a union bound in j, we see that with P probability at least 1 −ϵ, for any
θ ∈Θ, for any λ ∈R+,
P′

Φ λ
N (rk) −r1 −
¯dk + log(J)
λ
≥Lj

≤ηj,
j = 0, . . . , J + 1,
and consequently
P′

Φ λ
N (rk) −r1 −
¯dk + log(J)
λ

≤
 LJ+1
0
P′

Φ λ
N (rk) −r1 −
¯dk + log(J)
λ
≥α

dα
≤
J+1

j=1
ηj−1(Lj −Lj−1)
= ηJ

1 −r1 −log(J) −log(ϵ) −log(ηJ)
λ

−log(η1)
λ
+
J−1

j=1
ηj
λ log
 ηj
ηj+1
!
.
Let us put
d′′
k

θ, (ηj)J
j=1

= d′
k(θ) + log(J) −log(η1)
+
J−1

j=1
ηj log
 ηj
ηj+1
!
+ log
ϵηJ
J

ηJ.
We have proved that for any decreasing sequence (ηj)J
j=1, with P probability at
least 1 −ϵ, for any θ ∈Θ,
kR + r1
k + 1
≤inf
λ∈R+ Φ−1
λ
N

r1(1 −ηJ) + ηJ + d′′
k

θ, (ηj)J
j=1

λ

.
Remark 3.3.1. We can for instance choose J = 2, η2 =
1
10N , η1 =
1
log(10N),
resulting in
d′′
k = d′
k + log(2) + log log(10N) + 1 −log log(10N)
log(10N)
−log

 20N
ϵ

10N
.

3.3.
Vapnik bounds for inductive classiﬁcation
125
In the case where N = 1000 and for any ϵ ∈)0, 1), we get d′′
k ≤d′
k + 3.7, in the case
where N = 106, we get d′′
k ≤d′
k +4.4, and in the case N = 109, we get d′′
k ≤d′
k +4.7.
Therefore, for any practical purpose we could take d′′
k = d′
k + 4.7 and ηJ =
1
10N
in the above inequality.
Taking moreover a weighted union bound in k, we get
Theorem 3.3.3. For any ϵ ∈)0, 1), any sequence 1 > η1 > · · · > ηJ > 0, any
sequence πk : Ω →M1
+(Θ), where πk is a k-partially exchangeable posterior distri-
bution, with P probability at least 1 −ϵ, for any θ ∈Θ,
R(θ) ≤inf
k∈N∗
k + 1
k
inf
λ∈R+ Φ−1
λ
N

r1(θ) + ηJ

1 −r1(θ)

+ d′′
k

θ, (ηj)J
j=1

+ log

k(k + 1)

λ

−r1(θ)
k
.
Corollary 3.3.4. For any ϵ ∈)0, 1), for any N ≤109, with P probability at least
1 −ϵ, for any θ ∈Θ,
R(θ) ≤inf
k∈N∗inf
λ∈R+
k + 1
k

1 −exp(−λ
N )
−1

1 −exp

−λ
N

r1(θ) +
1
10N

−P′
log(Nk) | (Zi)N
i=1

−log(ϵ) + log

k(k + 1)

+ 4.7
N

−r1(θ)
k
.
Let us end this section with a numerical example: in the case of binary classi-
ﬁcation with a Vapnik–Cervonenkis class of dimension not greater than 10, when
N = 1000, infΘ r1 = r1(	θ) = 0.2 and ϵ = 0.01, we get a bound R(	θ) ≤0.4211 (for
optimal values of k = 15 and of λ = 1010).
3.3.3. Equal shadow and training sample sizes.
In the case when k =
1, we can use Theorem 3.2.5 (page 118) and replace Φ−1
λ
N (q) with

1 −2N
λ ×
log

cosh( λ
2N )
−1q, resulting in
Theorem 3.3.5. For any ϵ ∈)0, 1), any N ≤109, any one-partially exchangeable
posterior distribution π1 : Ω →M1
+(Θ), with P probability at least 1 −ϵ, for any
θ ∈Θ,
R(θ) ≤inf
λ∈R+

1 + 2N
λ log

cosh( λ
2N )

r1(θ) + 1
5N + 2d′
1(θ) + 4.7
λ
1 −2N
λ log

cosh( λ
2N )

.
3.3.4. Improvement on the equal sample size bound in the i.i.d. case.
Finally, in the case when P is i.i.d., meaning that all the Pi are equal, we can improve
the previous bound. For any partially exchangeable function λ : Ω × Θ →R+, we
saw in the discussion preceding Theorem 3.2.6 (page 120) that
T

exp

λ(rk −r1) −A(λ)v

≤1,

126
Chapter 3.
Transductive PAC-Bayesian learning
with the notation introduced therein. Thus for any partially exchangeable positive
real measurable function λ : Ω × Θ →R+ satisfying equation (3.1, page 116), any
one-partially exchangeable posterior distribution π1 : Ω →M1
+(Θ),
P

exp

sup
θ∈Θ
λ

rk(θ) −r1(θ) −A(λ)v(θ)

+ log

ϵπ1

Δ(θ)

≤1.
Therefore with P probability at least 1 −ϵ, with P′ probability 1 −η,
rk(θ) ≤r1(θ) + A(λ)v(θ) + 1
λ
 ¯d1(θ) −log(η)

.
We can then choose λ(ω, θ) ∈arg min
λ′∈R+ A(λ′)v(θ)+
¯d1(θ) −log(η)

λ′
, which satis-
ﬁes the required conditions, to show that with P probability at least 1 −ϵ, for any
θ ∈Θ, with P′ probability at least 1 −η, for any λ ∈R+,
rk(θ) ≤r1(θ) + A(λ)v(θ) +
¯d1(θ) −log(η)
λ
.
We can then take a union bound on a decreasing sequence of J values η1 ≥· · · ≥
ηJ of η. Weakening the order of quantiﬁers a little, we then obtain the following
statement: with P probability at least 1 −ϵ, for any θ ∈Θ, for any λ ∈R+, for any
j = 1, . . . , J
P′

rk(θ) −r1(θ) −A(λ)v(θ) −
¯d1(θ) + log(J)
λ
≥−log(ηj)
λ

≤ηj.
Consequently for any λ ∈R+,
P′

rk(θ) −r1(θ) −A(λ)v(θ) −
¯d1(θ) + log(J)
λ

≤−log(η1)
λ
+ ηJ

1 −r1(θ) −log(J) −log(ϵ) −log(ηJ)
λ

+
J−1

j=1
ηj
λ log
 ηj
ηj+1
!
.
Moreover P′
v(θ)

=
r1+R
2
−r1R, (this is where we need equidistribution) thus
proving that
R −r1
2
≤A(λ)
2

R + r1 −2r1R

+ d′′
1

θ, (ηj)J
j=1

λ
+ ηJ

1 −r1(θ)

.
Keeping track of quantiﬁers, we obtain
Theorem 3.3.6. For any decreasing sequence (ηj)J
j=1, any ϵ ∈)0, 1), any one-
partially exchangeable posterior distribution π : Ω →M1
+(Θ), with P probability
at least 1 −ϵ, for any θ ∈Θ,
R(θ) ≤inf
λ∈R+

1 + 2N
λ log

cosh( λ
2N )

r1(θ) + 2d′′
1

θ, (ηj)J
j=1

λ
+ 2ηJ

1 −r1(θ)

1 −2N
λ log

cosh( λ
2N )

1 −2r1(θ)

.

3.4.
Gaussian approximation in Vapnik bounds
127
3.4. Gaussian approximation in Vapnik bounds
3.4.1. Gaussian upper bounds of variance terms.
To obtain formulas which
could be easily compared with original Vapnik bounds, we may replace p −Φa(p)
with a Gaussian upper bound:
Lemma 3.4.1. For any p ∈(0, 1
2), any a ∈R+,
p −Φa(p) ≤a
2p(1 −p).
For any p ∈( 1
2, 1),
p −Φa(p) ≤a
8.
Proof. Let us notice that for any p ∈(0, 1),
∂
∂a

−aΦa(p)

= −
p exp(−a)
1 −p + p exp(−a),
∂2
∂2a

−aΦa(p)

=
p exp(−a)
1 −p + p exp(−a)
 
1 −
p exp(−a)
1 −p + p exp(−a)
!
≤

p(1 −p)
p ∈(0, 1
2),
1
4
p ∈( 1
2, 1).
Thus taking a Taylor expansion of order one with integral remainder:
−aΦ(a) ≤
⎧
⎪
⎪
⎪
⎪
⎪
⎪
⎨
⎪
⎪
⎪
⎪
⎪
⎪
⎩
−ap +
 a
0
p(1 −p)(a −b)db
= −ap + a2
2 p(1 −p),
p ∈(0, 1
2),
−ap +
 a
0
1
4(a −b)db = −ap + a2
8 ,
p ∈( 1
2, 1).
This ends the proof of our lemma. □
Lemma 3.4.2.
Let us consider the bound
B(q, d) =
 
1 + 2d
N
!−1 
q + d
N +
A
2dq(1 −q)
N
+ d2
N 2

,
q ∈R+, d ∈R+.
Let us also put
¯B(q, d) =

B(q, d)
B(q, d) ≤1
2,
q +
%
d
2N
otherwise.
For any positive real parameters q and d
inf
λ∈R+ Φ−1
λ
N
 
q + d
λ
!
≤¯B(q, d).
Proof. Let p = inf
λ Φ−1
λ
N
 
q + d
λ
!
. For any λ ∈R+,
p −λ
2N (p ∧1
2)

1 −(p ∧1
2)

≤Φ λ
N (p) ≤q + d
λ.

128
Chapter 3.
Transductive PAC-Bayesian learning
Thus
p ≤q + inf
λ∈R+
λ
2N (p ∧1
2)

1 −(p ∧1
2)

+ d
λ
= q +
$
2d(p ∧1
2)

1 −(p ∧1
2)

N
≤q +
A
d
2N .
Then let us remark that B(q, d) = sup

p′ ∈R+ ; p′ ≤q +
A
2dp′(1 −p′)
N

. If
moreover 1
2 ≥B(q, d), then according to this remark 1
2 ≥q +
%
d
2N ≥p. Therefore
p ≤1
2, and consequently p ≤q +
%
2dp(1−p)
N
, implying that p ≤B(q, d). □
3.4.2. Arbitrary shadow sample size.
The previous lemma combined with
Corollary 3.3.4 (page 125) implies
Corollary 3.4.3. Let us use the notation introduced in Lemma 3.4.2 (page 127).
For any ϵ ∈)0, 1), any integer N ≤109, with P probability at least 1 −ϵ, for any
θ ∈Θ,
R(θ) ≤inf
k∈N∗
k + 1
k

¯B

r1(θ) +
1
10N , d′
k(θ) + log

k(k + 1)

+ 4.7

−r1(θ)
k
.
3.4.3. Equal sample sizes in the i.i.d. case.
To make a link with Vapnik’s
result, it is useful to state the Gaussian approximation to Theorem 3.3.6 (page 126).
Indeed, using the upper bound A(λ) ≤
λ
4N , where A(λ) is deﬁned by equation (3.2)
on page 119, we get with P probability at least 1 −ϵ
R −r1 −2ηJ ≤inf
λ∈R+
λ
4N

R + r1 −2r1R

+ 2d′′
1
λ
=
A
2d′′
1(R + r1 −2r1R)
N
,
which can be solved in R to obtain
Corollary 3.4.4. With P probability at least 1 −ϵ, for any θ ∈Θ,
R(θ) ≤r1(θ) + d′′
1(θ)
N

1 −2r1(θ)

+ 2ηJ
+
$
4d′′
1(θ)

1 −r1(θ)

r1(θ)
N
+ d′′
1(θ)2
N 2

1 −2r1(θ)
2 + 4d′′
1(θ)
N

1 −2r1(θ)

ηJ.
This is to be compared with Vapnik’s result, as proved in Vapnik (1998, page
138):
Theorem 3.4.5 (Vapnik). For any i.i.d. probability distribution P, with P prob-
ability at least 1 −ϵ, for any θ ∈Θ, putting
dV = log

P(N1)

+ log(4/ϵ),
R(θ) ≤r1(θ) + 2dV
N
+
A
4dV r1(θ)
N
+ 4d2
V
N 2 .

3.4.
Gaussian approximation in Vapnik bounds
129
Recalling that we can choose (ηj)2
j=1 such that ηJ = η2 =
1
10N (which brings a
negligible contribution to the bound) and such that for any N ≤109,
d′′
1(θ) ≤P

log(N1) | (Zi)N
i=1

−log(ϵ) + 4.7,
we see that our complexity term is somehow more satisfactory than Vapnik’s, since
it is integrated outside the logarithm, with a slightly larger additional constant
(remember that log 4 ≃1.4, which is better than our 4.7, which could presumably
be improved by working out a better sequence ηj, but not down to log(4)). Our
variance term is better, since we get r1(1 −r1), instead of r1. We also have d′′
1
N
instead of 2dV
N , because we use no symmetrization trick.
Let us illustrate these bounds on a numerical example, corresponding to a situ-
ation where the sample is noisy or the classiﬁcation model is weak. Let us assume
that N = 1000, infΘ r1 = r1(	θ) = 0.2, that we are performing binary classiﬁcation
with a model with Vapnik–Cervonenkis dimension not greater than h = 10, and
that we work at conﬁdence level ϵ = 0.01. Vapnik’s theorem provides an upper
bound for R(	θ) not smaller than 0.610, whereas Corollary 3.4.4 gives R(	θ) ≤0.461
(using the bound d′′
1 ≤d′
1 + 3.7 when N = 1000). Now if we go for Theorem 3.3.6
and do not make a Gaussian approximation, we get R(	θ) ≤0.453. It is interesting
to remark that this bound is achieved for λ = 1195 > N = 1000. This explains why
the Gaussian approximation in Vapnik’s bound can be improved: for such a large
value of λ, λr1(θ) does not behave like a Gaussian random variable.
Let us recall in conclusion that the best bound is provided by Theorem 3.3.3
(page 125), giving R(	θ) ≤0.4211, (that is approximately 2/3 of Vapnik’s bound),
for optimal values of k = 15, and of λ = 1010. This bound can be seen to take ad-
vantage of the fact that Bernoulli random variables are not Gaussian (its Gaussian
approximation, Corollary 3.4.3, gives a bound R(θ) ≃0.4325, still with an optimal
k = 15), and of the fact that the optimal size of the shadow sample is signiﬁcantly
larger than the size of the observed sample. Moreover, Theorem 3.3.3 does not as-
sume that the sample is i.i.d., but only that it is independent, thus generalizing
Vapnik’s bounds to inhomogeneous data (this will presumably be the case when
data are collected from diﬀerent places where the experimental conditions may not
be the same, although they may reasonably be assumed to be independent).
Our little numerical example was chosen to illustrate the case when it is non-
trivial to decide whether the chosen classiﬁer does better than the 0.5 error rate
of blind random classiﬁcation. This case is of interest to choose “weak learners”
to be aggregated or combined in some appropriate way in a second stage to reach
a better classiﬁcation rate. This stage of feature selection is unavoidable in many
real world classiﬁcation tasks. Our little computations are meant to exemplify the
fact that Vapnik’s bounds, although asymptotically suboptimal, as is obvious by
comparison with the ﬁrst two chapters, can do the job when dealing with moderate
sample sizes.

130
Chapter 3.
Transductive PAC-Bayesian learning

Chapter 4
Support Vector Machines
4.1. How to build them
4.1.1. The canonical hyperplane.
Support Vector Machines, of wide use and
renown, were conceived by V. Vapkik (Vapnik, 1998). Before introducing them,
we will study as a prerequisite the separation of points by hyperplanes in a ﬁnite
dimensional Euclidean space. Support Vector Machines perform the same kind of
linear separation after an implicit change of pattern space. The preceding PAC-
Bayesian results provide a ﬁt framework to analyse their generalization properties.
In this section we deal with the classiﬁcation of points in Rd in two classes. Let
Z = (xi, yi)N
i=1 ∈

Rd × {−1, +1}
N be some set of labelled examples (called the
training set hereafter). Let us split the set of indices I = {1, . . . , N} according to
the labels into two subsets
I+ = {i ∈I : yi = +1},
I−= {i ∈I : yi = −1}.
Let us then consider the set of admissible separating directions
AZ =

w ∈Rd : sup
b∈R
inf
i∈I(⟨w, xi⟩−b)yi ≥1

,
which can also be written as
AZ =

w ∈Rd : max
i∈I−⟨w, xi⟩+ 2 ≤min
i∈I+⟨w, xi⟩

.
As it is easily seen, the optimal value of b for a ﬁxed value of w, in other words the
value of b which maximizes infi∈I(⟨w, xi⟩−b)yi, is equal to
bw = 1
2

max
i∈I−⟨w, xi⟩+ min
i∈I+⟨w, xi⟩

.
Lemma 4.1.1. When AZ ̸= ∅, inf{∥w∥2 : w ∈AZ} is reached for only one value
wZ of w.
Proof. Let w0 ∈AZ. The set AZ ∩{w ∈Rd : ∥w∥≤∥w0∥} is a compact convex
set and w →∥w∥2 is strictly convex and therefore has a unique minimum on this
set, which is also obviously its minimum on AZ. □
131

132
Chapter 4.
Support Vector Machines
Definition 4.1.1. When AZ ̸= ∅, the training set Z is said to be linearly sepa-
rable. The hyperplane
H = {x ∈Rd : ⟨wZ, x⟩−bZ = 0},
where
wZ = arg min{∥w∥: w ∈AZ},
bZ = bwZ,
is called the canonical separating hyperplane of the training set Z. The quantity
∥wZ∥−1 is called the margin of the canonical hyperplane.
As mini∈I+⟨wZ, xi⟩−maxi∈I−⟨wZ, xi⟩= 2, the margin is also equal to half the
distance between the projections on the direction wZ of the positive and negative
patterns.
4.1.2. Computation of the canonical hyperplane.
Let us consider the con-
vex hulls X+ and X−of the positive and negative patterns:
X+ =

i∈I+
λixi :

λi

i∈I+ ∈RI+
+ ,

i∈I+
λi = 1

,
X−=
 
i∈I−
λixi :

λi

i∈I−∈RI−
+ ,

i∈I−
λi = 1

.
Let us introduce the closed convex set
V = X+ −X−=

x+ −x−: x+ ∈X+, x−∈X−

.
As v →∥v∥2 is strictly convex, with compact lower level sets, there is a unique
vector v∗such that
∥v∗∥2 = inf
v∈V

∥v∥2 : v ∈V

.
Lemma 4.1.2. The set AZ is non-empty (i.e. the training set Z is linearly separa-
ble) if and only if v∗̸= 0. In this case
wZ =
2
∥v∗∥2 v∗,
and the margin of the canonical hyperplane is equal to 1
2∥v∗∥.
This lemma proves that the distance between the convex hulls of the positive
and negative patterns is equal to twice the margin of the canonical hyperplane.
Proof. Let us assume ﬁrst that v∗= 0, or equivalently that X+ ∩X−̸= ∅. For
any vector w ∈Rd,
min
i∈I+⟨w, xi⟩= min
x∈X+⟨w, x⟩,
max
i∈I−⟨w, xi⟩= max
x∈X−⟨w, x⟩,
so mini∈I+⟨w, xi⟩−maxi∈I−⟨w, xi⟩≤0, which shows that w cannot be in AZ and
therefore that AZ is empty.

4.1.
How to build them
133
Let us assume now that v∗̸= 0, or equivalently that X+ ∩X−= ∅. Let us put
w∗= 2v∗/∥v∗∥2. Let us remark ﬁrst that
min
i∈I+⟨w∗, xi⟩−max
i∈I−⟨w∗, xi⟩= inf
x∈X+⟨w∗, x⟩−sup
x∈X−
⟨w∗, x⟩
=
inf
x+∈X+,x−∈X−⟨w∗, x+ −x−⟩
=
2
∥v∗∥2 inf
v∈V⟨v∗, v⟩.
Let us now prove that infv∈V⟨v∗, v⟩= ∥v∗∥2. Some arbitrary v ∈V being ﬁxed,
consider the function
β →∥βv + (1 −β)v∗∥2 : [0, 1] →R.
By deﬁnition of v∗, it reaches its minimum value for β = 0, and therefore has
a non-negative derivative at this point. Computing this derivative, we ﬁnd that
⟨v −v∗, v∗⟩≥0, as claimed. We have proved that
min
i∈I+⟨w∗, xi⟩−max
i∈I−⟨w∗, xi⟩= 2,
and therefore that w∗∈AZ. On the other hand, any w ∈AZ is such that
2 ≤min
i∈I+⟨w, xi⟩−max
i∈I−⟨w, xi⟩= inf
v∈V⟨w, v⟩≤∥w∥inf
v∈V∥v∥= ∥w∥∥v∗∥.
This proves that ∥w∗∥= inf

∥w∥: w ∈AZ

, and therefore that w∗= wZ as
claimed. □
One way to compute wZ would therefore be to compute v∗by minimizing
CCCCC

i∈I
λiyixi
CCCCC
2
: (λi)i∈I ∈RI
+,

i∈I
λi = 2,

i∈I
yiλi = 0

.
Although this is a tractable quadratic programming problem, a direct computation
of wZ through the following proposition is usually preferred.
Proposition 4.1.3.
The canonical direction wZ can be expressed as
wZ =
N

i=1
α∗
i yixi,
where (α∗
i )N
i=1 is obtained by minimizing
inf

F(α) : α ∈A

where
A =

(αi)i∈I ∈RI
+,

i∈I
αiyi = 0

,
and
F(α) =
CCC

i∈I
αiyixi
CCC
2
−2

i∈I
αi.

134
Chapter 4.
Support Vector Machines
Proof. Let w(α) = 
i∈I αiyixi and let S(α) =
1
2

i∈I αi. We can express
the function F(α) as F(α) = ∥w(α)∥2 −4S(α). Moreover it is important to no-
tice that for any s ∈R+, {w(α) : α ∈A, S(α) = s} = sV. This shows that
for any s ∈R+, inf{F(α) : α ∈A, S(α) = s} is reached and that for any
αs
∈
{α
∈
A
:
S(α)
=
s} reaching this inﬁmum, w(αs)
=
sv∗. As
s →s2∥v∗∥2 −4s : R+ →R reaches its inﬁmum for only one value s∗of s, namely
at s∗=
2
∥v∗∥2 , this shows that F(α) reaches its inﬁmum on A, and that for any
α∗∈A such that F(α∗) = inf{F(α) : α ∈A}, w(α∗) =
2
∥v∗∥2 v∗= wZ. □
4.1.3. Support vectors.
Definition 4.1.2. The set of support vectors S is deﬁned by
S = {xi : ⟨wZ, xi⟩−bZ = yi}.
Proposition 4.1.4.
Any α∗minimizing F(α) on A is such that
{xi : α∗
i > 0} ⊂S.
This implies that the representation wZ = w(α∗) involves in general only a limited
number of non-zero coeﬃcients and that wZ = wZ′, where Z′ = {(xi, yi) : xi ∈S}.
Proof. Let us consider any given i ∈I+ and j ∈I−, such that α∗
i > 0 and α∗
j > 0.
There exists at least one such index in each set I−and I+, since the sum of the
components of α∗on each of these sets are equal and since 
k∈I α∗
k > 0. For any
t ∈R, consider
αk(t) = α∗
k + t1(k ∈{i, j}),
k ∈I.
The vector α(t) is in A for any value of t in some neighbourhood of 0, therefore
∂
∂t |t=0F

α(t)

= 0. Computing this derivative, we ﬁnd that
yi⟨w(α∗), xi⟩+ yj⟨w(α∗), xj⟩= 2.
As yi = −yj, this can also be written as
yi

⟨w(α∗), xi⟩−bZ

+ yj

⟨w(α∗), xj⟩−bZ

= 2.
As w(α∗) ∈AZ,
yk

⟨w(α∗), xk⟩−bZ

≥1,
k ∈I,
which implies necessarily as claimed that
yi

⟨w(α∗), xi⟩−bZ

= yj

⟨w(α∗), xj⟩−bZ

= 1.
□
4.1.4. The non-separable case.
In the case when the training set Z = (xi,
yi)N
i=1 is not linearly separable, we can deﬁne a noisy canonical hyperplane as fol-
lows: we can choose w ∈Rd and b ∈R to minimize
(4.1)
C(w, b) =
N

i=1

1 −

⟨w, xi⟩−b

yi

+ + 1
2∥w∥2,
where for any real number r, r+ = max{r, 0} is the positive part of r.

4.1.
How to build them
135
Theorem 4.1.5. Let us introduce the dual criterion
F(α) =
N

i=1
αi −1
2
CCCC
N

i=1
yiαixi
CCCC
2
and the domain A′ =

α ∈RN
+ : αi ≤1, i = 1, . . . , N,
N

i=1
yiαi = 0

. Let α∗∈A′
be such that F(α∗) = supα∈A′ F(α). Let w∗= N
i=1 yiα∗
i xi. There is a threshold
b∗(whose construction will be detailed in the proof), such that
C(w∗, b∗) =
inf
w∈Rd,b∈R C(w, b).
Corollary 4.1.6. (scaled criterion) For any positive real parameter λ let us
consider the criterion
Cλ(w, b) = λ2
N

i=1

1 −(⟨w, xi⟩−b)yi

+ + 1
2∥w∥2
and the domain
A′
λ =

α ∈RN
+ : αi ≤λ2, i = 1, . . . , N,
N

i=1
yiαi = 0

.
For any solution α∗of the minimization problem F(α∗) = supα∈A′
λ F(α), the vector
w∗= N
i=1 yiα∗
i xi is such that
inf
b∈R Cλ(w∗, b) =
inf
w∈Rd,b∈R Cλ(w, b).
In the separable case, the scaled criterion is minimized by the canonical hyper-
plane for λ large enough. This extension of the canonical hyperplane computation
in dual space is often called the box constraint, for obvious reasons.
Proof. The corollary is a straightforward consequence of the scale property
Cλ(w, b, x) = λ2C(λ−1w, b, λx), where we have made the dependence of the crite-
rion in x ∈RdN explicit. Let us come now to the proof of the theorem.
The minimization of C(w, b) can be performed in dual space extending the couple
of parameters (w, b) to w = (w, b, γ) ∈Rd × R × RN
+ and introducing the dual
multipliers α ∈RN
+ and the criterion
G(α, w) =
N

i=1
γi +
N

i=1
αi

1 −(⟨w, xi⟩−b)yi

−γi

+ 1
2∥w∥2.
We see that
C(w, b) = inf
γ∈RN
+
sup
α∈RN
+
G

α, (w, b, γ)

,
and therefore, putting W = {(w, b, γ) : w ∈Rd, b ∈R, γ ∈RN
+

, we are led to solve
the minimization problem
G(α∗, w∗) = inf
w∈W
sup
α∈RN
+
G(α, w),

136
Chapter 4.
Support Vector Machines
whose solution w∗= (w∗, b∗, γ∗) is such that C(w∗, b∗) = inf(w,b)∈Rd+1 C(w, b),
according to the preceding identity. As for any value of α′ ∈RN
+,
inf
w∈W
sup
α∈RN
+
G(α, w) ≥inf
w∈W
G(α′, w),
it is immediately seen that
inf
w∈W
sup
α∈RN
+
G(α, w) ≥sup
α∈RN
+
inf
w∈W
G(α, w).
We are going to show that there is no duality gap, meaning that this inequality is
indeed an equality. More importantly, we will do so by exhibiting a saddle point,
which, solving the dual minimization problem will also solve the original one.
Let us ﬁrst make explicit the solution of the dual problem (the interest of this
dual problem precisely lies in the fact that it can more easily be solved explicitly).
Introducing the admissible set of values of α,
A′ =

α ∈RN : 0 ≤αi ≤1, i = 1, . . . , N,
N

i=1
yiαi = 0

,
it is elementary to check that
inf
w∈W
G(α, w) =

inf
w∈Rd G

α, (w, 0, 0)

,
α ∈A′,
−∞,
otherwise.
As
G

α, (w, 0, 0)

= 1
2∥w∥2 +
N

i=1
αi

1 −⟨w, xi⟩yi

,
we see that infw∈Rd G

α, (w, 0, 0)

is reached at
wα =
N

i=1
yiαixi.
This proves that
inf
w∈W
G(α, w) = F(α).
The continuous map α →infw∈W G(α, w) reaches a maximum α∗, not necessarily
unique, on the compact convex set A′. We are now going to exhibit a choice of
w∗∈W such that (α∗, w∗) is a saddle point. This means that we are going to show
that
G(α∗, w∗) = inf
w∈W
G(α∗, w) = sup
α∈RN
+
G(α, w∗).
It will imply that
inf
w∈W
sup
α∈Rd
+
G(α, w) ≤sup
α∈RN
+
G(α, w∗) = G(α∗, w∗)
on the one hand and that
inf
w∈W
sup
α∈Rd
+
G(α, w) ≥inf
w∈W
G(α∗, w) = G(α∗, w∗)

4.1.
How to build them
137
on the other hand, proving that
G(α∗, w∗) = inf
w∈W
sup
α∈RN
+
G(α, w)
as required.
Construction of w∗.
• Let us put w∗= wα∗.
• If there is j ∈{1, . . . , N} such that 0 < α∗
j < 1, let us put
b∗= ⟨xj, w∗⟩−yj.
Otherwise, let us put
b∗= sup{⟨xi, w∗⟩−1 : α∗
i > 0, yi = +1, i = 1, . . . , N}.
• Let us then put
γ∗
i =

0,
α∗
i < 1,
1 −(⟨w∗, xi⟩−b∗)yi,
α∗
i = 1.
If we can prove that
(4.2)
1 −(⟨w∗, xi⟩−b∗)yi
⎧
⎪
⎨
⎪
⎩
≤0,
α∗
i = 0,
= 0,
0 < α∗
i < 1,
≥0,
α∗
i = 1,
it will show that γ∗∈RN
+ and therefore that w∗= (w∗, b∗, γ∗) ∈W. It will also
show that
G(α, w∗) =
N

i=1
γ∗
i +

i,α∗
i =0
αi

1 −(⟨w∗, xi⟩−b∗)yi

+ 1
2∥w∗∥2,
proving that G(α∗, w∗) = supα∈RN
+ G(α, w∗). As obviously G(α∗, w∗) = G

α∗, (w∗,
0, 0)

, we already know that G(α∗, w∗) = infw∈W G(α∗, w). This will show that
(α∗, w∗) is the saddle point we were looking for, thus ending the proof of the theo-
rem. □
Proof of equation (4.2). Let us deal ﬁrst with the case when there is j ∈
{1, . . . , N} such that 0 < α∗
j < 1.
For any i ∈{1, . . . , N} such that 0 < α∗
i < 1, there is ϵ > 0 such that for any
t ∈(−ϵ, ϵ), α∗+tyiei −tyjej ∈A′, where (ek)N
k=1 is the canonical base of RN. Thus
∂
∂t |t=0F(α∗+ tyiei −tyjej) = 0. Computing this derivative, we obtain
∂
∂t |t=0F(α∗+ tyiei −tyjej) = yi −⟨w∗, xi⟩+ ⟨w∗, xj⟩−yj
= yi

1 −

⟨w, xi⟩−b∗
yi

.
Thus 1 −

⟨w, xi⟩−b∗
yi = 0, as required. This shows also that the deﬁnition of b∗
does not depend on the choice of j such that 0 < α∗
j < 1.

138
Chapter 4.
Support Vector Machines
For any i ∈{1, . . . , N} such that α∗
i = 0, there is ϵ > 0 such that for any
t ∈(0, ϵ), α∗+ tei −tyiyjej ∈A′. Thus
∂
∂t |t=0F(α∗+ tei −tyiyjej) ≤0, showing
that 1 −

⟨w∗, xi⟩−b∗
yi ≤0 as required.
For any i ∈{1, . . . , N} such that α∗
i = 1, there is ϵ > 0 such that α∗−tei +
tyiyjej ∈A′. Thus
∂
∂t |t=0F(α∗−tei + tyiyjej) ≤0, showing that 1 −

⟨w∗, xi⟩−
b∗
yi ≥0 as required. This shows that (α∗, w∗) is a saddle point in this case.
Let us deal now with the case where α∗∈{0, 1}N. If we are not in the trivial case
where the vector (yi)N
i=1 is constant, the case α∗= 0 is ruled out. Indeed, in this
case, considering α∗+ tei + tej, where yiyj = −1, we would get the contradiction
2 = ∂
∂t |t=0F(α∗+ tei + tej) ≤0.
Thus there are values of j such that α∗
j = 1, and since N
i=1 αiyi = 0, both
classes are present in the set {j : α∗
j = 1}.
Now for any i, j ∈{1, . . . , N} such that α∗
i = α∗
j = 1 and such that yi = +1 and
yj = −1,
∂
∂t |t=0F(α∗−tei −tej) = −2 + ⟨w∗, xi⟩−⟨w∗, xj⟩≤0. Thus
sup{⟨w∗, xi⟩−1 : α∗
i = 1, yi = +1} ≤inf{⟨w∗, xj⟩+ 1 : α∗
j = 1, yj = −1},
showing that
1 −

⟨w∗, xk⟩−b∗
yk ≥0, α∗
k = 1.
Finally, for any i such that α∗
i = 0, for any j such that α∗
j = 1 and yj = yi, we have
∂
∂t |t=0F(α∗+ tei −tej) = yi⟨w∗, xi −xj⟩≤0,
showing that 1 −

⟨w∗, xi⟩−b∗
yi ≤0. This shows that (α∗, w∗) is always a saddle
point.
4.1.5. Support Vector Machines.
Definition 4.1.3. The symmetric measurable kernel K : X × X →R is said to be
positive (or more precisely positive semi-deﬁnite) if for any n ∈N, any (xi)n
i=1 ∈Xn,
inf
α∈Rn
n

i=1
n

j=1
αiK(xi, xj)αj ≥0.
Let Z = (xi, yi)N
i=1 be some training set. Let us consider as previously
A =

α ∈RN
+ :
N

i=1
αiyi = 0

.
Let
F(α) =
N

i=1
N

j=1
αiyiK(xi, xj)yjαj −2
N

i=1
αi.
Definition 4.1.4. Let K be a positive symmetric kernel. The training set Z is
said to be K-separable if
inf

F(α) : α ∈A

> −∞.

4.1.
How to build them
139
Lemma 4.1.7. When Z is K-separable, inf{F(α) : α ∈A} is reached.
Proof. Consider the training set Z′ = (x′
i, yi)N
i=1, where
x′
i =

K(xk, xℓ)
N
N
k=1,ℓ=1
1/2
(i, j)
N
j=1
∈RN.
We see that F(α) = ∥N
i=1 αiyix′
i∥2 −2 N
i=1 αi. We proved in the previous section
that Z′ is linearly separable if and only if inf{F(α) : α ∈A} > −∞, and that the
inﬁmum is reached in this case. □
Proposition 4.1.8.
Let K be a symmetric positive kernel and let Z = (xi, yi)N
i=1
be some K-separable training set. Let α∗∈A be such that F(α∗) = inf{F(α) : α ∈
A}. Let
I∗
−= {i ∈N : 1 ≤i ≤N, yi = −1, α∗
i > 0}
I∗
+ = {i ∈N : 1 ≤i ≤N, yi = +1, α∗
i > 0}
b∗= 1
2
 N

j=1
α∗
jyjK(xj, xi−) +
N

j=1
α∗
jyjK(xj, xi+)

,
i−∈I∗
−, i+ ∈I∗
+,
where the value of b∗does not depend on the choice of i−and i+. The classiﬁcation
rule f : X →Y deﬁned by the formula
f(x) = sign
" N

i=1
α∗
i yiK(xi, x) −b∗
#
is independent of the choice of α∗and is called the support vector machine deﬁned
by K and Z. The set S = {xj : N
i=1 α∗
i yiK(xi, xj) −b∗= yj} is called the set of
support vectors. For any choice of α∗, {xi : α∗
i > 0} ⊂S.
An important consequence of this proposition is that the support vector machine
deﬁned by K and Z is also the support vector machine deﬁned by K and Z′ =
{(xi, yi) : α∗
i > 0, 1 ≤i ≤N}, since this restriction of the index set contains the
value α∗where the minimum of F is reached.
Proof. The independence of the choice of α∗, which is not necessarily unique,
is seen as follows. Let (xi)N
i=1 and x ∈X be ﬁxed. Let us put for ease of notation
xN+1 = x. Let M be the (N + 1) × (N + 1) symmetric semi-deﬁnite matrix deﬁned
by M(i, j) = K(xi, xj), i = 1, . . . , N + 1, j = 1, . . . , N + 1. Let us consider the
mapping Ψ : {xi : i = 1, . . . , N + 1} →RN+1 deﬁned by
(4.3)
Ψ(xi) =

M 1/2(i, j)
N+1
j=1 ∈RN+1.
Let us consider the training set Z′ =

Ψ(xi), yi
N
i=1. Then Z′ is linearly separable,
F(α) =
CCC
N

i=1
αiyiΨ(xi)
CCC
2
−2
N

i=1
αi,
and we have proved that for any choice of α∗
∈
A minimizing F(α),
wZ′ = N
i=1 α∗
i yiΨ(xi). Thus the support vector machine deﬁned by K and Z
can also be expressed by the formula
f(x) = sign

⟨wZ′, Ψ(x)⟩−bZ′

140
Chapter 4.
Support Vector Machines
which does not depend on α∗. The deﬁnition of S is such that Ψ(S) is the set of
support vectors deﬁned in the linear case, where its stated property has already
been proved. □
We can in the same way use the box constraint and show that any solution
α∗∈arg min{F(α) : α ∈A, αi ≤λ2, i = 1, . . . , N} minimizes
(4.4)
inf
b∈R λ2
N

i=1

1 −
 N

j=1
yjαjK(xj, xi) −b
!
yi

+
+ 1
2
N

i=1
N

j=1
αiαjyiyjK(xi, xj).
4.1.6. Building kernels.
Except the last, the results of this section are drawn
from Cristianini et al. (2000). We have no reference for the last proposition of this
section, although we believe it is well known. We include them for the convenience
of the reader.
Proposition 4.1.9. Let K1 and K2 be positive symmetric kernels on X. Then for
any a ∈R+
(aK1 + K2)(x, x′)
def
= aK1(x, x′) + K2(x, x′)
and (K1 · K2)(x, x′)
def
= K1(x, x′)K2(x, x′)
are also positive symmetric kernels. Moreover, for any measurable function
g : X →R, Kg(x, x′)
def
= g(x)g(x′) is also a positive symmetric kernel.
Proof. It is enough to prove the proposition in the case when X is ﬁnite and
kernels are just ordinary symmetric matrices. Thus we can assume without loss of
generality that X = {1, . . . , n}. Then for any α ∈RN, using usual matrix notation,
⟨α, (aK1 + K2)α⟩= a⟨α, K1α⟩+ ⟨α, K2α⟩≥0,
⟨α, (K1 · K2)α⟩=

i,j
αiK1(i, j)K2(i, j)αj
=

i,j,k
αiK1/2
1
(i, k)K1/2
1
(k, j)K2(i, j)αj
=

k

i,j

K1/2
1
(k, i)αi

K2(i, j)

K1/2
1
(k, j)αj

5
67
8
≥0
≥0,
⟨α, Kgα⟩=

i,j
αig(i)g(j)αj =
"
i
αig(i)
#2
≥0.
□
Proposition 4.1.10. Let K be some positive symmetric kernel on X. Let p : R →
R be a polynomial with positive coeﬃcients. Let g : X →Rd be a measurable func-
tion. Then
p(K)(x, x′)
def
= p

K(x, x′)

,

4.1.
How to build them
141
exp(K)(x, x′)
def
= exp

K(x, x′)

and Gg(x, x′)
def
= exp

−∥g(x) −g(x′)∥2
are all positive symmetric kernels.
Proof. The ﬁrst assertion is a direct consequence of the previous proposition. The
second comes from the fact that the exponential function is the pointwise limit of a
sequence of polynomial functions with positive coeﬃcients. The third is seen from
the second and the decomposition
Gg(x, x′) =

exp

−∥g(x)∥2
exp

−∥g(x′)∥2
exp

2⟨g(x), g(x′)⟩

□
Proposition 4.1.11. With the notation of the previous proposition, any training
set Z = (xi, yi)N
i=1 ∈

X×{−1, +1}
N is Gg-separable as soon as g(xi), i = 1, . . . , N
are distinct points of Rd.
Proof. It is clearly enough to prove the case when X = Rd and g is the identity.
Let us consider some other generic point xN+1 ∈Rd and deﬁne Ψ as in (4.3). It is
enough to prove that Ψ(x1), . . . , Ψ(xN) are aﬃne independent, since the simplex,
and therefore any aﬃne independent set of points, can be split in any arbitrary way
by aﬃne half-spaces. Let us assume that (x1, . . . , xN) are aﬃne dependent; then
for some (λ1, . . . , λN) ̸= 0 such that N
i=1 λi = 0,
N

i=1
N

j=1
λiG(xi, xj)λj = 0.
Thus, (λi)N+1
i=1 , where we have put λN+1 = 0 is in the kernel of the symmetric
positive semi-deﬁnite matrix G(xi, xj)i,j∈{1,...,N+1}. Therefore
N

i=1
λiG(xi, xN+1) = 0,
for any xN+1 ∈Rd. This would mean that the functions x →exp(−∥x −xi∥2)
are linearly dependent, which can be easily proved to be false. Indeed, let n ∈Rd
be such that ∥n∥= 1 and ⟨n, xi⟩, i = 1, . . . , N are distinct (such a vector exists,
because it has to be outside the union of a ﬁnite number of hyperplanes, which is
of zero Lebesgue measure on the sphere). Let us assume for a while that for some
(λi)N
i=1 ∈RN, for any x ∈Rd,
N

i=1
λi exp(−∥x −xi∥2) = 0.
Considering x = tn, for t ∈R, we would get
N

i=1
λi exp(2t⟨n, xi⟩−∥xi∥2) = 0,
t ∈R.
Letting t go to inﬁnity, we see that this is only possible if λi = 0 for all values of i.
□

142
Chapter 4.
Support Vector Machines
4.2. Bounds for Support Vector Machines
4.2.1. Compression scheme bounds.
We can use Support Vector Machines
in the framework of compression schemes and apply Theorem 3.3.3 (page 125).
More precisely, given some positive symmetric kernel K on X, we may consider
for any training set Z′ = (x′
i, y′
i)h
i=1 the classiﬁer ˆfZ′ : X →Y which is equal to
the Support Vector Machine deﬁned by K and Z′ whenever Z′ is K-separable,
and which is equal to some constant classiﬁcation rule otherwise; we take this
convention to stick to the framework described on page 117, we will only use ˆfZ′
in the K-separable case, so this extension of the deﬁnition is just a matter of
presentation. In the application of Theorem 3.3.3 in the case when the observed
sample (Xi, Yi)N
i=1 is K-separable, a natural if perhaps sub-optimal choice of Z′
is to choose for (x′
i) the set of support vectors deﬁned by Z = (Xi, Yi)N
i=1 and to
choose for (y′
i) the corresponding values of Y . This is justiﬁed by the fact that
ˆfZ = ˆfZ′, as shown in Proposition 4.1.8 (page 139). If Z is not K-separable, we
can train a Support Vector Machine with the box constraint, then remove all the
errors to obtain a K-separable sub-sample Z′ = {(Xi, Yi) : α∗
i < λ2, 1 ≤i ≤N},
using the same notation as in equation (4.4) on page 140, and then consider its
support vectors as the compression set. Still using the notation of page 140, this
means we have to compute successively α∗∈arg min{F(α) : α ∈A, αi ≤λ2}, and
α∗∗∈arg min{F(α) : α ∈A, αi = 0 when α∗
i = λ2}, to keep the compression set
indexed by J = {i : 1 ≤i ≤N, α∗∗
i
> 0}, and the corresponding Support Vector
Machine 	fJ. Diﬀerent values of λ can be used at this stage, producing diﬀerent
candidate compression sets: when λ increases, the number of errors should decrease,
on the other hand when λ decreases, the margin ∥w∥−1 of the separable subset Z′
increases, supporting the hope for a smaller set of support vectors, thus we can use λ
to monitor the number of errors on the training set we accept from the compression
scheme. As we can use whatever heuristic we want while selecting the compression
set, we can also try to threshold in the previous construction α∗∗
i
at diﬀerent levels
η ≥0, to produce candidate compression sets Jη = {i : 1 ≤i ≤N, α∗∗
i
> η} of
various sizes.
As the size |J| of the compression set is random in this construction, we must
use a version of Theorem 3.3.3 (page 125) which handles compression sets of arbi-
trary sizes. This is done by choosing for each k a k-partially exchangeable posterior
distribution πk which weights the compression sets of all dimensions. We immedi-
ately see that we can choose πk such that −log

πk(Δk(J))

≤log

|J|(|J| + 1)

+
|J| log

(k+1)eN
|J|

.
If we observe the shadow sample patterns, and if computer resources permit, we
can of course use more elaborate bounds than Theorem 3.3.3, such as the transduc-
tive equivalent for Theorem 1.3.15 (page 30) (where we may consider the submod-
els made of all the compression sets of the same size). Theorems based on relative
bounds, such as Theorem 2.2.4 (page 72) or Theorem 2.3.9 (page 107) can also be
used. Gibbs distributions can be approximated by Monte Carlo techniques, where
a Markov chain with the proper invariant measure consists in appropriate local
perturbations of the compression set.
Let us mention also that the use of compression schemes based on Support Vector
Machines can be tailored to perform some kind of feature aggregation. Imagine that
the kernel K is deﬁned as the scalar product in L2(π), where π ∈M1
+(Θ). More
precisely let us consider for some set of soft classiﬁcation rules

fθ : X →R ; θ ∈Θ


4.2.
Bounds for Support Vector Machines
143
the kernel
K(x, x′) =

θ∈Θ
fθ(x)fθ(x′)π(dθ).
In this setting, the Support Vector Machine applied to the training set Z = (xi,
yi)N
i=1 has the form
fZ(x) = sign
"
θ∈Θ
fθ(x)
N

i=1
yiαifθ(xi)π(dθ) −b
#
and, if this is too burdensome to compute, we can replace it with some ﬁnite
approximation
fZ(x) = sign
"
1
m
m

k=1
fθk(x)wk −b
#
,
where the set {θk, k = 1, . . . , m} and the weights {wk, k = 1, . . . , m} are computed
in some suitable way from the set Z′ = (xi, yi)i,αi>0 of support vectors of fZ. For
instance, we can draw {θk, k = 1, . . . , m} at random according to the probability
distribution proportional to
22222
N

i=1
yiαifθ(xi)
22222 π(dθ),
deﬁne the weights wk by
wk = sign
" N

i=1
yiαifθk(xi)
# 
θ∈Θ
22222
N

i=1
yiαifθ(xi)
22222 π(dθ),
and choose the smallest value of m for which this approximation still classiﬁes Z′
without errors. Let us remark that we have built fZ in such a way that
lim
m→+∞
fZ(xi) = fZ(xi) = yi,
a.s.
for any support index i such that αi > 0.
Alternatively, given Z′, we can select a ﬁnite set of features Θ′ ⊂Θ such that Z′
is KΘ′ separable, where KΘ′(x, x′) = 
θ∈Θ′ fθ(x)fθ(x′) and consider the Support
Vector Machines fZ′ built with the kernel KΘ′. As soon as Θ′ is chosen as a function
of Z′ only, Theorem 3.3.3 (page 125) applies and provides some level of conﬁdence
for the risk of fZ′.
4.2.2. The Vapnik–Cervonenkis dimension of a family of subsets.
Let
us consider some set X and some set S ⊂{0, 1}X of subsets of X. Let h(S) be the
Vapnik–Cervonenkis dimension of S, deﬁned as
h(S) = max

|A| : A ⊂X, |A| < ∞and A ∩S = {0, 1}A
,
where by deﬁnition A ∩S = {A ∩B : B ∈S} and |A| is the number of points in A.
Let us notice that this deﬁnition does not depend on the choice of the reference set
X. Indeed X can be chosen to be  S, the union of all the sets in S or any bigger
set. Let us notice also that for any set B, h(B ∩S) ≤h(S), the reason being that
A ∩(B ∩S) = B ∩(A ∩S).

144
Chapter 4.
Support Vector Machines
This notion of Vapnik–Cervonenkis dimension is useful because, as we will see
for Support Vector Machines, it can be computed in some important special cases.
Let us prove here as an illustration that h(S) = d + 1 when X = Rd and S is made
of all the half spaces:
S = {Aw,b : w ∈Rd, b ∈R}, where Aw,b = {x ∈X : ⟨w, x⟩≥b}.
Proposition 4.2.1. With the previous notation, h(S) = d + 1.
Proof. Let (ei)d+1
i=1 be the canonical base of Rd+1, and let X be the aﬃne subspace
it generates, which can be identiﬁed with Rd. For any (ϵi)d+1
i=1 ∈{−1, +1}d+1,
let w = d+1
i=1 ϵiei and b = 0. The half space Aw,b ∩X is such that {ei ; i =
1, . . . , d + 1} ∩(Aw,b ∩X) = {ei ; ϵi = +1}. This proves that h(S) ≥d + 1.
To prove that h(S) ≤d + 1, we have to show that for any set A ⊂Rd of size
|A| = d+2, there is B ⊂A such that B ̸∈(A∩S). Obviously this will be the case if
the convex hulls of B and A\B have a non-empty intersection: indeed if a hyperplane
separates two sets of points, it also separates their convex hulls. As |A| > d + 1,
A is aﬃne dependent: there is (λx)x∈A ∈Rd+2 \ {0} such that 
x∈A λxx = 0 and

x∈A λx = 0. The set B = {x ∈A : λx > 0} and its complement A \ B are non-
empty, because 
x∈A λx = 0 and λ ̸= 0. Moreover 
x∈B λx = 
x∈A\B −λx > 0.
The relation
1

x∈B λx

x∈B
λxx =
1

x∈B λx

x∈A\B
−λxx
shows that the convex hulls of B and A \ B have a non-void intersection. □
Let us introduce the function of two integers
Φh
n =
h

k=0
 n
k
!
,
which can alternatively be deﬁned by the relations
Φh
n =

2n
when n ≤h,
Φh−1
n−1 + Φh
n−1
when n > h.
Theorem 4.2.2.
Whenever  S is ﬁnite,
|S| ≤Φ
222
D
S
222 , h(S)

.
Theorem 4.2.3.
For any h ≤n,
Φh
n ≤exp

nH

 h
n

≤exp

h

log( n
h) + 1

,
where H(p) = −p log(p)−(1−p) log(1−p) is the Shannon entropy of the Bernoulli
distribution with parameter p.
Proof of theorem 4.2.2. Let us prove this theorem by induction on | S|. It
is easy to check that it holds true when | S| = 1. Let X =  S, let x ∈X and
X′ = X \ {x}. Deﬁne (△denoting the symmetric diﬀerence of two sets)
S′ = {A ∈S : A △{x} ∈S},
S′′ = {A ∈S : A △{x} ̸∈S}.

4.2.
Bounds for Support Vector Machines
145
Clearly, ⊔denoting the disjoint union, S = S′⊔S′′ and S∩X′ = (S′∩X′)⊔(S′′∩X′).
Moreover |S′| = 2|S′ ∩X′| and |S′′| = |S′′ ∩X′|. Thus
|S| = |S′| + |S′′| = 2|S′ ∩X′| + |S′′| = |S ∩X′| + |S′ ∩X′|.
Obviously h(S ∩X′) ≤h(S). Moreover h(S′ ∩X′) = h(S′)−1, because if A ⊂X′ is
shattered by S′ (or equivalently by S′ ∩X′), then A∪{x} is shattered by S′ (we say
that A is shattered by S when A∩S = {0, 1}A). Using the induction hypothesis, we
then see that |S ∩X′| ≤Φh(S)
|X′| +Φh(S)−1
|X′|
. But as |X′| = |X|−1, the right-hand side
of this inequality is equal to Φh(S)
|X| , according to the recurrence equation satisﬁed
by Φ.
Proof of theorem 4.2.3: This is the well-known Chernoﬀbound for the
deviation of sums of Bernoulli random variables: let (σ1, . . . , σn) be i.i.d. Bernoulli
random variables with parameter 1/2. Let us notice that
Φh
n = 2nP
" n

i=1
σi ≤h
#
.
For any positive real number λ ,
P
 n

i=1
σi ≤h
!
≤exp(λh)E

exp
 
−λ
n

i=1
σi
!
= exp

λh + n log

E

exp

−λσ1

.
Diﬀerentiating the right-hand side in λ shows that its minimal value is
exp

−nK( h
n, 1
2)

, where K(p, q) = p log( p
q ) + (1 −p) log( 1−p
1−q ) is the Kullback diver-
gence function between two Bernoulli distributions Bp and Bq of parameters p and
q. Indeed the optimal value λ∗of λ is such that
h = nE

σ1 exp(−λ∗σ1)

E

exp(−λ∗σ1)

= nBh/n(σ1).
Therefore, using the fact that two Bernoulli distributions with the same expecta-
tions are equal,
log

E

exp(−λ∗σ1)

= −λ∗Bh/n(σ1) −K(Bh/n, B1/2) = −λ∗h
n −K( h
n, 1
2).
The announced result then follows from the identity
H(p) = log(2) −K(p, 1
2)
= p log(p−1) + (1 −p) log(1 +
p
1 −p) ≤p

log(p−1) + 1

.
4.2.3. Vapnik–Cervonenkis dimension of linear rules with margin.
The
proof of the following theorem was suggested to us by a similar proof presented in
Cristianini et al. (2000).
Theorem 4.2.4.
Consider a family of points (x1, . . . , xn) in some Euclidean vec-
tor space E and a family of aﬃne functions
H =

gw,b : E →R ; w ∈E, ∥w∥= 1, b ∈R

,

146
Chapter 4.
Support Vector Machines
where
gw,b(x) = ⟨w, x⟩−b,
x ∈E.
Assume that there is a set of thresholds (bi)n
i=1 ∈Rn such that for any
(yi)n
i=1 ∈{−1, +1}n, there is gw,b ∈H such that
n
inf
i=1

gw,b(xi) −bi

yi ≥γ.
Let us also introduce the empirical variance of (xi)n
i=1,
Var(x1, . . . , xn) = 1
n
n

i=1
CCCCxi −1
n
n

j=1
xj
CCCC
2
.
In this case and with this notation,
(4.5)
Var(x1, . . . , xn)
γ2
≥

n −1
when n is even,
(n −1) n2−1
n2
when n is odd.
Moreover, equality is reached when γ is optimal, bi = 0, i = 1, . . . , n and (x1, . . . ,
xn) is a regular simplex (i.e. when 2γ is the minimum distance between the convex
hulls of any two subsets of {x1, . . . , xn} and ∥xi −xj∥does not depend on i ̸= j).
Proof. Let (si)n
i=1 ∈Rn be such that n
i=1 si = 0. Let σ be a uniformly distributed
random variable with values in Sn, the set of permutations of the ﬁrst n integers
{1, . . . , n}. By assumption, for any value of σ, there is an aﬃne function gw,b ∈H
such that
min
i=1,...,n

gw,b(xi) −bi

21(sσ(i) > 0) −1

≥γ.
As a consequence
E n

i=1
sσ(i)xi, w
F
=
n

i=1
sσ(i)

⟨xi, w⟩−b −bi

+
n

i=1
sσ(i)bi
≥
n

i=1
γ|sσ(i)| + sσ(i)bi.
Therefore, using the fact that the map x →

max

0, x
2
is convex,
E
"CCCC
n

i=1
sσ(i)xi
CCCC
2#
≥E
⎡
⎣
"
max

0,
n

i=1
γ|sσ(i)| + sσ(i)bi
#2⎤
⎦
≥
"
max

0,
n

i=1
γE

|sσ(i)|

+ E

sσ(i)

bi
#2
= γ2
" n

i=1
|si|
#2
,
where E is the expectation with respect to the random permutation σ. On the other
hand
E
"CCCC
n

i=1
sσ(i)xi
CCCC
2#
=
n

i=1
E(s2
σ(i))∥xi∥2 +

i̸=j
E(sσ(i)sσ(j))⟨xi, xj⟩.

4.2.
Bounds for Support Vector Machines
147
Moreover
E(s2
σ(i)) = 1
nE
" n

i=1
s2
σ(i)
#
= 1
n
n

i=1
s2
i .
In the same way, for any i ̸= j,
E

sσ(i)sσ(j)

=
1
n(n −1)E
⎛
⎝
i̸=j
sσ(i)sσ(j)
⎞
⎠
=
1
n(n −1)

i̸=j
sisj
=
1
n(n −1)
&" n

i=1
si
5 67 8
=0
#2
−
n

i=1
s2
i
'
= −
1
n(n −1)
n

i=1
s2
i .
Thus
E
"CCCC
n

i=1
sσ(i)xi
CCCC
2#
=
" n

i=1
s2
i
# ⎡
⎣1
n
n

i=1
∥xi∥2 −
1
n(n −1)

i̸=j
⟨xi, xj⟩
⎤
⎦
=
" n

i=1
s2
i
# & 1
n +
1
n(n −1)
!
n

i=1
∥xi∥2
−
1
n(n −1)
CCCC
n

i=1
xi
CCCC
2'
=
n
n −1
" n

i=1
s2
i
#
Var(x1, . . . , xn).
We have proved that
Var(x1, . . . , xn)
γ2
≥
(n −1)
 n

i=1
|si|
!2
n
n

i=1
s2
i
.
This can be used with si = 1(i ≤n
2 ) −1(i > n
2 ) in the case when n is even and
si =
2
(n−1)1(i ≤n−1
2 ) −
2
n+11(i > n−1
2 ) in the case when n is odd, to establish the
ﬁrst inequality (4.5) of the theorem.
Checking that equality is reached for the simplex is an easy computation when
the simplex (xi)n
i=1 ∈(Rn)n is parametrized in such a way that
xi(j) =

1
if i = j,
0
otherwise.
Indeed the distance between the convex hulls of any two subsets of the simplex is
the distance between their mean values (i.e. centers of mass). □

148
Chapter 4.
Support Vector Machines
4.2.4. Application to Support Vector Machines.
We are going to apply
Theorem 4.2.4 (page 145) to Support Vector Machines in the transductive case.
Let (Xi, Yi)(k+1)N
i=1
be distributed according to some partially exchangeable dis-
tribution P and assume that (Xi)(k+1)N
i=1
and (Yi)N
i=1 are observed. Let us con-
sider some positive kernel K on X. For any K-separable training set of the form
Z′ = (Xi, y′
i)(k+1)N
i=1
, where (y′
i)(k+1)N
i=1
∈Y(k+1)N, let ˆfZ′ be the Support Vector
Machine deﬁned by K and Z′ and let γ(Z′) be its margin. Let
R2 =
max
i=1,...,(k+1)N K(Xi, Xi) +
1
(k + 1)2N 2
(k+1)N

j=1
(k+1)N

k=1
K(Xj, Xk)
−
2
(k + 1)N
(k+1)N

j=1
K(Xi, Xj).
This is an easily computable upper-bound for the radius of some ball containing
the image of (X1, . . . , X(k+1)N) in feature space.
Let us deﬁne for any integer h the margins
(4.6)
γ2h = (2h −1)−1/2
and
γ2h+1 =

2h
 
1 −
1
(2h + 1)2
!−1/2
.
Let us consider for any h = 1, . . . , N the exchangeable model
Rh =
 ˆfZ′ : Z′ = (Xi, y′
i)(k+1)N
i=1
is K-separable and γ(Z′) ≥Rγh

.
The family of models Rh, h = 1, . . . , N is nested, and we know from Theorem 4.2.4
(page 145) and Theorems 4.2.2 (page 144) and 4.2.3 (page 144) that
log

|Rh|

≤h log

 (k+1)eN
h

.
We can then consider on the large model R = +N
h=1 Rh (the disjoint union of the
sub-models) an exchangeable prior π which is uniform on each Rh and is such that
π(Rh) ≥
1
h(h+1). Applying Theorem 3.2.3 (page 116) we get
Proposition 4.2.5. With P probability at least 1 −ϵ, for any h = 1, . . . , N, any
Support Vector Machine f ∈Rh,
r2(f) ≤
k + 1
k
inf
λ∈R+
1 −exp

−λ
N r1(f) −h
N log

e(k+1)N
h

−log[h(h+1)]−log(ϵ)
N

1 −exp(−λ
N )
−r1(f)
k
.
Searching the whole model Rh to optimize the bound may require more computer
resources than are available, but any heuristic can be applied to choose f, since the
bound is uniform. For instance, a Support Vector Machine f ′ using a box constraint
can be trained from the training set (Xi, Yi)N
i=1 and then (y′
i)(k+1)N
i=1
can be set to
y′
i = sign(f ′(Xi)), i = 1, . . . , (k + 1)N.

4.2.
Bounds for Support Vector Machines
149
4.2.5. Inductive margin bounds for Support Vector Machines.
In or-
der to establish inductive margin bounds, we will need a diﬀerent combinatorial
lemma. It is due to Alon et al. (1997). We will reproduce their proof with some tiny
improvements on the values of constants.
Let us consider the ﬁnite case when X = {1, . . . , n}, Y = {1, . . . , b} and
b ≥3. The question we will study would be meaningless when b ≤2. Assume
as usual that we are dealing with a prescribed set of classiﬁcation rules R =

f :
X →Y

. Let us say that a pair (A, s), where A ⊂X is a non-empty set of shapes
and s : A →{2, . . . , b −1} a threshold function, is shattered by the set of func-
tions F ⊂R if for any (σx)x∈A ∈{−1, +1}A, there exists some f ∈F such that
minx∈A σx

f(x) −s(x)

≥1.
Definition 4.2.1.
Let the fat shattering dimension of (X, R) be the maximal size
|A| of the ﬁrst component of the pairs which are shattered by R.
Let us say that a subset of classiﬁcation rules F ⊂YX is separated whenever for
any pair (f, g) ∈F 2 such that f ̸= g, ∥f −g∥∞= maxx∈X|f(x) −g(x)| ≥2. Let
M(R) be the maximum size |F| of separated subsets F of R. Note that if F is a
separated subset of R such that |F| = M(R), then it is a 1-net for the L∞distance:
for any function f ∈R there exists g ∈F such that ∥f −g∥∞≤1 (otherwise f
could be added to F to create a larger separated set).
Lemma 4.2.6.
With the above notation, whenever the fat shattering dimension of
(X, R) is not greater than h,
log

M(R)

< log

(b −1)(b −2)n


log
h
i=1

n
i

(b −2)i
log(2)
+ 1

+ log(2)
≤log

(b −1)(b −2)n


log

(b−2)n
h

+ 1

h
log(2) + 1

+ log(2).
Proof. For any set of functions F ⊂YX, let t(F) be the number of pairs (A, s)
shattered by F. Let t(m, n) be the minimum of t(F) over all separated sets of
functions F ⊂YX of size |F| = m (n is here to recall that the shape space X is
made of n shapes). For any m such that t(m, n) > h
i=1

n
i

(b −2)i, it is clear that
any separated set of functions of size |F| ≥m shatters at least one pair (A, s) such
that |A| > h. Indeed, from its deﬁnition t(m, n) is clearly a non-decreasing function
of m, so that t(|F|, n) > h
i=1

n
i

(b−2)i. Moreover there are only h
i=1

n
i

(b−2)i
pairs (A, s) such that |A| ≤h. As a consequence, whenever the fat shattering
dimension of (X, R) is not greater than h we have M(R) < m.
It is clear that for any n ≥1, t(2, n) = 1.
Lemma 4.2.7. For any m ≥1, t

mn(b−1)(b−2), n

≥2t

m, n−1

, and therefore
t

2n(n −1) · · · (n −r + 1)(b −1)r(b −2)r, n

≥2r.
Proof. Let F = {f1, . . . , fmn(b−1)(b−2)} be some separated set of functions of size
mn(b −1)(b −2). For any pair (f2i−1, f2i), i = 1, . . . , mn(b −1)(b −2)/2, there is
xi ∈X such that |f2i−1(xi) −f2i(xi)| ≥2. Since |X| = n, there is x ∈X such that
mn(b−1)(b−2)/2
i=1
1(xi = x) ≥m(b −1)(b −2)/2. Let I = {i : xi = x}. Since there
are (b −1)(b −2)/2 pairs (y1, y2) ∈Y2 such that 1 ≤y1 < y2 −1 ≤b −1, there

150
Chapter 4.
Support Vector Machines
is some pair (y1, y2), such that 1 ≤y1 < y2 ≤b and such that 
i∈I 1({y1, y2} =
{f2i−1(x), f2i(x)}) ≥m. Let J =

i ∈I : {f2i−1(x), f2i(x)} = {y1, y2}

. Let
F1 = {f2i−1 : i ∈J, f2i−1(x) = y1} ∪{f2i : i ∈J, f2i(x) = y1},
F2 = {f2i−1 : i ∈J, f2i−1(x) = y2} ∪{f2i : i ∈J, f2i(x) = y2}.
Obviously |F1| = |F2| = |J| = m. Moreover the restrictions of the functions of F1 to
X\{x} are separated, and it is the same with F2. Thus F1 strongly shatters at least
t(m, n −1) pairs (A, s) such that A ⊂X \ {x} and it is the same with F2. Finally,
if the pair (A, s) where A ⊂X \ {x} is both shattered by F1 and F2, then F1 ∪F2
shatters also (A ∪{x}, s′) where s′(x′) = s(x′) for any x′ ∈A and s′(x) = ⌊y1+y2
2
⌋.
Thus F1 ∪F2, and therefore F, shatters at least 2t(m, n −1) pairs (A, s). □
Resuming the proof of lemma 4.2.6, let us choose for r the smallest integer such
that 2r > h
i=1

n
i

(b −2)i, which is no greater than

log
h
i=1 (
n
i)(b−2)i
log(2)
+ 1

.
In the case when 1 ≤n ≤r,
log(M(R)) < |X| log(|Y|) = n log(b) ≤r log(b) ≤r log

(b −1)(b −2)n

+ log(2),
which proves the lemma. In the remaining case n > r,
t

2nr(b −1)r(b −2)r, n

≥t

2n(n −1) . . . (n −r + 1)(b −1)r(b −2)r, n

>
h

i=1
 n
i
!
(b −2)i.
Thus |M(R)| < 2

(b −2)(b −1)n
r
as claimed. □
In order to apply this combinatorial lemma to Support Vector Machines, let us
consider now the case of separating hyperplanes in Rd (the generalization to Support
Vector Machines being straightforward). Assume that X = Rd and Y = {−1, +1}.
For any sample (X)(k+1)N
i=1
, let
R(X(k+1)N
1
) = max{∥Xi∥: 1 ≤i ≤(k + 1)N}.
Let us consider the set of parameters
Θ =

(w, b) ∈Rd × R : ∥w∥= 1

.
For any (w, b) ∈Θ, let gw,b(x) = ⟨w, x⟩−b. Let h be some ﬁxed integer and let
γ = R(X(k+1)N
1
)γh, where γh is deﬁned by equation (4.6, page 148).
Let us deﬁne ζ : R →Z by
ζ(r) =
⎧
⎪
⎪
⎪
⎪
⎪
⎪
⎪
⎪
⎨
⎪
⎪
⎪
⎪
⎪
⎪
⎪
⎪
⎩
−5
when
r ≤−4γ,
−3
when
−4γ <r ≤−2γ,
−1
when
−2γ <r ≤0,
+1
when
0 <r ≤2γ,
+3
when
2γ <r ≤4γ,
+5
when
4γ <r.

4.2.
Bounds for Support Vector Machines
151
Let Gw,b(x) = ζ

gw,b(x)

. The fat shattering dimension (as deﬁned in 4.2.1) of

X(k+1)N
1
,

(Gw,b + 7)/2 : (w, b) ∈Θ

is not greater than h (according to Theorem 4.2.4, page 145), therefore there is
some set F of functions from X(k+1)N
1
to {−5, −3, −1, +1, +3, +5} such that
log

|F|

≤log

20(k + 1)N


h
log(2)

log
 4(k + 1)N
h
!
+ 1

+ 1

+ log(2).
and for any (w, b) ∈Θ, there is fw,b ∈F such that sup

|fw,b(Xi) −Gw,b(Xi)| : i =
1, . . . , (k + 1)N

≤2. Moreover, the choice of fw,b may be required to depend on
(Xi)(k+1)N
i=1
in an exchangeable way. Similarly to Theorem 3.2.3 (page 116), it can
be proved that for any partially exchangeable probability distribution P ∈M1
+(Ω),
with P probability at least 1 −ϵ, for any fw,b ∈F,
1
kN
(k+1)N

i=N+1
1

fw,b(Xi)Yi ≤1

≤k + 1
k
inf
λ∈R+

1 −exp(−λ
N )
−1

1−
exp

−λ
N 2
N

i=1
1

fw,b(Xi)Yi ≤1

−log

|F|

−log(ϵ)
N

−
1
kN
N

i=1
1

fw,b(Xi)Yi ≤1

.
Let us remark that
1

21

gw,b(Xi) ≥0

−1 ̸= Yi

= 1

Gw,b(Xi)Yi < 0

≤1

fw,b(Xi)Yi ≤1

and
1

fw,b(Xi)Yi ≤1

≤1

Gw,b(Xi)Yi ≤3

≤1

gw,b(Xi)Yi ≤4γ

.
This proves the following theorem.
Theorem 4.2.8.
Let us consider the sequence (γh)h∈N∗deﬁned by equation (4.6,
page 148). With P probability at least 1 −ϵ, for any (w, b) ∈Θ,
1
kN
(k+1)N

i=N+1
1

21

gw,b(Xi) ≥0

−1 ̸= Yi

≤k + 1
k
inf
λ∈R+,h∈N∗

1 −exp(−λ
N )
−1

1−
exp
&
−λ
N 2
N

i=1
1

gw,b(Xi)Yi ≤4Rγh

−
log

20(k + 1)N

h
log(2) log

4e(k+1)N
h

+ 1

+ log

2h(h+1)
ϵ

N
'

152
Chapter 4.
Support Vector Machines
−
1
kN
N

i=1
1

gw,b(Xi)Yi ≤4Rγh

.
Properly speaking this theorem is not a margin bound, but more precisely a margin
quantile bound, since it covers the case where some fraction of the training sample
falls within the region deﬁned by the margin parameter γh which optimizes the
bound.
As a consequence though, we get a true (weaker) margin bound: with P proba-
bility at least 1 −ϵ, for any (w, b) ∈Θ such that
γ =
min
i=1,...,N gw,b(Xi)Yi > 0,
1
kN
(k+1)N

i=N+1
1

gw,b(Xi)Yi < 0

≤k+1
k

1 −exp

−
log

20(k+1)N

N

16R2+2γ2
log(2)γ2 log

e(k+1)Nγ2
4R2

+ 1

+ 1
N log( ϵ
2)

.
This inequality compares favourably with similar inequalities in Cristianini et al.
(2000), which moreover do not extend to the margin quantile case as this one.
Let us also mention that it is easy to circumvent the fact that R is not observed
when the test set X(k+1)N
N+1
is not observed.
Indeed, we can consider the sample obtained by projecting X(k+1)N
1
on some
ball of ﬁxed radius Rmax, putting
tRmax(Xi) = min

1, Rmax
∥Xi∥

Xi.
We can further consider an atomic prior distribution ν ∈M1
+(R+) bearing on Rmax,
to obtain a uniform result through a union bound. As a consequence of the previous
theorem, we have
Corollary 4.2.9. For any atomic prior ν ∈M1
+(R+), for any partially exchange-
able probability measure P ∈M1
+(Ω), with P probability at least 1 −ϵ, for any
(w, b) ∈Θ, any Rmax ∈R+,
1
kN
(k+1)N

i=N+1
1

21

gw,b ◦tRmax(Xi) ≥0

−1 ̸= Yi

≤k + 1
k
inf
λ∈R+,h∈N∗

1 −exp(−λ
N )
−1

1−
exp
&
−λ
N 2
N

i=1
1

gw,b ◦tRmax(Xi)Yi ≤4Rmaxγh

−
log

20(k + 1)N

h
log(2) log

4e(k+1)N
h

+ 1

+ log

2h(h+1)
ϵν(Rmax)

N
'

4.2.
Bounds for Support Vector Machines
153
−
1
kN
N

i=1
1

gw,b ◦tRmax(Xi)Yi ≤4Rmaxγh

.
Let us remark that tRmax(Xi) = Xi, i = N + 1, . . . , (k + 1)N, as soon as we
consider only the values of Rmax not smaller than maxi=N+1,...,(k+1)N∥Xi∥in this
corollary. Thus we obtain a bound on the transductive generalization error of the
unthresholded classiﬁcation rule 21

gw,b(Xi) ≥0

−1, as well as some incitation to
replace it with a thresholded rule when the value of Rmax minimizing the bound
falls below maxi=N+1,...,(k+1)N∥Xi∥.

154
Chapter 4.
Support Vector Machines

Appendix: Classiﬁcation by
thresholding
In this appendix, we show how the bounds given in the ﬁrst section of this mono-
graph can be computed in practice on a simple example: the case when the clas-
siﬁcation is performed by comparing a series of measurements to threshold values.
Let us mention that our description covers the case when the same measurement is
compared to several thresholds, since it is enough to repeat a measurement in the
list of measurements describing a pattern to cover this case.
5.1. Description of the model
Let us assume that the patterns we want to classify are described through h
real valued measurements normalized in the range (0, 1). In this setting the pattern
space can thus be deﬁned as X = (0, 1)h.
Consider the threshold set T = (0, 1)h and the response set R = Y{0,1}h. For any
t ∈(0, 1)h and any a : {0, 1}h →Y, let
f(t,a)(x) = a

1(xj ≥tj)
h
j=1

,
x ∈X,
where xj is the jth coordinate of x ∈X. Thus our parameter set here is Θ =
T × R. Let us consider the Lebesgue measure L on T and the uniform probability
distribution U on R. Let our prior distribution be π = L ⊗U. Let us deﬁne for any
threshold sequence t ∈T
Δt =

t′ ∈T : (t′
j, tj) ∩{Xj
i ; i = 1, . . . , N} = ∅, j = 1, . . . , h

,
where Xj
i is the jth coordinate of the sample pattern Xi, and where the interval
(t′
j, tj) of the real line is deﬁned as the convex hull of the two point set {t′
j, tj},
whether t′
j ≤tj or not. We see that Δt is the set of thresholds giving the same
response as t on the training patterns. Let us consider for any t ∈T the middle
m(Δt) =

Δt t′L(dt′)
L(Δt)
of Δt. The set Δt being a product of intervals, its middle is the point whose coordi-
nates are the middle of these intervals. Let us introduce the ﬁnite set T composed
of the middles of the cells Δt, which can be deﬁned as
T = {t ∈T : t = m(Δt)}.
It is easy to see that |T| ≤(N + 1)h and that |R| = |Y|2h.
155

156
Appendix
5.2. Computation of inductive bounds
For any parameter (t, a) ∈T × R = Θ, let us consider the posterior distribution
deﬁned by its density
dρ(t,a)
dπ
(t′, a′) = 1

t′ ∈Δt

1

a′ = a

π

Δt × {a}

.
In fact we are considering a ﬁnite number of posterior distributions, since ρ(t,a) =
ρ(m(Δt),a), where m(Δt) ∈T. Moreover, for any exchangeable sample distribution
P ∈M1
+

(X × Y)N+1
and any thresholds t ∈T,
P

(Xj
N+1, tj) ∩{Xj
i , i = 1, . . . , N} = ∅

≤
2
N + 1.
Thus, for any (t, a) ∈Θ,
P

ρ(t,a)

f.(XN+1)

̸= f(t,a)(XN+1)

≤
2h
N + 1,
showing that the classiﬁcation produced by ρ(t,a) on new examples is typically non-
random; this result is only indicative, since it is concerned with a non-random choice
of (t, a).
Let us compute the various quantities needed to apply the results of the ﬁrst
section, focussing our attention on Theorem 2.1.3 (page 54).
First note that ρ(t,a)(r) = r[(t, a)]. The entropy term is such that
K(ρt,a, π) = −log

π

Δt × {r}

= −log

L(Δt)

+ 2h log

|Y|

.
Let us notice accordingly that
min
(t,a)∈Θ K(ρ(t,a), π) ≤h log(N + 1) + 2h log

|Y|

.
Let us introduce the counters
bt
y(c) = 1
N
N

i=1
1

Yi = y and

1(Xj
i ≥tj)
h
j=1 = c

,
t ∈T, c ∈{0, 1}h, y ∈Y,
bt(c) =

y∈Y
bt
y(c) = 1
N
N

i=1
1

1(Xj
i ≥tj)
h
j=1 = c

,
t ∈T, c ∈{0, 1}h.
Since
r[(t, a)] =

c∈{0,1}h

bt(c) −bt
a(c)(c)

,
the partition function of the Gibbs estimator can be computed as
π

exp(−λr)

=

t∈T
L(Δt)

a∈R
1
|Y|2h exp

−λ
N

i=1
1

Yi ̸= f(t,a)(Xi)

=

t∈T
L(Δt)

a∈R
1
|Y|2h exp

−λ

c∈{0,1}h

bt(c) −bt
a(c)(c)


5.2.
Computation of inductive bounds
157
=

t∈T
L(Δt)
3
c∈{0,1}h
&
1
|Y|

y∈Y
exp
 
−λ

bt(c) −bt
y(c)
!'
.
We see that the number of operations needed to compute π

exp(−λr)

is propor-
tional to |T| × 2h × |Y| ≤(N + 1)h2h|Y|. An exact computation will therefore be
feasible only for small values of N and h. For higher values, a Monte Carlo approx-
imation of this sum will have to be performed instead.
If we want to compute the bound provided by Theorem 2.1.3 (page 54) or by
Theorem 2.2.2 (page 68), we need also to compute, for any ﬁxed parameter θ ∈Θ,
quantities of the type
πexp(−λr)

exp

ξm′(·, θ)

= πexp(−λr)

exp

ξρθ(m′)

,
λ, ξ ∈R+.
We need to introduce
b
t
y(θ, c) = 1
N
N

i=1
2221

fθ(Xi) ̸= Yi

−1(y ̸= Yi)
2221

1(Xj
i ≥tj)
h
j=1 = c

.
Similarly to what has been done previously, we obtain
π

exp

−λr + ξm′(·, θ)

=

t∈T
L(Δt)
3
c∈{0,1}h
 1
|Y|

y∈Y
exp
 
−λ

bt(c) −bt
y(c)

+ ξb
t
y(θ, c)
!
.
We can then compute
πexp(−λr)(r) = −∂
∂λ log

π

exp(−λr)

,
πexp(−λr)

exp

ξρθ(m′)

= π

exp

−λr + ξm′(·, θ)

π

exp(−λr)

,
πexp(−λr)

m′(·, θ)

= ∂
∂ξ |ξ=0
log

π

exp

−λr + ξm′(·, θ)

.
This is all we need to compute B(ρθ, β, γ) (and also B(πexp(−λr), β, γ)) in Theorem
2.1.3 (page 54), using the approximation
log

πexp(−λ1r)

exp

ξπexp(−λ2r)(m′)

≤log

πexp(−λ1r)

exp

ξm′(·, θ)

+ ξπexp(−λ2r)

m′(·, θ)

,
ξ ≥0.
Let us also explain how to apply the posterior distribution ρ(t,a), in other words
our randomized estimated classiﬁcation rule, to a new pattern XN+1:
ρ(t,a)

f·(XN+1) = y

= L(Δt)−1

Δt
1

a

1(Xj
N+1 ≥t′
j)
h
j=1

= y

L(dt′)
= L(Δt)−1

c∈{0,1}h
L

t′ ∈Δt :

1(Xj
N+1 ≥t′
j)
h
j=1 = c

1

a(c) = y

.
Let us deﬁne for short
Δt(c) =

t′ ∈Δt :

1(Xj
N+1 ≥t′
j)
h
j=1 = c

,
c ∈{0, 1}h.

158
Appendix
With this notation
ρ(t,a)

f.(XN+1) = y

= L

Δt
−1

c∈{0,1}h
L

Δt(c)

1

a(c) = y

.
We can compute in the same way the probabilities for the label of the new pattern
under the Gibbs posterior distribution:
πexp(−λr)

f·(XN+1) = y′
=

t∈T
3
c∈{0,1}h
 1
|Y|

y∈Y
exp
 
−λ

bt(c) −bt
y(c)
!
×

c∈{0,1}h
L

Δt(c)

y∈Y 1(y = y′) exp

−λ

bt(c) −bt
y(c)


y∈Y exp

−λ

bt(x) −bty(c)


×

t∈T
L(Δt)
3
c∈{0,1}h
 1
|Y|

y∈Y
exp

−λ

bt(c) −bt
y(c)
−1
.
5.3. Transductive bounds
In the case when we observe the patterns of a shadow sample (Xi)(k+1)N
i=N+1 on top
of the training sample (Xi, Yi)N
i=1, we can introduce the set of thresholds responding
as t on the extended sample (Xi)(k+1)N
i=1
Δt =

t′ ∈T : (t′
j, tj) ∩

Xj
i ; i = 1, . . . , (k + 1)N} = ∅, j = 1, . . . , h

,
consider the set
T =

t ∈T : t = m(Δt)

,
of the middle points of the cells Δt, t ∈T, and replace the Lebesgue measure
L ∈M1
+

(0, 1)h
of the previous section with the uniform probability measure L on
T. We can then consider π = L⊗U, where U is as previously the uniform probability
measure on R. This gives obviously an exchangeable posterior distribution and
therefore qualiﬁes π for transductive bounds. Let us notice that |T| ≤

(k + 1)N +
1
h, and therefore that π(t, a) ≥

(k + 1)N + 1
−h|Y|−2h, for any (t, a) ∈T × R.
For any (t, a) ∈T × R we may similarly to the inductive case consider the
posterior distribution ρ(t,a) deﬁned by
dρ(t,a)
dπ
(t′, a′) = 1(t′ ∈Δt)1(a′ = a)
π

Δt × {a})
,
but we may also consider δ(m(Δt),a), which is such that ri{[m(Δt), a]} = ri[(t, a)],
i = 1, 2, whereas only ρ(t,a)(r1) = r1[(t, a)], while
ρ(t,a)(r2) =
1
|T ∩Δt|

t′∈T ∩Δt
r2[(t′, a)].
We get

5.3.
Transductive bounds
159
K(ρ(t,a), π) = −log

L(Δt)

+ 2h log

|Y|

≤log

|T|

+ 2h log(|Y|) = K(δ[m(Δt),a], π)
≤h log

(k + 1)N + 1

+ 2h log(|Y|),
whereas we had no such uniform bound in the inductive case. Similarly to the
inductive case
π

exp(−λr1)

=

t∈T
L(Δt)
3
c∈{0,1}h
 1
|Y|

y∈Y
exp
 
−λ

bt(c) −bt
y(c)
!
.
Moreover, for any θ ∈Θ,
π

exp

−λr1 + ξρθ(m′)

= π

exp

−λr1 + ξm′(·, θ)

=

t∈T
L(Δt)
3
c∈{0,1}h
 1
|Y|

y∈Y
exp
 
−λ

bt(c) −bt
y(c)

+ ξb(θ, c)
!
.
The bound for the transductive counterpart to Theorems 2.1.3 (page 54) or 2.2.2
(page 68), obtained as explained page 115, can be computed as in the inductive
case, from these two partition functions and the above entropy computation.
Let us mention ﬁnally that, using the same notation as in the inductive case,
πexp(−λr1)

f·(XN+1) = y′
=

t∈T
3
c∈{0,1}h
 1
|Y|

y∈Y
exp
 
−λ

bt(c) −bt
y(c)
!
×

c∈{0,1}h
L

Δt(c)

y∈Y 1(y = y′) exp

−λ

bt(c) −bt
y(c)


y∈Y exp

−λ

bt(x) −bty(c)


×

t∈T
L(Δt)
3
c∈{0,1}h
 1
|Y|

y∈Y
exp

−λ

bt(c) −bt
y(c)
−1
.
To conclude this appendix on classiﬁcation by thresholding, note that similar fac-
torized computations are feasible in the important case of classiﬁcation trees. This
can be achieved using some variant of the context tree weighting method discovered
by Willems et al. (1995) and successfully used in lossless compression theory. The
interested reader can ﬁnd a description of this algorithm applied to classiﬁcation
trees in Catoni (2004, page 62).

160
Appendix

Bibliography
Alon, N., Ben-David, S., Cesa-Bianchi, N. and Haussler, D. (1997). Scale
sensitive dimensions, uniform convergence and learnability. J. ACM 44 615–631.
Audibert, J.-Y. (2004a). Aggregated estimators and empirical complexity for least
square regression. Ann. Inst. H. Poincar´e Probab. Statist. 40 685–736.
Audibert, J.-Y. (2004b). PAC-Bayesian statistical learning theory. Ph.D. thesis,
Univ. Paris 6. Available at http://cermics.enpc.fr/ audibert/.
Barron, A. (1987). Are Bayes rules consistent in information? In Open Problems
in Communication and Computation (T. M. Cover and B. Gopinath, eds.) 85–91.
Springer, New York.
Barron, A. and Yang, Y. (1999). Information-theoretic determination of mini-
max rates of convergence. Ann. Statist. 27 1564–1599.
Barron, A., Birg´e, L. and Massart, P. (1999). Risk bounds for model selection
by penalization. Probab. Theory Related Fields 113 301–413.
Blanchard, G. (1999). The “progressive mixture” estimator for regression trees.
Ann. Inst. H. Poincar´e Probab. Statist. 35 793–820.
Blanchard, G. (2001). Mixture and aggregation of estimators for pattern recog-
nition. Application to decision trees. Ph.D. thesis, Univ. Paris 13. Available at
http://ida.ﬁrst.fraunhofer.de/ blanchard/.
Blanchard, G. (2004). Un algorithme acc´el´er´e d’´echantillonnage Bay´esien pour
le mod`ele CART. Rev. Intell. Artiﬁcielle 18 383–410.
Birg´e, L. and Massart, P. (1997). From model selection to adaptive estimation.
In Festschrift for Lucien Le Cam (D. Pollard, ed.) 55–87. Springer, New York.
Birg´e, L. and Massart, P. (1998). Minimum contrast estimators on sieves.
Bernoulli 4 329–375.
Birg´e, L. and Massart, P. (2001a). A generalized Cp criterion for Gaussian
model selection. Preprint. Available at http://www.math.u-psud.fr/ massart/.
Birg´e, L. and Massart, P. (2001b). Gaussian model selection. J. Eur. Math.
Soc. 3 203–268.
Blum, A. and Langford, J. (2003). PAC-MDL bounds. Computational Learn-
ing Theory and Kernel Machines. 16th Annual Conference on Computational
Learning Theory and 7th Kernel Workshop. COLT/Kernel 2003, Washington,
DC, USA, August 24-27, 2003, Proceedings. Lecture Notes in Comput. Sci. 2777
344–357. Springer, New York.
Catoni, O. (2002). Data compression and adaptive histograms. In Foundations of
Computational Mathematics. Proceedings of the Smalefest 2000 (F. Cucker and
J. M. Rojas eds.) 35–60. World Scientiﬁc.
Catoni, O. (2003). Laplace transform estimates and deviation inequalities. Ann.
Inst. H. Poincar´e Probab. Statist. 39 1–26.
Catoni, O. (2004). Statistical learning theory and stochastic optimization. Ecole
161

162
Bibliography
d’´Et´e de Probabilit´es de Saint-Flour XXXI—2001. Lecture Notes in Math. 1851
1–270. Springer, New York.
Cristianini, N. and Shawe Taylor, J. (2000). An Introduction to Support Vec-
tor Machines and Other Kernel Based Learning Methods. Cambridge Univ. Press.
Feder, M. and Merhav, N. (1996). Hierarchical universal coding. IEEE Trans.
Inform. Theory 42 1354–1364.
Hastie, T., Tibshirani, R. and Friedman, J. (2001). The Elements of Statis-
tical Learning. Springer, New York.
Langford, J. and McAllester, D. (2004). Computable shell decomposition
bounds. J. Machine Learning Research 5 529–547.
Langford,
J.
and
Seeger,
M.
(2001a).
Bounds
for
averaging
classi-
ﬁers. Technical report CMU-CS-01-102, Carnegie Mellon Univ. Available at
http://www.cs.cmu.edu/ jcl.
Langford, J., Seeger, M. and Megiddo, N. (2001b). An improved predictive
accuracy bound for averaging classiﬁers. International Conference on Machine
Learning 18 290–297.
Littlestone,
N.
and
Warmuth,
M. (1986). Relating data compression
and learnability. Technical report, Univ. California, Santa Cruz. Available at
http://www.soe.ucsc.edu/ manfred/pubs.html.
McAllester, D. A. (1998). Some PAC-Bayesian theorems. In Proceedings of the
Eleventh Annual Conference on Computational Learning Theory (Madison, WI,
1998) 230–234. ACM, New York.
McAllester, D. A. (1999). PAC-Bayesian model averaging. In Proceedings of
the Twelfth Annual Conference on Computational Learning Theory (Santa Cruz,
CA, 1999) 164–170. ACM, New York.
McDiarmid, C. (1998) Concentration. In Probabilistic Methods for Algorithmic
Discrete Mathematics (M. Habib, C. McDiarmid and B. Reed, eds.) 195–248.
Springer, New York.
Mammen, E. and Tsybakov, A. (1999). Smooth discrimination analysis. Ann.
Statist. 27 1808–1829.
Ryabko, B. Y. (1984). Twice-universal coding. Problems Inform. Transmission
20 24–28.
Seeger, M. (2002). PAC-Bayesian generalization error bounds for Gaussian
process classiﬁcation. J. Machine Learning Research 3 233–269.
Shawe-Taylor, J., Bartlett, P. L., Williamson, R. C. and Anthony,
M. (1998). Structural risk minimization over data-dependent hierarchies. IEEE
Trans. Inform. Theory 44 1926–1940.
Shawe-Taylor, J. and Cristianini, N. (2002). On the generalization of soft
margin algorithms. IEEE Trans. Information Theory 48 2721–2735.
Tsybakov, A. (2004). Optimal aggregation of classiﬁers in statistical learning.
Ann. Statist. 32 135–166.
Tsybakov, A. and Van de Geer, S. (2005). Square root penalty: Adaptation to
the margin in classiﬁcation and in edge estimation. Ann. Statist. 33 1203–1224.
Van de Geer, S. (2000). Applications of Empirical Process Theory. Cambridge
Univ. Press.
Vapnik, V. N. (1998). Statistical Learning Theory. Wiley, New York.
Vert, J.-P. (2000). Double mixture and universal inference. Preprint. Available
at http://cbio.ensmp.fr/ vert/publi/.
Vert, J.-P. (2001a). Adaptive context trees and text clustering. IEEE Trans.
Inform. Theory 47 1884–1901.
Vert, J.-P. (2001b). Text categorization using adaptive context trees. Proceedings

Bibliography
163
of the CICLing-2001 Conference (A. Gelbukh, ed.) 423–436. Lecture Notes in
Comput. Sci. 2004. Springer, New York.
Willems, F. M. J., Shtarkov, Y. M. and Tjalkens, T. J. (1995). The
context-tree weighting method: Basic properties. IEEE Trans. Inform. Theory
41 653–664.
Willems, F. M. J., Shtarkov, Y. M. and Tjalkens, T. J. (1996). Con-
text weighting for general ﬁnite-context sources. IEEE Trans. Inform. Theory
42 1514–1520.
Zhang, T. (2006a). From ϵ-entropy to KL-entropy: Analysis of minimum informa-
tion complexity density estimation. Ann. Statist. 34 2180–2210.
Zhang, T. (2006b). Information-theoretic upper and lower bounds for statistical
estimation. IEEE Trans. Inform. Theory 52 1307–1321.

