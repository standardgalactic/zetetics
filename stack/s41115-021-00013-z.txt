REVIEW ARTICLE
Large-scale dark matter simulations
Raul E. Angulo1,2
• Oliver Hahn3,4,5
Received: 24 March 2021 / Accepted: 11 November 2021 / Published online: 11 February 2022
 The Author(s) 2021
Abstract
We review the ﬁeld of collisionless numerical simulations for the large-scale
structure of the Universe. We start by providing the main set of equations solved by
these simulations and their connection with General Relativity. We then recap the
relevant numerical approaches: discretization of the phase-space distribution (fo-
cusing on N-body but including alternatives, e.g., Lagrangian submanifold and
Schro¨dinger–Poisson) and the respective techniques for their time evolution and
force calculation (direct summation, mesh techniques, and hierarchical tree meth-
ods). We pay attention to the creation of initial conditions and the connection with
Lagrangian Perturbation Theory. We then discuss the possible alternatives in terms
of the micro-physical properties of dark matter (e.g., neutralinos, warm dark matter,
QCD axions, Bose–Einstein condensates, and primordial black holes), and exten-
sions to account for multiple ﬂuids (baryons and neutrinos), primordial non-Gaus-
sianity and modiﬁed gravity. We continue by discussing challenges involved in
achieving highly accurate predictions. A key aspect of cosmological simulations is
the connection to cosmological observables, we discuss various techniques in this
regard: structure ﬁnding, galaxy formation and baryonic modelling, the creation of
emulators and light-cones, and the role of machine learning. We ﬁnalise with a
recount of state-of-the-art large-scale simulations and conclude with an outlook for
the next decade.
Keywords Cosmology  Large-scale structure  Numerical methods
Contents
1
Introduction.............................................................................................................................
3
1.1
Large-scale simulations .................................................................................................
4
1.2
Upcoming challenges.....................................................................................................
6
1.3
Outline............................................................................................................................
8
Extended author information available on the last page of the article
123
Living Rev Comput Astrophys (2022) 8:1
https://doi.org/10.1007/s41115-021-00013-z(0123456789().,-volV)
(0123456789().,-volV)

2
Gravity and dynamics of matter in an expanding Universe.................................................
9
2.1
Equations of motion and the Vlasov equation .............................................................
10
2.2
Scalar metric ﬂuctuations and the weak ﬁeld limit .....................................................
11
2.3
Newtonian cosmological simulations............................................................................
13
2.4
Post-Newtonian simulations ..........................................................................................
14
2.5
Cold limit: the phase-space sheet and perturbation theory..........................................
15
2.6
Deformation and evolution in phase space ..................................................................
18
3
Discretization techniques for Vlasov–Poisson systems ........................................................
20
3.1
The N-body technique ...................................................................................................
20
3.2
Phase space deformation tracking and Lagrangian submanifold approximations ......
25
3.3
Full phase-space techniques ..........................................................................................
28
3.4
Schro¨dinger–Poisson as a discretisation of Vlasov–Poisson .......................................
29
4
Time evolution .......................................................................................................................
29
4.1
Symplectic integration of cosmological Hamiltonian dynamics .................................
30
4.2
Multi-stepping, adaptive steps and separation of time-scales......................................
32
4.3
Symplectic integration of quantum Hamiltonians........................................................
35
4.4
Acceleration methods: COLA and FASTPM .................................................................
37
5
Gravity calculation .................................................................................................................
39
5.1
Mesh-based methods......................................................................................................
39
5.2
Direct P2P summation...................................................................................................
45
5.3
Particle mesh Ewald summation, force splitting and the P3M method ......................
46
5.4
Hierarchical tree methods..............................................................................................
48
6
Initial conditions.....................................................................................................................
53
6.1
Connecting simulations with perturbation theory ........................................................
54
6.2
Initial conditions from Lagrangian perturbation theory...............................................
57
6.3
Generating Gaussian realisations of the perturbation ﬁelds ........................................
58
6.4
Initial particle loads and discreteness ...........................................................................
69
7
Beyond the cold collisionless limit: physical properties and models for dark
matter candidates....................................................................................................................
70
7.1
Weakly-interacting massive particles............................................................................
71
7.2
Axions ............................................................................................................................
74
7.3
Warm Dark Matter (WDM) ..........................................................................................
76
7.4
Fuzzy Dark Matter: Quantum Hamiltonians and condensates ....................................
79
7.5
Primordial black holes...................................................................................................
83
7.6
Self-interacting dark matter (SIDM), decaying and dissipative dark matter ..............
84
7.7
Effective descriptions ....................................................................................................
87
7.8
Multiple species with distinct initial perturbation amplitudes.....................................
88
7.9
Primordial non-Gaussianity and small-scale features from inﬂation...........................
95
7.10 Modiﬁed gravity ............................................................................................................
98
7.11 Closing remark.............................................................................................................
101
8
Numerical considerations and the challenge of high-accuracy simulations ......................
102
8.1
Box size and mass resolution......................................................................................
102
8.2
Close encounters and regularization in N-body methods ..........................................
104
8.3
Accuracy of initial conditions.....................................................................................
107
8.4
Chaos and determinism in simulations.......................................................................
108
8.5
Convergence among codes..........................................................................................
110
8.6
The N-body approximation .........................................................................................
112
9
Analysis and postprocessing ................................................................................................
113
9.1
The density ﬁeld ..........................................................................................................
114
9.2
Power-spectra and correlation functions, n-point and n-spectra................................
115
9.3
Velocity ﬁelds..............................................................................................................
117
9.4
Structure ﬁnding ..........................................................................................................
119
9.5
Cosmic web classiﬁcation ...........................................................................................
123
9.6
Lightcones....................................................................................................................
125
9.7
Emulators and interpolators.........................................................................................
127
123
1
Page 2 of 200
R. E. Angulo, O. Hahn

9.8
Machine learning .........................................................................................................
129
9.9
Connecting dark matter to galaxies and baryons .......................................................
131
10 Overview of state-of-the-art simulations and challenges....................................................
141
10.1 State-of-the-art simulations .........................................................................................
141
10.2 Computational trends and challenges .........................................................................
143
10.3 Challenges for data dissemination ..............................................................................
144
10.4 Challenges for cosmological predictions....................................................................
145
11 Conclusions and outlook......................................................................................................
148
References...................................................................................................................................
150
1 Introduction
The current standard cosmological model describes a Universe accelerated by a
cosmological constant (K) and dominated by cold dark matter (CDM), where
structure arose from minute initial perturbations—seeded in the primordial quantum
Universe—which collapsed on ever larger scales over cosmic time (Planck
Collaboration 2020; Alam et al. 2017; Betoule et al. 2014). The nonlinear interplay
of these ingredients have formed the cosmic web and the intricate network of haloes
harbouring galaxies and quasars.
Over the last decades, numerical simulations have played a decisive role in
establishing and testing this KCDM paradigm. Following pioneering work in the
1980s, numerical simulations steadily grew in realism and precision thanks to major
advances in algorithms, computational power, and the work of hundreds of
scientists. As a result, various competing hypotheses and theories could be
compared with observations, guiding further development along the years.
Ultimately, KCDM was shown to be quantitatively compatible with virtually all
observations of the large-scale structure of the Universe, even for those that involve
nonlinear physics and that are inaccessible to any method other than computer
simulations (see e.g., Springel et al. 2006; Vogelsberger et al. 2020).
Nowadays, simulations have become the go-to tool in cosmology for a number of
tasks: (i) the interpretation of observations in terms of the underlying physics and
cosmological parameters; (ii) the testing and aiding of the development of
perturbative approaches and analytic models for structure formation; (iii) the
production of reliable input (training) data for data-driven approaches and
emulators; (iv) the creation of mock universes for current and future large-scale
extragalactic cosmological surveys, from which we can quantify statistical and
systematic errors; (v) the study of the importance of various aspects of the
cosmological model and physical processes, and determining their observability.
Despite the remarkable agreement between simulations and the observed
Universe, there are indications that KCDM might not be ultimately the correct
theory (Planck Collaboration 2020; Riess et al. 2019; Asgari et al. 2021; DES
Collaboration 2021). Future cosmological observations will provide enough data to
test competing explanations by probing exceedingly large sub-volumes of the
Universe in virtually all electromagnetic wavelengths, and including increasingly
fainter objects and smaller structures (e.g. Laureijs et al. 2011; Bonoli et al. 2021;
123
Large-scale dark matter simulations
Page 3 of 200
1

DESI Collaboration 2016; Ivezic´ et al. 2019; Ade et al. 2019; Merloni et al. 2012).
These observations will be able to test the physics of our Universe beyond the
standard model: from neutrino masses, over the nature of dark matter and dark
energy, to the inﬂationary mechanism. Since these observations are intimately
connected to the nonlinear regime of structure formation, any optimal exploitation
of the cosmological information will increasingly rely on numerical simulations.
This will put numerical simulations in the spotlight of modern cosmology: they can
either conﬁrm or break the standard KCDM paradigm, and therefore will play a key
role in the potential discovery of new physics.
The required accuracy and precision to make predictions of the necessary quality
poses many important challenges and requires a careful assessment of all the
underlying assumptions. This is the main topic of this review; we cover the ample
ﬁeld of cosmological simulations, starting from the fundamental equations to their
connection with astrophysical observables, highlighting places where current
research is conducted.
1.1 Large-scale simulations
The spatial distribution and dynamics of the large-scale structure give us access to
fundamental aspects of the Universe: its composition, the physical laws, and its
initial conditions. For instance, the overall shape of the galaxy power spectrum is
sensitive to the abundance of baryons and dark matter; the anisotropy induced by
redshift-space distortions can constrain the cosmic density-velocity relation which
in turn is set by the gravity law; and high-order cumulants of the galaxy ﬁeld can
encode non-Gaussian signatures inherited from an early inﬂationary period.
To extract this information from observations of the large-scale distribution of
galaxies, quasars or other tracers, we must rely on a model that predicts their
observed distribution as a function of cosmic time for a given cosmological model.
That is, we require a prediction for the distribution of the mass density and the
velocity ﬁeld together with the properties and abundance of collapsed objects.
Furthermore, we need to predict how galaxies or other astronomical objects will
populate these ﬁelds. This is a well-posed but very challenging problem, due to the
complexity and nonlinear nature of the underlying physics.
On large scales and/or at early times, density ﬂuctuations are small and the
problem can be tackled analytically by expanding perturbatively the relevant
evolution equations. However, a rigorous perturbation theory can only be carried
out on scales unaffected by shell-crossing effects. On intermediate scales, instead,
so far only effective models with several free parameters exist (that are themselves
either ﬁtted to simulations or tested with simulations). On smaller very nonlinear
scales, the only way to accurately solve the problem is numerically.
We illustrate the complicated nature of the nonlinear universe in Fig. 1, which
shows the simulated matter ﬁeld in a region 40h1Mpc wide. In the top panel we
can appreciate the distribution of dark matter halos and their variety in terms of
sizes, masses, and shapes. In the middle and bottom panels we show the same region
123
1
Page 4 of 200
R. E. Angulo, O. Hahn

but on much thinner slices which emphasise the small-scale anisotropies and
ubiquitous ﬁlamentary structure.
When one is concerned with the large-scale structure of the Universe, the
dynamics is dominated by gravity, and baryons and dark matter can be considered
as a single pressureless (cold) ﬂuid. This poses an ideal situation for computer
simulations: the initial conditions as well as the relevant physical laws are known
and can be solved numerically considering only gravitational interactions. We
review in detail the foundations of such numerical simulations in Sects. 2, 3, 4, 5,
and 6. Speciﬁcally, in Sect. 2 we describe the derivation of the relevant equations
solved by numerical simulations, in Sect. 3 how they can be discretised by either an
N-body approach or by alternative methods. As we will discuss later, considering
different discretisations will be crucial to test the robustness of the predictions from
N-body simulations. In Sect. 4 we discuss how to evolve the discretised equations in
time, and pay attention to common approaches for computational optimization,
whereas in Sect. 5 we discuss various numerical techniques to compute gravita-
tional interactions. Finishing our recap of the main numerical techniques underlying
large-scale simulations, in Sect. 6 we discuss several aspects of how to set their
initial conditions.
Fig. 1 The distribution of dark matter in thin slices as predicted by a cosmological N-body simulation.
Each panel shows a region 40h1Mpc wide with different levels of thickness—40, 2, and 0:1h1Mpc,
from top to bottom—which highlight different aspects of the simulated density ﬁeld, from the distribution
of dark matter halos in the top panel, to the ﬁlamentary nature of the nonlinear structure in the bottom
panel. Image adapted from Stu¨cker et al. (2018)
123
Large-scale dark matter simulations
Page 5 of 200
1

The importance of numerical solutions for structure formation is that they
provide currently the only way to predict the highly nonlinear universe, and
potentially extract cosmological information from observations at all scales. In
contrast, if one is restricted to scales where perturbative approaches are valid and
shell-crossing effects are negligible (i.e., have only a sub-per cent impact on
summary statistics), then a huge amount of cosmological information is potentially
lost.
The primary role of numerical simulations for cosmological constraints has
already been demonstrated for several probes focusing mostly on small scales, and
in setting constraints on the properties of the dark matter particle, as exempliﬁed by
constraints from the Ly-a forest, the abundance and properties of Milky-Way
satellites, and strong lensing modelling. They all rely on a direct comparison of
observations with numerical simulations, or with models calibrated and/or validated
using numerical simulations. In Sect. 7 we discuss several ways in which the
distinctive properties of various potential dark matter candidates can be modelled
numerically, including neutralinos, warm dark matter, axions, wave dark matter,
and decaying and self-interacting dark matter. In the future, this will also be the case
for large-scale clustering, and we discuss the current and potential challenges to be
address in Sect. 8.
1.2 Upcoming challenges
Given that simulations are increasingly used for the inference of cosmological
parameters, a question of growing importance is therefore how one can demonstrate
the correctness of a given numerical solution. For instance, any simulation-based
evidence—of massive neutrinos or a departure from GR—would necessarily need to
prove its accuracy in modelling the relevant physics in the nonlinear regime. A
proper understanding is of paramount importance: simulators need to demonstrate
that a potential discovery relying on simulations is not simply a numerical
inaccuracy or could be explained by uncertain/ill understood model parameters (i.e.
the uncertainties due to all ‘‘free’’ parameters must be quantiﬁed). We devote
Sect. 7 to this topic.
Unfortunately still only a limited set of exact solutions is known for which strong
convergence can be demonstrated. For useful predictions, the correctness of the
solution has to be established in a very different, much more non-linear regime.
However, far from these relatively simplistic known solutions. There has been
signiﬁcant progress in this direction over the last decade: from large code
comparisons, a better understanding of the effect of numerical noise and
discreteness errors, the impact of code parameters that control the accuracy of the
solution, to the quality of the initial conditions used to set-up the simulations. These
tests, however, presuppose that the N-body method itself converges to the right
solution for a relatively small number of particles. Clear examples where the N-
body approach fails have emerged: most notably near the free-streaming scale in
warm dark matter simulations, and in the relative growth of multi-ﬂuid simulations.
Very recently, methods that do not rely on the N-body approach have become
possible which have allowed to test for such errors. Although so far no signiﬁcant
123
1
Page 6 of 200
R. E. Angulo, O. Hahn

biases have been measured for the statistical properties of CDM simulations, many
more careful and systematic comparisons will be needed in the future.
In parallel, there has been signiﬁcant progress in the improved modelling of the
multi-physics aspect of modern cosmological simulations. For instance, accurate
two-ﬂuid simulations are now possible capturing the distinct evolution of baryons
and cold dark matter, as are simulations that quantify the non-linear impact of
massive neutrinos with sophisticated methods. Further, the use of Newtonian
dynamics has been tested against simulations solving general relativistic equations
in the weak ﬁeld limit, and schemes to include relativistic corrections have been
devised. We discuss all these extensions, which seek to improve the realism of
numerical simulations, in Sect. 7.
An important aspect for conﬁrming or ruling out the KCDM model will be the
design of new cosmic probes that are particularly sensitive to departures from
KCDM. For this it is important to understand the role of non-standard ingredients on
various observables and in structure formation in general. This is an area where
rapid progress has been seen with advances in the variety and sophistication of
models, for instance regarding the actual nature of dark matter and simulations
assuming neutralinos, axions, primordial black holes, or wave dark matter.
Likewise, modiﬁcations of general relativity as the gravity law, and simulations
with primordial non-Gaussianity have also reached maturity.
To achieve the required accuracy and precision that is necessary to make optimal
use of upcoming observational data, it is blatantly clear that, ultimately, all
systematic errors in simulations must be understood and quantiﬁed, and the impact
of all the approximations made must be under control. One of them is that on
nonlinear scales baryonic effects start to become important since cold collisionless
and collisional matter start to separate, and baryons begin being affected by
astrophysical processes. Hence, it becomes important to enhance the numerical
simulation with models for the baryonic components, either for the formation of
galaxies or for the effects of gas pressure and feedback from supernovae or
supermassive black holes. We discuss different approaches to this problem in
Sect. 9.
In parallel to increasing the accuracy of simulations, the community is focusing
on improving their ‘‘precision’’. Cosmological simulations typically push interna-
tional supercomputer centers and are among the largest calculations. New
technologies and algorithmic advances are an important part of the ﬁeld of
cosmological simulations, and we review this in Sect. 10. We have seen important
advances in terms of adoption of GPUs and hardware accelerators and new
algorithms for force calculations with improved precision, computational efﬁciency,
and parallelism. Thank to these, state-of-the-art simulations follow regions of
dozens of Gigaparsecs with trillions of particles, constantly approaching the level
required by upcoming extragalactic surveys.
The ﬁeld of cosmological simulations have been also reviewed in the last decade
by other authors, who have focused on different aspects of the ﬁeld and from
different perspectives. For more details, we refer the reader to the excellent reviews
by Kuhlen et al. (2012), Frenk and White (2012), Dehnen and Read (2011), and by
Vogelsberger et al. (2020).
123
Large-scale dark matter simulations
Page 7 of 200
1

1.3 Outline
In the following we brieﬂy outline the contents of each subsection of this review.
Section 2: This section provides the basic set of equations solved by cosmo-
logical dark matter simulations. We emphasise the approximations usually adopted
by most simulations regarding the weak-ﬁeld limit of General Relativity and the
properties of dark matter. This section sets the stage for various kinds of simulations
we discuss afterwards.
Section 3: This section discusses the possible numerical approaches for solving
the equations presented in Section 2. Explicitly, we discuss the N-body approach
and alternative methods such as the Lagrangian submanifold, full phase-space
techniques, and Schro¨dinger–Poisson.
Section 4: This section derives the time integration of the relevant equations of
motion. We discuss the symplectic integration of the dynamics at second order. We
also review individual and adaptive timestepping, and the integration of quantum
Hamiltonians.
Section 5: We review various methods for computing the gravitational forces
exerted by the simulated mass distribution. Explicitly, we discuss the Particle-Mesh
method solved by Fourier and mesh-relaxation algorithms, Trees in combination
with traditional multipole expansions and Fast multipole methods, and their
combination.
Section 6: In this section we outline the method for setting the initial conditions
for the various types of numerical simulations considered. Explicitly, we review the
numerical algorithms employed (Zel’dovich approximation and higher-order
formulations) as formulated in Fourier or conﬁguration space.
Section 7: This section is focused on simulations relaxing the assumption that all
mass in the Universe is made out of a single cold collisionless ﬂuid. That is, we
discuss simulations including both baryons and dark matter; including neutrinos;
assuming dark matter is warm; self-interacting; made out of primordial black holes;
and cases where its quantum pressure cannot be neglected on macroscopic scales.
We also discuss simulations easing the restrictions that the gravitational law is given
by the Newtonian limit of General Relativity, and that the primordial ﬂuctuations
were Gaussian.
Section 8 This section discusses the current challenge for high accuracy in
cosmological simulations. We consider the role of the softening length, cosmic
variance, mass resolution, among others numerical parameters. We also review
comparisons of N-body codes and discuss the validity of the N-body discretization
itself.
Section 9: This section covers the connection between simulation predictions
and cosmological observations. We discuss halo ﬁnder algorithms, the building of
merger trees, and the construction of ligthcones. We also brieﬂy review halo-
occupation distribution, subhalo-abundance-matching, and semi-analytic galaxy
formation methods.
Section 10: This section provides a list of state-of-the-art large-scale numerical
simulations. We put emphasis in the computational challenge they face in
connection with current and future computational trends and observational efforts.
123
1
Page 8 of 200
R. E. Angulo, O. Hahn

In the ﬁnal section, we conclude with an outlook for the future of cosmological
dark matter simulations.
2 Gravity and dynamics of matter in an expanding Universe
Large-scale dark matter simulations are (mostly) carried out in the weak-ﬁeld, non-
relativistic, and collisionless limit of a more fundamental Einstein–Boltzmann
theory. Additionally, since these simulations neglect any microscopic interactions in
the collisionless limit right from the start (we will not consider them until we
discuss self-interacting dark matter), one operates in the Vlasov-Einstein limit. This
is essentially a continuum description of the geodesic motion of microscopic
particles since only (self-)gravity is allowed to affect their trajectories. Despite these
simpliﬁcations, this approach keeps the essential non-linearities of the system,
which gives rise to their phenomenological complexity.
In this section, we ﬁrst derive the relevant relativistic equations of motion in a
Hamiltonian formalism. We then take the non-relativistic weak-ﬁeld limit by
considering perturbations around the homogeneous and isotropic FLRW (Fried-
mann-Lemaıˆtre–Robertson–Walker) metric. This Vlasov–Poisson limit yields
ordinary non-relativistic equations of motion, with the twist of a non-standard
time-dependence due to the expansion of space in a general FLRW space time. Due
to the preservation of symplectic invariants, the expansion of space leads to an
intimately related contraction of momentum space to preserve overall phase space
volume.
With the general equations of motion at hand, we consider the cold limit (owed to
a property of cold dark matter (CDM) that is well constrained by observations)
which naturally arises since the expansion of space (or rather the compression of
momentum space) reduces any intrinsic momentum dispersion of the particle
distribution over time. In the cold limit, the distribution function of dark matter
takes a particularly simple form of a low-dimensional submanifold of phase space.
These discussions are aimed to provide a formal foundation for the equations of
motion as well as a motivation for many of the techniques and approximations
discussed and reviewed in later sections.
2.1 Equations of motion and the Vlasov equation
Since we are, due to the very weak interactions of dark matter, interested mostly in
the collisionless limit, we are essentially looking at freely moving particles in a
curved space-time. To describe the motion of these particles, it is much easier to
work with Lagrangian coordinates in phase space, i.e., the positions and momenta of
particles. In general relativity, we have in full generality an eight dimensional
relativistic extended phase space of positions xl and their conjugate momenta1 pl.
Kinetic theory in curved space time is discussed in many introductory texts on
general relativity in great detail (e.g. Ehlers 1971; Misner et al. 1973; Straumann
1 We will use greek letters for indices that run over both time (0) and space (1-3), and Latin letters when
only space is implied (1-3). The summation over repeated indices is implied unless otherwise indicated.
123
Large-scale dark matter simulations
Page 9 of 200
1

2013; Choquet-Bruhat 2015 for the curious reader), but mostly without connection
to a Hamiltonian structure. For our purposes, we can eliminate one degree of
freedom by considering massive particles and neglecting processes that alter the
mass of the particles. In that case the mass-shell condition plpl ¼ m2 ¼ const
holds2 and allows us to reduce dynamics to 3?3 dimensional phase space with one
parameter (e.g. time) that can be used to parameterise the motion. Note that we
employ throughout Einstein’s summation convention, where repeated indices are
implicitly summed over, unless explicitly stated otherwise.
Geodesic motion of massive particles In the presence of only gravitational
interactions, the motion of particles in general relativity is purely geodesic by
deﬁnition. Let us therefore begin by considering the geodesic motion of a particle
moving between two points A and B. The action for the motion along a trajectory3
(X(t), P(t)), parametrised by coordinate time t, between the spacetime points A and
B is
SðA; BÞ ¼
Z B
A
PldXl ¼
Z B
A
P0dt þ PidXi


¼
Z B
A
Pi
dXi
dt þ P0


dt:
ð1Þ
From Eq. (1), one can immediately read off that the Lagrangian L and Hamiltonian
H of geodesic motion are given by the usual Legendre transform pair (e.g. Gold-
stein et al. 2002)
L :¼ Pi
dXi
dt  H;
with
H :¼ P0;
dt :¼ dX0
ð2Þ
respectively, meaning that P0 represents the Hamiltonian itself [as one ﬁnds also
generally in extended phase space, cf. Lanczos (1986)]. It is easy to show in a few
lines of calculation that the coordinate-time canonical equations of motion in curved
spacetime are then given by two dynamical equations4 (e.g. Choquet-Bruhat 2015)
dXl
dt ¼ Pl
P0
and
dPl
dt ¼ Fl
with
Fl :¼ gab;lðXÞ PaPb
2P0 :
ð3Þ
The Christoffel symbols of the metric simplify here to this simple partial derivative
due to the mass-shell condition, but otherwise these two equations are equivalent to
the geodesic equation. Note the formal similarity of these equations compared to the
non-relativistic equations, with the ‘gravitational interaction’ absorbed into the
derivative of the metric. Eqs. (3) determine the particle motion given the metric.
The metric in turn is determined by the collection of all particles in the Universe
through Einstein’s ﬁeld equations, which we will address in the next section.
2 Note that for the speed of light we set c ¼ 1 in this section (it does not appear explicitly in the non-
relativistic end results), but we explicitly keep the gravitational constant G.
3 We will, unless indicated otherwise, use majuscule letters when describing the (time-parameterised)
position and momentum of individual particles, while we will use minuscule letters to indicate Eulerian or
general coordinates.
4 We denote partial derivatives in index notation, when it is obvious w.r.t. which coordinate one
differentiates, using a comma, i.e. f;i ¼ of=oxi.
123
1
Page 10 of 200
R. E. Angulo, O. Hahn

Statistical Mechanics When considering a large number of particles, it is
necessary to transition to a statistical description and consider the phase-space
distribution (or density) function of particles in phase-space over time, i.e. on
ðx; p; tÞ 2 R3þ3þ1,
rather
than
individual
microscopic
particle
trajectories
ðXðtÞ; PðtÞÞ. The on-shell phase space distribution function fmðx; p; tÞ can be
deﬁned e.g. through the particle number, which is a Lorentz scalar, per unit phase
space volume. This phase-space density is then related to the energy-momentum
tensor as
Tlm :¼
1ﬃﬃﬃﬃﬃﬃ
jgj
p
Z
R3 d3p fmðx; p; tÞ plpm
p0 ;
ð4Þ
where g is the determinant of the metric. For purely collisionless dynamics, the
evolution of fm is therefore determined by the on-shell Einstein–Vlasov equation
(e.g. Choquet-Bruhat 1971; Ehlers 1971)
bLm fm ¼ 0;
with
bLm :¼ o
ot þ pi
p0
o
oxi þ Fi
p0
o
opi
ð5Þ
where bLm is the on-shell Liouville operator in coordinate time. This equation relates
Hamiltonian dynamics and incompressibility in phase space: the Vlasov equation is
simply the continuum limit of Hamiltonian mechanics with only long-range grav-
itational interactions (i.e., geodesic motion). This can be seen by observing that
particle trajectories
XiðtÞ; PiðtÞ
ð
Þfollowing Eqs. (3) solve the Einstein–Vlasov
equation as characteristic curves, i.e. dfm XiðtÞ; PiðtÞ; t
ð
Þ=dt ¼ 0.
2.2 Scalar metric fluctuations and the weak field limit
Metric perturbations The ﬁnal step needed to close the equations is made through
Einstein’s ﬁeld equations Glm ¼ 8pGTlm. The ﬁeld equations connect the evolution
of the phase-space density fm, which determines the stress-energy tensor Tlm, with
the force 1-form Fi, which is determined by the metric. The results presented above
are valid non-perturbatively for an arbitrary metric. Here, we shall make a ﬁrst
approximation by considering only scalar ﬂuctuations using two scalar potentials /
and w5. This approximation is valid if velocities are non-relativistic, i.e.
Pi=P0

  1. In this case, the only dynamically relevant component of Tlm is the
time-time component. Let us thus consider the metric (which corresponds to the
‘‘Newtonian gauge’’ with conformal time), following largely the notation of Bartolo
et al. (2007),
5 In full generality, initially purely scalar ﬂuctuations in a dust ﬂuid will source vector and after shell-
crossing also tensor ﬂuctuations. They remain however small since velocities never become relativistic.
We are glancing here over various details of a rigorous Newtonian limit and refer the interested reader to
Kopp et al. (2014); Milillo et al. (2015) for a rigorous treatment.
123
Large-scale dark matter simulations
Page 11 of 200
1

ds2 ¼ a2ðsÞ  expð2wÞ ds2 þ expð2/Þ dxidxi


ð6Þ
where x are co-moving coordinates. The metric determinant is given by
ﬃﬃﬃﬃﬃﬃ
jgj
p
¼ a4 exp w  3/
ð
Þ.
The kinetic equation in GR is simply a geodesic transport equation and will thus
only depend on the gravitational ‘‘force’’ 1-form Fi, which can be readily computed
for this metric to be
Fi ¼ a2p0 exp 2w
ð
Þ w;i þ /;i

	
 m2
p0 /;i
ð7Þ
If the vector and tensor components are non-relativistic [see e.g. Kopp et al. (2014),
Milillo et al. (2015) for a rigorous derivation of the Newtonian limit], we are left
only with a constraint equation from the time-time component of the ﬁeld equations.
The time-time component of the Einstein tensor Glm is found to be
G0
0 ¼ expð2/Þ
a2
ðr/Þ2  2r2/


 3 expð2wÞ
a2
a0
a  /0

2
;
ð8Þ
where a prime indicates a derivative w.r.t. s. Inserting this in the respective ﬁeld
equation and performing the weak ﬁeld limit (i.e. keeping only terms up to linear
order in the potentials) one ﬁnds the following constraint equation
3H /0 þ Hw
ð
Þ þ r2/ þ 3
2 H2 ¼ 4pGa2q;
ð9Þ
where q :¼ T00, H :¼ a0=a, and G is Newton’s gravitational constant. Note that this
equation alone does not close the system, since we have no evolution equation for
aðsÞ yet.
Separation of background and perturbations The usual assumption is that
backreaction can be neglected, i.e. the homogeneous and isotropic FLRW case is
recovered with /; w ! 0 and density q ! qðsÞ. In this case, aðsÞ is given by the
solution of this equation in the absence of perturbations which becomes the usual
Friedmann equation
H2 ¼ 8pG
3
a2q
with
q ¼: Xra4 þ XmðaÞ þ Xma3 þ Xka2 þ XK

	
qc;0;
ð10Þ
where qc;0 :¼ 3H2
0
8pG is the critical density of the Universe today, H0 is the Hubble
constant, and the XX2fr;m;m;k;Kg are the respective density parameters of the various
species in units of this critical density (at a ¼ 1). Note that massive neutrinos XmðaÞ
have a non-trivial scaling with a (see Sect. 7.8.2 for details). In the inhomogeneous
case one can subtract out this FLRW evolution—neglecting by doing so any non-
linear coupling, or ‘backreaction’, between the evolution of a and the inhomo-
geneities—and ﬁnds ﬁnally
123
1
Page 12 of 200
R. E. Angulo, O. Hahn

3H /0 þ Hw
ð
Þ þ r2/ ¼ 4pGa2ðq  qÞ;
ð11Þ
This is an inhomogeneous diffusion equation (cf. e.g., Chisari and Zaldarriaga 2011;
Hahn and Paranjape 2016) reﬂecting the fact that the gravitational potential does not
propagate instantaneously in an expanding Universe so that super-horizon scales,
where density evolution is gauge-dependent, are screened.
2.3 Newtonian cosmological simulations
Newtonian gravity In the absence of anisotropic stress the two scalar potentials in
the metric (6) coincide and one has w ¼ /. One can further show that on sub-
horizon scales [where q must be gauge independent, see e.g. Appendix A of Hahn
and Paranjape (2016)] one then recovers from Eq. (11) the non-relativistic Poisson
equation,
r2/ ¼ 4pGa2ðq  qÞ:
ð12Þ
Note that this Poisson equation is however a priori invalid on super-horizon scales.
Formally, when carrying out the transformation that removed the extra terms from
Eq. (11), the Poisson source q has been gauge transformed to the synchronous co-
moving gauge. If a simulation is initialised with density perturbations in the syn-
chronous gauge and other quantities are interpreted in the Newtonian gauge, then
the Poisson equation consistently links the two. In addition, we have in the non-
relativistic weak ﬁeld limit that p0 ¼ a1m so that we also recover the Newtonian
force law
Fi ! am/;i :
ð13Þ
Note that such gauge mixing can be avoided and horizon-scale effects can be
rigorously accounted for by choosing a more sophisticated gauge (Fidler et al.
2016, 2017b) in which the force law is required to take the form of Eq. (13) and
coordinates and momenta are interpreted self-consistently in this ‘Newtonian
motion’ gauge to account for leading order relativistic effects. A posteriori gauge
transformations exist to relate gauge-dependent quantities, but remember that
observables can never be gauge dependent.
Non-relativistic moments For completeness and reference, we also give the
components of the energy-momentum tensor (4) as moments of the distribution
function fm in the non-relativistic limit
q :¼ T0
0 ¼ m
a3
Z
R3 d3p fmðx; p; tÞ
ð14aÞ
pi :¼ T0
i ¼ 1
a4
Z
R3 d3p fmðx; p; tÞ pi
ð14bÞ
123
Large-scale dark matter simulations
Page 13 of 200
1

Pij :¼ Tij ¼ 1
ma5
Z
R3 d3p fmðx; p; tÞ pi pj ;
ð14cÞ
deﬁning the mass density q, momentum density p and second moment Pij, which is
related to the stress tensor as Pij  pipj=q.
The equations solved by standard N-body codes. Finally, the equations of motion
in cosmic time dt ¼ a ds, assuming the weak-ﬁeld non-relativistic limit, are
dXi
dt ¼ Pi
m ¼ Pi
ma2
and
dPi
dt ¼ m o/
oXi
ð15Þ
with the associated Vlasov–Poisson system
ofm
ot þ pi
ma2
ofm
oxi  m o/
oxi
ofm
opi
¼ 0
ð16aÞ
r2/ ¼ 4pGa2ðq  qÞ
ð16bÞ
q ¼ m
a3
Z
R3 d3p fmðx; p; tÞ
ð16cÞ
where qðtÞ is the spatial mean of q that is used also in the Friedmann equation
H2 ¼ 8pG
3 a2q which determines the evolution of a(t). It is convenient to change to a
co-moving matter density a3q, eliminating several factors of a in these equations.
In particular, the Poisson equation can be written as
r2/ ¼ 3
2 H2
0Xmd=a;
ð17Þ
if
gravity
is
sourced
by
matter
perturbations
alone
so
that
qðx; tÞ ¼ ð1 þ dðx; tÞÞ Xmqc;0a3. Note that we have also introduced here the frac-
tional overdensity d :¼ q=q  1.
2.4 Post-Newtonian simulations
While traditionally all cosmological simulations were carried out in the non-
relativistic weak-ﬁeld limit, neglecting any back-reaction effects on the metric, the
validity and limits of this approach have been questioned (Ellis and Buchert 2005;
Heinesen and Buchert 2020). In addition, with upcoming surveys reaching horizon
scales, relativistic effects need to be quantiﬁed and accounted for correctly. Since
such effects are only relevant on very large scales, where perturbations are assumed
to be small, various frameworks have been devised to interpret the outcome of
Newtonian simulations in relativistic context (Chisari and Zaldarriaga 2011; Hahn
and Paranjape 2016), which suggested in particular that some care is necessary in
the choice of gauge when setting up initial conditions. Going even further, it turned
out to be possible to deﬁne speciﬁc ﬁne-tuned gauges, in which the gauge-freedom
is used to absorb relativistic corrections, so that the equations of motion are strictly
of the Newtonian form (Fidler et al. 2015; Adamek et al. 2017a; Fidler et al.
123
1
Page 14 of 200
R. E. Angulo, O. Hahn

2017a). This approach requires only a modiﬁcation of the initial conditions and a re-
interpretation of the simulation outcome. Alternatively, relativistic corrections can
also be included at the linear level by adding additional large-scale contributions
computed using linear perturbation theory to the gravitational force computed in
non-linear simulations (Brandbyge et al. 2017).
Going beyond such linear corrections, recently the ﬁrst Post-Newtonian
cosmological simulations have been carried out (Adamek et al. 2013, 2016) which
indicated however that back-reaction effects are small and likely irrelevant for the
next generation of surveys. Most recently, full GR simulations are now becoming
possible (Giblin et al. 2016; East et al. 2018; Macpherson et al. 2019; Daverio et al.
2019) and seem to conﬁrm the smallness of relativistic effects. The main advantage
of relativistic simulations is that relativistic species, such as neutrinos, can be
included self-consistently. In all cases investigated so-far, non-linear relativistic
effects have however appeared to be negligibly small on cosmological scales.
However, such simulations will be very important in the future to verify the
robustness of standard simulations regarding relativistic effects on LSS observables
(e.g. gravitational lensing, gravitational redshifts, e.g. Cai et al. 2017, or the
clustering of galaxies on the past lightcone, e.g. Breton et al. 2019; Guandalin et al.
2021; Lepori et al. 2021; Coates et al. 2021, all of which have been proposed as
tests of gravitational physics on large scales).
2.5 Cold limit: the phase-space sheet and perturbation theory
The cold limit All observational evidence points to the colder ﬂavours of dark matter
(but see Sect. 7 for an overview over various dark matter models). A key limiting
case for cosmological structure formation is therefore that of an initially perfectly
cold scalar ﬂuid (i.e. vanishing stress and vorticity). In this case, the dark matter
ﬂuid is at early enough times fully described by its density and (mean) velocity ﬁeld,
which is of potential nature. The higher order moments (14c) are then fully
determined by the lower order moments (14a–14b) and the momentum distribution
function at any given spatial point is a Dirac distribution so that fm is fully speciﬁed
by only two scalar degrees of freedom, a density nðxÞ, and a velocity potential, SðxÞ,
at some initial time, i.e.
fmðx; p; tÞ ¼ nðx; tÞ dD p  mrxSðx; tÞ
ð
Þ:
ð18Þ
Since S is differentiable, it endows phase space with a manifold structure and the
three-dimensional hypersurface of six-dimensional phase space on which f is non-
zero is called the ‘Lagrangian submanifold’. In fact, if at any time one can write
p ¼ m$S, then Hamiltonian mechanics guarantees that the Lagrangian submanifold
preserves its manifold structure, i.e. it never tears or self-intersects. It can however
fold up, i.e. lead to a multi-valued ﬁeld Sðx; tÞ, invalidating the functional form (18).
Prior to such shell-crossing events (as is the case at the starting time of numerical
simulations) this form is, however, perfectly meaningful and by taking moments of
the Vlasov equation for this distribution function, one obtains a Bernoulli–Poisson
system which truncates the inﬁnite Boltzmann hierarchy already at the ﬁrst moment,
123
Large-scale dark matter simulations
Page 15 of 200
1

leaving only two equations (Peebles 1980) in terms of the density contrast d ¼
n=n  1 and the velocity potential S,
od
ot þ a2$  ð1 þ dÞ$S
ð
Þ ¼ 0
and
oS
ot þ 1
2a2 $S
ð
Þ2þ/ ¼ 0;
ð19Þ
supplemented with Poisson’s equation (Eq. 17). Note that this form brings out also
the connection to Hamilton-Jacobi theory. After shell-crossing, this description
breaks down, and all moments in the Boltzmann hierarchy become important.
Eulerian perturbation theory For small density perturbations jdj  1, it is
possible to linearise the set of equations (19). One then obtains the ODE governing
the linear instability of density ﬂuctuations
d00 þ Hd0  3
2 H2
0Xma1d ¼ 0:
ð20Þ
The solutions can be written as dðx; sÞ ¼ DþðsÞdþðxÞ þ DðsÞdðxÞ and in KCDM
cosmologies given in closed form (Chernin et al. 2003; Demianski et al. 2005) as
DþðaÞ ¼ a 2F1
1
3 ; 1; 11
6 ; fKðaÞ


and
DðaÞ ¼
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
1 þ fKðaÞ
p
a3
2;
ð21Þ
where fK :¼ XK=ðXma3Þ, and 2F1 is Gauss’ hypergeometric function. In general
cases, especially in the presence of trans-relativistic species such as neutrinos,
Eq. (20) needs to be integrated numerically however. Moving beyond linear order,
recursion relations to all orders in perturbations of Eqs. (19) have been obtained in
the 1980s (Goroff et al. 1986) and provide the foundation of standard Eulerian
cosmological perturbation theory [SPT; cf. Bernardeau et al. (2002) for a review].
Lagrangian perturbation theory Alternatively to considering the Eulerian ﬁelds,
the dynamics can be described also through the Lagrangian map, i.e. by considering
trajectories
xðq; tÞ ¼ q þ Wðq; tÞ
starting
from
Lagrangian
coordinates
q ¼ xðq; t ¼ 0Þ. It becomes then more convenient to write the distribution
function (18) in terms of the Lagrangian map, i.e.
fmðx; p; sÞ ¼ dD x  q  Wðq; sÞ
ð
Þ dD p  maW0ðq; tÞ
ð
Þ:
ð22Þ
Mass conservation then implies that the density is given by the Jacobian J :¼
det Jij :¼ det oxi=oqj as
1 þ dðq; sÞ ¼ Jj j1:¼ det $q  x

1¼ det dij þ oWi=oqj

1;
ð23Þ
which is singular if any eigenvalue of $q  x vanishes. This is precisely the case
when shell crossing occurs. The canonical equations of motion (15) can be com-
bined into a single second order equation, which in conformal time reads
x00 þ Hx0 þ $x/ðxÞ ¼ 0;
ð24Þ
where we now consider trajectories not for single particles but for the Lagrangian
map, i.e. x ¼ xðq; tÞ. By taking its divergence, this can be rewritten as an equation
including only derivatives w.r.t. Lagrangian coordinates
123
1
Page 16 of 200
R. E. Angulo, O. Hahn

J dij þ Wi;j

	1 W00
i;j þ HW0
i;j


¼ 3
2 H2Xm J  1
ð
Þ:
ð25Þ
In Lagrangian perturbation theory (LPT), this equation is then solved perturbatively
using a truncated time-Taylor expansion of the form Wðq; sÞ ¼ P1
n¼1 DðsÞnWðnÞðqÞ
(Buchert 1989, 1994; Bouchet et al. 1995; Catelan 1995). At ﬁrst order n ¼ 1,
restricting to only the growing mode, one ﬁnds the famous Zel’dovich approxi-
mation (Zel’dovich 1970)
xðq; sÞ ¼ q þ DþðsÞ$qr2
q dþðqÞ;
ð26Þ
where dþðqÞ is, as above, the growing mode spatial ﬂuctuation part of SPT. All-
order recursion relations have also been obtained for LPT (Rampf 2012; Zhe-
ligovsky and Frisch 2014; Matsubara 2015). LPT solutions are of particular
importance for setting up initial conditions for simulations. Both SPT and LPT are
valid only prior to the ﬁrst shell-crossing since the (pressureless) Euler–Poisson
limit of Vlasov–Poisson ceases to be valid after. This can be easily seen by con-
sidering the evolution of a single-mode perturbation in the cold self-gravitating
case, as shown in Fig. 2. Prior to shell-crossing, the mean-ﬁeld velocity hviðx; tÞ
coincides with the full phase-space description pðxðq; tÞ; tÞ=m. Then the DF from
Eq. (18) guarantees that the (Euler/Bernoulli-) truncated mean ﬁeld ﬂuid equations
describe the full evolution of the system. This is no longer valid after shell-crossing,
−0.004
−0.002
0.000
0.002
0.004
v
a = 0.1
−0.1
0.0
0.1
a = 1
−1.0
−0.5
0.0
0.5
1.0
a = 10
0
2
4
6
8
1 + δ
0
2
4
6
8
0
2
4
6
8
−0.4
−0.2
0.0
0.2
0.4
x
−0.004
−0.002
0.000
0.002
0.004
⟨v⟩
−0.4
−0.2
0.0
0.2
0.4
x
−0.1
0.0
0.1
−0.4
−0.2
0.0
0.2
0.4
x
−1.0
−0.5
0.0
0.5
1.0
∂x
∂q, ∂v
∂q
∂x
∂q = 0
Fig. 2 Evolution of a single-mode perturbation from early times (a ¼ 0:1, left panels), through shell-
crossing (at a ¼ 1, middle panels), to late times (a ¼ 10, right panels). The top row shows the phase
space, where the cold distribution function occupies only a one-dimensional line. Density is shown in the
middle row, with singularities of formally inﬁnite density appearing at and after the ﬁrst shell-crossing.
The bottom panels show the mean ﬂuid velocity (hvi ¼ p=q, Eq. 14b), which is identical to the phase-
space diagram up to the ﬁrst shell-crossing, but develops a complicated structure with discontinuities in
the multi-stream region (indicated by green shading). Since the distribution function has a manifold
structure, its tangent space (indicated in orange) can be evolved in a ‘‘geodesic deviation’’ equation, or it
can be approximated by tessellations. Caustics appear where ox=oq ¼ 0. N-body simulation do not track
this manifold structure, and sample only the distribution function
123
Large-scale dark matter simulations
Page 17 of 200
1

accompanied by inﬁnite densities where det oxi=oqj ¼ 0, when the velocity becomes
multi-valued. Nevertheless, LPT provides an accurate bridge between the early
Universe and that at the starting redshift of cosmological simulations, which can
then be evolved further deep into the nonlinear regime. This procedure will be
discussed in detail in Sect. 6.
Heuristic models based on PT Additionally, perturbation theory has been used as
the backbone for approximate, but computationally extremely fast, descriptions of
the nonlinear structure [see Monaco (2016) or a review and Chuang et al. (2015b)
for a comparison of approaches]. These methods overcome the shell-crossing
limitation of perturbation theory in different ways. The introduction of a viscuous
term in the adhesion model (Gurbatov et al. 1985; Kofman and Shandarin 1988;
Kofman et al. 1992) prevents the crossing of particle trajectories. In an alternative
approach, Kitaura and Hess (2013) replaced the LPT displacement ﬁeld on small-
scales by values motivated from spherical collapse (Bernardeau 1994; Mohayaee
et al. 2006). A similar idea is implemented in MUSCLE (Neyrinck 2016; Tosone et al.
2021). Numerous models have been developed based on an extension of the
predictions of LPT via various small-scale models that aim to capture the collapse
into halos or implement empirical corrections: PATCHY (Kitaura et al. 2014),
PTHALOS (Scoccimarro and Sheth 2002; Manera et al. 2013), EZHALOS (Chuang
et al. 2015a), HALOGEN (Avila et al. 2015). Finally, PINOCCHIO (Monaco et al.
2002, 2013) and WEBSKY (Stein et al. 2020) both combine LPT displacements with
an ellipsoidal collapse model and excursion set theory to predict the abundance,
mass accretion history, and spatial distribution of halos. The low computational cost
of these approaches makes them useful for the creation of large ensembles of
‘‘simulations’’ designed at constructing covariance matrices for large-scale structure
observations, or for a direct modelling of the position and redshift of galaxies.
However, due to their heuristic character, their predictions need to be constantly
quantiﬁed and validated with full N-body simulations.
2.6 Deformation and evolution in phase space
The canonical equations of motion describe the motion of points in phase space over
time. Moving further, it is also interesting to consider the evolution of an
inﬁnitesimal phase space volume, spanned by ðdx; dpÞ, which is captured by the
‘‘geodesic deviation equation’’.
As we have just discussed, in the cold case, the continuum limit leads to all mass
occupying a thin phase sheet in phase space and one can think of the evolution of
the system as the mapping q7!ðx; pÞ between Lagrangian and Eulerian space (cf.
Fig. 2). One can take the analysis of deformations of pieces of phase space one level
further beyond the cold case by considering a general mapping of phase space onto
itself, i.e. ðq; wÞ7!ðx; pÞ (but note that this deﬁnition is formally not valid as a ! 0
since in the canonical cosmological case the momentum space blows up in this
limit). The associated phase-space Jacobian matrix D, which reﬂects the effect in
Eulerian space of inﬁnitesimal changes to the Lagrangian coordinates, is
123
1
Page 18 of 200
R. E. Angulo, O. Hahn

D :¼ oðx; pÞ
oðq; wÞ ¼
ox
oq
ox
ow
op
oq
op
ow
2
664
3
775 ¼:
Dxq
Dxw
Dpq
Dpw


;
ð27Þ
where in the last equality, we have split the 6D tensor into four blocks. Its dynamics
are fully determined by the canonical equations of motion, which we can obtain
after a few steps as (Habib and Ryne 1995; Vogelsberger et al. 2008).
_D ¼ oð _x; _pÞ
oðq; wÞ ¼
$x  $p
$p  $p
$x  $x
$p  $x


H


 D ¼: H  D:
ð28Þ
This is equation is called the ‘‘geodesic deviation equation’’ (GDE) in the literature
and it quantiﬁes the relative motion in phase space along the Hamiltonian ﬂow. For
separable Hamiltonians H ¼ Tðp; tÞ þ Vðx; tÞ, the coupling matrix H becomes
H ¼
0
ð$p  $pÞT
ð$x  $xÞV
0


;
and in cosmic time:
H ¼
0
1
ma2 dij
m/;ij
0
2
4
3
5;
ð29Þ
and shows a coupling to the gravitational tidal tensor (Vogelsberger et al. 2008;
Vogelsberger and White 2011). The evolution of D can be used to track the evo-
lution of an inﬁnitesimal environment in phase space around a trajectory
Δx
Δp
(a)
(b)
(c)
(d)
(x, p)i
(x, p)i+1
(x, p,
,
)i
≈xi+1 −xi
qi+1 −qi
Fig. 3 Discretisations used in the numerical solution of Vlasov–Poisson: a the N-body method which
samples the ﬁne grained distribution function (light gray line) at discrete locations, b the ‘GDE’ method
that can evolve the local manifold structure along with the particles (the green eigenvectors of Dxq are
tangential to the Lagrangian submanifold, c the sheet tessellation method, which uses interpolation (here
linear) between particles to approximate the Lagrangian submanifold with a tessellation, d a ﬁnite volume
discretisation of the full phase space with uniform resolution Dx in conﬁguration space and Dp in
momentum space
123
Large-scale dark matter simulations
Page 19 of 200
1

ðxðq; w; tÞ; pðq; w; tÞÞ. In particular, from Eq. (23) follows that zero-crossings of
the determinant of the Dxq block correspond to inﬁnite-density caustics, so that it
can be used to estimate the local (single) stream density, and count the number of
caustic crossings. Inﬁnite density caustics would cause singular behaviour in the
evolution of D, so that its numerical evolution has to be carried out with sufﬁcient
softening (Vogelsberger and White 2011; Stu¨cker et al. 2020). Since it is sensitive
to caustic crossings, the GDE can be used to quantify the distinct components of the
cosmic web (Stu¨cker et al. 2020, see also Sect. 9.5). The GDE has an intimate
connection also to studies of the emergence of chaos in gravitationally collapsed
structures since it quantiﬁes the divergence of orbits in phase space and has an
intimate connection to Lyapunov exponents (Habib and Ryne 1995). An open
problem is how rapidly a collapsed system achieves efﬁcient phase space mixing
since discreteness noise in N-body simulations could be dominant in driving phase
space diffusion if not properly controlled (Stu¨cker et al. 2020; Colombi 2021).
3 Discretization techniques for Vlasov–Poisson systems
The macroscopic collisionless evolution of non-relativistic self-gravitating classical
matter in an expanding universe is governed by the cosmological Vlasov–Poisson
(VP) set of Eqs. (16a–16b) derived above. VP describes the evolution of the density
fðx; p; tÞ in six-dimensional phase space over time. Due to the non-linear character
of the equations and the attractive (focusing) nature of the gravitational interaction,
intricate small-scale structures (ﬁlamentation) emerge in phase space already in 1?1
dimensions as shown in Fig. 2, and chaotic dynamics can arise in higher
dimensional phase space. Various numerical methods to solve VP dynamics have
been devised, with intimate connections also to related techniques in plasma
physics. The N-body approach is clearly the most prominent and important
technique to-day, however, other techniques have been developed to overcome its
shortcomings in certain regimes and to test the validity of results. A visual
representation of the various approaches to discretise either phase space or the
distribution function is shown in Fig. 3.
3.1 The N-body technique
The most commonly used discretisation technique for dark matter simulations is the
N-body method, which has been used since the 1960s as a numerical tool to study
the Hamiltonian dynamics of gravitationally bound systems such as star and galaxy
clusters (von Hoerner 1960; Aarseth 1963; He´non 1964) by Monte-Carlo sampling
the phase space of the system. They started being used to study cosmological
structure formation beginning in the early 1970s (Peebles 1971; Press and Schechter
1974; Miyoshi and Kihara 1975), followed by an explosion of the ﬁeld in the ﬁrst
half of the 1980s (Doroshkevich et al. 1980; Klypin and Shandarin 1983; White
et al. 1983; Centrella and Melott 1983; Shapiro et al. 1983; Miller 1983). These
works demonstrated the web-like structure of the distribution of matter in the
Universe and established that cold dark matter (rather than massive neutrinos) likely
123
1
Page 20 of 200
R. E. Angulo, O. Hahn

provides the ‘‘missing’’ (dark) matter. By the late 1990s, the resolution and dynamic
range had increased sufﬁciently so that it became possible to study the inner
structure of dark matter haloes, leading to the discovery of universal halo proﬁles
(Navarro et al. 1997), the large abundance of substructure in CDM subhaloes
(Moore et al. 1999; Klypin et al. 1999b), and predictions of the mass function of
collapsed structures in the Universe over a large range of masses and cosmic time
(Jenkins et al. 2001). The N-body method is now being used in virtually all large
state-of-the-art cosmological simulations as the method of choice to simulate the
gravitational collapse of cold collisionless matter (cf. Sect. 10 for a review of state-
of-the-art simulations). In ‘‘total matter’’ (often somewhat falsely called ‘‘dark
matter only’’) simulations, the N-body mass distribution serves as a proxy of the
potential landscape in which galaxy formation takes place. And also in multi-
physics simulations that simulate the distinct evolution of dark matter and baryons
(see also Sect. 7.8.1), collisionless dark matter is solved via the N-body method,
while a larger diversity of methods are employed to evolve the collisional baryonic
component (see e.g. Vogelsberger et al. 2020, for a review).
The N-body discretisation Underlying all these simulations is the fundamental N-
body idea: the Vlasov equation is the continuum version of the Hamiltonian
equations of motion, which implies that phase-space density is conserved along
Hamiltonian trajectories. The non-linear coupling in Hamilton’s equations arises
through the coupling of particles with gravity via Poisson’s equation, which is only
sourced by the density ﬁeld. Therefore, as long as a ﬁnite number of N particles is
able to fairly sample the density ﬁeld, the evolution of the system can be
approximated by these discrete trajectories.
A practical complication is that the (formally) inﬁnitely extended mass
distribution has to be taken into account. Most commonly, this complication is
solved by restricting the simulation to a ﬁnite cubical volume V ¼ L3 of co-moving
linear extent L with periodic boundary conditions. This can formally be written as
considering inﬁnite copies of this fundamental cubical box. The effective N-body
distribution function is then given by a set of discrete macroscopic particle locations
and momenta
XiðtÞ; PiðtÞ
ð
Þ; i ¼ 1. . .N
f
g along with the inﬁnite set of periodic
copies, so that
fNðx; p; tÞ ¼
X
n2Z3
X
N
i¼1
Mi
m dDðx  XiðtÞ  nLÞ dDðp  PiðtÞÞ;
ð30Þ
is an unbiased sampling of the true distribution function. Here Mi is the effective
particle mass assigned to an N-body particle, m the actual microscopic particle
mass, and XiðtÞ and PiðtÞ are the position and momentum of particle i at time t. The
most widespread choice of discretisation is one in which all particles are assumed to
have equal mass, Mi ¼ M ¼ Xmqc;0V=N. Note, however, that using different masses
is also possible and sometimes desirable (e.g., for multi-resolution simulations, see
Sect. 6.3.4).
Initial conditions Since the particles are to sample the full six-dimensional
distribution function, a key question is how the initial positions Xiðt0Þ and momenta
123
Large-scale dark matter simulations
Page 21 of 200
1

Piðt0Þ should be chosen. For cold systems, we have derived a consistent approach
above and it is given by Eq. (18) which can be readily evaluated from a discrete
sampling of the Lagrangian manifold alone, i.e. by choosing an (ideally
homogeneous and isotropic) uniform sampling in terms of Lagrangian coordinates
Qi for each N-body particle (discussed in more detail in Sect. 6.4) and then
obtaining the Eulerian position Xi and momentum Pi at some initial time t0 from the
Lagrangian map WðQi; t0Þ (see Sect. 6.2 for more details). This means that, in the
case of a cold ﬂuid, the particles sample the mean ﬂow velocity exactly. The
situation is considerably more involved if the system has a ﬁnite temperature which
requires to sample not only the three-dimensional Lagrangian submanifold but the
full six-dimensional phase space density. This implies that in some sense each
particle in the cold case needs to be sub-divided into many particles that sample the
momentum part of the distribution function. Particularly for hot distribution
functions, where the momentum spread is large compared to mean momenta arising
from gravitational instability (such as in the case of neutrinos), this has caused a
formidable challenge due to the large associated sampling noise. To circumvent
these problems various solutions have been proposed, e.g. using a careful sampling
of momentum space using shells in momentum modulus and an angle sampling
based on the healpix sphere decomposition (Banerjee et al. 2018), or reduced
variance sampling based on the control variates method (Elbers et al. 2021). Such
avenues are discussed in more detail in the context of massive neutrino simulations
in Sect. 7.8.2 below.
Equations of motion Once the initial particle sampling has been determined, the
subsequent evolution is fully governed by VP dynamics. Moving along character-
istics of the VP system, the canonical equations of motion for particle i ¼ 1. . .N in
cosmic time are obtained from dfðXiðtÞ; PiðtÞ; tÞ=dt ¼ 0 as
_Xi ¼
Pi
Mia2
and
_Pi ¼ Mi$x/jXi:
ð31Þ
These are consistent with a cosmic-time Hamiltonian system with a pair interaction
potential Iðx; x0Þ of the form
H ¼
X
N
i¼1
P2
i
2Mia2 þ 1
2 Mi
X
j6¼i
IðXi; XjÞ
"
#
ð32aÞ
where
X
j6¼i
IðXi; XjÞ ¼ /ðXiÞ
with
r2
x/ ¼ 3H2
0Xm
2a
q
q  1


:
ð32bÞ
The resulting acceleration term is given by
gðxÞ :¼ $x/jx¼ G
a
Z
R3 d3x0 qðx0; tÞ
x0  x
x0  x
k
k3 ;
ð33Þ
which has no contribution from the background q for symmetry reasons (Peebles
1980). The co-moving conﬁguration space density q that provides the Poisson
source arises from Eq. (30) and is given by
123
1
Page 22 of 200
R. E. Angulo, O. Hahn

qðx; tÞ ¼
Z
R3 d3p
Z
R3 d3x0 m fNðx0; p; tÞ Wðx0  xÞ
¼
X
n2Z3
X
N
i¼1
Mi W x  XiðtÞ  nL
ð
Þ:
ð34Þ
Here, we additionally allowed for a regularisation kernel WðrÞ that is convolved
with the discrete N-body density in order to improve the regularity of the density
ﬁeld and speed up convergence to the collisionless limit (or so one hopes). It
represents a softening kernel (also called ‘assignment function’ depending on
context) that regularises gravity and accounts for the fact that each particle is not a
point-mass (like a star or black hole), but corresponds to an extended piece of phase
space so that two-body scattering between the effective particles is always artiﬁcial
and must be suppressed. We discuss how the acceleration obtained from this inﬁnite
sum is solved in practice in Sect. 5.
Discreteness effects The quality of the force calculation rests on how good an
approximation the force associated with the density from Eq. (34) is. The hope is
that by appropriate choice of W and an as large as possible number N of particles,
the evolution remains close to the true collisionless dynamics and microscopic
collisions remain subdominant. Due to the discrete nature of the particles, problems
of the N-body approach are known to arise when force and mass resolution are not
matched in which case the evolution of the discrete system can deviate strongly
from that of the continuous limit (Centrella and Melott 1983; Centrella et al. 1988;
Peebles et al. 1989; Melott and Shandarin 1989; Diemand et al. 2004b; Melott et al.
1997; Splinter et al. 1998; Wang and White 2007; Melott 2007; Melott and
Shandarin 1989; Marcos 2008; Bagla and Khandai 2009). A slow convergence to
the correct physical solution can, however, usually be achieved by keeping the
softening so large that individual particles are never resolved. At the same time, if
the force resolution in CDM simulations is not high enough at late times, then sub-
haloes are comparatively loosely bound and prone to premature tidal disruption,
leading to the ‘overmerging’ effect and the resulting orphaned galaxies (i.e., if the
subhalo hosted a galaxy, it would still be a distinct system rather than having
merged with the host), e.g. Klypin et al. (1999a), Diemand et al. (2004a), van den
Bosch et al. (2018). In this case, one would want to choose the softening as small as
possible. We discuss this in more detail in Sect. 8.2.
More sophisticated choices of W beyond a global (possibly time-dependent)
softening scale are possible, for instance, the scale can depend on properties of
particles, such as the local density (leading to what is called ‘‘adaptive softening’’).
We discuss the aspect of force regularisation by softening in more detail in
Sect. 8.2. The gravitational acceleration that follows from Eq. (34) naturally has to
take into account the cosmological Poisson equation, i.e., include the subtraction of
the mean density and assume periodic boundary conditions. All aspects related to
the time integration of cosmological Hamiltonians will be discussed in Sect. 4,
those related to computing and evaluating gravitational interactions efﬁciently in
Sect. 5 below.
123
Large-scale dark matter simulations
Page 23 of 200
1

3.2 Phase space deformation tracking and Lagrangian submanifold
approximations
For large enough N, the N-body method is expected to converge to the collisionless
limit. Nonetheless, an obvious limitation of this approach is that the underlying
manifold structure is entirely lost as the particles retain only knowledge of positions
and momenta and all other quantities (e.g. density, as well as other mean ﬁeld
properties) can only be recovered by coarse-graining a larger number of particles.
Two different classes of methods, that we shall discuss next, have been developed
over recent years that overcome this key limitation in various ways. The ﬁrst class is
based on promoting particles (which are essentially vectors) to tensors and re-write
the canonical equations of motion to evolve them accordingly, resulting in equations
of motion reminiscent of the geodesic deviation equation (GDE) in general
relativity. The second class retains the particles but promotes them to vertices of a
tessellation whose cells provide a discretisation of the manifold.
(a)
(c)
(d)
(b)
Fig. 4
a, b The density ﬁeld obtained from the same set of N-body particles as a simple particle N-body
density in (a) and in terms of a phase space sheet interpolation in terms of tetrahedral cells in (b). c, d The
GDE method and the sheet tessellation method provide direct access to the stream density, which is
shown in Lagrangian q-space for c the GDE approach and d the sheet tessellation approach Images
reproduced with permission [a-b] from Abel et al. (2012) and (c, d) from Stu¨cker et al. (2020), copyright
by the authors
123
1
Page 24 of 200
R. E. Angulo, O. Hahn

3.2.1 Tracking deformation in phase space—the GDE approach
We already discussed in Sect. 2.6 how inﬁnitesimal volume elements of phase space
evolve under a Hamiltonian ﬂow. In particular, Eq. (28) is the canonical equation of
motion for the phase-space Jacobian matrix. In the ‘GDE’ approach, instead of
evolving only the vector ðXi; PiÞ for each N-body particle, one evolves in addition
the tensor Di for each particle [cf. Vogelsberger et al. (2008), White and
Vogelsberger (2009), but see also Habib and Ryne (1995) who derive a method
to compute Lyapunov exponents based on the same equations]. Of particular interest
is the Dxq sub-block of the Jacobian matrix since it directly tracks the local (stream)
density associated with each N-body particle through di þ 1 ¼ det Dxq;i

	1. The
equations of motion for the relevant tensors associated to particle i are
_Dxq;i ¼
1
ma2 Dpq;i
ð35aÞ
_Dpq;i ¼ m Dxq;i  TjXi
where
T :¼ rx  rx/;
ð35bÞ
and are solved alongside the N-body equations of motion (31) by computing the
tidal tensor T. One caveat with the GDE approach is that the evolution of Dxq is
determined not by the force but by the tidal ﬁeld—which contains one higher spatial
derivative of the potential than the force—and therefore is signiﬁcantly less regular
than the force ﬁeld (see the detailed discussion and analysis in Stu¨cker et al. (2021c)
who have also studied the stream density evolution in virialised halos, based on a
novel low-noise force calculation). This approach thus requires larger softening to
achieve converged answers than a usual N-body simulation, and possibly cannot be
shown to converge in the limit of inﬁnite density caustics.
Evolving Dxq provides additional information about cosmic structure that is not
accessible by standard N-body simulations. For instance, solving for the GDE
enabled (Vogelsberger et al. 2008; Vogelsberger and White 2011) to estimate the
number of caustics in dark matter haloes, which might add a boost to the self-
annihilation rate of CDM particles, or the amount of chaos and mixing in haloes. A
key result of Vogelsberger and White (2011) was that despite the large over-
densities reached in collapsed structures, each particle is nonetheless inside of a
stream with a density not too different from the cosmic mean density. This is
possible since haloes are built like paˆte feuillete´e as a layered structure of many
stretched and folded streams, as can be seen in panel a) of Fig. 5.
3.2.2 The dark matter sheet and phase space interpolation
A different idea to reconstruct the Lagrangian submanifold from existing N-body
simulations was proposed by Abel et al. (2012) and Shandarin et al. (2012) who
noted that a tessellation of Lagrangian space, constructed by using the initial
positions of the N-body particles at very early times as vertices (i.e., the particles
generate a simplicial complex on the Lagrangian submanifold), is topologically
preserved in Hamiltonian evolution. This means that initially neighbouring particles
123
Large-scale dark matter simulations
Page 25 of 200
1

can be connected up as non-overlapping tetrahedra (in the case of a 3D submanifold
of 6D phase space). Their deformation and change of position and volume reﬂect
the evolution of the phase-space distribution (and thus changes in the density ﬁeld).
A visual impression of the difference between an N-body density and this
tessellation based density is given in Fig. 4. No holes can appear through
Hamiltonian dynamics, but since the divergence of initially neighbouring points
depends on the speciﬁc dynamics (notably the Lyapunov exponents that described
the divergence of such trajectories), the edge connecting two vertices can become a
tangled curve due to the complex dynamics in bound systems, e.g., Laskar (1993),
Habib and Ryne (1995). As long as the tetrahedra edges still approximate well the
submanifold, the simplicial complex provides access to a vast amount of
information about the distribution of matter in phase space in an evolved system
that is difﬁcult or even impossible to reconstruct from N-body simulations. Most
notably, it yields an estimate of density that is local but deﬁned everywhere in
space, shot-noise free, and produces sharply delineated caustics of dark matter after
shell-crossing (Abel et al. 2012), leading also to new rendering techniques for 3D
visualisation of the cosmic density ﬁeld (Ka¨hler et al. 2012; Igouchkine et al. 2016;
Kaehler 2017), and very accurate estimators of the cosmic velocity ﬁeld (Hahn et al.
2015; Buehlmann and Hahn 2019).
Since the density is well deﬁned everywhere in space just from the vertices, and
reﬂects well the anisotropic motions in gravitational collapse, Hahn et al. (2013)
have proposed that this density ﬁeld can be used as the source density ﬁeld when
solving Poisson’s equation as part of the dynamical evolution of the system. The
x / arb. units
sheet tessellation
N-body
(a)
(b)
Fig. 5 Comparison of evolved structures from N-body simulations with other discretisation approaches.
a Comparison of a 1?1 dimensional phase space cut from simulations of a three-dimensional collapse of
a CDM halo using a sheet tessellation with reﬁnement (top, cf. Sousbie and Colombi 2016), and a
reference N-body particle mesh simulation (bottom). The panels show an inﬁnitely thin slice in the sheet
case, and a ﬁnitely thin projection in the N-body case. b Simulations of collapse in 1?1D phase space
with a particle mesh N-body method, the integer lattice method proposed by Mocz and Succi (2017), as
well as two ﬁnite volume approaches, one where slabs in velocity space are allowed to continuously move
against each other (‘moving mesh’). Images repsroduced with permission from [a] Colombi (2021),
copyright by the author; and [b] from Mocz and Succi (2017)
123
1
Page 26 of 200
R. E. Angulo, O. Hahn

resulting method, where few N-body particles deﬁne the simplicial complex that
together determine the density ﬁeld, solves the artiﬁcial fragmentation problem of
the N-body method for WDM initial conditions (Hahn et al. 2013). The complex
dynamics in late stages of collapse, however, limits the applicability of a method
with a ﬁxed number of vertices. This problem was later solved by allowing for
higher order reconstructions of the Lagrangian manifold from N-body particles—
corresponding in some sense to non-constant-metric ﬁnite elements in Lagrangian
space—, and dynamical reﬁnement (Hahn and Angulo 2016; Sousbie and Colombi
2016). For systems that exhibit strong mixing (phase or even chaotic, such as dark
matter haloes), following the increasingly complex dynamics by inserting new
vertices becomes quickly prohibitive (e.g., Sousbie and Colombi 2016; Colombi
2021 report an extremely rapid growth of vertices over time in a cosmological
simulation with only moderate force resolution). Stu¨cker et al. (2020) have carried
out a comparison of the density estimated from phase space interpolation and that
obtained from the GDE and found excellent agreement between the two except in
the center of halos. The comparison between the two density estimates, shown in
Lagrangian space, is reproduced in the bottom panels of Fig. 4.
The path forward in this direction lies likely in the use of hybrid N-body/sheet
methods that exploit the best of both worlds as proposed by Stu¨cker et al. (2020).
Panel a) of Fig. 5 shows a 1?1D cut through 3?3D phase space for the case of a
CDM halo comparing the result of a sheet-based simulation, where the cut results in
a ﬁnite number continuous lines (top) and the equivalent results for a thin slice from
an N-body simulation. The general impact of spurious phase space diffusion driven
by the N-body method is still not very well understood with detailed comparison
between various solvers under way (e.g., Halle et al. 2019; Stu¨cker et al. 2020;
Colombi 2021).
For hot distribution functions, such as e.g. neutrinos, the phase space distribution
of matter is not fully described by the Lagrangian submanifold. While a 6D
tessellation is feasible in principle, it has undesirable properties due to the inherent
shearing along the momentum dimensions. However, Lagrangian submanifolds can
still be singled out to provide a foliation of general six-dimensional phase space by
selecting multiple Lagrangian submanifolds that are offset from each other initially
by constant momentum vectors as proposed by Dupuy and Bernardeau (2014),
Kates-Harbeck et al. (2016).
Another version of phase space interpolation has been discussed in the context of
collisionless dynamics by Colombi and Touma (2008, 2014), the so-called
‘waterbag’ method, which allows for general non-cold initial data but is restricted
to 1?1 dimensional phase space. In this approach one exploits that the value of the
distribution function is conserved along characteristics. If one now traces out
isodensity countours of f in phase space, one ﬁnds a sequence of n (closed) lines
deﬁning the level set ðx; pÞ j fðx; p; t0Þ ¼ fi
f
g of 1?1D phase space with i ¼ 1. . .n at
the initial time t0. In 1?1D, these are closed curves. The curves can then be
approximated using a number of vertices and interpolation between them. Moving
the vertices along characteristics then guarantees that they remain part of the level
set at all times as phase space density is conserved along characteristics. The
number of vertices can be adaptively increased in order to maintain a high quality
123
Large-scale dark matter simulations
Page 27 of 200
1

representation of the set contour interpolation at all times. The acceleration of the
vertices can be conveniently deﬁned in terms of integrals over the contours (cf.
Colombi and Touma 2014).
3.3 Full phase-space techniques
Almost as old as the N-body approach to solve gravitational Vlasov–Poisson
dynamics are approaches to directly solve the continuous problem for an
incompressible ﬂuid in phase space (cf. Fujiwara 1981 for 1?1 dimensions). By
discretising phase space into cells of ﬁnite size in conﬁguration and momentum
space (Dx and Dp respectively) standard ﬁnite volume, ﬁnite difference methods or
semi-Lagrangian techniques for incompressible ﬂow can be employed. The main
disadvantage of this approach is that memory requirements can be prohibitive since,
without adaptive techniques or additional sophistications, the memory needed to
evolve a three-dimensional system scales as OðN3
x  N3
pÞ to achieve a linear
resolution of Nx cells per conﬁguration space dimension and Np cells per momentum
space dimension. Only rather recently this has become possible at all as
demonstrated for gravitational interactions by Yoshikawa et al. (2013) and Tanaka
et al. (2017). The limited resolution that can be afforded in 3?3 dimensions leads to
non-negligible diffusion errors even with high order methods, so that this direct
approach is arguably best suited for hot mildly non-linear systems such as e.g.
neutrinos (Yoshikawa et al. 2020, 2021), as the resolution required for colder
systems is prohibitive. As a way to reduce such errors, Colombi and Alard (2017)
proposed a semi-Lagrangian ‘metric’ method that uses a generalisation of the
‘GDE’ deformation discussed above to improve the interpolation step and reduce
the diffusion error in such schemes.
As another way to overcome the diffusion problem, integer lattice techniques
have been discussed (cf. Earn and Tremaine 1992), which exploit that if the time
step is matched to the phase-space discretisation, i.e., Dt ¼ mðDx=DpÞ, then the
conﬁguration space advection is exact and a reversible Hamiltonian system can be
obtained for the lattice model discretisation. While this approach does not overcome
the OðN6Þ memory scaling problem of a full phase-space discretisation technique,
recently Mocz et al. (2017) have proposed important optimisations that might allow
 OðN4Þ scaling by overcomputing, but that, to our knowledge, have not been
demonstrated yet in 3?3 dimensional simulations. Results obained by Mocz et al.
(2017) comparing the various techniques are shown in Fig. 5.
3.4 Schro¨dinger–Poisson as a discretisation of Vlasov–Poisson
An entirely different approach to discretise the Vlasov–Poisson system by
exploiting the quantum-classical correspondence has been proposed by Widrow
and Kaiser (1993) in the 1990s. Hereby one exploits that full information about the
123
1
Page 28 of 200
R. E. Angulo, O. Hahn

system, such as density, velocity, etc., can be recovered from the (complex) wave
function, and phase space is discretised by a (here tuneable, not physical)
quantisation scale h ¼ 2DxDp. Since the Schro¨dinger–Poisson system converges in
the limit of h ! 0 to Vlasov–Poisson (Zhang et al. 2002), it can be used as a UV
modiﬁed analogue model also for classical dynamics if one restricts attention (i.e.
smoothes) on scales larger than h. It is important to note that the phase of the wave
function is intimately related to the Lagrangian submanifold—both are given by a
single scalar degree of freedom. For this reason, the Schro¨dinger–Poisson analogue
has the advantage that it provides a full phase space theory with only a three-
dimensional ﬁeld (the wave function) that needs to be evolved. Following the ﬁrst
implementation by Widrow and Kaiser (1993), this model has found renewed
interest recently (Uhlemann et al. 2014; Schaller et al. 2014; Kopp et al. 2017;
Eberhardt et al. 2020; Garny et al. 2020). It is important to note that the underlying
equations are identical to those of ‘fuzzy dark matter’ (FDM) models of ultralight
axion-like particles, which we discuss in more detail in Sect. 7.4, in the absence of a
self-interaction term. In the case of FDM, the quantum scale h=mFDM is set by the
mass mFDM of the microscopic particle and is (likely) not a numerical discretisation
scale dictated by ﬁnite memory.
4 Time evolution
As we have shown above, large-scale dark matter simulations have an underlying
Hamiltonian structure, usually with a time-dependent Hamiltonian. Mathematically,
such Hamiltonian systems have a very rigid underlying structure, where the phase-
space area spanned by canonically conjugate coordinates and momenta is conserved
over time. Consequentially, speciﬁc techniques for the integration of Hamiltonian
dynamical systems exist that preserve such underlying structure even in a numerical
setting. For this reason, this section focuses almost exclusively on integration
techniques for Hamiltonian systems as they arise in the context of cosmological
simulations.
4.1 Symplectic integration of cosmological Hamiltonian dynamics
In the cosmological N-body problem, Hamiltonians arising in the Newtonian limit
are typically of the non-autonomous but separable type, i.e. can be written
H ¼ aðtÞ TðP1; . . .; PNÞ þ bðtÞ VðX1; . . .; XNÞ;
ð36Þ
where Xi and Pi are canonically conjugate, and aðtÞ and bðtÞ are time-dependent
functions that absorb all explicit time dependence (i.e. all factors of ‘a’ are pulled
out of the Poisson equation for V). In cosmic time t one has a ¼ aðtÞ2 and
b ¼ aðtÞ1, which is not a clever choice of time coordinate since then the time
dependence appears in both terms which complicates higher order symplectic
integration schemes as we discuss below. The unique best choice is to not forget the
relativistic origin of this Hamiltonian and consider time as a coordinate in extended
123
Large-scale dark matter simulations
Page 29 of 200
1

phase space (cf. Lanczos 1986), using a parametric time ~t with d~t ¼ a2dt so that
a ¼ 1 and b ¼ aðtÞ. This coincides with the ‘‘super-conformal time’’ ﬁrst introduced
by Doroshkevich et al. (1973) and extensively discussed by Martel and Shapiro
(1998) under the name ‘‘super-comoving’’ coordinates.
Grouping coordinates and momenta together as nj :¼ ðX; PÞj and remembering
that the equations of motion can be written in terms of Poisson brackets6 as _Pj ¼
Pj; H


and _Xj ¼
Xj; H


, one can write the canonical equations as a ﬁrst order
operator equation
_nj ¼ ^
HðtÞ nj
with
^
HðtÞ :¼ ; HðtÞ
f
g ¼ ; aT
f
g þ ; bV
f
g ¼: ^
DðtÞ þ ^
KðtÞ;
ð37Þ
which deﬁnes the drift and kick operators ^
D and ^
K, respectively. This ﬁrst order
operator equation has the formal solution
njðtÞ ¼ T exp
Z t
0
dt0 ^
Hðt0Þ


njð0Þ;
ð38Þ
where Dyson’s time-ordering operator T is needed because the operator ^
H is time-
dependent. Upon noticing that the kick acts only on the momenta and it depends
only on V (and therefore on the positions), and that the drift acts only on the
positions and depends only on the momenta, one can seek for time-explicit operator
factorisations that split the coordinate and momentum updates in the form
T exp
Z tþ
t
dt0 ^
Hðt0Þ


’ exp n ^
K


   exp 3 ^
D


exp 2 ^
K


exp 1 ^
D


þ OðmÞ:
ð39Þ
with appropriately chosen coefﬁcients j that in general depend on (multiple) time
integrals of a and b (Magnus 1954; Oteo and Ros 1991; Blanes et al. 2009). This is
a higher-order generalisation of the Baker–Campbell–Hausdorff (BCH) expansion
in the case that a and b are constants (Yoshida 1990). The cancellation of com-
mutators in the BCH expansion by tuning of the coefﬁcients j determines the order
of the error exponent m on the right hand side of Eq. (39). It is important to note that
if both a and b are time-dependent then the generalised BCH expansion contains
unequal-time commutators and the error is typically at best Oð3Þ. It is therefore
much simpler to consider only the integration in extended phase space in super-
conformal time, in which no unequal-time commutators appear and standard higher
order BCH expansion formulae can be used. While some N-body codes (e.g.,
RAMSES, Teyssier 2002) use super-conformal time, one ﬁnds numerous other choices
of integration time for second order accurate integrators in the literature (e.g., Quinn
6 The Poisson bracket ; 
f
g is deﬁned for canonically conjugate coordinates ðXi; PiÞi¼1;...;N and any two
(possibly time-dependent) functions A and B of these coordinates as
A; B
f
g ¼ PN
i¼1
oA
oXi  oB
oPi  oA
oPi  oB
oXi


.
In particular, one ﬁnds the properties
A; B
f
g ¼  B; A
f
g and dA
dt ¼ oA
ot þ A; H
f
g (e.g. Goldstein et al.
2002).
123
1
Page 30 of 200
R. E. Angulo, O. Hahn

et al. 1997; Springel 2005). In order to allow for generalisations to higher orders, we
discuss here how to construct an extended phase-space integrator. Consider the set
of coordinates ðXj; aÞ, j ¼ 1. . .N, including the cosmic expansion factor, with
conjugate momenta ðPj; paÞ along with the new extended phase-space Hamiltonian
in super-conformal time
~
H :¼
X
j
P2
j
2M þ aVðX1...NÞ þ a2HðaÞpa:
ð40Þ
Then the second order accurate ‘‘leap-frog’’ integrator is found when 1 ¼ 3 ¼ =2
and 2 ¼  in Eq. (39) (all higher orders 3...n ¼ 0) after expanding the operator
exponentials to ﬁrst order into their generators exp½ ^
D ’ I þ  ^
D. The ﬁnal inte-
grator takes the form
njð~t þ Þ ¼
I þ 
2
^
D


I þ  ^
K

	
I þ 
2
^
D


njð~tÞ
ð41Þ
or explicitly as it could be implemented in code
Xjð~t þ =2Þ ¼ Xjð~tÞ þ 
2M Pjð~tÞ
ð42aÞ
að~t þ =2Þ ¼ að~tÞ þ 
2 að~tÞ2 Hðað~tÞÞ
ð42bÞ
Pjð~t þ Þ ¼ Pjð~tÞ   að~t þ =2Þ $XjV X1...Nð~t þ =2Þ
ð
Þ
ð42cÞ
Xjð~t þ Þ ¼ Xjð~t þ =2Þ þ 
2M Pjð~t þ Þ
ð42dÞ
að~t þ Þ ¼ að~t þ =2Þ þ 
2 að~t þ =2Þ2 Hðað~t þ =2ÞÞ :
ð42eÞ
Note that the supplementary equation da=d~t ¼ o ~
H=opa ¼ a2HðaÞ, can in principle
also be integrated inexpensively to arbitrarily high precision in general cases, for
EdS one has ~t ¼ 2=ðH0
ﬃﬃﬃa
p Þ and in KCDM
~t ¼ 
2
H0
ﬃﬃﬃﬃﬃﬃﬃﬃﬃ
Xma
p
2F1  1
6 ; 1
2 ; 5
6 ; fKðaÞ


;
ð43Þ
where fK :¼ XK=ðXma3Þ as in Eq. (21), which has to be inverted numerically to
yield að~tÞ. Since this is a symplectic integration scheme, it will conserve the energy
associated with the Hamiltonian ~
H.
Equations (42a)–(42d) represent the drift-kick-drift (DKD) form of a second
order integrator. It is trivial to derive also the respective kick-drift-kick (KDK)
form. Based on this, it is possible to construct also higher order integrators, see e.g.,
Yoshida (1990) for a derivation of operators up to 8th order that involve, however,
positive and negative time coefﬁcients. Also, alternative symplectic formulations
with purely positive coefﬁcients are possible, see Chin and Chen (2001) for a 4th
123
Large-scale dark matter simulations
Page 31 of 200
1

order method. An exhaustive discussion of symplectic and other geometric
integrators and their properties can be found in Hairer et al. (2006) and Blanes
and Casas (2016). In cosmological simulations, the second order leap frog is,
however, the most commonly used integrator to date, arguably due to its robustness,
simplicity, slim memory footprint, and easy integration with hierarchical time-
stepping schemes (see below). We are not aware of production implementations of
higher-order symplectic integrators used in cosmological simulations.
A long-time evolution operator can be constructed by many successive
applications of the KDK or DKD propagators. Writing out the product, it is easy
to see that the last and ﬁrst half-step operators from two successive steps can often
be combined into a single operator (if ^A below is time independent, otherwise
usually at second order). Then, in the long product of operators, combining
. . . expðB ^BÞ expðA
2
^AÞ expðA
2
^AÞ expðB ^BÞ. . . ¼ . . . expðB ^BÞ expðA ^AÞ expðB ^BÞ. . .;
implies that in continued stepping only two interleaved steps have to be made per
time step, not three, and that the splitting into three sub-steps just serves to sym-
metrise the scheme and interleave the steps. Half-steps are only made at the very
beginning and end of the stepping—or whenever one needs synchronous dynamical
variables (e.g. for output or analysis).
4.2 Multi-stepping, adaptive steps and separation of time-scales
4.2.1 Time step criteria
A challenge in cosmological simulations is the large dynamic range from
quasilinear ﬂow on large-scales to very short dynamical times in the centres of
dark matter halos: we seek to simultaneously simulate large underdense regions of
the universe—where particles move on long timescales together with massive
clusters—where density contrasts can reach 104–105 times the average density and
with very short timescales. In the absence of an adaptive or hierarchical time-
stepping scheme, the criteria discussed below yield a global timestep Dt ¼ mini Dti
dictated by the N-body particle with the smallest time step.
A simple condition for choosing a time step is the Courant–Friedrichs–Lewy
(CFL) criterion, which requires that particles travel less than a fraction of one force
resolution element, Dx, over the time step. Speciﬁcally
Dti ¼ C
Dx
kPi=Mik ;
ð44Þ
where 0\C\1 is a free parameter, usually C 	 0:25. While commonly used in the
case of Vlasov–Poisson, we are not aware of explicit derivations of this value from
stability criteria as in the case of hyperbolic conservation laws. A closely related
criterion is Dti ¼ C
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
Dx=kAik
p
, where Ai :¼ $/jXi is the acceleration. This con-
dition sets a global timestep that is commonly used in simulations where forces are
computed via the PM algorithm (e.g., Merz et al. 2005). Other criteria are also
123
1
Page 32 of 200
R. E. Angulo, O. Hahn

possible, for instance the ABACUS code (Garrison et al. 2016), in addition to
Eq. 44, uses a heuristic condition based on the global maximum value of the RMS
velocity over the maximum acceleration of particles in a volume element.
In the case of tree or direct summation based methods, the scale played by the
mesh grid resolution is taken over by the softening length. Therefore, a simple
criterion is to estimate for each particle a time-scale
Dti ’ g
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
e
kAik
r
;
ð45Þ
where e is the gravitational force softening scale, and g is a dimensionless accuracy
parameter. This is the most common time-stepping criterion adopted in large-scale
simulations and it is used, for instance, in PKDGRAV-3 (with g ¼ 0:2) and
GADGET.
Several authors have argued that a more optimal timestepping criterion should be
based on the tidal ﬁeld rather than the acceleration (Dehnen and Read 2011; Stu¨cker
et al. 2020; Grudic´ and Hopkins 2020). This is also motivated by the fact that a
constant (global) acceleration does not change the local dynamics of a system, see
e.g. Stu¨cker et al. (2021a). Additionally, using tides avoids invoking the non-
physical scale e, and one has
Dti ’
g
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
TðXiÞ
k
k
p
;
ð46Þ
where T ¼ $  $/ is the tidal ﬁeld tensor, and k  k is e.g. the Frobenius matrix
norm. This tidal criterion typically yields shorter timesteps in the innermost parts
and longer timesteps in the outer parts of haloes compared to the standard criterion
(45). A caveat is that it is not trivial to get a robust estimate of the tidal ﬁeld, since it
is one spatial order less smooth than the acceleration ﬁeld entering (45) and so in
principle time-step ﬂuctuations due to noise might amplify integration errors.
An additional global timestep criterion, regardless of the dynamics of N-body
particles, is sometimes used in large-scale cosmological simulation when high
resolution is not required. These criteria are usually tied to the scale-factor evolution
and e.g. of the form
D logðaÞ\B ;
ð47Þ
where B 	 0:01. These kind of criteria are also usually employed in PM codes and
COLA (which we will discuss in Sect. 4.4), which typically adopt timesteps equally
spaced in the expansion factor or in its logarithm, or more complicated functions
(e.g., Da=a ¼ ða2
1
þ a2
2 Þ0:5 with a1 and a2 being free parameters in FAST-PM).
Different authors have advocated different options and number of steps justiﬁed
simply by convergence rates of a set of desired summary statistics (White et al.
2014; Feng et al. 2016; Tassev et al. 2013; Izard et al. 2016). The criterion in
Eq. 47 is also commonly used together with other conditions even in high-resolution
simulations, since it appears to be necessary for a precise agreement with linear
theory predictions at high redshift.
123
Large-scale dark matter simulations
Page 33 of 200
1

We note that different timestep criteria (and combinations) are adopted by
different codes, usually heuristically motivated. The optimal choice seems to
depend on details of the simulation (redshift, force accuracy, etc), which suggest
there could be better strategies to choose the timestep. This could be very important
as it has a signiﬁcant impact in the overall computational cost of a simulation. For
instance, by adjusting the timesteps, Sunayama et al. (2016) ﬁnds a factor of 4
reduction in the CPU time in N-body simulations while still accurately recovering
the power spectrum and halo mass function (after a correction of masses). As far as
we know, no systematic study of the optimal general time-stepping strategy has
been published for large-scale cosmological simulations taking into account the
target accuracy needed for upcoming observations.
For some applications, a global timestep is sufﬁcient to obtain accurate results on
the mildly nonlinear regime, as it has been adopted in some large-scale simulations
codes. However, as the resolution of a simulation increases, the minimum value of
Dti quickly decreases, usually as the result of a small number of particles in short
orbit inside dark matter halos. To avoid that the shortest time-scale dictates an
intractably small global time step, it is desirable to have individually adaptive time-
steps. Some care needs to be taken to consistently allow for this in a time integrator,
as we discuss next.
4.2.2 Hierarchical / block time stepping
For systems of particles with widely different time-scales, a division into ‘fast’ and
‘slow’ particles is advantageous. Given a second order accurate integrator and a
splitting of the Hamiltonian into H ¼ T þ Vslow þ Vfast, then the following n-fold
sub-cycling scheme is also second order accurate (Hairer et al. 2006)
I þ 
2
^
Kslow


I þ 
2n
^
Kfast


I þ 
n
^
D


I þ 
2n
^
Kfast


h
in
I þ 
2
^
Kslow


:
ð48Þ
The gain is that in one such KDK timestep, while the fast particles are kicked
2n times, the slow particles are kicked only twice. Since the force computation is the
algorithmically slowest part of the update, this leads to a computational speed up.
This sub-cycling idea can be generalised to the block time step scheme (BTS,
sometimes also called ‘hierarchical time stepping’) to update particles on their
relevant time scales (Hayli 1967, 1974; McMillan 1986) using a time-quantised
recursive version of the sub-cycling scheme above. By ﬁxing n ¼ 2, but applying
the formula recursively, i.e., splitting the ‘fast’ part itself into a ‘slow’ and ‘fast’ part
and so on, one achieves a hierarchical time integration scheme with time steps
‘ ¼ 2‘0 on recursion level ‘. The power-two quantisation means that while a
particle on level ‘ makes one timestep, a particle on level ‘ þ 1 makes two, and one
on level ‘ þ 2 makes four in the same time interval. Since the scheme is self-similar,
after every sub step with Eq. (48) on level ‘, all particles on levels ‘0 [ ‘ have
carried out complete time steps, and can be re-assigned a new time bin. In this way,
each particle can be assigned to a close to optimal time step ‘‘bin’’ which is
consistent with its local timestep criterion. This multi-stepping approach is adopted
in PKDGRAV-3 and GADGET.
123
1
Page 34 of 200
R. E. Angulo, O. Hahn

This scheme can be further optimized. As written above, the kick ^
K on level ‘
involves the interaction with particles on all other levels, i.e. the ‘fast’ particles
interact with the ‘slow’ particles on the ‘fast’ timescale, while it is likely sufﬁcient
that they do so on the ‘slow’ time scale. For this reason, a variation, e.g.
implemented in GADGET4 (Springel et al. 2021), is that the kick of particles on
level ‘ is computed using the gravitational force of particles only on all levels ‘0 
 ‘.
Such hierarchical integration schemes have recently been extended to higher order
integrators in the non-cosmological case (Rantala et al. 2021). In principle,
secondary trees need to be built in every level of the hierarchy of timesteps,
however, this would require a signiﬁcant amount of computing time. Therefore, a
optimization strategy, e.g. adopted in PKDGRAV-3, is to build a new secondary
tree only if a timestep level contains a small fraction of particles compared to the
previous level where the tree was built.
4.3 Symplectic integration of quantum Hamiltonians
The integration of a classical Hamiltonian in operator notation, Eq. (37) is basically
identical to that of the Schro¨dinger-Poisson system which is an effective description
of non-relativistic scalar ﬁeld dark matter, Eq. (92). One can therefore use the entire
machinery of operator splitting developed above, with differences only in the form
of the kick and drift operators, as they now act on the wave function, rather than the
set of conjugate coordinates and momenta. As above, the best choice is again
superconformal time so that one has a quantum Hamiltonian acting on wave
functions w with associated Poisson equation:
ih ow
o~t ¼ ^
Hw
with
^
H ¼ ^p2
2m þ að~tÞ ^Vð^qÞ
and
r2 ^V ¼ 3
2 H2
0mXXð w
j j21Þ:
ð49Þ
With the formal solution identical to that in Eq. (38) apart from a factor i=h in the
exponent, note also that the mass m is the actual microscopic particle mass and not a
coarse-grained effective mass. The main difference and advantage compared to the
classical case is that drift and kick operators ^
D and ^
K need not be represented
through their inﬁnitesimal generators, but can be directly taken to be the operator
exponentials
^
Dð~t; ~t þ Þ ¼ exp  i
h
^p2
2m


;
and
^
Kð~t; ~t þ Þ ¼ exp að~t þ =2Þ i
h
^V


:
ð50Þ
The kick operator is purely algebraic, i.e. it is simply a scalar function multiplying
the wave function. The same is true for the drift operator in Fourier space, where
123
Large-scale dark matter simulations
Page 35 of 200
1

^~
Dð~t; ~t þ Þ :¼ F ^
Dð~t; ~t þ Þ ¼ exp  ih
2m k2


ð51Þ
is simply a scalar function; F is the Fourier transform operator with inverse F 1, k
the Fourier-conjugate wave number (or momentum) to coordinate x. One can thus
formulate a split-step spectral integration scheme (e.g., Taha and Ablowitz 1984;
Woo and Chiueh 2009), where drift operators are simply applied in Fourier space,
i.e. before a drift, the wave function is transformed, and after it is transformed back.
The time coefﬁcients again have to be matched to cancel out commutators in the
BCH relation, so that a second order DKD time step is e.g. given by
wðx; t þ Þ ¼ F 1 ^~
Dð~t þ =2; ~t þ ÞF ^
Kð~t; ~t þ ÞF 1 ^~
Dð~t; ~t þ =2ÞF wðx; tÞ:
ð52Þ
The chaining of multiple steps eliminates two of the Fourier transforms for the steps
that are not at the beginning or end of the time integration, leaving one forward and
one backward transform per time step. The use of Fourier transforms and the
spectrally accurate drift operator (51) which contains the exponentiated Laplacian
^p2 to all orders signiﬁcantly increases the convergence rate of the scheme even for
large time steps.
The limiting factor of a spectral approach is that the spatial discretisation is
necessarily uniform for Fourier based methods. It is clear however that the use of
AMR techniques to locally increase the resolution inhibits (to our knowledge) the
simple use of spectral approaches, so that smaller stencils and ﬁnite-difference
expansions become necessary. Since gravity and the expanding Universe contract
gravitationally bound structures to ever smaller scales, methods with higher
dynamic range are needed to probe the interior of halos. To our knowledge, no
spatially adaptive spectral method has been developed yet. Instead, methods with
higher dynamic range resort to ﬁnite difference methods with AMR, which has been
successfully used to model the interior dynamics of scalar ﬁeld dark matter haloes
(Schive et al. 2014; Mina et al. 2020; Schwabe et al. 2020). By discretising the kick
operator,
one
has
to
resort
to
the
generator
formulation
again,
i.e.
^
D ¼ 1 þ  ih
m r2 þ Oð2Þ, where then the Laplacian can be approximated with
ﬁnite differences. This imposes strong CFL-like time-stepping constraints.
4.4 Acceleration methods: COLA and FASTPM
One of the main short-comings of symplectic integration schemes is that they have
to evolve a time-dependent Hamiltonian, which can require many time steps even
during the quasi-linear early phase of structure formation. In contrast, perturbation
theory is very accurate during this regime. For instance, ﬁrst-order LPT (a.k.a. the
Zel’dovich approximation) yields exact results for one-dimensional problems up to
shell-crossing and, therefore, the solution could be obtained in a single time-step.
This implies that (mostly in low resolution large-scale simulations) a considerable
amount of computing time can be spent to accurately evolve the particles during the
quasi-linear phase, since too large timesteps during this phase can lead to signiﬁcant
large-scale errors. This has motivated several methods aimed at incorporating
123
1
Page 36 of 200
R. E. Angulo, O. Hahn

results from perturbation theory in the time-integration of an N-body scheme. These
approaches have been widely-adopted to more efﬁciently create large ensembles of
simulations that achieve high accuracy on mildly non-linear scales. We review the
main ideas and implementations next.
4.4.1 COLA: COmoving Lagrangian Acceleration
In the COLA approach (Tassev et al. 2013), the idea is to consider motion relative
to a pre-computed LPT solution (speciﬁcally 1 and 2LPT in all implementations we
are aware of), by considering the equations of motion of CDM, Eq. (24), relative to
the motion in nLPT, as quantiﬁed by the order n truncated Lagrangian map xj ¼
qj þ WLPT;jðtÞ for particle j. In all existing work on COLA that we are aware of, an
ad-hoc modiﬁcation of the leapfrog drift and kick operators is made to reﬂect this
change in the equations of motion. One can however write such a transformation
rigorously as a canonical transformation to new coordinates ðXj; PjÞ with a
generating
function
F3ðpj; Xj; ~tÞ ¼ ðM _WLPT;j  pjÞ  Xj
so
that
Xj ¼ xj
and
Pj ¼ pj  M _WLPT;j. The COLA Hamiltonian then becomes (where the dot now
indicates a derivative w.r.t. superconformal time)
HCOLA ¼
X
j
ðPj þ M _WLPT;jÞ2
2M
þ aVðX1...NÞ þ M
X
j
€WLPT;j  Xj:
ð53Þ
It is immediately obvious that this Hamiltonian has explicit time-dependence in
both the kinetic and the potential part which will complicate the development of
symplectic splitting schemes. The equations of motion now reﬂect the motion rel-
ative to the LPT solution of the form
_Xj ¼ Pj
M þ _WLPT;j
and
_Pj ¼ a $XjV  M €WLPT;j:
ð54Þ
Existing COLA implementations ignore the Dyson time-ordering and simply
modify the drift and kick operators to become
^
DCOLAð~t; ~t þ ÞXj ¼ ^
Dð~t; ~t þ ÞXj þ WLPT;jð~t þ Þ  WLPT;jð~tÞ;
ð55aÞ
^
KCOLAð~t; ~t þ ÞPj ¼ ^
Kð~t; ~t þ ÞPj þ M _WLPT;jð~t þ Þ  M _WLPT;jð~tÞ;
ð55bÞ
which is accurate at ﬁrst order since none of the unequal time commutators can be
expected to vanish (Tassev et al. 2013 discuss an ad-hoc improvement to reduce
errors in their Appendix A.3.2). Despite the low order, this method allows for a very
rapid approximate evolution in the quasi-linear regime, at the expense of having to
store the ﬁelds needed to compute the nLPT trajectory of each ﬂuid element. The
above modiﬁcations are widely used in, for instance, the generation of a large
number of mock catalogues for estimates of clustering covariance matrices. In such
cases, ensembles of thousands of low-mass resolution, each of them with typically
123
Large-scale dark matter simulations
Page 37 of 200
1

10 time steps, are performed. An MPI-parallel implementation of the COLA
algorithm is publicly available for the implementation of Koda et al. (2016)7 and in
the form of the L-PICOLA8 code (Howlett et al. 2015), and a modiﬁed sCOLA
algorithm allowing a more efﬁcient spatial decomposition and ‘‘zoom simulations’’
has been recently proposed (Tassev et al. 2015) and is implemented in the SIM-
BELMYNE code (Leclercq et al. 2020)9. Therefore, it might be worthwhile exploring
non-symplectic integration schemes in COLA, which could be rigorously higher
order (given that there is no obvious beneﬁt from symplectic integration anyway)
and improve the performance of the method.
4.4.2 FastPM
An alternative that does not require to compute or store the LPT displacement ﬁelds,
thus saving computer memory, while relying on PT input to speed up the evolution
was proposed as the FASTPM method by Feng et al. (2016)10. In this approach, the
prefactors for drift and kick operators receive an ad-hoc modiﬁcation such that they
contain the expected contribution of non-constant acceleration and velocities
computed in the Zeldovich approximation. Note, however, that it has been argued
that no such modiﬁcations are needed to obtain an accurate time integration, as long
as the time stepping is chosen appropriately (Klypin and Prada 2018a; see also
Sunayama et al. 2016). The performance is similar to that of COLA, allowing
approximate simulations with very few time steps that can be accurate on large
scales. As for COLA, the order of convergence has, to our knowledge, not been
discussed in the literature. The FASTPM approach has been recently extended to
include the modelling of massive neutrinos (Bayer et al. 2021), and also ported to
TENSORFLOW (Modi et al. 2020b).
5 Gravity calculation
After having discussed the discretization in time and space (i.e. mass, for
Lagrangian schemes) of the evolution equations, we now turn to the problem of
computing the gravitational interactions of the simulated mass distribution. This
step is usually the most time-consuming aspect of a modern N-body simulation and
thus also where most numerical approximations are made and where various
parallelization strategies have the largest impact. Depending on the problem at
hand, the targeted numerical accuracy, and the computer architecture employed,
several different methods exists that are in different senses ’optimal’. Modern state-
of-the-art codes typically exploit all these existing techniques. Optimal algorithmic
complexity, OðNÞ in the number N of particles, is achieved e.g. by the Fast
Multipole Method (FMM), which is very promising for very large particle count
7 Available from https://github.com/junkoda/cola_halo/.
8 Available from https://cullanhowlett.github.io/l-picola/.
9 Available from https://bitbucket.org/ﬂorent-leclercq/simbelmyne.
10 Available from https://github.com/fastpm/fastpm.
123
1
Page 38 of 200
R. E. Angulo, O. Hahn

simulations and is used e.g., in the PKDGRAV3 or GADGET-4 codes, and the
geometric multigrid method, used e.g., in the RAMSES code. The newest codes also
readily utilise thousands of GPUs to generate simulated Universes for the upcoming
generations of cosmological observations.
In the following, we provide a brief overview of the main methods and the main
ideas behind them. Regarding the general topic of gravity calculations in N-body,
we also refer to other reviews for further details on these methods (Dehnen and
Read 2011).
5.1 Mesh-based methods
A robust and fast method to solve for the gravitational interactions of a periodic
system is provided by the particle-mesh (PM) method (Doroshkevich et al. 1980;
Hockney and Eastwood 1981). Derived from the particle-in-cell (PIC) technique
developed in plasma physics, they are among the oldest numerical methods
employed to study cosmological structure formation. The techniques described here
can be employed not only for the N-body discretisations, but are readily applicable
also e.g. for full phase space or integer lattice methods (cf. Sects. 3.2 and 3.3), see
also Miller and Prendergast (1968), and even in the case of Schro¨dinger-Poisson
systems (Woo and Chiueh 2009).
5.1.1 Force and potential determination—spectral calculation
Considering a periodic domain of side length L, we want to solve the cosmological
Poisson equation (Eq. 32b). Assume that both density q and potential / are periodic
in ½L=2; L=2Þ and can be expanded in a Fourier series, i.e.
qðxÞ ¼
X
n2Z3
~qn exp ik0 x  n
ð
Þ;
with
k0 :¼ 2p
L
ð56Þ
and identically for /ðxÞ with coefﬁcients ~/n. It then follows from Poisson’s
equation (Eq. 17) that their Fourier coefﬁcients obey the algebraic relation
k2
0 n
k k2 ~/n ¼ 4pGa1 ~qn  q dDðnÞ
ð
Þ
for all
n 2 Z3:
ð57Þ
This equation imposes the consistency condition ~qn¼0 ¼ q, i.e. the mean Poisson
source must vanish. In practice, this is achieved in PM codes by explicitly setting to
zero the n ¼ 0 mode (a.k.a. the ‘‘DC mode’’, in analogy to AC/DC electric cur-
rents). For the acceleration ﬁeld g ¼ r/, one ﬁnds ~gn ¼ ik0n ~/n. The solution
for potential and acceleration can thus be conveniently computed using the Discrete
Fourier transform (DFT) as
123
Large-scale dark matter simulations
Page 39 of 200
1

~/n ¼
 4pG
ak2
0
~qn
knk2
if
n 6¼ 0
0
otherwise
;
8
<
:
~gn ¼
4pG
ak0
i n~qn
knk2
if
n 6¼ 0
0
otherwise
8
<
:
:
ð58Þ
If one considers a uniform spatial discretisation of both potential /m :¼ /i;j;k :¼
/ðmhÞ and density qm, with i; j; k 2 ½0. . .Ng  1, mesh index m :¼ ði; j; kÞT, and
grid spacing h :¼ L=Ng, then the solution can be directly computed using the Fast-
Fourier-Transform (FFT) algorithm at OðM log MÞ for M ¼ N3
g grid points. Many
implementations exist, the FFTW library11 (Frigo and Johnson 2005) is one of the
most commonly used with support for multi-threading and MPI. In the case of the
DFT, the Fourier sum is truncated at the Nyquist wave number, so that
n 2 ðNg=2; Ng=23.
Note that instead of the exact Fourier-space Laplacian, k2
0knk2, which is
implicitly truncated at the Nyquist wave numbers, sometimes a ﬁnite difference
version is used in PM codes such as FAST-PM (Feng et al. 2016) (cf. 4.4). Inverting
the second order accurate ﬁnite difference Laplacian in Fourier space yields12
~/FD2
n
¼
 pGDx2
a
~qn
sin2 pnx
Ng


þ sin2 pny
Ng


þ sin2 pnz
Ng



1
if
n 6¼ 0
0
otherwise.
8
>
<
>
:
ð59Þ
This kernel has substantially suppressed power on small scales compared to the
Fourier space Laplacian, which reduces aliasing (see the discussion in the next
section). It also reduces the effect of anisotropies due to the mesh on grid scales.
Solving Poisson’s equation in Fourier space with FFTs becomes less efﬁcient if
boundary conditions are not periodic, or if spatial adaptivity is necessary. For
isolated boundary conditions, the domain has to be zero padded to twice its size per
linear dimension, which is an increase in memory by a factor of eight in three
dimensions. This is a problem on modern architectures since memory is expensive
and slow, while ﬂoating-point operations per second (FLOP) are much cheaper to
have in comparison. A further problem of FFT methods is their parallelization: a
multidimensional FFT requires a global transpose of the array. This leads to a very
non-local communication pattern and the need to transfer all of the data multiple
times between computer nodes per force calculation.
Additionally, if high resolution is required, as is often the case in cosmology due
to the nature of gravity as an attractive force, the size of the grid can quickly become
the computational bottleneck. One possibility is to introduce additional higher
resolution meshes (Jessop et al. 1994; Suisalu and Saar 1995; Pearce and Couchman
11 Available from https://www.fftw.org.
12 At second order one has o2
xf ¼ ðDxÞ2 dDðx þ DxÞ  2dDðxÞ þ dDðx  DxÞ
½
  f þ OðDx3Þ, and one
obtains Eq. (59) by Fourier transformation of the stencil operator. This exercise can be repeated also for
higher order stencils, respective expressions are given e.g. in Hahn and Abel (2011).
123
1
Page 40 of 200
R. E. Angulo, O. Hahn

1997; Kravtsov et al. 1997; Teyssier 2002), deposit particles onto them and then
solve using an adaptive ‘‘relaxation method’’ such as the adaptive multigrid method
(see below), or by employing the periodic FFT solution as a boundary condition.
Adaptive algorithms are typically more complex‘ due to the more complicated data
structures involved.
It is also possible to employ another (or many more) Fourier mesh extended over
a particular region of interest in a so-called ‘‘zoom simulation’’, cf. Sect. 6.3.4, if
higher force resolution is required in a few isolated subregions of the simulation
volume. A problem related of this method is that, for a ﬁnite grid resolution, Fourier
modes shorter than the Nyquist frequency will be incorrectly aliased to those
supported by the Fourier grid (Hockney and Eastwood 1981), which causes a biased
solution to the Poisson equation. The magnitude of this aliasing effect depends on
the mass assignment scheme and can be reduced when PM codes are complemented
with other force calculation methods, as discussed below in Sect. 5.3, since then the
PM force is usually UV truncated.
Instead of adding a ﬁne mesh on a single region of interest, it is possible to add it
everywhere in space. This approach is known as two-level PM or PMPM, and has
been used for carrying out COSMO- p, the largest N-body simulation to date (cf.
Sect. 10). This approach has the advantage that, for a cubical domain decompo-
sition, all the operations related to the ﬁne grid can be performed locally, i.e.
without communication among nodes in distributed-memory systems, which might
result in signiﬁcant advantages specially when employing hundreds of thousands of
computer nodes.
For full phase-space techniques, the PM approach also is preferable if a regular
mesh already exists in conﬁguration space onto which the mass distribution can then
be easily projected. The Fourier space spectral solution of the Poisson equation can
also be readily employed in the case of Schro¨dinger–Poisson discretisations on a
regular grid. In this case, the Poisson source is computed from the wave function
which is known on the grid, so that qm ¼ wmw
m.
5.1.2 Mass assignment schemes
Grid-based methods always rely on a charge assignment scheme (Hockney and
Eastwood 1981) that deposits the mass mi associated with a particle i at location Xi
by interpolating the particle masses in a conservative way to grid point locations xn
(where n 2 N3 is a discrete index, such that e.g. xn ¼ n Dx in the simplest case of a
regular (cubic) grid of spacing Dx). This gives a charge assignment of the form
qn ¼
Z
R3 d3x0 ^qðx0Þ W3Dðn Dx  x0Þ
with
^qðxÞ :¼
X
N
i¼1
MidDðx  XiÞ;
ð60Þ
where the periodic copies in the density were dropped since periodic boundary
conditions are assumed in the Poisson solver. Charge assignment to a regular mesh
is equivalent to a single convolution if Mi ¼ M is identical for all particles. The
123
Large-scale dark matter simulations
Page 41 of 200
1

most common particle-grid interpolation functions (cf. Hockney and Eastwood
1981) of increasing order are given for each spatial dimension by13
WNGPðxÞ ¼ 1
h
1
for xj j  Dx
2
0
otherwise
8
<
:
ð61aÞ
WCICðxÞ ¼ 1
h
1  xj j
Dx
for xj j\Dx
0
otherwise
8
<
:
ð61bÞ
WTSCðxÞ ¼ 1
Dx
3
4 
x
Dx

2
for xj j  Dx
2
1
2
3
2  xj j
Dx

2
for Dx
2  xj j\ 3Dx
2
0
otherwise
8
>
>
>
>
>
<
>
>
>
>
>
:
ð61cÞ
(b)
(a)
Fig. 6 Common particle-mesh mass assignment kernels in real space (panels a), and Fourier space
(panels b) of increasing order: n ¼ 1 NGP, n ¼ 2 CIC, n ¼ 3 TSC, n ¼ 4 PCS. Note that the NGP kernel
is not continuous, CIC is continuous but not differentiable, TSC is continuously differentiable, and PCS is
twice differentiable. The support of the assignment functions is nDx per dimension, and they converge to
a normal distribution for n ! 1. Due to their increasing smoothness, they also act as increasingly
stronger low-pass ﬁlters
13 The abbreviations commonly used to describe the different orders are owed to history: NGP = nearest
grid point, CIC = cloud in cell, TSC = triangular shaped cloud, PCS = piecewise cubic spline. It would be
more useful to simply call them ‘‘nth order assignment kernels’’.
123
1
Page 42 of 200
R. E. Angulo, O. Hahn

WPCSðxÞ ¼ 1
Dx
1
6 4  6
x
Dx

2
þ3 jxj
Dx

3
"
#
for xj j  Dx
1
6
2  xj j
Dx

3
for Dx  jxj\2Dx
0
otherwise
8
>
>
>
>
>
>
<
>
>
>
>
>
>
:
ð61dÞ
The
three-dimensional
assignment
function
is
then
just
the
product
W3DðxÞ ¼ WðxÞ WðyÞ WðzÞ, where x ¼ ðx; y; zÞT. It can be easily shown that inter-
polating using the inverse of these operators from a ﬁeld increases the regularity of
the particle density ﬁeld, and thus also has a smoothing effect on the resulting
effective gravitational force. This can also be seen directly from the Fourier
transform of the assignment functions which have the form (per dimension)
~
WnðkÞ ¼
sinc p
2
k
kNy

n
with
sinc x ¼ sin x
x
:
ð62Þ
where n ¼ 1 for NGP, n ¼ 2 for CIC, n ¼ 3 for TSC, n ¼ 4 for PCS interpolation,
and kNy :¼ p=Dx is the Nyquist wave number. NGP leads to a piecewise constant,
CIC to a piece-wise linear, TSC to a piecewise quadratically (i.e., continuous value
and ﬁrst derivative), and PCS to piecewise cubically changing acceleration as a
particle moves between grid points. The real space and Fourier space shape of the
kernels is shown in Fig. 6. Note that the support is always nDx, i.e. n cells, per
dimension and thus increases with the order, and by the central limit theorem ~
Wn
converges to a normal distribution as n ! 1. Hence, going to higher order can
impact memory locality and communication ghost zones negatively. Since an a
priori unknown number of particles might deposit to the same grid cell, special care
needs to be taken to make the particle projection thread safe in shared-memory
parallelism (Ferrell and Bertschinger 1994).
Alternatively to these mass assignment kernels for particles, it is possible to
project phase-space tessellated particle distributions (cf. Sect. 3.2) exactly onto the
force grid (Powell and Abel 2015; Sousbie and Colombi 2016). In practice, when
using such sheet tessellation methods, for a given set of ﬂow tracers, the phase-
space interpolation can be constructed and sampled with M ‘‘mass carrying’’
particles which can then be deposited into the grid. Since the creation of mass
carriers is a local operation, M can be arbitrarily large and thus the noise associated
to N-body discreteness can be reduced systematically. This approach has been
adopted by Hahn et al. (2013) and Angulo et al. (2013b) to simulate warm dark
matter while suppressing the formation of artiﬁcial fragmentation, as we will
discuss in greater detail in Sect. 7.3
The same mass assignment schemes can be used to reversely interpolate values
of a discrete ﬁeld back to the particle positions
Xi
f
g by inverting the projection
kernel. It has to be ensured that the same order is used for both mass deposit and
interpolation of the force to the particle positions, i.e., that deposit and interpolation
are mutually inverse. This is an important consistency since, otherwise, (1) exact
momentum conservation is not guaranteed, and (2) self-forces can occur allowing
123
Large-scale dark matter simulations
Page 43 of 200
1

particles to accelerate themselves (cf. Hockney and Eastwood 1981). It is important
to note that due to the grid discretisation, particle separations that are unresolved by
the discrete grid are aliased to the wrong wave numbers, which e.g. can cause
certain Fourier modes to grow at the wrong rate. Aliasing can be ameliorated by
ﬁltering out scales close to the Nyquist frequency, or by using interlacing techniques
where by combination of multiple shifted deposits individual aliasing contributions
can be cancelled at leading order (Chen et al. 1974; Hockney and Eastwood 1981).
Such techniques are important also when estimating Fourier-space statistics (i.e.,
poly-spectra) from density ﬁelds obtained using above deposit techniques (see
Sect. 9 for a discussion).
5.1.3 Relaxation methods and multi-scale
In order to overcome the limitations of Fourier space solvers (in particular, the large
cost of the global transpose on all data necessary along with the lack of spatial
adaptivity), a range of other methods have been developed. The requirement is that
the Poisson source is known on a grid, which can also be an adaptively reﬁned
‘AMR’ grid structure. On the grid, a ﬁnite difference version of the Poisson
equation is then solved, e.g., for a second-order approximation in three dimension
the solution is given by the ﬁnite difference equation:
/i1;j;k þ /iþ1;j;k þ /i;j1;k þ /i;jþ1;k þ /i;j;k1 þ /i;j;kþ1  6/i;j;k ¼ Dx2 fi;j;k ;
ð63Þ
where indices refer to grid point locations as above, Dx is the grid spacing, and
fi;j;k :¼ 4pGðqi;j;k  qÞ=a is the Poisson source. This can effectively be written as a
matrix inversion problem A/ ¼ f where the ﬁnite difference stencil gives rise to a
sparse matrix A and the solution sought is / ¼ A1f. Efﬁcient methods exist to
solve such equations. A particularly powerful one, that can directly operate even on
an AMR structure, is the adaptive multigrid method (Brandt 1977; Trottenberg et al.
2001), which is used e.g., by the RAMSES code (Teyssier 2002). It combines
simple point relaxation (e.g., Jacobi or Gauss–Seidel iterations) with a hierarchical
coarsening procedure which spreads the residual correction exponentially fast
across the domain. Some additional care is required at the boundaries of adaptively
reﬁned regions. Here the resolution of the mesh changes, typically by a linear factor
of two, and interpolation from the coarser grid to the ghost zones of the ﬁne grid is
required. In the one-way interface type of solvers, the coarse solution is obtained
independently of the ﬁner grid, and then interpolated to the ﬁner grid ghost zones to
serve as the boundary condition for the ﬁne solution (Guillet and Teyssier 2011), but
no update of the coarse solution is made based on the ﬁne solution. This approach is
particularly convenient for block-stepping schemes (cf. Sect. 4.2.2) where each
level of the grid hierarchy has its own time step by solving e.g. twice on the ﬁne
level while solving only once on the coarse. A limitation of AMR grids is however
that the force resolution can only change discontinuously by the reﬁnement factor,
both in time—if one wants to achieve a resolution that is constant in physical
coordinates—and in space—as a particle moves across coarse-ﬁne boundaries. On
123
1
Page 44 of 200
R. E. Angulo, O. Hahn

the other hand, AMR grids contain self-consistently an adaptive force softening (see
Sect. 8.2), if the reﬁnement strategy is tied to the local density or other estimators
(Hobbs et al. 2016).
Depending on the fragmentation of the ﬁner levels due to the dynamic adaptivity,
other solvers can be more efﬁcient than multigrid, such as direct relaxation solvers
(Kravtsov et al. 1997) or conjugate gradient methods. However, it is in principle
more accurate to account for the two-way interface and allow for a correction of the
coarse potential from the ﬁne grid as well, as discussed e.g. by Johansen and Colella
(1998), Miniati and Colella (2007). Note that, once a deep grid hierarchy has
developed, global Poisson solves in each ﬁne time step are usually prohibitive for
numerical algorithms. For this reason optimizations are often employed to solve for
the gravitational acceleration of only a subset of particles in multi-stepping
schemes. In the case of AMR, some care is necessary to interpolate boundary
conditions also in time to avoid possible spurious self-interactions of particles.
5.2 Direct P2P summation
As discussed above, mesh-based methods bring along an additional discretisation of
space. This can be avoided by computing interactions directly at the particle level
from Eqs. (32b–33). In this case, the gravitational potential at particle i’s location,
Xi, is given by the sum over the contribution of all the other particles in the system
along with all periodic replicas of the ﬁnite box, i.e.
/ðxiÞ ¼ a1 X
n2Z3
X
N
j¼1
i6¼j
GMj
kXi  Xj  nLk þ ubox;LðXi  nLÞ
2
64
3
75:
ð64Þ
Note that we neglected force softening for the moment, i.e. we set WðxÞ ¼ dDðxÞ.
Here ubox;L is the potential due to a box ½0; LÞ3 of uniform background density
q ¼ Xmqc that guarantees that the density q  q sourcing / vanishes when inte-
grated over the box.
This double sum is slowly convergent with respect to n, and in general there can
be spurious forces arising from a ﬁnite truncation [but note that the sum is
unconditionally convergent if the box has no dipole, e.g., Ballenegger (2014)]. A
fast and exact way to compute this expression is provided by means of an Ewald
summation (Ewald 1921), in which the sum is replaced by two independent sums,
one in Fourier space for the periodic long-range contribution, and one in real space,
for the non-periodic local contribution, which both converge rapidly. It is then
possible to rewrite Eq. (64) employing the position of the nearest replica, which
results into pairwise interactions with a modiﬁed gravitational potential. This
potential needs to be computed numerically, thus, in GADGET3, for instance, it is
tabulated and then interpolated at runtime, whereas in GADGET4, the code relies on
a look-up table of a Taylor expansion with analytic derivatives of the Ewald
potential. We summarise in more detail how this is achieved in Sect. 5.3, where we
123
Large-scale dark matter simulations
Page 45 of 200
1

discuss in particular how the FFT can be efﬁciently used to execute the Fourier
summation.
This direct summation of individual particle-particle forces is OðN2Þ, that is,
quadratic in the number of particles and thus becomes quickly computationally
prohibitive. In addition, since it is a highly non-local operation, it would require a
considerable amount of inter-process communication. In practice, this method is
sometimes used to compute short-range interactions, where the operation is local
and can exploit the large computational power provided by GPUs. This is, for
instance, the approach followed by the HACC code (Habib et al. 2016), when
running one of the largest simulations to date with 3.6 trillion particles; and also by
the ABACUS code (Garrison et al. 2018). Direct summation enabled by GPUs has
also been adopted by Ra´cz et al. (2019) for compactiﬁed simulations, where there is
an additional advantage that only a small subset of the volume has to be followed
down to z ¼ 0 (cf. Sect. 6.3.5).
5.3 Particle mesh Ewald summation, force splitting and the P3M method
Beyond the poor OðN2Þ scaling of the direct P2P summation (for which we discuss
the solutions below), another important limitation of the naı¨ve inﬁnite direct
summation is the inﬁnite periodic contribution in Eq. (64). At the root of the
solution is the Ewald summation (Ewald 1921), ﬁrst used for cosmological
simulations by Bouchet and Hernquist (1988), in which the total potential or
acceleration is split into a short and a long range contribution, and where the short
range contribution is summed in real space, while the long range contribution is
summed in Fourier space where it converges due to its periodic character much
faster. One thus introduces a ‘splitting kernel’ S so that
/ðxÞ ¼ /lrðxÞ þ /srðxÞ :¼ S  / þ ð1  SÞ  /:
ð65Þ
The long-range contribution /lr can be computed using the PM method on a rela-
tively coarse mesh. On the other hand, the short-range contribution /sr, can be
computed from the direct force between particles only in their immediate vicinity—
since the particles further away contribute through the PM part. Instead of the direct
force, which gives then rise to the P3M method, modern codes often use a tree-
method (see next section) for the short range force [this is e.g., what is implemented
in the GADGET2 code by Springel (2005), see also Wang (2021)].
The splitting kernel effectively spreads the mass over a ﬁnite scale rs for the long
range interaction, and corrects for the residual with the short range interaction on
scales .rs. Many choices are a priori possible, Hockney and Eastwood (1981), e.g.,
propose a sphere of uniformly decreasing density, or a Gaussian cloud. The latter is,
e.g., used in the GADGET codes.
In terms of the Green’s function of the Laplacian GðrÞ ¼ 1=ð4pkrkÞ, the formal
solution for the cosmological Poisson equation reads / ¼ 4pG
a
q  q
ð
Þ  G. For a
Gaussian cloud of scale rs, one has in real and Fourier space
123
1
Page 46 of 200
R. E. Angulo, O. Hahn

Sðr; rsÞ ¼ ð2pr2
s Þ3=2 exp  r2
2r2
s


;
~Sðk; rsÞ ¼ exp  1
2 k2r2
s


:
ð66Þ
The ‘dressed’ Green’s functions Glr ¼ G  S and Gsr ¼ G  ð1  SÞ then become
explicitly in real and Fourier space
Glrðr; rsÞ ¼  1
4p r erf
rﬃﬃﬃ
2
p
rs


;
ð67aÞ
Gsrðr; rsÞ ¼  1
4p r erfc
rﬃﬃﬃ
2
p
rs


;
ð67bÞ
Instead of the normal Green’s functions, one thus simply uses these truncated
functions and obtains a hybrid solver. In order to use this approach, one chooses a
transition scale of order the grid scale, rs 	 Dx, and then replaces the PM Green’s
function with Glr. Instead of the particle-particle interaction in the direct summation
or tree force (see below), one uses Gsr for the potential, and $Gsr for the force.
While the long range interaction already includes the periodic Ewald summation
component if solved with Fourier space methods, when evaluating the periodic
replica summation for the short-range interaction, the evaluation can be restricted to
the nearest replica in practice due to the rapid convergence with the regulated
interaction. In addition, since PM forces are exponentially suppressed on scales
comparable to rs which is chosen to be close to the grid spacing Dx, aliasing of
Fourier modes is suppressed.
Note that another more aggressive near-far ﬁeld combination is adopted by the
ABACUS code. In this approach, the computational domain is ﬁrst split into a
uniform grid with K3 cells. Interactions of particles separated by less than
approximately 2L/K are computed using direct summation (neglecting Ewald
corrections); otherwise are computed using a high-order multipole (p ¼ 8)
representation of the force ﬁeld in the Kgrid. Since two particles only interact
via either the near- or far-ﬁeld forces, and the tree structure is ﬁxed to the K-grid,
this allows for several optimizations and out-of-core computations. The price is
discontinuous force errors with a non-trivial spatial dependence, as well as reduced
accuracy due to the lack of Ewald corrections. This, however, might be
acceptable for some applications and, as we will see in Sect. 8.5, ABACUS
performs well when compared to other state-of-the-art codes.
5.4 Hierarchical tree methods
Assuming that it is acceptable to compute gravitational forces with a given speciﬁed
accuracy, there are ways to circumvent the OðN2Þ and non-locality problem of
direct summation. A common approach is to employ a hierarchical tree structure to
partition the mass distribution in space and compute the gravitational potential
jointly exerted by groups of particles, whose potential is expanded to a given
multipole order (Barnes and Hut 1986). Thus, instead of particle-particle
interactions, particle-node interactions are evaluated. Since the depth of such a
123
Large-scale dark matter simulations
Page 47 of 200
1

tree is typically Oðlog NÞ, the complexity of the evaluation of all interactions can be
reduced to OðN log NÞ. This can be further reduced to an ideal OðNÞ complexity
with the fast multipole method (FMM, see below).
There are several alternatives for constructing tree structures. The most common
choice is a regular octree in which each tree level is subdivided into 8 sub-cells of
equal volume, this is for instance used by GADGET. Another alternative, used for
instance in old versions of PKDGRAV are binary trees in which a node is split into
only two daughter cells. This in principle has the advantage to adapt more easily to
anisotropic domains, and a smoother transition among levels, at the expense of a
higher cost in walking the tree or the need to go to higher order multipole
expansions at ﬁxed force error. The tree subdivision continues until a maximum
number M of particles per node is reached (M ¼ 1 in GADGET2-3 but higher in
GADGET4 and PKDGRAV).
The main advantage brought by tree methods is that the pairwise interaction can
be expanded perturbatively and grouped among particles at similar locations, thus
reducing dramatically the number of calculations that needs to be carried out. The
key philosophical difference with respect to direct summation is that one seeks to
obtain the result at a desired accuracy, rather than the exact result to machine
precision. This difference allows a dramatic improvement in algorithmic complex-
ity. Another key aspect is that hierarchical trees are well suited for hierarchical
(adaptive) timesteps.
Tree methods have for a long time been extraordinarily popular for evaluating the
short range interactions also in hybrid tree-PM methods, as pioneered by Bagla
(2002); Bagla and Ray (2003), or more recent FMM-PM (Gnedin 2019; Wang 2021;
Springel et al. 2021) approaches, thus supplementing an efﬁcient method for
periodic long-range interactions with an efﬁcient method which is not limited to the
uniform coarse resolution of FFT-based approaches (or also discrete jumps in
resolution of AMR approaches). We discuss some technical aspects of these
methods next.
5.4.1 Hierarchical multipole expansion
In the ‘Barnes & Hut tree’ algorithm (Appel 1985; Barnes and Hut 1986), particle-
node interactions are evaluated instead of particle-particle interactions. Let us
consider a hierarchical octree decomposition of the simulation box volume V :¼
½0; Lbox3 at level ‘ into cubical subvolumes, dubbed ‘nodes’, S‘
i¼1...N‘ of side length
Lbox=2‘, where N‘ ¼ 23‘, so that S
i S‘
i ¼ V and S‘
i \ S‘
j6¼i ¼ ; on each level gives a
space partitioning. Let us consider the gravitational potential due to all particles
contained in a node Xj 2 S‘
i. The partitioning is halted when only one (but typically
a few) particle is left in a node. We shall assume isolated boundary conditions for
clarity, i.e. we neglect the periodic sum in Eq. (64). Thanks to the partitioning, the
gravitational interaction can be effectively localised with respect to the ‘tree node’
pivot at location k 2 S‘
i, so that the distance kXj  kk 
ﬃﬃﬃ
3
p
Lbox=2‘ ¼: r‘ is by
123
1
Page 48 of 200
R. E. Angulo, O. Hahn

deﬁnition bounded by the ‘node size‘ r‘ and can serve as an expansion parameter.
To this end, one re-writes the potential due to the particles in the node subvolume S‘
i
/‘
iðxÞ /
X
Xj2S‘
i
Mj
kx  Xjk ¼
X
Xj2S‘
i
Mj
kðx  kÞ  ðXj  kÞk ¼
X
Xj2S‘
i
Mj
kd þ k  Xjk
ð68Þ
where d :¼ x  k. This can be Taylor expanded to yield the ‘P2M’ (particle-to-
multipole) kernels
1
kd þ k  Xjk ¼
1
kdk
|{z}
monopole
þ dk
kdk3 Xj;k  kk

	
|ﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄ{zﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄ}
dipole Oðr‘=d2Þ
þ
þ 1
2
dkdl
kdk5
3ðXj;k  kkÞðXj;l  klÞ  dklkXj  kk2


|ﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄ{zﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄ}
quadrupole Oðr2
‘=d3Þ
þ. . .;
ð69Þ
which converges quickly if kdk  r‘. The multipole moments depend only on the
vectors ðXj  kÞ and can be pre-computed up to a desired maximum order p during
the tree construction and stored with each node. In doing this, one can exploit that
multipole moments are best constructed bottom-up, as they can be translated in an
upward-sweep to the parent pivot and then co-added—this yields an ‘upwards
M2M’ (multipole-to-multipole) sweep. Note that if one sets k to be the centre of
mass of each tree node, then the dipole moment vanishes. The complexity of such a
tree construction is OðN log NÞ for N particles.
When evaluating the potential /ðxÞ one now proceeds top-down from the root
node at ‘ ¼ 0 in a ‘tree walk’ and evaluates M2P (multipole-to-particle) interactions
between the given particle and the node. Since one knows that the error in /‘
iðxÞ is
O ðr‘=dÞp
ð
Þ, one deﬁnes a maximum ‘opening angle’ hc and requires in order for the
multipole expansion /‘
iðxÞ to be an acceptable approximation for the potential due
to the mass distribution in S‘
i that the respective opening angle obeys
r‘
kdk \hc:
ð70Þ
Otherwise the procedure is recursively repeated with each of the eight child nodes.
Since the depth of a (balanced) octree built from a distribution of N particles is
typically Oðlog NÞ, a full potential or force calculation has an algorithmic com-
plexity of OðN log NÞ instead of the OðN2Þ of the direct summation. The resulting
relative error in a node-particle interaction is (Dehnen 2002)
d/  hpþ1
c
1  hc
Mnode
kdk ;
ð71Þ
where Mnode is the node mass (i.e. the sum of the masses of all particles in S‘
i), and p
is the order of the multipole expansion. Eq. 70 error estimate is a purely geometric
criterion, independent of the magnitude of Mnode and the multipole moments, as well
123
Large-scale dark matter simulations
Page 49 of 200
1

as the actual value of the gravitational acceleration. It is also independent of the
magnitude of the interaction, i.e. neglecting that far nodes contribute more than
nearby ones to the total interaction.
An alternative method, proposed by Springel et al. (2001b), is to use a dynamical
criterion by comparing the expected acceleration with the force error induced by a
given node interaction. Speciﬁcally, when evaluating the particle-node interactions
for particle j one sets
hc;j ¼
akAjk kdk2
GMnode
 
!1=p
;
ð72Þ
where kAjk is the modulus of the gravitational acceleration (which could be esti-
mated from the force calculation performed in a previous step), and a is a dimen-
sionless parameter that controls the desired accuracy. Note, however, that for
relatively isotropic mass distributions, the uncertainty of a given interaction might
not be representative of the uncertainty in the total acceleration.
We highlight that the expressions (68)–(69) are valid for the non-periodic
particle-node interactions, but for periodic boundary conditions additional terms
arise owing to the modiﬁed Green’s function as seen in Eq. (64). The Green’s
function is also modiﬁed in the case when tree interactions are combined with other
methods such as PM in a tree-PM method (see Sect. 5.3). This implies in principle
also modiﬁed error criteria (or opening angles), however, this is often neglected.
So far, performing the multipole expansion only to monopole order (with nodes
centered at the center of mass) has been a popular choice for N-body codes. The
reason behind this is that a second-order accurate expression is obtained with very
low memory requirements (one needs to simply store the centre of mass of tree
nodes instead of the geometric centre, which is enough when moderate accuracy is
sought. However, in search of higher accuracy, a larger number of codes have
started to also consider quadrupole and octupole terms, which requires more
memory and computation but allows a less aggressive opening criteria. This has
been advocated as the optimal combination that provides the most accurate estimate
at a ﬁxed computational cost (Dehnen and Read 2011; Potter and Stadel 2016),
although the precise optimal order depends on the required accuracy (Springel et al.
2021). In the future, further gains from higher order terms can be obtained as
computer architectures evolve towards higher FLOP/byte ratios.
A problem for tree codes used for cosmological simulations is that on large scales
and/or at high redshift the mass distribution is very homogeneous. This is a problem
since the net acceleration of a particle is then the sum of many terms of similar
magnitude but opposite sign that mostly cancel. Thus, obtaining accurate forces
requires a low tolerance error which increases the computational cost of a
simulation. For instance, the EUCLID FLAGSHIP simulation (Potter and Stadel 2016),
which employed a pure Tree algorithm (cf. Sect. 10), spends a considerable amount
of time on the gravitational evolution at high redshift. Naturally, this problem is
exacerbated the larger the simulation and the higher the starting redshift.
A method to address this problem, that was proposed by Warren (2013) and
implemented in the 2HOT code, is known as ‘‘background subtraction’’. The main
123
1
Page 50 of 200
R. E. Angulo, O. Hahn

idea is to add the multipole expansion of a local uniform negative density to each
interaction, which can be computed analytically for each cubic cell in a particle-
node interaction. Although this adds computational cost to the force calculation, it
results in an important overall reduction of the cost of a simulation since many more
interactions can be represented by multipole approximations at high redshift. As far
as we know, this has not been widely adopted by other codes.
A further optimization that is usually worth carrying out on modern architectures
is to prevent tree reﬁnement down to single particles (for which anyway all
multipoles beyond the monopole vanish). Since the most local interactions end up
being effectively direct summation anyway, one can get rid of the tree overhead and
retain a ‘bucket’ of 1023 particles in each leaf node rather than a single individual
particle. All interactions within the node, as well as those which would open child
nodes are carried out in direct summation. While algorithmically more complex,
such a direct summation is memory-local and can be highly optimized and e.g.
ofﬂoaded to GPUs, providing signiﬁcant speed-up over the tree.
5.4.2 Fast-multipole method
Despite the huge advantage with respect to direct summation, a single interaction of
a particle with the tree is still computationally expensive as it has a Oðlog NÞ
complexity for a well-balanced tree. Furthermore, trees as described above have
other disadvantages, for instance, gravitational interactions are not strictly
symmetric. This leads to a violation of momentum conservation. A solution to
these limitations is provided by fast multipole methods (FMM), originally proposed
by Greengard and Rokhlin (1987) and extended to Cartesian coordinates by Dehnen
(2000, 2002). These algorithms take the idea of hierarchical expansions one step
further by realising that signiﬁcant parts of the particle-node interactions are
redundantly executed for particles that are within the same node. In order to achieve
a Oð1Þ complexity per particle, the node-node interaction should be known and
translated to the particle location. This is precisely what FMM achieves by
symmetrising the interaction to node-node interactions between well-separated
nodes, which are separately Taylor expanded inside of the two nodes. Up to
recently, FMM methods have not been widespread in cosmology, presumably due to
a combination of higher algorithmic and parallelization complexity. The advantages
of FMM are becoming evident in modern N-body codes, which simulate extremely
large numbers of particles and seek high accuracy, and thus FMM has been adopted
in PKDGRAV, GADGET-4, and SWIFT. We only brieﬂy summarize the main steps
of the FMM algorithm here, and refer the reader to the reviews by, e.g., Kurzak and
Pettitt (2006), Dehnen and Read (2011) for details on the method.
The FMM method builds on the same hierarchical space decomposition as the
Barnes&Hut tree above and shares some operators. For the FMM algorithm, three
steps are missing from the tree algorithm outlined in the previous section: a
‘downward M2L’ (multipole-to-local) sweep, which propagates the interactions
back down the tree after the upward M2M sweep, thereby computing a local ﬁeld
expansion in the node. This expansion is then shifted in ‘downward L2L’ (local-to-
123
Large-scale dark matter simulations
Page 51 of 200
1

local) steps to the centers of the child nodes, and to the particles in a ﬁnal ‘L2P’
(local-to-particle) translation. As one has to rely on the quality of the local
expansion in each node, FMM requires signiﬁcantly higher order multipole
expansions compared to standard Barnes&Hut trees to achieve low errors. Note that
for a Cartesian expansion in monomials xlymzn at a ﬁxed order p ¼ l þ m þ n, one
has ðp þ 1Þðp þ 2Þ=2 multipole moments, i.e. ðp þ 1Þðp þ 2Þðp þ 3Þ=6 for all
orders up to incl. p, i.e. memory needed for each node scales as Oðp3Þ, and a
standard implementation evaluating multipole pair interactions scales as Oðp6Þ. For
expansions in spherical harmonics, one can achieve Oðp3Þ scaling (Dehnen 2014).
Note that for higher order expansions one can rely on known recursion relations to
obtain the kernel coefﬁcients (Visscher and Apalkov 2010) allowing arbitrary order
implementations. Recently, it was demonstrated that a trace-free reformulation of
the Cartesian expansion has a slimmer memory footprint (Coles and Bieri 2020)
(better than 50% for p 
 8). The same authors provide convenient PYTHON scripts to
auto-generate code for optimized expressions of the FMM operators symbolically. It
is important to note that the higher algorithmic complexity lends itself well to recent
architectures which favour high FLOP-to-byte ratio algorithms (Yokota and Barba
2012).
While the FMM force is symmetric, Springel et al. (2021) report however that
force errors can be much less uniform in FMM than in a standard tree approach, so
that it might be required to randomise the relative position of the expansion tree
w.r.t. the particles between time steps in order to suppress the effect of correlated
force errors on sensitive statistics for cosmology. In principle also isotropy could be
further improved with random rotations. Note that errors might have a different
spatial structure with different expansion bases however.
The FMM method indeed has constant time force evaluation complexity for each
N-body particle. This assumes that the tree has already been built, or that building
the tree does not have OðN log NÞ complexity (which is only true if it is not fully
reﬁned but truncated at a ﬁxed scale). Note however that for FMM solvers, it is
preferable to limit the tree depth to a minimum node size or at least use a larger
number of particles in a leaf cell for which local interactions are computed by direct
‘P2P’ (particle-to-particle) interactions. Also, tree construction has typically a much
lower pre-factor than the ‘tree walk’. Note further that many codes use some degree
of ‘tree updating’ in order to avoid rebuilding the tree in every timestep.
In order to avoid explicit Ewald summation, some recent methods employ hybrid
FFT-FMM methods, where essentially a PM method is used to evaluate the periodic
long range interactions as in tree-PM and the FMM method is used to increase the
resolution beyond the PM mesh for short-range interactions (Gnedin 2019; Springel
et al. 2021).
123
1
Page 52 of 200
R. E. Angulo, O. Hahn

6 Initial conditions
In previous sections we have discussed how to discretise a cold collisionless ﬂuid,
compute its self-gravity, and evolve it in time. Closing our review of the main
numerical techniques for cosmological simulations, in this section we present
details on how to compute and set up their initial conditions.
The complicated non-linear structures that are produced at late times in
cosmological simulations develop from minute ﬂuctuations around homogeneity in
the early Universe that are ampliﬁed by gravitational collapse. While the
ﬂuctuations remain small (i.e. at early times, or on large scales) they permit a
perturbative treatment of the underlying non-linear coupled equations. Such
perturbative techniques belong to the standard repertoire of analytic techniques
for the study of the cosmic large-scale structure, see e.g., Bernardeau et al. (2002)
for a review, and Sect. 2.5 for a concise summary. At late times and on smaller
scales, shell-crossing and deeply non-linear dynamics limit the applicability of
perturbative techniques. While some attempts have been made to extend PT beyond
shell-crossing (Taruya and Colombi 2017; Pietroni 2018; Rampf et al. 2021a), or by
controlling such effects in effective ﬂuid approaches, e.g., Baumann et al. (2012),
the evolved non-linear universe is still the domain of simulations. At the same time,
PT of various ﬂavours is used to set up the ﬁelds that provide the initial conditions
for fully non-linear cosmological simulations.
6.1 Connecting simulations with perturbation theory
The physics governing the infant phase of the Universe, that is dominated by a hot
plasma tightly coupled to radiation and linked through gravity to dark matter and
neutrinos, is considerably more complex than the purely geodesic evolution of
a = 0
a = astart
a = atarget
forward:
backward:
back-scaling:
EB linear
EB linear
reduced linear
N-body
EB linear
reduced linear
N-body
non-linear LPT
Fig. 7 Different setups used to initialise N-body simulations with the output from a linear Einstein–
Boltzmann (EB) solver such as CAMB or CLASS to bridge the gap between missing physics in N-body
codes on the one hand, and missing non-linearities in the EB codes on the other hand. ‘EB linear’
represents the linear full-physics evolution through the EB code, ‘reduced linear’ a reduced linear model
(including physics captured in the N-body code), ‘non-linear LPT’ the non-linear evolution using
Lagrangian perturbation theory to some ﬁnite order valid prior to shell-crossing, and ‘N-body’ the full
non-linear evolution. In the ‘forward’ approach additional ﬁelds (e.g., neutrinos, relativistic corrections)
need to be added to match the EB solution at atarget
123
Large-scale dark matter simulations
Page 53 of 200
1

collisionless gravitationally interacting paricles outlined in Sect. 2. Since density
ﬂuctuations are small, this phase can be treated accurately by perturbative
techniques at leading order. State-of-the-art linear-order Einstein–Boltzmann (EB)
codes that numerically integrate these coupled multi-physics systems are e.g., CAMB
(Lewis et al. 2000) and CLASS (Lesgourgues 2011; Blas et al. 2011)14. These codes
usually evolve at least dark matter, baryons, photons and (massive) neutrinos and
output Fourier-space transfer functions for density dX and velocity divergence hX for
each of the species X as well as the total matter density ﬂuctuations at speciﬁable
output times. Typically equations are integrated in synchronous gauge, in a frame
comoving with dust. The use of the output of these Einstein–Boltzmann solver for
non-linear simulations that (in the case of N-body simulations) model only
Newtonian gravity and no relativistic species, let alone baryon-photon coupling,
requires still some numerical considerations that we discuss next. The inclusion or
non-inclusion of relativistic species makes a difference of several per cent in the
background evolution and therefore the growth rate between redshifts z ¼ 100 and
z ¼ 0 (Fidler et al. 2017b), implying that it is crucial to be aware of what physics is
included in the calculations for the initial conditions and in the non-linear
cosmological code. Usually, it is sufﬁciently accurate to combine output for density
perturbations in synchronous gauge with Newtonian gauge velocities when working
with Newtonian equations of motion, but also self-consistent gauge choices exist
which allow the correct inclusion of relativistic effects even within Newtonian
simulations.
The main approaches adopted when using the output from an EB solvers to set up
initial conditions are illustrated in Figure 7 and are:
Forward method In this approach, the output of the Einstein–Boltzmann code at
some early time zstartJ100 is used. To avoid errors of several per cent at low
redshift on all scales, relativistic components must be included in the background
evolution of the non-linear solution in this case. Also the signiﬁcant evolution of the
horizon between z [ 100 and 0 means that for very large-scale simulations,
relativistic corrections can become important and should be included as well for
high precision. Since all corrections beyond the background are signiﬁcant only on
large scales, they remain perturbative. In the COSIRA approach (Brandbyge et al.
2017), which is also used e.g., in the EUCLID ﬂagship simulations (Potter et al. 2017),
they are added as corrections at the linear level (subtracting essentially the
Newtonian linear gravity from the relativistic), convolving the resulting correction
with the random phases of the initial conditions, and adding this realisation-speciﬁc
correction to the gravity solver step of the N-body code.
Care has to be taken that these corrections never signiﬁcantly contribute to non-
linear terms as the corresponding back-reaction on the linear ﬁeld is neglected.
While requiring a direct integration of the Einstein–Boltzmann solver with the N-
body code, this approach can readily include also a treatment of massive neutrinos
at linear order (Tram et al. 2019, and see discussion in Sect. 7.8.2). If all relevant
physics is included, this approach guarantees very good agreement between
14 The CAMB software package can be obtained from https://camb.info, and CLASS is available from
https://lesgourg.github.io/class_public/class.html.
123
1
Page 54 of 200
R. E. Angulo, O. Hahn

Einstein–Boltzmann and N-body on linear scales. Due to the very nature of this
approach, it does not allow the use of high-order Lagrangian perturbation theory
since only linear quantities are known at the starting time zstart, which therefore has
to be pushed to early times in order to not itself affect the simulation results (see
discussion in Sect. 8.3). If ﬁelds dX and hX are known for a species X at the starting
time, then they can be converted into leading order consistent Lagrangian maps with
respective velocities through the relations
xðq; zstartÞ ¼ q  $r2dEB
X ðq; zstartÞ
and
vðq; zstartÞ ¼ $r2hEB
X ðq; zstartÞ:
ð73Þ
Backward method An alternative approach to the forward method that allows to
couple a non-linear simulation with reduced physical models to the EB solutions is
given by the ‘backward method’ (not to be confused with the ‘backscaling’ method
below). Here, the linearised set of equations solved by the non-linear code are used
to integrate backwards in time, i.e. from ztarget where the output of the EB code is
known, to the starting time of the non-linear simulation zstart. It is thus possible to
reduce the multi-species universe e.g., to just two species, total matter and massive
neutrinos (Zennaro et al. 2017), at ztarget, evolve them backwards in time under the
linearised physics of the N-body code, and then provide ICs using the prescrip-
tion (73). The leading order evolution of the ‘active’ ﬂuids takes into account scale-
dependent growth and agrees reasonably well at high redshifts with the full EB
solution. The limitation of this approach is that any decaying modes that are present
at ztarget must still be small at zstart. This can be achieved well for neutrinos [with sub
per cent errors for zstart.100 with P mm.0:3 eV, see Zennaro et al. (2017)] due to
their small contribution to the total energy budget, but is more limited e.g., for
baryons. Again, this approach is then restricted to being used for ﬁrst order accurate
displacements and velocities as only linear ﬁelds are known.
Backscaling method The arguably simplest approach, the back-scaling method,
avoids the complications of differences of physics. At the same time, it is the one
rigorously consistent with Lagrangian perturbation theory. It is also the traditionally
used approach to set up N-body ICs. In this method, one uses the Einstein–
Boltzmann code to evolve the linear multi-physics equations to a target redshift
ztarget and then re-scales the total matter perturbation dEBðztargetÞ as output by the EB-
code to arbitrary times using the linear theory growth factor deﬁned by Eq. (20) as
~dmðk; zstartÞ ¼ DþðzstartÞ
DþðztargetÞ
~dEB
m ðk; ztargetÞ:
ð74Þ
The main advantage of this approach is that by deﬁnition the correct linear theory is
obtained in the vicinity of z ¼ ztarget including e.g., relativistic and neutrino effects,
without having to include this physics into the N-body code. This comes at the price
that at early times, it might not in general agree with the full EB solution since a
plethora of modes captured by the higher-dimensional EB system are reduced to
scale-independent growth under the linear growing mode only. However, this is not
a problem if non-linear coupling is unimportant, which is an excellent assumption
123
Large-scale dark matter simulations
Page 55 of 200
1

precisely at early times. Backscaling can also be rigorously extended to simulations
including multiple ﬂuids coupled through gravity (Rampf et al. 2021b) by including
additional isocurvature modes. It can in principle also account for scale-dependent
evolution if it can be modelled at the Dþðk; aÞ level. This method, w.r.t. the total
matter ﬁeld in KCDM agrees exactly with the ‘backward method’ above if the
decaying mode is neglected. Arguably the biggest advantage of the backscaling
method is that it connects naturally with high order Lagrangian perturbation theory,
as we will discuss next.
6.2 Initial conditions from Lagrangian perturbation theory
With the increasing precision requirements of N-body simulations over the last 20
years, it quickly became clear that ﬁrst order accurate initial conditions are
insufﬁcient. Those are ICs that follow Eq. (73), which together with the back-scaled
input spectrum from Eq. (74) amounts to the Zel’dovich approximation (ZA;
Zel’dovich 1970). The reason is that linear ICs suffer from signiﬁcant transients—
decaying truncation errors between the ICs and the true non-linear evolution
(Scoccimarro 1998; Crocce et al. 2006)—since higher order non-Gaussian moments
of the density distribution are not accurately captured (see discussion in Sect. 8.3).
Higher order is needed to follow correctly the higher order moments of the density
distribution, i.e. ﬁrst order captures only the variance, second in addition also the
Fig. 8 The power spectrum of various ﬁelds contributing to displacements in Lagrangian Perturbation
Theory up to 3rd order. The top panel shows the power spectrum of r2/ð2Þ that contributes to the 2nd-
order displacements (cf. Eq. 77), whereas the bottom left and right panel show the spectrum of r2/ð3aÞ
and r2/ð3bÞ which correspond to the ﬁrst and second terms of the 3rd order LPT contribution /ð3Þ, given
in Eq. (6.2). In each case we display the results measured in a 250h1Mpc and 1000h1Mpc boxes, with
and without correct de-aliasing, as indicated by the ﬁgure. The ratio between the aliased and de-aliased
solutions with respect to the analytic expectation is shown in the bottom panels Image reproduced with
permission from Michaux et al. (2021), copyright by the authors
123
1
Page 56 of 200
R. E. Angulo, O. Hahn

skewness and third even the kurtosis (Munshi et al. 1994). These ‘transients’ can
only be suppressed by going to very early starting times, when the linear Gaussian
approximation is accurate, at the cost of typically larger numerical errors (Michaux
et al. 2021). The alternative to early starts is to go to higher order perturbation
theory beyond the ZA, where the displacement ﬁeld W of the Lagrangian map,
xðq; sÞ ¼ q þ Wðq; sÞ, is expanded in a Taylor series to order n in the linear theory
growth factor Dþ yielding the nLPT approximation
Wðq; sÞ ¼
X
n
j¼1
DþðsÞj WðjÞðqÞ:
ð75Þ
This includes only growing modes, but remains regular as Dþ ! 0, i.e. a ! 0, with
the key property that x ! q, i.e. the initial state is indeed a homogeneous unper-
turbed universe. Since the density is uniform in the a ! 0 limit (where the limit is
taken in the absence of radiation, otherwise one can use a 	 102 during matter
domination for simplicity), the growing mode perturbations are at leading order
encapsulated in a single potential /ð1ÞðqÞ which can be connected to the back-
scaling relation from above to the EB code output. This yields the famous ‘Zel’-
dovich approximation’
Wð1Þ ¼ $/ð1Þ
with
/ð1Þ :¼ r2 lim
a!0
DþðaÞ
a
dmðq; aÞ;
ð76Þ
that can be used to set up simulation initial conditions by displacing Lagrangian
ﬂuid elements (e.g., N-body particles) consistent with W and giving them velocities
according to _W. Inserting this ansatz order by order in Eq. (25) returns the well
known order-truncated n-th order LPT forms. Speciﬁcally, the 2LPT contribution to
the displacement ﬁeld has the form
Wð2Þ ¼ $/ð2Þ
with
/ð2Þ ¼  3
14 r2 /ð1Þ
;ii /ð1Þ
;jj  /ð1Þ
;ij /ð1Þ
;ij
h
i
;
ð77Þ
while at third order, i.e. 3LPT, the displacement ﬁeld starts to have both longitudinal
(i.e. irrotational) and transverse (i.e. solenoidal) components (Catelan 1995; Rampf
and Buchert 2012)
Wð3Þ ¼ $/ð3Þ þ $  Að3Þ
with
and
ð78Þ
The transverse part appears at 3LPT order and preserves the potential nature of the
ﬂow in Eulerian space. Newtonian gravity (i.e., Hamiltonian mechanics coupled to
only a scalar potential) cannot produce vorticity (i.e., it exactly preserves any that
might be present in the initial conditions, which however in cosmological context
would appear as a decaying mode that blows up as a ! 0). For the truncated nLPT
series this is only true at the respective order, i.e. $x  v ¼ $x  _W ¼ OðDn
þÞ
(Uhlemann et al. 2019). For systems of more than one pressureless ﬂuid, this
approach can be readily generalised taking into account isocurvature modes to all,
123
Large-scale dark matter simulations
Page 57 of 200
1

and decaying modes to ﬁrst order currently (Rampf et al. 2021b; Hahn et al. 2021).
Note that the relations given above for nLPT have small corrections in KCDM
(Bouchet et al. 1995; Rampf et al. 2021b), which are however not important when
initial conditions are generated at z  1, when it is safe to assume an Einstein–
de Sitter cosmology.
In Fig. 8 we show the power spectrum of the source terms, r2/ðnÞ, for 2LPT and
3LPT. As expected, we see that the higher-order ﬁelds have signiﬁcantly smaller
amplitude than the linear-order density power spectrum. However, these higher-
order contributions are required to improve the faithfulness of the simulated ﬁeld
and are in fact important for correctly predicting certain cosmological statistics. In
addition, note that when computing the high-order potentials /ðnÞ and AðnÞ (with
n 
 2) some care has to be taken to avoid aliasing (Orszag 1971; Michaux et al.
2021; Rampf and Hahn 2021), which can be important even on large scales, as
shown in the bottom panels of Fig. 8.
Note that recently, Rampf and Hahn (2021) were the ﬁrst to numerically
implement the full nLPT recursion relations so that ﬁelds to arbitrary order can be
used for ICs in principle, only limited by computer memory. This is included in the
publicly-available MONOFONIC MUSIC-2 code15.
6.3 Generating Gaussian realisations of the perturbation fields
The previous results were generic, for numerical simulations, one has to work with a
speciﬁc realisation of the Universe, which we will discuss next. The speciﬁc case of
the realisation of our Universe is discussed as well.
6.3.1 Unconstrained realisations
Many inﬂationary cosmological models predict that scalar metric ﬂuctuations are
very close to Gaussian (Maldacena 2003; Acquaviva et al. 2003; Creminelli 2003).
As we have shown above, Lagrangian perturbation theory, focusing on the fastest
growing mode, is built up from a single initial scalar potential /ð1Þ as deﬁned in
Eqs. (74) and (75), while the forward and backward approaches work with multiple
ﬁelds dm, hm, and possibly others. These specify expectation values for a random
realisation. Since these are all linear ﬁelds (i.e. we can assume that non-linear
corrections can be neglected at a ¼ 0 for back-scaling, and at astart for the forward
and backward method) they will be statistically homogeneous and isotropic
Gaussian random ﬁelds fully characterised by their two-point function. A general
real-valued Gaussian homogeneous and isotropic random ﬁeld /ðxÞ can be written
as the Fourier integral
15 Available from https://bitbucket.org/ohahn/monofonic.
123
1
Page 58 of 200
R. E. Angulo, O. Hahn

/ðxÞ ¼
1
ð2pÞ3
Z
R3 d3k eikx ~uðkÞ ~
WðkÞ;
ð79Þ
where
~
WðkÞ is a complex-valued three-dimensional random ﬁeld (also known as
‘‘white noise‘‘ since its power spectrum is k independent) with
~
WðkÞ ¼ ~
WðkÞ;
h ~
WðkÞi ¼ 0;
and
h ~
WðkÞ ~
Wðk0Þi ¼ dDðk  k0Þ;
ð80Þ
and ~uðkÞ is the (isotropic) ﬁeld amplitude in Fourier space as computed by the
Einstein–Boltzmann code. This is often given in terms of a transfer function ~TðkÞ
which is related to the ﬁeld amplitude as ~uðkÞ / kns=2 ~TðkÞ, where ns is the spectral
index of the primordial perturbations from inﬂation. If the power spectrum P(k) is
given, then setting ~uðkÞ ¼ ð2pÞ3=2
ﬃﬃﬃﬃﬃﬃﬃﬃﬃ
PðkÞ
p
yields the desired outcome
h ~/ðkÞ ~/ðk0Þi ¼ ð2pÞ3 PðkÞ dDðk  k0Þ:
ð81Þ
In order to implement these relations numerically, the usual approach when gen-
erating initial conditions is to replace the Fourier integral (79) with a discrete
Fourier sum that is cut off in the IR by a ‘box mode’ k0 ¼ 2p=L and in the UV by a
‘Nyquist mode’ kNy :¼ k0N=2 so that the integral can be conveniently computed by
Fig. 9 The nonlinear dark matter clustering at z ¼ 1 in simulations with different initial conditions. The
left panel shows the real-space power spectrum whereas the right panel shows the monopole and
quadrupole of the redshift space correlation function. Gray lines display the results for an ensemble of 300
simulations with random Gaussian initial conditions, whereas the symbols show the results from a single
Paired-&-Fixed pair of simulations. In the bottom panels we show the difference between the ensemble
mean and the Paired-&-Fixed results in units of the standard deviation of the ensemble measurements.
Note the drastic reduction of noise of this method, specially on large scales Image reproduced with
permission from Angulo and Pontzen (2016), copyright by the authors
123
Large-scale dark matter simulations
Page 59 of 200
1

a DFT of size N3. Naturally, ﬂuctuations on scales larger than the box and their
harmonics cannot be represented (but see below in Sect. 6.3.5). This is usually not a
problem as long as k0  kNL, where kNL is the scale where non-linear effects
become important, since then non-linearities can be assumed to not be strongly
coupling to unresolved IR modes and are also not sourced dominantly by the very
sparsely populated modes at the box scale (which would otherwise break isotropy in
the non-linear structure). For simulations evolved to z ¼ 0 this implies typically box
sizes of at least 300 h1Mpc comoving.
6.3.2 Reduced variance sampling
The noise ﬁeld ~
W naturally has a polar decomposition ~
WðkÞ ¼: ~AðkÞ eihðkÞ, where A
obeys a Rayleigh distribution (i.e. a v-distribution with two degrees of freedom) and
h is uniform on ½0; 2pÞ. The power spectrum associated with W transforms as
h ~
WðkÞ ~
Wðk0Þi ¼ h ~AðkÞ ~Aðk0Þi ¼ dDðk  k0Þ;
ð82Þ
i.e., it is independent of the phase h. In any one realization of ~
WðkÞ, one expects
ﬂuctuations (‘‘cosmic variance’’) in h ~
WðkÞ ~
Wðk0Þi around the ensemble average of
the order of the inverse square root of the number of discrete modes in some ﬁnite
interval k. . .k þ dk available in the simulation volume.
The amplitude of this cosmic variance can be dramatically reduced by simply
ﬁxing A to its expectation value (Angulo and Pontzen 2016), i.e., by ‘sampling’ A
from a Dirac distribution AðkÞ ¼ dDðkÞ. This technique is commonly referred to as
‘‘Fixing’’. Clearly, the resulting ﬁeld has much reduced degrees of freedom and a
very speciﬁc non-Gaussian character. In principle, this introduces a bias in the
nonlinear evolution of such a ﬁeld, e.g., the ensemble averaged power spectrum at
z ¼ 0 differs from that obtained from an ensemble of Gaussian realizations.
However, using perturbation theory, Angulo and Pontzen (2016) showed that the
magnitude of this bias in the power spectrum and bispectrum is always smaller (by a
factor equal to the number of Fourier modes) compared to mode-coupling terms of
physical origin. In fact, it was found empirically that simulations initialised with
such ICs produce highly accurate estimates of non-linear clustering (including
power spectra, bispectra, halo mass function, and others) and that the level of
spurious non-Gaussianity introduced is almost undetectable for large enough
simulation boxes (Angulo and Pontzen 2016; Villaescusa-Navarro et al. 2018;
Klypin et al. 2020).
The main advantage of ‘‘Fixing’’ is that it allows to avoid giant boxes or large
ensembles of simulations in order to obtain measurements with low cosmic
variance. A further reduction in cosmic variance can be achieved by considering
pairs of simulations where the second simulation is initialised with ~
WðkÞ instead of
~
WðkÞ (Pontzen et al. 2016; Angulo and Pontzen 2016). This is equivalent to
inverting the phase h, and averages out the leading order non-linear term
contributing to cosmic variance (Pontzen et al. 2016). This technique has been
adopted in several state-of-the-art dark matter and hydro-dynamical simulations
123
1
Page 60 of 200
R. E. Angulo, O. Hahn

(Angulo et al. 2021; Chuang et al. 2019; Euclid Collaboration 2019; Anderson et al.
2019).
The performance of this approach in practice is shown in Fig. 9 which compares
the z ¼ 1 power spectrum and multipoles of the redshift space correlation function.
The mean of 300 L ¼ 3000h1Mpc simulations is displayed as a solid line whereas
the prediction of a single pair of ‘ﬁxed’ simulations is shown as red circles. In the
bottom panels we can appreciate the superb agreement between both measurements,
with relative differences being almost always below one per cent.
6.3.3 Numerical universes: spatially stable white noise fields
A key problem in generating numerical realisations of random ﬁelds is that certain
properties of the ﬁeld should not depend on the exact size or resolution of the ﬁeld
in the numerical realisation. This means that it is desirable to have a method to
generate white Gaussian random ﬁelds which guarantees that the large-scale modes
remain identical, no matter what the resolution of the speciﬁc realisation. A further
advantage is gained if this method can be parallelised, i.e. if the drawing does not
necessarily have to be sequential in order to be reproducible. This problem has
found several solutions, a selection of which we discuss below.
N-GENIC (Springel et al. 2005)16 and derivates produce spatially stable white
noise by drawing white noise in Fourier space in a reproducible manner. I.e. for two
simulations with kNy and k0
Ny [ kNy, all modes that are representable in both, i.e.
kNy  kx;y;z  kNy, are identical, and for the higher resolution simulation, new
modes are added between k0
Ny  kx;y;z\  kNy and kNy\kx;y;z  k0
Ny. The random
number generation is parallelised by a stable 2?1 decomposition of Fourier space.
A shortcoming of this approach of sampling modes is that drawing in Fourier space
is inherently non-local so that it cannot be generalised to zoom simulations, where
high-resolution is desired only in a small subvolume, without generating the full
ﬁeld ﬁrst.
PANPHASIA (Jenkins 2013)17 has overcome this shortcoming by relying on a
hierarchical decomposition of the white noise ﬁeld in terms of cleverly chosen
octree basis functions. Essentially instead of drawing Fourier modes, one draws the
coefﬁcients of this hierarchical basis thus allowing to add as much small-scale
information as desired at any location in the three-dimensional volume.
MUSIC-1 (Hahn and Abel 2011) subdivides the cubical simulation volume into
subcubes for which the random numbers can be drawn independently and in parallel
in real space, since each cube carries its own seed. Reﬁned regions are combined
with white noise from the overlapping volume from the coarser levels, just as in the
N-GENIC approach, thus enforcing the modes represented at the coarser level to be
present on the ﬁner level.
16 Available from https://www.h-its.org/2014/11/05/ngenic-code/.
17 The stand-alone FORTRAN library can be downloaded from http://icc.dur.ac.uk/Panphasia.php, but it is
also built into the publicly available MUSIC-2 IC-code.
123
Large-scale dark matter simulations
Page 61 of 200
1

6.3.4 Zoom simulations
In cases in which the focus of a simulation is the assembly of single objects or
particular regions of the universe, it is neither desirable nor affordable to achieve the
necessary high resolution throughout the entire simulation volume. In such
situations, ‘zoom simulations’ are preferable, where the (mass) resolution is much
higher in a small sub-volume of the entire box. This can be achieved in principle by
generating high-resolution initial conditions, and then degrading the resolution
outside the region of interest [as followed e.g. by the ZINCO code (Garaldi et al.
2016)]. This approach is, however, limited by memory, and for deeper zooms,
reﬁnement methods are necessary. The basic idea is that in the region of interest
nested grids are inserted on which the Gaussian noise is reﬁned. Some special care
must be taken when applying the transfer function convolution and resolution of the
Poisson equation. Such approaches were pioneered by Katz et al. (1994),
Bertschinger (2001), and then extended to higher accuracy and 2LPT perturbation
theory using a tree-based approach by Jenkins (2010) which is implemented in a
non-public code used by the VIRGO consortium, and using multi-grid techniques by
Hahn and Abel (2011) in the publicly available MUSIC-1 code18. A recent addition
is the GENET-IC code19 (Stopyra et al. 2021) that focuses on the application of
constraints (cf. Sect. 6.3.7) to such zoom simulations but currently only supports
ﬁrst order LPT. An example of a particularly deep zoom simulation is the ‘voids in
voids’ simulation shown in Fig. 13.
6.3.5 Super-sample covariance and ensembles
On the scale of the simulated box, the mean overdensity and its variance are
expected to be non-zero for realistic power spectra. This is a priori in contradiction
with periodic boundary conditions (but see Sect. 6.3.6) and so the mean overdensity
of the volume in the vast majority of cosmological simulations is enforced to be
zero for consistency. Hence, when an ensemble of simulations is considered, the
variance of modes k\k0 is zero despite all of them having different initial white
noise ﬁelds and providing fair ensemble averages for modes k0.k.kNy. This
implies that the component of the covariance that is due to large-scale overdensities
and tides is underestimated (Akitsu et al. 2019) which is sometimes referred to as
super-sample covariance—in analogy to a similar effect present in galaxy surveys
(Li et al. 2018)—, and can be an important source of error in covariance matrices
derived from ensembles of simulations, especially if the simulated boxes are of
small size (Klypin and Prada 2019). Such effects can be circumvented in ‘‘separate
universe’’ simulations that are discussed in Sect. 6.3.6.
Furthermore, it is important to note that for Fourier summed realisations of /, the
correspondence between power spectra and correlation functions is broken since the
discrete (cyclic) convolution does not equal the continuous convolution, i.e.,
18 Available from https://bitbucket.org/ohahn/music.
19 Available from https://github.com/pynbody/genetIC.
123
1
Page 62 of 200
R. E. Angulo, O. Hahn

/ðxÞ 6¼ /KðxÞ :¼ DFT1
~
WðkÞ ~/ðkÞ
h
i
ð83aÞ
/ðxÞ 6¼ /RðxÞ :¼ DFT1
~
W


~/ðkxkÞ
ð83bÞ
where ‘~’ symbolises a discrete cyclic convolution. This implies that real space
and Fourier space statistics on discrete ﬁnite numerical Universes coincide neither
with one another nor with the continuous relation. It is always possible to consider
such real space realisations /R instead of Fourier space realisations /K (Pen 1997;
Sirko 2005). In the absence of super-sample covariance, the correct statistics is
always recovered on scales k0  k  kNy. Since the real-space kernel /ðrÞ is
effectively truncated at the box scale, it does not impose the box overdensity to
vanish and therefore also samples density ﬂuctuations on the scale of the box, which
must be absorbed into the background evolution (cf. Sect. 6.3.6).
The real-space sampling, by deﬁnition, reproduces the two-point correlation
function also in smaller boxes if one allows the mean density of the box to vary. In
fact, Sirko (2005) argued that this approach yields better convergence on statistics
that depend more sensitively on real-space quantities (such as the halo mass
function that depends on the variance of the mass ﬁeld on a given scale), and also an
accurate description of the correlation function for scales rJLbox=10. However,
Orban (2013) demonstrated that the correct correlation function can still be correctly
recovered by accounting for the integral constraint in correlation function
measurements,
i.e.
by
realising
that
the
/K
sampling
implicitly
imposes
R R
0 r2nðrÞdr ¼ 0 already over a scale R related to the box size Lbox instead of
only in the limit R ! 1. A better estimator can therefore be obtained by simply
subtracting this expected bias.
Note that an alternative approach to account for non-periodic boundary
conditions have been recently proposed (Ra´cz et al. 2018, 2019). In such
‘compactiﬁed’ simulations an inﬁnite volume is mapped to the surface of a four-
dimensional hypersphere. This compactiﬁed space can then be partitioned onto a
regular grid with which it is possible to simulate a region of the universe without
imposing periodic boundary conditions. This approach has the advantage for some
applications that it naturally provides an adaptive mass resolution which increases
near to the center of the simulation volume where a hypothetical observer is located.
6.3.6 Separate universe simulations
How small scales are affected by the presence of ﬂuctuations on larger scales is not
only important to understand ﬁnite-volume effects and ensembles of simulations, as
we discussed in the previous section, but it also is a central question for structure
formation in general. For instance, this response is an essential ingredient in models
for biased tracers or in perturbation theory. These interactions can be quantiﬁed in
standard N-body simulations, however, a method referred to as ‘‘separate universe
simulations’’ provides a more controlled way to carry out experiments where
perturbations larger than the simulated volume are systematically varied to yield
accurate results even with modest simulation volumes. A key advantage of the
123
Large-scale dark matter simulations
Page 63 of 200
1

separate universe technique is that it allows to quantify the dependence of small-
scale structure formation on large-scale perturbations. For instance, changing the
effective mean density, e.g., of two simulations to þd0 and d0, one can compute
the response of the power spectrum by taking a simple derivative dP=dd0 ’
ðPðk; þd0Þ  Pðk; d0ÞÞ=2d0 (e.g., Li et al. 2014), which can be extended also to
higher orders.
The main idea behind the separate universe formalism (Sirko 2005; Baldauf et al.
2011; Sherwin and Zaldarriaga 2012; Li et al. 2014; Wagner et al. 2015; Baldauf
et al. 2016) is that a long wavelength density ﬂuctuation can be absorbed in the
background cosmology. In other words, larger-than-box ﬂuctuations simply lead to
a non-zero overdensity d0 ¼ const: of the box that must be absorbed into the
background density in order to be consistent with the periodic boundary conditions
of the box, i.e., one matches
qðaÞ½1 þ DþðaÞd0 ¼: qðaÞ;
ð84Þ
and thus structure in a given region embedded inside a region of overdensity d0
(today, i.e. at a ¼ 1) is equivalent to that of an isolated region of the universe
evolving with a modiﬁed set of cosmological parameters indicated by ‘’. Speciﬁ-
cally, the modiﬁed Hubble parameter, and matter, curvature, and dark energy
density parameters become

H0 :¼ H0DH;
Xm :¼ XmD2
H ;
XK :¼ 1  D2
H ;
XK :¼ XKD2
H ;
ð85Þ
where for a simulation initalised at aini
DH :¼
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
1  5Xm
3
DþðainiÞ
aini
d0
s
:
ð86Þ
Note
that
although
these
expressions
are
exact,
solutions
only
exist
for
d0\
3
5Xm
aini
DþðainiÞ. For larger background densities, the whole region is expected to
collapse. An important aspect is that the age of the universe should match between
the separate universe box and that of the unperturbed universe, thus the scale factors
are not identical but relate to each other as
a :¼ a 1  1
3 DþðaÞd0


:
ð87Þ
Also, when initialising a simulation, the perturbation spectrum from which the ICs
are sampled should be rescaled with the growth function

DþðaÞ based on the
‘separate universe’ cosmological parameters.
Separate universe simulations have been successfully applied to many problems,
that can be roughly split into two groups. The ﬁrst group includes measurements of
the value and mass dependence of local and nonlocal bias parameters for voids and
halos. The second group includes quantiﬁcation of the response of the nonlinear
power spectrum and/or bispectrum to global processes. For instance, Barreira et al.
(2019) studied the role of baryonic physics on the matter power spectrum. Other
123
1
Page 64 of 200
R. E. Angulo, O. Hahn

studies include measurements of the linear and quadratic bias parameters associated
to the abundance of voids (Chan et al. 2020; Jamieson and Loverde 2019b); the
correlation between large-scale quasar overdensities and small-scale Ly-a forest
(Chiang et al. 2017); halo assembly bias (Baldauf et al. 2016; Lazeyras et al. 2017;
Paranjape and Padmanabhan 2017); and cosmic web anisotropy (Ramakrishnan and
Paranjape 2020).
Naturally, a simple change in the mean density only modiﬁes the isotropic
expansion. More realistically, a given volume will also be exposed to anisotropic
deformation due to a large-scale tidal ﬁeld. Schmidt et al. (2018) (see also Stu¨cker
et al. 2021c; Masaki et al. 2020; Akitsu et al. 2020) have demonstrated that such a
global anisotropy can be accounted for by a modiﬁcation of the force calculation in
numerical simulations. These simulations have been used to study the role of large-
scale tidal ﬁelds in the abundance and shape of dark matter halos and the response
of the anisotropic power spectrum, and will be very useful also for studies of
coherent alignment effects of haloes and galaxies which are important to understand
intrinsic alignments in weak gravitational lensing. We note that the separate
Universe approach can also be generalised to study the impact of compensated
isocurvature modes (where the relative ﬂuctations of baryons and dark matter
changes while leaving ﬁxed the total matter ﬂuctuations) or of modiﬁcations to the
primordial gravitational potential, as illustrated in Fig. 10.
Another limitation of the original separate universe formulation, is that the long
wavemode is assumed to evolve only due to gravitational forces. This means that
the scale on which d0 is deﬁned has to be much larger than any Jeans or free
streaming scale. This condition might be violated if, e.g., neutrinos are considered
since their evolution cannot be represented as a cold matter component. This
limitation was avoided in the approach of Hu et al. (2016), who introduced
additional degrees of freedom in terms of ‘‘fake’’ energy densities tuned to mimic
the correct expansion history and thus growth of the large-scale overdensity. This
approach has been applied to study inhomogeneous dark energy (Chiang et al. 2017;
Jamieson and Loverde 2019a) and massive neutrinos (Chiang et al. 2018).
δm(x, t)
4fNLφ(x)
δb(x)
δc(x)
Separate Universe δm
Separate Universe As
Separate Universe σ
ρm(t) →ρm(t) [1 + δL(t)]
As →As [1 + δAs]
δAs = 4fNLφL
ρb(t) →ρb(t) [1 + σL]
ρc(t) →ρc(t) [1 −fbσL]
Fig. 10 Schematic illustration of various kinds of Separate Universe simulations. Structure formation
embedded into a large-scale ﬂuctuation dL is equivalent to that of a simulation with a modiﬁed
background matter parameter, qm; structure formation with inside large-scale compensated isocurvature
ﬂuctuation, rL is equivalent to a modiﬁcation in the background baryon and cold dark matter densities, qc
and qm; and ﬁnally structure formation inside a large potential ﬂuctuation, as originated by primordial
non-gaussianity, can be captured in the Separate Universe formalism by a change in the amplitude of
ﬂuctuations As Image reproduced with permission from Voivodic and Barreira (2021), copyright by IOP
123
Large-scale dark matter simulations
Page 65 of 200
1

6.3.7 Real universes: constrained realisations
So far we have discussed how to generate random ﬁelds which produce numerical
universes in which we have no control over where structures, such as galaxy clusters
or voids, would form. In order to carry out cosmological simulations of a realisation
that is consistent with the observed cosmic structure surrounding us, it is therefore
desirable to impose additional constraints.This could, for instance, shed light on the
speciﬁc formation history of the Milky Way and its satellites, inform about regions
where a large hypothetical DM annihilation ﬂux is expected, or quantify the role of
cosmic variance in the observed galaxy properties [see Yepes et al. (2014) for a
review.]
The simplest way to obtain such constrained initial conditions is by employing
the so-called Hoffman–Ribak (HR) algorithm (Hoffman and Ribak 1991). Given an
unconstrained realisation of a ﬁeld /, we seek to ﬁnd a new constrained ﬁeld / that
fulﬁls M (linear) constraints. In general, this can be expressed in terms of kernels H
by requiring ðHjH /ÞðxjÞ ¼ cj, where cj is the desired value of the j-th constraint
centered on xj. The Gaussian ﬁeld / obeying these constraints can be found using
the Hoffman–Ribak algorithm (Hoffman and Ribak 1991) by computing
~/ðkÞ ¼ ~/ðkÞ þ PðkÞ ~
HiðkÞ n1
ij ðcj  cjÞ;
ð88Þ
with
cj ¼
1
ð2pÞ3
Z
R3 d3k ~
HjðkÞ ~/ðkÞ
and
nij ¼
1
ð2pÞ3
Z
R3 d3k ~
HiðkÞ ~
HjðkÞ PðkÞ;
ð89Þ
where cj is the covariance between constraint j and the unconstrained ﬁeld, and nij is
the M  M constraint covariance matrix (van de Weygaert and Bertschinger 1996;
see also Kravtsov et al. 2002 and Klypin et al. 2003 for further implementation
details). A possible constraint is e.g., a Gaussian peak on scale R at position xi so
that ~
HiðkÞ ¼ exp k2R2=2 þ ik  xi
½
, constraints on differentials and integrals of the
ﬁeld can be easily taken into account in the Fourier-space kernel.
Using this algorithm, various simulations were able to reproduce the local
distribution of galaxies and famous features of the local Universe such as the Local
and Perseus-Pices Superclusters, and the Virgo and Coma clusters as well as the
Great Attractor (e.g., Sorce et al. 2014). This is illustrated in the top left panel of
Fig. 11, which displays a simulation from the CLUES collaboration20 (Gottloeber
et al. 2010; Carlesi et al. 2016). Traditionally, the observational constraints were
mostly set by radial velocity data (which was assumed to be more linear than
density, thus more directly applicable for constraining the primordial density ﬁeld),
for instance, from dataset such as the ‘‘Cosmic Flows 2’’ (Tully et al. 2016).
A further technique related to constrained realisations has been termed as
‘genetic modiﬁcation’ (Roth et al. 2016; Stopyra et al. 2021). Its main idea is to
20 https://www.clues-project.org/.
123
1
Page 66 of 200
R. E. Angulo, O. Hahn

impose constraints, not in order to be compatible with the Local Universe, but to
perform controlled numerical experiments. For instance, the mass of a halo can be
altered by imposing a Gaussian density peak at the halo location with the desired
height and mass. In this way, it is possible to, e.g., isolate the role of speciﬁc
features (e.g., formation time, major merger, etc) in the formation of a halo or of the
putative galaxy it might host, seeking a better understanding of the underlying
physics.
The HR approach has several limitations, for instance, it does not account for the
Lagrangian–Eulerian displacements. A general problem of all reconstruction
methods is that small scales are difﬁcult to constrain since those scales have
Fig. 11 Various N-body simulations of initial ﬁelds constrained by local observations. The top left panel
shows one of the simulations of local Universe carried out by the CLUES collaboration, where the initial
conditions were constrained using the CosmicFlows observations (Tully et al. 2016). In the top right
panel we show a 200h1Mpc wide slice of the density ﬁeld in the ELUCID simulation (Wang et al. 2016).
The simulated dark matter is shown in a black-blue color scale whereas red/cyan symbols show the
location of red/blue galaxies in the SDSS DR7 observations. Similarly, in the bottom panel we show a
Mollweide projection of logð2 þ dÞ of a PM simulation whose initial conditions were set by requiring
agreement with the observations of the 2M?? catalogue (Lavaux and Hudson 2011) shown as red dots
Images reproduced with permission from [top left] CLUES, copyright by S. Gottlo¨ber, G. Yepes,
A. Klypin, A. Khalatyan; [top right] from Wang et al. (2016), copyright by IOP; and [bottom] from
Jasche and Lavaux (2019), copyright by IOP
123
Large-scale dark matter simulations
Page 67 of 200
1

shell-crossed in the z ¼ 0 Universe, so that information from distinct locations has
been mixed or even lost. Constrained simulations therefore resort to trial and error
by running many realisations of the unconstrained scales until a desired outcome is
achieved (e.g., a Milky Way Andromeda pair). To speed up this process, Sorce
(2020) recently proposed an important speed up by using pairs of simulation carried
out with the Paired and Fixed method (cf. Sect. 6.3.2), and Sawala et al. (2021a)
quantiﬁed the inﬂuence of unconstrained initial phases on the ﬁnal Eulerian ﬁeld.
Another improvement in terms of a ‘‘Reverse Zel’dovich Approximation’’ has been
proposed to estimate the Lagrangian position of local structure (Doumler et al.
2013a, b).
An alternative route to numerical universes in agreement with observations is
followed in Bayesian inference frameworks (Kitaura and Enßlin 2008; Jasche et al.
2010; Ata et al. 2015; Lavaux and Jasche 2016). In this approach, LPT models or
relatively low-resolution N-body simulations (Wang et al. 2014) are carried out as a
forward model mapping a random ﬁeld to observables. The associated large
parameter space of typically millions of dimensions of the IC ﬁeld is then explored
using Hamiltonian Monte Carlo until a realisation is found that compares favourably
with the observations. The white noise ﬁeld can then be stored and used for high
resolution simulations that can give insights into the formation history of the local
Universe. For instance, Heß et al. (2013), Libeskind et al. (2018), Sawala et al.
(2021b) simulated the initial density ﬁeld derived from observations of the local
Universe, and Wang et al. (2016), Tweed et al. (2017) created a constrained
simulation compatible with the whole SDSS DR7 galaxy distribution, which is
shown in the top right panel of Fig. 11.
6.4 Initial particle loads and discreteness
Given displacement and velocity ﬁelds from Lagrangian perturbation theory and a
random realisation of the underlying phases, one is left with imposing these
displacement and velocity perturbations onto a set of particles, i.e., a ﬁnite set of
initially unperturbed Lagrangian coordinates q1...N. These correspond to N-body
particles representing the homogeneous and isotropic initial state of the numerical
universe. Drawing the qj from a Poisson process would be the naive choice,
however, its intrinsic power spectrum is usually well above that of the matter
ﬂuctuations at the starting time, so that it introduces a large amount of stochastic
noise and is gravitationally unstable even in the absence of perturbations. Other
choices are regular Bravais lattices (a regular simple cubic grid being the most
obvious choice), which are gravitationally stable, have no stochasticity, but are
globally anisotropic. Higher-order Bravais lattices such as body-centered or face-
centered lattices are more isotropic than the simple cubic lattice. A gravitationally
stable arrangement with broken global symmetry can be obtained by evolving a
Poisson ﬁeld under a repulsive interaction (White 1994) until it freezes into a glass-
like distribution. The resulting particle distribution is more isotropic than a regular
lattice, and has a white-noise power spectrum on scales smaller than the mean inter-
particle separation, which decreases as k4 on larger scales and therefore has more
123
1
Page 68 of 200
R. E. Angulo, O. Hahn

noise than a Bravais lattice. Also other alternative initial particle loads have been
proposed, among them quaquaversal tilings (Hansen et al. 2007), and capacity
constrained Voronoi tessellations (CCVT, Liao 2018), both of which have a k4
power spectrum. Example initial particle distribution for various cases are shown in
Fig. 12.
After the creation of the initial particle load, the displacement Wðq1...NÞ and
velocity ﬁelds
_Wðq1...NÞ are interpolated to the particle locations q1...N, thereby
deﬁning the initial perturbed particle distribution with growing mode velocities at
the simulation starting time. In the case of Bravais lattices, the modes coincide
directly with the modes of the DFT in the case of the simple cubic lattice, so that no
interpolation is necessary, or can be obtained by Fourier interpolation. For the other
pre-initial conditions typically CIC interpolation is used, cf. Sect. 5.1.2. Since CIC
interpolation acts as a low-pass ﬁlter, the resulting suppression of power is usually
corrected by de-convolving the displacement and velocity ﬁelds with the CIC
interpolation kernel (Eq. 61b).
Since the symmetry of the ﬂuid is always broken at the particle discretisation scale,
the speciﬁc choice of pre-initial condition impacts the growth rate and growth isotropy
at the scale of a few particles. While in the Bravais cases, this deviation from the ﬂuid
limit is well understood (Joyce et al. 2005; Marcos et al. 2006; Marcos 2008), for glass,
CCVT and quaquaversal tilings such analysis has not been performed. One expects that
they are affected by a stochastic component in the growth rate with an amplitude
comparable to that of the regular lattices. Such deviations of the discrete ﬂuid from the
continuous ﬂuid accumulate during the pre-shell-crossing phase when the ﬂow is
perfectly cold so that over time the simulations, which are initialised with the ﬂuid
modes, relax to the growing modes of the discrete ﬂuid.
7 Beyond the cold collisionless limit: physical properties and models
for dark matter candidates
So far, in this review article we have focused on the case where all the mass in the
universe corresponds to a single cold and collisionless ﬂuid. This is also the
assumption of the vast majority of ‘‘dark matter only’’ or gravity-only simulations,
(a)
(b)
(c)
(d)
Fig. 12 Illustration in two dimensions of various particle distributions employed in the generation of
initial conditions for cosmological numerical simulations. From left to right: a regular simple cubic grid
lattice, a glass, and particle loads from quaquaversal tiling, and capacity constrained Voronoi tessellations
Image reproduced with permission from Liao (2018), copyright by the authors
123
Large-scale dark matter simulations
Page 69 of 200
1

and it is justiﬁed by the fact that gravity dominates long-range interactions, and that
dark matter is the most abundant form of matter in the Universe (Xc=Xm  84%).
In this section we discuss simulations where these assumptions are relaxed in
several ways, either to improve the realism of the simulated system, or to explore
the detectability and physics associated to the nature of the dark matter particle. In
each case, we brieﬂy discuss the physical motivation, its numerical implementation
along with potential modiﬁcations necessary to the initial conditions, and
summarise the main results.
In the ﬁrst part of this section we will discuss simulations where dark matter is
not assumed to be perfectly cold, but instead have a non-zero temperature as is the
case when made out of WIMPs, QCD Axions, or generically Warm Dark Matter.
We also discuss cases where dark matter is not a classical particle but made instead
of ultra light axion-like particles, or of primordial black holes. We also consider
cases where dark matter is not assumed to be perfectly collisionless, but instead
display microscopic interactions, such in the case of self-interacting and decaying
dark matter.
In the second part of this section we consider simulations that seek a more
accurate representation of the Universe. Speciﬁcally, we discuss simulations where
the mass density ﬁeld is composed of two distinct ﬂuids representing dark matter
and baryons, and simulations that include massive neutrinos. For completeness, we
also discuss simulations with non-Gaussian initial conditions and modiﬁed gravity.
7.1 Weakly-interacting massive particles
Historically, the favoured candidate for dark matter has been a weakly-interacting
massive particle (WIMP). WIMP is a generic name for a hypothetical particle with a
very cold distribution function due to its early decoupling and high mass (in the
GeV scale). For many decades, WIMPs were a strong contender to be the cosmic
DM, motivated by the observation that if the cross-section was set by the
electroweak scale, then it would result in a relic abundance matching the measured
density of dark matter in the Universe. This coincidence has been termed as the
‘‘WIMP miracle’’ [see Bertone et al. (2004) for a classic review]. However, the non-
detection of supersymmetric particles at the LHC to-date (Bertone 2010), and the
strong constraints from direct detection experiments begin to challenge the
explanation of dark matter through thermally produced WIMP particles (Rosz-
kowski et al. 2018). Nevertheless, massive WIMPs remain compatible with all
observational constraints and are one of the best motivated dark matter candidates.
See Bertone and Tait (2018) for a recent review of various experimental searches.
A concrete example of a WIMP in supersymmetric extensions to the Standard
Model is the lightest neutralino. These particles are stable and weakly interacting
and should have a mass in excess of J100 Gev. On astrophysical scales, neutralinos
can be described as a perfectly cold collisionless ﬂuid. However, the ﬁnite
temperature at which these particles decouple implies that they have small but non-
zero random microscopic velocities. As a consequence, neutralinos can stream
freely out of perturbations of sizes 	 0:7pc which means that the formation of halos
123
1
Page 70 of 200
R. E. Angulo, O. Hahn

of masses .108 M is strongly suppressed, and the typical mass of the ﬁrst halos to
collapse is about one Earth mass (Hofmann et al. 2001; Green et al. 2004; Loeb and
Zaldarriaga 2005).
For perfectly cold ﬂuids, the distribution function reduces to a Dirac-d-
distribution in momentum space, i.e., in any point in space there is a unique particle
momentum. This corresponds to the ‘‘single stream’’ or ‘‘monokinetic’’ regime as
usually referred to in ﬂuid mechanics and plasma physics (see also the discussion in
Sect. 2.5). For a warmer ﬂuid, such as that describing a neutralino ﬁeld, the cold
limit is also an excellent approximation for the distribution function. This is because
thermal random velocities are small compared to the mean velocities arising from
gravitational instability, specially at late times where the former are adiabatically
cooled due to the expansion of the Universe whereas the latter keep increasing due
to structure formation.
Consequently, numerical simulations of structure formation with neutralinos
assume them to be perfectly cold, follow them with traditional N-body integration
methods, and incorporate their free streaming effects only in the initial power
spectrum suppressing the amplitude of small scale modes. Note however, that the
very central parts of halos and caustics could be affected by intrinsic neutralino
velocity dispersion, providing e.g., maximum bounds on the density.
One important challenge associated with these types of simulations is the huge
dynamic range of the scales involved. For instance, to resolve the full hierarchy of
possible structures, it would require about 1023 N-body particles. For this reason,
neutralino simulations have focused on the formation of the ﬁrst structures at high
redshifts and over small volumes. Usually, these simulations involve zooming (cf.
Sect. 6.3.4) into the formation of a small number of halos (Diemand et al. 2005;
Ishiyama et al. 2009; Anderhalden and Diemand 2013; Ishiyama 2014; Angulo
et al. 2014). Another alternative is to carry out a suite of nested zoom simulations
(Gao et al. 2005), which has been recently extended to the free streaming mass by
Wang et al. (2020) by re-simulating low density regions embedded into larger
underdensities and so on. A selection of projected density ﬁelds from this simulation
suite are shown in Fig. 13 which displays progressive zooms by factors of 	 50 in
scale, from 10 Mpc to 50 pc.
Fig. 13 Progressive zooms onto smaller regions of a simulated nonlinear dark matter ﬁeld at z ¼ 0. From
left to right, each image shows a smaller region by factors of 5, 40, and 100. Note that in the rightmost
panel shows a region approximately 150 pc wide where the smallest visible clumps corresponds to the
smallest dark matter halos expected to form in an scenario where the dark matter particle is made out of
J100 GeV neutralinos. Image adapted from Wang et al. (2020)
123
Large-scale dark matter simulations
Page 71 of 200
1

There is a consensus from all these simulations that the ﬁrst microhalos have a
mass of about 106 M and start collapsing at a redshift of z 	 300. At those mass
scales and resfhifts, structure formation is different than at galactic scales: the
spectrum of CDM density ﬂuctuations has a slope close to 3, i.e. PðkÞ / k3,
which causes a large range of scales to collapse almost simultaneously. This also
implies that the formation of the ﬁrst microhalos is immediately followed by a rapid
mass growth and many major mergers. Whether these microhalos can survive tidal
forces inside Milky-Way halos is still an open question, which could have
implications for the detectability of a potential dark matter self-annihilation signal.
Another, perhaps unexpected, outcome of these simulations is that the density
proﬁle of these microhalos is signiﬁcantly different from that of halos on larger
mass scales. Ever since standard CDM simulations (i.e., those without any free-
streaming effects) reached adequate force and mass resolution, they revealed that
the internal density proﬁles of collapsed structures were well described by a simple
functional form (Navarro et al. 1997), referred to as NFW proﬁle, in terms of a
dimensionless radial coordinate x :¼ r=rs and density . :¼ qðrÞ=q0 (where rs and q0
are parameters that vary from halo to halo)
.ðxÞ ¼
1
xð1 þ x2Þ
ð90Þ
regardless of the mass of the halo, cosmic epoch, cosmological parameters, etc.
(Ascasibar and Gottlo¨ber 2008; Neto et al. 2007; Brown et al. 2020). Despite its
importance and several proposed explanations that involve, for instance, a funda-
mental connection with the mass accretion history (Ludlow et al. 2014, 2016),
maximum entropy or adiabatic invariance arguments (Taylor and Navarro 2001;
Dalal et al. 2010a; Pontzen and Governato 2013; El Zant 2013; Juan et al. 2014), or
even the role of numerical noise as the main driver (Baushev 2015), there is not yet
a consensus on the physical explanation behind this result. This is even more
puzzling when contrasted with analytic predictions, which suggest single power
laws as the result of gravitational collapse [see e.g., the self-similar solution of
secondary infall by Bertschinger (1985)].
In contrast, most neutralino simulations ﬁnd that the initial internal structure of
microhalos is better described by a single power law proﬁle 	 r1:5, as ﬁrst pointed
out by Diemand et al. (2005) (see also Ishiyama et al. 2009; Anderhalden and
Diemand 2013; Ishiyama 2014; Ogiya et al. 2016; Angulo et al. 2017; Delos et al.
2019). This very steep proﬁle would make microhalos very resilient to tidal
disruption by the Milky Way or by binary stars and also would enhance their
corresponding emission from dark matter self annihilation, making them potentially
detectable by future experiments (Diemand et al. 2006; Ishiyama et al. 2009;
Ishiyama 2014; Delos 2019), although their abundance is affected by free streaming
(Ishiyama and Ando 2020). This power-law proﬁle, however, quickly mutates to a
NFW-like proﬁle for higher mass halos. Several authors have argued that
subsequent mergers drive this transformation and determine the ﬁnal density
proﬁle (Ogiya et al. 2016; Angulo et al. 2017). These results have been further
supported by Colombi (2021) using the idealised collapse of three sine waves
123
1
Page 72 of 200
R. E. Angulo, O. Hahn

simulated with a Lagrangian tessellation algorithm. In contrast, Wang et al. (2020)
which is the only neutralino-like simulation that has reached z 	 0, ﬁnds density
proﬁles consistent with an NFW shape.
These inconsistencies among simulations leave the question about the ‘true’
density proﬁles of the ﬁrst halos forming in a WIMP dark matter model currently
unanswered. The role of numerical artefacts vs. physical processes (such as the
dynamical state of halos, their mass accretion histories, or environmental effects)
still need to be better understood. The alternative discretization methods discussed
in Sect. 3 might play an important role in this.
7.2 Axions
The QCD (Peccei–Quinn) axion is another hypothetical particle, originally proposed
to solve the strong charge-parity problem (see, Duffy and van Bibber 2009; Marsh
2016, for reviews), that has been considered as a possible dark matter candidate.
Axions, despite being very light (m 	 105–103 eV), are extremely cold due to
non-thermal production. Therefore they gravitationally cluster on small scales and
behave as cold dark matter on cosmological scales.
As for WIMPs, primordial ﬂuctuations in the axion ﬁeld exist down to very small
scales up to an eventual smoothing produced by free streaming velocities. In the
case of axions, this occurs on sub-parsec scales. The smallest structures are expected
to be ‘‘mini halos’’ of masses 1012 h1M (set roughly by the mass inside the
horizon when the axions become nonrelativistic) and 1012 cm radii. These minihalos
are even smaller than those in neutralino cosmologies and would form even earlier:
their typical collapse is expected to occur during the radiation dominated epoch of
the Universe at z 	 1000. If a large fraction of axion miniclusters survive tidal
disruption during structure growth, they could be potentially detected in femto- and
pico-lensing experiments (Kolb and Tkachev 1996; Fairbairn et al. 2018), or
alternatively, the resulting tidal streams could impact indirect and direct detection in
cavity experiments seeking to detect the transformation of axions into photons
(Tinyakov et al. 2016; O’Hare and Green 2017; Knirck et al. 2018). Therefore,
numerical simulations are required to explore structure formation and evolution of
axion structures.
Analogously to WIMPs and neutralinos, cosmological simulations including
axions assume them to be in the cold limit, i.e., to have zero velocity dispersion at
the starting redshift. The subsequent gravitational evolution can be followed by
standard N-body codes and algorithms, but because the ﬁrst halo collapse is
expected to occur on extremely small mass scales and even before the matter-
radiation equality, simulations typically have sizes of 	 1–10h1kpc and evolve
from zstart 	 106 up to z 	 100 where the ﬂuctuations on the scale of the box start to
become nonlinear.
The initial conditions of axion simulations are very different to that of standard
dark matter simulations. Whereas most dark matter ﬂuctuations are given by
adiabatic ﬂuctuations on all scales, the initial distribution of axions (on the small
scales targeted by axion simulations) is set by the formation and decay of
123
Large-scale dark matter simulations
Page 73 of 200
1

topological defects and axion self interactions after the QCD phase transition at the
end of inﬂation. Thus, the initial distribution is not predicted by e.g., Boltzmann
codes but has to be followed by QCD lattice simulations (Vaquero et al. 2019;
Buschmann et al. 2019). Because of these complications, only recently the ﬁrst self-
consistent cosmological simulation of the formation of structure in an axion dark
matter ﬁeld was carried out (Eggemeier et al. 2020; see Fig. 14). On large scales,
however, different patches of the universe would have been uncorrelated, and thus it
is common to assume the statistics to be given by a white-noise power spectrum
whose amplitude is set to match QCD axion simulations, and with a cut-off at
modes that entered the horizon when the axions were relativistic (Xiao et al. 2021).
These simulations ﬁnd that indeed axion miniclusters form at very high redshifts
(z [ 1500000) with an abundance that continuously grows covering a broad range of
masses, 1015–108 h1M at z 	 100. The abundance of axion miniclusters can be
reasonably well approximated by analytic arguments based on Press–Schechter and
Excursion set theory with the appropriate spectrum of ﬂuctuations. Such calcula-
tions allow an estimate of the abundance of these axion miniclusters down to
redshifts beyond the end of simulations. These axion miniclusters have density
proﬁles in reasonably good agreement with an NFW proﬁle and extremely high
concentrations c 	 100–400, consistent with the classical picture where concentra-
tion reﬂects the density of the universe at collapse.
These simulations make interesting predictions for the abundance and internal
properties of miniclusters at high redshifts. However, uncertainties exist that are
related to the survival of these halos to redshift zero and in an environment such as
that of the Milky Way in terms of the host halo tidal ﬁeld and stellar encounters.
Fig. 14 The projected mass ﬁeld at z ¼ 99 in a cosmological simulation assuming the dark matter is
composed of QCD axions. The left panel shows the whole simulation box of 0.86 pc, whereas the right
panel zooms into the largest axion minicluster of mass 	 109 h1M where the white circles denotes the
radius enclosing a mean density 200 times the background value. Note that, unlike most cosmological
simulations, there is a lack of ﬁlamentary structure owing to the scale-independent power spectrum of
ﬂuctuations expected in the primordial axion ﬁeld on the scales displayed by the left panel Image
reproduced with permission from Eggemeier et al. (2020), copyright by APS
123
1
Page 74 of 200
R. E. Angulo, O. Hahn

While perhaps the recursive-zooming techniques discussed in the previous section
could be extended to the axion scales, it would be a formidable computational
challenge. Another alternative could be to explore the impact of the tidal ﬁeld of the
Milky Way halo using, for instance, idealised simulation techniques that have been
employed to study the survival of CDM halos. Combining these tools it will be
possible to perform robust prediction for upcoming observations sensitive to the
axion structure.
7.3 Warm Dark Matter (WDM)
For both WIMPs and QCD axions, their microscopic nature has essentially no
implications for the properties of galaxies and for the observable large-scale scale
structure of the Universe. However, dark matter could be a particle whose mass and
free streaming scale is comparable to that of galaxies. Such particles are generically
referred to as warm dark matter and a concrete examples are sterile neutrinos or
gravitinos.
Additional motivation for considering dark matter alternatives, such as WDM, is
that the physical properties of DM could offer a solution to the tension between the
predictions of KCDM and observations of the abundance, spatial distribution, and
internal properties of dwarf galaxies (Klypin et al. 1999b; Moore et al. 1999; Zavala
et al. 2009; Power 2013; Papastergis et al. 2011, 2015; Klypin et al. 2015; Boylan-
Kolchin et al. 2011). Although baryonic physics and the effects of galaxy formation
are found to be able to resolve them even within CDM (or at least ameliorate the
tensions) (Navarro et al. 1996; Romano-Dı´az et al. 2008; Pontzen and Governato
2012; Brooks et al. 2013; Sawala et al. 2016; Brook and Di Cintio 2015; Chan et al.
2015), there is no consensus on the inevitability nor the magnitude of these effects
(Oman et al. 2015).
Constraining the mass of a hypothetical warm dark matter particle is an active
area of research. Currently, the most competitive methods are: i) the abundance of
Milky Way satellites, as measured by extragalactic surveys, ii) the small-scale
properties of intergalactic gas as measured by the Ly-alpha forest, and iii) the
abundance and properties of small halos and subhalos as measured by perturbations
to strong lensing systems. All these methods have different statistical power and
systematics, yet they agree on an upper limit for the dark matter free streaming
scale, which currently translates to a mass of about mvJ6keV for a thermal relic
(Enzi et al. 2021).
Since all these observations involve nonlinear structures, predictions from
numerical simulations are crucial for the robustness of these constraints. However,
as we will discuss below, simulations of WDM structure formation have
encountered serious challenges which are only now starting to be overcome.
As for the case of WIMPs, numerical simulations describe warm DM as a
perfectly cold ﬂuid but with an initial power spectrum modiﬁed to account for the
small-scale power suppression due to free streaming effects, erasing small-scale
ﬂuctuations below a characteristic free-streaming scale. These initial thermal
velocities will decay adiabatically so that they become irrelevant compared to
123
Large-scale dark matter simulations
Page 75 of 200
1

gravitationally induced velocities during structure formation. For instance, even for
a relatively warm particle of mv 	 250 eV, the velocity dispersion is expected to be
0.28 km/s, to be compared to about 100 to 1000 km/s of typical velocity dispersion
in galactic-sized halos. (Nevertheless, there have been attempts to directly sample
the WDM velocity in N-body simulations, however, this appears to introduce
signiﬁcant numerical noise, see e.g., Colı´n et al. 2008; Maccio` et al. 2012; Leo
et al. 2017 and our discussion regarding neutrinos in Sect. 7.8.2.) While small
during the time of the collapse of structures, the free streaming velocities impose
phase-space constraints (Tremaine and Gunn 1979), preventing the formation of
arbitrarily high densities in caustics and halo centers, in contrast to perfectly cold
CDM.
The most important signature of free streaming velocities in structure formation
is imprinted as a suppression in the transfer function relative to CDM. There have
been several parameterisations for this effect. One of the most widely-used is Bode
et al. (2001) for a WDM particle of mass mv and number of degrees of freedom gv
TWDMðkÞ ¼TCDMðkÞ  1 þ ða kÞ2m
h
i5=m
where
a ¼0:05 Xm
0:4

0:15

h
0:65

1:3
mv
1 keV

1:15 1:5
gv

0:29
h1Mpc;
ð91Þ
which is based on a ﬁt to a linear Einstein–Boltzmann calculation, and where m ’ 1–
1.2, but see also Schneider et al. (2013), Viel et al. (2005) for other popular
alternatives.
Fig. 15 The squared density ﬁeld of a simulated halo with mass 	 1:2  1012h1M assuming a cold
dark matter model in the left panel; and a warm dark matter in the right panel. In this WDM model,
ﬂuctuations below k ¼ 4:5h Mpc1 are suppressed, which consistent with dark matter being made of
resonantly-produced sterile neutrinos of mass 2 keV. Note that the suppression of small scale ﬂuctuations
induced by free streaming of warm dark matter results into a lack of low mass subhalos but caustics in the
halo outskirts become more visible Image reproduced with permission from Lovell et al. (2012),
copyright by the authors
123
1
Page 76 of 200
R. E. Angulo, O. Hahn

Warm DM simulations have shown that the abundance of halos decreases
exponentially with respect to that in CDM for scales below the half-mode mass,
deﬁned as the scale where the transfer function decreases by a factor of 2 with
respect to CDM. The abundance of subhalos also is strongly suppressed, though in a
smoother fashion owing to the mixture of mass scales caused by tidal stripping, i.e.,
a broad range of halo masses give origin to any given subhalo mass scale. The lack
of small scale structure also leads to a later collapse of halos, which simulations
have found is inherited as a reduction in the concentration of halos. These effects
can be appreciated in Fig. 15 which compares a zoom simulation of a Milky-Way
sized halo assuming a perfectly cold dark matter and a 	 2 keV WDM particle. The
lack of small scale structures and low mass subhalos in the WDM case, as discussed
above, is plainly visible. Finally, another interesting question concerns the internal
structure of WDM halos near the free streaming scale. As in the case of neutralino
simulations, simulations have found indications that WDM halos have inner density
proﬁles that are steeper than their CDM counterparts (Colı´n et al. 2008; Polisensky
and Ricotti 2015; Ogiya and Hahn 2018; Delos et al. 2019).
Warm Dark Matter simulations are also interesting from a theoretical point of
view, since the full hierarchy of nonlinear objects is within reach of a single
numerical simulations. Thus, they provide an ideal test-bed for numerical
convergence and the accuracy of simulations in general. This is in stark contrast
to standard N-body CDM simulation where the smallest resolved scale is always set
by numerical limitations rather than physical processes, i.e., the simulated transfer
has an effective small-scale cut-off at the scale of the mean inter-particle separation.
Unfortunately, WDM simulations have revealed a serious shortcoming of the N-
body method. Ever since the ﬁrst WDM simulations, they showed the presence of a
population of low-mass halos of purely numerical origin. These artiﬁcial fragments
dominate by factors of 100–1000 in number over those of physical origin (Klypin
et al. 1993; Avila-Reese et al. 2001; Bode et al. 2001; Wang and White 2007;
Angulo et al. 2012). This problem is ameliorated, but only slowly, with increasing
mass resolution, roughly as N1=3
p
(Wang and White 2007; Schneider et al. 2013). An
Fig. 16 The simulated density ﬁeld of Warm Dark Matter simulations illustrating the ‘‘artiﬁcial
fragmentation’’ problem. The left panel shows the result of a standard N-body simulation where dark
matter halos are highlighted as red circles. Note that ﬁlaments are broken up into pieces, which are
referred to as ‘‘artiﬁcial fragmentation’’, whose abundance increases high with higher resolution. These
fragments originate from discreteness errors in N-body simulations, which are considerably suppressed in
calculations employing phase-space tessellations as is shown in the right hand side panel. Image adapted
from Angulo et al. (2012)
123
Large-scale dark matter simulations
Page 77 of 200
1

illustration of these fragments is shown in Fig. 16, where we can see in the bottom
left region of the image that a vertical ﬁlament has been split into small halos,
highlighted by the red circles. These fragments likely originate from correlated and
highly anisotropic force errors driven by particle discreteness in regions of
anisotropic collapse (Hahn et al. 2013; Power et al. 2016).
There have been several attempts to solve the problem of artiﬁcial fragmentation.
At a practical level, there are proposals based on identifying and removing artiﬁcial
halos according to their Lagrangian properties or by comparing the results of
simulations at different mass resolutions (Lovell et al. 2014; Schneider et al. 2013).
At a more fundamental level, there are proposals to improve simulation techniques
and directly prevent the formation of these spurious micro-halos. Although with
limited success, these proposals include adaptive softening based on the local
density (Power et al. 2016) and anisotropic softening based on the local moment of
inertia (Hobbs et al. 2016). Another interesting idea was proposed by Myers et al.
(2016) who showed that the key to accurate N-body simulations is a decorrelation in
time of discretization errors. This was achieved by adding an artiﬁcial velocity
dispersion to particles and periodically remapping the set of N-body particles. To
our knowledge, however, this idea has only been investigated in up to 2D and in
idealised test problems. Among all the proposed solutions, perhaps the most
successful has come from the reformulation of the N-body method in terms of
Lagrangian phase-space elements (see Sect. 3.2).
In the context of Warm Dark Matter, Angulo et al. (2013b) showed that by using
these Lagrangian methods it was possible to properly quantify the mass function
below the cut-off scale. More recently, Stu¨cker et al. (2021b) extended these results
as a function of the properties of the cut-off in the initial transfer function by using a
hybrid Lagrangian-N-body approach (Stu¨cker et al. 2020), where dynamically
simple regions, such as ﬁlaments, voids, and sheets are evolved using a phase-space
interpolation whereas halos are simulated using N-body discretization. The lack of
artiﬁcial fragments in these simulations have also allowed to investigate in more
detail the observability of warm dark matter in general and in lensing in particular
(Richardson et al. 2021).
One might be concerned that artiﬁcial fragments could affect the properties of
larger halos that have accreted them (e.g., by gravitationally heating their centers).
These new generation of Lagrangian simulations are, however, demonstrating that
these effects are small and that the N-body method is reliable for halos whose mass
is above those dominated by artiﬁcial fragmentation. This is an important validation
for current constraints on the WDM particle mass, which heavily rely on the
correctness of N-body simulations.
7.4 Fuzzy Dark Matter: Quantum Hamiltonians and condensates
A particle can no longer be treated as classical in cosmological context if it is so
light that its de Broglie wavelength corresponds to astrophysical scales. If the
particle has a high enough number density, then occupation numbers will be so high
that it can form a Bose–Einstein-Condensate. Speciﬁc examples are generic ultra-
light bosons with a wave length of 	 10 kpc (Press et al. 1990; Frieman et al. 1995)
123
1
Page 78 of 200
R. E. Angulo, O. Hahn

and ultralight axions with masses mJ1023eV arising from string theory, e.g.,
Svrcek and Witten (2006). All these candidates are generically referred to as ‘Fuzzy
Dark Matter’ (FDM) and have the distinctive property that they display genuine
quantum effects on astrophysical scales (see Marsh 2016; Hui 2021; Ferreira 2021
for recent reviews).
These quantum effects lead to a suppression of small scale structure (due to an
effective ‘‘quantum pressure’’), and as a consequence claims have been made that
FDM can alleviate various of the small-scale problems of CDM mentioned in
Sect. 7.3, qualitatively similar to WDM (cf. Hui et al. 2017 for an overview). On the
other hand, constraints from comparing hydrodynamical simulations with observa-
tions of the Ly-a forest (Irsˇicˇ et al. 2017a; Armengaud et al. 2017) currently rule out
masses smaller than 1021 eV, which is higher than what is needed to solve these
problems (Kobayashi et al. 2017). Note, however, that these simulations only model
the effects of FDM on the initial transfer function and neglect the effect of quantum
pressure in their dynamics, thus there is a debate whether this could affect these
constraints (Zhang et al. 2018a; Armengaud et al. 2017; Nori et al. 2019).
Nonetheless, ultralight axions remain an interesting dark matter candidate with a
distinct signature due to the associated large-scale quantum effects, and that could
co-exist together with other forms of dark matter. As for other DM candidates, the
observable signatures of FDM are located in the non-linear regime, thus accurate
simulation is essential to rule out or eventually constrain the properties of FDM.
Fuzzy dark matter is described by the Schro¨dinger–Poisson (SP; also known as
Gross–Pitaevskii–Poisson in the context of condensates) system for a single
complex wave function w. This is the non-relativistic limit of a Klein–Gordon ﬁeld
after averaging over rapid oscillations of the scalar ﬁeld, leaving two scalar degrees
of freedom (amplitude and phase). The resulting system is typically expressed
through a Hamiltonian of the form
^
H ¼
^p2
2ma2 þ m
a
^V þ km
a3 ð1 þ dÞ
with
r2V ¼ 3
2 H2
0Xmd;
and
d ¼ w
j j21;
ð92Þ
where k represents a possible self-coupling of the ﬁeld, and the expansion of the
Universe has already been subtracted out as for the co-moving Vlasov–Poisson
system. Alternatively, it is possible to transform the SP equations into ﬂuid equa-
tions which resemble those of a classical ﬂuid with an additional ‘quantum pressure’
term so that:
ou
ot þ 1
a ðu  $Þu ¼  1
a $V  1
a3 $Q
with
Q :¼  h
2m
r2
ﬃﬃﬃq
p
ﬃﬃﬃq
p
ð93Þ
where m is the axion mass, q :¼ 1 þ d ¼ jwj2 the density, and u :¼ h
m $argðwÞ is the
velocity. Q can be regarded as a ‘quantum pressure’ term (prominent in Bohmian
quantum mechanics) and is in general singular wherever quantum interference
effects are present (since phase jumps, argðwÞ þ 2p, are accompanied by q ! 0).
123
Large-scale dark matter simulations
Page 79 of 200
1

This equation together with the continuity equation for q are also known as the
Madelung formulation (Madelung 1927) of quantum mechanics.
The ﬁrst aspect to consider in FDM numerical simulations is the effect on the
initial conditions. At linear order, Q ’  h
4m r2d which introduces an effective Jeans
length below which structure growth is suppressed:
kJ ¼
16pGqbm2
h2

1=4
’
a¼aeq9 Mpc1
m
1022eV

1=2
;
ð94Þ
where qb is the physical mater density, and aeq is the expansion factor at matter-
radiation equality. The exact effect on the initial transfer function can be computed
directly including the relevant modiﬁcations to Boltzmann solvers (e.g., AXION-
CAMB, Hlozek et al. 2015), or approximated as
TFDMðkÞ  TCDMðkÞ 
cos x3
1 þ x8


ð95Þ
where x ’ 1:61ðm=1022Þ1=18k=kJðaeqÞ (Hu et al. 2000).
There are essentially two approaches in the literature to follow the nonlinear
evolution of the axion ﬁeld. The ﬁrst one is to directly solve the associated
Schro¨dinger equation for the complex ﬁeld w. Essentially, these codes adopt
Eulerian discretisation schemes where the axion ﬁeld is described on a (static or
moving, ﬁxed or adaptive) grid (Schive et al. 2014; Schwabe et al. 2016; Mocz
et al. 2017; Edwards et al. 2018; Veltmaat et al. 2018; Mina et al. 2020; May and
Springel 2021). We have discussed schemes for the numerical integration in
Sect. 4.3. The integrator receives modiﬁcations if self-interactions of the ﬁeld
(k 6¼ 0) are included. Spectral Eulerian approaches are limited by their lack of
spatial adaptivity, so that all recent Eulerian schemes resort to ﬁnite difference
approximations with AMR or hybrid schemes.
An arguably simpler approach has been followed by other authors by resorting to
the Madelung formulation and including the quantum pressure term using an SPH-
based estimate (Veltmaat and Niemeyer 2016; Mocz and Succi 2015; Nori and
Baldi 2018; Zhang et al. 2018b; Hopkins 2019). Due to the singular nature of the
quantum pressure term, this approach will have difﬁculty to resolve quantum
interference effects, which has put some doubts on the results (but see below).
During phases of smooth evolution without topological changes (Mocz and Succi
2015) have shown that SPH methods can capture the evolution accurately. This
technique has been successfully employed to obtain the ﬁrst FDM constraints from
the Ly-a forest (Irsˇicˇ et al. 2017b; Nori et al. 2019) (arguably since these constraints
are more sensitive to the suppression of perturbations already in the initial
conditions rather than details of the structure in collapsed regions).
The large-scale dynamics in an FDM universe is identical to CDM since
Schro¨dinger–Poisson becomes Vlasov–Poisson in the h=m ! 0 limit (cf. Widrow
and Kaiser 1993; Zhang et al. 2002), and thus, FDM should resemble the
ﬁlamentary structure of CDM. Numerical simulations have conﬁrmed this and
illustrations of the qualitative agreement can e.g., be found in Uhlemann et al.
123
1
Page 80 of 200
R. E. Angulo, O. Hahn

(2014), Kopp et al. (2017), Mocz et al. (2018). On smaller scales, structure
formation is suppressed in a way that resembles a WDM cosmology with a free
streaming length comparable to the FDM effective Jeans length. On even smaller
scales, two effects appear. The ﬁrst one is the presence of a central long-lived
solitonic core in the centers of halos (Schive et al. 2014) whose properties are
correlated with the mass of the host halo (Chavanis 2011; Chavanis and Delﬁni
2011; Chen et al. 2017; Bar et al. 2018). The existence of this central mass excess
has been conﬁrmed via Eulerian and Lagrangian simulations, and its presence or
absence in observations of galaxies has been used to argue in favor or against FDM
(Desjacques and Nusser 2019; De Martino et al. 2020; Pozo et al. 2020; Burkert
2020).
Another key signature of FDM on small scales is the presence of a distinctive
granular structure associated with interference patterns and variations in density.
This, for instance, can be appreciated in Fig. 17. This feature appears to be a
prediction in all Eulerian simulation codes, however, it is absent in Lagrangian ones.
The reason behind this is that the Madelung formulation formally diverges when
q ! 0, which introduces a singularity that limits the ability of the corresponding
numerical methods to correctly capture the behavior of the system. It is thus
remarkable that the solitonic cores can be reproduced also in Madelung simulations,
Fig. 17 The simulated cosmic density ﬁeld when dark matter is assumed to be made of Fuzzy Dark
Matter (FDM), where quantum effects are important on astrophysical scales. The left panel shows a
simulation at z 	 1 from Veltmaat et al. (2018), whose inset zooms into a collapsed structure where a
granular behaviour and a dense solitonic core are evident. The right panel shows a comparison of a
ﬁlament at z 	 7 simulated assuming CDM, WDM, or FDM (or BECDM), from top to bottom. Note that
the ﬁlament is broken into small low-mass halos in CDM, whereas in WDM and FDM such small-scale
structure is absent due to the smoothing effects of free-streaming velocities and quantum effects,
respectively. In addition, in the FDM case, an interference pattern appears as a result of multi-streaming
in collapsed regions Images reproduced with permission from [left] Veltmaat et al. (2018), copyright by
APS; and [right] from Mocz et al. (2020), copyright by the authors
123
Large-scale dark matter simulations
Page 81 of 200
1

which is likely a consequence of them arising from hydrostatic equilibrium in the
thermodynamic q  1 regime, unaffected by errors arising in earlier, colder, stages
of collapse.
Regardless of such numerical problems, there is consensus that interference
patterns should appear in FDM and, in fact, they could provide a clear evidence of
its existence. For instance, the granularity and the rapid oscillations of the Klein–
Gordon ﬁeld could perturb strong lenses and/or affect the frequency of light from
pulsars in a way that could be detected by Pulsar Timing Arrays (Khmelnitsky and
Rubakov 2014; Porayko and Postnov 2014; De Martino et al. 2017), or from binary
pulsars(Blas et al. 2017). Current constraints are still weak (m [ 1023 eV)
(Porayko et al. 2018; Kato and Soda 2020), but the next generation of PTAs and
multiple other probes proposed should signiﬁcantly improve upon these limits,
which together with future advances and improvements in numerical simulations,
could scrutinise this interesting DM candidate.
7.5 Primordial black holes
Even though large-scale primordial ﬂuctuations are found to follow a kns’0:96 nearly
scale-invariant spectrum from the CMB and observations of the large-scale structure
of the Universe, small scales are essentially unconstrained. It is therefore possible
that large energy-density ﬂuctuations on small scales were generated during
inﬂation. These ﬂuctuations could have collapsed to form a population of black
holes (Carr et al. 2016; Carr and Ku¨hnel 2020) as soon as they enter the horizon as
early as at the matter-radiation equality.
An interesting possibility is that these primordial black holes (PBH) could make
up a signiﬁcant fraction (or possibly all) of the dark matter without recourse to
particles beyond the standard model. This possibility is even more interesting given
the recent detection of many black hole mergers detected by LIGO, with measured
black hole masses following an astrophysically unexpected distribution. Recent
lattice QCD calculations (Borsanyi et al. 2016) now predict the equation of state
during the QCD phase transition, which can lead to distinct features in the PBH
mass spectrum (Byrnes et al. 2018; Carr et al. 2021).
Various astrophysical observations have put limits on the abundance and mass of
these PBHs. The lower mass limit is determined by requiring the evaporation time
due to Hawking radiation to be larger than the Hubble time, which puts the
minimum mass to make up all of the dark matter at mPBHJ1015 g. Up to stellar
masses, PBH dark matter is severely constrained by astrophysical observations
(microlensing, close binary disruption), at higher than stellar masses it is
constrained by allowed spectral distortions of the CMB. Current constraints have
ruled out PBH of virtually any mass as the total dark matter with a monochromatic
PBH mass function, except for a window around 1016–1010 M (Carr et al.
2020a), which narrows to a small region around 1016 M if constraints from white
dwarf and neutron star disruptions are included. However, a broad spectrum of PBH
masses would render them unconstrained by any single observation. Furthermore,
since the physics behind PBH formation and that behind an hypothetical DM
123
1
Page 82 of 200
R. E. Angulo, O. Hahn

particle are in principle unrelated, it is possible that both types of dark matter
coexist, but CDM clustering around massive PBHs does constrain that scenario
(Adamek et al. 2019; Carr et al. 2020b).
The evolution of PBHs is determined by collisional dynamics, thus it can be
correctly captured by traditional N-body codes for small or zero softening length.
Due to the strong accelerations possible in pair encounters and the need to resolve
the formation and disruption of PBH binaries, integration techniques known from
star cluster simulations need to be employed (Aarseth 2009), but traditional
integrators are sufﬁcient when one is interested in the large-scale distribution of
PBHs.
Concerning initial conditions, on sufﬁciently large scales, PBH ﬂuctuations
follow that imprinted in the particle dark matter (CDM), while on small scales the
PBHs’ distribution can be assumed to be Poissonian. Recent numerical simulations
of the particle DM and PBH have employed standard N-body codes (Inman and Ali-
Haı¨moud 2019; Tkachev et al. 2020), usually augmented with models for BH-BH
mergers. In Fig. 18, we show the density ﬁeld at z ¼ 99 of one of such simulations
assuming that 10% or 100% of the DM is in the form of PBHs. For low DM
fractions in the form of PBHs, Inman and Ali-Haı¨moud (2019) found that DM halos
form around single a PBH which have steep power-law density proﬁles. As they
consider higher PBH fractions, halos contain a larger number of PBHs and display
broken power laws. In addition, the formation of small halos occurs earlier the
larger the PBH fraction, which could have observable consequences (in e.g., the
formation of ﬁrst stars or reionisation). Currently, these simulations are limited by
computational resources. In the future, one can expect that these simulations will be
able to tackle questions such as the formation of PBH binaries already in the
Fig. 18 The projected matter distributionat z ¼ 99 as predicted by numerical simulations assuming
primordial black holes (PBH) make up 10 or 100% of the dark matter (left and right panels, respectively).
The simulations correspond to box sizes of 30h1kpc and assume 20h1M as the mass of the PBHs.
Note that for larger PBH fractions, structures collapse earlier containing multiple PHB, whereas for low
fractions, PBH are mostly founds in isolation but are surrounded by ‘‘standard’’ dark matter particles
Image reproduced with permission from Inman and Ali-Haı¨moud (2019), copyright by APS
123
Large-scale dark matter simulations
Page 83 of 200
1

radiation-dominated epoch, potentially informing the fraction of PBH mergers
detectable by future gravitational wave experiments.
Note that if the small-scale ﬂuctuations produced by inﬂation are not large
enough to collapse into PBHs, they could create a population of dense low-mass
dark matter halos, usually referred to as ultra-compact minihalos (Berezinsky et al.
2003; Bringmann et al. 2012). These objects are found to have a steep inner density
proﬁle, q 	 r9=4 or r1:5, in simulations (Gosenca et al. 2017; Delos et al. 2018a),
and they are expected leave their own distinctive observational signature that could
be constrained by microlensing (Ricotti and Gould 2009; Li et al. 2012b), pulsar
time delays (Clark et al. 2016), or by (the lack of) a gamma-ray signal if DM self-
annihilates (Bringmann et al. 2012; Gosenca et al. 2017; Delos et al. 2018b).
7.6 Self-interacting dark matter (SIDM), decaying and dissipative dark matter
For many purposes, dark matter can be considered to have no other interactions
besides gravity. This ’collisionless’ assumption is justiﬁed since after freeze-out (in
the case of thermal production of the dark matter particles), non-gravitational
particle-particle interactions must be very weak given current observational
constraints. Nevertheless, any physically motivated particle DM model must have
a non-zero interaction cross-section in order for those particles to be produced in the
early Universe in the ﬁrst place.
There are various possible interaction mechanisms. For instance, dark matter can
interact and annihilate with itself (e.g., if it were a Majorana particle) producing
standard model particles and (gamma-ray) photons. This has fueled searches of
annihilation products in galaxy clusters, Milky way satellites, the galactic centre, or
as a diffuse extragalactic background [see Leane (2020) for a recent review]. This
‘indirect detection’ of particle dark matter heavily relies on N-body simulations
which can pinpoint the most likely places for a putative detection, as well as the
expected emission [see e.g., Springel et al. (2008b), Zavala et al. (2010) and Kuhlen
et al. (2012), Fornasa and Sa´nchez-Conde (2015), Zavala and Frenk (2019) for
reviews]. Although these searches have not been successful so far (Ackermann et al.
2012; Abdallah et al. 2016), future facilities such as the Cherenkov Telescope Array
will offer new prospects for a detection (Doro et al. 2013).
Other possible self-interaction considers the weakly collisional regime with
elastic binary processes vv ! vv. This case is generically known as self-interacting
dark matter, and the cross-sections can be large enough to be relevant for structure
formation. For instance, weak collisionality was found to have an effect on the
density proﬁles of isolated halos (Burkert 2000; Kochanek and White 2000),
predominantly by isotropising the core velocity dispersion and reducing the density.
In principle, such systems can undergo a gravothermal catastrophe leading to core
collapse, but current constraints on the cross-section put the time-scale for this at
J100Gyr (Koda and Shapiro 2011). The resulting observational signatures enable
constraints of such ‘richer’ dark sector physics [see e.g., Tulin and Yu (2018) for a
recent review of the topic], which as for other DM candidates, required a detailed
simulation counterpart.
123
1
Page 84 of 200
R. E. Angulo, O. Hahn

Self-interacting DM requires a modelling of microscopic short-range particle
scattering in N-body simulations. These interactions alter the overall the dynamics
which is no longer purely geodesic, and thus it requires upgrading from the Vlasov–
Poisson (cf. Eq. 5) to the Boltzmann–Poisson system of equations by adding a
scattering balance term
of
ot þ p
ma2  $xf  m$x/  $pf ¼ Cin  Cout;
ð96Þ
where Cin is the instanteneous rate of change of fðx; p; tÞ due to all scattering events
that lead to particles ending up in an inﬁnitesimal phase space volume d3x d3p
around the point ðx; pÞ, and Cout the respective rate for scattering out of that volume.
Assuming a two-particle momentum ‘in state’ ðp; p1Þ is scattered into the ’out
state’ ðp0; p0
1Þ, then the scattering rate balance, given a differential scattering cross
section drv=dX, is
Cin  Cout ¼
Z
R3 d3p1
Z 4p
0
dX drv
dX
p  p1
k
k
ma2
fðx; p0; tÞfðx; p0
1; tÞ  fðx; p; tÞfðx; p1; tÞ


;
ð97Þ
where the centre-of-mass scattering (solid) angle X contains the remaining two
degrees of freedom in ðp0; p0
1Þ allowed by symmetries for binary elastic collisions,
i.e. after accounting for momentum and energy (and particle number) conservation.
Unfortunately, if one inserts the N-body distribution function (30) in the scattering
rate C :¼ Cin  Cout, one does not arrive at a practicable discretisation since C is
zero unless two N-body particles are located at the exact same location. Since each
N-body particle anyway represents an element of phase space in a coarse-grained
sense, practical approaches (Vogelsberger et al. 2012; Rocha et al. 2013) have to
resort to estimating C with smeared out particles, relying on an SPH-like approach
where (30) is replaced with
fNðx; p; tÞ ¼
X
n2Z3
X
N
i¼1
Mi
m W
x  XiðtÞ  nL
k
k; hi
ð
Þ dDðp  PiðtÞÞ;
ð98Þ
where we recall that Mi and Pi are the mass and momentum of N-body particles, and
Wðr; hÞ is a smooth kernel function with ﬁnite support and hi a bandwidth (or
smoothing scale) parameter chosen so that several other particles are found within a
distance hi from particle i (the summation over periodic copies is of course irrel-
evant for the self-interaction). This distribution function can then be used to express
the scattering rate experienced by particle i as [see Rocha et al. (2013) for details of
the calculation]
123
Large-scale dark matter simulations
Page 85 of 200
1

Ci ¼
X
j
Cijj ¼
X
j
rv
ma2 Pi  Pj

Vij;
with
Vij ¼
Z
R3 d3x Wðkx  Xik; hiÞ Wðkx  Xjk; hjÞ
ð99Þ
representing the overlap between the particle kernels. Since numerically Cijj ¼ Cjji
is not guaranteed, Rocha et al. (2013) proposed to use a symmetrised scattering rate
Cij :¼ ðCijj þ CjjiÞ=2. Once the scattering rate Cij is known, the scattering proba-
bility over a time step Dt is Pij ¼ CijDt. Then, one can realise an elastic scattering
event by sampling this probability over one timestep and randomising the direction
of the relative velocity vector of particles i and j in the centre-of-mass frame. Such a
Monte Carlo approach to the weakly collisional regime has been compared and
validated with a non-ideal ﬂuid model e.g., by Koda and Shapiro (2011).
Dark matter self-interactions have been included in many cosmological
simulations (e.g., Yoshida et al. 2000; Vogelsberger et al. 2012; Rocha et al.
2013). An important focus of such simulations is on dwarf galaxies (e.g., Zavala
et al. 2013) and on simulations of galaxy clusters (e.g., Brinckmann et al. 2018;
Banerjee et al. 2020 for recent examples) since merging clusters provide some of
the strongest constraints on the cross-section of dark matter self-interaction (Harvey
et al. 2015; Kahlhoefer et al. 2015; Robertson et al. 2017). Note that self-
interactions are also included in the ’ETHOS’ effective dark matter model (Cyr-
Racine et al. 2016; Lovell et al. 2018), which we will discuss in the next subsection.
Another possible interaction is decaying dark matter, where the dark matter
decays into massless species on cosmological time scales. Current constraints from
the CMB require that, if all dark matter decays into photons (or dark radiation), then
the decay rate is at most C1J160Gyr (Audren et al. 2014). However, a much
smaller fraction of DM can decay and still leave a cosmological signature. In this
case, the corresponding increase in energy density of relativistic species at late times
needs to be accounted for in the background evolution of numerical simulations.
Additional non-homogeneous relativistic corrections can, e.g., be absorbed in a
similar way as for trans-relativistic massive neutrinos (see Sect. 7.8.2) using linear
theory corrections to the gravitational potential (Dakin et al. 2019b) or using a
gauge approach (Fidler et al. 2017b). Beyond a background contribution, dark
matter decay and annihilation could also contribute to a heating of the gas in low
mass halos (e.g. Scho¨n et al. 2015), and the inter-galactic medium (IGM), which can
be modelled e.g., in hydrodynamic cosmological simulations (Iwanus et al. 2017;
List et al. 2019b), or using machine learned modiﬁcations to matter only
simulations (List et al. 2019a), similar to those employed to include baryonic
effects or modify cosmological parameters (see Sect. 9.8).
While Ockham’s razor might push us to consider simple DM models, there is a
priori no reason that the physics of the dark sector could not be signiﬁcantly richer,
with multiple dark species and internal degrees of freedom. An intermediate space
between self-interacting dark matter and decaying dark matter is occupied by
dissipative dark matter, which allows for up-scattering to an excited state vv ! v0v0
with a subsequent decay, e.g., v0 ! v þ X under emission of a light or massless
123
1
Page 86 of 200
R. E. Angulo, O. Hahn

particle ’X’. Such processes can efﬁciently remove energy from the centres of halos
and lead to halo core collapse in less than a Hubble time (Essig et al. 2019; Huo
et al. 2020) leaving testable signatures in dwarf galaxies. They could also contribute
to the formation of supermassive black holes already at high redshift (Choquette
et al. 2019). Note, however, that dissipative dark matter interactions are constrained
by the non-detection of DM acoustic oscillations (Cyr-Racine et al. 2014), and
absence of a signiﬁcant thin ‘dark disk’ in the Milky Way (Schutz et al. 2018).
7.7 Effective descriptions
In the previous subsections we considered in detail speciﬁc DM candidates.
However, many more alternatives exist which span a broad range of masses,
interactions, production mechanisms, etc. For instance, sterile neutrinos produced
by resonant or non-resonant transitions, production in the decay of a parent particle
which might result in thermal or non-thermal distributions, or mixed models in
which DM is made out multiple particles with different properties. Furthermore,
new candidates are being constantly proposed.
Since it is unpractical to carry out numerical simulations for every possible
particle and covering their respective degrees of freedom, effective descriptions
have been proposed. The basic idea is that a large fraction of physically-viable
candidates can be mapped to a generic model with a few free parameters. For
instance, since nonlinear large-scale structure expected in a given DM model
depends mostly on the initial transfer function, deviations from the CDM transfer
function can be parameterised, and a given DM candidate can be mapped to a
particular point in this parameter space. Speciﬁcally, Murgia et al. (2017) have
argued that a large class of DM models can be described using a generalisation of
the WDM modiﬁcation given in Eq. (91)
TvðkÞ ¼ TCDMðkÞ  1 þ ak
ð
Þb
h
ic
ð100Þ
where a, b, and c are the three free parameters of the model (but note a strong
degeneracy between a and c). This form could be extended with additional free
parameters to describe a broader range of models, especially at high wavenumbers
(such as ‘dark oscillations’). On the other hand, these scales are expected to have a
very minor impact on structure formation.
A different effective description has been proposed in terms of the particle
physics Lagrangian in the so-called Effective Theory of Structure Formation
(ETHOS) (Cyr-Racine et al. 2016). The physical parameters of a given DM model
(DM particle mass, coupling constants, number of degrees of freedom, mediator
mass, etc.) map into effective parameters that determine the initial transfer function
(e.g., a, b, and c in Eq. 100) and an effective (velocity-dependent) cross section.
An advantage of these effective approaches is that only a relatively small number
of simulations need to be carried out for the free parameters of the effective
description (Vogelsberger et al. 2016; Stu¨cker et al. 2021b). With these, predictions
for the nonlinear structure, their observable signatures, and comparison with
observations, can be obtained for any DM model. This has been done for the ﬁrst
123
Large-scale dark matter simulations
Page 87 of 200
1

galaxies and reionization, the Ly-a-forest, the abundance of dwarf galaxies, and
gravitational lensing (Murgia et al. 2017; Lovell et al. 2018; Dı´az Rivero et al.
2018; Lovell et al. 2019; Bose et al. 2019).
This represents an example where N-body simulations are directly employed in
constraining cosmological parameters and fundamental physics—the properties of
dark matter in this case. As we will argue later, this approach can also be applied to
observations of the large-scale structure but it is of paramount importance to
demonstrate
the
accuracy
and
robustness
of
the
corresponding
numerical
predictions.
7.8 Multiple species with distinct initial perturbation amplitudes
Due to the dominance of collisionless dark matter and the coldness of both dark
matter and baryons during the structure formation epoch, large-scale simulations
usually represent the total matter component with a single collissionless ﬂuid. This
ﬂuid is commonly referred to as dark matter but in reality it represents dark matter
and any other massive, non-relativistic component in the Universe. While this is a
good approximation in many cases, the advent of more precise observations and, as
a consequence, stricter accuracy requirements for numerical simulations demands
the simulation of multiple ﬂuids as the other known massive components in the
universe beside dark matter—baryons and neutrinos— have different initial
distributions and relative velocities which affects late-time structure.
In this section we review several efforts and approaches to simulating the
gravitational co-evolution of multiple ﬂuids, speciﬁcally baryons and neutrinos.
This is a veritable challenge, that only recently is becoming possible to tackle thanks
to multiple novel algorithms and development in numerical techniques.
Fig. 19 The time evolution of cold dark matter plus baryon ﬂuctuations from z ¼ 130 up to z ¼ 0. The
left panels show the linear-theory power spectrum for the total mass, cold dark matter, and baryons as
solid, dotted, and dashed lines, respectively. Coloured lines show the mass power spectrum predicted by
an N-body simulation. The right panels show the ratio of the power spectra of baryons to that of cold dark
matter. The amplitude of ﬂuctuations at high-z is typically a factor of 2 smaller for baryons that for dark
matter. These differences are progresively reduced at lower redshifts to about a few percent at late times
Image reproduced with permission from Angulo et al. (2013a), copyright by the authors
123
1
Page 88 of 200
R. E. Angulo, O. Hahn

7.8.1 Baryons
If we consider only primordial adiabatic modes, at very early times and on super-
horizon scales, baryons and dark matter have an identical spatial distribution as
imprinted by the quantum ﬂuctuations processed by inﬂation. However, the tight
coupling of baryons with the radiation ﬁeld via Compton scattering prior to
recombination renders its subsequent evolution distinctly different from that of the
dark matter. Radiation pressure opposes the growth of baryonic overdensities
creating oscillations in density and temperature which are damped on small scales
because of an imperfect coupling and Jeans damping. On the other hand, dark matter
is not expected to couple to radiation and mostly grows unimpeded. After
recombination, baryons and photons effectively decouple and the same gravitational
interactions dominate the growth of baryon and dark matter overdensities. However,
the starting point for baryons and dark matter is already different. In addition to this
effect caused by recombination on purely adiabatic perturbations, primordial
isocurvature perturbations could add additional differences among baryons and dark
matter.
The linear evolution of a system of multiple ﬂuids coupled by gravity can be
modelled and computed accurately by Einstein–Boltzmann solvers, which, in fact,
show that the power spectrum of density ﬂuctuations at z 	 100 (the typical starting
redshift of numerical simulations) are still signiﬁcantly different. For instance, the
baryonic acoustic oscillations are barely present in the dark matter, there is a
relative velocity between baryons and dark matter, and the ﬂuctuation amplitues in
baryons are approximately half of those in dark matter, even on gigaparsec scales.
This can be seen in Fig. 19 which shows the time evolution of the power spectra for
total mass, baryons, and dark matter as predicted by linear perturbation theory and
by a N-body simulation.
Although one could think that simulating gravitationally baryons and dark matter
is a straightforward extension of standard N-body codes, achieving an accurate
evolution as well as initial conditions has proven to be rather challenging, and it is
an example of a situation where certain discretizations of the underlying equations
can result in a considerable numerical error.
A range of studies (Yoshida et al. 2003; O’Leary and McQuinn 2012; Angulo
et al. 2013a) have shown that a naı¨ve simulation of such a baryon-DM two-ﬂuid
system leads to the incorrect evolution of the relative baryon-dark matter
perturbations. Spurious particle coupling dominates over the real differences on
small scales which then quickly propagates to large scales. In early studies, these
errors could only be suppressed if forces were smoothed on scales larger than the
mean inter-particle separation, either with a large ﬁxed softening or one adapting
with the local density (O’Leary and McQuinn 2012; Angulo et al. 2013a).
Other proposed solutions (Yoshida et al. 2003; Bird et al. 2020) relate to the
initial particle load (cf. Sect. 6.4), of the two-ﬂuid simulations – adopting at least
one glass distribution for one component reduces the spurious coupling even at high
force resolution. However, Hahn et al. (2021) demonstrated that the dominant error
contribution comes from the constant mode (the density difference db  dc
approaches a constant at late times) which can be absorbed at all orders of LPT
123
Large-scale dark matter simulations
Page 89 of 200
1

into a simple variation of the relative masses of CDM and baryon particles. This,
therefore, enables an extension of Lagrangian Perturbation theory for multiple ﬂuids
(Rampf et al. 2021b) which allowed more accurate initial conditions and also lower
starting redshifts. The inclusion of relative velocities beyond linear order in the ICs
is however still an unsolved problem. In contrast to this back-scaling approach,
missing physics in the non-linear solvers (such as the small residual coupling to
radiation at zJ100) makes the ‘forward’ approach to initial conditions for
CDM?baryon simulations inaccurate at low z, so that in general ‘back-scaling’
should be preferred (cf. Sect. 6.1).
Simulations by Angulo et al. (2013a) showed that the nonlinear total matter
power spectrum is largely unaffected by the single/two ﬂuid distinction with the
z ¼ 0 results differing by less than 0.1% at k 	 1h Mpc1. However, baryon-dark
matter differences could be imprinted in halo formation, as expected on theoretical
grounds. This question was indeed investigated by using simulations with adaptive
softening (Khoraminezhad et al. 2021) and by using an extension of the separate
universe approach (Barreira et al. 2020a), which does not suffer from the numerical
inaccuracies described above. These authors showed that halo formation is actually
sensitive to baryon-dark matter ﬂuctuations, in agreement with analytic arguments
(Chen et al. 2019; Schmidt 2016). At a ﬁxed matter overdensity, halos tend to form
more efﬁciently in regions with smaller baryon-dark matter differences. While
small, this additional dependence creates coherent ﬂuctuations even on large (BAO)
scales which could affect observational constraints on neutrino masses and from
baryonic acoustic oscillations (Chen et al. 2019). On much smaller scales, baryons
stream pass dark matter collapsed structure (Tseliakhovich and Hirata 2010), which
delays their eventual accretion and thus is expected to affect structure formation in a
correlated way. Numerical simulations of this effect have shown that neglecting this
streaming leads to an overestimation of the abundance of high redshift low-mass
halos (Tseliakhovich and Hirata 2010; Dalal et al. 2010b; Park et al. 2020).
We note that in addition to the above, another (in principle unrelated) problem is
that caused by baryonic physics itself (ﬁnite Jeans scale, gas cooling, UV heating,
feedback, etc), which will be discussed below (cf. Sect. 9.9.5).
7.8.2 Massive neutrinos
Neutrinos are one of the fundamental particle families in the Standard Model of
particle physics, where they are expected to be massless given the allowed
symmetries. However, observations of ﬂavor oscillations in solar and atmospheric
neutrinos indicate that they do have mass, which could be a signature of physics
beyond the standard model. The measurement of the absolute mass scale of
neutrinos is very important, since, when combined with measurements of the
neutrino-mass splitting coming from neutrino oscillation experiments, they could
distinguish whether neutrinos are Majorana or Dirac particles. This in turn could
indicate the kind of extension required to the standard model and thus answering
one of the fundamental questions in physics.
123
1
Page 90 of 200
R. E. Angulo, O. Hahn

Recent results from the KATRIN experiment ﬁnd an electron neutrino mass
upper bound of 0.8 eV (at 90% CL) from the study of the electron endpoint energy
in tritium decay experiments (Aker et al. 2019). However, the large-scale structure
of the Universe provides currently the most accurate method to constrain the total
mass of neutrinos, but note that future experiments such as PTOLEMY (Betti et al.
2019) could be competitive with forecasted errors of 103eV. Current constraints on
neutrino masses from large-scale structure and the CMB are P mm\0:12 eV
(Palanque-Delabrouille et al. 2020; Planck Collaboration 2020), but the upcoming
generation of large-scale surveys have the potential to achieve an accuracy of
r½P mm ¼ 0:01  0:03 eV when combined with CMB lensing (Boyle and Schmidt
2020; Chen et al. 2021). Therefore, precise numerical simulations of cosmic
structure formation in the presence of neutrinos, and particularly their interplay with
cold dark matter has become increasingly important.
Neutrinos affect both the expansion history and the clustering of matter in the
Universe. The neutrino temperature is intimately connected to the photon
temperature as Tm ¼ ð4=11Þ1=3TCMB ’ 1:95K. As the Universe expands, neutrinos
cool and become non-relativistic at z ’ 189ðP mm=0:1 eVÞ. While they are
relativistic, they contribute to the total energy density of the universe as XmðaÞ ¼
Neffð7=8Þð4=11Þ4=3Xca4 (where for massive neutrinos we always explicitly
indicate the time-dependence in the density parameter), while as a non-relativistic
species they contribute as
XmðaÞ ¼
P mm
93:14 eV h2 a3:
ð101Þ
For intermediate cases, the neutrino mass fraction needs to be obtained numerically
from the Fermi-Dirac distribution function
XmðaÞ ¼ a3 X
j
mm;j
5:32meV

4Z 1
0
dy y2
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
1 þ y2=a2
p
exp bjy


þ 1 ;
ð102Þ
where bj :¼ mm;jc2=ðkBTmÞ.
Since they are still relativistic when they decouple at z 	 109, they have a typical
velocity of about a few hundreds km/sec today. Therefore at late times they
contribute mostly as perturbations through Newtonian gravity rather than as a
relativistic species through the background, so that for a CDM?baryon?neutrino
simulation one would have to solve the Poisson equation
r2/ ¼ 3H2
0
2a Xm

fcdc þ fbdb þ fmðaÞ dm
	
where
fc :¼ Xc
Xm
;
fb :¼ Xb
Xm
;
fmðaÞ :¼ XmðaÞ
Xma3 :
ð103Þ
Massive neutrinos therefore, depending on their relative importance through their
total mass fraction, need to be included in simulations of structure formation.
123
Large-scale dark matter simulations
Page 91 of 200
1

Many different approximations and discretisations were proposed to include
neutrinos into non-linear simulations of structure formation. These approaches
adopt different degrees of simpliﬁcation, but, as we will see below, they all agree to
a large extent for the small neutrino masses compatible with observations.
In the simplest approach, massive neutrinos are simply included in the Einstein–
Boltzmann solver, and total matter initial conditions for the N-body simulation are
generated in a normal ‘back-scaling’ approach (Agarwal and Feldman 2011;
Upadhye et al. 2014). More recent approaches however try to capture also the time-
evolution of the massive neutrino component. Since they are hot dark matter, the
evolution of neutrinos obeys the Vlasov–Poisson equations with a hot distribution
function once they are non-relativistic. In contrast to cold matter, neutrinos remain
fairly linear so that it is in principle possible to solve the VP equation directly in
phase space. This indeed has been recently achieved by Yoshikawa et al.
(2020, 2021), who followed CDM using traditional N-body techniques and solved
the VP equation describing neutrinos as an incompressible phase space ﬂuid using a
6D Cartesian grid. This solution is however computationally very expensive.
Another approach is to apply the N-body approach to sample the six-dimensional
distribution function of neutrinos, i.e. at each location, multiple particles sample the
possible momentum magnitude and directions given by a Fermi-Dirac distribution.
This approach can capture the nonlinear evolution of the neutrino ﬂuid and
traditionally had been regarded as the gold standard in the ﬁeld. Consequently, it has
been adopted in some very large simulations from which most of the current
knowledge about the role of neutrinos in structure formation stems (Brandbyge
et al. 2008; Viel et al. 2010; Castorina et al. 2015). This N-body approach has been
extended to relativistic simulations by Adamek et al. (2017b), which accurately take
into account the transition of neutrinos from the relativistic to the non-relatvitistc
regime, along with the contribution of both their energy density and their
anisotropic stress to metric perturbations in the weak ﬁeld regime.
Unfortunately, a large number of neutrino particles are needed to reduce
discreteness noise, which rapidly increases the computational cost of these
simulations (Emberson et al. 2017), since the error on the mean momentum (and
thus essentially the growing mode) only decreases with the Poisson noise. Some
alternatives have been proposed to minimise the impact of noise. One of them, Ma
and Bertschinger (1994), used a pairing of neutrino particles sampling exactly
opposite momenta to enforce local momentum conservation. This guarantees that at
the very start of the simulation, the mean ﬁeld is exactly recovered, but is washed
out shortly afterwards. To circumvent this problem, Banerjee et al. (2018) sampled
the directional distribution in a more regular fashion (using the HEALPIX
decomposition of the sphere rather than uncorrelated random directions). More
recently, Elbers et al. (2021) proposed another method to reduce the Poisson noise
by sampling only the deviations from the linear solution with particles, which shifts
the sampling error from the expectation value of the mean to the expectation value
of the deviation from the linear solution (referred to as the ‘df method’).
Alternatively, to avoid these numerical inaccuracies and reduce the computa-
tional cost, one can take advantage of the fact that neutrinos are never expected to
cluster signiﬁcantly, owing to their large peculiar velocities, and thus can be treated
123
1
Page 92 of 200
R. E. Angulo, O. Hahn

perturbatively. In the simplest approach, neutrinos are described on a grid which is
evolved according to linear theory (i.e. the neutrino density obtained with a linear
Einstein–Boltzmann solver is convolved with the random phases of the simulation),
which is then co-added to the total large-scale gravitational potential ﬁeld
(Brandbyge and Hannestad 2009). An advantage of this approach is that the
neutrino perturbations can be computed incorporating also general relativistic
effects (Tram et al. 2019). A disadvantage is that it cannot correctly capture the
nonlinear evolution of neutrino perturbations and that momentum and energy
conservation are not guaranteed as there is no back-reaction of non-linear matter on
the neutrinos (which is however negligible if the neutrinos are light).
A reﬁnement can be obtained with the so-called linear-response approaches
where, although neutrinos are treated perturbatively, the full nonlinear dark matter
ﬁeld is used as a source in the perturbative solution for the neutrinos (Ali-
Haı¨moud and Bird 2013). This approach appears to work extremely well for all but
the slowest moving neutrinos which can be captured in dark matter halos and
develop signiﬁcant nonlinearities. A further reﬁnement was proposed by Bird
et al. (2018) where only the initially coldest neutrinos are sampled with N-body
particles, and an even more efﬁcient implementation was recently proposed by
Chen et al. (2021).
A somewhat different approach is to solve the neutrino evolution using a ﬂuid
approach through a Boltzmann hierarchy expansion. One formulation has been
proposed by Dakin et al. (2019a) who considered the ﬁrst three moments of the
Boltzmann equation: solving for the continuity and Euler equations in Eulerian
space (i.e. the lowest two moments of the Boltzmann equation) while describing the
third moment, capturing the stress tensor, at linear order. These terms could also be
estimated using N-body particles (Banerjee and Dalal 2016), or by decomposing the
neutrino phase-space into shells of equal speed and evolve them with hydrodynamic
equations (Inman and Yu 2020).
Neutrinos have also been incorporated in approximate N-body methods (cf.
Sect. 4.4 for a review of such approaches). Recently, Bayer et al. (2021) proposed
an extension to the FASTPM algorithm by modifying the kick and drift operator; and
Wright et al. (2017) extended the COLA algorithm by incorporating the scale-
dependent effect of neutrinos in the growth factors. On the other hand, an accurate
prediction for the impact of neutrinos can also be achieved in post-processing by
using cosmology-rescaling methods (Zennaro et al. 2019; Angulo and White 2010;
Contreras et al. 2020c), or as a gauge transformation (Partmann et al. 2020).
Finally, when neutrinos are treated in a Newtonian framework at low redshift,
simulation initial conditions cannot be accurately used in a ‘‘forward’’ approach (cf.
Sect. 6.1), which would result in signiﬁcant inaccuracies (see e.g., Bastos de Senna
Nascimento and Loverde 2021). Zennaro et al. (2017) proposed a back-scaling
approach where for a given target redshift, the linear power spectrum predicted by
linear Boltzmann solvers are integrated backwards in time accounting only with
gravitational interactions. This is in principle unstable for long times since decaying
modes are excited that blow up during the backwards evolution, but due to the low
mass of neutrinos, this approach works well for starting times zstart.100. In this
way, when setting up ﬁrst order accurate initial conditions as in Eq. (73), particles
123
Large-scale dark matter simulations
Page 93 of 200
1

are set-up at the starting redshifts so that when evolved with gravitational
interactions they retrieve the correct large-scale density ﬂuctuations (see also the
discussion on ‘backward’ initial conditions in Sect. 6.1).
Despite the huge differences among the various methodologies to include
neutrinos into non-linear simulations, all these approaches agree extremely well on
their predictions for the impact of (light) massive neutrinos on the large-scale
structure, especially for the allowed neutrino masses where differences are typically
at the sub-percent level. Therefore, currently the cosmic evolution of neutrinos
appears to be a robust prediction of numerical simulations. This is illustrated in
Fig. 20 which displays the projected density ﬁeld of neutrinos in a box of
180h1Mpc employing various numerical approaches discussed in this section. Here
we can clearly see how linear theory predictions correctly capture the large-scale
distribution of neutrinos but underestimate the high-density tail. Additionally,
discreteness noise is evident in the particle method. Nevertheless, the agreement of
all methods on large scales is remarkable, especially for lighter neutrinos. In the
ﬁgure insets we see, however, how these numerical methods differ in the accuracy
with which describe neutrinos in the nonlinear regime and the associated degree of
noise.
In Fig. 20 one can also see that neutrinos follow the same large-scale patterns as
the dark matter. In contrast, on smaller scales, the large velocity dispersion of the
neutrino ﬁeld stops its growth and the ﬁeld remains smooth. This causes a well-
known scale dependent suppression in the total matter clustering. On intermediate
scales below the neutrino free streaming, the suppression has an amplitude roughly
proportional to DP=P 	  10fm, slightly larger than the linear theory prediction
DP=P 	  8fm (Brandbyge et al. 2008). On even smaller scales, the differences
decrease due to nonlinearities (see, e.g., Hannestad et al. 2020).
Fig. 20 Comparison of the simulated density ﬁeld of massive neutrinos with total mass P mm ¼ 0:5eV
and 0.1eV (top and bottom rows, respectively). Each panel shows the results of various computational
methods; linear perturbation theory, linear response, particle method, and df method. For comparison, the
leftmost column shows the cold mass (cold dark matter and baryons) over the same volume. Note the
inset in each panel showing a zoom into a massive dark matter halo. Image adapted from Elbers et al.
(2021), copyright by the authors
123
1
Page 94 of 200
R. E. Angulo, O. Hahn

Usually, numerical simulations consider a degenerate mass state for neutrinos,
i.e. assume that all neutrino states have the same mass. This is incompatible with
oscillation experiments, but justiﬁed as cosmic structure is mostly sensitive to the
total neutrino mass. However, the linear power spectrum is slightly different
between the normal and inverted hierarchy (Lesgourgues et al. 2004; Jimenez et al.
2010). Although the effect is small—below 0.4–0.6% for weak lensing and galaxy
clustering observables (Archidiacono et al. 2020)—numerical simulations have
shown that this signature is imprinted and even enhanced during nonlinear
clustering, which opens up the possibility of a marginal detection with future large-
scale structure surveys (Wagner et al. 2012). However, this will require signiﬁcant
advances in the modelling of baryonic effects, redshift space distortions, and galaxy
bias.
The role of neutrinos has also been explored via the ‘separate universe’ technique
(cf. Sect. 6.3.6) (Chiang et al. 2018). These simulations have shown that the linear
bias of dark matter halos is scale-dependent in the presence of neutrinos. These
ﬁndings were later conﬁrmed by the same authors but using standard N-body
simulations (where the contribution of neutrinos was artiﬁcially increased to
enhance their effect) (Chiang et al. 2019), who further showed that the scale
dependence persists regardless of whether it is deﬁned with respect to the total or
cold mass (CDM plus baryons) power spectrum.
7.9 Primordial non-Gaussianity and small-scale features from inflation
So far, we have considered the case where primordial ﬂuctuations in the Universe
were Gaussian. This is motivated by the fact that original quantum ﬂuctuations are
known to be Gaussian, thus, if the subsequent physics and evolution were linear, it
would result in the primordial seeds for structure formation being also Gaussian.
This, however, does not need to be the case since general inﬂationary models predict
various degrees of primordial non-Gaussianity (PNG). These originate from, for
instance, non-linear dynamics due to self-interactions in single-ﬁeld inﬂation, or
from correlations of the inﬂaton ﬁeld with additional (light or heavy) ﬁelds [see
Bartolo et al. (2004) for a review].
The departures from Gaussianity are expected to be of the same order of the
second-order corrections to linear-perturbation theory. Since the observed amplitude
of primordial perturbations is Oð105Þ, the natural expectation of these corrections
is thus Oð1010Þ. Therefore, the deviations from Gaussianity are expected to be
very small, and thus they can be generically (agnostic of speciﬁc models) prescribed
by expanding the true primordial Bardeen potential, U, around a Gaussian ﬁeld /ð1Þ
(enforcing h/ð1Þi ¼ 0) (cf. Creminelli et al. 2007):
123
Large-scale dark matter simulations
Page 95 of 200
1

UðxÞ ¼ /ð1ÞðxÞ þ fNL
Z
R3 d3y /ð1ÞðxÞ/ð1ÞðyÞWðx; yÞ  h/ð1ÞðxÞ/ð1ÞðyÞWðx; yÞi
h
i
þ
þ gNL 
3-point combinations of /ð1Þ


þ sNL 
4-point combinations of /ð1Þ


þ . . .
ð104Þ
where fNL; gNL; sNL; . . . are referred to as the non-Gaussianity parameters, which
quantify the level and structure of PNG; and W is a kernel deﬁning the type of non-
Gaussianity considered. The most common type in the literature is the so-called
‘‘local type’’ quadratic non-Gaussianity, which is deﬁned by non-zero fNL and
W ¼ dDðx  yÞ, and is a probe of multi-ﬁeld inﬂationary models. Other kinds of
conﬁgurations, e.g., equilateral and orthogonal types, are also (albeit less frequently)
considered, which are expected to be sensitive to different aspects of inﬂation
From the above arguments, one expects fNL 	 1, with the simplest inﬂationary
models of single-ﬁeld slow-roll predicting fNL.1, but with several others (including
non-inﬂationary cosmologies) predicting fNLJ1. We note that if inﬂation occurs at
high energies, then primordial gravitational waves could distinguish alternative
models, but if it occurs at low energies, measuring the value of fNL might be the only
source of information about the early Universe.
Constraints from the analysis of the CMB ﬂuctuations, as measured by the Planck
satellite, are f local
NL
¼ 0:9  5:1; f equil
NL
¼ 26  47; and f ortho
NL
¼ 38  24 at the
68% conﬁdence level (Planck Collaboration 2016; Planck Collaboration 2020),
which is in agreement with most inﬂationary models. Upcoming polarization and
small-scale CMB measurements are expected to improve these constraints
(Abazajian et al. 2016). An alternative for stronger constraints on fNL relies on
measurements of the late time large-scale structure of the Universe (Alvarez et al.
2014). Although current LSS constraints are signiﬁcantly weaker than those from
the CMB (r½f local
NL  	 20  100) (Leistedt et al. 2014; Giannantonio and Percival
2014; Ho et al. 2015; Castorina et al. 2019), forecasts anticipate that future surveys
could constrain fNL at the level of r½fNL 	 0:5  3 (Giannantonio et al. 2012;
Yamauchi et al. 2014; Camera et al. 2015; Ferraro and Smith 2015). However, as
the interpretation of upcoming surveys relies on non-linear physics and biased
tracers, numerical simulation of primordial non-Gaussianity is essential.
Numerical simulations of primordial non-Gaussianity can be carried out in the
same fashion as Gaussian simulations, with the difference being only in the initial
conditions. For a local PNG type, / can be trivially computed from any given value
of fNL. The only numerical consideration is that, as for higher-order LPT
implementations, Orszag’s rule needs to be applied to avoid aliasing in the
computation of ﬁeld convolutions. For orthogonal and equilateral types, the
generation of initial conditions is more complicated as it involves the generation of
a random ﬁeld subject to a constraint on its bispectrum, but Scoccimarro et al.
(2012) and Regan et al. (2012) proposed a general algorithm to efﬁciently achieve
such a task. Another subtlety regards the exact deﬁnition of /ð1Þ and its value at the
simulation starting redshift. As for the case of multi-ﬂuids, one can deﬁne /ð1Þ
directly at that redshift or apply back-scaling, a freedom that affects the comparison
123
1
Page 96 of 200
R. E. Angulo, O. Hahn

among simulations for different values of fNL
(cf. Pillepich et al. 2010).
Alternatively, the question of the role of PNG in structure formation can be
investigated using the separate universe approach (cf. Sect. 6.3.6). As explored by
Barreira et al. (2020b), Barreira (2020), a change in the initial power spectrum
amplitude can mimic a primordial non-Gaussianity of the local type.
Simulations of primordial non-Gaussianity have found essentially three effects
relevant for structure formation. The ﬁrst one is that a local-type PNG caused a
small modiﬁcation in the nonlinear matter power spectrum (Wagner et al. 2010)
which can be understood in perturbation theory as additional mode-coupling terms.
The abundance of halos is also affected by the existence of primordial non-
Gaussianity, with positive (negative) values of fNL increasing(decreasing) the
number of very massive halos (Dalal et al. 2008; Wagner and Verde 2012), and with
qualitatively similar results for gNL and sNL (LoVerde and Smith 2011). However,
these effects can become very degenerate with astrophysical processes and
nonlinear evolution, which cautions on their use as cosmological probes.
A clearer signature of local PNG arises on the very large-scale clustering of
galaxies or quasars. PNG modiﬁes the abundance of biased tracers on scales,
k\102h Mpc1, in a way that the clustering statistics receive an additional
contribution proportional to the non-Gaussian term in Eq. (104) (Dalal et al. 2008;
McDonald 2008; Baumann et al. 2013; Assassi et al. 2015). This has been
conﬁrmed by a number of N-body simulations (Dalal et al. 2008; Grossi et al. 2009;
Pillepich et al. 2010; Scoccimarro et al. 2012; Wagner and Verde 2012). In practice,
this contribution appears as a scale-dependent term proportional to b1fNLk2 in e.g.,
the power spectrum, which can dominate on large scales over the contribution of the
standard linear bias parameter, b1, and thus can be used to place constraints on fNL
(Slosar et al. 2008). Numerical simulations have shown that a similar scale-
dependent effect exists for other kinds of non-Gaussianities (Desjacques and Seljak
2010; Scoccimarro et al. 2012; Shandera et al. 2011).
The amplitude of the ‘non-Gaussianity bias’ can be related to the value of the
linear bias parameter, b1, using analytic arguments: b/ / ðb1  1Þ (Slosar et al.
2008; Matarrese and Verde 2008), with which a much more predictive model can be
constructed with the obvious beneﬁts of increased constraining power. However,
results from N-body simulations have revealed that the precise relation depends on
the kind of halo considered (or the property used to select them) and the speciﬁc
galaxy formation physics (Slosar et al. 2008; Scoccimarro et al. 2012; Desjacques
et al. 2009; Reid et al. 2010; Barreira et al. 2020b), since it depends on the details in
which the formation of a given nonlinear object responds to a change in the large-
scale potential. This might hinder the ability to robustly place constraints on PNG in
future surveys (Barreira 2020). However, as a potential detection of PNG is within
reach of the upcoming generation of LSS surveys, there is certainly motivation to
seek a better understanding of these effects in all LSS statistics.
123
Large-scale dark matter simulations
Page 97 of 200
1

7.10 Modified gravity
Throughout this review we have assumed General Relativity (GR) as the theory of
gravity. And so far no experiments or astrophysical observations have been found to
be inconsistent with GR. A particularly signiﬁcant prediction of GR was the
recently detected gravitational wave (GW) event with the co-incident detection of
an electromagnetic counterpart, which has put stringent constraints on the class of
modiﬁcations to GR allowed (Creminelli and Vernizzi 2017; Ezquiaga and
Zumalaca´rregui 2017). GR is also consistent with a plethora of cosmological
observations and speciﬁcally with tests based on redshift space distortions (Mueller
et al. 2018; Barreira et al. 2016; Herna´ndez-Monteagudo et al. 2020). However,
departures from GR on cosmological scales are still possible and have received
signiﬁcant attention as a potentially important piece to understand the accelerated
expansion of the Universe. In fact, testing gravity on cosmological scales is one of
the primary science goals of the upcoming generation of large-scale structure
observations and gravitational wave detectors (Alam et al. 2021; Belgacem et al.
2019).
To properly interpret future observations it is thus crucial to understand structure
formation in modiﬁed gravity, for which numerical simulations are indispensable
[see Llinares (2018), Baldi (2012) for specialised reviews]. A large number of
modiﬁcations to gravity has been proposed (reviewed, e.g., in Clifton et al. 2012
and Koyama 2016). In the context of large-scale structure, the class that has
received most attention are those with a ‘screening’ mechanism. These models
become indistinguishable from GR in high density regions, e.g., via the gravitational
potential (chameleon), its gradient (k-Mouﬂage), or its Laplacian (i.e., density)
(Vainshtein). They are in agreement with many local gravity tests, but they may
depart signiﬁcantly from GR on large scale so that they could be probed by cosmic
measurements.
The two most explored modiﬁcations to GR are the f(R) and DGP [short for Dvali
et al. (2000)] models, which are regarded as representative of the kind of MG
models currently available. These two gravity models feature an equal speed for
photons and gravity, and naturally contain a screening mechanism. Note that
although the initial motivation for such models was to explain the accelerated
expansion of the universe, nowadays they are predominantly explored to study
deviations from GR.
For the case of f(R), there is an additional term in the Einstein–Hilbert action that
is a function of the Ricci curvature R, which leads to equations of motion with a
gravitational potential modiﬁed as
r2U ¼ r2UGR  1
2 r2fR
with
r2fR ¼  a2
3 ½DR þ 8pGqd;
ð105Þ
where UGR is the gravitational potential in GR, DR is the perturbation to the Ricci
curvature, which could be written in terms of a scalar ﬁeld fR  dfðRÞ=dR (e.g., in
the Hu & Sawicki model fðRÞ :¼ M2
c1ðR=M2Þn
c2ðR=M2Þnþ1 with M2 :¼ H0Xm and n, c1 and
c2 being model parameters with c1=c2
2 / fR0, the value of the scalar ﬁeld today).
123
1
Page 98 of 200
R. E. Angulo, O. Hahn

Note that the theory is unscreened in low density regions where there is an addi-
tional ‘ﬁfth-force’, which has as an upper limit of 1/3 of the GR value.
In the case of (the normal branch of) DGP, which is screened by means of a
Vainshtein mechanism in regions where the Laplacian of the potential is large, the
modiﬁed Poisson equation reads
r2U ¼ r2UGR þ 1
2 r2/
with
r2/ þ r2
c
3ba2 ðr2/Þ2  ðrirj/Þ2
h
i
¼ 8pGa2
3b
dq
ð106Þ
where b ¼ 1 þ 2Hrc 1 þ
_H
3H2


and rc is a free parameter below which gravity
becomes 4-dimensional.
One can see that these gravity models generically modify the Poisson equation by
adding an additional term, whose amplitude itself is dynamically determined by a
non-linear equation. Numerical simulations thus need to solve for these ﬁelds in
each timestep. This is usually achieved by representing these ﬁelds on an adaptive
grid and solving for their values via relaxation or multi-grid methods (cf.
Sect. 5.1.3). Note that because of this overhead, traditionally, MG simulations were
signiﬁcantly slower than KCDM simulations, although recent advances (and
suitable approximations) have reduced their computational cost and nowadays they
have similar execution times (e.g., Barreira et al. 2015; Winther and Ferreira 2015).
Note that in general, MG can produce differences with respect to KCDM already
at high redshift. In such cases, the initial conditions of simulations need to be made
with power spectra computed with Boltzmann codes incorporating such effects,
such as e.g., MG-CAMB (Hojjati et al. 2011) or HI-CLASS (Zumalaca´rregui et al.
2017). However, it is common to simulate models that depart from GR only at low
redshifts, thus, the initial conditions follow that of standard simulations.
Several codes exist that simulate various kinds of modiﬁed gravity (Oyaizu 2008;
Schmidt 2009; Zhao et al. 2011; Li et al. 2012a; Brax et al. 2012; Llinares et al.
2014; Llinares and Mota 2014; Puchwein et al. 2013; Arnold et al. 2019), usually
extending well-established GR codes such as RAMSES, Gadget, and AREPO.
Winther et al. (2015) carried out a comparison of various N-body codes for f(R),
DGP, and Symmetron models by simulating a L ¼ 250h1Mpc box with N ¼ 5123
particles. These authors found a very good agreement among different codes and for
multiple statistics (for instance \1% difference in the power spectrum up to
k 	 5h Mpc1), which has supported the validity of the MG observables predicted
by numerical simulations. These MG simulations have revealed that the amplitude
of the power spectrum is enhanced relative to KCDM due to the additional force.
This enhancement is roughly scale-independent for DGP with a larger amplitude at
low redshifts, about 15(3)% for models with cH0 ¼ 1ð5Þ at z ¼ 0. In contrast,
departures with respect to KCDM are scale dependent for f(R), with a fractional
increase of 	 25ð5Þ% at k 	 10h Mpc1 for fR0 ¼ 105ð106Þ. The abundance of
massive halos is also affected by MG, with an increase on all mass scales for DGP
and a mass-dependent effect in f(R) as a result of large haloes being effectively
screened (see Winther et al. 2015 and references therein for more details).
123
Large-scale dark matter simulations
Page 99 of 200
1

Modiﬁed gravity has also been incorporated in approximate methods. Specif-
ically, Winther et al. (2017) and Valogiannis and Bean (2017) implemented
modiﬁcations to COLA (cf. Sect. 4.4) by computing 2LPT displacements in generic
MG models (up to second order) and included various screening mechanisms. These
authors found that the changes relative to KCDM in the power spectrum and halo
mass function were accurately captured by COLA (within a few per cent up to
k 	 3h Mpc1). A similar accuracy was reached by Mead et al. (2015b) who
extended cosmology-rescaling algorithms, so that the effects of MG in an N-body
simulation could be incorporated in post-processing.
As for dark matter candidates, a large number of possible modiﬁcations to the
equations of motion are allowed, each of which with their own free parameters. This
is a difﬁculty when generic predictions are required, e.g., in data analysis, or to
perform a systematic scanning of models with numerical simulations. For this
reason, there has been signiﬁcant work to formulate an effective parameterization
whose parameters can then be constrained (Lombriser 2016; Thomas 2020).
Deviations from GR can be quantiﬁed in a general way21 by modifying two of the
Einstein equations (in Fourier space) as
k2 ~UðkÞ ¼4pGa2qðaÞ lðk; aÞ ~dðkÞ
ð107aÞ
~WðkÞ ¼cðk; aÞ ~UðkÞ
ð107bÞ
where W and U are the two gravitational potentials (note that the lensing potential is
given by ðW þ UÞ=2), c is the gravitational slip, and l is a generic function that
captures the modiﬁcations between the relation of densities and the gravitational
potential (i.e. a scale and time-dependence of the gravitational ‘constant’). There-
fore, l ¼ c ¼ 1 yields the GR limit, but in general l and c can be complicated
functions of time and scale. In the linear regime, many theories (including f(R) and
DGP) can be exactly mapped to speciﬁc values and forms of c and l. However, in
the nonlinear regime this is less straightforward and parameterisations have been
proposed based on spherical collapse (Lombriser 2016), or a post-Friedmann for-
malism (Thomas 2020), which have been argued to be valid even down to very
small scales.
Following this philosophy, Cui et al. (2010) and Srinivasan et al. (2021) used
parameterised deviations from GR and carried out a suite of simulations with
different parameter values. So far, both of these approaches have considered only a
time dependence for l (e.g., Srinivasan et al. 2021 considered piecewise constant
values of l in redshift), but it is likely that in the future extensions to scale
dependence will be possible. Additionally, recently Hassani and Lombriser (2020)
showed that simulations adopting the Lombriser (2016) parametrisation can result in
percent-level agreement in the power spectrum with respect to direct f(R) and DGP
simulations. These results are very promising, although a more exhaustive
exploration of other summary statistics will be required in the future. Note that in
21 Sometimes this is referred to as Parameterised Post-Friedmannian approach, in analogy to the
Parameterised Post-Newtonian approach developed to measure deviations from Newtonian gravity in
Solar System observations.
123
1
Page 100 of 200
R. E. Angulo, O. Hahn

this case there is no need to solve for the evolution of the scalar ﬁeld, which makes
this kind of simulations signiﬁcantly easier to carry out.
Another advantage of such parameterisations is that they could be readily applied
to observations (e.g., Blake et al. 2020). For instance, Mueller et al. (2018) used a
similar parameterisation to constrain deviations from GR using redshift space
distortions in the BOSS survey. These constraints are expected to get signiﬁcantly
tighter with the newest generation of galaxy surveys and also by combining
different probes (higher order N-point functions, marked statistics, redshift space
distortion), for which we anticipate, the results of numerical simulations will be
crucial. An illustration of this are the recent results of He et al. (2016, 2018), who by
comparing the observed small-scale galaxy clustering against N-body simulations,
could rule out f(R) models with jfR0jJ106.
7.11 Closing remark
In this section we have reviewed several possible extensions to the physically
simplest KCDM simulations. Some of these modiﬁcations are more speculative in
nature, as e.g., modiﬁed gravity, whereas others are strongly motivated by physical
experiments, e.g., massive neutrinos. For an adequate interpretation of future
datasets it will be important to explore the interplay of such modiﬁcations and the
possible degeneracies that arise among them when interpreting cosmological data.
For instance, the power spectrum suppression that baryons display relative to CDM,
could potentially be misinterpreted as a signature of massive neutrinos. In this
direction, for instance, Kuo et al. (2018) carried out simulations with decaying
Fig. 21 Dependence of the nonlinear matter power spectrum at z ¼ 0 on the volume and mass resolution
of a N-body simulation. The left panel shows the fractional change in the power spectrum for various box
sizes L 2 ½128; 256; 512; 1024h1Mpc at a ﬁxed mass resolution. The right panel shows instead the
change produced by increasing the mass resolution while keeping ﬁxed the size of the simulation box.
Note that for achieving percent convergence (marked by the shaded region) up to k 	 3h Mpc1, boxes of
at least 	 500h1Mpc with particles less massive than 109h1M are required Image reproduced with
permission from Schneider et al. (2016), copyright by IOP/SISSA
123
Large-scale dark matter simulations
Page 101 of 200
1

Warm Dark Matter, and Schwabe et al. (2020) mixing fuzzy and particle Dark
Matter. Additionally, Baldi et al. (2014); Baldi and Villaescusa-Navarro (2018);
Hashim et al. (2018) have performed simulations with this focus, where they
consider cosmological scenarios with both modiﬁed gravity and warm dark matter,
with modiﬁed gravity and massive neutrinos, and with primordial non-Gaussianities
and interacting dark energy. As the quest for new physics continues to ever smaller
effects on the large-scale structure of the Universe, these kind of simulations will be
increasingly important in the future, and they will be required to guarantee the
robustness when a given KCDM extension becomes ruled out or favoured.
8 Numerical considerations and the challenge of high-accuracy
simulations
Numerical simulations start to play an increasingly central role in the interpretation
of observational data and in the quantitative inference of physical properties of the
Universe. It thus becomes essential to ensure the high precision and accuracy of
simulation results. In this section we discuss several key aspects in this regard.
8.1 Box size and mass resolution
Two basic properties of a cosmological simulation are the size of the simulated box
and the mass of the particles employed, both of which affect the nonlinear structure
formed. For a simulation of a given side length, L, Fourier modes below the
fundamental mode k\k0 ¼ 2p=L are effectively set to zero. Thus, structure grows
as if embedded in a region at the cosmic mean density and devoid of tidal forces,
which is a biased representation of actual ﬁnite regions in the universe. Power and
Knebe (2006) carried out a systematic study of the impact of these missing large
modes ﬁnding that, while the internal properties of dark matter halos are unaffected,
their abundance is strongly suppressed in small boxes, especially so at high masses.
Such a reduction in the number of dark matter halos also affects the nonlinear
power spectrum, suppressing its amplitude on quasi-linear scales. This has been
studied recently by several authors who all ﬁnd that a boxsize of J1000 h1Mpc is
required at z ¼ 0 to obtain a converged measurement—i.e. independent of further
increases of box size—of the density power spectrum and covariance matrices at the
per cent level (Schneider et al. 2016; Mohammed et al. 2014; Klypin and Prada
2019). Speciﬁcally, the nonlinear evolution of baryonic acoustic oscillations
depends on the correct modelling of large-scale ﬂows which also requires similarly
large boxes (Crocce and Scoccimarro 2006). The result of a study investigating the
effect of box size and mass resolution on the power spectrum by Schneider et al.
(2016) is reproduced in Fig. 21, where in the left panel the box size is varied at ﬁxed
123
1
Page 102 of 200
R. E. Angulo, O. Hahn

mass resolution and in the right panel the mass resolution is varied at ﬁxed box size,
each with signiﬁcant impact on the matter density spectrum.
The effects of the boxsize can be ameliorated by changing the equations of
motion such that they account for the fundamental (or DC) mode (Sirko 2005;
Gnedin et al. 2011), and sampling an ensemble of simulations representative of the
variance at the box scale. Such an approach is particularly important when carrying
out simulation ensembles to compute covariance matrices, as these are sensitive to
overdensities on scales larger than the box (see Sect. 6.3.5). Additionally, by setting
up initial conditions matching statistics in real space rather than Fourier space
(Sirko 2005), it is possible to obtain e.g., halo mass functions that are less biased
even for smaller boxes. Also, recent developments for modelling tidal ﬁelds larger
than the box size (Schmidt et al. 2018) might prove useful in the future to achieve
better convergence. Further, compactiﬁed simulations might offer an alternative
path as they naturally incorporate very large-scale modes (Ra´cz et al. 2018).
While the ﬁnite simulation volume modiﬁes the formation of halos mostly at the
high mass end, ﬁnite mass resolution determines the smallest halo resolvable in a
given simulation box. Thus, if halos that contribute signiﬁcantly to the nonlinear
power spectrum are not resolved, then the spectrum will be biased low. Schneider
et al. (2016) argued that a mass resolution of at least 109 h1M is required to
achieve per cent level convergence at k 	 1 h Mpc1 at z ¼ 0, as smaller halos
contribute negligibly to the power spectrum. Higher wavenumbers will be set by the
inner regions of halos, which might be affected by two-body relaxation and other
effects if not resolved with an adequate number of particles.
Furthermore, initial ﬂuctuations resolved with a small number of particles will
suffer from large numerical errors. Speciﬁcally, the abundance of halos resolved
with approximately less than 100 particles is overestimated as halo ﬁnders identify
statistical upward ﬂuctuations as real objects (Warren et al. 2006). Note however
that the actual rate of convergence depends on the halo ﬁnder algorithm (see
Sect. 9.4.1), as well as other numerical parameters such as force accuracy and the
softening length.
8.2 Close encounters and regularization in N-body methods
Another aspect affecting the numerical accuracy of the N-body solutions is related
to the so-called softening length, where the gravitational interaction ceases to be
Newtonian. As discussed also at length in Sect. 5.3, the Green’s function of the
Laplacian is GðrÞ ¼ 1=ð4pkrkÞ, which translates into the Green’s function Ga :
¼ $r2dDðrÞ of the acceleration operator, i.e.,
GaðrÞ ¼ 
r
4pkrk3
ð108Þ
which are both divergent for r ! 0. If the goal is to model dark matter in the
continuum limit, then this is undesired behavior: it drives an effective collision term
resulting in two-body relaxation, which leads to a deviation from collisionless
Vlasov–Poisson dynamics. In practice, it also imposes arbitrarily small time steps if
123
Large-scale dark matter simulations
Page 103 of 200
1

step criteria like Eq. (45) are used. The usual solution is to impose a small-scale cut-
off. In the simplest case of ‘Plummer softening’ (e.g., Hernquist and Barnes 1990)
one sets GðrÞ ¼ 1=ð4p
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
krk2 þ 2
q
Þ with a ‘softening length’ , so that the tamed
acceleration becomes
Ga;ðrÞ :¼ $G ¼ 
r
4p krk2 þ 2

3=2 ;
ð109Þ
which in fact vanishes for r ! 0, but is only asymptotically Newtonian (i.e. at
r ! 1). The maximum acceleration is reached for r ¼ =
ﬃﬃﬃ
2
p
with a value of
maxr kGa;k ¼ 2=ð3
ﬃﬃﬃ
3
p
2Þ. Other popular ways of modifying Eq. (108), such as
Kernel softening, can guarantee a transition to Newtonian force at ﬁnite r, typically
a few times the softening scale, e.g., Springel et al. (2001b). One should also remark
that if grid-based methods are used, unless extremely aggressive adaptive mesh
reﬁnement strategies are employed (e.g. reﬁnement on single particles), the grid
scale
directly
provides
a
regularisation
scale
and
suppresses
two-particle
interactions.
2
4
6
8
log (M200/mpart)
−4
−3
−2
−1
0
log (ϵ/r200)
90 = 2 r200/N200
v = r200/N200
ϵacc = r200/√N200
trelax ∼tH
c = 20
c = 5
Eagle
Illustris −1
Illustris −TNG
ϵopt
FIRE
Apostle
NIHAO
Latte
Aq −A −1, 2
Fig. 22 Diagonal black lines show three estimates for the minimum value of the gravitational softening
90, v, acc required for the simulated dynamics to be collisionless. Thus, the beige region might be
dominated by numerical errors. The dark blue region marks the minimum scale for which the 2-body
collisional relaxation is equal to a Hubble time, for halos of different concentrations. Thus, an optimal
value of the lie near the white region for halos resolved with at least 100 particles. The optimal values of
van den Bosch and Ogiya (2018), opt=r200 ¼ 2:3  N1=3
200 , which is approximately opt 	 0:017L=N1=3, is
denoted by the dashed line, whereas the values adopted in various simulations are shown by coloured
lines Image reproduced with permission from Ludlow et al. (2019), copyright by the authors
123
1
Page 104 of 200
R. E. Angulo, O. Hahn

With softening, the collisionless N-body system becomes well behaved at the
price of smoothing out structure on scales comparable to the size of . Formally, the
need for a softening length appears in cases where the N-body discretization is no
longer valid—separations smaller than the typical size of the volume chosen for the
coarse-graining process. Under these arguments, the softening should be chosen
such that  	 ‘ :¼ ðV=NÞ1=3 (Melott et al. 1997; Splinter et al. 1998; Romeo et al.
2008). Unfortunately, with current computational power, this is typically much
larger than the regions of interest—e.g. the virial radius of a halo resolved with
	 100 particles is 	 0:3‘—and large-scale simulations adopt values 30–100 times
smaller. For instance, and in units of the mean inter-particle separation, the Bolshoi
simulation employs 0.016 (Klypin et al. 2011), the Multidark simulations
0.0150–0.026 (Klypin et al. 2016), the set of Millennium simulations 0.022
(Springel 2005; Boylan-Kolchin et al. 2009; Angulo et al. 2012), and the EUCLID
ﬂagship 0.02 (Potter et al. 2017).
There are several possible criteria for setting the softening length in a simulation.
The goal is to suppress discreteness effects and force errors while maximizing the
range of scales and amount of resolved nonlinear structure (Ludlow et al. 2019).
One possible criterion, v, is to require that the binding energy of a halo is larger
than that of two particles at a distance , other criteria aim to suppress the effect of
close two-body encounters by looking at the change in acceleration (acc) or in large-
angle deﬂections (90). However, these are qualitative estimates, and usually
softening is chosen empirically from the observed convergence in numerical
experiments, e.g. the behaviour of the proﬁles of halos or the small-scale power
spectrum. Figure 22 shows a diagram with various possible estimates of the
softening length, including v, acc, 90 and the optimal values discussed below,
along with the values adopted by some state-of-the-art simulations.
Power et al. (2003) carried out a systematic analysis of the impact of numerical
parameters in the convergence of circular velocity proﬁles. They empirically
showed that convergence to within 	 10% can be achieved on scales larger than a
region enclosing a number of particles whose two-body relaxation time was larger
than the Hubble time. This criterion has been validated and employed in multiple
simulations afterwards (Diemand et al. 2004b; Springel et al. 2008a; Navarro et al.
2010; Gao et al. 2012) and is usually adopted when setting the softening length of
current simulations. In addition, the same authors (Power et al. 2003) proposed an
empirical ‘optimal’ softening length opt=r200 ¼ 4ðN200Þ1=2—this approximately
translates to  ¼ 0:03‘—which is widely used, especially in zoom simulations.
Note, however, that Zhang et al. (2019a) argued that this criterion was overly
conservative (see also Ludlow et al. 2019) and advocated for a factor of 2 smaller
softening, i.e. opt=r200 ¼ 2ðN200Þ1=2—based on the convergence of density and
circular velocity proﬁles of 	 1012h1M halos in cosmological boxes. An even
smaller value of the softening length was advocated by Mansﬁeld and Avestruz
(2021). By comparing a large number of publicly-available simulations, they found
that the shape and peak of the circular velocity of halos appeared systematically
biased for values larger than =‘ 	 0:008.
123
Large-scale dark matter simulations
Page 105 of 200
1

Using controlled idealised simulations, van den Bosch et al. (2018), van den
Bosch and Ogiya (2018) have also argued that current choices of the softening
length are inadequate for simulating the evolution of dark matter subhalos.
Speciﬁcally, they argue that subhalos resolved with less than 1000 particles suffer
from instabilities and are artiﬁcially disrupted. This could be a serious ’’over-
merging‘‘ problem [a classic N-body problem, see already Moore et al. (1996)] for
simulations as their prediction for the abundance and spatial distribution of dark and
luminous satellites could be unreliable. However, more recent results (Green et al.
2021) indicate that the effect is at most 10–20 per cent on the subhalo mass function.
As a way to alleviate the overmerging problem, van den Bosch et al. (2018) argue
for a softening length a few times smaller than usual choices. Speciﬁcally, they
argue that the optimal softening is opt=r200 ’ 2:3ðN200Þ0:33 [which is very similar
to that of Zhang et al. (2019a) discussed above].
On cosmological scales, Joyce et al. (2020) argued that self-similarity in statistics
measured in scale-free simulations (i.e., simulations with a power-law initial power
spectrum in an Xm ¼ 1 cosmology) is a good indicator of the degree of convergence
of a given simulation setup. With such, Garrison et al. (2021) advocate for an
optimal softening length of  ¼ 0:033‘ but ﬁxed in physical (as opposite to
comoving) coordinates. The choice of physical softening is a usual practice in
hydrodynamic and zoom simulations, but note that this formally yields a time-
dependent Hamiltonian (cf. Sect. 4) requiring some extra care in formulating the
integrator since the gravitational force would receive an additional contribution
(Price and Monaghan 2007) (but note that in superconformal time, the potential is
already the only time-dependent piece of the Hamiltonian). However, the magnitude
of the error introduced by ignoring such details might be acceptable for large-scale
simulations, with the advantage of requiring less timesteps at high redshifts.
In summary, there is consensus that force softening slightly smaller than what has
been traditionally adopted is preferred to improve convergence at a ﬁxed
computational cost. On the other hand, it is important to keep in mind that there
are a few examples of problems originating from too small softening lengths. One is
the case of artiﬁcial fragmentation in warm dark matter and ﬁrst halos, where
ﬁlaments (expected to be completely smooth) break down in pieces in a mass-
resolution dependent way. Another example is in the simulation of two cold ﬂuids
with different initial power spectra (as is the case of baryons and dark matter in the
early Universe). One has to keep in mind however that whenever   ‘, then the
system evolves as a discrete system rather than in the continuous limit. This leads to
signiﬁcant deviations during the initial phase of a simulation (see our discussion in
the next section on initial conditions), and contributes an additional source of
numerical error in cosmological predictions.
There have been some attempts in the literature to ﬁx the problems of the local
evolution of the ‘mean’ particle separation scale ‘ but with relatively limited
success. One example is the case of a variable softening length which is determined
by the local density (Price and Monaghan 2007; Bagla and Khandai 2009; Iannuzzi
and Dolag 2011), or by the eigenvalues of the moment of the inertia tensor (Hobbs
et al. 2016). Unfortunately, anisotropic collapse is typical in cosmological
123
1
Page 106 of 200
R. E. Angulo, O. Hahn

simulations, and thus isotropic softening tends to under- or over-smooth forces.
Isotropic adaptive softening is also already implicitly built into those codes that rely
on adaptive mesh reﬁnement and a particle-mesh based gravity solver, as e.g.
RAMSES or ART, see also Knebe et al. (2000), since the reﬁnement criterion is
usually tied to the local particle density. A more conservative reﬁnement criterion
compared to the very small softening typically employed with tree codes is then also
the reason why often such AMR codes display some suppression of the mass
function for the smallest halos (see also 8.5 below).
It is clear from the above that a possible direction for progress could be an
anisotropic softening determined by the local distortion tensor or by solving for the
GDE. This, in fact, would be very similar to a low-order version of the cold sub-
manifold method discussed earlier.
8.3 Accuracy of initial conditions
Initial conditions that are set-up using Lagrangian perturbation theory (LPT), see
Sect. 6.2, use a low-order truncation of LPT. The resulting truncation error appears
as a ‘transient’ error in the non-linear evolution of the cosmic density ﬁeld. This
truncation error is largest if LPT is truncated at low order and the simulation started
at late times. As a consequence, second order (2LPT) ICs have long been advocated
as a more accurate replacement of ﬁrst order (Zel’dovich approximation) ICs for
setting up initial conditions (Scoccimarro 1998; Valageas 2002; Crocce et al. 2006).
Fig. 23 Dependence of the statistical properties of a simulated nonlinear density ﬁeld on the details of
how the initial conditions are constructed. Left and right panels show the results for the matter power
spectrum and for the bispectrum with equilateral conﬁguration (k ¼ k1 ¼ k2); whereas top and bottom
panels display z ¼ 0 and z ¼ 1, respectively. In each panel, results are shown for various choices of
starting redshift zstart 2 ½11:5; 24; 49; 99; 199, and the order of the Lagrangian Perturbation Theory (LPT)
used to compute the particle displacements at the respective redshift. The reference run is a simulation
initialized with 3LPT at redshift 24 and using a face-centered-cubic lattice with four times as many
particles as in the test simulations Image reproduced with permission from Michaux et al. (2021),
copyright by the authors
123
Large-scale dark matter simulations
Page 107 of 200
1

In principle, it is always possible to simply start the simulation at early times to
reduce the truncation error and avoid having to use higher order LPT, but numerical
errors during the early stages of the simulation can be large for some schemes, since
the density perturbations away from homogeneity become increasingly smaller and
are easily overshadowed by numerical errors if inadequate force calculation is used
(this is particularly a problem for the tree method (cf. Sect. 5.4).
However, a further limitation of N-body simulations is due to discreteness
effects. While LPT initialises the N-body simulation with the growing modes of the
continuous ﬂuid system (with perturbations truncated in the UV at some wave
number usually not too far from the particle Nyquist wave number), the N-body
system itself follows the dynamics of a discrete system. The resulting growing and
decaying modes are different from the continuous ﬂuid, and in fact anisotropic at the
discretisation scale, as demonstrated by Joyce et al. (2005), Joyce and Marcos
(2007a, b), Marcos et al. (2006). As a consequence, there is a secondary transient
resulting from the transition of the N-body simulation from the continuous dynamics
to the discrete dynamics, which is accompanied by a distinct suppression of the
power spectrum on scales close to the particle Nyquist wave number during weakly
non-linear phases of the simulation. To compensate for this effect, Garrison et al.
(2016) have proposed to explicitly correct for this error by projecting into the
discrete eigenmodes and correcting the lack of growth with a boosted velocity that
exactly compensates the leading error term at a speciﬁc target time. Arguably a
downside of this approach is that, due to the boost, the evolution of the system prior
to the target time is somewhat unphysical.
In order to circumvent both truncation and discreteness errors, Michaux et al.
(2021) have argued for the use of particularly late starting times employing higher
order (3LPT) initial conditions. Michaux et al. (2021) also showed that these errors
are largest during the mildly non-linear evolution, but then decrease again once
scales close to the particle Nyquist wave number are dominated by structures that
are fully collapsed and virialised. The use of high order LPT and late starting times
might therefore allow more economical simulations, i.e. fewer particles to reach a
given accuracy up to a certain wave number. Even higher order initial conditions
might not be necessary except in very special situations, since LPT has been shown
to converge very quickly prior to shell-crossing (Rampf and Hahn 2021). The study
by Rampf and Hahn (2021) also found that for higher order LPT it is preferable to
exclude so-called ‘corner modes’ (i.e., modes between 1 and
ﬃﬃﬃ
3
p
times the linear
particle Nyquist wave number) in order to reduce artefacts in non-linear terms due
to UV truncation of the perturbation spectrum and convolution integrals. The effect
of these ‘corner modes’ for low order ICs (i.e. up to 2LPT) on non-linear simulation
results has been found to be small (Falck et al. 2017).
All these aspects are summarised in Fig. 23 which compares the power spectrum
and bispectrum as measured in simulations adopting various starting redshifts, zstart,
and LPT orders. We can see, for instance, that using 1LPT (i.e. the ‘‘Zeldovich
approximation’’) leads to a systematic underestimation of clustering statistics on
both intermediate and small scales. This effect is somewhat reduced for higher
starting redshifts, but an increase in the LPT order yields a much more signiﬁcant
123
1
Page 108 of 200
R. E. Angulo, O. Hahn

improvement. Employing 3LPT initial conditions, even at zstart ¼ 11:5, agrees with
the reference soluution at the subpercent level for k.2h Mpc1 at both redshifts and
for the power spectrum and bispectrum in this case.
8.4 Chaos and determinism in simulations
So far we have discussed how differences in the setup, discretization, or numerical
parameters of a simulation affect its predictions. However, even for a given set of
choices and deterministic equations of motion, stochasticity can arise in the
predictions for the nonlinear density ﬁeld as a result of chaotic behavior.
Chaos refers generally to a process in which exponentially divergent results
appear from small differences in the initial state of a system. Chaos in a Hamiltonian
system in a 3?3-dimensional phase space can be formally quantiﬁed in terms of
three distinct Lyapunov exponents k1;2;3 (due to the symplectic nature they come
in pairs). A notion of predictability of a system is then given by the maximal
Lyapunov exponent, deﬁned as the most rapid characteristic separation rate of two
trajectories separated by a vector dnðtÞ in phase space, i.e. dnðtÞ
j
j 	 expðktÞ dn0
j
j in
a linearised sense so that
k 	 lim
t!1
1
t log dnðtÞ
j
j
dn0
j
j ;
ð110Þ
where the initial separation dn0 should be thought of as inﬁnitesimal.
In the case of numerical simulations, seeds for chaos and stochastic behavior
could arise from round-off errors and/or from small variations in the initial
conditions of the system. Additionally, errors associated with the force calculation
and time integration could be exponentially ampliﬁed in chaotic systems. In fact,
examples of chaotic behavior have been reported in the literature for N-body
simulations of star clusters, satellite galaxies, halo stars, and planetary systems
among others (Heggie 1991; Goodman et al. 1993; El-Zant et al. 2019; Mafﬁone
et al. 2015; Price-Whelan et al. 2016). In principle, Lyapunov exponents can be
computed during the evolution of the N-body system to identify regions of chaos
(Habib and Ryne 1995), and the ‘GDE’ approach can also give direct access to them
(Vogelsberger et al. 2008). Understanding chaos in a cosmological context is
important to determine the accuracy and robustness of numerical simulations. As
discussed earlier, the evolution of a N-body system may not be guaranteed to
converge to the continuum limit even for inﬁnite particles.
Chaos in a cosmological simulation context has been explored by several authors.
By comparing an ensemble of runs with identical initial power spectrum but with
small differences in their white-noise ﬁeld, Thie´baut et al. (2008) found that large
scales and time-integrated halo properties such as position, mass and spin were
robust predictions. On the other hand, the position of substructures, and the
orientation of the spin and the velocity dispersion tensor showed larger variations.
Using pairs of simulations with identical initial conditions up to a small
perturbation, Genel et al. (2019) quantiﬁed the role of chaos in the properties of
well-resolved objects in numerical simulations. They found that differences in the
123
Large-scale dark matter simulations
Page 109 of 200
1

mass and circular velocity of halos grows exponentially, but that it saturates at a
level compatible with Poisson noise;
	 1=
ﬃﬃﬃﬃ
N
p
for a system resolved with
N particles. A similar conclusion was reached by El-Zant et al. (2019) studying
the time-reversibility of N-body systems: initial errors grow rapidly during an initial
phase but they subsequently saturate.
The results above suggest that numerical simulations of self-gravitating systems
do indeed converge, albeit slowly, to the collisionless limit as N tends to inﬁnity.
This is in contrast with cosmological hydrodynamical simulations, where initial
differences, round-off errors and sometimes stochastic star formation prescriptions
have been found to result in marked differences in the global properties of simulated
galaxies, even contributing signiﬁcantly to some scaling relations (Genel et al.
2019; Keller et al. 2019).
8.5 Convergence among codes
With few exceptions (see Sect. 3), all modern simulation codes essentially adopt the
same approximations to predict the nonlinear state of large-scale structure in the
Universe: the N-body discretization of a single ﬂuid (describing both baryons and
dark matter) that only interacts gravitationally. However, different codes make
different algorithmic choices regarding the force calculation, force softening, and
time integration, and also could be subject to systematic errors (also programming
bugs become more likely with the increasing algorithmic complexity of codes).
0.01
0.10
1.00
10.00
100.00
k [ h Mpc-1 ]
-0.02
-0.01
0.00
0.01
0.02
ln [Δ2(k) / Δ2
G4(k)]
GADGET-4
PKDGRAV-3
ABACUS
RAMSES
power spectrum, z = 0
0.01
0.10
1.00
r  [ h-1Mpc ]
-0.4
-0.2
0.0
0.2
0.4
ρ(r) / ρref (r) - 1
GADGET-4
PKDGRAV-3
ABACUS
RAMSES
deviations in averaged profile
Fig. 24 Comparison between the nonlinear structure at z ¼ 0 as predicted by 4 different N-body codes
evolving the same initial conditions of the ‘‘Euclid comparison project’’ (Schneider et al. 2016). This
simulation corresponds to a cubical box of side L ¼ 500h1Mpc with 20483 particles of mass
1:2  109h1M. The left panel shows the nonlinear matter power spectrum whereas the right panel
shows the stacked density proﬁle for the 25 most massive halos in the simulation. Displayed results are
obtained from GADGET-4 (Springel et al. 2021), PKDGRAV-3 (Potter and Stadel 2016), ABACUS
(Garrison et al. 2019), and RAMSES (Teyssier 2002). Note that all codes agree remarkably well even
down to very small scales (\1% up to k 	 10h Mpc1), and eventually disagree on smaller scales owing to
different numerical parameters adopted in each run. Similarly, the density proﬁles agree to a percent level
down to 10h1kpc Image reproduced with permission from Springel et al. (2021), copyright by the
authors
123
1
Page 110 of 200
R. E. Angulo, O. Hahn

Given the importance of the predictions and role of numerical simulations, it is
important to compare the performance and predictions of different codes.
An early comparison carried out by O’Shea et al. (2005) between the codes
ENZO and GADGET revealed systematic differences originating from the
algorithm employed to compute gravitational interactions. The particle mesh
simulation with adaptive mesh reﬁnement yielded a lower power spectrum
amplitude on small scales compared to the tree-PM simulation. It was found that
this discrepancy came from the conservative reﬁnement criteria missing the
formation of small halos at high redshift. A more aggressive mesh reﬁnement led to
much better agreement, but this served as an example that, although codes are
solving the same equations, numerical simulations are complex systems and
numerical errors can easily propagate to large levels. In the same year, Heitmann
et al. (2005) compared several codes in the context of large-scale clustering
predictions by carrying out both cosmological and idealised simulations.
A more systematic comparison among N-body codes was carried out in 2008 by
the Cosmic Code Comparison Project (Heitmann et al. 2008), in which ten codes
evolved the same initial conditions of comoving boxes of 64 h1Mpc and
256 h1Mpc, as well as the ‘‘Santa Barbara cluster’’ (Frenk et al. 1999). The
agreement of the codes had by then improved dramatically with all of them agreeing
on the amplitude of the z ¼ 0 nonlinear power spectrum at the 10  20% level up to
k 	 10h Mpc1, and at 5  10% at k 	 5h Mpc1. A comparison in 2014 of nine
cosmological N-body codes simulating the same 	 1011h1M halo by Kim et al.
(2014) demonstrated small differences in the global density proﬁle but pronounced
differences in the subhalo mass functions between AMR and tree-based codes
consistent with the earlier found suppression of small haloes when conservative
reﬁnement criteria are used.
Schneider et al. (2013) carried out the ‘‘Euclid comparison project’’ – a more
demanding test simulating a box of 500 h1Mpc per side with 20483 particles, which
should have led to converged results with respect to boxsize and mass resolution.
There were only three participant codes, GADGET-3, PKDGRAV-3, and RAMSES,
which showed a remarkable agreement of \5% for k 	 5h Mpc1. An important
feature of this code comparison was that the initial conditions were released
publicly22, so that any N-body code could carry out the same simulation and
compare their predictions. In fact, subsequently, further codes have been added to
this comparison as the initial conditions were run by several authors recently to
include the codes ABACUS (Garrison et al. 2019), L-GADGET-3 (Angulo et al.
2021), and GADGET-4 (Springel et al. 2021).
In Fig. 24 we show a recent comparison between four state-of-the-art codes.
Remarkably, the power spectrum on large scales agrees between all of them to
better than 0:4% which extends up to k 	 2h Mpc1 and somewhat degrades to 2%
up to k 	 10h Mpc1. Note that in the original comparison paper, GADGET-3 was
an outlier, displaying systematic differences with respect to the other codes.
However, the results of Angulo et al. (2021) and Springel et al. (2021) regarding the
22 https://www.ics.uzh.ch/*aurel/euclid.htm.
123
Large-scale dark matter simulations
Page 111 of 200
1

GADGET-3 code suggest that this run was probably carried out with poorer time
integration or force accuracy compared to the other codes.
Overall, the current agreement at the sub-percent level among codes is a
remarkable achievement for the ﬁeld of computational cosmology, which can now
claim that the nonlinear evolution of collisionless matter can be predicted to better
than one per cent, including sources of systematic error, over the full range of scales
relevant for upcoming weak lensing surveys. This naturally has been the ﬁrst
necessary step to demonstrate the robustness of numerical predictions, in the future
similar comparisons extended to other statistics (e.g. the bispectrum and higher-
order correlations, velocity ﬁelds, halo mass functions, etc) and to a more realistic
description of the universe (e.g. multiple ﬂuids, including neutrinos and baryons),
will be required to establish robustly the predictions of numerical simulations. In
addition, a careful assessment of the impact of the ubiquitous N-body discretization
itself will also be essential, which only now is becoming possible with the
development of the alternatives that we have discussed previously. We discuss this
in the next subsection.
8.6 The N-body approximation
Throughout this review we have argued that simulations are essential in modern
cosmology and are the only way to obtain accurate results in the nonlinear regime.
Speciﬁcally, in this section we have discussed how the results of cosmological
simulations converge as a function of numerical parameters; box size, mass
resolution, and initial conditions, as well as conditions for choosing the softening
length. Additionally, we discussed how different simulations codes do agree in their
predictions for the nonlinear matter clustering down to small scales.
It is important to highlight that these statements regard convergence within the N-
body discretisation. All codes employed in large-scale simulations do assume the
same N-body discretisation of the underlying ﬂuid equations, and they differ simply
in algorithmic choices about how to compute gravitational forces and perform the
time integration. Although they might differ in their computational efﬁciency and
convergence rate, they are expected to show convergence. However, the N-body
dynamics and ﬁnal distribution function is not necessarily identical to that of the
continuum limit. Actually there is no formal proof of the convergence, and any
observed convergence through resolution studies could arise due to, for instance, the
inherent noisiness of the problem or it could be that the convergence to the true
solution is extremely slow.
As we have discussed before, there are actually a few examples where the N-
body discretization clearly introduces signiﬁcant errors, even on large-scales. The
spurious effects of discreteness noise and a ﬁnite softening length are very evident
in warm dark matter cosmologies where ﬁlaments fragment and collapse into halos
originated by discreteness effects. Another example is in two-ﬂuid simulations, such
as baryon and dark matter, where discretisation errors lead to the incorrect
evolution, even on extremely large scales due to small-scale coupling. Also, the
differences between the continuous ﬂuid solution and the discrete N-body system
123
1
Page 112 of 200
R. E. Angulo, O. Hahn

are noticeable as a pronounced starting redshift dependence of the small-scale
power spectrum during the mildly non-linear evolution.
In fact, there are claims that N-body results might be strongly affected by
discreteness noise, and overly strong phase-space diffusion, which could act as an
attractor, thus showing convergence to the wrong solution (Baushev 2015). In this
case, for instance, the actual density proﬁle of collapsed objects might differ from
the standard NFW proﬁle, which could ultimately imply biases in, for instance, the
comic parameters inferred from weak gravitational lensing.
Given the importance of simulations in cosmology, it is crucial to be aware of
these limitations and explore whether the predictions relevant for large-scale
structure and the interpretation of cosmological observations is actually correct. An
important test would be to compare the N-body results against those of simulations
adopting other discretisation techniques. However, this has not yet been fully
achieved in the highly nonlinear regime, since the alternative techniques are much
more computationally expensive.
An important step in this direction was recently taken by Colombi (2021). In this
study, the formation of earth-mass microhalos and an idealised case of three
collapsing sine waves were simulated using a N-body PM code and the Lagrangian
phase-space tessellation code COLDICE (Sousbie and Colombi 2016). These authors
showed that both approaches agree remarkably well, as long as there is more than
one particle per force resolution element. This result is in agreement with the well
known studies that argued that N-body simulations can be reliable only as long as
the softening length is chosen of the order of the mean inter-particle separation
(Melott et al. 1997; Splinter et al. 1998). This scale is also the one implicitly
adopted by phase-space tessellations in Lagrangian space.
Interestingly, Colombi (2021) showed that N-body and phase-space tessellations
both predict a steep power law density proﬁles, in agreement with several previous
studies (cf. Sect. 7.1). After an initial period of collapse, discreteness noise and
perturbations of physical origin, such as mergers, drive the system towards an
NFW-like proﬁle (Syer and White 1998; Ishiyama 2014; Ogiya et al. 2016; Angulo
et al. 2017; Ogiya and Hahn 2018). This is an interesting result since in some WDM
models, the monolithic collapse of ﬂuctuations occurs near the observational limits,
thus it might be possible that this distinctive internal properties might leave
observable signatures.
In summary, there is strong evidence that the N-body solution is correct as long
as the softening is appropriately chosen and is of the order of the local mean inter-
particle separation. Note, however, that as we have see in section 8.2, modern large-
scale simulations typically use much smaller values. This is mandated by the
requirement that the gravitational force should be Newtonian down to the smallest
possible scale in order to prevent a too slow growth of small-scale perturbation in
CDM simulations. It will be interesting in the future to conﬁrm that the overall
predictions of large-scale simulations are quantitatively correct. This will be a
crucial step towards robust inferences from cosmic observations that will
progressively rely more on numerical simulations.
123
Large-scale dark matter simulations
Page 113 of 200
1

9 Analysis and postprocessing
In this section, we will review the most common statistics that can be computed
from cosmological N-body simulations, and discuss various analysis and post-
processing strategies to connect simulated universes to observables in the real
Universe.
9.1 The density field
The most basic predictions from simulations are the statistics of the nonlinear matter
density and velocity ﬁelds across cosmic time. These statistics are closely related to
the interpretation of several observational measurements such as gravitational
lensing, the abundance and spatial distribution of biased tracers, redshift space
distortions, and the kinetic Sunyaev–Zel’dovich effect, and are important for an
understanding of structure formation in general.
Using a mass deposit scheme (most commonly CIC interpolation, see
Sect. 5.1.2), the density ﬁeld can be readily obtained on a three-dimensional grid
from the N-body particle distribution. Such a procedure has however the problem
that, if perturbations on scales k [ kNy exist (the Nyquist wave number is deﬁned as
kNy :¼ p=Dx, where Dx is the grid spacing) they will be misidentiﬁed as modes
supported by the grid (i.e. k\kNy), which leads to errors in Fourier space. This is
referred to as aliasing [see Hockney and Eastwood (1981) for a detailed discussion].
This problem can be cured by interlacing, where the particles are additionally
shifted (in the simplest case once by a vector ðDx=2; Dx=2; Dx=2Þ) before deposit
and then shifted back using a Fourier space shift. If averaged with the original
deposit, it can be shown that the leading order aliased contribution is cancelled out
(Hockney and Eastwood 1981; Sefusatti et al. 2016).
Since the N-body scheme is Lagrangian, particles sample mass, and therefore the
signal-to-noise ratio of the density ﬁeld can be very low if a grid cells contain few
(or no) particles. This shortcoming can in principle be circumvented by employing
adaptive kernel estimators (such as an SPH)-like approach, a Voronoi-tessellation
based on particle positions (van de Weygaert 1994; Cautun and van de Weygaert
2011), or by using the phase space sheet tessellation method (cf. Sect. 3.2.2, Ka¨hler
et al. 2012), which all can give a well deﬁned density estimate everywhere in space.
A disadvantage of adaptive softening is that the ﬁlter properties are not easily
known in Fourier space, so that a de-convolution with the assignment kernel, which
is a common step in power spectrum estimation, is not possible. Information from
the full three-dimensional density ﬁeld is then usually further compressed into
various ‘summary statistics’, traditionally those statistics that can be predicted from
perturbation theory have been favoured (e.g., n-point spectra and correlation
functions), but new statistics are being considered to maximise cosmological
information content or discriminative power, e.g., Cheng et al. (2020).
Since primordial cosmological perturbations are (close to) Gaussian, non-
Gaussianity arises in the late Universe through non-linear evolution, and the density
ﬁeld approaches a Gaussian ﬁeld only on large scales. A Gaussian ﬁeld is fully
123
1
Page 114 of 200
R. E. Angulo, O. Hahn

described by its two-point statistics so that power spectra and two-point correlation
function take a central role in cosmological analysis, but need to be supplemented
with higher order statistics to be sensitive to additional cosmological information in
phase correlations, see Sect. 9.2 below. By averaging over ﬁnite volumes (‘counts
in cells’, Peebles 1980) and evaluating their one-point statistics (i.e., the variance,
skewness, kurtosis of the density probability distribution, which is close to log-
normal at late times, Coles and Jones 1991) one can probe similar information. Also
the statistics of peaks and troughs (or clusters and voids) is a sensitive probe of the
underlying cosmology since these occupy the tails of the density distribution, see
Sect. 9.4. This analysis has more recently been extended to include the statistics of
all critical points (i.e. also saddle points) and critical lines to characterise the density
ﬁeld (Sousbie 2011; Xu et al. 2019). Also excursion sets (i.e., isodensity surfaces)
of the density ﬁeld contain cosmological information, which is conveniently
expressed in invariant form in the Minkowski functionals (scalars) (Schmalzing and
Buchert 1997; Nakagami et al. 2004; Arago´n-Calvo et al. 2010; Fang et al. 2017;
Lippich and Sa´nchez 2021). These latter methods already quantify some aspects of
the anisotropic cosmic web (see the separate discussion in Section 9.5 below).
9.2 Power-spectra and correlation functions, n-point and n-spectra
The properties of the density ﬁeld, or the spatial distribution of a (biased or
unbiased) set of points drawn from it, e.g. N-body particles or halos, can be
characterized by a hierarchy of n-point functions. For a non-Gaussian ﬁeld, all the
connected n-point functions are needed to fully describe the ﬁeld. In Fourier space,
the power spectrum corresponds to the two-point function; the bispectrum to the
tree-point function; the tri-spectrum the four-point function, and so on.
The algorithmic complexity of computing these statistics increases as the n-th
power of the number of points. For computational efﬁciency, it is common to
estimate these correlations in Fourier space employing Fast Fourier Transforms
(FFT) applied over the density ﬁeld estimated on a uniform grid. This computation
then scale with the number of grid points Ng as OðNg log NgÞ, rather than with the
number of points in the sample. FFTs are particularly suited to analyze
cosmological simulations as they naturally incorporate the periodic boundary
conditions assumed in simulations, and efﬁcient numerical implementation exist.
However, as mentioned earlier, some care is needed to avoid ‘‘aliased’’ results.
The impact of aliasing on the power spectrum has been studied by several
authors. Jing (2005) analytically estimated the power spectrum including aliasing
for generic mass assignments, and proposed an algorithm to iteratively correct for it.
Colombi et al. (2009) also proposed a correction based on a Taylor-Fourier
expansion of the aliased spectrum. Aliasing can in principle be reduced if the mass
assignment scheme is a low-pass ﬁlter, thus effectively zeroing all small scale
Fourier modes not supported by the FFT (strictly all scales k [ 2kNy=3 should be
zeroed). Cui et al. (2008), Yang et al. (2009) argue that Daubechies wavelets and
B-splines can fulﬁl this purpose. More recently, Sefusatti et al. (2016) showed that
123
Large-scale dark matter simulations
Page 115 of 200
1

interlacing (see above) is a very efﬁcient way to reduce signiﬁcantly the effect of
aliasing for any mass assignment scheme.
Another issue related to uniform FFT grids is that the number of grid points
increases as OððL=DxÞ3Þ, thus measuring small scales can quickly become
prohibitively expensive. To circumvent this limitation, Jenkins et al. (2001)
proposed a folding technique, where the particle distribution is periodically
wrapped to a smaller box of size L0  L=b with b 2 N replacing x ! x mod L0. The
new Nyquist wave number becomes a factor of b higher for the same computational
cost, at the price of an overall larger statistical error, which is however acceptable in
many situations. More recently, the folding technique has been shown to also be
applicable the calculation of the bispectrum (Arico` et al. 2021a).
Note that in various situations, especially when estimating a density ﬁeld from
halos/galaxies, it can be preferable to compute correlation functions directly in
conﬁguration space, rather than through two DFTs (since the smallest resolved scale
is not limited by the grid resolution, and the computational cost scales with the
number of objects rather than the number of grid points). These direct algorithms
can be very efﬁcient if search trees are used for the range search. Therefore, another
alternative for estimating small-scale power spectra and bispectra is to compute
these Fourier statistics in conﬁguration space, by counting pairs or triplets of objects
(Philcox and Eisenstein 2020; Philcox 2021). Currently, there exist several publicly
available codes to efﬁciently compute correlation functions, power spectra and
higher-order statistics from numerical simulations, some of these are POWMES
(Colombi et al. 2009), NBODYKIT (Hand et al. 2018), BSKIT (Foreman et al.
2020), PYLIANS (Villaescusa-Navarro 2018), HIPSTER (Philcox 2021), CORR-
FUNC (Sinha and Garrison 2020), CUTE (Alonso 2012), and HALOTOOLS
(Hearin et al. 2017).
An important property of a discrete sample (i.e. halos or galaxies) of the cosmic
density ﬁeld is its bias, b(k), which quantiﬁes the differences in the overdensity ﬁeld
dg relative to that of the underlying (unbiased) dark matter ddm as a (scale-
dependent) multiplicative factor bðkÞ :¼ dgðkÞ=ddm. The bias can be readily
estimated from two point functions as bðkÞ ¼
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
PgðkÞ=PdmðkÞ
p
, or from the cross-
correlation between the sample and DM as bðkÞ :¼ Pg;dm=Pdm, which has the
advantage of being less affected by stochastic noise. The bias can also be deﬁned for
individual objects as the overdensity of DM around it relative to that around random
locations (e.g., Paranjape et al. 2018). Note that the average of the individual bias of
objects in a sample is mathematically equivalent to the bias of the sample.
On large scales (where jdj\1), it is possible to expand b(k) perturbatively in
terms of powers and derivatives of d (see Desjacques et al. 2018 for a review). The
coefﬁcients of this expansion are usually referred to as bias parameters, and have
been measured in N-body simulations using n-point functions, cumulants, and more
recently also by employing the separate universe formalism (e.g., Lazeyras et al.
2016; Lazeyras and Schmidt 2018, 2019). The perturbative expansion has the appeal
that it provides a physically motivated basis for describing the clustering of a
generic distribution of objects. In other words, the observed clustering of galaxies
can be expressed as a weighted sum of the auto and cross-spectra of powers and
123
1
Page 116 of 200
R. E. Angulo, O. Hahn

derivatives of d. Traditionally, these density spectra have been computed using
various ﬂavours of perturbation theory (e.g., Eggemeier et al. 2021), but recently
there has been increased interest in measuring them directly from N-body
simulations (e.g., Modi et al. 2020a; Zennaro et al. 2021).
9.3 Velocity fields
The estimation of the velocity ﬁeld poses more challenges than that of density ﬁelds.
The main problem is that the velocity ﬁeld is only sampled at the position of N-body
particles, which therefore implies an implicit mass weighing (i.e. one obtains the
momentum ﬁeld if particle velocities are co-added on a grid). In other words,
Fig. 25 Projections of various ﬁelds in a region of 16  16h1Mpc around a massive halo of mass
1:4  1014h1M in a Warm Dark Matter simulation. The top left panel shows the density ﬁeld whereas
the top right, bottom left, and bottom right show the voriticity, divergence, and the y-components of the
vorticity ﬁeld, respectively. Note the positive divergence in low density regions which have not yet shell-
crossed. These regions can be clearly distinguished in the top-right panel as zero-vorticity Image
reproduced with permission from Hahn et al. (2015), copyright by the authors
123
Large-scale dark matter simulations
Page 117 of 200
1

although the velocity ﬁeld should be deﬁned everywhere in space, without further
sophistication it is only possible to compute it where particles exist. Thus, for
instance, in low density regions, signal-to-noise is low and there could be large
empty regions where the velocity ﬁeld is not estimated. This is the case even for
high-resolution simulations, and the problem is even more serious when estimating
velocity ﬁelds for biased tracers due to their higher sparsity compared to N-body
particles (Jennings et al. 2015; Zhang et al. 2015).
This mass-weighted sampling of the velocity ﬁelds can potentially lead to large
uncertainties when estimating their volume-weighted statistical properties (which is
the ingredient entering in many frameworks for modelling redshift space
distortions) (Pueblas and Scoccimarro 2009; Zheng et al. 2015b; Zhang et al.
2015; Jennings et al. 2015). As discussed, for instance, by Jennings et al. (2011), the
standard cloud-in-cell estimation of the velocity ﬁeld causes its power spectrum to
strongly vary depending on the number of grid points deﬁning the velocity ﬁeld
mesh. The power spectra reach convergence only if the vast majority of the cells
contain at least one tracer particle. In practice this means that very large cells are
needed, of the order of tens of Mpc, which prevents the investigation into the highly
nonlinear regime.
There have been several approaches in the literature to address this problem. One
of them is to employ a large smoothing of the particle distribution. It is also possible
to used adaptive smoothing based on the local density (Colombi et al. 2009), or a
Kriging interpolation (Yu et al. 2015, 2017b). A different approach is to
theoretically model these artefacts and then correct the measurements (Zhang et al.
2015; Zheng et al. 2015b). In particular, Voronoi or Delaunay tessellations of the
particle distribution have been shown to be a good estimator of the volume-
weighted velocity ﬁeld. In this approach, the space is partitioned into a set of
disjoint regions with volumes tracing to local density without assuming isotropy.
Speciﬁcally, several authors have shown that these tessellations allow to measure
the statistical properties of velocity ﬁelds with signiﬁcantly less noise and bias (van
de Weygaert and Bernardeau 1998; Jennings et al. 2019). These approaches,
however, deﬁne a coarse-grained velocity ﬁeld, i.e., the average of the velocity of
different streams in a given region of space. Hahn et al. (2015) extended the phase-
space tessellation method described in Sect. 3.2.2 to deﬁne the velocity ﬁeld of each
dark matter stream everywhere in space, with which the average and higher-order
moments and derivatives of the velocity ﬁeld can be computed (cf. Fig. 25), this
approach can also be used to estimate the anisotropic stress tensor (Buehlmann and
Hahn 2019).
After these numerical artifacts are minimised or taken into account, it is possible
to study the statistical properties of the volume weighted divergence and vorticity of
the velocity ﬁelds, where analytic ﬁts have been proposed (Jennings 2012; Hahn
et al. 2015; Bel et al. 2019). In addition, it was shown that the halo velocity ﬁeld is
unbiased with respect to the matter velocity ﬁeld on large scales (k\0:1h Mpc1).
On smaller scales, there appear signs of velocity bias potentially originating from
the fact that halos form at special locations of the density ﬁeld (Zheng et al. 2015a).
123
1
Page 118 of 200
R. E. Angulo, O. Hahn

Furthermore, both vorticity and (generally anisotropic) stress in the velocity ﬁeld
are produced only through shell-crossing in multi-stream regions (both are decaying
modes at linear order), so that they are thought to carry some information about the
locally collapsed region (Pichon and Bernardeau 1999; Pueblas and Scoccimarro
2009; Laigle et al. 2015; Hahn et al. 2015; Jelic-Cizmek et al. 2018; Buehlmann
and Hahn 2019), and also potentially can give insight how perturbative approaches
can be pushed beyond the shell-crossing frontier.
9.4 Structure finding
9.4.1 Halos
‘Dark matter halos’ is the generic name given to regions of the universe which have
undergone three-dimensional gravitational collapse. These halos are the fundamen-
tal nonlinear unit of the CDM Universe and, hence, their abundance, internal
properties, and growth histories are at the core of several models for describing
structure formation. This includes descriptions of the nonlinear power spectrum,
modelling of biased tracers, and multiple models for the formation and spatial
distribution of galaxies. Furthermore, large dark matter halos are employed to
interpret observations of galaxy clusters, which can directly put constraints on
cosmological parameters.
The somewhat arbitrary deﬁnition of a halo and its boundary has led to a
multitude of operational deﬁnitions in N-body simulations and thus numerous
algorithms exist (Davis et al. 1985; Eisenstein and Hut 1998; Stadel 2001; Bullock
et al. 2001; Springel et al. 2001a; Aubert et al. 2004; Gill et al. 2004; Weller et al.
2005; Neyrinck et al. 2005; Kim and Park 2006; Diemand et al. 2006; Shaw et al.
2007; Maciejewski et al. 2009; Knollmann and Knebe 2009; Planelles and Quilis
2010; Habib et al. 2009; Behroozi et al. 2013b; Skory et al. 2010; Falck et al. 2012;
Roy et al. 2014; Ivkin et al. 2018; Elahi et al. 2019); these methods can be roughly
split into percolation algorithms in conﬁguration or phase-space, and identiﬁcation
of peaks in the density ﬁeld. Knebe et al. (2011, 2013) performed a systematic
comparison among 17 halo ﬁnders based on the same mock halos and N-body
simulation. This study found a very good agreement in the recovered structure and
their internal properties, although the halo mass returned by each algorithm varied
greatly owing to the arbitrariness in the halo deﬁnition. Note that although the
computational cost of performing group ﬁnding is small compared to carrying out a
large simulation, storing all particle data imposes signiﬁcant storage requirements,
so that state-of-the-art N-body codes typically carry out on-the-ﬂy halo ﬁnding
during the simulation runtime thus avoiding to store the dark matter catalogues and
allowing a ﬁner time resolution in halo statistics, which is necessary for high quality
merger trees (see below).
The three most common halo ﬁnders currently in use are the classical
conﬁguration space ‘friends-of-friends’ (FoF) (Press and Davis 1982; Davis et al.
1985), spherical overdensity (SO) (Lacey and Cole 1994), and phase-space FoF
(Diemand et al. 2006; a widely used example being ROCKSTAR Behroozi et al.
2013b). FoF is a percolation algorithm that groups N-body particles whose
123
Large-scale dark matter simulations
Page 119 of 200
1

maximum separation is below a threshold, usually referred to as the ’’linking
length’’ (‘l) and given in terms of the mean inter-particle separation (formally a
partitioning of all particles into equivalence classes whose members fullﬁll the
distance criterion with at least one other member). FoF effectively identiﬁes regions
in terms of an isodensity contour with a value d 	 0:65 ‘3
l
 1 (More et al. 2011).
For typical values of ‘l ¼ 0:2, this corresponds to 	 80 times the mean density. In
contrast, SO identiﬁes spherical regions whose mean enclosed density is above a
threshold, usually matching the value expected from spherical collapse (Bryan and
Norman 1998), although it also is common to use the threshold value for an
Einstein–de-Sitter Universe: 200 times the background density and even 200 times
the critical density of the Universe. More recently, phase-space FoF (and
ROCKSTAR in particular) has been proposed as a way to improve upon the FoF
algorithm to include also sub-structure. The basic idea is to split a standard FoF
group into a hierarchy of structures recursively identiﬁed with a FoF algorithm but
with a linking length and distance metric deﬁned in phase space, thus grouping
together particles that are nearby both in position and velocity. Additionally,
ROCKSTAR discards those particles that are not gravitationally bound.
FoF and SO are popular methods but have shortcomings. In particular, FoF is
known to suffer from numerical artefacts, where the mass of a given halo strongly
depends on the mass resolution (More et al. 2011; Ludlow et al. 2019; Leroy et al.
2021). Although corrections have been proposed (Warren et al. 2006), they have not
shown to be universal, but depend on the numerical resolution in addition to the
redshift and cosmology of the simulation (Ondaro-Mallea et al. 2022). SO on the
other hand, suffers less from numerical artefacts, however it cannot readily adapt to
the triaxial shape of DM halos (but note that this algorithm can be extended to
identify ellipsoidal regions Despali et al. 2013), there is an ambiguity in regions
where the boundaries of two separate SO halos overlap Garcı´a and Rozo (2019), and
Fig. 26 Bound and unbound subtstructures of a CDM halo as identiﬁed by the HSF phase-space subhalo
ﬁnder. Shown is the density in radial phase space (i.e., radial distance from the halo center vs. radial
velocity). The left panel shows the gravitationally bound subhalo structures identiﬁed, the central panel
the coherent but not gravitationally bound structures (i.e. tidal streams) and the right panel the smooth
main (host) halo component after removal of all identiﬁed substructure. A good substructure ﬁnder should
leave no visible correlated small scale structure in the main halo. Image adapted from Maciejewski et al.
(2009), copyright by the authors
123
1
Page 120 of 200
R. E. Angulo, O. Hahn

there can be a time evolution of halo mass simply due to the time-dependence of the
overdensity deﬁnition used (Diemer et al. 2013). On the other hand, ROCKSTAR
has been shown to be relatively robust against numerical resolution (Leroy et al.
2021), arguably thanks to the unbinding procedure. On the other hand, there is still
arbitrariness in the deﬁnition of the phase-space metric, and the use of gravitational
binding energy in the presence of accelerated frames and larger scale tidal ﬁelds
Stu¨cker et al. (2021a).
Another important issue regarding group ﬁnders concerns the so-called
universality of the halo abundance as a function of mass, the ‘‘halo mass function’’.
According to Press–Schechter theory and spherical collapse, the halo mass function
should be ‘‘universal’’ in the sense that it is primarily given by statistics of peaks in
Gaussian random ﬁelds—thus a single set of N-body simulations could be used in
principle to predict the halo mass function at any redshift and in any (reasonable)
cosmology (Jenkins et al. 2001; Reed et al. 2003; Bhattacharya et al. 2011; Crocce
et al. 2010; Angulo et al. 2012; Watson et al. 2013; Bocquet et al. 2016; Seppi
et al. 2021). At the same time, N-body simulations, however, have detected
departures from this universality at the 10  20% level. While the precise amplitude
of the effect varies with the halo mass deﬁnition and algorithm (Tinker et al. 2008;
Despali et al. 2016; Diemer 2020; Ondaro-Mallea et al. 2022), it can be the leading
systematic error in many theoretical models that rely on the halo mass function, and
as a consequence in the parameter constraints from future galaxy cluster surveys
(e.g., Salvati et al. 2020).
The non-universality of the mass function and the ambiguity in the halo mass
function have sparked recently a new wave of halo ﬁnders. These are relying on
identifying caustic boundaries (Shandarin 2021), the splash-back radius where the
slope of the density proﬁle is the steepest (Diemer and Kravtsov 2014; Diemer
2020), and others seeking to deﬁne a halo via characteristic features in the halo
density proﬁles (Garcia et al. 2021; Fong and Han 2021).
Even if these approaches succeed in deﬁning more ‘‘natural’’ halo boundaries in
the dark matter ﬁeld and/or result in universal mass functions, it is not clear that
they will necessarily lead to an advantage in the modelling of structure in the
universe. Quite likely, the same halo (or mass) deﬁnition is not the best for all
applications. For instance, one speciﬁc halo deﬁnition and boundary might be an
excellent predictor for the properties of the galaxies it hosts, whereas another mass
deﬁnition could be more tightly correlated with the X-ray luminosity associated to
that halo. In any case, the standard halo deﬁnitions only approximately mark the
boundary of a collapsed region, this new generation of halo ﬁnders might shed light
into more fundamental relations between halos and observable counterparts.
9.4.2 Subhalos
When a dark matter halo is accreted by a larger one, its outer parts are gradually
tidally stripped but the remnant can still be identiﬁed as a separate structure, which
is referred to as a ‘‘subhalo’’. These subhalos are expected to host satellite galaxies
if they are massive enough, and to produce detectable perturbations in strong
gravitational lensing, and potentially even emit electromagnetic radiation due to
123
Large-scale dark matter simulations
Page 121 of 200
1

DM annihilation. An example of a subhalo population of a Milky-Way halo is
shown in Fig. 26 which displays structure in radial phase space coordinates, split
into the bound subhaloes, still coherent tidally disrupted structures (tidal streams)
and the smooth background halo, as identiﬁed by the HSF subhalo ﬁnder
(Maciejewski et al. 2009).
As for the case of halos, the deﬁnition of a subhalo is somewhat arbitrary which
has led to multiple algorithms being proposed (Onions et al. 2012; Han et al.
2012, 2018; Elahi et al. 2019). They can be roughly grouped into phase-space
percolation, peaks in the density ﬁeld, and temporal algorithms which track the
descendant particles of a previously-known dark matter halo. Examples of publicly-
available subhalo ﬁnders are ROCKSTAR (Behroozi et al. 2015), HBT? (Han
et al. 2018), and VELOCIRAPTOR (Elahi et al. 2019), and SUBFIND (Springel
et al. 2001a) (updated along the ideas of HBT?) which is now part of the public
GADGET-4 release.
However, unlike for the case of halos, much larger differences exist between
different group ﬁnders. This is particularly true in the case of major mergers
(Behroozi et al. 2015), where percolation algorithms in conﬁguration space fail to
distinguish two overlapping structures of similar mass. In the comparison performed
by Knebe et al. (2011), it was found that subhalos are typically identiﬁed robustly
by most algorithms down to 	 40 particles, which decreased to 	 20 when velocity
information is included.
Beyond identiﬁcation completeness (which can be a function of radius in the
host), also numerical effects lead to an ‘overmerging’ of subhaloes (see the
discussion in Sect. 8.2 on force softening). A robust characterisation of subhalo
abundance in N-body simulations has to take into account such numerical selection
effects. It is further common to replace completely disrupted subhalos with an
‘orphan’ model that tracks them beyond the resolution limit (see Sect. 9.9.2).
9.4.3 Voids
While most of the mass in the Universe is in halos and subhalos, most of the volume
is found in low-density regions which have not undergone any kind of collapse.
These are referred to as cosmic ‘voids’, and can span regions of up to hundreds of
Mpc in diameter.
Voids are capturing an increasing amount of attention in the community since
they have been shown to provide useful cosmological tests in galaxy surveys (e.g.,
Hamaus et al. 2020). In particular, they are expected to be sensitive to the non-
Gaussian structure of the nonlinear universe, and thus are complementary to
traditional cosmological probes based on two-point correlators. Speciﬁcally, they
are particularly interesting in the context of screened versions of modiﬁed gravity
which are identical to GR in high-density regions but display an additional ﬁfth-
force in low density regions such as voids (cf. Sect. 7.10). Another motivation is
that voids are earlier dominated by dark energy compared to average density
regions, and a potential departure of gravity from general relativity can be more
evident in low-density regions (see e.g., Cai et al. 2015). They could also help in
understanding dark energy trough their imprint in the CMB through the Integrated
123
1
Page 122 of 200
R. E. Angulo, O. Hahn

Sachs Wolfe (ISW) effect (Cai et al. 2016). Another appeal of voids is that due to
their comparatively simple dynamics and structure, they can be modelled accurately
with simple analytic models (usually based on linear perturbation theory and
excursion set theory) (see e.g., Cai et al. 2017). This allows an optimal use of the
data, nevertheless, the models employed need to be carefully tested and calibrated
against numerical simulations.
As for the other types of cosmic structures, the deﬁnition and boundary of a void
is arbitrary and many algorithms have been proposed. Some algorithms rely on
ﬁnding spherical underdense regions (Padilla et al. 2005), others employ watershed
approaches (Platen et al. 2007; Neyrinck 2008), and others the eigenvalues of the
tidal ﬁeld (Hahn et al. 2007a). In addition, some algorithms rely on an estimate of
the three-dimensional cosmic density ﬁeld, while others directly operate on
halo/galaxy catalogues, which can facilitate a later comparison between results from
observations and simulations. The differences among ‘‘void ﬁnders’’ were
highlighted by Colberg et al. (2008) who systematically compared 13 approaches
applied to one large void from the Millennium simulation. A further specialised
comparison of void ﬁnders focused on their discriminatory power to distinguish
modiﬁed gravity models was carried out by Cautun et al. (2018); Paillas et al.
(2019).
Simulations are used to calibrate and develop theoretical models to use in data
analysis: void size functions, the density and velocity proﬁles, and the geometric
and dynamical distortions related to redshift space distortions, as well as their
clustering. Due the low number density and sparsity of voids, very-large-volume
simulations are required thus gravity-only simulations are commonly used (note no
strong baryonic effects are expected (Paillas et al. 2017)), however, usually the dark
matter ﬁeld is used, which might show some dependence with the resolution of the
simulation. The use of simulations has also helped in designing new probes, e.g.,
massive halos inside voids for constraining neutrino masses (Zhang et al. 2020) .
Ultimately, perhaps the biggest problem for cosmological inferences is that
theoretical models might depend on the exact operational deﬁnition of voids, and it
is not obvious how robust these are. Perhaps in the future, there will be emulators
for voids (cf. Sect. 9.7) where the same deﬁnition can be used both in simulated and
observed data. A more careful characterization of the covariances with other
cosmological probes will become necessary, as the use of multi-probes and cross-
correlation will be more common. New summary statistics could be able to extract
non-Gaussian information more efﬁciently, for instance, the recently proposed
k-Nearest-Neighbour (kNN) statistics (Banerjee and Abel 2021b, a), or statistics
conditional on large-scale density (Neyrinck et al. 2018; Paillas et al. 2021).
9.5 Cosmic web classification
The ﬁlamentary cosmic web (Bond et al. 1996) has for decades been a focus of
interest, since it might provide important insights into both environmental
differences in the formation and evolution of dark matter haloes and galaxies,
and also serve as a probe of cosmology. Its existence follows already from
Zel’dovich’s (1970) famous formula for the Lagrangian density contrast
123
Large-scale dark matter simulations
Page 123 of 200
1

1 þ dðqÞ ¼
1  Dþk1
ð
Þ 1  Dþk2
ð
Þ 1  Dþk3
ð
Þ
j
j1;
ð111Þ
where ki are the eigenvalues of the Hessian /ð1Þ
;ij of the initial scalar perturbation
potential (cf. Sect. 6.2). Evidently, positive eigenvalues lead to singularities, while
negative eigenvalues correspond to expansion, so that their signature gives rise to
four dynamically distinct structures ‘nodes’ (or ‘clusters’; with eigenvalue signature
‘þ þ þ’), ‘ﬁlaments’ (‘þ þ ’), ‘sheets’ (or ‘pancakes’; ‘þ  ’) and ‘voids’
(‘  ’).
Due to the hierarchical nature of structure formation in CDM, one expects sheets
to be made up of smaller scale ﬁlaments, and ﬁlaments to be made up of smaller
scale halos, and the interesting question arises about how much mass is actually
collapsed (Stu¨cker et al. 2018). Since these signatures are deﬁned w.r.t. the linear
perturbation potential, they are in general non-trivially related to the late-time
Eulerian density ﬁeld, as measured in simulations or, more importantly, in the real
Universe. For this reason, a large range of techniques have been developed that rely
e.g. on a smoothed version of the Eulerian tidal ﬁeld (Hahn et al. 2007b), or a multi-
scale ﬁltered version of the Hessian of the Eulerian density ﬁeld (Arago´n-Calvo
et al. 2007a; Cautun et al. 2013), the gradient tensor of the mean velocity ﬁeld
(Hoffman et al. 2012), or the anisotropic velocity dispersion tensor (Buehlmann and
Hahn 2019), as well as graph based models (Bonnaire et al. 2020), or an analysis of
critical points and lines in the smoothed density ﬁeld (Sousbie 2011) based on
Morse theory.
Another class of techniques addresses the problem from a Lagrangian point of
view, by noticing that the factors in Eq. (111) undergo a sign ﬂip when a particle
crosses a caustic. Beyond the Zel’dovich approximation, on can either use the GDE
tensor Dxq;i (see Eq. 35a) or an estimate of it from a sheet tessellation (cf.
Fig. 27 Schematic representation of a procedure to build lightcones from numerical simulations. In the
left panel we show a 1?1 space-time diagram indicating the region inside the past lightcone of an
observer at the origin. The vertical lines show the minimum simulation box size required to simulate
structure in a full octant of the sky up to z ¼ 2, whereas the shaded area indicates the simulated regions
which will never enter the lightcone. When building a lightcone, it is possible to identify and store the
lightcone during runtime, or it is also possible to concatenate simulation outputs at discrete times, as those
indicated by the horizontal grey lines, as a postprocessing step. Alternative to simulating large volumes, a
small simulation box can be replicated and rotated such that it has a effectively a much volume, as
exempliﬁed in the ﬁgure on the right Images reproduced with permission from [left] Garaldi et al. (2020),
copyright by the authors; and [right] from Sgier et al. (2021), copyright by IOP/SISSA
123
1
Page 124 of 200
R. E. Angulo, O. Hahn

Sect. 3.2.2) to track volume inversions. Algorithms based on tessellations where
developed by Falck et al. (2012), Ramachandra and Shandarin (2015), Shandarin
and Medvedev (2017), and based on a singular value decomposition of Dxq;i by
Stu¨cker et al. (2020). A detailed discussion of the relative performance of most of
these methods can be found in the comparison paper of Libeskind et al. (2018).
While the formation and evolution of the cosmic web is reasonably well
understood, the impact it leaves on galaxies and dark matter haloes is still a matter
of ongoing research. Many studies have focused on differences of halo properties in
the different components of the cosmic web (and its possibly intimate connection
with assembly bias, see also Sect. 9.9.2), e.g., Hahn et al. (2007b), Wang et al.
(2011), Goh et al. (2019), or the alignment of halo shapes or angular momenta with
the web, e.g., Arago´n-Calvo et al. (2007b), Hahn et al. (2007a), Codis et al. (2012),
Forero-Romero et al. (2014), Chen et al. (2016), which could leave a signature in
weak lensing measurements as an ‘intrinsic alignment’ correlation, but note that the
degree to which correlations found in dark matter carry over to galaxies is still
unclear. An alternative approach has been followed by Paranjape et al. (2018) who
quantify only the relative anisotropy of tides as a measure of external inﬂuence on
the formation of haloes and galaxies.
While most of these web classiﬁcation techniques have given interesting insights
into environmental effects on the formation of haloes and galaxies, the dissected
cosmic web, apart from voids and clusters, is not (yet) commonly used also as probe
of fundamental physics. Other measures that are sensitive to the structure of the
cosmic web, such as Minkowski functionals, are however quite commonly used also
to constrain cosmological parameters, e.g., Shirasaki et al. (2012).
9.6 Lightcones
Numerical simulations predict the phase-space coordinates of structure on constant-
time slices and this information is commonly the output of a simulation, usually
referred to as snapshots. However, observations measure the universe along a null
geodesic from our location at z ¼ 0, i.e. along the past lightcone of an observer. For
a proper comparison, it is thus necessary to transform the simulation output to a
lightcone in order to account for, among others, selection effects, line-of-sight
contamination, etc., and thus increase the realism of the predictions from
simulations (see e.g., Izquierdo-Villalba et al. 2019).
There are essentially two approaches to build lightcones from simulations. In the
ﬁrst, one builds lightcones in a post-processing step by employing adjacent
snapshots taken at fanjn ¼ 1. . .Nsg. In the simplest approach, structure in the
lightcone at a distance r is taken from the snapshot whose expansion factor is closest
to ar. This is implicitly deﬁned for light-like distances from the FRW metric as
ds2 ¼ 0
)
Z 1
ar
da
c
a2HðaÞ ¼ rðarÞ:
ð112Þ
Although simple, with a reasonable number of snapshots Ns, this approach recovers
accurately the large-scale distribution, abundance of objects, etc. However, it
123
Large-scale dark matter simulations
Page 125 of 200
1

creates small-scale discontinuities at the transition from one snapshot to another. To
ameliorate this problem, it is possible to interpolate the phase-space coordinates of
particles between snapshots to the precise intersection with the lightcone. This
however, can lead to an underestimation of central densities in halos due to non-
trivial motions in collapsed structures (Merson et al. 2013) for which a low-order
interpolation in time is insufﬁcient. An alternative is to interpolate directly halos and
subhalos. Speciﬁcally, Merson et al. (2013), Smith et al. (2017), Izquierdo-Villalba
et al. (2019) employed merger trees to identify the descendant of each structure and
in this way build its space-time trajectory. Note that despite these improvements,
this approach creates pathological cases where the same object/particle appears
twice in the lightcone or never appears at all.
As can be easily seen from Eq. (112), a simulation of side-length L can only
represent structure up to a ﬁnite redshift, e.g. z 	 1:4 for L ¼ 3000h Mpc. However,
one can take advantage of the periodic boundary conditions and replicate the box to
reach higher redshifts. Note that there can be optimal viewing angles and lightcone
angular extensions that avoid line-of-sight structure repetition (Kitzbichler and
White 2007) (at least for surveys that cover a small angle). If the simulated box is
large enough, structure can be considered uncorrelated, and it is common to
replicate and rotate the simulation box, which has been adopted by several lightcone
construction algorithms (see Fig. 27; Blaizot et al. 2005; Hollowed 2019;
Rodrı´guez-Torres et al. 2016; Sgier et al. 2019, 2021).
An implicit requirement of the method above is that it requires a dense sampling
of simulation outputs, Ns ’ 50–100, to obtain accurate results, thus posing
signiﬁcant storage requirements for large state-of-the art simulations. A second
option to build lightcones bypasses these requirements by constructing it directly
during the runtime of the simulation. The idea is that particles are output only when
they intersect the past lightcone, which is resolved with the time-resolution of the N-
body time step. This approach was adopted, for instance, in the Hubble Volume
simulation (Evrard et al. 2002) and more recently in the Euclid ﬂagship simulation
(Potter et al. 2017), see also Fosalba et al. (2008, 2015).
Since each N-body particle intersects the observer lightcone exactly once, in
principle one is no longer interested in its evolution afterwards, since it is also now
causally disconnected from the rest of the still ‘observable’ particles. This idea was
used by Llinares (2017) to propose a ‘shrinking domain’ framework, in which
particles outside the lightcone were simply discarded from the simulation, reducing
the computational cost of a simulation. This assumption, however, is incompatible
with the Newtonian approximation adopted in traditional simulations where
information travels instantaneously. Garaldi et al. (2020) thus proposed a ‘dynamic
zoom simulation’ in which particles outside the lightcone are not discarded but
instead represented with progressively less resolution. Depending on the mass
resolution and volume of the simulation, this approach could reduce the
computational cost of a simulation by factors of a few, at the expense of not
being able to store any full snapshot. Another short-coming of such optimisations is
that only one lightcone can be produced per simulation, while with standard
techniques in principle multiple distant observers can be used.
123
1
Page 126 of 200
R. E. Angulo, O. Hahn

9.7 Emulators and interpolators
Obtaining fast predictions for nonlinear structure for arbitrary cosmologies is
extremely important in modern cosmology. This is an essential ingredient in the
analysis of large extragalactic surveys, which could help to distinguish among
competing explanations for the accelerated expansion of the Universe and play a
crucial role in the hunt for new physics.
In this review, we have argued that numerical simulations are the most precise,
and often the only, way to predict nonlinear structure in the Universe. However,
simulations are expensive computationally, and thus it is only possible to carry them
out for a small number of speciﬁc cosmological parameters. The general strategy to
address this problem is to carry out an ensemble of simulations covering a targeted
space of cosmological parameters and then either interpolate the results, or calibrate
a physically-motivated model with which fast predictions are obtained. This
essentially comes down to non-parametric vs. parametric ﬁtting based on simulation
data.
A classical example of the parameterised approach is HALOFIT (Smith et al.
2003) for the nonlinear power spectrum. This approach has proven to be very
successful, and several revisions (recalibrations to improved modern simulations)
exist (Takahashi et al. 2012; Mead et al. 2015a, 2021) including extensions to
massive neutrinos (Bird et al. 2012; Mead et al. 2016). Recently, the same idea has
been applied to the matter bispectrum (Takahashi et al. 2020). In the most recent
parametric calibration carried out by Mead et al. (2021), 100 simulations of the
Mira-Titan project (Heitmann et al. 2016) were used to calibrate the nonlinear
matter power spectrum (based on the halo model and empirical corrections),
reaching an accuracy of about 	 5–10% up to very small scales k.5h1Mpc. The
same authors have extended the approach to model the impact of baryons on these
predictions.
The non-parametric approach is followed by ‘emulators’ instead. These also
correspond to interpolations of the simulation results but do not make any speciﬁc
assumption about the underlying physical model or even its functional form. Thus,
in general, they require a larger amount of data than parametric approaches, which
however, is becoming less of a problem thanks to increasing computational
resources. Emulators also have the advantage of being able to model complex trends
in the data, so that they are being progressively constructed for many more kinds of
large-scale structure statistics. For instance, emulators have been used in modelling
the nonlinear matter power spectrum (Heitmann et al. 2009; Lawrence et al. 2017;
DeRose et al. 2019; Euclid Collaboration 2019; Angulo et al. 2021) even beyond
KCDM (Winther et al. 2019; Ramachandra et al. 2021; Arnold et al. 2021) and for
baryonic effects (Arico` et al. 2021b; Giri and Schneider 2021), the galaxy power
spectrum and correlation function (Kwan et al. 2015; Zhai et al. 2019), weak
lensing peak counts and power spectra (Liu et al. 2015; Petri et al. 2015), the 21-cm
power spectrum (Jennings et al. 2019), the halo mass function (McClintock et al.
2019; Bocquet et al. 2020), halo clustering statistics (Nishimichi et al. 2019;
Kobayashi et al. 2020). Traditionally, emulators have been built with Gaussian
123
Large-scale dark matter simulations
Page 127 of 200
1

processes (GP), but more recently feed forward neural networks are gaining
popularity as they allow to deal with larger datasets and a high number of
dimensions.
A limitation of emulators is that they require a parameter space that is quite
densely-sampled with simulations, and that they perform poorly outside the
parameter ranges covered by this training set. As a consequence, most emulators
cover a relatively small range of parameter values. Although the sampled area might
be sufﬁcient to cover the posterior distribution for parameters in upcoming large-
scale structure surveys, they will deﬁnitely not be broad enough to cover the
parameter prior distributions in data analysis. Therefore, a possible path in the future
will be hybrid approaches where approximate and less accurate methods are
employed for a broad parameter estimation, and emulators are used in a predeﬁned
region where high accuracy is required.
Another limitation of emulators is that they have a non-trivial uncertainty
structure which can vary strongly across the parameter space (i.e. higher accuracy
near the parameters sampled by simulations and poorer in between them). This
means that not only data has an uncertainty but so does the theoretical model, which
propagates and could affect cosmological constraints. Although the uncertainty can
be decreased in certain parts of the parameter space by iteratively adding new
simulations (Rogers et al. 2019; Pellejero-Iban˜ez et al. 2020) (or by combining
simulations of different quality (Ho et al. 2022)), so that e.g. a high-likelihood
region is better sampled than regions ruled out by data, this process depends on the
summary statistic and scale in question. An alternative is to incorporate the emulator
Fig. 28 Comparison of the projected two dimensional mass ﬁelds for different combinations of
cosmological parameters, as computed from N-body simulations in the bottom row, and by a machine
learning algorithm in the top row. Speciﬁcally, these maps were generated using a Generative Adversarial
Network where two neural networks compete against each other; one seeking to generate ever more
realistic results and the other attempting to distinguish the generated from real data. In this case, the GAN
was trained with 46 different combinations of cosmological parameters (Xm and r8), and we can see it is
able to generate data that correctly captures the cosmological dependence of such maps. Image adapted
from Perraudin et al. (2021), copyright by the authors
123
1
Page 128 of 200
R. E. Angulo, O. Hahn

uncertainty in the data analysis, for which it will be very important to accurately
quantify the emulator uncertainty in the ﬁrst place. This will be a challenge per se
since these are typically empirically measured with a small number of simulations.
A further challenge will be to construct accurate emulators for biased objects and
in redshift space, which could aid in the interpretation of large-scale galaxy redshift
surveys. This, however, poses several challenges. The ﬁrst is related to the increase
in the dimensionality of the problem, as an emulator would need to consider the
properties of the object, e.g. the mass of the halo, and potentially other properties in
addition to cosmological parameters. The second challenge is that numerical
simulations are intrinsically noisier for discrete objects than for ﬁeld quantities due
to the shot noise associated with the latter. Nevertheless, recently, some progress
towards emulators for dark matter haloes has been achieved (Valcin et al. 2019;
Kobayashi et al. 2020). An interesting possibility will be to combine emulators with
perturbative expansions of galaxy bias, such as those proposed by Modi et al.
(2020a), Kokron et al. (2021), Zennaro et al. (2021), which has been recently
applied to data from the Dark Energy Survey (Hadzhiyska et al. 2021b).
9.8 Machine learning
Machine learning is a rapidly progressing ﬁeld with an increasing impact on
cosmology. In the speciﬁc context of cosmological numerical simulations, there are
roughly three areas in which machine learning algorithms have been applied to date:
artiﬁcial data generation, enhancement of N-body simulations, and cosmological
parameter estimation.
The ﬁrst area refers to the creation of artiﬁcial data, usually new realizations of
the cosmic density ﬁeld in two or three dimensions. Creating nonlinear ﬁelds with
N-body simulations is expensive computationally, as we have discussed throughout
this review. Machine learning can, instead, use a small set of simulations to learn its
properties and then quickly create previously unseen realizations statistically
consistent with this data. This is a common task in computer vision where, for
instance, images of human faces can be automatically generated (Radford et al.
2015). In a cosmological context, He et al. (2019) employed U-net architectures—in
which several convolutional neural networks are used on different (downsampled)
spatial scales, followed by an upsampling process and up-convolutions—to create
non-linear ﬁelds from a given initial linear ﬁeld. Similar ideas can be applied to
directly generate catalogues of dark matter halos, as proposed by Berger and Stein
(2019), Bernardini et al. (2020), or of weak lensing convergence maps (Mustafa
et al. 2019; Tamosiunas et al. 2021).
Another pathway to create new realizations of the nonlinear matter ﬁeld is based
on Generative Adversarial Networks (GANs). The main idea of GANs is to have
two competing neural networks; one of which creates fake data from a random
process and another that seeks to distinguish them from those in the training sample.
This architecture has shown to produce 2D and 3D ﬁelds quantitatively very similar
to those obtained by direct numerical simulation (Rodrı´guez et al. 2018; Perraudin
et al. 2019; Tamosiunas et al. 2021; Ullmo et al. 2020; Feder et al. 2020), even in
previously unseen cosmologies (see Fig. 28 and Perraudin et al. 2021). The
123
Large-scale dark matter simulations
Page 129 of 200
1

architectures used to create fake data can also be combined with existing data from,
for instance, low resolution simulations to artiﬁcially increase their resolution. This
task, usually referred to as ‘‘super resolution’’ has been performed by e.g.,
KodiRamanah et al. (2020), Li et al. (2020) where small-scale high-resolution
features were ‘in-painted’ onto low-resolution N-body simulations, ﬁnding good
agreement for a selection of density, velocity, and (sub)halo statistics (Ni et al.
2021).
An alternative way to create new realisations was followed by He et al. (2019),
who directly learned the displacement ﬁeld from FASTPM simulations (relative to
the Zel’dovich approximation) connecting Lagrangian and Eulerian coordinates of a
given particle. Interestingly, these authors obtained density statistics that closely
resemble FASTPM simulations, even adopting cosmological parameters different to
those used in the training (see also Kaushal et al. (2021) for a similar idea). Dai and
Seljak (2020) took this idea further by predicting the displacement ﬁeld (including
modiﬁcations due to baryonic effects), over a small number of layers (or time steps),
but enforcing rotational and translational symmetries, as expected from the
underlying physical laws.
Neural networks can also be used to enhance the results of numerical simulations.
For instance, Giusarma et al. (2019) used a U-Net architecture to modify the outputs
of standard KCDM N-body simulation in a way that mimics the presence of massive
neutrinos.
This
approach
appears
accurate
down
to
nonlinear
scales,
k 	 0:7h Mpc1, and for multiple statistics. Additionally, Tro¨ster et al. (2019) used
GANs and variational auto-encoders trained on the BAHAMAS hydrodynamical
simulation to predict the distribution of gas and baryonic pressure in gravity-only
simulations. These approaches can also be used to connect galaxies/halos to the
initial density ﬁeld. Speciﬁcally, Bernardini et al. (2020), Zhang et al. (2019b),
Icaza-Lizaola et al. (2021) have used ‘‘Convolutional Neural Networks’’ or ‘‘Sparse
Regressions’’ to predict either the dark matter halos or the galaxy distribution in a
hydrodynamical simulation based on the properties of the dark matter ﬁeld. Other
examples are Nadler et al. (2019) and Ogiya et al. (2019) who used ‘‘Random
Forests’’ to predict which subhalos in a gravity-only simulation would have been
disrupted due to baryonic or tidal effects, respectively.
At the heart of many of the above algorithms is that there are nonlinear ‘features’
that characterise the cosmic density ﬁeld. Thus, it might be possible to use these
features to also distinguish among cosmological models and constrain their
parameters. The idea of using machine learning to obtain constraints on
cosmological parameters has been explored in many recent works (Ravanbakhsh
et al. 2017; Schmelzle et al. 2017; Gupta et al. 2018; Fluri et al. 2018; Ribli et al.
2019; Peel et al. 2019; Ntampaka et al. 2020; Pan et al. 2020; Zorrilla-Matilla et al.
2020) and even applied to weak-lensing data (Fluri et al. 2019) of the KIDS-450
survey (Hildebrandt et al. 2017). These works have used different ﬂavours of deep
convolutional neural networks trained on N-body simulations and were typically
able to place stronger constraints than traditional clustering analyses based on two-
point functions. Although they are usually carried out in idealistic scenarios and
only for the matter ﬁeld (thus bypassing the problem of galaxy bias), they highlight
123
1
Page 130 of 200
R. E. Angulo, O. Hahn

the potential of the methods and, more generally, the existence of valuable
cosmological information in LSS data potentially currently unexploited.
One of the drawbacks of this approach is that it is difﬁcult to interpret what
features a particular neural network is relying on when constraining cosmological
parameters. In addition, as is known from the ﬁeld of computer vision, it is possible
to speciﬁcally design perturbations to images that can completely fool a well-trained
neural network (adverse examples). This serves as a caution to the use of neural
networks for robust parameter inference. An alternative is simply to deﬁne new
summary statistics motivated by the typical machine learning ﬁlters; such as wavelet
phase harmonics (Allys et al. 2020) or scattering transforms (Cheng et al. 2020), or
by analysing the feature maps in a trained network [such as the steepness of peaks in
ﬁltered convergence maps proposed by Ribli et al. (2019)]. These statistics appear
to be able to capture most of the cosmological information in the ﬁelds, thus
opening a promising analysis route for future large-scale structure surveys.
A key requirement for most machine learning algorithms is the existence of vast
training data provided by numerical simulation. This has motivated the creation of
large ensembles of simulations such as the CAMELS suite (Villaescusa-Navarro
et al. 2021), or the MADLENS framework (Bo¨hm et al. 2020). Although they have
so far been comprised of low-resolution or small simulated volumes, or even created
with approximate methods such as COLA and FAST-PM (Sect. 4.4), the continuous
advances in numerical cosmology will certainly allow improvements in this
direction in the future, which will enhance machine learning applications even
further.
9.9 Connecting dark matter to galaxies and baryons
Understanding the galaxy-halo connection is at the very heart of using the large-
scale structure of the Universe as a cosmological probe. On small scales, modelling
the galaxy-halo connection can provide constraints on fundamental physics; for
instance, on the free-streaming scale of dark matter or on possible dark matter-
baryon interactions (Nadler et al. 2019), on the allowed modiﬁcations of gravity (He
et al. 2019) (cf. Sect. 7.10), or on the dark matter mass (Newton et al. 2021). We
refer the reader to Baugh (2006), Wechsler and Tinker (2018), Somerville and Dave´
(2015), Vogelsberger et al. (2020) for specialised reviews of galaxy formation
physics and here simply summarise those techniques most commonly used in large-
scale dark matter simulations.
Currently, the arguably most realistic way to jointly model galaxies and the dark
matter ﬁeld is through cosmological hydro-dynamical simulations. These simula-
tions attempt to explicitly simulate astrophysical processes related to baryonic
physics such as gas cooling, star formation, and feedback energy injection from
supernovae and supermassive black holes among others. State-of-the art examples
are, in alphabetical order, the BAHAMAS (McCarthy et al. 2017), Cosmo-OWLS
(Le Brun et al. 2014), EAGLE (Schaye et al. 2010; Crain et al. 2015), Horizon-
AGN (Dubois et al. 2014), Illustris (Vogelsberger et al. 2014), Illustris-TNG
(Springel et al. 2018), Magneticum (Hirschmann et al. 2014), MassiveBlack-II
(Khandai et al. 2015), and SIMBA (Dave´ et al. 2019) simulations.
123
Large-scale dark matter simulations
Page 131 of 200
1

Unfortunately, hydrodynamical simulations are notoriously expensive computa-
tionally, and thus they can typically only be carried out for relatively small cosmic
volumes. Additionally, since galaxy formation cannot be predicted ab initio, many
speciﬁc choices need to be adopted regarding the physical processes to be modelled
and their free parameters. In addition, the modelling of most of these processes is
ﬁne-tuned to the resolution of the simulation at hand, which raises the question how
predictive these simulations are. This is perhaps the main limitation of hydrody-
namical simulations in the context of large-scale structure. Given the current
uncertainties in galaxy formation theory, it is therefore desirable to be able to
explore a more general galaxy-halo connection, ideally incorporating the respective
uncertainty when analysing and interpreting observational data.
For these reasons, currently, there are various popular and useful models for the
galaxy population in a given dark matter simulation which can be applied in post-
processing. These models can be roughly split into two categories: empirical, where
the relationship between dark matter halos and galaxies is simply given in
parametric or non-parametric forms but that do not predict galaxy properties; and
physically-motivated which attempt to directly model galaxy formation trough a set
of simpliﬁed descriptions. In this subsection we review the most common
approaches.
9.9.1 HOD and CLF
The simplest approach to connecting haloes with galaxies is the ‘halo occupation
distribution’ (HOD) model which assumes that the number of galaxies residing in a
given halo is only a function of the host halo mass. Note that a more sophisticated
version of HOD is the conditional luminosity/mass function (CLF) which attempts
to describe not only the total number of galaxies in a halo, but also the full
distribution of a secondary galaxy property (e.g. stellar masses or luminosities)
given by its distribution function conditional on halo mass (van den Bosch et al.
2003, 2007)
In the HOD formalism, the expected average number of satellite and central
galaxies in a given halo (also referred to as ‘‘occupation distribution‘‘) is given in a
parametric form motivated by observations and galaxy formation models. To make
a realisation of a galaxy population of a given halo in an N-body simulation, central
galaxies are assumed to follow a Bernoulli distribution, whereas the number of
satellite galaxies is assumed to be Poissonian.
Early HOD recipes contained only three free parameters and were able to
describe the luminosity and color dependence of the correlation function of galaxies
in SDSS (Zehavi et al. 2005). Motivated by the measured occupation distribution in
both hydrodynamical simulations and SAMs (cf. Sect. 9.9.4), the number of free
parameters increased to ﬁve (Zheng et al. 2005), whereas latest incarnations can
include up to ten free parameters (Hearin et al. 2016).
In the most basic HOD models, a central galaxy sits at rest in the center of the
halo and the satellites are usually assumed to follow a NFW proﬁle (Zheng et al.
2007) (or directly the phase-space distribution as dark matter particles). More
sophisticated galaxy models have shown that many of these assumptions are not
123
1
Page 132 of 200
R. E. Angulo, O. Hahn

valid in general: the number and properties of galaxies depend also on halo
properties other than mass, and satellite galaxies move and are located differently
than DM particles (Diemand et al. 2004a; Wu et al. 2013; Orsi and Angulo 2018).
All these impact the expected spatial distribution of galaxies, thus recent HOD
implementations have relaxed some of the assumptions of this model to enable a
more realistic description of galaxies. In particular, attempts are made to incorporate
secondary correlations with other halo properties beyond mass or environmental
properties (Hadzhiyska et al. 2020, 2021a), velocity bias (Guo et al. 2015), or
ﬂexibility in the spatial distribution to incorporate assembly bias (Hearin et al.
2016; Zehavi et al. 2019; Xu et al. 2021).
Despite its limitations, HOD remains one of the most popular approaches to
model galaxies in large-scale simulations, thanks to its ﬂexibility to capture galaxies
regardless of their type of selection function and without making strong assumptions
about galaxy formation physics. A further advantage is that it can be applied to
relatively low-resolution N-body simulations. In fact, the HOD and CLF have been
used together with N-body simulations to provide the strongest cosmological
constraints to date from galaxy clustering. For instance, Reid et al. (2014) obtained
2.5% measurements on the growth rate using the multipoles of the redshift-space
correlation function as measured in SDSS-III BOSS CMASS and Lange et al.
(2021) 5% with the LOWZ sample, whereas Cacciato et al. (2013) obtained
constraints on Xm and r8 competitive with those derived from CMB analyses but
using galaxy clustering and galaxy galaxy lensing in the SDSS survey. Although a
careful assessment of the systematic sources of uncertainty in these constraints is
required, they serve as an example for the statistical power obtained from the
combination of N-body simulations and galaxy formation models.
9.9.2 Subhalo abundance matching—SHAM
Several of the limitations of the HOD can be ameliorated by taking its assumption
one step further. In particular, one can assume that galaxies reside in dark matter
substructures instead of simply residing in dark matter haloes. This seemingly small
difference implies that there should be a one-to-one relation between galaxies and
dark matter substructures, which makes DM simulations much more predictive
about the phase-space coordinates of galaxies.
In the most general formulation, one could describe the galaxy population with
the probability of residing in a subhalo with a given set of subhalo properties (Yang
et al. 2012; Moster et al. 2013; Behroozi et al. 2013a). Different authors have
chosen different parametrisations, subhalo properties, and redshift evolution, but
obtain similar results when inferring halo masses from the stellar mass of observed
galaxies. Not only stellar mass can be modelled in this way, but also star formation
rate, metallicity, dust content, etc.
Another, alternative avenue is followed in ‘subhalo abundance matching’
(SHAM) by simply assuming a monotonic relation between subhalo and galaxy
properties (Kravtsov et al. 2004; Vale and Ostriker 2004; Conroy et al. 2006). In
this ‘rank-order’ SHAM, the most massive subhalo hosts the galaxy with the largest
corresponding property (e.g. the highest luminosity) and so on, thus providing a
123
Large-scale dark matter simulations
Page 133 of 200
1

non-parametric galaxy-halo relation. In current implementations this relationship is
not assumed to be perfect, but it is modelled with an additional parameter that
allows for some scatter in the mapping, which appears to be demanded by the data.
Exactly which global property of DM subhalo is the optimal parameter for a
SHAM mapping has been a matter of debate. Modern implementations use
parameters based on the circular velocity of the subhalo, VcircðrÞ ¼
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
GðM\rÞ=r
p
,
as it is less sensitive to a speciﬁc deﬁnition of halo mass and captures better the
inner parts of a halo, which arguably, is better connected to the inner regions a
galaxy is expected to inhabit. In fact, Vcirc appears to reproduce the small-scale
clustering of galaxies much better than mass-based-SHAMs. Furthermore, since
subhalo properties can evolve substantially once accreted due to the tidal heating
and stripping, subhalo properties before accretion are preferred. Explicitly, several
authors have argued that the highest value of the maximum of the circular velocity,
vmax ¼ maxðVcircÞ over the history of a halo, referred to as vpeak, is the single
property that correlates strongest with the stellar mass of galaxies in hydrodynam-
ical simulations (Chaves-Montero et al. 2016; Xu and Zheng 2020; He 2020). There
has also been attempts to combine more than one property for SHAM, e.g.,
including secondary dependences with Vcircðr ¼ R200Þ, the peak halo mass Mpeak,
concentration, or large-scale density (e.g., Mao et al. 2015; Lehmann et al. 2017;
Contreras et al. 2020a; Tonnesen and Ostriker 2021), seeking to improve the
accuracy of SHAM or capture better environmental dependences (e.g., as assembly
bias).
Subhalo abundance matching has been shown to be in good agreement with
multiple observations such as the two-point and three-point galaxy clustering and
the Tully–Fisher relation (Vale and Ostriker 2004; Conroy et al. 2006; Marı´n et al.
2008; Trujillo-Gomez et al. 2011; Nuza et al. 2013; Reddick et al. 2013), and to
accurately describe the clustering of stellar-mass selected galaxies in hydrodynam-
ical simulations (Chaves-Montero et al. 2016; Contreras et al. 2020c; Favole et al.
2022), to capture the so-called assembly bias (Contreras et al. 2020c), and to reduce
the need of velocity bias (Ye et al. 2017) [but see Hearin et al. (2013) for difﬁculties
regarding galaxy groups]. SHAM, while accurate for describing stellar masses, is
less so for star formation rates, or cold gas fraction, which are expected to display a
non-monotonous relationships to dark matter halos. On the other hand, SHAM could
be used as a starting point to describe these other properties by using the respective
distribution functions conditional on stellar masses (Hearin and Watson 2013;
Favole et al. 2017), or account for e.g. observational incompleteness (Favole et al.
2016). A similar idea has been implemented by Contreras et al. (2020b), Favole
et al. (2022), who extended SHAM with recipes for star formation rate based on the
mass accretion rate, and showed a remarkably good agreement with the clustering of
SFR-selected galaxies in the Illustris-TNG simulation (Springel et al. 2018).
SHAM imposes stricter requirements than HOD on the numerical accuracy and
mass resolution of the parent numerical simulation. This is since the evolution of
substructures inside halos needs to be followed for a considerable number of
dynamical times, relatively high force and time integration accuracy, together with
123
1
Page 134 of 200
R. E. Angulo, O. Hahn

adequate mass resolution are necessary (Klypin et al. 2015; Guo and White 2014)
(see also the discussion in Sect. 8.2).
Roughly, in every pericentric passage, DM subhalos loose approximately 90% of
their mass. Thus, for any ﬁnite mass resolution, subhalo mass will eventually fall
below the resolution limit of a simulation and be lost (Moore et al. 1996; van den
Bosch 2017), see also the discussion in Sect. 8.2. Naturally, this does not
necessarily mean that the respective galaxy has merged, thus one expects a
population of subhalo-less galaxies, also known as orphan galaxies (see e.g., Gao
et al. 2004; Wu et al. 2013; Delﬁno et al. 2021). The relative abundance of these
objects has been debated (Klypin et al. 2015; Guo and White 2014), and might
depend on the particular subhalo ﬁnder and merger tree algorithm used, it also
depends on the target galaxy population that is modelled. Furthermore, even with an
inﬁnite resolution, baryons and stars modify the gravitational potential inside DM
halos and of the infalling structures, thus SHAM and DM-only simulations cannot
correctly capture the dynamics of satellite galaxies. Thus, it is important to model
orphan galaxies and their eventual disruption within SHAM to obtain precise
predictions for the clustering of galaxies, specially on small scales (Campbell et al.
2018).
Similarly to HODs, the SHAM technique has also been used together with N-
body simulations to place strong constraints on cosmological parameters from the
observed clustering of galaxies. For instance, Simha and Cole (2013) obtained
constraints on Xm and r8 from the projected correlation function in SDSS. Another
example was provided by He et al. (2018) who demonstrated that a basic HOD and
f(R) simulations was incompatible with the clustering in SDSS which allow them to
place one of the strongest constraint on the amplitude of a hypotetical f(R) scalar
ﬁeld. As for the HOD, further work is required to establish the robustness of these
results, in particular with respect to degeneracies of galaxy formation physics, but
these results suggest a very promising avenue for future cosmological data analysis.
9.9.3 Semi-empirical models
More recently, there have been attempts to build upon the success of SHAM and to
extend it into a more physical model which is able to predict self-consistently
galaxy properties across time. Such a path is followed in the models dubbed
‘Universe Machine’ (Behroozi et al. 2019) and ‘EMERGE’ (Moster et al. 2018),
and the ‘Surrogate-Baryonic-Universe’ (Chaves-Montero and Hearin 2020). The
basic idea of these methods is to adopt an empirical model of the relationship
between star formation rate (SFR) and the fraction of quenched galaxies, and
subhalo properties (e.g. maximum circular velocity and halo formation time),
together with a speciﬁc redshift evolution. Then, with the use of subhalo merger
trees extracted from DM numerical simulations, it is possible to predict the star
formation history of every modelled galaxy. As a result, this SFR history is then
turned into the total stellar mass, from which other observable properties can be
computed for a given stellar population synthesis model, initial mass function, and
dust model.
123
Large-scale dark matter simulations
Page 135 of 200
1

The free parameters (15 - 40) of these relationships are constrained using
Bayesian algorithms by requiring an agreement with observational data across
multiple redshifts. In general, these models are more physical than purely empirical
models in that galaxy predictions are self-consistent (the stellar mass of a galaxy is
the integral of its star formation history), but they do not make any speciﬁc
assumptions about the physics underlying the inferred relations.
These models are quite successful in reproducing and predicting multiple
properties of the observed galaxy population. For this reason, it would be very
interesting to explore the kind of cosmological inferences that they would be able to
place when employed with N-body simulations. For instance, the possible
degeneracies between cosmological parameters and those physical parameters
describing galaxy formation and evolution. This would also be interesting for
informing which physical processes are the most important to understand and model
for improved cosmological power. To our knowledge, this has not yet been
attempted in the literature, but will certainly be an important step towards optimal
exploitation of up upcoming large-scale structure data.
9.9.4 Semi-analytic models—SAMs
Arguably the most complete post-processing modelling of the galaxy population is
provided by ‘semi-analytic’ models (SAMs) of galaxy formation. This approach
seeks to self-consistently evolve the properties of galaxies through a coupled system
of ordinary differential (or difference) equations describing the amounts of stars,
cold and hot gas, black holes, and star formation rate in galaxies.
SAMs were in fact the ﬁrst attempts to model galaxy formation and evolution,
with the main ideas dating back to White and Rees (1978), White and Frenk (1991).
Early SAMs were built on top of analytic halo merger trees and captured only the
Fig. 29 The spatial distribution of dark matter and stellar-mass selected galaxies with M [ 1010h1M
at z ¼ 0 in the Millennium-XXL simulation (Angulo et al. 2012). Galaxies were simulated using the L-
GALAXIES semi-analitic galaxy formation model of Henriques et al. (2013), and are displayed as circles
whose size is proportional to the expected half-mass radius. Image adapted from Angulo et al. (2014)
123
1
Page 136 of 200
R. E. Angulo, O. Hahn

main physics that was expected to be necessary to understand galaxy formation
(Kauffmann et al. 1993; Cole et al. 1994, 2000). Since then, SAMs have
signiﬁcantly evolved and have been improved in their assumptions, sophistication
and scope. Modern examples are ‘L-Galaxies’ (Henriques et al. 2015), ‘Galform’
(Cole et al. 2000), ‘Galacticus’ (Benson 2012), ‘SAG’ (Cora et al. 2018), ‘SAGE’
(Croton et al. 2016), ‘SHARKS’ (Lagos et al. 2018), ‘Gaea’ (Hirschmann et al.
2016), as well as ‘m2GC’ (Makiya et al. 2016); and typically include gas cooling,
chemical evolution and enrichment for multiple elements, feedback from SNe type I
and II, stellar winds, binary evolution, environmental and RAM-pressure stripping,
black hole formation, mergers, and feedback, dust formation, and radiative-transfer
effects. For a comparison of models see De Lucia et al. (2010), Knebe et al.
(2015, 2018).
Schematically, the fundamental assumption underlying SAMs is that every time a
mass element is accreted onto a DM halo, a corresponding amount of gas (set by the
universal baryon fraction) will also be accreted. Baryons will be shock heated to
Tvir, the virial temperature of the host halo, and start to cool either via
bremsstrahlung (Tvir [ 107 K), electron recombination (104 K\Tvir\107 K), or
metal-line cooling (Tvir\104 K). If the cooling time of the halo is long compared to
the age of the universe, then the accretion is said to be in a hot-mode, and a fraction
of the gas will condense into stars in every dynamical time, otherwise the cooling is
fast and system will develop cooling ﬂows.
The initial mass function (IMF) of newly formed stars is a degree of freedom of
these models, and most modern implementations adopt a Chabrier IMF, but a
Salpeter IMF, Kroupa IMF, and modiﬁcations of them have also been used in the
past (e.g., Baugh et al. 2005). Subsequently, stellar evolution models and stellar
population synthesis models will then determine the typical lifetime and spectral
energy distribution of stars of a given mass. During their life and death, stars return
part of their mass to the intergalactic medium, which is typically assumed to be
Fig. 30 The effect of baryonic physics quantiﬁed via SðkÞ  PðkÞ=PGrOðkÞ: the ratio of the nonlinear
power spectrum as measured in various hydrodynamical simulations over that in dark matter gravity-only
N-body simulations. Each panel displays the measurements in various hydro-dynamical suites,
BAHAMAS, C-OWLS, OWLS, whereas the rightmost panels shows the same measurement in the
Illustris, EAGLE, Illustris-TNG, and Horizon-AGN. Additionally, in each case we display as solid lines
the best-ﬁtting description of a ‘‘baryoniﬁcation model’’, in which the outputs of a gravity-only
simulations are perturbed according to physically motivated recipes (Schneider and Teyssier 2015;
Schneider et al. 2018; Arico` et al. 2020, 2021a). Image adapted from Arico` et al. (2021b), copyright by
the authors
123
Large-scale dark matter simulations
Page 137 of 200
1

recycled instantaneously in the subsequent generation of starts. Energy injection
could be thermal, kinetic, or radiative, and halts star formation.
In parallel to star formation, modern SAMs also follow the growth of
supermassive black holes at the center of every galaxy. These black holes are
assumed to grow from initial seeds by mergers and gas accretion. In most models,
during most of their lifetime, black holes increase their mass through Bondi–Hoyle–
Littleton accretion, and part of the accreted mass will then be re-injected as energy
into the ISM reducing star formation, in what is known as a radio-mode feedback.
During some moments of their history, a ‘quasar mode‘ black hole feedback cycle
can be triggered by mergers and disk instabilities, which leads to high accretion
rates and the emergence of quasars and AGNs (Croton et al. 2016; Bower et al.
2006).
Finally, the halo and subhalo merger trees determine the mass accretion and
mergers. As discussed above in the context of SHAM, subhalo mergers and
disruption are not necessarily a good predictor for galaxy merger and disruptions.
Thus, additional recipes are needed together with the modelling of orphan galaxies.
A disadvantage of SAMs is the relatively large number of free parameters—
20–50 typically. However, this arises mainly from our current uncertainty about
many aspects of galaxy formation, and the large number of physical processes that
are described. Typically, these free parameters are ﬁxed by requiring agreement
with a set of observations. Early SAMs were calibrated ‘by hand’ where agreement
with observations was subject to the criterion of a particular author. Nowadays,
SAMs are calibrated in a more objective manner using Bayesian statistics (Monte
Carlo Markov chains, particle swarms; e.g. Kampakoglou et al. 2008; Henriques
et al. 2009; Bower et al. 2010; Ruiz et al. 2015), however, since different codes and
authors choose different observables for their calibration, large discrepancies still
exist among different codes.
The strength of SAMs is that they provide self-consistent (physically motivated)
predictions for galaxy properties over, in principle, the whole electromagnetic
spectrum. Thus, SAMs have been employed to study and understand multiple
aspects of galaxy formation: the mass-metallicity relation, mass-luminosity
relations, galaxy clustering, galaxy colours, etc. SAMs have also been used to
make predictions for upcoming large-scale galaxy surveys (Merson et al. 2018;
Angulo et al. 2014), and to understand the physics of galaxy formation with dark
energy beyond a cosmological constant (Fontanot et al. 2012, 2015a), f(R) gravity
(Fontanot et al. 2013), and massive neutrinos (Fontanot et al. 2015b). An example
of the spatial distribution of dark matter and SAM galaxies is shown in Fig. 29.
9.9.5 Modelling of baryonic and gas physics
The main assumption of the galaxy formation modelling discussed in the previous
section is that baryonic physics determines the properties of galaxies, but that the
gravitational potential, and thus the dynamics, is fully determined by gravity
without any back-reaction from galaxy astrophysics. Although gravitational
interactions dominate the nonlinear evolution of cosmic structure, the accuracy
123
1
Page 138 of 200
R. E. Angulo, O. Hahn

required by future cosmological weak lensing observations is such that baryonic
effects on the matter distribution cannot be neglected.
Recently, the impact of effects such as feedback from supermassive black holes,
star formation, gas cooling, etc, has been studied extensively by comparing the
predictions of gravity-only simulations and full hydrodynamical calculations. The
consensus is that baryons modify systematically the shape of the nonlinear density
power spectrum on small scales. Speciﬁcally, baryons induce a suppression of the
amplitude on intermediate scales (k 	 1h Mpc1)—which is mostly resulting from
the collisional nature of baryons and additional injection of energy through feedback
which prevents the accretion of gas onto dark matter halos and modiﬁes the
baryonic
density
proﬁles—and
induce
an
enhancement
on
smaller
scales
(k 	 10h Mpc1)—as a result of gas cooling and star formation (van Daalen et al.
2020; Chisari et al. 2019). This effect is also shown in Fig. 30.
Although different hydrodynamical simulations agree qualitatively in their
predictions, they differ in the magnitude and redshift dependence of these effects
(van Daalen et al. 2020). Speciﬁcally, some simulations predict a relatively minor
effect (less than 5% at k [ 5h Mpc1), e.g. Horizon-AGN (Dubois et al. 2014),
EAGLE (Schaye et al. 2015; Hellwing et al. 2016), and Illustris-TNG300 (Springel
et al. 2018). Other simulations, predict stronger effects (10–15%) on the same
scales, e.g. BAHAMAS (McCarthy et al. 2017), OWLS (Schaye et al. 2010; van
Daalen et al. 2011), and Cosmo-OWLS (Le Brun et al. 2014). An extreme case is
Illustris (Vogelsberger et al. 2014), which predicts signiﬁcant effects even at
k 	 0:5h Mpc1 but is known to suffer from unrealistically low gas fractions in
massive haloes. Generally, it is striking that those simulations that are tuned to
produce ‘realistic’ galaxy properties, predict a weaker impact on the density power
spectrum, whereas those tuned on cluster properties predict stronger baryonic
effects. The discrepancy will have to be settled with the larger and more realistic
next generation of hydrodynamic cosmological simulations. Perhaps, more inter-
estingly will be the comparison with observational data. Although current constraint
are able to only marginally rule out the most extreme feedback scenarios (Huang
et al. 2021), new prospects for estimating the magnitude of baryonic effects in the
real Universe will open with the imminent improvement in weak lensing surveys
and in the joint analysis of gas observables (kinetic and thermal Sunyaev–
Zel’dovich effects, and X-ray gas fractions; Schneider et al. 2021; Tro¨ster et al.
2021).
Due to this variety in predictions, the impact of baryonic physics currently should
not be modelled based on a single simulation, and instead the focus is on creating
ﬂexible and general ways to model these effects. This motivation, along with the
need to leverage the larger statistical power of gravity-only simulations (at lower
computational cost), has triggered the development of several algorithms to modify
the mass ﬁeld in the presence of baryons. Such approaches are found in several
extensions of the halo-model (Semboloni et al. 2011; Mohammed et al. 2014;
Fedeli 2014; Mead et al. 2015a; Debackere et al. 2019); in terms of response
functions calibrated using Separate Universe simulations (Barreira et al. 2019);
123
Large-scale dark matter simulations
Page 139 of 200
1

displacing particles according to the expected gas pressure (Dai et al. 2018); or even
using machine learning (Tro¨ster et al. 2019; Villaescusa-Navarro et al. 2020).
In the same spirit as galaxy formation models discussed above, another avenue is
to model the impact of baryons directly from the dark matter ﬁeld. Among such
models is the baryonic correction model (Schneider and Teyssier 2015; Schneider
et al. 2018; Arico` et al. 2020). An advantage of this approach is that it does not
depend on a speciﬁc set of simulations and/or observables, that its free parameters
can be marginalised over to place cosmological constraints, and that they offer the
opportunity to predict multiple observables that depend on the gas distribution, such
as the Sunyaev–Zel’dovich effect or the X-ray emission in galaxy clusters.
Currently, these models appear ﬂexible and accurate enough to be useful in the
interpretation future datasets (Arico` et al. 2021b). Nevertheless, with the advent of
more realistic and precise hydrodynamical simulations, these models are expected
to be reﬁned and improved, especially concerning the way that baryonic effects are
modelled and parameterised, and improved physical priors on baryonic parameters.
10 Overview of state-of-the-art simulations and challenges
In this section, we will provide a brief overview of the largest gravity-only
calculations to-date (i.e., by mid 2021), which unveil the most detailed views of
nonlinear structure formation on large scales. We then discuss the challenges in
Table 1 List of cosmological simulations with a particle number in excess of 1 trillion (1012)
Year
Simulation
Code,
Algorithm
Supercomputer,
Location
Cores
½103
Np
½1012
Box
½h1Gpc

½h1kpc
2014
Dark Sky (Skillman
et al. 2014)
2HOT
FMM
Titan
USA
20
1.1
8
36.8
2017
TianNu (Emberson
et al. 2017)
CUBEP3M
PM-PM-PP
Tianhe-2
China
331
2.97
1.2
13
2017
Euclid Flagship
(Potter et al. 2017)
PKDGRAV3
Tree-FMM
PizDaint
Switzerland
4
2.0
3.
4.8
2019
Outer Rim
(Heitmann et al.
2019)
HACC
Tree-PM
Mira
USA
524
1.07
3.0
2.84
2019
Cosmo-p (Cheng
et al. 2020)
CUBE
PM-PM
p 2.0
China
20
4.39
3.2
195
2020
Uchuu (Ishiyama
et al. 2021)
GREEM
Tree-PM
ATERUI-II
Japan
\40
2.0
2.0
4.3
2020
Last Journey
(Heitmann et al.
2021)
HACC
Tree-PM
Mira
USA
524
1.24
3.4
3.14
2021
Far Point (Frontiere
et al. 2021)
HACC
Tree-PM
Summit
USA
?
1.86
1
0.8
123
1
Page 140 of 200
R. E. Angulo, O. Hahn

carrying out these calculations, in obtaining predictions as a function of cosmology,
and in the dissemination and sharing of their results and data products.
10.1 State-of-the-art simulations
The rapid progress of large-scale structure surveys has dramatically pushed the need
for on-par advances in the accuracy of theoretical modelling, and particularly so in
cosmological simulations. Roughly speaking, it is necessary to simulate volumes
similar to those observed with a mass resolution that allows to resolve, as a
minimum, the halos expected to host galaxies targeted by observations but ideally to
resolve the full merger history of those halos. For instance, the EUCLID survey will
map a volume of 60 Gpc3 and detect star-forming galaxies expected to reside in
halos as small as 1010–1011h1M. This motivates ever larger and more accurate
cosmological simulations.
The trend observed by Springel et al. (2005) in 2005 that the number of particles
in N-body simulations doubled every 16.5 months has somewhat ﬂattened since but
nevertheless cosmological simulations are at the forefront of what is possible with
state-of-the-art infrastructure in national and international supercomputing centers.
For instance, many cosmological codes have won or have been ﬁnalists to the
Gordon Bell Performance Prize over the last 30 years, which is awarded for
outstanding achievements in high-performance computing. Nowadays there are
multiple simulations with more than a trillion particles—several hundreds of times
more than those used by the iconic Millennium simulation. In Table 1 we compile a
summary of recent efforts, all of which notably adopt different parallelisation and
optimisation strategies as well as algorithms for the gravity calculation.
The ﬁrst calculation to reach the 1-trillion (1012) particle milestone was the Dark
Sky simulation (Skillman et al. 2014) in 2014. This simulation evolved a 1002403
particle distribution from redshift 93 down to redshift zero in a 8h1Gpc cubic
volume. This simulation was carried out with 20,000 CPUs of the Titan
Supercomputer at the Oak Ridge National Laboratory in USA. Gravitational forces
were computed with the 2HOT code (Warren 2013) using a tree algorithm with
multipole expansion, with a background subtraction to improve the performance at
high redshifts, and a dual tree traversal specifying cell-cell interactions in which
multiple particles share the same interaction list. A key aspect enabling this
simulation was the usage of Graphic Processing Units (GPUs) and many
optimisations via SSE or AVX vector instructions. Additionally, catalogues of
dark matter halos as well as a light-cone were constructed during the runtime of the
simulation.
The trillion particle mark was also reached by the TianNu simulation using a
different N-body code, CUBEP3M (Harnois-De´raps et al. 2013), which combines a
2-level PM with direct summation below the grid scale and including compression
for the internal representation of coordinates (Yu et al. 2018). This simulation
employed 86% (331,776 CPUs) of the second largest supercomputer in the world at
that time (4th place in early 2021): Tianhe-2 in China. The TianNu simulated the
cosmic density ﬁeld with 2:97  1012 particles in a 1:2h1Gpc box which included
123
Large-scale dark matter simulations
Page 141 of 200
1

the effects of massive neutrinos. The base simulation contained 69123 CDM
particles, and at z ¼ 5 a new set of 138243 particles representing Mm ¼ 0:05eV
neutrinos were added with which subtle differences between CDM and neutrinos
were studied (Inman et al. 2015; Yu et al. 2017a).
In the same year, 2017, the Euclid Flagship simulation (Potter et al. 2017) was
completed—the ﬁrst multi-trillion particle simulation with high force and mass
resolution. The simulation comprised 1000003 particles in a 3h1Gpc box aimed at
the
preparation
for
the
EUCLID
mission.
This
simulation
employed
the
PKDGRAV-3 code (Potter and Stadel 2016) which uses a binary tree with FMM
expansion for the force calculation. As for other large simulations, it was possible
thanks to the use of GPUs speeding up the gravity calculation.
The Outer Rim was another simulation that reached the trillion particle count. It
simulated a region of 3h1Gpc across using the HACC code (Habib et al. 2016) and
a half million of cores of the Mira BG/Q supercomputer at the Argonne Leadership
Computing Facility in the USA. The 1002403 particles of 109h1M were initialized
at z ¼ 200 with 1LPT and later evolved generating approximately 5PB of data. The
same group also used HACC and the Mira supercomputer in 2020 to create another
1.24 trillion particle simulation, the Last Journey (Heitmann et al. 2021), which
shares many speciﬁcs with Outer Rim but covers a slightly larger 3:4h1Gpc cubic
volume. Complementing these calculations, in 2021 the same group announced the
FarPoint simulation (Frontiere et al. 2021) with 1.86 trillion particles in a 1h1Gpc
box run on Summit—the 2nd largest supercomputer in the world at the time.
Similar to the Flagship but with slightly better mass resolution is the Uchuu
Simulation (Ishiyama et al. 2021), which is a 2000h1Mpc simulation with 2.1
trillion particles (1208003) of mass 3:3  108 h1M and employing 4:3h1kpc
softening length. The simulation was carried out on the ATERUI II supercomputer
in Japan using the GREEM tree-PM code (Ishiyama et al. 2012, 2021), which makes
extensive used of SIMD instructions and other low-level optimizations.
The largest simulation to-date is Cosmo-p which was performed in 2020 using
the CUBE code on 200480 cores of the Shanghai Jiao Tong University’s p 2.0
supercomputer in China. Cosmo-p simulated a region of 3:2h1Gpc with 4.39
trillion particles with a relatively modest force resolution, 195h1kpc. The force was
computed with a 2-level particle mesh algorithm (PMPM) (Merz et al. 2005), where
a global PM mesh is used to compute long range forces which is complemented by
independent local high-resolution PM meshes with isolated boundary condition to
estimate short-range forces. The ﬁne mesh can be stored completely locally in case
of cubical domain decomposition, which has the advantage of reducing inter-node
communication.
Note that the Cosmo-p simulation was carried out on a comparatively modest
supercomputer, this thanks to a heavily optimised memory consumption of the
CUBE code. This was realised mainly by using ﬁxed-point precision optimization
where phase-space coordinates are stored relative to the position and velocity of a
coarse grid (Yu et al. 2018). Although this has additional computing demands (due
to the compression/decompression), it reduced the required memory requirements
123
1
Page 142 of 200
R. E. Angulo, O. Hahn

from 24 to 6 bytes per particles, which is usually a limiting factor in these large-
scale simulations.
10.2 Computational trends and challenges
It is interesting to note that the multi-trillion particle limit has been reached
independently by several groups worldwide, employing different codes and
different computational strategies. This is a remarkable achievement for the ﬁeld
of cosmological simulations. However, there are some trends and common features
which we discuss next.
Firstly, these calculations are usually limited by the time spent in the force
calculation. In this regard, it is ﬁnally becoming clear that hierarchical trees are sub-
optimal compared to fast multipole methods, which display better scaling with
particle number, by decreasing the algorithmic complexity of the (short-range)
gravity interaction. On the other hand, implementing FMM efﬁciently (including its
parallelisation in distributed memory machines) is signiﬁcantly more complex, and
thus execution times can vary signiﬁcantly depending on the implementation. It also
seems that highly optimized codes with ‘‘hand-tuned’’ parts using SIMD, AVX, and
other low-level instructions are worth in this case, although this seems to depend on
the target architecture.
Along these lines, the use of co-processors, and GPUs in particular, is proving
extremely beneﬁcial for these large calculations. We can see for instance that multi-
trillion particle simulations are carried out with up to half-a-million CPUs (e.g. The
Last Journey) but with only 4 thousands CPUs when enhanced with GPUs (e.g.
Euclid Flagship). Speciﬁcally, PKDGRAV claims that factors of 10 speed-ups can
be achieved with the use of one GPU per node. The use of GPUs can also give the
opportunity to researchers without access to the largest supercomputers in the world
to carry out state-of-the-art simulations. This development is also in line with future
supercomputer architectures, where exascale supercomputing is likely to be reached
ﬁrst with GPUs with the additional motivation provided by the training of machine
learning algorithms.
Some degree of data compression seems to also be useful for these large
calculations. This will be even more true in the future where the FLOP-to-byte ratio
is expected to increase in future processors, more than the available RAM.
Likewise, GPUs usually have much less memory than traditional CPUs, which
provides further incentive for adopting some degree of internal compression. This is
demonstrated by the Cosmo-p simulation. However, it is unclear what degree of
data compression can be afforded when increasing the spatial resolution, and
whether this meets the accuracy requirement of upcoming LSS observations.
Another lesson learned from recent simulations is that I/O bandwidth and disk
space is an important factor that could limit the usefulness of simulations. For
instance, 200’000 CPU hours were needed only to read the initial conditions of the
Outer Rim simulation. Perhaps more importantly, the large raw datasets generated
(easily in the petabyte scale), restrict the use of these simulations to a limited
number of people, which unavoidably hinders their scientiﬁc exploitation. For this
reason, more and more of the post-processing, including the construction of light-
123
Large-scale dark matter simulations
Page 143 of 200
1

cones, structure identiﬁcation, merger trees, and even the creation of maps for
various observables (e.g. gravitational lensing or of the Sunyaev–Zel’dovich effect)
are carried out during the simulation runtime.
Despite the extraordinary combination of volume and mass resolution of the
simulations listed in the previous section, none of these multi-trillion particle
calculations is actually sufﬁcient to adequately match the characteristics e.g. of the
EUCLID or Rubin-DESC surveys. However, the previous track record of
continuous improvement and planned advances in supercomputer infrastructure
means that it is likely that in the near future at least one calculation achieves the
necessary combination of volume and resolution.
Finally, a related challenge for carrying and storing simulation results will be in
securing the necessary computational resources per se. As we have argued
throughout this review, gravity-only simulations are essential for modern cosmol-
ogy and for large extragalactic surveys, where they can signiﬁcantly enhance the
scientiﬁc output. However, carrying out these simulations is left to individual
groups or scientists who might or might not obtain competitively the required
computational resources. This unavoidably creates a large degree of uncertainty and
hinders a proper design and exploitation of simulations.
10.3 Challenges for data dissemination
State-of-the-art numerical simulations require huge computational efforts in terms
of CPU/GPU power and storage facilities. For this reason, historically, simulations
were only available to a small subset of the cosmological community. Over the last
10 years, this situation has changed thanks to the adoption of more open data
policies together with the cost reduction for hardware and the advance of web
technologies.
It is now customary for simulation projects to put considerable effort into making
their data publicly available and provide easy access to raw and secondary data
products. In fact, the success of a simulation is many times judged not only by its
direct scientiﬁc impact, but on the breadth of projects they enable and its use by the
astronomical community as a whole. Sharing simulation data is also important in the
context of cross-validation of simulation codes and results, since it readily allows a
comparison and assessment of the accuracy and potential sources of systematic
errors. In principle, this extends also to the simulation codes themselves: a public
code release strategy can leverage increased scrutiny of the methods employed in
any single code, in terms of both correctness and economy.
One of the pioneer efforts in the direction of data dissemination was that of the
Virgo Consortium with the Millennium Database (Lemson and Virgo Consortium
2006)23. In the context of the German Virtual Observatory, and following the
example of the SkyServer in the Sloan Sky Digital Server, the Millennium Database
served halo and semi-analytic galaxy catalogues via a relational database accessed
trough the standard Structured Query Language (SQL). More recent examples are
23 http://gavo.mpa-garching.mpg.de/Millennium/.
123
1
Page 144 of 200
R. E. Angulo, O. Hahn

databases for the Bolshoi simulations24 which have additionally served full particle
data, the Australian Theoretical Virtual Observatory25 which offers several post-
processing and visualization tools (Bernyk et al. 2016), and the INDRA database26
which provides access to a large ensemble of gravity-only simulations (Falck et al.
2021). As an example of the signiﬁcant value open data policies provide to
simulation projects is the fact that even though the Millennium Simulation was
carried out more than 15 years ago, it is still today being used in many research
projects.
SQL databases are extremely efﬁcient and useful for mining large datasets,
however, for many applications it is desirable to serve large catalogues for which
SQL is not optimal. In such cases, the increase of worldwide network bandwidths
and the web developments have made practical to provide data in excess of tens of
Terabytes. One example is http://skiesanduniverses.org/ where data from the
Multidark (Klypin et al. 2016), Bolshoi (Klypin et al. 2011), GLAM (Klypin and
Prada 2018b), and Uchuu (Ishiyama et al. 2021) simulations can be directly
downloaded. Another interesting alternative approach adopted to serve the data of
the 1-trillion particles DarkSky simulation27 is to directly map data in a given URL
to a Python virtual memory buffer. In this way, local Python sessions can directly
access data stored in a remote server. The Outer Rim and Last Journey simulations
data, instead, was shared directly trough the Globus technology28. Globus is a non-
proﬁt research data management that allows triggering secure data transfers among
different locations (e.g. personal computers, cloud storage, or supercomputer
facilities) via GridFTP. In this way, a subset of the simulated data (halo catalogues
and diluted snapshots, etc) can be easily shared with the research community.
The challenges faced by the current generation of simulations will become more
acute in the future, with the increase in data volumes and complexity of the whole
post-processing pipelines. Thus, it will be important that together with the data,
there is a public release of data analysis software and, more generally, further
emphasis in the reproducibility of the results. In this regard, the numerical
simulation community has a good track record with open software and open
comparison projects, all of which should enhance the robustness and quality of any
potential
cosmological
inference
derived
from
the
analysis
of
numerical
simulations.
10.4 Challenges for cosmological predictions
Carrying out a single state-of-the-art simulation is challenging, yet if they are to be
used for the exploitation of cosmological observations, we need a large number of
them covering the full parameter space of plausible cosmological models. This
24 https://www.cosmosim.org/.
25 https://tao.asvo.org.au/tao/.
26 http://sciserver.org.
27 https://darksky.slac.stanford.edu/.
28 http://www.globus.org.
123
Large-scale dark matter simulations
Page 145 of 200
1

means that the computational resources will be likely in excess of those of single
grand-challenge simulations.
Current campaigns aimed at providing predictions as a function of cosmology
typical build emulators which are trained using Oð100Þ simulations. This number
can be decreased by more than an order of magnitude by using cosmology-rescaling
algorithms (Angulo and White 2010; Angulo and Hilbert 2015), but still represent
an important computational challenge. With this (relatively) low number of
simulations, various groups have shown that it is already possible to achieve a .1%
accuracy for predicting the nonlinear power spectrum up to scales k 	 1h Mpc1, for
all the parameters of a minimal KCDM model (Angulo et al. 2021; Euclid
Collaboration 2021). At smaller scales, they have an accuracy of 3%, not too
different from the accuracy of simulations themselves. The main limitation is the
rather restricted cosmological parameter space they can cover, usually much smaller
than the priors considered in data analysis. Covering large hyper-volumes quickly
increases the number of required calculations and the computational cost associated,
thus, probably in the future hybrid emulators will be built which display high
accuracy in a given region of interest (e.g. near the best ﬁtting KCDM parameters)
but have less accuracy elsewhere. This could be achieved by using approximate
simulations, physically-motivated extrapolations, or sampling less densely the
parameter space.
Although improving the gravity-only predictions on small scales will be an
important task, baryons have a much more important impact on these scales and
thus for the overall accuracy of the predictions. To address this, also emulators have
been built based on physically-motivated models for baryonic effects, which claim
that they can also obtain few percent accuracy (Schneider et al. 2020; Arico` et al.
2021a). Although they are close to the target accuracy, they are likely only sufﬁcient
for the ﬁrst round of data analysis of upcoming surveys, but continued improvement
in precision will be needed. This is probably within reach as better understanding
from hydrodynamical simulations and observations is achieved.
Note that hydrodynamical simulations are sometimes regarded as the ‘‘ground
truth’’ and one might think that the best strategy for cosmological exploitation
should be based on multiple hydrodynamic calculations with varying cosmology
and baryonic parameters. However, it is important to be aware of the risks of this
approach. First, most of the simulated physics rely on simpliﬁed ‘‘sub-grid’’ physics
describing e.g. star formation, and feedback from black holes and supernovae. Thus
the accuracy and realism of the cosmological predictions would be limited by these
underlying recipes, which frequently are simply ad-hoc parametrisations with
signiﬁcant degrees of freedom that vary considerably among simulation codes and
their physics implementations. These prescriptions are often valid only for the
physical resolution of a given simulation and require re-tuning when the resolution
changes. Second, many of these recipes have been calibrated or validated against
observational data, thus there is the risk of a circular argument where observed data
is used to calibrate simulations assuming a cosmology and then one uses those
simulations to constrain cosmology. Finally, it is ultimately very difﬁcult to
estimate, let alone control, all possible sources of uncertainty and consistently
123
1
Page 146 of 200
R. E. Angulo, O. Hahn

propagate them to cosmological constraints. Due to all these reasons, a more
conservative approach is to employ physically-motivated models which are
informed by, and tested against, a broad range of cosmologies and galaxy formation
models including those seemingly ruled out by data.
Reliably predicting galaxy clustering as a function of cosmology is another area
where signiﬁcant modelling uncertainty exists. One option to make such predictions
would be to combine these simulations with one or more galaxy models described in
Sect. 9.9, so that the cosmological and astrophysical parameters could be jointly
constrained. This however, poses several problems. The ﬁrst is one of computational
nature, as the target parameter space would be extremely large which would be a
challenging task for emulators. Additionally, even at a ﬁxed cosmology, the
calibration of SAMs and empirical models can cost a few hundred thousands of
CPU hours. An alternative could be to formulate these with automatic differen-
tiation, for which several optimization algorithms can be employed speeding up
parameter sampling considerably. Another option is to split the cosmological and
galaxy formation parameters and emulate directly the ‘‘Bayesian evidence’’ of a
given cosmology (Lange et al. 2019, 2022).
As for our discussion regarding baryonic physics and hydrodynamical simula-
tions, there is the risk of cosmological biases due to an inaccurate modelling of
galaxy formation physics. Another potentially more robust option has been
proposed recently in terms of combinations of parametric bias descriptions
(motivated by perturbative expansion of galaxy bias) with N-body dynamics, which
can be emulated efﬁciently and could be a robust way to extract information from
the quasi-linear regime. In the future the main challenges will be the extension to
include peculiar velocities and a self-consistent treatment of higher-order correla-
tions (Pellejero-Iban˜ez et al. 2021; Banerjee et al. 2021). It is commonly argued that
by using measurements of the late-time LSS, one can access a large number of
modes in the Universe which can potentially outperform CMB analysis. It is,
however, unclear how many of these modes actually have useful information about
fundamental aspects of the universe. Likely a modelling based on simulations such
as the one here described will ultimately answer this question and determine the
maximum amount of cosmological information in the late-time Universe.
Another rich source of information is found in combining observations in
different wavelengths and exploiting their cross-correlations, e.g. lensing-SZ,
lensing-galaxy clustering, SZ-galaxy clustering, etc. For this, simulations would
need to simultaneously predict multiple observables. In this regard, predictions for
the halo mass function have also been possible either by emulators or by reﬁned
ﬁtting functions. Future challenges will be about incorporating baryonic physics,
and also observational errors (e.g. projection effects, off-centering, etc), since
cluster cosmology depends sensitively on the observable-mass calibration (e.g.
optical richness, X-ray, or Sunyaev–Zel’dovich effects).
In parallel, instead of building emulators, it will perhaps be possible to employ
machine learning algorithms to design optimal summary statistics than go beyond
classical N-point functions, or to train them to directly generate ensembles of ﬁelds
with which a full forward modelling could be possible. In this way, the
cosmological exploitation could be performed not only at the level of summary
123
Large-scale dark matter simulations
Page 147 of 200
1

statistics, but also at the ﬁeld level, e.g. incorporating the information in the phases
of the cosmic ﬁeld in Fourier space. However, to realise this possibility, more
advances will be required demonstrating the robustness of the approach (against,
e.g. observational systematic effects) and the quantiﬁcation of modelling errors.
Common to all the above is that it will be very important to carefully quantify the
emulators’ accuracy and incorporate them into a Bayesian data analysis workﬂow.
This assessment should entail all possible sources of systematic errors, errors arising
from the N-body discretization, errors associated with the speciﬁc simulation,
structure ﬁnding, interpolation method, and modelling of the relevant baryonic
physics, and the projection to the observable space (redshift space and/or redshift
errors). Since these errors are likely to have complex structures in parameter space
(being more accurate in some regions and less so in others), they will need to be
taken into account in Bayeasian parameter samplers and in the covariance matrices.
As the sophistication and accuracy of cosmological models improve, they will
pose stricter requirements for the accuracy of the respective covariance matrices
[see Monaco (2016) for a review]. Currently, there are indications that analytic or
approximate methods for building covariances are enough for the precision of future
LSS surveys and current data models (Barreira et al. 2018; Lippich et al. 2019; Blot
et al. 2019; Colavincenzo et al. 2019). However, as these models improve in
precision and become valid deep into the nonlinear regime (and for the cross-
correlation of different observables), they will require equally accurate covariances
and a re-assessment of the accuracy with which they are currently built will be very
important.
Ultimately, simulations will be able to model simultaneously a broad range of
observables over different wavelengths as a function of cosmology and over a wide
set of scales an redshifts. This will also be important as more surveys scan the sky
on different observables, the power of cross-correlations will become more evident
by breaking degeneracies, identifying potential sources of systematic errors, and,
perhaps more importantly, potentially detecting physics beyond KCDM from more
than a single cosmic probe.
All this will likely be an iterative process between the numerical simulations and
observational communities, where better predictions become available, data is
interpreted which results into a better assessment of sources of noise which feeds
back into more accurate and reﬁned simulations.
11 Conclusions and outlook
After decades of development, modern large-scale cosmological simulations have
become a mature ﬁeld that provides the most precise method for predicting and
understanding nonlinear structure in the cosmos. In consequence, numerical
simulations are essential in modern cosmology and in the ongoing efforts to
understand the nature of our Universe.
Reaching this point required progress in various directions. The ﬁrst concerns
rigorous tests of the basic assumptions behind these calculations: from the impact of
the N-body discretisation on results, to the validity of Newtonian limits of General
123
1
Page 148 of 200
R. E. Angulo, O. Hahn

Relativity. The second direction was a continuous improvement of the algorithms
and the accuracy of the calculations: from a better understanding of the sources of
error in the creation of initial conditions, in time integration, to the treatment of dark
matter and baryons as a single ﬂuid, and many others. The third direction concerned
a continuous extension of physical models beyond the simplest KCDM model: from
modiﬁcations of gravity to different dark matter models, this also had synergistic
effects on the development of new cosmic probes and experiments. All these
advances have been supported by a continuous increase in computational power,
which allowed simulations of ever bigger cosmological volumes with better and
better resolution. In parallel the development of algorithms continued to make best
use of new generations of supercomputers, with cosmological codes continuously
being among the few in science that can efﬁciently exploit the largest supercom-
puters worldwide.
As a consequence, predictions from gravity-only N-body simulations have
become very reliable. For instance, different simulation codes, despite using very
different numerical approaches for solving the underlying equations, now agree at
the sub-percent level on the nonlinear matter distribution down to the internal
structure of halos. Systematic comparison and convergence studies have also
allowed the ﬁeld to identify sources of noise and error, to improve the relevant
approaches, and to validate simpliﬁcations and optimisations. In parallel, an
important validation of the N-body approach itself is starting to be possible. Initial
results from Lagrangian tessellation discretizations—currently the only viable
alternative to N-body—are indicating the validity of N-body when following the
gravitational collapse of CDM ﬂuctuations. While there are still some problems that
will require further elucidation, these results appear to provide an important support
for the predictions of standard cosmological codes.
In contrast, the connection of dark matter with visible objects such as galaxies
and quasars, is comparatively still very much more uncertain. Nevertheless, in
recent years tremendous progress has been made in the ﬁeld of galaxy formation and
increasing agreement on that front is being quickly achieved. This allowed the
development of models for the impact of galaxy formation and baryonic physics on
cosmological observables that can be applied to gravity-only simulations. However,
some caution is necessary since hydrodynamical simulations usually rely on sub-
resolution physics which have a number of parameters that are adjusted to reproduce
observations: reproducing observations does not necessarily imply a modelling of
the correct effective physics. Their predictive power can only be scrutinized by
testing predictions far outside the calibrating space. Nevertheless, these galaxy
formation simulations have aided in the development of physically-motivated
models that could be applied to data in order to ultimately obtain constraints on
cosmological parameters after a marginalization over baryonic physics. In addition,
these baryonic models will keep improving in the future, which will naturally feed
back into more accurate and deterministic models to be combined with gravity-only
simulations.
All the development described throughout this review is preparing N-body
simulations for their next big challenge: to be used directly in the data analysis
pipeline of upcoming cosmological measurements. In this regard, we have seen fast
123
Large-scale dark matter simulations
Page 149 of 200
1

progress on two fronts. The ﬁrst is the development of approximate methods which,
although not always formally correct, appear to reproduce large-scale statistics of
the matter ﬁeld at a fraction of the computational cost of a standard N-body
simulation. The second front is the development of reliable interpolation techniques
of N-body results in cosmological parameter space, either by constructing emulators
over the outputs of hundreds of N-body results, or by training machine learning
algorithms. With the steady growth in computer power, it is likely that we will see
increasingly better predictions to the point that it will be possible to create
predictions as a function of cosmology that will be indistinguishable from those of
direct N-body simulations. This has the potential to signiﬁcantly increase the
scientiﬁc output of future extragalactic observations.
If the challenges described above can be successfully solved with high precision
and convincing robustness over the next decade, large-scale N-body simulations
could become a key piece in our effort to answer some of the most important
questions in physics: the nature of dark matter, dark energy, and gravity.
Acknowledgements We would like to thank the editor, Thorsten Naab, for his invitation to write this
article and his enormous patience during the process. We would also like to thank Alexandre Barreira,
Silvia Bonoli, Sergio Contreras, Baojiu Li, Go Ogiya, Aseem Paranjape, Cornelius Rampf, Jens Stu¨cker,
and Matteo Zennaro, for comments and suggestions. REA acknowledges the support of the ERC Starting-
Grant 716151 (BACCO). O.H. acknowledges funding from the European Research Council (ERC) under
the European Union’s Horizon 2020 research and innovation programme, Grant Agreement No. 679145
(COSMO-SIMS)
Open Access This article is licensed under a Creative Commons Attribution 4.0 International License,
which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as
you give appropriate credit to the original author(s) and the source, provide a link to the Creative
Commons licence, and indicate if changes were made. The images or other third party material in this
article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line
to the material. If material is not included in the article’s Creative Commons licence and your intended
use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain
permission directly from the copyright holder. To view a copy of this licence, visit http://
creativecommons.org/licenses/by/4.0/.
References
Aarseth SJ (1963) Dynamical evolution of clusters of galaxies. I. MNRAS 126:223. https://doi.org/10.
1093/mnras/126.3.223
Aarseth SJ (2009) Gravitational N-Body Simulations: Tools and Algorithms. Cambridge Monographs on
Mathematical
Physics.
Cambridge
University
Press,
Cambridge.
https://doi.org/10.1017/
CBO9780511535246
Abazajian KN, Adshead P, Ahmed Z et al (2016) CMB-S4 Science Book, First Edition. arXiv e-prints
arXiv:1610.02743 [astro-ph.CO]
Abdallah H, Abramowski A, Aharonian F, Ait Benkhali F, Akhperjanian AG, Angu¨ner E, Arrieta M,
Aubert P, Backes M, Balzer A et al (2016) Search for Dark Matter Annihilations towards the Inner
123
1
Page 150 of 200
R. E. Angulo, O. Hahn

Galactic Halo from 10 Years of Observations with H.E.S.S. Phys Rev Lett 117(11):111301. https://
doi.org/10.1103/PhysRevLett.117.111301. arXiv:1607.08142 [astro-ph.HE]
Abel T, Hahn O, Kaehler R (2012) Tracing the dark matter sheet in phase space. MNRAS 427:61–76.
https://doi.org/10.1111/j.1365-2966.2012.21754.x. arXiv:1111.3944
Ackermann M, Ajello M, Atwood WB et al (2012) Constraints on the Galactic Halo Dark Matter from
Fermi-LAT Diffuse Measurements. ApJ 761(2):91. https://doi.org/10.1088/0004-637X/761/2/91.
arXiv:1205.6474 [astro-ph.CO]
Acquaviva V, Bartolo N, Matarrese S, Riotto A (2003) Gauge-invariant second-order perturbations and
non-Gaussianity from inﬂation. Nucl Phys B 667(1–2):119–148. https://doi.org/10.1016/S0550-
3213(03)00550-9. arXiv:astro-ph/0209156 [astro-ph]
Adamek J, Daverio D, Durrer R, Kunz M (2013) General relativistic N-body simulations in the weak ﬁeld
limit. Phys Rev D 88(10):103527. https://doi.org/10.1103/PhysRevD.88.103527. arXiv:1308.6524
[astro-ph.CO]
Adamek J, Daverio D, Durrer R, Kunz M (2016) gevolution: a cosmological N-body code based on
General Relativity. JCAP 7:053. https://doi.org/10.1088/1475-7516/2016/07/053. arXiv:1604.06065
[astro-ph.CO]
Adamek J, Brandbyge J, Fidler C, Hannestad S, Rampf C, Tram T (2017a) The effect of early radiation in
N-body simulations of cosmic structure formation. MNRAS 470(1):303–313. https://doi.org/10.
1093/mnras/stx1157. arXiv:1703.08585 [astro-ph.CO]
Adamek J, Durrer R, Kunz M (2017b) Relativistic n-body simulations with massive neutrinos. JCAP
11:004. https://doi.org/10.1088/1475-7516/2017/11/004. arXiv:1707.06938 [astro-ph.CO]
Adamek J, Byrnes CT, Gosenca M, Hotchkiss S (2019) WIMPs and stellar-mass primordial black holes
are incompatible. Phys Rev D 100(2):023506. https://doi.org/10.1103/PhysRevD.100.023506.
arXiv:1901.08528 [astro-ph.CO]
Ade P, Aguirre J, Ahmed Z, Aiola S, Ali A, Alonso D, Alvarez MA, Arnold K, Ashton P, Austermann J
et al (2019) The Simons Observatory: science goals and forecasts. JCAP 2:056. https://doi.org/10.
1088/1475-7516/2019/02/056. arXiv:1808.07445 [astro-ph.CO]
Agarwal S, Feldman HA (2011) The effect of massive neutrinos on the matter power spectrum. MNRAS
410(3):1647–1654.
https://doi.org/10.1111/j.1365-2966.2010.17546.x.
arXiv:1006.0689
[astro-
ph.CO]
Aker M, Altenmu¨ller K, Arenz M et al [KATRIN Collaboration] (2019) Improved Upper Limit on the
Neutrino Mass from a Direct Kinematic Method by KATRIN. Phys Rev Lett 123(22):221802.
https://doi.org/10.1103/PhysRevLett.123.221802. arXiv:1909.06048 [hep-ex]
Akitsu K, Sugiyama NS, Shiraishi M (2019) Super-sample tidal modes on the celestial sphere. Phys Rev
D 100(10):103515. https://doi.org/10.1103/PhysRevD.100.103515. arXiv:1907.10591 [astro-ph.CO]
Akitsu K, Li Y, Okumura T (2020) Cosmological simulation in tides: power spectrum and halo shape
responses, and shape assembly bias. arXiv e-prints arXiv:2011.06584 [astro-ph.CO]
Alam S, Ata M, Bailey S et al (2017) The clustering of galaxies in the completed SDSS-III Baryon
Oscillation Spectroscopic Survey: cosmological analysis of the DR12 galaxy sample. MNRAS
470(3):2617–2652. https://doi.org/10.1093/mnras/stx721. arXiv:1607.03155 [astro-ph.CO]
Alam S, Aviles A, Bean R et al (2021) Testing the theory of gravity with DESI: estimators, predictions
and simulation requirements. JCAP 2021(11):050. https://doi.org/10.1088/1475-7516/2021/11/050
Ali-Haı¨moud Y, Bird S (2013) An efﬁcient implementation of massive neutrinos in non-linear structure
formation simulations. MNRAS 428(4):3375–3389. https://doi.org/10.1093/mnras/sts286. arXiv:
1209.0461 [astro-ph.CO]
Allys E, Marchand T, Cardoso JF, Villaescusa-Navarro F, Ho S, Mallat S (2020) New interpretable statis-
tics for large-scale structure analysis and generation. Phys Rev D 102(10):103506. https://doi.org/
10.1103/PhysRevD.102.103506. arXiv:2006.06298 [astro-ph.CO]
Alonso D (2012) CUTE solutions for two-point correlation functions from large cosmological datasets.
arXiv e-prints arXiv:1210.1833 [astro-ph.IM]
Alvarez M, Baldauf T, Bond JR, Dalal N, de Putter R, Dore´ O, Green D, Hirata C, Huang Z, Huterer D,
Jeong D, Johnson MC, Krause E, Loverde M, Meyers J, Meerburg PD, Senatore L, Shandera S,
Silverstein E, Slosar A, Smith K, Zaldarriaga M, Assassi V, Braden J, Hajian A, Kobayashi T, Stein
G, van Engelen A (2014) Testing Inﬂation with Large Scale Structure: Connecting Hopes with
Reality. arXiv e-prints arXiv:1412.4671 [astro-ph.CO]
Anderhalden D, Diemand J (2013) Density proﬁles of CDM microhalos and their implications for
annihilation boost factors. JCAP 4:009. https://doi.org/10.1088/1475-7516/2013/04/009. arXiv:
1302.0003 [astro-ph.CO]
123
Large-scale dark matter simulations
Page 151 of 200
1

Anderson L, Pontzen A, Font-Ribera A, Villaescusa-Navarro F, Rogers KK, Genel S (2019)
Cosmological Hydrodynamic Simulations with Suppressed Variance in the Lya Forest Power
Spectrum. ApJ 871(2):144. https://doi.org/10.3847/1538-4357/aaf576
Angulo RE, Hilbert S (2015) Cosmological constraints from the CFHTLenS shear measurements using a
new, accurate, and ﬂexible way of predicting non-linear mass clustering. MNRAS 448(1):364–375.
https://doi.org/10.1093/mnras/stv050. arXiv:1405.5888 [astro-ph.CO]
Angulo RE, Pontzen A (2016) Cosmological N-body simulations with suppressed variance. MNRAS
462(1):L1–L5. https://doi.org/10.1093/mnrasl/slw098. arXiv:1603.05253 [astro-ph.CO]
Angulo RE, White SDM (2010) One simulation to ﬁt them all—changing the background parameters of a
cosmological N-body simulation. MNRAS 405(1):143–154. https://doi.org/10.1111/j.1365-2966.
2010.16459.x. arXiv:0912.4277 [astro-ph.CO]
Angulo RE, Springel V, White SDM, Jenkins A, Baugh CM, Frenk CS (2012) Scaling relations for galaxy
clusters in the Millennium-XXL simulation. MNRAS 426(3):2046–2062. https://doi.org/10.1111/j.
1365-2966.2012.21830.x. arXiv:1203.3216 [astro-ph.CO]
Angulo RE, Hahn O, Abel T (2013a) How closely do baryons follow dark matter on large scales?
MNRAS 434:1756–1764. https://doi.org/10.1093/mnras/stt1135. arXiv:1301.7426
Angulo RE, Hahn O, Abel T (2013b) The warm dark matter halo mass function below the cut-off scale.
MNRAS 434(4):3337–3347. https://doi.org/10.1093/mnras/stt1246. arXiv:1304.2406 [astro-ph.CO]
Angulo RE, White SDM, Springel V, Henriques B (2014) Galaxy formation on the largest scales: the
impact of astrophysics on the baryonic acoustic oscillation peak. MNRAS 442(3):2131–2144.
https://doi.org/10.1093/mnras/stu905. arXiv:1311.7100 [astro-ph.CO]
Angulo RE, Hahn O, Ludlow AD, Bonoli S (2017) Earth-mass haloes and the emergence of NFW density
proﬁles. MNRAS 471(4):4687–4701. https://doi.org/10.1093/mnras/stx1658. arXiv:1604.03131
[astro-ph.CO]
Angulo RE, Zennaro M, Contreras S, Arico` G, Pellejero-Iban˜ez M, Stu¨cker J (2021) The BACCO
Simulation Project: Exploiting the full power of large-scale structure for cosmology. MNRAS
507:5869–5881. https://doi.org/10.1093/mnras/stab2018
Appel AW (1985) An Efﬁcient Program for Many-Body Simulation. SIAM J Sci Stat Comput
6(1):85–103
Arago´n-Calvo MA, Jones BJT, van de Weygaert R, van der Hulst JM (2007) The multiscale morphology
ﬁlter: identifying and extracting spatial patterns in the galaxy distribution. A&A 474(1):315–338.
https://doi.org/10.1051/0004-6361:20077880. arXiv:0705.2072 [astro-ph]
Arago´n-Calvo MA, van de Weygaert R, Jones BJT, van der Hulst JM (2007) Spin Alignment of Dark
Matter Halos in Filaments and Walls. ApJ 655(1):L5–L8. https://doi.org/10.1086/511633. arXiv:
astro-ph/0610249 [astro-ph]
Arago´n-Calvo MA, Shandarin SF, Szalay A (2010) Geometry of the cosmic web: Minkowski functionals
from the Delaunay tessellation. In: 2010 International Symposium on Voronoi Diagrams in Science
and Engineering, pp 235–243. https://doi.org/10.1109/ISVD.2010.33
Archidiacono M, Hannestad S, Lesgourgues J (2020) What will it take to measure individual neutrino
mass states using cosmology? JCAP 9:021. https://doi.org/10.1088/1475-7516/2020/09/021. arXiv:
2003.03354 [astro-ph.CO]
Arico` G, Angulo RE, Herna´ndez-Monteagudo C, Contreras S, Zennaro M, Pellejero-Iban˜ez M, Rosas-
Guevara Y (2020) Modelling the large scale structure of the Universe as a function of cosmology
and baryonic physics. MNRAS 495:4800–4819. https://doi.org/10.1093/mnras/staa1478
Arico` G, Angulo RE, Herna´ndez-Monteagudo C, Contreras S, Zennaro M (2021a) Simultaneous
modelling of matter power spectrum and bispectrum in the presence of baryons. MNRAS
503:3596–3609. https://doi.org/10.1093/mnras/stab699
Arico` G, Angulo RE, Contreras S, Ondaro-Mallea L, Pellejero-Iban˜ez M, Zennaro M (2021b) The
BACCO
simulation
project:
a
baryoniﬁcation
emulator
with
neural
networks.
MNRAS
506(3):4070–4082. https://doi.org/10.1093/mnras/stab1911. arXiv:2011.15018 [astro-ph.CO]
Armengaud E, Palanque-Delabrouille N, Ye`che C, Marsh DJE, Baur J (2017) Constraining the mass of
light bosonic dark matter using SDSS Lyman-a forest. MNRAS 471(4):4606–4614. https://doi.org/
10.1093/mnras/stx1870. arXiv:1703.09126 [astro-ph.CO]
Arnold C, Leo M, Li B (2019) Realistic simulations of galaxy formation in f(R) modiﬁed gravity. Nature
Astronomy
3:945–954.
https://doi.org/10.1038/s41550-019-0823-y.
arXiv:1907.02977
[astro-
ph.CO]
123
1
Page 152 of 200
R. E. Angulo, O. Hahn

Arnold C, Li B, Giblin B, Harnois-De´raps J, Cai YC (2021) FORGE—the f(R) gravity cosmic emulator
project I: Introduction and matter power spectrum emulator. arXiv e-prints arXiv:2109.04984 [astro-
ph.CO]
Ascasibar Y,
Gottlo¨ber
S (2008) The dynamical structure of
dark
matter haloes. MNRAS
386(4):2022–2030. https://doi.org/10.1111/j.1365-2966.2008.13160.x. arXiv:0802.4348 [astro-ph]
Asgari M, Lin CA, Joachimi B, Giblin B, Heymans C, Hildebrandt H, Kannawadi A, Sto¨lzner B, Tro¨ster
T, van den Busch JL, Wright AH, Bilicki M, Blake C, de Jong J, Dvornik A, Erben T, Getman F,
Hoekstra H, Ko¨hlinger F, Kuijken K, Miller L, Radovich M, Schneider P, Shan H, Valentijn E
(2021) KiDS-1000 cosmology: Cosmic shear constraints and comparison between two point
statistics. A&A 645:A104. https://doi.org/10.1051/0004-6361/202039070. arXiv:2007.15633 [astro-
ph.CO]
Assassi V, Baumann D, Schmidt F (2015) Galaxy bias and primordial non-Gaussianity. JCAP 12:043.
https://doi.org/10.1088/1475-7516/2015/12/043. arXiv:1510.03723 [astro-ph.CO]
Ata M, Kitaura FS, Mu¨ller V (2015) Bayesian inference of cosmic density ﬁelds from non-linear, scale-
dependent, and stochastic biased tracers. MNRAS 446(4):4250–4259. https://doi.org/10.1093/
mnras/stu2347. arXiv:1408.2566 [astro-ph.CO]
Aubert D, Pichon C, Colombi S (2004) The origin and implications of dark matter anisotropic cosmic
infall on  LH haloes. MNRAS 352(2):376–398. https://doi.org/10.1111/j.1365-2966.2004.07883.x.
arXiv:astro-ph/0402405 [astro-ph]
Audren B, Lesgourgues J, Mangano G, Serpico PD, Tram T (2014) Strongest model-independent bound
on the lifetime of Dark Matter. JCAP 12:028. https://doi.org/10.1088/1475-7516/2014/12/028.
arXiv:1407.2418 [astro-ph.CO]
Avila S, Murray SG, Knebe A, Power C, Robotham ASG, Garcia-Bellido J (2015) HALOGEN: a tool for
fast generation of mock halo catalogues. MNRAS 450(2):1856–1867. https://doi.org/10.1093/mnras/
stv711. arXiv:1412.5228 [astro-ph.CO]
Avila-Reese V, Colı´n P, Valenzuela O, D’Onghia E, Firmani C (2001) Formation and Structure of Halos
in a Warm Dark Matter Cosmology. ApJ 559(2):516–530. https://doi.org/10.1086/322411. arXiv:
astro-ph/0010525 [astro-ph]
Bagla JS (2002) TreePM: A Code for Cosmological N-Body Simulations. J Astrophys Astron
23:185–196. https://doi.org/10.1007/BF02702282. arXiv:astro-ph/9911025 [astro-ph]
Bagla JS, Khandai N (2009) The Adaptive TreePM: an adaptive resolution code for cosmological N-body
simulations. MNRAS 396(4):2211–2227. https://doi.org/10.1111/j.1365-2966.2009.14880.x. arXiv:
0811.4228 [astro-ph]
Bagla JS, Ray S (2003) Performance characteristics of TreePM codes. New A 8(7):665–677. https://doi.
org/10.1016/S1384-1076(03)00056-3. arXiv:astro-ph/0212129 [astro-ph]
Baldauf T, Seljak U, Senatore L, Zaldarriaga M (2011) Galaxy bias and non-linear structure formation in
general relativity. JCAP 10:031. https://doi.org/10.1088/1475-7516/2011/10/031
Baldauf T, Seljak U, Senatore L, Zaldarriaga M (2016) Linear response to long wavelength ﬂuctuations
using curvature simulations. JCAP 9:007. https://doi.org/10.1088/1475-7516/2016/09/007. arXiv:
1511.01465 [astro-ph.CO]
Baldi M (2012) Dark Energy simulations. Phys Dark Universe 1(1–2):162–193. https://doi.org/10.1016/j.
dark.2012.10.004. arXiv:1210.6650 [astro-ph.CO]
Baldi M, Villaescusa-Navarro F (2018) Cosmic degeneracies—II. Structure formation in joint simulations
of warm dark matter and f(R) gravity. MNRAS 473(3):3226–3240. https://doi.org/10.1093/mnras/
stx2594
Baldi M, Villaescusa-Navarro F, Viel M, Puchwein E, Springel V, Moscardini L (2014) Cosmic
degeneracies—I. Joint N-body simulations of modiﬁed gravity and massive neutrinos. MNRAS
440(1):75–88. https://doi.org/10.1093/mnras/stu259. arXiv:1311.2588 [astro-ph.CO]
Ballenegger V (2014) Communication: On the origin of the surface term in the Ewald formula. J Chem
Phys 140(16):161102. https://doi.org/10.1063/1.4872019
Banerjee A, Abel T (2021a) Cosmological cross-correlations and nearest neighbor distributions. MNRAS
504:2911–2923. https://doi.org/10.1093/mnras/stab961
Banerjee A, Abel T (2021b) Nearest neighbour distributions: New statistical measures for cosmological
clustering. MNRAS 500(4):5479–5499. https://doi.org/10.1093/mnras/staa3604. arXiv:2007.13342
[astro-ph.CO]
Banerjee A, Dalal N (2016) Simulating nonlinear cosmological structure formation with massive
neutrinos. JCAP 11:015. https://doi.org/10.1088/1475-7516/2016/11/015. arXiv:1606.06167 [astro-
ph.CO]
123
Large-scale dark matter simulations
Page 153 of 200
1

Banerjee A, Powell D, Abel T, Villaescusa-Navarro F (2018) Reducing noise in cosmological N-body
simulations with neutrinos. JCAP 9:028. https://doi.org/10.1088/1475-7516/2018/09/028. arXiv:
1801.03906
Banerjee A, Adhikari S, Dalal N, More S, Kravtsov A (2020) Signatures of self-interacting dark matter on
cluster density proﬁle and subhalo distributions. JCAP 2:024. https://doi.org/10.1088/1475-7516/
2020/02/024. arXiv:1906.12026 [astro-ph.CO]
Banerjee A, Kokron N, Abel T (2021) Modeling Nearest Neighbor distributions of biased tracers using
Hybrid Effective Field Theory. arXiv e-prints arXiv:2107.10287 [astro-ph.CO]
Bar N, Blas D, Blum K, Sibiryakov S (2018) Galactic rotation curves versus ultralight dark matter:
Implications of the soliton-host halo relation. Phys Rev D 98(8):083027. https://doi.org/10.1103/
PhysRevD.98.083027. arXiv:1805.00122 [astro-ph.CO]
Barnes
J,
Hut
P
(1986)
A
hierarchical
O(N
log
N)
force-calculation
algorithm.
Nature
324(6096):446–449. https://doi.org/10.1038/324446a0
Barreira A (2020) On the impact of galaxy bias uncertainties on primordial non-Gaussianity constraints.
JCAP 2020(12):031. https://doi.org/10.1088/1475-7516/2020/12/031. arXiv:2009.06622 [astro-
ph.CO]
Barreira A, Bose S, Li B (2015) Speeding up N-body simulations of modiﬁed gravity: Vainshtein
screening models. JCAP 12:059. https://doi.org/10.1088/1475-7516/2015/12/059. arXiv:1511.08200
[astro-ph.CO]
Barreira A, Sa´nchez AG, Schmidt F (2016) Validating estimates of the growth rate of structure with
modiﬁed gravity simulations. Phys Rev D 94(8):084022. https://doi.org/10.1103/PhysRevD.94.
084022. arXiv:1605.03965 [astro-ph.CO]
Barreira A, Krause E, Schmidt F (2018) Accurate cosmic shear errors: do we need ensembles of
simulations? JCAP 10:053. https://doi.org/10.1088/1475-7516/2018/10/053. arXiv:1807.04266
[astro-ph.CO]
Barreira A, Nelson D, Pillepich A, Springel V, Schmidt F, Pakmor R, Hernquist L, Vogelsberger M
(2019) Separate Universe simulations with IllustrisTNG: baryonic effects on power spectrum
responses and higher-order statistics. MNRAS 488:2079–2092. https://doi.org/10.1093/mnras/
stz1807. arXiv:1904.02070
Barreira A, Cabass G, Nelson D, Schmidt F (2020a) Baryon-CDM isocurvature galaxy bias with
IllustrisTNG. JCAP 2:005. https://doi.org/10.1088/1475-7516/2020/02/005. arXiv:1907.04317 [as-
tro-ph.CO]
Barreira A, Cabass G, Schmidt F, Pillepich A, Nelson D (2020b) Galaxy bias and primordial non-
Gaussianity: insights from galaxy formation simulations with IllustrisTNG. JCAP 12:013. https://
doi.org/10.1088/1475-7516/2020/12/013. arXiv:2006.09368 [astro-ph.CO]
Bartolo N, Komatsu E, Matarrese S, Riotto A (2004) Non-Gaussianity from inﬂation: theory and
observations. Phys Rep 402:103–266. https://doi.org/10.1016/j.physrep.2004.08.022. arXiv:astro-
ph/0406398
Bartolo N, Matarrese S, Riotto A (2007) Course 5—cosmic microwave background anisotropies up to
second order. In: Bernardeau F, Grojean C, Dalibard J (eds) Particle Physics and Cosmology: The
Fabric of Spacetime. Les Houches, vol 86. Elsevier, pp 233–285. https://doi.org/10.1016/S0924-
8099(07)80031-X
Bastos de Senna Nascimento C, Loverde M (2021) Neutrinos in N-body simulations. Phys Rev D
104:043512. https://doi.org/10.1103/PhysRevD.104.043512
Baugh CM (2006) A primer on hierarchical galaxy formation: the semi-analytical approach. Rep Prog
Phys
69(12):3101–3156.
https://doi.org/10.1088/0034-4885/69/12/R02.
arXiv:astro-ph/0610031
[astro-ph]
Baugh CM, Lacey CG, Frenk CS, Granato GL, Silva L, Bressan A, Benson AJ, Cole S (2005) Can the
faint submillimetre galaxies be explained in the K cold dark matter model? MNRAS
356(3):1191–1200. https://doi.org/10.1111/j.1365-2966.2004.08553.x. arXiv:astro-ph/0406069 [as-
tro-ph]
Baumann D, Nicolis A, Senatore L, Zaldarriaga M (2012) Cosmological non-linearities as an effective
ﬂuid. JCAP 7:051. https://doi.org/10.1088/1475-7516/2012/07/051. arXiv:1004.2488 [astro-ph.CO]
Baumann D, Ferraro S, Green D, Smith KM (2013) Stochastic bias from non-Gaussian initial conditions.
JCAP 5:001. https://doi.org/10.1088/1475-7516/2013/05/001. arXiv:1209.2173 [astro-ph.CO]
Baushev AN (2015) The real and apparent convergence of N-body simulations of the dark matter
structures: Is the Navarro-Frenk-White proﬁle real? Astropart Phys 62:47–53. https://doi.org/10.
1016/j.astropartphys.2014.07.012. arXiv:1312.0314 [astro-ph.CO]
123
1
Page 154 of 200
R. E. Angulo, O. Hahn

Bayer AE, Banerjee A, Feng Y (2021) A fast particle-mesh simulation of non-linear cosmological
structure formation with massive neutrinos. JCAP 2021(01):016. https://doi.org/10.1088/1475-7516/
2021/01/016
Behroozi PS, Wechsler RH, Conroy C (2013a) The Average Star Formation Histories of Galaxies in Dark
Matter Halos from z = 0–8. ApJ 770(1):57. https://doi.org/10.1088/0004-637X/770/1/57. arXiv:
1207.6105 [astro-ph.CO]
Behroozi PS, Wechsler RH, Wu HY (2013b) The ROCKSTAR Phase-space Temporal Halo Finder and
the Velocity Offsets of Cluster Cores. ApJ 762(2):109. https://doi.org/10.1088/0004-637X/762/2/
109. arXiv:1110.4372 [astro-ph.CO]
Behroozi P, Knebe A, Pearce FR, Elahi P, Han J, Lux H, Mao YY, Muldrew SI, Potter D, Srisawat C
(2015) Major mergers going Notts: challenges for modern halo ﬁnders. MNRAS 454(3):3020–3029.
https://doi.org/10.1093/mnras/stv2046. arXiv:1506.01405 [astro-ph.CO]
Behroozi P, Wechsler RH, Hearin AP, Conroy C (2019) UNIVERSEMACHINE: The correlation between
galaxy growth and dark matter halo assembly from z = 0–10. MNRAS 488(3):3143–3194. https://
doi.org/10.1093/mnras/stz1182. arXiv:1806.07893 [astro-ph.GA]
Bel J, Pezzotta A, Carbone C, Sefusatti E, Guzzo L (2019) Accurate ﬁtting functions for peculiar velocity
spectra in standard and massive-neutrino cosmologies. A&A 622:A109. https://doi.org/10.1051/
0004-6361/201834513. arXiv:1809.09338 [astro-ph.CO]
Belgacem E, Calcagni G, Crisostomi M, Dalang C, Dirian Y, Ezquiaga JM, Fasiello M, Foffa S, Ganz A,
Garcı´a-Bellido J, Lombriser L, Maggiore M, Tamanini N, Tasinato G, Zumalaca´rregui M, Barausse
E, Bartolo N, Bertacca D, Klein A, Matarrese S, Sakellariadou M (2019) Testing modiﬁed gravity at
cosmological distances with LISA standard sirens. JCAP 7:024. https://doi.org/10.1088/1475-7516/
2019/07/024. arXiv:1906.01593 [astro-ph.CO]
Benson AJ (2012) G ALACTICUS: A semi-analytic model of galaxy formation. New A 17(2):175–197.
https://doi.org/10.1016/j.newast.2011.07.004. arXiv:1008.1786 [astro-ph.CO]
Berezinsky V, Dokuchaev V, Eroshenko Y (2003) Small-scale clumps in the galactic halo and dark
matter annihilation. Phys Rev D 68(10):103003. https://doi.org/10.1103/PhysRevD.68.103003.
arXiv:astro-ph/0301551 [astro-ph]
Berger P, Stein G (2019) A volumetric deep Convolutional Neural Network for simulation of mock dark
matter halo catalogues. MNRAS 482(3):2861–2871. https://doi.org/10.1093/mnras/sty2949. arXiv:
1805.04537 [astro-ph.CO]
Bernardeau F (1994) The Nonlinear Evolution of Rare Events. ApJ 427:51. https://doi.org/10.1086/
174121. arXiv:astro-ph/9311066 [astro-ph]
Bernardeau F, Colombi S, Gaztan˜aga E, Scoccimarro R (2002) Large-scale structure of the Universe and
cosmological perturbation theory. Phys Rep 367(1–3):1–248. https://doi.org/10.1016/S0370-
1573(02)00135-7. arXiv:astro-ph/0112551 [astro-ph]
Bernardini M, Mayer L, Reed D, Feldmann R (2020) Predicting dark matter halo formation in N-body
simulations with deep regression networks. MNRAS 496(4):5116–5125. https://doi.org/10.1093/
mnras/staa1911. arXiv:1912.04299 [astro-ph.CO]
Bernyk M, Croton DJ, Tonini C, Hodkinson L, Hassan AH, Garel T, Duffy AR, Mutch SJ, Poole GB,
Hegarty S (2016) The Theoretical Astrophysical Observatory: Cloud-based Mock Galaxy Catalogs.
ApJS 223(1):9. https://doi.org/10.3847/0067-0049/223/1/9. arXiv:1403.5270 [astro-ph.GA]
Bertone G (2010) The moment of truth for WIMP dark matter. Nature 468(7322):389–393. https://doi.
org/10.1038/nature09509. arXiv:1011.3532 [astro-ph.CO]
Bertone G, Tait TMP (2018) A new era in the search for dark matter. Nature 562(7725):51–56. https://doi.
org/10.1038/s41586-018-0542-z. arXiv:1810.01668 [astro-ph.CO]
Bertone G, Hooper D, Silk J (2004) Particle dark matter: evidence, candidates and constraints. Phys Rep
405:279–390. https://doi.org/10.1016/j.physrep.2004.08.031
Bertschinger E (1985) Self-similar secondary infall and accretion in an Einstein-de Sitter universe. ApJS
58:39–65. https://doi.org/10.1086/191028
Bertschinger E (2001) Multiscale Gaussian Random Fields and Their Application to Cosmological
Simulations. ApJS 137(1):1–20. https://doi.org/10.1086/322526. arXiv:astro-ph/0103301 [astro-ph]
Betoule M, Kessler R, Guy J, Mosher J, Hardin D, Biswas R, Astier P, El-Hage P, Konig M, Kuhlmann S,
Marriner J, Pain R, Regnault N, Balland C, Bassett BA, Brown PJ, Campbell H, Carlberg RG,
Cellier-Holzem F, Cinabro D, Conley A, D’Andrea CB, DePoy DL, Doi M, Ellis RS, Fabbro S,
Filippenko AV, Foley RJ, Frieman JA, Fouchez D, Galbany L, Goobar A, Gupta RR, Hill GJ,
Hlozek R, Hogan CJ, Hook IM, Howell DA, Jha SW, Le Guillou L, Leloudas G, Lidman C,
Marshall JL, Mo¨ller A, Moura˜o AM, Neveu J, Nichol R, Olmstead MD, Palanque-Delabrouille N,
123
Large-scale dark matter simulations
Page 155 of 200
1

Perlmutter S, Prieto JL, Pritchet CJ, Richmond M, Riess AG, Ruhlmann-Kleider V, Sako M,
Schahmaneche K, Schneider DP, Smith M, Sollerman J, Sullivan M, Walton NA, Wheeler CJ
(2014) Improved cosmological constraints from a joint analysis of the SDSS-II and SNLS supernova
samples. A&A 568:A22. https://doi.org/10.1051/0004-6361/201423413. arXiv:1401.4064 [astro-
ph.CO]
Betti MG, Biasotti M, Bosca´ A, Calle F, Canci N, Cavoto G, Chang C, Cocco AG, Colijn AP, Conrad J,
D’Ambrosio N, De Groot N, de Salas PF, Faverzani M, Ferella A, Ferri E, Garcia-Abia P, Garcı´a-
Corte´s I, Garcia Gomez-Tejedor G, Gariazzo S, Gatti F, Gentile C, Giachero A, Gudmundsson JE,
Hochberg Y, Kahn Y, Kievsky A, Lisanti M, Mancini-Terracciano C, Mangano G, Marcucci LE,
Mariani C, Martı´nez J, Messina M, Molinero-Vela A, Monticone E, Moron˜o A, Nucciotti A,
PandolﬁF, Parlati S, Pastor S, Pedro´s J, Pe´rez de los Heros C, Pisanti O, Polosa AD, Puiu A, Rago I,
Raitses Y, Rajteri M, Rossi N, Rucandio I, Santorelli R, Schaeffner K, Tully CG, Viviani M, Zhao F,
Zurek KM (2019) Neutrino physics with the PTOLEMY project: active neutrino properties and the
light sterile case. JCAP 7:047. https://doi.org/10.1088/1475-7516/2019/07/047. arXiv:1902.05508
[astro-ph.CO]
Bhattacharya S, Heitmann K, White M, Lukic´ Z, Wagner C, Habib S (2011) Mass Function Predictions
Beyond KCDM. ApJ 732(2):122. https://doi.org/10.1088/0004-637X/732/2/122. arXiv:1005.2239
[astro-ph.CO]
Bird S, Viel M, Haehnelt MG (2012) Massive neutrinos and the non-linear matter power spectrum.
MNRAS 420(3):2551–2561. https://doi.org/10.1111/j.1365-2966.2011.20222.x. arXiv:1109.4416
[astro-ph.CO]
Bird S, Ali-Haı¨moud Y, Feng Y, Liu J (2018) An efﬁcient and accurate hybrid method for simulating
non-linear neutrino structure. MNRAS 481(2):1486–1500. https://doi.org/10.1093/mnras/sty2376.
arXiv:1803.09854 [astro-ph.CO]
Bird S, Feng Y, Pedersen C, Font-Ribera A (2020) More accurate simulations with separate initial
conditions for baryons and dark matter. JCAP 6:002. https://doi.org/10.1088/1475-7516/2020/06/
002. arXiv:2002.00015 [astro-ph.CO]
Blaizot J, Wadadekar Y, Guiderdoni B, Colombi ST, Bertin E, Bouchet FR, Devriendt JEG, Hatton S
(2005) MoMaF: the Mock Map Facility. MNRAS 360(1):159–175. https://doi.org/10.1111/j.1365-
2966.2005.09019.x. arXiv:astro-ph/0309305 [astro-ph]
Blake C, Amon A, Asgari M, Bilicki M, Dvornik A, Erben T, Giblin B, Glazebrook K, Heymans C,
Hildebrandt H, Joachimi B, Joudaki S, Kannawadi A, Kuijken K, Lidman C, Parkinson D, Shan H,
Tro¨ster T, van den Busch JL, Wolf C, Wright AH (2020) Testing gravity using galaxy-galaxy
lensing and clustering amplitudes in KiDS-1000, BOSS, and 2dFLenS. A&A 642:A158. https://doi.
org/10.1051/0004-6361/202038505. arXiv:2005.14351 [astro-ph.CO]
Blanes S, Casas F (2016) A Concise Introduction to Geometric Numerical Integration, 1st edn. Chapman
and Hall/CRC Press, New York
Blanes S, Casas F, Oteo JA, Ros J (2009) The Magnus expansion and some of its applications. Phys Rep
470:151–238. https://doi.org/10.1016/j.physrep.2008.11.001. arXiv:0810.5488 [math-ph]
Blas D, Lesgourgues J, Tram T (2011) The Cosmic Linear Anisotropy Solving System (CLASS). Part II:
Approximation schemes. JCAP 7:034. https://doi.org/10.1088/1475-7516/2011/07/034. arXiv:1104.
2933 [astro-ph.CO]
Blas D, Nacir DL, Sibiryakov S (2017) Ultralight Dark Matter Resonates with Binary Pulsars. Phys Rev
Lett 118(26):261102. https://doi.org/10.1103/PhysRevLett.118.261102. arXiv:1612.06789 [hep-ph]
Blot L, Crocce M, Sefusatti E, Lippich M, Sa´nchez AG, Colavincenzo M, Monaco P, Alvarez MA,
Agrawal A, Avila S, Balaguera-Antolı´nez A, Bond R, Codis S, Dalla Vecchia C, Dorta A, Fosalba P,
Izard A, Kitaura FS, Pellejero-Iban˜ez M, Stein G, Vakili M, Yepes G (2019) Comparing
approximate methods for mock catalogues and covariance matrices II: power spectrum multipoles.
MNRAS 485(2):2806–2824. https://doi.org/10.1093/mnras/stz507. arXiv:1806.09497 [astro-ph.CO]
Bocquet S, Saro A, Dolag K, Mohr JJ (2016) Halo mass function: baryon impact, ﬁtting formulae, and
implications for cluster cosmology. MNRAS 456(3):2361–2373. https://doi.org/10.1093/mnras/
stv2657. arXiv:1502.07357 [astro-ph.CO]
Bocquet S, Heitmann K, Habib S, Lawrence E, Uram T, Frontiere N, Pope A, Finkel H (2020) The Mira-
Titan Universe. III. Emulation of the Halo Mass Function. ApJ 901(1):5. https://doi.org/10.3847/
1538-4357/abac5c. arXiv:2003.12116 [astro-ph.CO]
Bode P, Ostriker JP, Turok N (2001) Halo Formation in Warm Dark Matter Models. ApJ 556(1):93–107.
https://doi.org/10.1086/321541. arXiv:astro-ph/0010389 [astro-ph]
123
1
Page 156 of 200
R. E. Angulo, O. Hahn

Bo¨hm V, Feng Y, Lee ME, Dai B (2020) MADLens, a python package for fast and differentiable non-
Gaussian lensing simulations. arXiv e-prints arXiv:2012.07266 [astro-ph.CO]
Bond JR, Kofman L, Pogosyan D (1996) How ﬁlaments of galaxies are woven into the cosmic web.
Nature 380(6575):603–606. https://doi.org/10.1038/380603a0. arXiv:astro-ph/9512141 [astro-ph]
Bonnaire T, Aghanim N, Decelle A, Douspis M (2020) T-ReX: a graph-based ﬁlament detection method.
A&A 637:A18. https://doi.org/10.1051/0004-6361/201936859. arXiv:1912.00732 [astro-ph.CO]
Bonoli S, Marı´n-Franch A, Varela J et al (2021) The miniJPAS survey: A preview of the Universe in 56
colors. A&A 653:A31. https://doi.org/10.1051/0004-6361/202038841. arXiv:2007.01910 [astro-
ph.CO]
Borsanyi S, Fodor Z, Guenther J, Kampert KH, Katz SD, Kawanai T, Kovacs TG, Mages SW, Pasztor A,
Pittler F, Redondo J, Ringwald A, Szabo KK (2016) Calculation of the axion mass based on high-
temperature lattice quantum chromodynamics. Nature 539(7627):69–71. https://doi.org/10.1038/
nature20115
Bose S, Vogelsberger M, Zavala J, Pfrommer C, Cyr-Racine FY, Bohr S, Bringmann T (2019) ETHOS—
an Effective Theory of Structure Formation: detecting dark matter interactions through the Lyman-a
forest. MNRAS 487(1):522–536. https://doi.org/10.1093/mnras/stz1276. arXiv:1811.10630 [astro-
ph.CO]
Bouchet FR, Hernquist L (1988) Cosmological Simulations Using the Hierarchical Tree Method. ApJS
68:521. https://doi.org/10.1086/191299
Bouchet FR, Colombi S, Hivon E, Juszkiewicz R (1995) Perturbative Lagrangian approach to
gravitational instability. A&A 296:575. arXiv:astro-ph/9406013
Bower RG, Benson AJ, Malbon R, Helly JC, Frenk CS, Baugh CM, Cole S, Lacey CG (2006) Breaking
the hierarchy of galaxy formation. MNRAS 370(2):645–655. https://doi.org/10.1111/j.1365-2966.
2006.10519.x. arXiv:astro-ph/0511338 [astro-ph]
Bower RG, Vernon I, Goldstein M, Benson AJ, Lacey CG, Baugh CM, Cole S, Frenk CS (2010) The
parameter space of galaxy formation. MNRAS 407(4):2017–2045. https://doi.org/10.1111/j.1365-
2966.2010.16991.x. arXiv:1004.0711 [astro-ph.CO]
Boylan-Kolchin M, Springel V, White SDM, Jenkins A, Lemson G (2009) Resolving cosmic structure
formation with the Millennium-II Simulation. MNRAS 398(3):1150–1164. https://doi.org/10.1111/j.
1365-2966.2009.15191.x. arXiv:0903.3041 [astro-ph.CO]
Boylan-Kolchin M, Bullock JS, Kaplinghat M (2011) Too big to fail? The puzzling darkness of massive
Milky Way subhaloes. MNRAS 415(1):L40–L44. https://doi.org/10.1111/j.1745-3933.2011.01074.
x. arXiv:1103.0007 [astro-ph.CO]
Boyle A, Schmidt F (2020) Neutrino mass constraints beyond linear order: cosmology dependence and
systematic biases. arXiv e-prints arXiv:2011.10594 [astro-ph.CO]
Brandbyge J, Hannestad S (2009) Grid based linear neutrino perturbations in cosmological N-body
simulations. JCAP 5:002. https://doi.org/10.1088/1475-7516/2009/05/002. arXiv:0812.3149 [astro-
ph]
Brandbyge J, Hannestad S, Haugbølle T, Thomsen B (2008) The effect of thermal neutrino motion on the
non-linear cosmological matter power spectrum. JCAP 8:020. https://doi.org/10.1088/1475-7516/
2008/08/020. arXiv:0802.3700 [astro-ph]
Brandbyge J, Rampf C, Tram T, Leclercq F, Fidler C, Hannestad S (2017) Cosmological N -body
simulations including radiation perturbations. MNRAS 466(1):L68–L72. https://doi.org/10.1093/
mnrasl/slw235. arXiv:1610.04236 [astro-ph.CO]
Brandt
A
(1977)
Multi-level
adaptive
solutions
to
boundary-value
problems.
Math
Comput
31(138):333–390
Brax P, Davis AC, Li B, Winther HA, Zhao GB (2012) Systematic simulations of modiﬁed gravity:
symmetron and dilaton models. JCAP 10:002. https://doi.org/10.1088/1475-7516/2012/10/002.
arXiv:1206.3568 [astro-ph.CO]
Breton MA, Rasera Y, Taruya A, Lacombe O, Saga S (2019) Imprints of relativistic effects on the
asymmetry of the halo cross-correlation function: from linear to non-linear scales. MNRAS
483(2):2671–2696. https://doi.org/10.1093/mnras/sty3206. arXiv:1803.04294 [astro-ph.CO]
Brinckmann T, Zavala J, Rapetti D, Hansen SH, Vogelsberger M (2018) The structure and assembly
history of cluster-sized haloes in self-interacting dark matter. MNRAS 474(1):746–759. https://doi.
org/10.1093/mnras/stx2782. arXiv:1705.00623 [astro-ph.CO]
Bringmann T, Scott P, Akrami Y (2012) Improved constraints on the primordial power spectrum at small
scales from ultracompact minihalos. Phys Rev D 85(12):125027. https://doi.org/10.1103/PhysRevD.
85.125027. arXiv:1110.2484 [astro-ph.CO]
123
Large-scale dark matter simulations
Page 157 of 200
1

Brook CB, Di Cintio A (2015) Expanded haloes, abundance matching and too-big-to-fail in the Local
Group. MNRAS 450(4):3920–3934. https://doi.org/10.1093/mnras/stv864. arXiv:1410.3825 [astro-
ph.GA]
Brooks AM, Kuhlen M, Zolotov A, Hooper D (2013) A Baryonic Solution to the Missing Satellites
Problem. ApJ 765(1):22. https://doi.org/10.1088/0004-637X/765/1/22. arXiv:1209.5394 [astro-
ph.CO]
Brown ST, McCarthy IG, Diemer B, Font AS, Stafford SG, Pfeifer S (2020) Connecting the structure of
dark matter haloes to the primordial power spectrum. MNRAS 495(4):4994–5013. https://doi.org/
10.1093/mnras/staa1491. arXiv:2005.12933 [astro-ph.CO]
Bryan GL, Norman ML (1998) Statistical Properties of X-Ray Clusters: Analytic and Numerical
Comparisons. ApJ 495(1):80–99. https://doi.org/10.1086/305262. arXiv:astro-ph/9710107 [astro-ph]
Buchert T (1989) A class of solutions in Newtonian cosmology and the pancake theory. A&A 223:9–24
Buchert T (1994) Lagrangian Theory of Gravitational Instability of Friedman-Lemaitre Cosmologies - a
Generic Third-Order Model for Nonlinear Clustering. MNRAS 267:811. https://doi.org/10.1093/
mnras/267.4.811. arXiv:astro-ph/9309055
Buehlmann M, Hahn O (2019) Large-scale velocity dispersion and the cosmic web. MNRAS
487(1):228–245. https://doi.org/10.1093/mnras/stz1243. arXiv:1812.07489 [astro-ph.CO]
Bullock JS, Kolatt TS, Sigad Y, Somerville RS, Kravtsov AV, Klypin AA, Primack JR, Dekel A (2001)
Proﬁles of dark haloes: evolution, scatter and environment. MNRAS 321(3):559–575. https://doi.
org/10.1046/j.1365-8711.2001.04068.x. arXiv:astro-ph/9908159 [astro-ph]
Burkert A (2000) The Structure and Evolution of Weakly Self-interacting Cold Dark Matter Halos. ApJ
534(2):L143–L146. https://doi.org/10.1086/312674. arXiv:astro-ph/0002409 [astro-ph]
Burkert A (2020) Fuzzy Dark Matter and Dark Matter Halo Cores. ApJ 904(2):161. https://doi.org/10.
3847/1538-4357/abb242. arXiv:2006.11111 [astro-ph.GA]
Buschmann M, Foster JW, Safdi BR (2019) Early-Universe Simulations of the Cosmological Axion.
arXiv e-prints arXiv:1906.00967 [astro-ph.CO]
Byrnes CT, Hindmarsh M, Young S, Hawkins MRS (2018) Primordial black holes with an accurate QCD
equation of state. JCAP 8:041. https://doi.org/10.1088/1475-7516/2018/08/041. arXiv:1801.06138
[astro-ph.CO]
Cacciato M, van den Bosch FC, More S, Mo H, Yang X (2013) Cosmological constraints from a
combination of galaxy clustering and lensing—III. Application to SDSS data. MNRAS
430(2):767–786. https://doi.org/10.1093/mnras/sts525. arXiv:1207.0503 [astro-ph.CO]
Cai YC, Padilla N, Li B (2015) Testing gravity using cosmic voids. MNRAS 451(1):1036–1055. https://
doi.org/10.1093/mnras/stv777. arXiv:1410.1510 [astro-ph.CO]
Cai YC, Taylor A, Peacock JA, Padilla N (2016) Redshift-space distortions around voids. MNRAS
462(3):2465–2477. https://doi.org/10.1093/mnras/stw1809. arXiv:1603.05184 [astro-ph.CO]
Cai YC, Kaiser N, Cole S, Frenk C (2017) Gravitational redshift and asymmetric redshift-space
distortions for stacked clusters. MNRAS 468(2):1981–1993. https://doi.org/10.1093/mnras/stx469.
arXiv:1609.04864 [astro-ph.CO]
Camera S, Santos MG, Maartens R (2015) Probing primordial non-Gaussianity with SKA galaxy redshift
surveys: a fully relativistic analysis. MNRAS 448(2):1035–1043. https://doi.org/10.1093/mnras/
stv040. arXiv:1409.8286 [astro-ph.CO]
Campbell D, van den Bosch FC, Padmanabhan N, Mao YY, Zentner AR, Lange JU, Jiang F, Villarreal A
(2018) The galaxy clustering crisis in abundance matching. MNRAS 477(1):359–383. https://doi.
org/10.1093/mnras/sty495. arXiv:1705.06347 [astro-ph.GA]
Carlesi E, Sorce JG, Hoffman Y, Gottlo¨ber S, Yepes G, Libeskind NI, Pilipenko SV, Knebe A, Courtois
H, Tully RB, Steinmetz M (2016) Constrained Local UniversE Simulations: a Local Group factory.
MNRAS 458(1):900–911. https://doi.org/10.1093/mnras/stw357. arXiv:1602.03919 [astro-ph.CO]
Carr B, Ku¨hnel F (2020) Primordial Black Holes as Dark Matter: Recent Developments. Annu Rev Nucl
Part Sci 70:355–394. https://doi.org/10.1146/annurev-nucl-050520-125911. arXiv:2006.02838 [as-
tro-ph.CO]
Carr B, Ku¨hnel F, Sandstad M (2016) Primordial black holes as dark matter. Phys Rev D 94(8):083504.
https://doi.org/10.1103/PhysRevD.94.083504. arXiv:1607.06077
Carr B, Kohri K, Sendouda Y, Yokoyama J (2020a) Constraints on Primordial Black Holes. arXiv
e-prints arXiv:2002.12778 [astro-ph.CO]
Carr B, Kuhnel F, Visinelli L (2020b) Black Holes and WIMPs: All or Nothing or Something Else. arXiv
e-prints arXiv:2011.01930 [astro-ph.CO]
123
1
Page 158 of 200
R. E. Angulo, O. Hahn

Carr B, Clesse S, Garcı´a-Bellido J, Ku¨hnel F (2021) Cosmic conundra explained by thermal history and
primordial black holes. Phys Dark Universe 31:100755. https://doi.org/10.1016/j.dark.2020.100755
Castorina E, Carbone C, Bel J, Sefusatti E, Dolag K (2015) DEMNUni: the clustering of large-scale
structures in the presence of massive neutrinos. JCAP 7:043. https://doi.org/10.1088/1475-7516/
2015/07/043. arXiv:1505.07148 [astro-ph.CO]
Castorina E, Hand N, Seljak U, Beutler F, Chuang CH, Zhao C, Gil-Marı´n H, Percival WJ, Ross AJ, Choi
PD, Dawson K, de la Macorra A, Rossi G, Ruggeri R, Schneider D, Zhao GB (2019) Redshift-
weighted constraints on primordial non-Gaussianity from the clustering of the eBOSS DR14 quasars
in Fourier space. JCAP 9:010. https://doi.org/10.1088/1475-7516/2019/09/010. arXiv:1904.08859
[astro-ph.CO]
Catelan P (1995) Lagrangian dynamics in non-ﬂat universes and non-linear gravitational evolution.
MNRAS 276:115–124. https://doi.org/10.1093/mnras/276.1.115. arXiv:astro-ph/9406016
Cautun M, van de Weygaert R, Jones BJT (2013) NEXUS: tracing the cosmic web connection. MNRAS
429(2):1286–1308. https://doi.org/10.1093/mnras/sts416. arXiv:1209.2043 [astro-ph.CO]
Cautun M, Paillas E, Cai YC, Bose S, Armijo J, Li B, Padilla N (2018) The Santiago-Harvard-Edinburgh-
Durham
void
comparison—I.
SHEDding
light
on
chameleon
gravity
tests.
MNRAS
476(3):3195–3217. https://doi.org/10.1093/mnras/sty463. arXiv:1710.01730 [astro-ph.CO]
Cautun MC, van de Weygaert R (2011) The DTFE public software: The Delaunay Tessellation Field
Estimator code. arXiv e-prints arXiv:1105.0370 [astro-ph.IM]
Centrella J, Melott AL (1983) Three-dimensional simulation of large-scale structure in the universe.
Nature 305:196–198. https://doi.org/10.1038/305196a0
Centrella JM, Gallagher JS III, Melott AL, Bushouse HA (1988) A case study of large-scale structure in a
‘hot’ model universe. ApJ 333:24–53. https://doi.org/10.1086/166722
Chan TK, Keresˇ D, On˜orbe J, Hopkins PF, Muratov AL, Faucher-Gigue`re CA, Quataert E (2015) The
impact of baryonic physics on the structure of dark matter haloes: the view from the FIRE
cosmological
simulations. MNRAS 454(3):2981–3001. https://doi.org/10.1093/mnras/stv2165.
arXiv:1507.02282 [astro-ph.GA]
Chan KC, Li Y, Biagetti M, Hamaus N (2020) Measurement of Void Bias Using Separate Universe
Simulations. ApJ 889(2):89. https://doi.org/10.3847/1538-4357/ab64ec. arXiv:1909.03736 [astro-
ph.CO]
Chavanis PH (2011) Mass-radius relation of Newtonian self-gravitating Bose-Einstein condensates with
short-range interactions. I. Analytical results. Phys Rev D 84(4):043531. https://doi.org/10.1103/
PhysRevD.84.043531. arXiv:1103.2050 [astro-ph.CO]
Chavanis PH, Delﬁni L (2011) Mass-radius relation of Newtonian self-gravitating Bose-Einstein
condensates with short-range interactions. II. Numerical results. Phys Rev D 84(4):043532. https://
doi.org/10.1103/PhysRevD.84.043532. arXiv:1103.2054 [astro-ph.CO]
Chaves-Montero J, Hearin A (2020) Surrogate modelling the Baryonic Universe—I. The colour of star
formation. MNRAS 495(2):2088–2104. https://doi.org/10.1093/mnras/staa1230. arXiv:1910.11883
[astro-ph.GA]
Chaves-Montero J, Angulo RE, Schaye J, Schaller M, Crain RA, Furlong M, Theuns T (2016) Subhalo
abundance matching and assembly bias in the EAGLE simulation. MNRAS 460(3):3100–3118.
https://doi.org/10.1093/mnras/stw1225. arXiv:1507.01948 [astro-ph.GA]
Chen L, Bruce Langdon A, Birdsall CK (1974) Reduction of the Grid Effects in Simulation Plasmas.
J Comput Phys 14(2):200–222. https://doi.org/10.1016/0021-9991(74)90014-X
Chen S, Wang H, Mo HJ, Shi J (2016) Alignments of Dark Matter Halos with Large-scale Tidal Fields:
Mass and Redshift Dependence. ApJ 825(1):49. https://doi.org/10.3847/0004-637X/825/1/49. arXiv:
1603.04152 [astro-ph.CO]
Chen SR, Schive HY, Chiueh T (2017) Jeans analysis for dwarf spheroidal galaxies in wave dark matter.
MNRAS 468(2):1338–1348. https://doi.org/10.1093/mnras/stx449. arXiv:1606.09030 [astro-ph.GA]
Chen SF, Castorina E, White M (2019) Biased tracers of two ﬂuids in the Lagrangian picture. JCAP
6:006. https://doi.org/10.1088/1475-7516/2019/06/006. arXiv:1903.00437 [astro-ph.CO]
Chen SF, Lee H, Dvorkin C (2021) Precise and Accurate Cosmology with CMBxLSS Power Spectra and
Bispectra. arXiv e-prints arXiv:2103.01229 [astro-ph.CO]
Chen JZ, Upadhye A, Wong YYY (2021) One line to run them all: SuperEasy massive neutrino linear
response in N-body simulations. JCAP 2021(04):078. https://doi.org/10.1088/1475-7516/2021/04/
078
123
Large-scale dark matter simulations
Page 159 of 200
1

Cheng S, Ting YS, Me´nard B, Bruna J (2020) A new approach to observational cosmology using the
scattering transform. MNRAS 499(4):5902–5914. https://doi.org/10.1093/mnras/staa3165. arXiv:
2006.08561 [astro-ph.CO]
Chernin AD, Nagirner DI, Starikova SV (2003) Growth rate of cosmological perturbations in standard
model: Explicit analytical solution. A&A 399:19–21. https://doi.org/10.1051/0004-6361:20021763.
arXiv:astro-ph/0110107 [astro-ph]
Chiang CT, Cieplak AM, Schmidt F, Slosar A (2017) Response approach to the squeezed-limit
bispectrum: application to the correlation of quasar and Lyman-a forest power spectrum. JCAP
6:022. https://doi.org/10.1088/1475-7516/2017/06/022. arXiv:1701.03375 [astro-ph.CO]
Chiang CT, Hu W, Li Y, LoVerde M (2018) Scale-dependent bias and bispectrum in neutrino separate
universe simulations. Phys Rev D 97(12):123526. https://doi.org/10.1103/PhysRevD.97.123526.
arXiv:1710.01310 [astro-ph.CO]
Chiang CT, LoVerde M, Villaescusa-Navarro F (2019) First Detection of Scale-Dependent Linear Halo
Bias in N -Body Simulations with Massive Neutrinos. Phys Rev Lett 122(4):041302. https://doi.org/
10.1103/PhysRevLett.122.041302. arXiv:1811.12412 [astro-ph.CO]
Chin SA, Chen CR (2001) Fourth order gradient symplectic integrator methods for solving the time-
dependent Schro¨dinger equation. J Chem Phys 114:7338–7341. https://doi.org/10.1063/1.1362288.
arXiv:physics/0012017
Chisari NE, Zaldarriaga M (2011) Connection between Newtonian simulations and general relativity.
Phys Rev D 83(12):123505. https://doi.org/10.1103/PhysRevD.83.123505. arXiv:1101.3555 [astro-
ph.CO]
Chisari NE, Mead AJ, Joudaki S, Ferreira P, Schneider A, Mohr J, Tro¨ster T, Alonso D, McCarthy IG,
Martin-Alvarez S, Devriendt J, Slyz A, van Daalen MP (2019) Modelling baryonic feedback for
survey cosmology. arXiv e-prints arXiv:1905.06082
Choquet-Bruhat Y (1971) Proble`me de cauchy pour le syste`me inte´gro-diffe´rentiel d’Einstein-liouville.
Ann Inst Fourier 21(3):181–201. https://doi.org/10.5802/aif.385. http://www.numdam.org/articles/
10.5802/aif.385/
Choquet-Bruhat Y (2015) Introduction to General Relativity, Black Holes, and Cosmology. Oxford
University Press, Oxford
Choquette J, Cline JM, Cornell JM (2019) Early formation of supermassive black holes via dark matter
self-interactions. JCAP 7:036. https://doi.org/10.1088/1475-7516/2019/07/036. arXiv:1812.05088
[astro-ph.CO]
Chuang CH, Kitaura FS, Prada F, Zhao C, Yepes G (2015a) EZmocks: extending the Zel’dovich
approximation to generate mock galaxy catalogues with accurate clustering statistics. MNRAS
446(3):2621–2628. https://doi.org/10.1093/mnras/stu2301. arXiv:1409.1124 [astro-ph.CO]
Chuang CH, Zhao C, Prada F, Munari E, Avila S, Izard A, Kitaura FS, Manera M, Monaco P, Murray S,
Knebe A, Sco´ccola CG, Yepes G, Garcia-Bellido J, Marı´n FA, Mu¨ller V, Skibba R, Crocce M,
Fosalba P, Gottlo¨ber S, Klypin AA, Power C, Tao C, Turchaninov V (2015b) nIFTy cosmology:
Galaxy/halo mock catalogue comparison project on clustering statistics. MNRAS 452(1):686–700.
https://doi.org/10.1093/mnras/stv1289. arXiv:1412.7729 [astro-ph.CO]
Chuang CH, Yepes G, Kitaura FS, Pellejero-Iban˜ez M, Rodrı´guez-Torres S, Feng Y, Metcalf RB,
Wechsler RH, Zhao C, To CH, Alam S, Banerjee A, DeRose J, Giocoli C, Knebe A, Reyes G (2019)
UNIT project: Universe N-body simulations for the Investigation of Theoretical models from galaxy
surveys. MNRAS 487(1):48–59. https://doi.org/10.1093/mnras/stz1233. arXiv:1811.02111 [astro-
ph.CO]
Clark HA, Lewis GF, Scott P (2016) Investigating dark matter substructure with pulsar timing—I.
Constraints on ultracompact minihaloes. MNRAS 456(2):1394–1401. https://doi.org/10.1093/
mnras/stv2743. arXiv:1509.02938 [astro-ph.CO]
Clifton T, Ferreira PG, Padilla A, Skordis C (2012) Modiﬁed gravity and cosmology. Phys Rep
513(1):1–189. https://doi.org/10.1016/j.physrep.2012.01.001. arXiv:1106.2476 [astro-ph.CO]
Coates L, Adamek J, Bull P, Guandalin C, Clarkson C (2021) Observing relativistic features in large-scale
structure surveys—II. Doppler magniﬁcation in an ensemble of relativistic simulations. MNRAS
504(3):3534–3543. https://doi.org/10.1093/mnras/stab1076. arXiv:2011.12936 [astro-ph.CO]
Codis S, Pichon C, Devriendt J, Slyz A, Pogosyan D, Dubois Y, Sousbie T (2012) Connecting the cosmic
web to the spin of dark haloes: implications for galaxy formation. MNRAS 427(4):3320–3336.
https://doi.org/10.1111/j.1365-2966.2012.21636.x. arXiv:1201.5794 [astro-ph.CO]
Colavincenzo M, Sefusatti E, Monaco P, Blot L, Crocce M, Lippich M, Sa´nchez AG, Alvarez MA,
Agrawal A, Avila S, Balaguera-Antolı´nez A, Bond R, Codis S, Dalla Vecchia C, Dorta A, Fosalba P,
123
1
Page 160 of 200
R. E. Angulo, O. Hahn

Izard A, Kitaura FS, Pellejero-Iban˜ez M, Stein G, Vakili M, Yepes G (2019) Comparing
approximate methods for mock catalogues and covariance matrices–III: bispectrum. MNRAS
482(4):4883–4905. https://doi.org/10.1093/mnras/sty2964. arXiv:1806.09499 [astro-ph.CO]
Colberg JM, Pearce F, Foster C, Platen E, Brunino R, Neyrinck M, Basilakos S, Fairall A, Feldman H,
Gottlo¨ber S, Hahn O, Hoyle F, Mu¨ller V, Nelson L, Plionis M, Porciani C, Shandarin S, Vogeley
MS, van de Weygaert R (2008) The Aspen-Amsterdam void ﬁnder comparison project. MNRAS
387(2):933–944. https://doi.org/10.1111/j.1365-2966.2008.13307.x. arXiv:0803.0918 [astro-ph]
Cole S, Aragon-Salamanca A, Frenk CS, Navarro JF, Zepf SE (1994) A recipe for galaxy formation.
MNRAS 271:781–806. https://doi.org/10.1093/mnras/271.4.781. arXiv:astro-ph/9402001 [astro-ph]
Cole S, Lacey CG, Baugh CM, Frenk CS (2000) Hierarchical galaxy formation. MNRAS
319(1):168–204. https://doi.org/10.1046/j.1365-8711.2000.03879.x. arXiv:astro-ph/0007281 [astro-
ph]
Coles JP, Bieri R (2020) An optimizing symbolic algebra approach for generating fast multipole method
operators. Comput Phys Commun 251:107081. https://doi.org/10.1016/j.cpc.2019.107081. arXiv:
1811.06332 [physics.comp-ph]
Coles P, Jones B (1991) A lognormal model for the cosmological mass distribution. MNRAS 248:1–13.
https://doi.org/10.1093/mnras/248.1.1
Colı´n P, Valenzuela O, Avila-Reese V (2008) On the Structure of Dark Matter Halos at the Damping
Scale of the Power Spectrum with and without Relict Velocities. ApJ 673(1):203–214. https://doi.
org/10.1086/524030. arXiv:0709.4027 [astro-ph]
Colombi S (2021) Phase-space structure of protohalos: Vlasov versus particle-mesh. A&A 647:A66.
https://doi.org/10.1051/0004-6361/202039719. arXiv:2012.04409 [astro-ph.CO]
Colombi S, Alard C (2017) A ‘metric’ semi-Lagrangian Vlasov-Poisson solver. J Plasma Phys
83(3):705830302. https://doi.org/10.1017/S0022377817000393. arXiv:1705.03750
Colombi S, Touma J (2008) Vlasov Poisson: The waterbag method revisited. Commun Nonlinear Sci
Numer Simulations 13(1):46–52. https://doi.org/10.1016/j.cnsns.2007.03.012
Colombi S, Touma J (2014) Vlasov-Poisson in 1D: waterbags. MNRAS 441:2414–2432. https://doi.org/
10.1093/mnras/stu739
Colombi S, Jaffe A, Novikov D, Pichon C (2009) Accurate estimators of power spectra in N-body
simulations. MNRAS 393(2):511–526. https://doi.org/10.1111/j.1365-2966.2008.14176.x. arXiv:
0811.0313 [astro-ph]
Conroy C, Wechsler RH, Kravtsov AV (2006) Modeling Luminosity-dependent Galaxy Clustering
through Cosmic Time. ApJ 647(1):201–214. https://doi.org/10.1086/503602. arXiv:astro-ph/
0512234 [astro-ph]
Contreras S, Angulo R, Zennaro M (2020a) A ﬂexible modelling of galaxy assembly bias. arXiv e-prints
arXiv:2005.03672 [astro-ph.GA]
Contreras S, Angulo R, Zennaro M (2020b) A ﬂexible subhalo abundance matching model for galaxy
clustering in redshift space. arXiv e-prints arXiv:2012.06596 [astro-ph.CO]
Contreras S, Angulo RE, Zennaro M, Arico` G, Pellejero-Iban˜ez M (2020) 3 per cent-accurate predictions
for the clustering of dark matter, haloes, and subhaloes, over a wide range of cosmologies and
scales. MNRAS 499(4):4905–4917. https://doi.org/10.1093/mnras/staa3117. arXiv:2001.03176
[astro-ph.CO]
Cora SA, Vega-Martı´nez CA, Hough T, Ruiz AN, Orsi A´ A, Mun˜oz Arancibia AM, Gargiulo ID,
Collacchioni F, Padilla ND, Gottlo¨ber S, Yepes G (2018) Semi-analytic galaxies—I. Synthesis of
environmental and star-forming regulation mechanisms. MNRAS 479(1):2–24. https://doi.org/10.
1093/mnras/sty1131. arXiv:1801.03883 [astro-ph.GA]
Crain RA, Schaye J, Bower RG, Furlong M, Schaller M, Theuns T, Dalla Vecchia C, Frenk CS,
McCarthy IG, Helly JC, Jenkins A, Rosas-Guevara YM, White SDM, Trayford JW (2015) The
EAGLE simulations of galaxy formation: calibration of subgrid physics and model variations.
MNRAS 450(2):1937–1961. https://doi.org/10.1093/mnras/stv725. arXiv:1501.01311 [astro-ph.GA]
Creminelli P (2003) On non-Gaussianities in single-ﬁeld inﬂation. JCAP 2003(10):003. https://doi.org/10.
1088/1475-7516/2003/10/003. arXiv:astro-ph/0306122 [astro-ph]
Creminelli P, Vernizzi F (2017) Dark Energy after GW170817 and GRB170817A. Phys Rev Lett
119(25):251302. https://doi.org/10.1103/PhysRevLett.119.251302. arXiv:1710.05877 [astro-ph.CO]
Creminelli P, Senatore L, Zaldarriaga M (2007) Estimators for local non-Gaussianities. JCAP 3:019.
https://doi.org/10.1088/1475-7516/2007/03/019. arXiv:astro-ph/0606001
Crocce M, Scoccimarro R (2006) Memory of initial conditions in gravitational clustering. Phys Rev D
73(6):063520. https://doi.org/10.1103/PhysRevD.73.063520. arXiv:astro-ph/0509419 [astro-ph]
123
Large-scale dark matter simulations
Page 161 of 200
1

Crocce M, Pueblas S, Scoccimarro R (2006) Transients from initial conditions in cosmological
simulations. MNRAS 373:369–381. https://doi.org/10.1111/j.1365-2966.2006.11040.x. arXiv:astro-
ph/0606505
Crocce M, Fosalba P, Castander FJ, Gaztan˜aga E (2010) Simulating the Universe with MICE: the
abundance of massive clusters. MNRAS 403(3):1353–1367. https://doi.org/10.1111/j.1365-2966.
2009.16194.x. arXiv:0907.0019 [astro-ph.CO]
Croton DJ, Stevens ARH, Tonini C, Garel T, Bernyk M, Bibiano A, Hodkinson L, Mutch SJ, Poole GB,
Shattow GM (2016) Semi-Analytic Galaxy Evolution (SAGE): Model Calibration and Basic
Results. ApJS 222(2):22. https://doi.org/10.3847/0067-0049/222/2/22. arXiv:1601.04709 [astro-
ph.GA]
Cui W, Liu L, Yang X, Wang Y, Feng L, Springel V (2008) An Ideal Mass Assignment Scheme for
Measuring the Power Spectrum with Fast Fourier Transforms. ApJ 687(2):738–744. https://doi.org/
10.1086/592079. arXiv:0804.0070 [astro-ph]
Cui W, Zhang P, Yang X (2010) Nonlinearities in modiﬁed gravity cosmology: Signatures of modiﬁed
gravity in the nonlinear matter power spectrum. Phys Rev D 81(10):103528. https://doi.org/10.1103/
PhysRevD.81.103528. arXiv:1001.5184 [astro-ph.CO]
Cyr-Racine FY, de Putter R, Raccanelli A, Sigurdson K (2014) Constraints on large-scale dark acoustic
oscillations from cosmology. Phys Rev D 89(6):063517. https://doi.org/10.1103/PhysRevD.89.
063517. arXiv:1310.3278 [astro-ph.CO]
Cyr-Racine FY, Sigurdson K, Zavala J, Bringmann T, Vogelsberger M, Pfrommer C (2016) ETHOS–an
effective theory of structure formation: From dark particle physics to the matter distribution of the
Universe. Phys Rev D 93(12):123527. https://doi.org/10.1103/PhysRevD.93.123527. arXiv:1512.
05344 [astro-ph.CO]
Dai B, Seljak U (2020) Learning effective physical laws for generating cosmological hydrodynamics with
Lagrangian Deep Learning. arXiv e-prints arXiv:2010.02926 [astro-ph.CO]
Dai B, Feng Y, Seljak U (2018) A gradient based method for modeling baryons and matter in halos of fast
simulations. JCAP 11:009. https://doi.org/10.1088/1475-7516/2018/11/009. arXiv:1804.00671
Dakin J, Brandbyge J, Hannestad S, Haugbølle T, Tram T (2019a) mCONCEPT: cosmological neutrino
simulations from the non-linear Boltzmann hierarchy. JCAP 2:052. https://doi.org/10.1088/1475-
7516/2019/02/052. arXiv:1712.03944 [astro-ph.CO]
Dakin J, Hannestad S, Tram T (2019b) Fully relativistic treatment of decaying cold dark matter in N-body
simulations. JCAP 6:032. https://doi.org/10.1088/1475-7516/2019/06/032. arXiv:1904.11773 [astro-
ph.CO]
Dalal N, Dore´ O, Huterer D, Shirokov A (2008) Imprints of primordial non-Gaussianities on large-scale
structure: Scale-dependent bias and abundance of virialized objects. Phys Rev D 77(12):123514.
https://doi.org/10.1103/PhysRevD.77.123514. arXiv:0710.4560 [astro-ph]
Dalal N, Lithwick Y, Kuhlen M (2010a) The Origin of Dark Matter Halo Proﬁles. arXiv e-prints arXiv:
1010.2539 [astro-ph.CO]
Dalal N, Pen UL, Seljak U (2010b) Large-scale BAO signatures of the smallest galaxies. JCAP 11:007.
https://doi.org/10.1088/1475-7516/2010/11/007. arXiv:1009.4704 [astro-ph.CO]
Dave´ R, Angle´s-Alca´zar D, Narayanan D, Li Q, Raﬁeferantsoa MH, Appleby S (2019) SIMBA:
Cosmological simulations with black hole growth and feedback. MNRAS 486(2):2827–2849.
https://doi.org/10.1093/mnras/stz937. arXiv:1901.10203 [astro-ph.GA]
Daverio D, Dirian Y, Mitsou E (2019) General relativistic cosmological N-body simulations. Part I. Time
integration. JCAP 10:065. https://doi.org/10.1088/1475-7516/2019/10/065. arXiv:1904.07841 [as-
tro-ph.CO]
Davis M, Efstathiou G, Frenk CS, White SDM (1985) The evolution of large-scale structure in a universe
dominated by cold dark matter. ApJ 292:371–394. https://doi.org/10.1086/163168
De Lucia G, Boylan-Kolchin M, Benson AJ, Fontanot F, Monaco P (2010) A semi-analytic model
comparison—gas cooling and galaxy mergers. MNRAS 406(3):1533–1552. https://doi.org/10.1111/
j.1365-2966.2010.16806.x. arXiv:1003.3021 [astro-ph.CO]
De Martino I, Broadhurst T, Tye SHH, Chiueh T, Schive HY, Lazkoz R (2017) Recognising Axionic
Dark Matter by Compton and de-Broglie Scale Modulation of Pulsar Timing. Phys Rev Lett
119:221103. https://doi.org/10.1103/PhysRevLett.119.221103. arXiv:1705.04367 [astro-ph.CO]
De Martino I, Broadhurst T, Henry Tye SH, Chiueh T, Schive HY (2020) Dynamical evidence of a dark
solitonic core of 109M in the Milky Way. Phys Dark Universe 28:100503. https://doi.org/10.1016/
j.dark.2020.100503. arXiv:1807.08153 [astro-ph.GA]
123
1
Page 162 of 200
R. E. Angulo, O. Hahn

Debackere SNB, Schaye J, Hoekstra H (2019) The impact of the observed baryon distribution in haloes
on the total matter power spectrum. arXiv e-prints arXiv:1908.05765
Dehnen W (2000) A Very Fast and Momentum-conserving Tree Code. ApJ 536(1):L39–L42. https://doi.
org/10.1086/312724. arXiv:astro-ph/0003209 [astro-ph]
Dehnen W (2002) A Hierarchical O (N) Force Calculation Algorithm. J Comput Phys 179(1):27–42.
https://doi.org/10.1006/jcph.2002.7026. arXiv:astro-ph/0202512 [astro-ph]
Dehnen W (2014) A fast multipole method for stellar dynamics. Comput Astrophys Cosmol 1:1. https://
doi.org/10.1186/s40668-014-0001-7. arXiv:1405.2255 [astro-ph.IM]
Dehnen W, Read JI (2011) N-body simulations of gravitational dynamics. EPJ Plus 126:55. https://doi.
org/10.1140/epjp/i2011-11055-3. arXiv:1105.1082 [astro-ph.IM]
Delﬁno FM, Scoccola CG, Cora SA, Vega-Martinez CA, Gargiulo ID (2021) Orphan galaxies in semi-
analytic models. arXiv e-prints arXiv:2102.01837 [astro-ph.CO]
Delos MS (2019) Evolution of dark matter microhalos through stellar encounters. Phys Rev D
100(8):083529. https://doi.org/10.1103/PhysRevD.100.083529. arXiv:1907.13133 [astro-ph.CO]
Delos MS, Erickcek AL, Bailey AP, Alvarez MA (2018a) Are ultracompact minihalos really
ultracompact? Phys Rev D 97(4):041303. https://doi.org/10.1103/PhysRevD.97.041303. arXiv:
1712.05421 [astro-ph.CO]
Delos MS, Erickcek AL, Bailey AP, Alvarez MA (2018b) Density proﬁles of ultracompact minihalos:
Implications for constraining the primordial power spectrum. Phys Rev D 98(6):063527. https://doi.
org/10.1103/PhysRevD.98.063527. arXiv:1806.07389 [astro-ph.CO]
Delos MS, Bruff M, Erickcek AL (2019) Predicting the density proﬁles of the ﬁrst halos. Phys Rev D
100(2):023523. https://doi.org/10.1103/PhysRevD.100.023523. arXiv:1905.05766 [astro-ph.CO]
Demianski M, Golda ZA, Woszczyna A (2005) Evolution of density perturbations in a realistic universe.
Gen Relativ Gravit 37(12):2063–2082. https://doi.org/10.1007/s10714-005-0180-2. arXiv:gr-qc/
0504089 [gr-qc]
DeRose J, Wechsler RH, Tinker JL, Becker MR, Mao YY, McClintock T, McLaughlin S, Rozo E, Zhai Z
(2019) The AEMULUS Project. I. Numerical Simulations for Precision Cosmology. ApJ 875(1):69.
https://doi.org/10.3847/1538-4357/ab1085. arXiv:1804.05865 [astro-ph.CO]
DES Collaboration, Abbott TMC, Aguena M, Alarcon A et al (2021) Dark Energy Survey Year 3 Results:
Cosmological Constraints from Galaxy Clustering and Weak Lensing. arXiv e-prints arXiv:2105.
13549 [astro-ph.CO]
DESI Collaboration, Aghamousa A, Aguilar J, Ahlen S et al (2016) The DESI Experiment Part I:
Science,Targeting, and Survey Design. arXiv e-prints arXiv:1611.00036 [astro-ph.IM]
Desjacques V, Nusser A (2019) Axion core-halo mass and the black hole-halo mass relation: constraints
on a few parsec scales. MNRAS 488(4):4497–4503. https://doi.org/10.1093/mnras/stz1978. arXiv:
1905.03450 [astro-ph.CO]
Desjacques V, Seljak U (2010) Signature of primordial non-Gaussianity of /3 type in the mass function
and bias of dark matter haloes. Phys Rev D 81(2):023006. https://doi.org/10.1103/PhysRevD.81.
023006. arXiv:0907.2257 [astro-ph.CO]
Desjacques V, Seljak U, Iliev IT (2009) Scale-dependent bias induced by local non-Gaussianity: a
comparison to N-body simulations. MNRAS 396(1):85–96. https://doi.org/10.1111/j.1365-2966.
2009.14721.x. arXiv:0811.2748 [astro-ph]
Desjacques V, Jeong D, Schmidt F (2018) Large-scale galaxy bias. Phys Rep 733:1–193. https://doi.org/
10.1016/j.physrep.2017.12.002. arXiv:1611.09787 [astro-ph.CO]
Despali G, Tormen G, Sheth RK (2013) Ellipsoidal halo ﬁnders and implications for models of triaxial
halo formation. MNRAS 431(2):1143–1159. https://doi.org/10.1093/mnras/stt235. arXiv:1212.4157
[astro-ph.CO]
Despali G, Giocoli C, Angulo RE, Tormen G, Sheth RK, Baso G, Moscardini L (2016) The universality
of the virial halo mass function and models for non-universality of other halo deﬁnitions. MNRAS
456(3):2486–2504. https://doi.org/10.1093/mnras/stv2842. arXiv:1507.05627 [astro-ph.CO]
Dı´az Rivero A, Dvorkin C, Cyr-Racine FY, Zavala J, Vogelsberger M (2018) Gravitational lensing and
the power spectrum of dark matter substructure: Insights from the ETHOS N -body simulations.
Phys Rev D 98(10):103517. https://doi.org/10.1103/PhysRevD.98.103517. arXiv:1809.00004 [astro-
ph.CO]
Diemand J, Moore B, Stadel J (2004a) Velocity and spatial biases in cold dark matter subhalo
distributions. MNRAS 352(2):535–546. https://doi.org/10.1111/j.1365-2966.2004.07940.x. arXiv:
astro-ph/0402160 [astro-ph]
123
Large-scale dark matter simulations
Page 163 of 200
1

Diemand J, Moore B, Stadel J, Kazantzidis S (2004b) Two-body relaxation in cold dark matter
simulations. MNRAS 348(3):977–986. https://doi.org/10.1111/j.1365-2966.2004.07424.x. arXiv:
astro-ph/0304549 [astro-ph]
Diemand J, Moore B, Stadel J (2005) Earth-mass dark-matter haloes as the ﬁrst structures in the early
Universe. Nature 433(7024):389–391. https://doi.org/10.1038/nature03270. arXiv:astro-ph/0501589
[astro-ph]
Diemand J, Kuhlen M, Madau P (2006) Early Supersymmetric Cold Dark Matter Substructure. ApJ
649(1):1–13. https://doi.org/10.1086/506377. arXiv:astro-ph/0603250 [astro-ph]
Diemer B (2020) Universal at Last? The Splashback Mass Function of Dark Matter Halos. ApJ 903(2):87.
https://doi.org/10.3847/1538-4357/abbf52. arXiv:2007.10346 [astro-ph.CO]
Diemer B, Kravtsov AV (2014) Dependence of the Outer Density Proﬁles of Halos on Their Mass
Accretion Rate. ApJ 789(1):1. https://doi.org/10.1088/0004-637X/789/1/1. arXiv:1401.1216 [astro-
ph.CO]
Diemer B, More S, Kravtsov AV (2013) The Pseudo-evolution of Halo Mass. ApJ 766(1):25. https://doi.
org/10.1088/0004-637X/766/1/25. arXiv:1207.0816 [astro-ph.CO]
Doro M, Conrad J, Emmanoulopoulos D, Sa`nchez-Conde MA, Barrio JA, Birsin E, Bolmont J, Brun P,
Colafrancesco S, Connell SH, Contreras JL, Daniel MK, Fornasa M, Gaug M, Glicenstein JF,
Gonza´lez-Mun˜oz A, Hassan T, Horns D, Jacholkowska A, Jahn C, Mazini R, Mirabal N, Moralejo
A, Moulin E, Nieto D, Ripken J, Sandaker H, Schwanke U, Spengler G, Stamerra A, Viana A,
Zechlin HS, Zimmer S, CTA Consortium (2013) Dark matter and fundamental physics with the
Cherenkov
Telescope
Array.
Astroparticle
Physics
43:189–214.
https://doi.org/10.1016/j.
astropartphys.2012.08.002. arXiv:1208.5356 [astro-ph.IM]
Doroshkevich AG, Ryaben’kii VS, Shandarin SF (1973) Nonlinear theory of the development of potential
perturbations. Astrophysics 9:144–153. https://doi.org/10.1007/BF01011421
Doroshkevich AG, Kotok EV, Poliudov AN, Shandarin SF, Sigov IS, Novikov ID (1980) Two-
dimensional simulation of the gravitational system dynamics and formation of the large-scale
structure of the universe. MNRAS 192:321–337. https://doi.org/10.1093/mnras/192.2.321
Doumler T, Gottlo¨ber S, Hoffman Y, Courtois H (2013a) Reconstructing cosmological initial conditions
from galaxy peculiar velocities—III. Constrained simulations. MNRAS 430(2):912–923. https://doi.
org/10.1093/mnras/sts614. arXiv:1212.2810 [astro-ph.CO]
Doumler T, Hoffman Y, Courtois H, Gottlo¨ber S (2013b) Reconstructing cosmological initial conditions
from galaxy peculiar velocities—I. Reverse Zeldovich Approximation. MNRAS 430(2):888–901.
https://doi.org/10.1093/mnras/sts613. arXiv:1212.2806 [astro-ph.CO]
Dubois Y, Pichon C, Welker C, Le Borgne D, Devriendt J, Laigle C, Codis S, Pogosyan D, Arnouts S,
Benabed K, Bertin E, Blaizot J, Bouchet F, Cardoso JF, Colombi S, de Lapparent V, Desjacques V,
Gavazzi R, Kassin S, Kimm T, McCracken H, Milliard B, Peirani S, Prunet S, Rouberol S, Silk J,
Slyz A, Sousbie T, Teyssier R, Tresse L, Treyer M, Vibert D, Volonteri M (2014) Dancing in the
dark: galactic properties trace spin swings along the cosmic web. MNRAS 444:1453–1468. https://
doi.org/10.1093/mnras/stu1227. arXiv:1402.1165
Duffy LD, van Bibber K (2009) Axions as dark matter particles. New J Phys 11(10):105008. https://doi.
org/10.1088/1367-2630/11/10/105008. arXiv:0904.3346 [hep-ph]
Dupuy H, Bernardeau F (2014) Describing massive neutrinos in cosmology as a collection of independent
ﬂows. JCAP 1:030. https://doi.org/10.1088/1475-7516/2014/01/030. arXiv:1311.5487
Dvali G, Gabadadze G, Porrati M (2000) 4D gravity on a brane in 5D Minkowski space. Phys Lett B
485(1–3):208–214. https://doi.org/10.1016/S0370-2693(00)00669-9. arXiv:hep-th/0005016 [hep-th]
Earn DJD, Tremaine S (1992) Exact numerical studies of Hamiltonian maps: Iterating without roundoff
error. Physica D 56(1):1–22. https://doi.org/10.1016/0167-2789(92)90047-Q
East WE, Wojtak R, Abel T (2018) Comparing fully general relativistic and Newtonian calculations of
structure formation. Phys Rev D 97(4):043509. https://doi.org/10.1103/PhysRevD.97.043509.
arXiv:1711.06681 [astro-ph.CO]
Eberhardt A, Banerjee A, Kopp M, Abel T (2020) Investigating the use of ﬁeld solvers for simulating
classical systems. Phys Rev D 101(4):043011. https://doi.org/10.1103/PhysRevD.101.043011.
arXiv:2001.05791 [physics.comp-ph]
Edwards F, Kendall E, Hotchkiss S, Easther R (2018) PyUltraLight: a pseudo-spectral solver for ultralight
dark matter dynamics. JCAP 10:027. https://doi.org/10.1088/1475-7516/2018/10/027. arXiv:1807.
04037 [astro-ph.CO]
123
1
Page 164 of 200
R. E. Angulo, O. Hahn

Eggemeier A, Scoccimarro R, Smith RE, Crocce M, Pezzotta A, Sa´nchez AG (2021) Testing one-loop
galaxy bias: joint analysis of power spectrum and bispectrum. arXiv e-prints arXiv:2102.06902
[astro-ph.CO]
Eggemeier B, Redondo J, Dolag K, Niemeyer JC, Vaquero A (2020) First Simulations of Axion
Minicluster Halos. Phys Rev Lett 125(4):041301. https://doi.org/10.1103/PhysRevLett.125.041301.
arXiv:1911.09417 [astro-ph.CO]
Ehlers J (1971) Proble`me de Cauchy pour le syste`me inte´gro-diffe´rentiel d’Einstein-Liouville. (Cauchy
problem for the Einstein-Liouville integro-differential system). In: General Relativity and
Cosmology. vol 21. Universite´ Joseph Fourier, Grenoble; Association des Annales de l’Institut
Fourier, Saint-Martin d’He`res
Eisenstein DJ, Hut P (1998) HOP: A New Group-Finding Algorithm for N-Body Simulations. ApJ
498(1):137–142. https://doi.org/10.1086/305535. arXiv:astro-ph/9712200 [astro-ph]
El Zant AA (2013) Dark Halos and Elliptical Galaxies as Marginally Stable Dynamical Systems. ApJ
779(1):64. https://doi.org/10.1088/0004-637X/779/1/64. arXiv:1311.0129 [astro-ph.GA]
El-Zant AA, Everitt MJ, Kassem SM (2019) Errors, chaos, and the collisionless limit. MNRAS
484(2):1456–1474. https://doi.org/10.1093/mnras/stz029. arXiv:1804.06920 [astro-ph.IM]
Elahi PJ, Can˜as R, Poulton RJJ, Tobar RJ, Willis JS, Lagos CdP, Power C, Robotham ASG (2019)
Hunting for Galaxies and Halos in simulations with VELOCIraptor. PASA 36:E021. https://doi.org/
10.1017/pasa.2019.12
Elbers W, Frenk CS, Jenkins A, Li B, Pascoli S (2021) An optimal non-linear method for simulating relic
neutrinos. MNRAS 507(2):2614–2631. https://doi.org/10.1093/mnras/stab2260. arXiv:2010.07321
[astro-ph.CO]
Ellis GFR, Buchert T (2005) The universe seen at different scales [rapid communication]. Phys Lett A
347:38–46. https://doi.org/10.1016/j.physleta.2005.06.087. arXiv:gr-qc/0506106 [gr-qc]
Emberson JD, Yu HR, Inman D, Zhang TJ, Pen UL, Harnois-De´raps J, Yuan S, Teng HY, Zhu HM, Chen
X, Xing ZZ (2017) Cosmological neutrino simulations at extreme scale. Res Astron Astrophys
17(8):085. https://doi.org/10.1088/1674-4527/17/8/85. arXiv:1611.01545 [astro-ph.CO]
Enzi W, Murgia R, Newton O, Vegetti S, Frenk C, Viel M, Cautun M, Fassnacht CD, Auger M, Despali
G, McKean J, Koopmans LVE, Lovell M (2021) Joint constraints on thermal relic dark matter from
a selection of astrophysical probes. MNRAS 506:5848–5862. https://doi.org/10.1093/mnras/
stab1960
Essig R, McDermott SD, Yu HB, Zhong YM (2019) Constraining Dissipative Dark Matter Self-
Interactions. Phys Rev Lett 123(12):121102. https://doi.org/10.1103/PhysRevLett.123.121102.
arXiv:1809.01144 [hep-ph]
Euclid Collaboration, Knabenhans M, Stadel J, Marelli S, Potter D, Teyssier R, Legrand L, Schneider A,
Sudret B, Blot L, Awan S, Burigana C, Carvalho CS, Kurki-Suonio H, Sirri G (2019) Euclid
preparation: II. The EUCLIDEMULATOR—a tool to compute the cosmology dependence of the
nonlinear matter power spectrum. MNRAS 484(4):5509–5529. https://doi.org/10.1093/mnras/
stz197. arXiv:1809.04695 [astro-ph.CO]
Euclid Collaboration, Knabenhans M, Stadel J, Potter D et al (2021) Euclid preparation: IX.
EuclidEmulator2—power spectrum emulation with massive neutrinos and self-consistent dark
energy perturbations. MNRAS 505(2):2840–2869. https://doi.org/10.1093/mnras/stab1366. arXiv:
2010.11288 [astro-ph.CO]
Evrard AE, MacFarland TJ, Couchman HMP, Colberg JM, Yoshida N, White SDM, Jenkins A, Frenk CS,
Pearce FR, Peacock JA, Thomas PA (2002) Galaxy Clusters in Hubble Volume Simulations:
Cosmological Constraints from Sky Survey Populations. ApJ 573(1):7–36. https://doi.org/10.1086/
340551. arXiv:astro-ph/0110246 [astro-ph]
Ewald PP (1921) Die Berechnung optischer und elektrostatischer Gitterpotentiale. Annalen der Physik
369(3):253–287. https://doi.org/10.1002/andp.19213690304
Ezquiaga JM, Zumalaca´rregui M (2017) Dark Energy After GW170817: Dead Ends and the Road Ahead.
Phys Rev Lett 119(25):251304. https://doi.org/10.1103/PhysRevLett.119.251304. arXiv:1710.05901
[astro-ph.CO]
Fairbairn M, Marsh DJE, Quevillon J, Rozier S (2018) Structure formation and microlensing with axion
miniclusters. Phys Rev D 97(8):083502. https://doi.org/10.1103/PhysRevD.97.083502. arXiv:1707.
03310 [astro-ph.CO]
Falck B, McCullagh N, Neyrinck MC, Wang J, Szalay AS (2017) The Effect of Corner Modes in the
Initial Conditions of Cosmological Simulations. ApJ 837(2):181. https://doi.org/10.3847/1538-4357/
aa60c7. arXiv:1610.04862 [astro-ph.CO]
123
Large-scale dark matter simulations
Page 165 of 200
1

Falck B, Wang J, Jenkins A, Lemson G, Medvedev D, Neyrinck MC, Szalay AS (2021) Indra: a Public
Computationally-Accessible Suite of Cosmological N-body Simulations. arXiv e-prints arXiv:2101.
03631 [astro-ph.CO]
Falck BL, Neyrinck MC, Szalay AS (2012) ORIGAMI: Delineating Halos Using Phase-space Folds. ApJ
754(2):126. https://doi.org/10.1088/0004-637X/754/2/126. arXiv:1201.2353 [astro-ph.CO]
Fang W, Li B, Zhao GB (2017) New Probe of Departures from General Relativity Using Minkowski
Functionals. Phys Rev Lett 118(18):181301. https://doi.org/10.1103/PhysRevLett.118.181301.
arXiv:1704.02325 [astro-ph.CO]
Favole G, Comparat J, Prada F, Yepes G, Jullo E, Niemiec A, Kneib JP, Rodrı´guez-Torres SA, Klypin A,
Skibba RA, McBride CK, Eisenstein DJ, Schlegel DJ, Nuza SE, Chuang CH, Delubac T, Ye`che C,
Schneider
DP
(2016)
Clustering
properties
of
g-selected
galaxies
at
z 	 0:8.
MNRAS
461(4):3421–3431. https://doi.org/10.1093/mnras/stw1483. arXiv:1507.04356 [astro-ph.CO]
Favole G, Rodrı´guez-Torres SA, Comparat J, Prada F, Guo H, Klypin A, Montero-Dorta AD (2017)
Galaxy clustering dependence on the [O II] emission line luminosity in the local Universe. MNRAS
472(1):550–558. https://doi.org/10.1093/mnras/stx1980. arXiv:1611.05457 [astro-ph.GA]
Favole G, Montero-Dorta AD, Artale MC, Contreras S, Zehavi I, Xu X (2022) Subhalo abundance
matching through the lens of a hydrodynamical simulation. MNRAS 509:1614–1625. https://doi.
org/10.1093/mnras/stab3006ar. arXiv:2101.10733 [astro-ph.GA]
Fedeli C (2014) The clustering of baryonic matter. I: a halo-model approach. JCAP 4:028. https://doi.org/
10.1088/1475-7516/2014/04/028. arXiv:1401.2997
Feder RM, Berger P, Stein G (2020) Nonlinear 3D cosmic web simulation with heavy-tailed generative
adversarial networks. Phys Rev D 102(10):103504. https://doi.org/10.1103/PhysRevD.102.103504.
arXiv:2005.03050 [astro-ph.CO]
Feng Y, Chu MY, Seljak U, McDonald P (2016) FASTPM: a new scheme for fast simulations of dark
matter and haloes. MNRAS 463(3):2273–2286. https://doi.org/10.1093/mnras/stw2123. arXiv:1603.
00476 [astro-ph.CO]
Ferraro S, Smith KM (2015) Using large scale structure to measure fNL, gNL and sNL. Phys Rev D
91(4):043506. https://doi.org/10.1103/PhysRevD.91.043506. arXiv:1408.3126 [astro-ph.CO]
Ferreira EGM (2021) Ultra-light dark matter. A&A Rev 29(1):7. https://doi.org/10.1007/s00159-021-
00135-6
Ferrell R, Bertschinger E (1994) Particle-Mesh Methods on the Connection Machine. Int J Mod Phys C
5(6):933–956. https://doi.org/10.1142/S0129183194001069. arXiv:comp-gas/9310002 [nlin.CG]
Fidler C, Rampf C, Tram T, Crittenden R, Koyama K, Wands D (2015) General relativistic corrections to
N-body simulations and the Zel’dovich approximation. Phys Rev D 92(12):123517. https://doi.org/
10.1103/PhysRevD.92.123517. arXiv:1505.04756 [astro-ph.CO]
Fidler C, Tram T, Rampf C, Crittenden R, Koyama K, Wands D (2016) Relativistic interpretation of
Newtonian simulations for cosmic structure formation. JCAP 9:031. https://doi.org/10.1088/1475-
7516/2016/09/031. arXiv:1606.05588 [astro-ph.CO]
Fidler C, Tram T, Rampf C, Crittenden R, Koyama K, Wands D (2017a) General relativistic weak-ﬁeld
limit and Newtonian N-body simulations. JCAP 12:022. https://doi.org/10.1088/1475-7516/2017/
12/022. arXiv:1708.07769 [astro-ph.CO]
Fidler C, Tram T, Rampf C, Crittenden R, Koyama K, Wands D (2017b) Relativistic initial conditions for
N-body simulations. JCAP 6:043. https://doi.org/10.1088/1475-7516/2017/06/043. arXiv:1702.
03221 [astro-ph.CO]
Fluri J, Kacprzak T, Refregier A, Amara A, Lucchi A, Hofmann T (2018) Cosmological constraints from
noisy convergence maps through deep learning. Phys Rev D 98(12):123518. https://doi.org/10.1103/
PhysRevD.98.123518. arXiv:1807.08732 [astro-ph.CO]
Fluri J, Kacprzak T, Lucchi A, Refregier A, Amara A, Hofmann T, Schneider A (2019) Cosmological
constraints with deep learning from KiDS-450 weak lensing maps. Phys Rev D 100(6):063514.
https://doi.org/10.1103/PhysRevD.100.063514. arXiv:1906.03156 [astro-ph.CO]
Fong M, Han J (2021) A natural boundary of dark matter haloes revealed around the minimum bias and
maximum infall locations. MNRAS 503:4250–4263. https://doi.org/10.1093/mnras/stab259
Fontanot F, Springel V, Angulo RE, Henriques B (2012) Semi-analytic galaxy formation in early dark
energy cosmologies. MNRAS 426(3):2335–2341. https://doi.org/10.1111/j.1365-2966.2012.21880.
x. arXiv:1207.1723 [astro-ph.CO]
Fontanot F, Puchwein E, Springel V, Bianchi D (2013) Semi-analytic galaxy formation in f(R)-gravity
cosmologies. MNRAS 436(3):2672–2679. https://doi.org/10.1093/mnras/stt1763. arXiv:1307.5065
[astro-ph.CO]
123
1
Page 166 of 200
R. E. Angulo, O. Hahn

Fontanot F, Baldi M, Springel V, Bianchi D (2015a) Semi-analytic galaxy formation in coupled dark
energy cosmologies. MNRAS 452(1):978–985. https://doi.org/10.1093/mnras/stv1345. arXiv:1505.
02770 [astro-ph.CO]
Fontanot F, Villaescusa-Navarro F, Bianchi D, Viel M (2015b) Semi-analytic galaxy formation in
massive neutrino cosmologies. MNRAS 447(4):3361–3367. https://doi.org/10.1093/mnras/stu2705.
arXiv:1409.6309 [astro-ph.CO]
Foreman S, Coulton W, Villaescusa-Navarro F, Barreira A (2020) Baryonic effects on the matter
bispectrum. MNRAS 498(2):2887–2911. https://doi.org/10.1093/mnras/staa2523. arXiv:1910.03597
[astro-ph.CO]
Forero-Romero JE, Contreras S, Padilla N (2014) Cosmic web alignments with the shape, angular
momentum and peculiar velocities of dark matter haloes. MNRAS 443(2):1090–1102. https://doi.
org/10.1093/mnras/stu1150. arXiv:1406.0508 [astro-ph.CO]
Fornasa M, Sa´nchez-Conde MA (2015) The nature of the Diffuse Gamma-Ray Background. Phys Rep
598:1–58. https://doi.org/10.1016/j.physrep.2015.09.002. arXiv:1502.02866 [astro-ph.CO]
Fosalba P, Gaztan˜aga E, Castander FJ, Manera M (2008) The onion universe: all sky lightcone
simulations in spherical shells. MNRAS 391(1):435–446. https://doi.org/10.1111/j.1365-2966.2008.
13910.x. arXiv:0711.1540 [astro-ph]
Fosalba P, Crocce M, Gaztan˜aga E, Castander FJ (2015) The MICE grand challenge lightcone
simulation—I. Dark matter clustering. MNRAS 448(4):2987–3000. https://doi.org/10.1093/mnras/
stv138. arXiv:1312.1707 [astro-ph.CO]
Frenk CS, White SDM (2012) Dark matter and cosmic structure. Annalen der Physik 524(9–10):507–534.
https://doi.org/10.1002/andp.201200212. arXiv:1210.0544 [astro-ph.CO]
Frenk CS, White SDM, Bode P, Bond JR, Bryan GL, Cen R, Couchman HMP, Evrard AE, Gnedin N,
Jenkins A, Khokhlov AM, Klypin A, Navarro JF, Norman ML, Ostriker JP, Owen JM, Pearce FR,
Pen UL, Steinmetz M, Thomas PA, Villumsen JV, Wadsley JW, Warren MS, Xu G, Yepes G (1999)
The Santa Barbara Cluster Comparison Project: A Comparison of Cosmological Hydrodynamics
Solutions. ApJ 525(2):554–582. https://doi.org/10.1086/307908. arXiv:astro-ph/9906160 [astro-ph]
Frieman JA, Hill CT, Stebbins A, Waga I (1995) Cosmology with Ultralight Pseudo Nambu-Goldstone
Bosons. Phys Rev Lett 75:2077–2080. https://doi.org/10.1103/PhysRevLett.75.2077. arXiv:astro-
ph/9505060
Frigo M, Johnson SG (2005) The design and implementation of FFTW3. Proceedings of the IEEE
93(2):216–231. Special issue on ‘‘Program Generation, Optimization, and Platform Adaptation’’
Frontiere N, Heitmann K, Rangel E, Larsen P, Pope A, Sultan I, Uram T, Habib S, Rizzi S, Insley J (2021)
Farpoint: A High-Resolution Cosmology Simulation at the Gpc Scale. arXiv e-prints arXiv:2109.
01956 [astro-ph.CO]
Fujiwara T (1981) Vlasov Simulations of Stellar Systems—Inﬁnite Homogeneous Case. PASJ 33:531
Gao L, De Lucia G, White SDM, Jenkins A (2004) Galaxies and subhaloes in KCDM galaxy clusters.
MNRAS 352(2):L1–L5. https://doi.org/10.1111/j.1365-2966.2004.08098.x. arXiv:astro-ph/0405010
[astro-ph]
Gao L, White SDM, Jenkins A, Frenk CS, Springel V (2005) Early structure in KCDM. MNRAS
363(2):379–392. https://doi.org/10.1111/j.1365-2966.2005.09509.x. arXiv:astro-ph/0503003 [astro-
ph]
Gao L, Navarro JF, Frenk CS, Jenkins A, Springel V, White SDM (2012) The Phoenix Project: the dark
side of rich Galaxy clusters. MNRAS 425(3):2169–2186. https://doi.org/10.1111/j.1365-2966.2012.
21564.x. arXiv:1201.1940 [astro-ph.CO]
Garaldi E, Baldi M, Moscardini L (2016) Zoomed high-resolution simulations of Multi-coupled Dark
Energy: cored galaxy density proﬁles at high redshift. JCAP 1:050. https://doi.org/10.1088/1475-
7516/2016/01/050. arXiv:1511.02239 [astro-ph.CO]
Garaldi E, Nori M, Baldi M (2020) Dynamic zoom simulations: A fast, adaptive algorithm for simulating
light-cones. MNRAS 499(2):2685–2700. https://doi.org/10.1093/mnras/staa2064. arXiv:2005.05328
[astro-ph.CO]
Garcı´a R, Rozo E (2019) Halo exclusion criteria impacts halo statistics. MNRAS 489(3):4170–4175.
https://doi.org/10.1093/mnras/stz2458. arXiv:1903.01709 [astro-ph.CO]
Garcia R, Rozo E, Becker MR, More S (2021) A Redeﬁnition of the Halo Boundary Leads to a Simple yet
Accurate Halo Model of Large Scale Structure. MNRAS 505:1195–1205. https://doi.org/10.1093/
mnras/stab1317
Garny M, Konstandin T, Rubira H (2020) The Schro¨dinger-Poisson method for Large-Scale Structure.
JCAP 4:003. https://doi.org/10.1088/1475-7516/2020/04/003. arXiv:1911.04505 [astro-ph.CO]
123
Large-scale dark matter simulations
Page 167 of 200
1

Garrison LH, Eisenstein DJ, Ferrer D, Metchnik MV, Pinto PA (2016) Improving initial conditions for
cosmological
N-body
simulations.
MNRAS
461:4125–4145.
https://doi.org/10.1093/mnras/
stw1594. arXiv:1605.02333
Garrison LH, Eisenstein DJ, Ferrer D, Tinker JL, Pinto PA, Weinberg DH (2018) The Abacus Cosmos: A
Suite of Cosmological N-body Simulations. ApJS 236(2):43. https://doi.org/10.3847/1538-4365/
aabfd3. arXiv:1712.05768 [astro-ph.CO]
Garrison LH, Eisenstein DJ, Pinto PA (2019) A high-ﬁdelity realization of the Euclid code comparison
N-body simulation with ABACUS. MNRAS 485(3):3370–3377. https://doi.org/10.1093/mnras/
stz634. arXiv:1810.02916 [astro-ph.CO]
Garrison LH, Joyce M, Eisenstein DJ (2021) Good and Proper: Self-similarity of N-body Simulations
with Proper Force Softening. arXiv e-prints arXiv:2102.08972 [astro-ph.CO]
Genel S, Bryan GL, Springel V, Hernquist L, Nelson D, Pillepich A, Weinberger R, Pakmor R, Marinacci
F, Vogelsberger M (2019) A quantiﬁcation of the butterﬂy effect in cosmological simulations and
implications for galaxy scaling relations. ApJ 871(1):21. https://doi.org/10.3847/1538-4357/aaf4bb.
arXiv:1807.07084 [astro-ph.GA]
Giannantonio T, Percival WJ (2014) Using correlations between cosmic microwave background lensing
and large-scale structure to measure primordial non-Gaussianity. MNRAS 441:L16–L20. https://doi.
org/10.1093/mnrasl/slu036. arXiv:1312.5154 [astro-ph.CO]
Giannantonio T, Porciani C, Carron J, Amara A, Pillepich A (2012) Constraining primordial non-
Gaussianity with future galaxy surveys. MNRAS 422(4):2854–2877. https://doi.org/10.1111/j.1365-
2966.2012.20604.x. arXiv:1109.0958 [astro-ph.CO]
Giblin JT, Mertens JB, Starkman GD (2016) Departures from the Friedmann-Lemaitre-Robertson-Walker
Cosmological Model in an Inhomogeneous Universe: A Numerical Examination. Phys Rev Lett
116(25):251301. https://doi.org/10.1103/PhysRevLett.116.251301. arXiv:1511.01105 [gr-qc]
Gill SPD, Knebe A, Gibson BK (2004) The evolution of substructure—I. A new identiﬁcation method.
MNRAS
351(2):399–409.
https://doi.org/10.1111/j.1365-2966.2004.07786.x.
arXiv:astro-ph/
0404258 [astro-ph]
Giri SK, Schneider A (2021) Emulation of baryonic effects on the matter power spectrum and constraints
from galaxy cluster data. arXiv e-prints arXiv:2108.08863 [astro-ph.CO]
Giusarma E, Reyes Hurtado M, Villaescusa-Navarro F, He S, Ho S, Hahn C (2019) Learning neutrino
effects in Cosmology with Convolutional Neural Networks. arXiv e-prints arXiv:1910.04255 [astro-
ph.CO]
Gnedin NY (2019) Hierarchical Particle Mesh: An FFT-accelerated Fast Multipole Method. ApJS
243(2):19. https://doi.org/10.3847/1538-4365/ab2d24. arXiv:1906.10734 [physics.comp-ph]
Gnedin NY, Kravtsov AV, Rudd DH (2011) Implementing the DC Mode in Cosmological Simulations
with Supercomoving Variables. ApJS 194(2):46. https://doi.org/10.1088/0067-0049/194/2/46.
arXiv:1104.1428 [astro-ph.CO]
Goh T, Primack J, Lee CT, Aragon-Calvo M, Hellinger D, Behroozi P, Rodriguez-Puebla A, Eckholm E,
Johnston K (2019) Dark matter halo properties versus local density and cosmic web location.
MNRAS
483(2):2101–2122.
https://doi.org/10.1093/mnras/sty3153.
arXiv:1805.04943
[astro-
ph.GA]
Goldstein H, Poole C, Safko J (2002) Classical mechanics, 3rd edn. Addison-Wesley, San Francisco
Goodman J, Heggie DC, Hut P (1993) On the Exponential Instability of N-Body Systems. ApJ 415:715.
https://doi.org/10.1086/173196
Goroff MH, Grinstein B, Rey SJ, Wise MB (1986) Coupling of modes of cosmological mass density
ﬂuctuations. ApJ 311:6–14. https://doi.org/10.1086/164749
Gosenca M, Adamek J, Byrnes CT, Hotchkiss S (2017) 3D simulations with boosted primordial power
spectra and ultracompact minihalos. Phys Rev D 96(12):123519. https://doi.org/10.1103/PhysRevD.
96.123519. arXiv:1710.02055 [astro-ph.CO]
Gottlo¨ber S, Hoffman Y, Yepes G (2010) Constrained local universe simulations (CLUES). In: Wagner S,
Steinmetz M, Bode A, Mu¨ller M (eds) High Performance Computing in Science and Engineering,
Garching/Munich 2009. Springer, Berlin, Heidelberg, pp 309–322. https://doi.org/10.1007/978-3-
642-13872-0_26. arXiv:1005.2687 [astro-ph.CO]
Green AM, Hofmann S, Schwarz DJ (2004) The power spectrum of SUSY-CDM on subgalactic scales.
MNRAS
353(3):L23–L27.
https://doi.org/10.1111/j.1365-2966.2004.08232.x.
arXiv:astro-ph/
0309621 [astro-ph]
123
1
Page 168 of 200
R. E. Angulo, O. Hahn

Green SB, van den Bosch FC, Jiang F (2021) The tidal evolution of dark matter substructure—II. The
impact of artiﬁcial disruption on subhalo mass functions and radial proﬁles. arXiv e-prints arXiv:
2103.01227 [astro-ph.GA]
Greengard L, Rokhlin V (1987) A fast algorithm for particle simulations. J Comput Phys 73(2):325–348.
https://doi.org/10.1016/0021-9991(87)90140-9
Grossi M, Verde L, Carbone C, Dolag K, Branchini E, Iannuzzi F, Matarrese S, Moscardini L (2009)
Large-scale non-Gaussian mass function and halo bias: tests on N-body simulations. MNRAS
398(1):321–332. https://doi.org/10.1111/j.1365-2966.2009.15150.x. arXiv:0902.2013 [astro-ph.CO]
Grudic´ MY, Hopkins PF (2020) A general-purpose timestep criterion for simulations with gravity.
MNRAS 495:4306–4313. https://doi.org/10.1093/mnras/staa1453
Guandalin C, Adamek J, Bull P, Clarkson C, Abramo LR, Coates L (2021) Observing relativistic features
in large-scale structure surveys—I. Multipoles of the power spectrum. MNRAS 501(2):2547–2561.
https://doi.org/10.1093/mnras/staa3890. arXiv:2009.02284 [astro-ph.CO]
Guillet T, Teyssier R (2011) A simple multigrid scheme for solving the Poisson equation with arbitrary
domain boundaries. J Comput Phys 230(12):4756–4771. https://doi.org/10.1016/j.jcp.2011.02.044.
arXiv:1104.1703 [physics.comp-ph]
Guo H, Zheng Z, Zehavi I, Dawson K, Skibba RA, Tinker JL, Weinberg DH, White M, Schneider DP
(2015) Velocity bias from the small-scale clustering of SDSS-III BOSS galaxies. MNRAS
446(1):578–594. https://doi.org/10.1093/mnras/stu2120. arXiv:1407.4811 [astro-ph.CO]
Guo Q, White S (2014) Numerical resolution limits on subhalo abundance matching. MNRAS
437(4):3228–3235. https://doi.org/10.1093/mnras/stt2116. arXiv:1303.3586 [astro-ph.CO]
Gupta A, Zorrilla Matilla JM, Hsu D, Haiman Z (2018) Non-Gaussian information from weak lensing
data via deep learning. Phys Rev D 97(10):103515. https://doi.org/10.1103/PhysRevD.97.103515.
arXiv:1802.01212 [astro-ph.CO]
Gurbatov SN, Saichev AI, Shandarin SF (1985) A model for describing the development of the large-
scale structure of the universe. Soviet Phys Dokl 20:921
Habib S, Ryne RD (1995) Symplectic Calculation of Lyapunov Exponents. Phys Rev Lett 74(1):70–73.
https://doi.org/10.1103/PhysRevLett.74.70. arXiv:chao-dyn/9406010 [nlin.CD]
Habib S, Pope A, Lukic´ Z, Daniel D, Fasel P, Desai N, Heitmann K, Hsu CH, Ankeny L, Mark G,
Bhattacharya S, Ahrens J (2009) Hybrid petacomputing meets cosmology: The Roadrunner
Universe project. J Phys Conf Ser 180:012019. https://doi.org/10.1088/1742-6596/180/1/012019
Habib S, Pope A, Finkel H, Frontiere N, Heitmann K, Daniel D, Fasel P, Morozov V, Zagaris G, Peterka
T, Vishwanath V, Lukic´ Z, Sehrish S, Wk Liao (2016) HACC: Simulating sky surveys on state-of-
the-art supercomputing architectures. New A 42:49–65. https://doi.org/10.1016/j.newast.2015.06.
003. arXiv:1410.2805 [astro-ph.IM]
Hadzhiyska B, Bose S, Eisenstein D, Hernquist L, Spergel DN (2020) Limitations to the ‘basic’ HOD
model and beyond. MNRAS 493(4):5506–5519. https://doi.org/10.1093/mnras/staa623. arXiv:1911.
02610 [astro-ph.CO]
Hadzhiyska B, Bose S, Eisenstein D, Hernquist L (2021a) Extensions to models of the galaxy-halo
connection. MNRAS 501(2):1603–1620. https://doi.org/10.1093/mnras/staa3776. arXiv:2008.04913
[astro-ph.CO]
Hadzhiyska B, Garcı´a-Garcı´a C, Alonso D, Nicola A, Slosar A (2021b) Hefty enhancement of
cosmological constraints from the DES Y1 data using a Hybrid Effective Field Theory approach to
galaxy bias. JCAP 2021(09):020. https://doi.org/10.1088/1475-7516/2021/09/020
Hahn O, Abel T (2011) Multi-scale initial conditions for cosmological simulations. MNRAS
415(3):2101–2121.
https://doi.org/10.1111/j.1365-2966.2011.18820.x.
arXiv:1103.6031
[astro-
ph.CO]
Hahn O, Angulo RE (2016) An adaptively reﬁned phase-space element method for cosmological
simulations and collisionless dynamics. MNRAS 455:1115–1133. https://doi.org/10.1093/mnras/
stv2304. arXiv:1501.01959
Hahn O, Paranjape A (2016) General relativistic screening in cosmological simulations. Phys Rev D
94(8):083511. https://doi.org/10.1103/PhysRevD.94.083511. arXiv:1602.07699
Hahn O, Carollo CM, Porciani C, Dekel A (2007a) The evolution of dark matter halo properties in
clusters, ﬁlaments, sheets and voids. MNRAS 381(1):41–51. https://doi.org/10.1111/j.1365-2966.
2007.12249.x. arXiv:0704.2595 [astro-ph]
Hahn O, Porciani C, Carollo CM, Dekel A (2007b) Properties of dark matter haloes in clusters, ﬁlaments,
sheets and voids. MNRAS 375(2):489–499. https://doi.org/10.1111/j.1365-2966.2006.11318.x.
arXiv:astro-ph/0610280 [astro-ph]
123
Large-scale dark matter simulations
Page 169 of 200
1

Hahn O, Abel T, Kaehler R (2013) A new approach to simulating collisionless dark matter ﬂuids.
MNRAS 434:1171–1191. https://doi.org/10.1093/mnras/stt1061. arXiv:1210.6652
Hahn O, Angulo RE, Abel T (2015) The properties of cosmic velocity ﬁelds. MNRAS 454(4):3920–3937.
https://doi.org/10.1093/mnras/stv2179. arXiv:1404.2280 [astro-ph.CO]
Hahn O, Rampf C, Uhlemann C (2021) Higher order initial conditions for mixed baryon-CDM
simulations. MNRAS 503(1):426–445. https://doi.org/10.1093/mnras/staa3773. arXiv:2008.09124
[astro-ph.CO]
Hairer E, Lubich C, Wanner G (2006) Geometric Numerical Integration: Structure-Preserving Algorithms
for Ordinary Differential Equations, Springer Series in Computational Mathematics, 2nd edn,
vol 31. Springer, Berlin. https://doi.org/10.1007/3-540-30666-8
Halle A, Colombi S, Peirani S (2019) Phase-space structure analysis of self-gravitating collisionless
spherical systems. A&A 621:A8. https://doi.org/10.1051/0004-6361/201833460. arXiv:1701.01384
[astro-ph.GA]
Hamaus N, Pisani A, Choi JA, Lavaux G, Wandelt BD, Weller J (2020) Precision cosmology with voids
in the ﬁnal BOSS data. JCAP 12:023. https://doi.org/10.1088/1475-7516/2020/12/023. arXiv:2007.
07895 [astro-ph.CO]
Han J, Jing YP, Wang H, Wang W (2012) Resolving subhaloes’ lives with the Hierarchical Bound-
Tracing algorithm. MNRAS 427(3):2437–2449. https://doi.org/10.1111/j.1365-2966.2012.22111.x.
arXiv:1103.2099 [astro-ph.CO]
Han J, Cole S, Frenk CS, Benitez-Llambay A, Helly J (2018) HBT?: an improved code for ﬁnding
subhaloes and building merger trees in cosmological simulations. MNRAS 474(1):604–617. https://
doi.org/10.1093/mnras/stx2792. arXiv:1708.03646 [astro-ph.CO]
Hand N, Feng Y, Beutler F, Li Y, Modi C, Seljak U, Slepian Z (2018) nbodykit: An Open-source,
Massively Parallel Toolkit for Large-scale Structure. AJ 156(4):160. https://doi.org/10.3847/1538-
3881/aadae0. arXiv:1712.05834 [astro-ph.IM]
Hannestad S, Upadhye A, Wong YYY (2020) Spoon or slide? The non-linear matter power spectrum in
the presence of massive neutrinos. JCAP 11:062. https://doi.org/10.1088/1475-7516/2020/11/062.
arXiv:2006.04995 [astro-ph.CO]
Hansen SH, Agertz O, Joyce M, Stadel J, Moore B, Potter D (2007) An Alternative to Grids and Glasses:
Quaquaversal Pre-Initial Conditions for N-Body Simulations. ApJ 656(2):631–635. https://doi.org/
10.1086/510477. arXiv:astro-ph/0606148 [astro-ph]
Harnois-De´raps J, Pen UL, Iliev IT, Merz H, Emberson JD, Desjacques V (2013) High-performance P3M
N-body code: CUBEP3M. MNRAS 436(1):540–559. https://doi.org/10.1093/mnras/stt1591. arXiv:
1208.5098 [astro-ph.CO]
Harvey D, Massey R, Kitching T, Taylor A, Tittley E (2015) The nongravitational interactions of dark
matter in colliding galaxy clusters. Science 347(6229):1462–1465. https://doi.org/10.1126/science.
1261381. arXiv:1503.07675 [astro-ph.CO]
Hashim M, Giocoli C, Baldi M, Bertacca D, Maartens R (2018) Cosmic degeneracies III: N-body
simulations
of
interacting
dark
energy
with
non-Gaussian
initial
conditions.
MNRAS
481(3):2933–2945. https://doi.org/10.1093/mnras/sty2450. arXiv:1806.02356 [astro-ph.CO]
Hassani F, Lombriser L (2020) N-body simulations for parametrized modiﬁed gravity. MNRAS
497(2):1885–1894. https://doi.org/10.1093/mnras/staa2083. arXiv:2003.05927 [astro-ph.CO]
Hayli A (1967) Le proble`me des N corps dans un champ exte´rieur. Application a` l’e´volution dynamique
des amas ouverts. I. In: Les Nouvelles M&eacute;thodes de la Dynamique Stellaire. p 67
Hayli A (1974) The method of the doubly individual step for N-body computations. In: Bettis DG (eds)
Proceedings of the Conference on the Numerical Solution of Ordinary Differential Equations.
Lecture Notes in Mathematics, vol 362. Springer, Berlin, Heidelberg, pp 304–312. https://doi.org/
10.1007/BFb0066598
He Jh (2020) Modelling the tightest relation between galaxy properties and dark matter halo properties
from hydrodynamical simulations of galaxy formation. MNRAS 493(3):4453–4462. https://doi.org/
10.1093/mnras/staa620. arXiv:1905.01612 [astro-ph.CO]
He Jh, Li B, Baugh CM (2016) Subhalo Abundance Matching in f (R ) Gravity. Phys Rev Lett
117(22):221101. https://doi.org/10.1103/PhysRevLett.117.221101. arXiv:1605.04709 [astro-ph.CO]
He Jh, Guzzo L, Li B, Baugh CM (2018) No evidence for modiﬁcations of gravity from galaxy motions
on cosmological scales. Nature Astronomy 2:967–972. https://doi.org/10.1038/s41550-018-0573-2.
arXiv:1809.09019 [astro-ph.CO]
123
1
Page 170 of 200
R. E. Angulo, O. Hahn

He S, Li Y, Feng Y, Ho S, Ravanbakhsh S, Chen W, Po´czos B (2019) Learning to predict the
cosmological structure formation. Proc Natl Acad Sci 116(28):13825–13832. https://doi.org/10.
1073/pnas.1821458116. arXiv:1811.06533 [astro-ph.CO]
Hearin AP, Watson DF (2013) The dark side of galaxy colour. MNRAS 435(2):1313–1324. https://doi.
org/10.1093/mnras/stt1374. arXiv:1304.5557 [astro-ph.CO]
Hearin AP, Zentner AR, Berlind AA, Newman JA (2013) SHAM beyond clustering: new tests of galaxy-
halo abundance matching with galaxy groups. MNRAS 433(1):659–680. https://doi.org/10.1093/
mnras/stt755. arXiv:1210.4927 [astro-ph.CO]
Hearin AP, Zentner AR, van den Bosch FC, Campbell D, Tollerud E (2016) Introducing decorated HODs:
modelling assembly bias in the galaxy-halo connection. MNRAS 460(3):2552–2570. https://doi.org/
10.1093/mnras/stw840. arXiv:1512.03050 [astro-ph.CO]
Hearin AP, Campbell D, Tollerud E, Behroozi P, Diemer B, Goldbaum NJ, Jennings E, Leauthaud A,
Mao YY, More S, Parejko J, Sinha M, Sipo¨cz B, Zentner A (2017) Forward Modeling of Large-
scale Structure: An Open-source Approach with Halotools. AJ 154(5):190. https://doi.org/10.3847/
1538-3881/aa859f. arXiv:1606.04106 [astro-ph.IM]
Heggie DC (1991) Chaos in the N-body problem of stellar dynamics. In: Predictability, Stability, and
Chaos in N-Body Dynamical Systems. NATO Advanced Study Institute (ASI) Series B vol 27,
pp 47–62
Heinesen A, Buchert T (2020) Solving the curvature and Hubble parameter inconsistencies through
structure formation-induced curvature. Class Quantum Grav 37(16):164001. https://doi.org/10.1088/
1361-6382/ab954b. arXiv:2002.10831 [gr-qc]
Heitmann K, Ricker PM, Warren MS, Habib S (2005) Robustness of Cosmological Simulations. I. Large-
Scale Structure. ApJS 160(1):28–58. https://doi.org/10.1086/432646. arXiv:astro-ph/0411795 [as-
tro-ph]
Heitmann K, Lukic´ Z, Fasel P, Habib S, Warren MS, White M, Ahrens J, Ankeny L, Armstrong R,
O’Shea B, Ricker PM, Springel V, Stadel J, Trac H (2008) The cosmic code comparison project.
Comput Sci Discovery 1(1):015003. https://doi.org/10.1088/1749-4699/1/1/015003. arXiv:0706.
1270 [astro-ph]
Heitmann K, Higdon D, White M, Habib S, Williams BJ, Wagner C (2009) The Coyote Universe II:
Cosmological Models and Precision Emulation of the Nonlinear Matter Power Spectrum. Astrophys
J 705:156–174. https://doi.org/10.1088/0004-637X/705/1/156. arXiv:0902.0429 [astro-ph.CO]
Heitmann K, Bingham D, Lawrence E, Bergner S, Habib S, Higdon D, Pope A, Biswas R, Finkel H,
Frontiere N, Bhattacharya S (2016) The Mira-Titan Universe: Precision Predictions for Dark Energy
Surveys. ApJ 820(2):108. https://doi.org/10.3847/0004-637X/820/2/108. arXiv:1508.02654 [astro-
ph.CO]
Heitmann K, Finkel H, Pope A, Morozov V, Frontiere N, Habib S, Rangel E, Uram T, Korytov D, Child
H, Flender S, Insley J, Rizzi S (2019) The Outer Rim Simulation: A Path to Many-core
Supercomputers. ApJS 245(1):16. https://doi.org/10.3847/1538-4365/ab4da1. arXiv:1904.11970
[astro-ph.CO]
Heitmann K, Frontiere N, Rangel E, Larsen P, Pope A, Sultan I, Uram T, Habib S, Finkel H, Korytov D,
Kovacs E, Rizzi S, Insley J, Knowles JYK (2021) The Last Journey. I. An Extreme-scale Simulation
on the Mira Supercomputer. ApJS 252(2):19. https://doi.org/10.3847/1538-4365/abcc67. arXiv:
2006.01697 [astro-ph.CO]
Hellwing WA, Schaller M, Frenk CS, Theuns T, Schaye J, Bower RG, Crain RA (2016) The effect of
baryons on redshift space distortions and cosmic density and velocity ﬁelds in the EAGLE
simulation. MNRAS 461:L11–L15. https://doi.org/10.1093/mnrasl/slw081. arXiv:1603.03328
He´non M (1964) L’e´volution initiale d’un amas sphe´rique. Annales d’Astrophysique 27:83
Henriques BMB, Thomas PA, Oliver S, Roseboom I (2009) Monte Carlo Markov Chain parameter
estimation in semi-analytic models of galaxy formation. MNRAS 396(1):535–547. https://doi.org/
10.1111/j.1365-2966.2009.14730.x. arXiv:0810.2548 [astro-ph]
Henriques BMB, White SDM, Thomas PA, Angulo RE, Guo Q, Lemson G, Springel V (2013)
Simulations of the galaxy population constrained by observations from z = 3 to the present day:
implications for galactic winds and the fate of their ejecta. MNRAS 431(4):3373–3395. https://doi.
org/10.1093/mnras/stt415. arXiv:1212.1717 [astro-ph.CO]
Henriques BMB, White SDM, Thomas PA, Angulo R, Guo Q, Lemson G, Springel V, Overzier R (2015)
Galaxy formation in the Planck cosmology—I. Matching the observed evolution of star formation
rates, colours and stellar masses. MNRAS 451(3):2663–2680. https://doi.org/10.1093/mnras/stv705.
arXiv:1410.0365 [astro-ph.GA]
123
Large-scale dark matter simulations
Page 171 of 200
1

Herna´ndez-Monteagudo C, Chaves-Montero J, Angulo RE, Aricco` G (2020) Tomographic Constraints on
Gravity from Angular Redshift Fluctuations in the Late Universe. MNRAS Lett 503:L62–L66.
https://doi.org/10.1093/mnrasl/slab021
Hernquist L, Barnes JE (1990) Are Some N-Body Algorithms Intrinsically Less Collisional than Others?
ApJ 349:562. https://doi.org/10.1086/168343
Heß S, Kitaura FS, Gottlo¨ber S (2013) Simulating structure formation of the Local Universe. MNRAS
435(3):2065–2076. https://doi.org/10.1093/mnras/stt1428. arXiv:1304.6565 [astro-ph.CO]
Hildebrandt H, Viola M, Heymans C, Joudaki S, Kuijken K, Blake C, Erben T, Joachimi B, Klaes D,
Miller L, Morrison CB, Nakajima R, Verdoes Kleijn G, Amon A, Choi A, Covone G, de Jong JTA,
Dvornik A, Fenech Conti I, Grado A, Harnois-De´raps J, Herbonnet R, Hoekstra H, Ko¨hlinger F,
McFarland J, Mead A, Merten J, Napolitano N, Peacock JA, Radovich M, Schneider P, Simon P,
Valentijn EA, van den Busch JL, van Uitert E, Van Waerbeke L (2017) KiDS-450: cosmological
parameter constraints from tomographic weak gravitational lensing. MNRAS 465(2):1454–1498.
https://doi.org/10.1093/mnras/stw2805. arXiv:1606.05338 [astro-ph.CO]
Hirschmann M, Dolag K, Saro A, Bachmann L, Borgani S, Burkert A (2014) Cosmological simulations of
black hole growth: AGN luminosities and downsizing. MNRAS 442(3):2304–2324. https://doi.org/
10.1093/mnras/stu1023. arXiv:1308.0333 [astro-ph.CO]
Hirschmann M, De Lucia G, Fontanot F (2016) Galaxy assembly, stellar feedback and metal enrichment:
the view from the GAEA model. MNRAS 461(2):1760–1785. https://doi.org/10.1093/mnras/
stw1318. arXiv:1512.04531 [astro-ph.GA]
Hlozek R, Grin D, Marsh DJE, Ferreira PG (2015) A search for ultralight axions using precision
cosmological data. Phys Rev D 91(10):103512. https://doi.org/10.1103/PhysRevD.91.103512.
arXiv:1410.2896 [astro-ph.CO]
Ho MF, Bird S, Shelton CR (2021) Multi-Fidelity Emulation for the Matter Power Spectrum using
Gaussian Processes. MNRAS 509:2551–2565. https://doi.org/10.1093/mnras/stab3114
Ho S, Agarwal N, Myers AD, Lyons R, Disbrow A, Seo HJ, Ross A, Hirata C, Padmanabhan N,
O’Connell R, Huff E, Schlegel D, Slosar A, Weinberg D, Strauss M, Ross NP, Schneider DP,
Bahcall N, Brinkmann J, Palanque-Delabrouille N, Ye`che C (2015) Sloan Digital Sky Survey III
photometric quasar clustering: probing the initial conditions of the Universe. JCAP 5:040. https://
doi.org/10.1088/1475-7516/2015/05/040. arXiv:1311.2597 [astro-ph.CO]
Hobbs A, Read JI, Agertz O, Iannuzzi F, Power C (2016) NOVel Adaptive softening for collisionless
N-body simulations: eliminating spurious haloes. MNRAS 458(1):468–479. https://doi.org/10.1093/
mnras/stw251. arXiv:1503.02689 [astro-ph.CO]
Hockney RW, Eastwood JW (1981) Computer Simulation Using Particles. Computer Simulation Using
Particles. McGraw-Hill, New York
Hoffman Y, Ribak E (1991) Constrained Realizations of Gaussian Fields: A Simple Algorithm. ApJ
380:L5. https://doi.org/10.1086/186160
Hoffman Y, Metuki O, Yepes G, Gottlo¨ber S, Forero-Romero JE, Libeskind NI, Knebe A (2012) A
kinematic classiﬁcation of the cosmic web. MNRAS 425(3):2049–2057. https://doi.org/10.1111/j.
1365-2966.2012.21553.x. arXiv:1201.3367 [astro-ph.CO]
Hofmann S, Schwarz DJ, Sto¨cker H (2001) Damping scales of neutralino cold dark matter. Phys Rev D
64(8):083507. https://doi.org/10.1103/PhysRevD.64.083507. arXiv:astro-ph/0104173 [astro-ph]
Hojjati A, Pogosian L, Zhao GB (2011) Testing gravity with CAMB and CosmoMC. JCAP 8:005. https://
doi.org/10.1088/1475-7516/2011/08/005. arXiv:1106.4543 [astro-ph.CO]
Hollowed J (2019) Lightcone Construction for HACC Cosmological Simulations with LANTERN. arXiv
e-prints arXiv:1906.08355 [astro-ph.CO]
Hopkins
PF
(2019)
A
stable
ﬁnite-volume
method
for
scalar
ﬁeld
dark
matter.
MNRAS
489(2):2367–2376. https://doi.org/10.1093/mnras/stz1922. arXiv:1811.05583 [astro-ph.CO]
Howlett C, Manera M, Percival WJ (2015) L-PICOLA: A parallel code for fast dark matter simulation.
Astron. Comput. 12:109–126. https://doi.org/10.1016/j.ascom.2015.07.003. arXiv:1506.03737 [as-
tro-ph.CO]
Hu W, Barkana R, Gruzinov A (2000) Fuzzy Cold Dark Matter: The Wave Properties of Ultralight
Particles. Phys Rev Lett 85(6):1158–1161. https://doi.org/10.1103/PhysRevLett.85.1158. arXiv:
astro-ph/0003365 [astro-ph]
Hu W, Chiang CT, Li Y, LoVerde M (2016) Separating the Universe into real and fake energy densities.
Phys Rev D 94(2):023002. https://doi.org/10.1103/PhysRevD.94.023002. arXiv:1605.01412 [astro-
ph.CO]
123
1
Page 172 of 200
R. E. Angulo, O. Hahn

Huang HJ, Eiﬂer T, Mandelbaum R, [DES Collaboration], et al (2021) Dark energy survey year 1 results:
Constraining baryonic physics in the Universe. MNRAS 502(4):6010–6031. https://doi.org/10.1093/
mnras/stab357. arXiv:2007.15026 [astro-ph.CO]
Hui L (2021) Wave Dark Matter. ARA&A 59:247–289. https://doi.org/10.1146/annurev-astro-120920-
010024
Hui L, Ostriker JP, Tremaine S, Witten E (2017) Ultralight scalars as cosmological dark matter. Phys Rev
D 95(4):043541. https://doi.org/10.1103/PhysRevD.95.043541. arXiv:1610.08297
Huo R, Yu HB, Zhong YM (2020) The structure of dissipative dark matter halos. JCAP 6:051. https://doi.
org/10.1088/1475-7516/2020/06/051. arXiv:1912.06757 [astro-ph.CO]
Iannuzzi F, Dolag K (2011) Adaptive gravitational softening in GADGET. MNRAS 417(4):2846–2859.
https://doi.org/10.1111/j.1365-2966.2011.19446.x. arXiv:1107.2942 [astro-ph.CO]
Icaza-Lizaola M, Bower RG, Norberg P, Cole S, Egan S (2021) A sparse regression approach to modeling
the relation between galaxy stellar masses and their host halos. MNRAS 507:4584–4602. https://doi.
org/10.1093/mnras/stab2368
Igouchkine O, Leaf N, Ma KL (2016) Volume rendering dark matter simulations using cell projection and
order-independent transparency. In: SIGGRAPH ASIA 2016 Symposium on Visualization. SA ’16.
ACM, New York, pp 8:1–8:8. https://doi.org/10.1145/3002151.3002163
Inman D, Ali-Haı¨moud Y (2019) Early structure formation in primordial black hole cosmologies. Phys
Rev D 100(8):083528. https://doi.org/10.1103/PhysRevD.100.083528. arXiv:1907.08129 [astro-
ph.CO]
Inman D, Yu HR (2020) Simulating the Cosmic Neutrino Background Using Collisionless Hydrody-
namics. ApJS 250(1):21. https://doi.org/10.3847/1538-4365/aba0b3. arXiv:2002.04601 [astro-
ph.CO]
Inman D, Emberson JD, Pen UL, Farchi A, Yu HR, Harnois-De´raps J (2015) Precision reconstruction of
the cold dark matter-neutrino relative velocity from N -body simulations. Phys Rev D 92(2):023502.
https://doi.org/10.1103/PhysRevD.92.023502. arXiv:1503.07480 [astro-ph.CO]
Irsˇicˇ V, Viel M, Haehnelt MG, Bolton JS, Becker GD (2017a) First Constraints on Fuzzy Dark Matter
from Lyman-a Forest Data and Hydrodynamical Simulations. Phys Rev Lett 119(3):031302. https://
doi.org/10.1103/PhysRevLett.119.031302. arXiv:1703.04683 [astro-ph.CO]
Irsˇicˇ V, Viel M, Haehnelt MG, Bolton JS, Cristiani S, Becker GD, D’Odorico V, Cupani G, Kim TS, Berg
TAM, Lo´pez S, Ellison S, Christensen L, Denney KD, Worseck G (2017b) New constraints on the
free-streaming of warm dark matter from intermediate and small scale Lyman-a forest data. Phys
Rev D 96(2):023522. https://doi.org/10.1103/PhysRevD.96.023522. arXiv:1702.01764 [astro-
ph.CO]
Ishiyama T (2014) Hierarchical Formation of Dark Matter Halos and the Free Streaming Scale. ApJ
788(1):27. https://doi.org/10.1088/0004-637X/788/1/27. arXiv:1404.1650 [astro-ph.CO]
Ishiyama T, Ando S (2020) The abundance and structure of subhaloes near the free streaming scale and
their impact on indirect dark matter searches. MNRAS 492(3):3662–3671. https://doi.org/10.1093/
mnras/staa069. arXiv:1907.03642 [astro-ph.CO]
Ishiyama T, Fukushige T, Makino J (2009) GreeM: Massively Parallel TreePM Code for Large
Cosmological N -body Simulations. PASJ 61:1319. https://doi.org/10.1093/pasj/61.6.1319. arXiv:
0910.0121 [astro-ph.IM]
Ishiyama T, Nitadori K, Makino J (2012) 4.45 Pﬂops Astrophysical N-Body Simulation on K computer—
The Gravitational Trillion-Body Problem. arXiv e-prints arXiv:1211.4406 [astro-ph.CO]
Ishiyama T, Prada F, Klypin AA, Sinha M, Metcalf RB, Jullo E, Altieri B, Cora SA, Croton D, de la Torre
S, Milla´n-Calero DE, Oogi T, Ruedas J, Vega-Martı´nez CA (2021) The Uchuu simulations: Data
Release 1 and dark matter halo concentrations. MNRAS 506(3):4210–4231. https://doi.org/10.1093/
mnras/stab1755. arXiv:2007.14720 [astro-ph.CO]
Ivezic´ Zˇ, Kahn SM, Tyson JA, Abel B, Acosta E, Allsman R, Alonso D, AlSayyad Y, Anderson SF,
Andrew J et al (2019) LSST: From Science Drivers to Reference Design and Anticipated Data
Products. ApJ 873(2):111. https://doi.org/10.3847/1538-4357/ab042c. arXiv:0805.2366 [astro-ph]
Ivkin N, Liu Z, Yang LF, Kumar SS, Lemson G, Neyrinck M, Szalay AS, Braverman V, Budavari T
(2018) Scalable streaming tools for analyzing N-body simulations: Finding halos and investigating
excursion sets in one pass. Astron Comput 23:166. https://doi.org/10.1016/j.ascom.2018.04.003.
arXiv:1711.00975 [astro-ph.IM]
Iwanus N, Elahi PJ, Lewis GF (2017) Dark matter annihilation feedback in cosmological simulations—I:
Code convergence and idealized haloes. MNRAS 472(1):1214–1225. https://doi.org/10.1093/mnras/
stx1974. arXiv:1707.06770 [astro-ph.CO]
123
Large-scale dark matter simulations
Page 173 of 200
1

Izard A, Crocce M, Fosalba P (2016) ICE-COLA: towards fast and accurate synthetic galaxy catalogues
optimizing a quasi-N-body method. MNRAS 459(3):2327–2341. https://doi.org/10.1093/mnras/
stw797. arXiv:1509.04685 [astro-ph.CO]
Izquierdo-Villalba D, Angulo RE, Orsi A, Hurier G, Vilella-Rojo G, Bonoli S, Lo´pez-Sanjuan C, Alcaniz
J, Cenarro J, Cristo´bal-Hornillos D, Dupke R, Ederoclite A, Herna´ndez-Monteagudo C, Marı´n-
Franch A, Moles M, Mendes de Oliveira C, Sodre´ L, Varela J, Va´zquez Ramio´ H (2019) J-PLUS:
Synthetic galaxy catalogues with emission lines for photometric surveys. A&A 631:A82. https://doi.
org/10.1051/0004-6361/201936232. arXiv:1907.02111 [astro-ph.GA]
Jamieson D, Loverde M (2019a) Quintessential isocurvature in separate universe simulations. Phys Rev D
100(2):023516. https://doi.org/10.1103/PhysRevD.100.023516. arXiv:1812.08765 [astro-ph.CO]
Jamieson D, Loverde M (2019b) Separate universe void bias. Phys Rev D 100(12):123528. https://doi.
org/10.1103/PhysRevD.100.123528. arXiv:1909.05313 [astro-ph.CO]
Jasche J, Lavaux G (2019) Physical Bayesian modelling of the non-linear matter distribution: New
insights into the nearby universe. A&A 625:A64. https://doi.org/10.1051/0004-6361/201833710.
arXiv:1806.11117 [astro-ph.CO]
Jasche J, Kitaura FS, Li C, Enßlin TA (2010) Bayesian non-linear large-scale structure inference of the
Sloan Digital Sky Survey Data Release 7. MNRAS 409(1):355–370. https://doi.org/10.1111/j.1365-
2966.2010.17313.x. arXiv:0911.2498 [astro-ph.CO]
Jelic-Cizmek G, Lepori F, Adamek J, Durrer R (2018) The generation of vorticity in cosmological
N-body simulations. JCAP 9:006. https://doi.org/10.1088/1475-7516/2018/09/006. arXiv:1806.
05146 [astro-ph.CO]
Jenkins A (2010) Second-order Lagrangian perturbation theory initial conditions for resimulations.
MNRAS 403(4):1859–1872. https://doi.org/10.1111/j.1365-2966.2010.16259.x. arXiv:0910.0258
[astro-ph.CO]
Jenkins A (2013) A new way of setting the phases for cosmological multiscale Gaussian initial
conditions. MNRAS 434:2094–2120. https://doi.org/10.1093/mnras/stt1154. arXiv:1306.5968
Jenkins A, Frenk CS, White SDM, Colberg JM, Cole S, Evrard AE, Couchman HMP, Yoshida N (2001)
The mass function of dark matter haloes. MNRAS 321:372–384. https://doi.org/10.1046/j.1365-
8711.2001.04029.x. arXiv:astro-ph/0005260
Jennings E (2012) An improved model for the non-linear velocity power spectrum. MNRAS 427(1):L25–
L29. https://doi.org/10.1111/j.1745-3933.2012.01338.x. arXiv:1207.1439 [astro-ph.CO]
Jennings E, Baugh CM, Pascoli S (2011) Modelling redshift space distortions in hierarchical cosmologies.
MNRAS 410(3):2081–2094. https://doi.org/10.1111/j.1365-2966.2010.17581.x. arXiv:1003.4282
[astro-ph.CO]
Jennings E, Baugh CM, Hatt D (2015) Velocity and mass bias in the distribution of dark matter haloes.
MNRAS 446(1):793–802. https://doi.org/10.1093/mnras/stu2043. arXiv:1407.7296 [astro-ph.CO]
Jennings WD, Watkinson CA, Abdalla FB, McEwen JD (2019) Evaluating machine learning techniques
for predicting power spectra from reionization simulations. MNRAS 483(3):2907–2922. https://doi.
org/10.1093/mnras/sty3168. arXiv:1811.09141 [astro-ph.CO]
Jessop C, Duncan M, Chau WY (1994) Multigrid Methods for N-Body Gravitational Systems. J Comput
Phys 115(2):339–351. https://doi.org/10.1006/jcph.1994.1200
Jimenez R, Kitching T, Pen˜a-Garay C, Verde L (2010) Can we measure the neutrino mass hierarchy in the
sky? JCAP 5:035. https://doi.org/10.1088/1475-7516/2010/05/035. arXiv:1003.5918 [astro-ph.CO]
Jing YP (2005) Correcting for the Alias Effect When Measuring the Power Spectrum Using a Fast Fourier
Transform. ApJ 620(2):559–563. https://doi.org/10.1086/427087. arXiv:astro-ph/0409240 [astro-ph]
Johansen H, Colella P (1998) A Cartesian Grid Embedded Boundary Method for Poisson’s Equation on
Irregular Domains. J Comput Phys 147(1):60–85. https://doi.org/10.1006/jcph.1998.5965
Joyce M, Marcos B (2007a) Quantiﬁcation of discreteness effects in cosmological N-body simulations. II.
Evolution up to shell crossing. Phys Rev D 76(10):103505. https://doi.org/10.1103/PhysRevD.76.
103505. arXiv:0704.3697
Joyce M, Marcos B (2007b) Quantiﬁcation of discreteness effects in cosmological N-body simulations:
Initial conditions. Phys Rev D 75(6):063516. https://doi.org/10.1103/PhysRevD.75.063516. arXiv:
astro-ph/0410451
Joyce M, Marcos B, Gabrielli A, Baertschiger T, Sylos Labini F (2005) Gravitational Evolution of a
Perturbed Lattice and its Fluid Limit. Phys Rev Lett 95(1):011304. https://doi.org/10.1103/
PhysRevLett.95.011304. arXiv:astro-ph/0504213
123
1
Page 174 of 200
R. E. Angulo, O. Hahn

Joyce M, Garrison L, Eisenstein D (2020) Quantifying resolution in cosmological N-body simulations
using self-similarity. MNRAS https://doi.org/10.1093/mnras/staa3434. arXiv:2004.07256 [astro-
ph.CO]
Juan E, Salvador-Sole´ E, Dome`nech G, Manrique A (2014) Fixing a rigorous formalism for the accurate
analytic derivation of halo properties. MNRAS 439(1):719–724. https://doi.org/10.1093/mnras/
stt2493. arXiv:1401.7335 [astro-ph.CO]
Kaehler R (2017) Massively parallel computation of accurate densities for N-body dark matter
simulations using the phase-space-element method. Astron Comput 20:68–76. https://doi.org/10.
1016/j.ascom.2017.05.005. arXiv:1612.09491 [physics.comp-ph]
Ka¨hler R, Hahn O, Abel T (2012) A novel approach to visualizing dark matter simulations. IEEE Trans
Vis Comput Graph 18(12):2078–2087. https://doi.org/10.1109/TVCG.2012.187
Kahlhoefer F, Schmidt-Hoberg K, Kummer J, Sarkar S (2015) On the interpretation of dark matter self-
interactions in Abell 3827. MNRAS 452(1):L54–L58. https://doi.org/10.1093/mnrasl/slv088. arXiv:
1504.06576 [astro-ph.CO]
Kampakoglou M, Trotta R, Silk J (2008) Monolithic or hierarchical star formation? A new statistical
analysis. MNRAS 384(4):1414–1426. https://doi.org/10.1111/j.1365-2966.2007.12747.x. arXiv:
0709.1104 [astro-ph]
Kates-Harbeck J, Totorica S, Zrake J, Abel T (2016) Simplex-in-cell technique for collisionless plasma
simulations. J Comput Phys 304:231–251. https://doi.org/10.1016/j.jcp.2015.10.017. arXiv:1506.
07207 [physics.comp-ph]
Kato R, Soda J (2020) Search for ultralight scalar dark matter with NANOGrav pulsar timing arrays.
JCAP 9:036. https://doi.org/10.1088/1475-7516/2020/09/036. arXiv:1904.09143 [astro-ph.HE]
Katz N, Quinn T, Bertschinger E, Gelb JM (1994) Formation of Quasars at High Redshift. MNRAS
270:L71. https://doi.org/10.1093/mnras/270.1.L71
Kauffmann G, White SDM, Guiderdoni B (1993) The formation and evolution of galaxies within merging
dark matter haloes. MNRAS 264:201–218. https://doi.org/10.1093/mnras/264.1.201
Kaushal N, Villaescusa-Navarro F, Giusarma E, Li Y, Hawry C, Reyes M (2021) NECOLA: Towards a
Universal Field-level Cosmological Emulator. arXiv e-prints arXiv:2111.02441 [astro-ph.CO]
Keller BW, Wadsley JW, Wang L, Kruijssen JMD (2019) Chaos and variance in galaxy formation.
MNRAS
482(2):2244–2261.
https://doi.org/10.1093/mnras/sty2859.
arXiv:1803.05445
[astro-
ph.GA]
Khandai N, Di Matteo T, Croft R, Wilkins S, Feng Y, Tucker E, DeGraf C, Liu MS (2015) The
MassiveBlack-II simulation: the evolution of haloes and galaxies to z
	
0. MNRAS
450(2):1349–1374. https://doi.org/10.1093/mnras/stv627. arXiv:1402.0888 [astro-ph.CO]
Khmelnitsky A, Rubakov V (2014) Pulsar timing signal from ultralight scalar dark matter. JCAP 2:019.
https://doi.org/10.1088/1475-7516/2014/02/019. arXiv:1309.5888 [astro-ph.CO]
Khoraminezhad H, Lazeyras T, Angulo RE, Hahn O, Viel M (2021) Quantifying the impact of baryon-
CDM perturbations on halo clustering and baryon fraction. JCAP 3:023. https://doi.org/10.1088/
1475-7516/2021/03/023. arXiv:2011.01037 [astro-ph.CO]
Kim J, Park C (2006) A New Halo-ﬁnding Method for N-Body Simulations. ApJ 639(2):600–616. https://
doi.org/10.1086/499761. arXiv:astro-ph/0401386 [astro-ph]
Kim Jh, Abel T, Agertz O et al [AGORA Collaboration] (2014) The AGORA High-resolution Galaxy
Simulations Comparison Project. ApJS 210(1):14. https://doi.org/10.1088/0067-0049/210/1/14.
arXiv:1308.2669 [astro-ph.GA]
Kitaura FS, Enßlin TA (2008) Bayesian reconstruction of the cosmological large-scale structure:
methodology, inverse algorithms and numerical optimization. MNRAS 389(2):497–544. https://doi.
org/10.1111/j.1365-2966.2008.13341.x. arXiv:0705.0429 [astro-ph]
Kitaura FS, Hess S (2013) Cosmological structure formation with augmented lagrangian perturbation
theory. MNRAS 435:L78–L82. https://doi.org/10.1093/mnrasl/slt101. arXiv:1212.3514 [astro-
ph.CO]
Kitaura FS, Yepes G, Prada F (2014) Modelling baryon acoustic oscillations with perturbation theory and
stochastic halo biasing. MNRAS 439:L21–L25. https://doi.org/10.1093/mnrasl/slt172. arXiv:1307.
3285 [astro-ph.CO]
Kitzbichler MG, White SDM (2007) The high-redshift galaxy population in hierarchical galaxy formation
models. MNRAS 376(1):2–12. https://doi.org/10.1111/j.1365-2966.2007.11458.x. arXiv:astro-ph/
0609636 [astro-ph]
123
Large-scale dark matter simulations
Page 175 of 200
1

Klypin A, Prada F (2018a) Dark matter statistics for large galaxy catalogues: power spectra and
covariance matrices. MNRAS 478(4):4602–4621. https://doi.org/10.1093/mnras/sty1340. arXiv:
1701.05690 [astro-ph.CO]
Klypin A, Prada F (2018b) Dark matter statistics for large galaxy catalogues: power spectra and
covariance matrices. MNRAS 478(4):4602–4621. https://doi.org/10.1093/mnras/sty1340. arXiv:
1701.05690 [astro-ph.CO]
Klypin A, Prada F (2019) Effects of long-wavelength ﬂuctuations in large galaxy surveys. MNRAS
489(2):1684–1696. https://doi.org/10.1093/mnras/stz2194. arXiv:1809.03637 [astro-ph.CO]
Klypin AA, Shandarin SF (1983) Three-dimensional numerical model of the formation of large-scale
structure in the Universe. MNRAS 204:891–907. https://doi.org/10.1093/mnras/204.3.891
Klypin A, Holtzman J, Primack J, Regos E (1993) Structure Formation with Cold plus Hot Dark Matter.
ApJ 416:1. https://doi.org/10.1086/173210. arXiv:astro-ph/9305011 [astro-ph]
Klypin A, Gottlo¨ber S, Kravtsov AV, Khokhlov AM (1999a) Galaxies in N-Body Simulations:
Overcoming the Overmerging Problem. ApJ 516(2):530–551. https://doi.org/10.1086/307122.
arXiv:astro-ph/9708191 [astro-ph]
Klypin A, Kravtsov AV, Valenzuela O, Prada F (1999b) Where Are the Missing Galactic Satellites? ApJ
522(1):82–92. https://doi.org/10.1086/307643. arXiv:astro-ph/9901240 [astro-ph]
Klypin A, Hoffman Y, Kravtsov AV, Gottlo¨ber S (2003) Constrained Simulations of the Real Universe:
The Local Supercluster. ApJ 596(1):19–33. https://doi.org/10.1086/377574. arXiv:astro-ph/0107104
[astro-ph]
Klypin AA, Trujillo-Gomez S, Primack J (2011) Dark Matter Halos in the Standard Cosmological Model:
Results from the Bolshoi Simulation. ApJ 740(2):102. https://doi.org/10.1088/0004-637X/740/2/
102. arXiv:1002.3660 [astro-ph.CO]
Klypin A, Prada F, Yepes G, Heß S, Gottlo¨ber S (2015) Halo abundance matching: accuracy and
conditions for numerical convergence. MNRAS 447(4):3693–3707. https://doi.org/10.1093/mnras/
stu2685
Klypin A, Yepes G, Gottlo¨ber S, Prada F, Heß S (2016) MultiDark simulations: the story of dark matter
halo concentrations and density proﬁles. MNRAS 457(4):4340–4359. https://doi.org/10.1093/mnras/
stw248. arXiv:1411.4001 [astro-ph.CO]
Klypin A, Prada F, Byun J (2020) Suppressing cosmic variance with paired-and-ﬁxed cosmological
simulations: average properties and covariances of dark matter clustering statistics. MNRAS
496(3):3862–3869. https://doi.org/10.1093/mnras/staa734. arXiv:1903.08518 [astro-ph.CO]
Knebe A, Kravtsov AV, Gottlo¨ber S, Klypin AA (2000) On the effects of resolution in dissipationless
cosmological simulations. MNRAS 317(3):630–648. https://doi.org/10.1046/j.1365-8711.2000.
03673.x. arXiv:astro-ph/9912257 [astro-ph]
Knebe A, Knollmann SR, Muldrew SI, Pearce FR, Aragon-Calvo MA, Ascasibar Y, Behroozi PS,
Ceverino D, Colombi S, Diemand J, Dolag K, Falck BL, Fasel P, Gardner J, Gottlo¨ber S, Hsu CH,
Iannuzzi F, Klypin A, Lukic´ Z, Maciejewski M, McBride C, Neyrinck MC, Planelles S, Potter D,
Quilis V, Rasera Y, Read JI, Ricker PM, Roy F, Springel V, Stadel J, Stinson G, Sutter PM,
Turchaninov V, Tweed D, Yepes G, Zemp M (2011) Haloes gone MAD: The Halo-Finder
Comparison Project. MNRAS 415(3):2293–2318. https://doi.org/10.1111/j.1365-2966.2011.18858.
x. arXiv:1104.0949 [astro-ph.CO]
Knebe A, Pearce FR, Lux H, Ascasibar Y, Behroozi P, Casado J, Moran CC, Diemand J, Dolag K,
Dominguez-Tenreiro R, Elahi P, Falck B, Gottlo¨ber S, Han J, Klypin A, Lukic´ Z, Maciejewski M,
McBride CK, Mercha´n ME, Muldrew SI, Neyrinck M, Onions J, Planelles S, Potter D, Quilis V,
Rasera Y, Ricker PM, Roy F, Ruiz AN, Sgro´ MA, Springel V, Stadel J, Sutter PM, Tweed D, Zemp
M
(2013)
Structure
ﬁnding
in
cosmological
simulations:
the
state
of
affairs.
MNRAS
435(2):1618–1658. https://doi.org/10.1093/mnras/stt1403. arXiv:1304.0585 [astro-ph.CO]
Knebe A, Pearce FR, Thomas PA, Benson A, Blaizot J, Bower R, Carretero J, Castander FJ, Cattaneo A,
Cora SA, Croton DJ, Cui W, Cunnama D, De Lucia G, Devriendt JE, Elahi PJ, Font A, Fontanot F,
Garcia-Bellido J, Gargiulo ID, Gonzalez-Perez V, Helly J, Henriques B, Hirschmann M, Lee J,
Mamon GA, Monaco P, Onions J, Padilla ND, Power C, Pujol A, Skibba RA, Somerville RS,
Srisawat C, Vega-Martı´nez CA, Yi SK (2015) nIFTy cosmology: comparison of galaxy formation
models. MNRAS 451(4):4029–4059. https://doi.org/10.1093/mnras/stv1149. arXiv:1505.04607
[astro-ph.GA]
Knebe A, Pearce FR, Gonzalez-Perez V, Thomas PA, Benson A, Asquith R, Blaizot J, Bower R,
Carretero J, Castander FJ, Cattaneo A, Cora SA, Croton DJ, Cui W, Cunnama D, Devriendt JE,
Elahi PJ, Font A, Fontanot F, Gargiulo ID, Helly J, Henriques B, Lee J, Mamon GA, Onions J,
123
1
Page 176 of 200
R. E. Angulo, O. Hahn

Padilla ND, Power C, Pujol A, Ruiz AN, Srisawat C, Stevens ARH, Tollet E, Vega-Martı´nez CA, Yi
SK (2018) Cosmic CARNage I: on the calibration of galaxy formation models. MNRAS
475(3):2936–2954. https://doi.org/10.1093/mnras/stx3274. arXiv:1712.06420 [astro-ph.GA]
Knirck S, Millar AJ, O’Hare CAJ, Redondo J, Steffen FD (2018) Directional axion detection. JCAP
11:051. https://doi.org/10.1088/1475-7516/2018/11/051. arXiv:1806.05927 [astro-ph.CO]
Knollmann SR, Knebe A (2009) AHF: Amiga’s Halo Finder. ApJS 182(2):608–624. https://doi.org/10.
1088/0067-0049/182/2/608. arXiv:0904.3662 [astro-ph.CO]
Kobayashi T, Murgia R, De Simone A, Irsˇicˇ V, Viel M (2017) Lyman-a constraints on ultralight scalar
dark matter: Implications for the early and late universe. Phys Rev D 96(12):123514. https://doi.org/
10.1103/PhysRevD.96.123514. arXiv:1708.00015 [astro-ph.CO]
Kobayashi Y, Nishimichi T, Takada M, Takahashi R, Osato K (2020) Accurate emulator for the redshift-
space power spectrum of dark matter halos and its application to galaxy power spectrum. Phys Rev
D 102(6):063504. https://doi.org/10.1103/PhysRevD.102.063504. arXiv:2005.06122 [astro-ph.CO]
Kochanek CS, White M (2000) A Quantitative Study of Interacting Dark Matter in Halos. ApJ
543:514–520. https://doi.org/10.1086/317149. arXiv:astro-ph/0003483
Koda J, Shapiro PR (2011) Gravothermal collapse of isolated self-interacting dark matter haloes: N-body
simulation versus the ﬂuid model. MNRAS 415(2):1125–1137. https://doi.org/10.1111/j.1365-2966.
2011.18684.x. arXiv:1101.3097 [astro-ph.CO]
Koda J, Blake C, Beutler F, Kazin E, Marin F (2016) Fast and accurate mock catalogue generation for
low-mass galaxies. MNRAS 459(2):2118–2129. https://doi.org/10.1093/mnras/stw763. arXiv:1507.
05329 [astro-ph.CO]
KodiRamanah D, Charnock T, Villaescusa-Navarro F, Wandelt BD (2020) Super-resolution emulator of
cosmological simulations using deep physical models. MNRAS 495(4):4227–4236. https://doi.org/
10.1093/mnras/staa1428. arXiv:2001.05519 [astro-ph.CO]
Kofman L, Pogosyan D, Shandarin SF, Melott AL (1992) Coherent Structures in the Universe and the
Adhesion Model. ApJ 393:437. https://doi.org/10.1086/171517
Kofman LA, Shandarin SF (1988) Theory of adhesion for the large-scale structure of the Universe. Nature
334(6178):129–131. https://doi.org/10.1038/334129a0
Kokron N, DeRose J, Chen SF, White M, Wechsler RH (2021) The cosmology dependence of galaxy
clustering and lensing from a hybrid N-body-perturbation theory model. MNRAS 505:1422–1440.
https://doi.org/10.1093/mnras/stab1358
Kolb EW, Tkachev II (1996) Femtolensing and Picolensing by Axion Miniclusters. ApJ 460:L25. https://
doi.org/10.1086/309962. arXiv:astro-ph/9510043 [astro-ph]
Kopp M, Uhlemann C, Haugg T (2014) Newton to Einstein—dust to dust. JCAP 3:018. https://doi.org/10.
1088/1475-7516/2014/03/018. arXiv:1312.3638 [astro-ph.CO]
Kopp M, Vattis K, Skordis C (2017) Solving the Vlasov equation in two spatial dimensions with the
Schro¨dinger method. Phys Rev D 96(12):123532. https://doi.org/10.1103/PhysRevD.96.123532.
arXiv:1711.00140
Koyama K (2016) Cosmological tests of modiﬁed gravity. Rep Prog Phys 79(4):046902. https://doi.org/
10.1088/0034-4885/79/4/046902. arXiv:1504.04623 [astro-ph.CO]
Kravtsov AV, Klypin AA, Khokhlov AM (1997) Adaptive Reﬁnement Tree: A New High-Resolution
N-Body Code for Cosmological Simulations. ApJS 111(1):73–94. https://doi.org/10.1086/313015.
arXiv:astro-ph/9701195 [astro-ph]
Kravtsov AV, Klypin A, Hoffman Y (2002) Constrained Simulations of the Real Universe. II.
Observational
Signatures
of
Intergalactic
Gas
in
the
Local
Supercluster
Region.
ApJ
571(2):563–575. https://doi.org/10.1086/340046. arXiv:astro-ph/0109077 [astro-ph]
Kravtsov AV, Berlind AA, Wechsler RH, Klypin AA, Gottlo¨ber S, Allgood B, Primack JR (2004) The
Dark Side of the Halo Occupation Distribution. ApJ 609(1):35–49. https://doi.org/10.1086/420959.
arXiv:astro-ph/0308519 [astro-ph]
Kuhlen M, Vogelsberger M, Angulo R (2012) Numerical simulations of the dark universe: State of the art
and the next decade. Phys Dark Universe 1:50–93. https://doi.org/10.1016/j.dark.2012.10.002.
arXiv:1209.5745 [astro-ph.CO]
Kuo JL, Lattanzi M, Cheung K, Valle JWF (2018) Decaying warm dark matter and structure formation.
JCAP 12:026. https://doi.org/10.1088/1475-7516/2018/12/026. arXiv:1803.05650 [astro-ph.CO]
Kurzak
J,
Pettitt
BM
(2006)
Fast
multipole
methods
for
particle
dynamics.
Mol
Simul
32(10–11):775–790. https://doi.org/10.1080/08927020600991161
123
Large-scale dark matter simulations
Page 177 of 200
1

Kwan J, Heitmann K, Habib S, Padmanabhan N, Finkel H, Lawrence E, Frontiere N, Pope A (2015)
Cosmic Emulation: Fast Predictions for the Galaxy Power Spectrum. Astrophys J 810(1):35. https://
doi.org/10.1088/0004-637X/810/1/35. arXiv:1311.6444 [astro-ph.CO]
Lacey C, Cole S (1994) Merger Rates in Hierarchical Models of Galaxy Formation – II. Comparison with
N-Body Simulations. MNRAS 271:676. https://doi.org/10.1093/mnras/271.3.676. arXiv:astro-ph/
9402069 [astro-ph]
Lagos CdP, Tobar RJ, Robotham ASG, Obreschkow D, Mitchell PD, Power C, Elahi PJ (2018) Shark:
introducing an open source, free, and ﬂexible semi-analytic model of galaxy formation. MNRAS
481(3):3573–3603. https://doi.org/10.1093/mnras/sty2440. arXiv:1807.11180 [astro-ph.GA]
Laigle C, Pichon C, Codis S, Dubois Y, Le Borgne D, Pogosyan D, Devriendt J, Peirani S, Prunet S,
Rouberol S, Slyz A, Sousbie T (2015) Swirling around ﬁlaments: are large-scale structure vortices
spinning up dark haloes? MNRAS 446(3):2744–2759. https://doi.org/10.1093/mnras/stu2289. arXiv:
1310.3801 [astro-ph.CO]
Lanczos C (1986) The Variational Principles of Mechanics, Dover Books On Physics. Dover
Publications, Mineola
Lange JU, van den Bosch FC, Zentner AR, Wang K, Hearin AP, Guo H (2019) Cosmological Evidence
Modelling: a new simulation-based approach to constrain cosmology on non-linear scales. MNRAS
490(2):1870–1878. https://doi.org/10.1093/mnras/stz2664. arXiv:1909.03107 [astro-ph.CO]
Lange JU, Hearin AP, Leauthaud A, van den Bosch FC, Guo H, DeRose J (2022) Five-percent
measurements of the growth rate from simulation-based modelling of redshift-space clustering in
BOSS LOWZ. MNRAS 509:1779–1804. https://doi.org/10.1093/mnras/stab3111
Laskar J (1993) Frequency analysis for multi-dimensional systems. Global dynamics and diffusion.
Physica D 67:257–281. https://doi.org/10.1016/0167-2789(93)90210-R
Laureijs R, Amiaux J, Arduini S, Augue`res JL, Brinchmann J, Cole R, Cropper M, Dabin C, Duvet L,
Ealet A et al (2011) Euclid Deﬁnition Study Report. arXiv e-prints arXiv:1110.3193 [astro-ph.CO]
Lavaux G, Hudson MJ (2011) The 2M?? galaxy redshift catalogue. MNRAS 416(4):2840–2856. https://
doi.org/10.1111/j.1365-2966.2011.19233.x. arXiv:1105.6107 [astro-ph.CO]
Lavaux G, Jasche J (2016) Unmasking the masked Universe: the 2M?? catalogue through Bayesian
eyes. MNRAS 455(3):3169–3179. https://doi.org/10.1093/mnras/stv2499. arXiv:1509.05040 [astro-
ph.CO]
Lawrence E, Heitmann K, Kwan J, Upadhye A, Bingham D, Habib S, Higdon D, Pope A, Finkel H,
Frontiere N (2017) The Mira-Titan Universe. II. Matter Power Spectrum Emulation. ApJ 847(1):50.
https://doi.org/10.3847/1538-4357/aa86a9. arXiv:1705.03388 [astro-ph.CO]
Lazeyras T, Schmidt F (2018) Beyond LIMD bias: a measurement of the complete set of third-order halo
bias parameters. JCAP 9:008. https://doi.org/10.1088/1475-7516/2018/09/008. arXiv:1712.07531
[astro-ph.CO]
Lazeyras T, Schmidt F (2019) A robust measurement of the ﬁrst higher-derivative bias of dark matter
halos. JCAP 11:041. https://doi.org/10.1088/1475-7516/2019/11/041. arXiv:1904.11294 [astro-
ph.CO]
Lazeyras T, Wagner C, Baldauf T, Schmidt F (2016) Precision measurement of the local bias of dark
matter halos. JCAP 2:018. https://doi.org/10.1088/1475-7516/2016/02/018. arXiv:1511.01096 [as-
tro-ph.CO]
Lazeyras T, Musso M, Schmidt F (2017) Large-scale assembly bias of dark matter halos. JCAP 3:059.
https://doi.org/10.1088/1475-7516/2017/03/059. arXiv:1612.04360 [astro-ph.CO]
Le Brun AMC, McCarthy IG, Schaye J, Ponman TJ (2014) Towards a realistic population of simulated
galaxy groups and clusters. MNRAS 441:1270–1290. https://doi.org/10.1093/mnras/stu608. arXiv:
1312.5462
Leane RK (2020) Indirect Detection of Dark Matter in the Galaxy. arXiv e-prints arXiv:2006.00513 [hep-
ph]
Leclercq F, Faure B, Lavaux G, Wandelt BD, Jaffe AH, Heavens AF, Percival WJ (2020) Perfectly
parallel cosmological simulations using spatial comoving Lagrangian acceleration. A&A 639:A91.
https://doi.org/10.1051/0004-6361/202037995. arXiv:2003.04925 [astro-ph.CO]
Lehmann BV, Mao YY, Becker MR, Skillman SW, Wechsler RH (2017) The Concentration Dependence
of the Galaxy-Halo Connection: Modeling Assembly Bias with Abundance Matching. ApJ
834(1):37. https://doi.org/10.3847/1538-4357/834/1/37. arXiv:1510.05651 [astro-ph.CO]
Leistedt B, Peiris HV, Roth N (2014) Constraints on Primordial Non-Gaussianity from 800 000
Photometric Quasars. Phys Rev Lett 113(22):221301. https://doi.org/10.1103/PhysRevLett.113.
221301. arXiv:1405.4315 [astro-ph.CO]
123
1
Page 178 of 200
R. E. Angulo, O. Hahn

Lemson G, Virgo Consortium t (2006) Halo and Galaxy Formation Histories from the Millennium
Simulation: Public release of a VO-oriented and SQL-queryable database for studying the evolution
of galaxies in the LambdaCDM cosmogony. arXiv e-prints astro-ph/0608019
Leo M, Baugh CM, Li B, Pascoli S (2017) The effect of thermal velocities on structure formation in
N-body simulations of warm dark matter. JCAP 11:017. https://doi.org/10.1088/1475-7516/2017/11/
017. arXiv:1706.07837 [astro-ph.CO]
Lepori F, Adamek J, Durrer R (2021) Cosmological Simulations of Number Counts. JCAP 2021(12):021.
https://doi.org/10.1088/1475-7516/2021/12/021
Leroy M, Garrison L, Eisenstein D, Joyce M, Maleubre S (2021) Testing dark matter halo properties
using self-similarity. MNRAS 501(4):5064–5072. https://doi.org/10.1093/mnras/staa3435. arXiv:
2004.08406 [astro-ph.CO]
Lesgourgues J (2011) The Cosmic Linear Anisotropy Solving System (CLASS) I: Overview. arXiv
e-prints arXiv:1104.2932 [astro-ph.IM]
Lesgourgues J, Pastor S, Perotto L (2004) Probing neutrino masses with future galaxy redshift surveys.
Phys Rev D 70(4):045016. https://doi.org/10.1103/PhysRevD.70.045016. arXiv:hep-ph/0403296
[hep-ph]
Lewis A, Challinor A, Lasenby A (2000) Efﬁcient computation of CMB anisotropies in closed FRW
models. ApJ 538:473–476. https://doi.org/10.1086/309179. arXiv:astro-ph/9911177 [astro-ph]
Li B, Zhao GB, Teyssier R, Koyama K (2012a) ECOSMOG: an Efﬁcient COde for Simulating MOdiﬁed
Gravity. JCAP 1:051. https://doi.org/10.1088/1475-7516/2012/01/051. arXiv:1110.1379 [astro-
ph.CO]
Li F, Erickcek AL, Law NM (2012b) A new probe of the small-scale primordial power spectrum:
Astrometric microlensing by ultracompact minihalos. Phys Rev D 86(4):043519. https://doi.org/10.
1103/PhysRevD.86.043519. arXiv:1202.1284 [astro-ph.CO]
Li Y, Hu W, Takada M (2014) Super-sample covariance in simulations. Phys Rev D 89(8):083519.
https://doi.org/10.1103/PhysRevD.89.083519. arXiv:1401.0385 [astro-ph.CO]
Li Y, Schmittfull M, Seljak U (2018) Galaxy power-spectrum responses and redshift-space super-sample
effect. JCAP 2:022. https://doi.org/10.1088/1475-7516/2018/02/022. arXiv:1711.00018 [astro-
ph.CO]
Li Y, Ni Y, Croft RAC, Di Matteo T, Bird S, Feng Y (2020) AI-assisted super-resolution cosmological
simulations. arXiv e-prints arXiv:2010.06608 [astro-ph.CO]
Liao S (2018) An alternative method to generate pre-initial conditions for cosmological N-body
simulations. MNRAS 481(3):3750–3760. https://doi.org/10.1093/mnras/sty2523. arXiv:1807.03574
[astro-ph.GA]
Libeskind NI, van de Weygaert R, Cautun M, Falck B, Tempel E, Abel T, Alpaslan M, Arago´n-Calvo
MA, Forero-Romero JE, Gonzalez R, Gottlo¨ber S, Hahn O, Hellwing WA, Hoffman Y, Jones BJT,
Kitaura F, Knebe A, Manti S, Neyrinck M, Nuza SE, Padilla N, Platen E, Ramachandra N,
Robotham A, Saar E, Shandarin S, Steinmetz M, Stoica RS, Sousbie T, Yepes G (2018) Tracing the
cosmic web. MNRAS 473(1):1195–1217. https://doi.org/10.1093/mnras/stx1976. arXiv:1705.03021
[astro-ph.CO]
Lippich M, Sa´nchez AG (2021) MEDUSA: Minkowski functionals estimated from Delaunay tessellations
of the three-dimensional large-scale structure. MNRAS 508:3771–3784. https://doi.org/10.1093/
mnras/stab2820
Lippich M, Sa´nchez AG, Colavincenzo M, Sefusatti E, Monaco P, Blot L, Crocce M, Alvarez MA,
Agrawal A, Avila S, Balaguera-Antolı´nez A, Bond R, Codis S, Dalla Vecchia C, Dorta A, Fosalba P,
Izard A, Kitaura FS, Pellejero-Iban˜ez M, Stein G, Vakili M, Yepes G (2019) Comparing
approximate methods for mock catalogues and covariance matrices—I. Correlation function.
MNRAS
482(2):1786–1806.
https://doi.org/10.1093/mnras/sty2757.
arXiv:1806.09477
[astro-
ph.CO]
List F, Bhat I, Lewis GF (2019a) A black box for dark sector physics: predicting dark matter annihilation
feedback with conditional GANs. MNRAS 490(3):3134–3143. https://doi.org/10.1093/mnras/
stz2759. arXiv:1910.00291 [astro-ph.CO]
List F, Iwanus N, Elahi PJ, Lewis GF (2019b) A novel scheme for Dark Matter Annihilation Feedback in
cosmological
simulations.
MNRAS
489(3):4217–4232.
https://doi.org/10.1093/mnras/stz2287.
arXiv:1908.05812 [astro-ph.CO]
Liu J, Petri A, Haiman Z, Hui L, Kratochvil JM, May M (2015) Cosmology constraints from the weak
lensing peak counts and the power spectrum in CFHTLenS data. Phys Rev D 91(6):063507. https://
doi.org/10.1103/PhysRevD.91.063507. arXiv:1412.0757 [astro-ph.CO]
123
Large-scale dark matter simulations
Page 179 of 200
1

Llinares C (2017) The shrinking domain framework I: a new, faster, more efﬁcient approach to
cosmological simulations. arXiv e-prints arXiv:1709.04703 [astro-ph.CO]
Llinares C (2018) Simulation techniques for modiﬁed gravity. Int J Mod Phys D 27:1848003. https://doi.
org/10.1142/S0218271818480036
Llinares C, Mota DF (2014) Cosmological simulations of screened modiﬁed gravity out of the static
approximation: Effects on matter distribution. Phys Rev D 89(8):084023. https://doi.org/10.1103/
PhysRevD.89.084023. arXiv:1312.6016 [astro-ph.CO]
Llinares C, Mota DF, Winther HA (2014) ISIS: a new N-body cosmological code with scalar ﬁelds based
on RAMSES. Code presentation and application to the shapes of clusters. A&A 562:A78. https://
doi.org/10.1051/0004-6361/201322412. arXiv:1307.6748 [astro-ph.CO]
Loeb A, Zaldarriaga M (2005) Small-scale power spectrum of cold dark matter. Phys Rev D
71(10):103520. https://doi.org/10.1103/PhysRevD.71.103520. arXiv:astro-ph/0504112 [astro-ph]
Lombriser L (2016) A parametrisation of modiﬁed gravity on nonlinear cosmological scales. JCAP
2016(11):039. https://doi.org/10.1088/1475-7516/2016/11/039. arXiv:1608.00522 [astro-ph.CO]
Lovell MR, Eke V, Frenk CS, Gao L, Jenkins A, Theuns T, Wang J, White SDM, Boyarsky A,
Ruchayskiy O (2012) The haloes of bright satellite galaxies in a warm dark matter universe.
MNRAS 420(3):2318–2324. https://doi.org/10.1111/j.1365-2966.2011.20200.x. arXiv:1104.2929
[astro-ph.CO]
Lovell MR, Frenk CS, Eke VR, Jenkins A, Gao L, Theuns T (2014) The properties of warm dark matter
haloes. MNRAS 439(1):300–317. https://doi.org/10.1093/mnras/stt2431. arXiv:1308.1399 [astro-
ph.CO]
Lovell MR, Zavala J, Vogelsberger M, Shen X, Cyr-Racine FY, Pfrommer C, Sigurdson K, Boylan-
Kolchin M, Pillepich A (2018) ETHOS—an effective theory of structure formation: predictions for
the high-redshift Universe - abundance of galaxies and reionization. MNRAS 477(3):2886–2899.
https://doi.org/10.1093/mnras/sty818. arXiv:1711.10497 [astro-ph.CO]
Lovell MR, Zavala J, Vogelsberger M (2019) ETHOS—an effective theory of structure formation:
formation of the ﬁrst haloes and their stars. MNRAS 485(4):5474–5489. https://doi.org/10.1093/
mnras/stz766. arXiv:1812.04627 [astro-ph.GA]
LoVerde M, Smith KM (2011) The non-Gaussian halo mass function with fNL, gNL and sNL. JCAP
8:003. https://doi.org/10.1088/1475-7516/2011/08/003. arXiv:1102.1439 [astro-ph.CO]
Ludlow AD, Navarro JF, Angulo RE, Boylan-Kolchin M, Springel V, Frenk C, White SDM (2014) The
mass-concentration-redshift relation of cold dark matter haloes. MNRAS 441(1):378–388. https://
doi.org/10.1093/mnras/stu483. arXiv:1312.0945 [astro-ph.CO]
Ludlow AD, Bose S, Angulo RE, Wang L, Hellwing WA, Navarro JF, Cole S, Frenk CS (2016) The
mass-concentration-redshift
relation
of
cold
and
warm
dark
matter
haloes.
MNRAS
460(2):1214–1232. https://doi.org/10.1093/mnras/stw1046. arXiv:1601.02624 [astro-ph.CO]
Ludlow AD, Schaye J, Bower R (2019) Numerical convergence of simulations of galaxy formation: the
abundance and internal structure of cold dark matter haloes. MNRAS 488(3):3663–3684. https://doi.
org/10.1093/mnras/stz1821. arXiv:1812.05777 [astro-ph.CO]
Ma CP, Bertschinger E (1994) A Calculation of the Full Neutrino Phase Space in Cold ? Hot Dark Matter
Models. ApJ 429:22. https://doi.org/10.1086/174298. arXiv:astro-ph/9308006 [astro-ph]
Maccio` AV, Paduroiu S, Anderhalden D, Schneider A, Moore B (2012) Cores in warm dark matter
haloes: a Catch 22 problem. MNRAS 424(2):1105–1112. https://doi.org/10.1111/j.1365-2966.2012.
21284.x. arXiv:1202.1282 [astro-ph.CO]
Maciejewski M, Colombi S, Springel V, Alard C, Bouchet FR (2009) Phase-space structures—II.
Hierarchical Structure Finder. MNRAS 396(3):1329–1348. https://doi.org/10.1111/j.1365-2966.
2009.14825.x. arXiv:0812.0288 [astro-ph]
Macpherson HJ, Price DJ, Lasky PD (2019) Einstein’s Universe: Cosmological structure formation in
numerical relativity. Phys Rev D 99(6):063522. https://doi.org/10.1103/PhysRevD.99.063522.
arXiv:1807.01711 [astro-ph.CO]
Madelung E (1927) Quantentheorie in hydrodynamischer Form. Z Phys 40:322–326. https://doi.org/10.
1007/BF01400372
Mafﬁone NP, Go´mez FA, Cincotta PM, Giordano CM, Cooper AP, O’Shea BW (2015) On the relevance
of chaos for halo stars in the solar neighbourhood. MNRAS 453(3):2830–2847. https://doi.org/10.
1093/mnras/stv1778. arXiv:1508.00579 [astro-ph.GA]
Magnus W (1954) On the exponential solution of differential equations for a linear operator. Commun
Pure Appl Math 7(4):649–673. https://doi.org/10.1002/cpa.3160070404
123
1
Page 180 of 200
R. E. Angulo, O. Hahn

Makiya R, Enoki M, Ishiyama T, Kobayashi MAR, Nagashima M, Okamoto T, Okoshi K, Oogi T,
Shirakata H (2016) The New Numerical Galaxy Catalog (m2GC): An updated semi-analytic model of
galaxy and active galactic nucleus formation with large cosmological N-body simulations. PASJ
68(2):25. https://doi.org/10.1093/pasj/psw005. arXiv:1508.07215 [astro-ph.GA]
Maldacena J (2003) Non-gaussian features of primordial ﬂuctuations in single ﬁeld inﬂationary models.
J High Energy Phys 2003(5):013. https://doi.org/10.1088/1126-6708/2003/05/013. arXiv:astro-ph/
0210603 [astro-ph]
Manera M, Scoccimarro R, Percival WJ, Samushia L, McBride CK, Ross AJ, Sheth RK, White M, Reid
BA, Sa´nchez AG, de Putter R, Xu X, Berlind AA, Brinkmann J, Maraston C, Nichol B, Montesano
F, Padmanabhan N, Skibba RA, Tojeiro R, Weaver BA (2013) The clustering of galaxies in the
SDSS-III Baryon Oscillation Spectroscopic Survey: a large sample of mock galaxy catalogues.
MNRAS 428(2):1036–1054. https://doi.org/10.1093/mnras/sts084. arXiv:1203.6609 [astro-ph.CO]
Mansﬁeld P, Avestruz C (2021) How biased are halo properties in cosmological simulations? MNRAS
500(3):3309–3328. https://doi.org/10.1093/mnras/staa3388. arXiv:2008.08591 [astro-ph.CO]
Mao YY, Williamson M, Wechsler RH (2015) The Dependence of Subhalo Abundance on Halo
Concentration. ApJ 810(1):21. https://doi.org/10.1088/0004-637X/810/1/21. arXiv:1503.02637
[astro-ph.CO]
Marcos B (2008) Particle linear theory on a self-gravitating perturbed cubic Bravais lattice. Phys Rev D
78(4):043536. https://doi.org/10.1103/PhysRevD.78.043536. arXiv:0804.2570 [astro-ph]
Marcos B, Baertschiger T, Joyce M, Gabrielli A, Sylos Labini F (2006) Linear perturbative theory of the
discrete cosmological N-body problem. Phys Rev D 73(10):103507. https://doi.org/10.1103/
PhysRevD.73.103507. arXiv:astro-ph/0601479
Marı´n FA, Wechsler RH, Frieman JA, Nichol RC (2008) Modeling the Galaxy Three-Point Correlation
Function. ApJ 672(2):849–860. https://doi.org/10.1086/523628. arXiv:0704.0255 [astro-ph]
Marsh DJE (2016) Axion cosmology. Phys Rep 643:1–79. https://doi.org/10.1016/j.physrep.2016.06.005.
arXiv:1510.07633
Martel H, Shapiro PR (1998) A convenient set of comoving cosmological variables and their application.
MNRAS 297:467–485. https://doi.org/10.1046/j.1365-8711.1998.01497.x. arXiv:astro-ph/9710119
Masaki S, Nishimichi T, Takada M (2020) Anisotropic separate universe simulations. MNRAS
496(1):483–496. https://doi.org/10.1093/mnras/staa1579. arXiv:2003.10052 [astro-ph.CO]
Matarrese S, Verde L (2008) The Effect of Primordial Non-Gaussianity on Halo Bias. ApJ 677(2):L77.
https://doi.org/10.1086/587840. arXiv:0801.4826 [astro-ph]
Matsubara T (2015) Recursive Solutions of Lagrangian Perturbation Theory. Phys Rev D 92(2):023534.
https://doi.org/10.1103/PhysRevD.92.023534. arXiv:1505.01481 [astro-ph.CO]
May S, Springel V (2021) Structure formation in large-volume cosmological simulations of fuzzy dark
matter: Impact of the non-linear dynamics. arXiv e-prints arXiv:2101.01828 [astro-ph.CO]
McCarthy IG, Schaye J, Bird S, Le Brun AMC (2017) The BAHAMAS project: calibrated
hydrodynamical simulations for large-scale structure cosmology. MNRAS 465:2936–2965.
https://doi.org/10.1093/mnras/stw2792. arXiv:1603.02702
McClintock T, Rozo E, Becker MR, DeRose J, Mao YY, McLaughlin S, Tinker JL, Wechsler RH, Zhai Z
(2019) The Aemulus Project II: Emulating the Halo Mass Function. Astrophys J 872(1):53. https://
doi.org/10.3847/1538-4357/aaf568. arXiv:1804.05866 [astro-ph.CO]
McDonald P (2008) Primordial non-Gaussianity: Large-scale structure signature in the perturbative bias
model. Phys Rev D 78(12):123519. https://doi.org/10.1103/PhysRevD.78.123519. arXiv:0806.1061
[astro-ph]
McMillan SLW (1986) The Vectorization of Small-N Integrators. In: Hut P, McMillan SLW (eds) The
Use of Supercomputers in Stellar Dynamics. Lecture Notes in Physics, vol 267. Springer, Berlin,
p 156. https://doi.org/10.1007/BFb0116406
Mead AJ, Peacock JA, Heymans C, Joudaki S, Heavens AF (2015a) An accurate halo model for ﬁtting
non-linear cosmological power spectra and baryonic feedback models. MNRAS 454(2):1958–1975.
https://doi.org/10.1093/mnras/stv2036. arXiv:1505.07833 [astro-ph.CO]
Mead AJ, Peacock JA, Lombriser L, Li B (2015b) Rapid simulation rescaling from standard to modiﬁed
gravity models. MNRAS 452(4):4203–4221. https://doi.org/10.1093/mnras/stv1484. arXiv:1412.
5195 [astro-ph.CO]
Mead AJ, Heymans C, Lombriser L, Peacock JA, Steele OI, Winther HA (2016) Accurate halo-model
matter power spectra with dark energy, massive neutrinos and modiﬁed gravitational forces.
123
Large-scale dark matter simulations
Page 181 of 200
1

MNRAS
459(2):1468–1488.
https://doi.org/10.1093/mnras/stw681.
arXiv:1602.02154
[astro-
ph.CO]
Mead A, Brieden S, Tro¨ster T, Heymans C (2021) HMcode-2020: Improved modelling of non-linear
cosmological power spectra with baryonic feedback. MNRAS 502:1401–1422. https://doi.org/10.
1093/mnras/stab082
Melott AL (2007) Comment on ‘Discreteness Effects in Simulations of Hot/Warm Dark Matter’ by J.
Wang & S.D.M. White. arXiv e-prints 07090745arXiv:0709.0745
Melott AL, Shandarin SF (1989) Gravitational instability with high resolution. ApJ 343:26–30. https://
doi.org/10.1086/167681
Melott AL, Shandarin SF, RaJ Splinter, Suto Y (1997) Demonstrating Discreteness and Collision Error in
Cosmological N-Body Simulations of Dark Matter Gravitational Clustering. ApJ 479(2):L79–L83.
https://doi.org/10.1086/310590. arXiv:astro-ph/9609152 [astro-ph]
Merloni A, Predehl P, Becker W, Bo¨hringer H, Boller T, Brunner H, Brusa M, Dennerl K, Freyberg M,
Friedrich P, Georgakakis A, Haberl F, Hasinger G, Meidinger N, Mohr J, Nandra K, Rau A,
Reiprich TH, Robrade J, Salvato M, Santangelo A, Sasaki M, Schwope A, Wilms J, German
eROSITA Consortium (2012) eROSITA Science Book: Mapping the Structure of the Energetic
Universe. arXiv e-prints arXiv:1209.3114 [astro-ph.HE]
Merson AI, Baugh CM, Helly JC, Gonzalez-Perez V, Cole S, Bielby R, Norberg P, Frenk CS, Benson AJ,
Bower RG, Lacey CG, Lagos CdP (2013) Lightcone mock catalogues from semi-analytic models of
galaxy formation—I. Construction and application to the BzK colour selection. MNRAS
429(1):556–578. https://doi.org/10.1093/mnras/sts355. arXiv:1206.4049 [astro-ph.CO]
Merson A, Wang Y, Benson A, Faisst A, Masters D, Kiessling A, Rhodes J (2018) Predicting Ha
emission-line galaxy counts for future galaxy redshift surveys. MNRAS 474(1):177–196. https://doi.
org/10.1093/mnras/stx2649. arXiv:1710.00833 [astro-ph.GA]
Merz H, Pen UL, Trac H (2005) Towards optimal parallel PM N-body codes: PMFAST. New A
10(5):393–407. https://doi.org/10.1016/j.newast.2005.02.001. arXiv:astro-ph/0402443 [astro-ph]
Michaux M, Hahn O, Rampf C, Angulo RE (2021) Accurate initial conditions for cosmological N-body
simulations: minimizing truncation and discreteness errors. MNRAS 500(1):663–683. https://doi.
org/10.1093/mnras/staa3149. arXiv:2008.09588 [astro-ph.CO]
Milillo I, Bertacca D, Bruni M, Maselli A (2015) Missing link: A nonlinear post-Friedmann framework
for small and large scales. Phys Rev D 92(2):023519. https://doi.org/10.1103/PhysRevD.92.023519.
arXiv:1502.02985 [gr-qc]
Miller RH (1983) Numerical experiments on the clustering of galaxies. ApJ 270:390–409. https://doi.org/
10.1086/161133
Miller RH, Prendergast KH (1968) Stellar Dynamics in a Discrete Phase Space. ApJ 151:699. https://doi.
org/10.1086/149469
Mina M, Mota DF, Winther HA (2020) SCALAR: an AMR code to simulate axion-like dark matter
models.
A&A
641:A107.
https://doi.org/10.1051/0004-6361/201936272.
arXiv:1906.12160
[physics.comp-ph]
Miniati F, Colella P (2007) Block structured adaptive mesh and time reﬁnement for hybrid, hyperbolic ?
N-body systems. J Comput Phys 227(1):400–430. https://doi.org/10.1016/j.jcp.2007.07.035. arXiv:
astro-ph/0608156 [astro-ph]
Misner C, Thorne K, Wheeler J (1973) Gravitation. W. H. Freeman, New York
Miyoshi K, Kihara T (1975) Development of the correlation of galaxies in an expanding universe. PASJ
27:333–346
Mocz P, Succi S (2015) Numerical solution of the nonlinear Schro¨dinger equation using smoothed-
particle hydrodynamics. Phys Rev E 91(5):053304. https://doi.org/10.1103/PhysRevE.91.053304.
arXiv:1503.03869 [physics.comp-ph]
Mocz P, Succi S (2017) Integer lattice dynamics for Vlasov-Poisson. MNRAS 465:3154–3162. https://
doi.org/10.1093/mnras/stw2928. arXiv:1611.02757
Mocz P, Vogelsberger M, Robles VH, Zavala J, Boylan-Kolchin M, Fialkov A, Hernquist L (2017)
Galaxy formation with BECDM—I. Turbulence and relaxation of idealized haloes. MNRAS
471(4):4559–4570. https://doi.org/10.1093/mnras/stx1887. arXiv:1705.05845 [astro-ph.CO]
Mocz P, Lancaster L, Fialkov A, Becerra F, Chavanis PH (2018) Schro¨dinger-Poisson-Vlasov-Poisson
correspondence. Phys Rev D 97(8):083519. https://doi.org/10.1103/PhysRevD.97.083519. arXiv:
1801.03507
Mocz P, Fialkov A, Vogelsberger M, Becerra F, Shen X, Robles VH, Amin MA, Zavala J, Boylan-
Kolchin M, Bose S, Marinacci F, Chavanis PH, Lancaster L, Hernquist L (2020) Galaxy formation
123
1
Page 182 of 200
R. E. Angulo, O. Hahn

with BECDM—II. Cosmic ﬁlaments and ﬁrst galaxies. MNRAS 494(2):2027–2044. https://doi.org/
10.1093/mnras/staa738. arXiv:1911.05746 [astro-ph.CO]
Modi C, Chen SF, White M (2020a) Simulations and symmetries. MNRAS 492(4):5754–5763. https://
doi.org/10.1093/mnras/staa251. arXiv:1910.07097 [astro-ph.CO]
Modi C, Lanusse F, Seljak U (2020b) FlowPM: Distributed TensorFlow Implementation of the FastPM
Cosmological N-body Solver. arXiv e-prints arXiv:2010.11847 [astro-ph.CO]
Mohammed I, Martizzi D, Teyssier R, Amara A (2014) Baryonic effects on weak-lensing two-point
statistics and its cosmological implications. arXiv e-prints arXiv:1410.6826
Mohayaee R, Mathis H, Colombi S, Silk J (2006) Reconstruction of primordial density ﬁelds. MNRAS
365(3):939–959. https://doi.org/10.1111/j.1365-2966.2005.09774.x. arXiv:astro-ph/0501217 [astro-
ph]
Monaco P (2016) Approximate Methods for the Generation of Dark Matter Halo Catalogs in the Age of
Precision Cosmology. Galaxies 4(4):53. https://doi.org/10.3390/galaxies4040053. arXiv:1605.07752
[astro-ph.CO]
Monaco P, Theuns T, Taffoni G (2002) The pinocchio algorithm: pinpointing orbit-crossing collapsed
hierarchical objects in a linear density ﬁeld. MNRAS 331(3):587–608. https://doi.org/10.1046/j.
1365-8711.2002.05162.x. arXiv:astro-ph/0109323 [astro-ph]
Monaco P, Sefusatti E, Borgani S, Crocce M, Fosalba P, Sheth RK, Theuns T (2013) An accurate tool for
the fast generation of dark matter halo catalogues. MNRAS 433(3):2389–2402. https://doi.org/10.
1093/mnras/stt907. arXiv:1305.1505 [astro-ph.CO]
Moore B, Katz N, Lake G (1996) On the Destruction and Overmerging of Dark Halos in Dissipationless
N-Body Simulations. ApJ 457:455. https://doi.org/10.1086/176745. arXiv:astro-ph/9503088 [astro-
ph]
Moore B, Ghigna S, Governato F, Lake G, Quinn T, Stadel J, Tozzi P (1999) Dark Matter Substructure
within Galactic Halos. ApJ 524(1):L19–L22. https://doi.org/10.1086/312287. arXiv:astro-ph/
9907411 [astro-ph]
More S, Kravtsov AV, Dalal N, Gottlo¨ber S (2011) The Overdensity and Masses of the Friends-of-friends
Halos and Universality of Halo Mass Function. ApJS 195(1):4. https://doi.org/10.1088/0067-0049/
195/1/4. arXiv:1103.0005 [astro-ph.CO]
Moster BP, Naab T, White SDM (2013) Galactic star formation and accretion histories from matching
galaxies to dark matter haloes. MNRAS 428(4):3121–3138. https://doi.org/10.1093/mnras/sts261.
arXiv:1205.5807 [astro-ph.CO]
Moster BP, Naab T, White SDM (2018) EMERGE—an empirical model for the formation of galaxies
since z 	 10. MNRAS 477(2):1822–1852. https://doi.org/10.1093/mnras/sty655. arXiv:1705.05373
[astro-ph.GA]
Mueller EM, Percival W, Linder E, Alam S, Zhao GB, Sa´nchez AG, Beutler F, Brinkmann J (2018) The
clustering of galaxies in the completed SDSS-III Baryon Oscillation Spectroscopic Survey:
constraining modiﬁed gravity. MNRAS 475(2):2122–2131. https://doi.org/10.1093/mnras/stx3232.
arXiv:1612.00812 [astro-ph.CO]
Munshi D, Sahni V, Starobinsky AA (1994) Nonlinear approximations to gravitational instability: A
comparison in the quasi-linear regime. ApJ 436:517–527. https://doi.org/10.1086/174925. arXiv:
astro-ph/9402065
Murgia R, Merle A, Viel M, Totzauer M, Schneider A (2017) ‘‘Non-cold’’ dark matter at small scales: a
general approach. JCAP 11:046. https://doi.org/10.1088/1475-7516/2017/11/046. arXiv:1704.07838
[astro-ph.CO]
Mustafa M, Bard D, Bhimji W, Lukic´ Z, Al-Rfou R, Kratochvil JM (2019) CosmoGAN: creating high-
ﬁdelity weak lensing convergence maps using Generative Adversarial Networks. Comput Astrophys
Cosmol 6(1):1. https://doi.org/10.1186/s40668-019-0029-9. arXiv:1706.02390 [astro-ph.IM]
Myers A, Colella P, Van Straalen B (2016) The Convergence of Particle-in-Cell Schemes for
Cosmological Dark Matter Simulations. ApJ 816(2):56. https://doi.org/10.3847/0004-637X/816/2/
56. arXiv:1503.05969 [astro-ph.CO]
Nadler EO, Gluscevic V, Boddy KK, Wechsler RH (2019) Constraints on Dark Matter Microphysics from
the Milky Way Satellite Population. ApJL 878:L32. https://doi.org/10.3847/2041-8213/ab1eb2
Nakagami T, Matsubara T, Schmalzing J, Jing Y (2004) An Analysis of the Large Scale N-body
Simulation using the Minkowski Functionals. arXiv e-prints astro-ph/0408428. arXiv:astro-ph/
0408428 [astro-ph]
Navarro JF, Eke VR, Frenk CS (1996) The cores of dwarf galaxy haloes. MNRAS 283(3):L72–L78.
https://doi.org/10.1093/mnras/283.3.L72. arXiv:astro-ph/9610187 [astro-ph]
123
Large-scale dark matter simulations
Page 183 of 200
1

Navarro JF, Frenk CS, White SDM (1997) A Universal Density Proﬁle from Hierarchical Clustering. ApJ
490:493–508. https://doi.org/10.1086/304888. arXiv:astro-ph/9611107
Navarro JF, Ludlow A, Springel V, Wang J, Vogelsberger M, White SDM, Jenkins A, Frenk CS, Helmi A
(2010) The diversity and similarity of simulated cold dark matter haloes. MNRAS 402(1):21–34.
https://doi.org/10.1111/j.1365-2966.2009.15878.x. arXiv:0810.1522 [astro-ph]
Neto AF, Gao L, Bett P, Cole S, Navarro JF, Frenk CS, White SDM, Springel V, Jenkins A (2007) The
statistics of K CDM halo concentrations. MNRAS 381(4):1450–1462. https://doi.org/10.1111/j.
1365-2966.2007.12381.x. arXiv:0706.2919 [astro-ph]
Newton O, Leo M, Cautun M, Jenkins A, Frenk CS, Lovell MR, Helly JC (2021) Benson AJ (2021)
Constraints on the properties of warm dark matter using the satellite galaxies of the Milky Way.
JCAP 08:062. https://doi.org/10.1088/1475-7516/2021/08/062
Neyrinck MC (2008) ZOBOV: a parameter-free void-ﬁnding algorithm. MNRAS 386(4):2101–2109.
https://doi.org/10.1111/j.1365-2966.2008.13180.x. arXiv:0712.3049 [astro-ph]
Neyrinck MC (2016) Truthing the stretch: non-perturbative cosmological realizations with multiscale
spherical collapse. MNRAS 455(1):L11–L15. https://doi.org/10.1093/mnrasl/slv141. arXiv:1503.
07534 [astro-ph.CO]
Neyrinck MC, Gnedin NY, Hamilton AJS (2005) VOBOZ: an almost-parameter-free halo-ﬁnding
algorithm. MNRAS 356(4):1222–1232. https://doi.org/10.1111/j.1365-2966.2004.08505.x. arXiv:
astro-ph/0402346 [astro-ph]
Neyrinck MC, Szapudi I, McCullagh N, Szalay AS, Falck B, Wang J (2018) Density-dependent
clustering—I. Pullingback the curtains on motions of the BAO peak. MNRAS 478(2):2495–2504.
https://doi.org/10.1093/mnras/sty1074. arXiv:1610.06215 [astro-ph.CO]
Ni Y, Li Y, Lachance P, Croft RAC, Di Matteo T, Bird S, Feng Y (2021) AI-assisted superresolution
cosmological simulations—II. Halo substructures, velocities, and higher order statistics. MNRAS
507(1):1021–1033. https://doi.org/10.1093/mnras/stab2113. arXiv:2105.01016 [astro-ph.CO]
Nishimichi T, Takada M, Takahashi R, Osato K, Shirasaki M, Oogi T, Miyatake H, Oguri M, Murata R,
Kobayashi Y, Yoshida N (2019) Dark Quest. I. Fast and Accurate Emulation of Halo Clustering
Statistics and Its Application to Galaxy Clustering. ApJ 884(1):29. https://doi.org/10.3847/1538-
4357/ab3719. arXiv:1811.09504 [astro-ph.CO]
Nori M, Baldi M (2018) AX-GADGET: a new code for cosmological simulations of Fuzzy Dark Matter
and Axion models. MNRAS 478(3):3935–3951. https://doi.org/10.1093/mnras/sty1224. arXiv:1801.
08144 [astro-ph.CO]
Nori M, Murgia R, Irsˇicˇ V, Baldi M, Viel M (2019) Lyman a forest and non-linear structure
characterization in Fuzzy Dark Matter cosmologies. MNRAS 482(3):3227–3243. https://doi.org/10.
1093/mnras/sty2888. arXiv:1809.09619 [astro-ph.CO]
Ntampaka M, Eisenstein DJ, Yuan S, Garrison LH (2020) A Hybrid Deep Learning Approach to
Cosmological Constraints from Galaxy Redshift Surveys. ApJ 889(2):151. https://doi.org/10.3847/
1538-4357/ab5f5e. arXiv:1909.10527 [astro-ph.CO]
Nuza SE, Sa´nchez AG, Prada F, Klypin A, Schlegel DJ, Gottlo¨ber S, Montero-Dorta AD, Manera M,
McBride CK, Ross AJ, Angulo R, Blanton M, Bolton A, Favole G, Samushia L, Montesano F,
Percival WJ, Padmanabhan N, Steinmetz M, Tinker J, Skibba R, Schneider DP, Guo H, Zehavi I,
Zheng Z, Bizyaev D, Malanushenko O, Malanushenko V, Oravetz AE, Oravetz DJ, Shelden AC
(2013) The clustering of galaxies at z  0.5 in the SDSS-III Data Release 9 BOSS-CMASS sample:
a test for the KCDM cosmology. MNRAS 432(1):743–760. https://doi.org/10.1093/mnras/stt513.
arXiv:1202.6057 [astro-ph.CO]
Ogiya G, Hahn O (2018) What sets the central structure of dark matter haloes? MNRAS
473(4):4339–4359. https://doi.org/10.1093/mnras/stx2639. arXiv:1707.07693 [astro-ph.CO]
Ogiya G, Nagai D, Ishiyama T (2016) Dynamical evolution of primordial dark matter haloes through
mergers. MNRAS 461(3):3385–3396. https://doi.org/10.1093/mnras/stw1551. arXiv:1604.02866
[astro-ph.CO]
Ogiya G, van den Bosch FC, Hahn O, Green SB, Miller TB, Burkert A (2019) DASH: a library of
dynamical subhalo evolution. MNRAS 485(1):189–202. https://doi.org/10.1093/mnras/stz375.
arXiv:1901.08601 [astro-ph.GA]
O’Hare CAJ, Green AM (2017) Axion astronomy with microwave cavity experiments. Phys Rev D
95(6):063017. https://doi.org/10.1103/PhysRevD.95.063017. arXiv:1701.03118 [astro-ph.CO]
O‘Leary RM, McQuinn M (2012) The Formation of the First Cosmic Structures and the Physics of the
z 	 20 Universe. ApJ 760(1):4. https://doi.org/10.1088/0004-637X/760/1/4. arXiv:1204.1344 [astro-
ph.CO]
123
1
Page 184 of 200
R. E. Angulo, O. Hahn

Oman KA, Navarro JF, Fattahi A, Frenk CS, Sawala T, White SDM, Bower R, Crain RA, Furlong M,
Schaller M, Schaye J, Theuns T (2015) The unexpected diversity of dwarf galaxy rotation curves.
MNRAS
452(4):3650–3665.
https://doi.org/10.1093/mnras/stv1504.
arXiv:1504.01437
[astro-
ph.GA]
Ondaro-Mallea L, Angulo RE, Zennaro M, Contreras S, Arico` G (2022) Non-universality of the mass
function: dependence on the growth rate and power spectrum shape. MNRAS 509:6077–6090.
https://doi.org/10.1093/mnras/stab3337
Onions J, Knebe A, Pearce FR, Muldrew SI, Lux H, Knollmann SR, Ascasibar Y, Behroozi P, Elahi P,
Han J, Maciejewski M, Mercha´n ME, Neyrinck M, Ruiz AN, Sgro´ MA, Springel V, Tweed D (2012)
Subhaloes going Notts: the subhalo-ﬁnder comparison project. MNRAS 423(2):1200–1214. https://
doi.org/10.1111/j.1365-2966.2012.20947.x. arXiv:1203.3695 [astro-ph.CO]
Orban C (2013) Keeping it real: revisiting a real-space approach to running ensembles of cosmological
N-body simulations. JCAP 2013(5):032. https://doi.org/10.1088/1475-7516/2013/05/032. arXiv:
1201.2082 [astro-ph.CO]
Orsi A´ A, Angulo RE (2018) The impact of galaxy formation on satellite kinematics and redshift-space
distortions. MNRAS 475(2):2530–2544. https://doi.org/10.1093/mnras/stx3349. arXiv:1708.00956
[astro-ph.CO]
Orszag SA (1971) On the Elimination of Aliasing in Finite-Difference Schemes by Filtering High-
Wavenumber
Components.
J
Atmosph
Sci
28:1074.
https://doi.org/10.1175/1520-
0469(1971)028\1074:OTEOAI[2.0.CO;2
O’Shea BW, Nagamine K, Springel V, Hernquist L, Norman ML (2005) Comparing AMR and SPH
Cosmological Simulations I Dark Matter and Adiabatic Simulations. ApJS 160(1):1–27. https://doi.
org/10.1086/432645. arXiv:astro-ph/0312651 [astro-ph]
Oteo JA, Ros J (1991) The Magnus expansion for classical Hamiltonian systems. J Phys A 24:5751–5762.
https://doi.org/10.1088/0305-4470/24/24/011
Oyaizu H (2008) Nonlinear evolution of f(R) cosmologies. I. Methodology. Phys Rev D 78(12):123523.
https://doi.org/10.1103/PhysRevD.78.123523. arXiv:0807.2449 [astro-ph]
Padilla ND, Ceccarelli L, Lambas DG (2005) Spatial and dynamical properties of voids in a K cold dark
matter
universe.
MNRAS
363(3):977–990.
https://doi.org/10.1111/j.1365-2966.2005.09500.x.
arXiv:astro-ph/0508297 [astro-ph]
Paillas E, Lagos CDP, Padilla N, Tissera P, Helly J, Schaller M (2017) Baryon effects on void statistics in
the EAGLE simulation. MNRAS 470(4):4434–4452. https://doi.org/10.1093/mnras/stx1514. arXiv:
1609.00101 [astro-ph.CO]
Paillas E, Cautun M, Li B, Cai YC, Padilla N, Armijo J, Bose S (2019) The Santiago-Harvard-Edinburgh-
Durham void comparison II: unveiling the Vainshtein screening using weak lensing. MNRAS
484(1):1149–1165. https://doi.org/10.1093/mnras/stz022. arXiv:1810.02864 [astro-ph.CO]
Paillas E, Cai YC, Padilla N, Sa´nchez A (2021) Redshift-space distortions with split densities. MNRAS
505:5731–5752. https://doi.org/10.1093/mnras/stab1654
Palanque-Delabrouille N, Ye`che C, Scho¨neberg N, Lesgourgues J, Walther M, Chabanier S (2020)
Armengaud E (2020) Hints, neutrino bounds and WDM constraints from SDSS DR14 Lyman-a and
Planck full-survey data. JCAP 04:038. https://doi.org/10.1088/1475-7516/2020/04/038
Pan S, Liu M, Forero-Romero J, Sabiu CG, Li Z, Miao H, Li XD (2020) Cosmological parameter
estimation from large-scale structure deep learning. Sci China Phys Mech Astron 63(11):110412.
https://doi.org/10.1007/s11433-020-1586-3. arXiv:1908.10590 [astro-ph.CO]
Papastergis E, Martin AM, Giovanelli R, Haynes MP (2011) The Velocity Width Function of Galaxies
from the 40% ALFALFA Survey: Shedding Light on the Cold Dark Matter Overabundance
Problem. ApJ 739(1):38. https://doi.org/10.1088/0004-637X/739/1/38. arXiv:1106.0710 [astro-
ph.CO]
Papastergis E, Giovanelli R, Haynes MP, Shankar F (2015) Is there a ‘‘too big to fail’’ problem in the
ﬁeld? A&A 574:A113. https://doi.org/10.1051/0004-6361/201424909. arXiv:1407.4665 [astro-
ph.GA]
Paranjape A, Padmanabhan N (2017) Halo assembly bias from Separate Universe simulations. MNRAS
468(3):2984–2999. https://doi.org/10.1093/mnras/stx659. arXiv:1612.02833 [astro-ph.CO]
Paranjape A, Hahn O, Sheth RK (2018) Halo assembly bias and the tidal anisotropy of the local halo
environment. MNRAS 476(3):3631–3647. https://doi.org/10.1093/mnras/sty496. arXiv:1706.09906
[astro-ph.CO]
123
Large-scale dark matter simulations
Page 185 of 200
1

Park H, Ahn K, Yoshida N, Hirano S (2020) First Structure Formation under the Inﬂuence of Gas-Dark
Matter Streaming Velocity and Density: Impact of the ‘‘Baryons Trace Dark Matter’’ Approxima-
tion. ApJ 900(1):30. https://doi.org/10.3847/1538-4357/aba26e. arXiv:2004.00863 [astro-ph.CO]
Partmann C, Fidler C, Rampf C, Hahn O (2020) Fast simulations of cosmic large-scale structure with
massive neutrinos. JCAP 9:018. https://doi.org/10.1088/1475-7516/2020/09/018. arXiv:2003.07387
[astro-ph.CO]
Pearce FR, Couchman HMP (1997) Hydra: a parallel adaptive grid code. New A 2(5):411–427. https://
doi.org/10.1016/S1384-1076(97)00025-0. arXiv:astro-ph/9703183 [astro-ph]
Peebles PJE (1971) Rotation of Galaxies and the Gravitational Instability Picture. A&A 11:377
Peebles PJE (1980) The large-scale structure of the universe. Princeton University Press, Princeton
Peebles PJE, Melott AL, Holmes MR, Jiang LR (1989) A model for the formation of the Local Group.
ApJ 345:108–121. https://doi.org/10.1086/167885
Peel A, Lalande F, Starck JL, Pettorino V, Merten J, Giocoli C, Meneghetti M, Baldi M (2019)
Distinguishing standard and modiﬁed gravity cosmologies with machine learning. Phys Rev D
100(2):023508. https://doi.org/10.1103/PhysRevD.100.023508. arXiv:1810.11030 [astro-ph.CO]
Pellejero-Iban˜ez M, Angulo RE, Arico´ G, Zennaro M, Contreras S, Stu¨cker J (2020) Cosmological
parameter estimation via iterative emulation of likelihoods. MNRAS 499(4):5257–5268. https://doi.
org/10.1093/mnras/staa3075. arXiv:1912.08806 [astro-ph.CO]
Pellejero-Iban˜ez M, Stu¨cker J, Angulo RE, Zennaro M, Contreras S, Arico G (2021) Modelling galaxy
clustering in redshift space with a Lagrangian bias formalism and N-body simulations. arXiv
e-prints arXiv:2109.08699 [astro-ph.CO]
Pen UL (1997) Generating Cosmological Gaussian Random Fields. ApJ 490(2):L127–L130. https://doi.
org/10.1086/311042. arXiv:astro-ph/9709261 [astro-ph]
Perraudin N, Srivastava A, Lucchi A, Kacprzak T, Hofmann T, Re´fre´gier A (2019) Cosmological N-body
simulations: a challenge for scalable generative models. Comput Astrophys Cosmol 6(1):5. https://
doi.org/10.1186/s40668-019-0032-1. arXiv:1908.05519 [physics.comp-ph]
Perraudin N, Marcon S, Lucchi A, Kacprzak T (2021) Emulation of cosmological mass maps with
conditional generative adversarial networks. Front Artif Intell 4:673062. https://doi.org/10.3389/frai.
2021.673062. arXiv:2004.08139 [astro-ph.CO]
Petri A, Liu J, Haiman Z, May M, Hui L, Kratochvil JM (2015) Emulating the CFHTLenS Weak Lensing
data: Cosmological Constraints from moments and Minkowski functionals. Phys Rev D
91(10):103511. https://doi.org/10.1103/PhysRevD.91.103511. arXiv:1503.06214 [astro-ph.CO]
Philcox OHE (2021) A faster Fourier transform? Computing small-scale power spectra and bispectra for
cosmological simulations in OðN2Þ time. MNRAS 501(3):4004–4034. https://doi.org/10.1093/
mnras/staa3882. arXiv:2005.01739 [astro-ph.CO]
Philcox OHE, Eisenstein DJ (2020) Computing the small-scale galaxy power spectrum and bispectrum in
conﬁguration space. MNRAS 492(1):1214–1242. https://doi.org/10.1093/mnras/stz3335. arXiv:
1912.01010 [astro-ph.CO]
Pichon C, Bernardeau F (1999) Vorticity generation in large-scale structure caustics. A&A 343:663–681
arXiv:astro-ph/9902142 [astro-ph]
Pietroni M (2018) Structure formation beyond shell-crossing: nonperturbative expansions and late-time
attractors. JCAP 2018(6):028. https://doi.org/10.1088/1475-7516/2018/06/028. arXiv:1804.09140
[astro-ph.CO]
Pillepich A, Porciani C, Hahn O (2010) Halo mass function and scale-dependent bias from N-body
simulations with non-Gaussian initial conditions. MNRAS 402:191–206. https://doi.org/10.1111/j.
1365-2966.2009.15914.x. arXiv:0811.4176
Planck Collaboration, Akrami Y, Arroja F et al (2020) Planck 2018 results. IX. Constraints on primordial
non-Gaussianity. A&A 641:A9. https://doi.org/10.1051/0004-6361/201935891. arXiv:1905.05697
[astro-ph.CO]
Planck Collaboration, Ade PAR, Aghanim N et al (2016) Planck 2015 results. XVII. Constraints on
primordial non-Gaussianity. A&A 594:A17. https://doi.org/10.1051/0004-6361/201525836. arXiv:
1502.01592 [astro-ph.CO]
Planck Collaboration, Aghanim N, Akrami Y et al (2020) Planck 2018 results. VI. Cosmological
parameters. A&A 641:A6. https://doi.org/10.1051/0004-6361/201833910. arXiv:1807.06209 [astro-
ph.CO]
Planelles S, Quilis V (2010) ASOHF: a new adaptive spherical overdensity halo ﬁnder. A&A 519:A94.
https://doi.org/10.1051/0004-6361/201014214. arXiv:1006.3205 [astro-ph.CO]
123
1
Page 186 of 200
R. E. Angulo, O. Hahn

Platen E, van de Weygaert R, Jones BJT (2007) A cosmic watershed: the WVF void detection technique.
MNRAS 380(2):551–570. https://doi.org/10.1111/j.1365-2966.2007.12125.x. arXiv:0706.2788 [as-
tro-ph]
Polisensky E, Ricotti M (2015) Fingerprints of the initial conditions on the density proﬁles of cold and
warm dark matter haloes. MNRAS 450(2):2172–2184. https://doi.org/10.1093/mnras/stv736. arXiv:
1504.02126 [astro-ph.GA]
Pontzen A, Governato F (2012) How supernova feedback turns dark matter cusps into cores. MNRAS
421(4):3464–3471.
https://doi.org/10.1111/j.1365-2966.2012.20571.x.
arXiv:1106.0499
[astro-
ph.CO]
Pontzen A, Governato F (2013) Conserved actions, maximum entropy and dark matter haloes. MNRAS
430(1):121–133. https://doi.org/10.1093/mnras/sts529. arXiv:1210.1849 [astro-ph.CO]
Pontzen A, Slosar A, Roth N, Peiris HV (2016) Inverted initial conditions: Exploring the growth of
cosmic structure and voids. Phys Rev D 93(10):103519. https://doi.org/10.1103/PhysRevD.93.
103519. arXiv:1511.04090 [astro-ph.CO]
Porayko NK, Postnov KA (2014) Constraints on ultralight scalar dark matter from pulsar timing. Phys
Rev D 90(6):062008. https://doi.org/10.1103/PhysRevD.90.062008. arXiv:1408.4670 [astro-ph.CO]
Porayko NK, Zhu X, Levin Y, Hui L, Hobbs G, Grudskaya A, Postnov K, Bailes M, Bhat NDR, Coles W,
Dai S, Dempsey J, Keith MJ, Kerr M, Kramer M, Lasky PD, Manchester RN, Osłowski S,
Parthasarathy A, Ravi V, Reardon DJ, Rosado PA, Russell CJ, Shannon RM, Spiewak R, van Straten
W, Toomey L, Wang J, Wen L, You X, Collaboration PPTA (2018) Parkes Pulsar Timing Array
constraints on ultralight scalar-ﬁeld dark matter. Phys Rev D 98(10):102002. https://doi.org/10.
1103/PhysRevD.98.102002. arXiv:1810.03227 [astro-ph.CO]
Potter D, Stadel J (2016) PKDGRAV3: Parallel gravity code. ascl:1609.016
Potter D, Stadel J, Teyssier R (2017) PKDGRAV3: beyond trillion particle cosmological simulations for
the next era of galaxy surveys. Comput Astrophys Cosmol 4(1):2. https://doi.org/10.1186/s40668-
017-0021-1. arXiv:1609.08621 [astro-ph.IM]
Powell D, Abel T (2015) An exact general remeshing scheme applied to physically conservative
voxelization. J Comput Phys 297:340–356. https://doi.org/10.1016/j.jcp.2015.05.022. arXiv:1412.
4941 [physics.comp-ph]
Power C (2013) Seeking Observable Imprints of Small-Scale Structure on the Properties of Dark Matter
Haloes. PASA 30:e053. https://doi.org/10.1017/pasa.2013.32. arXiv:1309.1591 [astro-ph.CO]
Power C, Knebe A (2006) The impact of box size on the properties of dark matter haloes in cosmological
simulations. MNRAS 370(2):691–701. https://doi.org/10.1111/j.1365-2966.2006.10562.x. arXiv:
astro-ph/0512281 [astro-ph]
Power C, Navarro JF, Jenkins A, Frenk CS, White SDM, Springel V, Stadel J, Quinn T (2003) The inner
structure of KCDM haloes—I. A numerical convergence study. MNRAS 338(1):14–34. https://doi.
org/10.1046/j.1365-8711.2003.05925.x. arXiv:astro-ph/0201544 [astro-ph]
Power C, Robotham ASG, Obreschkow D, Hobbs A, Lewis GF (2016) Spurious haloes and discreteness-
driven relaxation in cosmological simulations. MNRAS 462(1):474–489. https://doi.org/10.1093/
mnras/stw1644. arXiv:1606.02038 [astro-ph.CO]
Pozo A, Broadhurst T, de Martino I, Chiueh T, Smoot GF, Bonoli S, Angulo R (2020) Detection of a
universal core-halo transition in dwarf galaxies as predicted by Bose-Einstein dark matter. arXiv
e-prints arXiv:2010.10337 [astro-ph.GA]
Press WH, Davis M (1982) How to identify and weigh virialized clusters of galaxies in a complete
redshift catalog. ApJ 259:449–473. https://doi.org/10.1086/160183
Press WH, Schechter P (1974) Formation of Galaxies and Clusters of Galaxies by Self-Similar
Gravitational Condensation. ApJ 187:425–438. https://doi.org/10.1086/152650
Press WH, Ryden BS, Spergel DN (1990) Single mechanism for generating large-scale structure and
providing dark missing matter. Phys Rev Lett 64:1084–1087. https://doi.org/10.1103/PhysRevLett.
64.1084
Price DJ, Monaghan JJ (2007) An energy-conserving formalism for adaptive gravitational force softening
in smoothed particle hydrodynamics and N-body codes. MNRAS 374(4):1347–1358. https://doi.org/
10.1111/j.1365-2966.2006.11241.x. arXiv:astro-ph/0610872 [astro-ph]
Price-Whelan AM, Johnston KV, Valluri M, Pearson S, Ku¨pper AHW, Hogg DW (2016) Chaotic
dispersal of tidal debris. MNRAS 455(1):1079–1098. https://doi.org/10.1093/mnras/stv2383. arXiv:
1507.08662 [astro-ph.GA]
123
Large-scale dark matter simulations
Page 187 of 200
1

Puchwein E, Baldi M, Springel V (2013) Modiﬁed-Gravity-GADGET: a new code for cosmological
hydrodynamical simulations of modiﬁed gravity models. MNRAS 436(1):348–360. https://doi.org/
10.1093/mnras/stt1575. arXiv:1305.2418 [astro-ph.CO]
Pueblas S, Scoccimarro R (2009) Generation of vorticity and velocity dispersion by orbit crossing. Phys
Rev D 80(4):043504. https://doi.org/10.1103/PhysRevD.80.043504. arXiv:0809.4606 [astro-ph]
Quinn T, Katz N, Stadel J, Lake G (1997) Time stepping N-body simulations. arXiv:astro-ph/9710043
Ra´cz G, Szapudi I, Csabai I, Dobos L (2018) Compactiﬁed cosmological simulations of the inﬁnite
universe. MNRAS 477(2):1949–1957. https://doi.org/10.1093/mnras/sty695. arXiv:1711.04959
[astro-ph.CO]
Ra´cz G, Szapudi I, Dobos L, Csabai I, Szalay AS (2019) StePS: A multi-GPU cosmological N-body Code
for compactiﬁed simulations. Astron Comput 28:100303. https://doi.org/10.1016/j.ascom.2019.
100303. arXiv:1811.05903 [astro-ph.CO]
Radford A, Metz L, Chintala S (2015) Unsupervised Representation Learning with Deep Convolutional
Generative Adversarial Networks. arXiv e-prints arXiv:1511.06434 [cs.LG]
Ramachandra
NS,
Shandarin
SF
(2015)
Multi-stream
portrait
of
the
cosmic
web.
MNRAS
452(2):1643–1653. https://doi.org/10.1093/mnras/stv1389. arXiv:1412.7768 [astro-ph.CO]
Ramachandra N, Valogiannis G, Ishak M, Heitmann K (2021) Matter Power Spectrum Emulator for
f(R) Modiﬁed Gravity Cosmologies. Phys Rev D 103:123525. https://doi.org/10.1103/PhysRevD.
103.123525
Ramakrishnan S, Paranjape A (2020) Separate Universe calibration of the dependence of halo bias on
cosmic web anisotropy. MNRAS 499(3):4418–4431. https://doi.org/10.1093/mnras/staa2999. arXiv:
2007.03711 [astro-ph.CO]
Rampf C (2012) The recursion relation in Lagrangian perturbation theory. JCAP 1212:004. https://doi.
org/10.1088/1475-7516/2012/12/004. arXiv:1205.5274 [astro-ph.CO]
Rampf C, Buchert T (2012) Lagrangian perturbations and the matter bispectrum I: fourth-order model for
non-linear clustering. JCAP 6:021. https://doi.org/10.1088/1475-7516/2012/06/021. arXiv:1203.
4260 [astro-ph.CO]
Rampf C, Hahn O (2021) Shell-crossing in a KCDM Universe. MNRAS 501(1):L71–L75. https://doi.org/
10.1093/mnrasl/slaa198. arXiv:2010.12584 [astro-ph.CO]
Rampf C, Frisch U, Hahn O (2021a) Unveiling the singular dynamics in the cosmic large-scale structure.
MNRAS 505(1):L90–L94. https://doi.org/10.1093/mnrasl/slab053. arXiv:1912.00868 [astro-ph.CO]
Rampf C, Uhlemann C, Hahn O (2021b) Cosmological perturbations for two cold ﬂuids in KCDM.
MNRAS 503(1):406–425. https://doi.org/10.1093/mnras/staa3605. arXiv:2008.09123 [astro-ph.CO]
Rantala A, Naab T, Springel V (2021) FROST: a momentum-conserving CUDA implementation of a
hierarchical fourth-order forward symplectic integrator. MNRAS https://doi.org/10.1093/mnras/
stab057. arXiv:2011.14984 [astro-ph.IM]
Ravanbakhsh S, Oliva J, Fromenteau S, Price LC, Ho S, Schneider J, Poczos B (2017) Estimating
Cosmological Parameters from the Dark Matter Distribution. arXiv e-prints arXiv:1711.02033
[astro-ph.CO]
Reddick RM, Wechsler RH, Tinker JL, Behroozi PS (2013) The Connection between Galaxies and Dark
Matter Structures in the Local Universe. ApJ 771(1):30. https://doi.org/10.1088/0004-637X/771/1/
30. arXiv:1207.2160 [astro-ph.CO]
Reed D, Gardner J, Quinn T, Stadel J, Fardal M, Lake G, Governato F (2003) Evolution of the mass
function of dark matter haloes. MNRAS 346(2):565–572. https://doi.org/10.1046/j.1365-2966.2003.
07113.x. arXiv:astro-ph/0301270 [astro-ph]
Regan DM, Schmittfull MM, Shellard EPS, Fergusson JR (2012) Universal non-Gaussian initial
conditions for N-body simulations. Phys Rev D 86(12):123524. https://doi.org/10.1103/PhysRevD.
86.123524. arXiv:1108.3813 [astro-ph.CO]
Reid BA, Verde L, Dolag K, Matarrese S, Moscardini L (2010) Non-Gaussian halo assembly bias. JCAP
7:013. https://doi.org/10.1088/1475-7516/2010/07/013. arXiv:1004.1637 [astro-ph.CO]
Reid BA, Seo HJ, Leauthaud A, Tinker JL, White M (2014) A 2.5 per cent measurement of the growth
rate
from small-scale redshift
space clustering of
SDSS-III CMASS
galaxies. MNRAS
444(1):476–502. https://doi.org/10.1093/mnras/stu1391. arXiv:1404.3742 [astro-ph.CO]
Ribli D, Pataki BA´ , Csabai I (2019) An improved cosmological parameter inference scheme motivated by
deep learning. Nat Astron 3:93–98. https://doi.org/10.1038/s41550-018-0596-8. arXiv:1806.05995
[astro-ph.CO]
Richardson TRG, Stu¨cker J, Angulo RE, Hahn O (2021) Non-Halo Structures and their Effects on
Gravitational Lensing. arXiv e-prints arXiv:2101.07806 [astro-ph.CO]
123
1
Page 188 of 200
R. E. Angulo, O. Hahn

Ricotti M, Gould A (2009) A New Probe of Dark Matter and High-Energy Universe Using Microlensing.
ApJ 707(2):979–987. https://doi.org/10.1088/0004-637X/707/2/979. arXiv:0908.0735 [astro-ph.CO]
Riess AG, Casertano S, Yuan W, Macri LM, Scolnic D (2019) Large Magellanic Cloud Cepheid
Standards Provide a 1% Foundation for the Determination of the Hubble Constant and Stronger
Evidence for Physics beyond KCDM. ApJ 876(1):85. https://doi.org/10.3847/1538-4357/ab1422.
arXiv:1903.07603 [astro-ph.CO]
Robertson A, Massey R, Eke V (2017) What does the Bullet Cluster tell us about self-interacting dark
matter? MNRAS 465(1):569–587. https://doi.org/10.1093/mnras/stw2670. arXiv:1605.04307 [astro-
ph.CO]
Rocha M, Peter AHG, Bullock JS, Kaplinghat M, Garrison-Kimmel S, On˜orbe J, Moustakas LA (2013)
Cosmological simulations with self-interacting dark matter—I. Constant-density cores and
substructure. MNRAS 430:81–104. https://doi.org/10.1093/mnras/sts514. arXiv:1208.3025
Rodrı´guez AC, Kacprzak T, Lucchi A, Amara A, Sgier R, Fluri J, Hofmann T, Re´fre´gier A (2018) Fast
cosmic web simulations with generative adversarial networks. Comput Astrophys Cosmol 5(1):4.
https://doi.org/10.1186/s40668-018-0026-4. arXiv:1801.09070 [astro-ph.CO]
Rodrı´guez-Torres SA, Chuang CH, Prada F, Guo H, Klypin A, Behroozi P, Hahn CH, Comparat J, Yepes
G, Montero-Dorta AD, Brownstein JR, Maraston C, McBride CK, Tinker J, Gottlo¨ber S, Favole G,
Shu Y, Kitaura FS, Bolton A, Scoccimarro R, Samushia L, Schlegel D, Schneider DP, Thomas D
(2016) The clustering of galaxies in the SDSS-III Baryon Oscillation Spectroscopic Survey:
modelling the clustering and halo occupation distribution of BOSS CMASS galaxies in the Final
Data Release. MNRAS 460(2):1173–1187. https://doi.org/10.1093/mnras/stw1014. arXiv:1509.
06404 [astro-ph.CO]
Rogers KK, Peiris HV, Pontzen A, Bird S, Verde L, Font-Ribera A (2019) Bayesian emulator
optimisation for cosmology: application to the Lyman-alpha forest. JCAP 2:031. https://doi.org/10.
1088/1475-7516/2019/02/031. arXiv:1812.04631 [astro-ph.CO]
Romano-Dı´az E, Shlosman I, Hoffman Y, Heller C (2008) Erasing Dark Matter Cusps in Cosmological
Galactic Halos with Baryons. ApJ 685(2):L105. https://doi.org/10.1086/592687. arXiv:0808.0195
[astro-ph]
Romeo AB, Agertz O, Moore B, Stadel J (2008) Discreteness Effects in KCDM Simulations: A Wavelet-
Statistical View. ApJ 686(1):1–12. https://doi.org/10.1086/591236. arXiv:0804.0294 [astro-ph]
Roszkowski L, Sessolo EM, Trojanowski S (2018) WIMP dark matter candidates and searches–current
status and future prospects. Rep Prog Phys 81(6):066201. https://doi.org/10.1088/1361-6633/
aab913. arXiv:1707.06277 [hep-ph]
Roth N, Pontzen A, Peiris HV (2016) Genetically modiﬁed haloes: towards controlled experiments in
KCDM galaxy formation. MNRAS 455(1):974–986. https://doi.org/10.1093/mnras/stv2375. arXiv:
1504.07250 [astro-ph.GA]
Roy F, Bouillot VR, Rasera Y (2014) pFoF: a highly scalable halo-ﬁnder for large cosmological data sets.
A&A 564:A13. https://doi.org/10.1051/0004-6361/201322555
Ruiz AN, Cora SA, Padilla ND, Domı´nguez MJ, Vega-Martı´nez CA, Tecce TE, Orsi A´ , Yaryura Y,
Garcı´a Lambas D, Gargiulo ID, Mun˜oz Arancibia AM (2015) Calibration of Semi-analytic Models
of Galaxy Formation Using Particle Swarm Optimization. ApJ 801(2):139. https://doi.org/10.1088/
0004-637X/801/2/139. arXiv:1310.7034 [astro-ph.CO]
Salvati L, Douspis M, Aghanim N (2020) Impact of systematics on cosmological parameters from future
galaxy cluster surveys. A&A 643:A20. https://doi.org/10.1051/0004-6361/202038465. arXiv:2005.
10204 [astro-ph.CO]
Sawala T, Frenk CS, Fattahi A, Navarro JF, Bower RG, Crain RA, Dalla Vecchia C, Furlong M, Helly JC,
Jenkins A, Oman KA, Schaller M, Schaye J, Theuns T, Trayford J, White SDM (2016) The
APOSTLE simulations: solutions to the Local Group’s cosmic puzzles. MNRAS 457(2):1931–1943.
https://doi.org/10.1093/mnras/stw145. arXiv:1511.01098 [astro-ph.GA]
Sawala T, Jenkins A, McAlpine S, Jasche J, Lavaux G, Johansson PH, Frenk CS (2021a) Setting the
stage: structures from Gaussian random ﬁelds. MNRAS 501(4):4759–4776. https://doi.org/10.1093/
mnras/staa3568. arXiv:2003.04321 [astro-ph.CO]
Sawala T, McAlpine S, Jasche J, Lavaux G, Jenkins A, Johansson PH, Frenk CS (2021b) The SIBELIUS
Project: E Pluribus Unum. arXiv e-prints arXiv:2103.12073 [astro-ph.CO]
Schaller M, Becker C, Ruchayskiy O, Boyarsky A, Shaposhnikov M (2014) A new framework for
numerical simulations of structure formation. MNRAS 442(4):3073–3095. https://doi.org/10.1093/
mnras/stu1069. arXiv:1310.5102 [astro-ph.CO]
123
Large-scale dark matter simulations
Page 189 of 200
1

Schaye J, Dalla Vecchia C, Booth CM, Wiersma RPC, Theuns T, Haas MR, Bertone S, Duffy AR,
McCarthy IG, van de Voort F (2010) The physics driving the cosmic star formation history.
MNRAS 402(3):1536–1560. https://doi.org/10.1111/j.1365-2966.2009.16029.x. arXiv:0909.5196
[astro-ph.CO]
Schaye J, Crain RA, Bower RG, Furlong M, Schaller M, Theuns T, Dalla Vecchia C, Frenk CS,
McCarthy IG, Helly JC, Jenkins A, Rosas-Guevara YM, White SDM, Baes M, Booth CM, Camps P,
Navarro JF, Qu Y, Rahmati A, Sawala T, Thomas PA, Trayford J (2015) The EAGLE project:
simulating the evolution and assembly of galaxies and their environments. MNRAS 446:521–554.
https://doi.org/10.1093/mnras/stu2058. arXiv:1407.7040
Schive HY, Chiueh T, Broadhurst T (2014) Cosmic structure as the quantum interference of a coherent
dark wave. Nature Phys 10:496–499. https://doi.org/10.1038/nphys2996. arXiv:1406.6586
Schmalzing J, Buchert T (1997) Beyond Genus Statistics: A Unifying Approach to the Morphology of
Cosmic Structure. ApJ 482(1):L1–L4. https://doi.org/10.1086/310680. arXiv:astro-ph/9702130
[astro-ph]
Schmelzle J, Lucchi A, Kacprzak T, Amara A, Sgier R, Re´fre´gier A, Hofmann T (2017) Cosmological
model discrimination with Deep Learning. arXiv e-prints arXiv:1707.05167 [astro-ph.CO]
Schmidt F (2009) Self-consistent cosmological simulations of DGP braneworld gravity. Phys Rev D
80(4):043001. https://doi.org/10.1103/PhysRevD.80.043001. arXiv:0905.0858 [astro-ph.CO]
Schmidt F (2016) Effect of relative velocity and density perturbations between baryons and dark matter
on the clustering of galaxies. Phys Rev D 94(6):063508. https://doi.org/10.1103/PhysRevD.94.
063508. arXiv:1602.09059 [astro-ph.CO]
Schmidt AS, White SDM, Schmidt F, Stu¨cker J (2018) Cosmological N-body simulations with a large-
scale tidal ﬁeld. MNRAS 479:162–170. https://doi.org/10.1093/mnras/sty1430. arXiv:1803.03274
Schneider A, Teyssier R (2015) A new method to quantify the effects of baryons on the matter power
spectrum. JCAP 12:049. https://doi.org/10.1088/1475-7516/2015/12/049. arXiv:1510.06034
Schneider A, Smith RE, Reed D (2013) Halo mass function and the free streaming scale. MNRAS
433(2):1573–1587. https://doi.org/10.1093/mnras/stt829. arXiv:1303.0839 [astro-ph.CO]
Schneider A, Teyssier R, Potter D, Stadel J, Onions J, Reed DS, Smith RE, Springel V, Pearce FR,
Scoccimarro R (2016) Matter power spectrum and the challenge of percent accuracy. JCAP 4:047.
https://doi.org/10.1088/1475-7516/2016/04/047. arXiv:1503.05920 [astro-ph.CO]
Schneider A, Teyssier R, Stadel J, Chisari NE, Le Brun AMC, Amara A, Refregier A (2018) Quantifying
baryon effects on the matter power spectrum and the weak lensing shear correlation. arXiv e-prints
arXiv:1810.08629
Schneider A, Stoira N, Refregier A, Weiss AJ, Knabenhans M, Stadel J, Teyssier R (2020) Baryonic
effects for weak lensing. Part I. Power spectrum and covariance matrix. JCAP 4:019. https://doi.org/
10.1088/1475-7516/2020/04/019. arXiv:1910.11357 [astro-ph.CO]
Schneider A, Giri SK, Amodeo S, Refregier A (2021) Constraining baryonic feedback and cosmology
with weak-lensing, X-ray, and kinematic Sunyaev-Zeldovich observations. arXiv e-prints arXiv:
2110.02228 [astro-ph.CO]
Scho¨n S, Mack KJ, Avram CA, Wyithe JSB, Barberio E (2015) Dark matter annihilation in the ﬁrst
galaxy haloes. MNRAS 451(3):2840–2850. https://doi.org/10.1093/mnras/stv1056. arXiv:1411.
3783 [astro-ph.CO]
Schutz K, Lin T, Safdi BR, Wu CL (2018) Constraining a Thin Dark Matter Disk with G a i a. Phys Rev
Lett 121(8):081101. https://doi.org/10.1103/PhysRevLett.121.081101. arXiv:1711.03103 [astro-
ph.GA]
Schwabe B, Niemeyer JC, Engels JF (2016) Simulations of solitonic core mergers in ultralight axion dark
matter cosmologies. Phys Rev D 94(4):043513. https://doi.org/10.1103/PhysRevD.94.043513.
arXiv:1606.05151 [astro-ph.CO]
Schwabe B, Gosenca M, Behrens C, Niemeyer JC, Easther R (2020) Simulating mixed fuzzy and cold
dark matter. Phys Rev D 102(8):083518. https://doi.org/10.1103/PhysRevD.102.083518. arXiv:
2007.08256 [astro-ph.CO]
Scoccimarro
R
(1998)
Transients
from
initial
conditions:
a
perturbative
analysis.
MNRAS
299:1097–1118. https://doi.org/10.1046/j.1365-8711.1998.01845.x. arXiv:astro-ph/9711187
Scoccimarro R, Sheth RK (2002) PTHALOS: a fast method for generating mock galaxy distributions.
MNRAS
329(3):629–640.
https://doi.org/10.1046/j.1365-8711.2002.04999.x.
arXiv:astro-ph/
0106120 [astro-ph]
123
1
Page 190 of 200
R. E. Angulo, O. Hahn

Scoccimarro R, Hui L, Manera M, Chan KC (2012) Large-scale bias and efﬁcient generation of initial
conditions for nonlocal primordial non-Gaussianity. Phys Rev D 85(8):083002. https://doi.org/10.
1103/PhysRevD.85.083002. arXiv:1108.5512 [astro-ph.CO]
Sefusatti E, Crocce M, Scoccimarro R, Couchman HMP (2016) Accurate estimators of correlation
functions in Fourier space. MNRAS 460(4):3624–3636. https://doi.org/10.1093/mnras/stw1229.
arXiv:1512.07295 [astro-ph.CO]
Semboloni E, Hoekstra H, Schaye J, van Daalen MP, McCarthy IG (2011) Quantifying the effect of
baryon physics on weak lensing tomography. MNRAS 417:2020–2035. https://doi.org/10.1111/j.
1365-2966.2011.19385.x. arXiv:1105.1075
Seppi R, Comparat J, Nandra K, Bulbul E, Prada F, Klypin A, Merloni A, Predehl P, Ider Chitham J
(2021) The mass function dependence on dark matter haloes dynamical state. A&A 652:A155.
https://doi.org/10.1051/0004-6361/202039123
Sgier R, Fluri J, Herbel J, Re´fre´gier A, Amara A, Kacprzak T, Nicola A (2021) Fast lightcones for
combined cosmological probes. JCAP 2:047. https://doi.org/10.1088/1475-7516/2021/02/047.
arXiv:2007.05735 [astro-ph.CO]
Sgier RJ, Re´fre´gier A, Amara A, Nicola A (2019) Fast generation of covariance matrices for weak
lensing. JCAP 1:044. https://doi.org/10.1088/1475-7516/2019/01/044. arXiv:1801.05745 [astro-
ph.CO]
Shandarin SF (2021) Identifying dark matter haloes by the caustic boundary. JCAP 2021(1):044. https://
doi.org/10.1088/1475-7516/2021/01/044. arXiv:2005.14548 [astro-ph.CO]
Shandarin SF, Medvedev MV (2017) The features of the Cosmic Web unveiled by the ﬂip-ﬂop ﬁeld.
MNRAS 468(4):4056–4076. https://doi.org/10.1093/mnras/stx699. arXiv:1609.08554 [astro-ph.CO]
Shandarin S, Habib S, Heitmann K (2012) Cosmic web, multistream ﬂows, and tessellations. Phys Rev D
85(8):083005. https://doi.org/10.1103/PhysRevD.85.083005. arXiv:1111.2366
Shandera S, Dalal N, Huterer D (2011) A generalized local ansatz and its effect on halo bias. JCAP 3:017.
https://doi.org/10.1088/1475-7516/2011/03/017. arXiv:1010.3722 [astro-ph.CO]
Shapiro PR, Struck-Marcell C, Melott AL (1983) Pancakes and the formation of galaxies in a neutrino-
dominated universe. ApJ 275:413–429. https://doi.org/10.1086/161543
Shaw LD, Weller J, Ostriker JP, Bode P (2007) The Bound Mass of Substructures in Dark Matter Halos.
ApJ 659(2):1082–1095. https://doi.org/10.1086/511849. arXiv:astro-ph/0603150 [astro-ph]
Sherwin BD, Zaldarriaga M (2012) Shift of the baryon acoustic oscillation scale: A simple physical
picture. Phys Rev D 85(10):103523. https://doi.org/10.1103/PhysRevD.85.103523. arXiv:1202.3998
[astro-ph.CO]
Shirasaki M, Yoshida N, Hamana T, Nishimichi T (2012) Probing Primordial Non-Gaussianity with
Weak-lensing Minkowski Functionals. ApJ 760(1):45. https://doi.org/10.1088/0004-637X/760/1/45.
arXiv:1204.4981 [astro-ph.CO]
Simha V, Cole S (2013) Cosmological constraints from applying SHAM to rescaled cosmological
simulations. MNRAS 436(2):1142–1151. https://doi.org/10.1093/mnras/stt1643. arXiv:1302.0852
[astro-ph.CO]
Sinha M, Garrison LH (2020) CORRFUNC—a suite of blazing fast correlation functions on the CPU.
MNRAS
491(2):3022–3041.
https://doi.org/10.1093/mnras/stz3157.
arXiv:1911.03545
[astro-
ph.CO]
Sirko E (2005) Initial Conditions to Cosmological N-Body Simulations, or, How to Run an Ensemble of
Simulations. ApJ 634:728–743. https://doi.org/10.1086/497090. arXiv:astro-ph/0503106
Skillman SW, Warren MS, Turk MJ, Wechsler RH, Holz DE, Sutter PM (2014) Dark Sky Simulations:
Early Data Release. arXiv e-prints arXiv:1407.2600 [astro-ph.CO]
Skory S, Turk MJ, Norman ML, Coil AL (2010) Parallel HOP: A Scalable Halo Finder for Massive
Cosmological Data Sets. ApJS 191(1):43–57. https://doi.org/10.1088/0067-0049/191/1/43. arXiv:
1001.3411 [astro-ph.CO]
Slosar A, Hirata C, Seljak U, Ho S, Padmanabhan N (2008) Constraints on local primordial non-
Gaussianity from large scale structure. JCAP 8:031. https://doi.org/10.1088/1475-7516/2008/08/
031. arXiv:0805.3580 [astro-ph]
Smith RE, Peacock JA, Jenkins A, White SDM, Frenk CS, Pearce FR, Thomas PA, Efstathiou G,
Couchman HMP (2003) Stable clustering, the halo model and non-linear cosmological power
spectra. MNRAS 341(4):1311–1332. https://doi.org/10.1046/j.1365-8711.2003.06503.x. arXiv:
astro-ph/0207664 [astro-ph]
123
Large-scale dark matter simulations
Page 191 of 200
1

Smith A, Cole S, Baugh C, Zheng Z, Angulo R, Norberg P, Zehavi I (2017) A lightcone catalogue from
the Millennium-XXL
simulation.
MNRAS 470(4):4646–4661. https://doi.org/10.1093/mnras/
stx1432. arXiv:1701.06581 [astro-ph.CO]
Somerville RS, Dave´ R (2015) Physical Models of Galaxy Formation in a Cosmological Framework.
ARA&A 53:51–113. https://doi.org/10.1146/annurev-astro-082812-140951. arXiv:1412.2712 [as-
tro-ph.GA]
Sorce JG (2020) Efﬁciently estimating mean, uncertainty, and unconstrained large-scale fraction of local
Universe simulations with paired ﬁxed ﬁelds. MNRAS 495(4):4463–4474. https://doi.org/10.1093/
mnras/staa1432. arXiv:2006.01838 [astro-ph.CO]
Sorce JG, Courtois HM, Gottlo¨ber S, Hoffman Y, Tully RB (2014) Simulations of the Local Universe
constrained by observational peculiar velocities. MNRAS 437(4):3586–3595. https://doi.org/10.
1093/mnras/stt2153. arXiv:1311.2253 [astro-ph.CO]
Sousbie T (2011) The persistent cosmic web and its ﬁlamentary structure—I. Theory and implementation.
MNRAS 414(1):350–383. https://doi.org/10.1111/j.1365-2966.2011.18394.x. arXiv:1009.4015 [as-
tro-ph.CO]
Sousbie T, Colombi S (2016) ColDICE: A parallel Vlasov-Poisson solver using moving adaptive
simplicial tessellation. J Comput Phys 321:644–697. https://doi.org/10.1016/j.jcp.2016.05.048.
arXiv:1509.07720 [physics.comp-ph]
Splinter RJ, Melott AL, Shandarin SF, Suto Y (1998) Fundamental Discreteness Limitations of
Cosmological N-Body Clustering Simulations. ApJ 497(1):38–61. https://doi.org/10.1086/305450.
arXiv:astro-ph/9706099 [astro-ph]
Springel V (2005) The cosmological simulation code GADGET-2. MNRAS 364:1105–1134. https://doi.
org/10.1111/j.1365-2966.2005.09655.x. arXiv:astro-ph/0505010
Springel V, White SDM, Tormen G, Kauffmann G (2001a) Populating a cluster of galaxies—I. Results at
[formmu2]z=0. MNRAS 328(3):726–750. https://doi.org/10.1046/j.1365-8711.2001.04912.x. arXiv:
astro-ph/0012055 [astro-ph]
Springel V, Yoshida N, White SDM (2001b) GADGET: a code for collisionless and gasdynamical
cosmological simulations. New A 6(2):79–117. https://doi.org/10.1016/S1384-1076(01)00042-2.
arXiv:astro-ph/0003162 [astro-ph]
Springel V, White SDM, Jenkins A, Frenk CS, Yoshida N, Gao L, Navarro J, Thacker R, Croton D, Helly
J, Peacock JA, Cole S, Thomas P, Couchman H, Evrard A, Colberg J, Pearce F (2005) Simulations
of the formation, evolution and clustering of galaxies and quasars. Nature 435(7042):629–636.
https://doi.org/10.1038/nature03597. arXiv:astro-ph/0504097 [astro-ph]
Springel V, Frenk CS, White SDM (2006) The large-scale structure of the Universe. Nature
440(7088):1137–1144. https://doi.org/10.1038/nature04805. arXiv:astro-ph/0604561 [astro-ph]
Springel V, Wang J, Vogelsberger M, Ludlow A, Jenkins A, Helmi A, Navarro JF, Frenk CS, White SDM
(2008a) The Aquarius Project: the subhaloes of galactic haloes. MNRAS 391(4):1685–1711. https://
doi.org/10.1111/j.1365-2966.2008.14066.x. arXiv:0809.0898 [astro-ph]
Springel V, White SDM, Frenk CS, Navarro JF, Jenkins A, Vogelsberger M, Wang J, Ludlow A, Helmi A
(2008b) Prospects for detecting supersymmetric dark matter in the Galactic halo. Nature
456(7218):73–76. https://doi.org/10.1038/nature07411. arXiv:0809.0894 [astro-ph]
Springel V, Pakmor R, Pillepich A, Weinberger R, Nelson D, Hernquist L, Vogelsberger M, Genel S,
Torrey P, Marinacci F, Naiman J (2018) First results from the IllustrisTNG simulations: matter and
galaxy clustering. MNRAS 475(1):676–698. https://doi.org/10.1093/mnras/stx3304. arXiv:1707.
03397 [astro-ph.GA]
Springel V, Pakmor R, Zier O, Reinecke M (2021) Simulating cosmic structure formation with the
GADGET-4 code. MNRAS 506(2):2871–2949. https://doi.org/10.1093/mnras/stab1855. arXiv:
2010.03567 [astro-ph.IM]
Srinivasan S, Thomas DB, Pace F, Battye R (2021) Cosmological gravity on all scales II: Model
independent modiﬁed gravity N-body simulations. JCAP 2021(06):016. https://doi.org/10.1088/
1475-7516/2021/06/016
Stadel JG (2001) Cosmological N-body simulations and their analysis. PhD thesis, University of
Washington
Stein G, Alvarez MA, Bond JR, van Engelen A, Battaglia N (2020) The Websky extragalactic CMB
simulations. JCAP 10:012. https://doi.org/10.1088/1475-7516/2020/10/012. arXiv:2001.08787 [as-
tro-ph.CO]
123
1
Page 192 of 200
R. E. Angulo, O. Hahn

Stopyra S, Pontzen A, Peiris H, Roth N, Rey MP (2021) GenetIC–A New Initial Conditions Generator to
Support Genetically Modiﬁed Zoom Simulations. ApJS 252(2):28. https://doi.org/10.3847/1538-
4365/abcd94. arXiv:2006.01841 [astro-ph.IM]
Straumann N (2013) General Relativity. Graduate Texts in Physics. Springer, Dordrecht. https://doi.org/
10.1007/978-94-007-5410-2
Stu¨cker J, Busch P, White SDM (2018) The median density of the Universe. MNRAS 477(3):3230–3246.
https://doi.org/10.1093/mnras/sty815. arXiv:1710.09881 [astro-ph.CO]
Stu¨cker J, Hahn O, Angulo RE, White SDM (2020) Simulating the complexity of the dark matter sheet I:
numerical algorithms. MNRAS 495(4):4943–4964. https://doi.org/10.1093/mnras/staa1468. arXiv:
1909.00008 [astro-ph.CO]
Stu¨cker J, Angulo RE, Busch P (2021a) The boosted potential. MNRAS 508(4):5196–5216. https://doi.
org/10.1093/mnras/stab2913. arXiv:2107.13008 [astro-ph.CO]
Stu¨cker J, Angulo RE, Hahn O, White SDM (2021b) Simulating the complexity of the dark matter sheet
II: halo and subhalo mass functions for non-cold dark matter models. MNRAS. https://doi.org/10.
1093/mnras/stab3078. arXiv:2109.09760 [astro-ph.CO]
Stu¨cker J, Schmidt AS, White SDM, Schmidt F, Hahn O (2021c) Measuring the tidal response of
structure
formation:
anisotropic
separate
universe
simulations
using
TREEPM.
MNRAS
503(1):1473–1489. https://doi.org/10.1093/mnras/stab473. arXiv:2003.06427 [astro-ph.CO]
Suisalu I, Saar E (1995) An adaptive multigrid solver for high-resolution cosmological simulations.
MNRAS 274(1):287–299. https://doi.org/10.1093/mnras/274.1.287. arXiv:astro-ph/9412043 [astro-
ph]
Sunayama T, Padmanabhan N, Heitmann K, Habib S, Rangel E (2016) Efﬁcient construction of mock
catalogs for baryon acoustic oscillation surveys. JCAP 5:051. https://doi.org/10.1088/1475-7516/
2016/05/051. arXiv:1510.06665 [astro-ph.CO]
Svrcek P, Witten E (2006) Axions in string theory. J High Energy Phys 6:051. https://doi.org/10.1088/
1126-6708/2006/06/051. arXiv:hep-th/0605206
Syer D, White SDM (1998) Dark halo mergers and the formation of a universal proﬁle. MNRAS
293(4):337–342. https://doi.org/10.1046/j.1365-8711.1998.01285.x
Taha TR, Ablowitz MI (1984) Analytical and numerical aspects of certain nonlinear evolution equations.
II. Numerical, nonlinear Schro¨dinger equation. J Comput Phys 55(2):203–230. https://doi.org/10.
1016/0021-9991(84)90003-2
Takahashi R, Sato M, Nishimichi T, Taruya A, Oguri M (2012) Revising the Haloﬁt Model for the
Nonlinear Matter Power Spectrum. ApJ 761(2):152. https://doi.org/10.1088/0004-637X/761/2/152.
arXiv:1208.2701 [astro-ph.CO]
Takahashi R, Nishimichi T, Namikawa T, Taruya A, Kayo I, Osato K, Kobayashi Y, Shirasaki M (2020)
Fitting the Nonlinear Matter Bispectrum by the Haloﬁt Approach. ApJ 895(2):113. https://doi.org/
10.3847/1538-4357/ab908d. arXiv:1911.07886 [astro-ph.CO]
Tamosiunas A, Winther HA, Koyama K, Bacon DJ, Nichol RC, Mawdsley B (2021) Investigating
Cosmological GAN Emulators Using Latent Space Interpolation. MNRAS 506:3049–3067. https://
doi.org/10.1093/mnras/stab1879
Tanaka S, Yoshikawa K, Minoshima T, Yoshida N (2017) Multidimensional Vlasov-Poisson Simulations
with High-order Monotonicity- and Positivity-preserving Schemes. ApJ 849:76. https://doi.org/10.
3847/1538-4357/aa901f. arXiv:1702.08521 [physics.comp-ph]
Taruya A, Colombi S (2017) Post-collapse perturbation theory in 1D cosmology—beyond shell-crossing.
MNRAS
470(4):4858–4884.
https://doi.org/10.1093/mnras/stx1501.
arXiv:1701.09088
[astro-
ph.CO]
Tassev S, Zaldarriaga M, Eisenstein DJ (2013) Solving large scale structure in ten easy steps with COLA.
JCAP 6:036. https://doi.org/10.1088/1475-7516/2013/06/036. arXiv:1301.0322 [astro-ph.CO]
Tassev S, Eisenstein DJ, Wandelt BD, Zaldarriaga M (2015) sCOLA: The N-body COLA Method
Extended to the Spatial Domain. arXiv e-prints arXiv:1502.07751 [astro-ph.CO]
Taylor JE, Navarro JF (2001) The Phase-Space Density Proﬁles of Cold Dark Matter Halos. ApJ
563(2):483–488. https://doi.org/10.1086/324031. arXiv:astro-ph/0104002 [astro-ph]
Teyssier R (2002) Cosmological hydrodynamics with adaptive mesh reﬁnement. A new high resolution
code called RAMSES. A&A 385:337–364. https://doi.org/10.1051/0004-6361:20011817. arXiv:
astro-ph/0111367
Thie´baut J, Pichon C, Sousbie T, Prunet S, Pogosyan D (2008) On the onset of stochasticity in K cold
dark matter cosmological simulations. MNRAS 387(1):397–406. https://doi.org/10.1111/j.1365-
2966.2008.13250.x. arXiv:0803.3120 [astro-ph]
123
Large-scale dark matter simulations
Page 193 of 200
1

Thomas DB (2020) Cosmological gravity on all scales: Simple equations, required conditions, and a
framework for modiﬁed gravity. Phys Rev D 101(12):123517. https://doi.org/10.1103/PhysRevD.
101.123517. arXiv:2004.13051 [gr-qc]
Tinker J, Kravtsov AV, Klypin A, Abazajian K, Warren M, Yepes G, Gottlo¨ber S, Holz DE (2008)
Toward a Halo Mass Function for Precision Cosmology: The Limits of Universality. ApJ
688(2):709–728. https://doi.org/10.1086/591439. arXiv:0803.2706 [astro-ph]
Tinyakov P, Tkachev I, Zioutas K (2016) Tidal streams from axion miniclusters and direct axion
searches. JCAP 1:035. https://doi.org/10.1088/1475-7516/2016/01/035. arXiv:1512.02884 [astro-
ph.CO]
Tkachev MV, Pilipenko SV, Yepes G (2020) Dark matter simulations with primordial black holes in the
early Universe. MNRAS 499(4):4854–4862. https://doi.org/10.1093/mnras/staa3103. arXiv:2009.
07813 [astro-ph.CO]
Tonnesen S, Ostriker JP (2021) An Improved and Physically-Motivated Scheme for Matching Galaxies
with Dark Matter Halos. ApJ 917:66. https://doi.org/10.3847/1538-4357/ac0724
Tosone F, Neyrinck MC, Granett BR, Guzzo L, Vittorio N (2021) MUSCLE-UPS: improved
approximations of the matter ﬁeld with the extended Press-Schechter formalism and Lagrangian
perturbation theory. MNRAS 505(2):2999–3015. https://doi.org/10.1093/mnras/stab1517. arXiv:
2012.14446 [astro-ph.CO]
Tram T, Brandbyge J, Dakin J, Hannestad S (2019) Fully relativistic treatment of light neutrinos in
N-body simulations. JCAP 3:022. https://doi.org/10.1088/1475-7516/2019/03/022. arXiv:1811.
00904 [astro-ph.CO]
Tremaine S, Gunn JE (1979) Dynamical role of light neutral leptons in cosmology. Phys Rev Lett
42(6):407–410. https://doi.org/10.1103/PhysRevLett.42.407
Tro¨ster T, Ferguson C, Harnois-De´raps J, McCarthy IG (2019) Painting with baryons: augmenting
N-body simulations with gas using deep generative models. MNRAS 487(1):L24–L29. https://doi.
org/10.1093/mnrasl/slz075. arXiv:1903.12173 [astro-ph.CO]
Tro¨ster T, Mead AJ, Heymans C, Yan Z, Alonso D, Asgari M, Bilicki M, Dvornik A, Hildebrandt H,
Joachimi B, Kannawadi A, Kuijken K, Schneider P, Shan H, van Waerbeke L, Wright AH (2021)
Joint constraints on cosmology and the impact of baryon feedback: combining KiDS-1000 lensing
with the thermal Sunyaev-Zeldovich effect from Planck and ACT. arXiv e-prints arXiv:2109.04458
[astro-ph.CO]
Trottenberg U, Oosterlee CW, Schu¨ller A (2001) Multigrid, Texts in Applied Mathematics. Bd., vol 33.
Academic Press, San Diego. With contributions by A. Brandt, P. Oswald and K. Stu¨ben
Trujillo-Gomez S, Klypin A, Primack J, Romanowsky AJ (2011) Galaxies in KCDM with Halo
Abundance Matching: Luminosity-Velocity Relation, Baryonic Mass-Velocity Relation, Velocity
Function, and Clustering. ApJ 742(1):16. https://doi.org/10.1088/0004-637X/742/1/16. arXiv:1005.
1289 [astro-ph.CO]
Tseliakhovich D, Hirata C (2010) Relative velocity of dark matter and baryonic ﬂuids and the formation
of the ﬁrst structures. Phys Rev D 82(8):083520. https://doi.org/10.1103/PhysRevD.82.083520.
arXiv:1005.2416
Tulin S, Yu HB (2018) Dark matter self-interactions and small scale structure. Phys Rep 730:1–57.
https://doi.org/10.1016/j.physrep.2017.11.004. arXiv:1705.02358 [hep-ph]
Tully RB, Courtois HM, Sorce JG (2016) Cosmicﬂows-3. AJ 152(2):50. https://doi.org/10.3847/0004-
6256/152/2/50. arXiv:1605.01765 [astro-ph.CO]
Tweed D, Yang X, Wang H, Cui W, Zhang Y, Li S, Jing YP, Mo HJ (2017) ELUCID–Exploring the
Local Universe with the reConstructed Initial Density Field. II. Reconstruction Diagnostics. Applied
to Numerical Halo Catalogs. ApJ 841(1):55. https://doi.org/10.3847/1538-4357/aa6bf8. arXiv:1704.
03675 [astro-ph.CO]
Uhlemann C, Kopp M, Haugg T (2014) Schro¨dinger method as N-body double and UV completion of
dust. Phys Rev D 90(2):023517. https://doi.org/10.1103/PhysRevD.90.023517. arXiv:1403.5567
Uhlemann C, Rampf C, Gosenca M, Hahn O (2019) Semiclassical path to cosmic large-scale structure.
Phys Rev D 99(8):083524. https://doi.org/10.1103/PhysRevD.99.083524. arXiv:1812.05633
Ullmo M, Decelle A, Aghanim N (2020) Encoding large scale cosmological structure with Generative
Adversarial Networks. arXiv e-prints arXiv:2011.05244 [astro-ph.CO]
Upadhye A, Biswas R, Pope A, Heitmann K, Habib S, Finkel H, Frontiere N (2014) Large-scale structure
formation with massive neutrinos and dynamical dark energy. Phys Rev D 89(10):103515. https://
doi.org/10.1103/PhysRevD.89.103515. arXiv:1309.5872 [astro-ph.CO]
123
1
Page 194 of 200
R. E. Angulo, O. Hahn

Valageas P (2002) Transients from Zel’dovich initial conditions. A&A 385:761–767. https://doi.org/10.
1051/0004-6361:20020187. arXiv:astro-ph/0112102
Valcin D, Villaescusa-Navarro F, Verde L, Raccanelli A (2019) BE-HaPPY: bias emulator for halo power
spectrum including massive neutrinos. JCAP 12:057. https://doi.org/10.1088/1475-7516/2019/12/
057. arXiv:1901.06045 [astro-ph.CO]
Vale A, Ostriker JP (2004) Linking halo mass to galaxy luminosity. MNRAS 353(1):189–200. https://doi.
org/10.1111/j.1365-2966.2004.08059.x. arXiv:astro-ph/0402500 [astro-ph]
Valogiannis G, Bean R (2017) Efﬁcient simulations of large-scale structure in modiﬁed gravity
cosmologies with comoving Lagrangian acceleration. Phys Rev D 95(10):103515. https://doi.org/10.
1103/PhysRevD.95.103515. arXiv:1612.06469 [astro-ph.CO]
van Daalen MP, Schaye J, Booth CM, Dalla Vecchia C (2011) The effects of galaxy formation on the
matter power spectrum: a challenge for precision cosmology. MNRAS 415:3649–3665. https://doi.
org/10.1111/j.1365-2966.2011.18981.x. arXiv:1104.1174 [astro-ph.CO]
van Daalen MP, McCarthy IG, Schaye J (2020) Exploring the effects of galaxy formation on matter
clustering through a library of simulation power spectra. MNRAS 491:2424–2446. https://doi.org/
10.1093/mnras/stz3199
van de Weygaert R (1994) Fragmenting the Universe. 3: The constructions and statistics of 3-D Voronoi
tessellations. A&A 283(2):361–406
van de Weygaert R, Bernardeau F (1998) Velocity ﬁeld statistics and tessellation techniques: unbiased
estimators of X. In: Mu¨ller V, Gottlo¨ber S, Mu¨cket JP, Wambsganss J (eds) Large scale structure:
tracks and traces. World Scientiﬁc, Singapore, pp 207–216
van de Weygaert R, Bertschinger E (1996) Peak and gravity constraints in Gaussian primordial density
ﬁelds: An application of the Hoffman-Ribak method. MNRAS 281:84. https://doi.org/10.1093/
mnras/281.1.84. arXiv:astro-ph/9507024 [astro-ph]
van den Bosch FC (2017) Dissecting the evolution of dark matter subhaloes in the Bolshoi simulation.
MNRAS 468(1):885–909. https://doi.org/10.1093/mnras/stx520. arXiv:1611.02657 [astro-ph.GA]
van den Bosch FC, Ogiya G (2018) Dark matter substructure in numerical simulations: a tale of
discreteness noise, runaway instabilities, and artiﬁcial disruption. MNRAS 475(3):4066–4087.
https://doi.org/10.1093/mnras/sty084. arXiv:1801.05427 [astro-ph.GA]
van den Bosch FC, Yang X, Mo HJ (2003) Linking early- and late-type galaxies to their dark matter
haloes. MNRAS 340(3):771–792. https://doi.org/10.1046/j.1365-8711.2003.06335.x. arXiv:astro-
ph/0210495 [astro-ph]
van den Bosch FC, Yang X, Mo HJ, Weinmann SM, Maccio` AV, More S, Cacciato M, Skibba R, Kang X
(2007) Towards a concordant model of halo occupation statistics. MNRAS 376(2):841–860. https://
doi.org/10.1111/j.1365-2966.2007.11493.x. arXiv:astro-ph/0610686 [astro-ph]
van den Bosch FC, Ogiya G, Hahn O, Burkert A (2018) Disruption of dark matter substructure: fact or
ﬁction? MNRAS 474(3):3043–3066. https://doi.org/10.1093/mnras/stx2956. arXiv:1711.05276
[astro-ph.GA]
Vaquero A, Redondo J, Stadler J (2019) Early seeds of axion miniclusters. JCAP 4:012. https://doi.org/10.
1088/1475-7516/2019/04/012. arXiv:1809.09241 [astro-ph.CO]
Veltmaat J, Niemeyer JC (2016) Cosmological particle-in-cell simulations with ultralight axion dark
matter. Phys Rev D 94(12):123523. https://doi.org/10.1103/PhysRevD.94.123523. arXiv:1608.
00802 [astro-ph.CO]
Veltmaat J, Niemeyer JC, Schwabe B (2018) Formation and structure of ultralight bosonic dark matter
halos. Phys Rev D 98(4):043509. https://doi.org/10.1103/PhysRevD.98.043509. arXiv:1804.09647
[astro-ph.CO]
Viel M, Lesgourgues J, Haehnelt MG, Matarrese S, Riotto A (2005) Constraining warm dark matter
candidates including sterile neutrinos and light gravitinos with WMAP and the Lyman-a forest. Phys
Rev D 71(6):063534. https://doi.org/10.1103/PhysRevD.71.063534. arXiv:astro-ph/0501562 [astro-
ph]
Viel M, Haehnelt MG, Springel V (2010) The effect of neutrinos on the matter distribution as probed by
the intergalactic medium. JCAP 6:015. https://doi.org/10.1088/1475-7516/2010/06/015. arXiv:1003.
2422 [astro-ph.CO]
Villaescusa-Navarro F (2018) Pylians: Python libraries for the analysis of numerical simulations. ascl:
1811.008
Villaescusa-Navarro F, Naess S, Genel S, Pontzen A, Wandelt B, Anderson L, Font-Ribera A, Battaglia
N, Spergel DN (2018) Statistical Properties of Paired Fixed Fields. ApJ 867(2):137. https://doi.org/
10.3847/1538-4357/aae52b. arXiv:1806.01871 [astro-ph.CO]
123
Large-scale dark matter simulations
Page 195 of 200
1

Villaescusa-Navarro F, Angle´s-Alca´zar D, Genel S, Spergel DN, Somerville RS, Dave R, Pillepich A,
Hernquist L, Nelson D, Torrey P, Narayanan D, Li Y, Philcox O, La Torre V, Delgado AM, Ho S,
Hassan S, Burkhart B, Wadekar D, Battaglia N, Contardo G (2021) The CAMELS project:
cosmology and astrophysics with machine learning simulations. ApJ 915:71. https://doi.org/10.
3847/1538-4357/abf7ba
Villaescusa-Navarro F, Wandelt BD, Angle´s-Alca´zar D, Genel S, Zorrilla Mantilla JM, Ho S, Spergel DN
(2020) Neural networks as optimal estimators to marginalize over baryonic effects. arXiv e-prints
arXiv:2011.05992 [astro-ph.CO]
Visscher PB, Apalkov DM (2010) Simple recursive implementation of fast multipole method. J Magn
Magn Mater 322(2):275–281. https://doi.org/10.1016/j.jmmm.2009.09.033
Vogelsberger M, White SDM (2011) Streams and caustics: the ﬁne-grained structure of K cold dark
matter
haloes.
MNRAS
413(2):1419–1438.
https://doi.org/10.1111/j.1365-2966.2011.18224.x.
arXiv:1002.3162 [astro-ph.CO]
Vogelsberger M, White SDM, Helmi A, Springel V (2008) The ﬁne-grained phase-space structure of cold
dark matter haloes. MNRAS 385(1):236–254. https://doi.org/10.1111/j.1365-2966.2007.12746.x.
arXiv:0711.1105 [astro-ph]
Vogelsberger M, Zavala J, Loeb A (2012) Subhaloes in self-interacting galactic dark matter haloes.
MNRAS 423:3740–3752. https://doi.org/10.1111/j.1365-2966.2012.21182.x. arXiv:1201.5892
Vogelsberger M, Genel S, Springel V, Torrey P, Sijacki D, Xu D, Snyder G, Nelson D, Hernquist L
(2014) Introducing the Illustris Project: simulating the coevolution of dark and visible matter in the
Universe. MNRAS 444(2):1518–1547. https://doi.org/10.1093/mnras/stu1536. arXiv:1405.2921
[astro-ph.CO]
Vogelsberger M, Zavala J, Cyr-Racine FY, Pfrommer C, Bringmann T, Sigurdson K (2016) ETHOS—an
effective theory of structure formation: dark matter physics as a possible explanation of the small-
scale CDM problems. MNRAS 460(2):1399–1416. https://doi.org/10.1093/mnras/stw1076. arXiv:
1512.05349 [astro-ph.CO]
Vogelsberger M, Marinacci F, Torrey P, Puchwein E (2020) Cosmological simulations of galaxy
formation. Nature Rev Phys 2(1):42–66. https://doi.org/10.1038/s42254-019-0127-2. arXiv:1909.
07976 [astro-ph.GA]
Voivodic R, Barreira A (2021) Responses of Halo Occupation Distributions: a new ingredient in the halo
model & the impact on galaxy bias. JCAP 05:069. https://doi.org/10.1088/1475-7516/2021/05/069.
arXiv:2012.04637 [astro-ph.CO]
von Hoerner S (1960) Die numerische Integration des n-Ko¨rper-Problemes fu¨r Sternhaufen. I. ZAp 50
Wagner C, Verde L (2012) N-body simulations with generic non-Gaussian initial conditions II: halo bias.
JCAP 3:002. https://doi.org/10.1088/1475-7516/2012/03/002. arXiv:1102.3229 [astro-ph.CO]
Wagner C, Verde L, Boubekeur L (2010) N-body simulations with generic non-Gaussian initial
conditions I: power spectrum and halo mass function. JCAP 10:022. https://doi.org/10.1088/1475-
7516/2010/10/022. arXiv:1006.5793 [astro-ph.CO]
Wagner C, Verde L, Jimenez R (2012) Effects of the Neutrino Mass Splitting on the Nonlinear Matter
Power Spectrum. ApJ 752(2):L31. https://doi.org/10.1088/2041-8205/752/2/L31. arXiv:1203.5342
[astro-ph.CO]
Wagner C, Schmidt F, Chiang CT, Komatsu E (2015) Separate universe simulations. MNRAS 448:L11–
L15. https://doi.org/10.1093/mnrasl/slu187. arXiv:1409.6294 [astro-ph.CO]
Wang Q (2021) A hybrid Fast Multipole Method for cosmological N-body simulations. Res Astron
Astrophys 21(1):003. https://doi.org/10.1088/1674-4527/21/1/3. arXiv:2006.14952 [physics.comp-
ph]
Wang J, White SDM (2007) Discreteness effects in simulations of hot/warm dark matter. MNRAS
380(1):93–103. https://doi.org/10.1111/j.1365-2966.2007.12053.x. arXiv:astro-ph/0702575 [astro-
ph]
Wang H, Mo HJ, Jing YP, Yang X, Wang Y (2011) Internal properties and environments of dark matter
haloes. MNRAS 413(3):1973–1990. https://doi.org/10.1111/j.1365-2966.2011.18301.x. arXiv:1007.
0612 [astro-ph.CO]
Wang H, Mo HJ, Yang X, Jing YP, Lin WP (2014) ELUCID–Exploring the Local Universe with the
Reconstructed Initial Density Field. I. Hamiltonian Markov Chain Monte Carlo Method with
Particle Mesh Dynamics. ApJ 794(1):94. https://doi.org/10.1088/0004-637X/794/1/94. arXiv:1407.
3451 [astro-ph.CO]
Wang H, Mo HJ, Yang X, Zhang Y, Shi J, Jing YP, Liu C, Li S, Kang X, Gao Y (2016) ELUCID -
Exploring the Local Universe with ReConstructed Initial Density Field III: Constrained Simulation
123
1
Page 196 of 200
R. E. Angulo, O. Hahn

in the SDSS Volume. ApJ 831(2):164. https://doi.org/10.3847/0004-637X/831/2/164. arXiv:1608.
01763 [astro-ph.CO]
Wang J, Bose S, Frenk CS, Gao L, Jenkins A, Springel V, White SDM (2020) Universal structure of dark
matter haloes over a mass range of 20 orders of magnitude. Nature 585(7823):39–42. https://doi.org/
10.1038/s41586-020-2642-9. arXiv:1911.09720 [astro-ph.CO]
Warren MS (2013) 2HOT: An Improved Parallel Hashed Oct-Tree N-Body Algorithm for Cosmological
Simulation. arXiv e-prints arXiv:1310.4502 [astro-ph.IM]
Warren MS, Abazajian K, Holz DE, Teodoro L (2006) Precision Determination of the Mass Function of
Dark Matter Halos. ApJ 646(2):881–885. https://doi.org/10.1086/504962. arXiv:astro-ph/0506395
[astro-ph]
Watson WA, Iliev IT, D’Aloisio A, Knebe A, Shapiro PR, Yepes G (2013) The halo mass function
through the cosmic ages. MNRAS 433(2):1230–1245. https://doi.org/10.1093/mnras/stt791. arXiv:
1212.0095 [astro-ph.CO]
Wechsler RH, Tinker JL (2018) The Connection Between Galaxies and Their Dark Matter Halos.
ARA&A
56:435–487.
https://doi.org/10.1146/annurev-astro-081817-051756.
arXiv:1804.03097
[astro-ph.GA]
Weller J, Ostriker JP, Bode P, Shaw L (2005) Fast identiﬁcation of bound structures in large N-body
simulations. MNRAS 364(3):823–832. https://doi.org/10.1111/j.1365-2966.2005.09602.x. arXiv:
astro-ph/0405445 [astro-ph]
White M, Tinker JL, McBride CK (2014) Mock galaxy catalogues using the quick particle mesh method.
MNRAS 437(3):2594–2606. https://doi.org/10.1093/mnras/stt2071. arXiv:1309.5532 [astro-ph.CO]
White SDM (1994) Formation and Evolution of Galaxies: Les Houches Lectures. arXiv e-prints astro-ph/
9410043
White SDM, Frenk CS (1991) Galaxy Formation through Hierarchical Clustering. ApJ 379:52. https://doi.
org/10.1086/170483
White SDM, Rees MJ (1978) Core condensation in heavy halos: a two-stage theory for galaxy formation
and clustering. MNRAS 183:341–358. https://doi.org/10.1093/mnras/183.3.341
White SDM, Vogelsberger M (2009) Dark matter caustics. MNRAS 392(1):281–286. https://doi.org/10.
1111/j.1365-2966.2008.14038.x. arXiv:0809.0497 [astro-ph]
White SDM, Frenk CS, Davis M (1983) Clustering in a neutrino-dominated universe. ApJ 274:L1–L5.
https://doi.org/10.1086/184139
Widrow LM, Kaiser N (1993) Using the Schro¨dinger Equation to Simulate Collisionless Matter. ApJ
416:L71. https://doi.org/10.1086/187073
Winther HA, Ferreira PG (2015) Fast route to nonlinear clustering statistics in modiﬁed gravity theories.
Phys Rev D 91(12):123507. https://doi.org/10.1103/PhysRevD.91.123507. arXiv:1403.6492 [astro-
ph.CO]
Winther HA, Schmidt F, Barreira A, Arnold C, Bose S, Llinares C, Baldi M, Falck B, Hellwing WA,
Koyama K, Li B, Mota DF, Puchwein E, Smith RE, Zhao GB (2015) Modiﬁed gravity N-body code
comparison project. MNRAS 454(4):4208–4234. https://doi.org/10.1093/mnras/stv2253. arXiv:
1506.06384 [astro-ph.CO]
Winther HA, Koyama K, Manera M, Wright BS, Zhao GB (2017) COLA with scale-dependent growth:
applications to screened modiﬁed gravity models. JCAP 8:006. https://doi.org/10.1088/1475-7516/
2017/08/006. arXiv:1703.00879 [astro-ph.CO]
Winther H, Casas S, Baldi M, Koyama K, Li B, Lombriser L, Zhao GB (2019) Emulators for the non-
linear matter power spectrum beyond KCDM. Phys Rev D 100:123540. https://doi.org/10.1103/
PhysRevD.100.123540
Woo TP, Chiueh T (2009) High-Resolution Simulation on Structure Formation with Extremely Light
Bosonic Dark Matter. ApJ 697:850–861. https://doi.org/10.1088/0004-637X/697/1/850. arXiv:0806.
0232
Wright BS, Winther HA, Koyama K (2017) COLA with massive neutrinos. JCAP 10:054. https://doi.org/
10.1088/1475-7516/2017/10/054. arXiv:1705.08165 [astro-ph.CO]
Wu HY, Hahn O, Evrard AE, Wechsler RH, Dolag K (2013) Virial scaling of galaxies in clusters: bright
to faint is cool to hot. MNRAS 436(1):460–469. https://doi.org/10.1093/mnras/stt1582. arXiv:1307.
0011 [astro-ph.CO]
Xiao H, Williams I, McQuinn M (2021) Simulations of Axion Minihalos. Phys Rev D 104:023515.
https://doi.org/10.1103/PhysRevD.104.023515
Xu X, Zheng Z (2020) Galaxy assembly bias of central galaxies in the Illustris simulation. MNRAS
492(2):2739–2754. https://doi.org/10.1093/mnras/staa009. arXiv:1812.11210 [astro-ph.GA]
123
Large-scale dark matter simulations
Page 197 of 200
1

Xu X, Cisewski-Kehe J, Green SB, Nagai D (2019) Finding cosmic voids and ﬁlament loops using
topological data analysis. Astron Comput 27:34. https://doi.org/10.1016/j.ascom.2019.02.003.
arXiv:1811.08450 [astro-ph.CO]
Xu X, Zehavi I, Contreras S (2021) Dissecting and modelling galaxy assembly bias. MNRAS
502(3):3242–3263. https://doi.org/10.1093/mnras/stab100. arXiv:2007.05545 [astro-ph.GA]
Yamauchi D, Takahashi K, Oguri M (2014) Constraining primordial non-Gaussianity via a multitracer
technique with surveys by Euclid and the Square Kilometre Array. Phys Rev D 90(8):083520.
https://doi.org/10.1103/PhysRevD.90.083520. arXiv:1407.5453 [astro-ph.CO]
Yang YB, Feng LL, Pan J, Yang XH (2009) An optimal method for the power spectrum measurement.
Res Astron Astrophys 9(2):227–236. https://doi.org/10.1088/1674-4527/9/2/012
Yang X, Mo HJ, van den Bosch FC, Zhang Y, Han J (2012) Evolution of the Galaxy-Dark Matter
Connection and the Assembly of Galaxies in Dark Matter Halos. ApJ 752(1):41. https://doi.org/10.
1088/0004-637X/752/1/41. arXiv:1110.1420 [astro-ph.CO]
Ye JN, Guo H, Zheng Z, Zehavi I (2017) Properties and Origin of Galaxy Velocity Bias in the Illustris
Simulation. ApJ 841(1):45. https://doi.org/10.3847/1538-4357/aa70e7. arXiv:1705.02071 [astro-
ph.CO]
Yepes G, Gottlo¨ber S, Hoffman Y (2014) Dark matter in the Local Universe. New A Rev. 58:1–18.
https://doi.org/10.1016/j.newar.2013.11.001. arXiv:1312.0105 [astro-ph.CO]
Yokota R, Barba LA (2012) A tuned and scalable fast multipole method as a preeminent algorithm for
exascale systems. Int J High Perform Comput Appl 26(4):337–346. https://doi.org/10.1177/
1094342011429952
Yoshida H (1990) Construction of higher order symplectic integrators. Phys Lett A 150:262–268. https://
doi.org/10.1016/0375-9601(90)90092-3
Yoshida N, Springel V, White SDM, Tormen G (2000) Weakly Self-interacting Dark Matter and the
Structure of Dark Halos. ApJ 544:L87–L90. https://doi.org/10.1086/317306. arXiv:astro-ph/
0006134
Yoshida N, Sugiyama N, Hernquist L (2003) The evolution of baryon density ﬂuctuations in
multicomponent cosmological simulations. MNRAS 344(2):481–491. https://doi.org/10.1046/j.
1365-8711.2003.06829.x. arXiv:astro-ph/0305210 [astro-ph]
Yoshikawa K, Yoshida N, Umemura M (2013) Direct Integration of the Collisionless Boltzmann
Equation in Six-dimensional Phase Space: Self-gravitating Systems. ApJ 762:116. https://doi.org/10.
1088/0004-637X/762/2/116. arXiv:1206.6152 [astro-ph.IM]
Yoshikawa K, Tanaka S, Yoshida N, Saito S (2020) Cosmological Vlasov-Poisson Simulations of
Structure Formation with Relic Neutrinos: Nonlinear Clustering and the Neutrino Mass. ApJ
904(2):159. https://doi.org/10.3847/1538-4357/abbd46. arXiv:2010.00248 [astro-ph.CO]
Yoshikawa K, Tanaka S, Yoshida N (2021) A 400 Trillion-Grid Vlasov Simulation on Fugaku
Supercomputer: Large-Scale Distribution of Cosmic Relic Neutrinos in a Six-dimensional Phase
Space. arXiv e-prints arXiv:2110.15867 [astro-ph.CO]
Yu Y, Zhang J, Jing Y, Zhang P (2015) Kriging interpolating cosmic velocity ﬁeld. Phys Rev D
92(8):083527. https://doi.org/10.1103/PhysRevD.92.083527. arXiv:1505.06827 [astro-ph.CO]
Yu HR, Emberson JD, Inman D, Zhang TJ, Pen UL, Harnois-De´raps J, Yuan S, Teng HY, Zhu HM, Chen
X, Xing ZZ, Du Y, Zhang L, Lu Y, Liao X (2017a) Differential neutrino condensation onto cosmic
structure. Nature Astronomy 1:0143. https://doi.org/10.1038/s41550-017-0143. arXiv:1609.08968
[astro-ph.CO]
Yu Y, Zhang J, Jing Y, Zhang P (2017b) Kriging interpolating cosmic velocity ﬁeld. II. Taking
anistropies and multistreaming into account. Phys Rev D 95(4):043536. https://doi.org/10.1103/
PhysRevD.95.043536. arXiv:1603.05363 [astro-ph.CO]
Yu HR, Pen UL, Wang X (2018) CUBE: An Information-optimized Parallel Cosmological N-body
Algorithm. ApJS 237(2):24. https://doi.org/10.3847/1538-4365/aac830. arXiv:1712.06121 [astro-
ph.CO]
Zavala J, Frenk CS (2019) Dark Matter Haloes and Subhaloes. Galaxies 7(4):81. https://doi.org/10.3390/
galaxies7040081. arXiv:1907.11775 [astro-ph.CO]
Zavala J, Jing YP, Faltenbacher A, Yepes G, Hoffman Y, Gottlo¨ber S, Catinella B (2009) The Velocity
Function in the Local Environment from KCDM and KWDM Constrained Simulations. ApJ
700(2):1779–1793. https://doi.org/10.1088/0004-637X/700/2/1779. arXiv:0906.0585 [astro-ph.CO]
Zavala J, Springel V, Boylan-Kolchin M (2010) Extragalactic gamma-ray background radiation from
dark matter annihilation. MNRAS 405(1):593–612. https://doi.org/10.1111/j.1365-2966.2010.
16482.x. arXiv:0908.2428 [astro-ph.CO]
123
1
Page 198 of 200
R. E. Angulo, O. Hahn

Zavala J, Vogelsberger M, Walker MG (2013) Constraining self-interacting dark matter with the Milky
way’s dwarf spheroidals. MNRAS 431:L20–L24. https://doi.org/10.1093/mnrasl/sls053. arXiv:
1211.6426 [astro-ph.CO]
Zehavi I, Zheng Z, Weinberg DH, Frieman JA, Berlind AA, Blanton MR, Scoccimarro R, Sheth RK,
Strauss MA, Kayo I, Suto Y, Fukugita M, Nakamura O, Bahcall NA, Brinkmann J, Gunn JE,
Hennessy GS, Ivezic´ Zˇ, Knapp GR, Loveday J, Meiksin A, Schlegel DJ, Schneider DP, Szapudi I,
Tegmark M, Vogeley MS, York DG, SDSS Collaboration (2005) The Luminosity and Color
Dependence of the Galaxy Correlation Function. ApJ 630(1):1–27. https://doi.org/10.1086/431891.
arXiv:astro-ph/0408569 [astro-ph]
Zehavi I, Kerby SE, Contreras S, Jime´nez E, Padilla N, Baugh CM (2019) On the Prospect of Using the
Maximum Circular Velocity of Halos to Encapsulate Assembly Bias in the Galaxy-Halo
Connection. ApJ 887(1):17. https://doi.org/10.3847/1538-4357/ab4d4d. arXiv:1907.05424 [astro-
ph.GA]
Zel’dovich YB (1970) Gravitational instability: An approximate theory for large density perturbations.
A&A 5:84–89
Zennaro M, Bel J, Villaescusa-Navarro F, Carbone C, Sefusatti E, Guzzo L (2017) Initial conditions for
accurate N-body simulations of massive neutrino cosmologies. MNRAS 466:3244–3258. https://doi.
org/10.1093/mnras/stw3340. arXiv:1605.05283
Zennaro M, Angulo RE, Arico` G, Contreras S, Pellejero-Iba´n˜ez M (2019) How to add massive neutrinos
to
your
KCDM
simulation—extending
cosmology
rescaling
algorithms.
MNRAS
489(4):5938–5951. https://doi.org/10.1093/mnras/stz2612. arXiv:1905.08696 [astro-ph.CO]
Zennaro M, Angulo RE, Pellejero-Iba´n˜ez M, Stu¨cker J, Contreras S, Arico` G (2021) The BACCO
simulation project: biased tracers in real space. arXiv e-prints arXiv:2101.12187 [astro-ph.CO]
Zhai Z, Tinker JL, Becker MR, DeRose J, Mao YY, McClintock T, McLaughlin S, Rozo E, Wechsler RH
(2019) The Aemulus Project III: Emulation of the Galaxy Correlation Function. Astrophys J
874(1):95. https://doi.org/10.3847/1538-4357/ab0d7b. arXiv:1804.05867 [astro-ph.CO]
Zhang P, Zheng Y, Mauser NJ (2002) The limit from the Schro¨dinger-Poisson to the Vlasov-Poisson
equations with general data in one dimension. Commun Pure Appl Math 55(5):582–632. https://doi.
org/10.1002/cpa.3017
Zhang P, Zheng Y, Jing Y (2015) Sampling artifact in volume weighted velocity measurement.
I. Theoretical modeling. Phys Rev D 91(4):043522. https://doi.org/10.1103/PhysRevD.91.043522.
arXiv:1405.7125 [astro-ph.CO]
Zhang J, Kuo JL, Liu H, Sming Tsai YL, Cheung K, Chu MC (2018a) The Importance of Quantum
Pressure of Fuzzy Dark Matter on Lya Forest. ApJ 863(1):73. https://doi.org/10.3847/1538-4357/
aacf3f. arXiv:1708.04389 [astro-ph.CO]
Zhang J, Sming Tsai YL, Kuo JL, Cheung K, Chu MC (2018b) Ultralight Axion Dark Matter and Its
Impact on Dark Halo Structure in N-body Simulations. ApJ 853(1):51. https://doi.org/10.3847/1538-
4357/aaa485. arXiv:1611.00892 [astro-ph.CO]
Zhang T, Liao S, Li M, Gao L (2019a) The optimal gravitational softening length for cosmological
N-body simulations. MNRAS 487(1):1227–1232. https://doi.org/10.1093/mnras/stz1370. arXiv:
1810.07055 [astro-ph.CO]
Zhang X, Wang Y, Zhang W, Sun Y, He S, Contardo G, Villaescusa-Navarro F, Ho S (2019b) From Dark
Matter to Galaxies with Convolutional Networks. arXiv e-prints arXiv:1902.05965 [astro-ph.CO]
Zhang G, Li Z, Liu J, Spergel DN, Kreisch CD, Pisani A, Wandelt BD (2020) Void halo mass function: A
promising probe of neutrino mass. Phys Rev D 102(8):083537. https://doi.org/10.1103/PhysRevD.
102.083537. arXiv:1910.07553 [astro-ph.CO]
Zhao GB, Li B, Koyama K (2011) N-body simulations for f(R) gravity using a self-adaptive particle-mesh
code. Phys Rev D 83(4):044007. https://doi.org/10.1103/PhysRevD.83.044007. arXiv:1011.1257
[astro-ph.CO]
Zheligovsky V, Frisch U (2014) Time-analyticity of Lagrangian particle trajectories in ideal ﬂuid ﬂow.
J Fluid Mech 749:404–430. https://doi.org/10.1017/jfm.2014.221. arXiv:1312.6320 [math.AP]
Zheng Z, Berlind AA, Weinberg DH, Benson AJ, Baugh CM, Cole S, Dave´ R, Frenk CS, Katz N, Lacey
CG (2005) Theoretical Models of the Halo Occupation Distribution: Separating Central and Satellite
Galaxies. ApJ 633(2):791–809. https://doi.org/10.1086/466510. arXiv:astro-ph/0408564 [astro-ph]
Zheng Z, Coil AL, Zehavi I (2007) Galaxy Evolution from Halo Occupation Distribution Modeling of
DEEP2 and SDSS Galaxy Clustering. ApJ 667(2):760–779. https://doi.org/10.1086/521074. arXiv:
astro-ph/0703457 [astro-ph]
123
Large-scale dark matter simulations
Page 199 of 200
1

Zheng Y, Zhang P, Jing Y (2015a) Determination of the large scale volume weighted halo velocity bias in
simulations. Phys Rev D 91(12):123512. https://doi.org/10.1103/PhysRevD.91.123512. arXiv:1410.
1256 [astro-ph.CO]
Zheng Y, Zhang P, Jing Y (2015b) Sampling artifact in volume weighted velocity measurement. II.
Detection in simulations and comparison with theoretical modeling. Phys Rev D 91(4):043523.
https://doi.org/10.1103/PhysRevD.91.043523. arXiv:1409.6809 [astro-ph.CO]
Zorrilla-Matilla JM, Sharma M, Hsu D, Haiman Z (2020) Interpreting deep learning models for weak
lensing. arXiv e-prints arXiv:2007.06529 [astro-ph.CO]
Zumalaca´rregui M, Bellini E, Sawicki I, Lesgourgues J, Ferreira PG (2017) hi_class: Horndeski in the
Cosmic Linear Anisotropy Solving System. JCAP 8:019. https://doi.org/10.1088/1475-7516/2017/
08/019. arXiv:1605.06102 [astro-ph.CO]
Publisher’s Note Springer Nature remains neutral with regard to jurisdictional claims in published maps
and institutional afﬁliations.
Authors and Afﬁliations
Raul E. Angulo1,2
• Oliver Hahn3,4,5
& Raul E. Angulo
reangulo@dipc.org
Oliver Hahn
oliver.hahn@univie.ac.at
1
Donostia International Physics Center (DIPC), Donostia-San Sebastia´n, Spain
2
IKERBASQUE, Basque Foundation for Science, 48013 Bilbao, Spain
3
Department of Astrophysics, University of Vienna, Tu¨rkenschanzstraße 17, 1180 Vienna,
Austria
4
Department of Mathematics, University of Vienna, Oskar-Morgenstern-Platz 1, 1090 Vienna,
Austria
5
Laboratoire Lagrange, Universite´ Coˆte d’Azur, CNRS, Bvd. de l’Observatoire, 06304 Nice,
France
123
1
Page 200 of 200
R. E. Angulo, O. Hahn

