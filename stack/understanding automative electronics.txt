
Understanding Automotive
Electronics
An Engineering Perspective

I would like to thank my wife for her outstanding help in preparing this book.
Without her dedication in editing/prooﬁng and correcting errors,
this book would not have been completed. I dedicate this work to her.

Understanding Automotive
Electronics
An Engineering Perspective
Seventh edition
William Ribbens
AMSTERDAM • BOSTON • HEIDELBERG • LONDON
NEW YORK • OXFORD • PARIS • SAN DIEGO
SAN FRANCISCO • SINGAPORE • SYDNEY • TOKYO
ButterwortheHeinemann is an imprint of Elsevier

Butterworth-Heinemann is an imprint of Elsevier
225 Wyman Street, Waltham, MA 02451, USA
The Boulevard, Langford Lane, Kidlington, Oxford, 0X5 1GB, UK
Sixth edition 2003
Seventh edtion 2012
Copyright  2012 Elsevier Inc. All rights reserved.
No part of this publication may be reproduced or transmitted in any form or by any means, electronic or mechanical, including
photocopying, recording, or any information storage and retrieval system, without permission in writing from the Publisher.
Details on how to seek permission, further information about the Publisher’s permissions policies and our arrangements with
organizations such as the Copyright Clearance Center and the Copyright Licensing Agency, can be found at our website:
www.elsevier.com/permissions.
This book and the individual contributions contained in it are protected under copyright by the Publisher (other than as may
be noted herein).
Notices
Knowledge and best practice in this ﬁeld are constantly changing. As new research and experience broaden our understanding,
changes in research methods, professional practices, or medical treatment may become necessary.
Practitioners and researchers must always rely on their own experience and knowledge in evaluating and using any information,
methods, compounds, or experiments described herein. In using such information or methods they should be mindful of their
own safety and the safety of others, including parties for whom they have a professional responsibility.
To the fullest extent of the law, neither the Publisher nor the authors, contributors, or editors, assume any liability for any injury
and/or damage to persons or property as a matter of products liability, negligence or otherwise, or from any use or operation
of any methods, products, instructions, or ideas contained in the material herein.
Library of Congress Cataloging-in-Publication Data
Application submitted
British Library Cataloguing-in-Publication Data
A catalogue record for this book is available from the British Library.
ISBN: 978-0-08-097097-4
For information on all Butterworth-Heinemann publications
visit our website at www.elsevierdirect.com
Typeset by: TNQ Books and Journals, Chennai, India
Printed in the United States of America
13
10 9 8 7 6 5 4 3 2 1

Contents
Preface .......................................................................................................... xiii
Introduction ..................................................................................................... xv
Chapter 1: The Systems Approach to Control and Instrumentation ........................ 1
Chapter Overview .......................................................................................................1
Concept of a System ...................................................................................................2
Block Diagram Representation of a System ..........................................................3
Analog (Continuous Time) Systems .......................................................................5
Linear System Theory: Continuous Time ..................................................................5
First-Order System ..................................................................................................9
Second-Order System ...........................................................................................11
Steady-State Sinusoidal Frequency Response of a System .....................................16
State Variable Formulation of Models .....................................................................17
Control Theory ..........................................................................................................20
Open-Loop Control ...............................................................................................20
Closed-Loop Control ............................................................................................21
Stability of Control System ......................................................................................28
Root-Locus Techniques ........................................................................................29
Robustness of Control-System Stability ...............................................................31
Closed-Loop Limit-Cycle Control ............................................................................34
Instrumentation .........................................................................................................35
Measurement .........................................................................................................36
Issues .....................................................................................................................36
Systematic Errors ..................................................................................................37
Basic Measurement System ......................................................................................39
Sensor ....................................................................................................................40
Random Errors ......................................................................................................42
Signal Processing ..................................................................................................45
Filtering .....................................................................................................................45
Filter-Design Techniques ......................................................................................46
v

Chapter 2: Discrete Time Systems Theory ......................................................... 51
Digital Subsystem .....................................................................................................55
Sinusoidal Frequency Response ...............................................................................56
Discrete Time Control System .................................................................................63
Closed Loop Control .................................................................................................68
Example Discrete Time Control System ..................................................................72
Summary ...................................................................................................................77
Chapter 3: Electronics Fundamentals ................................................................ 79
Semiconductor Devices ............................................................................................80
Diodes ...................................................................................................................83
Rectiﬁer Circuit .....................................................................................................85
Transistors .................................................................................................................87
Field-Effect Transistors .........................................................................................96
Integrated Circuits .....................................................................................................99
Operational Ampliﬁers ...........................................................................................100
Use of Feedback in Op Amps ................................................................................101
Summing Mode Ampliﬁer ..................................................................................103
Phase-Locked Loop ................................................................................................104
Sample and Zero-Order Hold Circuits ...............................................................106
Digital Circuits ........................................................................................................111
Binary Number System ...........................................................................................113
Logic Circuits (Combinatorial) ..............................................................................114
NOT Gate ............................................................................................................114
AND Gate ...........................................................................................................115
OR Gate ..............................................................................................................117
Combination Logic Circuits ...............................................................................117
Logic Circuits with Memory (Sequential) .............................................................119
ReS Flip-Flop .....................................................................................................119
JK Flip-Flop ........................................................................................................119
Synchronous Counter ..............................................................................................120
Register Circuits ..................................................................................................121
Shift Register ......................................................................................................122
Integrated Circuits ...................................................................................................124
The Microprocessor ................................................................................................124
Chapter 4: Microcomputer Instrumentation and Control ................................... 127
Microcomputer Fundamentals ................................................................................128
Digital versus Analog Computers ......................................................................128
vi
Contents

Parts of a Computer ............................................................................................129
Microcomputers versus Mainframe Computers .................................................130
Programs .............................................................................................................130
Microcomputer Tasks ..............................................................................................131
Microcomputer Operations .....................................................................................132
Buses ...................................................................................................................132
Memory Read/Write ...........................................................................................133
Timing .................................................................................................................134
Addressing Peripherals .......................................................................................135
CPU Registers .........................................................................................................135
Accumulator Register .........................................................................................136
Condition Code Register .....................................................................................136
Microprocessor Architecture ..............................................................................138
Reading Instructions ...............................................................................................140
Initialization ........................................................................................................141
Operation Codes ..................................................................................................141
Program Counter .................................................................................................142
Branch Instruction ...............................................................................................143
Jump Instruction ..................................................................................................144
Jump-to-Subroutine Instruction ..........................................................................144
Example Use of a Microcomputer .........................................................................147
Buffer ..................................................................................................................147
Programming Languages ........................................................................................148
Assembly Language ............................................................................................148
Logic Functions ..................................................................................................150
Shift .....................................................................................................................150
Programming the AND Function .......................................................................152
Masking ...............................................................................................................153
Shift and AND ....................................................................................................153
Use of Subroutines ..............................................................................................153
Microcomputer Hardware .......................................................................................154
Central Processing Unit ......................................................................................154
Memory: ROM ....................................................................................................155
Memory: RAM ....................................................................................................156
I/O Parallel Interface ..........................................................................................156
Digital-to-Analog Converter ...............................................................................156
Analog-to-Digital Converter ...............................................................................159
Sampling .............................................................................................................162
Polling .................................................................................................................162
Contents
vii

Interrupts .............................................................................................................163
Vectored Interrupts ..............................................................................................163
Microcomputer Applications in Automotive Systems ...........................................164
Instrumentation Applications of Microcomputers .................................................166
Digital Filters ......................................................................................................168
Microcomputers in Control Systems ......................................................................170
Closed-Loop Control System .............................................................................171
Limit-Cycle Controller .......................................................................................171
Feedback Control Systems .................................................................................171
Table Lookup ......................................................................................................173
Multivariable and Multiple Task Systems ..........................................................175
Chapter 5: The Basics of Electronic Engine Control .......................................... 177
Motivation for Electronic Engine Control .............................................................178
Exhaust Emissions ..................................................................................................178
Fuel Economy .........................................................................................................179
Federal Government Test Procedures .....................................................................180
Fuel Economy Requirements ..............................................................................181
Meeting the Requirements ..................................................................................183
The Role of Electronics ......................................................................................184
Concept of an Electronic Engine Control System .................................................184
Inputs to Controller .............................................................................................187
Output from Controller .......................................................................................188
Deﬁnition of Engine Performance Terms ...............................................................193
Torque .................................................................................................................193
Power ...................................................................................................................196
Fuel Consumption ...............................................................................................198
Engine Overall Efﬁciency ...................................................................................200
Calibration ...........................................................................................................201
Engine Mapping ..................................................................................................201
Effect of Air/Fuel Ratio on Performance ...........................................................202
Effect of Spark Timing on Performance ............................................................203
Effect of Exhaust Gas Recirculation on Performance .......................................204
Exhaust Catalytic Converters .................................................................................206
Oxidizing Catalytic Converter ............................................................................206
The Three-Way Catalyst .....................................................................................207
Electronic Fuel-Control System .............................................................................209
Engine Control Sequence ...................................................................................212
Open-Loop Control .............................................................................................213
viii
Contents

Closed-Loop Control ..........................................................................................213
Closed-Loop Operation .......................................................................................215
Analysis of Intake Manifold Pressure ....................................................................219
Measuring Air Mass ...........................................................................................220
Inﬂuence of Valve System on Volumetric Efﬁciency ........................................223
Idle Speed Control ..................................................................................................224
Electronic Ignition ..................................................................................................230
Chapter 6: Sensors and Actuators .................................................................. 233
Automotive Control System Applications of Sensors and Actuators ....................234
Variables to be Measured ....................................................................................236
Airﬂow Rate Sensor ............................................................................................236
Pressure Measurements .......................................................................................242
Engine Crankshaft Angular Position Sensor ......................................................245
Magnetic Reluctance Position Sensor ................................................................247
Hall-Effect Position Sensor ................................................................................259
Optical Crankshaft Position Sensor ....................................................................263
Throttle Angle Sensor .............................................................................................265
Temperature Sensors ...............................................................................................268
Typical Coolant Sensor ...........................................................................................268
Sensors for Feedback Control ................................................................................270
Exhaust Gas Oxygen Sensor ...............................................................................270
Oxygen Sensor Improvements ............................................................................274
Knock Sensors ........................................................................................................276
Automotive Engine Control Actuators ...................................................................279
Fuel Injection ......................................................................................................284
Exhaust Gas Recirculation Actuator ..................................................................286
Variable Valve Timing ............................................................................................288
VVP Mechanism Model .....................................................................................290
Electric Motor Actuators ........................................................................................292
Brushless DC Motors ..........................................................................................301
Stepper Motors ....................................................................................................304
Ignition System .......................................................................................................304
Ignition Coil Operations .....................................................................................305
Chapter 7: Digital Powertrain Control Systems ............................................... 309
Introduction .............................................................................................................310
Digital Engine Control ............................................................................................310
Digital Engine Control Features .............................................................................312
Contents
ix

Control Modes for Fuel Control .............................................................................316
Engine Start .........................................................................................................317
Open-Loop Mode ................................................................................................317
Acceleration/Deceleration ...................................................................................317
Engine Crank ......................................................................................................319
Engine Warm-Up ................................................................................................320
Open-Loop Control .............................................................................................322
Closed-Loop Control ..........................................................................................323
Acceleration Enrichment ....................................................................................328
Deceleration Leaning ..........................................................................................328
Idle Speed Control ..............................................................................................329
Discrete Time Idle Speed Control ..........................................................................329
EGR Control ...........................................................................................................335
Variable Valve Timing Control ...............................................................................337
Electronic Ignition Control .....................................................................................343
Closed-Loop Ignition Timing .............................................................................347
Spark Advance Correction Scheme ....................................................................353
Integrated Engine Control System ..........................................................................354
Secondary Air Management ...............................................................................354
Evaporative Emissions Canister Purge ...............................................................355
Automatic System Adjustment ...........................................................................356
System Diagnosis ................................................................................................356
Summary of Control Modes ...................................................................................357
Engine Crank (Start) ...........................................................................................357
Engine Warm-Up ................................................................................................357
Open-Loop Control .............................................................................................357
Closed-Loop Control ..........................................................................................358
Hard Acceleration ...............................................................................................358
Deceleration and Idle ..........................................................................................359
Automatic Transmission Control ........................................................................359
Torque Converter Lock-Up Control ...................................................................366
Differential and Traction Control .......................................................................366
Hybrid Electric Vehicle Powertrain Control ......................................................368
Chapter 8: Vehicle-Motion Controls ................................................................ 381
Representative Cruise Control System ...................................................................382
Digital Cruise Control ........................................................................................390
Hardware Implementation Issues .......................................................................394
Throttle Actuator .................................................................................................396
Cruise Control Electronics ......................................................................................400
x
Contents

Stepper Motor-based Actuator Electronics ........................................................401
Vacuum-Operated Actuator ................................................................................403
Advanced Cruise Control ...................................................................................406
Antilock Braking System ........................................................................................410
Tire-Slip Controller .............................................................................................420
Electronic Suspension System ................................................................................420
Variable Damping via Variable Strut Fluid Viscosity ........................................442
Variable Spring Rate ...........................................................................................443
Electronic Suspension Control System ..............................................................444
Electronic Steering Control ....................................................................................446
Four-Wheel Steering ...............................................................................................449
Summary .................................................................................................................457
Chapter 9: Automotive Instrumentation and Telematics .................................... 459
Modern Automotive Instrumentation .....................................................................460
Input and Output Signal Conversion ......................................................................463
Multiplexing ........................................................................................................465
Multirate Sampling .............................................................................................468
Advantages of Computer-Based Instrumentation ..................................................469
Display Devices ......................................................................................................470
LED .....................................................................................................................474
LCD .....................................................................................................................476
Transmissive LCD ..............................................................................................480
VFD .....................................................................................................................480
Flat Panel Display ...................................................................................................483
Fuel Quantity Measurement ...................................................................................491
Coolant Temperature Measurement ........................................................................497
Oil Pressure Measurement ......................................................................................498
Vehicle Speed Measurement ...................................................................................500
High-Speed Digital Communications (CAN) ........................................................502
CAN Network .....................................................................................................504
Trip Information Computer ....................................................................................507
Telematics ...............................................................................................................510
GPS Navigation ......................................................................................................511
The GPS System Structure .....................................................................................516
Automotive Diagnostics ..........................................................................................519
Chapter 10: Diagnostics and Occupant Protection ............................................ 521
Electronic Control System Diagnostics ..................................................................522
Contents
xi

Service Bay Diagnostic Tool ..................................................................................524
Onboard Diagnostics ...............................................................................................525
Model-Based Sensor Failure Detection ..................................................................526
Diagnostic Fault Codes ...........................................................................................529
Onboard Diagnosis (OBD II) .................................................................................543
Model-Based Misﬁre Detection System .................................................................544
Expert Systems in Automotive Diagnosis ..............................................................555
Occupant Protection Systems .................................................................................561
Glossary ....................................................................................................... 569
Quiz questions .............................................................................................. 573
Index ........................................................................................................... 589
xii
Contents

Preface
The present edition of this book is an extensive revision of the previous editions based upon
suggestions of reviewers. The present edition has a strong engineering focus including
analytical models and quantitative performance analysis of electronic components/
subsystems and systems found in contemporary automobiles. However, the largely qualitative
explanations of automotive electronic systems from previous editions has been retained and,
in some cases, expanded wherever it has been possible to do so.
It has been the intention in writing this book to make it accessible to readers who have not had
the formal training in physical sciences and mathematics (as well as those who have) to
understand the functional operation of automotive electronic systems. The author
recommends that such individuals lacking the science background skip over the mathematical
portions of the text and concentrate on the qualitative discussion and verbal explanations
preceding and following the mathematical sections of the book.
It is hoped that the mathematical models and performance analyses presented throughout this
book will be informative to readers with backgrounds in the sciences, engineering and/or
mathematics. There may even be engineers/scientists working within the automotive industry
for whom a detailed discussion of electronic subsystems and components will be useful.
The ﬁrst chapter in previous editions presented an overview of basic functional components
of an automobile. This chapter has been removed, although a shortened version of the
explanation of certain automotive components and subsystems (e.g., engine, drivetrain,
braking, steering etc.) is presented as deemed necessary in the new chapters of this edition.
There are some topics in the present edition of this book that were not covered in detail in any
of the previous editions. These include the theory of electric motors, which ﬁnd application in
hybrid/electric vehicles. Telematics, which is an increasingly important automotive
technology, is covered in considerable detail (including the theory of GPS navigation
systems). In addition, the theory of onboard diagnosis of problems with exhaust emission
control systems is presented for the ﬁrst time in any of the editions of this book.
It has been the intent in writing this book to emphasize the fundamental aspects of the
application of electronics to automobiles. Ideally, if this objective has been achieved, the
reader should understand evolving technologies as well as totally new automotive electronic
technologies as they occur in future vehicles.
xiii

This page intentionally left blank

Introduction
This book covers the general topic of the application of electronics in automobiles and light
trucks. Some of the technology described herein is also found in large trucks and other land
vehicles, although these applications are not explicitly discussed.
The only important use of electronics in automobiles through the late 1950s was the broadcast
band radio receiver, which was based upon vacuum tube technology. The development of
solid-state electronics, from the ﬁrst transistors through the latest high performance integrated
circuits, came at a time that permitted the very sophisticated electronic systems discussed in
this book to be applied to solving automotive control and instrumentation problems.
The book is organized in a way that allows the reader to select his/her own desired starting
point depending upon background and/or experience. The ﬁrst two chapters provide a review
of linear system theory at the level found throughout the remainder of the book.
The new ﬁrst and second chapters present a survey of various aspects of linear system theory.
The new ﬁrst chapter discuses continuous time (analog) theory and the new second chapter
discuses discrete time (digital) system theory. Neither of these two chapters has sufﬁcient
breadth or depth to serve as a full ab initio presentation of system theory. For many readers,
they will be redundant. Nevertheless, they provide a review of linear system theory and
introduce notation that is used throughout this book.
Chapter 3 discusses the basics of solid-state active elements (e.g. diodes and various types of
transistors) along with circuits that form the basic building blocks of automotive electronic
systems. Chapter 4 discusses microprocessors/microcontrollers and certain fundamental
aspects of their application in automotive electronic systems. Chapter 5 presents the
fundamentals of electronic engine control. Chapter 6 surveys sensors and actuators found in
automotive electronic control or instrumentation systems that are arguably the most important
components in such systems. The remaining chapters discuss speciﬁc automotive systems
that incorporate electronics for control or instrumentation purposes. The automotive
components/systems covered include engine, drivetrain, suspension, steering, brakes,
instrumentation, telematics and diagnostics as well as motion control. All of the mathematical
models and performance analyses are given in terms of the theory and methods of the ﬁrst and
second chapters. Extensive use is made of contemporary computer simulation.
xv

Speciﬁc examples are presented for most electronic systems/components for which
component models and performance analyses are given. These examples are based upon
simpliﬁed models and linear system theory such that the basic principles involved are
illustrated without the cumbersome mathematical details (and nonlinearities) that are often
found in the analysis of practical production vehicle systems.
Furthermore, the examples given in this book of any component/system are representative of
those found in any production vehicle. Proprietary issues prohibit the detailed discussion of
such production items. In addition, the technology of automotive electronics found in
production vehicles is constantly evolving and any detailed discussion of a given vehicle
electronic system as of the writing of this book might well be obsolete in the next model year.
There is an important notational issue concerning the analytical portions of this book. There
are many variables and parameters involved in the various components/systems discussed in
each chapter. The symbols used in this book include upper and lower case Roman and Greek
(often subscripted) letters. However, the reader should be aware that these symbols do not
have a global deﬁnition throughout the book. Rather, each symbol is deﬁned for the section of
the book in which it is used.
The units and dimensions for variables discussed in this book are English in keeping with
earlier editions, even though the worldwide automotive industry uses essentially all metric
units. However, conversion tables from English to metric units are readily available.
Moreover, those readers in the USA, having relatively limited backgrounds in the physical
sciences, are likely to be more familiar with English rather than metric units. Readers having
backgrounds in the sciences will ﬁnd unit conversion straightforward.
xvi
Introduction

CHAPTER 1
The Systems Approach to Control
and Instrumentation
Chapter Outline
Chapter Overview
1
Concept of a System
2
Block Diagram Representation of a System
3
Analog (Continuous Time) Systems
5
Linear System Theory: Continuous Time
5
First-Order System
9
Second-Order System
11
Steady-State Sinusoidal Frequency Response of a System
16
State Variable Formulation of Models
17
Control Theory
20
Open-Loop Control
20
Closed-Loop Control
21
Stability of Control System
28
Root-Locus Techniques
29
Robustness of Control-System Stability
31
Closed-Loop Limit-Cycle Control
34
Instrumentation
35
Measurement
36
Issues
36
Systematic Errors
37
Basic Measurement System
39
Sensor
40
Random Errors
42
Signal Processing
45
Filtering
45
Filter-Design Techniques
46
Chapter Overview
This book discusses the application of electronics in automobiles from the standpoint of
electronic systems and subsystems. In a sense, the systems approach to describing automotive
electronics is a way of organizing the subject into its component parts based on functional
Understanding Automotive Electronics. http://dx.doi.org/10.1016/B978-0-08-097097-4.00001-1
Copyright  2012 Elsevier Inc. All rights reserved.
1

groups. This chapter will lay the foundation for this discussion by explaining the concepts of
a system and a subsystem and how such systems function and interact with one another. The
means for characterizing the performance of any system will be explained so that the reader
will understand some of the relative beneﬁts and limitations of automotive electronic systems.
This chapter will explain, generally, what a system is and, more precisely, what an electronic
system is. In addition, basic concepts of electronic systems that are applicable to all
automotive electronic systems, such as structure (architecture) and quantitative performance
analysis principles, will be discussed. In the general ﬁeld of electronic systems (including
automotive systems), there are three major categories of function, including control,
measurement, and communication.
Two major classes of electronic systems e analog or continuous time and digital or discrete
time e will be explained. In most cases, it is theoretically possible to implement a given
electronic system as either an analog or a digital system. The relatively low cost of digital
electronics coupled with the high performance achievable relative to analog electronics has
led modern automotive electronic system designers to choose digital rather than analog
realizations for new systems.
Concept of a System
A system is a collection of components that function together to perform a speciﬁc task.
Various systems are encountered in everyday life. It is common practice to refer to the bones
of the human body as the skeletal system. The collection of highways linking the country’s
population centers is known as the interstate freeway system.
Electronic systems are similar in the sense that they consist of collections of electronic and
electrical parts interconnected in such a way as to perform a speciﬁc function. The
components of an electronic system include transistors, diodes, resistors, and capacitors, as
well as standard electrical parts such as switches and connectors among others. All these
components are interconnected with individual wires or with printed circuit boards. In
addition, many automotive electronic systems incorporate specialized components known as
sensors or actuators that enable the electronic system to interface with the appropriate
automotive mechanical systems. Systems can often be broken down into subsystems. The
subsystems also consist of a number of individual parts.
Any electronic system can be described at various levels of abstraction, from a pictorial
description or a schematic drawing at the lowest level to a block diagram at the highest level.
For the purposes of this chapter, this higher-level abstraction is preferable. At this level, each
functional subsystem is characterized by inputs, outputs, and the relationship between input
and output. Normally, only the system designer or maintenance technician would be
concerned with detailed schematics and the internal workings of the system. Furthermore, the
2
Chapter 1

only practical way to cover the vast range of automotive electronic systems is to limit our
discussion to this so-called system level of abstraction. It is important for the reader to realize
that there are typically many different circuit conﬁgurations capable of performing a given
function.
Block Diagram Representation of a System
At the level of abstraction appropriate for the present discussion, a block diagram will
represent the electronic system. Depending on whether a given electronic system application
is to (a) control, (b) measure, or (c) communicate, it will have one of the three block diagram
conﬁgurations shown in Figure 1.1. The designer of a system often begins with a block
diagram, in which major components are represented as blocks.
In block diagram architecture, each functional component or subsystem is represented by an
appropriately labeled block. The inputs and outputs for each block are identiﬁed. In electronic
systems, these input and output variables are electrical signals, except for the system input
and system output. One beneﬁt of this approach is that the subsystem operation can be
(a)
(b)
(c)
Figure 1.1:
Electronic system block diagrams variable being controlled.
The Systems Approach to Control and Instrumentation
3

described by functional relationships between input and output. There is no need to describe
the operation of individual transistors and components within the blocks at this block diagram
level.
In the performance analysis of an existing system or in the design of a new one, the system or
subsystem is represented by a mathematical model that is derived from its physical
conﬁguration. Normally, this model is derived from known models of each of its constituent
parts, i.e., its basic physics. Initially, this chapter will consider components, subsystems, and
system blocks that can be represented by a linear mathematical model. Later in the chapter,
the treatment of nonlinearities is discussed.
For a block having input x(t) and output y(t) that can be represented by a linear model, the
model is of the form of a differential equation of the form
aoy þ a1
dy
dt þ . an
dny
dtn ¼ box þ b1
dx
dt. bm
dmx
dtm
(1)
Typically, n  m and such a system block or component is said to be of order n. Analysis of
this block is accomplished by calculating its output y(t) for an arbitrary (but physically
realizable) input x(t). The performance of such a block in an automotive system normally
involves ﬁnding its response to certain physically meaningful inputs. Such analysis is
explained later in this chapter.
Figure 1.1a depicts the architecture or conﬁguration for a control application electronic system.
In such a system, control of a physical subsystem (called the plant) occurs by regulating some
physical variable (or variables) through an actuator. An actuator is an energy conversion device
having an electrical input and an output of the physical form required to vary the plant (e.g.,
mechanical energy) as required to perform the desired system function output. Thus, an
actuator has an electrical input and an output that may be mechanical, pneumatic, hydraulic,
chemical, or so forth. The plant being controlled varies in response to changes in the actuator
output. The control is determined by electronic signal processing based on measurement of
some variable (or variables) by a sensor in relationship to a command input by the operator of
the system (i.e., by the driver in an automotive application).
In an electronic control system, the output of the sensor is always an electrical signal (denoted
e1 in Figure 1.1). The input is the desired value of the physical variable in the plant being
controlled. The electronic signal processing generates an output electrical signal (denoted e2
in Figure 1.1) that operates the actuator. The signal processing is designed to achieve the
desired control of the plant in relation to the variable being measured by the sensor. The
operation of such a control system is described later in this chapter. At this point, we are
interested only in describing the control-system architecture. A redundant explanation of
electronic control is presented later in this chapter.
4
Chapter 1

The architecture for electronic measurement (also known as instrumentation) is similar to that
for a control system in the sense that both structures incorporate a sensor and electronic signal
processing. However, instead of an actuator, the measurement architecture incorporates
a display device. A display is an electromechanical or electro-optical device capable of
presenting numerical values to the user (driver). In automotive electronic measurement, the
display is sometimes simply a ﬁxed message rather than a numeric display. Nevertheless, the
architecture is as shown in Figure 1.1b. It should be noted that both control and
instrumentation electronic systems use one or more sensors as well as electronic signal
processing.
Figure 1.1c depicts a block diagram for a communication system. In such a system, data or
messages are sent from a source to a receiver over a communication channel. This particular
architecture is sufﬁciently general that it can accommodate all communication systems from
ordinary car radios to digital data buses between multiple electronic systems on cars, as well
as extravehicular communication. Communication systems are described in detail later in this
chapter.
Analog (Continuous Time) Systems
Modern automotive digital electronic systems have virtually completely replaced analog
systems. Whereas digital systems are represented by discrete time models, analog systems are
represented by continuous time models having a form such as is given in Eqn (1). Normally
automotive electronic systems incorporate components (e.g., sensors and actuators) that are
best characterized by continuous time models. Typically, only the electronic portion is best
characterized by discrete time models. Furthermore, even the digital electronics can be
represented by an equivalent continuous time model, which can be converted to a discrete
time equivalent readily. Consequently, this discussion begins with a brief overview of linear
continuous time system theory. The discrete time system theory is reviewed in the next
chapter.
Linear System Theory: Continuous Time
The performance of a continuous time block (i.e., component/system) is found from the
solution to the differential equation Eqn (1) for a speciﬁc input. One straightforward method
of solving this equation is to take the Laplace transform of each term. The Laplace transform
(also denoted xðsÞ ¼ L ½xðtÞÞ of the input is denoted x(s) and is deﬁned as following the
linear integral transform of its time domain representation:
xðsÞ ¼
ZN
o
estxðtÞdt þ xðtÞ

t¼0
(2)
The Systems Approach to Control and Instrumentation
5

where
s ¼ s þ ju ¼ complex frequency
and where
j ¼
ﬃﬃﬃﬃﬃﬃﬃ
1
p
(3)
Similarly, the Laplace transform of the block output is denoted y(s) and is given by
yðsÞ ¼
ZN
o
estyðtÞdt þ yðtÞ

t¼0
(4)
The differential equation model for a given continuous time block includes time derivatives of
the input and output. The Laplace transform of the time derivative of order m of a variable
(e.g., the input) is given by
ZN
o
est dmx
dtmdt ¼ smxðsÞ
m ¼ 1; 2.
(5)
Assuming for simplicity that the initial conditions for both input and output are zero,
xðtÞ

t¼0 ¼ 0;
yðtÞ

t¼0 ¼ 0
the Laplace transform of the differential equation (Eqn (1)) for the block yields

a0 þ a1s þ a2s2 / ansn
yðsÞ ¼ ½b0 þ b1s þ / bmsmxðsÞ
(6)
It is conventional for the purpose of conducting analysis for continuous time systems to deﬁne
the transfer function (H(s)) for each block:
HðsÞ ¼ yðsÞ
xðsÞ
¼ b0 þ b1s þ / bmsm
a0 þ a1s þ / ansn
(7)
The transfer function concept is highly useful for continuous time linear system analysis
since the transfer function for any such system made up of a cascade connection of K blocks
(e.g., as depicted in Figure 1.2) is the product of the transfer functions of the individual
blocks.
6
Chapter 1

Denoting the transfer function of the kth block Hk(s), and for the complete system H(s), the
latter is given by
HðsÞ ¼
Y
K
k¼1
HkðsÞ
(8)
An alternate, highly useful, formulation of the transfer function is based on the roots of
equations formed from its numerator and denominator polynomials. The roots zj of the
numerator polynomial (PN(s)) are the m solutions to the equation
PNðsÞ ¼ b0 þ b1s þ / bmsm ¼ 0
(9)
where
PNðzjÞ ¼ 0
j ¼ 1; 2.m
are called the zeros of the transfer function. Similarly, the roots pi of the denominator
polynomial (PD(s)) are the n solutions to the equation
PDðsÞ ¼ a0 þ a1s þ / ansn ¼ 0
(10)
where
PDðpiÞ ¼ 0
i ¼ 1; 2.n
are called the poles of the transfer function. For a system that is stable, all poles and zeros
have negative real parts (i.e., s < 0) or, equivalently, all poles and zeros of a stable system lie
in the left half of the complex s-plane. The dynamic response of the block to any input is
determined by its poles and zeros.
The alternate form for H(s) in terms of its poles and zeros is given by
HðsÞ ¼
Q
m
j¼1
ðs  zjÞ
Q
n
i¼1
ðs  piÞ
(11)
Figure 1.2:
System cascade connection block diagram.
The Systems Approach to Control and Instrumentation
7

The time domain response of a continuous time block to any given input is given by the
inverse Laplace transform of Y(s). One method of computing this inverse Laplace transform
uses the residue theorem of complex analysis. The block output Y(s) is given as
YðsÞ ¼ HðsÞXðsÞ
(12)
The residue theorem expresses the output time domain in terms of the poles and zeros of the
product H(s)X(s) and includes the poles and zeros of H(s) as well as any zeros and poles of the
input:
YðsÞ ¼
Q
m
j¼1
ðs  zjÞ
Q
n
i¼1
ðs  piÞ
(13)
Assuming that all of the poles are distinct (i.e., pj 6¼ pk unless j ¼ k), the time domain output
is given by
yðtÞ ¼
X
N
k¼1
ðs  pkÞHðsÞXðsÞ
 epkt
s/pk
(14)
In evaluating this expression, the pole at s ¼ pk is canceled by the term (s  pk) in the
remaining portion of H(s)X(s). That is, each pole of the product contributes an exponential
term to the output.
The above formula for calculating the output time domain is, in fact, the inverse Laplace
transform of y(s) denoted:
yðtÞ ¼ L 1½YðsÞ
(15)
The formula given above for calculating the inverse transform is known as the residue
theorem.
The inverse Laplace transform of a system transfer function H(s) is known as its impulse
response. It is denoted h(t) and is given by the inverse Laplace transform of H(s):
hðtÞ ¼ L 1½HðsÞ
(16)
It is the response of a linear system to a unit impulse. The output of a linear system can be
found from its impulse response by the so-called convolution theorem which is given as
follows:
yðtÞ ¼
ZN
N
hðsÞ x ðt  sÞds
(17)
8
Chapter 1

For any causal stable system, the impulse response is zero for negative argument:
hðsÞ ¼ 0
s  0
(18)
One of the important inputs for assessing the performance of a block is its response to a unit
step input
xðtÞ ¼ 0
t < 0
¼ 1
t  0
It is straightforward to show that the Laplace transform of this step input is given by
xðsÞ ¼ 1
s
That is, this step input contributes one pole to the product H(s)X(s) at s ¼ 0.
First-Order System
As an example of this type of analysis, we consider the step response of a ﬁrst-order block
whose model is given by
a0y þ a1
dy
dt ¼ b0x
(19)
The transfer function for this block is given by
HðsÞ ¼
b0
a0 þ a1s ¼
b0
a1
s þ a0
a1
(20)
This transfer function has a single pole
where
p ¼  a0
a1
:
The block output has poles at s ¼ 0 and s ¼  a0
a1
.
The time response of this block to a unit step is given by
yðtÞ ¼ b0
a1

1  exp

 a0t
a1
	
(21)
The Systems Approach to Control and Instrumentation
9

It is common practice to characterize the step response of a ﬁrst-order system in terms of the
reciprocal of its pole, denoted s here:
s ¼ a1
a0
This parameter has dimensions of time (sec) and is called the ﬁrst-order time constant for the
system. Continuing with the present example, Figure 1.3 depicts the unit step response of
a ﬁrst-order system in which b0 ¼ 3, a0 ¼ 0.5, and a1 ¼ 1.0. A second-order system has two
poles which are either both negative real or a complex conjugate pair with negative real parts.
This latter case will have a step response of the form of a sinusoid of exponentially decreasing
amplitude. A second-order system step response example is presented later in this chapter.
For higher than second order, no simple intuitive description of the response is possible. Such
higher-order systems are encountered as examples later in this book.
The dynamic response of any linear continuous time automotive system (regardless of its
physical form e.g. electronic, mechanical etc) is found in the same procedure as given above.
That is, a mathematical model of the system of the form of Eqn (1) is developed. It should be
noted before proceeding that, depending upon the variables chosen for the model, one or more
of the initial formulations may contain time integrals of certain variables. That equation can
be reduced to the form of Eqn (1) by differentiating all terms with respect to time.
Figure 1.3:
Unit step response of a ﬁrst-order system.
10
Chapter 1

Alternatively, in the second step of taking the Laplace transform of the equation, the Laplace
transform of the integral of a variable, e.g.
Zt
0
xðt0Þ dt0
(with assumed zero initial condition) is given by
ZN
0
est
0
@
Zt
0
xðt0Þdt0
1
A dt ¼ xðsÞ
s
(22)
The next step in the analysis process is to form the transfer function for each block in the
system. The transfer function for the entire system is the product of the transfer function for
each block in any cascade connection. Of course, not all automotive systems have a simple
cascade connection topology. Rather, automatic control systems have a topology that involves
connecting the output of some block to the input of a previous block as will be explained later.
Fortunately, there are computer simulation application programs (e.g., MATLAB/
SIMULINK) that can ﬁnd the solution to the system differential equation for any of the
practically useful inputs for system analysis. However, any computer simulation program
requires that each block in the system be modeled as accurately as possible. One of the
primary beneﬁts to computer simulation for system performance analysis is that these
programs can handle nonlinearities. It is shown via example later in this book that computer
simulation of system performance also permits optimization of any given design conﬁguration
by selectively varying certain key parameters. Ultimately, however, the value of design/
analysis through computer simulation is dependent on the accuracy of the model for each
component. To support the computer simulation approach to system design/analysis, much of
the remaining chapters of this book are devoted to modeling both automotive components and
electronic system blocks and conducting performance analysis via simulation.
Second-Order System
As an example of the performance analysis of a second-order continuous time linear system,
we consider a spring/mass/damper subsystem as depicted in Figure 1.4. This example is
a highly oversimpliﬁed lowest approximation to an automotive suspension system at one
wheel (i.e., quarter car). In this ﬁgure a mass (Mu) representing the wheel/tire/brake assembly
(called the unsprung mass) that is attached via spring having spring rate K and viscous damper
(e.g., shock absorber) having damping parameter D to an inertial reference frame denoted Ms.
A time-varying force F(t) is applied vertically to mass Mu. The instantaneous displacement of
mass Mu relative to its position for F ¼ 0 is denoted y(t).
The Systems Approach to Control and Instrumentation
11

The model for the dynamic response of y(t) to force F(t) is found by setting the sum of all
forces in the y-direction to 0:
F  Mu€y  D _y  Ky ¼ 0
(23)
where
_y ¼ dy
dt
€y ¼ d2y
dt2
The second term on the left-hand side of the equation is the inertial force associated with
acceleration of mass Mu. The 3rd term is the force due to the viscous damper and the last term
is the force due to the spring displacement. Here and throughout this book, the dot over
a variable is common notation for its derivative with respect to time. This differential equation
can readily by put in a form similar to our standard model of Eqn (1):
Mu€y þ D_y þ Ky ¼ F
(24)
It is common practice when dealing with second-order blocks such as this to rewrite the
equation by dividing it by Mu and introducing the following parameters:
u0 ¼
ﬃﬃﬃﬃﬃﬃﬃ
K
Mu
r
¼ natural frequency
Ms
Mu
K
D
f
y
REST POSITION
Figure 1.4:
Example second-order system conﬁguration.
12
Chapter 1

z ¼
D
2u0Mu
¼ damping ratio
That standard form differential equation is
€y þ 2zu0 _y þ u2
0y ¼ F
Mu
(25)
The solution to this differential equation is most readily found using the Laplace transform
method explained earlier in this chapter. Assuming for convenience that the system is initially
at rest (i.e., F(0) ¼ 0, dy(0) ¼ 0), the Laplace transform of the differential equation is given by

s2 þ 2zu0s þ u2
0

yðsÞ ¼ FðsÞ
Mu
(26)
The operational transfer function is given by
HðsÞ ¼ yðsÞ
FðsÞ ¼
1=Mu
s2 þ 2zu0s þ u2
0
(27)
The response of the example second-order system to an arbitrary input F(t) can be found by
ﬁrst ﬁnding F(s) and then taking the inverse Laplace transform (e.g., by the method of
residues) to obtain y(t). However, in practice, solutions to the differential equations derived
for systems/subsystems/components are done using computer simulation tools (e.g.,
MATLAB/SIMULINK). These simulation tools permit analysis of system response for
systems that have nonlinear models and are of essentially arbitrary second order.
It is beyond the scope of this work to fully explain the MATLAB/SIMULINK tools, which
are, in any event, covered very well by the accompanying documentation. Rather, the purpose
here is to continue with the dynamic analysis of the second-order example system. For time
domain analysis using MATLAB/SIMULINK, it is helpful to rewrite the original differential
equation in the form
€y ¼ FðtÞ  D _y
Mu
 Ky
Mu
Simulation programs such as SIMULINK incorporate blocks from a library of standard
blocks that are connected together to form a block diagram of the complete system such that
the necessary operations to solve the equation are performed in the correct sequence. One of
the most important operations in solving any differential equation is integration with respect
to time. The block, which performs the time integral of its input, is depicted in the
SIMULINK library by the symbol of
s
1
The Systems Approach to Control and Instrumentation
13

That is, the operational transfer function of a time integral is 1
s which is implied by this library
block. The input to this block is on its left side and its output is on the right.
Multiplication by a constant K is depicted by the symbol:
The sum (or difference) of two or more variables is depicted by the block
The number of  signs on the block is chosen by the user to be the number of variables being
summed with the correct signs for the variables in the equation being solved. Various inputs to
the system (i.e., f (t)) are available from the SIMULINK library, including step, sinusoid,
signal generator, random process, and an arbitrary user created input function that is stored in
a ﬁle that is represented by a block in the SIMULINK block diagram. It is helpful in
interpreting the SIMULINK block diagram for the example second-order system to note the
following relationships:
_y ¼
R €ydt
y ¼
R _ydt
These relationships are implied by the MATLAB/SIMULINK system depicted in Figure 1.5.
This ﬁgure is a SIMULINK block diagram for ﬁnding the unit step response of the example
second-order system. In this ﬁgure, the input F(t) is a unit step and the output of the summing
(input)              K                    (output)
(input)            
−
+
            (output)
˙
у
у
у
ÿ
t
D
M
K
M
1
s
1
s
+
to workspace
to work space 1
clock
sum
unit step
integrator 1
integrator 2
F(t)
Figure 1.5:
MATLAB/SIMULINK second-order system.
14
Chapter 1

block is €y. The inputs to this block are the components of the right-hand side of the second-
order differential equation above. The ﬁrst integrator output is _y and the second integrator
output is y. The ﬁrst gain block is a constant multiplier of value D/Mu and the second is
a constant of value K/Mu. The block labeled “To Workspace” with label y is a ﬁle that is
created by the simulation output. Below the main simulation block diagram is a second ﬁle
“To Workspace 1” which creates a ﬁle of time that is synchronous with the output y.
To further illustrate the use of this SIMULINK model, the following speciﬁc parameters were
arbitrarily chosen:
Mu ¼ 1:7
K ¼ 50
D ¼ 5:83
The input is a unit step at t ¼ .5 s, i.e.,
FðtÞ ¼ 0
t  :5
¼ 1
t  :5
Figure 1.6 is a graph of y(t) depicting the motion of the mass Mu in response to this step.
In later chapters of this book, we will present examples of the dynamic response of
automotive systems/subsystems with models which are much more accurate in representing
the actual physical devices.
Figure 1.6:
Unit step response of example second-order system.
The Systems Approach to Control and Instrumentation
15

Steady-State Sinusoidal Frequency Response of a System
Another important input in conducting performance analysis of a system is the sinusoidal
function. The input in this case is of the form x(t) ¼ A cos(ut) þ B sin(ut), where A and B can
be varied to evaluate certain system responses (including setting either variable to zero).
There is an important identity from complex analysis that simpliﬁes the calculation of the
sinusoidal frequency response of any system which is given by
ejut ¼ cosðutÞ þ j sinðutÞ
(28)
This identity can also be expressed by the following relations:
cosðutÞ ¼ Re½ejut
sinðutÞ ¼ Im½ejut
(29)
where Re( ) is the real and Im( ) is the imaginary component of the argument and
where u ¼ 2pf (f ¼ natural frequency Hz).
For any stable, linear system, its response to a sinusoidal input consists of two parts: transient
response and steady-state sinusoidal response. The transient response is the dynamic output
of the system to the initial application of the sinusoid. Each component of this transient
response decays exponentially to zero. Following the period in which the transient decays to
zero, the remaining output is a steady-state sinusoidal (SSS) output. It is the SSS response that
is the goal of the system analysis with input
xðtÞ ¼ Re½Xejut
The steady-state sinusoidal (SSS) frequency response system output (after all transients have
decayed to zero) is of the form
yðtÞ ¼ Re½YðjuÞejut
The steady-state sinusoidal sinusoidal frequency response, which is denoted H(ju), is deﬁned as
HðjuÞ ¼ YðjuÞ
XðjuÞ
(30)
This SSS is a complex function of ju. It is identical to the transfer function along the
imaginary axis of the complex frequency plane or an s-plane. Thus, the SSS is obtained by
replacing s in the transfer function with (ju):
HðjuÞ ¼ HðsÞ

s¼ju
(31)
16
Chapter 1

Since it is a complex-valued function, it can be expressed in the form of an absolute value or
magnitude ðjHðjuÞjÞ and a phase angle f:
HðjuÞ ¼ jHðjuÞj ejfðuÞ
(32)
The magnitude of H(ju) is the ratio of the amplitude of its SSS response to the amplitude of
the sinusoidal input. The phase f(u) is the phase of the output to the input sinusoid.
The SSS is useful for evaluating the ﬁdelity of the system response over the spectrum of the
input. Ideally, a system block should have a constant amplitude and phase over the entire
frequency content of its input. In practice, any physically realizable block has a response that
varies with frequency u. Often the system designer can choose design parameters to achieve
acceptable performance over a required frequency range. The range of frequencies over
which such acceptable performance is achieved is termed its “bandwidth.” The same
computer simulation software used to evaluate step response is capable of calculating and
plotting the SSS frequency response. Normally, this is presented in a “Bode” plot format in
which the magnitude and phase are given in the form
magnitude : 20 logjHðjuÞjvs: logðuÞ
phase : fðuÞvs: logðuÞ
This Bode plot can be evaluated by the software from the same mathematical model for the
block as is used to calculate its step response.
State Variable Formulation of Models
Often in the process of modeling physical systems (such as automotive systems or
subsystems), it is possible to write a set of ﬁrst-order linear differential equations for a set of N
variables. This set of variables is denoted
xn ;
n ¼ 1; 2/N
The differential equations are written in the form
_xm ¼
X
N
n¼1
Amnxn þ
X
K
k¼1
Bmkuk
(33)
where Amn and Bmk are constants for the given physical system. A unique solution for each
independent variable for any given known input set is possible provided that there are N
independent equations of the above form. For this type of model, the set of equations can be
written in matrix form
The Systems Approach to Control and Instrumentation
17

_x1 ¼ A11x1 þ /A1NxN þ B11u1/B1KuK
«
_xN ¼ AN1x1/ANNxN þ BN1u1/BNKuK
(34)
An N-dimensional vector x is then deﬁned as
x ¼ ½x1x2/xNT
(where T/transpose). The variables xn in this formulation are known as “state variables.”
Similarly, the input is deﬁned as the K-dimensional vector
u ¼ ½u1/uKT
These equations are written in a standard “state variable model” form:
_x ¼ Ax þ Bu
(35)
where, for any real physical system,
x˛RN
u˛RK
A˛RNN
B˛RNK
The desired output variables for the system
yj ¼
X
N
n¼1
Cjnxn þ
X
K
k¼1
Djkuk
j ¼ 1; 2/J
(36)
In this formulation, the possibility that a set of input variables contributes to various outputs is
shown by the second term on the right-hand side of the above equation. This set of output
equations can also be put in matrix form in terms of the output vector
y ¼ ½y1y2/yJT
y ¼ Cx þ Du
(37)
where
y˛RJ
C˛RJN
D˛RJK
18
Chapter 1

The complete model for the system in standard state variable form is given by
_x ¼ Ax þ Bu
y ¼ Cx þ Du
(38)
This system of equations is solved by taking Laplace transforms of the equations. For the
present discussion, we assume zero initial conditions (i.e., xnð0Þ ¼ 0 cn). The system of N
ﬁrst-order differential equations becomes a system of N algebraic equations in the complex
variable s:
sxðsÞ ¼ AxðsÞ þ BuðsÞ
yðsÞ ¼ CxðsÞ þ DuðsÞ
(39)
The ﬁrst of these equations can be rewritten in the form
ðsI  AÞxðsÞ ¼ BuðsÞ
(40)
where I ¼ N-dimensional identity matrix (i.e., all diagonal elements are 1 and off-diagonal
elements are 0) and I˛RNN.
This equation can be solved for x(s) by multiplying both sides by the inverse of the matrix
(sIA), which is denoted (sIA)1:
xðsÞ ¼ ðsI  AÞ1BuðsÞ
(41)
the desired output y(s) is given by
yðsÞ ¼ CðsI  AÞ1BuðsÞ þ DuðsÞ
¼ HðsÞuðsÞ
The output equation is actually a set of J equations for variables yj :
yjðsÞ ¼
X
K
k¼1
HjkðsÞ ukðsÞ
j ¼ 1; 2; .J
(42)
The response of any output variable yj to any single input uk is given by the operational
transfer function HjkðsÞ:
yj ¼ HjkðsÞukðsÞ
k ¼ 1; 2; .K
The corresponding time domain variable yj(t) can be found by taking the inverse Laplace
transform or equivalently using the residue theorem method. The state variable formulation is
used later in the book with respect to automotive electronic systems.
The Systems Approach to Control and Instrumentation
19

Control Theory
Electronic control systems have many applications in modern automobiles. We present here
a general theory of linear control systems that is useful for explaining and understanding
those encountered in later chapters.
There are two major categories of control systems: open-loop (or feedforward) and closed-
loop (or feedback) systems. There are many automotive examples of each, as we will show in
later chapters. The architecture of an open-loop system is given in the block diagram of
Figure 1.7.
Open-Loop Control
The components of an open-loop controller include the electronic controller, which has an
output to an actuator. The actuator, in turn, regulates the plant being controlled in accordance
with the desired relationship between the command input and the value of the controlled
variable in the plant. Many examples of open-loop control are encountered in automotive
electronic systems, such as fuel control in certain operating modes. An open-loop control
system never compares actual output with the desired value.
In the open-loop control system of Figure 1.7, the command input is sent to the electronic
controller, which performs a control operation on the input to generate an intermediate
electrical signal (denoted i in Figure 1.7). This electrical signal is the input to the actuator
which generates a control input (denoted u in Figure 1.7) to the plant that, in turn, regulates
the plant output to the desired value. This type of control is called open-loop control because
the output of the system is never compared with the command input to evaluate control-
system performance at regulating the output to the desired input.
The operation of the plant is directly regulated by the actuator (which might simply be an
electric motor). Chapter 6 presents a discussion of various actuators used in automotive
electronic control systems. The system output may also be affected by external disturbances
that are not an inherent part of the plant but are the result of the operating environment. There
are many disturbances occurring in automotive electronic systems as discussed later.
Figure 1.7:
Open-loop system conﬁguration.
20
Chapter 1

One of the principal drawbacks to the open-loop controller is its inability to compensate for
changes that might occur in the controller or the plant or for any disturbances or due to
environmental changes. This defect is eliminated in a closed-loop control system, in which
the actual system output is compared to the desired output value in accordance with the input.
Of course, a measurement must be made of the plant output in such a system, and this requires
measurement instrumentation (discussed later in this chapter).
Closed-Loop Control
In its simplest form (which can be expanded to cover very complex systems), the block
diagram of a so-called “electronic feedback-control system” is depicted in Figure 1.8. In this
conﬁguration, the control system is intended to regulate the output (y) of a system or
subsystem called the “plant.” Normally the goal of this control system is to have the output
equal to the system input (x) often called the reference input. Wherever a difference (called
error ˛) between the output and reference input is nonzero, the control subsystem or
compensator (an electronic subsystem) generates a variable (u) that causes the plant input to
change in such a way as to reduce the error toward zero. The conﬁguration of Figure 1.8 is
called a feedback-control system because a measurement of the plant output via a sensor is
“fed back” to the input. The topology of the system is such that the signal path back to the
input forms a loop (i.e., a closed-loop). The sensor has an electrical output which is given here
as its output voltage (ys).
In order that the control variable u can cause a change in the plant output there must be
a component (i.e., an actuator), which receives this electrical input, and cause the plant to
change its state. Typically, this component is electromechanical in nature. The response of the
plant to this electrical input is normally called its “open-loop” response.
The goal of the present discussion is to develop models for the feedback-control system
by which its dynamic performance can be analyzed. The performance of the control system
is inﬂuenced by its system component dynamics. Normally the control-system designer
can optimize closed-loop system performance in some sense by proper design of the
compensator/controller. In modern automotive electronic control systems, the compensator
compensator
(controller)
Hc(s)
Plant
Hp(s)
(input)
(output)
Є
u
x
y
ys
+
–
Sensor
Hs(s)
Figure 1.8:
Closed-loop feedback-control-system conﬁguration.
The Systems Approach to Control and Instrumentation
21

is implemented by a microprocessor or microcontroller as explained in later chapters. In such
cases the compensator operation is determined by the program(s) running its microcontroller.
However, at this point it is useful to characterize the entire closed-loop control system as
a continuous time system. The next chapter discusses discrete time models and digital control
techniques.
It is assumed for the present that the models for the various components are known and that
each can be characterized by a transfer function. These models are given by the following:
error ˛ ¼ x  ys
(43)
plant yðsÞ ¼ HpðsÞuðsÞ
(44)
compensator uðsÞ ¼ HcðsÞ˛ðsÞ
(45)
sensor ySðsÞ ¼ HSðsÞyðsÞ
(46)
Combining the models for the components, the following model can be written for the closed-
loop system:
yðsÞ ¼

HpðsÞHcðsÞ
1 þ HsðsÞHpðsÞHcðsÞ

(47)
For convenience (and without serious loss of generality), the sensor transfer function is taken
to be unity (i.e., Hs(s) ¼ 1) yielding the most familiar form of the closed-loop transfer
function Hc‘ðsÞ, which is deﬁned as follows:
Hc‘ðsÞ ¼ yðsÞ
xðsÞ
Hc‘ðsÞ ¼
HpðsÞHcðsÞ
1 þ HpðsÞHcðsÞ
(48)
Although there is a large class of compensator conﬁguration, there are three main types that
have been in widespread use as outlined below:
1.
proportional u ¼ Kp˛
2.
proportionaleintegral (PI) u ¼ Kp˛ + KI
R
˛dt
3.
proportionaleintegraledifferential (PID)
u ¼ Kp˛ þ KI
Z
˛dt þ KD
d˛
dt
22
Chapter 1

The transfer functions for these three types are:
1.
P: HcðsÞ ¼ Kp
2.
PI: HcðsÞ ¼ Kp + KI
s
3.
PID: HcðsÞ ¼ Kp + KI
s + KDs
where KP is the proportional gain, KI the integral gain, and KD the differential gain.
The closed-loop dynamic response is inﬂuenced by the type of control via the compensator.
Generally, the compensator (or controller) performs a transformation on the error signal to
satisfy certain criteria, including:
1.
transient response characteristics
2.
steady-state errors
3.
disturbance rejection
4.
sensitivity to plant parameter changes over time or with environmental parameter changes
(e.g. temperature)
In addition to these criteria, it is also necessary that the closed-loop system be stable in the
sense that a bounded input produces a bounded output. By contrast, an unstable system has an
output that grows continuously regardless of input until some (typically nonlinear) limit is
reached in one of its components or subsystems. The output of such a system at its limit is said
to be in saturation.
We consider ﬁrst the criterion of transient response. The transient response for most closed-loop
systems is best representedbyits response to a unitstep (i.e.,itsstepresponse).Assuming that the
closed-loop system is stable, it is possible to make several general remarks about the relative step
response for various compensator transfer functions. A proportional controller (i.e., Hc(s) ¼ Kp)
has a steady-state error where this error varies inversely with proportional gain Kp.
Alternatively, a PI compensator which has a transfer function
HcðsÞ ¼ Kp þ KI
s
(49)
has a steady-state error of zero:
Lim
t/N ˛ðtÞ ¼ 0
provided that the system is stable.
However, for many plants the addition of an integral term in the compensator component can
reduce stability of the closed-loop system relative to that for a proportional-only compensator
for sufﬁciently large integral gain KI.
The Systems Approach to Control and Instrumentation
23

The addition of a derivative term to the compensator resulting in a PID controller can improve
the transient response in certain respects relative to a PI controller. Typically, it can increase
the initial rate of a change of the output

i:e:; dy
dt jt¼0

, although it may do so with an
overshoot of the ﬁnal intended value, depending upon the associated gain KD. The relative
beneﬁts of these types of controllers depend upon the particular application as well as the
other system criteria.
We illustrate the inﬂuence of the compensator on transient response with the second-order
system (see Figure 1.4) introduced above consisting of a mass that is connected to an inertial
reference frame by a parallel spring and viscous damper (i.e., a highly simpliﬁed model for
a suspension system). Acting on this mass is a force F(t) which changes its vertical position
y(t). It was shown above that the transfer function of this was shown to be
yðsÞ
FðsÞ ¼
1=Mu
s2 þ 2zu 0s þ u2
0
(50)
where the parameters u0 and z are given above in the discussion of a second-order system. A
closed-loop control system is to be formed in which the vertical position is to be regulated to
the reference x by the force which is generated by an actuator. The actuator model is
F ¼ Kau
where Ka is the actuator constant and u is the control signal from the compensator. We
consider, initially, a proportional compensator having the following model:
u ¼ Kp˛
where
˛ ¼ error
¼ x  y
The open-loop transfer function of this plant Hp(s) ¼ y(s)/u(s) is given by
Hp ¼
Ka=Mu
s2 þ 2zu0s þ u2
0
(51)
In order to better understand the performance of a closed-loop system, it is helpful to consider
the open-loop response. We illustrate with the second-order system as the plant. We assume
24
Chapter 1

that the actuator has a gain Ka ¼ 50, Kp ¼ 53.3, Mu ¼ 1.7, and D ¼ 17.6. Using these
parameters, the step response to unit force is shown in Figure 1.9.
The closed-loop transfer function is given by
Hc‘ ¼ yðsÞ
xðsÞ
(52)
¼
KpHpðsÞ
1 þ KpHpðsÞ
(53)
KaKp
Mu

s2 þ 2zu2
0 þ u2
0 þ KaKp
Mu
	
(54)
Using the parameters from the earlier example, it is possible to evaluate the step response via
simulation using MATLAB/SIMULINK. Figure 1.10 is a plot of the unit step response to
a command input step for two values of the proportional gain. The practical automotive
application for this example could be a commanded change in the vehicle height above the
ground in an electronically controlled suspension system (see chapter on motion control).
Figure 1.9:
Unit step response of example closed-loop system.
The Systems Approach to Control and Instrumentation
25

This plot shows that the steady-state unit step (at 0.5 sec) response error varies inversely with
proportional gain. Note, however, that the damping of the closed-loop system is decreased
with increasing gain (Kp) as is shown by the greater overshoot of y(t) for Kp ¼ 10 relative to
that for Kp ¼ 5.
Consider next the step response of a PI controller. An integral term ðKI
R
˛dtÞ was added to
the controller of the previous example. The closed-loop transfer function for this system is
given by
Hc‘ðsÞ ¼
KaðKps þ KIÞ=Mu
ðs2 þ 2zu0s þ u2
0Þs þ ðKps þ KIÞ Ka
Mu
(55)
Using the same second-order system parameters, response to a unit step at t ¼ 0.5 sec can be
found using MATLAB/SIMULINK. Generally speaking, the addition of an integral term in
the controller forces the steady-state error toward zero. Figure 1.11 is a plot of the unit step
response error for Kp ¼ 5 and KI ¼ 15. Note also that the overshoot (about 25%) is greater
than the proportional controller (about 12.5%) for the same Kp. However, the steady-state
error asymptotically approaches zero as predicted above.
A further improvement to the dynamic response of a control system is possible by including
a derivative term
Figure 1.10:
Response of proportional feedback-control system.
26
Chapter 1

KD
d˛
dt
such that the compensator transfer function is given by
HcðsÞ ¼ Kp þ KI
s þ KDs
(56)
Figure 1.12 is a plot of the unit step (at t ¼ 0.5 sec) response of the PID closed-loop
system having the same second-order system for the plant. In the ﬁgure, Kp ¼ 5, KI ¼ 10,
and KD ¼ 0.5.
This closed-loop system has the zero steady-state error properties of PI closed-loop system,
but has very little overshoot and very rapid response to any dynamic input. The above
examples clearly show that PID control has the potential for excellent closed-loop dynamic
response.
Caution must be exercised by the control-system design in choosing the type of controller as
well as the gains. Certain values of these gains can adversely affect the closed-loop system
relative to both its open-loop response or other gain choices. In the extreme case, the
controller, if poorly designed, can yield an unstable closed-loop system as will be discussed in
the next section of this chapter.
Figure 1.11:
Response of proportionaleintegral feedback-control system.
The Systems Approach to Control and Instrumentation
27

Stability of Control System
One of the most important issues concerning the practical utility of any control system is its
stability. Simply put, a control system is stable if a bounded input results in a bounded output.
What this means effectively is that a system will not “run away” on its own. In most cases, the
output of an unstable system will grow in amplitude until some physical limitation ceases its
growth.
However, the stability of a closed-loop control system does not necessarily require that the
plant being controlled is, itself, stable. In fact, a control system can, in certain cases, stabilize
an unstable plant such as in the case of many modern ﬁghter aircraft (e.g., F-16). However, the
application of a stabilizing control system for an unstable plant is rare in automotive
applications.
Modern control methodology offers the system designer many important tools for assessing
the stability of a control system. Commercially available software provides a control-system
designer the capability of rapidly assessing the stability of a candidate control system
provided a relatively robust linear mathematical model is available for the system. It is
beyond the scope of this book to cover all techniques for evaluating control-system stability.
However, we present one of the important techniques considered here called the root locus
technique. It is important in any control-system application and especially so in automotive
Figure 1.12:
Response of PID control system.
28
Chapter 1

systems to have some margin of stability to insure that the system remains stable even if some
system parameters change with time over the vehicle lifetime. One way of evaluating the
robustness of a control system to parameter variations is through an analysis technique called
gain and phase margin, which is also explained below.
Root-Locus Techniques
We begin with a brief survey of root-locus techniques. A root locus of a control system is
a plot of the poles of its closed-loop transfer function as some system parameter is varied. It
has been shown that the closed-loop transfer function for a plant having open-loop transfer
function Hp(s) being controlled by a controller having transfer function Hc(s) and assuming
an ideal sensor (i.e., Hs(s) ¼ 1) is given by
Hcl ¼
HcðsÞHpðsÞ
1 þ HcðsÞHpðsÞ
(57)
The poles of this transfer function are the zeros (in the complex s-plane) of the function:
1 þ HcðsÞHpðsÞ ¼ 0
(58)
In order to assess the inﬂuence of a parameter K on system stability, the above equation must
be rewritten in the following form:
1 þ K GðsÞ ¼ 0
(59)
This expression is known as the characteristic equation for the closed-loop system. The root
locus for this system is the locus in the complex s-plane of the zeros of the equation as
a function of the parameter K. Once in this form, the root locus is readily obtained using the
MATLAB rlocus [G(s)] function. In practice, it is convenient to write G(s) as a ratio of
functions N(s) e numerator polynomial e and D(s) e denominator polynomial:
1 þ K NðsÞ=DðsÞ ¼ 0
(60)
or
DðsÞ þ K NðsÞ ¼ 0
The root-locus function ﬁnds and plots the roots of this equation on a complex-valued polar
graph. For the system to remain stable, none of the roots can be in the right half of this
complex plane plot. Any system having one or more roots on the imaginary axis are neutrally
stable, a condition that cannot be tolerated in any automotive system that can affect vehicle
stability or occupant safety.
The Systems Approach to Control and Instrumentation
29

As an example of the use of root locus, we consider the second-order system plant depicted in
Figure 1.4 and having transfer function given by Eqn (51) with a PID controller. The transfer
function for this controller is given by
HcðsÞ ¼ Kp þ KI
s þ KDs
(61)
which can be rewritten in the form
HcðsÞ ¼ Kp
s
KD
Kp
s2 þ s þ KI
Kp

(62)
The parameter K in the general formula given above for root locus is taken to be Kp. In this
case, it is possible to examine closed-loop stability as Kp is varied while keeping KI/Kp and
KD/Kp ﬁxed. It can be shown for this system that the G(s) needed for the root locus is
given by
GðsÞ ¼
KD
Kp
s2 þ s þ KI
Kp
	
sðs2 þ 2zu0s þ u2
0Þ
Ka
Mu
(63)
The root locus for the system for variations in the parameter Kp with ﬁxed ratios
KD
Kp
¼ 0:5
KI
Kp
¼ 1:5
is given in Figure 1.13. The closed-loop transfer function for this example is a cubic function
of s so that there are three roots to the characteristic equation. The root loci are the paths
indicated by the solid curves beginning at the roots for Kp ¼ 0 indicated in the ﬁgure by
asterisks. As the gain increases, the roots move from these initial values as shown. In this root-
locus plot, the dashed straight lines from the origin are loci of constant pole damping ratio and
the dashed circles about the origin represent constant magnitude of poles. This ﬁgure shows
that the closed-loop poles remain in the left half of the complex s-plane c Kp for which the
system is stable. The closed-loop dynamic response of this system can be altered (within
certain limits) by suitable gain choices.
The root-locus technique can be used to assist the design of the controller particularly if the
speciﬁcations for the closed-loop system performance include placing the corresponding
poles in certain regions of the complex plane. For example, the damping ratio or step response
30
Chapter 1

overshoot might be speciﬁed; the gains can be chosen such that the closed-loop system has
poles in locations that satisfy the requirements.
As explained at the beginning of this section, there are many techniques in addition to root
locus for assessing the stability of a linear closed-loop system. It is beyond the scope of this
book to cover all these other techniques. Rather, there are many excellent texts that cover
these subjects in great detail.
Robustness of Control-System Stability
However, another important issue in the stability of a closed-loop system is the robustness of
stability to system parameter changes. Such changes occur in practice because typically the
linear models used to design or to conduct performance analyses of a closed-loop system are
linearized approximations to a nonlinear model for the actual system in the neighborhood of an
operating point. Changes in the operating point normally require changes to the parameters of
the linearized approximation to the actual model. A closed-loop system whose controller was
designed/optimized at one operating point and found to be stable there may not be stable at
other operating points. One important method of assessing the relative stability of a closed-loop
system is based upon an evaluation of the characteristic equation for a steady-state sinusoidal
excitation. For any given set of controller gains, the characteristic equation can be written as
1 þ LðsÞ ¼ 0
(64)
Figure 1.13:
Root-locus plot for example PID control system.
The Systems Approach to Control and Instrumentation
31

where
LðsÞ ¼ HcðsÞ HrðsÞ
(65)
and where L(s) is called the loop gain. For steady-state sinusoidal excitation, the
characteristic equation is given by
1 þ LðjuÞ ¼ 0
(66)
Instability occurs whenever
LðjuÞ ¼ 1
(67)
or
jLðjuÞj ¼ 1
and
: LðjuÞ ¼ 180
That is, both the magnitude and phase conditions must be satisﬁed for closed-loop
instability.
The relative stability of a closed-loop system is found in terms of a pair of frequencies
deﬁned as the gain crossover frequency (uG) and the phase crossover frequency (up)
where
logjLðjuGÞj ¼ 0
(68)
: LðjupÞ ¼ 180
The relative stability of a closed-loop system is expressed by two quantities: 1) gain margin
(GM) and 2) phase margin (PM). The gain margin is deﬁned as
GM ¼ 20 log10
LðjupÞ

(69)
It is the amount of gain (in dB) that must be added to the system at the phase crossover
frequency for the magnitude L(jup) to be unity. The phase margin is deﬁned as
PM ¼ : LðjuGÞ  180
(70)
32
Chapter 1

The gain and phase margin for any closed-loop system conﬁguration can readily be found
from the Bode plot of the loop gain L(ju). We illustrate gain and phase margin using the
example second-order system with PID controller. For this illustration, the gain parameters
are arbitrarily picked to be: Kp ¼ 10, KI ¼ 15, and KD ¼ 0.5. The Bode plot for this example is
given in Figure 1.14.
The gain crossover (i.e., loop gain ¼ 0 dB) in this example is at about 2 rad/s. There is no
phase crossover as the phase never goes more negative than about e110. This system has an
inﬁnite gain margin and a phase margin of about e80. Any system with these GM and PM is
highly stable and will remain stable with respect to relatively large system parameter
variations.
The control electronics used in the example of Figure 1.10 provided what is called
proportional control because the control signal is proportional to the error signal. Other
combinations of control electronics are possible, and it is a challenge to the system designer
to develop imaginative types of control electronics to improve the performance of a given
plant.
Figure 1.14:
Bode plot for example PID control system.
The Systems Approach to Control and Instrumentation
33

Closed-Loop Limit-Cycle Control
Another type of control that is used in automotive applications is limit-cycle control. Limit-
cycle control is a type of feedback control that monitors the system’s output and responds
only when the output goes beyond preset limits. Limit-cycle controllers often are used to
control plants with nonlinear or complicated transfer functions.
Limit-cycle control responds only when the error is outside a pair of limits. An example of
a limit-cycle controller is the temperature-controlled oven depicted in Figure 1.15. The
temperature inside the oven is controlled by the length of time the heating coil is energized.
The temperature of the oven is measured with a temperature probe, and the corresponding
electrical signal is fed back to the command to obtain an error signal. The control electronics
checks the error signal against the temperature control dial to determine if one of the
following two conditions exists:
1.
Oven temperature is below minimum setting of command input.
2.
Oven temperature is above maximum setting of command input.
The control electronics responds to error condition 1 by closing the relay contacts to energize
the heating element. This causes the temperature in the oven to increase until the temperature
TEMPERATURE
SIGNAL
TEMPERATURE
PROBE
ERROR
SIGNAL
CONTROL
LOGIC
+
–
TEMPERATURE
CONTROL
DIAL
ELECTRICAL
HEATING COIL
RELAY
CONTACTS
Electrical
Power
Source
COMMAND
INPUT
Figure 1.15:
Example limit-cycle control system.
34
Chapter 1

rises above a maximum limit, producing error condition 2. In this case, the control electronics
opens the relay contacts and the heat is turned off. The oven gradually cools until condition 1
again occurs and the cycle repeats. The oven temperature varies between the upper and lower
limit, and the variations can be graphed as a function of time, as shown in Figure 1.16.
The amplitude of the temperature variations, called the differential, can be decreased by
reducing the difference between the maximum and minimum temperature limits that are set in
the controller. As the limits get closer together, the temperature cycles more rapidly
(frequency increases) to hold the actual temperature deviations closer to the desired constant
temperature than for larger limits. Thus, the limit-cycle controller controls the system to
maintain an average value close to the command input, yet cycles above and below the
desired value. This type of controller has gained popularity due to its simplicity, low cost, and
ease of application. Fuel control, one of the most important automotive electronic control
systems, is, at least partially, a limit-cycle control system (see Chapter 5).
A limit-cycle control system is not linear and is, consequently, not amenable to analysis by
the linear techniques described above. Rather, the performance of any given limit-cycle
control system is best accomplished via simulation.
Instrumentation
An instrument (or instrumentation system) is a device for measuring some speciﬁc quantity.
Automotive instruments have traditionally been mechanical, pneumatic, hydraulic, electrical,
or combinations of these. However, modern automotive instrumentation is largely electronic.
Upper control limit
Lower control limit
MAX. TEMP.
LIMIT
MIN. TEMP.
LIMIT
AVERAGE
TEMP.
Figure 1.16:
Frequency response for limit-cycle control system.
The Systems Approach to Control and Instrumentation
35

These electronic instruments or instrumentation systems are used to measure a variety of
physical quantities, including
1.
Vehicle speed
2.
Total distance traveled
3.
Engine angular speed (rpm)
4.
Fuel quantity and/or ﬂow rate
5.
Oil pressure
6.
Engine coolant temperature
7.
Alternator charging current
8.
Tire pressure
9.
Estimated range to empty fuel tank
In addition to providing the driver with measurements of important variables, measurements
of variables are sometimes made to assist in the diagnosis of problems with various
subsystems. A typical automotive digital electronic system monitors measurements of certain
variables to assess whether or not they fall within an allowed band. In the event that a variable
is out-of-tolerance, a warning error message is stored in memory. If this out-of-bounds
variable is capable of affecting the normal vehicle operation, a warning message (e.g., “check
engine”) is displayed to the driver. This diagnostic application of instrumentation is discussed
in detail in chapter 10.
For an understanding of measurement instrumentation, it is helpful to review a deﬁnition of
measurement. Automotive instrumentation systems, whether electrical, mechanical, or
a combination of both, measure a physical quantity and provide a numerical value report of
that measurement to the driver (or sometimes to the maintenance technician).
Measurement
A measurement is deﬁned as a numerical comparison of an unknown magnitude of a given
physical quantity to a standard magnitude of the same physical quantity. In this sense, the
result of a measurement is normally a numerical value expressing the indicated value of the
measurement as a multiple of the appropriate standard. However, other display devices are
possible in which simple messages are given. For example, it is common practice not to
provide a display of measured values for engine oil pressure or coolant temperature. Warning
lamps are activated by the electronic instrumentation system whenever oil pressure is too low
or coolant temperature is too high.
Issues
In any measurement made with any instrument, there are several important issues, including
1.
Standards
2.
Precision
36
Chapter 1

3.
Calibration
4.
Accuracy
5.
Errors
6.
Reliability
Each of these issues has an important impact on the performance of the instrumentation.
The standard magnitudes of the physical variables measured by any instrument are
maintained by the National Institute of Standards & Technology in the United States. These
standard magnitudes and the fundamental relationships between physical variables determine
the units for each physical quantity. Contemporary vehicles often use metric standards known
as the MKS system (meter, kilogram, sec) along with some English units (e.g. mph).
The precision of any instrument is related to the number of signiﬁcant ﬁgures that is readable
from the display device. The greater the number of signiﬁcant ﬁgures displayed, the greater
the precision of the instrument.
Calibration is the act of setting the parameters of an instrument such that the indicated value
conforms to the true value of the quantity being measured.
The accuracy of any measurement is the conformity of the indicated value to the true value of
the quantity being measured. Error is deﬁned as the difference between true and indicated
values. Hence, accuracy and error vary inversely. The required accuracy for automotive
electronic systems varies with application, as will be shown in later chapters. In general, those
instruments used solely for driver information (e.g., fuel quantity) might have lower accuracy
requirements than those used for applications such as engine control or diagnosis.
The errors in any measurement are generally classiﬁed as either systematic or random.
Systematic errors result from known variations and imperfections in instrument performance,
for which corrections can be made if desired. There are many sources of systematic error,
including limited dynamic response to rapidly changing variables, temperature variations in
calibration, and loading. Since virtually any component in an instrument is potentially
susceptible to temperature variations, great care must be exercised in instrument design to
minimize temperature variations in calibration. As will be seen later in this book, most
automotive instruments have relatively low precision accuracy requirements, so that
temperature variations in calibration are negligible. Random errors are essentially random
ﬂuctuations in indicated value for the measurement. Most random measurement errors result
from noise from various sources as explained later in this chapter.
Systematic Errors
One example of a systematic error is known as loading errors, which are due to the energy
extracted by an instrument when making a measurement. Whenever the energy extracted
from a system under measurement is not negligible, the extracted energy causes a change in
The Systems Approach to Control and Instrumentation
37

the quantity being measured. Wherever possible, an instrument is designed to minimize such
loading effects. The idea of loading error can be illustrated by the simple example of an
electrical measurement, as illustrated in Figure 1.17. A voltmeter M having resistance Rm
measures the voltage across resistance R. The correct voltage (vc) is given by
vc ¼ V

R
R þ R1

(71)
However, the measured voltage vm is given by
vm ¼ V

Rp
Rp þ R1

(72)
where Rp is the parallel combination of R and Rm:
Rp ¼
RRm
R þ Rm
(73)
Loading is minimized by increasing the meter resistance Rm to the largest possible value. For
conditions where Rm approaches inﬁnite resistance, Rp approaches resistance R and vm
approaches the correct voltage. Loading is similarly minimized in measurement of any
quantity by minimizing extracted energy. Normally, loading is negligible in modern
instrumentation.
Another signiﬁcant systematic error source is the dynamic response of the instrument. Any
instrument has a limited response rate to very rapidly changing input, as illustrated in
Figure 1.18. In this illustration, an input quantity to the instrument changes abruptly at some
time. The instrument begins responding, but cannot instantaneously change and produce the
new value. After a transient period, the indicated value approaches the correct reading
(presuming correct instrument calibration). The dynamic response of an instrument to
R1
vm
R
M
V
+
i
i’
Figure 1.17:
Illustration of loading error-volt meter.
38
Chapter 1

rapidly changing input quantity varies inversely with its bandwidth as explained earlier in
this chapter.
In many automotive instrumentation applications, the bandwidth is purposely reduced to
avoid rapid ﬂuctuations in readings. For example, the type of sensor used for fuel-quantity
measurements actually measures the height of fuel in the tank with a small ﬂoat. As the car
moves, the fuel sloshes in the tank, causing the sensor reading to ﬂuctuate randomly about its
mean value. The signal processing associated with this sensor is actually a low-pass ﬁlter such
as is explained later in this chapter and has an extremely low bandwidth so that only the
average reading of the fuel quantity is displayed, thereby eliminating the undesirable
ﬂuctuations in fuel quantity measurements that would occur if the bandwidth were not
restricted.
The reliability of an instrumentation system refers to its ability to perform its designed
function accurately and continuously whenever required, under unfavorable conditions, and
for a reasonable amount of time. Reliability must be designed into the system by using
adequate design margins and quality components that operate both over the desired
temperature range and under the applicable environmental conditions.
Basic Measurement System
The basic block diagram for an electronic instrumentation system has been given in
Figure 1.1b. That is, each system has three basic components: sensor, signal processing, and
display. Essentially, all electronic measurement systems incorporated in automobiles have
this basic structure regardless of the physical variable being measured, the type of display
being used, or whether the signal processing is digital or analog.
Understanding automotive electronic instrumentation systems is facilitated by consideration
of some fundamental characteristics of the three functional components. Again it should be
Figure 1.18:
Illustration of instrument dynamic response error.
The Systems Approach to Control and Instrumentation
39

noted that automotive electronic systems are essentially digital rather than analog realization.
Modeling and analysis of digital electronic systems are in terms of discrete time. Such
modeling/analysis is discussed in Chapter 2. However, instrument systems often incorporate
analog (continuous time) sensors. Consequently, for the remainder of this chapter, all
variables are expressed in terms of continuous time models.
Sensor
A sensor is a device that converts energy from the form of the measurement variable to an
electrical signal. An ideal analog sensor generates an output voltage that is proportional to the
quantity q being measured:
vs ¼ Ksq
(74)
where Ks is the sensor calibration constant.
By way of illustration, consider a typical automotive sensor e the throttle-position sensor.
The quantity being measured is the angle (q) of the throttle plate relative to closed throttle.
Assuming for the sake of illustration that the throttle angle varies from 0 to qmax and the
voltage varies from 0 to 5 V, the sensor calibration constant Ks is
Ks ¼
5
qmax
Alternatively, a sensor can have a digital output, making it directly compatible with digital
signal processing. For such sensors, the output is an electrical equivalent of a numerical value,
using a binary number system as described earlier in this chapter. Figure 1.19 illustrates the
output for such a sensor. There are N output leads, each of which can have one of two possible
voltages, representing a 0 or 1. In such an arrangement, 2N possible numerical values can be
represented. For automotive applications, N ranges from 8 to 16, corresponding to a range of
256 to 65536 numerical values. Digital instruments belong to the class of discrete time
systems, which are discussed in detail in the next chapter.
Of course, a sensor is susceptible to error just as is any system or system component.
Potential systematic error sources include loading, ﬁnite dynamic response, calibration
shift, and nonlinear behavior. Often it is possible to compensate for these and other types of
errors in the electronic signal-processing unit of the instrument. If a sensor has limited
bandwidth, it will introduce errors when measuring rapidly changing input quantities.
Figure 1.20 illustrates such dynamic errors for an analog sensor measuring an input that
abruptly changes between two values (this type of input is said to have a square wave
waveform). Figure 1.20a depicts a square wave input to the sensor. Figure 1.20b illustrates
the response that the sensor will have if its bandwidth is too small. Note that the output does
40
Chapter 1

not respond to the instantaneous input changes. Rather, its output changes gradually, slowly
approaching the correct value.
An ideal sensor has a linear transfer characteristic (or transfer function), as shown in
Figure 1.21a. However, often the sensor output voltage is a nonlinear function of the quantity
being measured (i.e., vo(q) is nonlinear). Signal processing can be used to linearize the output
signal so that it will appear as if the sensor has a linear transfer characteristic, as shown in the
dashed curve of Figure 1.21b. Sometimes, a nonlinear sensor may provide satisfactory
operation without linearization if it is operated in a particular “nearly” linear region of its
transfer characteristic (Figure 1.21b). Moreover, with digital signal processing, a simple
Figure 1.19:
Analog input, digital output sensor.
(a)
(b)
Figure 1.20:
Instrument square wave dynamic response error.
The Systems Approach to Control and Instrumentation
41

calculation can be used to “correct” any nonlinearities of a given sensor, yielding a correct
value of the variable being measured. This signal processing would perform the nonlinear
correction by suitable calculation on the data from the sensor output. Such type of correction
calculation is best done with digital instruments, which are discussed in the next chapter.
Random Errors
Random sensor errors can occur due to external noise sources (i.e., random ﬂuctuations in the
quantity being measured) or due to internal noise sources. Random errors generated internally
in sensors are caused primarily by internal electrical noise. Internal electrical noise can be
caused by molecular vibrations due to heat (thermal noise) or random electron movement in
semiconductors (shot noise). In certain cases, a sensor may respond to quantities other than
the quantity being measured. For example, the output voltage of a sensor that measures
pressure includes random error in the form of an electrical noise.
Electrical noise is a random process, which can only be meaningfully modeled statistically.
Typically, sensor electrical noise voltage vn is essentially a stationary random process meaning
its statistics are time invariant. For most noise sources encountered in automotive electronic
sensors, the amplitude statistics are given by the Gaussian probability density function
pðvnÞ ¼
1
s
ﬃﬃﬃﬃﬃﬃ
2p
p
e
 1
2
vn
s
2
(75)
where s is the standard deviation of vn.
The spectral statistics are given by the so-called “power spectral density” W(f). The power
spectral density essentially models the distribution of the power per unit bandwidth vs.
Figure 1.21:
Linearization of nonlinear sensor.
42
Chapter 1

frequency f for the noise source. The power spectral density can be determined from a sample
vT(t) of vn(t) where
vTðtÞ ¼ vnðtÞ
0  t  T
¼ 0
elsewhere
(76)
The spectrum of VT(t) is given formally by its Fourier transform VT(ju):
VTðjuÞ ¼
ZN
N
ejutvTðtÞdt
(77)
The power spectral density is given (with sufﬁcient accuracy) by the following:
Wð fÞ ¼ Lim
T/N
 VTðj2pfÞ2
T
!
(78)
where f ¼ u/2p.
Any practical sensor has ﬁnite dynamic response. Depending on the origin of the noise in the
sensor, a potential noise model for such a sensor is shown in Figure 1.22. For this ﬁgure and
model, it is assumed that the noise is associated with the quantity being measured (i.e., so-
called process noise).
In this ﬁgure, Hs(ju) is the steady-state sinusoidal frequency response for the sensor which
expresses its dynamic response to the noise random process. This frequency response can be
found using the linear system modeling given earlier in this chapter. The “white noise source”
is an ideal noise source having a constant power spectral density (Ww):
WwðfÞ ¼ Wo
cf
(79)
The power spectral density of vn (i.e., Wn(f) ) is given by
WnðfÞ ¼ Wo jHsðj 2p fÞj2
(80)
Figure 1.22:
Sensor noise model.
The Systems Approach to Control and Instrumentation
43

In this noise model, the amplitude (Wo) of the basic noise source depends upon the physical
origin of the noise. For example, noise is generated in any resistance R at absolute
temperature To (i.e., thermal noise) that has power spectral density given by
Wo ¼ 4kToR
where k is the Boltzmann constant.
Similar models exist for electronic noise that is generated by a current ﬂowing through
a semiconductor junction.
The “amplitude” of the sensor output noise is best represented by its rms value ~vn which is
given by
~vn ¼
 RN
o
WnðfÞdf
	1
2
¼

W0
RN
o
Hsðj2pfÞ2df
	1
2
(81)
Thus, the noise amplitude of any sensor having a noise model depicted in Figure 1.22 is
proportional to the sensor bandwidth.
On the other hand, noise can be generated at any point in a sensor conﬁguration (including
output resistance). In this case, the sensor output power spectral density may well occupy
a spectral bandwidth that is large compared with the sensor bandwidth or the desired
spectrum of the quantity being measured. In this case, the noise amplitude may be reduced by
signal processing. Such signal processing takes the form of a ﬁlter. As will be shown in the
next section of this chapter, a ﬁlter can be designed that leaves the signal component of sensor
output essentially unchanged yet reduces the rms noise voltage. Such ﬁltering improves the
signal-to-noise ratio, which is always desirable in any measurement.
To be useful for measurement purposes, an electronic instrumentation system must somehow
make the results of measurement available to the user. This is done through the display, which
yields numerical values to the user. As in other aspects of electronic systems, the display can
be analog or digital. Both types of displays are described in detail in Chapter 9. As stated
earlier, in automotive applications, a “display” is often just a warning (e.g., lamp) to the driver
of an out-of-tolerance value for a given variable or parameter.
Automotive display devices, typically analog or digital meters, provide a visual indication
of the measurements made by the sensors. Actuators convert electrical inputs to an action
such as a mechanical movement. Displays, like sensors, are energy-conversion devices.
They have bandwidth, dynamic range, and calibration characteristics, and, therefore, have
the same types of errors as do sensors. As with sensors, many of the shortcomings of
display devices can be reduced or eliminated through the imaginative use of signal
processing.
44
Chapter 1

Signal Processing
Signal processing, as deﬁned earlier, is any operation that is performed on signals traveling
between the sensor and the display. Signal processing converts the sensor signal to an
electrical signal that is suitable to drive the display. In addition, it can increase the accuracy,
reliability, or readability of the measurement. Signal processing can make a nonlinear
sensor appear linear, or it can smooth a sensor’s frequency response. Signal processing can
be used to perform unit conversions such as converting from miles per hour to kilometers
per hour. It can perform display formatting (such as scaling and shifting a temperature
sensor’s output so that it can be displayed on the engine temperature gauge either in
centigrade or in Fahrenheit), or process signals in a way that reduces the effects of random
system errors.
Signal processing can be accomplished with either a digital or an analog subsystem. The trend
in automotive electronic systems toward fully digital instrumentation means that the majority
of automotive electronic signal processing is accomplished with a digital computer.
Filtering
One of the most important signal-processing operations in instrumentation is ﬁltering. As
explained above, ﬁltering can improve the signal/noise, which enhances measurement
accuracy. In the next section, we discuss ﬁlter types and design methods applicable in
instrumentation.
In linear continuous time instruments, electronic signal processing of the electrical output of
a sensor can perform many types of operations including 1) arithmetic, 2) integration, and 3)
differentiation and ﬁltering. Although rarely used in modern automotive electronic systems,
a continuous time model can be used during the design process to determine the optimum
signal-processing operation. Then the continuous time operation is converted to a discrete
time model for implementation in a digital system as explained in the next chapter.
In order to understand this process, it is, perhaps, helpful to consider the design process for
a continuous time ﬁlter (e.g., one that is developed for working with an analog sensor). This
designprocesscan beillustratedwiththe designofan analog ﬁlter. Filters aregenerallyclassiﬁed
in terms of their so-called “passbands and stopbands.” A passband is a range of frequencies over
whichtheﬁlterhasrelativelylowattenuation(e.g.,0 dB)characteristicsandastopbandisarange
of frequencies over which the attenuation is relatively large (e.g., many 10s of dB).
The ﬁlter itself is characterized by its complex frequency transfer function (H(s)) or its
steady-state sinusoidal frequency response (H(ju)). For example, a low-pass ﬁlter has
a passband from 0 through some cutoff frequency (up) at which point
HðjupÞ
2¼ 1
2jHðj0j2
(82)
The Systems Approach to Control and Instrumentation
45

It has a stopband with relatively high attenuation for u > us where us is the lower edge of the
stopband and us > up. A high-pass ﬁlter is similar to the low-pass ﬁlter with the two bands
interchanged. A bandpass ﬁlter has a passband between a pair of corner frequencies (up1 up2)
and a pair of stopbands deﬁned:
A bandstop ﬁlter has a single stopband between frequencies u1 and u2 and two passbands
outside this range:
Any practical, physically realizable ﬁlter has a region of transition between any passband and
an adjacent stopband, the slope of which, with respect to frequency, is determined by the
order of the ﬁlter transfer function.
Filter-Design Techniques
Filter design begins with a low-pass prototype function normalized frequency (U ¼ u/uc)
where uc is the passband corner frequency. The other three ﬁlter types are derived by a linear
transformation involving complex frequency s as explained below.
Filters are designed as well as classiﬁed by the function F(U) from which they are derived.
For example, the so-called Butterworth ﬁlter is derived from the function
FðUÞ ¼
1
1 þ U2n
(83)
where n is the order of the ﬁlter. Butterworth ﬁlters are characterized by maximally ﬂat
passbands. This function is taken to be the squared magnitude of the sinusoidal frequency
response of the desired ﬁlter:
FðUÞ ¼ jHðj UÞj2
(84)
¼ HðSÞHðSÞ
S¼j u
uc
(85)
Passband
up1  u  up2
Stopbands
u < us1 and u > us2
Passbands
u < up1 u > up2
Stopband
us2 < u < us2
46
Chapter 1

where S is a normalized complex frequency. To ﬁnd the transfer function (H(s)), the
substitution U2 / S2 is made and the resulting function factored to ﬁnd the roots of the
numerator and denominator. For the example Butterworth ﬁlter, these roots lie along the
unit circle in the normalized complex S-plane. These roots are equally spaced and except
for odd n where a single root exists at S ¼ 1, they occur in complex conjugate pairs.
The roots of the denominator (i.e., poles at S ¼ Pm) in the left half S-plane are
determined and the transfer function is given by
HðSÞ ¼
1
Q
n
m¼1
ðS  PmÞ
(86)
For example, the third-order (i.e., n ¼ 3) Butterworth low-pass ﬁlter prototype is
HðSÞ ¼
1
ðS þ 1ÞðS2 þ S þ 1Þ
(87)
The transfer function is then un-normalized by replacing S with s/uc.
The magnitude and phase of a third-order Butterworth ﬁlter are given in Figure 1.23 plot
for H(s).
Figure 1.23:
Magnitude and phase frequency response of third-order Butterworth ﬁlter.
The Systems Approach to Control and Instrumentation
47

Note that 20 log jH(j1)j2 which is equivalent to:
HðjUÞ

U¼1¼ 1ﬃﬃﬃ
2
p
The normalized frequency U ¼ 1 is the corner frequency of this ﬁlter in normalized
frequency. The steepness of the drop from passband to stopband increases with increasing
ﬁlter order n. The slope in the transition from the passband is e20 n dB/decade.
The other major ﬁlter types are based upon polynomials in normalized frequency. The two
commonest of these are Chebyshev or Cauer. The Chebyshev ﬁlter prototypes are derived
from the following polynomials:
FðU2Þ ¼ ˛2C2
nðUÞ
(88)
where
CnðUÞ ¼ cosðn cos1ðUÞÞ
ju  1j
¼ coshðn cosh1ðUÞÞ
ju > 1j
and ˛ is a parameter determined by the passband “ripple.” Cauer ﬁlter prototypes are derived
from Jacobi elliptic function of U and are beyond the scope of the present text. However, any
standard ﬁlter-design reference will supply design parameter tables. Also, ﬁlter design is
readily accomplished using MATLAB or other design software.
The design of a high-pass ﬁlter normalized prototype by replacing S with 1/S. Similar linear
transformations of S are available for bandpass or bandstop ﬁlters, but the transformation is
dependent upon the relative values for u1 and u2. Fortunately, modern software such as
MATLAB has the capability of calculating the transfer functions of any of the ﬁlters
discussed.
It is clear from the above discussion of ﬁlter-design techniques that, in principle, it is possible
to design a ﬁlter for measurement of a given quantity that optimizes the signal/noise. Such an
optimum design is based on a priori information about the spectrum of the measured
quantity. It is normally not possible (nor is it necessary) to know the exact spectrum of this
quantity. However, it is often possible to be able to determine upper and lower bounds of this
“signal spectrum.” The signal-processing ﬁlter passband can be selected to enclose these
spectral band limits. Noise suppression occurs in the associated stopbands for the optimal
ﬁlter.
In automotive electronic instrumentation, the sensor often measures a mechanical variable.
The dynamic model for the associated mechanical system is often known with great accuracy,
48
Chapter 1

thereby allowing the “signal” spectral bounds to be closely estimated. In such cases, the
signal-processing ﬁlter optimization can readily proceed.
This chapter has reviewed some basic principles of continuous time system theory that are
applicable through the remainder of the book. Speciﬁc applications of this theory are found in
nearly all automotive electronic systems. However, as explained earlier, modern automotive
electronics are digital and are modeled and analyzed using discrete time methods. The next
chapter reviews basic principles of such discrete time system modeling/analysis/design.
The Systems Approach to Control and Instrumentation
49

This page intentionally left blank

CHAPTER 2
Discrete Time Systems Theory
Chapter Outline
Digital Subsystem
55
Sinusoidal Frequency Response
56
Discrete Time Control System
63
Closed Loop Control
68
Example Discrete Time Control System
72
Summary
77
As explainedin the previous chapter, automotive electronic control and instrumentation systems
(as well as virtually all other electrical systems) are implemented with digital electronics as at
least some component or subsystem. Digital controllers and/or signal processing subsystems
incorporate one or more microprocessors or microcontrollers, each having a stored program to
run the system. Such systems are fundamentally discrete time systems.
However, automotive electronic systems also incorporate analog orcontinuous time components
(e.g., sensors and actuators). In order for the digital subsystem to perform its intended operation
it has for its input/output variables, numerical values of the continuous input/output at discrete
times (tk where k ¼ 1,2.). The time between successive input/output values must be sufﬁcient
for the digital system to perform all operations on the input to generate an output.
Although it is not necessary, most discrete time systems use periodic times to represent
input/output; that is, the kth discrete time is given by
tk ¼ kTs
k ¼ 1; 2; 3.
where Ts is the sample period. The conﬁguration for a discrete time system with an embedded
digital system and an analog destination component is depicted in Figure 2.1
In this ﬁgure, the source has a continuous time electrical signal v(t) that could, for example,
be a sensor output. The interface electronics-labeled A/D converter (which is modeled later in
this chapter) generates a sequence of numerical values called samples at each discrete time or
“sample period” tk:
vk ¼ vðtkÞ
Understanding Automotive Electronics. http://dx.doi.org/10.1016/B978-0-08-097097-4.00002-3
Copyright  2012 Elsevier Inc. All rights reserved.
51

These samples must be in a format that can be input to the digital system. The input to the
digital system at tk is denoted xk, which is a digital (N bit) numerical value equal to vk; that is,
the sampled variable vk becomes a binary number xk. The digital system generates an output
yn associated with input sample xn (as well as previous samples depending on the operations
performed). Although the destination component might be a display device that can display
the desired output numerical value, it may also be an actuator requiring a continuous time
electrical signal y(t). We assume here that the destination component (e.g., a display or
actuator) requires a continuous time electrical input. This continuous time electrical signal is
generated from the output yn via an output interface D/A converter. A system that is partly
continuous time along with one or more sampling operations is called a sampled data system
or a discrete time system.
It is important when explaining such systems for either design or performance analysis to
develop appropriate models for mixed continuous and discrete time systems. For the purpose
of developing such models, it is helpful to discuss initially only linear, time-invariant systems.
In later chapters, which are concerned with speciﬁc automotive systems, we will deal with
nonlinearities as required to explain the particular system.
As shown in the previous chapter, a linear time-invariant continuous time system is
characterized by an nth order differential equation with constant coefﬁcients. The linear
time-invariant discrete time system is characterized by a model in the format of difference
equations. One commonly used model for calculating the output yn of a discrete time system
is in the form of a recursive model:
yn ¼
X
K
k¼0
akxnk 
X
L
‘¼1
b‘yn‘
(1)
The dynamic response of such a system is determined by the coefﬁcients ak and b‘.
Recall that a continuous time system is usefully characterized by its transfer system (H(s))
which is obtained from the Laplace transforms of its input and output. A similar procedure is
very useful for conducting performance analysis or design of a discrete time digital system.
Figure 2.1:
Discrete time system conﬁguration.
52
Chapter 2

For a discrete time system the transform of a sequence xn that is analogous to the Laplace
transform for a continuous time system is the z-transform X(z) deﬁned by
XðzÞ ¼ Z ðxnÞ
(2)
XðzÞ ¼
X
N
n¼N
xnzn
We illustrate with an example in which xn is deﬁned as
xn ¼ cn
n  0
¼ 0
n  0
(3)
The z-transform is given by
XðzÞ ¼ P
N
n¼0
cnzn
¼ P
N
n¼0
ðcz1Þn
(4)
Where z ¼ complex variable analogous to s for the Laplace transform. This latter sum is
a geometric series that converges if jcz1j  1 or jzj  jcj to the closed form result
XðzÞ ¼
1
1  cz1
jzj  jcj
(5)
There are several important elementary properties of the z-transform that are important in the
analysis of discrete time, digital systems that are summarized without proof below:
1.
Linearity:
Z ½axn þ byn ¼ aXðzÞ þ bYðzÞ
(6)
2.
Time shift
Z ½xnþk ¼ zkXðzÞ
(7)
3.
Convolution: let
Wn ¼
X
N
k¼N
xk ynk ¼
X
N
n¼N
xnk yk
(8)
then W(z) ¼ X(z) Y(z)
Discrete Time Systems Theory
53

As in the case of a continuous time system for which the inverse Laplace transform can be
found, there is an inverse z-transform denoted Z 1[X(z)] which is given by the following
contour integral in the complex z-plane:
xn ¼ 1
2pj
I
C
XðzÞzn dz
z
(9)
where the contour C is chosen in a region of the complex z-plane for which the series
converges.
It is assumed that Y(z) is the z-transform of a sequence yn that is bounded as n / N. In this
case (which is the case of practical signiﬁcance in any automotive electronic system), the unit
circle in the complex z-plane (i.e., jzj ¼ 1) forms the boundary of the region of convergence of
Y(z). All poles of Y(z) lie inside the unit circle and Y(z) is analytic for jzj > 1. The inverse
z-transform of Y(z) is a single-sided sequence {yn} where
yn ¼ 0
n < 0
In this case (of practical interest), the contour C is the unit circle (i.e., C / jzj ¼ 1).
In practice, the inverse z-transform of a function of z (e.g., Y(z)) is normally computed from
a partial fraction expansion of Y(z) about its poles zk:
YðzÞ ¼ P
n
j¼1
aj
z  zj
¼ P
n
j¼1
aj z1
1  zj z1
(10)
Each of these terms can be rewritten in the form of a Taylor series for each pole provided
jzj > jzjj:
aj z1
1  zj z1 ¼ aj
X
N
m¼0
zjmzðmþ1Þ
j ¼ 1; 2/n
(11)
Replacing the summation index m with k  1 and beginning the series sum with k ¼ 1 yields
an expression for each partial fraction of the same form as Y(z). Combining terms of like
power yields the following expression for Y(z):
YðzÞ ¼
X
N
k¼1
" X
n
j¼1
ðajz k1
j
Þ
#
zk
(12)
54
Chapter 2

Comparing like powers of z, the inverse z-transform of Y(z) is the sequence {yk} where
yk ¼
X
n
j¼1
ajzjk1
(13)
Digital Subsystem
Before proceeding with the discussion of complete sampled data systems, it is, perhaps,
worthwhile to discuss certain basic characteristics of the digital subsystem shown in
Figure 2.1. Once again, assuming linear time invariance for this component, it has already
been explained that its model is generally of the recursive form
yn ¼
X
K
k¼0
akxnk 
X
L
k¼1
bkynk
(14)
Such a subsystem is typically called a digital ﬁlter, regardless of its speciﬁc function in the
larger system. We proceed with the approach to the design/analysis of the digital ﬁlter by ﬁrst
determining its digital transfer function. This can be computed directly from the z-transform
of the above model:
YðzÞ ¼ Z ðynÞ ¼
X
N
n¼N
ynzn
(15)
¼
X
N
n¼N
" X
K
k¼0
akxnk 
X
L
k¼1
bkynk
#
zn
(16)
Using the shift property it can be shown that
YðzÞ ¼
" X
K
k¼0
akzk
#
XðzÞ 
" X
L
k¼1
bkzk
#
YðzÞ
(17)
which can be rewritten in the form
YðzÞ ¼ HðzÞXðzÞ
(18)
The function H(z) is the digital transfer function of the digital ﬁlter and is given by
HðzÞ ¼ YðzÞ
XðzÞ
(19)
¼
P
K
k¼0
akzk
1 þ P
L
k¼1
bkzk
(20)
Discrete Time Systems Theory
55

The design procedures presented later in this chapter permit the calculation of the digital
transfer function to be computed. From this transfer function, the ﬁlter coefﬁcients can be
obtained from the corresponding power of z1.
As in the case of a continuous time ﬁlter, the response to a unit impulse for the ﬁlter is the
digital ﬁlter impulse response. For such an input, its z-transform X(z) ¼ 1 and the output
Y(z) ¼ H(z). The inverse z-transform of H(z) is the sequence {hn}, where components are
given by
hn ¼ 1
2pj
I
C
HðzÞzndz
z
(21)
where the contour C is the unit circle jzj ¼ 1. Any physically realizable ﬁlter requires no
future inputs (i.e., any input prior to xn) to generate yn and the ﬁlter is said to be causal; that is
to say, hn ¼ 0 for n  0. For a ﬁlter having the property
Lim hn
n/N ¼ 0;
the ﬁlter is assured to be stable.
A ﬁlter that has all bk ¼ 0 is called nonrecursive since it uses no previously calculated outputs
to yield the most recent output yn. Such a ﬁlter is also said to have a ﬁnite impulse response
(FIR) since
hn ¼ an
0  n  K
¼ 0
elsewhere
A recursive ﬁlter has at least one nonzero bk coefﬁcient. Such a ﬁlter has an inﬁnite impulse
response (IIR).
Sinusoidal Frequency Response
One of the most important inputs for assessing system performance is the sinusoid. For an
understanding of the sinusoidal frequency response of a digital ﬁlter, it is necessary to have
the z-transform of a sampled sinusoidal signal having frequency u sampled at period T. The
input sequence xn is given by
xn ¼ sinðUnÞ
t  0
¼ 0
t < 0
where U ¼ uT. The sinusoid can be rewritten as
sinðUnÞ ¼ ½e jUn  ejUn=2j
56
Chapter 2

for which the z-transform is given by
XðzÞ ¼ 1
2j
" X
N
n¼0
ðAe jU z1Þn 
X
N
n¼0
ðAejU z1Þn
#
(22)
Provided jzj  A, both series converge yielding the following expression for X(z):
XðzÞ ¼ A
2j

1
ð1  AejU z1Þ 
1
ð1  AejU z1Þ

¼
AsinðUÞz1
ð1  Ae jU z1Þð1  AejU z1Þ
(23)
The ﬁlter output Y(z) is given by
YðzÞ ¼ HðzÞ XðzÞ
¼
AsinðUÞz1HðzÞ
ð1  Ae jU z1Þð1  AejU z1Þ
(24)
where H(z) ¼ transfer function for the digital ﬁlter. By partial fraction expansion, the ﬁlter
output is given by
YðzÞ ¼
AHðe jUÞ
2jð1  e jU z1Þ 
AHðejUÞ
2jð1  ejU z1Þ þ
X
K
k¼1
akz1
ð1  bk z1Þ
(25)
where the latter sum terms (involving poles bk) are due to poles of H(z). The steady-state
sinusoidal frequency response corresponds to the limiting value of Y(z) for n / N. The
operation performed by this digital ﬁlter is determined by the ﬁlter coefﬁcients ak and bk.
Powerful methods have been developed permitting a designer to determine these ﬁlter
coefﬁcients such that the ﬁlter performs the operation required of it to meet the objectives of
the sampled data systems. Many examples are presented in later chapters dealing with
speciﬁc automotive subsystems. The designer chooses ﬁlter coefﬁcients to obtain the
required system performance. The terms, due to the poles of H(z), all asymptotically
approach zero for n / N. The remaining ﬁrst two terms in the above expression represent
the digital ﬁlter steady-state sinusoidal frequency response Yss(z), which can be written in
the form
YssðzÞ ¼ A
z1sinðUÞ½Hðe jUÞ þ HðejUÞ  j½1  z1cosðUÞ½Hðe jUÞ  HðejUÞ
2½1  2cosðUÞz1 þ z2

(26)
Discrete Time Systems Theory
57

The inverse z-transform of Yss(z) can be shown to be
yn ¼ A
½Hðe jUÞ þ HðejUÞ
2
sinðnUÞ þ ½Hðe jUÞ  HðejUÞ
2j
cosðnUÞ

¼ A
Hðe jUÞ
sin½nU þ fð jUÞ
(27)
where f ¼ :Hðe jUÞ
The steady-state sinusoidal frequency response of a digital ﬁlter having a transfer function
H(z) is a sinusoid of the same frequency scaled in amplitude by Hðe jUÞ and having a phase
f( jU) given by :Hðe jUÞ. Thus, the behavior of H(z) on the unit circle z ¼ e jU gives the
frequency response characteristics for p  U  p, where U is digital frequency.
We consider now digital ﬁltering of analog signals for any system employing analog,
continuous time components along with the digital ﬁlter (e.g., sensor and actuator or display).
The conﬁguration for this process is shown in Figure 2.2, which depicts a subset of the
components of Figure 2.1 focusing here on the components associated with digital ﬁltering of
an analog input x(t) to yield an analog output.
The ﬁrst component is called an analog-to-digital converter (A/D). The A/D converter samples
the input periodically (with period T), and prepares the sampled signal xk in a form that can be
input to the computer; that is, the A/D quantizes the sample xk and codes it in a binary or
similar computer usable form. The computer, under program control, calculates the numerical
value of the ﬁlter output yk. The ﬁnal component called a digital-to-analog (A/D) converter
receives the output from the digital ﬁlter computer and reconstructs a continuous time signal
y(t) such that samples of y(t) at tk are as close as possible, within the capabilities of the
computer and the A/D converter, to being samples of y(t):
ykyyðtkÞ
The limitations placed on these approximations are discussed later in this book.
It is worthwhile here to present some important aspects of the sampled analog signal. It is
clear that there is a loss of information during the sampling process since the sampled signal
only represents the analog signal at discrete times tk. This loss of information is mitigated
somewhat by the conceptual installation of a reconstruction device, which most commonly is
a zero-order hold (explained in detail later in this chapter). This device essentially clamps the
Figure 2.2:
Digital ﬁltering of analog signal.
58
Chapter 2

Figure 2.3:
Ideal sampler conﬁguration.
output signal to the value of the latest sample. Although the actual sampled data system
incorporates an A/D converter, for analysis purposes it is convenient to represent this system
as depicted in Figure 2.3
The output of the sample and hold can be represented by the following model:
xðtÞ ¼ xð0Þ½uðtÞ  uðt  TÞ þ xðTÞ½uðt  TÞ  uðt  2TÞ
þxð2TÞ½uðt  2TÞ  uðt  3TÞ/
(28)
where u(t) is a unit step. Taking the Laplace transform of xðtÞ yields XðsÞ, which can be shown
to be
XðsÞ ¼ ð1  eTsÞ
s
" X
N
n¼0
xðntÞenTs
#
¼ ð1  eTsÞ
s
XðsÞ
(29)
The ﬁrst factor is effectively the transfer function of the zero-order hold and the second X*(s),
which is called the starred transform, is deﬁned as
XðsÞ ¼
X
N
n¼0
xðntÞenTs
(30)
The starred transform of any variable is the z-transform with z replaced by esT as expressed
below:
XðsÞ ¼ XðzÞ

z¼esT
It should be emphasized at this point that X*(s) is a ﬁctitious signal introduced solely for
analysis purposes. The fundamental problem in modeling sampled data systems using starred
transforms is that the ideal sampler does not have a transfer function relating its input to its
output. The inverse Laplace transform of X*(s) is denoted x*(t) and is given by
xðtÞ ¼ xð0Þdt þ xðTÞdðt  TÞ þ /xðntÞdðt  nTÞ/
(31)
where d(t) is the ideal impulse function. This expression for x*(t) is equivalent to the output of
an ideal sampler as depicted in Figure 2.3.
Discrete Time Systems Theory
59

The starred transform can also be rewritten in the form (see Reference 2.1)
XðsÞ ¼ 1
T

XðsÞ þ Xðs þ jusÞ þ /Xðs þ jnusÞ/
þ Xðs  jusÞ þ Xðs  2jusÞ þ /Xðs  jnusÞ þ / þ xð0Þ
2

(32)
where us ¼ 2p
.
T. This result indicates that the Laplace transform is periodic in sample
radian frequency.
For s ¼ ju the starred transform X*(ju) is the spectrum of the ideal sampled signal. This
spectrum is a periodic repetition of the spectrum of the input signal. In theory, the original
signal could be reconstructed with an ideal low-pass ﬁlter having frequency response H(ju)
given by
HðjuÞ ¼ 1
us
2 < u < us
2
0 ¼ 1
elsewhere
provided the input spectrum is conﬁned to the ideal ﬁlter pass band. Any signal exceeding this
band cannot be even theoretically reconstructed without errors due to the overlap of adjacent
repetitions of the original signal spectrum. This input spectrum restriction is known as the
sampling theorem and errors that occur when the limit is violated are known as aliasing
errors. The sampling theorem requires that the sampling frequency (Fs ¼ 1/T) be at least twice
the highest frequency component in the signal being sampled to avoid aliasing errors.
We consider ﬁrst the design of a digital ﬁlter to achieve the desired operation based upon
a continuous time (analog) prototype. In this case, the desired continuous time linear transfer
function H(s) is known. Conversion to the corresponding digital ﬁlter transfer function H(z)
yields the ﬁlter coefﬁcients ak and bk necessary to perform the ﬁltering numerically. There are
numerous techniques for converting from H(s) to H(z) that yield very close approximations to
the desired H(s). Fortunately, there is software available to accomplish this task. For example,
MATLAB has a range of functions that give the ﬁlter coefﬁcients directly from parameters
entered (e.g., sampling frequency, ﬁlter type, and pass- and stop-band edge frequencies). The
MATLAB function BUTTER creates an output of ak and bk for the digital transfer function H(z)
of the form given in Eqn (20) based on an Butterworth analog prototype. It requires inputs
n ¼ ﬁlter order and cutoff frequency un where 0  un  1 and where un ¼ 1 corresponds to Fs
2 .
The digital corner frequency is related to the analog corner frequency uc by the following
relationship:
Uc ¼ ucT
(33)
60
Chapter 2

The sampling frequency must be selected such that the highest input frequency umax
satisﬁes
umax  p
T
(34)
to avoid aliasing errors as described above. There are numerous design procedures for ﬁnding
the transfer function for a digital ﬁlter from a continuous time equivalent analog ﬁlter. In any
such procedure the sampling frequency Fs ¼ 1
.
T choice is inﬂuenced by the spectrum of the
input analog signal X(u). To avoid aliasing errors, the digital frequency for any analog
frequency must fall within the band p  U  p. One such procedure utilizes a linear one-
to-one mapping of normalized analog frequency band 0  u  N into the digital frequency
band 0  U  p. This transformation is given by
utan
Uc
2

¼ tan
U
2

(35)
where the digital corner frequency is given by
Uc ¼ 2pfc
Fs
(36)
and where fc is the actual desired corner frequency (in Hz) and Fs is the sampling frequency.
The normalized analog corner frequency is u ¼ 1. Note that aliasing errors are avoided since
all analog frequencies map to the required digital frequency board.
The transformation from analog to digital transfer functions is found by replacing s ¼ ju and
z ¼ e jU in the linear mapping transformation, which yields
s ¼ j cot
Uc
2
 sin
U
2

cos
U
2
 
e j U¼z
(37)
¼ cot
	uc
2

"
eju=2  eju=2
eju=2 þ eju=2
#

e j U¼z
(38)
¼ c
z  1
z þ 1

(39)
where
c ¼ cot
Uc
2

:
Discrete Time Systems Theory
61

The digital transfer function H(z) is given in terms of analog transfer function which is
denoted Ha(s):
HðzÞ ¼ HaðsÞ

s¼ cðz  1Þ
z þ 1
HðzÞ ¼ Ha
cðz  1Þ
z þ 1

(40)
As an example of this linear transformation method for ﬁnding H(z), we consider a third-order
Butterworth normalized frequency prototype. This prototype Butterworth ﬁlter has analog
transfer function given by (see Chapter 1)
HaðsÞ ¼
1
ðs þ 1Þðs2 þ s þ 1Þ
(41)
It can be shown that the digital transfer function H(z) is given by
HðzÞ ¼
ðz þ 1Þ3
K1ðz þ z1Þðz2 þ a z þ bÞ
(42)
where
K1 ¼ ðc þ 1Þðc2 þ c þ 1Þ
(43)
z1 ¼ ð1  cÞ
1 þ c
(44)
a ¼
2ð1  c2Þ
ðc2 þ c þ 1Þ
(45)
b ¼ ðc2  c þ 1Þ
c2 þ c þ 1
(46)
The coefﬁcients of the recursive algorithm for this digital ﬁlter are found by rewriting the
expression for H(z) as a ratio of polynomials in powers of z1 as given below:
HðzÞ ¼
1 þ 3z1 þ 3z2 þ z3
K1½1 þ ðz1 þ aÞz1 þ ðaz1 þ bÞz2 þ z1bz3
(47)
62
Chapter 2

The recursive ﬁlter equation for this example is found by selecting the coefﬁcients (ak and bk)
using the previously given digital transfer function model
HðzÞ ¼
P
K
k¼0
akzk
1 þ P
L
k¼1
bkzk
(48)
where, for this example, K ¼ L ¼ 3. Thus, we can write
ynk ¼ fxn þ 3xn1 þ 3xn2 þ xn3  ½ðz1 þ aÞyn1 þ ðaz1 þ bÞyn2 þ z1byn3g=K1 (49)
As an example of this type of digital ﬁlter design, we present a digital version of the third-
order Butterworth ﬁlter presented in Chapter 1. In this example, let the sample frequency be
Fs ¼ 10 kHz and the corner frequency fc ¼ 2 kHz. The digital corner frequency u is given by
Uc ¼ 2pfc
Fs
¼ 1:2566
(50)
The parameters of H(z) are given by
c ¼ cot
Uc
2

¼ 1:3764
K1 ¼ ðc þ 1Þðc2 þ c þ 1Þ ¼ 10:149
z1 ¼ ð1  cÞ=ðc2 þ c þ 1Þ ¼ 0:1584
a ¼ 2ð1  c2Þ=ðc2 þ c þ 1Þ ¼ 0:4189
b ¼ ðc2  c þ 1Þ=ðc2 þ c þ 1Þ ¼ 0:3554
(51)
The digital sinusoidal frequency response (H (e jU) ) for this example is given in Figure 2.4.
The magnitude squared of the response at the digital corner frequency is
Hðe j UcÞ
2¼ 1
2
(52)
which corresponds to the response of the analog ﬁlter presented in Figure 1.21 for the
normalized corner frequency of 1.
Discrete Time Control System
The previous section of this chapter, which involves digital ﬁltering of analog signals (in
which the output signal is sent to a display device), would be applied in the design of an
Discrete Time Systems Theory
63

instrumental system. For control applications, the digital “ﬁlter” output would be sent to an
actuator that is associated with the plant being controlled. For design/analysis procedures, the
plant model should include the actuator dynamic model.
Normally the actuator is an analog device requiring a continuous time electrical input signal.
In this case, the output of the digital controller (ﬁlter) must be converted to analog form via
the D/A converter. For analytical purposes, this digital/analog conversion is taken to be
a zero-order hold (ZOH).
The operation of and model for the input sample and A/D process have already been explained.
The D/A process at the output of the discrete time digital control system using a ZOH is best
described from its idealized model. Variations from the ideal to the practical system can be
minimized by design. A circuit conﬁguration for the ZOH is given in Chapter 3. The ZOH is
actuallyananalogcircuitthatreceivesinputpulsesofamplitudeun.These pulsescanbemodeled
as ideal impulses and, in practice, are created by a D/A converter from the output sequences {un}
of the digital controller. These pulses are generated at times tn ¼ nTwhere T is the period of the
input sampler. Apart from a small time delay during which the digital ﬁlter performs its
operation, these output pulses are synchronous with the input samples to the A/D converter.
A simple approximate model for the ZOH output uðtÞ is given by
uðtÞ ¼ un
tn  t < tn þ T
(53)
Figure 2.4:
Digital sinusoidal frequency response of third-order Butterworth ﬁlter.
64
Chapter 2

that is, an ideal ZOH receives pulses at times tn and holds the output at the value un for one
sample period. Figure 2.5 illustrates this process in which the bar over the variable signiﬁes an
analog signal. In actual practice, the voltage pulses un are of ﬁnite duration and of an
amplitude given by un ¼ un where un is the numerical value of the digital system output.
The ZOH output yields a piecewise continuous function uðtÞ of the corresponding continuous
control signal u(t) that would be generated by the analog (continuous time) prototype system
from which the discrete time system was developed. The closeness of the approximation
ðuðtÞyuðtÞÞ is inﬂuenced by the sample period relative to the system dynamics as well as the
precision of computation of the digital discrete time system (e.g., number of bits in the digital
data) as explained in Chapter 4.
In a control system application, the ZOH output drives the plant actuator, which, in turn,
drives the plant dynamics. The conﬁguration for an open-loop system utilizing a digital
controller is depicted in Figure 2.6
(a)
(b)
Figure 2.5:
Illustration of sample and hold signals.
(a)
(b)
Figure 2.6:
Open-loop discrete time control system.
Discrete Time Systems Theory
65

The model for the digital controller is
uðzÞ ¼ HcðzÞXðzÞ
(54)
In terms of the starred transfer function this model, with the substitution z ¼ est, can bewritten as
uðsÞ ¼ HðsÞXðsÞ
(55)
The A/D and D/A converters, controller and plant can be combined to yield the output Y(s)
YðsÞ ¼ HpðsÞuðsÞ
(56)
¼ HpðsÞ
1  esT
s

uðsÞ
(57)
The z-transform of the output Y(z) is given by
YðzÞ ¼ Z
ð1  esTÞ
s
HpðsÞ

uðzÞ
(58)
¼ Z
ð1  esTÞ
s
HpðsÞ

HcðzÞXðzÞ
(59)
¼ ð1  z1ÞZ
ðHpðsÞÞ
s

HcðzÞXðzÞ
(60)
Eqn (60) is obtained from Eqn (59) from the time shift property of the z-transform. The
z-transform for the combination zero-order hold and plant is known as the pulse transfer
function and is normally found from tables. A sample of z-transform tables is given at the end
of this chapter. The time domain system output at times tk is found by computing the inverse
z-transform of Y(z):
yðkTÞ ¼ Z 1½YðzÞ
(61)
As an example of the analysis of an open-loop system having a digital controller we consider
a simple 1st-order plant having an analog transfer function given by
HpðsÞ ¼
1
s þ 1
We further assume a simple PD controller having the following difference equation:
uðktÞ ¼ KpðkTÞ þ KD
xðkTÞ  x½ðk  1ÞT
T

(62)
66
Chapter 2

For the purposes of illustrating this procedure, we make the numerical simpliﬁcation Kp ¼ 1
and (KD/T) ¼ 1 yielding the following control algorithm:
uðkTÞ ¼ 2xðkTÞ  x½ðk  1ÞT
(63)
The controller digital transfer function HcðzÞ can be found by taking the z-transform of the
time domain model
HcðzÞ ¼ 2  z1
¼ 2z  1
z
(64)
The z-transform of the combined zero-order hold/plant is given by
Z
1  eTs
sðs þ 1Þ

¼ 1  eT
z  eT
(65)
as found from the transform tables (Table 2.1) given later in this chapter.
The dynamic response for this example system is characterized by its response to a unit step
xðtÞ ¼ 1
t  0
¼ 0
t < 0
The z-transform for this input x(z) is given by
XðzÞ ¼
z
z  1
(66)
The controller output u(z) is given by
uðzÞ ¼
2z  1
z

z
z  1

¼ 2z  1
z  1
(67)
The output of this example Y(z) is given by
YðzÞ ¼
2z  1
z
 1  eT
z  eT

z
z  1
¼ ð2z  1Þð1  eTÞ
ðz  eTÞðz  1Þ
(68)
Discrete Time Systems Theory
67

It can be shown that the time domain system output (which is z1½YðZ Þ) is given by
yk ¼ ½1 þ ð1  2eTÞeðk1ÞTuðk  1Þ
(69)
The continuous time output is given by a smooth curve connecting all of the sampled points at
times tk. Similar procedures can be followed for analyzing the dynamic response of other
open-loop systems involving other plants and controllers.
The reader will have noticed that special techniques are required to ﬁnd transfer functions for
sampled data systems, because no transfer function exists for an ideal sampler. This transfer
function issue is also found in closed-loop systems, which we consider next.
Closed Loop Control
We consider ﬁrst the model for a closed-loop system shown in Figure 2.7 in which, for
notational simplicity the zero-order hold, controller, and plant are represented by a single
transfer function H(s).
In this ﬁgure, a reference input R(s) is the desired value for the system output Y(s). An error
signal E(s) is obtained which is given by
EðsÞ ¼ RðsÞ  YðsÞ
(70)
It is assumed that the output is measured via a sensor having transfer function HsðsÞ such that
the error signal is given by
EðsÞ ¼ RðsÞ  HsðsÞYðsÞ
(71)
Since the input to the combined plant is starred (i.e., sampled) the system output is given by
YðsÞ ¼ HðsÞEðsÞ
(72)
The error is, then, given by
EðsÞ ¼ RðsÞ  HðsÞHsðsÞEðsÞ
(73)
The starred error E*(s) is given by
EðsÞ ¼
X
N
n¼0
eðnTÞenTs
(74)
Figure 2.7:
Simpliﬁed block diagram of a closed-loop system (new ﬁgure).
68
Chapter 2

Taking the starred transform of both sides of the equation yields
EðsÞ ¼ RðsÞ  HH
sðsÞEðsÞ
(75)
where the bar over the product indicates that the product is taken before the transform.
Solving the above equation for E*(s) yields
EðsÞ ¼
RðsÞ
1 þ HH
sðsÞ
(76)
The z-transform for this expression is found by replacing eTs with z:
EðzÞ ¼
RðzÞ
1 þ HHsðzÞ
(77)
The system output is given by
YðzÞ ¼ HðzÞEðzÞ
¼
HðzÞRðzÞ
1 þ HHsðzÞ
(78)
The closed-loop transfer function Hc‘(z) is given by
Hc‘ ¼ YðzÞ
RðzÞ
¼
HðzÞ
1 þ HHsðzÞ
(79)
The time domain output at the sampling instants is given by the inverse z-transform
of Y(z)
yðnTÞ ¼ Z 1½YðzÞ
(80)
Unfortunately, this result gives no direct information of Y(t) at time other than tn ¼ nT.
In principle, the output at all times (i.e., y(t)) could be found from the analog transfer function
model
YðsÞ ¼ HðsÞRðsÞ
1 þ HH
sðsÞ
(81)
However, in practice, the difﬁculties in analysis using this analog model generally lead to the
digital transfer function approach.
Discrete Time Systems Theory
69

We consider next the block diagram of a closed-loop system in which all of the major
components are explicitly depicted and given in Figure 2.8.
In this ﬁgure, the independent variable for each component as it is modeled is depicted.
Starred transforms are also depicted. The error E(s) is given by
EðsÞ ¼ RðsÞ  HðsÞHsðsÞH
cðsÞEðsÞ
YðsÞ ¼ HðsÞH
cðsÞEðsÞ
(82)
Finding the starred transform of both sides of the ﬁrst equations yields
EðsÞ ¼ RðsÞ  HH
sðsÞHcðsÞEðsÞ
(83)
Solving for E*(s) yields
EðsÞ ¼
RðsÞ
1 þ HcðsÞHH
sðsÞ
(84)
From this expression, the z-transfer function can be found:
EðzÞ ¼
RðzÞ
1 þ HcðzÞHHsðzÞ
(85)
and the output is given by
YðzÞ ¼
HcðzÞHðzÞRðzÞ
1 þ HcðzÞHHsðzÞ
(86)
(a)
(b)
Figure 2.8:
Discrete time closed-loop system.
70
Chapter 2

The closed-loop transfer function Hc‘ðzÞ is given by
Hc‘ðzÞ ¼ YðzÞ
RðzÞ
¼
HcðzÞHðzÞ
1 þ HcðzÞHHsðzÞ
(87)
The procedures for developing Hc‘ðzÞ from the various components in the continuous model
(which are functions of s) are illustrated in the next section of this chapter.
It is common practice in developing a closed-loop control system to work with continuous
time models. These models can yield an analog controller transfer function using methods
discussed in the previous chapter (e.g., P, PI, and PID type control) with gain optimization to
satisfy requirements as closely as possible. Many methods have been discussed in the
previous chapter (e.g., the use of root locus techniques to select gains that place closed-loop
poles where desired). Stability analysis can also be done along with phase compensation
through lead/lag networks. Then, once the optimized analog transfer function for the
controller is found the corresponding digital transfer function H(z) can be obtained by the
methods given above. For example, a digital controller system might be of the form of a PID
control law. For this case, the control output at time tn (i.e., un) could, for example, be given by
the following function of the error (˛n) (see equation 92)
un ¼ Kp˛n þ KD
T ½˛n  ˛n1 þ KIT
X
K
k¼1
˛nk þ ˛nðkþ1Þ
2
(88)
where the third term above represents a discrete time approximation to the integral of the
error. The control transfer function can be found by taking the z-transform of the control law,
making use of the time shift property. For the above control law, the control variable u(z) is
given by
uðzÞ ¼
"
Kp þ KD
T ð1  z1Þ þ KIT
X
k
k¼1
zk þ zðkþ1Þ
2
#
EðzÞ
(89)
The control transfer function Hc(z) is then given by
HcðzÞ ¼ uðzÞ
EðzÞ
(90)
where E(z) ¼ Z {˛k} and where
HcðzÞ ¼ Kp þ KD
T ð1  z1Þ þ KIT
X
L
k¼1
zk þ zðkþ1Þ
2
(91)
Discrete Time Systems Theory
71

Example Discrete Time Control System
We illustrate the above discrete time control methodology with a speciﬁc example. In this
example, we avoid using the ﬁctional starred transforms that were introduced simply to
explain the theory of discrete time systems. Figure 2.9 is a block diagram of a plant having
transfer function Hp(s) and a discrete time digital control system.
This system controls the plant output variable y(t) in response to the command input x(t). The
error signal ˛(t) is given by
˛ðtÞ ¼ xðtÞ  yðtÞ
(92)
where an ideal sensor (i.e., Hs(s) ¼ 1) is assumed that provides the feedback signal. The
sample and A/D convertor provide discrete time samples ˛k of ˛ at times tk ¼ kT:
˛k ¼ ˛ðtkÞ
k ¼ 1; 2; .
(93)
where T is the sample period. The digital control generates control signal uk in accordance
with the desired control algorithm. It is assumed that the digital controller has a D/A converter
such that uk are voltage pulses that are sent to the ZOH. A ZOH and ﬁlter convert the samples
uk to a piecewise continuous time control signal uðtÞ, which operates the actuator that drives
the plant. For the present example, the plant is represented by a continuous time model that
has transfer function Hp(s):
Hp ¼
Ka
sðs þ p1Þ
(94)
where p1 is the ﬁrst order pole and Ka is the actuator constant.
In order to reduce computational complexity, a proportional-only controller having
proportional gain Kp and relatively simple plant model are assumed. However, the following
procedure is followed regardless of controller and plant complexity.
The forward path transfer function HF(s) of the discrete time system is given by
HF ¼ Kp
1  eTs
s

HpðsÞ
(95)
Figure 2.9:
Block diagram of example discrete time closed-loop control system (new ﬁgure).
72
Chapter 2

The z-transform HF(z) is given by
HFðzÞ ¼ Z

Kp
1  eTs
s

HpðsÞ

(96)
¼ Kpð1  z1ÞZ
HpðsÞ
s

(97)
From the time shift property of the z-transform, eTs / z1.
In order to evaluate the z-transform of Hp(s)/s (using transform tables), speciﬁc values are
chosen for the following parameters:
Ka ¼ 4; 500
P1 ¼ 351:2
T ¼ 0:001s
Kp ¼ 14:5
The procedure for obtaining the z-transform of the function HpðsÞ=s is to represent it in
a partial fraction expansion of the form
HpðsÞ
s
¼
a1
s þ p1
þ
a2
s þ p2
þ / an
s þ pn
(98)
However, in the present example, the function HpðsÞ=s has a double pole at s ¼ 0. In general,
for a pole of multiplicity r at s ¼ sr, the partial fraction expansion of HpðsÞ=s becomes
HpðsÞ
s
¼
Ar
ðs þ srÞr þ
Ar1
ðs þ srÞr1 þ / A1
s þ sr
þ
X
J
j¼1
aj
s þ sj
(99)
where
Ar ¼

ðs þ srÞr HpðsÞ
s

s¼sr
(100)
Ark ¼

1
ðr  kÞ!
dk
dsk
HpðsÞ
s

s¼sr
(101)
and where the poles sj ( j ¼ 1,2 /J) are simple poles.
Discrete Time Systems Theory
73

The z-transform of each term can be found from the tables once the sample period T has been
determined. For example, the z-transform of each simple pole is given by
Z
 aj
s þ sj

¼
ajz
z  esjT
(102)
Table 2.1 also gives the z-transform for terms associated with multiple poles.
The present example discrete time control system is of the form
HpðsÞ
s
¼
Ka
s2ðs þ p1Þ
(103)
Table 2.1: Table of Transforms
LaPlace Transform
Time Function
z-Transform
1
Unit impulse d
1
1
s
Unit step us(t)
z
z  1
1
1  eTs
drðtÞ ¼
X
N
n¼0
dðt  nTÞ
z
z  1
1
s2
t
Tz
ðz  1Þ2
1
s3
t2
2
T2zðz þ 1Þ
2ðz  1Þ3
1
snþ1
tn
n!
lim
a/0
ð1Þn
n!
vn
van
h
z
z  eaT
i
1
s þ a
eat
z
z  eaT
1
ðs þ aÞ2
teat
TzeaT
ðz  eaTÞ2
a
sðs þ aÞ
1  eat
ð1  eaTÞz
ðz  1Þðz  eaTÞ
u
s2 þ u2
sin ut
zsinuT
z2  2zcosuT þ 1
u
ðs þ aÞ2 þ u2
eat sin ut
zeaTsinuT
z2  2zeaTcosuT þ e2aT
s
s2 þ u2
cos ut
zðz  cosuTÞ
z2  2zcosuT þ 1
s þ a
ðs þ aÞ2 þ u2
eat cos ut
z2  zeaTcosuTÞ
z2  2zeaTcosuT þ e2aT
74
Chapter 2

The partial fraction expansion of this function yields three terms given by
Ka
s2ðs þ p1Þ ¼ Ka
p1s2  Ka
p2
1s þ
Ka
p2
1ðs þ p1Þ
(104)
The z-transform for each of the terms above can be determined using Table 2.1 at the end of
this chapter. Then the individual terms can be combined to yield the desired HF (z).
The z-transform of HF(z) is evaluated to be
HFðsÞ ¼
0:029z þ 0:025z
z2  1:697z þ 0:697
(105)
The closed-loop transfer function Hc‘ is given by
Hc‘ðzÞ ¼ YðzÞ
XðzÞ
(106)
Hc‘ðzÞ ¼
HFðzÞ
1 þ HFðzÞ
(107)
It is left as an exercise for the reader to show that Hc‘ is given by
¼
0:029z þ 0:0257
z2  1:668z þ 0:7226
(108)
The dynamic response of the closed-loop discrete time system is illustrated by its response to
a unit step. The z-transform of the unit step X(z) is given by
XðzÞ ¼
z
z  1
(109)
The system output Y(z) is given by
YðzÞ ¼ Hc‘ðzÞXðzÞ
(110)
¼
zð0:029z þ 0:0257Þ
ðz  1Þðz2  1:668z þ 0:7226Þ
(111)
The three poles of Y(z) are given by
z1 ¼ 1
z2 ¼ 0:8340  0:1645i
z3 ¼ 0:8340 þ 0:1645i
Discrete Time Systems Theory
75

The output sequence {yk} can be found using the procedures described earlier beginning with
a partial fraction expansion of Y(z):
YðzÞ ¼
a1
z  z1
þ
a2
z  z2
þ
a3
z  z3
(112)
¼
a1z1
1  z1z1 þ
a2z1
z  z2z1 þ
a3z1
z  z3z1
(113)
where a1 ¼ 1.0018, a2 ¼ 0.4864 þ 0.2658i, and a3 ¼ 0.4868  0.2658i.
Each partial fraction is analytic outside the unit circle in the complex z-plane since all poles
have magnitudes satisfying
zj
  1
j  1; 2; 3.
Thus, the sequence {yk} ¼ 0 for k < 0 as expected. The partial fractions can be rewritten in
a Taylor series in powers of z1:
ajz1
1  zjz1 ¼ aj
X
N
m¼0
zm
j zðmþ1Þ
(114)
By replacing mþ1 ¼ k and summing over k beginning with k ¼ 1, the partial fraction can be
written in the form of a z-transform and the coefﬁcients of zk become yk. The output
sequence terms are given by
yk ¼
X
3
j¼1
ajzk1
j
j ¼ 1; 2; 3.
(115)
The output y(t) is given only at the sample periods tk:
yðtÞ

t¼tk¼ yk
(116)
Thus, the system continuous time output is only correctly given at these sample times.
However, if the sample period (T) is sufﬁciently short, these samples represent y(t) with
enough accuracy for most practical circumstances. However, if the sample period is
increased, the accuracy of the sampled output is degraded. This point is demonstrated in
Figure 2.10, which plots the output y(tk) for T ¼ 0.1 s and for T ¼ 0.001 s (i.e., 1 ms).
The output for the 1-ms sample period agrees very closely with the output of the
corresponding continuous time output. However, for the longer sample period the errors can
become quite large.
76
Chapter 2

The same procedure is used for ﬁnding the closed-loop transfer function and dynamic
response sequence {yk} regardless of the complexity of the plant and controller transfer
function complexity and the input waveform x(t). Finding the z-transform of the discrete time
forward path is normally best accomplished with respect to published tables of z-transforms
(also available on-line). The closed-loop transfer function is found and the output Y(z) for any
given input X(z) is given by
YðzÞ ¼ Hc‘ðzÞXðzÞ
(117)
The time sequence {yk} is, then, found by expanding Y(z) in a partial fraction model. Each
term in the partial fraction model can be written as a Taylor series in powers of zk. The
coefﬁcients of all multiples of zk, when combined, yield the time sequence {yk}, which
yields a sampled version of the continuous time system output y(t).
Summary
This chapter has presented the general systems theory for discrete time digital systems.
Speciﬁc applications in automotive electronic systems are presented throughout this book.
The same basic procedures presented in this chapter apply to each of these exemplary
systems.
Figure 2.10:
Unit step response of example discrete time closed-loop control system.
Discrete Time Systems Theory
77

This page intentionally left blank

CHAPTER 3
Electronics Fundamentals
Chapter Outline
Semiconductor Devices
80
Diodes
83
Rectifier Circuit
85
Transistors
87
Field-Effect Transistors
96
Integrated Circuits
99
Operational Amplifiers
100
Use of Feedback in Op Amps
101
Summing Mode Amplifier
103
Phase-Locked Loop
104
Sample and Zero-Order Hold Circuits
106
Zero-order hold circuit
110
Digital Circuits
111
Binary Number System
113
Logic Circuits (Combinatorial)
114
NOT Gate
114
AND Gate
115
OR Gate
117
Combination Logic Circuits
117
Logic Circuits with Memory (Sequential)
119
ReS Flip-Flop
119
JK Flip-Flop
119
Synchronous Counter
120
Register Circuits
121
Shift Register
122
Integrated Circuits
124
The Microprocessor
124
This chapter is for the reader who has little knowledge of electronics. It is intended to provide
an overview of the subject so that discussions in later chapters about the operation and use of
automotive electronics control systems will be easier to understand. The chapter discusses
electronic devices and circuits having applications in electronic automotive instrumentation
and control systems. Topics include semiconductor devices, analog circuits, digital circuits,
and fundamentals of integrated circuits.
Understanding Automotive Electronics. http://dx.doi.org/10.1016/B978-0-08-097097-4.00003-5
Copyright  2012 Elsevier Inc. All rights reserved.
79

Semiconductor Devices
All of the active circuit devices (e.g., diodes and transistors) from which electronic circuits
are built are themselves fabricated from so-called semiconductor materials. A semiconductor
material in pure form is neither a good conductor nor a good insulator. The ability of
a material to conduct electric current is characterized by a property called conductivity. A
model for current ﬂow in semiconductor materials and an explanation for electrical
conductivity are developed later in this chapter. A metal such as copper, which is a good
conductor, has a relatively high conductivity such that current ﬂows in response to relatively
low applied voltage. An insulator such as mica has a relatively low conductivity such that
essentially zero current ﬂows in response to an applied voltage. A semiconductor material has
conductivity somewhere between that of a good conductor and that of a good insulator.
Therefore, this material (also called semiconductor material) and devices made from it are
semiconductor devices (also called solid-state devices).
There are many types of semiconductor devices, but transistors and diodes are two of the most
important in automotive electronics. Furthermore, these devices are the fundamental
elements used to construct nearly all modern integrated circuits. Therefore, the discussion of
semiconductor devices will be centered on these two. Semiconductor devices are made
primarily from silicon or germanium (although other materials, e.g., gallium arsenide, are
also in use) that is purposely infused with impurities that change the conductivity of the
material.
The conductivity of a pure semiconductor can be varied in a predictable manner by diffusing
precisely controlled amounts of very speciﬁc impurities into it. The process of adding
impurities to silicon is called “doping.” Boron and phosphorus are often used as impurity
source materials to alter the conductivity of silicon. When boron is used, the semiconductor
material becomes a so-called p-type semiconductor. When phosphorus is used, the
semiconductor material becomes an n-type semiconductor.
In order to understand the operation of these transistors and diodes, it is helpful to understand
the basic physical mechanism of electrical conductivity in both n-type and p-type
semiconductor materials. The ﬂow of an electric current through any material is due to the
motion of electrons in the material in response to an applied electric ﬁeld. This electric ﬁeld
results from the application of a voltage at the external terminals of the corresponding
structure. Although the details of electric ﬁeld theory are beyond the scope of this book,
roughly speaking, it varies in proportion to applied voltage and inversely with the distance
between the electrodes to which the voltage is applied. The electrons that move in response to
this electric ﬁeld originate from the individual atoms that make up the material.
For a basic understanding of conductivity, it is helpful to refer to Figure 3.1, which depicts
a relatively long, thin slab of semiconductor material across which a voltage is applied. In this
80
Chapter 3

ﬁgure, the electric ﬁeld intensity is a vector denoted E which is x directed. In this book,
vectors are indicated by a bar over the symbol for the vector as exempliﬁed by the electric
ﬁeld intensity E. A voltage v is applied to a pair of conducting (e.g., Cu) electrodes. For this
relatively long, thin semiconductor material, the magnitude of the electric ﬁeld intensity E is
given approximately by
E ¼ v
L
Also shown in Figure 3.1 is the current density vector J, which is also an x-directed vector. The
magnitude of the current density J is the current per unit cross-sectional area and is given by
J ¼ i
Ac
(1)
where Ac is the cross-sectional area of the slab in the y, z plane. The current density vector is
proportional to the electric ﬁeld intensity
J ¼ s E
(2)
where s is the conductivity of the material. The reciprocal of conductivity is known as the
resistivity r of the material:
r ¼ 1
s
(3)
The explanation of electron ﬂow in any material is based upon the “band theory of electrons.”
This theory is a major component in modern atomic physics. According to this theory, the
energy of the electrons associated with the atoms making up a material is constrained to
certain ranges called bands. Any given electron will have an energy within one of these bands
E
i
electrode
ν
O
L
x
electrode
J
Figure 3.1:
Illustration of current conduction in semiconductor.
Electronics Fundamentals
81

and no electron can have energy outside these bands. Within each band the electrons can have
only discrete energy levels and only one electron can “occupy” a given energy level.
Consequently, the number of electrons within each band for any atom is constrained to the
number of “allowed” energy levels. An electron can only move in response to an applied
electric ﬁeld and contribute to current ﬂow if there is an unoccupied energy level to which it
can move as its energy changes due to the electric ﬁeld intensity force acting on it.
All of the energy levels of the lower energy bands of an atom are ﬁlled such that there is no
energy level to which an electron can move in response to an applied electric ﬁeld. Thus, these
lower band electrons cannot contribute to current ﬂow in response to an applied voltage. The
electrons in the outermost band, known as the conduction band, are the least tightly bound and
for a material such as Si they are few in number relative to the number of energy levels in that
band. These outer band electrons can move to an adjacent energy level and effectively move
freely in response to an applied electric ﬁeld. These electrons are called “free electrons.”
Doping Si with phosphorus impurity results in an excess of free electrons relative to pure Si.
The doped material is said to be an “n-type” semiconductor and has a conductivity that is
greater than the undoped Si.
Thenextlowestenergybandfromtheoutermostiscalledthe“valenceband”sinceitisassociated
with the chemical valence of the material (in this case Si). The energy levels of this band are
nearly (but not completely) ﬁlled.However, dopinga semiconductor with a p-type impurity (e.g.,
doping Si with Boron) yields a relative excess of energy levels in this valence band. The resulting
doped material is called a p-type semiconductor. Electrons in this band can move to the available
energy levels created by doping in response to an electric ﬁeld, thereby contributing to current
ﬂow. However, functionally this p-type material behaves as though it had excess of positively
charged particles called “holes.” The model for current ﬂow in a semiconductor and the
explanationofsemiconductordevicesusetheﬁctitiousholesandtheirresponsetoanappliedﬁeld
as a basis for the contribution they make to current ﬂow. The terminology used to describe these
charge carriers is as follows: in n-type material electrons are called “majority carriers” and holes
called “minority carriers”; the reverse is true in p-type material.
Doping a semiconductor material changes the relative densities of holes and electrons.
However, there is a basic relationship between these densities, which is preserved regardless
of the doping concentrations. If one starts with an intrinsic semiconductor such as Si which
has an equal concentration of “free” electrons and holes which are identical, we denote this
concentration ni ¼ 1.5  1010/cm3.
Doping Si with either a p-type or an n-type impurity changes the concentrations. Denoting
electron density n, and hole density p, the following equation expresses the relationship
between these concentrations under thermal equilibrium:
np ¼ n2
i
(4)
82
Chapter 3

There is another basic aspect of semiconductor physics which plays a role in the electrical
characteristics of semiconductor electronic components. Whenever a voltage V is applied to
a slab of semiconductor material it creates an electric ﬁeld which is represented by the electric
ﬁeld intensity vector E as described above (in this text the overbar for a variable is the
notation indicating that the variable is a vector).
In a semiconductor material, any electric ﬁeld due to an external potential causes the electrons
and holes to move with mean velocity vectors ve and vh, respectively. These velocities are
given by
ve ¼ meE
vh ¼ mhE
where me is the electron drift mobility and mh is the hole drift mobility.
These mean velocities yield electron and hole current densities Je and Jh, respectively:
Je ¼ nqve
Jh ¼ pqvh
where q is the charge on an electron (1.6  1019) coulomb.
These relationships will appear in models for various components in this text.
Throughout this book, current ﬂow is taken to be conventional current in which the direction
of ﬂow is from positive to negative, whereas in reality current consists of electron motion
from negative to positive. This choice of current is merely convenient for notational purposes
and has no effect on the validity of any circuit analysis or design.
Diodes
A diode is a two-terminal electrical device having one electrode that is called the anode
(a p-type semiconductor) and another that is called the cathode (an n-type semiconductor).
A solid-state diode is formed by the junction between the anode and the cathode. In practice,
a pen junction is formed by diffusing p-type impurities on one side of the intended junction
and n-type impurities on the other side.
The region in which the diode material changes from p-type to n-type material is called the
pen junction (or simply junction). The junction region is relatively short but plays a critical
role in the diode operation. When the junction is formed, electrons in the vicinity of the
junction migrate from the n-type to the p-type. Similarly, holes in the region migrate from
p-type to n-type. This migration leaves behind a positively charged dopant ion on the n-side
Electronics Fundamentals
83

and a negatively charged dopant ion on the p-side over a region known as the depletion region
that creates a charge distribution that in turn creates a potential difference between the two
regions. In equilibrium conditions, this potential inhibits further current ﬂow. This potential is
known as the junction barrier potential since it acts more or less like a barrier to the current
ﬂow.
The current, which ﬂows through the diode in response to an applied voltage, depends upon
the polarity of the voltage as well as its magnitude. Figure 3.2 illustrates the schematic
symbol for a pen diode showing the p-type (anode) and n-type (cathode) sides of the
junction. If a voltage is applied with positive on the anode and negative on the cathode, it is
said to be “forward biased.” For the opposite polarity, the diode is said to be “reverse biased.”
Forward bias reduces the junction barrier potential, thereby increasing current ﬂow. Reverse
bias increases that potential, thereby inhibiting current ﬂow.
The current through a forward-biased diode increases exponentially with applied voltage V,
whereas the reverse-biased ﬂow reaches a very low saturation current Is. A model for this
current ﬂow is
I ¼ IsðexpðV=nVtÞ  1Þ
(5)
where Is and n are parameters that are speciﬁc to a particular diode. The parameter VT is called
the thermal voltage and is given by
VT [ kT=q
where k is the Boltzman’s constant, T is the junction absolute temperature, and q is the
electron charge.
Figure 3.2:
Schematic symbol (use old 3-1a). Schematic symbol for pen diode.
84
Chapter 3

At room temperature, VTy26 mv. The parameter n is normally between 1 and 2 and Is is
a few m amp. Figure 3.3 depicts this current ﬂow vs. diode junction applied voltage V. The
reverse-bias current is too small to be shown.
Although the model given above for diode voltage current characteristics is a very good
representation for a practical diode (provided the reverse-bias voltage is below its breakdown
voltage), it is generally not necessary to represent the diode with this degree of accuracy for
most circuit analysis or design purposes. Normally it is sufﬁcient for the voltage levels involved
in automotive electronics to represent a pen diode as a polarity-dependent switch as
characteristic in ﬁgures. The switch can be modeled as being open for reverse bias and closed
for forward bias. With this model, the diode current in the forward bias is limited by the external
circuit components to which it is connected. The reverse-bias current is taken to be zero.
Rectiﬁer Circuit
The circuit in Figure 3.4, a very common diode circuit, is called a half-wave rectiﬁer circuit
because it effectively cuts the AC (alternating current) waveform in half in the sense that the
diode passes the positive portion of the cycle and blocks the negative portion of the cycle.
Consider the circuit ﬁrst without the dotted-in capacitor. The alternating current voltage
source is assumed to be a sine wave with a peak-to-peak amplitude of 100 V (50-V positive
swing and 50-V negative swing). Waveforms of the input voltage and output voltage plotted
against time are shown as the solid lines in Figure 3.5. Notice that the output never drops
below 0 V. The diode is reverse biased and blocks current ﬂow when the input voltage is
negative, but when the input voltage is positive, the diode is forward biased and permits
current ﬂow. If the diode direction is reversed in the circuit, current ﬂow will be permitted
when the input voltage is negative and blocked when the input voltage is positive. Rectiﬁer
1.8
1.4
1.0
0.6
Diode voltage, V
Diode current, mA
0.2
0
6
18
30
42
54
ideal
actual
Figure 3.3:
Transfer characteristic. Diode transfer characteristics.
Electronics Fundamentals
85

circuits are commonly used to convert the AC voltage into a DC voltage (e.g., for use with
automotive alternators to provide DC current battery charging and to supply electrical power
to the vehicle). Using a capacitor to store charge and resist voltage changes smoothes the
rippling or pulsating output of a half-wave rectiﬁer.
The input voltage Vin of Figure 3.4 is AC; the output voltage Vout has a DC component and
a time-varying component, as shown in Figure 3.5.
The output voltage of the half-wave rectiﬁer can be smoothed by adding a capacitor, which is
represented by the dotted lines in Figure 3.4. The combination of the load resistance (R) and
the capacitor (C) forms a low-pass ﬁlter, which acts to smooth the ﬂuctuating output of the
half-wave rectiﬁer diode. Since the capacitor stores a charge and opposes voltage changes, it
discharges (supplies current) to the load resistance R when Vin is going negative from its peak
voltage. The capacitor is recharged when Vin comes back to its positive peak and current is
supplied to the load by the Vin. The result is Vout that is more nearly a smooth, steady dc
voltage, as shown by the dotted lines between the peaks of Figure 3.5. The amplitude of the
ripples in the output voltage can be made insigniﬁcant by choosing a capacitor having
sufﬁciently large capacitance, which lowers the low-pass ﬁlter corner frequency and
attenuates the ripple components (see Chapter 1).
Figure 3.4:
Rectiﬁer circuit.
Figure 3.5:
Rectiﬁer waveforms.
86
Chapter 3

There are many diode applications including some in communications systems. Often, it is
desirable to change the carrier frequency of an information-carrying signal. The highly
nonlinear transfer characteristics of a diode make it an excellent component for a process
known as “frequency mixing.” Whenever two or more signals are passed through a diode,
a signal is generated that includes components whose frequencies are the sum and the
difference of the two original signal frequencies. Figure 3.6 depicts a simpliﬁed embodiment
of the frequency-mixing concept.
Let the two voltage sources have terminal voltages v1, v2: where v1ðtÞ ¼ V1sinðu1tÞ:
v2ðtÞ ¼ V2sinðu2tÞ
It can be shown that the voltage across Rm is given by
vm ¼
X
N
n¼N
X
N
m¼N
Cm;nðV1; V2Þsin½ðmu1 þ nu2Þt
(6)
where the coefﬁcients Cm,n are functions of V1,V2 as well as Rm and m, n are integers. The
amplitudes of these coefﬁcients are largest for relatively small n and m and asymptotically
approach 0 as n/  N and m/  N. In most communications, application frequency
mixing circuits are used to select the desired frequency components. The ﬁlter pass band
encloses the desired frequency component and its stop bands reject the unwanted frequency
components (see Chapter 1).
Transistors
Diodes are static circuit elements; that is, they do not have gain or store energy. Transistors are
active elements because they can amplify or transform a signal level. Transistors are three-
terminalcircuitelements thatact likevoltage or current-controlled current ampliﬁers. Transistors
come in two major categories that are termed “bipolar” or “ﬁeld effect” depending upon whether
they are current or voltage controlled, respectively. There are two common bipolar (i.e.,
consisting of n-type and p-type semiconductors) types denoted 1) NPN and 2) PNP.
Filter
H(j )
Rl
Rm
Vm
V1
V2
Figure 3.6:
Frequency “mixing” circuit.
Electronics Fundamentals
87

Physically, an NPN transistor structure consists of a thin p-type material (called BASE)
sandwiched between 2 n-type pieces, which are called the COLLECTOR and the EMITTER.
A PNP transistor has a thin n-type material as the BASE between a p-type EMITTER and
p-type COLLECTOR.
Bipolar transistors can be made to amplify or switch in three different circuit conﬁgurations:
1) grounded emitter, 2) grounded base, and 3) grounded collector. For the present discussion,
we will use Figure 3.7a and b to depict the schematic symbols for both bipolar types. The
direction of conventional current ﬂow for each of the terminals for collector (Ic), emitter (Ie),
and base (Ib) is shown in these schematic symbol drawings. Figure 3.8 depicts a circuit
conﬁguration for a grounded emitter NPN ampliﬁer whose theory of operation is explained
later in this chapter.
The signal being ampliﬁed is represented by source voltage vs and source resistance Rs. The
load resistance R‘ connects the collector to the positive DC power supply voltage Vcc. The
output, ampliﬁed signal is taken at the collectoreR‘ junction and is denoted vo. For linear
ampliﬁcation, a bias resistance Rb supplies a DC current to the base. The purpose of the bias
current is explained later with respect to the operation of a transistor as an ampliﬁer.
Transistors are useful as amplifying devices. During normal operation, current ﬂows from the
base to the emitter in an NPN transistor. The collectorebase junction is reverse biased, so that
COLLECTOR
NPN transistor schematic symbol
EMITTER
N
BASE
Ib
Ie
P
Ic
N
COLLECTOR
PNP transistor schematic symbol
EMITTER
BASE
Ib
Ie
Ic
(a)
(b)
Figure 3.7:
Transistor schematic symbols.
88
Chapter 3

only a very small amount of current ﬂows between the collector and the base when there is no
base current ﬂow.
The baseeemitter junction of a transistor acts like a diode. Under normal operation for
an NPN transistor, current ﬂows forward into the base and out the emitter, but does not
ﬂow in the reverse direction from emitter to base. The arrow on the emitter of the
transistor schematic symbol indicates the forward direction of current ﬂow. The
collectorebase junction also acts as a diode, but supply voltage is always applied to it in
the reverse direction. This junction does have some reverse current ﬂow, but it is so
small (106 to 1012 amp) that it is ignored except when operated under extreme
conditions, particularly temperature extremes. In some automotive applications, the
extreme temperatures may signiﬁcantly affect transistor operation. For such applications,
the circuit may include components that automatically compensate for changes in
transistor operation.
The operation of an NPN bipolar junction transistor (BJT) in grounded emitter conﬁguration
can be understood with reference to Figure 3.9. In this conﬁguration, the individual component
regions e collector, base, and emitter e are depicted along with the very important depletion
regions in each at both junctions. Voltages Vce and Vbe are the voltages of the collector (þ) and
the base (þ) relative to emitter (ground), where Vce > Vbe. These voltages reverse bias the
collectorebase junction and forward bias the baseeemitter junction. The electrically neutral
portions of the collector and emitter are denoted n and the neutral portion of the base is denoted
p. The reverse-bias collectorebase voltage is denoted Vcb and is given by
Vcb ¼ Vce  Vbe
An increase in Vce (without changing Vbe) increases the reverse bias which increases the
depletion region in both the collector and base. There is no change in the depletion region of
Vcc
Vs
v0
ie
ib
Rb
R
ic
Rs
Figure 3.8:
NPN transistor ampliﬁer circuit.
Electronics Fundamentals
89

the emitterebase junction (for ﬁxed Vbc). Consequently, the neutral base region is decreased
in size along the active path between collector and emitter.
The narrowing of the base reduces the probability of any recombination of a charge carrier
with an impurity ion. In addition, the gradient of the charge density across the base is
increased such that the current, due to minority carriers injected across the baseeemitter
junction, increases. The result of these effects is to increase the collector (i.e., output) current
as Vce is increased.
The operating characteristics for a bipolar transistor are given as a set of curves of Ic(Vce,Vbe)
known as characteristics curves. The characteristic curves for a typical small signal NPN
transistor (i.e., 2N4401) in the grounded emitter conﬁguration are given in Figure 3.10. These
curves are parametrized in terms of base current (in m amp). Note that each curve for a ﬁxed Vbe
increases from Ic ¼ 0 at Vce ¼ 0, reaching a saturation value and beyond this point increases
roughly linearly, with VCE. A large signal model for the grounded emitter bipolar transistor is
given by the so-called Early model:
Ic ¼ Is exp
Vbe
VT

1 þ Vce
VA

(7)
bF ¼ vIc
vIb
Vce
bF ¼ bF0

1 þ Vce
VA

Vbe
Vce
Vcb
n
Collector
n-type depletion region
Base/collector
depletion region
Base
Base/emitter depletion region
Emitter depletion region
Emitter
p
n
Ic
Figure 3.9:
NPN grounded emitter conﬁguration and voltages.
90
Chapter 3

where Is is the saturation current for the reverse-biased collector-base junction, VT is the
thermal voltage ¼ kT/q, VA is the so-called Early voltage (in the approximate range
15e150 V), and bF0 is the forward common emitter current gain at zero bias:
bF0 ¼ vIc
vIb
Ib ¼ 0
A small signal linear model for the transistor is given in Figure 3.11. This model is the most
useful for performance analysis/design of linear modes of operation.
In this model, the collector current is modeled by a current-controlled current source (hfeIb)
shunted by a resistance R (source impedance). The base current Ib is determined by the source
being ampliﬁed along with external circuit impedances.
The baseeemitter diode does not conduct (there is no transistor base current) until the voltage
across it exceeds Vd volts in the forward direction. If the transistor is a silicon transistor, Vd
equals 0.7 V just as with the silicon diode. The collector current Ic is zero until the
baseeemitter voltage Vbe exceeds 0.7 V. This is called the cutoff condition, or the off
condition, when the transistor is used as a switch.
When Vbe rises above 0.7 V, the diode conducts and allows some base current Ib to
ﬂow. Figure 3.10 shows that the transistor voltage/current characteristics, though
basically nonlinear, have a linear region of operation. A variation in base current about
a point such as Io ¼ 300 mA at VCE ¼ 5 V produces a variation in collector current that
Figure 3.10:
Grounded emitter output characteristics.
Electronics Fundamentals
91

is highly linear. The so-called common emitter forward current gain, denoted hfe, is
given by
hfe ¼ vIc
vIb
Vbe
(8)
It is common practice in linear transistor circuit analysis/design to denote d-c components of
voltage/current with uppercase letters and variations about these d-c values with lowercase
letters. For example, collector current can be modeled as
IcðtÞ ¼ Ico þ dIc
¼ Ico þ icðtÞ
(9)
Similarly, the base current Ib can be modeled as given below
IcðtÞ ¼ Io þ dIb
¼ Io þ ibðtÞ
(10)
At any d-c base current (that is called the base bias current) and is denoted Io in Figure 3.11
the collector a-c current ic is given by
icðtÞ ¼ hfeibðtÞ
(11)
Ib
Ib
hfe
Ic
RL
Vd
Vce
Vcc
R
Vbe
BASE
+
–
+
–
BASE-COLLECTOR
DIODE
BASE-EMITTER
DIODE
EMITTER
COLLECTOR
Figure 3.11:
Current and voltages for NPN transistor.
92
Chapter 3

The current gain (hfe) can range from 10 to 200 depending on the transistor type, but is nearly
constant over a large range of Vce, Ib, Ic. The collector current is represented by a current
generator in the collector circuit of the model in Figure 3.11. This condition is called the
active region because the transistor is conducting current and amplifying. It is also called the
linear region because collector current is (approximately) linearly proportional to base
current. The dotted resistance in parallel with the collectorebase diode represents the leakage
of the reverse-biased junction, which is normally neglected, as discussed previously.
A third condition, known as the saturation condition, exists under certain conditions of
collectoreemitter voltage and collector current. In the saturation condition, large increases in
the transistor base current produce little increase in collector current. When saturated, the
voltage drop across the collectoreemitter is very small, usually less than 0.5 V. This is the
“on” condition for a transistor switching circuit. This condition occurs in a switching circuit
when the collector of the transistor is tied through a resistor RL to a supply voltage Vcc as
shown in Figure 3.8. In this mode of operation, the source voltage is large enough that the
base current drives the transistor into the saturated condition, in which the output voltage
(voltage drop from collector to emitter) is very small and the collectorebase diode may
become forward biased.
Having brieﬂy described the behavior of transistors, it is now possible to discuss circuit
applications for them. As an example of the use of this small signal model, consider the
analysis of the simple ampliﬁer circuit of Figure 3.12a. In this ﬁgure, a signal represented by
the a-c voltage vs and source resistance Rs, and capacitor C is ampliﬁed to an output signal vo.
The purpose of adding the capacitor is to block the d-c base current through the bias resistor
Rb from ﬂowing through the source. This output voltage is produced by collector variation
(due to source voltage variations) acting through load resistance RL.
In a transistor ampliﬁer, a small change in base current results in a corresponding larger
change in collector current. In order to achieve linear ampliﬁcation the transistor is
biased with a d-c current Io via bias resistor Rb. The characteristic curves for this
transistor are shown in Figure 3.11b. The straight line (called the load line) connecting
Vce ¼ Vcc with Ic ¼ Ics represents the variation in voltage Vo and collector current Ic with
variation in base current due to signal voltage Vs. The slope of the load line SLL is
given by
SLL ¼ dIc
dVce
(12)
¼ Ics
Vcc
¼ 1
RL
Electronics Fundamentals
93

With vs ¼ 0, the bias current is given by
I0 ¼ Vcc  Vd
Rb
yVcc
Rb
(13)
where Vd is the forward-bias voltage drop across the baseeemitter junction, which is typically
negligible in comparison with Vcc. The analysis of this circuit is done using the small signal
model of Figure 3.12c in which the load resistance at terminal Vcc is at a-c ground potential.
The output voltage vo of circuit in Figure 3.12a is the a-c component of Vce.
This model, which is often termed the “small signal linear incremental transistor model,” is
actually an idealized (ﬁctional) equivalent circuit that is only valid for linear ampliﬁcation
and represents only the time varying (i.e., a-c) components of voltages and currents. In this
model, the collector current ic is represented by a current-controlled ideal current source
shunted by a source resistance Rc. An ideal current source is an artiﬁcial circuit component
(a)
(b)
(c)
Vcc
RL
Rb
Rs
Rs
C
Rc
RL
vo
ie
vc hfe ib
lb
Vs
Vo
vs
Io
Ic
100
50
COLLECTOR CURRENT : Ic(mA)
00
5
10
COLLECTOR-EMITTER VOLTAGE : VCE(V)
Ta=25ºC
600
600
600
500
500
500
400
400
400
300
300
300
200
200
200
100
100
100
IB=0μA
IB=0μA
IB=0μA
Ics
IoIoIo
Figure 3.12:
Grounded emitter NPN transistor ampliﬁer.
94
Chapter 3

that produces a current that is independent of any load impedance. The current generated is
proportional to base current ib and is given by
ic ¼ hfeib
(14)
Assuming Rc >> RL (which is the usual case), the output voltage vo is given by
voðtÞ ¼ RLicðtÞ
(15)
vo ¼ hfeRLibðtÞ
(16)
Note that the collector voltage and base current are 180 out of phase. This phase change
occurs because load resistance end that is physically connected to the power supply (i.e., Vcc)
is at a-c ground potential and the a-c collector current ﬂows in the direction shown in
Figure 3.12c. The base circuit analysis is conducted by summing the voltage components
around the base circuit loop
vs ¼ ibRs þ vc
(17)
The capacitor voltage vc is given by
vcðtÞ ¼ 1
C
Zt
o
iðsÞdt
(18)
Eqn (17) can be solved for base current ib by using the Laplace transform method of Chapter 1
yielding the following Equation for ib(s):
ibðsÞ ¼
vsðsÞ
Rs þ 1
sC
¼ sCvsðsÞ
1 þ RsCs
(19)
Substituting ib(s) from Eqn (19) into Eqn (16) yields the transistor circuit voltage gain G:
GðsÞ ¼ voðsÞ
vsðsÞ
(20)
¼  hfesCRsRL
RLð1 þ sCRsÞ
¼ hfe
RL
Rs

s=uo
1 þ s=uo

(21)
Electronics Fundamentals
95

where uo ¼
1
RsC
The dimension of the product RsC is time such that uo has the dimension offrequency (in rad/s).
The variation of gain with input frequency can be determined from the steady-state sinusoidal
frequency response for the gain [G(ju)]. In Chapter 1, it was shown that the sinusoidal
frequency response of any system is found by replacing s with ju in the operational transfer
function. Thus, the frequency dependence of ampliﬁer gain is given by
GðjuÞ ¼ hfe
RL
Rs

ju=uo
1 þ ju=uo

(22)
For frequencies u >> uo, the ampliﬁer gain approaches a constant value
GðjuÞ/
u/N
hfe
RL
Rs
(23)
that is, the circuit of Figure 3.12a is a “high pass” ampliﬁer. The d-c blocking capacitor C is
chosen during circuit design such that uo is smaller than the lowest component in vs.
In practice, transistor ampliﬁers frequently consist of multiple stages of the form of
Figure 3.12a connected in cascade, each with a capacitor coupling its output to the input of
the next stage. Of course, the time domain output can be found by taking the inverse Laplace
transform of vo(s) as shown in Chapter 1.
In addition to the linear region of operation, a transistor can be made to operate nonlinearly as
a switch as explained above with respect to saturation and cutoff regions. For this application,
the bias resistor is omitted. Circuit parameters and input voltages are chosen such that the
transistor switches abruptly from cutoff in which Icy0 and saturation in which Ic ¼ Icsat. This
type of operation is used in digital circuits, which are discussed later in this chapter. As will be
shown later, both input and output voltages are binary valued.
Field-Effect Transistors
The types of transistors discussed above are known as bipolar transistors because they operate
by conduction via both electrons and holes. As explained earlier, they amplify relatively weak
base currents yielding relatively large collectoreemitter output currents. They are in effect
current-controlled current ampliﬁers. Another type of transistor operates as a voltage-
controlled ampliﬁer and is called a ﬁeld-effect transistor (FET). There are many variations of
FETs, as explained below.
Unlike the bipolar transistor, which is fabricated with two pen junctions, the ﬁeld-effect
transistor consists of a slab of either n-type or p-type semiconductor to which electrodes are
96
Chapter 3

bonded as depicted in Figure 3.13. An FET is known as either an n-channel or a p-channel
FET depending upon whether the semiconductor is n-type or p-type material, respectively.
An FET is a three-terminal active circuit element having a pair of electrodes connected at
opposite ends of the slab of semiconductor and called source (denoted S) and drain (denoted
D). A third electrode, called the gate (denoted G), consists of a thin layer of conductor that is
electrically insulated from the semiconductor slab.
There are many types of FETs characterized by fabrication technology, material doping (i.e.,
n-channel or p-channel), and whether the gate voltage tends to increase the number of charge
carriers (called enhancement mode) or decrease the number of charge carriers (depletion
mode). The FET circuit schematic symbols for n-type and p-type enhancement modes are
shown in Figure 3.14.
Figure 3.14:
Circuit symbol for FET transistors.
Figure 3.13:
Field-effect transistor conﬁguration.
Electronics Fundamentals
97

Perhaps the most common gate fabrication involves a metal with an oxide layer placed
against the semiconductor in the sequence metal-oxide semiconductor (MOS). The oxide
layer insulates the metal electrode from the semiconductor so that no current ﬂows through
the gate electrode. Rather, the voltage applied to the gate creates an electric ﬁeld that controls
current ﬂow from source to drain. The terminology for an FET having this type of gate
structure is NMOS or PMOS, depending on whether the FET is n-channel or p-channel.
Often, circuits are fabricated using both in a complementary manner, and the fabrication
technology is known as complementary-metal-oxide semiconductor (CMOS). Regardless of
the fabrication technology or the type of semiconductor, FET functions as a voltage-
controlled current source.
The analysis procedure for all FET-type transistors is essentially the same as for a bipolar
transistor. An example-amplifying circuit, shown in Figure 3.15, depicts the current path from
power supply VDD through a load resistor RL and through the transistor from D to S and then
to ground using an n-channel enhancement mode FET. A signal voltage vs applied at the gate
electrode controls the current ﬂow through the FET and thereby through the load resistance
RL. Functionally, the FEToperates like a voltage-controlled current source. A relatively weak
signal applied to the gate can yield a relatively large voltage Vo across the load resistance.
We illustrate such analysis with an example based upon Figure 3.12c. The small signal (a-c)
equivalent circuit model for this circuit is shown in Figure 3.16.
The input impedance for an FET is sufﬁciently large that the gate voltage is approximately the
source voltage vGyvs. The equivalent circuit of Figure 3.16 includes a voltage-controlled
current source whose output current is controlled by gate voltage vG. This current source is
shunted by source resistance R. In this case, the voltage-controlled current source with current
Figure 3.15:
Simple FET ampliﬁer.
98
Chapter 3

iD
¼ gmvG
ygmvs
where
gm ¼ viD
vvG
vGbias
The parametergm is called the “transconductance” for the FET. The output voltagevo is given by
vo ¼  RRLiD
R þ RL
¼  RRLgmvs
R þ RL
(24)
Note that the FET ampliﬁer produces a 180 phase shift from vs to vo similar to the bipolar
ampliﬁer.
The above example illustrates the analysis procedures for any FET. Of course, any given FET
ampliﬁer circuit may incorporate frequency-dependent components (e.g., inductors and
capacitors), which requires analysis via transform techniques as explained in Chapter 1 and
similar to that used in the bipolar transistor analysis.
Integrated Circuits
In modern automotive electronic systems/subsystems, transistors only seldom appear as
individual components (except for relatively high-power applications as drivers for fuel
injection or spark generation). Rather, multiple transistors (numbering in the tens of
thousands are created on a single Si chip). This is particularly true of digital circuits which are
discussed later in this chapter. These combined circuits are termed integrated circuits and are
packaged with dozens or hundreds of leads conﬁgured such that they can be attached via
soldered connections to a so-called printed circuit board. A printed circuit consists of a thin
insulating board onto which conductors are formed that provides the interconnection between
multiple integrated circuits to form an electronic system/subsystem.
VG
s
G
D
R
vS
RS
RL
vo
iD
gmvG
Figure 3.16:
Small signal circuit model for FET ampliﬁer.
Electronics Fundamentals
99

Analog ﬁltering or other signal processing has largely disappeared from contemporary
automobiles. However, some older vehicles may still be on the road in which there is some
analog signal processing. Moreover, analog signal processing is sometimes combined with an
analog sensor. For the sake of completeness, a brief discussion of analog signal processing is
included here. Analog ﬁltering/signal processing is, perhaps, best illustrated with integrated
circuits called “operational ampliﬁers.”
Operational Ampliﬁers
An operational ampliﬁer (op amp) is an example of a standard building block of integrated
circuits and has many applications in analog electronic systems. It is normally connected in
a circuit with external circuit elements (e.g., resistors and capacitors) that determine its
operation. An op amp is a differential ampliﬁer which typically has a very high voltage
gain of 10,000 or more and has two inputs and one output (with respect to ground), as
shown in Figure 3.17a. A signal applied to the inverting input (e) is ampliﬁed and inverted
(i.e. has polarity reversal) at the output. A signal applied to the noninverting input (þ) is
ampliﬁed, but it is not inverted at the output.
–
+
OUTPUT
GROUND
(ZERO VOLTS)
GROUND
(ZERO VOLTS)
NONINVERTING
INVERTING
−
+
vout
vout
vin
iin
Ri
Av =  
Rf
Ri
Rf
if
vin
iin
+
–
Inverting Amplifier
Noninverting Amplifier
Schematic Symbol
–Rf
Ri
Rf
Ri
Av =  
Ri + Rf
Ri
= 1 + 
(b)
(a)
(c)
Figure 3.17:
Op amp circuits.
100
Chapter 3

Use of Feedback in Op Amps
The op amp is normally not operated at maximum gain, but feedback techniques can be used
to adjust the closed-loop gain and dynamic response to the value desired, as shown in
Figure 3.17b. The output is connected to the inverting input through circuit elements
(resistors, capacitors, etc.) which determine the closed-loop gain.
The output voltage vout for an op amp having no feedback path (i.e., open loop) is given by
vout ¼ Aðv1  v2Þ
(25)
where v1 is the noninverting input voltage, and v2 is the inverting input voltage.
Alternatively, this equation can be rewritten in a form from which the relationships between
the inverting and noninverting inputs can be found for an ideal op amp (having open-loop gain
A / N):
v1  v2 ¼ vout
A /
A/N
0
Thus, the 2 input voltages will approach identity for a high-quality (i.e., high A) op amp as
represented by the following condition:
v1yv2
The internal resistance between the inverting and non-inverting inputs is denoted Rin and is
relatively large compared to external resistances used in normal up-amp applications. In the
example of Figure 3.17b, the feedback path consists of resistor Rf. The gain is adjusted by the
ratio of the two resistors and is calculated by the following analysis. For this circuit
conﬁguration, the noninverting for which we can write
v1 ¼ v2 ¼ 0
In order that v1 ¼ 0, the currents at the inverting input must sum to zero:
iin ¼ vin  v1
Ri
iin ¼ vin
Ri
if ¼ vout  v1
Rf
if ¼ vout
Rf
Electronics Fundamentals
101

iin þ if ¼ 0
vout
Rf
¼  vin
Ri
The closed-loop gain Ac‘ is deﬁned
Ac‘ ¼ vout
vin
¼  Rf
Ri
(26)
The phase change of 180 between vin and vout is indicated by the negative Ac‘.
The op amp can readily be conﬁgured to implement a low-pass ﬁlter using the circuit depicted
in Figure 3.18. The components in the feedback path include the parallel combination of
resistor Rf and capacitor C. In this circuit, as in any other inverting mode circuit with the
noninverting mode grounded, the currents into the inverting input sum to 0. Using the Laplace
transform methods of Chapter 1 and the model for capacitor voltage/current relationships
(i.e., ic ¼ C dvc
dt ), the model for the inverting mode currents is given below:
vsðsÞ
Ri
þ voðsÞ

sC þ 1
Rf

¼ 0
(27)
Ri
vs
vout
Rf
C
R
+
–
Figure 3.18:
Low-pass ﬁlter op amp circuit.
102
Chapter 3

Solving for vo/vs gives the closed-loop gain Ac‘ (as a transfer function):
Ac‘ðsÞ ¼ voðsÞ
vsðsÞ
¼ 
Rf =Ri
1 þ sRf C
(28)
With reference to the discussion in Chapter 1 on continuous time systems, it can be seen that
steady-state sinusoidal frequency response Ac‘ðjuÞ is a low-pass ﬁlter having corner
frequency uc ¼ 1/RfC:
Ac‘ðjuÞ ¼ 
Rf =Ri
1 þ ju=uc
(29)
The minus sign in the equation means signal phase inversion from input to output. Moreover,
the closed-loop gain is independent of the open-loop gain (as long as A is large). Furthermore,
since both the inverting and noninverting inputs are held at ground potential, the input
impedance of the op amp circuit of Figure 3.17b presented to input voltage vin is the
resistance of Ri.
A noninverting ampliﬁer is also possible, as shown in Figure 3.17c. The input signal is
connected to the noninverting (þ) terminal, and the output is connected through a series
connection of resistors to the inverting (e) input terminal. The voltage gain, Av, in this case is
Av ¼ vout
vin
¼ 1 þ Rf
Ri
(30)
Note that this noninverting circuit has no phase inversion from input to output voltage. The
minimum closed-loop gain for this noninverting ampliﬁer conﬁguration (with Rf ¼ 0) is unity.
Besides adjusting gain (via the choice of Rf and Ri), negative feedback also can help to correct
for the ampliﬁer’s nonlinear operation and distortion. The input impedance presented to the
input voltage vin by the noninverting op amp conﬁguration of Figure 3.17c is very large
(ideally inﬁnite). This high input impedance is one of the primary features of the noninverting
op amp conﬁguration.
Summing Mode Ampliﬁer
One of the important op amp applications is summing of voltages. Figure 3.19 is a schematic
drawing of a summing mode op amp circuit.
In this circuit, a pair of voltages va and vb (relative to ground) is connected through identical
resistances R to the inverting input. Using the property of inverting mode op amps that the
Electronics Fundamentals
103

currents into the inverting input sum to 0, it can be shown that the output voltage vo is
proportional to the sum of the input voltages:
v0 ¼  Rf ðva þ vbÞ
R
(31)
Phase-Locked Loop
Another example of analog integrated circuit signal processing having automotive application
is a device known as a “phase-locked loop” (PLL). This circuit can be used with certain
analog (continuous time) sensors to provide an analog signal that can be further processed by
a digital electronic system after it is sampled. The PLL ﬁnds application in the demodulation
of phase- or frequency-modulated signals. At least one automotive application is the
measurement of instantaneous crankshaft angular speed as explained later in this book.
A block diagram for the PLL circuit is shown in Figure 3.20.
vd
vs
vv
vo
LPF
VCO
phase
detector
Figure 3.20:
Block diagram for PLL.
–
+
Rf
vo
R
R
va
vb
R1
Figure 3.19:
Schematic drawing of a summing mode op amp circuit.
104
Chapter 3

In this ﬁgure, the input signal vs(t) is assumed to be phase ðfÞ modulated and is given by
vsðtÞ ¼ Vcosðust þ fðtÞÞ
(32)
where fðtÞ is the instantaneous phase modulation.
A corresponding frequency-modulated signal has instantaneous frequency given by
usðtÞ ¼ Us þ dusðtÞ
where Us is the time average frequency and dus is the frequency deviation from mean (i.e.,
modulation).
In any practical application of the PLL for automotive systems, the modulation deviation is
a small fraction of the carrier frequency (i.e., jdusj << Us).
The other components in Figure 3.20 include a phase detector, a low-pass ﬁlter (LPF), and
a voltage-controlled oscillator (VCO). The phase detector is functionally an electronic
multiplier that generates an output voltage vd given by
vd ¼ Kdvsvv
(33)
where Kd is the constant for the device.
The VCO is an oscillator having an output voltage vv(t) whose instantaneous frequency
(uv(t)) is controlled by voltage vo (from the LPF) such that
vvðtÞ ¼ VvcosðfvðtÞÞ
(34)
where
fðtÞ ¼
Zt
o
uvðsÞds
(35)
uvðtÞ ¼ u½voð0Þ þ KvvoðtÞ
(36)
where Kv is the constant for the VCO circuit.
The PLL circuit is an electronic closed-loop control system (see Chapter 1). After a brief
transient period during which the VCO frequency is controlled, its frequency is “locked” to
us (i.e., uv(t) ¼ us(t)) provided Us is within the so-called “capture range” for the VCO. That
is, PLL lock occurs provided
jUs  uvð0Þj  Uc
(37)
where Uc ¼ PLL capture range
(38)
Electronics Fundamentals
105

For frequency modulation cases, under lock conditions the VCO voltage is given by
vvðtÞ ¼ Vvcos½uvt þ df
(39)
where uv ¼ us.
The instantaneous phase difference dfðtÞ is linearity proportional to the frequency deviation
dus from the mean frequency Us:
dfðtÞ ¼ Kfdus
(40)
where Kf is a constant for the VCO.
The phase detector output voltage is given by
vd ¼ KdVsVvcosðustÞcosðust þ dfÞ
(41)
¼ KdVsVv
2
½sinð2ust þ fÞ þ sinðdfÞ
(42)
The LPF suppresses the term at frequency 2us and for small modulation sinfzf such that the
output voltage
voðtÞ ¼ KdVsVvKf
2
dusðtÞ
(43)
That is, the LPF output signal is proportional to the frequency modulation. Thus, this circuit is
an FM demodulator. The ﬁlter pass band must be sufﬁciently large to accommodate the
spectrum of dus.
Sample and Zero-Order Hold Circuits
Chapter 2 introduced the concept of ideal sample and zero-order hold circuit, which is
used in discrete time digital systems. In order to understand the implementation of digital
electronics in automotive systems, it is, perhaps, worthwhile to discuss, brieﬂy, some
actual circuit conﬁgurations for practical realizations of these important system
components.
106
Chapter 3

Recall from Chapter 2 that the input (xk) to a digital system is essentially a numerical
representation in binary or binary-coded format of a sample of a continuous time voltage
variable v(t) at sample time tk:
xk ¼ vðtk; NBÞ
(44)
where NB signiﬁes an N-bit binary representation of V(tk) (i.e., see Chapter 4). This sampling
process involves two steps: 1) obtaining a voltage sample at tk and 2) converting this sample
to the N-bit numerical format. The ﬁrst step can be accomplished, in theory, via a switch that
connects the continuous time voltage to a low-loss capacitor for a sufﬁcient duration to charge
the capacitor to the voltage value v(tk).
Figure 3.21 depicts a sampler for a digital system that works in conjunction with an A/D
converter as described above. The A/D converter is explained in detail with example circuits
in Chapter 4. This ﬁgure depicts the equivalent circuit of the source being sampled including
its source impedance (assumed to be resistive) Rs as well as a very low leakage capacitor C.
The capacitor maintains voltage v(tk) sufﬁciently long to permit the A/D to complete its
conversion. In Figure 3.21a, the switch S model is
closed switch/S ¼ 1
tk  t tk þ ss
(45)
open switch/S ¼ 0
tk þ ss < t < tkþ1
The duration of the switch closure ss must be long enough for the A/D conversion to be
complete at which time an output EOC ¼ 1 (logical) indicating “end of conversion” to the
(a)
(b)
Rs
Rs
vg
vc
vc
xk
xk
S
i
i
v(t)
v(t)
Sampler with ideal switch S
Sample with FET switch
FET
C
C
A/D
A/D
EOC
N bit
EOC
Figure 3.21:
Sample circuit.
Electronics Fundamentals
107

digital system. It is assumed for convenience that the input impedance of the A/D converter is
sufﬁciently large that its input current is negligible.
During the period in which the switch is closed (at sample time tk), the source voltage supplies
current to the capacitor to change its voltage from vc ¼ v(tk1) to vc ¼ v(tk). The model for
this circuit is given by
Rsi þ vc ¼ vðtkÞ  vcðtk1Þ
tk  t  tk þ ss
i ¼ 0
tk þ ss < t  tkþ1
(46)
where
i ¼ dq
dt;
q is the charge on capacitor, and where vc ¼ q
C; C is the capacitance of capacitor:
vcðk1Þ ¼ vcðtk1 þ ssÞ
Eqn (24) can readily be rewritten in terms of vc:
RsC_vc þ vc ¼ vðtkÞ  vcðk1Þ
tk  t  tk þ ss
(47)
vcðtÞ ¼ vcðtk þ ssÞ
tk þ ss < t  tkþ1
¼ vck
where vck is ideally held constant by the capacitor until time tkþ1. Because the output
voltage of the above circuit “holds” the sample of source voltage vck for the indicated
period, it is usually called a “sample and hold” circuit. The solution to the ﬁrst-order
differential Eqn (25) is readily obtained using the Laplace transform method given in
Chapter 1:
vcðtÞ ¼ ½vðtkÞ  vcðk1Þð1  et=sÞ
tk  t  tk þ ss
(48)
¼ vck
tk þ ss < t þ tkþ1
where s ¼ RsC.
Ideally, the capacitor voltage vck should equal the sampled value of the source voltage v at
t ¼ tk. This ideal voltage is approximated by the actual voltage vck provided s << ss.
Furthermore, ss should be small compared to the time that the source changes such that
vðtk þ ssÞxvðtkÞ
In order for this latter condition to be achieved, the sample duration period ss and the system
sample period T must both be small. It was shown in Chapter 2 that the sample frequency
Fs ¼ 1/T must be greater than twice the highest frequency in v(t) to avoid aliasing errors.
108
Chapter 3

Furthermore, the sample duration must be larger than s (i.e., ss >> s) in order for the sampler
to approximate the ideal sampler performance. This latter objective requires that the
capacitance C satisﬁes the following inequality:
C << ss
Rs
In the practical sample circuit of Figure 3.21b, the switch function is implemented via an FET
whose source to drain resistance (RSD) is a function of a control voltage vg applied to the gate
of the transistor. The switching operation can be achieved a control voltage by a periodic
pulse train form as given by
vgðtÞ ¼ Vg
tk  t < tk þ ss
(49)
¼ 0
tk  ss  t < tkþ1
With vg(t) above applied to the FET gate, the source/drain resistance is given by
RSDðVgÞ ¼ Ron
ðtransistor in saturationÞ
RSDð0Þ ¼ Roff
ðtransistor in cutoffÞ
Ideally, these resistances should be
Ron ¼ 0
Roff/N
However, in practice, Roff is ﬁnite, but large, and Ron is small, but nonzero. Provided Roff is
sufﬁciently large, the model for the circuit of Figure 3.21 is given by
ðRs þ RonÞC_vc þ vc ¼ vðtkÞ  vcðk1Þ
tk  t  tk þ ss
(50)
y vðtkÞ
tk þ ss < t < tkþ1
The circuit in which the switch is implemented by the FET has the same dynamic response as
that of the ideal switch model except that the time constant s is given by
s ¼ ðRs þ RonÞC
The performance of the practical sample circuit can approach that of the ideal sample by
proper choice of circuit and system parameters.
Electronics Fundamentals
109

Zero-order hold circuit
In addition to the ideal sampler component introduced in Chapter 2, the ideal ZOH
component was shown to be required whenever a digital system output must be converted
to an analog electrical signal (e.g., to operate an analog actuator). The ZOH circuit is
similar in certain respects to the “sample and hold” circuit introduced above, in that it is
synchronous with the sampler at the system input and that it must hold a voltage between
successive sample times. In addition, it incorporates a low-leakage capacitor to “hold” the
voltage.
Figure 3.22 depicts a ZOH circuit in which the system input yk is the kth digital system
output. In the ﬁgure, the digital system (not shown) generates an output sequence {yk} in the
form of an N-bit binary “word” on a set of N-leads that are connected to the D/A converter.
The D/A converter is explained in detail (along with the schematic diagrams) in Chapter 4.
The digital control system also generates a signal that controls the D/A operation such that,
at the end of the conversion (EOC), the D/A output analog voltage uk corresponds to the
numerical value of yk. The EOC output triggers a pulse generator having output voltage vg(t)
given by
vg ¼ Vg
tk  t  tk þ ss
(51)
¼ 0
tk þ ss < t < tkþ1
The pulse duration ss must be sufﬁciently long that the capacitor voltage is approximately
(ideally) uk. Voltage vg is applied to the FET gate, which functions as a voltage-controlled
switch (as explained above with respect to the sample circuit). The sourceedrain resistance is
given by
yk
uk
u(t)
FET
C
+
+
-
-
D/A
Pulse
gen
vc
R1
EOC
S
C
R
vc
(a) ZOH circuit configuration
(b) ZOH equivalent circuit
u(t)
uk
vg
Figure 3.22:
ZOH circuit.
110
Chapter 3

RSDðVgÞ ¼ Ron
RSDð0Þ ¼ Roff
The model for the capacitor voltage vc(t) is similar to that given for the sample circuit:
ðRon þ RsÞC_vc þ vc ¼ uk  vcðk1Þ
(52)
¼ uck
tk þ ss < t < tkþ1
It is left as an exercise for the reader to ﬁnd the capacitor voltage vc(t) and show that it
is a piecewise continuous function of time that approximates the output of the ideal
ZOH of Chapter 2. The primary differences between vc(t) and uðtÞ for an ideal ZOH
are the (ideally) short intervals from t ¼ tk to t ¼ tk þ ss, during which periods the
capacitor voltage is changing. Except for the short intervals in which the capacitor
voltage is changing, uðtÞ is a stepwise continuous function of time t as depicted in
Chapter 2.
The circuit of 3.23 also incorporates an operational ampliﬁer connected as a noninverting
voltage follower having output voltage uðtÞ where
uðtÞ ¼ vcðtÞ
(53)
This op amp provides isolation of the capacitor such that any circuit, which is connected to
the ZOH output, will not place a load on vc which would otherwise cause “loading” (with
a drop in vc from its desired value).
Digital Circuits
Digital circuits, including digital computers, are formed from binary circuits. Binary digital
circuits are electronic circuits whose output can be only one of two different states. Each state
is indicated by a particular voltage or current level. Binary circuits can operate in only one of
two states (on or off) corresponding to logic 1 or 0, respectively. Digital circuits also can use
transistors. In a digital circuit, a transistor is in either one of two modes of operation: on,
conducting (at saturation), or off (in the cutoff state).
In electronic digital systems, a transistor is used as a switch. As explained above, a transistor
(either bipolar or FET) has three operating regions: cutoff, active, and saturation. If only the
saturation or cutoff regions are used, the transistor acts like a switch. When in saturation, the
transistor is on and has very low resistance; when in cutoff, it is off and has very high
resistance. In digital circuits, the input voltage to the transistor switch must be capable of
either saturating the transistor or putting it into a cutoff condition without allowing operation
Electronics Fundamentals
111

in the active region. The on condition is indicated by a very low output voltage and the off
condition is by an output voltage equal to or slightly below power supply voltage.
Figure 3.23 depicts an NPN transistor circuit conﬁguration for use in a digital circuit. In this
ﬁgure, it can be seen that no bias resistor is present since this transistor is not operated in the
linear (active) mode. Rather, the source voltage is binary valued having only two voltage
levels:
vs ¼ VHðhigh voltageÞ
¼ VLðlow voltageÞ
The operation of this type of transistor circuit can be illustrated assuming that it is a 2N4401
transistor having characteristic curves as depicted in Figure 3.12b.
In the present example, it is assumed that the low voltage VL < Vd where Vd is the
baseeemitter voltage threshold (discussed above) above which base current ﬂows. Whenever
vs ¼ VL, the base current and collector current are essentially zero. The output voltage vo is
given by
vo ¼ Vcc  icRLxVcc
(54)
It is assumed that the high voltage for this example is sufﬁcient that the base current ib is given
by
ib ¼ VH
Rs
> 600 mA amp
In this case, the output voltage is less than 0.5 V.
vo
RL
Rb
Vcc
vs
Figure 3.23:
NPN transistor digital circuit.
112
Chapter 3

The above example is presented simply as an illustration of a transistor operating in a binary
state. Actual binary voltage levels for transistor digital circuits depend upon the type of
transistor used as well as the voltage conventions for representative logical 1 or 0.
Binary Number System
Digital circuits function by representing various quantities numerically using a binary
number system or some other coded form of binary such as octal or hexadecimal numbers.
In a binary number system, all numbers are represented using only the symbols 1 (one) and
0 (zero) arranged in the form of a place position number system. Electronically, these
symbols can be represented by transistors in either saturation or cutoff. Before proceeding
with a discussion of digital circuits, it is instructive to review the binary number system
brieﬂy.
An M-bit binary number (which we denote here as N2) is represented by a set of binary digits
called bits {An ¼ 0,1} arranged as shown below (with AM the most signiﬁcant):
N2 ¼ AMAM1.AM.A1
(55)
Each bit in this M-bit binary number is a multiple of a power of 2. The decimal equivalent of
N2 is denoted N10 and is given by
N10 ¼
X
M
m¼1
Am2m1
(56)
For example, the decimal equivalent of the binary number 1010 (i.e., M ¼ 4) is given by
N10 ¼ 1  23 þ 0  22 þ 1  2 þ 0  1
¼ 8 þ 2 ¼ 10
As mentioned above, another coded number system can be formed from binary by grouping
bits to form a new base (as long as it is an integer power of 2). For example, an octal number
system is base 8 which uses octal digits such that Am ¼ 0; 1; .6; 7. In such a system, which
can be implemented by groups of three transistor switches to yield eight possible combinations
an octal number (denoted N8, with AM being the most signiﬁcant digit) is given by
N8 ¼ AM.A1
The decimal equivalent of N8 is given for an M-digit octal number by
N8 ¼
X
M
m¼1
Am8m1
(57)
Electronics Fundamentals
113

Logic Circuits (Combinatorial)
Digital computers can perform binary digit (bit) manipulations very easily by using three basic
logic circuits, which perform arithmetic or logical operations on binary numbers or logical
variables and are often euphemistically called “gates.” We begin with three basic digital gates:
the NOT, the AND, and the OR gate. Digital gates operate on logical variables that can have one
of two possible values (e.g., true/false, saturation/cutoff, or 1/0). As was previously explained,
numerical values are represented by combinations of 0 or 1 in a binary number system.
As mentioned earlier, digital circuits operate with transistors in one of two possible states e
saturation or cutoff. Since these two states can be used to represent multiple-digit binary
numbers. The input and output voltages for such digital circuits will be either “high” or “low,”
corresponding to 1 or 0. High voltage means that the voltage exceeds a high threshold value
that is denoted VH. If the voltage at the input or output of a digital circuit is denoted V, then
symbolically, the high voltage condition corresponding to logical 1 is written as
V > VH
(58)
Similarly, low voltage (corresponding to logical 0) means that voltage V is given by
V < VL
(59)
where VL denotes the low threshold value. The actual values for VH and VL depend on the
technology for implementing the circuit. Representative values are VH ¼ 2.4 V and
VL ¼ 0.8 V for bipolar transistors.
Digital circuit operation is represented in terms of logical variables that are denoted here with
uppercase letters. For example, in the next few sections A, B, and C represent logical
variables that can have a value of either 0 or 1.
NOT Gate
The NOT gate is a logic inverter. If the input is a logical 1, the output is a logical 0. If the input
is a logical 0, the output is a logical 1. It changes zeros to ones and ones to zeros. The simple
bipolar transistor circuit of Figure 3.23 performs the same function if operated from cutoff to
saturation. A high base voltage (logical 1) produces a low collector voltage (logical 0) and
vice versa. Figure 3.24a shows the schematic symbol for a NOT gate. Next to the schematic
symbol is what is called a truth table. The truth table lists all of the possible combinations of
input A and output B for the circuit. The logic symbol is shown also. The logic symbol is read
as “NOT A.” The bar over a logical variable indicates the logical inverse of the variable; that
is, if A ¼ 1, then A ¼ 0.
114
Chapter 3

AND Gate
The AND circuit effectively performs the logical conjunction operation on binary numbers or
logical conditions. The AND gate has at least two inputs and one output. The one shown in
Figure 3.24b has two inputs. The output is high (1) only when both (all) inputs are high (1). If
either or both inputs (or any) are low (0), the output is low (0). Figure 3.24b shows the truth
(a)
A
A
(overbar)
A●B = C
(Large dot)
A ● B = C
A + B = C
(Plus sign)
B
B
A
C
B
A
C
B
A
C
B
A
C
B
A
C
B
A
C
NOT
OR
NAND
NOR
AND
(b)
(c)
(d)
(e)
A
B
1
1
A
B
C
0
0
0
0
1
0
0
0
1
1
1
1
A
B
C
0
0
0
0
1
1
1
0
1
1
1
1
A
B
C
1
0
0
0
1
1
1
0
1
1
1
0
A
B
C
1
0
0
0
1
0
0
0
1
1
1
0
0
0
A + B = C
Figure 3.24:
Logic “gates.”
Electronics Fundamentals
115

Figure 3.25:
Combination logic circuit.
116
Chapter 3

table, schematic symbol, and logic symbol for this gate. The two inputs are labeled A and B.
Notice that for two inputs there are four combinations of A and B, but only one results in
a high output. In general, for N inputs, there are 2N combinations with only one having a high
(logic 1) output.
OR Gate
The OR gate, like the AND gate, has at least two inputs and one output. The one shown in
Figure 3.24c has two inputs. The output is high (1) whenever one or both (any) inputs are high
(1). The output is low (0) only when both inputs are low (0). Figure 3.24c shows the schematic
symbol, logic symbol, and truth table or the OR gate.
In addition to the AND, OR, and NOT logical circuits, there are combinations of AND and
NOT yielding the so-called NAND gate. Similarly, the combination of OR with NOT yields
the so-called NOR gate. Combining these two pairs of functions in a single circuit is often
advantageous for building up larger digital circuit subsystems or systems on a single IC.
Figures 3.24d and 3.24e depict the schematic symbols for the NAND and NOR, respectively,
along with truth tables and logical symbols.
Combination Logic Circuits
Still another important logical building block that can be build up with the three basic logic
gates is the exclusive OR denoted XOR. This circuit has logical 1 output if one and only one
of its inputs is nonzero. A two-input example is shown in Figure 3.25a. The schematic symbol
for this device is depicted on the upper left of Figure 3.25a. Its implementation using the three
basic gates is shown at the lower left. The XOR truth table and logic symbol are also given in
Figure 3.25a.
All of these gates can be used to build digital circuits that perform all of the arithmetic
functions of a calculator or computer. Table 3.1 shows the addition of two binary bits in all
the combinations that can occur. Note that in the case of adding a 1 to a 1, the sum is 0,
and a 1, called a carry, is placed in the next place value (in a place position number
sequence) so that it is added with any bits in that place value. A digital circuit designed to
perform the addition of two binary bits is called a half adder and is shown in Figure 3.25b.
Note that it incorporates an XOR gate. It produces the sum and any necessary carry, as
shown in the truth table.
Table 3.1: Addition of binary bits.
Bit A
0
0
1
1
Bit B
0
1
0
1
Sum
0
1
1
10
Electronics Fundamentals
117

A half-adder circuit does not have an input to accept a carry from a previous place value.
A circuit that does is called a full adder (Figure 3.25c). A series of full-adder circuits can be
combined to add binary numbers with as many digits as desired. Any digital computing
system from a simple electronic calculator to the largest digital computer performs all
arithmetic operations using full-adder circuits (or some equivalents) and a few additional
logic circuits. In such circuits, subtraction is performed as a modiﬁed form of addition by
using some of additional logic circuits as explained in Chapter 4. Multiplication of two 1-bit
numbers is characterized by elementary rules of multiplication:
0  0 ¼ 0
0  1 ¼ 0
1  0 ¼ 0
1  1 ¼ 1
Multiplication of an N-bit number by an M-bit number is implemented under program control
in some form of stored program computer as explained in Chapter 4.
Of course, the addition of pairs of 1-bit numbers has no major application in digital
computers. On the other hand, the addition of multiple-bit numbers is of crucial importance
in digital computers and, of course, in automotive digital control systems. The 1-bit full-
adder circuit can be expanded to form a multiple-bit-adder circuit. By way of illustration,
a 4-bit adder is shown in Figure 3.26. Here, the 4-bit numbers in place position notation are
given by
A ¼ a4a3a2a1
B ¼ b4b3b2b1
A
in
in
in
out
out
out
B C’
C
S
FA
A
B C’
C
S
FA
A
B C’
C
S
FA
A
B C’
C
S
FA
C4
S4
a4 b4
a3 b3
S3
S2
S1
a2 b2
a1 b1
Figure 3.26:
4-bit-adder circuit.
118
Chapter 3

where each bit is either 1 or 0. The sum of two 4-bit numbers has a 5-bit result, where the ﬁfth
bit is the carry from the sum of the most signiﬁcant bits. Each block labeled FA is a full adder.
The carry out (C) from a given FA is the carry in (C) of the next-highest full adder. The sum S
is denoted (in place position binary notation) by
S ¼ C4S4S3S2S1
Logic Circuits with Memory (Sequential)
The logic circuits discussed so far have been simple interconnections of the three basic gates
NOT, AND, and OR. The output of each system is determined only by the inputs present at
that time. These circuits are called combinatorial logic circuits. There is another type of logic
circuit that has a memory of previous inputs or past logic states. This type of logic circuit is
called a sequential logic circuit because the sequence of past input values and the logic states
at those times determine the present output state. Because sequential logic circuits hold or
store information even after inputs are removed, they are the basis of semiconductor computer
memories.
ReS Flip-Flop
A very simple memory circuit can be made by interconnecting two NAND gates, as in
Figure 3.27a.
A careful study of the circuit reveals that when S is high (1) and R is low (0), the output Q is
set high and remains high regardless of whether S is high or low at any later time. The high
state of S is said to be latched into the state of Q. The only way Q can be unlatched to go low is
to let R go high and S go low. This resets the latch. This type of memory device is called
a reseteset (ReS) ﬂip-ﬂop and is the basic building block of sequential logic circuits. The
term “ﬂip-ﬂop” describes the action of the logic level changes at Q. Notice from the truth
table that R and S must not be 1 at the same time. Under this condition, the two gates are
logically indeterminate and the ﬁnal state of the ﬂip-ﬂop output is uncertain.
JK Flip-Flop
A ﬂip-ﬂop where the uncertain state of simultaneous inputs on R and S is solved is shown
in Figure 3.27b. It is called a JeK ﬂip-ﬂop and can be obtained from an ReS ﬂip-ﬂop by
adding additional logic gating, as shown in the logic diagram. When both J and K inputs
are 1, the ﬂip-ﬂop changes to a state other than the one it was in. The ﬂip-ﬂop shown in
this case is a synchronized one. That means it changes state at a particular time determined
by a timing pulse, called the clock, being applied to the circuit at the terminal marked by
Electronics Fundamentals
119

a triangle. The little circle at the clock terminal means the circuit responds when the clock
goes from a high level to a low level. If the circle is not present, the circuit responds when
the clock goes from a low level to a high level. As is shown below, there are many uses at
JeK-type circuits for their equivalent implementation in computers, which operate with
a clock as explained later.
Synchronous Counter
Figure 3.28 shows a four-stage synchronous counter. It is synchronous because all stages are
triggered at the same time by the same clock pulse (Clk). It has four stages; therefore, it
counts 24 or 16 clock pulses before it returns to a starting state. The timed waveforms
appearing at each Q output are also shown. The waveforms of Figure 3.28b indicate how such
circuitry can be used for counting, for generating other timing pulses, and for determining
timed sequences.
0
J
K
0
0
1
0
1
0
1
0
1
1
1
SCHEMATIC SYMBOL
LOGIC DIAGRAM
TRUTH TABLE
Qn
tn
IN-
PUTS
OUT-
PUTS
tn + 1
Q
Qn
Qn
Q
Qn
0
S
R
0
0
1
0
1
0
1
0
1
1
1
Q0
IN-
PUTS
OUT-
PUTS
Q1
Q0
-
-
Q1
R
R
S
S
K
R
R-S
F.F.
J
K
J
Q
Q
Q
Q
S
Q
R-S Flip-Flop
JK Flip-Flop
CLOCK
CLOCK
*State is Uncertain
Subscripts: 0 Before Inputs
1 After Inputs
n = State at tn
n + 1 = next clock pulse
TRIANGLE MEANS CIRCUIT
RESPONDS AT CLOCK
CIRCLE MEANS CIRCUIT
TRIGGERS WHEN CLOCK
GOES HIGH TO LOW
Q
Q
Q
(a)
(b)
Figure 3.27:
Sequential logic circuits.
120
Chapter 3

Register Circuits
One of the most important circuits for building a computer is formed using multiple JK-type
circuits as depicted in Figure 3.29. Such circuits are known as registers. Figure 3.29 is shown
as a 4-bit device simply to explain the operation of the register. Practical register circuits used
in computers normally have many more JK-type circuits than depicted here. There are many
classes of register depending upon usage in the computer and the operation performed. These
operations include
1.
storage of data,
2.
shift right or left, and
3.
synchronous counting.
When used as a storage register or memory, the data to be shared (which, for example, might
be digital input data from a sensor and (A to D) converter), the output of a full adder, or the
CLOCK INPUT
a
1
2
3
4
5
6
7
8
9 10 11 12 13 14 15 16
QA
QB
QC
QD
QA
QB
QC
QD
CLOCK
INPUT
b
J
K
Q
Clk
A
Q
J
K
Q
Clk
B
Q
J
K
Q
Clk
C
Q
J
K
Q
Clk
D
Q
LOGIC
HIGH
Figure 3.28:
Synchronous counter circuit.
Electronics Fundamentals
121

contents of another register) are provided to the J inputs. The data A4A3A2A1 are transferred to
the corresponding Q output at the clock time. It will remain there until new data and a clock
pulse are provided to the computer.
Shift Register
Another very important circuit that is implemented with a JK type of circuit (or its functional
equivalent) is a so-called shift register. Figure 3.30a depicts a simple 4-bit shift register
Ck
A1
Q1
Q1
J1
K1
A2
Q2
J2
K2
A3
Q3
J3
K3
A4
Q4
J4
K4
Figure 3.29:
Storage register circuit example.
(a)
(b)
Clk
Q1
J1
K1
Q2
J2
K2
Q3
J3
K3
Q4
J4
K4
Clk
D
C
Q1
J1
A1
A2
A3
A4
K1
Q2
J2
K2
Q3
J3
K3
Q4
J4
K4
Figure 3.30:
4-bit shift register circuit example.
122
Chapter 3

having the capability of so-called parallel load in which all data bits are transferred
simultaneously into the corresponding ﬂip-ﬂop with control C high at the clock pulse.
This latter register has two modes of operation: 1) transfer of data (A4A3A2A1) into the register
with control C high and 2) shift right or left with control C low. The shift operation refers to
changing the position of a bit in a digital number to a higher (shift left) or lower (shift right)
position. Consider an M-bit binary number N,
N ¼ AM.Am.A1
where AM is the most signiﬁcant bit. Shift right or left is a synchronous operation, in that it is
associated with clock time tn. A shift left at time tnþ1 means that Am becomes Amþ1. Similarly
a shift right operation means that the Am bit at tn becomes Am1 at tnþ1. For the example
circuit of Figure 3.30a, the operation is a shift left. The same circuit could be made into
a shift-right operation by reversing the data order; that is, the most signiﬁcant bit (AM) is
entered into JK1, then in a decreasing order until the least signiﬁcant is loaded into JK4.
The circuit of Figure 3.30 depicts a data load operation that is said to be parallel in which all
bits are loaded synchronously. It is also possible to load the data serially in which the data bits
are entered in sequence, beginning with either the most or the least signiﬁcant bit. At each
clock cycle, the bits are shifted one position right or left depending upon circuit conﬁguration
and/or program control.
The data to be entered into this register consist of a sequence of bits Am that are synchronous
with the clock. At each clock pulse, the corresponding data bit (i.e., either a 0 or a 1) is
presented along the data line (D in Figure 3.30b). Prior to clock time tn, the previous data bit
(i.e., at clock time tn1) is stored in Q1 and that at time tn2 in Q2, etc. Each of these bits is
presented to the J input of the next ﬂip-ﬂop. The result of the circuit operation is a shift to the
next bit position for each clock pulse.
There are additional categories of shift register that perform various logical operations on
binary numbers or data depending upon how the circuit treats the least and most signiﬁcant
bits. A shift-right operation drops the A1 bit and shifts a 0 into the AM bit location. The reverse
is true for a shift-left operation.
It is also possible to connect the least and most signiﬁcant bit locations; such an operation is
termed “rotate right or left.” For a rotate-right operation, the least signiﬁcant bit at tn becomes
the most signiﬁcant bit at tnþ1. Similarly, the reverse is true for a rotate-left operation. Such
operations can be implemented either with dedicated (hard-wired) circuits or more commonly
through program-controlled switching.
Digital electronic systems send and receive signals made up of ones and zeros in the form of
codes. The digital codes represent the information that is moved through the digital systems
Electronics Fundamentals
123

by the digital circuits. Digital systems are made up of many identical logic gates and ﬂip-ﬂops
interconnected to do the function required of the system. As a result, digital circuits are ideal
for implementation in integrated circuits (ICs) because all components can be made at the
same time on a small silicon area.
Integrated Circuits
One of the important consequences of integrated circuit (IC) technology progress has been
that digital circuits have become available (in IC form) as electronic systems or subsystems;
that is, the functional capability of digital circuits in single IC packages, or chips, has
spectacularly increased in the past 40 years. One of the important digital systems that is
available as an IC is the arithmetic and logic unit (ALU).
Figure 3.31 is a sketch of a typical ALU showing the various connections. This 4-bit ALU has
the capability of performing 16 possible logical or arithmetic operations on two 4-bit inputs,
A and B. Table 3.2 summarizes these various operations using the logical notation explained
earlier in this chapter. The ALU (implemented with more than 4-bits) is an important
component of the most important single-chip IC for all digital electronic systems: the
microprocessor.
The Microprocessor
Perhaps the single most important digital IC to evolve has been the microprocessor (MPU).
This important device, incorporating hundreds of thousands of transistors in an area of about
A1
CARRY
IN
A INPUT (4 BITS)
B INPUT (4 BITS)
MODE
IN
CARRY
OUT
FUNCTION OUT
(4 BITS)
FUNCTION
SELECT
(4 BITS)
A2A3A4
B1B2B3B4
F1F2F3F4
Figure 3.31:
ALU symbol.
124
Chapter 3

¼-inch square, has truly revolutionized digital electronic system development. A
microprocessor is the operational core of a microcomputer and has broad applications in
automotive electronic systems.
The MPU incorporates a relatively complicated combination of digital circuits including an
ALU, registers, and decoding logic. A representative (though simpliﬁed) MPU block diagram
is shown in Figure 3.32. The double lines labeled “bus” are actually sets of conductors for
carrying digital data throughout the MPU. A block diagram of a microprocessor/
microcontroller with more detail is given in Chapter 4. Common IC MPUs use 8, 16, or 32 (or
higher multiples of 8) conductor buses.
Early twenty-ﬁrst-century automobiles incorporate dozens of microprocessors that are
applied for a variety of uses from advanced powertrain control to simple tasks such as
automatic seat and side-view mirror positioning. A microprocessor by itself can accomplish
nothing. It requires additional external digital circuitry as explained in the next chapter. One
of the tasks performed by the external circuitry is to provide instructions in the form of
digitally encoded electrical signals. By way of illustration, an 8-bit microprocessor operates
with 8-bit instructions. There are 28 (or 256) possible logical combinations of 8 bits,
corresponding to 256 possible MPU instructions, each causing a speciﬁc operation.
A complete summary of these operations and the corresponding instructions (called
Table 3.2: Arithmetic logic functions.
Select S
Input
Logic Function,
M [ 1
Arithmetic Function, M [ 0
Cn [ 1
Cn [ 0
0000
F ¼ A (NOT)
F ¼ A
F ¼ A Plus 1
0001
F ¼ A þ B (NOR)
F ¼ A þ B
F ¼ (A þ B) Plus 1
0010
F ¼ AB
F ¼ A þ B
F ¼ ðA þ BÞ Plus 1
0011
F ¼ 0
F ¼ Minus 1
(2’s Complement)
F ¼ 0
0100
F ¼ AB (NAND)
F ¼ A þ AB
F ¼ ðA þ ABÞ Plus 1
0101
F ¼ B (NOT)
F ¼ (A þ B) Plus AB
F ¼ (A ¼ B) Plus AB þ 1
0110
F ¼ AB þ BA (Exclusive OR)
F ¼ (A  B) Minus 1
F ¼ A Minus B
0111
F ¼ AB
F ¼ A B Minus 1
F ¼ AB
1000
F ¼ A þ B (Implication)
F ¼ A þ AB
F ¼ (A þ B) Plus 1
1001
F ¼ AB þ AB (NOT exclusive OR)
F ¼ A þ B
F ¼ (A þ B) Plus 1
1010
F ¼ B
F ¼ ðA þ BÞ Plus AB
F ¼ ðA þ BÞ Plus A þ 1
1011
F ¼ AB (AND)
F ¼ AB Minus 1
F¼ AB
1100
F ¼ 1
F ¼ A Plus A*
F ¼ (A þ A) Plus 1
1101
F ¼ A þ B
F ¼ (A þ B) Plus A
F ¼ (A þ B) Plus A þ 1
1110
F ¼ A þ B (OR)
F ¼ ðA þ BÞ Plus A
F ¼ ðA þ BÞ Plus A þ 1
1111
F ¼ A
F ¼ A Minus 1
F ¼ A
*Each bit is shifted to the next more signiﬁcant position.
Electronics Fundamentals
125

microinstructions) is beyond the scope of this book. A few of the more important instructions
are explained in the next chapter, which further expands the discussion of this important
device.
Figure 3.32:
Simpliﬁed microprocessor block diagram.
126
Chapter 3

CHAPTER 4
Microcomputer Instrumentation
and Control
Chapter Outline
Microcomputer Fundamentals
128
Digital versus Analog Computers
128
Parts of a Computer
129
Microcomputers versus Mainframe Computers
130
Programs
130
Microcomputer Tasks
131
Microcomputer Operations
132
Buses
132
Memory Read/Write
133
Timing
134
Addressing Peripherals
135
CPU Registers
135
Accumulator Register
136
Condition Code Register
136
Branching
138
Microprocessor Architecture
138
Reading Instructions
140
Initialization
141
Operation Codes
141
Program Counter
142
Branch Instruction
143
Offset example
143
Jump Instruction
144
Jump-to-Subroutine Instruction
144
Saving the program counter
145
Example Use of a Microcomputer
147
Buffer
147
Programming Languages
148
Assembly Language
148
Logic Functions
150
Shift
150
Programming the AND Function
152
Understanding Automotive Electronics. http://dx.doi.org/10.1016/B978-0-08-097097-4.00004-7
Copyright  2012 Elsevier Inc. All rights reserved.
127

Masking
153
Shift and AND
153
Use of Subroutines
153
Microcomputer Hardware
154
Central Processing Unit
154
Memory: ROM
155
Memory: RAM
156
I/O Parallel Interface
156
Digital-to-Analog Converter
156
Analog-to-Digital Converter
159
Sampling
162
Polling
162
Interrupts
163
Vectored Interrupts
163
Microcomputer Applications in Automotive Systems
164
Instrumentation Applications of Microcomputers
166
Digital Filters
168
Microcomputers in Control Systems
170
Closed-Loop Control System
171
Limit-Cycle Controller
171
Feedback Control Systems
171
Table Lookup
173
Multivariable and Multiple Task Systems
175
This chapter describes microcomputers and explains how they are used in instrumentation
and control systems. Topics include microcomputer fundamentals, microcomputer
equipment, microcomputer inputs and outputs, computerized instrumentation, and
computerized control systems. The speciﬁc automotive applications of microcomputers are
explained in later chapters.
Microcomputer Fundamentals
Digital versus Analog Computers
In digital computer-based systems, physical variables are represented by a numerical
equivalent using a form of the binary (base 2) number system. In the previous chapter, it was
shown that transistor circuits can be constructed to have one of two stable states: saturation
and cutoff. These two states can be used to represent a 0 (zero) or a 1 (one) in a binary number
system. To be practically useful, there must be groups of such circuits that are arranged in the
form of a place position, binary number system.
As will be shown in subsequent chapters, digital automotive electronic systems are
implemented with microprocessors in combination with other components to form a type of
128
Chapter 4

special-purpose digital computer (as opposed to a general-purpose computer; e.g., a laptop)
or a form of digital controller having a structure very much like a computer. The later
discussion of automotive digital systems can perhaps be best understood following a brief
discussion of digital computer technology. In any application, including automotive,
a computer performs various operations on the data. To explain the operation of a digital
computer, it is helpful ﬁrst to explain the operation of its various components.
Parts of a Computer
A few of the parts of a general-purpose digital computer are shown in Figure 4.1. This ﬁgure
is presented only as an illustration of a representative digital computer. The actual
conﬁguration of any given computer such as might be used in an automotive application is
determined by the speciﬁc tasks it is to perform. For example, an engine control computer (as
described in Chapter 7) would not include disk drive, keyboard, printer, or monitor.
The central processing unit (CPU) is the processor that is the heart of the system. When made
in an integrated circuit, it is called a microprocessor. This is where all of the arithmetic and
Figure 4.1:
General-purpose computer block diagram.
Microcomputer Instrumentation and Control
129

logic decisions are made and is the calculator part of the computer. Automotive digital
computers are implemented with one or more microprocessors. A more detailed description
of a microprocessor is given later in this chapter.
The memory holds the program and data. The computer can change the information in
memory by writing new information into memory, or it can obtain information contained in
memory by reading the information from memory. Each memory location has a unique
address that the CPU uses to ﬁnd the information it needs.
Information (or data) must be put into the computer in a form that the computer can read, and
the computer must present an output in a form that can be read by humans or used by other
computers or digital systems. The input and output devices, called I/O, perform these
conversions. In a general-purpose computer, peripherals are devices such as keyboards,
monitors, magnetic disk units, modems, and printers. The arrows on the interconnection lines
in Figure 4.1 indicate the ﬂow of data.
Microcomputers versus Mainframe Computers
With this general idea of what a computer is, it is instructive to compare a general-purpose
mainframe computer and a microcomputer. A microcomputer is just a small computer,
typically thousands of times smaller than the large, general-purpose mainframe computers
used by banks and large corporations or military or government labs. At the upper end of the
spectrum of computers are the very large scientiﬁc computers, many of which are made up of
large numbers of smaller computers operating in parallel. These large computers perform
ﬂoating point operations (FLOPS) at something of the order of a 109 FLOPS. On the other
hand, a typical automotive digital system is of the scale of a microcomputer. Depending on
feature content, a typical automobile will incorporate dozens of microcomputers. A typical
mainframe computer is capable of billions of arithmetic operations per second (additions,
subtractions, multiplications, and divisions). A microcomputer can perform several million
operations per second. As important for mathematical calculations as the speed of the
operation is the accuracy of the operation.
The precision and accuracy of calculations performed by a digital computer are functions of
the number of bits used to represent numerical values. In order to give a numerical frame of
reference, recall that an 8-bit binary number can represent 256 decimal numbers. If (as in the
case of many automotive digital systems) the number is to have a sign (i.e., þ or e), then only
numbers from e127 to 128 can be so represented.
Programs
A program is a set of instructions organized into a particular sequence to do a particular task.
The ﬁrst computers were little more than fancy calculators. They did only simple arithmetic
130
Chapter 4

and made logic decisions. They were programmed (given instructions) by punching special
codes into a paper tape that was then read by the machine and interpreted as instructions. A
program containing thousands of instructions running on an early model machine might require
yards of paper tape. The computer would process the program by reading an instruction from
the tape, performing the instruction, reading another instruction from the tape, performing the
instruction, and so on until the end of the program. Reading paper tape was a slow process
compared with the speed with which a modern computer can perform requested functions. In
addition, the tape had to be fed through the computer each time the program was run, which
was cumbersome and allowed for the possibility of the tape wearing and breaking.
To minimize the use of paper tape, and to increase computational efﬁciency, a method was
invented to store programs inside the computer. The program is read into a large electronic
memory made out of thousands of data latches (ﬂip-ﬂops), one for each bit, that provide
locations in which to store program instructions and data. Each instruction is converted to
binary numbers with a deﬁnite number of bits and stored in a memory location. Each memory
location has an address number associated with it. The computer reads the binary number
(instruction or data) stored in each memory location by going to the address of the
information called for in the instruction being processed. When the address for a particular
memory location is generated, a copy of its information is transferred to the computer.
(Depending on the instruction, the original information might stay in its location in memory
while the memory is being read.)
The computer can use some of its memory for storing programs (instructions) and other
memory for storing data. The program or data can be easily changed simply by loading in
a different program or different data. The stored program concept is fundamental to all
modern electronic computers.
Computers have memory components of two major types: 1) read-only memory (ROM) and
2) random access memory (RAM) which could also be called read/write since data/program
steps can be written (i.e., placed in memory for temporary storage) or read (obtained
electronically from the memory). In automotive computers or digital subsystems, the program
is typically stored in a ROM. Both types of memory are discussed in detail later in this
chapter.
Microcomputer Tasks
A suitably conﬁgured microcomputer can potentially perform any automotive control or
instrumentation task. For example, it will be shown in a later chapter that a microcomputer can
be conﬁgured to control fuel metering and ignition for an engine along with many other tasks.
The microcomputer-based engine control system has much greater ﬂexibility than the earliest
electronic engine control systems, which, typically, used elementary logic circuits as well as
Microcomputer Instrumentation and Control
131

analog circuits. For these early systems, changes in the performance of the control system
required changes in the circuitry (hardware). With a microcomputer performing the logic
functions, most changes can be made simply by altering certain parameters used in the
associated algorithms; that is, the software data are changed rather than the hardware (logic
circuits). This makes the microcomputer a very attractive building block in any digital system.
Microcomputers can also be used to replace analog circuitry. Special interface circuits can be
used to enable a digital computer to input and output analog signals (this will be discussed
later). The important point here is that microcomputers are excellent alternatives to hardwired
(dedicated) logic and analog circuitry that is interconnected to satisfy a particular design.
In the subsequent portions of this chapter, both the computer hardware conﬁguration and
programs (software) are discussed. Because these two aspects of computers are so strongly
interrelated, it is necessary for the following discussion to switch back and forth between the
two.
In a modern personal computer, the program instructions and data are stored electronically in
register-type circuits as described in Chapter 3. Recall that a register circuit consists of
a sequence of ﬂip-ﬂop (or similar) binary circuits. Modern register-type circuits are extremely
fast circuits having the capability of storing data that can be inserted or retrieved in a small
fraction of a microsecond during the execution of a program. In addition, programs and data
can be stored indeﬁnitely via magnetic or optical disk media.
Microcomputer Operations
Recall the basic computer block diagram of Figure 4.l. The central processing unit (CPU)
obtains data from memory (or from an input device) by generating the address for the data in
memory. The address with all its bits is stored in the CPU as a binary number in a temporary
data latch-type memory called a register (see Chapter 3). The outputs of the register are sent
at the same time over multiple wires to the computer memory and peripherals.
Buses
As shown in Figure 4.2, the group of wires that carries the address is called the address bus.
(The word bus refers to groups of wires that form a common path to and from various
components in the computer.) For example, consider a computer having an address register
32 bits; these bits enable the CPU to access 232 memory locations. In a microcomputer, each
memory location usually contains multiples of 8 bits of data. A group of 8 bits is called a byte
and a group of 16 bits is sometimes called a word.
Data are sent to the CPU over a data bus (Figure 4.2). The data bus is slightly different from
the address bus in that the CPU uses it to obtain (read) data from memory or peripherals, and
132
Chapter 4

to send (write) data to memory or peripherals. Signals on the address bus originate only at the
CPU and are sent to devices attached to the bus. Signals on the data bus can be either data to/
from memory or other registers or inputs to or outputs from the CPU that are sent or received
at the CPU by the data register. In other words, the data bus is a two-way communication bus,
while the address bus is a one-way communication bus. In addition to the address and data
bus, there are sets of or wires that are called the control bus. It is this control bus that sends the
binary signals to the components involved in any operation at the appropriate time to cause
them to perform the speciﬁc operation.
Memory Read/Write
The CPU always controls the direction of data ﬂow on the data bus because, although it is
bidirectional, data can move in only one direction at a time. The CPU provides a special read/
write control signal (Figure 4.2) that activates circuits in the memory which determine the
direction of the data ﬂow. For example, when the read/write (R/W) line is high, the CPU
transfers information from a memory location to the CPU.
The timing diagram for a memory read operation is shown in Figure 4.3.
Suppose the computer has been given the instruction to read data from memory location
number 10. To perform the read operation, the CPU raises the R/W line to the high level to
activate memory circuitry in preparation for a read operation. Almost simultaneously, the
Figure 4.2:
Computer buses.
Microcomputer Instrumentation and Control
133

address for location 10 is placed on the address bus (“address valid” in Figure 4.3). The number
10 in 16-bit binary (0000 0000 0000 1010) is sent to the memory in the address bus. The binary
electrical signals corresponding to 10 operate the speciﬁc circuits in the memory to cause the
binary data at that location to be placed on the data bus. The CPU has an internal register that is
activated during this read operation to receive and store the data. The data are then processed by
the CPU during the next cycle of operation according to the relevant instruction.
A similar operation is performed whenever the CPU is to send data from one of its internal
registers to memory, which is a “write” operation. In this case, the read/write control line will
be set at the logic level opposite to the read operation (i.e., low in this example). During the
write operation, the data to be sent are placed on the data bus at the same time the destination
address is placed on the address bus. This operation will transfer data from the CPU source
location to the destination, which could be a memory location in RAM or could be an external
device (as will be explained later).
Timing
A certain amount of time is required for the memory’s address decoder to decode which
memory location is called for by the address, and also for the selected memory location
to transfer its information to the data bus. To allow time for this decoding, the processor
institutes an appropriate time delay before receiving the information requested from the
data bus. Then, at the proper time, the CPU opens the logic gating circuitry between the
data bus and the CPU data register so that the information on the bus from memory
location (e.g., 10) is latched into the CPU. During the memory read operation, the
memory has temporary control of the data bus. Control must be returned to the CPU, but
not before the processor has read in the data. The CPU provides a timing control signal,
Figure 4.3:
Read/write timing.
134
Chapter 4

called the clock, which regulates the memory internal timing to take and release control
of the data bus.
Refer again to Figure 4.3. Notice that the read cycle is terminated when the clock goes from
high to low during the time that the read signal is valid. This is the signal generated by the
CPU at the end of the read cycle at which time the data bus can be released for other
operations.
The bus timing signals are very important for the reliable operation of the computer. However,
they are built into the design of the machine and, therefore, are under machine control. As long as
the machine performs the read and write operations correctly, the programmer can completely
ignore the details of the bus timing signals and concentrate on the logic of the program. In any
microprocessor-based electronic system, there is an oscillator running at frequency fosc that
establishes all timing operations. Typically submultiples of the master oscillator fn are obtained
via frequency division where f ¼ fosc/n (n ¼ integer). For automotive control operations, real-
timecalculationsarerequired(asexplainedlater).Thecalculationspeedfortheseoperationsisan
increasing function of fosc. Frequency division such as is required for many computer operations
is readily accomplished using sequences of JeK (or equivalent) ﬂip-ﬂop circuits (see Chapter 3).
Addressing Peripherals
The reason for distinguishing between memory locations and peripherals is that they perform
different functions. Memory is a data storage device, while peripherals are input/output
devices. However, many microcomputers address memory and peripherals in the same way
because they use a design called memory-mapped I/O (input/output). With this design,
peripherals, such as data terminals, are equivalent to memory to the CPU so that sending data
to a peripheral is as simple as writing data to a memory location. In systems where this type of
microcomputer has replaced some digital logic, the digital inputs enter the computer through
a designated memory slot. If outputs are required, they exit the computer through another
designated memory slot.
The relatively efﬁcient means of input/output of data via memory map facilitates operations
such as digital ﬁltering of sampled analog signals or for control operations as explained in
Chapter 2. In such cases, the A/D converter providing the sampled input would have a speciﬁc
memory location. Similarly, any D/A or ZOH would also have a designated memory location.
Such memory-mapped I/O is particularly helpful for speeding computer operations in
discrete time control for automotive systems.
CPU Registers
The programmer uses a different model (a programming model) of the microprocessor used
in a system compared to the hardware designer. This model shows the programmer which
Microcomputer Instrumentation and Control
135

registers in the CPU are available for program use, and what function the registers perform.
Figure 4.4 shows a programming model microprocessor for an 8-bit microcomputer.
The 8-bit example is presented solely to simplify the explanation of the operation of these
registers. In any practical computer system, these registers have many more bits. In the
example, the computer has two 8-bit registers and three 16-bit registers. The 16-bit registers
are discussed later; the 8-bit registers are discussed here.
Accumulator Register
One of the 8-bit registers is an accumulator, a general-purpose register that is used for
arithmetic and logical operations. The accumulator can be loaded with data from a memory
location, or its data can be stored in a memory location. The number held in the accumulator
can be added to, subtracted from, or compared with another number from memory. The
accumulator is the basic work register of a computer. It is commonly called the A register.
Condition Code Register
The other 8-bit register, the condition code (CC) register (also called status register),
indicates or ﬂags certain conditions that occur during accumulator operations. Rules are
Figure 4.4:
Selected CPU registers.
136
Chapter 4

established in the design of the microprocessor so that a 1 or 0 in the bit position of the CC
register represents speciﬁc conditions that have occurred in the last operation of the
accumulator. The bit positions and rules are shown in Figure 4.5a. One bit of the CC register
indicates that the A register is all zeros. Another bit, the carry bit, indicates that the last
operation performed on the accumulator caused a carry to occur. The carry bit acts like the
ninth bit of the accumulator (in this 8-bit example). Notice what happens when we add 1 to
255 in binary:
The eight bits in the accumulator are all zeros, but the carry bit being set to a 1 (high)
indicates that the result is actually not 0, but 256. Such a condition can be checked by
examining the CC register carry bit for a 1. For the following discussion, we remain with
Decimal 
Binary
255
input
11111111 
+1
add
+1 
256
sum
00000000 
carry
1 
NOT USED
SET HIGH IF A IS ZERO
SET HIGH IF CARRY OCCURS
SET HIGH IF A IS NEGATIVE
SET HIGH IF OVERFLOW OCCURS
INTERRUPT DISABLE
BRANCH IF Z IS HIGH
BRANCH IF C IS HIGH
BRANCH IF N IS HIGH
BRANCH IF O IS HIGH
BRANCH ALWAYS
(a) Bit Functions
(b) Branch Instructions
REGISTER
CC
Z
BIT
7
BIT
0
C
N
O
I
BRANCH IF Z IS LOW
BRANCH IF C IS LOW
BRANCH IF N IS LOW
BRANCH IF O IS LOW
THESE BITS 
ARE CALLED 
FLAGS
Figure 4.5:
Condition code register bits.
Microcomputer Instrumentation and Control
137

the simpliﬁed 8-bit example registers. In general, the microprocessor will operate with
N bits.
The condition code register also provides a ﬂag that, when set to a 1, indicates that the number
in the accumulator is negative. Most microcomputers use a binary format called two’s
complement notation for doing arithmetic. In two’s complement notation, the leftmost bit
indicates the sign of the number. Since one of the 8 bits (of the example) is used for the sign,
7 bits (or N  1 in general) remain to represent the magnitude of the number. The largest
positive number that can be represented in two’s complement with 8 bits is þ127 (or
2(N1)  1 for N bits, in general); the largest negative number is e128 (or 2(N1) in general).
Since the example accumulator is only 8 bits wide, it can handle only 1 byte at a time.
However, by combining bytes and operating on them one after another in time sequence (as is
done for 16-bit arithmetic), the computer can handle very large numbers or can obtain
increased accuracy in calculations. Handling bits or bytes one after another in time sequence
is called serial operation.
Branching
The CC register provides programmers with status indicators (the ﬂags) that enable them to
monitor what happens to the data as the program executes the instructions. The
microcomputer has special instructions that allow it to go to a different part of the program.
Bits of the CC register are labeled in Figure 4.5a. Typical branch-type instructions are shown
in Figure 4.5b.
Program branches are either conditional or unconditional. Eight of the nine branch
instructions listed in Figure 4.5b are conditional branches; that is to say, the branch is taken
only if certain conditions are met. These conditions are indicated by the CC register bit as
shown. The branch-always instruction is the only unconditional branch. Such a branch is used
to branch around the next instruction to a later instruction or to return to an earlier instruction.
Another type of branch instruction that takes the computer out of its normal program
sequence is indicated for the I-bit of the CC register. It is associated with an interrupt. An
interrupt is a request, usually from an input or output (I/O) peripheral, that the CPU stops its
present operation and accepts or takes care of (service) the special request. There will be more
about interrupts later in this chapter.
Microprocessor Architecture
The central component that controls and performs all operations in any microcomputer is the
microprocessor, which is made up of many electronic subsystems all implemented in a single
integrated circuit. As described in Chapter 3, a microprocessor consists of hundreds of
thousands of transistors (on a single silicon chip) that are grouped together and interconnected
to form the various subsystems, all of which are interconnected with internal address, data,
and control buses.
138
Chapter 4

Figure 4.6 is a block diagram of a representative (simpliﬁed to 8 bits) commercial
microprocessor such as has been used in legacy automotive digital electronic system. The
silicon chip on which the microprocessor is fabricated is mounted in a housing (usually
a plastic structure) and connected to external pins that enable the microprocessor to be
Figure 4.6:
Simpliﬁed microprocessor block diagram.
Microcomputer Instrumentation and Control
139

connected to the microcomputer. The connections to the external circuitry are depicted and
labeled in Figure 4.6 and include address and data buses. In addition, external connections are
made to an oscillator (clock) as well as inputs and outputs: interrupt, ready (rdy), read/write
control (R/W), and data bus enable (DBE), the operation of which is explained later in this
chapter.
This block diagram is divided into two main portions e a register section and a control
section. The actual operations performed by the microprocessor are accomplished in the
register section. The speciﬁc operations performed during the execution of a given step in the
program are controlled by electrical signals from the instruction decoder.
During each program step, an instruction in the form of an 8 or more bit binary number is
transferred from memory to the instruction register. This instruction is decoded using logic
circuits similar to those presented in Chapter 3. The result of this decoding process is a set of
electrical control signals that are sent to the speciﬁc components of the register section that
are involved in the instruction being executed.
The data upon which the operation is performed are similarly transferred from memory to the
data bus buffer. From this buffer the data are then transferred to the desired component in the
register section for execution of the operation.
Note that an arithmetic and logic unit (ALU) is included in the register section of a simpliﬁed,
representative microprocessor as shown in Figure 4.6. This device is a complex circuit
capable of performing the arithmetic and logical operations, as explained in Chapter 3. Also
included in the register section is the accumulator, which is the register used most frequently
to receive the results of arithmetic or logical operation. In addition, the example
microprocessor register section has an index register, stack pointer register, and program
counter register. The program counter register holds the contents of the program counter and
is connected through the internal address bus to the address buffer register. The address bus
for the example microprocessor has 16 lines, and thereby can directly address 65,536 (i.e.,
64 K) of memory. It should be emphasized that the microprocessor components and
organization presented above are merely representative of this class of devices. There are
many potential variations on the architecture shown as well as the number of bits associated
with instructions and data. However, at the highest level of abstraction, the above description
and architecture serve to illustrate any microprocessor that might be used in automotive
applications.
Reading Instructions
In the following sections of this chapter, the operation of a computer or microcomputer
such as is found in modern automobiles is explained. The operation of any digital
computer is fully controlled by the program. For automotive control applications, the
140
Chapter 4

controlling program must be efﬁcient in order to perform its various tasks at a rate which
is compatible with the speed of operations of the external sensors, actuators, and
switches. As explained below, each instruction is in the form of a string of binary
characters similar to data. For illustrative purposes only, we assume all data and
instructions are 8 bits wide.
To understand how the computer performs its functions, one must ﬁrst understand how the
computer obtains program instructions from memory. Recall that program instructions are
stored sequentially (step by step) in memory as binary numbers, starting at a certain binary
address and ending at some higher address. The computer uses a register called the program
counter (Figure 4.4) to keep track of where it is in the program.
Initialization
To start the computer, a small startup (boot) program that is permanently stored in the
computer (in a ROM) is run. This program sets all of the CPU registers with the correct
values and clears all information in the computer memory to zeros before the operations
program is loaded. This is called initializing the system. Then, the operations program is
loaded into memory, at which point the address of the ﬁrst program instruction is loaded into
the program counter. The ﬁrst instruction is read from the memory location whose address is
contained in the program counter register; that is, the 16 bits in the exemplary program
counter are used as the address for a memory-read operation. Each instruction is read from
memory in sequence and placed on the data bus into the instruction register, where it is
decoded. The instruction register is another temporary storage register inside the CPU (or
microprocessor). It is connected to the data bus when the information on the bus is an
instruction.
Operation Codes
Numeric codes called operation codes (or op codes for short) contain the instructions that
represent the actual operation to be performed by the CPU. The block diagram of Figure 4.7,
which illustrates part of the CPU hardware organization, should help clarify the ﬂow of
instructions through the CPU.
The instruction register has a part that contains the numeric op codes. A decoder determines
from the op codes the operation to be executed, and a data register controls the ﬂow of data
inside the CPU as a result of the op code instructions.
One important function of the op-code decoder is to determine how many bytes must be read
to execute each instruction. Many instructions require two or three bytes. Figure 4.8 shows the
arrangement of the bytes in an instruction. The ﬁrst byte contains the op code. The second
byte contains address information, usually the lowest or least signiﬁcant byte of the address.
Microcomputer Instrumentation and Control
141

Program Counter
The program counter is used by the CPU to address memory locations that contain
instructions. Every time an op code is read (this is often called fetched) from memory, the
program counter is incremented (advanced by one) so that it points to (i.e., contains the
address of) the next byte following the op code. If the operation code requires another byte,
the program counter supplies the address, the second byte is fetched from memory, and the
program counter is incremented. Each time the CPU performs a fetch operation, the program
counter is incremented; thus, the program counter always contains the address of the next
byte in the program. Therefore, after all bytes required for one complete instruction have been
read, the program counter contains the address for the beginning of the next instruction to be
executed.
Figure 4.7:
Instruction decode subsystem.
142
Chapter 4

Branch Instruction
In any practical computer program, there is normally the need to change the sequence of
instructions as a result of some logical condition being met. An instruction of this type is
called a branch instruction. All of the branch instructions require two bytes. The ﬁrst byte
holds the operation code, and the second byte holds the location to which the processor is to
branch.
Now, if the address information associated with a branch instruction is only 8 bits long and
totally contained in the second byte, it cannot be the actual branch address. In this case, the
code contained in the second byte is actually a two’s complement number that the CPU adds
to the lower byte of the program counter to determine the actual new address. This number in
the second byte of the branch instruction is called an address offset or just offset. Recall that in
two’s complement notation, the 8-bit number can be either positive or negative; therefore, the
branch address offset can be positive or negative. A positive branch offset causes a branch
forward to a higher memory location. A negative branch offset causes a branch to a lower
memory location. Since 8 bits are used in the present example, the largest forward branch is
127 memory locations and the largest backward branch is 128 memory locations.
Offset example
Suppose the program counter is at address 5122 and the instruction at this location is a branch
instruction. The instruction to which the branch is to be made is located at memory address
5218. Since the second byte of the branch instruction is only 8 bits wide, the actual address
5218 cannot be contained therein. Therefore, the difference or offset (96) between the current
program counter value (5122) and the desired new address (5218) is contained in the second
byte of the branch instruction. The offset value (96) is added to the address in the program
counter (5122) to obtain the new address (5218), which is then placed on the address bus. The
binary computation of the ﬁnal address from the program counter value and second byte of
the branch instruction is shown in Figure 4.9.
Figure 4.8:
Instruction decode bytes.
Microcomputer Instrumentation and Control
143

Jump Instruction
Branch instructions have a range of þ127 or e128 (in the present 8-bit example). If the
branch needs to go beyond this range, a jump instruction must be used. The jump instruction
is a 3-byte instruction. The ﬁrst byte is the jump op code, and the next two bytes are the actual
jump address. The CPU loads the jump address directly into the program counter, and the
program counter is effectively restarted at the new jump location. The CPU continues to fetch
and execute instructions in exactly the same way it did before the jump was made.
The jump instruction causes the CPU to jump out of one section of the program into another.
The CPU cannot automatically return to the ﬁrst section because no record was kept of the
previous location. However, another instruction, the jump to subroutine, does leave a record
of the previous instruction address.
Jump-to-Subroutine Instruction
A subroutine is a short program that is used by the main program to perform a speciﬁc
function. Its use in programming is explained in a later section of this chapter. It is located in
sequential memory locations separated from the main program sequence. If the main program
requires some function such as multiplication several times at widely separated places within
the program, the programmer can write one subroutine to perform the multiplication and then
have the main program jump to the memory locations containing the subroutine each time it is
needed. This saves the task of having to rewrite the multiplication program repeatedly. To
perform the multiplication, the programmer simply includes instructions in the main program
that ﬁrst load the numbers to be multiplied into the data memory locations used by the
subroutine and then jump to the subroutine.
RefertoFigure4.10tofollowthesequence.Itbeginswiththeprogramcounterholdingtoaddress
location 100, where it gets the jump-to-subroutine instruction (step 1). Each jump-to-subroutine
Figure 4.9:
Program counter offset.
144
Chapter 4

instruction (step 2) requires that the next two bytes must also be read to obtain the jump address
(step 2a). Therefore, the program counter is incremented once for each byte (steps 3 and 4) and
the jump address is loaded into the address register. The program counter is then incremented
once more so that it points to the op-code byte of the next instruction (step 5).
Saving the program counter
The contents of the program counter are saved by storing them in a special memory location
before the jump address is loaded into the program counter. This program counter address is
saved so that it can be returned to in the main program when the subroutine is ﬁnished. This is
the record that was mentioned before.
Now refer back to Figure 4.4. There is a register in Figure 4.4 called the stack pointer (SP).
The address of the special memory location used to store the program counter content is kept
in this 16-bit stack pointer register. When a jump-to-subroutine op code is encountered, the
CPU uses the number code contained in the stack pointer as a memory address to store the
Figure 4.10:
Jump-to-subroutine sequence.
Microcomputer Instrumentation and Control
145

program counter to memory (step 2b of Figure 4.10). The program counter is a 2-byte register,
so it must be stored in two memory locations (in the present example). The current stack
pointer is used as an address to store the lower byte of the program counter to memory
(step 6). Then the stack pointer is decremented (decreased by one) and the high byte of the
program counter is stored in the next lower memory location (step 7). The stack pointer is
then decremented again to point to the next unused byte in the stack to prepare for storing the
program counter again when required (step 8). The special memory locations pointed to by
the stack pointer are called stacks.
After the program counter has been incremented and saved, the jump address is loaded into the
program counter (step 9). The jump to the subroutine is made, and the CPU starts running the
subroutine (step 10). The only thing that distinguishes the subroutine from another part
of the program is the way in which it ends. When a subroutine has run to completion, it must
allow the CPU to return to the point in the main program from which the jump occurred. In this
way, the main program can continuewithout missing a step. The return-from-subroutine (RTS)
instruction is used to accomplish this. It is decoded by the instruction register, and increments
the stack pointer as shown in Figure 4.11, step 1. It uses the stack pointer to address the stack
memory to retrieve the old program counter value from the stack (steps 2 and 4). The old
Figure 4.11:
Return-from-subroutine steps.
146
Chapter 4

program counter value is loaded into the program counter register (steps 3 and 5), and
execution resumes in the main program (step 6). The return-from-subroutine instruction works
like the jump-to-subroutine instruction, except in reverse.
Example Use of a Microcomputer
Let us look at an example of how a microcomputer might be used to replace some digital
logic, and along the way learn about some more microcomputer instructions. The digital logic
to be replaced in this example is a simple AND gate circuit. Now, no one would use
a microcomputer to replace only an AND gate, because an AND gate costs a fraction of what
a microcomputer costs. However, if the system already has a microcomputer in it, the cost of
the AND gate could be eliminated by performing the logical AND function in the computer
rather than with the gate.
Suppose there are two signals that must be ANDed together to produce a third signal. One of
the input signals comes from a pressure switch located under the driver’s seat of an
automobile; its purpose is to indicate whether someone is occupying the seat. This signal will
be called A, and it is at logical high when someone is sitting in the seat. Signal B is developed
within a circuit contained in the seat belt and is at logical high when the driver’s seat belt is
fastened. The output of the AND gate is signal C. It will be at logical high when someone is
sitting in the driver’s seat and has the seat belt fastened.
Buffer
In order to use a microcomputer to replace the AND gate, the computer must be able to detect
the status of each signal. The microcomputer used here has the so-called memory-mapped I/O
(as explained earlier in this chapter), in which peripherals are treated exactly like memory
locations. The task is to provide a peripheral that allows the computer to look at the switch
signals as if they were bits in a memory location. This can be done easily by using a device
called a buffer (Figure 4.12). To the microcomputer, a buffer looks just like an 8-bit memory
slot at a selected memory location. The 8 bits in the memory slot correspond to 8 digital signal
inputs to the buffer. Each digital input controls the state of a single bit in the memory slot. The
digital inputs are gated into the buffer under control of the CPU. The microcomputer can
detect the state of the digital inputs by examining the bits in the buffer any time after the
inputs are gated into the buffer.
In this application, signal A will be assigned to the rightmost bit (bit 0) and signal B to the
next bit (bit 1). It does not matter that the other 6 bits are left unconnected. The computer will
gate in and read the state of those lines, but the program will be written to purposely ignore
them. With the logic signals interfaced to the microcomputer, a program can be written that
will perform the required logic function.
Microcomputer Instrumentation and Control
147

Programming Languages
Before writing a program, one must know the code or language in which the program is to be
written. Computer languages come in various levels, including high-level language such as
Cþþ. A program written in a high-level language such as Cþþ is essentially independent of
the individual hardware on which it is to be run. However, to be useful on any given computer,
it must be converted to a language that is speciﬁc to that hardware through use of a program
known as a compiler. The compiler converts the high-level language to a so-called machine
language. An assembly language is designed for a speciﬁc microprocessor. A typical
assembly-language program consists of a sequence of instructions as explained below that are
highly mnemonic to an English word. Machine language is the actual language in which
a program is stored in memory in a binary or binary-coded format. For the present example,
we choose the intermediate-level language (assembly language) to illustrate speciﬁc CPU
operations.
Assembly Language
Assembly language is a special type of abbreviated language, each symbol of which pertains
to a speciﬁc microprocessor operation. Some assembly-language instructions, such as branch,
jump, jump to subroutine, and return from subroutine, have already been discussed. Others
will be discussed as they are needed to execute an example program. Assembly-language
Figure 4.12:
Buffer conﬁguration.
148
Chapter 4

instructions have the form of initials or shortened (so-called mnemonics) words that represent
microcomputer functions. These abbreviations are only for the convenience of the
programmer because the program that the microcomputer eventually runs must be in the form
of binary numbers. When each instruction is converted to the binary code that the
microcomputer recognizes, it is called a machine language program.
Table 4.1 shows the assembly-language equivalents for typical microcomputer instructions,
along with a detailed description of the operation called for by the instruction. When writing
a microcomputer program, it is easier and faster to use the abbreviated name rather than the
complete function name. Assembly language simpliﬁes programming tasks for the computer
programmer because the abbreviations are easier to remember and write than the binary
Table 4.1: Assembly-language mnemonics.
Mnemonic
Operand
Comment
a. Program Transfer Instructions
JMP
(Address)
Jump to new program location
JSR
(Address)
Jump to a subroutine
BRA
(Offset)
Branch using the offset
BEQ
(Offset)
Branch if accumulator is zero
BNE
(Offset)
Branch if accumulator is nonzero
BCC
(Offset)
Branch if carry bit is zero
BCS
(Offset)
Branch if carry bit is nonzero
BPL
(Offset)
Branch if minus bit is zero
BMI
(Offset)
Branch if minus bit is nonzero
RTS
Return from a subroutine
b. Data Transfer Instructions
LDA
(Address)
Load accumulator from memory
STA
(Address)
Store accumulator to memory
LDA
# (Constant)
Load accumulator with constant
LDS
# (Constant)
Load stack pointer with constant
STS
(Address)
Store stack pointer to memory
c. Arithmetic and Logical Operations
COM
Complement accumulator (NOT)
AND
(Address)
AND accumulator with memory
OR
(Address)
OR accumulator with memory
ADD
(Address)
Add accumulator with memory
SUB
(Address)
Subtract accumulator with memory
AND
# (Constant)
AND accumulator with constant
OR
# (Constant)
OR accumulator with constant
SLL
Shift accumulator left logical
SRL
Shift accumulator right logical
ROL
Rotate accumulator left
ROR
Rotate accumulator right
Microcomputer Instrumentation and Control
149

numbers the computer uses. However, the program eventually must be converted to the binary
codes that the microcomputer recognizes as instructions, which is done by a special program
called an assembler. The assembler program is run on the computer to convert assembly
language to binary codes. This enables the programmer to write the program using words that
have meaning to the programmer and also to produce machine codes that the computer can use.
Logic Functions
Microprocessors are capable of performing all of the basic logic functions such as AND, OR,
NOT, and combinations of these. For instance, the NOT operation can affect the accumulator
by changing all ones to zeros and zeros to ones. Other logic functions are performed by using
the contents of the accumulator and some memory location. All eight bits of the accumulator
are affected, and all are changed at the same time. As shown in Figure 4.13, the AND
operation requires two inputs. One input is the contents of the accumulator and the other input
is the contents of a memory location; thus, the eight accumulator bits are ANDed with the
eight memory bits. The AND operation is performed on a bit-by-bit basis. For instance, bit
0 of the accumulator (the rightmost bit) is ANDed with bit 0 of the memory location, bit 1
with bit 1, bit 2 with bit 2, and so on. In other words, the AND operation is performed as if
eight AND gates were connected with one input to a bit in the accumulator, and with the other
input to a bit (in the same position) in the memory location. The resulting AND outputs are
stored back into the accumulator in the corresponding bit positions. The OR logic function is
performed in exactly the same way as the AND except that a 1 would be produced at the
output if signal A or signal B were a 1, or if both were a 1 (i.e., using OR logic).
Shift
Instead of the AND gate inputs being switched to each bit position as shown in
Figure 4.13, the microcomputer uses a special type of sequential logic operation, the shift,
Figure 4.13:
AND logic illustration.
150
Chapter 4

to move the bits to the AND gate inputs. A type of register that is capable of such shift
operations was discussed in Chapter 3 and is called a shift register. A shift operation
causes every bit in the accumulator to be shifted one bit position either to the right or to
the left. It can be what is called a logical shift or it can be a circulating shift. Figure 4.14
shows the four types of shifts (logical, circulating, right, and left) and their effects on the
accumulator. In a left shift, bit 7 (the leftmost bit) is shifted into the carry bit of the CC
register, bit 6 is shifted into bit 7, and so on until each bit has been shifted once to the left.
Bit 0 (the rightmost bit) can be replaced either by the carry bit or by a zero, depending on
the type of shift performed. Depending on the microprocessor, it is possible to shift other
registers as well as the accumulator.
Figure 4.14:
Shift register operations.
Microcomputer Instrumentation and Control
151

Programming the AND Function
It is the task of the programmer to choose instructions and organize them in such a way that
the computer performs the desired tasks. To program the AND function, one of the
instructions will be the AND, which stands for “AND accumulator with contents of a speciﬁc
memory location,” as shown in Table 4.1c. Since the AND affects the accumulator and
memory, values must be put into the accumulator to be ANDed. This requires the load
accumulator instruction, LDA.
The assembly-language program of Figure 4.15 performs the required AND function. The
programmer must ﬁrst know which memory location the digital buffer interface (Figure 4.12)
occupies. This location is identiﬁed, and the programmer writes instructions in the assembler
program so that the buffer memory location will be referred to by the label or name SEAT.
The mnemonic SEAT is easier for the programmer to remember and write than the address of
the buffer.
The operation of the program is as follows. The accumulator is loaded with the contents of the
memory location SEAT. Note in Figure 4.12 that the two digital logic input signals, A and B,
have been gated into bits 0 and 1, respectively, of the buffer that occupies the memory
location labeled SEAT. Bit 0 is high when someone is sitting in the driver’s seat. Bit 1 is high
when the driver’s seat belt is fastened. Only these two bits are to be ANDed together; the other
six are to be ignored. But there is a problem because both bits are in the same 8-bit byte and
there is no single instruction to AND bits in the same byte. However, the two bits can be
effectively separated by using a mask.
Figure 4.15:
Assembly language AND subroutine.
152
Chapter 4

Masking
Masking is a technique used to allow only selected bits to be involved in a desired operation.
Since the buffer contents have been loaded into the accumulator, only bits 0 and 1 have
meaning, and these two bits are the only ones of importance that are to be kept in the
accumulator. To do this, the accumulator is ANDed with a constant that has a zero in every bit
location except the one that is to be saved. The binary constant in line 2 of Figure 4.15a
(00000001) is chosen to select bit 0 and set all others to zero as the AND instruction is
executed. The ANDing procedure is called masking because a mask has been placed over the
accumulator that allows only bit 0 to come through unchanged. If bit 0 was a logical 1, it is
still a logical 1 after masking. If bit 0 was a logical 0, it is still a logical 0. All other bits in the
accumulator now contain the correct bit information about bit 0.
Shift and AND
In our example program, the accumulator is still not ready to perform the ﬁnal AND
operation. Remember that SEAT contains the contents of the buffer and the conditions of
signal A and signal B. The contents of the accumulator must be ANDed with SEAT so that
signals A and B are ANDed together. A copy of signal A is held in the accumulator in bit 0,
but it is in the wrong bit position to be ANDed with signal B in SEAT in the bit 1 position.
Therefore, signal A must be shifted into the bit 1 position. To do this, the shift left logical
instruction is used (Figure 4.14a). With signal A in bit 1 of the accumulator and signal B in bit
1 of SEAT, the AND operation can be performed on the two bits. If both A and B are high, the
AND operation will leave bit 1 of the accumulator high (1). If either is low, bit 1 of the
accumulator will be low (0).
Use of Subroutines
The previous example program has been written as a subroutine named CHECK so that it can
be used at many different places in a larger program. For instance, if the computer is
controlling the speed of the automobile, it might be desirable to be able to detect whether
a driver is properly fastened in the seat before it sets the speed at 55 miles per hour.
Since the driver’s seat information is very important, the main program must wait until the
driver is ready before allowing anything else to happen. A program such as that shown in
Figure 4.15b can be used to do this. The main program calls the subroutine WAIT, which in
turn immediately calls the subroutine CHECK. CHECK returns to WAIT with the condition
codes set as they were after the last AND instruction. The Z bit (see Figure 4.5a) is set if A and
B are not both high (the accumulator is zero). The BEQ instruction (see Table 4.1) in line 2 of
WAIT branches back because the accumulator is zero and causes the computer to re-execute
the JSR instruction in line 1 of WAIT. This effectively holds the computer in a loop,
rechecking signals A and B until the accumulator has a nonzero value (A and B are high).
Microcomputer Instrumentation and Control
153

In automotive electronic systems for control or instrumentation, there are many subroutines
that are called repeatedly. Among those is the routine for multiplication (as well as for
division). The algorithm on which the subroutine is based is derived from the fundamental
multiplication of a pair of bits:
The product of a binary multiplicand A by a binary multiplier B yields binary result C. It is
perhaps instructive to illustratewith an example in which A ¼ 13 (decimal) and B ¼ 2 (decimal):
In obtaining this result for each bit in the multiplier, the multiplicand is either copied (i.e.,
multiplied by 1) if the multiplier bit is a 1 or replaced by all 0’s (i.e., multiplication by 0) and
shifted to the left by the position of the bit in the multiplier. After performing this operation
for each multiplier bit, the results are summed according to the rules of binary addition.
Microcomputer Hardware
The microcomputer system electronic components are known as computer hardware. (The
programs that the computer runs are called software.) The basic microcomputer parts are the
CPU, memory, and I/O (input and output peripherals). We next expand upon this discussion of
important components and their associated operations.
Central Processing Unit
The central processing unit is a microprocessor. It is an integrated circuit similar to the one
shown in Figure 4.16a. It contains thousands of transistors and diodes on a chip of silicon
small enough to ﬁt on the tip of a ﬁnger. It includes some form of arithmetic logic unit (ALU),
as well as registers for data and instruction storage and a control section. The chip is housed in
(13 decimal)
A = 1101
(2 decimal)
B = 10
A
1 1 0 1
B
×    1 0 
0
0
0
0
+ 1 1 0 1
C
1 1 0 1 0
(26 decimal) 
0  0 ¼ 0
1  0 ¼ 0
0  1 ¼ 0
1  1 ¼ 1
154
Chapter 4

a rectangular, ﬂat package similar to the one shown in Figure 4.16b. Newer versions of
a microprocessor are packed in a ﬂat package that has pins all the way around the periphery
such that the IC can be attached to the surface of a printed circuit board (known as surface-
mounted ICs). The CPU gets program instructions from a memory device.
Memory: ROM
There are several types of memory devices available, and each has its own special
features. Systems such as those found in the automobile that must permanently store their
programs use a type of permanent memory called read-only memory (ROM). This type of
memory can be programmed only one time and the program is stored permanently, even
when the microcomputer power is turned off. The programs stored in ROM are
sometimes called ﬁrmware rather than software since they are unchangeable. This type of
memory enables the microcomputer to immediately begin running its program as soon as
it is turned on.
Several types of ROM can be used in any microcomputer, including those found in
automotive digital systems. For program storage, a ROM is used that is not alterable. The
program and data storage are determined by physical conﬁguration during manufacturing.
In certain cases, it may be desirable to modify certain parameters. For example, in
Figure 4.16:
Photograph of exemplary IC chip
Microcomputer Instrumentation and Control
155

automotive applications it may be desirable to permit authorized persons to modify a control
system parameter of a vehicle after it has been in operation for some time to improve system
performance. In this case, it must be possible to modify data (parameters) stored in ROM.
Such modiﬁcation is possible in a ROM that can be electrically erased and reprogrammed.
This type of ROM is termed EEPROM (electrically erasable, programmable read-only-
memory). In principle, of course, it is theoretically possible to have the ROM or a portion of
it stored on a removable chip. New parameters can be installed by simply replacing this
chip.
Memory: RAM
Another type of memory, one that can be written to as well as read from, is required for the
program stack, data storage, and program variables. This type of memory is called random
access memory (RAM). This is really not a good name to distinguish this type of memory
from ROM because ROM is also a random access type of memory. Random access means the
memory locations can be accessed in any order rather than in a particular sequence. A better
name for the data storage memory would be read/write memory (RWM). However, the term
RAM is commonly used to indicate a read/write memory, so that is what will be used here.
A typical microcomputer contains both ROM- and RAM-type memory.
It is beyond the scope of this book to discuss the detailed circuitry of all types of memory
circuits. However, one example of a type of circuit that can be used for memory is the register
circuit, which is implemented with ﬂip-ﬂop circuits as described in Chapter 3.
I/O Parallel Interface
Microcomputers require interface devices that enable them to communicate with other
systems. The digital buffer interface used in the driver’s seat application discussed earlier is
one such device. The digital buffer interface is an example of a parallel interface because the
eight buffer lines are all sampled at one time, that is, in parallel. The parallel buffer interface
in the driver’s seat application is an input, or readable, interface. Output, or writable,
interfaces allow the microcomputer to affect external logic systems. An output buffer must be
implemented using a data latch so that the binary output is retained after the microcomputer
has ﬁnished writing data into it. This permits the CPU to go on to other tasks while the
external system reads and uses the output data. This is different from the parallel input, in
which the states could change between samples.
Digital-to-Analog Converter
The parallel input and output interfaces are used to monitor and control external digital
signals. As explained in Chapter 2, the microcomputer can also be used to measure and
156
Chapter 4

control analog signals through the use of special interfaces. The microcomputer can produce
an analog voltage by using a digital-to-analog converter (D/A converter). A D/A converter
accepts inputs from the digital system of a certain number of binary bits and produces an
output voltage level that is proportional to the input number and may incorporate a zero-order
hold (ZOH; see Chapter 3). D/A converters come in many different versions with different
numbers of input bits and output ranges. A representative example microcomputer D/A
converter has 8-bit inputs and a 0e5 V output range.
A simple ideal 8-bit D/A converter is shown in Figure 4.17. This type of D/A converter uses
a parallel input interface and two operational ampliﬁers.
The 8 bits are written into the parallel interface and stored in data latches (e.g., JeK ﬂip-ﬂop
as explained in Chapter 3). For the purposes of explaining the operation of this simpliﬁed
Figure 4.17:
Simpliﬁed D/A conﬁguration.
Microcomputer Instrumentation and Control
157

example D/A converter, it is assumed that the parallel interface includes output circuitry
associated with each data bit latch such that
Dn ¼ 5 V if An ¼ 1
n ¼ 1; 2; .N
¼ 0 V if An ¼ 0
(1)
where An ¼ nth bit of the 8-bit input digital data where A8 is the MSB. In this example, the
output of each latch is a digital signal that is ideally 0 V if the bit is low and 5 V if the bit is
high. The ﬁrst op amp is an inverting mode summing ampliﬁer for which the gain for input n
is given by e (R/Rs(n)).
The source resistance for the nth data bit is given by
RsðnÞ ¼ 2Nnþ1R
n ¼ 1; 2; .N
(2)
where, for the present 8-bit example, N ¼ 8. The output voltage of the ﬁrst op amp circuit V1
(in accordance with the discussion of summing op amp circuits of Chapter 3) is given by
V1 ¼ 
X
N
n¼1
Dn
2Nnþ1
(3)
¼  5
2N
X
N
n¼1
An2n1
(4)
¼  5
2NN10
(5)
where N10 is the decimal numerical value of the input digital data.
The second op amp has a closed-loop gain of
Ac[ ¼ Rf =R
(6)
The output voltage of this 2nd op amp is given by
Vout ¼ 5Rf
2NRN10
(7)
¼ KDAN10
(8)
where KDA is the scale factor for the D/A converter. The effect of the two ampliﬁers is to
scale each bit of the parallel interface by a specially chosen factor and add the resultant
158
Chapter 4

voltages together such that the D/A converter output voltage (Vout) is proportional to the
decimal equivalent of the input binary data. The scale factor is chosen by the system
designer to be compatible with the voltage requirements of the component (e.g., actuator)
to which the D/A is converted. Typically, in control applications, the D/A converter
output is connected to a ZOH before the converted voltage is sent to the actuator
(see Chapter 2).
The D/A converter output voltage can change only when the computer writes a new
number into the D/A converter data latches. As explained in Chapter 2, in control
applications, the D/A converter ZOH combination is synchronized to the sampler, which
samples the input to the control system. The computer must generate each new output
often enough to ensure an accurate representation of the changes in the digital signal.
The analog output of the D/A converter can take only a speciﬁc number of different
values and can change only at speciﬁc times determined by the sampling rate. The output
of the converter will always have small discrete step changes (resolution). The resolution
of the representation of the A/D output varies in proportion to the number N of bits.
The designer must decide how small the steps must be to produce the desired shape and
smoothness in the analog signal so that it is a reasonable duplication of the variations in
the digital levels. The smoothness of the D/A output voltage can be improved by ﬁltering,
although care must be exercised in the ﬁlter design to prevent waveform distortion and
phase delay.
Analog-to-Digital Converter
In addition, microcomputers can measure analog voltages by using a special interface
component called an analog-to-digital A/D converter. Analog-to-digital converters convert an
analog voltage input into a digital number output that the microcomputer can read.
Figure 4.18 shows a conceptually simple hypothetical, but not necessarily optimal, way of
making an A/D converter by using a D/A converter and a voltage comparator. Control of the
A/D circuitry is exercised by the computer via output logic variables “reset” and convert C
and input logic variable EOC as shown in Figure 4.18.
At the sample time (tk), the analog-to-digital conversion process begins under computer
control with several operations. The computer sends a sample trigger signal to the sample and
hold circuit causing it to sample vin at the sample time tk. The computer also generates
a signal that resets the counter to zero and then sends a signal C to the JeK ﬂip-ﬂop circuit
that enables the AND gate such that the counter begins counting clock pulses (generated by
the computer timing circuitry). The D/A converter output voltage changes in discrete steps at
each clock pulse. This causes the analog output voltage to have a staircase appearance as the
binary number at the input is increased one bit at a time from minimum value to maximum
value, as shown in Figure 4.19.
Microcomputer Instrumentation and Control
159

This example 8-bit D/A converter can have any one of 256 different voltage levels. For many
applications, this is a close-enough approximation to a continuous analog ramp signal. The
counter contents at time t are the binary equivalent of N where N is the largest integer in the
following:
N ¼ fPfcðtN  tkÞRg
tN  t < tNþ1
(9)
sample
&
hold
computer
comparator
binary
counter
reset
D/A
sample trigger
reset
EOC
P
C
J
Q
K
in
Ck
vk
vr
vin
tk
Figure 4.18:
Example A/D converter.
Figure 4.19:
Digital ramp waveform.
160
Chapter 4

The ramp voltage vr(t) for the time interval speciﬁed in Eqn (9) is given by
vrðtÞ ¼ KDAN
as explained above for a D/A converter and shown in Figure 4.19. The counting of clock
pulses continues until the ramp reaches a condition (called coincidence) at which point the
comparator changes state. The comparator output (vcomp) is a binary valued voltage, which is
given by
vcomp ¼ vL
vr < vk
(10)
¼ vH
vr  vk
(11)
wherevL and vH arevoltages corresponding to logic low and high, respectively. At coincidence,
the ramp voltage is essentially given by
vrðtcÞ ¼ vk
(12)
where tc is the time of coincidence. When the comparator voltage switches from low to high,
the count is inhibited via the K input to the JeK input. The contents of the counter are the
binary equivalent N2 of N(tc) and remain at this value until the counter is reset. At this point
(i.e., t ¼ tc), the computer receives an end-of-conversion EOC signal (as vcomp switches from
VL to VH) via an interrupt input.
The computer responds under program control to read the counter contents (Nc) which are the
binary equivalent of the number of clock pulses Nc counted from tk to tk þ tc:
Nc ¼ NðtcÞ
Nc ¼ vk
KDA
(13)
The binary equivalent of Nc is denoted Nc2.
As shown in Figure 4.18, the counter output lines are connected to a computer parallel
input (P) such that the counter contents are available to the computer data bus (DB). The
computer can be conﬁgured to read the counter contents via a special memory operation
called memory-mapped I/O data read as explained earlier in this chapter. Thus, the
computer reads the binary equivalent of a number, which is proportional to vk.
Conversion to vk is accomplished by multiplying Nc2 by the D/A converter constant KDA.
It is important that the conversion time for the largest value of vk be small compared to
sample times (i.e., max(tc) < < T). This condition can be met with sufﬁciently high clock
frequency (fc).
Microcomputer Instrumentation and Control
161

Sampling
As explained in Chapter 2, a discrete time digital system operating on continuous time
variables requires sampling the input signal at the Nyquist or higher rate. Figure 4.20 shows
a sine wave analog signal and some digital approximations with various sampling rates.
Notice that Figure 4.20a with 13 samples per sine wave cycle follows the sinusoid much
closer than Figure 4.20b, which only samples twice in a cycle. When the sampling rate is less
than 2, as in Figure 4.20c, aliasing errors occur as explained in Chapter 2.
Polling
The so-called stand-alone analog-to-digital converters are available that perform conversions
independent of the direct involvement of the computer in the conversion process. The
microcomputer outputs a control signal to cause the conversion to be initiated. At the end of
conversion, the A/D outputs a signal when the conversion is done.
During the A/D or D/A process, the computer can run other operations. However, at the end of
either conversion, the computer must be capable of obtaining the A/D data or outputting to a D/A
converter. One way of doing this is for the microcomputer to periodically check the interface
while it is running another part of the program. This method is called polling. A subroutine is
included in the main program and is called up whenever an A/D converter interface is being
used. This usually consists of a few lines of assembly-language code that check to see if the
Figure 4.20:
Sampling rate illustration.
162
Chapter 4

interface is done and collect the result when it is ﬁnished. When the polling subroutine
determines that the A/D converter is ﬁnished, the main program continues without using the
polling subroutine until the A/D converter interface is called up again. The problem with such
a scheme is that the polling routine may be called many times before the interface is ﬁnished.
This is an inefﬁcient use of computer capabilities and can degrade computer throughput.
Therefore, an evaluation must be made in certain systems to determine if polling is worthwhile.
Interrupts
An efﬁcient alternative to polling uses control circuitry, called an interrupt. An interrupt is an
electrical signal that is generated outside of the CPU and is connected to an input on the CPU.
The interrupt causes the CPU to temporarily discontinue the program execution and to
perform some operation on data coming from an external device. A relatively slow A/D
converter, for instance, could use an interrupt line to signal the processor when it has ﬁnished
converting. When an interrupt occurs, the processor automatically jumps to a designated
program location and executes the interrupt service subroutine. For the A/D converter, this
would be a subroutine to read in the conversion result. When the interrupt subroutine is done,
the computer returns to the point in the program before the interrupt occurred. Interrupts
reduce the amount of time the computer spends dealing with the various peripheral devices
relative to continuously monitoring them.
Another important use for interrupts is in timekeeping. Suppose that a system is being used
that requires actions to be taken at particular absolute times; for instance, sampling an analog
signal is a timed process. A special component called a timer could be used. A timer is
a device that maintains absolute time. A square-wave clock signal is counted in counter
registers like the one discussed in Chapter 3. The timer can be programmed to turn on the
interrupt line when it reaches a certain count and then reset itself (start over). It may be inside
the CPU itself or it may be contained in peripheral devices in the microcomputer system.
Timers have many automotive applications (as shown later).
Such a technique is sometimes used to trigger the output of a new number to a D/A converter
at regular intervals such as at sample times. The microcomputer program includes routines to
control the timer for the desired amount of time by presetting the counter to some starting
value other than zero. Each time the timer counts out the programmed number of its clock
pulses, it interrupts the computer. The interrupt service subroutine then gets the new binary
number that has been put into memory by the microcomputer and transfers this number to the
D/A converter data latches.
Vectored Interrupts
All of the interrupt activity is completely invisible to the program that gets interrupted. In
other words, the interrupted program does not contain data to indicate that it was interrupted
Microcomputer Instrumentation and Control
163

because its execution continues without program modiﬁcation with minimum delay.
Interrupts allow the computer to handle two or more operations almost simultaneously. In
some systems, one interrupt line may be used by more than one device. For instance, two or
more A/D converters may use the same interrupt line to indicate when any of them are ready.
In this case, the computer cannot identify which device caused the interrupt. The computer
could poll all the devices each time an interrupt occurs to see which one needs service, but as
discussed, polling may waste time. A better way is to use vectored interrupts.
In computer parlance, a vector is a memory location that contains another address that locates
data or an instruction. It may be a speciﬁc memory location that contains the address of the
ﬁrst instruction of a subroutine to service an interrupt or it may be a register that contains the
same type address. In this speciﬁc case, an interrupt vector is a register that peripherals use to
identify which device caused the interrupt. When a peripheral causes an interrupt, it writes
a code into the interrupt vector register so that the processor can determine which device
interrupted it by reading the code. The decoder for an interrupt vector usually includes
circuitry that allows each device to be assigned a different interrupt priority. If two devices
interrupt at the same time, the processor will service the most important one ﬁrst.
The vectored interrupt enables the microcomputer to efﬁciently handle the peripheral devices
connected to it and to service the interrupts rapidly. Interrupts allow the processor to respond
to operations in peripheral devices without having to constantly monitor the interfaces. They
enable the microcomputer to handle many different tasks and to keep track of all of them.
A microcomputer system designed to use interrupts is called a real-time computing system
because it rapidly responds to peripherals as soon as requests occur. Such real-time systems
are used in digital instrumentation and control systems in automotive applications.
Microcomputer Applications in Automotive Systems
There is a great variety of applications of microprocessors in automobiles. As will be
explained in later chapters of this book, microprocessors ﬁnd applications in engine and
driveline control, instrumentation, ride control, antilock braking and other safety devices,
entertainment, heating/air conditioning control, automatic seat position control, and many
other systems. In each of these applications, the microprocessor serves as the functional core
of what can properly be called a special-purpose microcomputer.
Although these applications are widely varied in operation, the essential conﬁguration (or
architecture) has much in common for all applications. Figure 4.21 is a simpliﬁed block
diagram depicting the various components of each of the automotive systems having the
applications listed previously. In this block diagram, the microprocessor is denoted MPU. It is
connected to the other components by means of three buses: address bus (AB), data bus (DB),
and control bus (CB). As explained above, each bus consists of a set of wires over which
164
Chapter 4

binary-valued electrical signals are transmitted. By way of illustration, in early automotive
applications, the DB consists of 8 wires. Although the size of the DB is much larger in
contemporary vehicles, the AB is typically larger than the DB and the control bus also is a set
of wires, the number of which is determined by the complexity of the microprocessor.
The operation of each special-purpose microcomputer system is controlled by a program
stored in ROM. As explained earlier in this chapter, the MPU generates addresses for the
ROM in sequence to obtain each instruction in corresponding sequence. The operation of
each microprocessor-based automotive subsystem has a speciﬁc program that is permanently
stored (electronically) in the ROM. Changes in the system operation can be achieved by
replacing the ROM chip(s) with new chip(s) that contain the appropriate program for the
desired operation. This feature is advantageous during the engineering development phase for
any microprocessor-based system. While the hardware remains ﬁxed, the system
modiﬁcations and improvements are achieved by substituting ROM chips. Rules from the
EPA prohibit a vehicle user from making such ROM changes. Only authorized repair
personnel can legally and safely make such changes.
A typical automotive microprocessor-based system also incorporates some amount of RAM.
This memory is used for a variety of purposes, including storing temporary results, storing the
stack, and storing all of the variables, not to mention all of the other activities discussed
earlier in this chapter.
Figure 4.21:
Representative automotive computer block diagram.
Microcomputer Instrumentation and Control
165

The input/output (I/O) device for any given automotive microcomputer system serves as the
interface connection of the microcomputer with the particular automotive system. Standard
commercial I/O devices are available from the manufacturers of each microprocessor that are
speciﬁcally conﬁgured to work with that processor. These I/O devices are implemented as an IC
chip and are very versatile in application. Such a typical I/O device has multiple data ports for
connectingtoperipheraldevices,aswellasaportthatisconnectedtothedatabusofthecomputer.
Figure 4.22 is a block diagram of a typical commercial I/O device. In this device, there are two
ports labeled A and B (which service BUS A or BUS B), respectively. These ports can be
conﬁgured to act as either input or output, depending on the data in the data direction register.
Normally the correct code for determining direction is transferred to the I/O device from the
microprocessor via the system data bus.
Whenever the microprocessor is either to transfer data to the I/O device or to receive data
from it, a speciﬁc address is generated by the processor. This address is decoded, using
standard logic, to form an electrical signal that activates the chip select inputs to the I/O. In
addition, the read/write (R/W) output of the microprocessor is activated, causing data to be
received (read) from a peripheral device, or transmitted (write) to a peripheral device.
Recall from earlier in this chapter that this use of address lines to activate the I/O is known as
memory-mapped I/O. In memory-mapped I/O, input or output of data is selected by reading
from the I/O input address or writing to the I/O output address.
Instrumentation Applications of Microcomputers
In instrumentation applications of microcomputers, the signal processing operations are
performed numerically under program control. The block diagram of a typical computer-based
instrument is depicted in Figure 4.23. In this example instrument, an analog sensor provides
a continuous-time voltage, vo, that is proportional to the quantity (x) being measured. The
continuous-time voltage is sampled at times (tk) determined by the computer. The sampled
analogvoltageisthenconvertedtodigitalformatusinganA/Dconverterasexplainedabove.The
digital data are connected to port A of the I/O device of the computer to be read into memory.
Microcomputers can convert the nonlinear output voltage of some sensors into a linear
voltage representation. The sensor output voltage is used to look up the corresponding linear
value stored in a table. The A/D converter generates an EOC signal when the conversion from
analog to digital is completed. Typically, the EOC signal provides an interrupt signaling the
computer that data are ready as explained above.
The signal processing to be performed is expressed as a set of operations that is to be performed
by the microprocessor on the data. These operations are written in an algorithm for the signal
processing operation by the system designer. The algorithm is converted to a set of speciﬁc
166
Chapter 4

Figure 4.22:
Illustration of I/O ports.
Microcomputer Instrumentation and Control
167

computer operations that becomes the program for the signal processing. After the signal
processing is completed, the result is ready to be sent to the display device. The digital data are
sent through I/O to port B to the D/A converter. There it is converted back to sampled analog as
explained earlier in this chapter to drive the display. The sampled data often are “smoothed” to
a suitable continuous-time voltage by means of a special ﬁlter known as a reconstruction ﬁlter.
The continuous-time output of this ﬁlter drives the continuous-time display.
In a great many applications, the display is digital (e.g., automotive fuel quantity
measurement). In this case, the conversion from digital to analog is not required, and the
computer output data can directly activate the digital display in the correct format.
Digital Filters
In Chapter 2, the analysis/design of digital (discrete time) ﬁlters was explained. Here, some
implementation issues are discussed with respect to automotive digital electronic systems,
nearly all of which are accomplished using a microprocessor, either as a stand-alone system
or as an operation embodied within a larger, multifunction digital system.
As an example of computer-based instrumentation signal processing applications, consider
the relatively straightforward task of ﬁltering the output of a sensor. Recall from the Chapter 1
discussion of ﬁlters that low-pass ﬁlters pass low-frequency signals but reject high-frequency
signals. High-pass ﬁlters do just the reverse: They pass high-frequency signals and reject low-
frequency signals. Bandpass ﬁlters pass midrange frequencies but reject both low and high
frequencies.
Chapter 2 introduced the concept of digital (discrete time) ﬁlters that perform ﬁltering
operation on samples xk of the signal (x(t)) that is to be ﬁltered. Recall from that discussion
Figure 4.23:
Automotive digital instrumentation block diagram.
168
Chapter 4

that one relatively commonly used algorithm for a digital ﬁlter is the recursive algorithm for
calculating the output yn, which is repeated here for convenience:
yn ¼
X
K
k¼1
akxnk 
X
J
j¼1
bjynj
(14)
It was further shown that the z-operational transfer function H(z) is given by
HðzÞ ¼
X
K
k¼1
akzk
1 þ
X
J
j¼1
bjzj
(15)
Filtering the input signal sequence {xk} to calculate the output at sample time tn (i.e., yn) is
done by the digital system under program control. The ﬁlter coefﬁcients, ak and bj, are stored
in ROM and read at the appropriate time. The K previous input values from xne1 to xnek must
be stored in RAM along with previously calculated values of ynej. After input xn has been read
into the digital system, a program (subroutine) is called by the main program, which
implements the recursive ﬁlter algorithm. Multiplication can be performed by repeated use,
under program control, of the basic multiply subroutine described above or in certain
microprocessors by a special circuit section called “hardware multiply” in which the
multiplication (e.g., akxnek) is performed by loading the variables into registers and then, by
means of a control signal, the multiplication is performed by the circuitry with the result
placed in a temporary storage register (e.g., in RAM). Once all products have been computed,
the ﬁlter output yn is obtained by addition or subtraction as indicated in the recursive ﬁlter
algorithm. There are many automotive ﬁlter applications, each of which is implemented as
described above.
A digital low-pass ﬁlter could be used, for instance, to smooth the output of an automotive-
fuel-level sensor. The fuel-level sensor produces an electrical signal that is proportional to the
height of the fuel in the center of the tank as described in Chapter 6. The level at that point
will change as fuel is consumed, and it also will change as the car slows, accelerates, turns
corners, and hits bumps. The sensor’s output voltage varies widely because of fuel slosh even
though the amount of fuel in the tank changes slowly. If the sensor output voltage is sent
directly to the fuel gauge, the resulting variable indication will ﬂuctuate too rapidly to be read.
The measurement can be made readable and meaningful by using a low-pass ﬁlter to smooth out
the signal ﬂuctuations to reduce the effects of sloshing. The low-pass ﬁlter can be implemented
in a microcomputer by programming the computer to average the sensor signal over several
seconds before sending it to the display. For instance, if the fuel-level sensor signal is sampled
Microcomputer Instrumentation and Control
169

once every second and it is desirable to average the signal over a period of K samples, the
computer saves only the latest K samples, averages them, and displays the average. When a new
sample is taken, the oldest sample is discarded so that only the K latest samples are kept. A new
average can be computed and displayed each time a new sample is taken.
The algorithm for calculating the average xn at time tn of K previous samples of data xk:
k ¼ 1,2,/,K is given by
xn ¼ 1
K
X
K
k¼1
xnk
This algorithm is of the same structure as that used in a recursive ﬁlter (e.g., Eqn (14)) in
which all coefﬁcients bj are 0 and all coefﬁcients ak are 1/K; that is to say, averaging
a sequence of data samples {xnek} is a form of ﬁltering the data. Programming to compute
this average involves some of the same steps of retrieval of data and forming an arithmetic
average. The division by K can be performed quickly by multiplication of the sum of samples
by the reciprocal of K (i.e., 1/K) which value can be stored in ROM.
Digital ﬁltering (e.g., averaging) can be performed by a computer under the control of the
software. Sometimes the section of code that performs any such task is simply called “the
ﬁlter.” Digital signal processing is very attractive because the same computer can be used to
process several different signals. During the engineering development of an automotive
digital system, the desired ﬁlter characteristics often evolve. Such evolution can be readily
implemented via changes in the stored ﬁlter coefﬁcients. For any evolution of analog ﬁlters or
signal processing, the hardware itself must be changed. For the digital ﬁlter, once the ﬁlter
coefﬁcients have been determined and ﬁlter performance is acceptable, the numerical values
(i.e., ak and bj) are ready for storage in production vehicle ROM.
There are limitations to the use of digital ﬁlters, however. The frequency range of digital
ﬁlters is determined by the speed of the processor. The microcomputer must be able to sample
each signal at or above the rate required by the Nyquist sampling theorem. It must also be fast
enough to perform all of the averaging and linearization for each signal before the next
sample is taken. This is an important limitation, and the system designer must be certain that
the computer is not overloaded by trying to make it perform too many tasks too quickly.
Microcomputers in Control Systems
Microcomputers are able to handle inputs and outputs that are either digital or converted
analog signals. With the proper software, they are capable of making decisions about those
signals and can react to them quickly and precisely. These features make microcomputers
ideal for controlling other digital or analog systems, as discussed in the following sections.
170
Chapter 4

Closed-Loop Control System
Recall the basic closed-loop control system block diagram of Chapter 1 (continuous
time) and Chapter 2 (discrete time). A continuous time-control system performs the
control law operations on the error signal to generate a continuous time-control signal (u)
which is sent to the actuator via hardware. Recall that the discrete time system performs
the control law calculation by performing operations on the sampled error between the
desired and actual numerical values of the plant variable being controlled. The
calculations to be performed to obtain the control variable (i.e., uk of Chapter 2) can
readily be done in a digital computer under program control. The computer can compare
command input and plant output and perform the computation required to generate
a control signal.
Limit-Cycle Controller
The limit-cycle controller, discussed in Chapter 1, can be readily implemented with
a microcomputer. Recall that the limit-cycle controller controls the plant output so that it falls
somewhere between an upper and lower limit, preferably so that its average value is equal to
the command input. The controller must read in the command input and the plant output and
determine via appropriate logic the value of the control signal to be sent to the plant based on
those signals alone.
Using a microcomputer, the upper and lower limits can be determined from the command
input by using a lookup table similar to that discussed later in this chapter. The plant output is
compared against these two limits. If the plant output is above the higher limit or below the
lower limit, the microcomputer outputs the appropriate on/off signal to the plant to bring the
output back between the two limits.
Feedback Control Systems
Recall that in Chapters 1 and 2, the concept of a feedback control system was introduced.
Those chapters dealt with the basic analytical models and control algorithms on an abstract
level. In this chapter, the speciﬁc conﬁguration incorporating a microcomputer as the control
system implementation is considered.
A feedback control system can also be implemented using a digital computer as well as the
limit-cycle controller. Figure 4.24 shows the physical conﬁguration of a control system
employing a computer. In this ﬁgure, there is a physical system, or plant, that is to be
controlled. The speciﬁc variable being controlled is denoted x. For example, in an automobile,
the plant might be the engine and the controlled variable might be engine speed. Examples of
feedback control are presented in later chapters of this book.
Microcomputer Instrumentation and Control
171

The desired value for x is the set point s. An error signal ˛ is obtained:
˛ ¼ s  x
The error signal is sampled, yielding samples ˛n (where n represents sample number; i.e.,
n ¼ 1, 2,/). A representative value of a control algorithm is the PID control law by which an
output yn for each input sample is calculated by the computer:
yn ¼ KP˛n þ KIT
2
X
K
k¼1
ð˛nk þ ˛nk1Þ þ KDð˛n  ˛n1Þ
T
where KP is the proportional gain, KI is the integral gain, KD is the differential gain, and T is
the sample period.
In this PID controller, K is the number of samples from which the integral is calculated. The
program for implementing this exemplary PID control law involves temporary storage of K
Figure 4.24:
Digital feedback control system block diagram.
172
Chapter 4

previous error samples for retrieval and computation of yn. The same type of program steps
for implementing this control is used as those used for digital ﬁlter applications; that is,
retrieval of variables, multiplication by the appropriate coefﬁcients, and forming the algebraic
sum of the various terms in the control law.
After computing yn for each input sample, a digital version of yn is transmitted through the I/O
to the D/A converter and zero-order hold (ZOH) as explained in Chapter 2. The dashed lines
between the D/A and ZOH (see Chapter 3) blocks indicate that the ZOH may be implemented
as part of the D/A. There it is converted to analog format, providing a control signal uk to the
actuator (A), which is presumed here to be analog. The actuator controls the plant in such
a way as to cause the error to be reduced toward zero. Many examples of the application of
computer-based electronic control systems in automobiles are presented in later chapters of
this book.
Table Lookup
One of the important functions of a microcomputer in automotive applications is table
lookup. These applications include
1.
linearization of sensor data,
2.
multiplication, and
3.
calibration conversion.
The concept of table lookup is illustrated in Figure 4.25, in which a pair of variables, Vo and X,
are related by the graph depicted therein. Also shown in Figure 4.25 is a table listing certain
speciﬁc values for the relationship. The functional relationship between Vo and X might, for
example, be the output voltage of a nonlinear sensor Vo for measuring a quantity X. If the
Figure 4.25:
Illustration of table lookup.
Microcomputer Instrumentation and Control
173

value for Vo is known, then the corresponding value for X can theoretically be found using the
graph or the tabulated values. In the latter case, the nearest two tabulated values for Vo are
located, and the corresponding values for X are read from the table. Denoting V1 and V2 as the
nearest values for V0 and X1, X2 as the corresponding tabulated values, the value for X
corresponding to Vo is found by linear interpolation:
X ¼ X1 þ ðX2  X1ÞðVo  V1Þ=ðV2  V1Þ
A microcomputer can perform the interpolation operation given above using tabulated values
for the relationship between Vo and X (i.e., Vo (X)). This method is illustrated using a speciﬁc
example of the measurement of a variable X using a sensor output voltage, and variable X is
assumed to be that which is illustrated in Figure 4.25. The table lookup operation can also be
programmed to use a nonlinear interpolation algorithm or regression polynomial ﬁt.
The portion of the microcomputer that is involved in the table lookup process is illustrated in
Figure 4.26. The relationship Vo (X) is stored in ROM for representative points along the
curve. These data are stored using Vo values as addresses, and corresponding values of X as
Figure 4.26:
Table lookup block diagram.
174
Chapter 4

data. For example, consider a point (V1, X1). The data X1 are stored at memory location V1 in
binary format.
The operation of the table lookup is as follows. The sensor has output voltage Vo. The
computer reads the values of Vo (using an A/D converter to convert to digital format) and
reads the digital result through the I/O device. Then the MPU under program control
calculates the addresses for the two nearest tabulated values to Vo, which are V1 and V2
(V1 < Vo < V2). The computer, under program control, reads values X1 and X2 and then
calculates X using Eqn (9) (or higher-order polynomial ﬁt algorithm).
Repeated reference will be made to the table lookup function in later chapters. In particular,
Chapter 7 will discuss how a typical digital engine control system frequently obtains data
using table lookup.
Multivariable and Multiple Task Systems
A very important feature of microcomputer control logic is the ability to control multiple
systems independently and to control systems with multiple inputs and outputs. The
automotive applications for microcomputer control involve both of these types of multivariable
systems. For instance, the automobile engine controller has several inputs (such as mass airﬂow
rate, throttle angle, and camshaft and/or crankshaft angular position) and several outputs. All of
the outputs must be controlled as close to simultaneously as is feasible within hardware
capability and computation time limits because some inputs affect more than one output. These
types of controllers can be very complicated and are difﬁcult to implement in analog fashion.
The increased complexity (and cost) of a multivariable microcomputer system is not much
higher than for a single-variable microcomputer system, presuming the microcomputer has the
capacity to do the task. It only affects the task of programming the appropriate control scheme
into the microcomputer. This type of control is discussed in a later chapter.
The organization of the program for any computer performing multiple tasks simultaneously
is extremely complex. One such organizational scheme involves having a so-called “main
program loop.” This main loop calls up appropriate subroutines for each of the tasks to be
performed in sequence. The main loop continuously cycles at a rate that is determined by the
computation time required for each task (subroutine). However, not all of the tasks need to be
performed for each cycle through the main loop. Certain tasks such as fuel and spark control
are required to be performed for every main loop cycle. Other, less time-critical tasks, such as
ﬁltering fuel quantity measurements, need to be performed at a much lower rate than the fuel
and spark control tasks.
Other tasks such as diagnosis of problems with the vehicle subsystems are required to be
performed only when a problem is detected (e.g., see Chapter 9). The main loop must be
Microcomputer Instrumentation and Control
175

programmed to respond to signals that are generated when a problem is detected. These
applications are explained in detail in later chapters where appropriate.
The development of a program for any automotive electronic system is normally very time
consuming and requires the efforts of some very talented and capable computer programmers.
Typically, a full program for the very complex powertrain control system (see Chapter 7)
involves many thousands of individual lines of code. Some assistance in the form of
automatic code generation is available from certain software, although a discussion of this
subject is beyond the scope of this book.
After a chapter on basics of automotive engine control and a chapter on sensors and actuators,
this book will deal more speciﬁcally with particular microcomputer automotive
instrumentation and control systems to show how these systems are used in the automobile to
control the engine and drivetrain and many auxiliary functions. In addition, speciﬁc
algorithms, along with dynamic performance calculations/simulations, are presented for
selected applications. The programming of the subroutine for their implementation follows
procedures discussed and explained in this chapter.
176
Chapter 4

CHAPTER 5
The Basics of Electronic Engine Control
Chapter Outline
Motivation for Electronic Engine Control
178
Exhaust Emissions
178
Fuel Economy
179
Federal Government Test Procedures
180
Fuel Economy Requirements
181
Meeting the Requirements
183
The Role of Electronics
184
Additional cost incentive
184
Concept of an Electronic Engine Control System
184
Inputs to Controller
187
Output from Controller
188
Definition of Engine Performance Terms
193
Torque
193
Power
196
Fuel Consumption
198
Engine Overall Efficiency
200
Calibration
201
Engine Mapping
201
Effect of Air/Fuel Ratio on Performance
202
Effect of Spark Timing on Performance
203
Effect of Exhaust Gas Recirculation on Performance
204
Exhaust Catalytic Converters
206
Oxidizing Catalytic Converter
206
The Three-Way Catalyst
207
Electronic Fuel-Control System
209
Engine Control Sequence
212
Open-Loop Control
213
Closed-Loop Control
213
Exhaust gas oxygen concentration
214
Closed-Loop Operation
215
Frequency and deviation of the fuel controller
217
Analysis of Intake Manifold Pressure
219
Measuring Air Mass
220
Speed-density method
221
Understanding Automotive Electronics. http://dx.doi.org/10.1016/B978-0-08-097097-4.00005-9
Copyright  2012 Elsevier Inc. All rights reserved.
177

Influence of Valve System on Volumetric Efficiency
223
Including EGR
223
Idle Speed Control
224
Electronic Ignition
230
Engine control in the vast majority of engines means regulating fuel and air intake as well as
spark timing to achieve desired performance in the form of power output. Until the 1960s,
control of the engine output torque and RPM was accomplished through some combination of
mechanical, pneumatic, or hydraulic systems. Then, in the 1970s, electronic control systems
were introduced.
This chapter is intended to explain, in general terms, the theory of electronic control of
a gasoline-fueled, spark-ignited automotive engine. Chapter 7 explains practical digital
control methods and systems. The examples used to explain the major developments and
principles of electronic control have been culled from the techniques of various
manufacturers and do not necessarily represent any single automobile manufacturer at the
highest level of detail.
Motivation for Electronic Engine Control
The initial motivation for electronic engine control came in part from two government
requirements. The ﬁrst came about as a result of legislation to regulate automobile exhaust
emissions under the authority of the Environmental Protection Agency (EPA). The second
was a thrust to improve the national average fuel economy by government regulation. The
issues involved in these regulations along with normal market forces continue to motivate
improvements in reduction of regulated gases as well as fuel economy. Electronic engine
control is only one of the automotive design factors involved in fuel economy improvements.
However, this book is only concerned with the electronic systems.
Exhaust Emissions
Although diesel engines are in common use in heavy trucks, railroads, and some pick-up
trucks, the gasoline-fueled engine is the most commonly used engine for passenger cars and
light trucks in the United States. This engine is more precisely termed the gasoline-fueled,
spark-ignited, four-stroke/cycle, normally aspirated, liquid-cooled internal combustion
engine. It is this engine, which is denoted the SI engine, that is discussed in this book. The
following discussion of exhaust emission regulations applies to the SI engine.
The engine exhaust consists of the products of combustion of air and gasoline mixture.
Gasoline is a mixture of chemical compounds that are called hydrocarbons. This name is
178
Chapter 5

derived from the chemical formation of the various gasoline compounds, each of which is
a chemical union of hydrogen (H) and carbon (C) in various proportions. Gasoline also
contains natural impurities as well as chemicals added by the reﬁner. All of these can produce
undesirable exhaust elements. The combustion of gasoline in an engine results in exhaust
gases, including CO2, H2O, CO, oxides of nitrogen, and various hydrocarbons.
During the combustion process, the carbon and hydrogen combine with oxygen from the air,
releasing heat energy and forming various chemical compounds. If the combustion were
perfect, the exhaust gases would consist only of carbon dioxide (CO2) and water (H2O),
neither of which is considered harmful to human health in the atmosphere. In fact, both are
present in an animal’s breath.
Unfortunately, the combustion of the SI engine is not perfect. In addition to the CO2 and H2O,
the exhaust contains amounts of carbon monoxide (CO), oxides of nitrogen (chemical unions
of nitrogen and oxygen that are denoted NOx), unburned hydrocarbons (HC), oxides of sulfur,
and other compounds. Some of the exhaust constituents are considered harmful and are now
under the control of the federal government. The exhaust emissions controlled by government
standards are CO, HC, and NOx.
Automotive exhaust emission control requirements began in the United States in 1966
when the California state regulations became effective. Since then, the federal
government has imposed emission control limits for all states, and the standards became
progressively tighter throughout the remainder of the twentieth century and will continue
to tighten in the twenty-ﬁrst century. Auto manufacturers found that the traditional
engine controls could not control the engine sufﬁciently to meet these emission limits
and maintain adequate engine performance at the same time, so they turned to electronic
controls.
Fuel Economy
Everyone has some idea of what fuel economy means. It is related to the number of miles that
can be driven for each gallon of gasoline consumed. It is referred to as miles per gallon
(MPG) or simply mileage. In addition to improving emission control, another important
feature of electronic engine control is its ability to improve fuel economy.
It is well recognized by layman and experts alike that the mileage of a vehicle is not unique.
Mileage depends on the size, shape, and weight of the car as well as how the car is driven.
The best mileage is achieved under steady cruise conditions. City driving, with many starts
and stops, yields worse mileage than steady highway driving. In order to establish
a regulatory framework for fuel economy standards, the federal government has established
hypothetical driving cycles that are intended to represent how cars are operated on a sort of
average basis.
The Basics of Electronic Engine Control
179

The government fuel economy standards are not based on one car, but are stated in terms of
the average rated miles per gallon fuel mileage for the production of all models by
a manufacturer for any year. This latter requirement is known in the automotive industry by
the acronym CAFE (corporate average fuel economy). It is a somewhat complex requirement
and is based on measurements of the fuel used during a prescribed simulated standard driving
cycle.
Federal Government Test Procedures
For an understanding of both emission and CAFE requirements, it is helpful to review the
standard cycle and how the emission and fuel economy measurements are made. The U.S.
federal government has published test procedures that include several steps. The ﬁrst step is to
place the automobile on a chassis dynamometer, like the one shown in Figure 5.1.
A chassis dynamometer is a test stand that holds a vehicle such as a car or truck. It is
equipped with instruments capable of measuring the power that is delivered at the drive
Figure 5.1:
Chassis dynamometer.
180
Chapter 5

wheels of the vehicle under various conditions. The vehicle is held on the dynamometer
so that it cannot move when power is applied to the drive wheels. The drive wheels are
in contact with two large rollers. One roller is mechanically coupled to an electric
generator that can vary the load on its electrical output. The other roller has instruments
to measure and record the vehicle speed. The generator absorbs and provides
a measurement of all mechanical power that is delivered at the drive wheels to the
dynamometer. The power is calculated from the electrical output in the correct units of
kW or Hp (horsepower where 1 Hp ¼ 0.746 kW). The controls of the dynamometer can
be set to simulate the correct load (including the effects of tire rolling resistance and
aerodynamic drag) and inertia of the vehicle moving along a road under various
conditions. The conditions are the same as if the vehicle actually were being driven
except for wind loads.
The vehicle is operated according to a prescribed schedule of speed and load to simulate the
speciﬁed trip. One driving cycle simulates an urban trip and another simulates a highway trip.
Over the years, the hypothetical driving cycles for urban and rural trips have evolved.
Figure 5.2 illustrates sample driving cycle trips (one for each) that demonstrate the
differences in those hypothetical test trips. It can be seen that the urban cycle trip involves
acceleration, deceleration, stops, starts, and steady cruise such as would be encountered in
a “typical” city automobile trip of 7.45 miles (12 km). The highway schedule takes 765
seconds and simulates 10.24 miles (16.5 km) of highway driving.
During the operation of the vehicle in the tests, the exhaust is continuously collected and
sampled. At the end of the test, the absolute mass of each of the regulated exhaust gases is
determined. The regulations are stated in terms of the total mass of each exhaust gas divided
by the total distance of the simulated trip.
Fuel Economy Requirements
In addition to emission measurement, each manufacturer must determine the fuel
consumption in MPG for each type of vehicle and must compute the corporate average fuel
economy (CAFE) for all vehicles of all types produced in a year. Fuel consumption is
measured during both an urban and a highway test, and the composite fuel economy is
calculated.
Table 5.1 is a summary of the exhaust emission requirements and CAFE standards for a few
representative years. It shows the emission requirements and increased fuel economy
required, demonstrating that these regulations have become and will continue to become
more stringent with passing time. Not shown in Table 5.1 is a separate regulation on
nonmethane hydrocarbon (NMHC). Because of these requirements, each manufacturer has
a strong incentive to minimize exhaust emissions and maximize fuel economy for each
vehicle produced.
The Basics of Electronic Engine Control
181

Figure 5.2:
Federal driving schedules (Title 40 United States Code of Federal Regulations).
182
Chapter 5

New regulations for emissions have continued to evolve and encompass more and more
vehicle classes. Present-day regulations affect not only passenger cars but also light utility
vehicles and both heavy- and light-duty trucks. Furthermore, regulations apply to a variety of
fuels, including gasoline, diesel, natural gas, and alcohol-based fuels involving mixtures of
gasoline with methanol or ethanol.
As an example, we present below the standards that were written for the vehicle half-life (5
years or 50,000 milesewhichever comes ﬁrst) and full life cycle (10 years or 100,000 miles)
as of 1990. The standards are:
These regulations were phased in according to the following schedules:
There are many details to these regulations that are not relevant to the present discussion.
However, the regulations themselves are important in that they provided motivation for
expanded electronic controls.
Meeting the Requirements
Unfortunately, as seen later in this chapter, meeting the government regulations causes some
sacriﬁce in performance. Moreover, attempts to meet the standards exempliﬁed by Table 5.1
using mechanical, electromechanical, hydraulic, or pneumatic controls like those used in pre-
emission control vehicles have not been cost-effective. In addition, such controls cannot
operate with sufﬁcient accuracy across a range of production vehicles, over all operating
Table 5.1: Emission and MPG requirements.
Year
Federal HC/CO/NOx
California HC/CO/NOx
CAFE MPG
1968
3.22/33.0/e
e
e
1971
2.20/23.0/e
e
e
1978
1.50/15.0/2.0
0.41/9.0/1.5
18.0
1979
1.50/15.0/2.0
0.41/9.0/1.5
19.0
1980
0.41/7.0/2.0
0 41/9 0/1 5
20.0
1989
0.31/4.1/1.0
0.31/4.1/1.0
27.5
HC
0.31 g/mi
CO
4.20 g/mi
NOx
0.60 g/mi (non-diesel)
1.25 g/mi (diesel)
Model year 1994: 40%
Model year 1995: 80%
Model year 1996: 100%
The Basics of Electronic Engine Control
183

conditions, and over the life of the vehicle to stay within the tolerance required by the EPA
regulations. Each automaker must verify that each model produced will still meet emission
requirements after traveling 100,000 miles. As in any physical system, the parameters of
automotive engines and associated peripheral control devices can change with time. An
electronic control system has the ability to automatically compensate for such changes and to
adapt to any new set of operating conditions and make electronic controls a desirable option
in the early stages of emission control.
The Role of Electronics
The use of digital electronic control has enabled automakers to meet the government
regulations by controlling the system accurately with excellent tolerance. In addition, the
system has long-term calibration stability. As an added advantage, this type of system is very
ﬂexible. Because it uses microcomputers, it can be modiﬁed through programming changes to
meet a variety of different vehicle/engine combinations. Critical quantities that describe an
engine can be changed relatively easily by changing data stored in the system’s computer
memory.
Additional cost incentive
Besides providing control accuracy and stability, there is a cost incentive to use digital
electronic control. The system componentsdthe multifunction digital integrated
circuitsdare decreasing in cost, thus decreasing the system cost. From about 1970 on,
considerable investment was made by the semiconductor industry for the development of low
cost, multifunction integrated circuits. In particular, the microprocessor and microcomputer
have reached an advanced state of capability at relatively low cost. This has made the
electronic digital control system for the engine, as well as other on-board automobile
electronic systems, commercially feasible. As pointed out in Chapter 3, as multifunction
digital integrated circuits continue to be designed with more and more functional capability
through very large scale integrated circuits (VLSI), the costs continue to decrease. At the
same time, these circuits offer improved electronic system performance in the automobile.
In summary, the electronic engine control system duplicates the function of conventional
legacy ﬂuidic control systems, but with greater precision and long-term stability via adaptive
control processes. It can optimize engine performance while meeting the exhaust emission
and fuel economy regulations and can adapt to changes in the plant.
Concept of an Electronic Engine Control System
In order to understand electronic engine control, it is necessary to understand some
fundamentals of how the power produced by the engine is controlled. Any driver understands
184
Chapter 5

intuitively that the throttle directly regulates the power produced by the engine at any
operating condition. It does this by controlling the airﬂow into the engine.
In essence the engine is an air pump such that at any RPM, the mass ﬂow rate of air into the
engine varies directly with throttle plate angular position (see Figure 5.3).
As the driver depresses the accelerator pedal, the throttle angle (qT in Figure 5.3) increases,
which increases the cross-sectional area through which the air ﬂows, reducing the resistance
to airﬂow and thereby allowing an increased airﬂow into the engine. A model for the airﬂow
vs. throttle angle and engine RPM is given later in this chapter. The role of fuel control is to
regulate the fuel that is mixed with the air so that it increases in proportion to the airﬂow. As
we will see later in this chapter, the performance of the engine is affected strongly by the
mixture (i.e., by the ratio of air to fuel). However, for any given mixture the power produced
by the engine is directly proportional to the mass ﬂow rate of air into the engine. In the U.S.
system of units as a rough “rule of thumb,” an airﬂow rate of about 6 lb/h produces 1
horsepower of usable mechanical power at the output of the engine. Metric units have come to
air flow
in
pivot
to
engine
top view
intake
throttle plate
throttle plate
end view
θT
Figure 5.3:
Intake system with throttle plate.
The Basics of Electronic Engine Control
185

be more commonly used, in which engine power is given in kilowatts (kW) and air mass is
given in kilograms (kg). Denoting the power from the engine Pb, the linear model for engine
power is given by
Pb ¼ K _MA
where Pb is the power from the engine (hp or kW), _MA the mass airﬂow rate (kg/sec) or (slugs/
sec), and K the constant relating power to airﬂow (kW/kg/sec) or (hp/lb/sec). Of course, it is
assumed that all parts of the engine, including ignition timing, are functioning correctly for this
relationship to be valid.
We consider next an electronic engine control system that regulates fuel ﬂow to the engine.
An electronic engine control system is an assembly of electronic and electromechanical
components that continuously varies the fuel and spark settings in order to satisfy government
exhaust emission and fuel economy regulations. Figure 5.4 is a block diagram (at the most
abstract level) of a generalized electronic engine control system.
It will be explained later in this chapter that an automotive engine control has both open-
loop and closed-loop operating modes (see Chapter 1). As explained in Chapter 1, a closed-
loop control system requires measurements of certain output variables such that the
controller can calculate the state of the system being controlled, whereas an open-loop
system does not. The electronic engine control system receives input electrical signals from
the various sensors that measure the state of the engine. From these signals, the controller
generates output electrical signals to the actuators that determine the correct fuel delivery
and spark timing.
Models for and performance analysis of automotive engine control system sensors and
actuators are discussed in Chapter 6. As mentioned, the conﬁguration and control for an
automotive engine control system are determined in part by the set of sensors that is available
to measure the variables. In many cases, the sensors available for automotive use involve
compromises between performance and cost. In other cases, only indirect measurements of
certain variables are feasible. From measurement of these variables, the desired variable is
found by computation.
Figure 5.5 is a form of overall engine electronic control at a very abstract level. There is
a fuel-metering system to set the airefuel mixture ﬂowing into the engine through the intake
Figure 5.4:
Generic electronic engine control system.
186
Chapter 5

manifold. Spark control determines when the airefuel mixture is ignited after it is
compressed in the cylinders of the engine. The power is delivered at the driveshaft and the
gases that result from combustion ﬂow out from the exhaust system. In the exhaust system,
there is a valve to control the amount of exhaust gas being re-circulated back to the input, and
a catalytic converter to further control emissions. The addition of re-circulated exhaust gas to
the engine intake, as well as various sensors and actuators depicted in Figure 5.5, is explained
later in this chapter. In addition, there is a subsystem that collects the evaporating fuel vapors
in the fuel tank to prevent them from being vented to the atmosphere. These fuel vapors are
later sent to the intake system as a small component of fuel being supplied to the engine. This
subsystem is denoted EVAP in Figure 5.5.
At one stage of development, the electronic engine control consisted of separate subsystems
for fuel control, spark control, and exhaust gas recirculation. The ignition system in
Figure 5.5 is shown as a separate control system, although engine control is evolving toward
an integrated digital system (see Chapter 7).
Inputs to Controller
Figure 5.6 identiﬁes the major physical quantities that are sensed and provided to the
electronic controller as inputs. They are as follows:
1.
Throttle position sensor (TPS)
2.
Mass airﬂow rate (MAF)
3.
Engine temperature (coolant temperature) (CT)
4.
Engine speed (RPM) and angular position
5.
Exhaust gas recirculation (EGR) valve position
6.
Exhaust gas oxygen (EGO) concentration
Figure 5.5:
Engine functions and control diagram.
The Basics of Electronic Engine Control
187

Output from Controller
Figure 5.7 identiﬁes the major physical quantities that are outputs from the controller. These
outputs are
1.
Fuel metering control
2.
Ignition control (dwell and timing)
3.
Exhaust gas recirculation control
4.
Fuel tank evaporative emission control (EVAP)
This chapter discusses the various electronic engine control functions separately and explains
how each function is implemented by a separate control system. Chapter 7 shows how these
Figure 5.6:
Major controller inputs from engine.
Figure 5.7:
Major controller outputs to engine.
188
Chapter 5

separate control systems are being integrated into one system and are implemented with
digital electronics.
For certain readers of this book, a brief review of engine conﬁguration and operation may be
helpful. Although several types of engines have found application as the prime mover in
automobiles, the one most commonly used continues to be the multicylinder, four-stroke IC
engine as explained earlier in the chapter. The conﬁguration and operation of electric
propulsion (e.g., in hybrid vehicle) are discussed in Chapter 6.
The conﬁguration of a single cylinder of an IC engine is depicted in Figure 5.8a. Mechanical
power is produced by the engine in the form of torque acting on the rotating crank shaft. There
are four basic engine processes that occur during the two complete revolutions of the
crankshaft that occur during any single cycle of operation. This engine conﬁguration includes
a component called the piston, which ﬁts within a cylinder and is mechanically linked to the
crankshaft by the connecting rod. Airﬂow into and out of the cylinder is controlled by poppet
valves (simply called the valves here). One of these is termed the intake valve and the other
the exhaust valve. Additional components of the engine include a so-called “intake port
system” consisting of a system of passageways (e.g., tubes) that direct fuel/air mixture into
the engine and a so-called “exhaust port system” that directs the products of combustion out
of the engine.
During any single cycle of engine operation (involving two complete rotations of the
crankshaft), there are four portions of the crankshaft rotation called strokes. Each stroke
corresponds to piston (reciprocating) motion from its highest point (called “top-dead-center”
or TDC) to the lowest point (called “bottom-dead-center” or BDC). These four strokes of any
given engine cycle are termed intake, compression, power, and exhaust strokes. During the
intake stroke, the piston moves from TDC to BDC. During most of this stroke, the intake
valve is open and the exhaust valve is closed. During this stroke, air mixed with fuel is
pumped into the cylinder by the positive differential pressure between the intake port and the
cylinder internal pressure. During the compression stroke, the piston moves from BDC to
TDC. Both intake and exhaust valves are closed. For an ideal IC engine, this compression is
adiabatic and modeled by the following expression:
pc ¼ Vg
c
(1)
where Vc is the cylinder contained volume (between the piston upper surface and the top of
the combustion chamber), pc the combustion chamber pressure, and g the ratio of speciﬁc
heat at constant pressure to the speciﬁc heat at constant volume. For the intake air/fuel
mixture gy1:5 for air/gasoline mixture.
The term adiabatic refers to a process with zero heat loss. The compression process for an
actual engine is not adiabatic since heat is lost (e.g., through the cylinder sidewalls). The
actual function pc(Vc) for a practical engine is shown graphically later in this chapter.
The Basics of Electronic Engine Control
189

(a)
(b)
Figure 5.8:
IC engine cylinder and cam actuation mechanism
190
Chapter 5

The difference between combustion chamber maximum volume (piston at BDC) and its
minimum volume (at TDC) (which is often called the “clearance volume”) is called the
cylinder displacement VD. The ratio of cylinder pressure at TDC to that at BDC is called
the compression ratio r. At some point before the piston reaches TDC, the spark is
generated and combustion of the fuel/air mixture is initiated and cylinder pressure rises
rapidly.
During the next stroke, the power stroke, the cylinder pressure, acting on the piston via the
connecting rod, applies a torque to the crankshaft. This expansion ideally would be adiabatic,
but in fact is not adiabatic due to heat losses (as is demonstrated later from measurements
made on an actual engine).
During the ﬁnal stroke, the exhaust stroke, the piston again moves from BDC to TDC. The
exhaust valve is open during most of this stroke, and the products of combustion (mostly CO2
and H2O) are pumped out of the cylinder into the exhaust system and released through this
system to the atmosphere.
The actual point in the 720 crankshaft rotation angle at which the valves open and close
(called valve timing) is determined by a mechanism that includes the camshaft and
mechanical linkage connecting it to the valves. The camshaft, which is illustrated in
Figure 5.8b, has lobes that force the valves open against the restoring forces of valve springs
that otherwise hold the valves closed. The reader should imagine that the valves depicted in
Figure 5.8a extend to the end of the valve stem depicted in Figure 5.8b. The camshaft is
coupled via a gear system to the crankshaft such that it rotates at half the speed of the latter.
This mechanism assures that the valves operate synchronously within each engine cycle.
During the development period of any new engine design, the optimal valve timing is
determined. In Chapter 6, the drive mechanism for the camshaft and the means for rotating it
at half the crankshaft angular speed are explained with respect to a system known as variable
valve phasing. For the present, however, the discussion is focused on basic engine processes.
Energy is produced by a four-stroke/cycle internal combustion engine only during the power
stroke. The energy produced during this stroke must be greater than the energy required for
the other strokes as well as by internal friction losses. Normally, in any well-designed engine
the power stroke energy far exceeds the magnitude of all mechanical losses, thereby yielding
net output energy.
A basic method of evaluating the output mechanical energy involves the so-called indicator
diagram, which is also a plot of the pc vs. Vc for the entire cycle. Figure 5.9 represents an
indicator diagram for an ideal engine cycle (in the sense of no heat loss to the engine) by the
dashed curve and the pc(Vc) plot for an actual engine by the solid curve.
For the ideal engine cycle, the valves are assumed to open or close at exactly TDC or BDC.
Any time delays associated with the gas dynamics of intake and exhaust are taken to be
The Basics of Electronic Engine Control
191

negligible. In Figure 5.9, point a is at BDC with the cylinder ﬁlled with fuel/air mixture. The
segment from point a to point b corresponds to the compression stroke. Ignition occurs at
point b and the combustion chamber pressure increases instantaneously to point c, which is
the beginning of the power stroke. The power stroke is represented by the segment from point
c to point d. At point d, the exhaust valve opens and pressure drops to the exhaust system
pressure (pe) at point a. The segment from point a to point e corresponds to the exhaust
stroke. At point e, the exhaust valve closes and the intake valve opens. The intake stroke
corresponds to the segment from point e to point a where the cycle began and where the next
engine cycle commences. For this ideal engine cycle, both intake and exhaust gas pressures
are taken to be at atmospheric pressure.
The indicator diagram for an actual engine is depicted by the solid curve for which the
compression stroke is the segment of the solid curve from point 1 to point 2. Notice that the
pressure at point 1 is slightly below atmosphere pressure, which occurs because of pressure
losses in the intake system. At point 2, ignition occurs and the pressure rises to its maximum
value at point 3. The expansion from point 3 to point 4 is somewhat different in shape than the
ideal adiabatic expansion due to heat losses. Pressure continues to drop after the exhaust valve
opens (near point 4), but remains slightly above atmospheric pressure due to “back pressure” in
the exhaust system. The exhaust stroke occurs between point 4 and point 0. The intake stroke
occurs from point 0 to point 1 at pressure somewhat below atmospheric due to pressure drop
across the throttle plate as well as some pressure losses in the intake system. From point 1,
the cycle begins again.
Atmospheric
Pressure
VD Proportional to L
3
2
1
a4
d
b
m
n
f
0
cVD
e
Vc
pc
C
Figure 5.9:
Indicator diagram for a four-stroke engine.
192
Chapter 5

The net energy/cycle (called the indicated energy, Wi) is given by the contour integral around
the curve from points 1e6 below:
Wi ¼
I
pcdVc
(2)
The only positive contribution to this integral comes from the portion from point 3 to point 4
(i.e., the power stroke). The energy/cycle is inﬂuenced markedly by the timing of the valve
openings and closing as will be explained in Chapter 7. As clearly shown from Figure 5.9, in
any practical engine the indicator diagram deviates from the ideal as indicated by the
continuous curve of Figure 5.9.
Deﬁnition of Engine Performance Terms
Several common terms are used to describe an engine’s performance, including the torque
and power at various places in the engine and powertrain as well as cylinder pressure,
crankshaft angular speed, fuel consumption and various combinations of these as explained
below. It is these performance variables that are inﬂuenced by the electronic engine control.
For an understanding of this controller inﬂuence, it is necessary to have the quantitative
models for these performance variables as presented below.
Torque
Engine torque is produced on the crankshaft by the cylinder pressure pushing on the piston
during the power stroke. In an IC, engine torque is produced at the crankshaft as explained
below. The torque that is applied to the crankshaft is called “indicated torque Ti.” The output
torque from the engine at the transmission end of the crankshaft differs from Ti due to friction
and pumping losses and is called the brake torque (denoted Tb).
For an understanding of the various torques at different points in the powertrain, it is helpful
to refer to Figure 5.10, which illustrates the geometry of a single cylinder in a four-stroke IC
engine. Figure 5.10 shows the centerline of the cylinder which is a line along the cylinder axis
through the crankshaft rotational center. The piston is connected via the connecting rod to the
crankshaft. The connecting rod is fastened to the piston via the piston pin about which this rod
can rotate. During the power stroke, a torque is applied to the crankshaft resulting from the
force acting on the piston due to combustion chamber pressure acting through a lever arm
which is proportional to the crank throw R and which varies with crankshaft angular position
(qe). This torque is known as the indicated torque to distinguish it from other torque acting on
the crankshaft and can be computed as explained below.
Figure 5.10 presents the geometry of the piston, connecting rod, and crankshaft in a way
which permits a model for the indicated torque Ti(qe) as a function of crankshaft angle (qe)
The Basics of Electronic Engine Control
193

to be developed. In Figure 5.10 the connecting rod length is denoted Lr and the radius from
the crankshaft axis of rotation to the center of the connecting rod journal is denoted R. It is
this radius of the crankshaft rotation which provides the lever arm for the production of
indicated torque due to the force on the top of the piston due to combustion chamber
pressure (Pc(qe)). In many engines, the piston pin is located slightly off the cylinder
centerline (CL) in a plane that is orthogonal to the crankshaft axes of rotation, which
beneﬁts torque production. The piston pin offset from the cylinder CL is denoted d in
Figure 5.10. The angle between the connecting rod plane of symmetry and the cylinder axis
is denoted b. Owing to the piston offset, the indicated torque for a piston on the down stroke
is given by
TiðqeÞ ¼ pcðqeÞARsinðqe þ bÞ
cosb
0  qe < p
(3)
On the up stroke Ti is given by
TiðqeÞ ¼ pcðqeÞARsinðqe  bÞ
cosb
p  qe < 2p
(4)
θe
R
crankshaft 
axis of
rotation
crank pin
axis
piston pin
axis
piston
cylinder
β
δ
Lr
CL
Figure 5.10:
Schematic illustration of cylinder geometry.
194
Chapter 5

where A is the piston cross-sectional area. The factors R½sinðqe  bÞ=cosb represent the lever
arm through which torque is applied to the crankshaft.
The combustion chamber pressure for a representative four-stroke reciprocating IC engine is
shown in Figure 5.11 for a complete engine cycle (720 of crankshaft rotation) beginning
at e180 (BDC) for the start of compression and ending at 540 (BDC) at the end of intake
stroke. Note that following ignition (point x), the pressure rises abruptly due to combustion
reaching a maximum at a point (y) slightly beyond TDC.
The region of positive work for each cycle is indicated in the drawing as the power stroke
(i.e., 0 to 180). The ﬂuctuations in combustion chamber pressure along with the geometry
factor relating pc to Ti cause Ti to ﬂuctuate with crankshaft angle and of course with time.
exhaust
intake
540°
BDC
180°
BDC
–180°
  BDC
180°
BDC
360°
TDC
θe degrees of crankshaft rotation
TDC
compression
power
Compression 
Pressure
Ignition
Negative
work
Positive
Work
Maximum
Pressure
Pressure, pc
700
– 90°
90°
y
b
x
c
c′
x
pi
pe
(–π)
(π)
(π)
(2π)
(3π)
θe
digrees
(radians)
θe
digrees
(radians)
Figure 5.11:
Exemplary plot of pc(qe).
The Basics of Electronic Engine Control
195

However when the engine produces power, the time-average value for Ti (i.e., Ti) is
positive:
Ti > 0
There are other contributors to the total dynamic indicated torque at the crankshaft,
including torques due to the reciprocating forces of the piston and connecting rod. The
details of the reciprocating torque (Tr) are beyond the scope of this book and are not relevant
to the present discussion, but in general increase quadratically with rotational speed. In
addition, there are contributors to the torque at the crankshaft due to internal friction of the
rotating and reciprocating components as well as due to pumping of intake and exhaust
gases.
The indicated torque is the maximum available torque which is applied at each crankshaft
segment for the corresponding cylinder. Typically, between each crankshaft “throw” are
sleeve bearings that have friction. In addition to friction, there are negative torques applied to
the crankshaft owing to the nonzero cylinder pressuresdpe during exhaust and pi during
intake e and a relatively large negative torque associated with compression. The time-
average torque averaged over an engine cycle at the crankshaft output end is called the brake
torque Tb and is given by
Tb ¼ Ti  Tfp
(5)
where Tfp is the average torques associated with friction and pumping losses. It is this brake
torque acting through the drivetrain that provides the torque to drive the vehicle. The
drivetrain includes the transmission and other gear systems (e.g., differential) as explained in
Chapter 7.
Power
One of the most important metrics for engine performance is output power. This power is
related to the indicated torque applied to the crankshaft (as explained above). The
instantaneous power applied to the crankshaft by the indicated torque is known as the
indicated power (Pi[qe(t)]), given by
PiðtÞ ¼ TiðtÞueðtÞ
where
ueðtÞ ¼ dqe
dt
in rad=sec
(6)
196
Chapter 5

The units for Pi(t) are Nm/sec (metric) or ft lb/sec (English units). Normally it is the average
indicated power averaged over N engine cycles PðNÞ that is useful as a metric for engine
available power (with qe in radians) is given by:
PiðNÞ ¼
1
4pN
Z4pN
0
PiðqeÞdqe
N ¼ integer
(7)
The appropriate unit for Pi is kW, although in the USA the popular unit (with the driving
public) remains horsepower (Hp), where 1Hp ¼ 0.75 kW and 550 ft lb/s.
The engine output power at the crankshaft is known as the brake power (Pb) since historically
engine power was measured using a Prony brake. This brake power (in kW or Hp) is the
difference between indicated power and the power associated with internal power losses due,
e.g., to friction and pumping of the intake mixture and exhaust gases. Generally, the cycle-
averaged friction and pumping power are combined and denoted Pfp. The brake power Pb is
given by
Pb ¼ Pi  Pfp
(8)
Measurements are readily made of Pfp by driving the engine from an external power source
such as an electric dynamometer. The latter is an instrumented electric motor/generator
having the capacity to absorb all brake power produced by the running engine under test.
Normally, instrumentation permits measurements to be made of output torque, angular speed
ue, and Pb. It is also common practice to evaluate engine performance via the averaged torque
at the engine output, which is called “brake torque” and is denoted Tb and which is related to
Pb by the expression
Tb ¼ Pb=ue
(9)
Another metric of performance for an engine is the so-called mean-effective pressure (mep).
It is deﬁned as the indicated work done on the piston (Wi) (given in Eqn (2)) divided by
displacement volume VD. As in the case of torques, it is convenient to consider the indicated
mep (imep) which is deﬁned as
imep ¼ Wi
VD
(10)
where VD ¼ V1  V2 is the displacement, V1 the cylinder maximum volume (at BDC), and V2
the cylinder minimum volume at TDC; (i.e., clearance volume).
The imep (which has the dimensions of pressure) is the value of constant pressure, which, if
acting during an engine cycle, would produce the work done on the crankshaft. There is also
a friction mep (fmep):
fmep ¼ Wf
Vd
(11)
The Basics of Electronic Engine Control
197

where Wf is the work done by the friction torque. The most commonly used mep is the brake
mep (bmep), which is deﬁned as
bmep ¼ imep  fmep
It has the units of pressure (e.g., N/m2 or lb/in2) and is the value of constant pressure acting
over a full engine cycle to produce the output mechanical work/cycle.
Fuel Consumption
Fuel economy can be measured while the engine delivers power to the dynamometer. The
engine is typically operated at a ﬁxed RPM and a ﬁxed brake power (ﬁxed dynamometer load),
and the fuel ﬂow rate (in kg/hr or lb/hr) is measured. The fuel consumption is then given as the
ratio of the fuel ﬂow rate ð _fÞ to the brake power output (Pb). This fuel consumption is known as
the brake-speciﬁc fuel consumption, or BSFC. BSFC is a measurement of the fuel economy of
the engine alone and is given by
BSFC ¼
_f
Pb
(12)
The unit for BSFC is kg/(kW$hr) or (lb/CHp$hr) in British units. By improving the BSFC of
the engine, the fuel economy of the vehicle in which it is installed is also improved. It is
shown later in this chapter that electronic controls can optimize BSFC.
In gasoline-fueled engines, airﬂow into the engine at any operating angular speed (RPM) is
determined by the throttle angular position. In fact, the throttle is the control by the driver that
determines the engine output power.
As explained above, any internal combustion must pump air/fuel into its combustion
chamber. If an IC engine were a perfect air pump, then at wide open throttle the air volume
pumped into the engine for each complete engine cycle (i.e., two complete revolutions) would
be its displacement volume Vd:
Vd ¼ ApSc
(13)
where Ap is the piston cross-sectional area and Sc the cylinder stroke which is the distance
traveled by the piston from TDC to BDC.
Formally, the volumetric efﬁciency ey is deﬁned as the ratio of the mass of fresh mixture
(i.e., air and fuel) that is actually pumped into the cylinder during an intake stroke at inlet air
density to the mass of this mixture, which would ﬁll the cylinder at the inlet air density. The
volumetric efﬁciency for any given engine is determined empirically and varies with throttle
angle, RPM, inlet pressure and temperature as well as exhaust pressure (pe). Assuming
198
Chapter 5

initially that all cylinders receive mixture at identical density the deﬁnition of ey can be
expressed by
ey ¼ 2 _Mi
NVdri
(14)
where _Mi is the air intake mixture mass ﬂow rate (slugs/sec) (or kg/sec), N the number of
revolutions/sec, and ri the inlet mixture density (slugs/ft3) (or kg/m3).
The variable ri is the density of the mixture in the intake system downstream from the throttle
plate in or near a cylinder inlet port. When inlet air density is deﬁned at this point in the intake
system, it provides a measurement of the air pumping efﬁciency of the cylinder and valves
alone. It is this deﬁnition which is used for the present discussion. However, it should be noted
that volumetric efﬁciency could be based on the air density at the input to the intake system
(i.e., upstream of the throttle plate). With air density taken at this point, the volumetric
efﬁciency is termed the overall volumetric efﬁciency. Unfortunately, it is not always convenient
to measure the density of the inlet mixture which consists of air, fuel, and atmospheric water
vapor. On the other hand, since fuel, airﬂow, and water vapor occupy the same volume and have
the same intake volume ﬂow rate ð _ViÞ, the following relationship is valid:
_Vi ¼
_Mi
ri
¼
_Ma
ra
(15)
where _Ma is the mass ﬂow rate of dry air and ra the inlet density of dry air.
For mixtures of air, water vapor, and gaseous or evaporated fuel, Dalton’s law of partial
pressures states:
pi ¼ pa þ pf þ pw
(16)
where pi is the total inlet pressure, pa the partial pressure of air, pf the partial pressure of fuel,
and pw the partial pressure of water vapor.
Each constituent (denoted k) of the inlet air mixture behaves as a perfect gas such that
rk ¼ pk
RTi
(17)
where R is the perfect gas law constant. Also, it can be shown that
pa
pi
¼
Ma=ma
Ma
ma
þ Mf
mf
þ Mw
mw

(18)
The Basics of Electronic Engine Control
199

where Mk¼ mass of constituent k and mk ¼ molecular mass of constituent k:
k ¼ a, f, w
The air density in the mixture ra is given by
ra ¼
 pi
RTi

1 þ Fi
ma
mf

þ ma
mw
h

(19)
where Fi ¼ Mf
Ma
is the fuel/air mass ratio, h the ratio of mass water vapor to the mass of air,
ma ¼ 29, and mw ¼ 18.
In this form it is possible to compute inlet air density from measurements of total inlet air
pressure (pi) and inlet absolute air temperature Ti as well as standard environmental variable
measurements (e.g., relative humidity). As presently shown, Fi is determined by the fuel-
control system to achieve certain engine performance requirements.
As explained earlier in this chapter, the engine power is regulated by the driver via an air
valve in the form of a movable throttle plate in the intake system. Linkage connects the
accelerator pedal to the throttle plate such that it partially restricts airﬂow into the engine.
Typically, the throttle plate is in the form of a circular disk that pivots about a diametric axis in
a cylindrical portion of the intake manifold (e.g., see Figure 5.3). Effectively, the airﬂow into
the engine at any given engine angular speed (RPM) varies in proportion to the opening of this
plate as represented by the throttle angle qT. This empirically determined volumetric
efﬁciency is a convenient variable that can be used to characterize engine pumping efﬁciency
during the development of a new engine control system and can also be used in fuel control of
a production engine as explained later.
Engine Overall Efﬁciency
There are numerous ways to characterize the performance of an engine as indicated above.
One of the most meaningful of these is the efﬁciency with which the engine converts the
energy available in the fuel (in chemical form) to mechanical work. This efﬁciency, which we
denote hm, can be evaluated on an engine cycle by engine cycle basis. However, it is more
convenient to express hm as the ratio of the instantaneous mechanical power delivered to the
load to the rate of change of available energy in the fuel being delivered:
hm ¼ Pm=ðQf _Mf Þ
where Pm is the mechanical power delivered to load (kW), _Mf ¼ d
dtMf the instantaneous mass
ﬂow rate of fuel (kg/sec), and Qf the energy content of fuel (joule/kg).
200
Chapter 5

Calibration
The deﬁnition of engine calibration is the setting of the air/fuel ratio and ignition timing for
the engine for any given operating condition. With the new electronic control systems,
calibration is determined by the electronic engine control system.
As will be shown later in this chapter, electronic engine control systems are based upon
microprocessors or microcontrollers. Under program control, the engine control system
determines the correct fuel delivery amount and the ignition timing as a function of driver
command (via throttle setting) and other operating variables and parameters. Typically, these
correct values are found from a table look-up process with interpolation. The calibration
tables for any given engine conﬁguration are found empirically as described below. As will
also be shown below, an additional component of fuel delivery is determined from a closed-
loop portion of the control.
The majority of present-day engines deliver fuel by means of an individual fuel injector
associated with each cylinder. A fuel injector is essentially an electromechanical valve to
which fuel, under pressure, is supplied. Chapter 6 explains the conﬁguration and operation of
fuel injectors. As will be explained later, each fuel injector delivers fuel in a pulse mode in
which fuel quantity is determined primarily by the duration of fuel delivery at a nominally
constant delivery rate. Another important engine calibration variable for such systems is the
time of fuel delivery relative to cycle for the associated cylinder.
Engine Mapping
The development of any control system comes from knowledge of the plant, or system to be
controlled. In the case of the automobile engine, this knowledge of the plant (the engine)
comes primarily from a process called engine mapping.
For engine mapping, the engine is connected to a dynamometer and operated throughout its
entire speed and load range. Measurements are made of the important engine variables while
quantities, such as the air/fuel ratio and the spark control, are varied in a known and
systematic manner. Such engine mapping is done in engine test cells that have engine
dynamometers and complex instrumentation that collects data under computer control. At
each operating point, calibration is varied and performance is measured. An optimum
calibration can be found that is a compromise between performance and allowable exhaust
gas emission rates under federal regulations.
From the engine mapping a calibration table can be created of optimum values for later
incorporation into the engine control system ROM as explained in Chapter 7. Also, from this
mapping, a mathematical model can be developed empirically that explains the inﬂuence of
every measurable variable and parameter on engine performance. The control system
The Basics of Electronic Engine Control
201

designer can, if desired, select a control conﬁguration, control variables, and control strategy
that will satisfy all performance requirements (including stability) as computed from this
model and that are within the other design limits such as cost, quality, and reliability. To
understand a representative engine control system, it is instructive to consider the inﬂuence of
control variables on engine performance and exhaust emissions.
Effect of Air/Fuel Ratio on Performance
Figure 5.12 illustrates the variation in the performance variables of indicated torque (Ti)
BSFC as well as engine emissions with variations in the air/fuel ratio with ﬁxed spark timing
and a constant engine speed.
In this ﬁgure, the exhaust gases are represented in brake-speciﬁc form. This is a standard way
to characterize exhaust gases whose absolute emission levels are proportional to power. The
deﬁnitions for the brake-speciﬁc emissions rates are
BSHC ¼ brake-speciﬁc HC concentration
¼ r HC
Pb
(20)
BSCO ¼ brake-speciﬁc CO concentration
¼ rCO
Pb
(21)
Figure 5.12:
Typical variation of performance with a variation in air/fuel ratio.
202
Chapter 5

BSNOx ¼ brake-speciﬁc NOx concentration
¼ r NOx
Pb
where rHC is the HC rate of ﬂow, rCO the CO rate of ﬂow, rNOx the NOx rate of ﬂow, and Pb the
brake power. The indicated torque is denoted Ti in Figure 5.12.
One speciﬁc air/fuel ratio is highly signiﬁcant in electronic fuel-control systems, namely, the
stoichiometric mixture. The stoichiometric (i.e., chemically correct) mixture corresponds to
an air and fuel combination such that if combustion was perfect, all the hydrogen and carbon
in the fuel would be converted by the burning process to H2O and CO2. For gasoline, the
stoichiometric mixture ratio is 14.7:1.
Stoichiometry is sufﬁciently important that the fuel and air mixture is often represented by
a ratio called the equivalence ratio, which is given the speciﬁc designation l. The equivalence
ratio is deﬁned as follows:
l ¼
ðair=fuelÞ
ðair=fuel @ stoichiometryÞ
A relatively low air/fuel ratio, below 14.7 (corresponding to l < 1), is called a rich mixture
and an air/fuel ratio above 14.7 (corresponding to l > 1) is called a lean mixture. Emission
control is strongly affected by air/fuel ratio, or by l.
Note from Figure 5.12 that torque (Ti) reaches a maximum in the air/fuel ratio range of
12e14. The exact air/fuel ratio for which torque is maximum depends on the engine
conﬁguration, engine speed, and ignition timing. Also note that the CO and unburned
hydrocarbons tend to decrease with increasing air/fuel ratios, as one might expect because
there is relatively more oxygen available for combustion with lean mixtures than with rich
mixtures.
Unfortunately, for the purposes of controlling exhaust emissions, the NOx exhaust
concentration increases with increasing air/fuel ratios. That is, there is no air/fuel ratio that
simultaneously minimizes all regulated exhaust gases.
Effect of Spark Timing on Performance
Spark advance is the time before top dead center (TDC) when the spark is initiated. It is
usually expressed in number of degrees of crankshaft rotation relative to TDC. Figure 5.13
reveals the inﬂuence of spark timing on brake-speciﬁc exhaust emissions with constant speed
and constant air/fuel ratio for a representative engine. Note that both NOx and HC generally
increase with increased advance of spark timing. BSFC and torque are also strongly
The Basics of Electronic Engine Control
203

inﬂuenced by timing. Figure 5.13 shows that maximum torque occurs at a particular advanced
timing (called advance for mean best torque) denoted MBT.
Operation at or near MBT is desirable since this spark timing tends to optimize performance.
This optimal spark timing varies with RPM. As will be explained, engine control strategy
involves regulating fuel delivery at a stoichiometric mixture and varying ignition timing for
optimized performance. However, there is yet another variable to be controlled, which assists
the engine control system in meeting exhaust gas emission regulations.
Effect of Exhaust Gas Recirculation on Performance
Up to this point in the discussion, only the traditional calibration parameters of the engine
(air/fuel ratio and spark timing) have been considered. However, by adding another control
variable, the undesirable exhaust gas emission of NOx can be signiﬁcantly reduced while
maintaining a relatively high level of torque. This new control variable, exhaust gas
recirculation (EGR), consists of recirculating a precisely controlled amount of exhaust gas
into the intake. The engine control conﬁguration depicted in Figure 5.5 shows that exhaust
gas recirculation is a major subsystem of the overall control system. Its inﬂuence on
emissions is shown in Figures 5.14 and 5.15 as a function of the percentage of exhaust gas
in the intake. Figure 5.14 shows the dramatic reduction in NOx emission when plotted
against air/fuel ratio, and Figure 5.15 shows the effect on performance variables as the
percentage of EGR is increased. Note that the emission rate of NOx is most strongly
Figure 5.13:
Typical variation of performance with spark timing.
204
Chapter 5

inﬂuenced by EGR and decreases as the percentage of EGR increases. The HC emission
rate increases with increasing EGR; however, for relatively low EGR percentages, the HC
rate changes only slightly. Thus, a compromise EGR rate between NOx reduction and HC
increase is possible in which the beneﬁts of EGR on NOx reduction far offset the adverse
effect on HC emissions. This compromise amount of EGR varies with engine
conﬁguration.
Figure 5.14:
NOx emission as a function of air/fuel ratios at various EGR%.
HC
NOx
BSFC
BSHC
BSFC
BSNOx
% EGR
PERFORMANCE
VARIABLES
Figure 5.15:
Inﬂuence of EGR on brake-speciﬁc performance variables.
The Basics of Electronic Engine Control
205

The mechanism by which EGR affects NOx production is related to the peak combustion
temperature. Roughly speaking, the NOx generation rate increases with increasing peak
combustion temperature if all other variables remain ﬁxed. Increasing EGR tends to lower
this temperature; therefore, it tends to lower NOx generation. It should be noted that EGR,
though relatively small, does inﬂuence the air partial pressure in the intake mixture.
Compensation for this effect is required as explained later.
Exhaust Catalytic Converters
It is the task of the electronic control system to set the calibration for each engine-operating
condition. There are many possible control strategies for setting the variables for any given
engine, and each tends to have its own advantages and disadvantages. Moreover, each
automobile manufacturer has a speciﬁc conﬁguration that differs in certain details from
competitive systems. However, this discussion is about a typical electronic control system
that is highly representative of the systems for engines used by U.S. manufacturers. This
typical system is one that has a catalytic converter in the exhaust system. Exhaust gases
passed through this device are chemically altered in a way that reduces tailpipe emissions
relative to engine output exhaust. Essentially, the catalytic converter reduces the
concentration of undesirable exhaust gases coming out of the tailpipe relative to engine-out
gases (the gases coming out of the exhaust manifold).
The EPA regulates only the exhaust gases that leave the tailpipe; therefore, if the catalytic
converter reduces exhaust gas emission concentrations, the engine exhaust gas emissions at
the exhaust manifold can be higher than the EPA requirements. This has the signiﬁcant beneﬁt
of allowing engine calibration to be set for better performance than would be permitted if
exhaust emissions in the engine exhaust manifold had to satisfy EPA regulations. This is the
type of system that is chosen for the typical electronic engine control system.
Several types of catalytic converters are available for use on an automobile. The desired
functions of a catalytic converter include
1.
oxidation of hydrocarbon emissions to carbon dioxide (CO2) and water (H2O)
2.
oxidation of CO to CO2
3.
reduction of NOx to nitrogen (N2) and oxygen (O2)
Oxidizing Catalytic Converter
The oxidizing catalytic converter (Figure 5.16) has been one of the more signiﬁcant devices
for controlling exhaust emissions since the era of emission control began. The purpose of the
oxidizing catalyst (OC) is to increase the rate of chemical reaction, which initially takes place
in the cylinder as the compressed airefuel mixture burns, toward an exhaust gas that has
complete oxidation of HC and CO to H2O and CO2.
206
Chapter 5

The extra oxygen required for this oxidation is often supplied by adding air to the exhaust
stream from an engine-driven air pump. This air, called secondary air, is normally introduced
into the exhaust manifold.
The most signiﬁcant measure of the performance of the OC is its conversion efﬁciency,
hc ¼ Mo
Mic
(22)
where Mo is the mass ﬂow rate of gas that has been oxidized leaving the converter and Mic is
the mass airﬂow rate of gas into the converter
The conversion efﬁciency of the OC depends on its temperature. Figure 5.17 shows the
conversion efﬁciency (expressed as a percent) of a typical OC for both HC and CO as
functions of temperature. Above about 300 degrees C, the efﬁciency approaches 98e99% for
CO and more than 95% for HC.
The Three-Way Catalyst
Another catalytic converter conﬁguration that is extremely important for modern emission
control systems is called the three-way catalyst (TWC). It uses a speciﬁc catalyst formulation
containing platinum, palladium, and rhodium to reduce NOx and oxidize HC and CO all at
the same time. It is called three way because it simultaneously reduces the concentration of all
three major undesirable exhaust gases. The three-way catalyst uses a speciﬁc chemical design
to reduce all three major emissions (HC, CO, and NOx) by approximately 90%.
The conversion efﬁciency of the TWC for the three exhaust gases depends mostly on the
air/fuel ratio. Unfortunately, the air/fuel ratio for which NOx conversion efﬁciency is high,
Figure 5.16:
Catalytic converter conﬁguration.
The Basics of Electronic Engine Control
207

corresponds to a very low conversion efﬁciency for HC and CO and vice versa. However,
as shown in Figure 5.18, there is a very narrow range of air/fuel ratio (called the window
and shown as the lined region in Figure 5.18) in which an acceptable compromise exists
between NOx and HC/CO conversion efﬁciencies. The conversion efﬁciencies within
this window are sufﬁciently high to meet the very stringent EPA requirements established
so far.
Note that this window is only about 0.1 air/fuel ratio wide ( 0.05 air fuel ratio) and is
centered at stoichiometry. (Recall that stoichiometry is the air/fuel ratio that would result in
complete oxidation of all carbon and hydrogen in the fuel if burning in the cylinder were
perfect; for gasoline, stoichiometry corresponds to an air/fuel ratio of 14.7.) This ratio and
the concept of stoichiometry is extremely important in an electronic fuel controller. In fact,
the primary function of most modern electronic fuel-control systems is to maintain average
air/fuel ratio at stoichiometry. The operation of the three-way catalytic converter is
adversely affected by lead. Thus, in automobiles using any catalyst, it is necessary to use
lead-free fuel.
Controlling the average air/fuel ratio to the tolerances of the TWC window (for the full life
requirement) requires accurate measurement of mass airﬂow rate and precise fuel delivery
and is the primary function of the electronic engine control system. A modern electronic fuel-
control system can meet these precise fuel requirements. In addition, it can maintain the
necessary tolerances for government regulations for over 100,000 miles.
CO
HC
100
80
60
40
20
0
200
300
400
500
TEMPERATURE (°C)
CATALYST CONVERSION
EFFICIENCY %
Figure 5.17:
Oxidizing catalyst conversion efﬁciency versus temperature.
208
Chapter 5

The fundamentals of any electronic engine control system are that it regulates the fuel/air
mixture and ignition timing in response to an arbitrary driver input (via the throttle plate). The
driver input includes the accelerator pedal position which ultimately determines the throttle
position. The electronic engine control system directly determines a corresponding fuel
quantity delivered to the engine which optimizes performance subject to a somewhat complex
set of constraints. The constrained optimization involves compromises between the
conﬂicting constraints of emission regulations and required fuel economy. As explained
above, there are other control variables (e.g., spark timing EGR) that are part of the
constrained optimization process.
Electronic Fuel-Control System
For an understanding of the conﬁguration of an electronic fuel-control system, refer to the
block diagram of Figure 5.19. The primary function of this fuel-control system is to determine
the mass airﬂow rate accurately into the engine. Then the control system precisely regulates
fuel delivery such that the ratio of the mass of air to the mass of fuel in each cylinder is as
close as possible to stoichiometry (i.e., 14.7). The components of this block diagram are as
follows:
1.
throttle position sensor (TPS)
2.
mass airﬂow sensor (MAF)
3.
fuel injectors (FI)
4.
ignition systems (IGN)
100
80
60
40
20
0
13
14
15
16
NOx
CO
HC
WINDOW
AIR/FUEL RATIO
 CONVERSION
EFFICIENCY (%)
Figure 5.18:
Conversion efﬁciency of a TWC vs. air/fuel.
The Basics of Electronic Engine Control
209

5.
exhaust gas oxygen sensor (EGO)
6.
engine coolant sensor (ECS)
7.
engine position sensor (EPS)
8.
camshaft position sensor (CPS)
9.
exhaust gas recirculation actuator (EGR)
The EPS has the capability of measuring crankshaft angular speed (RPM) as well as
crankshaft angular position when it is used in conjunction with a stable and precise electronic
clock (in the controller) as explained in Chapter 6. The camshaft position sensor typically
generates a timing pulse for each camshaft revolution (i.e., one complete engine cycle); the
combination of EPS and CPS yields an unambiguous measurement of engine angular position
(within each engine cycle) for each cylinder. The CPS sensor is required in a four-stroke/cycle
engine since each cycle involves two complete crankshaft revolutions as explained above.
The signals from the various sensors enable the controller to determine the correct fuel ﬂow in
relation to the airﬂow to obtain the stoichiometric mixture. From this calculation, the correct
fuel delivery is regulated via fuel injectors (FI). In addition, optimum ignition timing is
determined and appropriate timing pulses are sent to the ignition control module (IGN).
The intake air passes through the individual pipes of the intake manifold to the various
cylinders. The set of fuel injectors (one for each cylinder) are each normally located near the
intake valve within the corresponding cylinder. As explained in Chapter 6, each fuel injector
is an electrically operated valve that is (ideally) either fully open or fully closed. When the
valve is closed, there is, of course, no fuel delivery. When the valve is open, fuel is delivered
at a ﬁxed rate as set by the fuel injector characteristics as well as fuel supply pressure. The
amount of fuel delivered to each cylinder during engine cycle k (Mf (k)) is determined by the
Figure 5.19:
Electronic fuel-control conﬁguration.
210
Chapter 5

length of time sk that the fuel injector valve is open. This time is, in turn, computed in the
engine controller to achieve the desired air/fuel ratio. Typically, the fuel injector open timing
is set to coincide with the time that air is ﬂowing into the cylinder during the intake stroke.
However, at relatively low fuel delivery rates (e.g., near closed throttle), the control system
must account for the relatively short opening and closing fuel injector dynamic transients
response. The control system generates a pulsed electrical signal of sufﬁcient amplitude to
open the fuel injector valve. The duration of this pulse sk regulates the quantity of fuel such
that the mass of fuel delivered (Mf) is given by
Mf ðkÞ ¼
R
tk;nþsk
tk;n
_Mf dt
y _M

tk;n

sk
(23)
where _Mf is the fuel mass ﬂow rate and tk,n the time of fuel delivery to cylinder n during
engine cycle k.
It is assumed for this discussion that Mf(k) is the same for all cylinders during any engine
cycle.
There is an important property of the catalytic converter that allows for momentary (very
short term) ﬂuctuations of the air/fuel ratio outside the narrow window. As the exhaust gases
ﬂow through the catalytic converter, they are actually in it for a short (but nonzero) amount of
time, during which the conversions described above take place. Because of this time interval,
the conversion efﬁciency is unaffected by rapid ﬂuctuations above and below stoichiometry
(and outside the window) as long as the average air/fuel ratio over time remains within the
window centered at stoichiometry provided the ﬂuctuations are rapid enough. A practical
fuel-control system maintains the average mixture at stoichiometry but has minor (relatively
rapid) ﬂuctuations about the average, as explained below.
The electronic fuel-control system operates in two modes: open-loop and closed-loop. Recall
the concepts for open-loop and closed-loop control as explained in Chapter 1. In the open-
loop mode (also called feedforward), the mass airﬂow rate ð _MaÞ into the engine is measured.
Then the fuel-control system determines the quantity of fuel (Mf) to be delivered to meet the
required air/fuel ratio.
In the closed-loop control mode (also called feedback), a measurement of the controlled
variable is provided to the controller (i.e., it is fed back) such that an error signal between the
actual and desired values of the controlled variable is obtained. Then the controller generates
an actuating signal that tends to reduce the error to zero.
In the case of fuel control, the desired variables to be measured are HC, CO, and NOx
concentrations. Unfortunately, there is no cost-effective, practical sensor for such
measurements that can be built into the car’s exhaust system. On the other hand, there is
The Basics of Electronic Engine Control
211

a relatively inexpensive sensor that gives an indirect measurement of HC, CO, and NOx
concentrations. This sensor generates an output that depends on the concentration of residual
oxygen in the exhaust after combustion. As will be explained in detail in Chapter 6, this
sensor is called an exhaust gas oxygen (EGO) sensor. There it is shown that the EGO has
evolved since its introduction in the earliest electronic control systems. For the purposes of
the present chapter we consider the simplest model for an EGO sensor. In this simpliﬁed
model, the EGO sensor output switches abruptly between two voltage levels depending on
whether the input air/fuel ratio is richer than or leaner than stoichiometry. Such a sensor is
appropriate for use in a limit-cycle type of closed-loop control. Although the EGO sensor is
a switching-type sensor, it provides sufﬁcient information to the controller to maintain the
average air/fuel ratio over time at stoichiometry, thereby meeting the mixture requirements
for optimum performance of the three-way catalytic converter.
In a typical modern electronic fuel-control system, the fuel delivery is partly open-loop and
partly closed-loop. The open-loop portion of the fuel ﬂow is determined by measurement of
mass airﬂow. This portion of the control sets the air/fuel ratio at approximately stoichiometry.
A closed-loop portion is added to the fuel delivery to ensure that time-average air/fuel ratio is
at stoichiometry (within the tolerances of the window).
There are exceptions to the stoichiometric mixture setting during certain engine-operating
conditions, including engine start, heavy acceleration, and deceleration. There are also
exceptions due to ambient environmental conditions, particularly engine temperature as well
as ambient air temperature and pressure. These conditions represent a very small fraction of
the overall engine-operating times. They are discussed in Chapter 7, which explains the
operation of a modern, practical digital electronic engine control system.
Engine Control Sequence
The step-by-step process of events in fuel control begins with engine start. During engine
cranking the mixture is set rich by an amount depending on the engine temperature (measured
via the engine coolant sensor), as explained in detail in Chapter 7. Generally speaking, the
mixture is relatively rich for starting and operating a cold engine as compared with a warm
engine. However, the discussion of this requirement is deferred to Chapter 7. Once the engine
starts and until a speciﬁc set of conditions is satisﬁed, the engine control operates in the open-
loop mode.
After combustion, the exhaust gases ﬂow past the EGO sensor, through the TWC, and out the
tailpipe. Once the EGO sensor has reached its operating temperature (typically a few seconds
to about two minutes depending upon ambient conditions and the type of sensor used [see
Chapter 6]), the EGO sensor signal is input to the controller and the system begins closed-
loop operation.
212
Chapter 5

Open-Loop Control
Fuel control for an electronically controlled engine operates open-loop any time the
conditions are not met for closed-loop operation. Among many conditions (which are
discussed in detail in Chapter 7) for closed-loop operations, there are some temperature
requirements. After operating for a sufﬁciently long period after starting, a liquid-cooled
automotive engine operates at a steady temperature.
However, an engine that is started cold initially operates in open-loop mode. This operating
mode requires, at minimum, measurement of the mass airﬂow into the engine, and
a measurement of RPM as well as measurement of coolant temperature. The mass airﬂow
rate measurement in combination with RPM permits computation (by the engine controller)
of the mass of air (Ma) drawn into each cylinder during intake for each engine cycle. The
correct fuel mass (Mf) that is injected with the intake air is computed by the electronic
controller:
Mf ¼ rfaMa
(24)
where rfa is the desired ratio of fuel to air.
For a fully warmed-up engine, this ratio is 1/14.7, which is about .068. That is, 1 lb of fuel is
injected for each 14.7 lb of air, making the air/fuel ratio 14.7 (i.e., stoichiometry). The desired
fuel/air ratio varies with temperature in a known way such that the correct value can be found
from the measurement of coolant temperature. For a very cold engine, the mixture ratio can
go as low as about 2 (i.e., rfay0:5).
Theoretically, if there were no changes to the engine, the sensors, or the fuel injector, an
engine control system could operate open-loop at all times. In practice, owing to errors in
the calculation of Ma, variations in manufactured components, as well as to factors such as
wear, the open-loop control would not be able to maintain the mixture at the desired air/fuel
ratio if it were used alone. In order to maintain the very precise air/fuel mixture ratio
required for emission control over the full life of the vehicle, the engine controller is
operated in closed-loop mode for as much of the time as possible. Compensation for the
open-loop mode variations above is possible via adaptive closed-loop control as explained
in Chapter 7.
Closed-Loop Control
Referring to Figure 5.20, the control system in closed-loop mode operates as follows. For any
given set of operating conditions, the fuel metering actuator provides fuel ﬂow to produce an
air/fuel ratio set by the controller output. This mixture is burned in the cylinder and the
combustion products leave the engine through the exhaust pipe. The EGO sensor generates
The Basics of Electronic Engine Control
213

a feedback signal for the controller input that depends on the exhaust gas oxygen
concentration. This concentration is a function of the intake air/fuel during the intake portion
of the same cycle which is 1.5 crankshaft revolutions earlier than the time at which the EGO
sensor output is measured.
One closed-loop control scheme that has been used in practice (i.e., limit-cycle control)
results in the air/fuel ratio cycling around the desired set point of stoichiometry. The
important parameters for this type of control include the amplitude and frequency of
excursion away from the desired stoichiometric set point. Fortunately, the three-way catalytic
converter’s characteristics are such that only the short-term time-average air/fuel ratio
determines its performance. The variation in air/fuel ratio during the limit-cycle operation is
so rapid that it has no effect on engine performance or emissions, provided that the average
air/fuel ratio remains at stoichiometry.
Exhaust gas oxygen concentration
The EGO sensor, which provides feedback, will be explained in Chapter 6. In essence,
the EGO generates an output signal that depends on the amount of oxygen in the exhaust.
This oxygen level, in turn, depends on the air/fuel ratio entering the engine. The amount
of oxygen is relatively low for rich mixtures and relatively high for lean mixtures. In
terms of equivalence ratio (l), recall that l ¼ 1 corresponds to stoichiometry, l > 1
corresponds to a lean mixture with an air/fuel ratio greater than stoichiometry, and l < 1
corresponds to a rich mixture with an air/fuel ratio less than stoichiometry. (The EGO
sensor is sometimes called a lambda sensor.) Fuel entering each cylinder having
a relatively lean mixture (i.e., excess oxygen) results in a relatively high oxygen
concentration in the exhaust after combustion. Correspondingly, intake fuel and air
having a relatively rich mixture (i.e., low oxygen) result in relatively low oxygen
concentration in the exhaust.
Figure 5.20:
Simpliﬁed typical closed-loop fuel-control system block diagram.
214
Chapter 5

For the purposes of the present chapter, a relatively simple continuous time model for an ideal
EGO sensor output voltage Vo is given in Eqn (25):
VoðtÞ ¼ V1  V2sgn½lðt  tdÞ  1
(25)
where td is the time delay from input mixture for a given engine cycle to the corresponding
exhaust gases reaching the EGO sensor. This time delay which is about three-quarters of the
period of an engine cycle varies inversely with engine RPM. The parameters V1 and V2 are
derived from the pair of actual EGO sensor voltages for l < 1 and l > 1 (see Chapter 6) and
are approximately
V1x:55; V2x:45
Although there are many potential control strategies for a switching-type sensor such as the
EGO sensor, we will illustrate with a relatively straightforward example. Any control system
incorporating a switching sensor (as characterized by the above model) will operate in a form
of limit-cycle type of operation. As explained above, the fuel delivered to any given cylinder
by its fuel injector during the kth engine cycle (Mf(k)) is proportional to the time interval
(sF(k)) of its binary-valued control electrical signal VF(k) (see Figure 5.20). In our present
example controller, the fuel injector (i.e., actuator) control voltage is given by
VFðkÞ ¼ V
tk;n  t < tk;n þ sFðkÞ
¼ 0
tk;n þ sFðkÞ < t < tkþ1;n
(26)
where tk,n is the injection time during kth engine cycle for the nth cylinder.
The fuel injector duration sF(k) consists of an open-loop component so(k) plus a closed-loop
component sFc:
sFðkÞ ¼ soðkÞ þ sFcðkÞ
(27)
where so(k) is calculated based on _Ma measurement.
Closed-Loop Operation
In the present example, the closed-loop portion of the pulse duration sF(k) for each cycle
sFc(k) is a function of the equivalence ratio at the EGO sensor:
sFcðkÞ ¼ sFcðk  1Þ þ ds sgn½lðkÞ  1
(28)
whenever the mixture is lean of stoichiometry (i.e., l > 1), the pulse duration increases by ds
from the previous cycle, thereby richening the mixture (and causing l to decrease toward 1).
The Basics of Electronic Engine Control
215

Correspondingly, whenever l < 1 (rich of stoichiometry), the pulse duration is decreased
from cycle k to cycle k þ 1. The open-loop portion of sF is a pulse whose duration so(k)
(called base pulse duration) is calculated to yield MF corresponding to stoichiometric mixture
based upon mass airﬂow rate _Ma measurements. We illustrate the operation of this example
fuel-control system in Figure 5.20.
Lambda is used in the block diagram of Figure 5.20 to represent the equivalence ratio at the
intake manifold. The exhaust gas oxygen concentration determines the EGO output voltage
(Vo). The EGO output voltage abruptly switches between the lean and the rich levels as the
air/fuel ratio crosses stoichiometry. The EGO sensor output voltage Vo is at its higher of two
levels for a rich mixture and at its lower level for a lean mixture.
Reduced to its essential features, the engine control system operates as a limit-cycle
controller in which the air/fuel ratio cycles up and down about the set point of stoichiometry,
as shown by the idealized waveforms in Figure 5.21. The air/fuel ratio is either increasing or
decreasing; it is never constant. The increase or decrease is determined by the EGO sensor
output voltage. Whenever the EGO output voltage level indicates a lean mixture, the
controller causes the air/fuel ratio to decrease, that is, to change in the direction of a rich
mixture. On the other hand, whenever the EGO sensor output voltage indicates a rich mixture,
the controller changes the air/fuel ratio in the direction of a lean mixture.
The electronic fuel controller changes the mixture by changing the duration of the actuating
signal to each fuel injector. Increasing this duration causes more fuel to be delivered, thereby
(a)
(b)
Figure 5.21:
Simpliﬁed waveforms in a closed-loop fuel-control system.
216
Chapter 5

causing the mixture to become richer. Correspondingly, decreasing this duration causes the
mixture to become leaner. Figure 5.21b shows the fuel injector signal duration.
In Figure 5.21a the EGO sensor output voltage is at the higher of two levels over several
time intervals, including 0e1 and 1.7e2.2. This high voltage indicates that the mixture is
rich. The controller causes the pulse duration (Figure 5.21b) to decrease during this
interval. At time 1 second, the EGO sensor voltage switches low, indicating a lean
mixture. At this point the controller begins increasing the actuating time interval to tend
toward a rich mixture. This increasing actuator interval continues until the EGO sensor
switches high, causing the controller to decrease the fuel injector actuating interval. The
process continues this way, cycling back and forth between rich and lean around
stoichiometry.
The engine controller continuously computes the desired fuel injector actuation duration and
maintains the current value in memory. At the appropriate time in the intake cycle, the
controller reads the value of the fuel injector duration and generates a pulse of the correct
duration to activate the proper fuel injector for the computed time interval sF.
One point that needs to be stressed at this juncture is that the air/fuel ratio deviates from
stoichiometry. However, the catalytic converter will function as desired as long as the time-
average air/fuel ratio is at stoichiometry. The controller continuously computes the average of
the EGO sensor voltage. Ideally, the air/fuel ratio should spend as much time rich of
stoichiometry as it does lean of stoichiometry. In the simplest case, the average EGO sensor
voltage VEGO should be halfway between the rich and the lean values:
VEGO ¼ Vrich þ Vlean
2
(29)
Whenever this condition is not met, the controller adapts its computation of pulse duration
(from EGO sensor voltage) to achieve the desired average stoichiometric mixture. Chapter 7
explains this adaptive control in more detail than is given here.
Frequency and deviation of the fuel controller
Recall from Chapter 1 that a limit-cycle controller regulates a system between two limits
and that it has an oscillatory behavior; that is, the control variable oscillates about the set
point or the desired value for the variable. The simpliﬁed fuel-controller operates in
a limit-cycle mode and, as shown in Figure 5.21, the air/fuel ratio oscillates about
stoichiometry (i.e., average air/fuel ratio is 14.7). The two end limits are determined by
the rich and lean voltage levels of the EGO sensor, by the controller, and by the
characteristics of the fuel metering actuator. The time necessary for the EGO sensor to
sense a change in fuel metering is known as the transport delay. As engine speed
increases, the transport delay decreases.
The Basics of Electronic Engine Control
217

The frequency of oscillation fL of this limit-cycle control system is deﬁned as the
reciprocal of its period. The period of one complete cycle is denoted Tp, which is
proportional to transport delay. Thus, the frequency of oscillation varies inversely with Tp
and is given by
fL ¼ 1
Tp
Furthermore, the transport delay varies inversely with engine speed (RPM). Therefore, the
limit-cycle frequency is proportional to engine speed. This is depicted in Figure 5.22 for
a representative typical engine.
Another important aspect of limit-cycle operation is the maximum deviation of air/fuel ratio
from stoichiometry. It is important to keep this deviation small because the net TWC
conversion efﬁciency is optimum for stoichiometry. The maximum deviation typically
corresponds to an air/fuel ratio deviation of about 1:0. Although the air/fuel ratio is
constantly swinging up and down, the average value of deviation is held within  0:05 of the
14.7:1 ratio. In addition, the limit-cycle frequency and deviation in a practical engine control
are inﬂuenced by hysteresis in the transfer characteristics VF(l) for an actual EGO sensor as
discussed in Chapter 7.
Generally, the maximum deviation decreases with increasing engine speed because of the
corresponding decrease in transport delay. The parameters of the control system are adjusted
such that at the worst case the deviation is within the required acceptable limits for the TWC
used.
600
4000
RPM
60
40
20
6.25
4.1
td(ms)
12.5
fL(Hz)
Figure 5.22:
Typical limit-cycle frequency versus RPM.
218
Chapter 5

The preceding discussion applies only to a simpliﬁed idealized fuel-control system. Chapter
7 explains the operation of practical electronic fuel-control systems in which the calculation
of fuel injector duration is done numerically in a microprocessor-based engine control
system.
Analysis of Intake Manifold Pressure
As explained earlier, fuel control is based on a measurement of mass airﬂow rate and on
regulation of fuel ﬂow to maintain a desired air/fuel ratio. Mass airﬂow measurement can be
accomplished either directly or indirectly via computation based on measurement of other
intake variables. For an understanding of this important measurement, it is helpful to consider
the characteristics of the intake system, and the relationship between the relevant variables.
Figure 5.23 is a very simpliﬁed sketch of an intake manifold. In this simpliﬁed sketch, the
engine is viewed as an air pump pumping air into the intake manifold. Whenever the
engine is not running, no air is being pumped and the intake (MAP) is at atmospheric
pressure. This is the highest intake MAP for a non-supercharged engine. (A supercharged
engine has an external air pump called a supercharger.) When the engine is running, the
airﬂow is impeded by the partially closed throttle plate. This reduces the pressure in the
intake manifold so it is lower than atmospheric pressure; therefore, a partial vacuum
exists in the intake.
If the engine were a perfect air pump and if the throttle plate were tightly closed, a perfect
vacuum could be created in the intake manifold. A perfect vacuum corresponds to zero
absolute pressure. However, the engine is not a perfect pump and some air always leaks past
the throttle plate. (In fact, some air must get past a closed throttle or the engine cannot idle.)
Therefore, the intake MAP ﬂuctuates during the stroke of each cylinder and as pumping is
switched from one cylinder to the next.
MANIFOLD
PRESSURE
AIR FLOW
ENGINE
INTAKE MANIFOLD
THROTTLE PLATE
ATMOSPHERIC
PRESSURE
Figure 5.23:
Simpliﬁed intake system conﬁguration.
The Basics of Electronic Engine Control
219

Each cylinder contributes to the pumping action every second crankshaft revolution. For an
N-cylinder engine, the frequency fp, in cycles per second, of the manifold pressure ﬂuctuation
for an engine running at a certain RPM is given by
fp ¼ N  RPM
120
Figure 5.24 shows manifold pressure ﬂuctuations qualitatively as well as average MAP.
For a control system application, only average manifold pressure is required. The torque
produced by an engine at a constant RPM is approximately proportional to the average value
of MAP. The rapid ﬂuctuations in instantaneous MAP are not of interest to the engine
controller. Therefore, the manifold pressure measurement method should ﬁlter out the
pressure ﬂuctuations at frequency fp and measure only the average pressure. One way to
achieve this ﬁltering is to connect the MAP sensor to the intake manifold through a very small
diameter tube. The rapid ﬂuctuations in pressure do not pass through this tube, but the average
pressure does. The MAP sensor output voltage then corresponds only to the average manifold
pressure. Of course, electronic ﬁltering of the MAP sensor voltage is also possible as
explained in Chapter 1
Measuring Air Mass
A critically important aspect of fuel control is the requirement to measure the mass of air that
is drawn into the cylinder (i.e., the air charge). The amount of fuel delivered can then be
0
TIME
MAP
MANIFOLD
PRESSURE
ATMOSPHERIC
   PRESSURE
Figure 5.24:
Intake manifold pressure ﬂuctuations.
220
Chapter 5

calculated such as to maintain the desired air/fuel ratio. There is no practically feasible way of
measuring the mass of air in the cylinder directly. However, the air charge can be determined
from the mass ﬂow rate of air into the engine intake since all of this air eventually is
distributed to the cylinders (ideally uniformly).
There are two methods of determining the mass ﬂow rate of air into the engine. One
method uses a single sensor that directly measures mass airﬂow rate. The operation of this
sensor is explained in Chapter 6. The other method uses a number of sensors that provide
data from which mass ﬂow rate can be computed. This method is known as the speed-
density method.
Speed-density method
The concept for this method is based on the mass density of air as illustrated in Figure 5.25a.
For a given volume of air (V) at a speciﬁc pressure (p) and temperature (T) having mass Ma,
the density of the air (ra) is given by
ra ¼ Ma
V
(30)
This concept can be extended to moving air, as depicted in Figure 5.25b. Here air is assumed
to be moving through a uniform tube (e.g., the intake pipe for an engine) past a reference
point for a speciﬁc period of time. This is known as the volume ﬂow rate.
Although the speed-density method of measuring _Ma has disappeared from contemporary
engines, it is, perhaps, worthwhile to review it brieﬂy in part because of its existence in older
vehicles and in part to develop an understanding of this engine intake process. Earlier, it was
shown that the mass airﬂow rate _Ma in the engine is given by
_Ma ¼ _Vira
(31)
where ra is the density of the mixture of fuel air and water vapor:
ra ¼ pa
RTi
(32)
with pa being manifold absolute pressure, Ti being inlet air absolute temperature, and R being
constant for and Vi is the volume ﬂow rate.
In the above model, we neglect the relatively small contribution to manifold pressure of water
vapor and assume that fuel is injected at the intake valve location, which is downstream from
the throttle plate.
In Chapter 6, sensors are described for measuring pa (i.e., MAP sensor) and Ti (i.e., inlet air
temperature sensor). Thus, the air density can readily be calculated based on measurements of
The Basics of Electronic Engine Control
221

these sensors. It was also shown earlier in this chapter in the discussion of volumetric
efﬁciency that the air volume ﬂow rate _Vi into the intake is given by
_Vi ¼ ev
N
2 VD
(33)
where
N ¼ RPM
60
VD is the displacement, and ev the volumetric efﬁciency.
Fixed Volume
L
W
H
DENSITY = Ma
V
GIVEN VOLUME
   OF AIR ATT
WITH MASS OF Ma
Vi(ft3/sec)
V
V
V
t3
t2
t1
REFERENCE
POINT
Volume Flowing Past a Point
(a)
(b)
Figure 5.25:
Volume ﬂow rate calculation.
222
Chapter 5

The engine angular speed (N) is readily measured and the volumetric efﬁciency is normally
measured during the engine mapping process. Tables of ev vs. throttle angle and RPM can be
stored in memory for retrieval during a calculation of _Ma in the engine controller. Thus, via
measurement and table look-up, the engine control has sufﬁcient data to calculate (or at least
to closely estimate) _Ma from which fuel delivery quantities are readily computed.
Inﬂuence of Valve System on Volumetric Efﬁciency
For any given engine conﬁguration, volumetric efﬁciency is determined by the intake
manifold, the valve sizes, and locations, as well as the timing and proﬁle of the cam lobe
characteristics. The design of the cam lobe proﬁle determines when the valves open and close
and determines the maximum valve opening (lift). Any given cam proﬁle is optimum only for
a relatively narrow range of RPMs and throttle settings. Compromises are made between low-,
high-, and mid-range RPMs as well as part throttle versus open or closed throttle.
Ideally, it would be desirable to vary valve timing and lift continuously as the engine operates
so as to optimize volumetric efﬁciency. One technology exists for such variable valve timing
(VVT) and is found in certain production vehicles. Variable valve timing is also called
variable valve phasing (VVP) which is the preferred terminology in this book.
This technology involves separate camshafts for intake and exhaust valves. These two
camshafts are driven via a mechanism that varies the relative timing for intake and exhaust.
This mechanism (which includes an electromechanical actuator) and its operation are
explained in Chapter 6. There it is shown that either (or both) intake and exhaust valve timing
is varied relative to the engine cycle. The control strategy for regulating VVP is explained in
Chapter 7.
In essence, the exhaust valve is open primarily during the exhaust stroke and that the intake
valve is open primarily during the intake stroke. Typically in automotive engines, the exhaust
valve remains open during the initial portion of the intake valve-opening period. The
crankshaft angle over which the two valves are both open (or partially open) is called overlap.
Valve overlap permits exhaust action to assist the intake and improve volumetric efﬁciency. It
also permits some exhaust gas to be mixed with intake gases such the EGR system is at least
partially implemented by engine pumping processes. In a variable cam phasing system, this
overlap is minimum at idle and varies with operating conditions to optimize emissions and
performance. This topic is discussed in detail in Chapters 6 and 7.
Including EGR
Calculating _Vi is relatively straightforward in a computer-based control system. Another
factor must be taken into account in determining mass airﬂow rate. Exhaust gas recirculation
requires that a certain portion of the charge into the cylinders be exhaust gas. Because of this,
The Basics of Electronic Engine Control
223

a portion of the displacement VD is exhaust gas. Therefore, the volume ﬂow rate of EGR must
be known. A valve-positioning sensor in the EGR valve can be calibrated to provide the ﬂow
rate.
From this information for the speed-density method of calculating _Ma, the true volume ﬂow
rate of air, _Va, can be determined by subtracting the volume ﬂow rate of EGR ð _VEGRÞ from
_Vi. The total cylinder air charge rate ð _VaÞ is thus given as follows:
_Va ¼ _Vi  _VEGR
(34)
The volume ﬂow rate of EGR is known from the position of the EGR valve and from engine-
operating conditions, as explained in Chapter 7.
Substituting the equation for _Va, the volume ﬂow rate of air is
_Va ¼ NVDev
2
 _VEGR
(35)
Knowing _Va and the density ra gives the mass ﬂow rate of air _Ma as follows:
_Ma ¼ _Vara
(36)
Knowing _Ma the stoichiometric mass ﬂow rate for the fuel, _Mf , can be calculated as follows:
_Mf ¼
_Ma
14:7
(37)
Continuing with the discussion of the speed-density method for measuring _Ma, it is the
function of the fuel metering actuator to set the fuel mass ﬂow rate at this desired value based
on the values of _Va and pa. The control system continuously calculates _Ma from _Va and ra at
the temperature and manifold pressure involved, and generates an output electrical signal to
operate the fuel injectors to produce a stoichiometric mass fuel rate. For a practical engine
control system, it completes such a measurement, computation, and control signal generation
at least once for each cylinder ﬁring.
Idle Speed Control
The operation of an automotive engine at idle involves a special consideration. Under idle
conditions, there is no input to the throttle from the driver via the accelerator pedal. The
engine must produce exactly the torque required to balance all applied load torques from the
transmission and any accessories as well as internal friction and pumping torques in order to
run at a steady idle angular speed (RPM). Certain load torques occur as a result of driver
224
Chapter 5

action (e.g., change in the transmission selector from park or neutral to drive or reverse as
well as switching electrical loads). However, certain other load torques occur without a direct
driver command (e.g., air conditioner clutch actuation).
As in all engine-operating modes, the torque produced by the engine at idle is determined by
the mass ﬂow rate of intake air. The electronic fuel control regulates fuel ﬂow to maintain
stoichiometry as long as the engine is fully warmed and may brieﬂy regulate fuel to somewhat
richer than stoichiometry during cold starts. Normally the electronic engine control is
intended to operate the engine at a ﬁxed RPM regardless of load. It does this by regulating
mass airﬂow with the throttle command from the driver at zero. The airﬂow required to
maintain the desired idle RPM must enter the engine via the throttle assembly with the throttle
at a small but nonzero angle. Alternatively, some engines are equipped with a special air
passage that bypasses the throttle plate. For either method an actuator is required to enable the
electronic engine control system to regulate the idle mass airﬂow rate. Chapter 6 discusses
various actuators having application for idle airﬂow control. For the present discussion, we
assume a model for the idle mass airﬂow rate that is representative of the practical actuator
conﬁgurations discussed in Chapter 6. (Note: In the following analysis, the subscript I is
included for all variables and parameters to emphasize that the present system refers to idle
speed control.)
Regardless of the idle air bypass conﬁguration, the mass airﬂow at idle condition (which we
denote _MaI) is proportional to the displacement of a movable element that regulates the size
of the aperture through which the idle air ﬂows (e.g., the throttle angle qT or its equivalent xT
in an idle bypass structure). For the purposes of the present discussion, we assume that the
engine indicated torque at idle TiI is given by
TiI ¼ KI _MaI
(38)
where KI is the constant for the idle air system; we further assume that _MaI varies linearly
with the position of the idle bypass variable xI:
_MaI ¼ KmxI
(39)
where xI is the opening in the idle bypass passage way and Km the constant for this structure.
Typically, the movable element in the idle air bypass structure incorporates a spring that acts
to hold xI ¼ 0 in the absence of any actuation. The actuation force (or torque) acts on the force
(torque) of this spring as well as the internal force (torque) in accelerating the mass mI (or
moment of inertia for rotating air bypass conﬁguration) of the movable elements and the
friction force (torque). We assume, for the present, a linear model for the actuator motion:
mI€xI þ dI _xI þ kIxI ¼ Kau
(40)
The Basics of Electronic Engine Control
225

where dI is the viscous friction constant, kI the spring rate of restoring spring, u the actuator
input signal, and Ka the actuator constant.
It is also necessary for this discussion of idle speed control to have a model for the
relationship between indicated torque and engine angular speed at idle. To avoid potential
confusion with other frequency variables, we adapt the notation UI for the crankshaft angular
speed of idle (rad/sec). This variable is given by
UI ¼ p RPMI
30
(41)
where
RPMI ¼ RPM at idle
In general for relatively small changes in UI, the load torques (including friction pumping
torques) can be represented by the following linear model:
TLðUIÞ ¼ ReUI
where Re is essentially constant for a given engine/load conﬁguration at a particular operating
temperature. The indicated torque at idle TiI has the following approximate linear model:
Ti y Je _UI þ TLðUÞ
(42)
where Je is the moment of inertia of engine and load rotating components.
Using the Laplace transform methods of Chapter 1, it is possible to obtain the engine transfer
function at idle HeI(s):
HeIðsÞ ¼ UIðsÞ
TiðsÞ
(43)
¼
1
Jes þ Re
(44)
Similarly, the transfer function for the idle speed actuator dynamics HaI(s) is given by
HaIðsÞ ¼ xIðsÞ
uðsÞ
¼
Ka
mIðs2 þ 2zIuIs þ uI 2Þ
(45)
226
Chapter 5

where
uI ¼
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
kI=mI
p
zI ¼
dI
2mIuI
These transfer functions can be combined to yield the transfer function (in standard form) of
the idle speed control “plant” HpI(s):
HpIðsÞ ¼ UIðsÞ
uðsÞ
(46)
¼
KaKmKI
JemI

s2 þ 2zuI þ uI
 
s þ Re
Je

(47)
where u is the control variable that is sent to the actuator.
Open-loop control of idle speed is not practical owing to the large variations in load as well as
parameter changes due to variations in operating environmental conditions. On the other
hand, closed-loop control is well suited to regulating idle speed to a desired value. Figure 5.26
is a block diagram of such an idle speed control system.
Using the analysis procedures of Chapter 1 and denoting the idle speed set point Us, it can be
shown that the idle speed control closed-loop transfer function HCLI is given by
HCLIðsÞ ¼ UIðsÞ
UsðsÞ
¼
HcIðsÞHpIðsÞ
1 þ HsðsÞHcIðsÞHpIðsÞ
(48)
+
–
idle
control
system
actuator
engine
(plant)
engine speed
sensor
Ωs
ΩI
u
xI
HaI(s)
Hs(s)
HeI(s)
HcI(s)
Є
Figure 5.26: Idle speed control system block diagram.
The Basics of Electronic Engine Control
227

where HcI is the transfer function for the idle speed controller and Hs(s) the transfer function
for the crankshaft speed sensor.
In Chapter 1, there were three control strategies introduced: P, PI, and PID. Of these, the
proportional only (P) is undesirable since it has a nonzero steady-state error between UI and
its desired value (Us). It was also shown in Chapter 1 that a proportionaleintegral (PI) control
had zero steady-state error but could potentially yield an unstable closed-loop system.
However, depending upon the system parameters there are ranges of values for both the
proportional gain (Kp) and integral gain (KI) for which stable operation is possible and for
which the idle speed control system has acceptable performance. The controller transfer
function for PI control is given by
HcIðsÞ ¼ Kp þ KI
s ¼ Kp
s þ s0
s

(49)
For the purpose of illustrating exemplary idle speed control performance, we assume the
following set of parameters:
zI ¼ 0:5
uI ¼ 25 rad=sec
ue ¼ Re=Je ¼ 10rad=sec
Knum ¼ KaKmKI ¼ 250
Kden ¼ JemI ¼ 0:05
s0 ¼ KI=Kp ¼ 10
The forward transfer function HF(s) is deﬁned by the following expression:
HFðsÞ ¼ HcIðsÞHpIðsÞ
¼
Knumðs þ s0Þ
Kden½ðs3 þ 2 zuIs2 þ u 2
I sÞðs þ ueÞ
(50)
The present analysis is simpliﬁed by assuming a perfect angular speed sensor such that
Hs(s) ¼ 1. In this case, the closed-loop idle speed control transfer function (HCLI(s)) is
given by
HCLIðsÞ ¼
KpHFðsÞ
1 þ KpHFðsÞ
(51)
The inﬂuence of proportional gain on stability of this closed-loop idle speed control can be
evaluated via root locus techniques as explained in Chapter 1. Figure 5.27 is a plot of the root
locus for this idle speed control with the assumed parameters.
228
Chapter 5

It can be seen from this ﬁgure that the closed-loop poles all begin in the left half complex
plane and are all stable. However, as Kp increases, a pair of poles cross over into the
right half complex plane and are unstable. Using the MATLAB “data cursor” function
under the tools bar on the root locus plot, it can be seen that for Kp ¼ 1.2, the poles that
migrate to the right-hand side of the complex plane are stable and have a damping ratio
of about 25%.
Using this value for Kp (i.e., Kp ¼ 1.2), the closed-loop dynamic response for the system was
examined by commanding a step change in RPM from an initial 550 RPM to 600 RPM at
t ¼ 0.5 s. Figure 5.28 is a plot of the dynamic response of engine idle speed (in RPM) to this
command input.
It can be seen that the idle speed reaches the command RPM after a brief transient response
with zero steady-state error.
The parameters used in this idle speed control simulation are not necessarily representative of
any particular engine. Rather they have been chosen to illustrate characteristics of this
important engine control function. In Chapter 7 where digital engine (powertrain) control is
discussed, a discrete time control is modeled.
Figure 5.27:
Root locus for idle speed control.
The Basics of Electronic Engine Control
229

Electronic Ignition
The engine ignition system exists solely to provide an electric spark to ignite the mixture in
the cylinder. As explained earlier in this chapter, the engine performance is strongly
inﬂuenced by the spark timing relative to the engine position during the compression stroke
(see also Chapter 1). The spark advance (relative to TDC) is determined in the electronic
engine control based on a number of measurements made by sensors. As will be explained in
Chapter 7, the optimum spark advance varies with the intake manifold pressure, RPM, and
temperature.
However, in order to generate a spark at the correct spark advance, the electronic engine
control must have a measurement of the crankshaft angular position within an engine cycle.
The engine position measurement is determined by a sensor coupled to the camshaft and
another coupled to the crankshaft.
Electronic ignition can be implemented as part of an integrated system or as a stand-alone
ignition system. A block diagram for the latter system is shown in Figure 5.29.
Based on measurements from the sensors for engine position, mass airﬂow or manifold
pressure, and RPM, the electronic controller computes the correct spark advance for each
cylinder. At the appropriate time, the controller sends a trigger signal to the driver circuits,
thereby initiating spark. Before the spark occurs, the driver circuit sends a relatively large
current through the primary (P) of the coil. When the spark is to occur, a trigger pulse is sent
Figure 5.28:
Step response of idle speed control.
230
Chapter 5

to the driver circuit to interrupt the current in the primary. A very high voltage is induced at
this time in the secondary (S) of the coil. The physical mechanism by which this interrupted
primary current causes the high voltage in the coil secondary windings is explained in
Chapter 6. This high voltage is applied to the spark plugs, causing them to ﬁre. In those cases
for which a coil is associated with two cylinders, one of the two cylinders will be in this
compression stroke. Combustion will occur in this cylinder, resulting in power delivery
during its power stroke. The other cylinder will be in its exhaust stroke and the spark will have
no effect. Most engines have an even number of cylinders and there can be a separate driver
circuit and coil for each pair of cylinders.
Before proceeding with a discussion of contemporary discrete-time digital control of the
complete powertrain, however, it is necessary to explain and develop models for the critically
important components of a control system: sensors and actuators. Chapter 6 is devoted to
these important components.
Figure 5.29:
Electronic ignition system conﬁguration.
The Basics of Electronic Engine Control
231

This page intentionally left blank

CHAPTER 6
Sensors and Actuators
Chapter Outline
Automotive Control System Applications of Sensors and Actuators
234
Variables to be Measured
236
Airflow Rate Sensor
236
Pressure Measurements
242
Strain gauge MAP sensor
242
Engine Crankshaft Angular Position Sensor
245
Magnetic Reluctance Position Sensor
247
Engine angular speed sensor
256
Timing sensor for ignition and fuel delivery
258
Hall-Effect Position Sensor
259
The Hall-effect
260
Shielded-field sensor
262
Optical Crankshaft Position Sensor
263
Throttle Angle Sensor
265
Temperature Sensors
268
Typical Coolant Sensor
268
Sensors for Feedback Control
270
Exhaust Gas Oxygen Sensor
270
Desirable EGO characteristics
272
Switching characteristics
272
Oxygen Sensor Improvements
274
Knock Sensors
276
Automotive Engine Control Actuators
279
Fuel Injection
284
Fuel injector signal
284
Exhaust Gas Recirculation Actuator
286
Variable Valve Timing
288
VVP Mechanism Model
290
Electric Motor Actuators
292
Brushless DC Motors
301
Stepper Motors
304
Ignition System
304
Ignition Coil Operations
305
Understanding Automotive Electronics. http://dx.doi.org/10.1016/B978-0-08-097097-4.00006-0
Copyright  2012 Elsevier Inc. All rights reserved.
233

The previous chapter introduced two critically important components found in any electronic
control system: sensors and actuators. This chapter explains the operation of the sensors and
actuators used throughout a modern car. Special emphasis is placed on sensors and actuators
used for powertrain (i.e., engine and transmission) applications since these systems often
employ the largest number of such devices. However, this chapter will also discuss sensors
found in other subsystems on modern cars.
In any control system, sensors provide measurements of important plant variables in a format
suitable for the digital microcontroller. Similarly, actuators are electrically operated devices
that regulate inputs to the plant that directly controls its output. For example, as we shall see,
fuel injectors are electrically driven actuators that regulate the ﬂow of fuel into an engine for
engine control applications.
Recall from Chapter 1 that fundamentally an electronic control system uses measurements of
the plant variable being regulated in the closed-loop mode of operation. The measured
variable is compared with a desired value (set point) for the variable to produce an error
signal. In the closed-loop mode, the electronic controller generates output electrical signals
that regulate inputs to the plant in such a way as to reduce the error to zero. In the open-loop
mode, it uses measurements of the key input variable to calculate the desired control variable.
Automotive instrumentation (as described in Chapter 1) also requires measurement of some
variable. For either control or instrumentation applications, such measurements are made
using one or more sensors. However, since control applications of sensors demand more
accurate sensor performance models, the following discussion of sensors will focus on
control applications. The reader should be aware, however, that many of the sensors discussed
below can also be used in instrumentation systems.
As will be shown throughout the remainder of this book, automotive electronics has many
examples of electronic control in virtually every subsystem. Modern automotive electronic
control systems use microcontrollers based on microprocessors (as explained in Chapter 4) to
implement almost all control functions. Each of these subsystems requires one or more
sensors and actuators in order to operate.
Automotive Control System Applications of Sensors and Actuators
In any control system application, sensors and actuators are in many cases the critical
components for determining system performance. This is especially true for automotive
control system applications. The availability of appropriate sensors and actuators dictates the
design of the control system and the type of function it can perform.
The sensors and actuators that are available to a control system designer are not always what
the designer wants, because the ideal device may not be commercially available at acceptable
234
Chapter 6

costs. For this reason, special signal processors or interface circuits often are designed to
adapt an available sensor or actuator, or the control system is designed in a speciﬁc way to ﬁt
available sensors or actuators. However, because of the large potential production run for
automotive control systems, it is often worthwhile to develop a sensor for a particular
application, even though it may take a long and expensive research project to do so.
Although there are many subsystems on automobiles that operate with sensors and actuators,
we begin our discussion with a survey of the devices for powertrain control. To motivate the
discussion of engine control sensors and actuators, it is helpful to review the variables
measured (sensors) and the controlled variables (actuators). Figure 6.1 is a simpliﬁed block
diagram of a representative electronic engine control system illustrating most of the relevant
sensors used for engine control.
As explained in Chapter 5, the position of the throttle plate, sensed by the throttle position
sensor (TPS), directly regulates the airﬂow into the engine, thereby controlling output power.
A set of fuel injectors (one for each cylinder) delivers the correct amount of fuel to
a corresponding cylinder during the intake stroke under control of the electronic engine
controller to maintain the fuel/air mixture at stoichiometry within a narrow tolerance band. A
fuel injector is, as will presently be shown, one of the important actuators used in automotive
electronic application. The ignition control system ﬁres each spark plug at the appropriate
time under control of the electronic engine controller. The exhaust gas recirculation (EGR) is
controlled by yet another output from the engine controller. All critical engine control
functions are based on measurements made by various sensors connected to the engine in an
appropriate way. Computations made within the engine controller based on these inputs yield
output signals to the actuators. We consider inputs (sensors) to the control system ﬁrst, and
then we will discuss the outputs (actuators).
INLET
AIR
TPS
MAF
ENGINE
EGO
EGR
ENGINE
CONTROL
FUEL
INJECTORS
IGNITION
SYSTEM
CRANKSHAFT/
CAMSHAFT
POSITION
SENSOR
COOLANT
TEMPERATURE
SENSOR
Figure 6.1:
Representative electronic engine control system.
Sensors and Actuators
235

Variables to be Measured
The set of variables sensed for any given powertrain is speciﬁc to the associated engine
control conﬁguration. Space limitations for this book preclude a complete survey of all
powertrain control systems and relevant sensor and actuator selections for all car models.
Nevertheless, it is possible to review a superset of possible sensors, which is done in this
chapter, and to present representative examples of practical digital control conﬁgurations,
which is done in the next chapter.
The superset of variables sensed in engine control includes the following:
1.
mass airﬂow (MAF) rate
2.
exhaust gas oxygen concentration
3.
throttle plate angular position
4.
crankshaft angular position/RPM
5.
camshaft angular position
6.
coolant temperature
7.
intake air temperature
8.
ambient air pressure
9.
ambient air temperature
10.
manifold absolute pressure (MAP)
11.
differential exhaust gas pressure (relative to ambient)
12.
vehicle speed
13.
transmission gear selector position
14.
actual transmission gear, and
15.
various pressures.
In addition to measurements of the above variables, engine control is also based on the status
of the vehicle as monitored by a set of switches. These switches include the following:
1.
air conditioner clutch engaged
2.
brake on/off
3.
wide open throttle
4.
closed throttle, and
5.
transmission gear selection.
Airﬂow Rate Sensor
In Chapter 5, we showed that the correct operation of an electronically controlled engine
operating with government-regulated exhaust emissions requires a measurement of the mass
ﬂow rate of air ð _MaÞ into the engine. (Recall from Chapter 1 that the dot in this notation
implies time rate of change.) The majority of cars produced since the early 1990s use
236
Chapter 6

a relatively simple and inexpensive mass airﬂow rate (MAF) sensor. This is normally
mounted as part of the intake air assembly, where it measures airﬂow into the intake manifold.
It is a ruggedly packaged, single-unit sensor that includes solid-state electronic signal
processing. In operation, the MAF sensor generates a continuous signal that varies as
a function of true mass airﬂow _Ma.
Before explaining the operation of the MAF, it is, perhaps, helpful to review the
characteristics of the inlet airﬂow into an engine. It has been shown that a 4-stroke
reciprocating engine functions as an air pump with air pumped sequentially into each cylinder
every two crankshaft revolutions. The dynamics of this pumping process are such that the
airﬂow consists of a ﬂuctuating component (at half the crankshaft rotation frequency)
superposed on a quasi-steady component. This latter component is a constant only for
constant engine operation (i.e., steady power at constant RPM such as might be achieved at
a constant vehicle speed on a level road). However, automotive engines rarely operate at
absolutely constant power and RPM. The quasi-steady component of airﬂow changes with
load and speed. It is this quasi-steady component of _MaðtÞ that is measured by the MAF for
engine control purposes. One way of characterizing this quasi-steady state component is as
a short-term time average over a time interval s (which we denote _MasðtÞ) where
_MasðtÞ ¼ 1
s
Zt
ts
_Maðt0Þdt0
(1)
The integration interval (s) must be long enough to suppress the time-varying component at
the lowest cylinder pumping frequency (e.g., idle RPM) yet short enough to preserve the
transient characteristics of airﬂow associated with relatively rapid throttle position changes.
Alternatively, the quasi-steady component of mass airﬂow can be represented by a low-pass-
ﬁltered version of the instantaneous ﬂow rate. Recall from Chapter 1 that a low-pass ﬁlter
(LPF) can be characterized (in continuous time) by an operational transfer function (HLPF(s))
of the form
HLPFðsÞ ¼ bo þ b1s þ /bmsm
ao þ a1s þ /ansn
(2)
where the coefﬁcients determine the response characteristics of the ﬁlter. The ﬁlter bandwidth
effectively selects the equivalent time interval over which mass airﬂow measurements are
averaged. Of course, in practice with a digital powertrain control system, mass airﬂow
measurements are sampled at discrete times and the ﬁltering is implemented as a discrete time
transformation of the sampled data (see Chapter 2).
A typical MAF sensor is a variation of a classic airﬂow sensor that was known as a hot wire
anemometer and was used, for example, to measure wind velocity for weather forecasting as
Sensors and Actuators
237

well as for various scientiﬁc studies. In the typical MAF, the sensing element is a conductor or
semiconductor thin-ﬁlm structure mounted on a substrate. On the air inlet side is mounted
a honeycomb ﬂow straightener that “smoothes” the airﬂow (causing nominally laminar
airﬂow over the ﬁlm element).
The concept of such an airﬂow sensor is based upon the variation in resistance of the two-
terminal sensing element with temperature. A current is passed through the sensing element
supplying power to it, thereby raising its temperature and changing its resistance. When this
heated sensing element is placed in a moving air stream (or other ﬂowing gas), heat is
removed from the sensing element as a function of the mass ﬂow rate of the air passing the
element as well as the temperature difference between the moving air and the sensing
element. For a constant supply current (i.e., heating rate), the temperature at the element
changes in proportion to the heat removed by the moving air stream, thereby producing
a change in its resistance. A convenient model for the sensing element resistance (RSE) at
temperature (T) is given by
RSEðTÞ ¼ Ro þ KTDT
(3)
where Rois the resistance at some reference temperature Tref (e.g., 0 C), DT ¼ T  Tref, and KT
is the resistance/temperature coefﬁcient. For a conducting sensing element, KT > 0, and for
a semiconducting sensing element, KT < 0.
The mass ﬂow rate of the moving air stream is measured via a measurement of the change in
resistance. There are many potential methods for measuring mass airﬂow via the inﬂuence of
mass airﬂow on the sensing element resistance. One such scheme involves connecting the
element into a so-called bridge circuit as depicted in Figure 6.2.
+
–
R1
V1
i1
i2
V2
vo
R3
R2
RSE(T)
bridge
circuit
differential
amplifier
Figure 6.2:
Mass airﬂow sensor.
238
Chapter 6

In the bridge circuit, three resistors (R1, R2, and R3) are connected as depicted in Figure 6.2
along with a resistive sensing element denoted RSE(T). This sensing element consists of a thin
ﬁlm of conducting (e.g., Ni) or semiconducting material that is deposited on an insulating
substrate. The voltages V1 and V2 (depicted in Figure 6.2) are connected to the inputs of
a relatively high-gain differential ampliﬁer. The output voltage of this ampliﬁer vo is
connected to the bridge (as shown in Figure 6.2) and provides the electrical excitation for the
bridge. This voltage is given by
vo ¼ GðV1  V2Þ
(4)
where G is the ampliﬁer voltage gain
In this bridge circuit, only that sensing element is placed in the moving air stream whose mass
ﬂow rate is to be measured. The other three resistances are mounted such that they are at the
same ambient temperature (Ta) as regards the moving air.
The combination bridge circuit and differential ampliﬁer form a closed-loop in which the
temperature difference DT between the sensing element and the ambient air temperature
remains ﬁxed independent of Ta (which for an automobile can vary by more than 100 C). We
discuss the circuit operation ﬁrst and then explain the compensation for variation in Ta.
For the purposes of this explanation of the MAF operation, it is assumed that the input
impedance at both differential ampliﬁer inputs is sufﬁciently large that no current ﬂows into
either the þ or e input. With this assumption, the differential input voltage DV is given by
DV ¼ V1  V2
(5)
¼ v0

R2
R1 þ R2

RSE
RSE þ R3

(6)
However, it has been shown that vo ¼ GDV, so the following equation can be shown to be
valid:
1
G ¼

R2
R1 þ R2

RSE
RSE þ R3

(7)
In the present MAF sensor conﬁguration, it is assumed (as is often found in practice) that
G >> 1. For sufﬁciently large G, from Eqn (6.7), we can see that RSE is given approximately by
RSEðTÞ ¼ R2R3
R1
(8)
In this case, it can be shown using Eqn (3) that the temperature difference between the sensing
element and the ambient air is given approximately by
Sensors and Actuators
239

kTDT ¼ R2R3
R1
 ½R0 þ kTðTa  TrefÞ
(9)
where Tref is an arbitrary reference temerature.
This temperature difference can be made independent of ambient temperature Ta by the
proper choice of R3, which is called the temperature compensating resistance. In one such
method, R3 is made with the same material but possibly with a different structure as the
sensing element such that its resistance is given by
R3ðTaÞ ¼ R3o þ kT3ðTa  TrefÞ
(10)
where R3o is the resistance of R3 at Ta ¼ Tref and kT3 is the temperature coefﬁcient of R3.
The sensing element temperature difference DT is given by
kTDT ¼
R2R3o
R1
 R0

þ
R2
R1
kT3  kT

Ta  Tref

(11)
If the sensor is designed such that
R2kT3
R1
¼ kT
then DT is independent of Ta and is given by
DT ¼ 1
kT
R2R3o
R1
 Ro

(12)
This temperature difference is determined by the choice of circuit parameters and is
independent of ampliﬁer gain for sufﬁciently large gain (G).
The preceding analysis has assumed a steady mass airﬂow (i.e., _Ma ¼ constant). The mass
airﬂow into an automotive engine is rarely constant, so it is useful to consider the MAF sensor
dynamic response to time-varying _Ma. The combination bridge circuit and differential
ampliﬁer has essentially instantaneous dynamic response to changes in _Ma. The dynamic
response of the MAF of Figure 6.2 is determined by the dynamic temperature variations of the
sensing element. Whenever the mass airﬂow rate changes, the temperature of the sensing
element changes. The voltage vo changes, thereby changing the power PSE dissipated in the
sensing element in such a way as to restore DT to its equilibrium value. An approximate
model for the dynamic response of DT to changes in _Ma is given by
D _T þ DT
sSE
¼ a1PSE  a2 _Ma
(13)
where PSE ¼ i2
2RSE:
¼

vo
RSE þ R3
2
RSE
240
Chapter 6

In equation 13, i2 ¼ current shown in Figure 6.2
sSE ¼ sensing element time constant
and where a1 and a2 are constants for the sensing element conﬁguration.
The Laplace methods of analysis in Chapter 1 are not applicable for solving this nonlinear
differential equation for the exact time variation of TSE. However, a well-designed sensing
element has a sufﬁciently short time constant sSE such that the variation in DT is negligible. In
this case, the change in power dissipation from the zero airﬂow condition is given by
a1½PSEð _MaÞ  PSEð0Þ ¼ a2 _Ma
(14)
It can be shown from Eqn (14) that MAF sensor output voltage varies as given below:
voð _MaÞ ¼ ½v2
oð0Þ þ KMAF _Ma1=2
(15)
where KMAF is the constant for the MAF conﬁguration.
As an example of this variation, Figure 6.3 is a plot of the sensor voltage vs. airﬂow for
a production MAF sensor. This example sensor uses a Ni ﬁlm for the sensing element.
The conversion of MAF to voltage is nonlinear, as indicated by the calibration curve depicted
in Figure 6.3 for the example MAF sensor. Fortunately, a modern digital engine controller can
convert the analog bridge output voltage directly to mass airﬂow by simple computation. As
will be shown in Chapter 7, in which digital engine control is discussed, it is necessary to
Figure 6.3:
Output voltage for example MAF vs. mass ﬂow rate g/s.
Sensors and Actuators
241

convert analog sensor voltage from the MAF to a digital format. The analog output of the
differential ampliﬁer can be sampled and converted to digital format using an A/D converter
(see Chapter 4). The engine control system can calculate _Ma from vo using the known
functional relationship voð _MaÞ.
Pressure Measurements
There are numerous potential applications for measurement of pressure (both pneumatic
and hydraulic) at various points in the modern automobile, including ambient air pressure,
intake manifold absolute pressure, tire pressure, oil pressure, coolant system pressure,
transmission actuation pressure, and several others. In essentially all such measurements,
the basis for the measurement is the change in an electrical parameter or variable (e.g.,
resistance and voltage) in a structure that is exposed to the pressure. Space limitations
prevent us from explaining all of the many pressure sensors used in a vehicle. Rather, we
illustrate pressure-type measurements with the speciﬁc example of intake manifold
pressure (MAP). Although it is obsolete in contemporary vehicles, the speededensity
method (discussed in Chapter 5) of calculating mass airﬂow in early emission regulation
vehicles used such an MAP sensor.
Strain gauge MAP sensor
One relatively inexpensive MAP sensor conﬁguration is the silicon-diaphragm diffused strain
gauge sensor shown in Figure 6.4. This sensor uses a silicon chip that is approximately
3 millimeters square. Along the outer edges, the chip is approximately 250 mm
(1 mm ¼ 106 m) thick, but the center area is only 25 mm thick and forms a diaphragm. The
edge of the chip is sealed to a Pyrex plate under vacuum, thereby forming a vacuum chamber
between the plate and the center area of the silicon chip.
A set of sensing resistors is formed around the edge of this chamber, as indicated in
Figure 6.4. The resistors are formed by diffusing a doping impurity into the silicon. External
connections to these resistors are made through wires connected to the metal bonding pads.
This entire assembly is placed in a sealed housing that is connected to the intake manifold by
a small-diameter tube. Manifold pressure applied to the diaphragm causes it to deﬂect.
Diaphragm deﬂection in response to an applied pressure results in a small elongation of the
diaphragm along its surface. The elongation of any linear isotropic material of length L
corresponds to the length becoming L þ dL in response to applied pressure. For linear
deformation, dL << L. The elongation is quantitatively represented by its strain ˛, which is
given by
˛¼ dL
L
(16)
242
Chapter 6

In any diaphragm made from a linear material the strain is proportional to the applied
pressure (p):
˛¼KDp
(17)
where KD is a constant which is determined by the diaphragm conﬁguration (e.g., its shape
and area exposed to p as well as its thickness).
The resistance of the sensing resistors changes in proportion to the applied manifold pressure
by a phenomenon that is known as piezoresistivity. Piezoresistivity occurs in certain
semiconductors so that the actual resistivity r (the reciprocal of conductivity) changes in
proportion to the strain. The strain induced in each resistor is proportional to the diaphragm
deﬂection, which, in turn, is proportional to the pressure on the outside surface of the
diaphragm. For a MAP sensor, this pressure is the manifold absolute pressure.
Figure 6.4:
Exemplary manifold pressure sensor conﬁguration.
Sensors and Actuators
243

An electrical signal that is proportional to the manifold pressure is obtained by connecting the
resistors in a circuit called a Wheatstone bridge, as shown in the schematic of Figure 6.5a.
The voltage regulator holds a constant dc voltage (Vs) across the bridge. The resistors diffused
into the diaphragm are denoted R1, R2, R3, and R4 in Figure 6.5a. When there is no strain on
the diaphragm, all four resistances are equal, and the bridge is balanced, which means that the
voltage between points A and B is zero. When manifold pressure changes, it causes these
resistances to change in such a way that R1 and R3 increase by an amount that is proportional
to pressure; at the same time, R2 and R4 decrease by an identical amount. This unbalances the
bridge and a net difference voltage is present between points A and B. The differential
ampliﬁer generates an output voltage proportional to the difference between the two input
voltages (which is, in turn, proportional to the pressure), as shown in Figure 6.5b.
Figure 6.5:
Example MAP sensorr circuit.
244
Chapter 6

We illustrate the operation of this sensor with the following model. The voltage at point A is
denoted VA and at point B as VB. The resistances R1 and R3 are given by
Rnð˛Þ ¼ Ro þ R˛˛
n ¼ 1; 3
(18)
where
R˛ ¼ dR
d˛

˛¼o
> 0
(19)
For resistances R2 and R4, the model for resistance is given by
Rmð˛Þ ¼ Ro  R˛˛
m ¼ 2; 4
(20)
The voltages VA and VB are given respectively by
VA ¼ VS

R3
R3 þ R4

¼ VS
ðRo þ R˛˛Þ
2Ro
(21)
VB ¼ VS

R2
R2 þ R4

¼ VS
ðRo  R˛˛Þ
2Ro
(22)
The voltage difference VA VB is given by
VA  VB ¼ VS
R˛˛
Ro
(23)
The differential ampliﬁer output voltage (Vo) is given by
Vo ¼ GAðVA  VBÞ
(24)
¼ GA
VSR˛˛
Ro
(25)
where GA is the ampliﬁer voltage gain. Since the sensor strain is proportional to pressure, the
output voltage is also proportional to the applied pressure:
Vo ¼ GA
VSR˛
Ro
KDp
This pressure signal can be input to the digital control system via sampling and an analog-to-
digital converter (see Chapter 2).
Engine Crankshaft Angular Position Sensor
Another important measurement for electronic engine control is the angular position of the
crankshaft relative to a reference position. The crankshaft angular position is often termed the
Sensors and Actuators
245

“engine angular position” or simply “engine position.” It will be shown that the sensor for
measuring crankshaft angular position can also be used to calculate its instantaneous angular
speed. It is highly desirable that this measurement be made without any mechanical contact
with the rotating crankshaft. Such noncontacting measurements of any rotating shafts (i.e., in
engine or drivetrain) can be made in a variety of ways, but the most common of these in
automotive electronics use magnetic or optical phenomena as the physical basis. Magnetic
means of such measurements are generally preferred in engine applications since they are
unaffected by oil, dirt, or other contaminants.
The principles involved in measuring rotating shafts can be illustrated by one of the most
signiﬁcant applications for engine control: the measurement of crankshaft angular position or
angular velocity (i.e., RPM). Imagine the engine as viewed from the rear, as shown in
Figure 6.6. On the rear of the crankshaft is a large, circular steel disk called the ﬂywheel that is
connected to and rotates with the crankshaft. A point on the ﬂywheel is denoted the ﬂywheel
mark, as shown in Figure 6.6. A reference line is taken to be a line through the crankshaft axis
of rotation and a point (b) on the engine block. For the present discussion, the reference line is
taken to be a horizontal line. The crankshaft angular position is the angle between the
reference line and the line through the axis and the ﬂywheel mark.
Imagine that the ﬂywheel is rotated so that the mark is directly on the reference line. This is an
angular position of zero degrees. For our purposes, assume that this angular position
corresponds to the No. 1 cylinder at TDC (top dead center) on either intake or power strokes.
As the crankshaft rotates, this angle increases from zero to 360 in one revolution. However,
one full engine cycle from intake through exhaust requires two complete revolutions of the
crankshaft; that is, one complete engine cycle corresponds to the crankshaft angular position
going from zero to 720. During each cycle, it is important to measure the crankshaft position
Figure 6.6:
Illustration of crankshaft angular position representation.
246
Chapter 6

relative to the reference for each cycle in each cylinder. This information is used by the
electronic engine controller to set ignition timing and, in most cases, to set the fuel injector
pulse timing.
In automobiles with electronic engine control systems, angular position qe can be sensed on
the crankshaft directly or on the camshaft. Recall that the piston drives the crankshaft directly,
while the valves are driven from the camshaft. The camshaft is driven from the crankshaft
through a 1:2 reduction drivetrain, which can be gears, belt, or chain. Therefore, the camshaft
rotational speed is one-half that of the crankshaft, so the camshaft angular position goes from
zero to 360 for one complete engine cycle. Either of these sensing locations can be used in
electronic control systems. Although the crankshaft location is potentially superior for
accuracy because of torsional and gear backlash errors in the camshaft drivetrain, many
production systems locate this sensor such that it measures camshaft position. For
measurement of engine position via a crankshaft sensor, an unambiguous measurement of the
crankshaft angular position relative to a unique point in the cycle for each cylinder requires
some measurement of camshaft position as well as crankshaft position. Typically, it is
sufﬁcient to sense camshaft position at one point in a complete revolution. At the present
time, there appears to be a trend toward measuring crankshaft position directly rather than
indirectly via camshaft position. In principle, it is sufﬁcient for engine control purposes to
measure crankshaft/camshaft position at a small number of ﬁxed points. The number of such
measurements (or samples), for example, could be determined by the number of cylinders.
Magnetic Reluctance Position Sensor
One noncontacting engine sensor conﬁguration that measures crankshaft position directly
(using magnetic phenomena) is illustrated in Figure 6.7.
This sensor consists of a permanent magnet with a coil of wire wound around it. A steel disk
that is mounted on the crankshaft (usually in front of the engine) has tabs that pass between
the pole pieces of this magnet. In Figure 6.7 for illustrative purposes, the steel disk has four
protruding tabs, which is the minimum number of tabs for an 8-cylinder engine. In general,
there are N tabs where N is determined during the design of the engine control system. The
passage of each tab could correspond, for example, to the TDC position of a cylinder on its
power stroke, although other reference positions are also possible. The crankshaft position q
at all other times in the engine cycle are given by
q  qn ¼
Zt
tn
uðtÞdt
tn < t < tnþ1
(26)
where qn is the angular position of the nth tab relative to a reference line, tn is the time of
passage of the nth tab associated with the reference point for the corresponding cylinder
Sensors and Actuators
247

during the nth engine cycle, and u is the instantaneous crankshaft angular speed. Of course,
the times tn are determined in association with camshaft reference positions. The camshaft
sensor provides a reference point in the engine cycle that determines the index n above. The
precision in determining engine position within each cycle for each cylinder is improved by
increasing the number of tabs on the disk.
The sensor in Figure 6.7 (as well as any magnetic sensor) incorporates one or more
components of its structure which are of a ferromagnetic material such as iron, cobalt, or
nickel, or any of the class of manufactured magnetic materials (e.g., ferrites). Performance
analysis and/or modeling of automotive sensors based upon magnetic phenomena, strictly
speaking, requires the determination of the magnetic ﬁelds associated with the conﬁguration.
The full, precise, and accurate determination of the magnetic ﬁeld distributions for any sensor
conﬁguration is beyond the scope of this book. However, approximate analysis of such
magnetic ﬁelds for structures having relatively simple geometries is possible with the
introduction of the following simpliﬁed theory for the associated magnetic ﬁeld distributions.
The magnetic ﬁeld in a material is described by a pair of ﬁeld quantities that can be compared
to the voltage and current of an ordinary electric circuit. One of these quantities is called the
magnetic ﬁeld intensity vector H. It exerts a force analogous to voltage. The response of the
magnetic circuit to the magnetic ﬁeld intensity is described by the second vector, which is
called magnetic ﬂux density vector B, which is analogous to current. In these two quantities,
the over bar indicates that each is a vector quantity.
Figure 6.7:
Magnetic crankshaft angular position sensor conﬁguration.
248
Chapter 6

The structure of any practical magnetic sensor (which provides noncontact measurement
capability) will have a conﬁguration that consists, at least, in part of ferromagnetic material.
Ferromagnetism is a property of the transition metals (iron, cobalt, and nickel) and certain
alloys and compounds made from them. Magnetic ﬁelds in these materials are associated with
electron spin for each atom. Physically, such materials are characterized by small regions
called domains, each having a magnetic ﬁeld associated with it due to the parallel alignment of
the electron spins (i.e., each domain is effectively a tiny permanent magnet). If no external
magnetic ﬁeld is applied to the material, the magnetic ﬁeld directions of the domains are
randomly oriented and the material creates no permanent external magnetic ﬁeld. Whenever an
external magnetic ﬁeld is applied to a ferromagnetic material, the domains tend to be reoriented
such that their magnetic ﬁelds tend to align with the external ﬁeld, thereby increasing the
external magnetic ﬂux density in the direction of the applied magnetic ﬁeld intensity.
Figure 6.8 illustrates the functional relationship of the scalar magnitudes B(H) for a typical
ferromagnetic material having a conﬁguration such as is depicted in Figure 6.7.
Flux density B
Residual
flux density
Initial
magnetization
curve
Coercive
force
–Bm
–Hc
Hc
Bm
Hm
–Hm
Br
–Br
μ
Hi
Figure 6.8:
Magnetization curve for exemplary ferromagnetic material.
Sensors and Actuators
249

The externally applied magnetic ﬁeld intensity Hi is created by passing a current through the
coil of N turns. If the material is initially unmagnetized and the current is increased from zero,
the B(Hi) follows the portion labeled “initial magnetization curve.” The arrows on the curves
of Figure 6.8 indicate the direction of the change in Hi. The contribution of the ferromagnetic
material to the ﬂux density is called magnetization M and is given by
M ¼ B
mo
 Hi
(27)
where mo is the magnetic permeability of free space.
For a sufﬁciently large applied Hi (e.g., Hi > Hm), all of the domains are aligned with the
direction of H and B saturates such that (B  Bm) ¼ mo (Hi  Hm), where Hm and Bm are
depicted in Figure B-1. If the applied ﬁeld is reduced from saturation to zero, the
ferromagnetic material has a nonzero ﬂux density denoted Br in Figure B-1 and the
corresponding magnetization Mr (called remanent magnetization) causes the material to
become a permanent magnet. Essentially, all ferromagnetic materials exhibit hysteresis in the
B(H) relationship as depicted in Figure 6.8. Certain ferromagnetic materials have such a large
remanent magnetization that they are useful in providing a source of magnetic ﬁeld for some
automotive sensors. The structure depicted in Figure 6.7 is such a sensor.
Normally, in automotive sensors, the signals involved correspond to relatively small
incremental changes in B and H about a steady value. For example, the sensor of Figure 6.7
operates with small B and H incremental changes about the remanent magnetization such that
B is given approximately by
B ¼ Br þ mHi
(28)
where
m ¼ dB
dHi

Hi¼0
¼ incremental permeability of the ferromagnetic materials
(29)
The straight line of Figure 6.8 passing through B ¼ Br, Hi ¼ 0 has slope m as deﬁned above.
Ferromagnetic materials have very high incremental permeability relative to nonmagnetic
materials. For sensor regions that can be described by the scalar model (i.e., B ¼ mH), the
incremental permeability is given by
m ¼ mrmo
where mo is the permeability of free space and mr is the relative permeability of the material.
For any ferromagnetic material mr >> 1.
250
Chapter 6

From electromagnetic theory, there is an important fundamental equation, which is useful in
the present analysis of any magnetic automotive sensor. That equation relates the contour
integral of H along a closed contour C and is given by
I
C
H$d‘ ¼ IT
(30)
where IT is the total current passing normal to and through the surface enclosed by C. This
integral equation will be shown to be useful for analyzing magnetic automotive sensors of the
type depicted in Figure 6.7.
Another relationship that is useful for developing the model for a magnetic sensor is
continuity of the normal component of B at the interface of any two materials. This continuity
is expressed by the relationship
B1$^n ¼ B2$^n
(31)
where B1 and B2 are the magnetic ﬂux densities in two materials at their interface and ^n is the
unit vector normal to the surface at the interface. These two important fundamental equations
are used in the modeling of the sensor of Figure 6.7 and other similar magnetic sensors.
The path for the magnetic ﬂux of the sensor of Figure 6.7 is illustrated in Figure 6.9.
In Figure 6.9, gc is the width of the gap in the pole piece and tT is the thickness of the steel
disk. For a conﬁguration such as is shown in Figure 6.9, the lines of constant magnetic ﬂux
follow paths as indicated in the ﬁgure. The following notation is used:
Bm is the ﬂux density within the ferromagnetic material,
Hm is the magnetic ﬁeld intensity within the ferromagnetic material,
Bg is the ﬂux density within air gaps, and
Hg is the magnetic ﬁeld intensity within air gaps.
Figure 6.9:
Magnetic circuit of the sensor of Figure 6.7.
Sensors and Actuators
251

From Eqn (30) above, the following equation can be written for the contour shown in
Figure 6.9:
Z
C
H$d‘yHgga þ HmLm
(32)
where ga is the total air gap length along contour C, Lm is the total length along contour C
within the material, and C is the closed path along line of constant B.
We consider ﬁrst the open circuit case in which IT ¼ 0. In this case, the air gap magnetic ﬁeld
intensity Hg is given by
Hgy  HmLm=ga
(33)
From Eqn (31), the following equation can be written for the interface between the
ferromagnetic material and the air gap:
Bg$^ng ¼ Bm$^nm
However, since the lines of magnetic ﬂux are normal to this interface
Bg$^ng ¼ Bg
and
Bm$^nm ¼ Bm
or
Bg ¼ Bm
ðat the interfaceÞ
That is, the magnetic ﬂux density for the conﬁguration of Figure 6.9 is constant along the path
denoted therein. Within the material, the following relationship is valid:
Bm ¼ moðHm þ MrÞ
¼ Bg
¼ moHg
(34)
where Mr is the remanent magnetization of the pole piece. Thus, we can write
Hm ¼ Hg  Mr
(35)
For a magnetized ferromagnetic material Mr >> Hg such that
Hgy  Mr
(36)
252
Chapter 6

Combining Eqns (29) and (30), the ﬂux density is given by
Bg ¼ moHg
¼ mo
MrLm
ga
(37)
Eqn (37) shows that the magnitude of B around the contour C varies inversely with the size
of the air gap along that path. Note that when one of the tabs of the steel disk is located
between the pole pieces of the magnet, a large part of the gap between the pole pieces is ﬁlled
by the steel. The total air gap ga in this case is given by ga ¼ gc e tT. On the other hand, when
a tab is not positioned between the magnet pole pieces, the total air gap is gc. Since B varies
inversely with the size of the air gap for the conﬁguration of Figure 6.8, it is much larger
whenever any of the tabs is present than when none are present. Thus, the magnitude of the
magnetic ﬂux that “ﬂows” through the magnetic circuit depends on the position of the tab,
which, in turn, depends on the crankshaft angular position.
The magnetic ﬂux is least when none of the tabs is near the magnet pole pieces. As a tab begins
to pass through the gap, the magnetic ﬂux increases. It reaches a maximum when the tab is
located symmetrically between the pole pieces, and then decreases as the tab passes out of the
pole piece region. In any control system employing a sensor such as that of Figure 6.7, the
position of maximum magnetic ﬂux has a ﬁxed relationship to TDC for one of the cylinders.
An approximate model for the sensor conﬁguration of Figure 6.7 is developed as follows
using the model developed above for B(ga). The terminal voltage Vo (according to Faraday’s
law) is given by the time rate of change of the magnetic ﬂux linking the N turns of the coil:
Vo ¼ N dF
dt
where
F ¼
Z
Ac
Bds
¼ moMrLmAc
ga
where Ac ¼ hcwc
The integral is taken over the cross-sectional area of the coil Ac (i.e., orthogonal to the contour
of constant ﬂux density). However, since the ﬂux density is essentially constant around this
contour C, the integral can be taken in the gap.
Sensors and Actuators
253

When the tabs are far away from the magnetic piece, the ﬂux density magnitude is
approximately given by
B ¼ moMrLm
gc
and gc is the pole piece gap.
In this case, the magnetic ﬂux F is given to close approximation by
F z moMrLmhcwc
gc
(38)
where wc is the width of the magnet normal to the page.
When the tab moves between the pole pieces, the ﬂux increases roughly in proportion to the
projected overlap of the tab and gap cross-sectional areas reaching a maximum when the tab
is symmetrically located between the pole faces. The value for F when the tab is located
symmetrically is given approximately by
F ¼ moMrLmhcwc
ðgc  tTÞ
(39)
The sensor terminal voltage, which is proportional to the time derivative of this ﬂux, reaches
a maximum and then crosses zero at the point when the tab is centered between the pole
pieces. It then decreases and is antisymmetric about the center point as depicted in
Figure 6.10. The zero crossing of this voltage pulse is a convenient point for crankshaft and
camshaft position measurements.
In the theory of electromagnetism, the ratio F/M for a structure such as is depicted in
Figure 6.8 is known as “reluctance” and is denoted <, which is given by
< ¼ moLmhcwc
ga
Since the air gap ga varies with the position of the steel disk in the sensor depicted in
Figure 6.7, this sensor is often termed a “variable reluctance sensor.” It is, in fact, an inductive
variable reluctance sensor since its output voltage is generated only when the magnetic ﬂux
changes with time.
One of the disadvantages of the inductive type of variable reluctance sensor as depicted in
Figure 6.7 is that it only produces a nonzero voltage when the shaft is moving. Static engine
timing such as was used in preemission-regulated vehicles is impossible with this type of
variable reluctance-type sensors. However, it will be shown later in this chapter that there are
noncontacting magnetic position sensor conﬁgurations that are capable of static timing.
254
Chapter 6

Another disadvantage of the inductive variable reluctance angular position sensor is the
variation in the zero crossing point with angular speed due to the impedance characteristics of
the sensor. The precise timing requirements of modern digital engine control require that
some compensation be made for the slight variation in timing reference of this sensor due to
its source impedance. Figure 6.11 gives an equivalent circuit for this sensor in which the open
circuit voltage source is represented by the voltage waveform of Figure 6.10b. In this ﬁgure,
Ls represents the inductance of the coil, which varies somewhat with steel disk angular
position. The source resistance (Rs) is primarily the physical resistance of the coil wire but
includes a component due to energy losses in the magnetic material.
Typically, these parameters are determined empirically for any given sensor conﬁguration.
The load impedance (resistance) of the signal processing circuitry is denoted R‘. When the
Figure 6.10:
Variable reluctance sensor voltage.
Ls
Rs
R
V
Vo
Figure 6.11:
Equivalent circuit for variable reluctance sensor.
Sensors and Actuators
255

sensor of Figure 6.7 is connected to signal processing circuitry, the exact zero-crossing point
of its terminal voltage can potentially vary as a function of RPM. The variation in zero-
crossing point is associated with the phase shift of the circuit of Figure 6.11. At any sinusoidal
frequency u the approximate phase shift 4(u) between vo and v‘ is given by
f ¼ tan1
 uLs
Rs þ R‘

where Ls is the inductance when the tab lies within the pole piece. The exact variation with
RPM can be determined empirically such that compensation for this error can be done in the
electronic engine control system. Compensation for such variations in the zero-crossing point
is important for precise fuel delivery and ignition timing as explained in Chapter 7.
Figure 6.7 illustrates a sensor having a ferromagnetic disk with four protruding tabs, which is
a useful conﬁguration for an eight-cylinder engine. However, engine position can readily be
measured with the number of tabs being more than ½ the number of cylinders. For crankshaft
position measurement, it is only necessary for the angular position of the tabs relative to
crankshaft reference line position to be known. In fact, the precision and accuracy of
crankshaft position can theoretically be improved with an increase in the number of tabs.
On the other hand, an increase in the number of tabs for a practical sensor increases the sensor
excitation frequency (us) for a given crankshaft angular speed. This increased excitation
frequency increases the phase shift fðusÞ of the signal applied to a load resistance (R‘) by an
amount given by
fðusÞ ¼ tan1
 nusLs
Rs þ R‘

n ¼ 1; 2.
for each harmonic (n) component of the sensor output voltage. Typically, the crankshaft
angular position is sensed at the zero crossings of the sensor output voltage as explained
above. The phase shift associated with the sensor inductance introduces errors in this zero-
crossing point relative to the actual tab center. However, this phase error is reduced by
increasing load resistance (R‘). Any compensation for this error via calculation in the digital
engine control system is a unique process for any speciﬁc sensor/signal processing
conﬁguration.
Engine angular speed sensor
An engine angular speed sensor is needed to provide an input for the electronic controller for
several functions. The crankshaft angular position sensor discussed previously can be used to
measure engine speed. The reluctance sensor is used in this case as an example; however, any
of the other position sensor techniques could be used as well. Refer to Figure 6.7 and notice
that the four tabs will pass through the sensing coil once for each crankshaft revolution.
256
Chapter 6

For each crankshaft revolution, there are four voltage pulses of a waveform depicted
qualitatively in Figure 6.10b. For a running engine, the sensor output consists of a continuous
stream of such voltage pulses. We denote the time of the nth zero crossing of voltage Vo
(corresponding to TDC for a cylinder) as tn. With this notation, the sensor output voltage is
characterized by the following relationships:
VoðtnÞ ¼ 0
dVo
dt

t¼tn
< 0
(40)
The crankshaft angular speed (ue(t) in rad/sec) is given by
ueðtÞ ¼
2p
Mðtnþ1  tnÞ
(41)
where M ¼ number of tabs (four in the example illustrated in Figure 6.6). Thus,
a measurement of the time between any pair of successive zero crossings of vo can be used by
a digital controller to calculate crankshaft angular speed.
One convenient way to measure this time interval is via the use of a binary counter and a high-
frequency oscillator (clock). A high-frequency clock is a required component for the
operation of a microprocessor/microcontroller as described in Chapter 4. A digital subsystem
is readily conﬁgured to start counting the clock at time tn and stop counting at tnþ1. The
contents of the binary counter will contain the binary equivalent of Bc where
Bc ¼ fcðtnþ1  tnÞ
(42)
Then, in one scheme, the time from tnþ1 to tnþ2 can be used for the digital control to access Bc
for later computation of ue.
Control of this counting process can be implemented with a circuit known as a zero-crossing
detector (ZCD). This circuit responds to the zero-crossing event at each tn by producing an
output pulse VZCD of the form
VZCD ¼ V1
tn  t  tn þ sZCD
¼ V2
tn þ sZCD < t < tnþ1
(43)
where the time interval sZCD << (tnþ1  tn) at all engine speeds and V1 is a voltage that
corresponds to binary 1 in a digital system and V2 to binary 0.
The ZCD pulse can be used to control an electronic switch (gate) to alternately supply
oscillator pulses to the binary counter or stop the counting. The ZCD, gate and counter can be
implemented by ad hoc dedicated circuitry or within the controller/microprocessor (see
Chapter 4).
Sensors and Actuators
257

Timing sensor for ignition and fuel delivery
As explained above, the combination of crankshaft and camshaft angular position
measurements is sufﬁcient to unambiguously determine the instantaneous position in the cycle
for each cylinder. The measurement of engine position via crankshaft and camshaft position
sensors (as well as its use in timing fuel delivery and ignition) is described in Chapter 7.
Normally, it is sufﬁcient to measure camshaft position at a single ﬁxed point in each camshaft
revolution. Such a measurement of camshaft position is readily achieved by a magnetic sensor
similar to that described above for the crankshaft position measurement.
This sensor detects a reference point on the angular position of the camshaft that deﬁnes the
beginning of a complete engine cycle. Once this reference point has been detected, crankshaft
position measurements (as described above) provide sufﬁcient information for timing fuel
injection pulses and ignition.
In one scheme, a variable reluctance sensor is located near a ferromagnetic disk on the
camshaft. This disk has a notch cut as shown in Figure 6.12 (or it can have a protruding tab).
The disk provides a low-reluctance path (yielding high magnetic ﬂux) except when the notch
aligns with the sensor axis. Whenever the notch aligns with the sensor axis, the reluctance of
this magnetic path is increased because the permeability of air in the notch is very much lower
than the permeability of the disk. This relatively high reluctance through the notch causes the
magnetic ﬂux to decrease and produces a change in sensor output voltage.
As the camshaft rotates, the notch passes under the sensor once for every two crankshaft
revolutions. The magnetic ﬂux abruptly decreases, then increases as the notch passes the
sensor. This generates a pulse in the sensor output voltage vo that can be used in electronic
control systems for timing purposes. For the conﬁguration depicted in Figure 6.12, the sensor
output voltage resembles that of Figure 6.9b with a polarity reversal; that is, the output
voltage satisﬁes the conditions
Figure 6.12:
Exemplary camshaft angular sensor conﬁguration.
258
Chapter 6

Vo < 0
t < Tnotch
Vo > 0
t > Tnotch
where Tnotch is the time at which the notch is symmetrically located along the magnet axis.
The precise camshaft angular location is determined by the zero crossing of the sensor output
voltage.
Hall-Effect Position Sensor
As mentioned previously, one of the main disadvantages of the magnetic reluctance sensor is
its lack of output when the engine is not running. A crankshaft position sensor that avoids this
problem is the Hall-effect position sensor. This sensor can be used to measure either camshaft
position or crankshaft position.
A Hall-effect position sensor is shown in Figure 6.13. This sensor is similar to the reluctance
sensor in that it employs a steel disk having protruding tabs and a magnet for coupling the
disk to the sensing element. Another similarity is that the steel disk varies the reluctance of
the magnetic path as the tabs pass between the magnet pole pieces. This sensor is useful for
measuring the angular position q of any shaft (e.g., crankshaft) relative to a reference line. Its
operation depends upon a phenomenon known as the Hall-effect. For convenience, this
reference line is the intersection of the vertical plane of symmetry of the magnet with the ﬂat
surface of the disk. In Figure 6.13, qn is the angle between the reference line and the center of
the nth tab as shown.
Figure 6.13:
Representative Hall-effect sensor conﬁguration.
Sensors and Actuators
259

The Hall-effect
The Hall element is a thin, ﬂat slab of semiconductor through which a current I caused by an
applied external potential Vs is ﬂowing. Figure 6.14 depicts a Hall element in the form of
a semiconductor slab of length Lx, width Ly, and depth d that has an applied voltage Vs with
current I.
In this conﬁguration, there is a uniform magnetic ﬁeld in the z direction (i.e., normal to the
page). Although the electric ﬁeld intensity Es due to the applied voltage Vs is a function of
position in the material, for a relatively long, thin slab of semiconductor (i.e., Lx >> Ly >> d)
it is nearly uniform over much of the sample and given approximately by
Es y Vs
Lx
^x ¼ Ex^x
(44)
where ^x is a unit vector in the x direction. The concentrations of electrons and holes in this
material are denoted n and p, respectively. In the absence of the magnetic ﬁeld, the current
that would ﬂow is given by
I ¼
ZLy
o
Zd
o
Jxdydz
(45)
where Jx is the current density (i.e., the current/unit area across any y, z plane):
Jx ¼ q½nvex þ pvhx
(46)
I
y
x
thickness = d
Jy
Vo
Vs
Ēs
Jx
Lx
Ly
Figure 6.14:
Schematic illustration of Hall-effect sensor.
260
Chapter 6

where
vex ¼ meEx ¼ electron drift velocity,
vhx ¼ mhEx ¼ hole drift velocity
and where n and p are the electron and hole concentrations and me and mn are the electron and
hole mobilities, respectively.
However, when the magnetic ﬂux density (B) is nonzero, there is a force acting on the
electrons and holes known as the Lorentz force FLe (electrons) and FLh (holes), which are
proportional to the vector product of B and velocities ðve and vhÞ:
FLe ¼ qve  B
(47)
FLh ¼ qvh  B
where B ¼ Bz^z and ^z is the unit vector in the z direction.
This Lorentz force acts on the electrons and holes causing them to drift in the y direction
creating a current ﬂow in this direction represented by current density Jy:
Jy ¼ q½ pvhy þ nvey
If (as is the usual case) the input impedance of the differential ampliﬁer A in Figure 6.13
is extremely large, Jy x 0 which means that pvhy ¼ nvey. The charge carriers will
drift orthogonal to Jx and Bz creating an electric ﬁeld Ey whose strength cancels the Lorentz
force.
The strength of this y directed electric ﬁeld is given by
Ey ¼ RHJxBz
where RH is the Hall-effect coefﬁcient.
The terminal voltage of the sensor Vo is given by
Vo ¼
ZLy=2
Ly=2
Eydx
yEyLy ¼ RHJxBzLy
Thus, the Hall-effect sensor generates an open circuit voltage that is proportional to the
x-directed current density Jx and to the magnetic ﬂux density Bz.
The operation of the angular position sensor conﬁguration depicted in Figure 6.13 is based
upon the variation of magnetic ﬂux density normal to the Hall element and its relationship to
Sensors and Actuators
261

the terminal voltage Vo derived above. Recall that the magnetic ﬂux density is essentially
constant along a closed path through the magnetic pole pieces and across the two gaps.
This ﬂux density has a relatively low magnitude for all shaft positions for which the
protruding tabs are away from the lower gap shown in Figure 6.13. As a tab approaches this
gap, it begins to ﬁll the gap with a ferromagnetic material having a much higher magnetic
permeability than air. The magnitude of the ﬂux density increases in proportion to the
projected overlap area of the tab on the magnet pole face (i.e., the face orthogonal to the
magnetic path). This magnetic ﬂux density reaches a maximum when any of the tabs is
symmetrically located within the magnet’s lower gap. If the angular position of the nth tab is
denoted qn (as shown in Figure 6.13), then the terminal voltage Vo of the sensor has
a waveform as depicted in Figure 6.15; that is, the terminal voltage reaches a maximum
whenever qn ¼ 0 (n ¼ 1,2.N) where N ¼ number of tabs. Thus, this sensor produces
a voltage pulse of the general waveform of Figure 6.15 each time a tab passes through the gap.
As in the case of the active variable reluctance sensor discussed above, if this sensor is used
for crankshaft position measurement, it must be combined with a camshaft angular position
sensor (possibly also a Hall-effect sensor) for unambiguous timing within each engine cycle,
as explained above.
Shielded-ﬁeld sensor
Figure 6.16a shows another concept that uses the Hall-effect element in a way different
from that just discussed. In this method, the Hall element is normally exposed to a magnetic
ﬁeld and produces an output voltage. When one of the tabs passes between the magnet and
the sensor element, the low-reluctance values of the tab and disk provide a path for the
magnetic ﬂux that bypasses the Hall-effect sensor element, and the sensor output drops to
near zero. Note in Figure 6.16b that the waveform is just the opposite of the one in
Figure 6.15.
Figure 6.15:
Hall sensor output voltage waveform.
262
Chapter 6

Optical Crankshaft Position Sensor
In a sufﬁciently clean environment, a shaft position can also be sensed using optical
techniques. Figure 6.17 illustrates such a system. Again, as with the magnetic system, a disk
is directly coupled to the crankshaft. This time the disk has holes in it that correspond to the
number of tabs on the disks of the magnetic systems. Mounted on each side of the disk are
ﬁber-optic light pipes. The hole in the disk allows transmission of light through the light pipes
from the light-emitting diode (LED) source to the phototransistor used as a light sensor. Light
would not be transmitted from source to sensor when there is no hole because the solid disk
blocks the light. On the other hand, whenever a disk hole is aligned with one of the ﬁber-optic
light pipes, light from the LED passes through the disk to the phototransistor.
The light-emitting diode used as a light source for this sensor has an increasing number of
other applications in automotive systems including lighting (e.g., brake lights, turn signals,
and instrumentation displays). The theory of operation of the LED is explained in Chapter 9.
LEDs are made from a variety of semiconductor materials and are available in wavelength
regions from infrared through ultraviolet depending upon material, fabrication and excitation
voltage. There is even now a white light LED.
The other important component of the optical position sensor of Figure 6.17a is the
phototransistor. A bipolar phototransistor has essentially the conﬁguration of a conventional
transistor having collector, base, and emitter regions. However, instead of injecting minority
carriers into the base region via an electrical source (i.e., via base current ib) the received light
Figure 6.16:
Shielded-ﬁeld Hall-effect sensor.
Sensors and Actuators
263

performs this function. The phototransistor is constructed such that light from a source is
focused onto the junction region. The energy bandgap of the base region DEg (i.e., the gap in
allowable electron energy from the top of the valence band to the bottom of the conduction
band e see Chapter 3) determines the wavelength of light to which the phototransistor
responds.
Figure 6.17b depicts an NPN phototransistor and its grounded emitter circuit conﬁguration.
The collectorebase junction is reverse biased. Incoming light of illumination level P is
focused by a lens arrangement onto the base (b) region of the phototransistor. When photons
of the incoming light are absorbed in the base region, they create charge carriers that are
equivalent to the base current of a conventional bipolar transistor. As explained in Chapter 3,
increases in base region carriers cause the collectoreemitter current to increase.
Consequently, the collector current Ic varies linearly with P and is given by
Ic ¼ Io þ bgP
(48)
FIBER-OPTIC
LIGHT PIPE
LIGHT-EMITTING
DIODE
AMPLIFIER
PHOTOTRANSISTOR
SENSED DISK
HOLE
(a)
(b)
A
Vo
VL
RL
Ic
Vcc
c
b
e
Phototransistor and circuit
P
Figure 6.17:
Optical angular position sensor.
264
Chapter 6

where b ¼ grounded emitter current gain
g ¼ conversion constant from light intensity to equivalent base current.
The load voltage VL is given by
VL ¼ Vcc  IcRL
¼ Vcc  RLðIo þ bgPÞ
(49)
Each time a hole in the disk passes the ﬁber-optic light path depicted in Figure 6.17a, the
load voltage will be a high-to-low voltage pulse. The ampliﬁer can be conﬁgured with
a negative voltage gain such that its output will be a positive voltage pulse at the time any hole
passes the optical path. These voltage pulses can be used to obtain the angular position of
a rotating shaft (e.g., crankshaft) in a way similar to the magnetic position sensors explained
above.
One of the problems with optical sensors is that they must be protected from dirt and oil;
otherwise, the optical path has unacceptable transmissivity. On the other hand, they have the
advantages that they can sense position without the engine running and that the pulse
amplitude is essentially constant with variation in speed.
Throttle Angle Sensor
Still another variable that must be measured for electronic engine control is the throttle plate
angular position. In most automobiles, the throttle plate is linked mechanically to the
accelerator pedal and moves with it. When the driver depresses the accelerator pedal, this
linkage causes the throttle plate angle to increase, allowing more air to enter the engine and
thereby increasing engine power.
Measurement of the instantaneous throttle angle is important for control purposes, as will be
explained in Chapter 7. Most throttle angle sensors are essentially potentiometers. A
potentiometer consists of a resistor with a movable contact, as illustrated in Figure 6.18.
The basis for the throttle angle position sensor is the inﬂuence of geometric size and shape on
the resistance of a conductive material. To illustrate this relationship, consider the resistance
of a long section of a conductor of length L with a uniform cross-sectional area A with
a voltage VS applied at the ends along the long axis. As long as the lateral dimensions are
small compared with length (i.e.,
ﬃﬃﬃ
A
p
<< L), the current density is essentially uniform across
the cross-sectional area. The current density of a current ﬂowing through this area J is related
to the electric ﬁeld intensity E along the conductor long axis by
J ¼ sE
(50)
Sensors and Actuators
265

where s is the conductivity of the material. The total current through the conductor I for
uniform J is given by
I ¼
R
A
Jds
yJA
(51)
where the integral is taken over the cross-sectional area of the conductive material.
Furthermore, the terminal voltage at the conductor ends is given by
V ¼ 
ZL
o
Edx y EL
(52)
where the x coordinate is along the long axis. The voltage relative to ground (at x ¼ 0) varies
linearly with position x:
VðxÞ ¼ VSx
L
0  x  L
(53)
The resistance R of this conductor is deﬁned as
R ¼ V
I
¼ EL
sEA
(54)
J
E
x
L
resistive
material
movable
contact
Vs
Vo
Figure 6.18:
Potentiometer schematic circuit
266
Chapter 6

R ¼ Lr
A
(55)
where r ¼ 1/s ¼ material resistivity (ohm m).
Consider now a resistive material formed in a segment of a circle of radius r as depicted in
Figure 6.19. Let the radial dimension and the thickness of the material be uniform and small
compared to the circumferential distance along the arc (ra). A movable metallic contact that
pivots about the center of the circular arc makes contact with the resistive material at an
angle a (measured from a line through the center and the grounded end of the resistive
material). The opposite end of the material (at an angle amax) is connected to a constant
voltage Vs. A structure such as that depicted in Figure 6.19 is known as a rotary
potentiometer (or just as a potentiometer). Let the total resistance from the end of the
material which is connected to Vs be denoted Rp and the resistance from the movable contact
to ground at any angle a be denoted R(a). With the assumptions of uniform geometry given
above, this resistance varies linearly with arc length ra. Thus, the resistance R(a) can be
shown to be given by
RðaÞ ¼ Rpa
amax
(56)
Figure 6.19:
Throttle angle sensor: a potentiometer.
Sensors and Actuators
267

The current I ﬂowing into this potentiometer is given by
I ¼ Vs
Rp
(57)
The open circuit voltage at the movable contact V(a) is given by
VðaÞ ¼ IRðaÞ
¼ Vs
Rp
RðaÞ
¼ Vs
a
amax
(58)
A potentiometer is made by connecting the movable contact to a shaft at the pivot point whose
axis is orthogonal to the plane of the conductor. If this shaft is mechanically connected to
another rotary shaft (e.g., the throttle plate pivot shaft), the conﬁguration of Figure 6.19 is
a sensor for measuring the angular position (a) of that other shaft. In the case of the throttle
plate shaft, this potentiometer constitutes a throttle angle sensor in which the voltage V(a)
provides a measurement of the throttle angle and thereby yields a measurement of the driver
command for engine power. For digital engine control, the voltage V(a) must be converted to
digital format using an analog-to-digital converter.
Temperature Sensors
Temperature (T) is an important parameter throughout the automotive system. In the
operation of an electronic fuel control system it is vital to know the temperature of the
coolant, the temperature of the inlet air, and the temperature of the exhaust gas oxygen sensor
(a sensor to be discussed in the next section). Several sensor conﬁgurations are available for
measuring these temperatures, but we can illustrate the basic operation of most of the
temperature sensors by explaining the operation of a typical coolant sensor. The temperature
sensor for any given application is designed to meet the expected temperature range. For
example, a coolant, temperature sensor experiences far lower temperatures than a sensor
exposed to exhaust gases.
Typical Coolant Sensor
A typical coolant sensor, shown in Figure 6.20, consists of a thermistor mounted in a housing
that is designed to be inserted in the coolant stream. This housing is typically threaded such
that it seals the assembly against coolant leakage.
A thermistor is a two-terminal semiconductor whose resistance varies inversely with its
temperature. The theory of operation is based upon the inﬂuence of temperature on the charge
carrier concentrations which, in turn, depend upon the difference in energy between the
268
Chapter 6

valence and conduction band and which are an exponential function of temperature. The
resistance of a thermistor is a nonlinear function of temperature that can be modeled over
a given temperature range by a polynomial function of T.
However, a relatively commonly used model that is valid over the range of coolant
temperatures represents the thermistor resistance RTas a logarithmic function of T is given by
‘nðRTÞ ¼ A
T  B
(59)
where, for an exemplary sensor, the coefﬁcients are approximately
A y 5000, B y 3.96, and T is the absolute temperature (K).
The sensor is typically connected in an electrical circuit like that shown in Figure 6.21, in
which the coolant temperature sensor resistance is denoted RT. This resistance is connected to
a reference voltage through a ﬁxed resistance R. The sensor output voltage, VT, is given by the
following equation:
VT ¼ V
RT
R þ RT
(60)
Figure 6.20:
Coolant temperature sensor.
Figure 6.21:
Temperature sensor circuit.
Combining equations 59 and 60 yields the following equation for temperature T:
T ¼ A=fB þ ‘n ½VTR=ðV  VTÞg
Sensors and Actuators
269

The terminal voltage VT is input to the digital engine control system (e.g., via an A/D
converter) where RT is computed from VT. Then, temperature is obtained using the model for
RT(T) given above or another model (e.g., polynomial).
Sensors for Feedback Control
The sensors that we have discussed until now have been part of the open-loop (i.e.,
feedforward) control. Next, we consider sensors that are appropriate for feedback engine
control. Recall from Chapter 5 that feedback control for fuel delivery is based on maintaining
the air/fuel ratio at stoichiometry (i.e., 14.7:1). The primary sensor for fuel control is the
exhaust gas oxygen sensor.
Exhaust Gas Oxygen Sensor
Recollect from Chapter 5 that the amount of oxygen in the exhaust gas is used as an indirect
measurement of the intake air/fuel ratio. As a result, one of the most signiﬁcant automotive
sensors in use today is the exhaust gas oxygen (EGO) sensor. This sensor is often called
a lambda sensor from the Greek letter lambda (l), which is commonly used to denote the
equivalence ratio (as deﬁned in Chapter 5):
l ¼
ðair=fuelÞ
ðair=fuel=@ stoichiometry
(61)
Whenever the air/fuel ratio is at stoichiometry, the value for l is 1. When the airefuel mixture
is lean, the condition is represented by l > 1. Conversely, when the airefuel mixture is rich,
the condition is represented by (l < 1).
The two types of EGO sensors that have been used are based on the use of active oxides of
two types of materials. One uses zirconium dioxide (ZrO2) and the other uses titanium
dioxide (TiO2). The former is the most commonly used type today. Figure 6.22a is
a photograph of a typical ZrO2 EGO sensor. Figure 6.22b schematically depicts the mounting
of the sensor on the exhaust system. Figure 6.22c schematically shows the structure of the
individual components and the way in which the exhaust gas acts on the EGO sensor.
In essence, the EGO sensor consists of a thimble-shaped section of ZrO2 with thin platinum
electrodes on the inside and outside of the ZrO2. The inside electrode is exposed to air, and the
outside electrode is exposed to exhaust gas through a porous protective overcoat.
A simpliﬁed explanation of EGO sensor operation is based on the distribution of oxygen ions.
Oxygen ions have two excess electrons such that the ions are negatively charged. The ZrO2
has a tendency to attract the oxygen ions, which accumulate on the ZrO2 surface just inside
the platinum electrodes.
270
Chapter 6

The platinum plate on the air reference side of the ZrO2 is exposed to a much higher
concentration of oxygen ions than the exhaust gas side. The air reference side becomes
electrically more negative than the exhaust gas side; therefore, an electric ﬁeld exists across
the ZrO2 material and a voltage, Vo, results. The polarity of this voltage is positive on the
exhaust gas side and negative on the air reference side of the ZrO2. The magnitude of this
voltage depends on the concentration of oxygen in the exhaust gas and on the sensor
temperature.
The quantity of oxygen in the exhaust gas is represented by the oxygen partial pressure.
Basically, this partial pressure is that proportion of the total exhaust gas pressure slightly
above (but nearly at atmospheric pressure) that is due to the concentration of oxygen in the
EXHAUST GAS
Sensor mounted in exhaust manifold
EXHAUST GAS
ELECTRODES
POROUS PROTECTIVE
OVERCOAT
AIR
Inside the sensor tip
AIR
+
_
+
_
Vo
Vo
Zr O2
(a)
(b)
(c)
Figure 6.22:
Illustration of EGO sensor.
Sensors and Actuators
271

composite exhaust gas. The exhaust gas oxygen partial pressure for a rich mixture varies over
the range of 1016e1032 of atmospheric pressure. The oxygen partial pressure for a lean
mixture is roughly 102 atmosphere. Consequently, for a rich mixture there is a relatively low
oxygen concentration in the exhaust and a higher EGO sensor output voltage. For a fully
warmed EGO sensor, the output voltage is about 1 volt for a rich mixture and about 0.1 V for
a lean mixture.
Desirable EGO characteristics
The EGO sensor characteristics that are desirable for the type of limit-cycle fuel control
system that was discussed in Chapter 5 are as follows:
1.
abrupt change in voltage at stoichiometry,
2.
rapid switching of output voltage in response to exhaust gas oxygen changes,
3.
large difference in sensor output voltage between rich and lean mixture conditions, and
4.
stable voltages with respect to exhaust temperature.
Switching characteristics
The switching time for the EGO sensor also must be considered in control applications. An
ideal characteristic for a limit-cycle controller is shown in Figure 6.23. The arrow pointing
down indicates the change in Vo as the air/fuel ratio was varied from rich to lean. The up arrow
indicates the change in Vo as the air/fuel ratio was varied from lean to rich. Note that this EGO
sensor has switching characteristics with hysteresis. A model for the ideal EGO sensor was
used in Chapter 5 for explaining closed-loop fuel control in which the hysteresis was taken to
be negligible.
Figure 6.23:
Switching characteristics of ideal EGO sensor.
272
Chapter 6

Figure 6.24 depicts the actual sensor voltage/equivalence ratio characteristics for
a common commercially available (fully warned) EGO sensor. Comparing this sensor’s
characteristics to that of the ideal sensor characteristics shows that the voltage drop from
a rich mixture to lean has a ﬁnite slope and occurs on the lean side of stoichiometry.
Furthermore, the EGO sensor terminal voltage is a continuous function of l. This voltage is
also a continuous function of l for a lean to rich transfer but has a very steep slope at l ¼ 1.
Temperature affects switching times and output voltage. Switching times at two temperatures
are shown in Figure 6.25. Note that the time per division is twice as much for the display at
350 C as at 800 C. This means that the switching times are roughly 0.1 second at 350 C,
whereas at 800 C they are about 0.05 s. This is a 2:1 change in switching times due to
changing temperature.
The temperature dependence of the EGO sensor output voltage is very important. The graph
in Figure 6.26 shows the temperature dependence of an EGO sensor output voltage for lean
and rich mixtures and for two different load resistances e 5 MU and 0.83 MU. The EGO
sensor output voltage for a rich mixture is in the range of about 0.80e1.0 V for an exhaust
temperature range of 350e800 C. For a lean mixture, this voltage is roughly in the range of
0.05e0.07 V for the same temperature range.
Under certain conditions, the fuel control using an EGO sensor will be operated in open-loop
mode and for other conditions it will be operated in closed-loop mode (as will be explained in
Chapter 7). The EGO sensor should not be used for control at temperatures below about
300 C because the difference between rich and lean voltages decreases rapidly with
temperature in this region. This important property of the sensor is partly responsible for the
requirement to operate the fuel control system in the open-loop mode at low exhaust
Figure 6.24:
Commercial EGO sensor voltage vs. l.
Sensors and Actuators
273

temperatures. Closed-loop operation with the EGO output voltage used as the error input
cannot begin until the EGO sensor temperature exceeds about 300 C. Open-loop mode
operation is undesirable since exhaust emission regulation is not as reliable as closed-loop
operation particularly as a vehicle ages and engine parameters can change. Although it is
important to hasten the change from open- to closed-loop operation (particularly during
a cold engine start), the EGO sensor voltage must be sufﬁcient for closed-loop operation.
Oxygen Sensor Improvements
Improvements have also been made in the exhaust gas oxygen sensor, which remains today
the primary sensor for closed-loop operation in cars equipped with the three-way catalyst. As
we have seen, the signal from the oxygen sensor is not useful for closed-loop control until the
sensor has reached a temperature of about 300 C. Typically, the temperature of the sensor is
too low during the starting and engine warm-up phase, and it can also be too low during
relatively long periods of deceleration. It is desirable to return to closed-loop operation in as
LEAN-TO-RICH
100MS
50MS
a. At 350ºC
b. At 800ºC
1000MV
0MV
V0
V0
1000MV
0MV
LEAN-TO-RICH
RICH-TO-LEAN
RICH-TO-LEAN
Figure 6.25:
EGO sensor switching transients.
274
Chapter 6

short a time as possible. Thus, the oxygen sensor must reach its minimum operating
temperature in the shortest possible time.
An improved exhaust gas oxygen sensor has been developed that incorporates an electric
heating element inside the sensor, as shown in Figure 6.27. This EGO sensor is known as the
heated exhaust gas oxygen, or HEGO, sensor. The heat current is automatically switched on
and off depending on the engine operating condition. When available in a vehicle
conﬁguration, an exhaust gas temperature sensor can closely estimate the HEGO temperature.
Heating can then be applied as necessary to reach closed-loop operation as soon as possible.
The heating element is made from resistive material and derives heat from the power
dissipated in the associated resistance. The HEGO sensor is packaged in such a way that this
Figure 6.26:
EGO sensor temperature characteristics.
Sensors and Actuators
275

heat is largely maintained within the sensor housing, thereby leading to a relatively rapid
temperature rise.
Normally, the heating element need only be turned on for cold-start operations. Shortly after
engine start, the exhaust gas has sufﬁcient heat to maintain the EGO sensor at a suitable
temperature.
Knock Sensors
Another sensor having applications in closed-loop engine control is the so-called knock
sensor. As explained in Chapter 7, this sensor is employed in closed-loop ignition timing to
prevent undesirable knock. Although a more detailed explanation of knock is given in
Chapter 7, for the purposes of this chapter it can be described generally as a rapid rise in
cylinder pressure during combustion. It does not occur normally, but only under special
conditions. It occurs most commonly with high manifold pressure and excessive spark
advance and at relatively high combustion temperatures. It is important to detect knock and
avoid excessive knock; otherwise, there may be damage to the engine.
As will be explained in Chapter 7, one way of controlling knocking is to sense when knocking
begins and then retard the ignition until the knocking stops. A key to the control loop for this
method is a knock sensor.
Knock sensors fundamentally detect impulsive acoustical signals associated with the rapid
pressure rise of cylinder pressure. The phenomenon is called knock because the acoustical
signal associated with it is in the audio range and sounds like a “knock.” It is characterized by
a short, relatively intense, pulse followed by rapidly decaying oscillations in the few KHz
range depending on engine conﬁguration. The associated cylinder pressure waveform is
depicted in Chapter 7 in Figure 7.11.
The conﬁguration of a representative knock sensor using magnetostrictive techniques is
shown in Figure 6.28a. Magnetostriction is a phenomenon whereby the magnetic properties
Figure 6.27:
Heated EGO sensor conﬁguration.
276
Chapter 6

of a material depend on stress (due to an applied force). When sensing knock, the
magnetostrictive rods, which are in a magnetic ﬁeld, change the ﬂux ﬁeld in the coil due to
knock-induced forces. In Figure 6.28a, the forces associated with knock cylinder pressure are
transmitted through the mounting frame to the magnetostrictive rods. Magnetostriction is
a property of ferromagnetic materials, which were introduced in the discussion of the sensor
of Figure 6.7. Recall that a ferromagnetic material is physically made up of individual
domains in which the magnetic ﬁelds associated with the electron spins within a domain are
all aligned in a given direction.
Wherever an external magnetic ﬁeld is applied, the domains are reoriented such that their axes
tend to be parallel with the applied ﬁeld. The reorientation of the magnetic domains induces
a strain within the material, which slightly changes its size and shape.
Conversely, these same materials when magnetized and when subject to stress/strain due to an
applied external force change magnetic permeability m. It is this latter effect (known as
reverse magnetostriction) that is of interest in a knock sensor.
‘SOFT’
MAGNETIC
SHELL
MAGNET
MAGNETOSTRICTIVE
RODS
CASE
COIL
INSULATOR
TERMINAL
(a)
(b)
rod
Vo
lR
μR
pC
magnet
ferromagnetic 
shell
line of const. B
N turn
coil
Figure 6.28:
Knock sensor conﬁguration.
Sensors and Actuators
277

Although magnetostriction is strictly speaking an anisotropic phenomenon, for the purposes
of the present discussion a typical magnetostrictive material in a knock sensor is fabricated
with relatively long thin rods. In this case, only the permeability change along the axis is of
importance and can be treated as an isotropic scalar permeability mR (rather than tensor)
model as given below.
In Figure 6.28a, the small magnet creates a magnetic ﬁeld having a magnetic ﬂux density B in
the form of closed-loops passing through the magnet, magnetostrictive rods, the coil of N
turns, and return through the magnetically “soft” (i.e., relatively high magnetic permeability)
magnetic shell (i.e., see Figure 6.28b). These loops are basically lines of constant ﬂux density
magnitude. The strength of this ﬂux density is determined by the magnet as well as the
permeability of the magnetostrictive rods mR. The magnetic permeability of the shell ms is
assumed to satisfy the inequality: ms >> mR.
A simpliﬁed model for the amplitude of the ﬂux density is given by
B y MmR
‘R
(62)
where ‘R is the length of the magnetostrictive rods and M is a constant for the magnet. The
total magnetic ﬂux F through the rods is approximately given by
F ¼ R
AR
Bds
yBAR
(63)
where ds is a differential area in a plane orthogonal to the rod long axis and AR is its entire
cross-sectional area. In a typical sensor, B is nearly uniform over the rod area AR. In this case,
the total magnetic ﬂux is given approximately by
F ¼ MARmR
‘R
(64)
The sensor terminal voltage Vo is given by
Vo ¼ N dF
dt
¼ NMAR
‘R
dmR
dt
(65)
where N ¼ number of turns of the coil.
The time derivative of mR is due to magnetostrion in the rods. An approximate model for mR is
given by:
mR ¼ m1 þ m2sR
278
Chapter 6

where sR is the stress induced in the rod by knock forces, which are transmitted to the rods by
the frame, and where m1 and m2 are constants for the magnetostrictive rod material.
During normal combustion, dsR=dt is relatively small. However, during knock, this time
derivative is relatively large and is proportional to the knock cylinder pressure ﬂuctuations.
Thus, the sensor terminal voltage contains a term that is proportional to knock intensity. This
voltage is used to sense excessive knock (see Chapter 7). Other sensors use piezoelectric
crystals or the piezoresistance of a doped silicon semiconductor. Whichever type of sensor is
used, it forms a closed-loop system that retards the ignition to reduce the knock detected at the
cylinders. Systems using knock sensors are explained in Chapter 7.
The problem of detecting knock is complicated by the presence of other vibrations and noises
in the engine. Normally, signal processing in the form of ﬁlters “tuned” to the knock
frequency of the speciﬁc engine conﬁguration enhances the detection of knock (see
Chapter 7).
Automotive Engine Control Actuators
In addition to the set of sensors, electronic engine control is critically dependent on a set of
actuators to control air/fuel ratio, ignition, and EGR. Each of these devices will be discussed
separately.
In general, an actuator is a device that receives an electrical input (e.g., from the engine
controller) and produces an output of a different physical form (e.g. mechanical or thermal or
other). Examples of actuators include various types of electric motors, solenoids, and
piezoelectric force generators. In automotive electronic systems, the solenoid is a very
commonly used device because it is relatively simple and inexpensive.
The solenoid is used in applications ranging from precise fuel control to mundane
applications such as electric door locks. A solenoid is, in essence, a powerful electromagnet
having a conﬁguration generally similar to that illustrated schematically in Figure 6.29. The
solenoid consists of a ﬁxed cylindrical steel (i.e., ferromagnetic) frame with a movable steel
element. A coil having N turns is wound around the steel frame, forming a powerful
electromagnet.
Unlike the magnetic sensors explained above in which the source of magnetic ﬁeld is
a permanent magnet, the source of the magnetic ﬁeld in the solenoid is the current I that ﬂows
through the coil. The lines of constant magnetic ﬂux density B form closed contours such as
denoted C1 in Figure 6.29. These contours include a segment through the center post and
movable plunger, a segment directed radially in the upper and lower portions and then
through the outer shell. The contour C1 is in a plane that passes through the axis of symmetry
of the cylindrical solenoid structure. Note that any contour such as C1 passes through the
Sensors and Actuators
279

ferromagnetic material as well as the nonmagnetic sleeve of thickness g and nonmagnetic air
gap of length x.
Figure 6.29 also shows a movable element which is in the form of a cylinder of high
permeability (m) ferromagnetic material. This movable element is held away from the center
post by a spring. The other end of this spring is attached to a structure that is ﬁxed rigidly to
the ferromagnetic shell. This shell is normally cylindrical in shape and coaxial with the
center post.
The value of the magnetic ﬁeld intensity can be related to the total current I that passes
through the surface enclosed by C1 using one of the fundamental equations (Eqn (30)) given
above
IT ¼
I
C1
H$d‘
(66)
where d‘ is a differential vector along the contour C1. The magnetic ﬂux density magnitude B
is constant along any contour C1. The magnitude of H along any contour C1 is given by
H ¼ B
m
where
m ¼ mo
in the sleeve and gap
¼ mrmo
in the ferromagnetic material
non
magnetic
sleeve
spring
movable element
ferro magnetic
shell (high μ)
N turn coil
center post
I
x
C1
Rs
vs
g
dl
Figure 6.29:
Solenoid conﬁguration.
280
Chapter 6

The relative permeability (mr) in the ferromagnetic material is so large that in the
ferromagnetic material H is negligibly small. The contour integral above reduces
approximately to
IT x Hðx þ gÞ
(67)
where Hg is the magnitude of H in the air and sleeve material and is given by
Hg ¼ B
mo
To a close approximation, H and B are essentially constant over the center post cross-sectional
area. The total current IT is given by
IT ¼ NI
¼ B
mo
ðx þ gÞ
The total ﬂux linking the N turn coil l is given by
l ¼ N
ZZ
Ac
Bds
where ds is the differential area in the cross-section of the post and where the integral is taken
over the cross-sectional area of the post AC. With the assumption of essentially uniform B
over the post, the total ﬂux linking the coil becomes
l y NBAC
¼ mo
N2IAC
x þ g
The important circuit parameter that characterizes the electrical model for the coil, which is
called its inductance L, is deﬁned as
L ¼ l
I
¼ moN2AC
ðx þ gÞ
The terminal voltage vo of a two-terminal device having inductance L is given by
vo ¼ dðLIÞ
dt
(68)
Sensors and Actuators
281

For a ﬁxed inductor, this model becomes familiar:
vo ¼ L dI
dt
ðfor constant LÞ
(69)
However, for a magnetic actuator such as is used in automotive electrical systems (e.g., the
example solenoid), this inductance varies with the position of any movable element.
For the purposes of modeling an actuator, the primary focus is on determining the dynamic
response (i.e., movement of the plunger) to an applied electrical signal. At any instant, the
total energy is the sum of the magnetic and mechanical energy. As a simpliﬁcation (without
loss of generality), it is convenient to assume a lossless electromechanical system. In this
case, the electrical energy put into the system is stored in the magnetic ﬁeld. If electrical
power is supplied to the system at constant x, the instantaneous stored magnetic energy (Wm)
is given by
Wm ¼
ZI
0
lði; xÞdi
(70)
¼ 1
2 LðxÞI2
(71)
If the total energy stored in the magnetic ﬁeld is denoted Wm, conservation of energy requires
that
dWm
dt
¼ IL dI
dt  fe
dx
dt
(72)
where the ﬁrst term is the instantaneous electrical power Pe into the system and the second
term represents time rate of change of mechanical energy due to the mechanical force of
electrical origin fe applied to the movable element. The negative sign on the second term
indicates that the mechanical energy is taken from the stored magnetic energy and is applied
to the movable element. In this model, both lT and x are independent variables. For our
assumed conservative system, the force of electrical origin (fe) for the solenoid of Figure 6.25
is given by
fe ¼ vWm
vx
(73)
¼  moN2ACI2
2ðx þ gÞ2
(74)
Note that the minus sign indicates a force that is reducing x and that it varies inversely with x.
282
Chapter 6

The solenoid of Figure 6.29 is mechanically unstable in the sense that a current of sufﬁcient
strength causes fe to increase as an inverse quadratic function of x, whereas the spring force
countering fe varies linearly with x. In any solenoid conﬁgured as in Figure 6.25, the movable
element will accelerate toward the ﬁxed post, stopping abruptly only when x ¼ 0. In any
practical solenoid, the plunger actually bounces away from the post and oscillates brieﬂy
with decaying amplitude (typically at a very high frequency). Normally, the nonmagnetic
sleeve provides sufﬁcient mechanical damping to rapidly damp out any “bounce.” It should be
noted that the introduction of the model for the solenoid using stored energy is useful for
explaining other types of actuators (e.g., motors to be discussed later in automotive electronic
systems).
It is, perhaps, worthwhile to extend the static model developed above for the solenoid to
develop the dynamic equations. First, however, we simplify the notation for the ﬂux linkage
to the following:
lðI; xÞ ¼
LoI
ð1 þ x=gÞ
(75)
where
Lo ¼ moACN2
g
and where Lo is the inductance of the solenoid at x ¼ o. Summing the voltages around the loop
formed by the source vs, Rs and the solenoid terminals yields:
vs ¼ IRs þ dl
dt
(76)
¼ IRs þ
Lo
ð1 þ x=gÞ
dI
dt 
LoI
g2ð1 þ x=gÞ2
dx
dt
The ﬁrst term on the right-hand side of equation 76 is the voltage drop across the source
resistance Rs. The second term is the familiar voltage due to the instantaneous inductance L(x)
and the ﬁnal term is a voltage that is induced by the moving plunger.
Next, we write the mechanical equation of motion of the plunger:
fe ¼ M d2x
dt2 þ D dx
dt þ Ksðx  ‘Þ
where M is the plunger mass, D is the mechanical damping force due to the plunger motion
(that is here taken to linear), Ks is the spring rate of the spring that holds the movable element
in its extended position, and ‘ is the spring length in the absence of the mechanical force of
Sensors and Actuators
283

electrical origin fe. This force has been derived above, and using the new notation yields the
mechanical equation of motion for the plunger:
 1
2
LoI2
gð1 þ x=gÞ2 ¼ M d2x
dt2 þ D dx
dt þ Ksðx  ‘Þ
(77)
Since these equations are nonlinear in I and x, they cannot be solved by the Laplace operator
method of Chapter 1. However, modern computer simulation (e.g., MATLAB/SIMULINK)
provides a means of calculating I(t) and x(t) once the numerical parameters for the structure
are known. However, one aspect of this model has not been considered. That aspect is the
bounce of the plunger at the point where x ¼ 0 during the initial motion of the plunger. The
model for bounce involves the elasticity of the mechanical stop as well as the damping of the
nonmagnetic sleeve. It will be shown in the next chapter that the details of this bounce are not
normally relevant to the operation of an automotive solenoid type actuator and will not be
further explored here.
This abrupt motion of the movable element is essentially in the form of a mechanical
switching action such that the solenoid tends to be either in its rest position as held by the
spring (i.e., x ¼ ‘) or against the center post (i.e., at x ¼ 0). The movable element is typically
connected to a mechanism that is correspondingly moved by the snap action of this element.
Applications of solenoids in automotive electronics include fuel injectors and EGR valves.
Fuel Injection
A fuel injector is (in essence) a solenoid-operated valve. The valve opens or closes to permit
or block fuel ﬂow to the engine. The valve is attached to the movable element of the solenoid
and is switched by the solenoid activation.
Fuel injector signal
Consider an idealized fuel injector as shown in Figure 6.30, in which the injector is open
when the applied voltage is on and is closed when the applied voltage is off.
In this conﬁguration, a solenoid has a movable element in the form of a pintle with a conical
tip that ﬁts into a conical section forming a nozzle. A spring holds the pintle such that the
nozzle is closed. Behind this nozzle is a small fuel-ﬁlled chamber holding fuel under pressure
that is supplied by a tube known as the fuel rail. With no control voltage applied (i.e., Vc ¼ 0)
and no current I ﬂowing, the spring holds the pintle in a closed position such that no fuel ﬂows
through the nozzle. With voltage of sufﬁcient amplitude applied, the solenoid pulls the pintle
out of its seat and fuel ﬂows through the nozzle into the intake system.
Once the pintle is pulled fully toward the solenoid center post, the fuel ﬂow rate through the
nozzle is constant for a given regulated fuel pressure and nozzle geometry. Therefore, except
284
Chapter 6

for brief transient periods, the quantity of fuel injected into the air stream is proportional to
the time the valve is open. The control current that operates the fuel injector is pulsed on and
off to deliver precise quantities of fuel.
For most contemporary vehicles, fuel injection takes place in the intake port for each cylinder
such that the fuel spray is directed along with intake air ﬂowing past the intake valve during
the intake stroke. The control voltage V depicted in Figure 6.31 is the terminal voltage applied
to the fuel injector by the electronic engine control system. Figure 6.31a and b depict
idealized binary-valued voltage levels that are “on” or “off.”
However, it has been shown above that the terminal voltage of a solenoid is characterized by
a nonlinear model and the plunger/pintle is similarly characterized by a nonlinear dynamic
model. On the other hand, the actual opening and closing pintle/plunger transient response
normally represents a relatively short period compared with the “on” time t even under idle
conditions (i.e., low duty cycle). In the idealized situation depicted in Figure 6.31, the fuel is
assumed to ﬂow at an essentially constant rate (i.e., _Mf ¼ constant) for a constant fuel rail
pressure. In this situation, the mass of fuel delivered to a cylinder during any given engine
cycle Mf (k) is given by
Mf ðkÞ ¼ _Mf tk
where tk ¼ “on” time for the kth engine cycle. For a pulse train fuel injector control voltage
signal, the ratio of “on” time t to the period of the pulse T (“on” time plus “off” time) is called
N turn coil
ferromagnetic shell
spring
fuel rail
fuel
pintle
nozzle
to intake
nonmagnetic
sleeve
I
Vc
Figure 6.30:
Simpliﬁed fuel injector conﬁguration
Sensors and Actuators
285

the duty cycle dFI. This is shown in Figure 6.31. The fuel injector is energized for time tk to
allow fuel to spray from the nozzle into the air stream going to the intake manifold. The
injector is de-energized for the remainder of the period. For a constant fuel rail/pressure, the
quantity of fuel supplied during the kth engine cycle [Mf (k)] is proportional to dFI. Therefore,
a low duty cycle, as seen in Figure 6.31a, is used for a relatively high air/fuel ratio (lean
mixture), and a high duty cycle (Figure 6.31b) is used for a relatively low air/fuel ratio (rich
mixture).
Exhaust Gas Recirculation Actuator
In Chapter 5 it was explained that exhaust gas recirculation (EGR) is utilized to reduce NOx
emissions. The amount of EGR is regulated by the engine controller, as explained in Chapter 7.
When the correct amount of EGR has been determined by the controller based on
Figure 6.31:
Fuel injector terminal voltage.
286
Chapter 6

measurements from the various engine control sensors, the controller sends an electrical signal
to the EGR actuator. Typically, this actuator is a variable-position valve that regulates the EGR
as a function of intake manifold pressure and exhaust gas pressure.
Although there are many EGR conﬁgurations, only one representative example will be
discussed to explain the basic operation of this type of actuator. The example EGR actuator is
shown schematically in Figure 6.32. This actuator is a vacuum-operated diaphragm valve
with a spring that holds the valve closed if no vacuum is applied. The vacuum that operates
the diaphragm is supplied by the intake manifold and is controlled by a solenoid-operated
valve. This solenoid valve is controlled by the output of the control system.
This solenoid operates essentially in the same manner as that explained in the discussion on
fuel injectors. Whenever the solenoid is energized (i.e., by current supplied by the control
system ﬂowing through the coil), the EGR valve is opened by the applied vacuum.
The amount of valve opening is determined by the average pressure on the vacuum side of the
diaphragm. This pressure is regulated by pulsing the solenoid with a variable-duty cycle
Figure 6.32:
EGR actuator.
Sensors and Actuators
287

electrical control current. The duty cycle (see discussion on fuel injectors) of this pulsing
current controls the average pressure in the chamber that affects the diaphragm deﬂection,
thereby regulating the amount of EGR.
Variable Valve Timing
In the discussion of the four-stroke IC engine, it was explained that the intake and exhaust
valves were opened by a mechanism that is driven from the camshaft. It was explained that
the intake valve is opened during the intake stroke and closed otherwise. Similarly, the
exhaust valve is opened during the exhaust stroke. The exact time during the engine cycle at
which these valves open and close is determined by the proﬁle of the camshaft lobes.
The engine performance (including power output and exhaust emissions) is determined partly
by the timing of these openings and closings relative to top dead center (TDC) and bottom
dead center (BDC) as well as by the amount of opening (valve lift). It has long been known
that optimal cam timing and lift vary with engine operating conditions (i.e., load and RPM).
The design of a cam proﬁle has been a compromise that yields acceptable performance over
the entire engine operating envelope.
A long-sought goal for the four-stroke IC engine has been the ability to continuously vary
valve timing and lift to achieve optimum performance at all operating conditions. In this
chapter, variation in the opening and closing of valves relative to a ﬁxed point in the engine
cycle (e.g., TDC) is termed variable valve phasing (VVP). It is appropriate to use such a term
since the relative time of occurrence of multiple events in any cyclical process is often called
phase.
After a considerable development period, various mechanisms have come into production
automotive engines for varying valve phasing under electronic control. Signiﬁcant
improvements in volumetric efﬁciency are possible with VVP. For example, if the exhaust
valve closing is delayed relative to BDC and relative to intake valve opening, there is
a portion of the cycle in which both valves are open simultaneously (known as valve overlap).
The gas dynamics of the exhaust gas leaving the cylinder and intake air entering the cylinder
are such that volumetric efﬁciency is improved by this valve overlap. The optimum overlap
varies with operating conditions, and electronic control (with a suitable actuator) is required
to achieve this optimum. VVP can be achieved by regulating the timing of either or both the
exhaust or intake valves.
A representative example of the mechanism for valve phasing is depicted in Figure 6.33.
Figure 6.33a is a front view of the engine. Both camshafts are driven via sprocket gears that
are, in turn, driven by a sprocket gear mounted at the end of the crankshaft. These sprocket
gears can be coupled via a chain (or a timing belt or possibly by a gear system) to a gear on the
crankshaft.
288
Chapter 6

In this hypothetical example, each cam sprocket includes a housing within which is a helical
spline gear that engages an inner gear connected rigidly to this sprocket gear. Figure 6.33b
shows an exploded view of the helical gear and the camshaft sprocket gear. The camshaft is
connected to the helical spline and rotates with it relative to the sprocket as the helical gear
moves axially. This conversion of axial displacement to relative rotary motion is responsible
for advancing and retarding the exhaust camshaft relative to the exhaust camshaft sprocket.
The helical gear is moved axially by engine lubricating oil acting on a pair of pistons within
cylinders located at either end of the helical gear. Oil under pressure is supplied to a pair of
sealed chambers, the ends of which are the helical gear (acting as a piston). The axial
displacement of the helical gear is regulated by a variable-duty-cycle solenoid-activated
control valve that is itself regulated by the engine electronic control system. By regulating the
axial displacement of the helical gear, the engine control system controls the relative phasing
of the exhaust and intake camshafts.
An alternate cam phasing mechanism is depicted in Figure 6.33c. This mechanism
incorporates extended vanes (V) on the camshaft (C). The vanes are located within recesses in
R
EXHAUST CAMSHAFT
SPROCKET GEAR
INTAKE CAMSHAFT
SPROCKET GEAR
CHAIN
CRANKSHAFT
SPROCKET
GEAR
T
G
φc
G
G
C
C
V
CL
P1
iA
iR
SR
SA
to A
to R
to sump
p
S pool valve
P2
A
A V
V
C
EXHAUST
CAMSHAFT
SPROCKET
GEAR
HELICAL SPLINE
GEAR
(d)
(b)
(c)
(a)
R
Figure 6.33:
Representative VVP mechanisms.
Sensors and Actuators
289

the camshaft gear G. Gear teeth T are circumferentially located around the gear. Although
only three gear teeth are shown in the ﬁgure, they extend around the periphery of the gear and
engage the camshaft drive chain/belt/gears. The vanes, which have the same thickness as the
gear, ﬁt tightly into the recesses. Rotation of the camshaft/vanes within the recesses provides
the rotational movement that is responsible for variable valve phasing.
The recesses are larger circumferentially than the vanes such that chambers A and R are
formed between the gear and the vanes. Oil, under pressure, is supplied to these sets of
chambers differentially ﬁlling them completely such that the volume of one chamber
increases as the other decreases. The pressure in the chambers is maintained by a pair of
covering plates P1 and P2, which provide sealing of the chambers. A single cam lobe (CL) is
depicted on the camshaft extension from the variable valve phasing mechanisms. Such a cam
lobe is present for each cylinder operated by the camshaft. Although they are not shown in
Figure 6.33c, there are passageways that supply the oil under pressure.
Figure 6.33d depicts a spool valve assembly that permits the pressurized oil to be sent to either
the A or R chambers and allows the displaced oil on the opposite side (i.e., the nonpressurized
side) to return to the engine oil sump. When pressurized oil is supplied to the A chambers and
released from the R chambers, the camshaft rotates clockwise as shown in Figure 6.33c,
thereby advancing camshaft phase. The reverse is true when the pressurized oil is supplied to
the R chambers and the oil displaced from the A chambers returns to the engine oil sump. Once
the desired cam phasing has been achieved, this spool valve is centered and the oil is blocked
from further movement. The camshaft phase is rigidly maintained under so-called “hydraulic
lock” conditions. This hydraulic locking is important to maintain the desired phasing because
the camshaft itself is subjected to the reaction torque from the valve actuation. The forces
acting on each cam lobe include the compression of the valve springs (i.e., the springs that hold
thevalves closed) as well as inertial forces due to acceleration of thevalves and any mechanism
required to operate them. These latter forces predominate for RPM above a certain level
depending on spring rate and the mass of the valve actuation mechanism.
The spool valve actuation is implemented via one or more electromechanical actuators
(depending upon system conﬁguration), which are typically solenoids. Figure 6.33d depicts
a pair of solenoids SA and SR. The VVP control comes from the electronic engine control
unit (ECU) in the form of currents iA and iR. In one implementation, the current(s) that
regulate spool valve position are variable-duty-cycle electrical pulse signals, as described
earlier in this chapter.
VVP Mechanism Model
Next, an approximate model is developed for the VVP mechanism that has been described
qualitatively above. This model is used in Chapter 7 to explain the operation of the VVP
under powertrain control. In the implementation shown in Figure 6.33c and d, the spool valve
290
Chapter 6

is centered via a spring when iA ¼ 0 and iR ¼ 0. In this condition, the mechanism is in
hydraulic lock and the cam phase is constant. Whenever the pulsed current iA is supplied
to SA, the pressurized oil p is supplied to chamber A and the displaced oil from chamber
R is sent to the oil sump causing the camshaft phase to advance. The displacement of the
spool valve within its housing (xA) is proportional to the duty cycle dA of the pulsed
current iA.
The pressure in chamber A denoted pA (for a given supply pressure from the main oil galley)
is proportional to spool valve displacement, which is proportional to dA. The model for
chamber A pressure is given by
pA ¼ kpAdA
The torque acting on the camshaft to advance the camshaft phasing Tc is proportional to the
pressure differential between the A and R chambers. Since the oil in chamber R (for nonzero
current iA) is returned to the oil sump, the pressure in chamber R (i.e., pR) is slightly above oil
sump pressure (i.e., atmospheric pressure). The torque acting on the camshaft to advance the
cam phase Tc is given by
Tc ¼ kcdA
for iA nonzero
(78)
where kc is the constant for the geometry and for constant oil supply pressure. Similarly,
whenever pulsed current iR (having duty cycle dR) is sent to solenoid SR, the spool valve
position is negative and pressurized oil is sent to chamber R (causing the camshaft phase to
retard). The corresponding torque acting on the camshaft is negative and given by
Tc ¼ kcdR
iR nonzero
(79)
With proper design, such a system can be modeled as a linear actuator in the following form:
Tc ¼ kcu
(80)
where u is the control signal from electronic engine control system:
¼ dA
iA nonzero
¼ dR
iR nonzero
(81)
The torque applied to the camshaft results in dynamic angular movement of the camshaft
fc(t) measured relative to the camshaft drive gear (G see Figure 6.30c). It is convenient to
represent this dynamic motion with the following approximate linear model:
Jc€fc þ Bc _fc ¼ Tc
(82)
¼ kcu
(83)
Sensors and Actuators
291

where Jc ¼ moment of inertia of the components that rotate relative to the gear
Bc ¼ viscous damping coefﬁcient for VVP mechanism.
The VVP actuator mechanism can now be modeled as a transfer function Hp(s), which is
given by
Hp ¼ fcðsÞ
uðsÞ
¼
ka
sðs þ soÞ
(84)
where
ka ¼ kc
Jc
so ¼ Bc
Jc
Parameters for a hypothetical VVP mechanism are as follows:
ka ¼ 2600
so ¼ 17
The transfer function Hp(s) is the plant for a VVP control system that is incorporated as
a function in the engine/powertrain control system for an engine with VVP. The electronic
control for this VVP is described and analyzed in Chapter 7.
Electric Motor Actuators
Perhaps the most important electromechanical actuator in automobiles is an electric motor.
Electric motors have long been used on automobiles beginning with the starter motor, which uses
electric power supplied by a storage battery to rotate the engine at sufﬁcient RPM that the engine
canbemadeto startrunning.Motorshavealsobeenemployedtoraiseorlowerwindows,position
seats as well as for actuators on airﬂow control at idle (see Chapter 7). In recent times, electric
motors have been usedto provide thevehicle primary motive power in hybrid or electric vehicles.
There are a great number of electric motor types that are classiﬁed by the type of excitation
(i.e., dc or ac), the physical structure (e.g., smooth air gap or salient pole), and by the type of
magnet structure for the rotating element (rotor) which can be either a permanent magnet or
an electromagnet. However, there are certain fundamental similarities between all electric
motors, which are discussed below. Still another distinction between types of electric motors
is based upon whether the rotor receives electrical excitation from sliding mechanical switch
(i.e., commutator and brush) or by induction. Regardless of motor conﬁguration, each is
292
Chapter 6

capable of producing mechanical power due to the torque applied to the rotor by the
interaction of the magnetic ﬁelds between the rotor and the stationary structure (stator) that
supports the rotor along its axis of rotation.
It is beyond the scope of this book to consider a detailed theory of all motor types. Rather, we
introduce basic physical structure and develop analytical models that can be applied to all
rotating electromechanical machines. Furthermore, we limit our discussion to linear, time-
invariant models, which are sufﬁcient to permit performance analysis appropriate for most
automotive applications.
We introduce the structures of various electric motors with Figure 6.34, which is a highly
simpliﬁed sketch depicting only the most basic features of the motor.
This motor has coils wound around both the stator (having N1 turns) and the rotor (having N2
turns), which are placed in slots around the periphery in an otherwise uniform gap machine. In
this simpliﬁed drawing, only two coils are depicted. In practice, there are more than twowith an
equal number in both the stator and rotor. Each winding in either stator or rotor is termed
a “pole” of the motor. Both stator and rotor are made from ferromagnetic material having a very
high permeability (see discussion above on ferromagnetism). It is worthwhile to develop
a model for this simpliﬁed idealized motor to provide the basis for an understanding of the
v2
λ2
v1
λ1
α
θ
N1
N2
rotor
contour C
axis of
rotation
stator
g
i1
i2
Figure 6.34:
Schematic representation of electric motor.
Sensors and Actuators
293

relatively complexstructureofa practical motor. In Figure6.34,the statoris a cylinder of length
‘ and the rotor is a smaller cylinder supported coaxially with the stator such that it can rotate
about the common axis. The angle between the planes of the two coils is denoted q and the
angular variable about the axis measured from the plane of the stator coil is denoted a. The
radial air gap between rotor and stator is denoted g. It is important in the design of any rotating
electric machine (including motors) to maintain this air gap as small as is practically feasible
since the strength of the associated magnetic ﬁelds varies inversely with g. The terminal
voltages of these two coils are denoted v1 and v2. The currents are denoted i1 and i2 and the
magnetic ﬂux linkage for each is denoted l1 and l2, respectively. Assuming for simpliﬁcation
purposes that the slots carrying the coils are negligibly small, the magnetic ﬁeld intensity H is
directed radially and is positive when directed outward and negative when directed inward.
The terminal excitation voltages are given by:
v1 ¼ _l1
v2 ¼ _l2
The magnetic ﬂux density in the air gap Br is also radially directed and is given by
Br ¼ moHr
(85)
where mo is the permeability of air.
This magnetic ﬂux density is continuous through the ferromagnetic structure, but because the
permeability of the stator and rotor (m) is very large compared with that of air, the magnetic
ﬁeld intensity inside both the rotor and stator is negligibly small:
H x 0 inside ferromagnetic material.
The contour integral along any path (e.g., contour C of Figure 6.34) that encloses the two coils
is given by
IT ¼
I
C
H$d ‘ ¼ 2gHrðaÞ
(86)
The magnetic ﬂux density Br(a) is also directed radially and is given by
BrðaÞ ¼ moHrðaÞ
This magnetic ﬁeld intensity is a piecewise continuous function of a as given below:
2gHrðaÞ ¼ N1i1  N2i2
0  a < q
¼ N1i1 þ N2i2
q < a < p
¼ N1i1 þ N2i2
p < a < p þ q
¼ N1i1  N2i2
p þ q < a < 2p
294
Chapter 6

The magnetic ﬂux linkage for the two coils l1 and l2 are given by
l1 ¼ N1
Zp
o
BrðaÞ‘Rrda
l2 ¼ N2
Zpþq
q
BrðaÞ‘Rrda
(87)
where Rr is the rotor radius.
It is assumed in the integrals for l1 and l2 that the so-called fringing magnetic ﬂux outside of
the axial length ‘ of the rotor/stator is negligible. Using the concept of inductance for each
coil as introduced in the discussion about solenoids, this ﬂux linkage can be written as a linear
combination of the contributions from i1 and i2:
l1 ¼ L1i1 þ Lmi2
(88)
l2 ¼ Lmi1 þ L2i2
(89)
where
L1 ¼ N2
1Lo ¼ self inductance of coil 1
(90)
L2 ¼ N2
2Lo ¼ self inductance of coil 2
(91)
Lo ¼ mo‘Rrp
2g
(92)
The parameter Lm is the mutual inductance for the two coils which is deﬁned as the ﬂux
linkage induced in each coil due to the current in the other divided by that current and is
given by
Lm ¼ LoN1N2

1  2q
p

0 < q < p
¼ LoN1N2

1 þ 2q
p

p < q < 0
The above formulas for these inductances provide a sufﬁcient model to derive the terminal
voltage/current relationships as well as the electromechanical models for motor performance
calculations. The self-inductances for each coil are independent of q, but the mutual
inductance varies with q such that Lm(q) is a symmetric function of q. It can be formally
expanded in a Fourier series in q having only cosine terms in odd harmonics as given below:
LmðqÞ ¼ M1 cosðqÞ þ M3 cosð3qÞ þ M5 cosð5qÞ þ .
(93)
Sensors and Actuators
295

In any practical motor, there will be a distribution of windings such that the fundamental
component M1 predominates; that is, the mutual inductance is given approximately by
LmxM cosðqÞ
(94)
For notational convenience, the subscript 1 on M1 is dropped. Any motor made up of multiple
matching pairs of coils in the stator and rotor will have a set of terminal relations in the ﬂux
linkages for the stator and rotor ls and lr, respectively, given by
ls ¼ Lsis þ Mir cosq
lr ¼ Lrir þ Mis cosq
The torque of electrical origin acting on the rotor Te is given by
Te ¼ vWmM
vq
where, for a linear lossless system, the mutual coupling energy WmM is
WmM ¼ isirLmðqÞ
The torque Te is given by
Te ¼ isirM sinq
The mechanical dynamics for the motor are given by
Te ¼ Jr
d2q
dt2 þ Bv
dq
dt þ Cc sgn
dq
dt

where Jr is the rotor moment of inertia about its axis, Bv is the rotational damping coefﬁcient
due to rotational viscous friction, and Cc is the coulomb friction coefﬁcient.
It is of interest to evaluate the motor performance by calculating the motor mechanical power
Pm for a given excitation. Let the excitation of the stator and rotor be from ideal current
sources such that
is ¼ Is sinðustÞ
ir ¼ Ir sinðurtÞ
qðtÞ ¼ umt þ g
(95)
where um is the rotor rotational frequency (rad/sec) and g expresses an arbitrary time phase
parameter. The motor power is given by
Pm ¼ Teum
(96)
¼ umIsIrMsinðustÞsinðurtÞsinðumt þ gÞ
(97)
296
Chapter 6

This equation can be rewritten using well-known trigonometric identities in the form
Pm ¼  umIsIrM
4
fsin½ðum þ us  urÞt þ g þ sin½ðum  us þ urÞt þ g
 sin½ðum þ us þ urÞt þ g  sin½ðum  us  urÞt þ gg
(98)
The time average value of any sinusoidal function of time is zero. The only conditions under
which the motor can produce a nonzero average power are given by the frequency
relationships below:
um ¼ us  ur
(99)
For example, whenever um ¼ us þ ur, the motor time average power Pmav is given by
Pmav ¼ umIsIrM
4
sing
(100)
In such a motor, an equilibrium operation will be achieved when Pmav ¼ PL where PL ¼ load
power. Thus, the phase between rotor and stator ﬁelds is given by
sing ¼
4PL
umIsIrM
(101)
provided
PL  umIsIrM
4
(102)
The above frequency conditions (Eqn (99)) are fundamental to all rotating machines and are
required to be satisﬁed for any nonzero average mechanical output power. Each different type
of motor has a unique way of satisfying the frequency conditions. We illustrate with a speciﬁc
example, which has been employed in certain hybrid vehicles. This example is the induction
motor. However, before proceeding with this example, it is important to consider an issue in
motor performance. Normally, electric motors that are intended to produce substantial
amounts of power (e.g., for hybrid vehicle application) are polyphase machines; that is, in
addition to the windings associated with stator excitation, a polyphase machine will have one
or more additional sets of windings that are excited by the same frequency but at different
phases. Although three-phase motors are in common use, the analysis of a two-phase
induction motor illustrates the basic principles of polyphase motors with a relatively
simpliﬁed model and is assumed in the following discussion.
A two-phase motor has two sets of windings displaced at 90 in the q direction and
excited by currents with a 90 phase for both stator and rotor. A so-called balanced two-
phase motor will have its coil excited by currents ias, ibs for phases a and b, respectively,
where
Sensors and Actuators
297

ias ¼ Is cosðustÞ
(103)
ibs ¼ Is sinðustÞ
The rotor is also constructed with two sets of windings displaced physically by 90 and
excited with currents iar and ibr having 90 phase shift:
iar ¼ Ir cosðurtÞ
(104)
ibr ¼ Ir sinðurtÞ
A two-phase induction motor is one in which the stator windings are excited by currents given
above (i.e., ias and ibs). The rotor circuits are short-circuited such that var ¼ vbr ¼ 0, where var
is the terminal voltage for windings of phase a and vbr is the terminal voltage for the b phase.
The currents in the rotor are obtained by induction from the stator ﬁelds. By extension of the
analysis of the single-phase excitation, the terminal ﬂux linkages are given by
las ¼ Lsias þ Miarcosq  Mibrsinq
lbs ¼ Lsibs þ Miarsinq þ Mibrcosq
lar ¼ Lriar þ Miascosq þ Mibssinq
lbr ¼ Lribr  Miassinq  Mibscosq
(105)
The torque Te and instantaneous power Pm for the two-phase induction motor are given by
Te ¼ M½ðiaribs  ibriasÞcosq  ðiarias þ ibribsÞsinq
(106)
Pm ¼ umMIsIrsin½ðum  us þ urÞt þ g
The average power Pav is nonzero when um ¼ us  ur and is given by
Pa ¼ umMIsIrsing
Since the rotor terminals are short-circuited, we have
dlar
dt ¼ dlbr
dt ¼ 0
(107)
The two rotor currents, thus, satisfy the following equations:
0 ¼ Rriar þ Lr
diar
dt þ MIs
d
dt½cosðustÞcosðumt þ gÞ þ sinðustÞsinðumt þ gÞ
(108)
0 ¼ Rribr þ Lr
dibr
dt þ MIs
d
dt ½cosðustÞsinðumt þ gÞ þ sinðustÞcosðumt þ gÞ
(109)
where Rr and Lr are the resistance and self-inductance of the two sets of (presumed) identical
structure). These equations can be rewritten as
298
Chapter 6

Lr
diar
dt þ Rriar ¼ MIsðus  umÞsin½ðus  umÞt  g
(110)
Lr
dibr
dt þ Rribr ¼ MIsðus  umÞcos½ðus  umÞt  g
(111)
The current iab is identical to iar except for a 90 phase shift as can be seen from Eqn (111).
Note that the current for both phases are at frequency ur where
ur ¼ ðus  umÞ
Thus, the induction motor satisﬁes the frequency condition by having currents at the
difference between excitations and rotor rotational frequency. The current iar is given by
iar ¼
ðus  umÞMIs
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
R2r þ ðus  umÞ2L2r
q
cos½ðus  umÞt  a
(112)
where
a ¼ 

p
2 þ g þ b

and
b ¼ tan1
ðus  umÞ
Rr
Lr

(113)
The current in phase b is identical except for a 90 phase shift. Substituting the currents for
rotor and stator into the equation for torque Te yields the remarkable result that the this torque
is independent of q and is given by
Te ¼ ðus  umÞM2RrI2
s
R2r þ ðus  umÞ2L2r
(114)
The mechanical output power Pm is given by
Pm ¼ umTe
¼
"
u2
sM2I2
s
ðRr=sÞ2 þ u2sL2r
#1  s
s

Rr
where s is called slip and is given by
s ¼ us  um
us
(115)
The induction machine has three modes of operation as characterized by values of s. For
0 < s < 1 it acts as a motor and produces mechanical power. For 1 < s < 0 it acts like
Sensors and Actuators
299

a generator and mechanical input power to the rotor is converted to output electrical power.
For s > 1, the induction machine acts like a brake with both electrical input and mechanical
input power dissipated in rotor ir
2Rr losses. Because of its versatility, the induction motor has
great potential in hybrid/electric vehicle propulsion applications. However, it does require
that the control system incorporates solid-state power switching electronics to be able to
handle the necessary currents. Moreover, it requires precise control of the excitation current.
The application of an induction motor to provide the necessary torque to move a hybrid or
electric vehicle is inﬂuenced by the variation in torque with rotor speed. Examination of Eqn
(114) reveals that the motor produces zero torque at synchronous speed (i.e., um  us). The
torque of an induction motor initially increases from its value at um ¼ 0 reaches a maximum
torque (Tmax) at a speed um > u
m when
0  u
m  us
The torque has a negative slope given by
dTe
dum
< 0
um > u
m
Normally, an induction motor is operated in the negative slope region of Tm(um) (i.e.,
u
m > um < us) for stable operation. Equilibrium is reached at a motor rotational speed um at
which the motor torque Te and load torque TL are equal, i.e. Te(um) ¼ TL(um).
This point is illustrated for a hypothetical load torque that is a linear function of motor speed
such that the load torque is given by
TL ¼ KLum
(116)
Figure 6.35 illustrates the motor and load torques for a load that varies linearly with um.
For convenience of presentation, Figure 6.35 presents normalized motor torque and load
torque normalized to the maximum torque Tmax where
Tmax ¼ max
um ðTeðumÞÞ
(117)
This maximum occurs at um ¼ u
m, which, for the present hypothetical normalized example,
is given by
u
m
us
y:68
Figure 6.33 also presents two load torques normalized to Tmax:
TL1 ¼ KL1um=Tmax
TL2 ¼ KL2um=Tmax
300
Chapter 6

where
KL2 > KL1
The operating motor speed for these two load torques are the two intersection points u01 and
u02 where
Tmðu01Þ ¼ TL1ðu01Þ
Tmðu02Þ ¼ TL2ðu02Þ
These two intersection points are the steady-state operating conditions for the two load
torques. The higher of the two loads has a steady-state operating point lower than the ﬁrst
(i.e., u02 < u01).
Chapter 7 discusses the control of an induction motor that is used in a hybrid electric vehicle.
There the model for load torque vs. vehicle operating conditions is developed.
Brushless DC Motors
Next, we consider a relatively new type of electric motor known as a brushless DC motor. A
brushless DC motor is not a DC motor at all in that the excitation for the stator is AC.
Normalized motor torque TM  vs normalized load torques TL1 TL2
TM TL1 TL2
1
0.9
0.8
0.7
0.6
0.5
0.4
0.3
0.2
0.1
0
0
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
1
ωm/ωs
TM
TL1
TL2
Figure 6.35:
Normalized torque Tm vs. normalized load torques TL1 TL2.
Sensors and Actuators
301

However, it derives its name from physical and performance similarity to a shunt-connected
DC motor with a constant ﬁeld current. This type of motor incorporates a permanent magnet
in the rotor and electromagnet poles in the stator as depicted in Figure 6.36. Traditionally,
permanent magnet rotor motors were generally only useful in relatively low-power
applications. Recent development of some relatively powerful rare earth magnets and the
development of high-power switching solid-state devices have substantially raised the power
capability of such machines.
The stator poles are excited such that they have magnetic N and S poles with polarity as
shown in Figure 6.36 by currents Ia and Ib. These currents are alternately switched on and off
from a DC source at a frequency that matches the speed of rotation. The switching is done
electronically with a system that includes an angular position sensor attached to the rotor.
This switching is done so that the magnetic ﬁeld produced by the stator electromagnets
always applies a torque on the rotor in the direction of its rotation.
ROTOR WITH PERMANENT
MAGNET
MAGNET
STATOR
POLES
ROTOR
POWER
COMMAND
(FROM DRIVER)
COIL A
(ELECTRIC
POWER
SOURCE)
CONTROL
COIL B
IA
IA
IA
VDC
IB
IB
IB
B
B
A
A
S
S
N
N
A
B
S
C
(a)
(b)
(c)
θ
θ
Figure 6.36:
Brushless DC motor.
302
Chapter 6

The torque Tm applied to the rotor by the magnetic ﬁeld intensity vector H created by the
stator windings is given by the following vector product
Tm ¼ gðM  HÞ
(118)
where M is the magnetization vector for the permanent magnet and g is the constant for the
conﬁguration.
The direction of this torque is such as to cause the permanent magnet to rotate toward parallel
alignment with the driving ﬁeld H (which is proportional to the excitation current). The
magnitude of the torque Tm is given by
Tm ¼ gMHsinðqÞ
where M ¼ magnitude of M, H ¼ magnitude of H and q ¼ angle between M and H.
If the permanent magnet rotor were allowed to rotate in a static magnetic ﬁeld, it would only
turn until q ¼ 0 (i.e., alignment).
In a brushless DC motor, however, the excitation ﬁelds are alternately switched electronically
such that a torque is continuously applied to the rotor magnet. In order for this motor to
continue to have a nonzero torque applied, the stator windings must be continuously
switched synchronous with rotor rotation. Although only two sets of stator windings are
shown in Figure 6.36 (i.e., two-pole machine), normally there would be multiple sets of
windings, each driven separately and synchronously with rotor rotation. In effect, the
sequential application of stator currents creates a rotating magnetic ﬁeld which rotates at
rotor frequency (ur).
A simpliﬁed block diagram of the two-pole motor control system for the motor of
Figure 6.36a and b is shown in Figure 6.36c. A sensor S measures the angular position q
of the rotor relative to the axes of the magnetic poles of the stator. A controller
determines the time for switching currents Ia and Ib on as well as the duration. The
switching times are determined such that a torque is applied to the rotor in the direction
of rotation.
At the appropriate time, transistor A is switched on, and electric power from the on-board DC
source (e.g., battery pack) is supplied to the poles A of the motor. The duration of this current
is regulated by controller C to produce the desired power (as commanded by the driver). After
rotating approximately 90, current Ib is switched on by activating transistor B via a signal
sent by controller C.
Sensors and Actuators
303

The rotor permanent magnet is equivalent to an electromagnet with d-c excitation (i.e.,
ur ¼ 0). The frequency at which the currents to the stator coils are switched is always
synchronous with the speed of rotation. Thus, the frequency condition for the motor is
satisﬁed since us ¼ um. This speed is determined by the mechanical load on the motor and the
power commanded by the controller. As the power command is increased, the controller
responds by increasing the duration of the current pulse supplied to each stator coil. The
power delivered by the motor is proportional to the fraction of each cycle that the current is on
(i.e., the so-called duty cycle).
Stepper Motors
The conﬁguration of Figure 6.34 is similar in form to another important motor having
automotive applications which is called a stepper motor. Normally, a stepper motor has
application where torque loads are relatively low. Chapter 7 discusses the application of
a stepper motor in an engine idle speed control system. In most cases, the stepper motor
output employs a reduction gear system in which the gear output shaft rotates at only
a fraction of the stepper motor output shaft.
A stepper motor of the conﬁguration depicted in Figure 6.36 has excitation currents iA and iB
that are sequences of nonoverlapping pulses. The relative phasing of the pulses determine the
direction of motor rotation. The motor rotates a ﬁxed angular increment for each pair of
pulses iA and iB. Very precise angular position control is obtained for a stepper motor by the
number and relative phasing of pairs of such pulses. A control system can advance the load
placed on the stepper motor-gear system by a speciﬁed amount via the number of output
pulses sent to the motor. Feedback via a position sensor of the load movement can be used in
conjunction with the output pulses to assure the desired displacement of the load object on the
motor/gear system.
The speed of motion of the output shaft is proportional to the pulse frequency of the
sequences of pulses on iA and iB. However, any such stepper motor has an upper bound on this
speed such that the driving pulses are nonoverlapping in time.
Ignition System
The equivalent of an actuator for the ignition system on an engine is the combination of the
spark plug, the ignition coil, and driver electronic circuits. This is the subsystem that receives
the electrical signal from the engine controller and delivers as its output the spark that ignites
the mixture during the end of the compression stroke.
304
Chapter 6

Figure 6.37 is a block diagram schematic drawing illustrating this subsystem. The primary
circuit of the coil (depicted as the left portion P of the coil in Figure 6.37) is connected to the
battery and through a power transistor to ground. For convenience, the collector, emitter, and
base are denoted C, E, and B, respectively (see Chapter 3). The coil secondary S is connected
to one or more spark plugs, as explained in Chapter 7. A model for the operation of the
ignition system is developed next.
Ignition Coil Operations
The ignition coil is a structure in which a pair of windings (primary P and secondary S) is
wound around a ferromagnetic core. This core forms a closed magnetic path linking (ideally)
all P and S turns. In contemporary automotive electronic systems, there is often a single coil
for each spark plug or for each pair of spark plugs.
Figure 6.37 depicts a functional model for the ignition system in which the ignition coil is
represented by a structure having the topology of a transformer. Denoting the number of turns
in the secondary Ns and in the primary Np for any practically useful ignition coil Ns >> Np.
Although this ﬁgure depicts only a single spark plug and coil, there must be, of course,
a separate circuit for each cylinder.
The engine control unit (ECU) controls the operation of the ignition system via a control
signal (eb) that is applied to the base of transistor Q. Whenever base current ib ¼ 0, the
transistor is in a cutoff condition and its collector current icy0. At the appropriate time (as
determined from angular position measurements of the crankshaft and camshaft), the ECU
outputs a signal that causes the transistor to switch from cutoff to saturation (see Chapter 3).
In saturation, the transistor emitter/collector resistance Rec ¼ Ron where Ron is a small but
nonzero resistance. The collector current Ip that ﬂows under saturation conditions can be
shown to satisfy the following differential equation:
Vb ¼ RonIp þ Lp
dIP
dt
(119)
BATTERY
VOLTAGE
C
IP
P
DRIVER
TRANSISTOR
BASE
CURRENT
E
B
C
COIL
SPARK PLUGS
ELECTRONIC
IGNITION CONTROL
TRIGGER
PULSES
FROM
ENGINE
CONTROL
S
Figure 6.37:
Electronic ignition block diagram.
Sensors and Actuators
305

where Vb is the vehicle power bus voltage and Lp is the primary coil inductance. Using the
Laplace transform methods of Chapter 1, the current Ip through the coil (equal to the collector
current) primary can be shown to be
IpðtÞ ¼ Vb
Ron

1  et=sc

where sc ¼ Lp=Ron
Normally, the ECU will generate a control signal eb of sufﬁcient duration that Ip has
essentially reached the steady-state value of Vb/Ron. The duration of this control signal is
known as “dwell.” The end of this dwell period corresponds to the time that spark is to occur
for the given cylinder. At this time, the ECU switches off the control signal and the coil
primary current drops rapidly to 0.
The physical process of creating the spark is the very large coil secondary voltage vs which is
given by
Vs ¼ Ns
dF
dt
where F is the total magnetic ﬂux through the core, magnetically linking the Ns turns of the
coil secondary.
From the discussions of magnetic ﬁeld theory for various magnetic sensors and actuators
earlier in this chapter, it was shown that the lines of constant magnetic ﬂux density within the
ferromagnetic coil core are parallel to the contour C depicted in Figure 6.38. It can be shown
that the total magnetic ﬂux is proportional to the coil primary current Ip. At the end of the
dwell period, this ﬂux will have reached a saturation value Fs given approximately by
ib
lb
Vb
Rb
Ci
(P)
(S)
Contour
Spark
plug
Ignition coil
IGN
OUT
ECU
Ferromagnetic coil
Vs
Ip
Q
b
c
e
Figure 6.38:
Simpliﬁed electronic ignition circuit.
306
Chapter 6

Fs y mcAcVb
‘cRon
where mc is the core permeability, ‘c is the distance around contour C, and Ac is the core cross-
sectional area (normal to C).
The secondary voltage (Vs(t)) is a short-duration, very large peak amplitude voltage pulse.
The large amplitude of this pulse results from the relatively large value for Ns and the very
large time rate of change of F. The capacitor Ci, which is shown in Figure 6.38, is partly
responsible for the very large rate of change of Ip at the end of dwell.
The generation of the high voltage necessary for ignition based upon magnetic induction
using a coil such as is described above has been used to create the ignition spark in various
circuits since the earliest days of the four-stroke spark ignited IC engine. This method is likely
to continue well into the future for this engine type.
With the background in sensors and actuators from this chapter, it is now possible to discuss
the various automotive control systems.
Sensors and Actuators
307

This page intentionally left blank

CHAPTER 7
Digital Powertrain Control Systems
Chapter Outline
Introduction
310
Digital Engine Control
310
Digital Engine Control Features
312
Control Modes for Fuel Control
316
Engine Start
317
Open-Loop Mode
317
Acceleration/Deceleration
317
Engine Crank
319
Engine Warm-Up
320
Open-Loop Control
322
Closed-Loop Control
323
Acceleration Enrichment
328
Deceleration Leaning
328
Idle Speed Control
329
Discrete Time Idle Speed Control
329
EGR Control
335
Variable Valve Timing Control
337
Electronic Ignition Control
343
Closed-Loop Ignition Timing
347
Spark Advance Correction Scheme
353
Integrated Engine Control System
354
Secondary Air Management
354
Evaporative Emissions Canister Purge
355
Automatic System Adjustment
356
System Diagnosis
356
Summary of Control Modes
357
Engine Crank (Start)
357
Engine Warm-Up
357
Open-Loop Control
357
Closed-Loop Control
358
Hard Acceleration
358
Deceleration and Idle
359
Automatic Transmission Control
359
Torque Converter Lock-Up Control
366
Differential and Traction Control
366
Hybrid Electric Vehicle Powertrain Control
368
Understanding Automotive Electronics. http://dx.doi.org/10.1016/B978-0-08-097097-4.00007-2
Copyright  2012 Elsevier Inc. All rights reserved.
309

Introduction
Traditionally, the term powertrain has been used to include the engine, transmission,
differential, and drive axle/wheel assemblies. With the advent of electronic controls, the
powertrain also includes the electronic control system (in whatever conﬁguration it has). In
addition to engine control functions for emissions regulation, fuel economy, and
performance, electronic controls are also used in the automatic transmission to select shifting
as a function of operating conditions. Moreover, certain vehicles employ electronically
controlled clutches in the differential (transaxle) for traction control. Electronic controls for
these major powertrain components can be either separate (i.e., one for each component) or
an integrated system regulating the powertrain as a unit.
This latter integrated control system has the beneﬁt of obtaining optimal vehicle performance
within the constraints of exhaust emission and fuel economy regulations. Each of the control
systems is discussed separately beginning with electronic engine control. Then a brief
discussion of integrated powertrain follows. This chapter concludes with a discussion of
hybrid, electric vehicle (HEV) control systems in which propulsive power comes from an IC
engine or an electric motor, or a combination of both. The proper balance of power between
these two sources is a complex function of operating conditions and governmental
regulations.
Digital Engine Control
Chapter 5 discussed some of the fundamental issues involved in electronic engine control.
This chapter explores some practical digital control systems. There is, of course, considerable
variation in the conﬁguration and control concept from one manufacturer to another.
However, this chapter describes representative control systems that are not necessarily based
on the system of any given manufacturer, thereby giving the reader an understanding of the
conﬁguration and operating principles of a generic representative system. As such, the
systems in this discussion are a compilation of the features used by several manufacturers.
In Chapter 5, engine control was discussed with respect to continuous time representation. In
fact, modern engine control systems, such as the ones discussed in this chapter, are digital.
A typical engine control system incorporates a microprocessor and is essentially a special-
purpose computer (or microcontroller).
Electronic engine control has evolved from a relatively rudimentary fuel control system
employing discrete analog components to the highly precise fuel and ignition control
achieved through microprocessor-based integrated digital electronic powertrain control. The
motivation for development of the more sophisticated digital control systems has been the
increasingly stringent exhaust emission and fuel economy regulations that have evolved
310
Chapter 7

recently. It has proven to be cost effective to implement the powertrain controller as
a multimode computer-based system to satisfy these requirements.
A multimode controller operates in one of many possible modes, and, among other tasks,
changes the various calibration parameters as operating conditions change in order to
optimize performance. To implement multimode control in analog electronics, it would be
necessary to change hardware parameters (for example, via switching systems) to
accommodate various operating conditions. In a computer-based controller, however, the
control law and system parameters are changed via program (i.e., software) control. The
hardware remains ﬁxed but the software is reconﬁgured in accordance with operating
conditions as determined by sensor measurements and switch inputs to the controller.
This chapter will explain how the microcontroller under program control is responsible for
generating the electrical signals that operate the fuel injectors and trigger the ignition pulses.
This chapter also discusses secondary functions (including management of secondary air that
must be provided to the catalytic converter, EGR regulation, and evaporative emission
control) that have not been discussed in detail before.
All digital systems are inherently discrete time model based. That is, rather than modeling
systems or subsystems on a continuous time basis, all processes are characterized at discrete
times tk where
tk ¼ kTs
k ¼ 1; 2; 3.
Ts ¼ sample time
(1)
The time interval between successive sample times is the period during which the control
system performs the necessary computations to perform its function. The theoretical basis for
discrete time system modeling and analysis has been explained in Chapter 2. However, as
explained in Chapter 5, the majority of automotive control or instrumentation systems employ
some analog sensors and actuators (or in the instrumentation case, displays).
In Chapter 6, it was shown that the majority of sensors and actuators are analog devices that
are modeled as functions of continuous time t. As described in Chapter 2, measurements
made by continuous time sensors are sampled at times tk to obtain the necessary discrete time
system input. When representing the sampled data from a continuous time sensor having an
output terminal voltage V0(t) the notation used here to represent the kth sample of V0 is Vk
where
Vk ¼ V0ðtkÞ
(2)
It is, perhaps, worthwhile at this point to illustrate the operation of a digital control system
with a simple example. Although certain automotive control requires measurements from
Digital Powertrain Control Systems
311

multiple sensors (i.e. with multiple inputs) to perform a speciﬁc task, our illustration
considers the example of a single input, single output (SISO) linear system. Let the input to
the controller at time tk be xk and the output corresponding to this and other previous inputs be
denoted yk. It should be noted that yk is output from the digital system at a time delayed from
the xk owing to the nonzero computation time. As explained in Chapter 2, one form for the
relationship between the input and output of a linear SISO digital system is given by the
recursive algorithm below:
yk ¼
X
M
m¼0
amxkm 
X
N
n¼1
bnykn
(3)
The coefﬁcients am and bn are chosen by the designer to perform a speciﬁc task. It should be
noted that for a purely linear system with continuous time sensor and actuator, it is possible to
develop the control function relating input and output using continuous time techniques. Then
the discrete time coefﬁcients can be obtained from this continuous time function by
a discretization process as described in Chapter 2.
The trend in contemporary automotive electronic systems is to perform multiple control
operations using an integrated digital system based upon a microprocessor/microcontroller.
Furthermore, it is an aspect of a digital system that nonlinear transformations and/or
calculations are handled as well as linear ones.
Digital Engine Control Features
Recall from Chapter 5 that one primary purpose of the electronic engine control system is to
regulate the mixture (i.e., airefuel), the ignition timing, and EGR. Virtually all major
manufacturers of cars sold in the United States (both foreign and domestic) use the three-way
catalytic converter for meeting exhaust emission constraints. For such cars, the air/fuel ratio is
held as closely as possible to the stoichiometric value of about 14.7 for as much of the time as
possible. Ignition timing and EGR are controlled separately to optimize performance and fuel
economy.
Figure 7.1 illustrates the primary components of an electronic engine control system. In this
ﬁgure, the engine control system is a microcontroller, typically implemented with a specially
designed microprocessor or microcontroller and operating under program control. Spark
plugs for this four-cylinder example are denoted S.P.
Typically, the controller incorporates hardware for the multiply/divide operation as well as
ROM (see Chapter 4). The hardware multiply greatly speeds up the multiplication routines,
which are generally cumbersome and slow when implemented by a subroutine in the
software. The associated ROM contains the program for each mode as well as calibration
312
Chapter 7

parameters and lookup tables. The microcontroller under program control generates output
electrical signals to operate the fuel injectors so as to maintain the desired mixture and
ignition to optimize performance. For a given engine output power (as commanded by the
driver via the accelerator pedal), the correct mixture is obtained by regulating the quantity of
fuel delivered into each cylinder during the intake stroke in accordance with the
corresponding intake air mass, as explained in Chapter 5.
With respect to the fuel control function the digital engine control system obtains
a measurement of mass airﬂow typically using a mass airﬂow (MAF) sensor. As shown in
Chapter 6, the MAF sensor generates an output terminal voltage vo given by
voðtÞ ¼ fmð _MaÞ
(4)
where _Ma is the instantaneous mass airﬂow rate into the engine intake system (kg/s).
As explained in Chapter 6, the function Fm for a representative production MAF sensor is
given by
voð _MaÞ ¼
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
v2oð0Þ þ KMAF _Ma
q
However, a digital fuel control system can invert a nonlinear function to obtain the value _Ma
of mass airﬂow:
_Ma ¼ f 1
m ðvoÞ
(5)
Figure 7.1:
Components of an electronically controlled engine.
Digital Powertrain Control Systems
313

As explained in Chapter 5, the intake to the engine includes EGR as well as air. As will be
shown below, the digital engine control system is able to determine the EGR mass ﬂow rate
_MEGR since it controls the ﬂow of EGR. In certain cases, the EGR rate is determined from
a differential pressure sensor (DPS). Thus, the correction for _MEGR in the MAF sensor output
is a straightforward computation.
An ideal engine control would determine the mass of air drawn into the mth cylinder during
the nth engine cycle Ma(n, m). This ideal controller would instantaneously inject fuel with
a uniform distribution at the end of the intake process for this cylinder to achieve a uniform
stoichiometric mixture throughout the cylinder in preparation for compression ignition and
power generation. This ideal process would assure that all cylinders achieved the desired
stoichiometric mixture for each cycle as desired for optimum exhaust emissions in
conjunction with the catalytic converter. However, this ideal fuel control is not practically
achievable.
On the other hand, suboptimal fuel control that is very close to optimal can be achieved in
practice. As will be shown later in this chapter, closed-loop fuel control provides sufﬁcient
regulation of mixture to meet the strictest emission regulations. It will also be shown later in
this chapter that fuel control operates in several possible modes. However, before proceeding
to this discussion it is helpful to explain some of the basic issues in the development of the
ﬁnal system conﬁguration and fuel control algorithms.
In practice, an MAF sensor is placed somewhere in the upstream end of the engine
intake system of tubes that direct airﬂow to the individual cylinders. Typically, this intake
system (called “the intake manifold”) is designed to achieve as uniform as possible
a distribution among all cylinders over the broadest possible operating range. For the
present discussion, it is helpful to assume that a uniform distribution of air is achieved for
each engine cycle.
At any instant t the total mass of air pumped into the engine during the previous engine cycle
of duration Te (corresponding to crankshaft rotation through 4p rotations) is given by
MaTðtÞ ¼
ZqeðtÞ
qeðtÞ4p
_MaðqeÞdqe
(6)
where qe(t) is the crankshaft instantaneous angular position at time t and Te is the period of an
engine cycle at the instantaneous RPM
¼ 120
RPM
314
Chapter 7

For simpliﬁcation and without serious loss of generality it is convenient to assume that the
engine is operating at a steady load and RPM. According to our assumptions, the amount of
air drawn into any given cylinder (m) during the nth engine cycle Ma(n, m) is given by
Maðn; mÞ ¼ MaT
Mc
m ¼ 1; 2.Mc
(7)
where Mc is the number of cylinders.
Note: If the RPM and load are changing but at a slow enough rate, then for at least the period
of one cycle the above model is sufﬁciently accurate to compute the desired fuel delivery for
a stoichiometric mixture.
The fuel mass to be supplied to cylinder m during the nth engine cycle f(n,m) is given by
fðn; mÞ ¼ Maðn; mÞ
Ra=f
(8)
where Ra/f is the desired ratio of mass of air to mass of fuel. As explained below, the correct
Ra/f depends upon the control operating mode. It is desirable that Ra/f be at stoichiometry
(i.e., Ra/f ¼ 14.7) for as much of the engine-operating period as possible for optimum exhaust
emission regulation.
As explained in Chapter 6, fuel delivery in contemporary engines is provided by fuel injectors.
It should be recalled that a fuel injector is a solenoid-operated valve that is opened by an
electrical control signal at the proper time in the engine cycle for a period of time sf(n, m)
(for cylinder m during cycle n) that is computed in the digital engine control system. It was
also explained in Chapter 6 that fuel under a regulated pressure is available on the upstream
side of the fuel injector valve via the fuel rail.
The fuel ﬂow rate _Mf is a function of the fuel rail pressure as well as the open area of the valve
and the displacement of the pintle by the solenoid. These latter two parameters are ﬁxed by
the structure of the fuel injector. The quantity of fuel delivered by the fuel injector F(n, m) for
the mth cylinder during the nth engine cycle is given by
Fðn; mÞ ¼
Z
tnmþsf ðn;mÞ
tnm
_Mf dt
(9)
where tn,m is the beginning time of fuel delivery control binary signal, tn,m þ sF(n, m) is the
end of fuel injection period, and _Mf is the fuel ﬂow rate for fuel injector.
Digital Powertrain Control Systems
315

It is common practice in contemporary engine design to place the fuel injector near to the
intake valve such that the fuel spray during the fuel injector open period is directed into the
cylinder through the intake valve opening. The binary fuel injection control voltage is timed
such that fuel is delivered during a portion of the intake stroke.
The fuel injector opening and closing dynamics are sufﬁciently short except for very small
F(n, m) that the fuel delivery is given approximately by
Fðn; mÞy _Mf sFðn; mÞ
(10)
It should be noted that for steady load and RPM typically sF should be constant; however, for
varying load and accelerating/decelerating engine sF may vary with both n and m.
Consequently, the notation sF retains both indices.
Control Modes for Fuel Control
The engine control system is responsible for controlling fuel and ignition for all possible
engine-operating conditions. However, there are a number of distinct categories of engine
operation, each of which corresponds to a separate and distinct operating mode for the engine
control system. The differences between these operating modes are sufﬁciently great that
a different software routine may be used for each. The control system must determine the
operating mode from the existing sensor data and call the particular corresponding software
routine. We begin with a qualitative survey of system operation in the various control modes
and later present formal models.
For a typical engine, there are at least seven different engine-operating modes that affect fuel
control: engine crank, engine warm-up, open-loop control, closed-loop control, hard
acceleration, deceleration, and idle. The program for mode control logic determines the
engine-operating mode from sensor data and timers.
In the earliest versions of electronic fuel control systems, the fuel metering actuator typically
consisted of one or two fuel injectors mounted near the throttle plate so as to deliver fuel into
the throttle body. These throttle body fuel injectors (TBFIs) were in effect an
electromechanical replacement for the carburetor. Requirements for the TBFI were such that
they only had to deliver fuel at the correct average ﬂow rate for any given mass airﬂow rate.
Mixing of the fuel and air, as well as distribution to the individual cylinders, took place in the
intake manifold system.
The more stringent exhaust emissions regulations of recent years have demanded more
precise fuel delivery than can normally be achieved by TBFI. These regulations and the need
for improved performance have led to timed sequential port fuel injection (TSPFI). In such
316
Chapter 7

a system, there is a fuel injector for each cylinder that is mounted so as to spray fuel directly
into the intake of the associated cylinder.
For the purposes of the present discussion, fuel delivery is assumed to be TSPFI (i.e., via
individual fuel injectors located so as to spray fuel directly into the intake port and timed to
coincide with the intake stroke). Airﬂow measurement is via an MAF sensor. Some engine
control systems involve vehicle speed sensors and various switches to identify brake on/off
and the transmission gear, depending on the particular control strategy employed. We
consider next the individual engine control modes.
Engine Start
When the ignition key is switched on initially, the mode control logic automatically selects an
engine start control scheme that provides the correct temperature-dependent air/fuel ratio
required for starting the engine. Once the engine RPM rises above the cranking value, the
controller identiﬁes the “engine started” mode and passes control to the program for the
engine warm-up mode. This operating mode typically keeps the air/fuel ratio relatively low to
prevent engine stall during cool or cold weather until the engine coolant temperature rises
above some minimum value. The instantaneous desired air/fuel is a function of coolant
temperature and ambient conditions. The particular value for the minimum coolant
temperature is speciﬁc to any given engine type and, in particular, to the fuel metering system.
(Alternatively, the low air/fuel ratio may be maintained for a ﬁxed time interval following
start, depending on start-up engine temperature.)
Open-Loop Mode
When the coolant temperature rises sufﬁciently, the mode control logic directs the system to
operate in the open-loop control mode until the EGO sensor warms up enough to provide
accurate readings. This condition is detected by monitoring the EGO sensor’s output for
voltage readings above a certain minimum rich air/fuel mixture voltage set point (see Chapter
6 for EGO sensor voltage characteristics). When the sensor has indicated rich at least once
and after the engine has been in open loop for a speciﬁc time, the control mode selection logic
selects the closed-loop mode for the system. (Note: other criteria may also be used.) The
engine remains in the closed-loop mode until the EGO sensor cools and fails to read a rich
mixture for a certain length of time or a hard acceleration or deceleration occurs. If the sensor
cools, the control mode logic selects the open-loop mode again.
Acceleration/Deceleration
During hard acceleration or heavy engine load, the control mode selection logic chooses
a scheme that provides a rich air/fuel mixture for the duration of the acceleration or heavy
Digital Powertrain Control Systems
317

load. This scheme has the capability to provide maximum torque, but depending on driver
demand, suboptimal emissions control, and relatively poor fuel economy regulation as
compared with a stoichiometric air/fuel ratio may occur. After the need for enrichment has
passed, control is returned to either open-loop or closed-loop mode, depending on the control
mode logic conditions that exist at that time. During periods of deceleration, the air/fuel ratio
might be increased to reduce emissions of HC and CO due to unburned excess fuel. However,
enleanment is limited to an air/fuel that avoids excess NOx production.
When idle conditions are present, control mode logic passes system control to the idle speed
control mode. In this mode, the engine speed is controlled to reduce engine roughness and
stalling that might occur because the idle load has changed due to air conditioner compressor
operation, alternator operation, or gearshift positioning from park/neutral to drive, although
stoichiometric mixture is used if the engine is warm. A detailed model and performance
analysis of idle speed control is presented later in this chapter.
As explained above, in modern engine control systems, the controller is a special-purpose
digital computer built around a microprocessor or microcontroller. An exemplary
conﬁguration of a typical modern digital engine control system is depicted in Figure 7.2.
Figure 7.2:
Digital engine control system diagram.
318
Chapter 7

The controller also includes ROM containing the main program (of several thousand lines of
code). This ROM is accessed by the engine control system via address bus A and receives data
via data bus D (see Chapter 4). There is also a section of ROM continuing parameter values
for speciﬁc control modes and tables of data for various control functions as explained later in
this chapter. Of course, any microprocessor-based system must have RAM for temporary
storage of data during computation (see Chapter 4). The sensor signals are connected to the
controller via an input/output (I/O) subsystem. Similarly, the I/O subsystem provides the
output signals to drive the fuel injectors (shown as the fuel metering block of Figure 7.2) as
well as to trigger pulses to the ignition system (described later in this chapter). In addition,
this microprocessor-based control system includes hardware for sampling and analog-to-
digital conversion such that all sensor measurements are in a format suitable for reading by
the microprocessor. (Note: See Chapter 4 for a detailed discussion of these components.)
With reference to Figure 7.2, the sensors that measure various engine variables for control are
as follows:
mass airﬂow sensor (MAF),
engine temperature as represented by coolant temperature (CT),
one or two heated exhaust gas oxygen sensor(s) (HEGO),
crankshaft angular position and RPM sensor (CPS),
camshaft position sensor for determining start of each engine cycle (CS POS/RPM),
throttle position sensor (TPS), and
differential pressure sensor (exhaust to intake) for EGR control (DPS).
Other sensors that might be used on older model cars that are not given in Figure 7.2 include
the following:
manifold pressure sensor (MAP),
inlet air temperature (IAT),
ambient air pressure (AAP), and
ambient air temperature (AAT).
The control system selects an operating mode based on the instantaneous operating condition
as determined from the sensor measurements. Within any given operating mode, the desired
air/fuel ratio (A/F)d is selected. The controller then determines the quantity of fuel to be
injected into each cylinder during each engine cycle. This quantity of fuel depends on the
particular engine-operating condition as well as the controller mode of operation, as will
presently be explained.
Engine Crank
While the engine is being cranked, the fuel control system must provide an intake air/fuel
ratio of anywhere from 2:1 to 12:1, depending on engine temperature. The lowest value for
Digital Powertrain Control Systems
319

[A/f]d would be applied for very cold temperatures. The correct air/fuel ratio (i.e., [A/F]d) is
selected from an ROM lookup table with interpolation (as explained later in this chapter) as
a function of coolant temperature. Low temperatures affect the ability of the fuel metering
system to atomize or mix the incoming air and fuel properly to achieve combustion. At low
temperatures, the fuel tends to form into large droplets in the air, which do not burn as
efﬁciently as tiny droplets. The larger fuel droplets tend to increase the apparent air/fuel ratio,
because the amount of usable fuel (on the surface of the droplets) in the air is reduced;
therefore, the fuel metering system must provide a decreased air/fuel ratio to provide the
engine with a more combustible air/fuel mixture. During engine crank the primary issue is to
achieve engine start as rapidly as possible. Once the engine is started the controller switches
to an engine warm-up mode.
Engine Warm-Up
While the engine is warming up, an enriched air/fuel ratio relative to stoichiometry is still
needed to keep it running smoothly, but the required air/fuel ratio changes as the temperature
increases. Therefore, the fuel control system stays in the open-loop mode, but the air/fuel
ratio commands continue to be altered due to the temperature changes. The emphasis in this
control mode is on rapid and smooth engine warm-up. Fuel economy and emission control
may be still a secondary concern. The controller selects a warm-up time from a lookup table
based on the temperature of the coolant. In certain cases, a fully warmed engine is switched
off by the driver for a brief period such that temperature remains sufﬁciently high that warm-
up mode is either very short or not used at all.
A diagram illustrating the lookup table selection of desired air/fuel ratios is shown in
Figure 7.3. Essentially, the measured coolant temperature (Tc) is converted to an address for
the lookup table with interpolation as described below. This address is supplied to the ROM
table via the system address bus (A/B). The data stored at this address in the ROM are desired
Figure 7.3:
Illustration of table lookup.
320
Chapter 7

air/fuel ratio (A/F)d for the temperature. These data are sent to the controller via the system
data bus (D/B).
The term lookup table refers to obtaining an output variable y that is a function of one or
more inputs. It provides an alternative to calculation based upon a model (e.g.,
a polynomial model). It is often applied to empirically obtained data (e.g., from engine
mapping) in which the optimum value of a variable (e.g., air/fuel) has been determined
from measurements for various values of the independent variables. It is inherently
limited to a ﬁnite number of discrete points in the relevant range for the independent
variables.
On the other hand, during actual engine operation these same independent variables are
continuous and rarely coincide perfectly with the stored values. In this case, the output
variable corresponding to these independent variables is obtained by a process called
interpolation. This process involves ﬁtting the region between two successive data points with
a function (normally linear). We illustrate linear interpolation with a two-dimensional data
set. Let yn be the value of a dependent variable (e.g. air/fuel) at independent data sensor output
point xn where n ¼ 1,2.N. Let x be a measurement of independent variable (e.g., coolant
temperature) for which the corresponding dependent variable y (e.g., desired air/fuel) is
sought. Also, let xm and xmþ1 be the nearest tabulated data points in the table in which
xm < x < xmþ1. The corresponding tabulated values for the dependent variable are ym and
ymþ1. For linear interpolation it is assumed that y varies linearly with x over the domain xm 
x  xm + 1. The slope S over this domain is given by
S ¼ dy
dx
¼ ymþ1  ym
xmþ1  xm
(11)
The linearly interpolated value for y is given by
y ¼ ym þ Sðx  xmÞ
¼ ym þ
ymþ1  ym
xmþ1  xm

ðx  xmÞ
(12)
Alternatively, it is possible to obtain a polynomial model which gives the best ﬁt to measured
data in a least squared error sense. Let an empirical data set be given by {xn, yn: n ¼ 1,2.N}.
The polynomial which best represents this data is of the form
y ¼ a0 þ a1x þ a2x2 þ /aMxM
M < N
(13)
Digital Powertrain Control Systems
321

The mean squared error between this polynomial and the data is
MSE ¼
X
N
n¼1
½yðxnÞ  yn2=N
(14)
There are many computer programs for ﬁnding the coefﬁcient set {am: m ¼ 0,1.M} such
that MSE is minimized. For example, the MATLAB function polyﬁt (xn, yn, M) returns the
coefﬁcient set am (of order M), which yields the least MSE for the given data set. In this case,
the digital engine control can calculate the desired dependent variable for any given
measurement of the independent variable x. The choice between table lookup with
interpolation and polynomial calculation can be assessed by the quality of ﬁt of the
polynomial to the data given by the MSE for the best polynomial ﬁt and by the relative
complexity of the two methods. The set of coefﬁcients for any given data are normally
determined during the development of an engine control system. These coefﬁcients are stored
in ROM such that the determination of y for any measurement x (during normal engine
operation) is readily implemented in the control system using Eqn (13) and the stored values
for {am} for the polynomial model method and by Eqn (12) for the lookup table and
interpolation method.
Returning to the discussion of coolant temperature for setting (A/F)d, there is always the
possibility of a coolant temperature failure. Such a failure could result in excessively rich or
lean mixtures, which can seriously degrade the performance of both the engine and the three-
way catalytic converter (3 wcc). One scheme that can circumvent a temperature sensor failure
involves having a time function to limit the duration of the engine warm-up mode. The
nominal time to warm the engine from cold soak at various temperatures is known. The
controller is conﬁgured to switch from engine warm-up mode to an open-loop (warmed-up
engine) mode after a sufﬁcient time by means of an internal timer.
Open-Loop Control
For a warmed-up engine, the controller will operate in an open loop if the closed-loop mode is
not available for any reason. For example, the engine may be warmed sufﬁciently but the
EGO sensor may not provide a usable signal. In any event, as soon as possible it is important
to have a stoichiometric mixture to minimize exhaust emissions.
It was shown above that the quantity of fuel to be delivered to cylinder m during the nth
engine cycle can be computed from MAF sensor measurements and can be regulated by
means of a fuel injector pulse duration sF(n, m). For the present, it is helpful to assume that
intake air is uniformly distributed to all M cylinders. In this case, the fuel injector open
duration is
322
Chapter 7

sFðn; mÞ ¼ sFðnÞ
cm
(15)
This quantity of fuel is actually delivered to each cylinder during the open-loop mode and is
often termed the “base pulse duration.” Until conditions permit closed-loop mode of fuel
control the fuel quantity is determined from MAF measurements. As a means of denoting
open-loop operation the notation for base pulse duration is sb(n):
sFðnÞðopen loopÞ ¼ sbðnÞ
(16)
Corrections of the base pulse width occur whenever any conditions affect the accuracy of the
fuel delivery. For example, low battery voltage might affect the pressure in the fuel rail that
delivers fuel to the fuel injectors. Corrections to the base pulse width are then made using the
actual battery voltage.
Closed-Loop Control
Perhaps the most important adjustment to the fuel injector pulse duration comes when the
control is in the closed-loop mode. In the open-loop mode, the accuracy of the fuel delivery is
dependent upon the accuracy of the measurements of the important variables (e.g., MAF).
However, any component of a given physical system is susceptible to changes with operating
conditions (e.g., temperature) or with time (aging or wear of components). Such failures or
degradation of sensor/actuator calibration can adversely affect exhaust emissions in the open-
loop mode.
To avoid degraded emission control, it is important for the control system to switch to the
closed-loop mode as soon as possible and to remain in this mode for as much of the engine
operation as possible. The closed-loop mode can only be activated when the EGO (or HEGO)
sensor is sufﬁciently warmed. Recall from Chapter 6 that for a fully warmed EGO sensor, the
output voltage of the sensor is high (approximately 1 V) when the exhaust oxygen
concentration is low (i.e., for a rich mixture relative to stoichiometry). The EGO sensor
voltage is low (approximately 0.1 V) whenever the exhaust oxygen concentration is high (i.e.,
for a mixture that is lean relative to stoichiometry).
Chapter 1 presented a discussion of the theory of the closed-loop control of a dynamic system
in which a measurement of the dynamic system output variable that is being regulated/
controlled is compared with the desired value. The controller produces an input to the plant that
changes the output variable in such a way as to minimize the error between actual and desired
output. Ideally, control of exhaust emissions would require a sensor for measuring the
concentration of each regulated gas component in the engine exhaust as explained in Chapter 5.
A large body of theory (both linear and nonlinear) exists which is applicable in the design of
Digital Powertrain Control Systems
323

a control system provided a sensor exists that can yield an accurate measurement with sufﬁcient
bandwidth of the variable being regulated.
However, as explained in Chapters 5 and 6, no cost-effective sensor for measuring these
regulated exhaust gases is available for production vehicles. On the other hand, as explained
in Chapter 5, the use of a three-way catalytic converter enables tailpipe emissions to be
controlled within regulatory limits provided the intake mixture remains sufﬁciently close to
stoichiometry. Furthermore, it was explained that the exhaust gas oxygen concentration
changes abruptly as the mixture transitions from rich to lean or from lean to rich at
stoichiometry. As explained in Chapter 6, the EGO sensor generates an output voltage that
follows exhaust gas concentration. A model for the EGO sensor voltage as a function of
exhaust equivalence ratio (l) was given in Chapter 5.
Unfortunately, a measurement of a switching output variable is compatible only with a limit
cycle controller. None of the linear control theory of Chapter 1 including design, performance
analysis, and stability is applicable to a limit cycle control system. Although such theory
exists for a limit cycle controller, this theory is beyond the scope of this book. However, as
will be shown below, it is possible to develop a dynamic simulation model for a limit cycle
fuel control system. Using this simulation, it is possible to investigate the inﬂuence of various
physical and design parameters on the system performance.
The physical conﬁguration for the closed-loop fuel control system is depicted in Figure 7.4a.
In this ﬁgure, the engine (Eng) receives fuel and air mixture in the intake system via the M
fuel injectors (denoted FI ‒ one for each cylinder).
The mixture ﬂowing into the engine is represented by the intake equivalence ratio (li). This
mixture is determined by the intake mass airﬂow rate ð _MaÞ and the fuel injector pulse
duration sF(n) for the nth engine cycle as explained above. The exhaust equivalence ratio lo
can be modeled as a time-delayed version of li where the time delay is modeled below. The
exhaust gas oxygen concentration is a function of lo such that the output voltage vo of the
EGO sensor can be represented in the ideal case by a binary model as given below.
Closed-loop fuel control consists of determining sF(n) as a function of the EGO sensor output
voltage. This pulse duration consists of a base pulse duration sb(n) and a closed-loop
correction factor (CL(n)) in the representative form
sFðnÞ ¼ sbðnÞ½1 þ CLðnÞ
(17)
One commonly employed algorithm for computing this correction factor is a linear
combination of a proportional-like term and a discrete time integral-like term as given
below
CLðnÞ ¼ aIðnÞ þ bPðnÞ
(18)
324
Chapter 7

where I(n) is the integral term, P(n) is the proportional term, a is the integral gain, and b is the
proportional gain.
The integral-like term is determined in the digital control system as a function of the EGO
sensor voltage vo. As explained in Chapter 5, this voltage is a function of exhaust gas oxygen
concentration. This voltage can also be characterized in terms of a variable called the exhaust
equivalence ratio (lo). After a given engine cycle is complete, this exhaust gas equivalence
ratio is given approximately by a time-delayed version of li in the form
loðtÞyliðt  TeÞ
(19)
where Te is the engine cycle time
Mf
Ma
intake
air
digital
control
system
Eng
FI
(M)
EGO
EGO
I
2
1—s
alpha
Integrator
To Workspace 3
To Workspace 1
To Workspace
To Workspace 2
In1 Out1
-K-
beta
avg
Add
Transport
Delay
t
Clock
y
v
(n)
vo
(a)
(b)
+
+
.
.
Figure 7.4:
Closed-loop fuel control system.
¼ 120
RPM
Digital Powertrain Control Systems
325

With this notation, the EGO sensor voltage is given by
voðloÞ ¼ VH
lo < 1ðrich mixtureÞ
¼ VL
lo > 1ðlean mixtureÞ
(20)
where VH is the EGO sensor “high” level z1 volt and VL is the EGO sensor “low” level
(z0.1 V).
Using the above notation, the integral control algorithm at computation time tk; ½IðkÞ is
given by
Iðk þ 1Þ ¼ IðkÞ  1
l0ðkÞ < 1
¼ IðkÞ þ 1
l0ðkÞ > 1
(21)
In this algorithm, the computation time tk is given by
tk ¼ kTs
k ¼ 1; 2.
Ts ¼ sample time
In determining the value of I(n) for the nth engine cycle, the most recent value for I(tk) is
taken. During engine operation I(k) continuously increases or decreases linearly with time tk
depending upon l0.
The “proportional” term for the nth engine cycle is the average over the K previous samples of
the EGO sensor voltage:
PðnÞ ¼ 1
K
" X
K
k¼1
voðtn  tkÞ
#
 vom
(22)
where vom is the EGO sensor mid-range value (corresponding to stoichiometry). The linear
combination above for CL(n) is representative of closed-loop correction calculations used by
a digital fuel control system to modify the base pulse duration.
A fundamental characteristic of a limit cycle control system is the oscillatory behavior of its
control variable. The CL(n) term continuously oscillates about a nominal value even for
a steady engine load and RPM. In the case of the fuel control, the frequency of oscillation and
the amplitude of the deviation vary inversely with Te.
To illustrate the behavior of a limit cycle controller a MATLAB/SIMULINK simulation was
constructed for the example block diagram of Figure 7.4b. The sample period was Ts ¼ 0.01 s
and the RPM was taken to be about 1000 RPM. The closed-loop control parameters were
taken to be a ¼ 2Ts, b ¼ 0.025.
326
Chapter 7

The simulation block diagram uses an ideal model for the EGO sensor (see Figure 6.23),
combined with the integral control logic of Eqn (21). Since the time steps are in multiples of
Ts and since the integrator is integrating a constant magnitude with only a sign change, the
actual stepwise function of Eqn (21) is very closely approximated using the continuous time
integrator (which is simpler to implement in the simulation than the discrete time version).
The hysteresis is 0.1 air/fuel ratio for this ideal sensor. The time delay is Te ¼ 0.067 s and is
implemented in a transport delay SIMULINK block.
Figure 7.5 is a sample of the waveform where the solid curve is the EGO sensor output
voltage and the dashed curve is the integral portion of the CL and the deviation of the air/fuel
ratio is the dash-dot curve. Note that this deviation is 0.1 air/fuel ratios.
The time delay between the integral part of CL(n) and the EGO sensor output is too small to be
evident from the ﬁgure. Only a short time interval of the waveforms is presented in order to
show the detailed response. Also apparent in this ﬁgure is the relationship between the
exhaust gas concentration and the slope of the integral part of CL(n). Whenever the EGO
sensor voltage is high, corresponding to a rich mixture relative to stoichiometry, the integral
component is decreasing which decreases sF causing the mixture to become leaner.
Conversely, a low EGO sensor voltage causes the integral part to increase, thereby enriching
the mixture.
In Figure 7.5, it can be seen that the air/fuel oscillates within 0.1 air/fuel ratio of
stoichiometry (14.7). This performance should be sufﬁcient that the tail pipe gases after
passing through the three-way converter should meet government-mandated limits.
Figure 7.5:
Example limit cycle operation.
Digital Powertrain Control Systems
327

Acceleration Enrichment
During periods of heavy engine load such as during hard acceleration, fuel control is adjusted
to provide an enriched air/fuel ratio to maximize engine torque and very brieﬂy neglect fuel
economy and emissions. This condition of enrichment is permitted within the regulations of
the EPA as it is only a temporary condition. It is well recognized that hard acceleration is
occasionally required for maneuvering in certain situations and is, in fact, related at times to
safety. A relatively large increase in throttle angle corresponds to heavy engine load and is an
indication that heavy acceleration is called for by the driver. In some vehicles, a switch is
provided to detect wide open throttle. The fuel system controller responds by increasing the
pulse duration of the fuel injector signal for the duration of the heavy load. This enrichment
enables the engine to operate with a torque greater than that allowed when emissions and fuel
economy are controlled. Enrichment of the air/fuel ratio to about 12:1 is sometimes used and
corresponds roughly to a maximum engine brake torque.
Alternatively, heavy acceleration can be detected from the time derivative of throttle angle qT.
In discrete time control systems, the rate of throttle change rT is given by
rTðkÞ ¼ qTðkÞ  qTðk  1Þ
Ts
(23)
Enrichment is enabled whenever rT exceeds a predetermined threshold value (rTt). For
rT >rTt, enrichment is accomplished by increasing sF from its normal closed-loop value. For
example, sF for rT > rTt can include an extra term of the following form:
sFðrTÞ ¼ sbð1 þ CL þ FðrTÞÞ
rT > rTt
where F(rT) is often an empirically determined function for a givenvehicle engine conﬁguration.
Deceleration Leaning
During periods of light engine load and high RPM such as coasting or deceleration, the engine
may operate with a very lean air/fuel ratio to reduce excess emissions of HC and CO.
Decelerationisindicatedbyasuddendecreaseinthrottleangleorbyclosureofa switchwhenthe
throttle is closed (depending on the particular vehicle conﬁguration). When these conditions are
detected by the control computer, it computes a decrease in the pulse duration of the fuel injector
signal. The fuel may even be turned off completely for very heavy deceleration. This decrease
can be represented by the equation for acceleration in which the function
FðrTÞ ¼ FdðrTÞ
rT < rTd
(24)
where rTd is a threshold value for rT below which enleanment is required and where Fd(rT) is
the enleanment function.
328
Chapter 7

Idle Speed Control
The idle speed control mode is used to prevent engine stall during idle. The goal is to allow
the engine to idle at as low an RPM as possible, yet keep the engine from running rough and
stalling when power-consuming accessories, such as air conditioning compressors and
alternators, turn on.
The control mode selection logic switches to idle speed control when the throttle angle
reaches its zero (completely closed) position as detected by a switch on the throttle that is
closed and engine RPM falls below a minimum value. This condition often occurs when the
vehicle is stationary. Idle speed is controlled by using an electronically controlled throttle
bypass valve, as seen in Figure 7.6a, which allows air to ﬂow around the throttle plate and
produces the same effect as if the throttle had been slightly opened such that sufﬁcient _Ma
ﬂows to maintain engine operation.
There are various schemes for operating a valve to introduce bypass air for idle control. One
relatively common method for controlling the idle speed bypass air uses a special type of
motor called a stepper motor. One stepper motor conﬁguration consists of a rotor with
permanent magnets and two sets of windings in the stator that are powered by separate driver
circuits. The conﬁguration of a stepper motor is similar to that of a brushless DC motor as
explained in Chapter 6 (see Figure 6.36). Such a motor can be operated in either direction by
supplying pulses in the proper phase to the windings as explained in Chapter 6. This is
advantageous for idle speed control since the controller can very precisely position the idle
bypass valve by sending the proper number of pulses of the correct phasing.
A digital engine control computer can precisely determine the position of the valve in
a number of ways. In one way, the computer can send sufﬁcient pulses to close completely the
valve when the ignition is ﬁrst switched on. Then it can open pulses (phased to open the valve)
to a speciﬁed (known) position. The physical conﬁguration for the idle speed control is
depicted in Figure 7.6a. The variables have the same notation as given in Chapter 5.
In addition, the digital engine control system receives digital on/off status inputs from several
power-consuming devices attached to the engine, such as the air conditioner clutch switch,
park-neutral switch, and the battery charge indicator. These inputs indicate the load that is
applied to the engine during idle.
Discrete Time Idle Speed Control
In Chapter 5, an idle speed control system (ISC) was introduced based upon the continuous
time control theory of Chapter 1. As explained in Chapter 5, the purpose of the ISC is to
maintain the engine idle speed U at a constant (set point) value Us. The ISC is one of many
Digital Powertrain Control Systems
329

control modes of the digital engine control system. Since this function is implemented
digitally, the ISC is inherently a discrete time system.
In this section, we consider a digital (i.e., discrete time) implementation of the same ISC that
was presented in Chapter 5. Figure 7.7 is a block diagram of this discrete time system in
which the control subsystem labeled Hc is implemented in the integrated digital electronic
engine control system.
Figure 7.6:
Idle speed control system.
330
Chapter 7

The present discussion is an example of discrete time control introduced in Chapter 2. In this
ﬁgure, the plant being controlled consists of the engine with the idle air bypass actuator. This
plant is an analog system modeled by continuous time equations. Using the Laplace transform
methods of Chapter 1, it was shown in Chapter 5, that, for the example ISC, the plant transfer
function Hp(s) is given by
HpðsÞ ¼
5000
s3 þ 35s2 þ 875s þ 6250
(25)
The desired idle angular speed (or set point for the controller) is denoted Us in Figure 7.7.
Also depicted in the block diagram of this ﬁgure is the actual idle angular speed U(t) or U(s).
A measurement of U made by the sensor is fed back to the system input forming an error ˛:
˛ðsÞ ¼ Us  HsðsÞUðsÞ
(26)
In the example of Chapter 5 it was assumed for computational simplicity that the sensor is
ideal such that Hs(s) ¼ 1. For the purposes of comparing the continuous time idle speed
control system with the present discrete time, digital implementation we make the same
assumption here along with assuming the same plant model.
In the present discrete time implementation, the error is sampled periodically with period T. In
accordance with the discrete time control theory of Chapter 2 we assume an ideal sampler/
quantizer (i.e. A/D converter) such that the input to the discrete time control system is ˛:
˛k ¼ ˛ðkTÞ
k ¼ 1; 2; 3.
(27)
We further assume that in keeping with the continuous time system, the control is PI. The
continuous time model for the control system is given by its operational transfer function:
HcðsÞ ¼ uðsÞ
˛ðsÞ
HcðsÞ ¼ Kp þ KI
s
(28)
z
Figure 7.7:
Discrete time idle speed control block diagram.
Digital Powertrain Control Systems
331

In the time domain, the control variable u(t) can be written as
uðtÞ ¼ Kp˛ðtÞ þ KI
Zt
o
˛ðt0Þdt0
The discrete time model for u(t) at sample time tk(i.e., uk) is given by
uðkÞ ¼ Kp˛k þ KIukI
where ˛k ¼ ˛ðtkÞ, tk ¼ kT, and T is the sample period.
In the PI model ukI is the discrete time version of the integral term evaluated at time tk. There
are many ways of approximating the continuous time integral with a discrete time version.
The trapezoidal integration rule is chosen here. In this method, the integral of ˛ðtÞ at time tk
can be approximated by the following:
Ztk
o
˛ðtÞdty
Ztk1
o
˛ðtÞdt þ T
2ð˛ðtkÞ þ ˛ðtk1ÞÞ
(29)
where the second term approximates the contributions to the integral at tk by the integral
evaluated at tk1 þ the area of a trapezoidal area under the function ˛ðtÞ from tk1 to tk. Using
this model, we obtain the following recursive equation:
uk ¼ uk1 þ KIT
2 ð˛k þ ˛k1Þ
(30)
Taking the z-transform of this equation yields the following expression:
uIðzÞ ¼ z1uIðzÞ þ K1Tð1  z1Þ
2
˛ðzÞ
(31)
This equation can be rewritten as
uIðzÞ ¼ KIT
2
ðz þ 1Þ
ðz  1Þ ˛ðzÞ
(32)
It can be shown that the z-transform operational transfer function Hc(z) is given by
HcðzÞ ¼ uðzÞ
˛ðzÞ
HcðzÞ ¼ Kp þ KITðz þ 1Þ
2ðz  1Þ
¼ ðKp þ KIT=2Þz þ ðKIT=2  KpÞ
ðz  1Þ
(33)
332
Chapter 7

The controller outputs a sequence {uk} control signal that is converted to a piecewise
continuous time control signal uðtÞ via the ZOH (see Chapter 2) which operates the plant
actuator.
It was also shown in Chapter 2 that the z-transform operational transfer function of the
combination ZOH and plant G(z) is given by
GðzÞ ¼

1  z1
Z
HpðsÞ
s

(34)
As shown in Chapter 2 the method of ﬁnding the z-transform of Hp(s)/s is ﬁrst to ﬁnd the
partial fraction expansion of this function and then using the table of Chapter 2 to ﬁnd the
individual z-transforms of each partial fraction. Then the desired G(z) is found by combining
those terms into a ratio of polynomials in z. It can be shown using this procedure that G(z) for
the example system with sample time T ¼ 0.01 s is given by
GðzÞ ¼ 103ð0:762z2 þ 2:788z þ 0:6391Þ
ðz3  2:629z2 þ 2:3381z  0:7040Þ
The z-transform operational transfer function for the forward path HF(z) is given by
HFðzÞ ¼ HcðzÞGðzÞ
¼ 103½0:9563z3 þ 2:6247z2  2:3879z  0:7323
z4  3:6286z3 þ 4:9672z2  3:0432z þ 0:704
(35)
The closed-loop transfer function HCL(z) (as explained in Chapter 2) is given by
HCLðzÞ ¼
HcðzÞGðzÞ
1 þ HcðzÞGðzÞ
(36)
It can be shown that, using the parameters of the example of Chapter 5, HCL(z) is given by
HCLðzÞ ¼ 103ð0:9563z3 þ 2:624z2  2:3879z  0:7323Þ
z4  3:629z3 þ 4:9698z2  3:0456z þ 0:7040
(37)
The four poles of HCL(z) are given by
z1 ¼ 0:9236 þ 0:1912i
z2 ¼ 0:9236  0:1912i
z3 ¼ 0:9246
z4 ¼ 0:8559
Digital Powertrain Control Systems
333

All four poles are inside the unit circle (jzj ¼ 1) in the complex z-plane so the system is stable.
In Chapter 5, the performance of the continuous time ISC was examined by computing the
step response in which the command speed was changed from 550 to 600 RPM at time
t ¼ 0.5 s. A similar step change can be determined for the discrete time ISC by assuming
a command input US(t) given by
USðtÞ ¼ 550 þ 50uðtÞ
(38)
where u(t) ¼ unit step at t ¼ 0. The z-transform of the ISC dynamic response to this input is
given by
UðzÞ ¼ 550 þ 50
z
z  1 HCLðzÞ
¼ 550 þ
0:05ð0:9563z4 þ 2:624z3  2:3879z2  0:7323zÞ
z5  4:622z4 þ 8:5975z3  8:0154z2 þ 3:7496z  0:7040
(39)
The system output at times tk can be found by writing the partial fraction expansion for the
product y(z):
yðzÞ ¼ zHCLðzÞ
z  1
(40)
As shown in Chapter 2 this partial fraction is of the form
yðzÞ ¼
X
5
m¼1
am
z  zm
where am is the residue of y(z) at pole zm and zm denotes poles of y(z) m¼1,2,3,4,5.
The response of the system at time tk which is denoted yk was shown in Chapter 2 (by equating
coefﬁcients of zk on both sides of the above equation) to be given by
yk ¼
X
5
m¼1
amzmk1
Figure 7.8 is a plot of U(tk) where
UðtkÞ ¼ 550 þ 50yk
A comparison of Figure 5.29 in Chapter 5 with Figure 7.8 shows that the dynamic
performance of the discrete time digital version of ISC is nearly identical with the
334
Chapter 7

corresponding continuous time system. When the engine is not idling, the idle speed control
valve may be completely closed so that the throttle plate has total control of intake air.
EGR Control
A second electronic engine control subsystem involves the control of exhaust gas that is
recirculated back to the intake manifold. Under normal operating conditions, engine cylinder
temperatures can reach a point at which NOx is formed during combustion. The exhaust will
have NOx emissions that increase with increasing combustion temperature. As explained in
Chapter 5, a small amount of exhaust is introduced into the cylinder to replace some of the
normal intake air. This results in lower combustion temperatures, which reduces NOx
emissions.
The control mode selection logic determines when EGR is turned off or on. EGR is turned off
during cranking, cold engine temperature (engine warm-up), idling, acceleration, or other
conditions demanding high torque. Since exhaust gas recirculation was ﬁrst introduced as
a concept for reducing NOx exhaust emissions, its implementation has gone through
considerable change. There are, in fact, many schemes and conﬁgurations for EGR
realization. We discuss here one method of EGR implementation that incorporates enough
features to be representative of all schemes in use today and in the near future.
Figure 7.8:
Step response of discrete time idle speed control.
Digital Powertrain Control Systems
335

Fundamental to all EGR schemes is a passageway or port connecting the exhaust and intake
manifolds. A valve is positioned along this passageway whose position regulates EGR from
zero to some maximum value. In one conﬁguration, the valve is operated by a diaphragm
connected to a variable vacuum source. The controller operates a solenoid in a periodic
variable-duty-cycle mode. By varying this duty cycle, the control system has proportional
control over the EGR valve opening and thereby over the amount of EGR. However, EGR
activation also can be done using a motor such as a stepper motor as described in Chapter 6.
The solenoid-based EGR actuator has cost advantages over a motor-based system, although
manifold vacuum required to operate it varies with engine-operating conditions and is very
low at wide open throttle.
In many EGR control systems the controller monitors the differential pressure between the
exhaust and intake manifold via a differential pressure sensor (DPS). With the signal from this
sensor, the controller can calculate the valve opening for the desired EGR level. The amount
of EGR required is a predetermined function of the load on the engine (i.e., power produced).
A simpliﬁed block diagram for an exemplary EGR control system is depicted in Figure 7.9. In
this ﬁgure, the EGR valve is operated by a solenoid-regulated vacuum actuator (coming from
the intake). An explanation of this proportional actuator is given in Chapter 6. The engine
controller determines the required amount of EGR based on the engine-operating condition
and the signal from the differential pressure sensor (DPS) between intake and exhaust
manifolds. The controller then commands the correct EGR valve position to achieve the
desired amount of EGR via a variable-duty-cycle actuator signal.
The optimum amount of EGR can be determined empirically as a function of engine-
operating conditions. Ideally, closed-loop control of EGR would require, for example,
a combustion temperature sensor. Although a cost-effective sensor for directly measuring
combustion temperature has not been developed yet, there is a correlation between exhaust
gas temperature and combustion temperature. The former is readily measurable with
Figure 7.9:
EGR control block diagram.
336
Chapter 7

relatively inexpensive sensors. In principle, the amount of EGR could be based upon a closed-
loop control system using exhaust gas temperature measurements for a feedback signal.
Variable Valve Timing Control
Chapter 5 introduced the concept and relative beneﬁts of variable valve timing for improved
volumetric efﬁciency. There it was explained that performance improvement and emission
reductions could be achieved if the opening and closing times (and ideally the valve lift) of
both intake and exhaust valves could be controlled as a function of operating conditions. In
Chapter 6, a representative mechanism was discussed for varying camshaft phasing that can
be used for varying either/both intake and exhaust camshaft phasing. This system improves
volumetric efﬁciency by varying valve overlap from exhaust closing to intake opening as well
as the absolute phase of valve opening and closing. In addition to improving volumetric
efﬁciency, this variable valve phasing can assist in achieving desired EGR fraction.
The amount of valve overlap is directly related to the relative exhausteintake camshaft
phasing. Generally, minimal overlap is desired at idle. The desired optimal amount of overlap
is determined during engine development as a function of RPM and load (e.g., by engine
mapping).
The desired exhaust and/or intake camshaft phasing is stored in memory (ROM) in the engine
control system as a function of RPM and load. Then during engine operation the correct
camshaft phasing can be found via table lookup and interpolation based on measurements of
RPM and load. The RPM measurement is achieved using a noncontacting angular speed
sensor (see Chapter 6). Load is measured either using MAF as well as RPM or via an MAP
sensor (see Chapter 6).
Once the desired camshaft phasing has been determined, the engine control system sends an
appropriate electrical control signal to an actuator (e.g., a motor or a solenoid-operated
valve). In Chapter 5, it was shown that for one conﬁguration camshaft phasing is regulated by
the axial position of a helical spline gear. This axial position is determined by the pressure of
(engine) oil action on one face of the helical spline gear acting against a spring. This oil
pressure is regulated by the solenoid-operated valve.
In Chapter 6, an alternate mechanism for varying camshaft phasing is implemented using oil
pressure-activated movable vanes in recesses in the camshaft drive gear. For either this latter
mechanism or one based upon a helical gear axial position, closed-loop control enables the
engine control system to optimize volumetric efﬁciency.
Since a variable valve phasing system is in fact a position control system, closed-loop control
of a camshaft phase requires a measurement of camshaft position relative to the crankshaft.
This angular position measurement can be accomplished by measuring the angle between the
Digital Powertrain Control Systems
337

camshaft and its drive gear. Numerous angular-position sensor conﬁgurations are discussed in
Chapter 6. For the following discussion of VVP, it is assumed that such a sensor is part of the
system. Figure 7.10a depicts a physical conﬁguration of a representative camshaft phasing
control system.
Control of a variable valve phasing (VVP) mechanism has a number of objectives and is
subject to certain constraints based upon automotive engine-operating characteristics. Except
for steady highway cruise, an automotive engine load and RPM vary over a relatively large
range. Consequently, the VVP control must have the capability to follow relatively rapid
changes in command. The response to step changes in command should have relatively low
overshoot (e.g., <10%) and should reach its command position without a steady-state offset.
The control, of course, must be stable, and should be robust with respect to parameter
changes. The example VVP system presented here is based upon the actuation mechanism
described in Chapter 6 which uses vanes attached to the camshaft that move within recesses in
the camshaft drive gear. Recall that movement of the vanes relative to this gear results in the
variation in camshaft phasing. Recall also that movement of the vanes within the gear recesses
is in response to differential pressure on opposite sides of each vane, resulting from a spool
valve actuator, which supplies engine oil under pressure to A or R chambers as shown in
Figure 7.10a. The dynamic response of the VVP control system should be robust with respect
oil under
pressure
actuator
(spool valve)
engine
control
VVP
mechanism
A
R
u
φc
φc
φd
(a)
(b)
camshaft
angular
position
sensor
Hp(s)
plant
Hs(s)
sensor
control
Hc(z)
ZOH
uk
S
Є
Єk
T
+ _
u–
Figure 7.10:
Physical conﬁguration and block diagram of VVP system.
338
Chapter 7

to oil viscosity, which changes with changes in engine temperature; that is, the closed-loop
gain for the control system should have large gain and phase margins (see Chapter 1).
The VVP control is one function of the digital control system. When operating in VVP mode
the block diagram of the VVP is shown in Figure 7.10b. As explained in Chapter 2, a discrete
time control system that regulates a continuous time plant requires a sample and A/D
converter as well as a zero order hold (ZOH), both of which are incorporated in the block
diagram of Figure 7.10b. Sensor measurements for such a system are assumed to be ideal such
that the sensor transfer function is taken to be
HsðsÞy1
In Chapter 6, it was shown that the plant transfer function for this VVP conﬁguration is given
by
HpðsÞ ¼
Ka
sðs þ soÞ
(41)
For the present example, the following parameters are chosen:
Ka ¼ 2600
so ¼ 17
A PID control law is selected to provide sufﬁcient ﬂexibility to meet design objectives. The
continuous time PID control law is given by
u ¼ Kp˛ þ KD
d˛
dt þ KI
Z
˛dt
(42)
Using the root locus techniques of Chapter 1, the following gain parameters are given which
satisfy the overshoot and response time criteria:
Kp ¼ 0:080
KD=Kp ¼ 0:020
KI=Kp ¼ 0:100
One of the requirements for the VVP control system is robust stability; in Chapter 1, it was
shown that robustness is expressed meaningfully by gain and phase margins as determined by
the bode plot for the product Hc(s)Hp(s). Figure 7.11 is the Bode plot for this system.
The gain crossover frequency is at 10 rad/s and the phase margin there is about 109 degrees.
The phase crossover frequency is at about .02 rad/sec where the gain margin is more than
100 dB. This system has very robust stability.
Digital Powertrain Control Systems
339

The discrete time model for the control system is given by
uk ¼ Kp˛k þ KD
T ð˛k  ˛k1Þ þ KIukI
(43)
where ˛k ¼ ˛ðtkÞ, tk ¼ kT
k ¼ 1; 2.; and T is the sample period.
In the section on idle speed control, it was shown that the z-transform of ukI using trapezoidal
integration rule is given by
ukIðzÞ ¼ KIZ ½
R
˛dt
¼ KITðz þ 1Þ
2ðz  1Þ
200
Bode Diagram
Frequency (rad/sec)
Phase (deg)
Magnitude (dB)
150
100
50
0
–50
–90
–135
–180
10–3
10–2
10–1
100
101
102
103
Figure 7.11:
Bode plot of HF(s) for V VP system.
340
Chapter 7

Combining all three terms in the control variable uk of Eqn (37), the control system transfer
function Hc(z) is given by
HcðzÞ ¼ uðzÞ
˛ðzÞ
HcðzÞ ¼ Kp þ KDðz  1Þ
Tz
þ KIT
2
ðz þ 1Þ
ðz  1Þ
¼

Kp þ KD
T þ KIT
2

z2 

Kp þ 2KD
T
 KIT
2

z þ KD
T

zðz  1Þ
(44)
The plant and ZOH z-transform operational transfer function G(z) is found using the method
given in Chapter 2:
GðzÞ ¼ ð1  z1ÞZ
HpðsÞ
s

The z-transform in the above equation can be found by expanding Hp(s)/s in a partial fraction.
The function HpðsÞ=s is given by
HpðsÞ
s
¼
Ka
s2ðs þ soÞ
(45)
This function has a double pole at s ¼ 0. Using the parameters for the plant given above, the
partial fraction expansion is given by
HpðsÞ
s
¼ 8:9965
s þ 17  8:9965
s
þ 152:94
s2
(46)
Using the tables of z-transforms from Chapter 2 and assuming a sample period T ¼ 0.01 sec,
the operational transfer function G(z) is given by
GðzÞ ¼ ð1  z1Þ
"
8:9965z
z  z1
 8:9965z
z  1 þ 152:94zT
ðz  1Þ2
#
(47)
where
z1 ¼ es0T
¼ 0:6538:
The poles of G(z) are all on or in the unit circle which assures a stable system with a combined
transfer function:
GðzÞ ¼
0:7087z þ 0:6152
z2  1:6538z þ 0:6538
(48)
Digital Powertrain Control Systems
341

Using the gain parameters Kp, KD, and KI given above, the forward transfer function HF (from
˛k to the plant output fcðkÞ) is given by
HFðzÞ ¼ fcðzÞ
˛ðzÞ
HFðzÞ ¼ HcðzÞGðzÞ
¼ 0:1021z3  0:0587z2  0:0825z þ 0:0394
z4  2:6538z3 þ 2:3075z2  0:6538z
(49)
The closed-loop z-transfer function Hcl(z) is given by
HclðzÞ ¼ fcðzÞ
fdðzÞ
(50)
¼
HFðzÞ
1 þ HFðzÞ
¼
0:1021z3  0:0587z2  0:0825z þ 0:0394
z4  2:5517z3 þ 2:2489z2  0:7363z þ 0:0394
(51)
The poles of the closed-loop transfer function are given by
z1 ¼ 0:9975
z2 ¼ 0:7442 þ 0:2166i
z3 ¼ 0:7442  0:2166i
z4 ¼ 0:0657
All poles are within the unit circle for which system stability is assured.
The dynamic response of the VVP system is illustrated by ﬁnding the output sequence fcðkÞ
for 10 step command input which is given by
fd ¼ 0
t < 0
¼ 10
t  0
The z-transform of fd is given by
FdðzÞ ¼ 10z
z  1
342
Chapter 7

The camshaft phase (i.e., system output) is given by
FcðzÞ ¼ HCLðzÞFdðzÞ
The output sequence fcðkÞ at time tk is found using the method of ﬁnding the inverse
z-transform explained in Chapter 2. Recall that this method involves ﬁnding the partial
fraction expansion of FcðzÞ and writing each term as a power series in zk. The output
camshaft phase fcðkÞ at time tk is the sum of all coefﬁcient of zk in the separate power series
terms in the partial fraction expansion.
Figure 7.12 is a plot of this sequence vs. time tk: The transient response error has essentially
decayed to zero in less than 0.5 sec and the overshoot is 6.5%. Thus, this digital variable
camshaft phase control system meets the original objectives.
Electronic Ignition Control
As explained in Chapter 5, an engine must be provided with fuel and air in correct proportions
and the means to ignite this mixture in the form of an electric spark. Before the development
of contemporary electronic ignition, the traditional ignition system included spark plugs,
a distributor, and a high-voltage ignition coil. The distributor (which was a form of rotary
Figure 7.12:
VVP response to 10-degree step command.
Digital Powertrain Control Systems
343

switch) would sequentially connect the coil output high voltage to the correct spark plug. In
addition, it would cause the coil to generate the spark by interrupting the primary current (via
ignition points) in the coil circuit, thereby generating the required spark. The time of
occurrence of this spark (i.e., the ignition timing) in relation of the piston to TDC which
inﬂuences the torque generated was determined mechanically by distributor phasing relative
to the engine cycle.
The distributor and single coil have been replaced by multiple coils and an electronic control
system. Each coil supplies the spark to either one or two cylinders. In such a system, the
controller selects the appropriate coil and delivers a trigger pulse to the ignition control
circuitry at the correct time for each cylinder. (Note: In some cases, the coil is on the spark
plug as an integral unit.)
Figure 7.13 illustrates such a system for an example 4-cylinder engine.
Figure 7.13:
Example integrator circuit diagram.
344
Chapter 7

In this example, a pair of coils provides the spark for ﬁring two cylinders for each coil.
Cylinder pairs are selected such that one cylinder is on its compression stroke while the other
is on exhaust. The cylinder on compression is the cylinder to be ﬁred (at a time somewhat
before it reaches TDC). The other cylinder is on exhaust. The coil ﬁres the spark plugs for
these two cylinders simultaneously. For the former cylinder, the mixture is ignited and
combustion begins for the power stroke that follows. For the other cylinder (on exhaust
stroke), the combustion has already taken place and the spark has no effect.
Although the mixture for contemporary vehicle engines is constrained by emissions
regulations, the spark timing can be varied in order to achieve optimum performance within
the exhaust emission constraint. For example, the ignition timing can be chosen to produce
the best possible engine torque for any given operating condition. This optimum ignition
timing is known for any given engine conﬁguration from empirical studies of engine
performance as measured on an engine dynamometer. As explained in Chapter 5, this
optimum ignition timing is known as “spark advance for mean best torque” which is
abbreviated MBT.
Ignition timing is normally represented quantitatively by the angular position of the
crankshaft relative to TDC for each cylinder during its compression stroke. Spark occurs
before TDC because of the time required for combustion to be completed such that power
during the power stroke is optimized. Spark timing in degrees of crankshaft rotation is termed
“spark advance” (SA).
In the example conﬁguration of Figure 7.13, the spark advance value is computed in the main
engine control (i.e., the same controller that regulates fuel). This system receives data from
the various sensors (as described above with respect to fuel control) and determines the
correct spark advance for the instantaneous operating condition.
The variables that inﬂuence the optimum spark timing at any operating condition include
RPM, manifold pressure (or mass airﬂow), barometric pressure, and coolant temperature. The
correct ignition timing for each value of these variables is stored in an ROM lookup table. The
engine control system obtains readings from the various sensors and generates an address to
the lookup table (ROM). After reading the data from the lookup tables, the control system
computes the correct spark advance (possibly including interpolation). An output signal is
generated at the appropriate time to activate the spark.
In the conﬁguration depicted in Figure 7.13, the electronic ignition is implemented in a stand-
alone ignition module. This solid-state module receives the correct spark advance data and
generates electrical signals that operate the coil driver circuitry. These signals are produced in
response to timing inputs coming from crankshaft and camshaft signals (POS/RPM).
The coil driver circuits generate the primary current in windings P1 and P2 of the coil packs
depicted in Figure 7.13. These primary currents build up during the so-called dwell period
Digital Powertrain Control Systems
345

before the spark is to occur. The process of spark generating for ignition purposes was
explained in Chapter 6. There it was explained that the spark is produced by a short-duration
very high voltage that is generated in the ignition coil. In the example depicted in Figure 7.13,
a pair of coil packs, each ﬁring two spark plugs, is shown. Such a conﬁguration would be
appropriate for a 4-cylinder engine. Normally, there would be one coil pack for each pair of
cylinders or possibly for each cylinder.
In a typical electronic ignition control system, the total spark advance, SA (in degrees before
TDC), is made up of several components that are added together:
SA ¼ SAS þ SAP þ SAT
(52)
The ﬁrst component, SAS, is the basic spark advance, which is a tabulated function of RPM
and MAP or MAF. The control system reads RPM and MAP, or MAF and calculates the
address in ROM of the SAS that corresponds to these values. Figure 7.14 depicts
a representative variation in SAS vs. RPM.
In the example, the advance of RPM from idle to about 1200 RPM is relatively slow. Then,
from about 1200 to about 2300 RPM the slope of SAs with respect to RPM is relatively steep.
Beyond 2300 RPM, the increase in SAs with respect to RPM is again relatively small. Each
engine conﬁguration has its own spark advance characteristic, which is normally
a compromise between a number of conﬂicting factors (the details of which are beyond the
scope of this book). The SAs tabulated values that are placed in ROM are normally determined
via engine mapping during development of an engine control system.
1
2
3
4
5
6
0
0
5
10
15
20
25
30
SAs Degrees
RPM (THOUSANDS)
Figure 7.14:
Representative SA curve versus RPM.
346
Chapter 7

The second component, SAP, is the contribution to spark advance due to mass airﬂow or
manifold pressure. This value is obtained from ROM lookup tables with MAF or MAP as the
independent variable. In general, the SAP is reduced as intake manifold pressure increases,
owing to an increase in combustion rate with pressure.
The ﬁnal component, SAT, is the contribution to spark advance due to temperature.
Temperature effects on spark advance are relatively complex, including such effects as cold
cranking, cold start, warm-up, and fully warmed-up conditions, the details of which are
beyond the scope of this book.
Closed-Loop Ignition Timing
The ignition system described in the foregoing is an open-loop system. The major
disadvantage of open-loop control is that it cannot automatically compensate for mechanical
changes in the system. Closed-loop control of ignition timing is desirable from the standpoint
of improving engine performance and maintaining that performance in spite of system
changes.
One scheme for closed-loop ignition timing is based on the improvement in performance that
is achieved by advancing the ignition timing relative to TDC. For a given RPM and manifold
pressure, the variation in torque with spark advance is as depicted in Figure 7.15.
One can see that advancing the spark relative to TDC increases the torque until a point is
reached at which best torque is produced. As introduced above and explained qualitatively in
Chapter 5, this spark advance is known as the SA for mean best torque, or MBT.
0
(TDC)
MBT
SA DEGREES BEFORE TDC
TORQUE
SA
►
Figure 7.15:
Engine brake torque vs. SA.
Digital Powertrain Control Systems
347

When the spark is advanced too far, an abnormal combustion phenomenon occurs that is
known as knocking. Although the details of what causes knocking are beyond the scope of this
book, it is generally a result of a portion of the airefuel mixture abruptly igniting
(autoigniting), as opposed to being normally ignited by the advancing ﬂame front that occurs
in normal combustion following spark ignition. Roughly speaking, the amplitude of knock is
proportional to the fraction of the total air and fuel mixture that autoignites. It is characterized
by an abnormally rapid rise in cylinder pressure during combustion, followed by very rapid
oscillations in cylinder pressure. The frequency of these oscillations is speciﬁc to a given
engine conﬁguration and is typically in the range of a few kilohertz. Figure 7.16 is a graph of
a representative cylinder pressure versus time under knocking conditions. A relatively low
level of knock is arguably beneﬁcial to performance, although excessive knock is
unquestionably damaging to the engine and must be avoided.
One control strategy for spark advance under closed-loop control is to advance the spark
timing until the knock level becomes unacceptable. At this point, the control system reduces
the spark advance (retarded spark) until acceptable levels of knock are achieved. Of course,
a spark advance control scheme based on limiting the levels of knocking requires a knock
sensor such as that explained in Chapter 6. This sensor responds to the acoustical energy in
the spectrum of the rapid cylinder pressure oscillations, as shown in Figure 7.16.
Figure 7.17 is a diagram of an exemplary instrumentation system for measuring knock
intensity. Output voltage VE of the knock sensor is proportional to the acoustical energy in the
engine block at the sensor mounting point. This voltage is sent to a narrow bandpass ﬁlter that
is tuned to the knock frequency (for the particular engine conﬁguration). The ﬁlter output
voltage VF is proportional to the amplitude of the knock oscillations, and is thus a “knock
signal.” The envelope voltage of these oscillations, Vd, is obtained with a detector circuit
Figure 7.16:
Cylinder pressure under knock conditions.
348
Chapter 7

which can, for example, be implemented with a rectiﬁer-type circuit which includes a diode
and a capacitor (see Chapter 3).
Following the detector in the circuit of Figure 7.17 of the example knock detection system is
an electronic gate that normally blocks Vd for much of the engine cycle but passes it during
the portion of the engine cycle for which the knock amplitude is largest (i.e., shortly after
TDC). The gate is, in essence, an electronic switch that is normally open, but is closed for
a short interval (from 0 to T) following TDC. It is during this interval that the knock signal is
 KNOCK
SENSOR
VE
VF
Vd
DETECTOR
 NARROW
BANDPASS
   FILTER
  TDC
TIMING
 PULSE
ELECTRONIC
       GATE
INTEGRATOR
VK
VF
Vd
VL
TDC
TIME
TIME
TDC
(c)
(a)
(b)
Figure 7.17:
Instrumentation for measuring knock intensity.
Digital Powertrain Control Systems
349

largest in relationship to engine noise. The probability of successfully detecting the knock
signal is greatest during this interval. Similarly, the possibility of mistaking normal engine
acoustic noise for true knock signal is smallest during this interval.
The ﬁnal stage in the exemplary knock-measuring instrumentation is integration with
respect to time. Integration can be accomplished numerically in the engine control or as
a part of the knock sensor instrumentation using an operational ampliﬁer circuit conﬁgured
to perform analog integration. For example, the circuit of Figure 7.18a could be used to
integrate the gate output. In our example system, the electronic gate is implemented via
a pair of switches S1 and S2. Switch S1 is normally open and S2 closed but S1 is closed and
S2 opened at t ¼ 0 corresponding to the beginning of the period where knock can occur. The
end of this period is t ¼ T. This gate operation is repetitive and occurs following TDC for
the power stroke of the associated cylinder. The output voltage VK at the end of the gate
interval T is given by
Figure 7.18:
Analog integrator for knock detection system.
350
Chapter 7

VK ¼ ð1=RCÞ
ZT
0
VdðtÞdt
(53)
This voltage increases sharply in magnitude but is negative for Vd as depicted in Figure 7.18b
because the input is connected to the op amp inverting input. Figure 7.18b is a plot of the
absolute magnitude of Vk (i.e., jVkj). This voltage reaches a maximum amplitude at the end of
the gate interval, as shown in Figure 7.18b, provided knock occurs. However, if there is no
knock, VK remains near zero.
The level of knock intensity is indicated by voltage jVK(T)j at the end of the gate interval. The
spark control system compares this voltage with a threshold voltage to determine whether
knock has or has not occurred.
This envelope-detected voltage is sent to the controller, where it is compared with a level
corresponding to the knock intensity threshold. Whenever the knock level is less than the
threshold, the spark is advanced. Whenever it exceeds the threshold, the spark is retarded. The
comparator function is normally implemented in the digital control system by numerically
comparing the integrated knock intensity signal with a threshold TK (under program control;
see Figure 7.19).
In such an implementation, the controller generates a binary-valued variable (denoted K in
Figure 7.19) having the following algorithm:
K ¼ 0
jVKðTÞj< TK
¼ 1
jVKðTÞj> TK
(54)
Knock detection with the above algorithm has two types of error: (1) missed detection in
which knock has occurred but the system output is K ¼ 0 and (2) false alarm in which there is
normal combustion but the system output is K ¼ 1. The quantitative error analysis for the
above knock detection method generally is covered in the ﬁeld of statistical decision theory.
The theory of this topic is outside the scope of this book. However, for those readers having
a background in statistical analysis, we present the following brief models and analysis of the
probability of error in the above knock detection system.
Figure 7.19:
Comparator for knock detector.
Digital Powertrain Control Systems
351

Essentially, the voltage of any point in the exemplary knock detection system is a random
process. In this exemplary knock detection system, the detection of knock is based upon the
voltage VK(T) and is, in effect, a form of statistical hypothesis testing. This method can
perhaps best be explained from the histogram of Figure 7.20 for voltage VK(T) for a large
sample of engine cycles under the two hypotheses:
H0: normal combustion and
H1: knocking conditions.
For notational convenience, we let x ¼ jVK(T)j in Figure 7.20. In this ﬁgure, the number of
occurrences of x at a particular value for hypothesis H0 is denoted nH0ðxÞ and for hypothesis
H1 is denoted nH1ðxÞ. For a sufﬁciently large sample space, these histograms approach the
continuous probability density functions for the two hypotheses that are denoted pH0ðxÞ and
pH1ðxÞ, respectively.
The detection threshold TK is depicted in Figure 7.20. The total probability of error Pe for our
example knock detection method is given by
Pe ¼
ZN
TK
pH0ðxÞdx þ
ZTK
O
pH1ðxÞdx
(55)
where the ﬁrst term corresponds to false alarm errors and the second to missed detection
errors. For any such knock detection method, an optimum threshold that minimizes the total
probability of error can be determined empirically.
500
400
300
200
100
0
0
20
nH0(x)
nH1(x)
40
TK
60
χ
Figure 7.20:
Histogram for hypotheses H0 and H1.
352
Chapter 7

Although this scheme for knock detection has shown a constant threshold, there are some
production applications that have a variable threshold. The threshold in such cases increases
with RPM because the competing acoustical noises in the engine increase with RPM.
Spark Advance Correction Scheme
Although the details of spark advance control vary from manufacturer to manufacturer, there
are generally two classes of correction that are used: fast correction and slow correction. In
the fast correction scheme, the spark advance is decreased for the next engine cycle by a ﬁxed
amount (e.g., 5) whenever knock is detected. Then the spark advance is incremented in one-
degree increments every 5e20 crankshaft revolutions.
The fast correction ensures that minimum time is spent under heavy knocking conditions.
Further, this scheme compensates for hysteresis (i.e., for one degree of spark advance to cause
knocking, more than one degree must be removed to eliminate knocking). The fast correction
scheme is depicted qualitatively by the waveform depicted in Figure 7.21.
In the slow correction scheme (Figure 7.22), spark advance is decreased by one (or more)
degree each time knock is detected, until no knocking is detected. The spark advance
proceeds in one-degree increments after many engine cycles.
The slow correction scheme is more of an adaptive closed-loop control than is the fast
correction scheme. It primarily is employed to compensate for relatively slow changes in
engine condition or fuel quality (i.e., octane rating).
Figure 7.21:
Fast correction of SA.
Digital Powertrain Control Systems
353

Integrated Engine Control System
Each control subsystem for fuel control, spark control, and EGR has been discussed
separately. However, in a contemporary vehicle an integrated electronic engine control
system employs an open architecture and can include these subsystems and provide
additional functions. (Usually, the ﬂexibility of the digital control system allows such
expansion quite easily because the computer program can be changed to accomplish the
expanded functions.) Several of these additional functions are discussed in the following.
Secondary Air Management
Secondary air management is used to improve the performance of the catalytic converter by
providing extra (oxygen-rich) air either to the converter itself or to the exhaust manifold. The
catalyst temperature must be above about 200 C to efﬁciently oxidize HC and CO and reduce
NOx. During engine warm-up when the catalytic converter could be cold, HC and CO are
oxidized in the exhaust manifold by routing secondary air to the manifold. This creates extra
heat to speed warm-up of the converter and EGO sensor, enabling the fuel controller to go to
the closed-loop mode relatively quickly.
The converter can be damaged if too much heat is applied to it. This can occur if large
amounts of HC and CO are oxidized in the manifold during periods of heavy loads, which call
for fuel enrichment, or during severe deceleration. In such cases, the secondary air is directed
to the air cleaner, where it has no effect on exhaust temperatures.
After warm-up, the main use of secondary air is to provide an oxygen-rich atmosphere in the
second chamber of the three-way catalyst, dual-chamber converter system. In a dual-chamber
converter, the ﬁrst chamber contains rhodium, palladium, and platinum to reduce NOx and to
Figure 7.22:
Slow correction of SA.
354
Chapter 7

oxidize HC and CO. The second chamber contains only platinum and palladium. The extra
oxygen from the secondary air improves the latter converter’s ability to oxidize HC and CO in
the second converter chamber.
The computer program for the control mode selection logic can be modiﬁed to include the
conditions for controlling secondary air. In one conﬁguration, the engine controller regulates
the secondary air by using two solenoid valves similar to the EGR valve. One valve switches
airﬂow to the air cleaner or to the exhaust system. The other valve switches airﬂow to the
exhaust manifold or to the converter. The air routing is based on engine coolant temperature
and air/fuel ratio. The control system diagram for secondary air is shown in Figure 7.23.
Evaporative Emissions Canister Purge
In pre-emission controlled vehicles, the fuel stored in the fuel system tended to evaporate and
release hydrocarbons (HCs) into the atmosphere. In contemporary vehicles, to reduce these
HC emissions, the fuel tank is sealed and evaporative gases are collected by a charcoal ﬁlter in
a canister. The collected fuel is released into the intake through a solenoid valve controlled by
the computer. This normally is done during closed-loop operation to reduce fuel calculation
complications in the open-loop mode.
CONTROLLER
FUEL
METERING
DUTY
CYCLE
SOLENOID
SOLENOID
SECONDARY
AIR CONTROL
SECONDARY
AIR CONTROL
SECONDARY
AIR
SECONDARY
AIR
  A/D
CONV.
VALVE
VALVE
COOLANT
TEMPERATURE
ENGINE
I
N
T
A
K
E
     FUEL
METERING
F
I
L
T
E
R
AIR
FUEL
TWC
EXHAUST
MANIFOLD
Figure 7.23:
Secondary air system.
Digital Powertrain Control Systems
355

Automatic System Adjustment
Another important feature of microcomputer engine control systems is their ability to be
programmed to adapt to parameter changes. Many control systems use this feature to enable
the computer to modify lookup table values for computing open-loop air/fuel ratios. While
the computer is in the closed-loop mode, the computer checks its open-loop calculated air/
fuel ratios and compares them with the closed-loop average limit cycle values. If they match
closely, the open-loop lookup tables are unchanged. If the difference is large, the system
controller corrects the lookup tables so that the open-loop values more closely match the
closed-loop values. This updated open-loop lookup table is stored in separate memory
(RAM), which is always powered directly by a car battery or a separate “keep alive” battery
so that the new values are not lost while the ignition key is turned off. The next time the
engine is started, the new lookup table values will be used in the open-loop mode and will
provide more accurate control of the air/fuel ratio than the unmodiﬁed values. This feature is
very important because it allows the system controller to adjust to long-term changes in
engine and fuel system conditions. This feature can be applied in individual subsystem
control systems or in the fully integrated control system. If not available initially, it may be
added to the system by modifying its control program.
System Diagnosis
Another important feature of microcomputer engine control systems is their ability to
diagnose failures in their control systems or components and alert the operator. Sensor and
actuator failures or misadjustments can be detected readily by the computer under certain
operating conditions. For instance, the computer will detect a malfunctioning MAF sensor if
the sensor’s output goes above or below certain speciﬁed limits, or fails to change for long
periods of time. A prime example is the automatic adjustment system just discussed. If the
open-loop calculations consistently come up different from those indicated in closed-loop
mode, the engine control computer may determine that one of the many sensors used in the
open-loop calculations has experienced a calibration change or has failed completely.
If the computer detects the loss of a primary control sensor or actuator, it may switch to in
a different mode until the problem is repaired. The operator is notiﬁed of a failure by an
indicator on the instrument panel (e.g., check engine indicator). Because of the ﬂexibility of
the microcomputer engine control system, additional diagnostic programs might be added to
accommodate different engine models that contain more or fewer sensors. Keeping the
system totally integrated gives the microcomputer controller access to more sensor inputs so
they can be checked. Chapter 10 discusses system diagnosis in detail. Often, there is sufﬁcient
redundancy to permit suboptimal engine operation when a component has failed such that the
vehicle can be driven to a repair facility in an operating mode that has been termed a “limp
home mode.”
356
Chapter 7

Summary of Control Modes
A summary of the control modes for a digital engine control system is presented below.
Engine Crank (Start)
The following list is a summary of the engine operations in the engine crank (starting) mode,
wherein the primary control concern is rapid and reliable engine start:
1.
engine RPM at cranking speed,
2.
engine coolant at relatively low temperature (cold start),
3.
air/fuel ratio low (cold start),
4.
spark retarded,
5.
EGR off,
6.
secondary air to exhaust manifold,
7.
fuel economy not closely controlled, and
8.
emissions not as closely controlled as during fully warmed engine.
Engine Warm-Up
While the engine is warming up, the engine temperature is rising to its normal operating
value. Here, the primary control concern is rapid and smooth engine warm-up. A summary of
the engine operations during this period is as follows:
1.
engine RPM above cranking speed at command of driver,
2.
engine coolant temperature rises to minimum threshold,
3.
air/fuel ratio,
4.
spark timing set by controller,
5.
EGR off,
6.
heat supplied to HEGO,
7.
secondary air to exhaust manifold,
8.
fuel economy not as closely controlled as fully warmed engine, and
9.
emissions not as closely controlled as fully warmed engine.
Open-Loop Control
The following list summarizes the engine operations when the engine is being controlled in an
open-loop mode. This mode is used before the EGO sensor has reached the correct
temperature for closed-loop operation. Fuel economy and emissions are closely controlled.
1.
engine RPM at command of driver (or idle speed control),
2.
engine temperature above warm-up threshold,
Digital Powertrain Control Systems
357

3.
air/fuel ratio controlled by an open-loop system to 14.7,
4.
EGO sensor temperature less than minimum threshold,
5.
heat supplied to HEGO,
6.
spark timing set by controller,
7.
EGR controlled,
8.
secondary air to catalytic converter,
9.
fuel economy controlled,
10.
emissions controlled.
Closed-Loop Control
For the closest control of emissions and fuel economy under various driving conditions, the
electronic engine control system is in a closed loop. Fuel economy and emissions are
controlled very tightly. The following is a summary of the engine operations during this
period:
1.
engine RPM at command of driver (or idle speed control),
2.
engine temperature in normal range (above warm-up threshold),
3.
average air/fuel ratio controlled to 14.7, 0.05,
4.
EGO sensor’s temperature above minimum threshold detected by a sensor output voltage
indicating a rich mixture of air and fuel for a minimum amount of time,
5.
system returns to open loop if EGO sensor cools below minimum threshold or fails to
indicate rich mixture for given length of time,
6.
EGR controlled,
7.
secondary air to catalytic converter,
8.
fuel economy tightly controlled, and
9.
emissions tightly controlled.
Hard Acceleration
When the engine must be accelerated quickly or if the engine is under heavy load, it is in
a special mode. Now, the engine controller is primarily concerned with providing maximum
performance. Here is a summary of the operations under these conditions:
1.
driver asking for sharp increase in RPM or in engine power (via rapid throttle angle
increase), demanding maximum torque,
2.
engine temperature in normal range,
3.
air/fuel ratio rich mixture,
4.
EGO not in loop (very brieﬂy),
5.
EGR off,
6.
secondary air to intake,
358
Chapter 7

7.
relatively poor fuel economy (relative to normal closed loop), and
8.
relatively poor emissions control (relative to normal closed loop).
Deceleration and Idle
Slowing down, stopping, and idling are combined in another special mode. The engine
controller is primarily concerned with reducing excess emissions during deceleration, and
keeping idle fuel consumption at a minimum. This engine operation is summarized in the
following list:
1.
RPM decreasing rapidly due to driver command or else held constant at idle,
2.
engine temperature in normal range,
3.
air/fuel ratio lean mixture,
4.
special mode in deceleration to reduce emissions,
5.
special mode in idle to keep RPM constant at idle as load varies due to air conditioner,
automatic transmission engagement, etc.,
6.
EGR on,
7.
secondary air to intake,
8.
good fuel economy during deceleration, and
9.
possibly relatively poor fuel economy during idle, but fuel consumption kept to minimum
possible (except for hybrid electric vehicle (HEV)).
Automatic Transmission Control
The vast majority of cars and light trucks sold in the United States are equipped with
automatic transmissions. The majority of these transmissions are controlled electronically.
The conﬁguration of an automatic transmission consists of a torque converter and a sequence
of planetary gear sets.
The transmission (whether automatic or manual) is a gear system that adjusts the ratio of
engine speed to wheel speed. Essentially, the transmission enables the engine to operate
within its optimal performance range regardless of the vehicle load or speed. It provides
a gear ratio between the engine speed and vehicle speed such that the engine provides
adequate power to drive the vehicle at any speed. Any gear system connecting a pair of shafts
along which torque/power is transmitted is the mechanical equivalent of an electrical
transformer. Just as a transformer can maximize the power transmitted from a source to
a load, a gear system has the capability of maximizing the transfer of engine power to the load
at the drive wheels while maintaining engine speed (under load) at acceptable values.
To accomplish optimal power transfer to the load with a manual transmission, the driver
selects the correct gear ratio from a set of possible gear ratios (usually three to ﬁve for
Digital Powertrain Control Systems
359

passenger cars). An automatic transmission selects the gear ratio by means of an automatic
control system.
The conﬁguration for an automatic transmission consists of a ﬂuid-coupling mechanism,
known as a torque converter, and a system of planetary gear sets. The torque converter is
formed from a pair of structures of a semitoroidal shape (i.e., a donut-shaped object split
along the plane of symmetry). Figure 7.24 is a schematic sketch of a torque converter showing
the two semitoroids.
One of the toroids is driven by the engine by the input shaft and is called the pump. The
other is in close proximity and is called the turbine. Both the pump and the turbine have
vanes that are nearly in axial planes. In addition, a series of vanes are ﬁxed to the frame
and are called the reactor. The entire structure is mounted in a ﬂuid-tight chamber and is
ﬁlled with a hydraulic ﬂuid (i.e., transmission ﬂuid). As the pump is rotated by the
engine, the hydraulic ﬂuid circulates as depicted by the arrows in Figure 7.24. The ﬂuid
impinges on the turbine blades, imparting a torque to it. The torque converter provides
a ﬂuid coupling to transmit engine torque and power to the turbine from the engine. The
torque that is applied to the pump portion of the torque converter is the engine brake
torque (Tb). Denoting the torque applied to the output shaft by the turbine TT, this latter
torque is given by TT ¼ TRTb where TR is the torque multiplication factor of the torque
converter. However, the properties of the torque converter are such that when the vehicle
is stopped corresponding to a nonmoving turbine, the engine can continue to rotate (as is
does when the vehicle is stopped with the engine running). Normally, with the vehicle
F
L
U
I
D
 
F
L
O
W
TURBINE
REACTOR
AXIS
OF ROTATION
TT
ωt
Tp
ωp
PUMP
INPUT
SHAFT
OUTPUT
SHAFT
(TO PLANETARY GEAR SYSTEM)
Figure 7.24:
Torque converter conﬁguration.
360
Chapter 7

stopped and the torque converter output shaft not rotating, the engine is at idle and
producing minimal Tb. The turbine blades are in a stalled condition and TT is sufﬁciently
low that only a small torque applied to the wheels by the brakes is capable of stopping
the vehicle.
A detailed analytical model for a torque converter is given in a paper by Allen Kotwicki.* In
this paper, it is explained that a torque converter is a form of ﬂuid coupling device in which
a reactor is added which is rigidly connected to the transmission housing and normally does
not rotate. However, torque converter efﬁciency is improved whenever the torque reaction on
the ﬂuid is zero by allowing the reactor to rotate freely. The torque converter is ﬁlled with
transmission ﬂuid that is caused to circulate through the pumpeturbineereactor by rotation
of the pump by the engine crankshaft rotation. This ﬂuid ﬂows in an annular path as depicted
in Figure 7.24. The operating physical principle upon which a ﬂuid coupling or a torque
converter is based is that torque in any such system results from a time rate of change of
angular momentum. In the reference cited above it is shown that the torques of the pump Tp
and turbine Tt are given by
Tp ¼ AupQ þ BQ2
Tt ¼ AupQ  CutQ þ DQ2
(56)
where up ¼ the pump angular speed (rad/s),
ut ¼ the turbine angular speed (rad/s),
Q ¼ the ﬂuid volume ﬂow rate,
A ¼ r R2
px,
B ¼ r
Rpxtanapx
Apx
 Rrxtanarx
Arx

,
C ¼ r R2
tx, and
D ¼ r
Rpx
Apx
tanapx  Rrx
Atx
tanatx

where r is the transmission ﬂuid density.
In these equations a double subscript on a variable means: ﬁrst subscript p / pump,
r / reactor, t / turbine and the second subscript e / entrance, x / exit. The double-
subscripted parameters have the following meaning:
A is the converter cross-sectional area normal to annular ﬂow (p),
R is the radius from converter axis, and
a is the element blade angle relative to axis.
* Dynamic Models for Torque Converter Equipped Vehicles, Allen Kotwicki, SAE paper # 820393, 1982.
Digital Powertrain Control Systems
361

It is further shown that the volume ﬂow rate is given by
Q ¼  ðHut  GupÞ
2I
þ
h
Hut  Gup
2þ4I
	
Eu2
p þ Fu 2
t

i
2I
1
2
(57)
where E, F, G, H, and I are constants given in the cited reference. In this reference empirical
evaluation of coefﬁcients for a ﬁrst-order linear regression-based polynomial for Q of the
form is developed:
Qza1up þ but
where
utySup is assumed
where S is the speed ratio.
Using this approximation, it is shown in the reference that the torque ratio TR is given by
TR ¼ Tt
Tp
¼ ðA þ Da1Þup þ ðDb  CÞut
ðA þ Ba1Þup þ Bbut
(58)
where
a1 ¼
E
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
IðE þ FG2=H2Þ
p
þ G
2I
b ¼
FG
H
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
IðE þ FG2=H2Þ
p
 H
2I
This simpliﬁed model is shown in the reference to correlate well with experimental data and is
normally sufﬁcient for development of transmission controls.
The planetary gear system consists of a set of three types of gears connected together as
depicted in Figure 7.25a. The inner gear is known as the sun gear. There are three gears
meshed with the same gear at equal angles, which are known as planetary gears. These three
gears are tied together with a cage that supports their axles. The third gear, known as a ring
gear, is a section of a cylinder with the gear teeth on the inside. The ring gear meshes with the
three planetary gears.
362
Chapter 7

In operation, one or more of these gear systems are held ﬁxed to the transmission housing via
a set of hydraulically actuated clutches. The action of the planetary gear system is determined
by which set or sets of clutches are activated. For example, if the ring gear is held ﬁxed and
input power (torque) is applied to the sun gear, the planetary gears rotate in the same direction
as the sun gear but at an increased torque. We denote the input torque applied to the sun gear
and the angular speed of the shaft driving this gear system by Ti and ui, respectively. The
output torque and its speed are denoted To and uo, respectively. A model for this gear system
is given by
To ¼ gTi
uo ¼ ui=g
(59)
PLANETARY
GEARS
RING
GEAR
PLANETARY
GEAR
CAGE
SUN GEAR
E
Tp
TC
Ti
gear system
clutches
drive
wheels
g1
To
ωo
D
WL
TL
WL
TL
g2
g3
(a)
(b)
ωi
Figure 7.25:
Schematic automatic transmission conﬁguration.
Digital Powertrain Control Systems
363

where g is the gear ratio
¼ Np=Ns
Ns is the number of teeth on the sun gear and Np is the number of teeth on a planetary gear.
If the planetary gear cage is ﬁxed, then the sun gear drives the ring gear in the opposite
direction as is done when the transmission is in reverse. If all three sets of gears are held ﬁxed
to each other rather than the transmission housing, then direct drive (gear ratio ¼ 1) is
achieved.
A typical automatic transmission has a number of planetary gear systems (denoted g1, g2, g3
in Figure 7.25b), each with its own set of hydraulically actuated clutches as depicted
schematically in Figure 7.25b. In an electronically controlled automatic transmission, the
clutches are electrically or electrohydraulically actuated via solenoid type actuators such as
are described in Chapter 6.
Most automatic transmissions have three forward gear ratios, although a few have two and
some have four or more and all have reverse. A properly used manual transmission normally
has efﬁciency advantages over an automatic transmission (because of power losses in the
torque converter), but the automatic transmission is the most commonly used transmission for
passenger automobiles in the United States. In the past, automatic transmissions have been
controlled by a hydraulic and pneumatic system, but it is common in contemporary vehicles
to use electronic controls as part of an integrated powertrain control system. The control
system must determine the correct gear ratio by sensing the driver-selected command,
accelerator pedal position, engine load, and vehicle motion. Once again, as in the case of
electronic engine control, the electronic transmission control can optimize transmission
control. However, since the engine and transmission function together as a power-producing
unit, it is sensible to control both components in a single electronic controller. The proper gear
ratio is actually computed in the electronic transmission control portion of the powertrain
control system.
Figure 7.25b depicts schematically the powertrain denoting the engine E, the torque converter
(TC), the gear system, the differential D (having gear ratio gD), and the axles with the drive
wheels (which could be front or rear). The conﬁguration and operating principles of the
differential are explained later in this chapter. For simplicity, it is convenient to assume that
both right and left drive wheels (or all four drive wheels for four-wheel drive) are identical
and present a combined load torque TL to the drive axle. In this case, the transmission output
torque To is given by
To ¼ TL=gD
364
Chapter 7

The gear system consists of a set of planetary gear units each having a gear ratio gn
(n ¼ 1,2.N). The appropriate gear is selected by the control system, which operates the
correct set of clutches via an electrohydraulic actuator (e.g. solenoid-operated valve
supplying transmission ﬂuid under pressure to a set of sprag clutches). For gear systems
connected in series, the total gear ratio g from the torque converter output to the load is
given by
gT ¼ gD P
n¼1
N
gn
(60)
Otherwise, for a parallel connected system of gears as shown in Figure 7.25b, the gear ratio is
given by
gT ¼ gDgn
(61)
Although there are many possible powertrain control modes depending upon vehicle
operating conditions and driver command, an illustrative example mode is maximizing the
power delivered to the load (drive wheels) for a given engine brake power (Pb ¼ Tbue). For
example, under certain powertrain operating conditions, the gear ratio, which maximizes this
transfer of engine power to load power (PL ¼ TLuL) g,* is given approximately by
g ¼
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
Tb=ue
TLuL
s
The controller selects the nearest available gear ratio from the set of possible choices.
Another control mode for the transmission is to maximize drive axle torque TL, thereby
maximizing vehicle acceleration whenever the driver command yields wide open throttle
(WOT). This mode calls for the maximum available gear ratio subject to the constraint that
engine RPM remains near the point for maximum brake torque.
The relevant clutches are activated by the pressure of transmission ﬂuid acting on piston-like
mechanisms. The pressure is switched on at the appropriate clutch via solenoid-activated
valves that are supplied with automatic transmission ﬂuid under pressure. The solenoids are
actuators that receive an electrical signal from the powertrain control system as explained in
Chapter 6.
During normal driving, the electronic transmission controller determines the desired gear
ratio from measurements of engine load and RPM as well as transmission output shaft RPM.
These RPM measurements are made using noncontacting angular speed sensors (usually
magnetic in nature) as explained in Chapter 6. Once this desired gear ratio is determined, the
set of clutches to be activated is uniquely determined, and control signals are sent to the
appropriate clutches.
Digital Powertrain Control Systems
365

Normally, the highest gear ratio (i.e., ratio of input shaft speed to output shaft speed) is
desired when the vehicle is at low speed such as in accelerating from a stop. As vehicle speed
increases from a stop, a switching level will be reached at which the next lowest gear ratio is
selected. This switching (gear-changing) threshold is an increasing function of load as
measured by the MAF or MAP sensor.
At times (particularly under steady vehicle speed conditions), the driver demands increasing
engine power (e.g., for heavy acceleration). In this case, the controller shifts to a higher gear
ratio, resulting in higher acceleration than would be possible in the previous gear setting. At
a steady-cruise condition, the transmission gear ratio is unity and the total gear ratio from
engine to drive wheels is gD (i.e., differential gear ratio). The functional relationship between
gear ratio and operating condition is often termed the “shift schedule,” which is programmed
into ROM.
Torque Converter Lock-Up Control
As explained above, automatic transmissions use a hydraulic or ﬂuid coupling to transmit
engine power to the wheels. There is some relatively small power loss in the TC such that the
ﬂuid coupling is less efﬁcient than the nonslip coupling of a pressure-plate manual clutch
used with a manual transmission. Thus, fuel economy is usually lower with an automatic
transmission than with a standard transmission. This problem has been partially remedied by
placing a clutch functionally similar to a standard pressure-plate clutch inside the torque
converter of the automatic transmission and engaging it during periods of steady cruise. This
enables the automatic transmission to provide fuel economy near that of a manual
transmission and still retain the automatic shifting convenience.
The torque converter locking clutch (TCC) is activated by a lock-up solenoid controlled by
the engine control system computer. The computer determines when a period of steady cruise
exists from throttle position and vehicle speed changes. It pulls in the locking clutch and
keeps it engaged until it senses conditions that call for disengagement. This condition is
known as “torque converter lock-up.”
Differential and Traction Control
The transmission output shaft is coupled to the drive axles via the differential. The differential
is a necessary component of the drivetrain because the left and right drive wheels turn at
different speeds whenever the car moves along a curve (e.g., turning a corner). Whenever
a car is executing a turn, the outside drive wheel rotates at a higher angular speed than the
inside wheel. The differential achieves this function permitting both wheels to propel the
vehicle. Figure 7.26 depicts the conﬁguration for a differential. Unfortunately, wherever there
is a large difference between the tire/road friction from left to right, the differential will tend
366
Chapter 7

to spin the low friction wheel. An extreme example of this occurs whenever one drive wheel is
on ice and the other is on dry road. In this case, the tire on the ice side will spin and the wheel
on the dry side will not. Typically, the vehicle will not move in such circumstances.
Certain cars are equipped with so-called traction control devices that can overcome this
disadvantage of the differential. Such cars have differentials that incorporate
electrohydraulic solenoid-activated clutches somewhat similar to those used in an
automatic transmission that can “lock” the differential, permitting power to be delivered
to both drive wheels. It is only desirable to activate these clutches in certain conditions
and to disable them during normal driving, permitting the differential to perform its
intended task.
Figure 7.26:
Differential conﬁguration.
Digital Powertrain Control Systems
367

A traction control system incorporates sensors for measuring wheel speed and a controller
that determines the wheel slip condition based on these relative speeds. Wherever a wheel
spin condition is detected, the controller sends electrical signals to the solenoids, thereby
activating the clutches to eliminate the wheel slip.
Hybrid Electric Vehicle Powertrain Control
The concept of a hybrid electric vehicle (HEV), in which propulsive power comes from an
internal combustion engine (ICE) and an electric motor (EM), has emission and fuel
advantages relative to a conventional vehicle powered only by an ICE. As explained in
Chapter 5, the hybrid vehicle combines the low (ideally zero) emissions of an electric vehicle
with the range and performance capabilities of IC-engine-powered cars. However,
optimization of emission performance and/or fuel economy is a complex control problem.
There are differential types of hybrid electric vehicles based upon the degree of hybridization.
A vehicle that can operate on either the ICE or the electric propulsion or a combination of
both is known as a full hybrid. In order to have any practical range for electric propulsion
only, the vehicle must have a suitable very high capacity battery pack. This battery pack is
capable of storing far more energy than a conventional storage battery found in ICE only
vehicles.
On the other hand, there are certain hybrids which are incapable of electric propulsion only.
These vehicles, which are commonly called “mild hybrids,” require the ICE for some of their
propulsion. In one conﬁguration, a mild hybrid has an ICE connected to a motor that serves
several functions including starting the ICE, adding a power boost to the ICE, and
regenerative braking to recover and store some energy during deceleration. In regenerative
braking, the electric motor acts as a generator that receives its mechanical drive power from
the vehicle momentum and delivering its output electrical power to the battery pack. The
discussion of induction motors in Chapter 6 explains this operation of a motor acting as
a generator.
There are numerous issues and considerations involved in hybrid vehicle powertrain control,
including the efﬁciencies of the IC engine and electric motor as a function of operating
condition; the size of the vehicle and the power capacity of the IC engine and electric motor; the
storage capacity and state of charge of the battery pack; accessory load characteristics of the
vehicle; and, ﬁnally, the driving characteristics of the driver. With respect to this latter issue, it
would be possible to optimize vehicle emissions and performance if the exact route, including
vehicle speed, acceleration, deceleration, road inclination, and wind characteristics, could be
programmed into the control memory before any trip were to begin. It is highly impractical to
do such preprogramming. However, by monitoring instantaneous vehicle operation, it is
possible to achieve good, though suboptimal, vehicle performance and emissions.
368
Chapter 7

Depending on operating conditions, the controller in a full hybrid can command pure electric
vehicle operation, pure IC engine operation, or a combination. Whenever the IC engine is
operating, the controller should attempt to keep it at its peak efﬁciency.
Certain special operating conditions should be noted. For example, the IC engine is stopped
wherever the vehicle is stopped. Clearly, such stoppage beneﬁts vehicle fuel economy and
improves air quality when the vehicle is driven in dense trafﬁc with long stoppages such as
those that occur while driving in large urban areas.
There are two major types of hybrid electric vehicles depending on the mechanism for
coupling the IC engine (ICE) and the electric motor (EM). Figure 7.27 is a schematic
representation of one hybrid vehicle conﬁguration known as a series hybrid vehicle (SHV).
In this SHV, the ICE drives a generator (G) and has no direct mechanical connection to the
drive axles. The vehicle is propelled by the electric motor (EM), which receives its input
electrical power from a high-voltage bus. This bus, in turn, receives its power either from the
engine-driven generator (for ICE propulsion) or from the battery pack (for EM propulsion), or
from a combination of the two. In this ﬁgure, mechanical power is denoted MP and electrical
power EP. The mechanical connection from the EM to the transaxle (T/A) provides
propulsive power to the drive wheels (DWs). The term transaxle refers to the entire drive
system from the EM to the drive wheels.
Figure 7.28 is a schematic of a hybrid vehicle type known as a parallel hybrid. The parallel
hybrid of Figure 7.28 can operate with ICE alone by engaging both solenoid-operated
clutches on either side of the EM but with no electrical power supplied to the EM. In this
case, the MP supplied by the ICE directly drives the transaxle T/A, and the EM rotor
spins essentially without any mechanical drag. This hybrid vehicle can also operate with
the EM supplying propulsive power by switching off the ICE, disengaging clutch C1,
engaging clutch C2, and providing electrical power to the EM from the high-voltage bus
Figure 7.27:
Series HEV schematic.
Digital Powertrain Control Systems
369

(HVB). Of course, if both ICE and EM are to produce propulsive power, then both
clutches are engaged. Not shown in Figure 7.28 is a separate controller for the motor.
Also not shown in this ﬁgure but discussed later in this section is the powertrain
controller that optimizes performance and emissions for the overall vehicle and engages/
disengages clutches as required.
The HEV of Figure 7.29 operates similarly to that of Figure 7.28 except that mechanical
power from ICE and EM are combined in a mechanism denoted coupler. For the system of
Figure 7.29 pure ICE propulsion involves engaging clutch C1, disengaging clutch C2, and
providing no electrical power to the EM. Alternatively, pure EM propulsion involves
disengaging clutch C1, switching off the ICE, engaging clutch C2, and providing electrical
power to the EM via the high-voltage bus (HVB). Simultaneous ICE and EM propulsion
involves running the ICE, providing electrical power to the EM, and engaging both
clutches.
Figure 7.28:
Parallel hybrid schematic.
Figure 7.29:
HEV with mechanical coupler.
370
Chapter 7

In principle, any type of electric motor could be used to provide the electric propulsion in
a hybrid vehicle. However, in practice, there are two main types in common use today: the
brushless DC motor and the induction motor. Both are explained and modeled in Chapter 6. It
should be recalled that the brushless DC motor incorporates a permanent magnet rotor
normally with multiple poles. The stator has multiple windings that are excited by AC
currents. Typically, the stator windings are arranged for three-phase operation.
However, the stored electric power in a hybrid vehicle is DC (from the battery pack). The
frequency condition for this type of motor requires that the rotational frequency um be
identical to the stator excitation frequency us since the rotor excitation is at ur ¼ 0.
Operation of the brushless DC motor in a hybrid vehicle during electric propulsion requires
that an electric system convert the stored DC electric power to 3-phase AC power. This
conversion is accomplished in a motor control system that creates an electric control signal at
frequency us in addition to power switching circuits (normally implemented via high-power
switching transistors). Ideally, the stator excitation should be three sinusoidal voltages of
equal amplitude which in phasor notation are given by
VA ¼ Vejust
VB ¼ Vejðustþ2p=3Þ
VC ¼ Vejðustþ4p=3Þ
(62)
However, in practice, the excitation waveforms are not sinusoidal. Rather, they are more often
of a form of square or trapezoidal waveform. Motor control requires correct phasing relative
to the orientation of the rotor. Such phasing requires a noncontacting rotor position sensor
(e.g., Hall effect; see Chapter 6).
In order to provide torque and power levels required for hybrid vehicle operation a brushless
DC motor is made using powerful magnets having so-called rare earth elements. A typical
magnet for a hybrid vehicle brushless DC motor is made of an alloy of iron, boron, and, the
relatively expensive rare earth, element, neodynium.
A brushless DC motor can also function as an alternator. The motion of the rotor creates
a time-varying ﬂux linking the stator turns VA, VB, and VC. This time-varying ﬂux linkage, in
turn, creates a voltage given by VAVBVC in each winding:
VA ¼ dFA
dt
VB ¼ VAejð2p=3Þ
VC ¼ VAejð4p=3Þ
Digital Powertrain Control Systems
371

The zero phase corresponds to the rotor rotation angle for which VA is a maximum.
These voltages can be converted to DC using a set of transformers (to achieve correct voltage
levels) and rectiﬁer circuits (see Chapter 3). The corresponding DC power can be supplied to
the battery pack to increase its state of charge. In this way, the motor acting as a generator can
provide braking torque to decelerate the vehicle and recover some of the vehicle kinetic
energy that would otherwise be dissipated in brakes. Such generator action is known as
regenerative braking.
Other electric motor types also have application in hybrid vehicle propulsion. In Chapter 6 the
induction motor was explained. Induction motors of high torque/power output and high
efﬁciency can be built without requiring rare earth magnetic material. A model for an
induction motor was presented in Chapter 6 where it was shown that the frequency condition
for average torque generation is automatically satisﬁed.
Induction motors for hybrid vehicle use are normally three-phase, meaning that three separate
windings (one for each phase) are required for both stator and rotor. In Chapter 6 it was shown
that the torque produced by the induction machine (with current excitation amplitude Is) is
given by
Te ¼ ðus  umÞM2R2
rI2
s
R2r þ ðus  umÞ2L2r
(63)
where us is the excitation frequency and um is the motor rotational frequency.
All parameters in this model for Te are deﬁned in Chapter 6. It is also shown in Chapter 6 that
the steady-state motor speed for a given excitation is the motor angular speed uo at which the
motor torque Te(uo) balances the load torque TL:
TeðuoÞ ¼ TLðuoÞ
(64)
This point is illustrated for a hypothetical hybrid vehicle being propelled solely by an
induction motor. The load torque at the motor output is proportional to the force FV required
to move the vehicle at the commanded speed.
We consider ﬁrst a hybrid vehicle moving along a steady speed on a straight, level road. There
are two primary contributions to FV: tire rolling resistance Frr and aerodynamic drag D. The
rolling resistance is essentially independent of vehicle speed but is proportional to vehicle
weight and varies as a decreasing function of tire pressure. If we assume that all tires are
equally inﬂated, then the total rolling resistance force is given by
Frr ¼ mrrWV
372
Chapter 7

where WV is the vehicle weight and mrr is the coefﬁcient of rolling resistance of tires. The
coefﬁcient mrr is generally in the range 0.02  .mrr  0.04.
The aerodynamic drag D is given by
D ¼ r
2 CDSrefV2
where r is the local air density (kg/m3 or slug/ft3), CD is the drag coefﬁcient, Sref is the
a reference area (m2 or ft2), and V is the vehicle speed (m/s or ft/s).
The reference area is an arbitrary choice that ultimately determines the value for CD. It is
common practice to choose Sref as the vehicle projected area on a vertical plane normal to the
vehicle plane of symmetry. The force necessary to move the vehicle along a straight, level
road at a constant speed V is given by
FV ¼ mrrWV þ ð1=2ÞrCDSrefV2
The above expression for FV is valid for a level road. Whenever the vehicle encounters
a nonzero slope (i.e., along a hill), this force includes a term that is proportional to the vehicle
weight and the slope of the hill. For a vehicle traveling along a road with a slope (relative to
horizontal) of angle q, the total force FV is given by
FV ¼ mrrWV þ ð1=2ÞrCDSrefV2 þ WVsinq
(66)
Thus, a road with nonzero slope can shift load torque on the motor (TL) up or down depending
upon whether sign (q) is þ or q, respectively.
In the hypothetical example, the induction motor drives the vehicle wheels through
a transmission and differential such that um is proportional to V. The load torque at the motor
output TV is proportional to the force FV:
TV ¼ rTFV=gv
(67)
where gV is the gear ratio from motor to drive wheels and rT is the tire effective radius.
Figure 7.30 is a plot of normalized motor torque Tm and load torque TL (normalized to the
maximum motor torque Tmax) vs. the ratio um/us where
Tm ¼ Te
Tmax
TL ¼ TV
Tmax
Digital Powertrain Control Systems
373

where for a given excitation Tmax is deﬁned as
Tmax ¼ max
um
ðTeÞ
The steady-state operating motor speed is at the intersection of these two curves (i.e., at
um=usx0:92). A change in load torque (e.g., due to a nonzero road slope) causes the load
curve to shift to a new motor operating point. The system is stable as long as
TL=Tmax < 1:
The efﬁciency of the induction motor is inﬂuenced, in part, by the steady-state operating
point. In general, as long as the steady-state operating point (i.e., um ¼ uo) is in the negative
slope region of Te(um) (and operation is stable), the motor produces torque that varies in
proportion to slip s. However, motor efﬁciency varies inversely with slip.
The induction motor controller can regulate Te(um) via the excitation frequency (us) and
current amplitude Is or motor voltage Vs. One hypothetical control strategy would vary the
excitation and synchronous excitation frequency (us) to optimize the motor efﬁciency.
However, there are many other factors that inﬂuence the overall vehicle efﬁciency including
the choice of ICE and/or electric propulsion, battery status, vehicle-operating conditions and
driving patterns (e.g., urban or highway), etc.
Figure 7.30:
Normalized motor torque TM vs. normalized load torque TL.
374
Chapter 7

The current that provides the induction motor excitation Is is determined by the source voltage
Vs and motor impedance. Normally, motor control is preferably done via regulation of Vs
directly rather than via Is. We consider next the model for the motor torque based upon the
excitation voltage Vs.
The stator current magnitude Is is related to the complex terminal voltage amplitude Vs. For
sinusoidal excitation and using the parameter notation for induction motors from Chapter 6,
the relationship between Vs and Is is given by
Vs ¼ jusLsIs þ u2
sM2IsðRs=sÞ
ðRs=sÞ2 þ u2sL2r
 j
u3
sM2LrIs
ðRr=sÞ2 þ u2sL2s
(68)
This expression gives the voltage/current relationships for each phase. See Chapter 6 for the
deﬁnitions of all parameters. Solving the above equation for Is and substituting it into the
equation for motor torque yields
Te ¼ ðM2=usLsLrÞ ðLv=LsÞ ðRr=sÞ V2
s

us

1  M2
LrLs

Lr
2
þðRr=sÞ2
(69)
The above equation provides a basis for motor torque control in hybrid vehicle applications.
For an induction motor at constant supply voltage amplitude Vs the slip s will vary until the
motor torque is the same as load torque TL:
TeðsÞ ¼ TL
There is a family of curves of Te(s) for each excitation voltage that is similar in form to that
given for current excitation (see Figure 7.30). Normal operation of an induction motor is in
a region in which
dTe
dus
< 0
and s is relatively small. In this region, the motor torque is given approximately by
Tey
 M2
usL2s
 s
Rr
V2
s
(70)
On the other hand, when slip is relatively large the torque can be shown to be given
approximately by
Digital Powertrain Control Systems
375

Tey
M2RrV2
s
ðLrLsÞ2u3s

1  M2
LrLs

s
(71)
The above approximate expressions can be used to control motor torque for the two distinct
regions of operation. In any event, the motor control can regulate torque by controlling
excitation voltage as well as frequency us as explained later in this chapter.
For either series or parallel hybrid vehicle, dynamic braking is possible during vehicle
deceleration, with the EM acting as a generator. The EM/generator supplies power to the
high-voltage bus which is converted to the low-voltage bus (LVB) voltage level by the
power electronics subsystem. In this deceleration circumstance, the energy that began as
vehicle kinetic energy is recovered with the motor acting as a generator and is stored in
the battery pack. This storage of energy occurs as an increase in the state of charge
(SOC) of the battery pack. This process (regenerative braking) was discussed above with
respect to the brushless DC motor, but applies equally well with an induction motor
drive system.
In addition to the lead acid battery in common use today, there are new energy storage means
including nickelemetal hydride (NiMH) and even special capacitors called ultra-caps. Each
of these electrical energy storage technologies has advantages and disadvantages for hybrid
vehicle application.
The battery pack has a maximum SOC that is ﬁxed by its capacity. Dynamic braking is
available as an energy recovery strategy as long as SOC is below its maximum value.
Nevertheless, dynamic braking is an important part of hybrid vehicle fuel efﬁciency. It is the
only way some of the energy supplied by the ICE and/or EM can be recovered when the
vehicle is traveling along a road with a negative slope or is decelerating instead of being
dissipated in the vehicle brakes.
For each battery type, there is a maximum rated stored charge qr which is determined by
construction. The SOC for the battery is normally expressed by the instantaneous q expressed
as a fraction of qr. A storage battery is, in effect, a type of nonlinear capacitor (with
a nonlinear source resistance) in which the open circuit voltage Voc is a function of stored
charge q:
Voc ¼ fðqÞ
The storage of the energy recovered during dynamic braking requires that the corresponding
electrical energy be direct current and at a voltage compatible with the battery pack. Since
most automotive systems apart from the motor operate at 12 V (nom), a common battery pack
might consist of a connection of multiple 12-volt batteries.
376
Chapter 7

Conversion of electrical power from one voltage level V1 to a second V2 is straightforward
using a transformer as long as this power is alternating current. Figure 7.31 schematically
illustrates transformer structure and the conversion of voltages from one level to another.
A transformer consists of a core of magnetically permeable material (usually a ferromagnetic
material) around which a pair of closely wrapped coils are formed. One coil (termed the
primary) consists of N1 turns and the other (termed the secondary) consists of N2 turns. In
a well-designed transformer essentially all of the magnetic ﬂux in the core links all turns in
both coils.
Assuming (arbitrarily) that AC electrical power comes from a source (e.g., an AC generator)
at peak voltage V1, then the power ﬂowing from the transformer secondary to a load will be at
a peak voltage V2 where
V2 ¼ ðN2=N1ÞV1
Conversion of DC electrical power from one voltage to another can be accomplished using
a transformer only if the DC power is ﬁrst converted to AC and then converted back to DC as
explained below. Figure 7.32a is a greatly simpliﬁed schematic of a DC-to-DC converter in
which a transistor is used to convert an input DC signal to AC that is sent to a transformer for
conversion to a different voltage.
The control electronics supplies a pulsating signal to the base B of transistor Q1, alternately
switching it on and off. When Q1 is on (i.e., conducting), voltage V1 is applied to the
transformer primary (i.e., N1). When Q1 is off (i.e., nonconducting), transformer primary
voltage is zero. In this case, the pulsating AC voltage that is alternately V1 and 0 applied to the
primary results in an AC voltage in the secondary that is essentially N2/N1 times the primary
voltage. This secondary voltage is converted to DC by rectiﬁcation using diode D1 and
ﬁltering via capacitor C (see Chapter 3). The secondary voltage is fed back to the control
electronics, which varies the relative ON and OFF times to maintain V2 at the desired level.
Figure 7.31:
Transformer conﬁguration.
Digital Powertrain Control Systems
377

A variation of the circuit of Figure 7.32a appears in the power electronics module for
conversion between the battery pack or from an ICE-driven generator and the hybrid vehicle
motor driver. Regardless of the type of motor used, the generation of the voltages that provide
the motor excitation (i.e., VA VB VC for a three-phase motor) can be accomplished using
circuits of the conﬁguration shown in Figure 7.32b. Although this ﬁgure depicts a single
phase (i.e., VA), a separate driver transistor such as Q1 along with a transformer (of N1 primary
and N2 secondary turns) is required for each phase. The control electronics internally
computes the signals that control the phases (i.e., 0, 2p/3 and 4p/3) of the remaining three
phases. This control is normally implemented in the powertrain control system. Of course, the
speciﬁc details of the relevant power electronics depend on the hybrid vehicle manufacturer.
Powertrain control for a hybrid vehicle is achieved using a multimode digital control system.
It is somewhat more complicated than the digital engine control system discussed earlier in
this chapter in that it must control an IC engine as well as an EM motor. In addition, it must
achieve the balance between ICE and EM power, and it must engage or disengage the
solenoid-operated clutches (if present).
The inputs to this controller come from sensors that measure the following:
•
power demand from driver (accelerator pedal),
•
state of charge of battery pack,
•
vehicle speed,
•
ICE RPM and load,
•
EM voltage and current,
•
EM angular position (for brushless DC motors), and
•
regulation of electric power ﬂow and voltage.
(a)
(b)
Figure 7.32:
Voltage conversion circuit.
378
Chapter 7

The system outputs include control signals to
•
ICE throttle position,
•
EM motor control inputs (e.g., VA VB VC),
•
clutch engage/disengage, and
•
switch ICE ignition on/off
Depending upon the HEV conﬁguration, there may be no direct mechanical link from the
accelerator pedal to the throttle. Rather, the throttle position (as measured by a sensor) is set
by the control system via an electrical signal sent to an actuator (motor) that moves the
throttle in a system called drive-by-wire.
The control system itself is a digital controller using the inputs and outputs listed above and
has the capability of controlling the hybrid powertrain in many different modes. These modes
include starting from a standing stop, steady cruise, regenerative braking, recharging battery
pack, and many others that are speciﬁc to a particular vehicle conﬁguration.
In almost all circumstances, it is desirable for the IC engine to be off at all vehicle stops.
Clearly, it is a waste of fuel and an unnecessary contribution to exhaust emissions for an IC
engine to run in a stopped vehicle. Exceptions to this rule involve cold weather operations in
which it is desirable or even necessary to have some limited engine operations with a stopped
vehicle in order to maintain engine and catalytic converter at proper temperature. In addition,
a low-battery SOC might call for ICE operation at certain vehicle stops in order to provide
charge to the battery pack.
When starting from a standing start, normally the EM propulsion is used to accelerate the car
to desired speed, assuming the battery has sufﬁcient charge. If charge is low, then the
controller can engage the clutch to the ICE such that the EM can begin acceleration and at the
same time crank the ICE to start it. Then, depending on the time that the vehicle is in motion,
the ICE can provide propulsive power and/or battery charge. Should the vehicle go to a steady
cruise at low battery SOC for engine operation near its optimum, then the control strategy
normally is to switch off the electric power to the EM and power the vehicle solely and
recharge the battery pack with the ICE. In other cruise conditions, the controller can balance
power between ICE and EM in a way that maximizes total fuel economy (subject to emission
constraints).
For urban driving with frequent stops, the control strategy favors EM operation as long as
SOC is sufﬁcient. In this operating mode, regenerative braking may be used (in which energy
is absorbed by vehicle deceleration), and the recovered energy appears as increased SOC.
The various operating modes and control strategies for an HEV depend on many factors,
including vehicle weight; relative size and power capacity of ICE/EM; and exhaust emissions
and fuel economy of the ICE (as installed in the particular vehicle). It is beyond the scope of
Digital Powertrain Control Systems
379

this book to attempt to cover all possible operating modes for all HEV conﬁgurations.
However, the above discussion has provided background within which speciﬁc HEV
conﬁgurations’ operating modes and control strategies can be understood.
In addition to the HEV, there is also the pure electric vehicle (EV) that has no ICE for
powering the vehicle. This vehicle incorporates many of the components of an HEV including
an electric motor, a battery pack for storing electric energy, and an electronic controller that
provides the motor excitation. As any EV is driven, the battery SOC decreases.
Control of the EM in an EV is accomplished in a way that is similar to that described above
for EM motor control in an HEV. This control is done by regulating the excitation voltage or
current as well as the excitation frequency (which must satisfy the frequency condition for
any motor). At some point, the battery pack requires recharging. The power for this
recharging comes from the electric power grid. It is worth remembering that although an EV
has essentially zero vehicle-out emissions, the creation of the electric power to recharge the
batteries is done at some electric utility. Depending on the type of power generation at the
electric utility, there may be increased emissions from that plant to meet the power
requirements to recharge EV battery packs except for nuclear electric power generators. In
this sense, the EV is not always a pure zero-emission vehicle.
380
Chapter 7

CHAPTER 8
Vehicle-Motion Controls
Chapter Outline
Representative Cruise Control System
382
Digital Cruise Control
390
Hardware Implementation Issues
394
Throttle Actuator
396
Cruise Control Electronics
400
Stepper Motor-based Actuator Electronics
401
Vacuum-Operated Actuator
403
Advanced Cruise Control
406
Antilock Braking System
410
Tire-Slip Controller
420
Electronic Suspension System
420
Variable Damping via Variable Strut Fluid Viscosity
442
Variable Spring Rate
443
Electronic Suspension Control System
444
Electronic Steering Control
446
Four-Wheel Steering
449
Summary
457
The term vehicle motion refers to the translation along and rotation about all three axes
(i.e. longitudinal, lateral, and vertical) for a vehicle. By the term longitudinal axis, we mean the
axis that is parallel to the ground (vehicle at rest) on a horizontal plane along the length of
the car. The lateral axis is orthogonal to the longitudinal axis and is also parallel to the ground
(vehicle at rest). The vertical axis is orthogonal to both the longitudinal and lateral axes.
Rotations of the vehicle around these three axes correspond to angular displacement of the car
body in roll, yaw, and pitch. Roll refers to angular displacement about the longitudinal axis;
yaw refers to angular displacement about the vertical axis; and pitch refers to angular
displacement about the lateral axis.
In characterizing the vehicle dynamic motion, it is common practice to deﬁne a body-centered
Cartesian coordinate system in which the x-axis is the longitudinal axis with positive
forward. The y-axis is the lateral axis and is taken as the lateral axis with the positive sense
to the right-hand side. The vertical axis is taken as the z-axis with the positive sense up.
Understanding Automotive Electronics. http://dx.doi.org/10.1016/B978-0-08-097097-4.00008-4
Copyright  2012 Elsevier Inc. All rights reserved.
381

The vehicle dynamic motion is represented as displacement, velocity, and acceleration of the
vehicle relative to an earth-centered, earth-ﬁxed (ECEF) inertial coordinate system (as will be
explained later in this chapter) in response to forces acting on it. Although strictly speaking,
the ECEF coordinate system is not truly an inertial reference, with respect to the types of
motion of interest in most vehicle dynamics it is essentially an inertial reference system.
Electronic controls have been recently developed with the capability of regulating the motion
along and about all three axes. Individual car models employ various selected combinations
of these controls. This chapter discusses motion control electronics beginning with control
of motion along the longitudinal axis in the form of a cruise control system.
The forces and moments/torque that inﬂuence vehicle motion along the longitudinal axis
include those due to the powertrain (including, in selected models, traction control), the brakes,
the aerodynamic drag, and tire-rolling resistance, as well as the inﬂuence of gravity when the car
is moving on a road with a nonzero inclination (or grade). In a traditional cruise control system,
the tractive force due to the powertrain is balanced against all resisting forces to maintain
a constant speed. In an advanced cruise control system, brakes are also automatically applied as
required to maintain speed when going down a hill of sufﬁciently steep grade. Longitudinal
vehicle motion refers to translation of the vehicle in an ECEF y,z-plane.
Representative Cruise Control System
Automotive cruise control is an excellent example of the type of electronic feedback control
system that was discussed in general terms in Chapter 1. Recall that the components of
a control system include the plant, or system being controlled, and a sensor for measuring the
plant variable being regulated. It also includes an electronic control system that receives inputs
in the form of the desired value of the regulated variable and the measured value of that
variable from the sensor. The control system generates an error signal constituting the
difference between the desired and actual values of this variable. It then generates an output
from this error signal that drives an electromechanical actuator. The actuator controls the input
to the plant in such a way that the regulated plant variable is moved toward the desired value.
We begin with a simpliﬁed cruise control for a vehicle traveling along a straight road (along
the x axis in our ECEF coordinate system). In the case of a cruise control, the variable being
regulated is the vehicle speed:
V ¼ dx
dt
where x is the translation of the vehicle in the ECEF frame.
The driver manually sets the car speed at the desired value via the accelerator pedal. Upon
reaching the desired speed (Vd), the driver activates a momentary contact switch that sets that
382
Chapter 8

speed as the command input to the control system. From that point on, the cruise control
system maintains the desired speed automatically by operating the throttle via a throttle
actuator.
Under normal driving circumstances, the total external forces acting on the vehicle are such
that a net positive traction force (from the powertrain) is required to maintain a constant
vehicle speed. The total external forces acting on the vehicle include rolling resistance of
the tires, aerodynamic drag, and a component of vehicle weight whenever the vehicle is
traveling on a road with a slope relative to level. However, when the car is on a downward
sloping road of sufﬁcient grade, drag and tire-rolling resistance are insufﬁcient to prevent
vehicle acceleration (i.e. _V > 0) and maintaining a constant vehicle speed requires
a negative tractive force that the powertrain cannot deliver. In this case, the car will
accelerate unless brakes are applied. For our initial discussion, we assume this latter
condition does not occur and that no braking is required. It is further assumed that the
powertrain has sufﬁcient power capability of maintaining constant vehicle speed on an
up-sloping grade.
The plant being controlled consists of the powertrain (i.e. engine and drivetrain), which
propels the vehicle through the drive axles and wheels. As described above, the load on this
plant includes friction and aerodynamic drag as well as a portion of the vehicle weight when
the car is going up- and down-hills.
For an understanding of the dynamic performance of a cruise control, it is helpful to develop
a model for vehicle motion along a road. The basic performance of a cruise control can be
presented with a few simplifying assumptions. In the interest of safety a typical cruise control
cannot be activated below a certain speed (e.g. 40 mph). For the purposes of presenting the
present somewhat simpliﬁed model, it is assumed that the vehicle is traveling along a straight
road at a cruise speed with the automatic transmission in torque converter lock-up mode
(see Chapter 7). This assumption removes some powertrain dynamics from the model. It is
further assumed that the transmission is in direct drive such that its gear ratio is 1. The total gear
ratio is given by the differential/transaxle gear ratio gA where typically 2:8  gA  4:0. Under
this assumption, the torque applied to the drive wheels Tw is given by
Tw ¼ gATb
(1)
where Tb is the engine brake torque.
The cruise control system employs an actuator that moves the throttle in response to the
control signal. Of course whenever the cruise control is disabled, this actuator must release
control of the throttle such that the driver controls throttle angular position via the accelerator
pedal and associated linkage. Except for roads with relatively steep grades, normally, once
cruise control is activated relatively small, changes in throttle position are required to
Vehicle-Motion Controls
383

maintain selected vehicle speed. For our simpliﬁed model we assume that Tb varies linearly
with cruise control output electrical signal u:
Tb ¼ Kau
(2)
where Ka is a constant for the engine/throttle actuator. This assumption, though not strictly
valid, permits a system performance analysis using the discussion of linear control theory
of Chapter 1 without any serious loss of generality.
A vehicle traveling along a straight road at speed V experiences forces due to the wheel
torque Tw, aerodynamic drag D tire-rolling resistance Frr, and inertial forces. A dynamic
model for the vehicle longitudinal (i.e. along the direction of travel and vehicle fore/aft
axis) is given by
M _V þ D þ Frr ¼ gATb
rw
 WV sin q
(3)
where
M ¼ vehicle mass
WV ¼ vehicle weight (gM)
rw ¼ drive wheel effective radius
Frr ¼ mrWV
mr ¼ coefﬁcient of tire-rolling resistance
:02  mr  0:04 typically
q
¼ angle of the road surface relative to a horizontal plane
D
¼ r
2CDSrefðV þ VwÞ2
r
¼ air density
CD ¼ drag coefﬁcient
Sref ¼ reference area
Vw ¼ the component of wind along vehicle longitudinal axis (positive for head
wind negative for tail wind).
In specifying a drag coefﬁcient for a car, it is necessary to specify a reference area. Although
the choice of Sref is somewhat arbitrary, conventional practice takes the largest vehicle cross-
sectional area projected in a body y,z-plane. In the above nonlinear differential Eqn (3), the
ﬁrst term on the right-hand side (RHS) is the force acting on the vehicle due to the applied
road torque acting at the tire/road interface due to the powertrain. The second term on the
RHS is the component of force along the vehicle axis due to its weight and any road slope
expressed by q.
384
Chapter 8

For a car traveling at constant cruise speed VC (i.e. _V ¼ 0) along a level, horizontal road
(i.e. q ¼ 0) with zero wind, the differential equation above reduces to an algebraic expression
in terms of the engine brake torque and speed V:
r CDSref
2
V2
C þ mrWV ¼ ga
Tb
rw
(4)
This equation permits a determination of engine brake torque vs. cruise speed for a level
road.
If the vehicle is traveling at a steady speed along a hill with slope angle q, then the Tb is
determined from the following equation:
gA
Tb
rW
¼ r CDSrefV2
C
2
þ mrWV þ Mg sin q
(5)
For the operation of the cruise control system, it is normally sufﬁcient to model vehicle
dynamics with a linearized version of the nonlinear differential equation. The drag term
can be linearized by representing vehicle instantaneous speed (V(t)) with the approximate
model assuming for simplicity that Vw ¼ 0:
D ¼ DC þ dD
(6)
VðtÞ ¼ VC þ dV
where DC is the drag at speed VC:
dD ¼ dD
dV

VC
dV
¼ rCDSrefVCdV
¼ KDdV
where KD is a constant for a given initial steady cruise speed VC and constant r.
In modeling the cruise control system, it is helpful to consider the inﬂuence of road grade (q)
as a disturbance. This disturbance can be linearized to a close approximation by the
substitution (provided that the slope of the hill is sufﬁciently small):
sin qzq
The linearized equation of motion is given by
Md _V þ rCDSref VCdV  Mgq ¼ gA
dTb
rW
¼ gA
Kau
rw
(7)
Vehicle-Motion Controls
385

The operational transfer function Hp(s) for the “plant” for zero disturbance (i.e., q ¼ 0) is
given by
HpðsÞ ¼ dVðsÞ
uðsÞ
¼ KagA=ðMrwÞ
s þ r CDSref Vc
M
(8)
The conﬁguration for a representative automotive cruise control is shown in Figure 8.1.
When the vehicle reaches the desired speed under normal driver accelerator pedal regulation
of the throttle, to activate cruise control at that speed the driver pushes a momentary contact
switch thereby setting the command speed in the controller. At this point, control of the
throttle position is via the cruise control actuator. The momentary contact (pushbutton) switch
that sets the command speed is denoted S1 in Figure 8.1.
Also shown in this ﬁgure is a disable switch that completely disengages the cruise control
system from the power supply such that throttle control reverts back to the accelerator pedal.
This switch is denoted S2 in Figure 8.1 and is a safety feature. In an actual cruise control
system, the disable function can be activated in a variety of ways, including the master power
switch for the cruise control system and a brake pedal-activated switch that disables the cruise
control any time that the brake pedal is moved from its rest position. The throttle actuator opens
and closes the throttle in response to the error between the desired and actual speed. Whenever
the actual speed is less than the desired speed, the throttle opening is increased by the actuator,
which increases vehicle speed, until the error is zero at which point the throttle opening remains
ﬁxed until either a disturbance occurs or the driver calls for a new desired speed.
Figure 8.1:
Cruise control conﬁguration.
386
Chapter 8

A block diagram of a cruise control system is shown in Figure 8.2. In the cruise control
depicted in this ﬁgure, a proportional integral (PI) control strategy has been assumed. Before
the advent of digital cruise control, there were a variety of analog systems which had
a proportional-only (P) control law. Nevertheless, the PI controller is representative of good
design for such a control system since it can reduce steady-state speed errors to zero (as
explained in Chapter 1). In this strategy, an error e is formed by subtracting (electronically)
the actual speed V from the desired speed Vd:
e ¼ Vd  V
(9)
It should be noted that the speed differential from Vc is the negative of the error
(i.e. e ¼ d V). The controller then electronically generates the actuator signal by
combining a term proportional to the error (Kpe) and a term proportional to the integral
of the error:
K1
Z
edt
(10)
The actuator signal u is given by
u ¼ Kpe þ KI
Z
edt
(11)
Operation of the system can be understood by considering the operation of a PI
controller. We assume that the driver has reached the desired speed (say, 60 mph) and
activated the speed set switch. The car is initially traveling on a level road at the desired
speed. Then at some point it encounters a long hill with a steady positive slope (i.e.
a hill going up).
Figure 8.2:
Cruise control block diagram.
Vehicle-Motion Controls
387

The control signal at the output of the PI controller u is given by
u ¼ Kpe þ KI
Z
edt
(12)
It is consistent with the linearized approximation to model the change in brake torque dTb due
to actuator change in throttle position in response to the control signal u as linear in the
control signal (as presented earlier):
dTb ¼ Kau
where Ka is a constant for the throttle actuatoreengine combination. With the above models
and notation, the vehicle dynamic equation of motion becomes
Md _V þ KDdV þ Mgq ¼ gAKau
rw
¼ gA
Ka
rW

Kpe þ KI
Z
edt

(13)
Taking the Laplace transform of the above equation and solving for the speed differential
yield
dVðsÞ ¼ 
sgqðsÞ

s2 þ
KD
M þ gAKaKp
Mrw

s þ gAKaKI
Mrw

(14)
A computer simulation of this simpliﬁed cruise control was done for a step change in grade of
q ¼ 0.03 starting at 2 s into the simulation for the following parameters in English units:
WV ¼ 3100lb
CD ¼ 0.3
Sref ¼ 18 ft2
r ¼ 0.0024slug/ft3 (i.e. sea level on a standard day)
KA ¼ 10
Kp ¼ 10
KI ¼ 50
rw ¼ 1 ft
The simulation was done for the PI control but for reference purposes was also run for KI ¼ 0
(i.e. a proportional-only control). Figure 8.3 shows the response for the car initially traveling
under cruise control at 60 MPH. At time t ¼ 2 s a hill of steady 5% (i.e. q ¼ 0.05) grade occurs
(for the particular gains chosen). The dashed curve is the response of proportional-only
control. Note that the speed drops down to a steady 53 MPH for the controller. The solid curve
depicts the vehicle speed for the preferred PI control. Except for a brief overshoot, this control
388
Chapter 8

Figure 8.3:
Cruise control speed performance.
returns the vehicle speed to the set point of 60 MPH in a few seconds. It should be noted that
the P-only control performance can be improved by increasing Kp (provided the system
satisﬁes stability robustness criteria (see Chapter 1)).
The response characteristics of a PI controller depend strongly on the choice of the gain
parameters Kp and KI. It is possible to select values for these parameters to increase the rate at
which the system responds to disturbance. If this rate is increased too much, however,
overshoot will increase and stability robustness (e.g. gain/phase margins) generally is
reduced. As explained in Chapter 1, the amplitude of the speed error oscillations decreases by
an amount determined by a parameter called the damping ratio. The damping ratio that
produces the fastest response without overshoot is called critical damping.
The importance of these performance curves of Figure 8.3 is that they demonstrate how the
performance of a cruise control system is affected by the controller gains. These gains are
simply parameters that are contained in the control system. They determine the relationship
between the error, the integral of the error, and the actuator control signal.
Usually a control system designer attempts to balance the proportional and integral control
gains so that the system is optimally damped. However, because of system characteristics, in
many cases, it is impossible, impractical, or inefﬁcient to achieve the optimal time response
and therefore another response is chosen. The control system should cause Tb to respond
quickly and accurately to the command speed, but should not overtax the engine in the
Vehicle-Motion Controls
389

process. Therefore, the system designer chooses the control electronics that provide the
following system qualities:
1.
Quick response
2.
Stable system
3.
Small steady-state error
4.
Optimization of the control effort required
Digital Cruise Control
The explanation of the operation of cruise control thus far has been based on a continuous
time formulation of the problem. This formulation correctly describes the concept for cruise
control regardless of whether the implementation is by analog or digital electronics. Cruise
control is now mostly implemented digitally using a microprocessor-based controller. For
such a system, proportional and integral control computations are performed numerically in
the computer. The digital cruise control is inherently a discrete time system with samples of
the vehicle speed taken at integer multiples of the sample period Ts.
The block diagram for a representative digital cruise control is depicted in Figure 8.4.
The plant variable being controlled is its forward speed V. The desired speed or set point for
the controller is denoted Vd. The model for the plant as represented by its transfer function
Hp(s) is taken to be the same as that developed above for the analog version of the cruise
control. However, the actuator signal which is the ZOH output uðtÞ is a piecewise continuous
signal (see Chapter 2):
HpðsÞ ¼ VðsÞ
uðsÞ
¼
gAKa
Mrwðs þ KD=MÞ
¼
K
s þ s0
(15)
Vd
Ts
ek
e
V
+
–
digital
control
Hc (z)
plant
Hp (s)
sensor
Hs (s)
ZOH
Hh0
uk
ū(t)
G(z)
Figure 8.4:
Digital speed control block diagram.
390
Chapter 8

where
K ¼ gAKa
Mru
so ¼ KD=M
Using the same parameters as were used for the analog version of the cruise control, this
model is given numerically by the following transfer function:
HpðsÞ ¼
0:4129
ðs þ 0:0118Þ
(16)
As explained in Chapter 2, the z-transfer function for the combination of ZOH and plant
(G(z)) is given by
GðzÞ ¼ ð1  z1ÞZ
HpðsÞ
s

(17)
From the methods of Chapter 2, the z-transform above can be found by expanding Hp(s)/s in
a partial fraction series and then using the tables of Chapter 2. Then it is left as an exercise to
show that for sample period Ts ¼ 0.01 s, G(z) is given by
GðzÞ ¼ K
so
"
ð1  z0Þðz  1Þ
z2  ðz0 þ 1Þz þ z2
0
#
(18)
where
K1 ¼ .4129
so ¼ .0018
z0 ¼ esoT
The continuous time PI control law is given by
uðtÞ ¼ KpeðtÞ þ KI
Z
edt
(19)
In Chapter 7 under the section discussing control of variable valve phasing, it was shown that
one discrete time z-transform of the integral term (using the trapezoidal integration rate) is
given by
Z

KI
Z
edt

¼ KITsðz þ 1Þ
2ðz  1Þ
Vehicle-Motion Controls
391

The z-operational transfer function for the controller is given by
HcðzÞ ¼ uðzÞ
eðzÞ
(20)
HcðzÞ ¼ Kp þ KITsðz þ 1Þ
2ðz  1Þ
HcðzÞ ¼

Kp þ KIT
2

z 

Kp  KIT
2

ðz  1Þ
(21)
Using the same gains (Kp ¼ 10 and KI ¼ 50) as for the continuous time control, one obtains
HcðzÞ ¼ 10:25z  9:75
ðz  1Þ
(22)
Chapter 2 also showed that the forward path z-transfer function HF(z) for a discrete time
control system as shown in Figure 8.4 is given by
HFðzÞ ¼ dVðzÞ
eðzÞ
¼ HcðzÞGðzÞ
¼
0:0423z2  0:0826z þ :0403
z3  2:999z2 þ 2:998z  0:9999
(23)
Assuming an ideal sensor for which Hs(s) ¼ 1, the closed-loop gain z-transform function
HCL(z) is given by
HCLðzÞ ¼
HFðzÞ
1 þ HFðzÞ
¼
0:0423z2  0:0826z þ :0403
z3  2:9576z2 þ 2:9172z  0:9596
(24)
The poles of this closed-loop transfer function are
z1 ¼ 1:000
z2 ¼ 0:9788 þ 0:0402i
z3 ¼ 0:9788  0:0402i
392
Chapter 8

Since all poles are either on or inside the unit circle ðjzj ¼ 1Þ, the closed-loop cruise control
system is stable.
The dynamic response for this discrete time cruise control system can be found by evaluating
its response to a step change in the input. Assume that the vehicle is cruising at a steady
60 MPH. Then, at t ¼ 2 s (i.e., at sample k1 where k1 ¼ 200), the cruise control set point is
changed by a step increase of 10 to 70 MPH. This system set point is given by
Vd ¼ 60
t < 2
¼ 70
t  2
(25)
The z-transform for this system input is given by
VdðzÞ ¼ 60 þ 10z
z  1
(26)
The output z-transform V(z) is given by
VðzÞ ¼ HCLðzÞVdðzÞ
(27)
The vehicle speed Vk at times tk is found by taking the inverse z-transform of V(z). Using the
partial fraction expansion method of Chapter 2, the time response at t ¼ tk is shown in
Figure 8.5.
Figure 8.5:
Response of digital cruise control to step change in set speed.
Vehicle-Motion Controls
393

The speed is constant until k ¼ k1 where t(k1) ¼ 2 s and then increases with a relatively small
overshoot approaching the ﬁnal set point value of 70 MPH.
We consider next the implementation of the digital cruise control system in actual
hardware. The vehicle speed sensor and the actuator are analog and can either be modeled
as continuous or discrete time devices (examples of each are discussed below) and the
control system is digital. When the car reaches the desired speed, Vd, the driver activates
the speed set switch. At this time, the output of the vehicle speed sensor is sampled,
converted to a digital value and transferred to a storage register. This is the set point for
the controller.
Hardware Implementation Issues
The computer continuously reads the actual vehicle speed, V, and generates an error, en, at the
sample time, tn:
en ¼ Vd  VðtnÞ
A control signal, un, is computed that has the following form:
un ¼ Kpen þ K1
X
M
m¼1
enm
(28)
This sum, which is computed in the cruise control computer, is then multiplied by the integral
gain KI and added to the most recent error multiplied by the proportional gain Kp to form the
control signal. The computed discrete time control signal un then must be converted to
a piecewise continuous form uðtÞ suitable to operate the actuator (via a ZOH). It should be
noted that uðtÞ corresponds to the control signal u for the continuous time linear cruise control
above. The correct form for this signal is discussed below in conjunction with the throttle
actuator conﬁguration.
The operation of the cruise control system can be further understood by examining the vehicle
speed sensor and the actuator in detail. Figure 8.6a is a sketch of a sensor conﬁguration
suitable for vehicle speed measurement.
In a representative vehicle speed measurement system, the vehicle speed information is
mechanically coupled to the speed sensor by a ﬂexible cable coming from the driveshaft,
which rotates at an angular speed proportional to vehicle speed. A speed sensor driven by this
cable generates a pulsed electrical signal (Figure 8.6b) that is processed by the computer to
obtain a digital measurement of speed.
A speed sensor can be implemented magnetically or optically. The magnetic speed
sensor was discussed in Chapter 6, so we hypothesize an optical sensor for the
394
Chapter 8

purposes of this discussion. For the hypothetical optical sensor, a ﬂexible cable drives
a slotted disk that rotates between a light source and a light detector. The placement of
the source, disk, and detector is such that the slotted disk interrupts or passes the light
from source to detector, depending on whether a slot is in the line of sight from source
to detector. The light detector produces an output voltage whenever a pulse of light
from the light source passes through a slot to the detector. The number of pulses
generated per second is proportional to the number of slots in the disk and the vehicle
speed:
f ¼ NVK
where f is the frequency in pulses per second, N is the number of slots in the sensor disk,
V is the vehicle speed, K is the proportionality constant that accounts for differential gear
ratio and wheel size.
Figure 8.6:
Example speed sensor conﬁguration.
Vehicle-Motion Controls
395

The sampled pulse frequency fk is computed from measurements of the time of each low to
high transition denoted tk in Figure 8.6b:
fk ¼
1
tk  tk1
The output pulses are passed through a sample gate to a binary counter (Figure 8.7).
The gate is an electronic switch that either passes the pulses to the counter or blocks their
passage depending on whether the switch is closed or open. The time interval during which
the gate is closed is precisely controlled by the computer. The digital counter counts the
number of pulses from the light detector during time TgðnÞ that the gate is closed and pulses
from the sensor are sent to the counter during the nth speed measurement cycle. The number
of pulses P(n) that is counted by the digital counter is given by
PðnÞ ¼ TgðnÞNVK
(29)
That is, the number P(n) is proportional to vehicle speed V at speed sample n. The electrical
signal in the binary counter is in a digital format that is suitable for reading by the cruise
control computer.
Throttle Actuator
The throttle actuator is an electromechanical device that, in response to an electrical input
from the controller (u), moves the throttle through some appropriate mechanical linkage.
Two relatively common throttle actuators operate either from manifold vacuum or with
a stepper motor. The stepper motor implementation operates similarly to the idle speed
control actuator described in Chapter 7 and is essentially a digital device. The throttle
opening is either increased or decreased by the stepper motor in response to the sequences
of pulses sent to the two windings depending on the relative phase of the two sets of
pulses.
Figure 8.7:
Digital speed measurement system.
396
Chapter 8

For a stepper motor-type actuator, the control signal (u) is converted to a pair of pulse
sequences to drive the A and B coils (see Chapter 6). The stepper motor displacement causes
a change in throttle plate angle dqt(n) (see Chapter 5) corresponding to un. Let fp be the pulse
frequency for the stepper motor pulse pairs. Normally the pulse signal is generated in the
digital control system as part of its timing circuitry. The controller regulates throttle angle
changes by setting the time interval Ta during which pulses are sent to the stepper motor. The
total number of pulse pairs sent to the stepper motor actuator (Np(n)) during a time interval Ta
is given by
NpðnÞ ¼ fpTaðnÞ
(30)
where Ta(n) is the actuator time during actuation cycle.
The actuation time interval is proportional to un:
TaðnÞ ¼ KTuu
(31)
where KT is a constant for the control system.
The throttle plate angular displacement dqt(n) is proportional to Np(n):
dqtðnÞ ¼ KqNpðnÞ
(32)
where Kq is the angular displacement for each pair of stepper motor pulses.
The time interval for throttle actuation must be sufﬁciently long to permit the full actuation of
dqt(n) to occur but should be less than the discrete time sample period.
For the linearized vehicle model, the change in brake torque dTb(n) is approximated linearly
proportional to dqt(n) (for relatively small dqt at cruise condition):
dTbðnÞ ¼ KbdqtðnÞ
¼ KbKqKTfpun
(33)
A dynamic performance of the digital cruise control is as explained for the discrete time
model given above where dTb(n) is a discrete time version of dTb(t). An example of the
electronics for generating the stepper motor actuator is discussed later in this chapter.
We consider next an exemplary analog (continuous time) throttle actuator. This throttle
actuator is operated by manifold vacuum through a solenoid valve, which is similar to that
used for the EGR valve described in Chapter 7 and further explained later in this chapter.
During cruise control operation, the throttle position is set automatically by the throttle
actuator in response to the actuator signal generated in the control system. This type of
manifold-vacuum-operated actuator is illustrated in Figure 8.8.
Vehicle-Motion Controls
397

A pneumatic piston arrangement is driven from the intake manifold vacuum. The piston-
connecting rod assembly is attached to the throttle lever. There is also a spring attached to the
lever. If there is no force applied by the piston, the spring pulls the throttle closed. When an
actuator input signal energizes the electromagnet in the control solenoid, the pressure control
valve is pulled down and changes the actuator cylinder pressure p by providing a path to
manifold pressure pm. Manifold pressure is lower than atmospheric pressure pa, so the
actuator cylinder pressure quickly drops, causing the piston to pull against the throttle lever to
open the throttle.
Althoughtheactuationsignalisabinary-valuedvoltage,theactuatorcanbeconsideredananalog
device with actuation proportional to the pulse duty cycle (see Chapter 6). The force exerted by
the piston is varied by changing the average pressure pav in the cylinder chamber. This is done by
rapidly switching the pressure control valve between the outside air port, which provides
atmospheric pressure, and the manifold pressure port, the pressure of which is lower than
atmospheric pressure. In one implementation of a throttle actuator, the actuator control signal Vc
is a variable-duty-cycle type of signal like that discussed for the fuel injector actuator. A high Vc
signal energizes the electromagnet; whenever Vc ¼ 0 the electromagnet is de-energized.
Switching back and forth between the two pressure sources causes the average pressure in the
chamber to be somewhere between the low manifold pressure and outside atmospheric pressure.
Figure 8.8:
Vacuum-operated throttle actuator.
398
Chapter 8

For the exemplary solenoid operated actuator, the pressure applied to the valve side of the
oriﬁce pi in Figure 8.8 is given by
pi ¼ pm
Vc ¼ VH
¼ pa
Vc ¼ 0
(34)
where pm is the manifold pressure and pa the atmospheric pressure.
The cruise control computer generates actuator control signal
VcðtÞ ¼ VH
tk  t  tk þ s
¼ 0
tk þ s < t < tkþ1
The duty cycle dp is given by
dp ¼
s
ðtkþ1  tkÞ
(35)
where tk is the periodic cycle time for speed control in the cruise control computer. This duty
cycle (dp) is proportional to control signal un.
The average pressure (pav) in the actuator cylinder chamber (averaged over a period (Tav)
corresponding to several cycles) is given by
pavðtÞ ¼ 1
Tav
Zt
tTav
piðt0Þdt0
¼ pa þ ðpm  paÞdp
(36)
Since pm is a function of engine operating conditions, the control system continuously adjusts
dp to maintain cruise speed at the desired value Vd. This average pressure and, consequently,
the piston force are proportional to the duty cycle of the valve control signal Vc. The duty
cycle is in turn proportional to the control signal un (explained above) that is computed from
the sampled error signal en.
This type of duty-cycle-controlled throttle actuator is ideally suited for use in digital control
systems. If used in an analog control system, the analog control signal must ﬁrst be converted
to a duty-cycle control signal. The same frequency response considerations apply to the
throttle actuator as to the speed sensor. In fact, with both in the closed-loop control system,
each contributes to the total system phase shift and gain and must be considered during
system design.
Vehicle-Motion Controls
399

Cruise Control Electronics
Cruise control can be implemented electronically in various ways, including with
a microcontroller, with special-purpose digital electronics or with analog electronics. It can
also be implemented (in proportional control strategy alone) with an electromechanical speed
governor.
The physical conﬁguration for a digital, microprocessor-based cruise control is depicted in
Figure 8.9. A system such as is depicted in Figure 8.9 has a digital controller that is often
called a microcontroller since it is implemented with a microprocessor operating under
program control that is a part of the system design. The actual program that causes the
various calculations to be performed is stored in read-only memory (ROM). Typically, the
ROM also stores parameters that are critical to the correct calculations. In addition,
the system uses RAM memory to store the command speed and to store any temporary
calculation results. Input from the speed sensor and output to the throttle actuator are
handled by the I/O interface (normally an integrated circuit that is a companion to the
microprocessor). The output from the controller (i.e., the control signal) is sent via the I/O
(on one of its output ports) to so-called driver electronics. The latter electronics receives this
control signal and generates a signal of the correct format and power level to operate the
actuator (as explained below).
A microprocessor-based cruise control system performs all of the required control law
computations digitally under program control. For example, a PI control strategy is
Figure 8.9:
Digital cruise control conﬁguration.
400
Chapter 8

implemented as explained above, with a proportional term and an integral term that is formed
by a summation. In performing this task, the controller continuously receives samples of the
speed error en. This sampling occurs at a sufﬁciently high rate to be able to adjust the control
signal to the actuator in time to compensate for changes in operating condition or to
disturbances. At each sample the controller reads the most recent error and then performs the
control law computations necessary to generate an actuator signal un. As explained earlier
that error is multiplied by the proportional gain Kp, yielding the proportional term in the
control law. It also computes the sum of a number of M previous error samples (the exact sum
is chosen by the control system designer in accordance with the allowable steady-state error
and the available computation time). Then this sum is multiplied by a constant KI and added
to the proportional term, yielding the control signal.
The control signal un at this point is simply a number that is stored in a memory location in the
digital controller. The use of this number by the electronic circuitry that drives the throttle
actuator to regulate vehicle speed depends on the conﬁguration of the particular control
system and on the actuator used by that system.
Stepper Motor-based Actuator Electronics
For example, in the case of a stepper motor actuator, the actuator driver electronics reads the
control variable un and then generates a sequence of pulses to the pair of windings on the
stepper motor (with the correct relative phasing) at frequency fp as explained above to cause
the stepper motor to either advance or retard the throttle setting as required to bring the error
toward zero.
An illustrative example of driver circuitry for a stepper motor actuator is shown in
Figure 8.10.
The basic idea for this circuitry is to drive the stepper motor in such a way as to advance or
retard the throttle in accordance with the control signal un that is stored in memory. Just as the
controller periodically updates the actuator control signal, the stepper motor driver
electronics continually adjusts the throttle by an amount determined by this actuator signal.
This signal is, in effect, a signed number (i.e., a positive or negative numerical value). A sign
bit indicates the direction of the throttle movement (advance or retard). The numerical value
determines the amount of advance or retard.
The magnitude of the actuator signal (in binary format) is loaded into a parallel load serial
down-count binary counter. The direction of movement is in the form of the sign bit (SB of
Figure 8.10). The stepper motor is activated by a pair of quadrature phase signals (i.e.,
signals that are out of phase by p/2) coming from a pair of oscillators. To advance the
throttle, phase A signal is applied to coil 1 and phase B signal to coil 2. To retard the
throttle these phases are each switched to the opposite coil. The amount of movement in
Vehicle-Motion Controls
401

either direction is determined by the number of cycles Np(n) of A and B, one step for
each cycle.
The number of cycles of these two phases is controlled by a logical signal (Z(Ta)) in
Figure 8.10. This logical signal is switched low such that ZðTaÞ is high for period Ta, enabling
a pair of AND gates (from the set A1, A2, A3, and A4). The length of time that Z is switched
high (Ta) determines the number of cycles and corresponds to the number of steps of the
motor.
The logical variable Z corresponds to the contents of the binary counter being zero. As
long as the logical inverse of Z (i.e., Z) is high, a pair of AND gates (A1 and A3, or A2
and A4) is enabled, permitting phase A and phase B signals to be sent to the stepper motor.
The pair of gates enabled is determined by the sign bit. When the sign bit is high, A1 and
A2 are enabled and the stepper motor advances the throttle position as long as Z is not
high. Similarly, when the sign bit is low, A3 and A4 are enabled and the stepper motor
retards the throttle position. The diodes in the AND gate outputs isolate the inactive from
the active AND gates.
Figure 8.10:
Stepper motor actuator electronics for cruise control.
402
Chapter 8

To control the number of steps, the controller loads a binary value into the binary counter.
With the contents not being zero, the appropriate pair of AND gates is enabled. When loaded
with data, the binary counter counts down at the frequency of a clock (CK in Figure 8.10).
When the countdown reaches zero, logical variable Z switches high (and Z switches low) and
the gates are disabled and the stepper motor stops moving.
The time required to count down to zero is determined by the numerical value loaded into the
binary counter. By loading signed binary numbers into the binary counter, the cruise
controller regulates the amount and direction of movement of the stepper motor and thereby
the corresponding movement of the throttle.
Vacuum-Operated Actuator
The driver electronics for a cruise control based on a vacuum-operated system generates
a variable-duty-cycle signal as described above. In this type of system, the duty cycle at any
time is proportionalto thecontrol signal as explained above. For example, if at any given instant
a large positive error exists between the command and actual signal, then a relatively large
control signal will be generated. This control signal will cause the driver electronics to produce
a large duty-cycle signal to operate the solenoid so that most of the time the actuator cylinder
chamber is nearly at manifold vacuum level. Consequently, the piston will move against the
restoring spring and cause the throttle opening to increase. As a result, the engine will produce
more power and will accelerate the vehicle until its speed matches the command speed.
It should be emphasized that, regardless of the actuator type used, a microprocessor-based
cruise control system will:
1.
Read the command speed.
2.
Measure actual vehicle speed.
3.
Compute an error (error ¼ command  actual).
4.
Compute a control signal using P, PI, or PID control law.
5.
Send the control signal to the driver electronics.
6.
Cause driver electronics to send a signal to the throttle actuator such that the error will be
reduced.
Although analog electronics are obsolete in contemporary vehicles, we include the following
example of a pure analog system to illustrate principles introduced in Chapter 3 and because
there remain some older vehicles with such systems on the road. A pure analog speed sensor
in the form of a d-c generator is assumed. Its output voltage Vo is linearly proportional to
vehicle speed V:
Vo ¼ KgV
(37)
where Kg is the constant for the sensor.
Vehicle-Motion Controls
403

An example of electronics for a cruise control system that is basically analog is shown in
Figure 8.11.
The vehicle speed sensor of Figure 8.11a generates the output Vo which is sent to the driver-
operated switch for setting a voltage corresponding to desired speed (Vd) in a hold circuit such
Figure 8.11:
Analog cruise control conﬁguration.
404
Chapter 8

as was described in Chapter 3. This voltage value will remain until reset by the driver to a new
value. The sensor voltage also provides the feedback signal to the error ampliﬁer of this PI
control system. Notice that the system uses four operational ampliﬁers (op amps) as described
in Chapter 3 and that each op amp is used for a speciﬁc purpose. Op amp 1 is used as an error
ampliﬁer. The output of op amp 1 (Ve) is proportional to the difference between the command
speed and the actual speed. The error signal is then used as an input to op amps 2 and 3. Op
amp 2 is a proportional ampliﬁer with a gain of KP ¼ R2/R1. Notice that R1 is variable so
that the proportional ampliﬁer gain can be adjusted. Op amp 3 is an integrator with a gain of
KI ¼ 1/R3C, which generates output voltage VI, which is given by
VI ¼  1
R3C
Z
Vedt
(38)
The outputs of the proportional and integral ampliﬁers are added using a summing ampliﬁer,
op amp 4. The summing ampliﬁer adds voltages VP and VI and inverts the resulting sum. The
inversion is necessary because both the proportional and integral ampliﬁers invert their input
signals while providing ampliﬁcation. Inverting the sum restores the correct sense, or polarity,
to the control signal.
The summing ampliﬁer op amp produces an analog voltage, Vout, that must be converted to
a duty-cycle signal before it can drive the throttle actuator. A voltage-to-duty-cycle converter
is used whose output directly drives the throttle actuator solenoid. The voltage-to-duty-cycle
converter is a voltage-controlled oscillator which generates an output wave form at frequency
fp with duty cycle which is proportional to Vout.
Two switches, S1 and S2, are shown in Figure 8.11a. Switch S1 is operated by the driver to set
the desired speed. It signals the sample-and-hold electronics (Figure 8.11b) to sample the
present vehicle speed at the time S1 is activated and hold that value until the next switch
operation by the driver. Voltage Vc, representing the vehicle speed at which the driver wishes
to set the cruise controller, is sampled and it charges capacitor C. A very high input
impedance ampliﬁer detects the voltage on the capacitor without causing the charge on the
capacitor to “leak” off. The output from this ampliﬁer is a voltage, Vsh, proportional to the
command speed that is sent to the error ampliﬁer:
VshðtÞ ¼ VsðtaÞ
(39)
where ta is the time driver activating S1.
Switch S2 (Figure 8.11a) is used to disable the speed controller by interrupting the control
signal to the throttle actuator. Switch S2 disables the system whenever the ignition is turned
off, the controller is turned off, or the brake pedal is pressed. The controller is switched on
when the driver presses the speed set switch S1.
Vehicle-Motion Controls
405

For safety reasons, the brake turnoff is often performed in two ways. As just mentioned,
pressing the brake pedal turns off or disables the electronic control. In certain cruise control
conﬁgurations that use a vacuum-operated throttle actuator, the brake pedal also
mechanically opens a separate valve that is located in a hose connected to the throttle actuator
cylinder. When the valve is opened by depression of the brake pedal, it allows outside air to
ﬂow into the throttle actuator cylinder so that the throttle plate is rapidly closed. The valve is
shut off whenever the brake pedal is in its inactive position. This ensures a fast and complete
shutdown of the speed control system whenever the driver presses the brake pedal.
Advanced Cruise Control
The cruise control system previously described is adequate for maintaining constant speed,
provided that any required deceleration can be achieved by a throttle reduction (i.e. reduced
engine power). The engine has limited braking capability with a closed throttle, and this
braking in combination with aerodynamic drag and tire-rolling resistance may not provide
sufﬁcient deceleration to maintain the set speed. For example, a car entering a long, relatively
steep downgrade in a mountainous region may accelerate due to gravity even with the throttle
closed.
For this driving condition, vehicle speed can be maintained only by application of the brakes.
For cars equipped with a conventional cruise control system, the driver has to apply braking to
hold speed.
An advanced cruise control (ACC) system has a means of automatic brake application
whenever deceleration with throttle input alone is inadequate. A somewhat simpliﬁed block
diagram of an ACC is shown in Figure 8.12, emphasizing the automatic braking portion.
This system consists of a conventional brake system with master cylinder wheel cylinders,
vacuum boost (power brakes), and various brake lines. Figure 8.12 shows only a single-wheel
cylinder, although there are four in actual practice. In addition, proportioning valves are
present to regulate the front/rear brake force ratio.
In normal driving, the system functions like a conventional brake system. As the driver
applies braking force through the brake pedal to the master cylinder, brake ﬂuid (under
pressure) ﬂows out of port A and through a brake line to the junction of check valves CV1 and
CV2. Check valve CV2 blocks brake ﬂuid, whereas CV1 permits ﬂow through a pump
assembly P and then through the apply valve (which is open) to the wheel cylinder(s), thereby
applying brakes.
In cruise control mode, the ACC controller regulates the throttle (as explained above for
a conventional cruise control) as well as the brake system via electrical output signals and in
response to inputs, including the vehicle speed sensor and set cruise speed switch. The ACC
406
Chapter 8

system functions as described above until the maximum available deceleration with closed
throttle is inadequate. Whenever there is greater deceleration than this maximum value, the
ACC applies brakes automatically. In this automatic brake mode, an electrical signal is sent
from the M (i.e. motor) output of the controller to the motor, causing the pump to send more
brake ﬂuid (under pressure) through the apply valve (maintained open) to the wheel cylinder.
At the same time, the release valve remains closed such that brakes are applied.
The braking pressure can be regulated by varying the isolation valve, thereby bleeding some
brake ﬂuid back to the master cylinder. By activating isolation valves separately to the four
wheels, brake proportioning can be achieved. Brake release can be accomplished by sending
signals from the ACC to close the apply valve and open the release valve. We present next
a continuous time model for the ACC.
The vehicle model under ACC mode is given by
M _V þ D þ Mgsinq ¼ gATbo
rw
 TB
rw
(40)
where Tbo is the engine torque at closed throttle and TB the braking torque.
Figure 8.12:
ACC system conﬁguration.
Vehicle-Motion Controls
407

This braking torque is normally zero under steady cruise. It is only increased from zero in the
ACC mode when required to maintain cruise speed.
Under normal circumstances, for a sufﬁciently steep downgrade (i.e. q < 0), Tbo is negligible.
For simpliﬁcation purposes, it is assumed that the braking torque is linearly proportional to
brake pressure pB:
TB ¼ KBpB
(41)
where KB is a constant for the brake conﬁguration. A linearized model for the vehicle
traveling on a straight road with vehicle speed V ¼ Vd þ dV is given by
Md _V þ KDdV þ Mgq ¼ KBpB=rw
¼ KBKAu=rw
(42)
where KA is the brake pressure actuator constant Vd is the cruise speed set point, and u the
ACC control signal.
If a PI control law is assumed for this ACC automatic braking mode, the control signal is
given by
u ¼ Kpe þ KI
Z
edt
(43)
where
e ¼ Vd  V ¼error signal ¼ dV, where V is the actual vehicle speed.
Substituting the control signal model into the linearized vehicle mode and taking the Laplace
transform of the resulting equation yield the following:

s þ KD
M

dVðsÞ þ gq ¼ KBKA
rwM

Kp þ KI
s

dVðsÞ
(44)
Solving for dV(s) yields
dVðsÞ ¼
gsjqj
s2 þ
KD
M þ KBKAKp
rwM

s þ KBKAKI
rwM
(45)
Note the similarity to the model for cruise control developed earlier in which the actuator
drives the throttle plate angle. In the above equation, the negative sign of the q for g
downgrade is accounted for by replacing q with jqj. The dynamic response of a car with
ACC traveling along a straight horizontal road and encountering a steep downgrade (with
408
Chapter 8

slope q ¼ jqj) is similar to that for an ordinary cruise control encountering a sudden change
in slope except that the speed initially increases and then comes to an asymptotic value.
A simulation of this ACC was run for the same vehicle parameters of the earlier example.
Here it is assumed that the vehicle encounters the steep downgrade at t ¼ 2 s. It is further
assumed for simplicity that the ACC switches instantly to automatic braking mode (when the
throttle closed switch signals the controller). Figure 8.13 is a plot of vehicle speed for P-only
control as well as PI control. The same coefﬁcients are assumed for the controller and KB is
taken to be four.
Figure 8.13 is a plot of the ACC speed response to a long steep downgrade of e7%
encountered at t ¼ 2 s for a vehicle with ACC that is initially in a steady 60 MPH cruise. Note
that for P-only control, the speed increases to an asymptotic value of about 67 MPH. During
the asymptotic range, this speed is maintained with a steady brake pressure. However, for
PI control, the speed initially increases, then with applied brakes decreases with small
undershoot reaching the desired cruise speed of 60 MPH. The action of various control laws
was described in Chapter 1. The present simulation conﬁrms the predicted behavior.
Another potential application for automatic braking involves separate brake pressure applied
individually to all four wheels. This independent brake application can be employed for
improved handling when both braking and steering are active (e.g. braking on curves). Later
in this chapter, an application of automatic braking to enhance the lateral stability of the
vehicle is discussed.
Figure 8.13:
Vehicle speed with ACC on hill with long downgrade.
Vehicle-Motion Controls
409

Antilock Braking System
One of the most readily accepted applications of electronics in automobiles has been the
antilock brake system (ABS). ABS is a safety-related feature that assists the driver in
deceleration of the vehicle in poor or marginal braking conditions (e.g. wet or icy roads). In
such conditions, panic braking by the driver (in non-ABS-equipped cars) results in reduced
braking effectiveness and, typically, loss of directional control due to the tendency of the
wheels to lock (i.e. to stop rolling and to be held ﬁrmly against rotation by the brakes).
In ABS-equipped cars, the wheel is prevented from locking by a mechanism that
automatically regulates the force applied to the wheels by the brakes to an optimum for any
given low-friction condition. The physical conﬁguration for an ABS is shown in Figure 8.14.
In addition to the normal brake components, including brake pedal, master cylinder, vacuum
boost, wheel cylinders, calipers/disks, and brake lines, this system has a set of angular speed
sensors at each wheel, an electronic control module, and a hydraulic brake pressure
modulator (regulator). For simplicity in the drawing, only a pair of brake pressure modulators
are shown. However, in practice there is a separate modulator for each brake.
In order to understand the ABS operation, it is ﬁrst necessary to understand the physical
mechanism of wheel lock and vehicle skid that can occur during braking. The car is traveling
at a speed U and the wheels are rotating at an angular speed uw where
uw ¼ p RPMw
30
(46)
Figure 8.14:
Antilock braking system.
410
Chapter 8

and where RPMw is the RPM of the wheel in revolutions per minute. When the wheel is
rolling (no applied brakes),
U ¼ rwuw
(47)
where rw is the tire effective radius.
When the brake pedal is depressed, the pads are forced by hydraulic pressure against the disk,
as depicted schematically in Figure 8.15a. Figure 8.15b illustrates the forces applied to the
wheel by the road during braking. This pressure causes a force which acts as a torque Tb in
opposition to the wheel rotation. The actual force that decelerates the car is shown as Fb
in Figure 8.15b. The lateral force that maintains directional control of the car is shown as FL
in Figure 8.15b.
The wheel angular speed begins to decrease, causing a difference between the vehicle speed U
and the tire speed over the road (i.e. uwrw). In effect, the tire slips relative to the road surface.
The amount of slip s determines the braking force and lateral force. The slip, as a percentage
of car speed, is given by
s ¼ U  uwrw
U
Note: A rolling tire has slip s ¼ 0, and a fully locked tire has s ¼ 1.
The braking and lateral forces are proportional to the normal force (from the weight
of the car and from inertial forces due to deceleration) acting on the tire/road interface
(N in Figure 8.15b) and the friction coefﬁcients for braking force (Fb) and lateral
force (FL):
Fb ¼ Nmb
FL ¼ NmL
(48)
where mb is the braking friction coefﬁcient and mL is the lateral friction coefﬁcient.
These coefﬁcients depend markedly on slip, as shown qualitatively in Figure 8.16. The solid
curves are for a dry road and the dashed curves for a wet or icy road. As brake pedal force is
increased from zero, slip increases from zero. For increasing slip, mb increases to s ¼ so.
Further increase in slip actually decreases mb, thereby reducing braking effectiveness.
On the other hand, mL decreases steadily with increasing s such that for fully locked wheels
the lateral force has its lowest value. For wet or icy roads, mL at s ¼ 1 is so low that the lateral
force often is insufﬁcient to maintain directional control of the vehicle. However, directional
control can often be maintained even in poor braking conditions if slip is optimally
controlled. This is essentially the function of the ABS, which performs an operation
Vehicle-Motion Controls
411

Figure 8.15:
Brake conﬁguration and forces acting on wheel.
412
Chapter 8

equivalent to pumping the brakes (as done by experienced drivers before the development of
ABS). In ABS-equipped cars under marginal or poor braking conditions, the driver simply
applies a steady brake force and the system adjusts tire slip dynamically to achieve near
optimum value (on average) automatically.
In an exemplary ABS conﬁguration, control over slip is affected by regulating the brake line
pressure under electronic control. The conﬁguration for ABS is shown in Figure 8.14. This
ABS regulates or modulates brake pressure to maintain slip as near to optimum for as much
time as possible (e.g. at so in Figure 8.16). The operation of this ABS is based on estimating
the torque Tw applied to the wheel at the road surface by the braking force Fb:
Tw ¼ rwFb
(49)
The braking torque Tb is applied to the disk by the brake pads in response to brake pressure pb
and is a function of pb:
Tb ¼ fðpbÞ
(50)
Although it is not necessary for ABS application, it is convenient to simplify the model for Tb
to the following:
Tbykbpb
(51)
where kb is a constant for the given brakes.
Figure 8.16:
Exemplary variation in friction coefﬁcients with slip.
Vehicle-Motion Controls
413

The difference between these two torques acts to decelerate the wheel. In accordance with
basic Newtonian mechanics, the wheel torque Tw is related to braking torque and wheel
deceleration by the following equation:
Tw ¼ Tb þ Iw _uw
where Iw is the wheel moment of inertia about its rotational axis and _uw is the wheel
deceleration ðduw=dtÞ, that is, the rate of change of wheel speed.
During heavy braking under marginal conditions, sufﬁcient braking force is applied to cause
wheel lock-up (in the absence of ABS control). We assume such heavy braking for the
following discussion of the ABS. As brake pressure is applied, Tb increases and uw decreases,
causing slip to increase. The wheel torque is proportional to mb, which reaches a peak at slip
so. Consequently, the wheel torque reaches a maximum value (assuming sufﬁcient brake force
is applied) at this level of slip and decreases for s > so. For this region of slip, the slope of mb is
negative (i.e. dmb
ds < 0) and wheel deceleration is unstable causing uw / 0 resulting in wheel
lock condition. It is the function of the ABS to regulate Tb to maintain slip near optimum as
explained below.
Figure 8.17 is a sketch of wheel torque versus slip during ABS action illustrating the peak Tw.
After the peak wheel torque is sensed electronically, the electronic control system commands
that brake pressure be reduced (via the brake pressure modulator). This point is indicated in
Figure 8.17 as the limit point of slip for the ABS. As the brake pressure is reduced, slip is
reduced and the wheel torque again passes through a maximum.
Figure 8.17:
Wheel torque vs. slip under ABS action.
414
Chapter 8

The wheel torque reaches a value below the peak on the low slip side denoted lower limit
point of slip and at this point brake pressure is again increased. The system will continue to
cycle, maintaining slip near the optimal value as long as the brakes are applied and the
braking conditions lead to wheel lock-up.
The ABS control laws and algorithms are, naturally, proprietary for each manufacturer.
Rather than dealing with such proprietary issues here, an ABS control concept is presented
here based upon a paper by the author of this book and which has demonstrated successful
ABS operation in laboratory (wheel dynamometer) tests. This discussion can be considered
exemplary of much of the mechanical dynamics as well as control algorithms.
An ideal ABS control would maintain braking force/torque such that slip would remain at
exactly the optimum slip (i.e. so) for any given tire/road condition. However, a suboptimal
control system having very near optimal performance can be achieved by cycling brake
pressure such that slip cycles up and down about the optimum as depicted qualitatively in
Figure 8.17. The cycling should be such that the average of the time varying s and mb, mL are
very close to optimum.
The present exemplary ABS control is based upon the use of a so-called sliding mode
observer (SMO). The SMO is a robust state vector estimator that has the capability of
estimating very closely the state vector of a dynamic system (see Chapter 1 for the deﬁnition
of a state vector). The SMO for the present discussion estimates a single-dimensional state
vector, the differential torque applied to the wheel, (dTb), where
dTb ¼ Tb  Tw
¼ Iw _uw
(53)
Rewriting Eqn (53) yields a form from which the SMO can be readily derived:
_u ¼ dTb
Iw
(54)
The goal for the SMO for this application is to calculate an estimate ðd ^TbÞ of the differential
torque. It obtains d ^Tb by solving the following differential equation for the estimate ð^uwÞ of
wheel angular speed:
_^uw ¼ m sgnð^uw  uwÞ
(55)
Where m is the SMO gain that must satisfy the following inequality:
m  maxjdTbj
(56)
Vehicle-Motion Controls
415

The SMO requires an accurate, precise measurement of wheel angular speed (uw). The
desired estimate ðd ^TbÞ is the solution to the following ﬁrst-order differential equation:
s dd ^Tb
dt
þ d ^Tb ¼ m sgnð^uw  uwÞ
(57)
Effectively, d ^Tb is a ﬁrst-order low-pass-ﬁltered version of the right-hand side of the above
equation. The low-pass ﬁlter (LPF) bandwidth (i.e. 1/s) must be sufﬁciently large to
accommodate the relatively large ﬂuctuations in wheel angular speed. It is possible to use
a higher-order than ﬁrst-order low-pass ﬁlter. Experiments and simulations have been run
with 2nd-order LPF with good braking performance. The SMO generates a very close
estimate of dTb such that the control logic can detect that extremal values for the actual
differential torque have occurred by detecting extremal values of the SMO estimate ðd ^TbÞ.
This estimate is the input to the control algorithm for regulating brake pressure.
The actual control algorithm for applying or releasing brakes is based upon the estimate of
dTb. Whenever the slip passes the optimal value (so), either increasing or decreasing the d ^Tb
has an extremal value. One control scheme incorporates an extremal value detector applied to
d ^Tb. Whenever an extremum is detected with brakes applied, this indicates s has crossed so
while increasing. Upon detection of this extremum, the control generates a command signal
to release brake pressure (using a mechanism described below). Conversely, whenever an
extremal value of d ^Tb is detected with brakes not being applied (or at reduced brake pressure),
this indicates that s has crossed so while decreasing. Upon detecting this condition, the control
system generates a signal that causes brake pressure to be reapplied.
During ABS operation, the control logic essentially detects that slip has increased beyond so,
and at some point between so and the upper limit point of slip for ABS (as shown in
Figure 8.17), this logic detects an impending wheel lock condition and generates control
signals that cause brake pressure to rapidly decrease. With brake pressure reduced, the wheel
tends toward a rolling condition and slip decreases as depicted in Figure 8.17. As the slip
crosses so while decreasing, mb increases to its maximum value at so and then decreases. The
corresponding dTb has an extremum as s crosses so. The SMO detects the extremal value of
d ^Tb, thereby creating a logic condition that brakes are to be re-applied.
In an actual ABS, the brakes are individually controlled at each wheel. Separate control of
each wheel is required because during braking, the inertial forces can result in different
normal force (N) at each wheel. In addition, the friction coefﬁcient may well be different for
each tire/road interface.
There are two major beneﬁts to ABS. One of these is achieving optimal friction coefﬁcient at
each wheel. The other is to maintain sufﬁcient lateral friction coefﬁcient (mL) for good
directional control of the vehicle during stopping.
416
Chapter 8

The mechanism for modulating brake pressure is illustrated in Figure 8.18.
In Figure 8.18 the notation is as follows:
During braking with ABS control, the driver is assumed to apply brake pressure to the line
connecting MC and WC. The driver is assumed to maintain a relatively high pressure.
Although Figure 8.18 depicts ABS for a single wheel, it is assumed that a separate set of
valves are supplied for each of the four wheel cylinders.
Each of the valves depicted in Figure 8.18 are two-position solenoid-operated valves, each
having two separate functions. The blocking valve in the inactive position for V1 ¼ 0 passes
brake ﬂuid under pressure from its input line to its output line. Under normal (non-ABS)
braking, the dump valve (V2 ¼ 0) passes this ﬂuid from its input to its output line which leads
electronic
control
S
wheel
cylinder
WC
K
BP
MC
BV
V1
V2
V3
DV
RV
P
A
Figure 8.18:
Schematic illustration of ABS.
BP
Brake pedal
MC
Master cylinder
K
Brake ﬂuid reservoir
BV
Blocking valve
DV
Pressure dump valve
RV
Repressurization valve
P
Pump
A
Accumulator
S
Wheel speed sensor
WC
Wheel cylinder
V1,V2,V3
Actuator control
signals.
Vehicle-Motion Controls
417

to the repressurization valve. This latter valve passes the pressurized brake ﬂuid to the wheel
cylinder which thereby applies brake torque to the corresponding wheel.
Whenever the ABS control detects a potential wheel lock-up owing to slip s > so (due to
the negative dmb/ds), it generates nonzero control signals V1, V2, and V3 in a precise
sequence. In the exemplary ABS, potential wheel lock is detected by an extremum in d ^Tb
with brakes applied. The control sends a voltage V1 to BV which causes it to switch to
a brake pressure-blocked position. In this position the master cylinder is isolated from the
wheel cylinder by the BV. Only the input line to BV is under driver-applied brake
pressure. A few milliseconds after the BV is activated, the control generates a voltage V2
that activates the DV which switches it to its second position. In this position the line to
the RV and wheel cylinder are connected to the reservoir and the WC pressure drops
rapidly toward 0.
During all times a pump (P) maintains a supply of brake ﬂuid under pressure in accumulator
A. In its deactivated state (i.e. V3 ¼ 0), the RV isolates the accumulator from the line leading
to the WC and provides a stop in the A output line. This A pressure is the pressure that is used
to repressure the WC at the appropriate time. This appropriate time is the time at which the
control system detects an extremum in d ^Tb for brakes “off” (or low Tb). When the controller
detects this condition, it initially sets control voltage V2 ¼ 0, thereby deactivating DV. A few
milliseconds after V2 is set to zero, the controller generates voltage V3 that activates the
repressurization valve. When activated, the RV connects the Awith its pressurized brake ﬂuid
to the WC. It simultaneously applies the pressure to the output line of the DV which also
pressurizes the BVoutput line. The pressurized WC applies the force required to apply brake
torque Tb to the wheel.
Assuming that a low mb condition is maintained, the process of increasing slip with s passing
so and a new extremal valve in d ^Tb is detected. The entire process of pressure dump followed
by represurization is repeated. The cycling of the ABS normally continues until the wheel
speed with brakes “off” is below a pre-set value (e.g. 1e5 MPH) or until the driver releases
the brake pedals.
Figure 8.19 illustrates the braking during an ABS action in simulation of an experimental
system. In this illustration, the vehicle is initially traveling at 55 mph and the brakes are
applied as indicated by decreasing speed of Figure 8.19a. The solid curve of Figure 8.19a
depicts vehicle speed over the ground and the dashed curve the instantaneous wheel
speed (rwuw). The wheel speed begins to drop until the control detects incipient
wheel lock (e.g. for an extremum of d ^Tb). At this point, the ABS reduces brake pressure
and the wheel speed increases until the control reaches the condition to reapply brake
pressure. With the high applied brake pressure, the wheels again tend toward lock-up
and ABS reduces brake pressure. The cycle continues until the vehicle is slowed
sufﬁciently.
418
Chapter 8

Figure 8.19b depicts the instantaneous friction coefﬁcient mb(t). It can be seen that the ABS
action of releasing and then reapplying brake pressure causes this mb to cycle back and forth
about its peak value (mb(so)). Similar results to those of Figure 8.19 were achieved in
laboratory tests with suitable instrumentation.
It should be noted that by maintaining slip near so, the maximum deceleration is achieved for
a given set of conditions. Some reduction in lateral force occurs from its maximum value by
maintaining slip near so. However, in most cases the lateral force is large enough to maintain
directional control, thereby permitting the driver to steer the vehicle.
In some antilock brake systems, the mean value of the slip oscillations is shifted below so,
sacriﬁcing some braking effectiveness to enhance directional control. This can be
accomplished by adjusting the upper and lower slip limits.
Figure 8.19:
Illustration of ABS action.
Vehicle-Motion Controls
419

Tire-Slip Controller
Another beneﬁt of the ABS is that the brake pressure modulator can be used for ACC as
explained earlier as well as for tire-slip control. Tire slip is effective in moving the car
forward just as it is in braking. Under normal driving circumstances with powertrain torque
applied to the drive wheels, the slip that was deﬁned previously for braking is negative. That
is, the tire is actually moving at a speed that is greater than for a purely rolling tire (i.e.
rwuw > U). In fact, the traction force is proportional to slip.
For wet or icy roads, the friction coefﬁcient can become very low and excessive slip can
develop. In extreme cases, one of the driving wheels may be on ice or in snow while the other
is on a dry (or drier) surface. Because of the action of the differential (see Chapter 7 and
Figure 7.26), the low-friction tire will spin and relatively little torque will be applied to the
dry-wheel side. In such circumstances, it may be difﬁcult for the driver to move the car even
though one wheel is on a relatively good friction surface.
The difﬁculty can be overcome by applying a braking force to the free spinning wheel. In this
case, the differential action is such that torque is applied to the relatively dry-wheel surface
and the car can be moved. In the example ABS, such braking force can be applied to the free
spinning wheel by the hydraulic brake pressure modulator (assuming a separate modulator for
each drive wheel). Control of this modulator is based on measurements of the speed of the two
drive wheels. Of course, the ABS already incorporates wheel speed measurements, as
discussed previously. The ABS electronics have the capability of performing comparisons of
these two wheel speeds and of determining that braking is required of one drive wheel to
prevent wheel spin.
Antilock braking can also be achieved with electrohydraulic brakes. An electrohydraulic
brake system was described in the section of this chapter devoted to advanced cruise control
(ACC).
Recall that for ACC a motor-driven pump supplied brake ﬂuid through a solenoid-
operated “brakes” apply valve to the wheel cylinder. For ACC application of the brakes,
the apply and isolation valves operate separately to regulate the braking to each of the
four wheels.
Electronic Suspension System
An automotive suspension system consists of springs, shock absorbers, and various linkages
to connect the wheel assembly to the car body. The purpose of the suspension system is to
isolate the car body motion as much as possible from wheel vertical motion due to rough road
input. Figure 8.20 depicts, schematically, the suspension system for the front wheels of a front
wheel drive car. In essence a suspension system is a mass, spring, damping assembly that
420
Chapter 8

connects the car body (whose mass is called the “sprung” mass to the wheel/axle, brake and
other linkages connected to them, which are called the “unsprung” mass).
The two primary subjective performance measures from a driver/passenger standpoint are
ride and handling. Ride refers to the motion of the car body in response to road bumps or
irregularities. Handling refers to how well the car body responds to dynamic vehicle motion
such as cornering or hard braking.
Damping in the suspension system is provided by the shock absorber portion of the strut
assemble. Viscous damping is provided by ﬂuid motion through oriﬁces in a piston portion of
the strut. The structure and details of a strut are given later in this chapter, but the interested
reader can look ahead to Figure 8.23. For the present, attention is focused on the inﬂuence of
strut damping on ride and handling. Generally speaking, ride is improved by lowering the
shock absorber damping, whereas handling is improved by increasing this damping. In
traditional suspension design, the damping parameter is ﬁxed and is chosen to achieve
a compromise between ride and handling (i.e. an intermediate value for shock absorber
damping is chosen).
Figure 8.20:
Illustration of front suspension system.
Vehicle-Motion Controls
421

In electronically controlled suspension systems, this damping can be varied depending on
driving conditions and road roughness characteristics. That is, the suspension system adapts
to inputs to maintain the best possible ride, subject to handling constraints that are associated
with safety.
There are two major classes of electronic suspension control systems: active and semi-active.
The semi-active suspension system is purely dissipative (i.e. power is absorbed by the shock
absorber under control of a microcontroller). In this system, the shock absorber damping is
regulated to absorb the power of the wheel motion in accordance with the driving conditions.
In an active suspension system, power is added to the suspension system via a hydraulic or
pneumatic power source. At the time of the writing of this book, electronic control of
commercial suspension systems is primarily semi-active. In this chapter, we explain the semi-
active system ﬁrst, then the active one.
The primary purpose of the semi-active suspension system is to provide a good ride for as
much of the time as possible without sacriﬁcing handling. Good ride is achieved if the car’s
body is isolated as much as possible from the road surface variations. The vertical input to the
unsprung mass motion is the road surface proﬁle. For a car traveling at a steady speed, this
input is a random process. Depending upon the nature of the road surface (i.e. newly paved
road vs. ungraded gravel dirt road), this random process may either be a stationary or
a nonstationary process. For the following discussion we assume a stationary random process.
A semi-active suspension controls the shock absorber damping to achieve the best possible
ride without sacriﬁcing handling performance.
In addition to providing isolation of the sprung mass (i.e. car body and contents), the
suspension system has another major function. It must also dynamically maintain the tire
normal force as the unsprung mass (wheel assembly) travels up and down due to road
roughness. Recall from the discussion of antilock braking that braking and lateral forces
depend on normal tire force. Of course, in the long-term time average, the normal forces will
total the vehicle weight plus any inertial forces due to acceleration, deceleration, or cornering.
However, as the car travels over the road, the unsprung mass moves up and down in response
to road input. This motion causes a variation in normal force, with a corresponding variation
in potential cornering or braking forces. For example, while driving on a rough curved road,
there is a potential loss of steering or braking effectiveness if the suspension system does not
have good damping characteristics. We consider next certain aspects of vehicle dynamics to
understand the role played by electronically controlled suspension.
The geometry for describing the vehicle motion relative to the suspension is depicted in
Figure 8.21a and b. In this ﬁgure, three major axes are deﬁned for the vehicle: 1) longitudinal;
2) lateral and 3) vertical. The ECEF inertial coordinate system axes are denoted (x0,y0,z0). The
vehicle body axes are denoted (x,y,z).
422
Chapter 8

The longitudinal axis is a line in the plane of symmetry through the center of gravity (CG) parallel
to a ground reference plane. The ground plane is the plane through the wheel axles when the
vehicleissittingonanexactlyhorizontalplane.Inthisconﬁguration,thedeﬂectionofthefrontand
rear springs due tovehicleweight depends upon thelocation of the CG alongthe longitudinal axis.
Figure 8.21 is a side view of the vehicle depicting the body longitudinal axis x (ﬁxed to the
vehicle). This ﬁgure also depicts the x axis for the vehicle at rest with the x0 axis which
constitutes an inertial (e.g., ECEF) reference. In this ﬁgure, the x axis is deﬂected by a “pitch
angle” ap relative to the x0 axis. The vertical displacement of the CG is denoted dzcg in the
ﬁgure and is called heave. The front and rear springs are assumed to be identical right and left.
The front suspension spring rate is denoted KF and the rear KR. Viscous damping is also
assumed to be symmetrical right and left and has linear damping coefﬁcients DF and DR for
front and rear respectively (in the present, simpliﬁed model).
Figure 8.21b depicts the vehicle in a front view for which the body lateral axis (y) is shown in
the rest position by the dashed line y0 and in the deﬂected position by the solid line. The angle
fR is the “roll” angle about the longitudinal axis. The z axis is orthogonal to the x,y plane
through the CG. The y0 and z0 axis are part of the inertial reference for the following
discussion on vehicle dynamic motion.
side view
front view
lateral
axis
longitudinal
axis
(a)
(b)
z′
x′
x
z
δzcg
δzcg
DF
KR
DR
KR
DR
KL
DL
NR
Nr
NF
Nl
b
y′
W
y
hCG
CG
αp
a
φR
KF
+
Figure 8.21:
Schematic illustration of suspension.
Vehicle-Motion Controls
423

It is beyond the scope of this book to present a full discussion of vehicle dynamics which
involves sets of coupled nonlinear differential equation models. Rather, the goal here is to
focus on electronic control of the suspension and to illustrate the corresponding aspect of
vehicle dynamics for a few representative maneuvers. For this purpose a set of simpliﬁed
linear dynamic models are presented. In such simpliﬁed models there are many forces acting
on the vehicle sprung mass including: drivetrain and braking torques/forces, inertial forces,
and the normal forces coupled from the unsprung mass acting on the tires to the sprung mass.
The normal forces acting on the tires are different for all four wheels whenever the vehicle is
maneuvering. These forces include components due to the vehicle weight as well as reaction
forces to inertial forces due to vehicle dynamics. These four forces have the following
notations:
NFr
Front right
NF[
Front left
NRr
Rear right
NR[
Rear left
We begin with a relatively simple example vehicle maneuver consisting of braking on
a straight and level road. The front and rear forces acting on the car from the tires are denoted
FF and FR respectively. These forces are positive for acceleration and negative for braking,
which is assumed here, and are given by
FF ¼ ðNFr þ NF[ÞmF
FR ¼ ðNRr þ NR[ÞmR
(58)
where mF is the friction coefﬁcient for front tires and mR is the friction coefﬁcient for rear tires.
The combination of these braking forces produces a moment about the CG Tb given by
Tb ¼ ðFF þ FRÞhCG
(59)
Countering this moment is a moment (Tn) about the CG due to the tire normal forces given by
Tn ¼ NFa  NRb
where
NF ¼ NFr þ NFr
NR ¼ NRr þ NR[
(60)
and where a and b are the distances along the longitudinal axis of the vehicle from the CG to
the front and rear axles respectively (i.e. see Figure 8.21a).
424
Chapter 8

The normal forces acting on the tires are transmitted through the tires to the spring/damper
system of the suspension. For the present, the tire dynamics are neglected although they are
included in a later example. The forces NF and NR produce a deﬂection in the suspension
springs from the unloaded positions such that NF and NR are given by:
NF ¼ 

KFdzF þ DFd_zF

NR ¼ 

KRdzR þ DRd_zR

(61)
where dzF is the deﬂection of front spring and dzR the deﬂection of rear spring.
KR ¼ KRr þ KR[ ¼ rear spring rate
KF ¼ KFr þ KF[ ¼ front spring rate
DF ¼ DFr þ DF[ ¼ front damping coefficient
DR ¼ RRr þ DR[ ¼ rear damping coefficient
(62)
Note that in the absence of any vertical motion of the CG (i.e. it is assumed here that d€zg ¼ 0),
the normal forces sum to the vehicle weight (WV):
NF þ NR ¼ WV
(63)
Furthermore, it is reasonable to assume that front and rear tires have identical friction
coefﬁcient
mR ¼ mF
The total force acting on the vehicle due to braking is given by
F ¼ FF þ FR
¼ mWV
The moment acting around the CG due braking (Tb) is given by
Tb ¼ WVmhCG
The sum of the moments of all forces acting on the sprung mass results in an angular
acceleration of the pitch angle ð€apÞ about the lateral (y) axis, yielding the following
model:
Iyy€ap ¼ mWVhCG þ Tn
(64)
Vehicle-Motion Controls
425

where
Iyy ¼ moment of inertia of the sprung mass about the lateral axis through the CG:
Tn ¼ aNF  bNR
For sufﬁciently small pitch-angle changes the front and rear displacement and vertical
velocity are given by:
dzF ¼ aap
ðfront displacementÞ
dzR ¼ bap
ðrear displacementÞ
d_zF ¼ a _ap
ðfront vertical velocityÞ
d_zR ¼ b _ap
ðrear vertical velocityÞ
(65)
Substituting these relationships into the pitch dynamic Eqn (64) yields
Iyy€ap ¼ ðFF þ FRÞhCG 
	
aðKFaap þ DFa _apÞ þ bðKRbap þ DRb _apÞ

(66)
Simplifying and rearranging terms in this equation yield the following second-order
differential equation in ap:
Iyy€ap þ D _ap þ Kap ¼ FhCG
(67)
where
D ¼ a2DF þ b2DR
K ¼ a2KF þ b2KR
The operational transfer function (Ha(s)) relating braking force to pitch angle is given by
HaðsÞ ¼ apðsÞ
FðsÞ
¼
hCG
Iyys2 þ Ds þ K ¼ hCG
Iyy

1
s2 þ 2zuns þ u2n

(68)
where
FðsÞ ¼ FFðsÞ þ FRðsÞ
426
Chapter 8

and
un ¼
ﬃﬃﬃﬃﬃﬃ
K
Iyy
s
z ¼ D=ð2IyyunÞ ¼ damping ratio
Solution to this equation for the pitch dynamics due to an arbitrary braking force function
F(t) is found using the methods of Chapter 1 or for any given vehicle via simulation. For
example, the pitch-angle response to a step of amplitude change in braking force of
magnitude Fo increases from ap ¼ 0 with _ap ¼ 0 rising toward an asymptotic value
(apss) of
apss ¼ hCGF0
K
(69)
Depending on the damping ratio z, there may be overshoot in ap before settling to apss where,
with the sign convention of Figure 8.21a, apss < 0.
In addition to the operational transfer function, the pitch dynamics due to braking are given by
the sinusoidal frequency response Ha(ju), which is given by
HaðjuÞ ¼
hCG=Iyy
ðu2n  u2Þ þ 2jzunu
(70)
The peak response occurs at u ¼ un and has magnitude
jHaðjunÞj ¼ hCG
2zK
(71)
and a 90 phase shift from F(ju) to ap(ju). The importance of damping in determining the
resonant response of pitch dynamics is clear from this frequency response.
Recall from the discussion of ABS that the braking force during periods in which ABS is
active is time varying and is often essentially periodic. The pitch dynamic response to ABS
cycling is potentially a concern in ride dynamics, although the excitation frequency is
normally far from pitch dynamic resonance. Nevertheless, electronically damping, as
discussed later, could potentially improve ride quality.
The pitch dynamic sinusoidal frequency response (although greatly simpliﬁed) has been
developed and shown to be determined by suspension spring rate and damping. A similar
Vehicle-Motion Controls
427

set of equations describe the vertical displacement (i.e. heave) dynamics. A similar
sinusoidal frequency response can be derived for heave. However, this discussion is
deferred to a later section in which the vertical dynamic models include wheel and tire
dynamics. Later in this chapter a model is developed with these dynamics included. For the
moment, we consider these dynamics and the associated frequency response qualitatively
for an exemplary vehicle.
Figure 8.22 illustrates qualitatively a representative tire normal force variation as a function
of frequency of excitation for a ﬁxed-amplitude, variable-frequency sinusoidal excitation (see
Chapter 1 for a discussion of sinusoidal frequency response) for an actual vehicle. The solid
curve is the response for a relatively low-damping-coefﬁcient shock absorber and the dashed
curve is the response for a relatively high damping coefﬁcient.
The ordinate of the plot in Figure 8.22 is the ratio of amplitude of force variation to the
average normal load (i.e. due to weight). There are two relative peaks in this response. The
lower peak is approximately 1e2 Hz and is generally associated with spring/sprung mass
oscillation. The second peak, which is in the general region of 12e15 Hz, is resonance of the
spring/unsprung mass combination.
Generally speaking, for any given ﬁxed suspension system, ride and handling cannot both
be optimized simultaneously. A car with a good ride is one in which the sprung mass
motion/acceleration due to rough road input is minimized. In particular, the sprung mass
motion in the frequency region from about 2 to 8 Hz has often been found to be the most
Figure 8.22:
Normal force variation due to sinusoidal excitation vs. frequency.
428
Chapter 8

important for good subjective ride. Good ride is achieved for relatively low damping (low
D in Figure 8.22).
For low damping, the unsprung mass moves relatively freely due to road input while
the sprung mass motion remains relatively low. Note from Figure 8.22 that this low
damping results in relatively high variation in normal force, particularly near the
two peak frequencies. That is, low damping results in relatively poor handling
characteristics.
With respect to the four frequency regions of Figure 8.22, the following generally desired
suspension damping characteristics can be identiﬁed:
Another major input to the vehicle that affects handling is steering input that causes
maneuvers out of the ECEF inertial reference vertical plane (e.g. cornering). Whenever the
car is executing such maneuvers, there is a lateral acceleration. This acceleration acting
through the center of gravity causes the vehicle to roll in a direction opposite to the
maneuver.
Another relatively simple example of vehicle dynamics involves the vehicle encountering
a curve in a level road. For convenience assume that the car is traveling a straight road for t < 0
and then encounters the curve at t ¼ 0. This example illustrates the inﬂuence of such
a maneuver on roll dynamics (i.e. fRðtÞ). For this example it is necessary to include thevariable
j (which was introduced earlier in the chapter and is called yaw) in the dynamic model. It is the
change in direction of the vehicle longitudinal axis relative to its direction on the straight level
road. Because the road for t < 0 is straight, the initial direction forms the ECEF inertial
reference frame for this example. The notation for the time rate of change of j is r:
r ¼ _j
(72)
Similarly, the notation for _fR is taken to be p:
p ¼ _fR
(73)
The lateral velocity component of the CG is denoted v:
v ¼ _y
(74)
Region
Frequency (Hz)
Damping
1: Sprung mass mode
1e2
High
2: Intermediate ride
2e8
Low
3: Unsprung mass resonance
8e20
High
4: Harshness
>20
Low
Vehicle-Motion Controls
429

The inertial forces due to the motion of the car along the curve create a rolling moment TR
about the CG given by
TR ¼ MhCGð_v þ ru0Þ
(75)
where uo is the vehicle speed (assumed constant) and M the vehicle mass.
The sum of the moments about the CG for this maneuver yields the following approximate
differential equation:
Ixx€f þ MhCGð_n þ ru0Þ ¼ ðLffR þ LppÞ
(76)
where Ixx is the moment of inertia of the sprung mass structure about the body longitudinal
axis
Lf¼ðKF þ KRÞw2
Lp ¼ ðDF þ DRÞw2
(77)
where w is the distance between right and left tire planes of symmetry (Figure 8.21a).
In this equation, a term proportional to the cross product of inertia Ixz _r has been
neglected without serious loss of generality as it is usually small except for relatively
high _r. The above equation can be rewritten in terms of the inertial (rolling) moment
(TR) in the form
Ixx€fR þ Lp _fR þ Lff ¼ TR
(78)
where
TR ¼ Mhcgð_v þ ruoÞ
If the curve is a segment of a constant radius circle, then during the constant turn maneuver
the moment T can be given as
TRðtÞ ¼ 0
t < 0
¼ T0
t  0
(79)
It can be shown that for a vehicle traveling along a curve of constant radius R at a constant
speed uo, T0 is given by
T0 ¼ MhCG u2
o=R
430
Chapter 8

The operational transfer function for the roll dynamics HfðsÞ is given by
HfðsÞ ¼ fRðsÞ
TRðsÞ
¼
1
Ixx

s2 þ sLp
Ixx
þ Lf
Ixx

(80)
The dynamic response fRðtÞ in roll to a step encounter with the curve at t ¼ 0 has the same
qualitative shape as that found for the pitch response to a step of applied brakes. The roll
damping coefﬁcient Lp which is proportional to the strut damping coefﬁcient has the same
inﬂuence on fRðtÞ as it does on ap(t). The steady-state roll angle ðfRSSÞ after the transient
response has decayed is given by
fRSS ¼ T0
Lf
(81)
That is, the suspension spring rate determines the roll for a given steady turn rate. For
passenger cars under normal driving conditions, the sinusoidal frequency response in roll is
typically of less interest than for pitch or heave dynamics. A sinusoidal roll moment input
might come, for example, from an oscillatory steering wheel input. This is not encountered in
normal passenger car operation.
Car handling generally improves if the amount of roll for any given maneuver is reduced. The
rolling rate for a given car and maneuver is improved if spring rate and shock absorber
damping are increased.
In Chapter 1, we discussed the dynamics of a spring/mass/damping system, identifying
resonant frequency and unity damping Dc (i.e. z ¼ 1):
Dc ¼ 2
ﬃﬃﬃﬃﬃﬃﬃﬃ
KM
p
For good ride, the damping should be as low as possible. However, from practical design
considerations, the minimum damping is generally in the region of 0.1 < D/Dc < 0.2. For
optimum handling, the damping is in the region of 0.6 < D/Dc < 0.8.
Technology has been developed permitting the damping characteristics of shock absorber/
strut assembly to be varied electrically, which in turn permits the ride/handling characteristics
to be varied while the car is in motion. For an understanding of the operation of electronic
suspension control, it is helpful to review the operation of a strut (shock absorber) with
reference to Figure 8.23. Physically, this strut consists of a closed cylinder with a movable
Vehicle-Motion Controls
431

piston. Opposite ends of this strut are attached to the vehicle body (sprung mass) and the
wheel axle assembly (unsprung mass). The strut is ﬁlled with oil which can pass through
relatively small apertures in the piston, thereby allowing relative motion between the
attachment points. The strut provides viscous damping force whenever the piston is moving in
the cylinder that is an increasing function of the relative piston/cylinder velocity, the size of
the apertures, and the ﬂuid viscosity. Although the forceevelocity relationship is nonlinear, in
the following analysis this relationship was modeled as approximately linear.
Under normal steady-cruise conditions, damping is electrically set low (e.g. with relatively
large aperture) yielding a good ride. However, under dynamic maneuvering conditions (e.g.
cornering), the damping is set high (relatively small aperture) to yield good handling.
Generally speaking, as shown in the above, simpliﬁed example, high damping reduces vehicle
roll in response to cornering or turning maneuvers, and it tends to maintain tire force on the
road for increased cornering forces. Variable damping suspension systems can improve
safety, particularly for vehicles with a relatively high center of gravity (e.g. SUVs). Before
proceeding with a discussion of electronically controlled strut damping, it is necessary to
include tire dynamics in our vehicle dynamic model.
The tire dynamics in the vehicle dynamic models can be introduced adequately for the
purposes of reviewing electronically controlled suspension by considering a single strut
conﬁguration. This conﬁguration and the model being developed apply to all four suspension
assemblies. The model is often called “the quarter car model” (QCM). It is in effect a unicycle
model. The conﬁguration to be considered for this QCM is depicted in Figure 8.24.
Figure 8.23:
Strut physical conﬁguration.
432
Chapter 8

In this ﬁgure, the following notation is used:
y0 ¼ road height above a horizontal inertial reference (e.g. ECEF)
y1 ¼ height of unsprung mass above datum
y2 ¼ height of sprung mass above datum
Ms ¼ sprung mass
Mu ¼ unsprung mass
Ks ¼ strut spring rate
Ds ¼ strut damping coefﬁcient
Kt ¼ tire spring rate
Dt ¼ tire damping coefﬁcient
Typically, tire damping is very small in comparison with strut damping so it is assumed to be
negligible here.
A pair of differential equations can be written separately by summing forces acting on the
sprung mass and on the unsprung mass. For the unsprung and sprung mass, respectively, the
dynamic models are given by
Mu€y1 þ Dsð_y1  _y2Þ þ Ktðy1  y0Þ þ Ksðy1  y2Þ ¼ 0
(82)
Ms€y2 þ Dsð_y2  _y1Þ þ Ksðy2  y1Þ ¼ 0
(83)
y2
y1
y0
Dt
Kt
Mu
Ds
Ks
Ms
road surface
ECEF datum
Figure 8.24:
QCM car suspension conﬁguration.
Vehicle-Motion Controls
433

Solution of Eqn (84) can be found in two ways. The ﬁrst way we consider leads to a closed-
form analytical solution. Alternatively, the solution method that is best suited for numerical
evaluation is to write the above equations in terms of a set of four state variable equations with
state vector x given by
x ¼ ½v1; v2; y1; y2T
where
v1 ¼ _y1
v2 ¼ _y2
Taking the Laplace transform of Eqns (82) and (83) (with zero initial conditions) yields a pair
of coupled algebraic equations in complex frequency s:
	
Mus2 þ Dss þ ðKt þ KsÞ

y1ðsÞ  ðDss þ KsÞy2 ¼ Kty0ðsÞ
(84)
ðMss2 þ Dss þ KsÞy2ðsÞ  ðDss þ KsÞy1ðsÞ ¼ 0:
In matrix form, this pair of equations can be written in the form
A

y1
y2

¼ Kt

y0
0

(85)
where
A ¼

Mus2 þ Dss þ ðKs þ KtÞ
ðDss þ KsÞ
ðDss þ KsÞ
Mss2 þ Dss þ Ks

(86)
The two-dimensional state vector [y1, y2]T is found using matrix methods yielding

y1
y2

¼ KtA1

y0
0

(87)
The 2  2 matrix A is readily inverted using standard methods from matrix algebra yielding
an analytical solution for y1 or y2. The time response for an arbitrary yo(t) can be found
using the inverse Laplace methods of Chapter 1. However, for evaluating ride and
handling, the frequency response characteristics are the most meaningful quantitative
representation.
434
Chapter 8

Our primary interest here is in ﬁnding the sprung mass motion since this directly affects
“ride” quality. Ride is best characterized by the sprung mass acceleration (as) for any given
road proﬁle yo(x) where
as ¼ €y2
(88)
The operational transfer function relating as(s) to y0(s) can be shown to be given by
HaðsÞ ¼ asðsÞ
yoðsÞ
¼ s2y2ðsÞ
yoðsÞ
¼
2zu2
1u2s3 þ u2
1u2
2s2
s4 þ 2mzu2s3 þ ðu2
1 þ mu2
2Þs2 þ 2zu2
1u2s þ u2
1u2
2
(89)
where
u2
1 ¼ Kt
Mu
u2
2 ¼ Ks
Ms
m ¼ Ms þ Mu
Mu
z ¼
Ds
2
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
MsKs
p
Handling is strongly inﬂuenced by the variation in tire normal force dN. This normal force is
proportional to the relative displacement d ¼ y0  y1:
dN ¼ Ktd
The transfer function HH(s) is deﬁned as
HHðsÞ ¼ dðsÞ
y0ðsÞ
¼ 1  y1ðSÞ
y0ðSÞ
(90)
Vehicle-Motion Controls
435

The solution for y1(s) from the matrix equation yields the following:
HHðsÞ ¼
s4 þ 2mzu2s3 þ mu2
2s2
s4 þ 2mzu2s3 þ ðu2
1 þ mu2
2Þs2 þ 2zu2
1u2s þ u2
1u2
2
(91)
As an illustration of the variation in relative displacement d vs. road displacement yo vs.
frequency, a plot of the sinusoidal frequency response for HH(ju) is given in Figure 8.25.
For this ﬁgure, a representative QCM was used with the following parameters in English
units:
Kt ¼ 1700 lb/ft
Ks ¼ 8000 lb/ft
Mu ¼ 2.34 slugs
Ms ¼ 100 slugs
z ¼ 0.8
Figure 8.25:
Frequency response for HH(s).
436
Chapter 8

Figure 8.25 presents the magnitude of this frequency response (in dB) as 20 log jHH(ju)j and
the phase of HH(ju) vs. log(u). It can be seen that this QCM has a relatively sharp resonance
at uy7 rad=s rad/s or about 1.1 Hz. This resonance is primarily due to the dynamic response
of the unsprung mass.
In evaluating the inﬂuence of suspension system parameters on ride and handling, the road
proﬁle must be modeled. It is widely known that the road proﬁle is a random process. A
random process is quantitatively represented by its amplitude and spectral statistics. The
amplitude statistics are given by its probability distribution function Py(Y) ¼ p(y  Y). Its
spectral statistics are represented by the power spectral density for yo which is denoted Wo(f)
and is given by
Wo ¼ jYoðjuÞj2
(92)
where
YoðjuÞ ¼ Lim
T/N
ZT
T
yoðtÞejutdt
(93)
However, road proﬁles are functions of distance along the road surface (i.e. yo(x)). This road
proﬁle random process can be converted to a time function by considering motion at
a constant speed uo where
u0 ¼ dx
dt
The time function yo(t) is given by
yoðtÞ ¼ yo
 x
uo

The International Standards Organization (ISO) has established a standard model for Wo(f),
which is roughly an inverse function of frequency f.
Ride is best characterized quantitatively by the RMS (root-mean-squared) value of the sprung
mass acceleration ~as:
~as ¼
2
4 Lim
T/N
0
@1
T
ZT
0
a2
sðtÞdt
1
A
3
5
1
2
Vehicle-Motion Controls
437

This RMS value can also be found from the power spectral density (Wa(f)) for as. Assuming
that the road proﬁle is a stationary random process (or a quasi-stationary process, i.e.
stationary over large segments), the RMS value for as is given by
~a2
s ¼
ZN
0
WaðfÞdf
For a stationary random process, the power spectral density Wa(f) is given by
WaðfÞ ¼ jHaðj2pfÞj2Wo

f

(94)
Thus, the ride quality can be represented by the integral
~as ¼
2
4
ZN
0
jHaðj2pfÞj2WoðfÞdf
3
5
1
2
(95)
The above equation for ~as illustrates the signiﬁcance of the sinusoidal frequency response of
the sprung mass to road excitation. The important suspension parameters in Ha(ju) are the
sprung and unsprung mass as well as their ratio
Ms
Mu

, the strut and tire spring rates, as well
as the strut damping parameters.
Similarly, handling is quantitatively represented by the RMS value of tire deﬂection (d). The
RMS value of d (i.e. ~d) is given by
~d ¼
2
4
ZN
0
jHHðj2pfÞjWoðfÞdf
3
5
1
2
(96)
Clearly, both ride and handling are inﬂuenced by suspension parameters as well as Ms and Mu.
Considerable research and development has gone into determining optimum strut damping
over the years. Table 8.1 is a summary of some of the results of those studies vs. running
condition, control objective, optimum condition, as well as optimum z and representative
compact car value.
The beneﬁts of variable strut damping in terms of improved ride and or handling have been
demonstrated. We consider next actuator schemes for varying this damping. The damping of
a suspension system is determined by the viscosity of the ﬂuid in the shock absorber/strut and
438
Chapter 8

Table 8.1: Summary of Optimum Suspension System Parameters
Running
Condition
Control Objective
Optimum Condition
Optimum Damping Ratio
Theoretical Value z
For Compact
Car
Ordinary driving
Ride improvement
To minimize sprung
overall acceleration
D2
2
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
MsKs
p
¼ 1
2
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
mðKs=KtÞ
m  1
s
0.16
Roll
Roll reduction when
turning
To suppress dynamic
roll angle to a
level below static
roll angle
ðLf=IxxÞD
4
ﬃﬃﬃﬃﬃﬃﬃﬃ
KIxx
p
¼ 1ﬃﬃﬃ
2
p
0.71
Pitch
Pitch reduction when
accelerating,
decelerating and
braking
To suppress dynamic pitch
angle to a level below
static pitch angle
a2DF þ b2DR
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
2Iyyða2KF þ b2KRÞ
q
¼ 1ﬃﬃﬃ
2
p
0.71
Bouncing
Reduction of bouncy
feeling and ride
improvement
To suppress light bouncy
vibrations within a range
where ride quality does
not deteriorate
Ds
2
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
MsKs
p
¼
ﬃﬃﬃ
2
p
m þ 1
m
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
mðKs=KtÞ
m  1
s
0.43
Tough road
Road holdability
improvement
To minimize the
root-mean-square value
of unsprung relative
displacement
Ds
2
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
MsKs
p
¼ 1
2
"
m3r2
K  2mðm  1ÞrK þ ðm  1Þ2
m2ðm  1Þrk
#1=2
0.44
where rK ¼ Ks/Kt,
D ¼ DF þ DR
Vehicle-Motion Controls
439

by the size of the aperture through which the ﬂuid ﬂows (see Figure 8.23) as the wheel moves
relative to the car body. For normal strut damping, the viscosity of the ﬂuid in the strut is
determined by the choice of ﬂuid and its temperature. The damping force for a given viscosity
varies as an inverse function of the aperture area. Thus, variable damping can, in principle, be
varied either by varying the strut aperture mechanically or by somehow varying the strut ﬂuid
viscosity. We consider the mechanical approach ﬁrst.
Although there are various mechanisms employed to vary the aperture, we illustrate with
a hypothetical conﬁguration. In this conﬁguration a relatively thin tube that is coaxial with the
piston shaft on its outside extends from the piston to the outside of the strut. This assembly is
sealed where it protrudes from the cylinder to prevent any loss of strut ﬂuid. This shaft connects
with a plate that has apertures similar to the piston and that is part of the piston assembly.
Rotation of this sleeve varies the overlap of the apertures in the piston and plate and effectively
regulates the combined aperture through which the strut ﬂuid ﬂows in response to piston axial
motion. The sleeve extends the full length of the piston shaft. At the end of the sleeve near the
attachment lug, and mechanically linked to it, is a gear. This gear meshes with another gear that
is driven by a motor (e.g. stepper motor) that functions as a strut aperture regulating actuator.
The motor assembly is mounted on the structure to which the strut attaches. The strut aperture
size is determined by the angular position of the plate relative to the piston. An electrical signal
from the suspension control system operates the actuator which determines the strut aperture.
This hypothetical electronically controlled strut provides the mechanism by which suspension
damping is regulated. This mechanism can be either switched between two positions via
a solenoid or varied continuously using, for example, a stepper motor such as has already been
discussed. In order to be effective in electronically regulated strut damping, there must be an
electronic control system that generates the actuator electrical signal.
Although therearemany potentialcontrolstrategies for regulatingshock absorber damping,we
consider ﬁrst switched damping as in our example. In such a system, the shock absorber
damping is switched to the higher value whenever lateral acceleration exceeds a predetermined
threshold. Figure 8.26 illustrates such a system in which the threshold for switching to ﬁrm
damping (i.e. higher damping) is 0.35 g. A separate curve of similar shape of steering angle vs.
vehicle speed exists for each lateral acceleration threshold. A simple model for acceleration for
avehicle maneuvering with constant lateral acceleration is presented later in this chapter. There
it is shown that the steering angle vs. velocity are given by
dF ¼ K
uo
(97)
where K is proportional to lateral acceleration. Thus, each curve of dF(uo) has a shape such as
is given in Figure 8.26. The strut damping is switched from the soft damping region (i.e.
relatively large strut aperture) where it is for normal driving to the ﬁrm damping region
whenever the lateral acceleration exceeds the threshold (e.g. 0.35 g in the present example).
440
Chapter 8

Figure 8.26:
Illustration of switching threshold for switched type variable strut damping.
In this example, a sensor for measuring the lateral acceleration (called an accelerometer) is
commercially available at relatively low cost. The signal from this sensor can be compared
with the threshold acceleration value to determine which of the two aperture settings are to be
selected and to generate an appropriate actuator signal. Figure 8.27 is an illustration of the
force/relative velocity characteristics of a shock absorber having an electrically variable
aperture. The ﬁgure illustrates these characteristics at the extreme limits of the variable
aperture. A similar family of force velocity proﬁles between these limits represents the strut
characteristics for aperture sizes between these two limits.
Strut damping can also be varied continuously using the hypothetical mechanism above by
means of a motor actuator. In this conﬁguration, the force/velocity relationship will be a curve
between the solid and dashed curves of Figure 8.27. One control scheme that is potentially
approachable to a continuously variable strut damping is based upon monitoring vehicle
operational conditions. In this scheme, sensors are provided which continuously monitor
vehicle operating conditions. In addition to the lateral acceleration sensor, a solid-state
accelerometer is available that can be placed at a convenient location on the car body to
measure sprung mass acceleration (as(t)). Calculation of the RMS value ~as yields an
indication of ride. Whenever ~as exceeds a given level (possibly driver adjusted), the control
system can generate a signal to operate strut apertures to lower this acceleration. Another
accelerometer could be mounted on the unsprung masses (e.g. wheel axle assembly to
monitor its acceleration (au(t))). Integration twice with respect to time can give a running
measure of displacement:
d ¼
Zt
o
Zs
o
auðt0Þdt0ds
(98)
Vehicle-Motion Controls
441

Figure 8.27:
Strut force velocity relationship for variable-aperture strut.
Whenever the RMS value of d indicates a potential handling problem, the strut damping could be
commanded to optimize handling. Various algorithms are potentially available to set suspension
damping to an optimum value with handling probably taking a higher priority over ride in the
interest of safety. On the other hand as long as safety is not compromised, ride can be optimized.
Variable Damping via Variable Strut Fluid Viscosity
Variable suspension damping is also achieved with a ﬁxed aperture and variable ﬂuid
viscosity. The ﬂuid for such a system consists of a synthetic hydrocarbon with suspended iron
particles and is called a magneto-rheological ﬂuid (MR). An electromagnet is positioned such
that a magnetic ﬁeld is created whose strength is proportional to current through the coil. This
magnetic ﬁeld passes through the MR ﬂuid. In the absence of the magnetic ﬁeld, the iron
particles are randomly distributed and the MR ﬂuid has relatively low viscosity corresponding
to low damping. As the magnetic ﬁeld is increased from zero, the iron particles begin to align
with the ﬁeld, and the viscosity increases in proportion to the strength of the ﬁeld (which is
proportional to the current through the electromagnet coil). That is, the damping of the
associated shock absorber/strut, which incorporates MR ﬂuid, varies continuously with the
442
Chapter 8

electromagnet coil current. Since damping is dependent on both viscosity and the strut
aperture, this variable viscosity can be used to optimize damping either alone or in
combination with variable aperture. However, in practice, the magnetic ﬁelds involved in
varying the strut damping over a useful range tend to be large. The entire strut structure must
be conﬁgured to permit such ﬁelds to be generated with practically achievable current levels.
Variable Spring Rate
It was shown above that the frequency response characteristics of a suspension system are
inﬂuenced by the springs as well as the shock absorber damping. Conventional steel springs
(i.e. coil or leaf) have a ﬁxed spring rate (i.e. forceedeﬂection characteristics). For any given
set of suspension springs, the vehicle height above the ground is determined by vehicle
weight, which in turn depends on loading (i.e. passengers, cargo, and fuel). Some vehicles,
having electronically controlled suspension, are also equipped with pneumatic springs as
a replacement for steel springs. A pneumatic spring consists of a rubber bladder mounted in
an assembly and ﬁlled with air under pressure. This mechanism is commonly called an air
suspension system.
Unlike metallic springs, however, pneumatic springs have nonlinear force deﬂection
relationship. A pneumatic spring consists of a cylinder/piston assembly with a gas (e.g. nitrogen
or air between the end of the piston and the sealed cylinder). A gas under pressure p varies with
the volume Vof the chamber which contains it in accordance with the adiabatic gas law:
pVg ¼ K
(99)
where K is the constant and gthe ratio of speciﬁc heat at constant pressure to that at constant
volume (g ¼ 1.4 for air).
The pneumatic spring volume V is given by
V ¼ Apð[  xÞ
(100)
where Ap is the piston cross-sectional area, [ is the distance of the piston top surface to
the cylinder end at its maximum extension, and x is the displacement due to external
force ð0  x < [Þ.
The force vs. displacement function is given by
F ¼ pAp
¼
KAp
	
Apð[  xÞ

g
(101)
Vehicle-Motion Controls
443

As the piston moves toward the end of the cylinder (i.e. increasing x) due to increased normal
force on the wheel assembly, the strut force increases nonlinearly with x. This type of gas
spring has long been employed in aircraft landing gear structures where the nonlinear force/
displacement is beneﬁcial for absorbing vertical loads imparted during landings.
The force vs. displacement rate for such pneumatic springs is proportional to the pressure in
the bladder. In automotive suspension springs, a motor-driven pump is normally provided that
varies the pressure in the bladder, yielding a variable spring rate suspension. In conjunction
with a suitable control system, the pneumatic springs can automatically adjust the vehicle
height to accommodate various vehicle loadings, as well as to increase spring “stiffness.”
Electronic Suspension Control System
The control system for an exemplar electronic suspension system is depicted in the block
diagram of Figure 8.28.
Figure 8.28:
Example electronic suspension system conﬁguration.
444
Chapter 8

The control system conﬁguration in Figure 8.28 is generic and not necessarily representative of
the system for any production car. This system includes sensors for measuring vehicle speed;
steering input (i.e. angular deﬂection of steered wheels); relative displacement of the wheel
assembly and car body/chassis; lateral acceleration; and yaw rate. The outputs are electrical
signals to the shock absorber/strut actuators and to the motor/compressor that pressurizes the
pneumatic springs (if applicable). The actuators can be solenoid-operated (switched) oriﬁces
or motor-driven variable oriﬁces or electromagnets for RH ﬂuid-type variable viscosity struts.
Certain vehicles may also be equipped with automatic electrically operated brakes (such as
explained in the discussion of ACC) for stability enhancement purposes.
The control system typically is in the form of a microcontroller or microprocessor-based
digital controller. The inputs from each sensor are sampled, converted to digital format, and
stored in memory. As explained above, the body acceleration measurement can be used to
evaluate ride quality. The controller makes this evaluation based upon ~as or similar metrics
for body motion. The relative road/wheel axle displacement d can be used to estimate tire
normal force, and damping is then adjusted to try to optimize this normal force.
Body roll angle ðfRÞ or the yaw rate sensor (r) provides data which in relationship to vehicle
speed and steering input measurements can be used to evaluate cornering performance. In
certain vehicles, these measurements combine in an algorithm that is used to activate the
electrohydraulic brakes for enhanced stability during extreme maneuvers. The details of
automotive stability enhancement is beyond the scope of this book, but the interested reader
should refer to Society of Automotive Engineers (SAE) publications on this subject.
Under program control in accordance with the control strategy, the electronic control system
generates output electrical signals to the various actuators. The variable damping actuators
vary either the oil passage oriﬁce or the RH ﬂuid viscosity independently at each wheel to
obtain the desired damping for that wheel.
There are many possible control strategies and many of these are actually used in production
vehicles. For the purposes of this book, it is perhaps most beneﬁcial to present a representative
control strategy that typiﬁes features of a number of actual production systems.
The important inputs to the vehicle suspension control system come from road roughness-
induced forces and inertial forces (due, for example, to cornering or maneuvering), steering
inputs, and vehicle speed. In our hypothetical simpliﬁed control strategy, these inputs are
considered separately. When driving along a nominally straight road with small steering
inputs, the road input is dominant. In this case, the control is based on the spectral content
(frequency region) of the relative motion. The controller (under program control) calculates
such variables as ~as or ~d (from the corresponding sensor’s data). Whenever the amplitude of
the spectrum near the peak frequencies exceeds a threshold, damping is increased, yielding
a ﬁrmer ride and improved handling. Otherwise, damping is kept low (soft suspension).
Vehicle-Motion Controls
445

If, in addition, the vehicle is equipped with an accelerometer (usually located in the car body
near the center of gravity) and with motor-driven variable-aperture shock absorbers, then an
additional control strategyis possible.In this lattercontrol strategy, the shock absorber apertures
are adjusted to minimize sprung mass acceleration in the 2e8 Hz frequency region, thereby
providing optimum ride control. However, at all times, the damping is adjusted to control
unsprung mass motion to maintain wheel normal force variation at acceptably low levels for
safety reasons. Whenever a relatively large steering input is sensed (sometimes in conjunction
with body roll angle and/or yaw rate measurement), such as during a cornering maneuver, then
the control strategy switches to the smaller aperture, yielding a “stiffer” suspension and
improved handling. In particular, the combination of cornering on a relatively rough road calls
for damping that optimizes tire normal force, thereby maximizing cornering forces.
Electronic Steering Control
The steering system of a car consists of a mechanism for rotating the front wheels of the car
about an axis that is nearly vertical in response to steering wheel angle changes. The basic
mechanism is shown schematically in Figure 8.29.
The force/torque of the steering wheel is inﬂuenced by the actual orientation of the pivot axes
relative to the car body vertical axis. The fore/aft angle is known as camber angle. An increase
in this angle relative to vertical increases steering torque; it also increases restoring torque,
which tends to rotate the wheels toward the body symmetry plane after a turn has been
completed. Typically, the camber angle is only a few degrees, but this angle in combination
with the lateral orientation of the pivot axis (known as caster angle) is beneﬁcial in steering
stability. Proper alignment of these angles assists the vehicle in tracking a straight heading for
neutral steering torque.
The adverse effect of this wheel alignment is an increase in steering effort for the driver
relative to zero camber and caster, which is undesirable. Rather than compromise on
alignment to achieve lower steering effort, car manufacturers have found it desirable to
provide a power assist via a hydraulic system as depicted in Figure 8.29. An engine-driven
pump P provides hydraulic ﬂuid (power steering ﬂuid) under pressure. This pressurized ﬂuid
is sent via hydraulic lines to a control valve (CV) mounted at some point on the steering shaft.
This CV directs the pressurized ﬂuid to a hydraulic cylinder mechanism that applies torque in
the same direction as the steering wheel.
A basic problem with such a system comes from matching the desired boost with that
available from the power steering pump. Figure 8.30 shows qualitatively the desired boost
which decreases with vehicle speed.
Unfortunately in early power steering systems, the available boost was an increasing function
of engine speed (owing to the increase in pump speed with engine speed) which is a function
446
Chapter 8

of vehicle speed and the transmission gear ratio. Although it is possible to obtain a constant
boost with respect to engine RPM via pressure regulating valves yielding a constant boost
with respect to vehicle speed, obtaining desired boost was not readily achievable with purely
mechanical systems. On the other hand, electronic controls provide a relatively
straightforward means of regulating boost to obtain desired results. Moreover, a digital power
steering control system allows for the possibility of changing the boost vs. speed proﬁle via
software changes. A control that adapts automatically to driving conditions is also achievable
cost effectively. In an electrohydraulic power steering system the hydraulic pressure to the
boost cylinder can be varied via an adjustable pressure relief valve. An actuator for such
a system can be a motor (e.g. stepper motor) or a solenoid, possibly driven by a variable-duty-
cycle control signal (see Chapter 6).
Rack and Pinion
P
HB
steering 
shaft
CV
Steering Wheel
hydraulic P.S.
pivot axes
δr
δl
u
x’
Figure 8.29:
Basic steering mechanism with power assist.
Vehicle-Motion Controls
447

An alternative power steering scheme uses a special electric motor to provide the boost
required instead of the hydraulic boost as depicted in Figure 8.31.
In this ﬁgure, a motor gear system is coupled to the steering mechanism in such a way as to
provide the torque boost. A digital control system C receives vehicle speed measurements via
Figure 8.30:
Power steering boost vs. speed.
MG
control
vehicle
speed
sensor
C
S
Figure 8.31:
Electric power steering boost.
448
Chapter 8

speed sensors and generates a motor control signal to achieve the desired speed/boost proﬁle.
Electric boost power steering has several advantages over traditional hydraulic power
steering. Electronic control of electric boost systems is straightforward and can be
accomplished without any energy conversion from electrical power to mechanical actuation.
Moreover, electronic control offers very sophisticated adaptive control in which the system
can adapt to the driving environment. A basic problem with a direct electric motor steering
boost is that an electric motor must be rotating to produce meaningful torque. For any driving
situation in which a constant steering angle input is required (e.g. for vehicle moving along an
arc of constant radius of curvature), the motor would have to generate the torque boost while
not rotating. An alternative electric boost scheme involves an electric motor directly driving
a hydraulic pump that is part of an electrohydraulic power steering system.
Four-Wheel Steering
Electronically controlled power steering also has the capability for four-wheel steering (4WS).
As will be shown later 4WS be highly useful during vehicle curb parking but also has potential
for improved road maneuverability. An example of an electronically controlled steering system
that has had commercial production is for four-wheel steering systems (4WS). In the 4WS-
equipped vehicles, the front wheels are directly linked mechanically to the steering wheel, as in
traditional vehicles. There is a power steering boost for the front wheels as in a standard two-
wheel steering system. The rear wheels are steered under the control of a microcontroller via an
actuator. Figure 8.32 is an illustration of the 4WS conﬁguration.
In Figure 8.32, the notation is as follows:
x0 ¼ vehicle longitudinal axis
x ¼ inertial (ECEF) reference axis (i.e. initial direction of x)
j ¼ angle between x and x0
dF ¼ angle between x0 and the front tire plane of symmetry
dR ¼ angle between x0 and the rear tire plane of symmetry
du ¼ angle between x0 and uo
uo ¼ car instantaneous velocity vector
a ¼ longitudinal distance CG to front wheel axis
b ¼ longitudinal distance CG to rear wheel axis
v ¼ car lateral velocity
r ¼ _j
vF ¼ lateral velocity of front wheel relative to road surface
vR ¼ lateral velocity of rear wheel relative to road surface
During ordinary driving of a passenger car the angle between the car longitudinal axis
and the instantaneous velocity vector (du) is small such that cosðduÞy1, sinðduÞydu.
Vehicle-Motion Controls
449

Under these conditions, the lateral velocities of the front and rear tires respectively are
given by
vF ¼ v þ ra
vR ¼ v  br
(102)
The models for the tire lateral forces at the front and rear tires FFL and FRL respectively are
based on the so-called tire slip angles aF and aR respectively. Neglecting the small angle du,
these are the angles between the vehicle longitudinal axis ðx0Þ and the instantaneous velocity
vector of the tire contact point with the road and are given by
aF ¼ dF  tan1
v þ ra
uo

aR ¼ dR  tan1
v  br
uo

(103)
In these equations right-and-left symmetry is assumed which is valid for relatively small dF,
dR such as is the case while driving on the highway. It is consistent with the small-angle
assumptions that these angles are given approximately by
aFydF 
v þ ar
uo

aRydR  v  br
u0
(104)
v
δu
u0
ψ
steering angle sensor
speed sensor
b
S
U
C
A
a
FRL
vR
vF
δr
δF
FFL
x′
x
y′
r
CG
Figure 8.32:
4WS basic conﬁguration.
450
Chapter 8

For a conventional front wheel steering car, dR ¼ 0. The tire lateral or so-called cornering
forces (for small angles) FFL (front) and FRL (rear) and front wheel steering are given by
FFL ¼ 2CF

dF 
v þ ar
uo

FRL ¼ 2CR


v  br
uo

(105)
where CF is the front tire concerning stiffness, CR the rear tire concerning stiffness, and where
right/left symmetry is assumed.
The cornering stiffness is a steering parameter, which is a function of the tire characteristics
and road surface. It is also a function of the instantaneous tire normal force (i.e. NF, NR).
However, for the present discussion, it is assumed to be a constant for the following steering
maneuver.
The model for lateral translational motion is found by summing forces acting in the
y0-direction:
Mð_v þ uorÞ ¼ 2CF

dF 
v þ ar
uo

 2CR
v  br
uo

(106)
where M is the vehicle mass.
Similarly, the model for the rotational motion about the CG is found by summing all moments
about the CG and is given by
Izz _r ¼ 2aCF

dF 
v þ ar
uo

 2bCR
v  br
uo

(107)
where Izz is the vehicle moment of inertia about the vertical axis through the CG.
The motion of the car in response to a steering input dF(t) is found by solving the above
equations. The solution for any set of coupled linear ﬁrst-order equations is facilitated using
state variable approach as explained in Chapter 1. In this case the independent variables v,r
are put in state vector (x) form where the state vector is given by
x ¼

v
r

(108)
The state variable model for the pair of equations is in the form
_x ¼ Ax þ Bu
(109)
Vehicle-Motion Controls
451

where the state transition matrix A is given by
A ¼
2
664
2 ðCF þ CRÞ
Muo
2 ðaCF  bCRÞ
Muo
 uo
M
2 ðaCF þ bCRÞ
Izzuo
2 ða2CF  b2CRÞ
Izzuo
3
775
and the input matrix B is given by
B ¼
2
64
2CF
M
2aCF
Izz
3
775
(110)
The input u for front wheel steering is given by
u ¼ dF
(111)
Taking the Laplace transform of the state variable Eqn (109) and solving for x(s) yields
xðsÞ ¼ ðsI  AÞ1BuðsÞ
(112)
where I is an identity matrix which, for a two-dimensional vector, is given by
I ¼

1
0
0
1

Solution of the equation for x(s) is straightforward once the parameters of the A and B matrix
are determined for any given vehicle, set of tires and steering command. As shown in Chapter
1 the time domain state vector can be readily found using inverse Laplace (i.e. residue)
methods.
The simpliﬁed steering model above for front wheel steering has ignored vehicle roll
dynamics during a steering maneuver. We next develop a model for a 4WS (with electronic
controls and for which dR can be nonzero) that includes roll dynamics. In writing a set of
equations that includes roll, it is necessary to distinguish sprung mass (Ms) from unsprung
mass (Mu) and total vehicle mass (M) where
M ¼ Ms þ Mu
452
Chapter 8

Summing the forces acting in the y0-direction through the CG yields the following equation:
Mð_v þ uorÞ þ MshCG _p ¼ 2CF

dF 
v þ ar
uo

þ 2CR

dR 
v  br
uo

(113)
where the possibility of nonzero dR is explicitly taken. Summing moments about the vertical
axis through the CG yields the following equation:
Izz _r  Izx _p ¼ 2aCF

dF 
v þ ar
uo

 2bCR

dR 
v  br
uo

(114)
where the cross-moment of inertia Izx has not been neglected. Finally, summing moments
about the longitudinal axis through the CG yields the following equation:
Ixx _p  Ixz _r þ MshCGð_v þ uorÞ ¼ ðLPF þ LPRÞp  ðLfF þ LfRÞfR
(115)
where
p ¼ _fR
and
Ixx ¼ moment of inertia about the x axis.
Ixz ¼ Izx ¼ product of inertia in x and z
The above set of coupled linear differential equations can be written in state variable form
with a four-dimensional state vector
x ¼
2
664
v
r
p
fR
3
775
(116)
and input vector
u ¼

dF
dR

This equation is four dimensional requiring four coupled differential equations. In addition to
the three given above, the 4th differential equation is given by
p ¼ _fR
Vehicle-Motion Controls
453

The state vector equation is given by
G_x ¼ Hx þ Du
(117)
The matrix G is given by
2
664
M
0
MshCG
0
0
Izz
Izx
0
MshCG
Ixz
Ixx
0
0
0
1
0
3
775
(118)
The matrix H is given by
2
664
2ðCF þ CRÞ=uo
2ðCFa  CRbÞ=uo  Muo
0
0
2ðCFa  CRbÞ=uo
2ða2CF þ b2CRÞ=uo
0
0
0
MshCGuo
ðLPF þ LPRÞ
ðLfF þ LfRÞ
0
0
1
0
3
775
and matrix D is given by
D ¼
2
664
2CF
2CR
2aCF
2bCR
0
0
0
0
3
775
The above state variable equation can be put in standard form by multiplying Eqn (117) by the
inverse of G yielding
_x ¼ G1Hx þ G1Du
¼ Ax þ Bu
where
A ¼ G1H
B ¼ G1D
In the illustration of Figure 8.32, the front wheels are steered to a steering angle dF by the
driver’s steering wheel input. A sensor (S) measures the steering angle and another sensor (U)
gives the vehicle speed. The microcontroller (C) determines the desired rear steering angle dR
under program control as a function of speed and front steering angle via actuator A.
In an exemplary 4WS control strategy for speeds below 10 mph, the rear steering angle is in
the opposite direction to the front steering angle. This control strategy has the effect of
454
Chapter 8

decreasing the car’s turning radius by as much as 30% from the value it has for front wheel
steering only. Consequently, the maneuvering ability of the car at low speeds is enhanced (e.g.
for parking).
At intermediate speeds (e.g. 11 mph < U < 30 mph), the steering might be front wheel only.
At higher speeds (including highway cruise), the front and rear wheels are steered in the same
direction. At least one automaker has an interesting strategy for higher speeds (e.g. at
highway cruise speed). In this strategy, the rear wheels turn in the opposite direction to the
front wheels for a very short period (on the order of 1 s) and then turn in the same direction as
the front wheels. This strategy has a beneﬁcial effect on maneuvers such as lane changes on
the highway.
As an illustration of the inﬂuence of electronic 4WS on vehicle maneuvers, a simulation has
been run on a hypothetical vehicle having the following metric system parameters:
M ¼ 1000 kg
Ms ¼ 890 kg
Ixx ¼ 300 kg m2
Izz ¼ 1200 kg m2
Ixz ¼ Izx ¼ 11.25 kg m2
a ¼ 1.28 m
b ¼ 0.92 m
hCG ¼ 0.3 m
LPF ¼ LPR ¼ 1045 N m s/rad
LfF ¼ LfR ¼ 15450 Nmsec2
CF ¼ 2  104 N/rad
CR ¼ 2.9  104 N/rad
uo ¼ 30 m/s
Figure 8.33 qualitatively depicts the car position during alone change maneuver for 2Ws and
for 4Ws.
From the simulation, Figure 8.34 plots the steering wheel angle in radians for this lane
change-type maneuver as well as the vehicle lateral motion y(t) of the CG. The control
strategy in this simulation is for the rear wheel deﬂection dR ¼ 0:1dF. The solid curve
represents 4WS response and the dashed curve the response for 2WS. Note that the lane
change amount is twice as much for 4WS as for 2WS during the steering input time interval.
Alternatively a given lateral displacement can be achieved in half the time with 4WS as for
2Ws.
This simulation of a lane change maneuver with rear wheels steered in the opposite direction
is only intended to illustrate the signiﬁcant differences in maneuvering for 4WS compared to
2WS. In fact, such a control strategy is not necessarily desirable for passenger car
Vehicle-Motion Controls
455

electronically controlled 4WS. Rather it might be more appropriate for certain race car
applications.
For normal passenger cars, it is more likely that at highway cruise speeds the rear wheel
steering would be in the same direction as the front wheels but at a somewhat smaller peak
deﬂection. Another passenger car control strategy might be to steer the rear wheels opposite
to the front wheels for a short period and then to steer them in the same direction (although at
Figure 8.33:
Lane change maneuver (qualitative sketch).
Figure 8.34:
Lane change maneuver 4WS vs. 2WS from simulation.
456
Chapter 8

a smaller angle). Many control strategies can be evaluated in simulation using models such as
are presented above or (preferably) more accurate models than above with respect to
nonlinearities and un-modeled dynamics.
Turning the wheels in the same direction at cruising speeds has another beneﬁt for a vehicle
towing a trailer. When front and rear wheels turn in the same direction, the angle between the
car and trailer axes is less than it is for front wheel steering only. The reduction in this angle
means that the lateral force applied to the rear wheels by the trailer in curves is less than that
for front wheel only steering. This lateral force reduction improves the stability of the car or
truck/trailer combination relative to front steering only.
Summary
This chapter has reviewed some basic theory for vehicle-motion control. In practice and in
production vehicles, the models presented here would not be adequate for development of
actual control systems. However, the relevant models involve very complicated nonlinear,
coupled differential equations that extend beyond the intended scope of this book. On the
other hand, the simpliﬁed models presented here illustrate the theory of such complex
electronic systems. There is abundant literature available through the Society of Automotive
Engineers (SAE) and its publication services for the reader who is interested in pursuing the
advanced theory of vehicle-motion control. It is hoped that the discussions in this chapter
have prepared the reader well enough to be able to understand these publications.
Vehicle-Motion Controls
457

This page intentionally left blank

CHAPTER 9
Automotive Instrumentation
and Telematics
Chapter Outline
Modern Automotive Instrumentation
460
Input and Output Signal Conversion
463
Multiplexing
465
Multirate Sampling
468
Advantages of Computer-Based Instrumentation
469
Display Devices
470
LED
474
LCD
476
Transmissive LCD
480
VFD
480
Flat Panel Display
483
Fuel Quantity Measurement
491
Coolant Temperature Measurement
497
Oil Pressure Measurement
498
Vehicle Speed Measurement
500
High-Speed Digital Communications (CAN)
502
CAN Network
504
Trip Information Computer
507
Telematics
510
GPS Navigation
511
The GPS System Structure
516
Automotive Diagnostics
519
This chapter describes electronic instrumentation and the relatively new ﬁeld of telematics.
By the term instrumentation, we mean the equipment and devices that measure engine and
other vehicle variables and parameters for control or to display their status to the driver. By
the term telematics, we refer to communication of all forms within the vehicle as well as
communication to and from the vehicle. Communication within the vehicle takes the form of
digital data links between various electronic subsystems. Communication to and from the
vehicle spans all communication from voice and digital data via cell or satellite phone
Understanding Automotive Electronics. http://dx.doi.org/10.1016/B978-0-08-097097-4.00009-6
Copyright  2012 Elsevier Inc. All rights reserved.
459

systems to digital data sent from land or satellite. Internet connections to an on-board PC (or
the like) are included in those categories listed above. This chapter begins with a discussion of
electronic instrumentation and concludes with telematics.
From about the late 1920s until the late 1950s, the standard automotive instrumentation
included the speedometer, oil pressure gauge, coolant temperature gauge, battery charging
rate gauge, and fuel quantity gauge. Strictly speaking, only the latter two are electrical
instruments. In fact, this electrical instrumentation was generally regarded as a minor part of
the automotive electrical system. By the late 1950s, however, the gauges for oil pressure,
coolant temperature, and battery charging rate were replaced by warning lights that were
turned on only if speciﬁed limits were exceeded. This was done primarily to reduce vehicle
cost and because of the presumption that many people did not necessarily regularly monitor
these instruments.
Automotive instrumentation was not really electronic until the 1970s. At that time, the
availability of relatively low-cost solid-state electronics brought about a major change in
automotive instrumentation; the use of low-cost electronics has increased with each new
model year. This chapter presents a general overview of typical automotive electronic
instrumentation.
In addition to providing measurements for display, modern automotive instrumentation
performs limited diagnosis of problems with various subsystems. Whenever a problem is
detected, a warning indicator alerts the driver of a problem and indicates the appropriate
subsystem. For example, whenever self-diagnosis of the engine control system detects
a problem, such as a loss of signal from a sensor, a lamp illuminates the “Check Engine”
message on the instrument panel. Such warning messages alert the driver to seek repairs from
authorized technicians who have the expertise and special equipment to perform necessary
maintenance.
Modern Automotive Instrumentation
The evolution of instrumentation in automobiles has been inﬂuenced by electronic
technological advances in much the same way as the engine control system, which has
already been discussed. Of particular importance has been the advent of the microprocessor,
solid-state display devices, and solid-state sensors. In order to put these developments into
perspective, recall the general block diagram for instrumentation (ﬁrst given in Chapter 1),
which is repeated here as Figure 9.1. There it was explained that measurement instruments
consist of three functional components: sensor, signal processing, and display.
In electronic instrumentation, a sensor is required to convert any nonelectrical signal to an
equivalent voltage or current. Electronic signal processing is then performed on the sensor
460
Chapter 9

output to produce an electrical signal that is capable of driving the display device. The display
device is read by the vehicle driver. If a quantity to be measured is already in electrical form
(e.g. the battery charging current), then this signal can be used directly and no sensor is
required.
As explained in Chapter 1 the role of signal processing is to perform any required
transformation of the sensor output voltage to generate a signal that is sent to the display such
that the display presents the desired measurement in the correct format. In general, the sensor
output voltage for the measurement of a physical variable (x) is in the following form:
v0 ¼ fðxÞ
(1)
As explained in Chapter 6 f(x) can take many forms. The simplest and often the most
desirable form is a linear transformation for which the sensor model is given by
v0 ¼ Ksx
(2)
However, other functional forms both linear and nonlinear are commonly encountered in
practice. For example, a sensor can have a model that is given by
v0 ¼ Ks
dx
dt
(3)
Signal processing might include integration of the sensor voltage to obtain x(t):
xðtÞ ¼ 1
Ks
Zt
0
v0ðsÞds
(4)
Each measurement in any instrumentation system will have a speciﬁc sensor function
requiring a particular signal-processing transformation to yield the desired display. If the
Figure 9.1:
General instrumentation block diagram.
Automotive Instrumentation and Telematics
461

sensor is a linear analog device, then the signal-processing operation can be given by the
operation transfer function ðHspðsÞÞ where
HspðsÞ ¼ v1ðsÞ
v0ðsÞ
(5)
where v0 is the sensor output and v1 is the input signal to the display (see Figure 9.1).
Signal processing in contemporary vehicle instrumentation is performed in a digital system
under program control. In this case, the sensor input is sampled at discrete times tk and the
output of the signal processor is a discrete time sequence f yng. A representative linear signal-
processing operation can be written as a recursive algorithm as explained in Chapter 2:
yn ¼
X
K
k¼0
akv0ðtnkÞ 
X
L
i¼1
biyni
(6)
The digital sequence fyng is then converted to a signal ðv1Þ of the correct format to drive the
display.Examplesofdigitalsignalprocessingforspeciﬁcmeasurementsarepresentedthroughout
this chapter. The hardware for various types of display is discussed later in this chapter.
In contemporary automotive instrumentation, a microcomputer (or related digital subsystem)
performs all signal-processing operations for several measurements. The primary motivation
for computer-based instrumentation is the great ﬂexibility offered in the design of the
instrument panel. A block diagram for such an instrumentation system is shown in Figure 9.2.
All measurements from the various sensors and switches are processed in a special-purpose
digital computer, i.e. the instrumentation computer. The processed signals are routed to the
appropriate display or warning message. It is common practice in modern automotive
Figure 9.2:
Computer-based instrumentation system.
462
Chapter 9

instrumentation to integrate the display or warning in a single module that may include both
solid-state alphanumeric display, lamps for illuminating speciﬁc messages, and traditional
electromechanical indicators. For convenience, this display system will be termed the
instrument panel (IP).
The inputs to the instrumentation computer include sensors (or switches) for measuring (or
sensing) various vehicle variables as well as diagnostic inputs from the other critical
electronic subsystems. The vehicle status sensors may include any of the following:
1.
fuel quantity,
2.
fuel pump pressure,
3.
fuel ﬂow rate,
4.
vehicle speed,
5.
oil pressure,
6.
oil quantity,
7.
coolant temperature,
8.
outside ambient temperature,
9.
windshield washer ﬂuid quantity, and
10.
brake ﬂuid quantity.
In addition to these variables, the input may include switches for determining gear selector
position, brake activation, and detecting open doors and trunk, as well as IP selection switches
for multifunction displays that permit the driver to select from various display modes or
measurement units. For example, the driver may be able to select vehicle speed in miles per
hour (mph) or kilometers per hour (kph).
An important function of modern instrumentation systems is to receive diagnostic
information from certain subsystems and to display appropriate warning messages to the
driver. The powertrain control system, for example, continuously performs self-diagnosis
operations (see Chapter 10). If a problem has been detected, a fault code is set indicating the
nature and location of the fault. This code is transmitted to the instrumentation system via
a powertrain digital data line (PDDL in Figure 9.2). This code is interpreted in the
instrumentation computer and a “Check Engine” warning message is displayed. Similar
diagnostic data are sent to the instrumentation system from each of the subsystems for which
driver warning messages are deemed necessary (e.g. ABS, airbag, and cruise control). The
way in which a fault is detected is explained in greater detail in Chapter 10.
Input and Output Signal Conversion
It should be emphasized that any single input can be digital, switched, or analog depending on
the technology used for the sensor. A typical instrumentation computer is an integrated
subsystem that is designed to accept all of these input formats. A typical system is designed
Automotive Instrumentation and Telematics
463

with a separate input from each sensor or switch. An example of an analog input is the fuel
quantity sensor, which can be a potentiometer attached to a ﬂoat, as described in detail later in
this chapter. The measurement of vehicle speed as discussed in Chapter 8 uses a sensor
described in Chapter 6 is an example of a measurement that is already in digital format.
The analog inputs must all be converted to digital format using an analog-to-digital (A/D)
converter as explained in Chapter 4 and illustrated in Figure 9.3. In the example of Figure 9.3,
a quantity x being measured uses an analog sensor with output voltage vo(x). The
instrumentation computer causes a sample of vo to be taken at time tk via a sample and hold
(SH) circuit. The sampled voltage vo(tk) is, then, converted to a digital input vk by the A/D
converter (see Chapter 4) and is input to the CPU in digital format.
The digital inputs are, of course, already in the desired format. The conversion process
requires an amount of time that depends primarily on the A/D converter. After the conversion
is complete, the digital output generated by the A/D converter is the closest possible
approximation to the equivalent analog voltage, using an M-bit binary number (where M is
chosen by the designer and could, for example, be between 8 and 32). The A/D converter then
sends a signal to the computer by changing the logic state on a separate lead (labeled EOC,
indicating end of conversion in Figure 9.3) that is connected to the computer. (Recall the use
of interrupts for this purpose, as discussed in Chapter 4.) The output voltage of each analog
sensor for which the computer performs signal processing must be converted in this way.
Once the conversion and any required digital signal processing are complete, the digital
output is transferred to a register in the computer. If the output is to drive a digital display, this
output can be used directly. However, if an analog display is used, the binary number must be
converted to the appropriate analog signal by using a digital-to-analog (D/A) converter (see
Chapter 4).
Figure 9.4 illustrates a typical D/A converter used to transform digital computer output to an
analog signal.
CPU
A/D
sample
convert
EOC
SH
Sensor
vk
v0
v0(tk)
tk
x
Figure 9.3:
Digital instrumentation input system.
464
Chapter 9

The N digital output leads transfer the results of the signal processing to a D/A converter.
When the transfer is complete, the computer sends a signal to the D/A converter to start
converting. The D/A output generates a voltage that is proportional to the binary number in
the computer output. As explained in Chapter 2, the D/A conversion often includes a zero-
order hold circuit (ZOH). A low-pass ﬁlter (which could be as simple as a capacitor) is often
connected across the D/A output to smooth the analog output between samples. The sampling
of the sensor output, A/D conversion, digital signal processing, and D/A conversion normally
take place during the time slot allotted for the measurement of the variable in a sampling time
sequence (although time delays are possible), to be discussed shortly.
Multiplexing
Of course, the computer can only deal with the measurement of a single quantity at any one
time. Therefore, the computer input must be connected to only one sensor at a time, and the
computer output must be connected only to the corresponding display. The computer
performs any necessary signal processing on a particular sensor signal and then generates an
output signal to the appropriate display device.
The process of selectively and sequentially sending multiple inputs to a digital signal-
processing system is known as multiplexing. We consider an instrumentation system in which
a set of signals from N analog sensors is connected to the digital system. A means for
accomplishing this process in time sequence is known as time-domain multiplexing (TDM).
One conﬁguration for TDM of N signals is shown schematically in Figure 9.5.
In the conﬁguration of Figure 9.5, a set of N analog sensors generates output voltages vn(t).
Each of these is connected to an electronic switch (Sn), which, e.g. can be implemented
Figure 9.4:
Digital instrumentation analog output.
Automotive Instrumentation and Telematics
465

using a transistor as described in Chapters 3 and 4 located within an electronic module
denoted MUX. The MUX performs the multiplexing function as well as a sampling
function. Not shown in this ﬁgure are the electrical connections which activate (i.e. close)
the normally open switches. In the conﬁguration of Figure 9.5, the digital system activates
each switch by sending digital data to a decoder (1 of N). When the data corresponding to
switch Sn are transmitted to the decoder, it generates a signal which activates that switch
effectively connecting voltage vn to the A/D converter. At the end of the conversion time,
the A/D generates a signal on the EOC line which causes the digital system to read the
A/D output. The A/D converter holds vn until EOC. Thus, the MUX in this
conﬁguration performs a sampling operation in addition to multiplexing (see Chapter 4
for a discussion of sampling).
In the conﬁguration of Figure 9.5, it is assumed here that each sensor signal is assigned a time
slot within a larger period. In this case, the sample time tnk for sensor n during the kth MUX
cycle is given by
tnk ¼ Tk þ ndT
n ¼ 1; 2/ N;
dT ¼ Tc
N
Tc ¼ Tkþ1  Tk ¼ cycle period
(7)
where N is the number of inputs sampled during Tc.
digital 
system
decode
control
A/D
BC
D
EOC
A
analog 
sensors
MUX
S2
S2
SN
SN
S1
vN
v1
v2
x1
x2
xN
S1
Figure 9.5:
Analog multiplexing system.
466
Chapter 9

This conﬁguration is one of many such for performing the MUX function. Multiplexing can
also be done with digital signals. Such signals can come either from a digital sensor (e.g.
a speed sensor as in Chapter 8) or from an analog sensor with its own dedicated A/D converter.
Figure 9.6 illustrates a digital MUX conﬁguration.
Here, it is assumed for illustrative purposes that there are four inputs to the MUX
(corresponding to digital data from four sensors). It is further presumed that the data are
available in 8-bit digital format. In practice, however, contemporary vehicle instrumentation
Figure 9.6:
Digital data multiplexer.
Automotive Instrumentation and Telematics
467

uses a higher number of bits for each measurement variable. Each of the multiplexers selects
a single bit from each of the four inputs. There must be eight such MUX circuits, each
supplying one data bit. The output lines from each MUX are connected to a corresponding
data bus line in the digital computer (see Chapter 4). The digital system controls sequencing
by generating data select line signals as shown in Figure 9.6. This selection is done in
a sequence corresponding to the sample time tnk as explained for the analog MUX for the nth
input and kth sample.
Once the required signal processing has been completed in the digital system and output
signal yn has been computed for sensor n corresponding to sample time tnk, the correct signal
must be sent to the display for that variable. Although the sensors for the conﬁguration of
Figure 9.5 have been taken to be analog, it is assumed that the displays are digital. It is
assumed that the digital output comes along a single set of output data lines in a time
sequence similar to that shown for the input data. That is, each pair of data select bits (e.g. A
and B of Figure 9.7) has a time associated with it such that the data yn is sent to the correct
8-bit digital display one bit from each of the Demux circuits. Each display converts the 8-bit
data to an alphanumeric character in the digital display as explained later.
Multirate Sampling
As explained above with respect to the conﬁguration of Figure 9.5, one possible scheme for
measuring several variables by this process is to sample each quantity sequentially, giving
each measurement a ﬁxed time slot, tnk, out of the total cycle period, Tc, as illustrated in
Figure 9.8.
This method is satisfactory as long as the sample period is small compared with the time in
which any quantity changes appreciably. Certain quantities, such as coolant temperature and
fuel quantity, change very slowly with time. For such variables, a sample period of a few
seconds or longer is often adequate.
On the other hand, variables such as vehicle speed, battery charge, and fuel consumption rate
change relatively quickly and require a much shorter sample period, perhaps every second or
every few tenths of a second. To accommodate the various rates of change of the automotive
variables being measured, the sample period varies from one quantity to another. This process
of having a different sample period for different subsets of variables is known as multirate
sampling. The most rapidly changing quantities are sampled with a very short sample period,
whereas those that change slowly are sampled with a long sample period.
Multirate sampling can be accomplished by having different conﬁgurations such as shown in
Figure 9.5 for each subset of variables at a given sample rate. However, it is also possible to
achieve multirate sampling with a single MUX which samples signal sensors at the highest
rate required. Then, rather than store and process every sample for the low rate variable, the
468
Chapter 9

low rate variable sampling rate can be accomplished by a process called decimation. In this
process, only one sample of data is stored in memory for every M cycle periods of duration Tc
resulting in a decimation by M of the data. Effectively this process reduces the sample rate by
a factor of 1/M of the highest sample rate.
Advantages of Computer-Based Instrumentation
One of the major advantages of computer-based instrumentation is its great ﬂexibility. To
change from the instrumentation for one vehicle or one model to another often requires only
a change of computer program. This change can often be implemented by replacing one ROM
Figure 9.7:
Digital data demultiplexer.
Automotive Instrumentation and Telematics
469

(read-only memory) with another. Remember that the program is permanently stored in
a ROM that is typically packaged in a single integrated circuit package (see Chapter 4).
Another beneﬁt of microcomputer-based electronic automotive instrumentation is its
improved performance compared with conventional instrumentation. For example, the
traditional electromechanical fuel gauge system has errors that are associated with 1)
nonlinearities in the mechanical and geometrical characteristics of the tank relative to the
sender unit, 2) the instrument voltage regulator, and 3) the display dynamic response. The
electronic instrumentation system eliminates the error that results from imperfect voltage
regulation. In general, the electronic fuel quantity measurement maintains calibration over
essentially the entire range of automotive operating conditions. Moreover, it signiﬁcantly
improves the display accuracy by replacing the electromechanical galvanometer display with
an all-electronic digital display.
Display Devices
One of the most important components of any measuring instrument is the display device.
In automotive instrumentation, the display device must present the results of the
measurement to the driver in a form that is easy to read and understand. The speedometer,
ammeter, and fuel quantity gauge were originally electromechanical devices. Then
automotive manufacturers began using warning lamps for certain variables (e.g. oil
pressure) instead of gauges to cut cost. A warning lamp can be considered as a type of
electro-optical display. In addition, electro-optical alphanumeric display devices are in
common use in contemporary vehicles.
Figure 9.8:
Sequential sampling.
470
Chapter 9

Even in certain models of contemporary vehicles, analog display devices are sometimes used
(e.g. to display fuel quantity, coolant temperature, oil pressure, and engine RPM). The most
common analog electromechanical display is the galvanometer. The physical conﬁguration
for a galvanometer is shown in Figure 9.9.
This display device uses a movable pointer to indicate the numerical value of the displayed
quantity along a scale. The scale consists of short segments of lines that are directed radially
from the pointer pivot. Normally, numerical values are only given along the longer lines.
The pointer is attached via a long, thin rod that is supported at either end by small bearings
of the type used to support shafts in mechanical watches or clocks. The rod to which the
pivot is attached is also attached to a coil of wire having N turns as well as one or more
springs. A permanent magnet is the source of a magnetic ﬁeld which ﬂows through the
ferromagnetic pole pieces and a ﬁxed cylindrical core. The coil is separated from the pole
pieces and cylindrical core by a small gap and can rotate about the pivot axis within
this gap.
The pole pieces and cylindrical core are designed such that the magnetic ﬂux density vector B
is directed radially from the pivot axis, inward on the left pole piece and outward on the right.
The magnitude of this magnetic ﬂux density Br is approximately constant over the entire
region of coil movement as shown in Figure 9.10.
Figure 9.9:
Galvanometer conﬁguration.
Automotive Instrumentation and Telematics
471

From basic magnetic ﬁeld theory (as introduced in Chapter 6), it is known that whenever
a current ﬂows through the movable coil, a torque Tc acts on the coil, which is given by
Tc ¼ KcNBri
(8)
where Kc is the constant for the conﬁguration, N is the number of turns on the coil, and i is the
current through the coil.
The spring produces a torque on the pointer shaft in a direction opposite to that of the
magnetic torque and such that it tends to move the pointer to q ¼ 0.
The dynamic equation of motion for the galvanometer is given below:
J€q þ D_q þ Kq ¼ Tc
¼ KcNBri
(9)
where J is the moment of inertia of the moving assembly about the pivot of axes, D is the
viscous damping coefﬁcient for the movable elements, and K is the spring rate of the torsional
spring.
From Chapter 1 it can be shown that the operational transfer function for the above model
(Hi(s)) is given by
HiðsÞ ¼ qðsÞ
iðsÞ
¼
KcNBr
Js2 þ Ds þ K
(10)
Pointer
Pole piece
Scale
N turn coil
V
i
0
1
2
3
Rs
B
B
Figure 9.10:
Galvanometer magnetic ﬁeld conﬁguration.
472
Chapter 9

The electrical input to the galvanometer is represented by its terminal voltage and source
impedance Rs (assumed to be purely resistive). A circuit diagram for the galvanometer is
shown in Figure 9.11.
The coil has a circuit model consisting of resistance Rc and inductance Lc. The dynamic
model for the coil current is given by
vs ¼ ðRs þ RcÞ i þ Lc
di
dt
(11)
Using the Laplace transform methods of Chapter 1, the operational transfer function for the
galvanometer Hg(s) can be shown to be
HgðsÞ ¼ qðsÞ
vsðsÞ
¼
KcBrN
ðJs2 þ Ds þ KÞ½ðRs þ RcÞ þ sLc
(12)
One of the important issues for the performance of a galvanometer for automotive display
applications is its dynamic response. For displaying relatively slowly changing variables (e.g.
fuel quantity), its response should be slow; that is, it should have a relatively low bandwidth
(e.g. 0.1 rad/sec). With such low bandwidth, the fuel quantity display will indicate the time
average of the sensor signal. In this case, the relatively rapid ﬂuctuations in sensor output
(due, e.g. to fuel sloshing) are suppressed. The low bandwidth for fuel quantity display is
achieved by choice of Rs. On the other hand, galvanometer display of relatively rapidly
changing quantities (e.g. vehicle speed) requires a larger bandwidth than for fuel quantity.
The optimum bandwidth for any galvanometer automotive display is determined by the
designer through the choice of parameters in Hg(s).
Recent developments in solid-state technology in the ﬁeld called optoelectronics have led
to sophisticated electro-optical display devices that are capable of indicating
alphanumeric or pictorial data. This means that both numeric and alphabetic information
Rs
Rc
Lc
i
vs
Figure 9.11:
Galvanometer circuit diagram.
Automotive Instrumentation and Telematics
473

can be used to display the results of measurements of automotive variables or parameters.
This capability allows messages in English or other languages to be given to the
driver. The input for these devices is an electronic digital signal, which makes these
devices compatible with computer-based instrumentation, whereas electromechanical
displays require a D/A converter and are only capable of indicating a value along
the scale.
Automobile manufacturers have considered many different types of electronic displays for
automotive instrumentation. We consider three representative technologies here: light-
emitting diode (LED), liquid crystal display (LCD), and vacuum-ﬂuorescent display (VFD).
Each of these technologies can be employed to display alphanumeric characters by placing
them in a suitable geometric arrangement such that, when illuminated in speciﬁc patterns,
they appear as the desired alphanumeric character. The ultimate application of these electro-
optic devices is in the form of a rectangular arrangement of individual devices yielding the so-
called ﬂat panel display. This sophisticated display and its operation are explained after the
following explanation of the electro-optic technologies. We consider these three technologies
separately in the following discussion. Each of these types is discussed brieﬂy to explain their
uses in automotive applications. We discuss the physics of the various devices ﬁrst, then
explain the required interface electronics to convert the digital processor output to create
alphanumeric characters.
LED
The light-emitting diode is a semiconductor diode that is constructed in a manner and of
a material so that light is emitted when an electrical current is passed through it. The
semiconductor material most often used for an LED that emits red light is gallium arsenide
phosphide. Light is emitted at the diode’s pen junction when the positive carriers combine
with the negative carriers at the junction (see Chapter 3 for a discussion of pen junctions).
The diode is constructed so that the light generated at the junction can escape from the diode
and be seen. The light emitted by such a junction has a relatively narrow spectral bandwidth
such that it has a speciﬁc color. This spectrum is associated with the energy bandgap of the
carriers in the junction.
Physically, an LED consists of a chip of semiconducting material doped with impurities to
create a pen junction as depicted in Figure 9.12. The LED conﬁguration and excitation
voltage (Vex) source are depicted in Figure 9.12. The polarity for this voltage source forward
biases the junction. The majority charge carriers ﬂow readily across the junction region which
is of such a size as to have a high probability of a free election combining with a hole. In doing
so, the electron energy drops by an amount approximately equal to the bandgap energy DEg.
474
Chapter 9

This drop in energy causes a photon of frequency n to be released. The photon frequency is
proportional to the energy change of the electron:
n ¼ DEg
h
(13)
where h is the Planck’s constant. The wavelength (l) of the photon is given by
l ¼ c
n ¼ ch
DEg
(14)
where c is the speed of light.
The color of the emitted light is determined by its wavelength which, in turn, depends upon
DEg. The energy bandgap (and hence the color of the emitted light) is determined by the
semiconductor material as well as by doping and fabrication.
The light is emitted from an LED within a very narrow cone-shaped region whose axis is
orthogonal to the output side surface of the semiconductor chip. The angle of this cone is only
a few degrees from the normal to the surface because the semiconductor material has a very
high index of refraction relative to air (e.g. the index of refraction of silicon (Si) n ¼ 4.24
relative to air (1.000)). The index of refraction for any material n is given by
n ¼ co
c
where c is the speed of light in the material and c0 is the vacuum speed of light.
junction region
conduction band
band gap
valence band
+
+
+
+
–
–
–
–
Vex
light
Δ Eg
p-type
n-type
Figure 9.12:
LED conﬁguration and energy bands.
Automotive Instrumentation and Telematics
475

Light leaving a transparent medium can only escape the surface and be emitted when the
angle of incidence to the surface is less than the critical angle qc (measured from the normal to
the surface). The critical angle is the maximum angle of incidence of light leaving the Si
material at which it can leave the material. Angles of incidence greater than qc result in total
internal reﬂection with no light leaving the material. For the LED, qc is given by
qc ¼ sin1ð1=niÞ
¼ sin1ð1=4:24Þ
¼ 13:6
Any photon reaching the surface at an angle greater than the critical angle is internally
reﬂected. Often, LED chip surfaces are convoluted with angled facets to increase light output
and reduce internal reﬂections.
An LED display is normally made of small dots or rectangular segments arranged so that
numbers and letters can be formed when selected dots or segments are turned on. The
conﬁguration for these segments is described in greater detail later in this chapter in the
section on VFD. In the early stages of development, a single LED was not well suited for
automotive display use because of its low brightness. Although it could be seen easily in
darkness, it was difﬁcult to impossible to see in bright sunlight. However, LED technology
has evolved such that it is presently a technology capable of signiﬁcant illumination.
LCD
The LCD display is commonly used in electronic digital watch displays because of its
extremely low electrical power and relatively low-voltage requirements. The heart of an LCD
is a special liquid that is called a twisted nematic liquid crystal. This liquid has the capability
of rotating the polarization of linearly polarized light.
The conﬁguration of an LCD can be understood from the schematic drawings of Figure 9.13.
The liquid crystal is sandwiched between a pair of glass plates that have transparent,
electrically conductive coatings. The transparent conductor is deposited on the front glass
plate in the form of the character, or segment of a character, that is to be displayed. Next,
a layer of dielectric (insulating) material is coated onto the glass plate to produce the desired
alignment of the liquid-crystal molecules. The polarization of the molecules is vertical at the
front, and they gradually rotate through the liquid-crystal structure until the molecules at the
back are horizontally polarized. Thus, the molecules of the liquid crystal rotate 90 from the
front plate to the back plate so that their polarization matches that of the front and back
polarizers with no voltage applied. The operation of an LCD display depends fundamentally
upon polarization of light. Before proceeding with an explanation of the LCD operation, it is
helpful to review optical polarization.
476
Chapter 9

Polarization of an electromagnetic wave (including light) is associated with the orientation
of the electric (E) and magnetic (H) ﬁelds which describe its propagation. At great
distances from the source an electromagnetic wave (e.g. radio wave) at a single frequency
u ¼ 2pv can be represented locally by a so-called plane wave in which the surfaces of
constant phase lie in planes orthogonal to the direction of propagation (here taken to be
the z direction). The electric ﬁeld intensity vector E is assumed to be x-directed and is
given by
Eðz; tÞ ¼ Ex^xejðutkzÞ
(15)
where
k ¼ 2p
l
^x is the unit vector in x direction and where l is the wavelength:
l ¼ c
v
Figure 9.13:
Typical LCD construction.
Automotive Instrumentation and Telematics
477

where c is the speed of light in the medium of propagation:
c ¼ co
n
co is the vacuum speed of light and n is the index of refraction of the medium.
The magnetic ﬁeld intensity vector H is given by
Hðz; tÞ ¼ H^yejðwtkzp=2Þ
(16)
where ^y is a unit vector in the y direction.
The above electromagnetic wave is said to be linearly polarized because the ﬁeld intensities
E; H have the directions ^x and ^y, respectively. Light from the sun and from most artiﬁcial light
sources is not polarized, and the ﬁeld intensity vectors are randomly directed.
Nonpolarized light can be made to be linearly polarized by passing the light through
a polarizing material. For example, light can be polarized by passing it at an angle through
a so-called birefringent material. Calcite is an example of a crystalline birefringent material
which has the property of having two different indices of refraction for orthogonal light
polarizations relative to the crystal axes. At the exit surface, light exiting at an angle within
certain limits will pass the polarized component with the lower index of refraction. The
polarization component having the larger index of refraction will be reﬂected at the surface
and will not leave the exit surface. Thus, the light exiting this material is linearly polarized.
There are other physical means of polarization light as well.
If a second polarizer is placed behind the ﬁrst (in the direction of propagation) with its
polarization axis orthogonal to the ﬁrst, any light exiting the ﬁrst polarizer will not pass
through the second. Such an orientation is termed “cross-polarized” polarizers.
The operation of the LCD in the absence of applied voltage can be understood with reference
to Figure 9.14a. Ambient light enters through the front polarizer so that the light entering the
front plate is vertically polarized. As it passes through the liquid crystal, the light polarization
is changed by the orientation of the molecules. When the light reaches the back of the crystal,
its polarization has been rotated 90 so that it is horizontally polarized and passes through the
rear horizontal polarizer. The light is reﬂected from the reﬂector at the rear. It passes back
through the liquid-crystal structure, the polarization again being rotated, and passes out of the
front polarizer. Thus, a viewer sees reﬂected ambient light and does not see the segment.
The effect of an applied voltage to the transmission of light through this device can be
understood from Figure 9.14b. A voltage applied to any of the segments of the display
causes the liquid-crystal molecules under those segments only to be aligned in a straight line
478
Chapter 9

rather than twisted. In this case, the light that enters the liquid crystal in the vicinity of the
segments passes through the crystal structure without the polarization being rotated. Since
the light has been vertically polarized by the front vertical polarizing plate, the light is
blocked by the horizontal polarizer so it cannot reach the reﬂector. Thus, light that enters the
cell in the vicinity of energized segments is not returned to the front face. These segments
will appear dark to the viewer, the surrounding area will be light, and the segments will be
visible in the presence of ambient light. Thus, a voltage of sufﬁcient amplitude applied to
any segment of an LCD will darken it relative to the surrounding region. Selective
application of voltage to a multisegment LCD display gives it the capability of displaying
alphanumeric characters.
The LCD is an excellent display device because of its low power requirement and relatively
low cost. However, a potential disadvantage of the LCD for automotive application is the
need for an external light source for viewing in the dark. Its characteristic is just the opposite
Figure 9.14:
Liquid-crystal polarization.
Automotive Instrumentation and Telematics
479

of the LED; that is, the LCD is readable in the daytime, but not at night. For night driving, the
display must be illuminated by small lamps inside the display. Another disadvantage is that
the display does not work well at the low temperatures that are encountered during winter
driving in some areas. These characteristics of the LCD have limited its use in automotive
instrumentation.
Transmissive LCD
An LCD can also function as an optical transmission device from a light source at the rear of
the structure to the front face. A conﬁguration such as this permits an LCD to display
messages in low ambient light conditions (e.g. nighttime). The intensity of the backlight for
a transmission to type LCD is automatically adjusted to produce optimum illumination as
a function of the signal from an ambient light level sensor located inside the passenger
compartment.
Some display manufacturers produce an LCD that combines reﬂective and transmissive
structures in a so-called transﬂexive LCD structure. The combination of these two basic LCD
types in a package permits optimal readability to be achieved for automotive displays over the
entire range of ambient light conditions from bright sunny days to the darkest night
conditions.
Another evolution of LCD technology has permitted automotive displays to be available in
multiple colors. The LCD conﬁguration described above is a black and white display. A
suitable color ﬁlter placed in front of the mirror in a reﬂective LCD or in front of the backlight
in a transmissive LCD yields a color display, with the color being determined by the optical
ﬁlter.
Still another evolution in LCD technology is the development of a very large array of
programmable multicolor displays. Such displays are capable of presenting complex
programmable alphanumeric messages to the driver and can also present graphical data or
pictorial displays (e.g. electronic maps). Since the array structure LCD is functionally similar
to the ﬂat panel type, a detailed discussion of this array type is deferred to the section of this
book devoted to the discussion of the ﬂat panel solid-state display.
VFD
The VFD has been widely used in automotive instrumentation, although the multicolor LCD
is becoming the preferred choice for this application. This device generates light in much the
same way as a cathode ray tube (e.g. early oscilloscope or TV display) does; that is, a material
called phosphor emits light when it is bombarded by energetic electrons. The display uses
a ﬁlament coated with material that generates free electrons when the ﬁlament is heated. The
480
Chapter 9

electrons are accelerated toward the anode by a relatively high voltage. When these high-
speed electrons strike the phosphor on the anode, the phosphor emits light. A common VFD
has a phosphor that emits a blueegreen light that provides good readability in the wide range
of ambient light conditions that are present in an automobile. However, other colors (e.g. red
or yellow) are available by using other phosphors.
The numeric characters are formed by shaping the anode segments in the form of a standard
seven-segment character. The basic structure of a typical VFD is depicted in Figure 9.15. The
ﬁlament is a special type of resistance wire and is heated by passing an electrical current
through it. The coating on the heated ﬁlament produces free electrons that are accelerated by
the electric ﬁeld produced by a voltage on the accelerating grid. This grid consists of a ﬁne
wire mesh that allows the electrons to pass through. The electrons pass through because they
are attracted to the anode, which has a higher voltage than the grid. The high voltage is
applied only to the anode of the segments needed to form the character to be displayed. The
instrumentation computer selects the set of segments that are to emit light for any given
message. For those readers familiar with vacuum tube technology, the VFD is, in effect,
a form of such a device.
Since the ambient light in an automobile varies between sunlight and darkness, it is desirable
to adjust the brightness of the display in accordance with the ambient light. The brightness is
controlled by varying the voltage on the accelerating grid. The energy of the electrons striking
Figure 9.15:
Simpliﬁed vacuum-ﬂuorescent display conﬁguration.
Automotive Instrumentation and Telematics
481

the phosphor and the brightness of the light is an increasing function of the grid voltage.
Figure 9.16 shows the brightness characteristics for a typical VFD device.
A brightness of 200 fL (foot-lamberts) might be selected on a bright sunny day, whereas the
brightness might be only 20 fL at night. The brightness can be set manually by the driver, or
automatically. In the latter case, a photoresistor is used to vary the grid voltage in accordance
with the amount of ambient light. A photoresistor is a device whose resistance varies as
a function of the amount of light striking it (see discussion of optical sensors in Chapter 6).
The VFD operates with relatively low power and operates over a wide temperature range. The
most serious drawback for automotive application is its susceptibility to failure due to
vibration and mechanical shock. However, this problem can be reduced by mounting the
display on a shock-absorbing isolation mount.
All of the display devices when used to present alphanumeric characters require interface
electronics that receive as input the output signals from the digital system and generate the
electrical signals necessary to activate the display segments for the character to be displayed.
Such interface is in the form of a so-called decoder circuit. For certain standard digital signal
formats, the decoder may be packaged with the display circuitry. Each segment has its own
electrical lead from which it is activated. The decoder maps the input M-bit binary signal into
the segment leads that are used to create the particular character. The details of this decoder
operation are explained further in the next section of this chapter.
The display devices that have been discussed to this point have one rather serious limitation.
The characters that can be displayed are limited to those symbols that can be approximated by
Figure 9.16:
Brightness control range for vacuum-ﬂuorescent display.
482
Chapter 9

the segments that can be illuminated. Furthermore, illuminated warning messages such as
“Check Engine” or “Oil Pressure” are ﬁxed messages that are either displayed or not,
depending on the engine conditions. The primary disadvantage of such ad hoc display devices
is the limited ﬂexibility of the displayed messages.
Flat Panel Display
Arguably, the display device with the greatest ﬂexibility for presenting all types of data
(including pictorial representations) is the so-called ﬂat panel display. This type of display is
being used increasingly for display purposes in the aerospace industry, where it is used to
display aircraft attitude information (sometimes pictorially), aircraft engine or airframe
parameters, navigational data, and warning messages. It is known in the aerospace industry as
the “glass cockpit.” Clearly, the ﬂat panel (FPD) display has great potential for automotive
instrumentation display. The FPD can be implemented with various electro-optical
technologies as described above. We assume for convenience that LCD technology is
employed in the following discussion.
A solid-state LCD display consists of an array of LCDs arranged in a matrix format as
depicted in Figure 9.17. The individual elements in such a display are termed pixels. In this
Figure 9.17:
Solid-state array-type display.
Automotive Instrumentation and Telematics
483

structure, only one LCD is active at any time. The intensity of the active LCD is controlled by
circuitry connected within the microstructure. The active LCD is selected via horizontal and
vertical control circuitry. In the FPD, each pixel has its own address. The presentation of
alphanumeric or pictorial data requires activation of the associated pixels. This can be done
by separately addressing and activating each pixel. However, this is a highly inefﬁcient use of
the instrumentation computer. An efﬁcient use of this computer involves a scanning method
of presenting pixel data in a stand-alone display controller as explained below in the form of
a raster-type scan.
One scheme for achieving a solid-state raster scan display device is to construct an array of
elements that can be physically LED, VFD, or LCD, as depicted in Figure 9.17. These
elements are interconnected with two grids of wires, one running vertically and one running
horizontally. Each vertical wire is connected to all of the elements in a given column. Each
horizontal wire similarly interconnects all of the elements in a given row.
The presentation of alphanumeric or graphical data requires activating the individual pixel
elements that make up the visual pattern to be displayed. For simplicity we consider only
“black/white”-type display, although color display is a simple extension of the present
concept. The location of any given pixel in the display is given by its coordinates in an xey
matrix. The mth column of the horizontal position of the display is given by x-coordinate xm,
xm ¼ mDX
where DX is the distance in the lateral direction between consecutive columns.
The vertical position of the nth row yn is given by
yn ¼ nDy
where Dy is the distance in the vertical (i.e. y) direction between consecutive rows.
One way of presenting the visual information in a display is to incorporate a raster (i.e. the
name of the pattern of analog TV scanning) type scan in which the position of any pixel is
a repetitive function of time. In a raster type of scan, the pixels in a row are presented
sequentially (e.g. from left to right) and the rows are presented sequentially (e.g. top to
bottom). For such a display, the pixel located at xmyn is selected at time tm,n where
tm;n ¼ nTpy þ mTpx
n ¼ 1; 2.N; m ¼ 1; 2.M
(17)
and where
Tpy ¼ MTpx
484
Chapter 9

and
Tc ¼ NTpy
where Tc is the period required to scan the entire display:
Tc ¼ 1
fc
fc ¼ picture cycleðor refresh rateÞ
Tpx ¼ 1
fx
(18)
fx ¼ frequency at which columns are scanned
Tpy ¼ 1
fy
(19)
fy ¼ frequency at which rows are scanned
In a raster scan type of display, the scanning is done for one row at a time from left to right
beginning at the top row during each complete scanning cycle. For the nth row at time nTpy, m
sequentially changes from 1 to M. At the completion of the scan for row n (i.e. at time
nTpy þ MTpx), the next row (i.e. n þ 1) is active and horizontal scan begins again. The
process continues until all N rows have been scanned. At this time (i.e. t ¼ NTpy þ MTpx),
a cycle is complete and the entire visual display has been presented. There are speciﬁc
relationships between these frequencies: fy ¼ Nfc and fx ¼ Mfy. The cycle frequency must be
sufﬁciently fast that the image appears to the driver as a continuous display (e.g. fc is in the
range from 30 to 60 Hz typically).
One hypothetical conﬁguration for implementing this raster-type scan is shown schematically
in Figure 9.18. This conﬁguration uses a separate counter and one of M select decoder for
activating the desired column, and another counter and one of N select decoder select for
activating the desired row. For the purposes of this discussion it is assumed that whenever the
mth column electrical lead and the nth row lead are simultaneously at high voltage the pixel at
Automotive Instrumentation and Telematics
485

xm,yn is active. By active we mean that it is illuminated if it is an LED or VFD type or made
dark in an otherwise illuminated matrix if it is an LCD. The control of whether a pixel is
active or not in this hypothetical conﬁguration is controlled by the digital display via logical
signals Er and Ec, which either enable the signal for a given column or disable it via separate
AND gate for each column output. Whenever a given pixel (e.g. xm,n) is to be activated the
logical signals Er and Ec are set high by the controller at time tmn.
The column counter receives clock (Ck) pulses at frequency fx. For each pulse received, the
column counter is incremented by one continuing modulo M. Similarly, the row counter receives
clock pulses at frequency fy and is incremented by one for each received pulse (modulo N). A
counter can readily be made to count modulo M or N for any pair of integers using appropriate
logic circuits connected to the parallel out counter leads (see Chapter 4). The decoder circuits are
one of M and one of N select logic circuits that receive the parallel counter output signals. These
circuits place a high voltage on the column number corresponding to the counter contents.
It is assumed that the column select period Tpx is sufﬁciently long to activate any given pixel.
It is further assumed that the cycle refresh period Tc is sufﬁciently short that the display can be
perceived by the viewer as a complete picture. This perception is inﬂuenced by human visual
persistency as well as the illumination period. It has long been known from analog TV that
a refresh frequency of 60 Hz is sufﬁcient to satisfy the visual persistency requirement.
In the above-described raster-type scan operation of a ﬂat panel display, the counters and
“clocks” at frequencies fx fy are internal to the digital display controller. In such a conﬁguration,
the row and column counters can provide the address for the “pixel-active” binary value on
signals Er and Ec. Whenever this pixel is to be active, the digital system logical output, to each
of the column select AND gates is set high, enabling the corresponding pixel. Whenever it is to
binary counter / decoder
counter
decode
columns
rows
x1
Er
Dx
Ec
Ck
y1
y2
yn
yN
fy
Ck
fx
xm
xm
Figure 9.18:
Schematic illustration of representative pixel drive circuits.
486
Chapter 9

be inactive, this signal is set to logical low, thereby inhibiting the column select signal from
establishing the voltage output column lead and, in turn, thereby rendering that pixel inactive.
A block diagram of the complete hypothetical ﬂat panel display is shown in Figure 9.19. In this
system, the digital instrumentation system, which is microprocessor based and which is under
program control, receives input signals from all necessary sensors. The inputs may be analog or
digital. For each analog signal, conversion to digital format is performed by an A/D converter.
The digital control system performs all signal-processing operations, computing in this process
anoutputappropriatefordisplayingeachvariablebeingmeasuredandstoringthisvalueinRAM.
The logical value for each pixel i.e. whether active (i.e. on) or inactive (i.e. off) must be
determined to achieve the desired display pattern. It is beyond the scope of this book to
explain the software for creating any and all patterns to be displayed for a complex graphical,
simulated analog (e.g. for vehicle speed) or pictorial display. However, whenever the display
is to be alphanumeric at a speciﬁc location, the patterns for each pixel are known in advance
and are readily stored in ROM. The display conversion process requires only selection of the
pixel logical pattern for the desired alphanumeric character.
An alternative to a raster-type ﬂat panel display is a so-called random access display. This
type of display is advantageous for displaying patterns that either change relatively slowly or
change at random (rather than periodically).
In this type of display rather than control of each pixel for every display cycle the digital
instrumentation system uses an intermediate RAM that we call a video RAM. Here, the term
random access refers to the access of video RAM by the controller. The digital system
transmits only changes to the display pattern when such change is required. The video RAM
contains the logical value for each pixel in the display. This logical value Enm corresponding
to the pixel at xm,yn is determined by the digital system under program control.
A block diagram of a hypothetical random access-type display is shown in Figure 9.20. In the
display depicted in Figure 9.20, the logical variables Em,n for each pixel are stored at memory
control
for
digital 
instrumentation
system
row counter/
decoder
Display
column counter/
decoder
Er
S1
S2
Sk
Ec
fPx
fPx
Figure 9.19:
Block diagram for ﬂat panel display controller.
Automotive Instrumentation and Telematics
487

locations corresponding to pixel locations xm,yn via address buses carrying addresses m and n
corresponding to position xm and yn respectively. The logical value (Emn) for each pixel is
supplied via DIN during a data write operation by the computer. The counter decoder for x and
y ðC=DX and C=Dy respectively) contain M and N bit binary numbers that are used as the
address for each logical variable. In the system shown in Figure 9.20, the x and y C/D
sequentially scan the addresses for each pixel in a raster-type pattern. This pattern is repeated
at cycle frequency fc which continuously refreshes the display.
The digital system can “write” data (see Chapter 4) into a memory location in video RAM
(i.e. xm,yn) at times when the display is not reading data during its scan pattern.
The two hypothetical ﬂat panel display conﬁgurations discussed above are representative of
a broad range of potential display technologies for automotive use. However, regardless of
display technology used and even in cases for which the display is not changing, refresh is
required within the time interval of human visual persistence in order to have a recognizable/
readable display.
We next consider the structure and operation of an FPD controller that functions in
conjunction with the instrumentation computer to cause the scanning display to be generated.
Digital
Instrumentation 
Computer
Display
Video
RAM
(Emn)
C/Dx
C/Dy
n
DIN
fpy
fpx
m
S1
yN
y1
x2
xM
x1
y2
S2
Sk
Ay
Ax
Figure 9.20:
Random access display block diagram.
488
Chapter 9

instrumentation 
computer
source 
signals
horizontal 
counter/
decoder
FPC
FPD
display 
RAM
vertical 
(row) 
decoder
video data
Vc
AB
DB
R/T
DB1
AB1
AB0
HL
D
fc
VL
Emn
Figure 9.21:
Block diagram of automotive instrumentation with FPD.
A simpliﬁed block diagram for a system incorporating an FPD-type display with the
associated controller is depicted in Figure 9.21.
The source signals to be displayed (e.g. from the sensors) and instrumentation computer,
which are microprocessor (MPU) based, shown at the left of this illustration have the same
function as the corresponding components of the system in Figure 9.2. The output of the
instrumentation computer controls the ﬂat panel display, working through ﬂat panel display
controller (FPC).
In the example architecture of Figure 9.21, it is assumed that the instrumentation computer
communicates with the FPC via data and address buses (DB and AB), and controls its
operation via a serial link along a line or set of lines labeled receiver/transmitter (R/T).
However, many other choices of data link are possible. The data that are sent over the DB are
stored in a special memory called display RAM. This memory stores digital data that are to be
displayed in alphanumeric or pictorial patterns on the ﬂat panel display FPD. The controller
obtains data from the video RAM and converts them to the relevant video signal (Vc). At the
same time, the controller activates the horizontal and vertical lines for each pixel in
synchronism with the video signal.
The ﬂat panel controller in the example system (Figure 9.21) itself incorporates an MPU for
controlling the FPD. The data to be displayed are stored in the display RAM via the system
buses under control of the instrumentation computer. The operation of the MPU is controlled
by programs stored in a display ROM (DROM). This ROM might also store data that are
required to generate particular characters. The various components of the display controller
are internally connected by means of data and address buses similar to those used in the
instrumentation computer.
Automotive Instrumentation and Telematics
489

The operation of the display controller is under control of the instrumentation computer. This
computer transfers data that are to be displayed to the video RAM, via address bus AB and
data bus DB and signals the display controller via control R/T. The FPC outputs a clock signal
at frequency fc to the horizontal counter/decoder and initiates counting via control D in
Figure 9.21. It is assumed for this example that the instrumentation computer transfers data
one row at a time. The FPC loads the address of the active row into the vertical decoder circuit
which activates the line for that vertical row. The FPC outputs the display video signal
synchronously with the horizontal decoder such that the active pixel has the correct
excitation.
The details of the transfer of data to the video generator and the corresponding generation of
video signals vary from system to system. In the hypothetical system shown in Figure 9.21,
the display is assumed to be an array of LED, VFD, or LCD elements arranged in 240 rows
vertically by 480 columns horizontally. Figure 9.22 depicts a small section of the display in
which the characters F and P are displayed. The dots are generated by switching on the active
element at the desired location by reading the pixel logical variable Emn at address given by
the binary address ½xm; yn and activating the elements of Emn ¼ 1 or having it remain inactive
if Emn ¼ 0.
The enormous ﬂexibility of the ﬂat panel type display offers the potential for a very
sophisticated automotive instrumentation system. In addition to displaying the variables and
Figure 9.22:
Display of characters F and P.
490
Chapter 9

parameters that have traditionally been available to the driver, the FPD-type display can
present engine data for diagnostic purposes (see Chapter 10), vehicle comfort control system
parameters, and entertainment system variables. It should be noted that IP conﬁgurations vary
widely between the various automobile manufacturers and vehicle models. We have
presented only an illustrative sample of IP example conﬁgurations here.
Fuel Quantity Measurement
Having described the various components and implementation of automotive
instrumentation, we now present some speciﬁc measurement examples. During
a measurement of fuel quantity, the MUX switch functionally connects the computer input to
the fuel quantity sensor, as shown in Figure 9.23. This sensor output is converted to digital
format and then sent to the computer for signal processing. (Note: In some automotive
systems, the analog sensor output is sent to the instrumentation subsystem, where the A/D
conversion takes place.)
Figure 9.23:
Fuel quantity measurement system.
Automotive Instrumentation and Telematics
491

Several fuel quantity sensor conﬁgurations are available. Figure 9.24 illustrates the type of
sensor to be described, which is a potentiometer connected via mechanical linkage to a ﬂoat. In
Chapter 6, a potentiometerwas introducedas a sensor for measuring throttle angularposition. It
also has application in certain fuel-measuring instrumentation. Normally, the sensor is
mounted so that the ﬂoat remains laterally near the center of the tank for all fuel levels. A
constant current passes through the sensor potentiometer, since it is connected directly across
the regulated voltage source. The potentiometer is used as a voltage divider so that the voltage
at the wiper arm is related to the ﬂoat position, which is determined by fuel level.
The sensor output voltage is not directly proportional to fuel quantity in gallons because of the
complex shape of the fuel tank. The computer memory contains the functional relationship
between sensor voltage and fuel quantity for the particular fuel tank used on the vehicle.
The computer reads the binary number from the A/D converter (see Figure 9.23) that
corresponds to sensor voltage and uses it to address a particular memory location. Another
binary number corresponding to the actual fuel quantity in gallons for that sensor voltage is
stored in that memory location. The computer then uses the number from memory to generate
the appropriate display signal (either analog or digital, depending on display type) and sends
that signal via DEMUX to the display.
Computer-based signal processing can also compensate for fuel slosh. As the car moves over
the road, the fuel sloshes about and the ﬂoat moves up and down around the average position
that corresponds to the correct level for a stationary vehicle. The computer compensates for
slosh by computing a running average of the fuel sensor voltage (v0(t)of Figure 9.24). It does
Figure 9.24:
Fuel quantity sensor conﬁguration.
492
Chapter 9

this by storing several samples over a few seconds and computing the arithmetic average of
the sensor output or by low-pass ﬁltering the sensor voltage. The oldest samples are
continually discarded as new samples are obtained. The averaged output becomes the signal
that drives the display. It should be noted that this is actually a form of digital ﬁltering.
Let vn ¼ v0ðtnÞ be the fuel sensor voltages at the nth sample time. The actual fuel quantity is
denoted F; the sensor voltage v0 is a known function of F for any fuel/angle sensor
combination such that the sensor terminal voltage is given by:
v0 ¼ fFðFÞ
(20)
The instrumentation computer (under program control) computes the sampled measurement
Fn from vn:
Fn ¼ f 1
F ðvnÞ
(21)
The short-term time average of fuel quantity Fav is given by
FavðnÞ ¼ 1
N
X
N
m¼1
Fnm ¼ 1
N
X
N
m¼1
f 1
F ðvnmÞ
(22)
The sloshing effect of fuel on fuel gauge indicated value can be reduced by ﬁltering the fuel
sensor output. A block diagram of a fuel measurement instrumentation conﬁguration is shown
in Figure 9.25.
In this ﬁgure, the sensor output voltage is given by Eqn (20). The digital signal processing
(DSP) is implemented in the instrumentation computer and includes the nonlinear correction
block (NLC) which calculates the quantity of fuel F from the sampled sensor voltage as given
in Eqn (21). The DSP also includes a low-pass ﬁlter LPF which has z-transfer function HspðzÞ.
This latter calculation is done in a separate subroutine as a recursive algorithm. It should be
noted that the short-term time average of fuel quantity also is effectively a form of LPF.
It is assumed for the sake of illustration that the display device is an analog meter of the
galvanometer conﬁguration explained earlier in this chapter. It is further assumed that the
scale is marked such that for a full tank q is at full scale and for an empty tank q ¼ 0 with
fuel quantity F expressed as a fraction of full tank is given by deﬂection q. The continuous
F
Sensor
NLC
fF
-1 (vn)
LPF
Hsp(z)
ZOH
D
Fi
v1
yn
xn
vo
vn
Figure 9.25:
Filtering fuel sensor signal.
Automotive Instrumentation and Telematics
493

time transfer function for this type of display ðH0ðsÞÞ was shown earlier (Eqn (12)) to be
given by
HDðsÞ ¼ qðsÞ
v1ðsÞ
¼
KcNBr
ðJs2 þ sD þ KÞ½ðRc þ RsÞ þ sLc
(23)
where v1 is the signal processing output of Figure 9.25 and is the source voltage for the
galvanometer display.
A typical galvanometer display is designed such that the torque component proportional to
the moment of inertia (J) is insigniﬁcant compared to the damping and spring torques. Thus,
the transfer function is given approximately by its dominant pole factor:
H0ðsÞy
KcNBr
DLCðs þ s0Þðs þ sLÞ
(24)
where
s0 ¼ K
D
sL ¼ Rs þ Rc
Lc
Using numerical values for a representative automotive analog fuel gauge, these frequency
parameters are the approximate ranges given below:
s0y0:5 to 2:0
sLy105 to 106
The large disparity in these pole locations makes the pole at s0 the dominant pole and that at sL
a so-called insigniﬁcant pole. The result of this disparity is that the transfer function is
approximately given by
HDðsÞy
KcNBr
DðRs þ RcÞðs þ s0Þ
¼
KD
s þ s0
(25)
494
Chapter 9

where KD is a constant for the display that is given by
KD ¼
KcNBr
DðRs þ RcÞ
(26)
Using the methods of Chapter 2 it can be shown that the z-transfer function for the
combination ZOH and display HD(z) is given by
HDðzÞ ¼ ð1  z1ÞZ
HDðsÞ
s

(27)
Representative values for K and S0 are given by
KD ¼ 0:5
s0 ¼ 0:5
For a sample period of T ¼ 0.001 sec, the z-transfer function is given by
HDðzÞ ¼ ð1  z1Þ
ðz  z1Þ
(28)
where z1 ¼ es0T ¼ 0:9995
The digital ﬁlter is chosen as a second-order Butterworth ﬁlter having a digital corner
frequency Uc ¼ 0.001. It can be shown that the z-transfer function for this ﬁlter is
HspðzÞ ¼ 105½0:2462z2 þ 0:4924z þ 0:2462
z2  1:9956z þ 0:9956
(29)
The dynamic performance of this digital fuel measurement system can readily be
demonstrated via simulation. The SIMULINK simulation model block diagram is shown in
Figure 9.26. The fuel tank is assumed to be ½ full (F ¼.5) and the fuel slosh is simulated in
MATLAB/SIMULINK via a ﬁltered white noise source.
In this block diagram, fuel slosh is created using a random number generator ﬁltered to yield
a band-limited stationary random process. This random process is combined with the constant
0.5 representing the ½ full tank. The block labeled discrete transfer function is the second-
order Butterworth digital ﬁlter having transfer function Hsp(z) of Eqn (29). The ﬁnal
continuous time transfer function represents the display dynamic response having gain
KD ¼ 0.5 and bandwidth so ¼ 0.5.
Automotive Instrumentation and Telematics
495

A sample of the system response is shown in Figure 9.27 in which the dashed curve represents
the unﬁltered fuel measurement and the solid line represents the displayed value. The ﬁltered
display deviates only slightly (i.e. less than 1%) from the true value of F ¼ 0.5 (i.e. 1/2 tank of
fuel), but the random ﬂuctuations due to fuel slosh are completely suppressed.
Figure 9.26:
SIMULINK model for fuel quantity instrument subsystem.
Figure 9.27:
Filtered fuel quantity F (solid line) and unﬁltered fuel quantity (dashed line).
496
Chapter 9

Coolant Temperature Measurement
Another important automotive parameter that is measured by the instrumentation is the
coolant temperature. The measurement of this quantity is different from that of fuel quantity
because usually it is not important for the driver to know the actual temperature at all times.
For safe operation of the engine, the driver only needs to know that the coolant temperature is
less than a critical value. A block diagram of the measuring system is shown in Figure 9.28.
The coolant temperature sensor used in most cars is a solid-state sensor called a thermistor.
Recall that this type of sensor was discussed in Chapter 6, where it was shown that the
resistance of this sensor decreases with increasing temperature. Figure 9.29 shows the circuit
connection and a sketch of a typical sensor output voltage (vo) versus temperature (T) curve.
The sensor output voltage is sampled during the appropriate time slot and is sampled (S)
converted to a binary number equivalent by the A/D converter. The computer compares this
binary number to the one stored in memory that corresponds to the high-temperature limit. If
the coolant temperature exceeds the limit, an output signal is generated that activates the
Figure 9.28:
Coolant temperature measurement.
Automotive Instrumentation and Telematics
497

warning indicator. If the limit is not exceeded, the output signal is not generated and the
warning message is not activated. A proportional display of actual temperature can be used if
the memory contains a cross-reference table between sensor output voltage and the
corresponding temperature, similar to that described for the fuel quantity table.
Oil Pressure Measurement
Engine oil pressure measurement is similar to coolant temperature measurement in that it
frequently uses a warning message display rather than an indicated numerical value, although
certain high-performance vehicles contain a display that either simulates an analog oil
pressure gauge or uses a galvanometer-type display. Whenever the oil pressure is outside
allowable limits, a warning message is displayed to the driver. In the case of oil pressure, it is
important for the driver to know whenever the oil pressure falls below a lower limit. It is also
possible for the oil pressure to go above an allowable upper limit; however, many
manufacturers do not include a high oil pressure warning in the instrumentation.
The simplest oil pressure warning system involves a spring-loaded switch connected to
a diaphragm. The switch assembly is mounted in one of the oil passageways such that the
diaphragm is exposed directly to the oil pressure. The force developed on the diaphragm by
the oil pressure is sufﬁcient to overcome the spring and to hold the switch open as long as the
Figure 9.29:
Coolant temperature sensor circuit.
498
Chapter 9

oil pressure exceeds the lower limit. Whenever the oil pressure falls below this limit, the
spring force is sufﬁcient to close the switch. Switch closure is used to switch on the low oil
pressure warning message lamp.
One of the deﬁciencies of this simple switch-based oil pressure warning system is that it has
a single ﬁxed low oil pressure limit. In fact, the threshold oil pressure for safe operation varies
with engine load. Whereas a relatively low oil pressure can protect bearing surfaces at low
loads (e.g. at idle), a proportionately higher oil pressure threshold is required with increasing
load (i.e. increasing horsepower and RPM).
An oil pressure instrument that operates with a load- or speed-dependent threshold requires an
oil pressure sensor rather than a switch. Such an oil pressure warning system is illustrated in
Figure 9.30. This system uses a variable-resistance oil pressure sensor (e.g. piezoresistive)
such as shown in Figure 9.31. Sensors of this type were discussed in Chapter 6. A voltage is
developed across a ﬁxed resistance connected in series with the sensor that is a known
function of oil pressure. It should be noted that this assumed pressure sensor is hypothetical
and used only for illustrative purposes.
Figure 9.30:
Oil pressure measurement instrumentation.
Automotive Instrumentation and Telematics
499

During the appropriate measurement time slot, the oil pressure sensor voltage is sampled
through the analog MUX switch and converted to a binary number in the A/D converter. The
computer reads this binary number and compares it with the binary number in memory for the
allowed oil pressure limits. The oil pressure limit is determined from load or crankshaft speed
measurements that are already available in the engine control system. These measurement
data can be sent to the instrument subsystem via a MUX system as described with respect to
Figure 9.5. These measurements serve as the address for a ROM lookup table to ﬁnd the oil
pressure limit. If the oil pressure is below the allowed lower limit or above the allowed upper
limit, an output signal is generated that activates the oil pressure warning light through the
DEMUX (see Figure 9.7).
It is also possible to use a proportional display of actual oil pressure. A digital display can be
driven directly from the computer. An analog display, such as a galvanometer, requires a D/A
converter.
Vehicle Speed Measurement
An example of a digital speed sensor has already been described in Chapter 8 for a cruise
control system. The speed sensor is assumed to be of a structure such as is depicted in
Figure 6.10 or 6.13. In either of these sensors, a single pulse is generated with the passage of
each lug on the disk. A sensor of this type is assumed to be used for car speed measurements.
Figure 9.31:
Oil pressure sensor.
500
Chapter 9

The output of the speed sensor is a sequence of pulses at frequency fp that is proportional to
car speed V:
fp ¼ ksV
(30)
where ks is a constant for the sensor system.
A block diagram of the digital system (including the instrumentation computer) that
determines vehicle speed from the speed sensor is depicted in Figure 9.32. Since the sensor
output pulse frequency is proportional to vehicle speed, a digital speed measurement can be
obtained by counting pulses for a given speciﬁc time interval (s). The pulse counting is
accomplished via a binary counter (see Chapter 4). The time interval during which sensor
output pulses are counted is determined by a control signal G from the instrumentation
control system (ICS).
The electronic gate of Figure 9.32 is functionally an electronically controlled switch (e.g.
implemented by an FET; see Chapter 3) whose state (i.e. open or closed) is controlled by the
binary valued signal represented by logical variable G.
The (ICS) periodically outputs this logical control signal such that G ¼ 1 corresponds to
closed gate for which sensor pulses are sent to the counter and G ¼ 0 corresponds to the gate
open and counting is inhibited as given below:
G ¼ 1
tk  t  tk þ s
¼ 0
tk þ s < t < tkþ1
tkþ1  tk ¼ Ts ¼ sample period
(31)
During the period in which G ¼ 1, each sensor pulse causes the counter to increment by one.
Thus, at time tk + s the counter contains count P where
P ¼
n
P fpsR
o
(32)
speed 
sensor
Instrumentation 
control system
binary
counter
electronic gate
G
V
fp
Figure 9.32:
Vehicle speed instrument subsystem.
Automotive Instrumentation and Telematics
501

where the brackets indicate the largest integer in the product fps. At some point during the
post counting interval (i.e. tk + s < t < tk + 1) the digital system generates signals necessary
to transfer the counter contents to a memory location.
Under program control, the vehicle speed is computed from the counter contents as given
below:
V ¼ P
kss
(33)
where ks is the speed sensor constant given above in Eqn (30).
The computer reads the number P in the binary counter, then resets the counter to zero to
prepare it for the next count. After performing computations and ﬁltering, the computer
generates a signal for the display to indicate the vehicle speed. Although it is possible to
display vehicle speed numerically, it is normally desirable to present speed using either
a galvanometer-type analog display or a display that simulates an analog scale/pointer (e.g.
FPD). A digital display can be directly driven by the computer. Either mph or kph may be
selected. If an analog display is used, a D/A converter must drive the display. Both mph and
kph usually are calibrated on an analog scale. A ﬂat panel display is now commonly used for
displaying such measurements. This display has sufﬁcient ﬂexibility and detailed resolution
that graphical data or electronic maps can be shown to the driver as explained earlier.
The data required for such displays can, for example, be transmitted via a high-speed digital
data (HSDD) link between the various on-board electronics systems. In the next section, we
discuss high-speed intermodule digital communication systems.
High-Speed Digital Communications (CAN)
As has been shown in the preceding sections of this book, there are multiple electronic
subsystems on board any vehicle. It is normal for various electronic subsystems to make
use of the same variable. For example, vehicle speed measurements are used by the
instrumentation subsystem, powertrain control, and possibly vehicle suspension or steering
subsystems. In order to share such measurements or to exchange other data (e.g. subsystem
status) it has become necessary to provide a high data rate digital communication, which is
often denoted HSDD for high-speed digital data link network in the vehicle.
Figure 9.33 is a block diagram of an integrated vehicle instrumentation system in which all
on-board electronic systems are coupled by an HSDD link.
This system requires a keyboard (KB) or a similar input device (e.g. touch pad) for operator
control. The driver can, for example, select to display the entertainment system operation.
This display mode permits the driver to select radio, tape, or CD, and to tune the radio to the
502
Chapter 9

desired station and set the volume. In vehicle diagnostic mode, the ﬂat panel display can be
conﬁgured to display the parameters required by the service technician for performing
a diagnosis of any on-board electronic system (see Chapter 10).
In Figure 9.33, several electronic subsystems are connected by the digital data link. Tying
systems together this way has great potential performance beneﬁts for the vehicle. Each
automotive subsystem has its own primary variables, which are obtained through
measurements via sensors. A primary variable in one subsystem might be a secondary
variable in another system. It might not be cost effective to provide a sensor for a secondary
variable to achieve the best possible performance in a stand-alone subsystem. However, if
measurement data can be shared via the digital data link, then the secondary measurement is
potentially available for use in optimizing performance. Furthermore, redundant sensors for
measuring primary variables can be eliminated by an integrated electronics system for the
vehicle. For example, wheel speed measurements are primary variables for ABS systems and
are also useful in electronic transmission control.
The various subsystems in Figure 9.33 have all been identiﬁed in other sections of this book
and will not be discussed further here, except for the system manager. This subsystem is
responsible for coordinating data transfer and regulating the use of the data bus so that no two
systems are transmitting simultaneously.
Figure 9.33:
Block diagram for vehicle digital data system
Automotive Instrumentation and Telematics
503

CAN Network
Essentially, the digital data link provides a sophisticated communication system between
various subsystems. Among the issues of importance for such a communication system are
the protocol and message format. It is highly advantageous to have a standard protocol for all
automobiles. The Society of Automotive Engineers (SAE) has developed a standard
speciﬁcation for an HSC which it terms a “Controller Area Network” or CAN. This CAN
operates at a data rate of 500 kilobits/sec (KBSC) and can be implemented with wire or
optical ﬁber. Originally developed for passenger car applications, CAN is a form of local area
network that permits data to be shared.
Some form of network arbitration is required for determining priority of the use of the link
whenever there is conﬂict between subsystems for its use. This feature is typically handled by
the system manager subsystem (see Figure 9.33).
The basic message structure is derived assuming that the majority of data on the link are
regularly sent. This means that the content of each message is known (only the actual data
varies). The standards and speciﬁcations for the CAN network are given in a document
published by SAE which is given the designation (in the latest version) J-2284-3.
In the CAN concept, each electronic subsystem that is connected to the CAN (called ECU in
J-2284-3) incorporates communication hardware and software, permitting it to function as
a communication module referred to as a gateway. CAN is based on the so-called broadcast
communication mechanism in which communication is achieved by the sending gateway (i.e.
subsystem) transmitting messages over the network (e.g. wire interconnect). Each message
has a speciﬁc format (protocol) that includes a message identiﬁer. The identiﬁer deﬁnes the
content of the message, its priority, and is unique within the network. In addition to the data
and identiﬁer, each message includes error-checking bits as well as beginning and end of ﬁle
bits. In the most recent version of J-2284-3, the message identiﬁer is 29 bits.
The CAN communication system has great ﬂexibility, permitting new subsystems to be added
to an existing system without modiﬁcation, provided the new additions are all receivers. Each
gateway (subsystem) can be upgraded with new hardware and software at any time with
equipment that was not available at the time the car left the manufacturing plant or even when
it left the dealer. Essentially, the CAN concept with its open architecture frees the
development of new telematics applications from the somewhat lengthy development cycle of
a typical automobile model. Furthermore, it offers the potential for the aftermarket addition of
new subsystems.
The SAE J-2284-3 standard is a recommended practice document (one of many published by
SAE) that deﬁnes the CAN in terms of its physical layer and portions of the data link layer. It
primarily focuses on a minimum standard level of performance from the HSDD CAN
504
Chapter 9

implementation by any automotive manufacturer. All of the ECU’s associated media are to be
designed to meet component level requirements. By meeting component level requirements,
the system level performance requirements are assured.
Physically, the CAN consists of a pair of wires CAN_H and CAN_L whose voltages are
speciﬁed by a pair of states: 1) dominant state and 2) recessive state. The CAN_H bus wire is
ﬁxed to a mean voltage level during the recessive state and is driven positive during the
dominant bit state. The CAN_L bus wire is ﬁxed to a mean voltage level during the recessive
state and driven in the negative voltage direction during dominant bit state.
The recessive state is represented by an inactive state differential voltage between CAN_H
and CAN_L that is approximately 0. The recessive state represents a logical 1-bit value. The
dominant state is represented by a differential voltage between CAN_H and CAN_L greater
than a minimum threshold value. The dominant state overwrites the recessive state and
represents a logical 0-bit value.
The SAE J_2284-3 standard gives a number of deﬁnitions of terms by which the CAN HSC
can be understood. The term “media” refers to the physical structure/conﬁguration which
conveys the electrical transmission between ECUs on the network and may, for example, be
unshielded twisted pair of wires. The term “physical layer” refers to the transmission of a bit
stream over the physical media and deals with electrical, mechanical, functional, and
procedural characteristics to access the physical media. The term “protocol” refers to a set of
conventions for the exchange of information between ECUs on the CAN. It includes the
speciﬁcation of frame administration, frame transfer, and the physical layer. In this context,
the frame is the formal arrangement of the sequence of bits over a speciﬁed time interval that
constitutes the message.
The message format includes a message identiﬁer (formerly 11 bits but later 29 bits). The
actual encoding of the identiﬁer is manufacturer speciﬁc. The identiﬁer deﬁnes the content of
the message as well as its priority. The message also includes a ﬁeld for the information being
sent in the form of eight data bytes. A set of error-checking bits is also included that might be
of the form of “check sum” of the bits.
The CAN is capable of supporting data transfer between ECUs from a minimum of two to
a maximum of 24. The topology of the CAN is depicted in Figure 9.34 which illustrates
a CAN with N ECUs.
The conﬁguration of the CAN shown in Figure 9.34 includes a connection to an off-board
diagnostics tool (ECUN-2) via a data link connector (DLC). Each ECU is connected to the
CAN via a stub whose length (L1) must satisfy
0 < L1  1m
Automotive Instrumentation and Telematics
505

The stub length to the DLC L2 has the same requirement as L1. The off-board stub length (L3)
must satisfy
0 < L3  5m
The distance between and two ECUs including cable stubs (d) must satisfy
0:1  d  33m
The CAN must be terminated at either end with a resistance RL which has tolerance range
118  RL  132U
The nominal value for RL is 120 U. This resistance is connected between CAN_H and
CAN_L wires. In addition, each ECU must present no more than 100 pF capacitance to
ground and no more than 50 pF differential.
The physical media parameters for an unshielded twisted pair are also given in SAE J-2284-3.
The characteristic impedance of the twisted pair zo must satisfy
108  z0  132U
The resistance/unit length Rl must be less than 0.070 U/m. The propagation delay for the
media must be less than 5.5 nsec/m.
The CAN is an arbitrating protocol which requires a very precise control of various timing
events in the exchange of inter-ECU information. It is essential to maintain synchronization
between modules at all times. There are several time delays that must be taken into account in
the CAN, including delays associated with ECU transmitter and receiver and logic delays.
Propagation delays between modules must take into account the time for a signal to make
a complete round trip from one module to another.
In addition, the basic CAN bit time requirements are a critical speciﬁcation. In SAE J-2284-3,
the bit time (tbit) must satisfy 1990  tbit  2010 nsec. A further constraint is that the nominal
ECU1
ECU2
ECU3
L2
L3
L1
off board 
ECU
(N-2)
DLC
ECU
(N-1)
ECU
N
CAN bus
RL
d
stub
Figure 9.34:
CAN bus architecture
506
Chapter 9

bit time must be a programmable multiple of the system clock period. For precise timing
details, the reader is referred to SAE J-2284-3.
The SAE J-3394-3 also has speciﬁc requirements concerning electromagnetic compatibility.
The electromagnetic radiation from the CAN as well as susceptibility to interference from
other CAN electronic/electrical systems is speciﬁed in the SAE J-2284-3 standard. It is
typical of SAE standard documents (including J-2284-3) that they evolve over time to
accommodate technology advances and changes resulting, for example, from government-
mandated regulatory changes. Regardless of such evolution, the basic concepts for the CAN
network will remain the same.
Trip Information Computer
One of the most popular electronic instruments for automobiles is the trip information system.
This system has a number of interesting functions and can display many useful pieces of
information, including the following:
1.
present fuel economy,
2.
average fuel economy,
3.
average speed,
4.
present vehicle location (relative to total trip distance),
5.
total elapsed trip time,
6.
fuel remaining,
7.
miles to empty fuel tank,
8.
estimated time of arrival,
9.
time of day,
10.
engine RPM,
11.
engine temperature, and
12.
average fuel cost per mile.
The trip information computer analyzes fuel ﬂow, vehicle speed, and fuel tank quantities, and
then calculates information such as miles to empty tank, average fuel economy, and estimated
arrival time. In the present chapter, English units are used because in the USA, these are the
preferred units.
Additional functions can be performed, which no doubt will be part of future developments.
However, we will discuss a representative system having features that are common to most
available systems.
A block diagram of this system is shown in Figure 9.35. Not shown in the block diagram are
MUX, DEMUX, and A/D converter components, which are normally part of a computer-
based instrument.
Automotive Instrumentation and Telematics
507

This system can be implemented as a set of special functions of the main automotive
instrumentation system, or it can be a stand-alone system employing its own computer.
The vehicle inputs to this system come from the three sensors that measure the following
variables:
1.
quantity of fuel remaining in the tank,
2.
instantaneous fuel ﬂow rate, and
3.
vehicle speed.
Other inputs that are obtained by the computer from other parts of the control system are
1.
odometer mileage and
2.
time (from clock in the computer).
The driver enters inputs to the system through the keyboard. At the beginning of a trip, the
driver initializes the system and enters the total trip distance and fuel price. At any time
during the trip, the driver can use the keyboard to ask for information to be displayed.
The system computes a particular trip parameter from the input data. For example,
instantaneous fuel economy in miles per gallon (MPG) can be found by computing
MPG ¼ V= _F
(34)
where V is the speed in miles per hour and _F is the fuel consumption rate in gallons per hour.
Figure 9.35:
Trip information system block diagram.
508
Chapter 9

Of course, this computation varies markedly as operating conditions vary. At a steady cruising
speed along a level highway with a constant wind, fuel economy is essentially constant. If the
driver then depresses the accelerator (e.g. to pass trafﬁc), the fuel consumption rate
temporarily increases faster than speed, and MPG is reduced for that time. Various averages
can be computed such that instant fuel economy, short-term average fuel economy, or long-
term average fuel economy can be displayed.
Another important trip parameter that this system can display is the miles to empty fuel tank,
D. This can be found by calculating
D ¼ MPG x Q
(35)
where Q is the quantity of fuel remaining in gallons. Since D depends on MPG, it also
changes as operating conditions change (e.g. during heavy acceleration). In such cases, the
calculation of miles to empty based on the above simple equation is grossly incorrect. The
estimate of D for transient driving conditions (e.g. urban driving) can be improved relative to
Eqn (35) by using short-term time average values of MPG. However, the calculation of
Eqn (31) gives a correct estimate of the miles to empty for steady cruise along a highway in
which operating conditions are constant.
Still another pair of parameters that can be calculated and displayed by this system are distance
to destination, Dd, and estimated time of arrival, ETA. These can be found by computing
Dd ¼ DT  DP
(36)
ETA ¼ T1 þ ðDd=VÞ
(37)
where DT is the trip distance (entered by the driver), DP is the present position (in miles
traveled since start), V is the present vehicle speed, and T1 is the start time.
The computercancalculatethepresent positionDPbysubtractingthestartmileage,D1 (obtained
fromtheodometer reading whenthe tripcomputerwas initializedbythe driver),fromthe present
odometer mileage. Alternatively the variables DT DP can be obtained automatically (once
a destination has been selected by the driver) via a GPS as explained later in this chapter.
The average fuel cost per mile (on any given trip) C can be found by calculating
C ¼ ðDP=MPGÞ$fuel price per gallon
There are many other useful and interesting operations that can be performed by the variety of
available systems. Actually, the number of such functions that can be performed is limited
primarily by cost and by the availability of sensors to measure the required variables.
Automotive Instrumentation and Telematics
509

Telematics
Communications to and from an automobile has become routine as a result of both cell phone
and satellite technology. In addition, the technology is evolving for area broadcast of road
condition information on radio station subcarriers. Technology is also evolving that will
permit Internet connections via cell phones, making the car in effect on Internet node.
Automobile Internet connectivity opens a limitless range of services for the driver, from on-
line navigation help to on-line diagnostic and/or road service for mechanical problems.
One of the major issues in telematics is how to present the information and services that are
potentially available to the driver without distraction from the driving tasks. Of course, the
various services can be made available to passengers without necessarily distracting the
driver. For example, video monitors in rear seats can provide entertainment, game playing on
any standard computer Internet terminal via on-board DVD, or wireless connection, be it cell
phone or satellite links.
On the other hand, the use of any subsystem that provides information such as is described
above is potentially distracting to the driver. The simple act of dialing a standard cell phone
requires the use of at least one hand and at least a momentary look at the cell phone. Some
state legislatures are passing laws prohibiting the driver’s use of a standard cell phone while
driving.
The driver’s distraction through cell phone use is somewhat alleviated by voice-activated cell
phone dialing in which the cell phone user verbally gives the phone number, speaking each
digit separately. Included within the cell phone is a very sophisticated algorithm for
recognizing speech. Speech recognition software identiﬁes spoken words or numbers based
on patterns in the waveform at the output of a microphone into which the user speaks. There
are two major categories of speech recognition software: speaker dependent and speaker
independent.
Speaker-dependent software recognizes the speech of a speciﬁc individual who must work
with the system. The user is prompted to say a speciﬁc digit a number of times until the
software can reliably identify the waveform patterns associated with that particular speaker.
By this process, the system is “trained” to the individual user. It may not be capable of
recognizing other users to whose speech it has not been trained.
Speaker-independent voice recognition software can recognize spoken digits regardless of the
user. It is generally more sophisticated than speaker-dependent speech recognition.
Unfortunately, it is also prone to recognition errors in excess of the speaker-dependent
systems.
The cell phone connection can also be used to provide on-line navigation or other services by
contacting a service with operators trained to provide this type of service. Alternatively, the
510
Chapter 9

cell phone can be used to provide an Internet connection to an on-line navigation service that
transmits data to the car for display on an electronic map.
The telematics technology is presently in its infancy and is certain to grow spectacularly in
capability and ﬂexibility, providing the motorist with virtually limitless services. Telematics
functionality is probably limited more by imagination and by potential driver distraction than by
technology.
The use of satellite communication with automobiles provides many signiﬁcant applications.
These include satellite radio, navigation, and safety applications. Satellite communications
are conducted in the microwave portion of the electromagnetic spectrum requiring a special
automotive antenna compatible with these frequency bands that is normally mounted on the
roof of the vehicle. Satellites are inherently far away from terrestrial receivers so the signal
strengths are relatively weak and require receivers of high sensitivity and also incorporate
very sophisticated signal processing.
A satellite system such as “OnStar” provides the capability of completely hands-free
telephone connection. The driver (or other occupants) can signal OnStar via a single push
button. An operator receives the phone number to be dialed verbally and can complete
a phone connection. The driver can complete a phone call without ever having to divert his/
her attention from driving.
In the event of an accident, a vehicle that also has a GPS navigation system can alert
the satellite operator system of the accident and relay car coordinates such that emergency
vehicles can be directed to the accident scene without requiring intervention or verbal
communication with any occupant. The sensing of a crash can be accomplished via the
sensor used for airbag deployment or via a dedicated independent crash sensor.
GPS Navigation
The GPS navigation system, global positioning system (GPS), has provided the capability of
some relatively sophisticated vehicle navigation systems. Initially intended for aircraft
position measurements and navigation, it has been successfully adapted for use with land
vehicles. As explained below, a GPS-equipped vehicle has the capability for relatively precise
and accurate measurements of the vehicle position. This position information combined with
electronic versions of maps yields the capability to navigate optimally between any two
locations without requiring any paper road maps.
The GPS system consists of 24 satellites arranged in groups of four in each of six orbital
planes inclined at 55 spaced 60 apart in longitude and at a nominal altitude of 11,000 n
miles above the local surface (i.e. orbital semi-major axis z26,600 km). At any given time
for any given receiver location a subset (I) of satellites are available for use by the receiver.
Automotive Instrumentation and Telematics
511

Each satellite carries a precise (atomic) clock and repetitively transmits its position and time
(i.e. ephemeris data). The user equipment consists of a receiver along with its own precise
clock. By measuring the time difference dt from transmission of the signal to its reception, the
receiver obtains a measurement of the transit time from satellite to receiver, which yields an
estimate of the range R from the satellite to receiver:
R ¼ cdt ¼
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
ðx  xsÞ2 þ ðy  ysÞ2 þ ðz  zsÞ2
q
(38)
where c is the speed of propagation of the satellite-transmitted signal, x, y, z are the receiver
location coordinates, and xs, ys, zs are the coordinates of the satellite. Both receiver and
satellite coordinate systems are in ECEF coordinates (see Chapter 8). If the receiver and
satellite clocks were perfectly synchronized then, in principle, measurement of dt would yield
the range from the receiver to (known) satellite position. A set of three measurements to three
satellites could ideally yield the solution for the user position (x,y,z) from these
measurements. However, it is, in practice, impossible to exactly synchronize these two
clocks. The actual measured time difference between satellite i (i ¼ 1, 2, . . . I) clock and
receiver clock time yields an estimate of R (denoted Ri) called pseudo-range. Because of the
receiver clock uncertainty, at least four measurements are required to estimate position and
receiver clock error. The pseudo-range model is given by
Ri ¼
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
ðx  xiÞ2 þ ðy  yiÞ2 þ ðz  ziÞ2
q
þ B
(39)
where B is a bias resulting from the receiver clock error Dtc:
B ¼ cDtc;
that is, Dtc is the error between true GPS time as carried by the satellite and the receiver clock
time and c is propagation speed of the GPS signal.
The user position can be determined (i.e. the navigation problem can be solved) by
measurement of the pseudo-range to at least four satellites by triangulation or trilateration.
However, the accuracy of this position solution is inﬂuenced by many factors, including the
geometry of the satellites in relation to the user and various error sources. These errors
include intentional degradation by DOD (signiﬁcantly reduced in the year 2000) meant to
reduce the accuracy to unfriendly users, propagation errors, clock random errors, orbital
perturbations, and satellite ephemeris errors. Consequently, many more than four
measurements are made to reduce errors.
In addition to estimations of position and clock bias, GPS receives also estimate user velocity
and clock drift rate. These additional estimates are required on application since, in this case,
512
Chapter 9

the GPS receiver is presumed to be moving and to have changed its position during the time
required to obtain the pseudo-range measurements.
The procedure for estimating vehicle position and clock bias is to assume an initial position
for the receiver and clock bias ðx0; y0; z0; B0Þ and to ﬁnd the vehicle-estimated position at
timetkðtk ¼ kT; k ¼ 1; 2; .Þ.
The model upon which vehicle position and velocity estimates are based represents vehicle
vector position and clock bias as a four-dimensional vector Xk at time tk. A similar four-
dimensional vector represents the initial estimates (Xo). A second represents errors in initial
position estimates and is denoted dXk:
dXk ¼ ½dx; dy; dz; dBT
where dXk ¼ Xk  X0:
Xk ¼ ½xk; yk; zk; BkT
X0 ¼ ½xo; yo; zo; BoT
Finally, the rate of change in vector position (i.e. _X) is given by a third four-dimensional
vector:
_X ¼ ½_x;
_y;
_z;
_BT
In all of these four-dimensional vectors, the superscript T represents transpose of the row
vector.
The model for four-dimensional vector estimates is given by
Xk ¼
2
664
xk
yk
zz
Bk
3
775 ¼
2
664
xo
yo
zo
Bo
3
775 þ
2
664
dx
dy
dz
dB
3
775 þ ðk  1ÞT
2
664
_x
_y
_z
_B
3
775
(40)
where dx; dy; dz; dB are errors in the initial estimates, ð_x; _y; _zÞ are the estimated user velocity
vector components, and _B is the user clock drift rate.
The GPS navigation problem can now be formulated as a state estimation problem in which
the state vector, X, is eight dimensional and is given by
X ¼ ½dx; dy; dz; dB; _x; _y; _z; _BT
Automotive Instrumentation and Telematics
513

The standard method for solving this problem is to linearize the pseudo-range equation:
Ri ¼ Rio þ ai1dx þ ai2dy þ ai3dz þ dB;
(41)
where Ri0 is the initial pseudo-range estimate from satellite i (i ¼ 1,2 . I):
¼
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
ðx0  xiÞ2 þ ðy0  yiÞ2 þ ðz0  ziÞ2
q
þ B0
(42)
and where
ai1 ¼ vRi
vx

Rio
¼
x  xi
Rio  Bo
ai2 ¼ vRi
vy

Rio
¼
y  yi
Rio  Bo
ai3 ¼ vRi
vz

Rio
¼
z  zi
Rio  Bo
(43)
The parameters ai1; ai2; ai3 are the direction cosines of the angles between the line of sight
from the user to satellite i and the coordinate axes. The linearized pseudo-range equation can
be written in terms of dRi where
dRi ¼ Ri  Ri0 ¼ ai1dx þ ai2dy þ ai3dz þ dB
(44)
Figure 9.36 is a simpliﬁed illustration of the geometry for a vehicle moving at a constant velocity
beginning at true position, xT, yT. In ﬁgure 9.36, S1 and S2 denote satellites i¼1 and i¼2
respectively and x0, y0 are the initial position estimates associated with pseudo ranges R01, R02
Figure 9.36:
GPS navigation geometry (simpliﬁed).
514
Chapter 9

For an understanding of the basic GPS in vehicles it is convenient to simplify the navigation
problem by assuming that the vehicle is moving at constant speed. The measurement model
for vehicle traveling at a constant speed from an initial estimated position ðx0; y0; z0Þ for four
satellites is given by
dR ¼ HX þ e;
where
dR ¼
2
4
½dR11
dR21
dR31
dR41T
«
½dRn1
dRn2
dRn3
dRn4T
3
5
(45)
In this expression n is the number of measurements made to each of the four satellites, and the
matrix H is given by
H ¼
2
664
H1
H2
«
Hn1
3
775;
where
Hk ¼
2
664
a11
a12
a13
1
kTa11
kTa12
kTa13
kT
a21
a22
a23
1
kTa21
kTa22
kTa23
kT
a31
a32
a33
1
kTa31
kTa32
kTa33
kT
a41
a42
a43
1
kTa41
kTa42
kTa43
kT
3
775
˛R4n8
K ¼ 1; .; n
(46)
The state vector X is given by
X ¼ ½ dx
dy
dz
dB
_x
_y
_z
_B T
and both dR and e are 4n  1 dimensional error vectors.
The solution to this problem for ﬁnding X can be obtained in a “batch” mode, in which data
are collected for n samples and found as the ordinary “least-squares” (OLS) solution, or the
solution can be found recursively. The OLS solution is found using the pseudo-inverse of H
and is given by
X ¼ ðHTHÞ1HTdR
(47)
Automotive Instrumentation and Telematics
515

Once a solution has been reached for X, the position of the vehicle for all time xk, yk, zk is
given by
2
664
xk
yk
zk
Bk
3
775 ¼
2
664
xo
yo
zo
Bo
3
775 þ
2
664
dx
dy
dz
dB
3
775 þ ðk  1ÞT
2
664
_x
_y
_z
_B
3
775
(48)
for a vehicle moving at a constant velocity vector v ¼ ½_x; _y; _zT. For maneuvering vehicles the
solution involves time-varying estimates of v.
The recursive solution to the GPS navigation problem is a Kalman ﬁlter which continuously
estimates X. The kth estimate of X (i.e. Xk) is based upon K previous measurements and
estimates and is of the form
Xk ¼ Xk1 þ KkðdRk  HkXk1Þ;
(49)
where Kk is the Kalman ﬁlter gain and dRk, Hk are samples of dR and H as deﬁned above at
times tk. The Kalman ﬁlter gain is computed in a multistep process that is derived from known
statistics of process and measurement noise, the basic dynamics of the vehicle motion, and the
relationship between the state and the measurements in the zero noise ideal case. The details of
these relations are beyond the scope of this book but can be found in any of the many excellent
books which have been written about optimal ﬁltering as well as those concerning GPS theory.
The GPS System Structure
The structure of the GPS navigation system consists of three major segments: (1) the space
segment (the satellites), (2) the control segment, and (3) the user receiver systems. The
satellite must be capable of transmitting its position and the correct GPS time continuously. A
major function of the control segment is to periodically upload to each satellite data from
which this position can be computed. Periodic updates to this ephemeris data are required
owing to orbital perturbations and changes due to lunaresolar perturbations, air drag,
asphericityof Earth’s gravitational potential, and magnetic, static-electric forces in orbit.
The control segment conﬁguration is depicted in Figure 9.37. The monitor stations receive the
GPS signals (same as the user). These signals can be used to evaluate ephemeris errors and
satellite clock errors. These stations are located at Colorado Springs, Kwajalein, Diego
Garcia, Ascension Island, and Hawaii. These stations measure pseudo-range values form the
satellites as they come into view. These measurements are used to determine ephemeris and
clock errors. In addition, these stations monitor local meteorological data that are useful for
correcting for tropospheric delays. The data and corrections obtained by these monitor
stations are sent to the master control.
516
Chapter 9

The master uploads navigation messages to the satellites via the stations at Ascension, Diego
Garcia, and Kwajalein. The satellites are continuously controlled via the master control to
avoid cumulative errors that would occur in the absence of this control function.
There are numerous error sources in GPS navigation solutions, including satellite ephemeris
errors, propagation errors and uncertainties, and clock errors. These errors are exacerbated by
poor geometry, which increases the uncertainty in position. Such uncertainty is represented
quantitatively by a parameter known as geometric dilution of position (GDOP).
The ephemeris errors result from imperfect prediction of satellite position. Propagation errors
and uncertainties result from ionospheric and tropospheric refraction variation. The
ionospheric refraction is determined largely by free-electron density and carrier frequency.
The index of refraction, n, for propagation through the ionosphere is deﬁned as
n ¼ c0
vf
(50)
where vf is the phase velocity.
At any carrier frequency, f, the index of refraction is given by
n ¼
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
1 
fc
f
2
s
;
(52)
where fc is the plasma frequency:
fc ¼ 1
2p
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
Nce2
mε0
s
y9
ﬃﬃﬃﬃﬃﬃ
Ne
p
(53)
Figure 9.37:
Control segment conﬁguration.
Automotive Instrumentation and Telematics
517

where Ne is the electron density (number/m3), e is the electron charge, m is the mass of
electron, and ε0 is the permittivity of free space.
On the other hand, tropospheric index of refraction is independent of carrier frequency, but is
inﬂuenced by the partial pressure of water vapor in an approximate relationship as
represented by index of refraction, n:
ny1 þ K1
T

p þ K2pw
T

(53)
where p is the atmospheric pressure, T is the absolute temperature, pw is the partial pressure of
water, and K1,2 are constants.
The path length change due to refraction DL is given by
DL ¼
ZR
0
ðn  1Þds;
(54)
where R ¼ distance to the satellite
ypseudo-range
s ¼ coordinate along the propagation path.
This expression can be rewritten approximately in terms of receiver altitude h0 and elevation
angle f0 to the satellite:
DL ¼
ZH
h0
n  1
sinf0
dh;
(55)
where H is the satellite elevation above the Earth. If the atmosphere is assumed to be
exponential, then
n  1yðn0  1Þebh;
(56)
where (for a standard day)
n0y1:00032
by0:000145=m
518
Chapter 9

Typical values are
DLy2:2m
for
f0 ¼ 90
y25m
for
f0 ¼ 5
The inﬂuence of satellite geometry is given via the GDOP. The GDOP can be computed from
the matrix of direction cosines to the satellite, Hi, where the ith row of H is
Hi ¼ ½ai1; ai2; ai3; 1
(57)
GDOP ¼
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
trace
n
HT
i Hi
1o
r
(58)
With a given value for GDOP, the rms error is given by
s ¼ GDOPs0
(59)
where s0 is the minimum position error that results for optimal satellite geometry and is due
to the error sources listed above. The review given here in this chapter of GPS theory is only
an overview. The actual theory is much more involved than can possibly be presented in the
present book. However, there are numerous publications that explain GPS theory in a much
more advanced way for the interested reader.
Automotive Diagnostics
In certain automobile models, the instrumentation computer can perform the important
function of diagnosis of the electronic engine control system as well as other subsystems. This
diagnosis takes place at several different levels. One level is used during manufacturing to test
the system, and another level is used by mechanics or interested car owners to diagnose
engine control system problems. Some levels operate continuously and others are available
only on request from an external device that is connected to the car data link for diagnostic
purposes by a technician. This application is explained in the next chapter.
Automotive Instrumentation and Telematics
519

This page intentionally left blank

CHAPTER 10
Diagnostics and Occupant Protection
Chapter Outline
Electronic Control System Diagnostics
522
Service Bay Diagnostic Tool
524
Onboard Diagnostics
525
Model-Based Sensor Failure Detection
526
Diagnostic Fault Codes
529
Onboard Diagnosis (OBD II)
543
Model-Based Misfire Detection System
544
Expert Systems in Automotive Diagnosis
555
Occupant Protection Systems
561
From the earliest days of the commercial sale of the automobile, it has been obvious that
maintenance is required to keep automobiles operating properly. Of course, automobile
dealerships have provided this service for years, as have independent repair shops and service
stations. Until the early 1970s, however, a great deal of the routine maintenance and repair
was done by car owners themselves, using inexpensive tools and equipment. However, the
Clean Air Act affected not only the emissions produced by automobiles but also the
complexity of the engine control systems and, as a result, the complexity of automobile
maintenance and repair. Car owners can no longer, as a matter of course, do their own
maintenance and repairs on certain automotive subsystems (particularly the engine). In fact,
the traditional shop manual used for years by technicians for repairing cars is rapidly
becoming obsolete and is being replaced by electronic technician aids.
As will be shown later in this chapter, the trend in automotive maintenance is for the
automobile manufacturer to distribute all required documentation, including parts lists
(with ﬁgures) as well as repair procedures in electronic format via a dedicated
communication link (e.g. via satellite) or via CD supplied to the service technician. The
repair information is then available to the technician at the repair site by use of a PC-like
workstation.
Onboard digital systems can also store diagnostic information wherever a failure or partial
failure occurs in a component or subsystem. The relevant information can then be stored in
a memory (e.g. RAM) that retains the information even if the car ignition is switched off.
Understanding Automotive Electronics. http://dx.doi.org/10.1016/B978-0-08-097097-4.00010-2
Copyright  2012 Elsevier Inc. All rights reserved.
521

Then, when the car is delivered to a repair station (e.g. at the dealer), the technician can
retrieve the diagnostic information electronically.
The change from traditional ﬂuidic/pneumatic engine controls to microprocessor-based
electronic engine controls was a direct result of the need to control automobile emissions, and
has been chronicled throughout this book. However, little has been said thus far about the
diagnostic problems involved in electronically controlled engines. This type of diagnostics
requires a fundamentally different approach than that for traditionally controlled engines
because it requires more sophisticated equipment than was required for diagnostics in pre-
emission control automobiles. In fact, the best diagnostic methods use special-purpose
computers that are themselves microprocessor based.
Electronic Control System Diagnostics
Each microprocessor-based electronic subsystem has the capability of performing some
limited self-diagnosis. A subsystem can, for example, detect a loss of signal from a sensor or
detect an open circuit in an actuator circuit as well as other failures. As long as the subsystem
computer is still functioning, it can store fault codes for detected failures. Such diagnosis
within a given subsystem is known as onboard diagnosis.
Some limited self-diagnostics have been available in power train control from the earliest
days of microprocessor-based control systems. However, the Environmental Protection
Agency (EPA) has developed regulations mandating a relatively high level of diagnosis for
components and subsystems that can adversely effect exhaust emissions when failed or in
degraded performance. These regulations are known as “On-Board Diagnostics II” (OBD II).
They require that the vehicle has within its electronic control/instrumentation systems the
capability of essentially continuously monitoring the performance of the vehicle emission
control systems. The details of this regulation and speciﬁc implementation schemes are
discussed later in this chapter.
Whenever a fault in a component or system is detected, a code, speciﬁc to the failure/
degraded performance known as a “Fault-code,” is stored in memory. Various techniques for
detecting such failures are discussed later in this chapter. If the fault has the potential to
degrade the emission control system beyond allowable limits, OBD II requires that the driver
be alerted via a “check engine” message on the instrument panel.
However, a higher level of diagnosis than the onboard diagnosis is typically done with an
external computer-based system that is available in a service shop. Data stored in memory in
an onboard subsystem are useful for completing diagnosis of any problem with the associated
subsystem. Such diagnosis is known as off-board diagnosis and is usually conducted with
a special-purpose computer.
522
Chapter 10

In order for fault code data to be available to the off-board diagnosis computer,
a communication link is required between the off-board equipment and the particular
subsystem on board the vehicle. Such a communication system is typically in the form of
a serial digital data link. A serial data link transmits digital data in a binary time sequence
along a pair of wires. Before discussing the details of onboard and off-board diagnosis, it is
perhaps worthwhile to discuss brieﬂy automotive digital communications.
It was shown in the previous chapter that the various electronic subsystems (ECUs) in
a contemporary vehicle are connected together via the CAN network. For example, in
Figure 9.34 one of the connections to the CAN bus is a data link (denoted DLC) that is a portal
from the vehicle to the off-board diagnosis system. A connection is made to this diagnostic
systemwhenthevehicleisinanauthorizedrepairfacility(e.g.cardealer)formaintenance/repair.
Figure 10.1 depicts a representative connection of an off-board connection of a so-called
diagnostic scan tool to an automotive DLC. The diagnostic scan tool depicted in Figure 10.1
DIAGNOSTIC SCAN TOOL
DATA LINK CONNECTOR
Figure 10.1:
Illustration of diagnostic scan tool connection to vehicle.
Diagnostics and Occupant Protection
523

is portable and can be carried in the vehicle when it is being test driven by a maintenance
technician as discussed later in this chapter.
The scanner has access to address and data buses of the subsystem containing the memory in
which the relevant fault codes are stored. The scanner then sends addresses to the memory
locations where the fault codes are stored and retrieves any fault code in each memory
location associated with fault code storage. The scanner also includes a display device where
it displays the fault code. Some diagnostic systems include storing the clock time of the
occurrence of the fault. Such a system is useful for diagnosing intermittent faults (i.e. those
that come and go randomly and are challenging for the technician to ﬁnd). In addition to the
portable scan diagnostic tool (PSDT), there is a service bay diagnostic tool (SBDT) which is
often on a movable cart but is not small enough to be carried on board for test drivers.
Service Bay Diagnostic Tool
An alternative to the onboard diagnostics is available in the form of a service bay diagnostic
system. This system uses a computer that has a greater diagnostic capability than the vehicle-
based system because its computer is typically much larger and has only a single task to
performdthat of diagnosing problems in vehicle electronic systems.
Service bay diagnostic systems are computer-based instruments that are capable of reading
fault codes that are stored by the onboard diagnostic systems (e.g. via the DLC described in
Chapter 9). In addition, they have electronic versions of the equivalent of shop manuals as
well as recommended procedures for diagnosing speciﬁc problems from the stored fault
codes as well as information and problem descriptions from the driver.
In certain circumstances, fault codes, by themselves, are insufﬁcient to fully diagnose a given
problem. In the cases, the off-board diagnostic system can present a sequence of steps that
require action by the service technician which, when followed, can complete the diagnosis of
a problem. Of course, it should be emphasized that fault codes are only applicable to those
automotive systems/subsystems that have electrical or electronic components. Other
subsystem/components require the knowledge and experience of the service technician to
perform diagnosis/repair. For example, a failed or partially failed wheel bearing is not
a failure that will have a stored fault code. The diagnosis and repair of problems in
automobiles will always require competent, knowledgeable, trained technicians.
On the other hand, the electronic content in contemporary vehicles continues to increase with
each new vehicle conﬁguration/model. Thus, it is clear that electronic diagnostic methods
will continue to proliferate.
In addition to storing and displaying shop manual data and procedures, a computer-based
service bay diagnostic system has the theoretical capability to automate the diagnostic
524
Chapter 10

process itself. In achieving this objective, the technicians’ terminal has the capability to
incorporate what is commonly called an expert system that is explained in detail later in this
chapter.
Onboard Diagnostics
Onboard diagnostics are dictated largely by the need for each automobile to meet the
requirements of OBD II regulations. As stated above, any component/subsystem having
the potential to adversely affect exhaust emissions must be evaluated for its performance.
In addition, however, on a power train systems level, the onboard diagnostics must be
capable of detecting engine misﬁre. A misﬁre is any failure of any cylinder (during an
engine cycle) to experience normal combustion. It can include e.g. a complete misﬁre in
which ignition fails to cause combustion to occur. Partial combustion in which only
a portion of the fuel/air mixture is combusted also can constitute a misﬁre by OBD II
standards. A misﬁre can degrade the performance of the catalytic converter since the
exhaust gas constituents and concentrations are outside the limits in which it is intended to
function.
Any engine can experience an occasional, spurious misﬁre (or partial misﬁre). However,
when the severity and frequency of occurrence exceeds certain tolerance limits the catalytic
converter performance is degraded and exhaust emissions can exceed the EPA mandated
limits. For such an occurrence, the warning message must be displayed and the owner should
seek repairs for the vehicle. The format for this warning message varies with vehicle model,
but it is often an illuminated “check engine” display. For convenience in the present chapter,
this warning message is termed “fault indication lamp” or FIL since it is actually illuminated
due to a component/system fault. An exemplary method of detecting misﬁres is described in
detail later in this chapter.
On a component level, there are many individual components which can adversely affect
exhaust emissions during periods of degraded performance. For example, the heated exhaust
gas oxygen concentration sensor (HEGO; see Chapter 6) which is used for closed-loop fuel
control can experience a failure or partial failure. For a warmed engine running with fuel
control in closed-loop mode, the voltage waveform of the HEGO sensor will have certain
patterns when the sensor is operating normally. This voltage should be cycling between its
normal high voltage level (about 1 V) and its low voltage level (about 0.1 V). Moreover, the
mean value of the sensor voltage will lie within a relatively narrow band that is approximately
midway between the high and low voltage levels.
Any deviation in the HEGO sensor voltage waveform is an indication of a potential HEGO
sensor failure or degraded performance. However, there are other potential causes of
waveform parameters (HEGO sensor) outside expected limits. For example, the fuel control
Diagnostics and Occupant Protection
525

system could have experienced a failure and could be unintentionally fueling the engine too
rich or too lean. In addition, one or more fuel injectors could have failed resulting in
excessively rich or lean mixture.
The OBD II requirement at this point is to illuminate the FIL warning and set the appropriate
fault codes. These might include separate codes corresponding to the conditions: (1) HEGO
sensor voltage a steady high or (2) a steady low, (3) HEGO sensor voltage failure to cycle; (4)
mean HEGO sensor voltage above limits or (5) below limits.
When the vehicle is brought to the service facility, the service technician will normally
connect the appropriate off-board system to the DLC (see Figure 9.34) and transfer all fault
codes from the onboard memory to the scan tool. With all fault codes present the service
technician can follow a set of procedures to diagnose the failures.
Another component that can fail affecting exhaust emissions is a fuel injector. Not all
fuel injector failures are detectable with onboard diagnostics. However, the power
train control system can monitor fuel injector current and terminal voltage.
Measurement of these quantities can detect an open or short circuit in the fuel
injector solenoid coil. Of course, should either condition be detected OBD II requires
the driver alert message as well as storage of the appropriate code and identiﬁcation
of the affected cylinder.
Still another important component requiring monitoring is the catalytic converter. As
stated earlier in this book, there is no cost-effective way of measuring the regulated
exhaust gas concentrations on board the vehicle. On the other hand, it is possible to obtain
some assessment of the catalytic converter conversion efﬁciency by placing a second
HEGO sensor in its output side. The primary HEGO sensor for fuel control is located
upstream of the catalytic converter. Recall from Chapter 7 that in closed-loop mode the
fuel control continuously cycles from rich to lean of stoichiometry and from lean to rich.
During periods of relatively rich mixture the exhaust gas oxygen concentration is low.
This exhaust gas enters the catalytic converter with the low O2 concentration where the
converter acts as an oxidizer. The reverse is true for a relatively lean mixture. A
comparison of the primary and secondary HEGO sensor voltages can serve as an
indication of relative converter efﬁciency.
Model-Based Sensor Failure Detection
The performance of certain sensors can be evaluated via model-based calculation from
measurements of other sensors. For example, the MAF is an important sensor for setting
fuel injector base pulse duration (see Chapter 7). A calibration change in the MAF sensor
can lead to misfueling (relative to stoichiometry) particularly in open-loop mode of fuel
526
Chapter 10

control. It is important to maintain proper fuel/air mixture regardless of the controller mode
of operation.
An independent check on MAF calibration is possible (theoretically) for any engine that also
has an MAP sensor and an intake air temperature sensor. Assuming that these sensors are
functioning correctly the mass ﬂow rate M
$
a into the intake system is given by:
,Ma ¼
,Vadi
(1)
where
,Va ¼ volume flow rate
di ¼ intake air density.
Using tables of volumetric efﬁciency (hV) for the engine as a function of throttle angle and
RPM, the volume ﬂow rate
,Va is given by:
,Va ¼ DenhVðqt; RÞ
2
(2)
where
De ¼ engine displacement
n ¼ R/60
R ¼ RPM
qt ¼ throttle angle.
The intake air density is given by
di ¼ d0piT0
p0Ti
(3)
where
d0 ¼ sea-level standard day air density
p0 ¼ sea-level standard day air pressure
T0 ¼ sea-level standard day air temperature
pi ¼ intake manifold air pressure
Ti ¼ intake manifold air temperature.
In principle, the MAF sensor calibration can be evaluated by comparing the measured value
of
,Ma from it with the calculated value from temperature and pressure measurements.
Unfortunately, the cost of adding extra sensors makes it unattractive to an automobile
manufacturer to implement such a method unless these sensors were already in place for other
Diagnostics and Occupant Protection
527

control applications. Nevertheless, this hypothetical example illustrates the potential for
cross-checking the performance of various sensors.
It has been shown (e.g. see Chapter 7) that power train control uses numerous angular speed
sensors. As shown in Chapter 6 many of these use a magnetic or optical sensor in conjunction
with a disk having multiple lugs. Many failure modes are possible with such sensors. For
example, a magnetic speed sensor incorporating a permanent magnet and a coil can
experience shorting of a portion of the coil turns. This type of failure leads to a lower than
normal output voltage at any given speed. Although speed measurement from such a sensor is
based upon the frequency of counted pulses, the failure can occur whenever the voltage
amplitude falls below the level at which the signal processing can detect the presence of some
(or all) of the pulses produced within one revolution. In addition it is possible for one of the
lugs to come off the disk (e.g. due to manufacturing defect). In either type of failure the signal
processing will compute an incorrect angular speed for the sensor.
One method for detecting missing pulses uses the controller clock to record the time of
occurrence tk(k ¼ 1, 2, . K) of each of the pulses in the incoming sequence during any given
engine cycle where K is the number of lugs on the disk. The controller can also obtain the
differential time between successive pulses
d tk ¼ tk  tk1;
k ¼ 1; 2 . K
If a sensor failure of the types described above has occurred then there will be at least one
differential time which is signiﬁcantly different from the others in a full sequence during an
engine cycle. The measurements of angular speed for this particular time differential is
termed an outlyer. Several standard algorithms exist for detecting and removing these
erroneous measurements from the data collected during each cycle of operations as well as
setting a fault code.
Various temperature (e.g. coolant temperature) sensors are used in power train control whose
accuracy affects emission control. The very wide range of temperatures over which a vehicle
operates essentially precludes a practical and reliable means of checking the calibration
accuracy. On the other hand, open and short circuit conditions can be detected by monitoring
sensor terminal voltages. However, depending upon the design, it may be possible to establish
limits on the possible range of indicated temperatures. Any reading outside this range can be
considered a detected fault.
In addition to those sensors that must be monitored for OBD II requirements, there are
sensors that are important for safe reliable vehicle operation. For example, an oil
pressure measurement is important to assure that proper lubrication is present for all
engine rotating parts. Such sensors can be monitored with respect to open/short circuit
conditions.
528
Chapter 10

In addition, the proper operation of electrical system is important. The charging of the battery
via the alternator can be monitored by both the terminal voltage and the current ﬂow. In
particular, an alternator voltage level that is too low or too high for engine operating
conditions is an indication of an alternator problem.
As will be demonstrated below, the diagnostic capability provided in any modern
microprocessor-based electronic control system (although somewhat limited) can provide
valuable assistance to the service technician. These diagnostic functions are performed by the
microprocessor under the control of stored programs, and are normally performed when the
microprocessor is not fully committed to performing normal control calculations. While it is
beyond the scope of this book to review the actual software involved in such diagnostic
operations, the diagnostic procedures that are followed and explanations of onboard
diagnostic functions can be reviewed, by example.
During the normal operation of the car, there are periods during which the performance of
various electrical and electronic components is monitored via the vehicle instrumentation
system (see Chapter 9). Whenever a fault is detected, the data are stored in memory using
a speciﬁc fault code. At the same time, the controller generates or activates an FIL warning
lamp (or similar display) on the instrument panel indicating that service is required provided
the fault affects the emission control system or affects safety.
The onboard diagnostic functions have one major limitationdthey cannot detect intermittent
failures reliably. For the system to detect and isolate a failure, the failure must be
nonreversible and persistent. In an onboard diagnostic system, if the electronic control
module stores trouble codes that are automatically cleared by the microprocessor after a set
number of engine cycles have occurred without a fault reappearing, then intermittent failure
detection is precluded. However, it is possible in certain vehicles for the system to be put into
a fault-recording mode. Many times such a fault-recording mode can identify intermittent
failures.
Diagnostic Fault Codes
The Society of Automotive Engineers (SAE) has developed a set of recommended practices
that provides a standard set of diagnostic fault codes for those component/system faults that
are common to all vehicle models. By standardizing fault codes, a qualiﬁed independent
service technician can diagnose certain problems on any vehicle using a universal scan tool.
Each individual car manufacturer deﬁnes its own fault codes for any component or system
that is not encompassed by the standard set.
The SAE-deﬁned code has the format P0xxx. A partial list is given in Table 10.1 as an
example of a subset of fault codes. Manufacturer-speciﬁc codes can have a format P1xxx as
illustrated in Table 10.1.
Diagnostics and Occupant Protection
529

Table 10.1: Fault code sample.
FIL Indication
Affected Component
P0106 (5)
Manifold Absolute
Pressure Circuit
Range/Performance
P0107 (3)
Manifold Absolute
Pressure Circuit
Low Input
P0108 (3)
Manifold Absolute
Pressure Circuit
High Input
P0112 (10)
Intake Air
Temperature Circuit
Low Input
P0113 (10)
Intake Air
Temperature Circuit
High Input
P0116 (86)
Engine Coolant
Temperature Circuit
Range/Performance
P0117 (6)
Engine Coolant
Temperature Circuit
Low Input
P0118 (6)
Engine Coolant
Temperature Circuit
High Input
P0122 (7)
Throttle Position
Circuit
Low Input
P0123 (7)
Throttle Position
Circuit
High Input
P0131 (1)
Primary Heated Oxygen Sensor
Circuit Low Voltage
(Sensor 1)
P0132 (1)
Primary Heated Oxygen Sensor
Circuit High Voltage
(Sensor 1)
P0133 (61)
Primary Heated Oxygen
Slow Response
(Sensor 1)
P0135 (41)
Primary Heated Oxygen Sensor
Heater
Circuit Malfunction
(Sensor 1)
P0137 (63)
Secondary Heated Oxygen
Sensor
Circuit Low Voltage
(Sensor 2)
530
Chapter 10

Table 10.1: Fault code sample.dcont’d
FIL Indication
Affected Component
P0138 (63)
Secondary Heated Oxygen
Sensor
Circuit High Voltage
(Sensor 2)
P0139 (63)
Secondary Heated Oxygen
Sensor
Slow Response
(Sensor 2)
P0141 (65)
Secondary Heated Oxygen
Sensor Heater
Circuit Malfunction
(Sensor 2)
P0171 (45)
System Too Lean
P0172 (45)
System Too Rich
P1300 or same of
P0301
P0302
P0303
P0304
P0305
P0306
0
B
B
B
B
B
B
@
71
72
73
74
75
76
1
C
C
C
C
C
C
A
Misﬁre of Multiple Cylinders
Detected
P0301
P0302
P0303
P0304
P0305
P0306
0
B
B
B
B
B
B
@
71
72
73
74
75
76
1
C
C
C
C
C
C
A
Misﬁre Detected
dCylinder 1
dCylinder 2
dCylinder 3
dCylinder 4
dCylinder 5
dCylinder 6
P0335 (4)
Crankshaft Position
Sensor Circuit
Low Input
P0336 (4)
Crankshaft Position
Sensor
Range/Performance
P0401 (80)
Exhaust Gas
Recirculation
Insufﬁcient Flow Detected
P0420 (67)
Catalyst System
Efﬁciency Below
Threshold
P0441 (92)
Evaporative Emission
Control System
Incorrect Purge Flow
Continued
Diagnostics and Occupant Protection
531

Table 10.1: Fault code sample.dcont’d
FIL Indication
Affected Component
P0500 (17)
Vehicle Speed
Sensor Circuit
Malfunction
P0505 (14)
Idle Control
System
Malfunction
P0715
P0720
P0725
P0730
P0740
P0753
P0758
ð70Þ
Automatic
Transaxle
P1107 (13)
Barometric
Pressure Circuit
Low Input
P1108 (13)
Barometric
Pressure Circuit
High Input
P1297 (20)
Electrical Load
Detector Circuit
Low Input
P1298 (20)
Electrical Load
Detector Circuit
High Input
P1361 (8)
Top dead Center
Sensor Intermittent
Interruption
P1362 (8)
Top Dead Center
Sensor No Signal
EGR - exhaust gas recirculation
P1381 (9)
Cylinder Position
Sensor
Intermittent Interruption
P1382 (9)
Cylinder Position
Sensor No Signal
P1459 (92)
Evaporative
Emission
Purge Flow Switch
Malfunction
P1491 (12)
EGR Valve
Lift Insufﬁcient
Detected
P1498 (12)
EGR Valve
Lift Sensor
High Voltage
532
Chapter 10

The procedure for diagnosing one or more problems during vehicle repair/maintenance
begins with the service technician connecting the off-board diagnostic scan tool to the DLC.
With the ignition switch on and this tool connected, data associated with any or all faults are
automatically transferred to the diagnostic tool. In addition to the individual fault codes that
were stored, additional data indicating the engine and associated components/systems
operating conditions may also be transferred (depending on the vehicle model and
manufacturer).
In most cases, the most advanced diagnostic tools are computer based having relatively large
databases related to diagnostic and repair procedures. Commonly, these procedures are
presented to the service technician in the form of a ﬂowchart (not unlike a ﬂowchart for
a computer algorithm). The ﬂowchart appears on the diagnostic tool visual monitor (e.g.
computer display) in a graphical/pictorial form. Although the procedures to be followed in the
ﬂowchart depend on the particular fault, it is possible to illustrate the procedures with
a representative example. The example taken here considers a failure in the primary HEGO.
Refer to Chapter 7 for a review of the role played by this important sensor in closed-loop fuel
control.
Once the vehicle has been taken (possibly driven) to an authorized repair facility, the
diagnosis begins with the service technician connecting the diagnostic (scan) tool to the DLC.
If the onboard diagnostic subsystem has detected an HEGO sensor low voltage fault, it will
store the fault code P0131 in memory (see Table 10.1). When properly connected, either of
the scan tools (i.e. PSDT or SBDT) will display this code to the service technician. For our
example situation, it is presumed that the service bay scan tool has the relevant diagnostic
ﬂowchart stored internal to its computer and will display (either automatically or at the
command of the technician) a ﬂowchart such as is depicted in Figure 10.2.
The ﬁrst step in the procedure of this ﬂowchart involves veriﬁcation that a fault has actually
occurred and persists. This veriﬁcation is accomplished during a test drive with a fully warmed
vehicle that is conducted by the service technician with the PSDT connected and conﬁgured to
measure and display the primary HEGO sensor terminal voltage (VHEGO). If this voltage does
not satisfy the condition (VHEGO  0.1 V), the system is deemed to be functioning properly at
Table 10.1: Fault code sample.dcont’d
FIL Indication
Affected Component
P1508 (14)
Idle Air Control
Valve Circuit
Failure
P1607 (d)
Engine Control
Module Internal
Circuit Failure A
Diagnostics and Occupant Protection
533

the time of the test drive and the FIL is considered to be intermittent. Forthis test driveoutcome,
a separate path (denoted B in Figure 10.2) is to be followed. This path includes the
recommendation that the service technician examine the wiring associated with the HEGO
sensor to check for broken or loose wires or connectors. If no wiring problem is found and the
start
Scan tool displays
P0131
1) test drive vehicle
    with portable scan
    tool attached
2) measure HEGO
    sensor output
    voltage (VHEGO) during
    (WOT) acceleration
Problem verification
2. start and run engine
    at 300 RPM
    No load until
    radiator fan comes on
1. Reset ECU
IS VHEGO ≤ 0.1 volt
IS VHEGO < 0.1 volt
NO
NO
YES
YES
YES
measure fuel
rail pressure
IS fuel pressure
within limits
    Electrical test HEGO
1) switch ignition off
2) disconnect HEGO
     from harness
3) connect scan to
    HEGO output
4) start engine
    run at idle
5) measure VHEGO
repair
fuel
system
System OK
at this time
fault may be
intermittent
NO
NO
YES
check wiring
1) switch ignition
    off
2) disconnect HEGO
    wiring at ECU
3) check for short
    cct HEGO wires
    (multimeter)
IS there continuity
in wires
replace ECU and
repeat
procedure
repair or
replace
wiring
replace
HEGO
sensor
A
C
C
D
D
D
D
A
B
Figure 10.2:
Flowchart for diagnosing fault in primary HEGO.
534
Chapter 10

vehicle has experienced other such FIL warnings, the instructions may be to install special
recording equipment in the vehicle and either return it to service or repeat the test drive.
On the other hand, if VHEGO  0.1 V, the ﬂow path directs the service technician to measure fuel
pressure. If this pressure is outside limits speciﬁed in the service manual, it must be repaired.
After repairs are completed, Step C involves returning to the ﬂowchart at the point indicated.
If the fuel pressure is within limits, the service technician is directed to electrical tests of the
HEGO. With the engine switched off, the HEGO is disconnected from the wiring harness. A
diagnostic scan tool is connected via a set of leads with clip-on ends to the sensor terminals of
the HEGO (note: for a HEGO, there is also a pair of connectors for the heating element; see
Chapter 6). The engine is then started and allowed to idle. The HEGO voltage is measured by
the scan tool. At this point in the ﬂowchart, there is a break from point A to the continuous
point A at the top right of the ﬂowchart.
If the condition VHEGO  0.1 V is met, it is the HEGO sensor itself that has failed and it is
replaced. To conﬁrm that the problem has been resolved, the technician returns to point D in
the procedure. Assuming that the problem is resolved, the procedure will end at point B where
it will become concluded that the problem is ﬁxed. If this condition is not met, the sensor is
functioning and the problem of low HEGO sensor voltage may be in the wiring harness.
The next step in the ﬂowchart involves testing the wiring harness from the HEGO to the
engine control unit (ECU). The HEGO sensor wiring harness is removed from the ECU and
a wire continuity test is performed using either the scan tool or any available multimeter. If
there is either intermittent or no continuity in the sensor wires from the ECU to the sensor end
and if there are short circuits either between the two sensor leads or from either to ground, the
harness is faulty and must be repaired (if possible) or replaced. Again the procedure will be
repeated at D and if the problem is resolved, the procedure will end in step B with
a conclusion that the system is repaired.
If there is continuity, the problem must be in the ECU itself. The service technician is directed
to replace the ECU with a known good one. If the problem with low HEGO sensor voltage
disappears, a permanent replacement ECU is installed. At this point, there is a return to point
D and if the problem has been resolved, the exit at step B is taken.
If, after the vehicle is returned to service, the FIL is illuminated and the scan tool detects fault
P0131 again, the problem is an intermittent fault. Among the possible options is the choice of
installing a recording device that can, over a period of time, collect data to identify that an
intermittent fault has occurred. It is also possible to replace the HEGO sensor and its wiring
harness and continue road testing.
Another example procedure will be illustrated here by following the steps necessary to
respond to the speciﬁc fault code P0133, which indicates that the HEGO sensor has slow
Diagnostics and Occupant Protection
535

response. Recall from the discussion in Chapter 6 that the HEGO sensor switches between
approximately 0.1 and 1 V as the mixture switches between the extreme conditions of lean
and rich. Recall also that this voltage swing requires that the HEGO sensor must be at
a temperature above 200 C. Fault code P0133 means that the HEGO sensor may not
swing above or below its cold voltage of approximately 0.5 V, and that the electronic
control system will not go into closed-loop operation (see Chapters 5 and 7) or that the
transitions are too slow for closed-loop control to function. Possible causes for fault code
P0133 include the following:
•
HEGO sensor is not functioning correctly.
•
The connections or leads are defective.
•
The control unit is not processing the HEGO sensor signal.
Further investigation was required to attempt to isolate the speciﬁc problem.
To check the operation of the HEGO sensor, the average value of its output voltage is measured
using the scan tool (or a multi meter). The desired voltage is displayed on the scan tool.
Using this voltage, the service technician follows a procedure outlined in Figures 10.3 and
10.4. If the voltage is less than 0.37 Vor greater than 0.57 V, the service technician is asked to
investigate the wiring harness for defects.
If the HEGO sensor voltage is between 0.37 and 0.57 V, tests are performed to determine
whether the HEGO sensor or the control unit is faulty. The service technician must jumper the
HEGO sensor leads together at the input to the control unit, simulating a sensor short circuit,
and must read the sensor voltage value using the PSDT (or a suitable multi meter). If this
voltage is less than 0.05 V, the control unit is functioning correctly and the HEGO sensor
must be investigated for defects. If the indicated sensor voltage is greater than 0.05 V, the
control unit is faulty and should be replaced.
A further test of the proper HEGO sensor dynamic (switching) operation as part of the
engine control is illustrated in the ﬂowchart of Figure 10.4. In this diagnostic procedure, the
goal is to ascertain whether the HEGO sensor operation results in closed-loop mode of
engine control. As explained in Chapter 7, the engine must be sufﬁciently warmed before
closed-loop operation is activated. The ﬁrst step in the ﬂowchart is to run the engine and
monitor coolant temperature. Once this temperature exceeds a given threshold level, the
HEGO sensor should be operating properly even if the heater has failed. The technician is
directed to run the engine at fast idle and monitor HEGO sensor voltage. Under these
conditions, the sensor should be switching. If the voltage is constant, the sensor has failed
and must be replaced.
If the sensor voltage is variable, it must switch from less than 0.3 V to more than 0.6 V. If it
does not, it must be replaced. If it does meet this condition, the service technician is directed
536
Chapter 10

Figure 10.3:
Flowchart for diagnosis of HEGO sensor output voltage problems.
Diagnostics and Occupant Protection
537

● 
Connect PSDT or SBDT and configure 
to measure coolant temperature
● 
Operate engine at fast idle until 
Tcoolant ≥ 85ºC
● 
Configure scan tool to measure VHEGO
is VHEGO = constant
is VHEGO  variable and
0.3 ≤ VHEGO ≤ 0.6
replace 
HEGO 
sensor
replace 
HEGO 
sensor
replace 
HEGO 
sensor
HEGO 
sensor 
is OK
configure 
scan tool 
to display CLI
is CLI = 1
B
YES
YES
YES
NO
NO
NO
Figure 10.4:
Flowchart for HEGO sensor proper switching sensor test.
538
Chapter 10

to determine if closed-loop mode is activated or not. The PSDT tool is conﬁgured to read
a binary-valued parameter that is termed “closed-loop indicator” (CLI). If CLI ¼ 0, the
HEGO sensor switching is insufﬁcient to cause closed-loop operation to occur and the sensor
is replaced. If CLI ¼ 1, the sensor is OK and this diagnostic procedure is complete. It should
be noted that the ECU could also have failed, but diagnosis of this problem would follow
a different ﬂowchart.
In addition to measurement of HEGO sensor, the scan tool can be used by a service
technician to measure other variables or parameters as suggested above. We consider, for
example, the throttle position sensor which provides an important input to the electronic
engine control as explained in Chapters 5, 6 and 7. The onboard diagnostic can detect out-
of-limits values for this sensor and display fault codes, e.g. P0122 for voltage below
a lower limit or P0123 for voltage above a high limit. However, other throttle position
sensor faults are possible that are not detected by the exemplary onboard diagnostic
system. A change in calibration of this sensor will normally result in an incorrect
computation of fuel injector base pulse duration (see Chapter 7). Such a calibration failure
could result from a change in the supply voltage to the sensor. Even though no fault code
is set for such a failure (in this hypothetical example), a service technician with sufﬁcient
experience and knowledge may suspect such a failure if the vehicle driver reports an
apparent reduction in performance under certain driving conditions. The technician can
conﬁgure the scan tool to measure the throttle position sensor voltage. Then, with the
ignition switch in the on position but with the engine not running, the service technician
can measure the voltage as the throttle is depressed. Although it is theoretically possible to
independently measure throttle angular position qt and to obtain a plot of sensor voltage
Vt(qt), normally it is sufﬁcient for diagnostic purposes to qualitatively examine the voltage
as the throttle is changed. This sensor voltage should change smoothly and roughly
linearly with qt. Similar measurements can be made on other sensors which might have
developed partial failures (e.g. calibration shift) that are not sufﬁcient to be detected by
the onboard diagnostic system.
In addition to parameter and variable measurements, the diagnosis of problems with various
switches is often desirable or even necessary. Various examples of the important function of
certain switches have been explained in previous chapters. For example, in a cruise control
system, the brake pedal switch has the critical safety-related function of disconnecting the
throttle actuator from the throttle linkage in a cruise control system (see Chapter 8) when the
driver applies the brakes. The onboard diagnostic system cannot detect a failure in this switch
unless there is an independent means of sensing that brakes are applied (e.g. via a brake
pressure sensor). Owing to this potentially inherent limitation of the onboard diagnostic
system, it is desirable to perform a sequence of switch tests during a routine vehicle servicing
procedure. The evaluation of various switches can be implemented automatically via the
Diagnostics and Occupant Protection
539

diagnostic tool with the involvement of the service technician. Such an automatic switch test
procedure was implemented in at least one production vehicle.
We illustrate this switch test procedure with the above exemplary system in which the scan
tool is conﬁgured to display two-digit diagnostic codes. The two-digit codes and associated
circuit are presented in Figure 10.5. In this ﬁgure, the relevant diagnostic codes displayed on
the scan tool are represented by digits AA.
For this example, the switch tests involve diagnostic codes 71-80 and provide checks on the
switches indicated in Figure 10.5.
To begin the switch tests, the service technician must depress and release the brake pedal. If
there is no brake switch failure, then the code advances to 71. If the display does not advance,
then the control unit is not processing the brake switch signal and further diagnosis is required.
For such a failure, the service technician locates the speciﬁc ﬂowchart (such as seen in
Figure 10.6) for diagnosis of the particular switch failure and follows the procedure outlined.
The detailed tests performed by the service technician are continuity checks that are performed
with the PSDT or a multimeter. Figure 10.7 depicts the cruise control brake circuit diagram.
Whenever any switch test fails, a diagnostic ﬂowchart is called up by the service technician,
and its steps are followed in the sequence displayed on the scan tool. Similar procedures are
followed for each switch test in the sequence. This procedure sequence is as follows:
(1) With code 71 displayed, depress and release brake pedal for normal operation, the display
advances.
Figure 10.5:
Switch test sequence.
540
Chapter 10

(2) With code 72 displayed, depress the throttle from idle position to wide-open position. The
control unit tests the throttle switch, and advances the display to code 73 for normal
operation.
(3) With code 73 displayed, the transmission selector is moved to drive and then neutral. This
operation tests the drive switch, and the display advances to code 74 for normal operation.
(4) With code 74 displayed, the transmission selector is moved to reverse and then to park.
This tests the reverse switch operation, and the display advances to code 75 for normal
operation.
(5) With 75 displayed, the cruise control is switched from off to on and back to off, testing the
cruise control switch. For normal operation, the display advances to 76.
(6) With code 76 displayed and the cruise control switch on, depress and release the set/coast
button. If the button (switch) is operating normally, the display advances to 77.
(7) With 77 displayed and with the cruise control instrument on, depress and release the
resume/acceleration switch. If the switch is operating normally, the display advances to 78.
(8) With 78 displayed, depress and release the instant/average button on the trip information
computer (TIC). If the button is working normally, the code advances to 79.
with ignition ON continuity 
check brake switch current
continuity both sides
with ignition on depress 
brake pedal and check 
continuity in circuit H
IS there 
continuity
check for
open in circuit H
replace cruise 
control switch
replace switch
IS fuse OK
check for short 
circuits to 
ground in DCJ
repair open in 
circuit C
are there 
short circuit
replace fuse 
and retest
repair/replace 
circuit wire C
does fuse 
blow again
repeat switch 
test
replace control 
system
IS adjustment correct
reset
check adjustment on 
switch
check fuse
continuity on one side
no continuity
NO
YES
NO
YES
NO
NO
YES
NO
YES
YES
Figure 10.6:
Cruise control brake circuit.
Diagnostics and Occupant Protection
541

(9) With 79 displayed, depress and release the reset button on the TIC panel. If the reset
button is working normally, the code will advance to 80.
(10) With 80 displayed, depress and release the rear defogger button on the climate control
head. If the defogger switch is working normally, the code advances to 70, thereby
completing the switch tests.
This exemplary diagnostic tool can also be used to display certain engine parameters with the
engine running (either in the service bay or on a road test). The scan tool gives the
measurement as well as the normal range for the parameter.
Figure 10.8 shows the parameter values in sequence for an exemplary vehicle. Parameter 01 is
the angular deﬂection of the throttle in degrees from idle position.
Parameter 02 is the manifold absolute pressure in kilopascals. The range for this parameter is
14-99, with 14 representing about the maximum manifold vacuum. Parameter 03 is the
absolute atmospheric pressure in kPa. Normal atmospheric pressure is roughly 90-100 kPa at
Figure 10.7:
Cruise control brake circuit.
542
Chapter 10

sea level. Parameter 04 is the coolant temperature and Parameter 05 is the intake manifold
temperature.
Parameter 06 is the duration of the fuel injector pulse in milliseconds. Refer to Chapters 5, 6,
and 7 for an explanation of the injector pulse widths and the inﬂuence of these pulse widths on
fuel mixture.
Parameter 07 is the average value for the HEGO sensor output voltage. Reference was made
earlier in this chapter to the diagnostic use of this parameter. Recall that the HEGO sensor
switches between about0.1 and 1 Vas the mixture oscillates between lean and rich. The displayed
value is the time average for this voltage, which varies with the duty cycle of the mixture.
Parameter 08 is the spark advance in degrees before TDC. This value should agree with that
obtained using a SBDT conﬁgured in the engine analyzer mode. Although it is not shown in
Figure 10.8, parameter 09 is the number of ignition cycles that have occurred since a trouble
code was set in memory. If 20 such cycles have occurred without a fault, this counter is set to
zero and all trouble codes are cleared.
Parameter 10 (not shown in Figure 10.8) is a logical (binary) variable that indicates whether
the engine control system is operating in open or closed loop (i.e. the CLI). A value of 1
corresponds to closed loop, which means that data from the HEGO sensor are fed back to the
controller to be used in setting injector pulse duration. Zero for this variable indicates open-
loop operation, as explained in Chapters 6 and 7. Parameter 11 is the battery voltage.
Onboard Diagnosis (OBD II)
Onboard diagnosis has also been mandated by government regulation, particularly if a vehicle
failure could damage emission control systems. The relatively severe requirement for
onboard diagnosis is known as OBD II. This requirement is intended to ensure that the
emission control system is functioning as intended.
Figure 10.8:
Chart of exemplary engine parameters with normal ranges.
Diagnostics and Occupant Protection
543

Automotive emission control systems, which have been discussed in Chapters 5 and 7, consist
of fuel and ignition control for the three-way catalytic converter, as well as controls for EGR,
secondary air injection, and evaporative emission. The OBD II regulations require real-time
monitoring of the performance of the emission control system components. For example, the
performance of the catalytic converter must be monitored using a temperature sensor for
measuring converter temperature and a pair of HEGO sensors (one before and one after the
converter).
Another requirement for OBD II is a misﬁre detection system. It is known that under misﬁring
conditions (failure of the mixture to ignite), exhaust emissions increase. In severe cases, the
catalytic converter itself can be irreversibly damaged.
The only cost-effective means of meeting OBD II requirements involves electronic
instrumentation. Owing to intellectual property issues, it is not feasible to present an actual
misﬁre detection system used by any particular automotive manufacturer. Rather, we present
a hypothetical misﬁre detection system that is mathematical model based and which has
been tested under laboratory conditions as well as in actual road tests.
Model-Based Misﬁre Detection System
A model-based method of detecting engine misﬁres requires a dynamic model for the
power train of sufﬁcient detail and accuracy to be able to represent the relationship
between the instantaneous torque ﬂuctuations and the corresponding ﬂuctuations in
crankshaft instantaneous angular speed ue(t). It is shown later in this section that
measurements of ue(t) can be used as the basis for misﬁre detection in accordance with
the following model. The instantaneous net torque Tn applied at the ﬂywheel consists of
the algebraic sum:
Tn

qe

t

¼ Ti

qe

t

þ TR

qe

t

þ TFp

qe

t

 Tl

qe

t

(4)
where
qe(t) ¼ crankshaft instantaneous angular position
Ti[qe(t)] ¼ indicated torque
TR[qe(t)] ¼ torque due to inertial forces of reciprocating components
TFp[qe(t)] ¼ friction and pumping loss torque
Tl[qe(t)] ¼ load torque from transmission.
The indicated torque is the torque that is applied to the crankshaft due to cylinder pressure
during combustion acting on the piston area (Ap) through the instantaneous lever arm [(qe) of
the connecting rod crankshaft throw structure (see Chapter 5). The friction component of TFp
544
Chapter 10

is due to the sliding friction of all moving surfaces and the pumping component of TFp is the
torque required to pump the fuel air mixture into each cylinder and pump the exhaust gases
out of the engine through the exhaust system.
The reciprocating torque is the torque applied to the crankshaft due to the inertial forces
associated with the reciprocating motion of the piston/connecting rod/crankshaft throw. This
torque amplitude increases quadratically with RPM but can be computed with great
accuracy for any given engine conﬁguration from the known geometry and component
masses.
For the purposes of illustrating the present concept for misﬁre detection a number of
simplifying assumptions are made. There is negligible loss of model robustness by assuming
that the crankshaft is inﬁnitely stiff and experiences insigniﬁcant torsional motion in response
to the torque ﬂuctuations. It is also adequate for the present purposes to assume that the
connecting rod is sufﬁciently long relative to the crankshaft throw (Rc) and that the piston pin
offset is negligible such that the indicated torque due to the power stroke of the mth cylinder is
given by:
TmðqeÞ ¼ ApRcðpc  poÞfmðqeÞ
(5)
where
fmðqeÞ ¼ sinðqe  qmÞ
2
641 þ
ðRc=LcÞcos ðq  qmÞ
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
1  ðRc=LcÞ2sin2ðqe  qwÞ
q
3
75
and where
Lc ¼ connecting rod length
Rc ¼ crankshaft throw
pc ¼ cylinder pressure
po ¼ atmospheric pressure
where
qm ¼ qe at TDC for cylinder m.
The origin for qe is taken as the crankshaft angle for the number 1 cylinder at TDC for
compression/combustion strokes. The indicated torque is the sum of the indicated torque for
all M cylinders of an M cylinder engine
TiðqeÞ ¼
X
M
m¼1
TmðqeÞ
Diagnostics and Occupant Protection
545

The reciprocating torque associated with the mth cylinder are given by:
TRmðqeÞyMeqR2
cfTðqeÞ

fTðqeÞu
$
e þ fBðqÞu2
e

(6)
where
ue ¼ p RPM
30
fTðqeÞ ¼ sinðqe  qmÞ þ
ðRc=LcÞsin½2ðqe  qmÞ
2
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
1  ðRc=LcÞ2sin2ðqe  qmÞ
q
fBðqeÞ ¼ Rc
Lc
8
>
<
>
:
cos½2ðqe  qmÞ
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
1  ðRc=LcÞ2sin2ðqe  qmÞ
q
9
>
=
>
;
þ
Rc
Lc
3
sin2ðqe  qmÞ
4
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
½ð1  Rc=LcÞ2sin2ðqe  qmÞ3
q
þ cosðqe  qmÞ
(7)
where: Meq ¼ sum of the mass of the piston, wrist pin and 1/3 of the connecting rod.
The combined reciprocating torque TR is given by:
TRðqeÞ ¼
X
M
m¼1
TRmðqeÞ
(8)
For the purposes of modeling the engine for misﬁre detection, it is possible to approximate
TFp(qe) with a linearized model as given below:
TFpðqeÞyReue
where
Re ¼ linearized friction coefﬁcient.
The net torque applied to the crankshaft is the sum of the components:
TnðqeÞ ¼ TiðqeÞ þ TRðqeÞ
(9)
The present method of misﬁre detection in an engine is based upon a metric which represents
the nonuniformity in torque generation (i.e. in dTk). If every cylinder produced exactly the
same torque during a given engine cycle, the ﬂuctuations in dTk would have exactly the same
extrema (i.e. relative maximum and relative minimum). However, this situation is never
achieved in practice due to variations in fueling as well as combustion. Nevertheless, these
extrema are nearly the same for a normal running engine.
546
Chapter 10

On the other hand, for one or more misﬁres (or partial misﬁres) these extrema are signiﬁcantly
different. That is, the nonuniformity in dTk is relatively small for normal engines and
increases signiﬁcantly for misﬁre conditions. The present method of misﬁre detection is based
on a metric for torque nonuniformity for a given engine cycle for an M cylinder engine, which
is denoted n and is given by:
n ¼ d T  dTavu
(10)
where
T ¼ ½T1; T
0
1; /TM; T
0
MT ˛ R2M
where
Tm ¼ Tmðqm
e Þ
¼ relative maximum of Tm
qm
e ¼ crankshaft angle at which Tm occurs
and where
T
0
m ¼ TmðqemÞ
¼ relative minimum of Tm
qem ¼ qe at which T
0
m occurs.
That is, the extremal values for dT are characterized by
dTn
dqe
		qm
e ¼ 0
d2Tn
dq2e
		qm
e < 0
dTn
dqe
jqem ¼ 0
d2Tn
dq2e
jqem > 0
;
m ¼ 1; 2.M
(11)
where
Tav ¼ 1
2M
X
M
m¼1
h
Tm þ T
0
m
i
average of extrema per cycle
(12)
dT ¼

dT1dT
0
1/dTmdT
0
m/dTMdT
0
M
T
dTm ¼ Tm  Tav
dT
0
m ¼ T
0
m  Tav
dTav ¼ 1
2M
X
M
m¼1
h
dTm  dT
0
m
i
ðaverage torque deviationÞ
Diagnostics and Occupant Protection
547

and where u is a 2M dimensional vector given by:
u ¼ ½1; 1; 1; 1.1; 1T
˛ R2M
Figure 10.9 illustrates (qualitatively) the nonuniformity vector samples for a hypothetical
torque waveform. Note that for perfectly uniform torque waveform dT0
m ¼ dTm with the result
that n is a zm dimensional vector with all elements zero.
The presence of a misﬁre can readily be detected by a scalar n derived from a norm of the
vector n
n ¼ k n k1
[1 norm
or
¼ kn k2
[2 norm
(13)
The actual misﬁre detection is done on a statistical hypothesis testing basis. An experimental
test of the misﬁre detection method was conducted in which there are three conditions
expressed as hypothesis H0, H1, H2 where
H0 / normal engine operation
H1 / misﬁre in a single cylinder within an engine cycle
H2 / misﬁre in two cylinders within an engine cycle.
The tests were conducted on a four-cylinder engine having port fuel injection on each
cylinder. The engine control system was programmed to interrupt fuel injection on one or two
cylinders or on none. Instrumentation (explained later) was constructed which obtained the [1
Tn
θ1
θ1
θ2
θM
θe
θ2
θM
Figure 10.9:
Illustrative torque waveform and its extrema.
548
Chapter 10

norm of n (n1) for each of several thousand engine cycles. Figure 10.10 is a plot of the
histogram for these data in which the distribution centered near n1y10 corresponded to H0.
The distribution centered near n1y40 corresponds to H1 and that centered near n1y80
corresponds to H2. This histogram consists of the number of occurrences at the value n1 for
each hypothesis Hi, N (n1, Hi) (i ¼ 0, 1, 2) of nonuniformity index n1. The speciﬁc hypothesis
under any test was determined by the number of cylinders that were caused to be misﬁred in
the associated control instrumentation (i.e. 0, 1, 2 misﬁring cylinders).
The detection of misﬁre can be based on a variety of criteria. For example, a simple statistical
test can be a threshold comparison. Let Nav (H0) be the mean value for n1 under H0, Nav (H1)
be the mean value for n1 under H1. A threshold nt is chosen such that
nt ¼ ½NavðH0Þ þ NavðH1Þ=2
(14)
Histogram for H0, H1, H2
N(n1, H0)
n1
N(n1, H1)
N(n1, H2)
600
500
400
300
200
100
0
0
20
40
60
80
100
Figure 10.10:
Histograms of nonuniformity index.
Diagnostics and Occupant Protection
549

The criterion for misﬁre is as follows:
n1 > nt / misﬁre
n1 < nt / no misﬁre.
There are two types of error associated with the above misﬁre criterion:
n1 < nt for an actual misﬁre (missed detection)
n1 > nt for no misﬁre (false alarm).
It should be noted that a similar statistical study was conducted using other threshold values.
Choosing the threshold as done above yields approximately equal costs to both missed
detection and false alarms.
The above method of detecting misﬁres does not, by itself, identify the cylinder(s) that is (are)
misﬁring. The nonuniformity index vector n1 can be used as a further onboard diagnosis tool to
assist the repair technician in identifying the misﬁring cylinder(s). For an otherwise properly
running engine a unique vector (n) tends to be associated with the misﬁre in each cylinder.
Assume initially that the above misﬁre detection indicates only a single cylinder is misﬁring.
The unique “signature” nonuniformity index for a consistent misﬁre in cylinder m will have
nonuniformity vector nðmÞ. This “signature” can be obtained by running the engine with
cylinder m purposely disabled (i.e. via fuel or spark). Data for the nonuniformity vector nðmÞ
are given by the statistical average of n over a sample of K engine cycles:
n ðmÞ ¼
1
K
X
K
k¼1
nk;
m ¼ 1; 2.M
(15)
where
nk ¼ nonuniformity vector for the kth engine cycle:
Each of these M vectors is directed to a point in a 2M dimensional space. The isolation of the
misﬁringcylinderisdonebyﬁndingtheshortest“distance”fromanonuniformityvectorn tothese
vectors. This vector distance (for the kth engine cycle) in 2M dimensional space dkðmÞ is given by
dkðmÞ ¼ nðmÞ  nk
(16)
where n is the measured nonuniformity vector for an engine cycle in which a single
cylinder misﬁre has been detected. The problem of isolating the misﬁring cylinder is
reduced to ﬁnding the cylinder number mo, which yields the smallest [2 norm for the
vector distance
min
m ðkdm k 2Þ ¼ k dmo k 2
(17)
550
Chapter 10

That is, cylinder mo (mo ¼ 1, 2, . M) has the minimum k dmo k 2 and is identiﬁed as the
misﬁring cylinder.
If cylinder mo consistently misﬁres (as opposed to a random pattern) then by setting an
appropriate ﬂag in the diagnostic memory, the repair technician can know which cylinder
should be analyzed for problems. This type of information greatly reduces the off-board
diagnosis and maintenance effort. Often vehicles experience intermittent failures. A relatively
simple onboard analysis program can evaluate the frequency of and the consistency of an
intermittently misﬁring cylinder.
Although the above method has great potential for detecting and diagnosing misﬁre problems,
it cannot be directly implemented since there is no cost-effective method of measuring torque;
however, the torque ﬂuctuations dTn lead directly to crankshaft speed ﬂuctuations which are
measurable with a simple, inexpensive non-contacting sensor. We explain below the
relationship between torque and crankshaft angular speed ﬂuctuations. This relationship can
be developed from a dynamic model for the power train as explained next.
A close enough estimate of dTn for misﬁre detection purposes can be obtained from a sliding
mode observer (SMO) based upon a relatively straightforward system for measuring
crankshaft angular speed (ue). The model from which this SMO is built for an automatic
transmission-equipped vehicle with unlocked torque converter is given below
J,ue ¼ TiðqeÞ  TRðqeÞ  Reue  TlðqeÞ
(18)
where
J ¼ moment of inertia of engine rotating parts
and where
Tl ¼ load torque on the engine output.
For the purposes of illustration, we consider the special case in which the vehicle is traveling
under steady-state conditions for which Tl is a constant. This term can be neglected in the
computation of torque ﬂuctuations (as is done here).
Combining Eqns (10.4 through 10.8) with Eqn (10.18) yields the following model for ,ue
,ue ¼
1
J þ MeqR2c f 2
T

qe
fðpc  poÞApRcfTðqeÞ  MeqR2
cfTðqeÞfBðqeÞu2
e  Reueg
(19)
The equations for Ti and TR have been given previously. Rewriting the above equation in state
vector form with state vector x given by
x ¼ ½x1 x2T;
x1 ¼ qe
x2 ¼ ue
Diagnostics and Occupant Protection
551

yields
,x1 ¼ x2
,x2 ¼
1
J þ MeqR2cf 2
Tðx1Þ

ðpc  poÞApRcfTðx1Þ  MeqR2
cfTðx1ÞfBðx1Þx2
2  Rex2

(20)
It is shown below that both x1 and x2 are measurable with inexpensive non-contacting sensors.
Let the measurement of state vector x1 be denoted y1 and the measurement of x2 be denoted y2
The SMO for the estimate of x2 (which is denoted ^x2) is given by:
^x2 ¼
1
J þ MeqR2cf 2
Tðy1Þf  ASMOsgn ½fTðy1Þð^x2  y2ÞApRcfTðy1Þ
Meq2R2
cfTðy1ÞfRðy1Þy2
2  Rey2g
(21)
where
ASMO ¼ SMO gain
sgn( ) ¼ sign function of argument.
The SMO gain requirement is that it be larger than the maximum value that can occur for
(Pe  Po):
ASMO > max ðPc  PoÞ
The estimate of indicated torque is obtained as the output of the ﬁrst order ﬁlter given by
s ,v þ v ¼ ASMOsgn

fTðy1Þð^x2  y2Þ

ApRcfTðy1Þ
(22)
^Tn ¼ v
Using this SMO to estimate ^Tn it is possible to form dTn and the vector T from which misﬁre
detection is possible as explained above.
The measurement of crankshaft angular position and speed can readily be made using a non-
contacting sensor such as that depicted in Figure 10.11 and as explained in Chapter 6. In
Figure 10.11, the ferromagnetic disk (with lugs) is attached to the crankshaft. However, for
the accuracy in measurements of qe and we required for SMO estimation of torque, there is
a minimum number of lugs on the ferromagnetic disk. Experiments have shown that use of the
starter ring gear which typically has 30-50 teeth is sufﬁcient for these measurements.
For illustrative purposes it is convenient to consider these measurements at a relatively slowly
changing RPM. In this case the crankshaft angular speed ue(t) is given by:
ueðtÞ ¼ Ue þ d ueðtÞ
(23)
552
Chapter 10

where
Ue ¼ p RPM
30
¼ short-term time average of ue
due(t) ¼ variation in ue due to dTn
This angular speed is actually in the form of a frequency-modulated (FM) carrier frequency in
which Ue acts as the carrier frequency and due(t) is the modulation. It should be noted that
Ue [ max (due).
The crankshaft instantaneous angular position qe(t) is given by
qeðtÞ ¼ qo þ
Zt
o
ue

t
0
dt
0
(24)
where qo ¼ qe(0) ¼ phase reference.
The phase reference can be established relative to the engine cycle via a camshaft once/
revolution non-contacting sensor (see Chapter 7).
The sensor output signal v0(t) is given by
v0ðtÞ ¼ f½MdqeðtÞ þ j
(25)
where
Md ¼ number of lugs on disk
j(t) ¼ random process (error in the sensor output).
The function f($) is the waveform associated with the sensor conﬁguration. Fortunately the
electronic signal processing required to measure ue(t) can be obtained using either analog or
Figure 10.11:
Non-contacting crankshaft angular speed sensor.
Diagnostics and Occupant Protection
553

digital electronic signal processing. Figure 10.12 shows a block diagram for an analog signal
processing.
The “frequency to voltage converter” is in effect an FM demodulator which can be
implemented with a circuit known as a “phase-locked loop” (PLL). The PLL is an electronic
closed-loop system. It is output voltage vp(t) is given by
vp ¼ Kp

Mdue

t

þ
,j

The low-pass ﬁlter (LPF) passes the ﬁrst term and suppresses that portion of the spectrum of
,j which lies outside the LPF pass bands thereby yielding the measurement of ue needed for
the SMO to compute ^Tn. For the present analysis it is assumed that this portion of
,j is
negligible. The crankshaft angular position can be obtained by integrating the LPF output
voltage. Using the integrator circuit described in Chapter 3 the integrator output voltage VI
is given by
V1 ¼ 1
si
Zt
0
Veðt0Þdt0
¼ Kp Md
si
½qeðtÞ þ qo
(26)
where
si ¼ integrator time constant
Of course, digital integration as explained previously (e.g. see Chapter 8) can also be used to
obtain VI. The phase origin for this measurement of qe(t) is established via the once/revolution
camshaft sensor. The measurement of qe is required as part of the computation of the
nonuniformity index n.
In a contemporary implementation the measurement of ue(t) is done in discrete time based
upon successive samples of vo(t). As explained in Chapter 6, a sensor such as is depicted in
Figure 10.12 generates an output waveform which crosses zero whenever one of the lugs on
Sensor
Frequency to
voltage
converter
(PLL)
Low pass
filter
(LPF)
Integrator
vs
vp
ve
v1
Figure 10.12:
Block diagram for ue measurement.
554
Chapter 10

the disk lies along the centerline (CL) of the disk sensor axis. Let tk be the time of the kth zero
crossing of the sensor output voltage, and let dtk be given by:
d tk ¼ tk  tk1
The kth sample of ue(t) which is denoted ue(k) and is given by:
ueðkÞ ¼
1
Mdd tk
(27)
If Md is sufﬁciently large, the sequence {ue(k)} will be an un-aliased sample of ue(k).
The instantaneous crankshaft angular position qe(k) is given by:
qeðkÞ ¼ qeðtkÞ;
k ¼ 1; 2 . 2Md
(28)
This sampled crankshaft angular position is readily obtained by passing the sensor through
a zero crossing detector (ZCD) and counting the output pulses using a binary counter (see
Chapter 4 for an explanation of a counter) as explained in Chapter 6. The counter should be
reset by a signal from the once/revolution camshaft sensor. This signal is also sent to a ZCD
and then to the binary counter reset input. This conﬁguration will automatically count zero
crossings of the crankshaft sensor of Figure 10.12 modulo 2Md.
Using the instrumentation above for measuring ue and qe provides the necessary values for
a calculation of ^Tn using the SMO as well as the nonuniformity index n. The misﬁre detection
proceeds using the estimate of Tn according to the procedure explained earlier.
The above hypothetical method of misﬁre detection has been shown to reliably detect
misﬁres both in a laboratory environment and in actual road tests. For a test vehicle
equipped with an automatic transmission total errors of less than 1% have been achieved for
the exemplary misﬁre detection in actual road tests. Although intellectual property
considerations preclude discussing the actual misﬁre detection methods used by any
automotive manufacturer, many of the components of the hypothetical system are to be
found in some of them.
Expert Systems in Automotive Diagnosis
An expert system is a computer program that employs human knowledge to solve problems
normally requiring human expertise. The theory of expert systems is part of the general area
of computer science known as artiﬁcial intelligence (AI). The major beneﬁt of expert system
technology is the consistent, uniform, and efﬁcient application of the decision criteria or
Diagnostics and Occupant Protection
555

problem-solving strategies. We consider next a hypothetical expert system devoted to
automotive diagnosis.
The diagnosis of electronic engine control systems by an expert system proceeds by following
a set of rules that embody steps similar to the diagnostic charts in the shop manual. The
diagnostic system can receive fault codes from the onboard diagnostic. The system processes
these codes logically under program control in accordance with the set of internally stored
rules. However, as explained above, not all faults are detected by the onboard diagnostic
system. Testing of various systems and components by the service technician as directed by
the expert system aids the diagnosis of problems. The hypothetical expert system-based
diagnostic procedure also is designed to receive inputs from the service technician based on
such tests. The end result of the computer-aided diagnosis is an assessment of the problem
and recommended repair procedures. The use of an expert system for diagnosis has the
potential to improve the efﬁciency of the diagnostic process and can thereby reduce
maintenance time and costs.
The development of an expert system requires a computer specialist who is known in AI
parlance as a knowledge engineer. The knowledge engineer must acquire the requisite
knowledge and expertise for the expert system by interviewing the recognized experts in the
ﬁeld. In the case of automotive electronic engine control systems the experts include the
design engineers, the test engineers and technicians, involved in the development of the
control system. In addition, expertise is developed by the service technicians who routinely
repair the system in the ﬁeld. The expertise of this latter group can be incorporated as
evolutionary improvements in the expert system. The various stages of knowledge acquisition
(obtained from the experts) are outlined in Figure 10.13.
It can be seen from this illustration that several iterations are required to complete the
knowledge acquisition. Thus, the process of interviewing experts is a continuing process.
Not to be overlooked in the development of an expert system is the personal relationship
between the experts and the knowledge engineer. The experts must be fully willing to
cooperate and to explain their expertise to the knowledge engineer if a successful expert
system is to be developed. The personalities of the knowledge engineer and experts can
become a factor in the development of an expert system.
Figure 10.14 represents the environment in which an expert system evolves. Of course,
a digital computer of sufﬁcient capacity is required for the development work. A summary of
expert system development tools that have been used in the past and that are potentially
applicable for a mainframe computer is presented in Table 10.2.
It is common practice to think of an expert system as having two major portions. The portion
of the expert system in which the logical operations are performed is known as the inference
engine. The various relationships and basic knowledge are known as the knowledge base.
556
Chapter 10

Thegeneraldiagnosticﬁeldtowhichanexpertsystemisapplicableisoneinwhichtheprocedures
used by the recognized experts can be expressed in a set of rules or logical relationships. The
automotive diagnosis area is clearly such a ﬁeld. The diagnostic charts that outline repair
procedures (as outlined earlier in this chapter) represent good examples of such rules.
To clarify some of the ideas embodied in an expert system, consider the following example of
the diagnosis of an automotive repair problem. This particular problem involves failure of the
car engine to start. It is presumed in this example that the range of defects is very limited.
Although this example is not necessarily commonly encountered, it does illustrate some of
the principles involved in an expert system.
Figure 10.13:
Expert system development procedure.
Diagnostics and Occupant Protection
557

The fundamental concept underlying this example is the idea of condition-action pairs
that are in the form of IF-THEN rules. These rules embody knowledge that is presumed to
have come from human experts (e.g. experienced service technicians or automotive
engineers).
A typical expert system formulates expertise in IF-THEN rules.
The expert system of this example consists of three components:
(1) A rule base of IF-THEN rules
(2) A database of facts
(3) A controlling mechanism.
Each rule of the rule base is of the form of “if condition A is true, then action B should be
taken or performed.” The IF portion contains conditions that must be satisﬁed if the rule is to
be applicable. The THEN portion states the action to be performed whenever the rule is
activated (ﬁred).
The database contains all the facts and information that are known to be true about the
problem being diagnosed. The rules from the rule base are compared with the knowledge base
Figure 10.14:
Environment of an expert system.
Table 10.2: Expert system developing tools for mainframes.
Name
Company
Machine
Ops5
Carnegie Mellon
University
VAX
S.1
Teknowledge
VAX
Xerox 1198
Loops
Xerox 1108
Kee
Intelligenetics
Xerox 1198
Art
Inference
Symbolics
558
Chapter 10

to ascertain which are the applicable rules. When a rule is ﬁred, its actions normally modify
the facts within the database.
The controlling mechanism of this expert system determines which actions are to be taken
and when they are to be performed. The operation follows four basic steps:
(1) Compare the rules to the database to determine which rules have the IF portion satisﬁed
and can be executed. This group is known as the conﬂict set in AI parlance.
(2) If the conﬂict set contains more than one rule, resolve the conﬂict by selecting the highest
priority rule. If there are no rules in the conﬂict set, stop the procedure.
(3) Execute the selected rule by performing the actions speciﬁed in the THEN portion, and
then modify the database as required.
(4) Return to Step 1 and repeat the process until there are no rules in the conﬂict set.
In the present simpliﬁed example, it is presumed that the rule base for diagnosing a problem
starting a car is as given in Figure 10.15.
Rules R2 through R7 draw conclusions about the suspected problem, and rule R1 identiﬁes
problem areas that should be investigated. It is implicitly assumed that the actions speciﬁed in
the THEN portion include “add this fact to the database.” In addition, some of the speciﬁed
actions have an associated fractional number. These values represent the conﬁdence of the
expert who is responsible for the rule that the given action is true for the speciﬁed condition.
Further suppose that the facts known to be true are as shown in Figure 10.16.
The controlling mechanism follows Step 1 and discovers that only R1 is in the conﬂict set.
This rule is executed, deriving these additional facts in performing Steps 2 and 3:
•
Suspect there is no spark
•
Suspect too much fuel is reaching the engine.
At Step 4, the system returns to Step 1 and learns that the conﬂict set includes R1, R4, and R6.
Since R1 has been executed, it is dropped from the conﬂict set. In this simpliﬁed example,
assume that the conﬂict is resolved by selecting the lowest numbered rule (i.e. R4 in this
case). Rule R4 yields the additional facts after completing Steps 2 and 3 that there is a break
in the fuel line (0.65). The value 0.65 refers to the conﬁdence level of this conclusion.
The procedure is repeated with the resulting conﬂict set R6. After executing R6, the
system returns to Step 1, and ﬁnding no applicable rules, it stops. The ﬁnal fact set is
shown in Figure 10.17. Note that this diagnostic procedure has found two potential
diagnoses: a break in the fuel line (conﬁdence level 0.65), and mixture too rich
(conﬁdence level 0.70).
The previous example is intended merely to illustrate the application of AI to automotive
diagnosis and repair. To perform diagnosis on a speciﬁc car using an expert system, the
Diagnostics and Occupant Protection
559

Figure 10.15:
Simple automobile diagnostic rule base.
Figure 10.16:
Starting database of known facts.
Figure 10.17:
Final resulting database of known facts.
560
Chapter 10

service technician identiﬁes all the relevant features to the service technician’s terminal
including, of course, the engine type. After connecting the data link from the onboard
diagnostic system to the terminal, the diagnosis can begin. The terminal can ask the service
technician to perform speciﬁc tasks that are required to complete the diagnosis, including, for
example, starting or stopping the engine.
The expert system is an interactive program and, as such, has many interesting
features. For example, when the expert system requests that the service technician
perform some speciﬁc task, he/she can ask the expert system why he or she should do
this, or why the system asked the question. The expert system then explains the
motivation for the task, much the way a human expert would do if he or she were
guiding the service technician. An expert system is frequently formulated on rules of
thumb that have been acquired through years of experience by human experts. It often
beneﬁts the service technician in his or her task to have requests for tasks explained in
terms of both these rules and the experience base that has led to the development of
the expert system.
The general science of expert systems is so broad that it cannot be covered in this book. The
interested reader can contact any good engineering library for further material in this exciting
area. In addition, the SAE has many publications covering the application of expert systems
to automotive diagnosis.
From time to time, automotive maintenance problems will occur that are outside the scope of
the expertise incorporated in the expert system. In these cases, an automotive diagnostic
system needs to be supplemented by direct contact of the service technician with human
experts. Automobile manufacturers all have technical assistance available to service
technicians via internal connections, or e-mail.
Vehicle off-board diagnostic systems (whether they are expert systems or not) continue to be
developed and reﬁned as experience is gained with the various systems, as the diagnostic
database expands, and as additional software is written. The evolution of such diagnostic
systems may be heading in the direction of fully automated, rapid, and efﬁcient diagnoses of
problems in cars equipped with modern digital control systems.
Occupant Protection Systems
Occupant protection during a crash has evolved dramatically since about the 1970s.
Beginning with lap seat belts, and motivated partly by government regulation and partly
by market demand, occupant protection has evolved to passive restraints and airbags. We
will discuss only the latter since airbag deployment systems can be implemented
electronically, whereas other schemes are largely mechanical. Whereas the ﬁrst airbag
Diagnostics and Occupant Protection
561

occupant protection systems were intended for occupant protection in crashes that were
mostly along the vehicle longitudinal axis, contemporary vehicles provide side impact
protection.
Occupant protection by an airbag is conceptually quite straightforward. The airbag system
has a means of detecting when a crash occurs that is essentially based on exceptional
deceleration along a car axis. A collision that is serious enough to injure car occupants
involves deceleration in the range of tens or hundreds of gs, whereas normal driving involves
acceleration/deceleration less than 1 g.
Once a crash has been detected, a ﬂexible bag is rapidly inﬂated with a gas that is released
from a container by electrically igniting a chemical compound. Ideally, the airbag inﬂates in
sufﬁcient time (e.g. typically 50 ms) to act as a cushion for the driver (or passenger) as he or
she is thrown forward or sideways during the crash.
On the other hand, practical implementation of the airbag has proven to be technically
challenging. At car speeds that can cause injury to the occupants, the time interval for a crash
into a rigid barrier from the moment the front bumper contacts the barrier until the ﬁnal part of
the car ceases forward motion is of the order of a second. Table 10.3 lists required airbag
deployment times for a variety of test crash conditions.
A typical airbag will require about 30 ms to inﬂate, meaning that the crash must be detected
within about 20 ms. With respect to the speed of modern digital electronics, a 20-ms time
interval is not considered to be short. The complicating factor for crash detection is the
many crash-like accelerations/decelerations experienced by a typical car that could be
interpreted by airbag electronics as a crash, such as impact with a large pothole or driving
over a curb.
The conﬁguration for an airbag system has also evolved from electromechanical
implementation (using switches) to electronic systems employing sophisticated signal
processing. One of the early conﬁgurations that was intended to protect occupants from
longitudinal axis deceleration employed a pair of acceleration switches SW1 and SW2 as
depicted in Figure 10.18. Each of these switches is in the form of a mass suspended in a tube
with the tube axis aligned parallel to the longitudinal car axis. Figure 10.18b is a circuit
diagram for the airbag system.
The two switches, which are normally open, must both be closed to complete the circuit for
ﬁring the airbag. When this circuit is complete, a current ﬂows through the ignitor that
activates the charge. A gas is produced (essentially explosively) that inﬂates the airbag.
The switches SW1 and SW2 are placed in two separate locations in the car. Typically, one is
located near the front of the car and one in or near the front of the passenger compartment
(some automakers locate a switch under the driver’s seat on the ﬂoor pan).
562
Chapter 10

Referring to the sketch in Figure 10.18, the operation of the acceleration-sensitive switch can
be understood. Under normal driving conditions the spring holds the movable mass against
a stop and the switch contacts remain open. During a crash the force of acceleration (actually
deceleration of the car) acting on the mass is sufﬁcient to overcome the spring force and move
the mass. For sufﬁciently high car deceleration, the mass moves forward to close the switch
contacts. In a real collision at sufﬁcient speed, both switch masses will move to close the
switch contacts, thereby completing the circuit and igniting the chemical compound to inﬂate
the airbag.
An approximate dynamic model for the mechanical crash sensor is given below:
M€x þ D _x þ Fc þ Kx ¼ 0
(29)
Table 10.3: Airbag deployment times.
Test Library Event
Required Deployment
Time (ms)
9 mph frontal barrier
ND
9 mph frontal barrier
ND
15 mph frontal barrier
50.0
30 mph frontal barrier
24.0
35 mph frontal barrier
18.0
12 mph left angle barrier
ND
30 mph right angle barrier
36.0
30 mph left angle barrier
36.0
10 mph center high pole
ND
14 mph center high pole
ND
18 mph center high pole
ND
30 mph center high pole
43.0
25 mph offset low pole
56.0
25 mph car to car
50.0
30 mph car to car
50.0
30 mph 550 hop road, panic stop
ND
30 mph 629 hop road, panic stop
ND
30 mph 550 tramp road, panic stop
ND
30 mph 629 tramp road, panic stop
ND
30 mph square block road, panic stop
ND
40 mph washboard road, medium braking
ND
25 mph left-side pothole
ND
25 mph right-side pothole
ND
60 mph chatter bumps, panic stop
ND
45 mph massoit bump
ND
5 mph curb impact
ND
20 mph curb drop-off
ND
35 mph Belgian blocks
ND
Note: ND ¼ nondeployment.
Diagnostics and Occupant Protection
563

where
M ¼ mass of the movable element
D ¼ viscous friction coefﬁcient
Fc ¼ coulomb friction force (stiction)
K ¼ spring constant.
x ¼ mass displacement of M from stop.
The acceleration of the mass (€x) is related to vehicle acceleration a or deceleration (a) by
the following
€x ¼ a
The motion of the movable mass is the solution to the following:
D$x þ Fc þ Kx ¼ Ma
(30)
Whenever the mass displacement exceeds the spacing to the switch contact (xp) (i.e. x ¼ xp)
the contacts close and the action described above proceeds.
Figure 10.18:
Airbag deployment system.
564
Chapter 10

Figure 10.18 also shows a capacitor connected in parallel with the battery. This capacitor
is typically located in the passenger compartment. It has sufﬁcient capacity that in the
event the car battery is destroyed early in the crash, it can supply enough current to ignite
the squib.
In recent years, there has been a trend to implement electronic airbag systems. In such
systems the role of the acceleration-sensitive switch is played by an analog accelerometer
along with electronic signal processing, threshold detection, and electronic driver circuit to
ﬁre the squib. Figure 10.19 depicts a block diagram of such a system.
The accelerometers A1 and A2 are placed at locations similar to where the switches SW1 and
SW2 described above are located. Each accelerometer outputs a signal that is proportional to
acceleration (deceleration) along its sensitive axis. As an illustration of the characteristic
waveform from an accelerometer, Figure 10.20 presents measurements of a 3200 lb (curb
weight) vehicle that was crashed into a rigid barrier at 30 mph.
Under normal driving conditions, the acceleration at the accelerometer locations is less
than 1 g. However, during a collision at a sufﬁciently high speed the signal increases
rapidly. Signal processing can be employed to enhance the collision signature in relation to
the normal driving signal. Such signal processing must be carefully designed to minimize
time delay of the output relative to the collision deceleration signal. A comparison of the
deceleration proﬁle of Figure 10.20 for this crash with the deployment requirements of
Table 10.3 illustrates the complexity of the signal processing necessary to properly deploy
the airbag.
After being processed, the deceleration signal is compared with a threshold level. As long as
the processed signal is less than this threshold the driver circuit remains deactivated.
However, when this signal exceeds the threshold, the driver circuit sends a current of
sufﬁcient strength to activate the chemical and inﬂate the airbag.
Typically, the threshold is set so that airbag deployment occurs for a crash into a barrier at or
above a speciﬁc speed. Depending on the system design, this speed can be anywhere between
Figure 10.19:
Accelerometer-based airbag system.
Diagnostics and Occupant Protection
565

8 and 12 mph. This speed range is chosen by the manufacturer to optimize the protection
offered to the car occupants while minimizing (or completely eliminating) false deployment
(that is, deployment when there is no crash).
In addition to airbags for protecting the driver and front seat passenger against
frontal collision, airbags have become available for occupant protection against other
types of collisions. Airbags now are available for protection against side impact.
Conceptually, these occupant protection systems operate in ways similar to the type
described above.
There will continue to be new developments in airbag technology in order to improve
performance. Complicating this task is the fact that the signature of a crash differs
depending on the crash conﬁguration and vehicle design. For example, there is one class of
signature for a crash into a rigid barrier (i.e. a nonmoving and incompressible object) and
another for a crash between a pair of cars (particularly when vehicle curb weights are
different). In spite of technical difﬁculties in implementation, the airbag is ﬁnding broad
application for occupant protection and has achieved broad acceptance by the driving
public.
Figure 10.20:
Acceleration data for 30 mph crash.
566
Chapter 10

In addition to airbags, contemporary vehicles employ passive restraint systems consisting of
lap and over-the-shoulder belts. These passive restraints combined with airbags offer a high
level of occupant protection. Although it is not an electronic system, another aspect of
occupant protection comes from an optimal vehicle structural design. Contemporary vehicles
are structurally designed to absorb crash energy in such a way as to minimize intrusion of
damage into the passenger compartment.
Diagnostics and Occupant Protection
567

This page intentionally left blank

Glossary
Accumulator (Computer component): The basic work register of a computer.
Actuator: A device which performs an action in response to an electrical signal.
A/D (also ADC): Analog-to-digital converter; an electronic circuit device that generates binary or binary coded
digital output that is proportional to an analog input voltage.
A/F: See Air/Fuel Ratio.
Analog Circuits: Continuous time linear electronic circuits in which voltages are proportional to some physical
quantities.
Assembly Language: An abbreviated computer language in which basic computer instructions and addresses are
represented by pneumonic alphabetic symbol groups.
BDC: Bottom dead center; the extreme lowest position of the piston during its stroke.
Bit: A binary digit; a single digit in a binary number system.
Block Diagram: A system diagram which shows all of the major parts and their interconnections normally
including an analytical model for each component.
BSCO: Brake speciﬁc CO: the ratio of the rate at which carbon monoxide leaves the exhaust pipe to the brake
horsepower.
BSFC: Brake speciﬁc fuel consumption; the ratio of fuel consumption to the brake horsepower being
generated.
BSHC: Brake speciﬁc HC; the ratio of the rate at which unburned hydrocarbons leave the exhaust pipe to the brake
horsepower.
BSNOx: Brake speciﬁc NOx; the ratio of the rate at which oxides of nitrogen leave the exhaust pipe to the brake
horsepower.
Byte: An 8-bit binary number.
CAFE: Corporate-Average-Fuel-Economy. The government mandated fuel economy which is averaged over the
production for a year for any given manufacturer.
Capacitor: A two-terminal circuit component that stores charge and has a terminal voltage that is proportional to
stored charge.
Catalytic Converter: A device which enhances certain chemical reactions which help to reduce the levels of
undesirable exhaust gases from the tailpipe relative to their levels at the output of the engine.
Closed-Loop Control: A control system in which the control signal that regulates the plant output is a function of
the difference between the desired and actual values of the output variable being regulated.
Closed-Loop Fuel Control: A fuel control mode where input air/fuel ratio is controlled by metering the fuel
response to the rich-lean indications from an exhaust gas oxygen sensor.
CO: Carbon monoxide; an undesirable chemical combustion product due to imperfect combustion.
Combinational Logic: Logic circuits whose outputs depend only on the present logic inputs.
Combustion: The burning of the fuel-air mixture in the cylinder.
Comparator, Analog: An electronic circuit in which the binary valued ooutput voltage is determined by the relative
amplitude of its two input voltages.
Compression Ratio: The ratio of the cylinder volume at BDC to the volume at TDC.
Control Variable: The output of the controller which is the input to the plant that regulates the output variable in
accordance with the control law.
569

Conversion Efﬁciency (Catalytic Converter): the ratio of ﬂow rate of remaining regulated exhaust gas in the
converter output to their input ﬂow rates.
CPU: Central processing unit; the portion of a computer that performs all arithmetic, logic and data transfer
operations.
Cutoff: A transistor operating mode for which very little (ideally zero) current ﬂows between the collector and
emitter (with proper supply voltages) due to zero base current.
D/A (also DAC): Digital-to-analog converter; a device which produces a voltage which is proportional to the digit
input number.
Damping Coefﬁcient: The coefﬁcient of the ﬁrst order time derivative in the linear differential equation model for
a second order system.
DEMUX: Demultiplexer; a type of electronic switch used to select one of several input lines for its output.
Diesel: A class of internal combustion engine (also known as a compression ignition engine) in which combustion is
initiated by the high temperature of the compressed air/fuel mixture in the cylinder during a compression stroke.
Differential Gain: The coefﬁcient multiplying the time derivative of the error in a PID control law.
Digital Circuits: Electronic circuit systems made up of combinations of individual circuits whose output voltages
switch between two levels corresponding to 1 and 0 of a binary or a binary coded number system.
Diode: A two-terminal circuit component that ideally functions as an electronic switch whose state is a function of
the polarity of the applied voltage.
Display: A device which indicates in human readable form the result of measurement of some variable.
Drivetrain: The combination of mechanisms connecting the engine to the driving wheels including transmission,
driveshaft, and differential.
Dwell: The portion of an engine cycle during which current ﬂows through the primary circuit of the ignition coil for
each spark generation.
Dynamometer: A device for applying a mechanical load to an engine output having the capability of measuring
engine performance.
Efﬁciency: A variable or parameter that serves as a metric for the performance of a system or component in
achieving a desired result.
EGO: Exhaust gas oxygen; the concentration of oxygen in the exhaust of an engine.
EGO Sensor: A sensor is used in closed-loop fuel control systems to indicate rich or lean A/F.
EGR: Exhaust gas recirculation; a mechanism in which a portion of exhaust is introduced into the intake of an
engine.
Electronic Carburetor: A fuel metering actuator in which the air/fuel ratio is controlled by continual variations of
the metering rod position in response to an electronic control signal (now obsolete).
Engine Calibration: The values for air/fuel, spark advance, and EGR at any operating condition.
Engine Crankshaft Position: The angular position of the crankshaft relative to a reference point.
Engine Mapping: A procedure of experimentally determining the performance of an engine at selected operating
points and recording the results.
Equivalence Ratio: Actual air/fuel ratio divided by the air/fuel ratio at stoichiometry.
Evaporative Emissions: Evaporated fuel from the fuel system which can mix with the surrounding air unless
collected by a subsystem.
Foot-Pound: A unit of torque corresponding to a force of one pound acting on a one-foot level arm.
Frequency Response: A graph of the magnitude and phase of a system transfer function for sinusoidal input as
a function of frequency.
Gain: The ratio of a system’s output magnitude to its input magnitude.
Gasoline: The fuel for spark ignited internal combustion (IC) engines consisting of a mixture of various chemical
compounds of hydrogen and carbon (with various additives).
Hardware (Computer): The Electronic digital circuits and peripheral devices that constitute the physical structure
of a computer.
Harness: The wire bundles that interconnect all electrical and electronic components/systems in an automobile.
HC: Abbreviation for hydrocarbon chemicals, such as gasoline, formed by the union of carbon and hydrogen.
570
Glossary

Ignition Timing: The time of occurrence of ignition measured in degrees of crankshaft rotation relative to TDC.
Inductor: A two-terminal magnetic circuit component that stores energy in a magnetic ﬁeld produced by current
ﬂowing in it and having a terminal voltage that is proportional to the time rate of change of that current.
Instrumentation: Apparatus (often electronic) which is used for measurement or control, and for display of
measurements or conditions.
Integral Gain: The coefﬁcient multiplying the integral of the error in a PI or PID control law.
Integrator: An electronic circuit or computer function whose output is the time integral of its input.
Integrated Circuit: A semiconductor device which contains many circuit functions on a single chip interconnected
in such a way as to perform high level functions.
Interrupts: An input to a microprocessor that provides an efﬁcient method of quickly providing a signal that
a particular external event has occurred, normally resulting in an interruption in the execution of a sequence of
computer instructions.
Lead/Lag Term: A control system phase compensation that provides a phase advance (lead) or delay (lag) in the
control law.
Limit Cycle: A mode of control system operation in which the controlled variable switches between a pair of limits
with the average near the desired value.
Linear Region: A transistor operating mode where the collector current is proportional to the base current.
Logic Circuits: Digital electronic circuits that perform logical operations such as NOT, AND, OR, and combi-
nations of these.
Lookup Table: A table in the computer memory of selected data points for a dependent variable at corresponding
points for an independent variable from which the value of the dependent variable can be computed at inter-
mediate values of the independent variable by interpolation
MAP: Manifold absolute pressure; the absolute pressure in the intake manifold of an engine.
Mathematical Model: An equation or set of equations expressing the functional relationship between the variables
of a given system from which the dynamic response of the system outputs can be computed for various inputs.
Microcomputer: A small computer which uses an integrated circuit microprocessor and related components
capable of discrete time control applications
MUX: Multiplexer; a type of electronic switch used to select one of several input lines and functionally connect that
input to the MUX output.
NOx: The various oxides of nitrogen.
Op Code: A binary number that causes a speciﬁc microprocessor operation to occur when placed in the instruction
decode circuit
Open-Loop Control: A control mode in which the control or actuator signal is computed as a function of
a measurement of an input.
Open-Loop Fuel Control: A mode where engine input air/fuel ratio is controlled by measuring the mass ﬂow rate
of input air and adding the proper mass ﬂow rate of fuel to obtain the desired air/fuel ratio.
Operational Ampliﬁer: A standard analog building block with two inputs, one output, and a very high voltage gain
between the differential input and the output.
Optimal Damping: The damping of a second order system that produces the fastest time response without
overshoot.
Peripheral: An external input-output device that is connected to a computer.
Phase Shift: The time delay between the output of a system and the sinusoidal input expressed as a fraction of the
period of the sinusoid either in degrees or radians.
Plant: The system that is to be controlled in a control system.
Port Fuel Injection: A fuel metering system in which fuel from a fuel injector is directed into the intake of
a cylinder.
Proportional Gain: The component of a control (or actuating) signal that is proportional to the difference between
the desired and actual output of a closed-loop control system.
Qualitative Analysis: A study that reveals how a system works expressed intuitively rather than analytically.
Quantitative Analysis: An analytical performance analysis for a system.
Glossary
571

RAM: Random access memory; read/write memory.
Random Error: A stochastic measurement error that is characterized by its statistics.
Reference Input: The input to a control system that corresponds to the desired plant output.
Resister: A two-terminal circuit component whose terminal voltage is proportional to the current passing through it
ROM: Read only memory; permanent memory used to store programs and parameters.
RPM: Revolutions per minute; the angular speed of rotation of the crankshaft of an engine or other rotating shaft.
Sample and Hold: The act of measuring a voltage at a particular time and storing that voltage until a new sample is
taken.
Sampling: The act of obtaining a measurement of a time varying voltage at discrete times (mostly done
periodically).
Saturation: A transistor operating mode for which the collector-emitter current is the maximum possible for a given
supply voltage and collector/emitter resistance (functionally equivalent to a closed switch between collection
and emitter).
Semiconductor: A material that has an electrical conductivity somewhere between that of a conductor and an
insulator.
Sensor: An energy conversion device which measures some physical quantity and converts it to an electrical
quantity (e.g., voltage).
Sequential Logic: Logic circuits whose output depends on the particular sequence of the input logic signals often
requiring a timing (clock) input.
SI Engine: Abbreviation for spark-ignited, gasoline-fueled, piston-type, internal-combustion engine.
Signal Processing: The alteration of an electrical signal by electronic circuitry used to achieve a desired result (e.g.,
ﬁltering).
Skid: A condition in which the tires are sliding over the road surface rather thin rolling; usually associated with
braking.
Slip: The ratio of the difference between a given speed (either translational or rotational) and a corresponding
reference speed to the reference speed.
Software: The computer program instructions to perform the desired computer operations.
Spark Advance: The number of degrees of crankshaft rotation before TDC where the spark plug is ﬁred. (See
ignition timing.)
Spark Timing: The process of ﬁring the spark plugs at the proper moment to ignite the combustible mixture in the
engine cylinders.
Stoichiometry: The air/fuel ratio for perfect combustion for which all of the hydrogen and carbon in the fuel are
oxidized to H2O and CO2.
System: A collection of interacting parts.
Systematic Error: A measurement error in instrumentation system which is predictable and correctable.
TBFI: Throttle-body-fuel-injector; a fuel metering actuator in which the air/fuel ratio is controlled by injecting
precisely controlled spurts of fuel into the air stream entering the intake manifold (now obsolete).
TDC: Top dead center; the extreme highest point of the piston during its stroke.
Throttle Angle: The angle between the throttle plate and a reference line.
Torque Converter: A form of ﬂuid coupling used in an automatic transmission in which the coupling between the
input and output shafts is achieved by momentum transfer of a ﬂuid between an input shaft and an output shaft.
Torque: The twisting force of the crankshaft or other driving shaft.
Transfer Function: The ratio of the Laplace transforms of the output to the input of a linear system with zero initial
conditions for which complex frequency s is the independent variable.
Tranformer: An electrical circuit component capable of inductively coupling circuits for time-varying electrical
signals and changing a-c voltage levels.
Transistor: A three-terminal active semiconductor circuit component capable of amplifying currents or voltages.
Transport Delay (IC Engine): The time required for a given mass of fuel and air to travel from the intake manifold
through the engine to the EGO sensor in the exhaust manifold.
Volumetric Efﬁciency: The pumping efﬁciency of the engine as air is pumped into the cylinders.
572
Glossary

Quiz questions
Chapter 1
1.
Explain the purpose of the following systems:
a)
control system
b)
instrumentation system
c)
communication system.
2.
Given a system having input x(t) and output y(t) which are related by the following differential equation:
2 d2y
dt2 þ 1:7 dy
dt þ 4:3y ¼ 1 dx
dt þ 10x
a)
deﬁne the operational transfer function for this system H(s)
b)
ﬁnd H(s).
3.
Find the poles and zeros for the system of Problem 2.
4.
The input to a system x(t) is a unit step:
xðtÞ ¼ 0 t < 0
¼ 1 t  0
Show that the Laplace transform x(s) for this input is given by:
xðsÞ ¼ 1
s
5.
Find the unit response for the system of Problem 2 assuming:
xð0Þ ¼ 0;
yð0Þ ¼ 0
6.
A system consists of three functional blocks as depicted below:
Assume that these blocks are modeled by the following equations:
a)
3dx1
dt þ x1 ¼ x2
block 1
x1
x2
x3
y
block 2
block 3
573

b)
0:5 d2x2
dt2 þ 2:1 dx2
dt þ _vyx2 ¼ dx3
dt þ 1:1x3
c)
dy
dt þ 0:1y ¼ 2x3
Assume zero initial conditions and ﬁnd the sinusoidal frequency response for this system.
7.
Let a system be described by a two-dimensional state vector x ¼ [x, x2]Tand a one-dimensional input U(t) and
a one-dimensional output. The system is described by the following set of equations:
_x1 ¼ 3x1 þ x2
_x2 ¼ 2x1
y ¼ 2x1
a)
Find the system matrix A, the input matrix B and the output matrix C for a stable variable formulation of
the form:
_x ¼ Ax þ Bu
y ¼ Cx
b)
Find the operational transfer function H(s) where:
HðsÞ ¼ yðsÞ
HðsÞ
8.
Given the PI control system depicted below:
assume the following component models:
control: HcðsÞ ¼ uðsÞ
˛ðsÞ ¼ Kp þ
_K1
s
plant: HpðsÞ ¼
0:04
s2 þ 2s þ 0:75
sensor: HsðsÞ ¼ 1
a)
Show that the error ˛(x) ¼ next gain.
b)
Let KI/Kp e 3.15 and with Kp as a variable, ﬁnd the closed loop transfer function for this control system.
c)
Using the root locus method of MATLAB for the equivalent, show that the closed loop system becomes
unstable for sufﬁciently large Kp.
d)
Find the overshoot (%) of the step response of the system for Kp ¼ 1.32 (hint, use MATLAB).
e)
Find the gain and phase margins.
Control
Hc(s)
Plant
Hp(s)
input
output
Є
u
x(t)
y(t)
+
–
Sensor
Hs(s)
574
Quiz questions

9.
a)
Show that a control system for a plant having a transfer function Hp(s) given by:
HpðsÞ ¼
10
sðs þ 0:5Þ
and a proportional only controller is stable for any gain provided the feedback sensor is ideal
(i.e. Hs(s) ¼ 1).
b)
However, if the sensor has a dynamic response modelled by a ﬁrst order transfer function given by:
HsðsÞ ¼
1
s þ 2
The closed loop system becomes unstable for a sufﬁciently large gain.
c)
Find the value of proportional gain for which the system becomes unstable.
10.
Explain the role of sensor dynamics in the systematic errors of an instrumentation system.
11.
A sensor having a resistive source impedance R ¼ 10 kU is connected to a signal processing ﬁlter having
a transfer function Hsp(s) given by:
HspðsÞ ¼
1000
s þ 1000
If the sensor is at temperature T ¼ 400K, ﬁnd the rms random error voltage ~v in the output of the ﬁlter.
Note: Boltzmans constant is k ¼ 1.4  1023 Joule/K.
Chapter 2
1.
A voltage v(t) is given by:
vðtÞ ¼ 100ð1  cosð2ptÞÞ
This voltage is to be sampled at a period T ¼ 0.01.
a)
Find the value of the 15th sample, i.e. vðkÞjk¼15
where v(k) ¼ v(tk)
and
where tk ¼ kT
The input xk to a discrete time system is to be an 8-bit representation of v(tk) rounded to the nearest
binary integer
xk ¼ f1 vðtkÞg
b)
Find the 8-bit binary representation of x15
c)
What is the lowest theoretical sample rate (i.e. the Nyquist rate) for sampling this voltage?
2.
Given a function of time f(t) of the form:
fðtÞ ¼ 0
t > 0
¼ eat
t > 0
Quiz questions
575

This function is sampled at a period Ts.
a)
Find the z-transform F(z) of f(tk) where:
tk ¼ k Ts
b)
What is the region of convergence for F(z)
c)
Find the pole(s) for F(z)
3.
Find the inverse z-transform of the function Y(z) (i.e. ﬁnd yk) where Y(z) is given by:
YðzÞ ¼
1
14:3z1  0:4z2
4.
Find the z-transfer function and recursive algorithm for a 3rd order Butterworth low-pass ﬁlter having the
following design parameters:
sample frequency:
Fs ¼ 20 kHz
corner frequency:
Fc ¼ 3:5 kHz
5.
For the open loop control system of Figure 2.6, assume the following:
digital control:
Uk ¼ Kpxk
plant transfer function:
HpðsÞ ¼ YðzÞ=UðzÞ ¼
Ka
s þ s0
parameters
Kp ¼ 10
Ka ¼ 50
s0 ¼ 2.5
sample period
T ¼ 0.01 sec
a)
Find the z-transfer function H(z)
HðzÞ ¼ YðzÞ
XðzÞ
b)
Is the closed loop control system stable?
c)
If the system is stable, ﬁnd the unit step response.
6.
For the closed loop feedback control system of Figure 2.9, assume the parameters given for the example and
show that the closed loop z-transfer function HCl(z) is given by:
HClðzÞ ¼
0:029z þ 0:0257
z2  1:668z þ 0:7226
7.
What affect does the sample period have on the accuracy of the discrete time model of a digital control system
performance analysis?
8.
What is the inﬂuence of a ZOH on the dynamic response of a discrete time digital system?
9.
What is the effect of sampling a continuous time signal on the spectrum of that signal (i.e. compare spectra at
original and sampled signals)?
10.
How can the original version of a sampled signal be recreated from the sampled signal and what are the
limitations on the accuracy of such reconstruction?
576
Quiz questions

Chapter 3
1.
How do holes contribute to electrical conduction in a semiconductor material?
2.
What is the source of the junction potential in a p-n semiconductor diode?
3.
Sketch the wave form of voltage ve for the following diode circuit:
Where Vs(t) is a symmetric square wave having the following model:
VsðtÞ ¼ 5
tn  t  tn þ T
2
¼ 5
tn þ T
2 < t < tnþ1
tn ¼ n T
n ¼ 1; 2.
4.
Given the following single stage NPN transistor ampliﬁer circuit:
Let Vs(t) be given by:
VsðtÞ ¼ Vs sin us t
assuming the following:
a)
the transistor is biased via Rb to its linear range
b)
Rs [ 1/us c
c)
Vcc > Vs
d)
Vo(t) ¼ Vco + Vo sin us t
Find the voltage gain A for this circuit:
Rl
Vs (t)
Vl (t)
Vcc
R2
Rb
Rs
C
Vs
Vo
A ¼ Vo
Vs
Quiz questions
577

5.
Given the operational ampliﬁer circuit shown below:
If
Rs ¼ 1 K U
Rf ¼ 10 K U
C ¼ 1m fd
a)
ﬁnd the closed loop gain Ac‘ expressed as a transfer function.
b)
ﬁnd Ace as a complex sinusoidal frequency response.
6.
Find the 8-bit binary equivalent to decimal 74.
7.
Using the truth table of the XOR circuit of Figure 3.17a, verify that the truth table for the half adder of Figure
3.17b is correct and show that this circuit conﬁguration performs the sum of two 1 bit binary numbers.
8.
Show via a truth table that the circuit of Figure 3.17c is a full adder.
Chapter 4
1.
a)
Find the product of 27 and 15 by writing the numbers in binary form and by using binary multiplication.
b)
How many bits are required to represent this product?
2.
For the D/A converter circuit of Figure 4.17, let Dn ¼ 2.5000 An for n ¼ 1,2.8. Let the input digital data be
given by:
A8 . A1 ¼ 01101001
ﬁnd the output voltage Vout for this input.
3.
Let the contents of an 8-bit left shift register at clock time t1 be given by:
C ¼ 10100110
Find the contents of the shift register for t2, t7 and t8.
4.
Repeat Problem 3 for a shift right register.
Rs
Vs
VO
Rf
C
Rs
+
–
r
578
Quiz questions

5.
Repeat Problem 3 for a rotate left register.
6.
A 4 bit binary number B4B3B2B1 stored at memory location M(B) ¼ 10000001 is to be multiplied by a
second 4 bit binary number C4C3C2C1 stored at memory location M(C) ¼ 10000010 using an 8-bit
microprocessor.
Using the assembly language mnemonics of Table 4.1, write an assembly language program for this operation
for which the product D is to be stored at memory location M(D) ¼ 10000011.
7.
Liquid cooled engines that power most contemporary vehicles require cooling (via the radiator) to remove
heat from the engine and prevent coolant temperature from exceeding a pre-determined threshold temper-
ature (Tth). Depending upon the ambient temperature, a fan is required to remove heat from the radiator. In
contemporary vehicles an electric motor powers the cooling fan. Although a relatively simple thermally
activated switch can be used to switch power on to the motor, for the present problem assume that the cooling
fan is to be regulated by the engine control microprocessor. Assume further that a coolant temperature sensor
is available (as explained in Chapter 6) that produces an output voltage V0 ¼ Ks (Tc e Tref) where Tc is the
coolant temperature, Tref and Ks are constants for the sensor. Sketch a block diagram for a subsystem
(including the microprocessor as a block) that switches the coolant fan on whenever Tc  Tth. Assume
memory mapped I/O and denote the input memory address MI and the output memory address is Mo. Show all
necessary blocks and assume that a binary output signal operates the fan switch.
8.
Using the assembly language mnemonics of Table 4.1, write a program for regulating the coolant fan of
Problem 7.
9.
Given an 8-bit A/D converter such as is depicted in Figure 4.18, having an input voltage range 0  vin  5 volt
where 0 volts corresponds to binary 0:
a)
ﬁnd the resolution of this A/D converter in volts/bits
b)
ﬁnd the output binary number for an input of 1.47 volts
c)
The maximum conversion time is to be 10 msec (i.e. 0.01 sec). Find the minimum clock frequency (fc of
Figure 4.19).
Chapter 5
1.
A four cylinder engine has a displacement VD. The clearance volume for each cylinder is 10% of the cylinder
contained volume VC. Find the theoretical maximum compression ratio for a gasoline/air mixture assuming an
ideal adiabatic cycle.
2.
Calculate the brake torque in lb.ft for an engine having brake HP of 25 HP at 2000 RPM.
3.
Find the inlet manifold air density as a fraction of sea level standard day density P
0 . For an inlet air pressure
that is 30% of sea level standard day pressure at a temperature that is 100F above T0 where T0 ¼ 518.7R in
English units.
4.
An engine having displacement of 270 in3 is operated part throttle at 2400 RPM. If the inlet air density is 0.018
slug/ft3 and the volumetric efﬁciency under these conditions is 62%, ﬁnd the mass ﬂow rate in slugs/sec of the
inlet mixture.
5.
For the same engine and operating conditions as in Problem 3, assume the engine is operated at a stoichio-
metric mixture with pure iso-octane fuel having chemical formula C8H18. Assume further that the ratio of mass
of water vapor to dry air is 0.05. Find the mass ﬂow rate of dry air into the engine in slugs/sec.
6.
For the example idle speed control system of this chapter, show that derive Eqn 47 using Eqns 41 and 46.
Quiz questions
579

7.
An engine is producing 50 HP and consuming 2.6 gal/hr of fuel while operating at stoichiometry.
a)
assume that gasoline has a density of 6 lb/gal and compute the brake speciﬁc fuel consumption.
b)
Find the mass ﬂow rate of air into the engine.
8.
A 4 cylinder port fuel injected engine having a displacement of 270 in3 is operating at part throttle at a constant
of 2400 RPM. The volumetric efﬁciency is 37% and the inlet air density is 1 d  103 slug/ft3. Each fuel
injector can deliver 0.2 in3/sec of fuel at the operating rad pressure when activated. Each fuel injector is
operating in pulse mode. Find the duty cycle for the fuel injectors.
9.
For the ignition coil circuit depicted below:
Find the current as a function of time during the dwell period. (NOTE: the circuit model during the spark
interval is highly nonlinear and not susceptible to analyses using the theory covered in this book.) Assume the
following:
Vs ¼ 12:8 volt
R ¼ 2:2 U
Lp ¼ :018 henry
Chapter 6
1.
Independently using the models given beginning with Eqn 6.3, derive Eqn 6.15.
2.
A six cylinder engine operating at a steady load at 2200 RPM that has a piezoresistive intake MAP sensor
such as is depicted in Figure 6.4. The pressure sensor is connected in a circuit with schematic shown in
Figure 6.5a. With MAP (p) in English units (psi) the model for sensor element resistance Rn (n ¼ 1, 3) is
given by:
RðpÞ ¼ 1000 þ 1:4 p
The instantaneous MAP is given by:
PðtÞ ¼ PM þ dp sin
Md:We t
z

where PM ¼ time average MAP
dp ¼ amplitude of MAP fluctuations due to dynamic pumping of intake mixture:
Vs
P
S
R
i
Lp
580
Quiz questions

Let
PM ¼ .65 Po
Po ¼ sea level standard day barometer pressure
dp ¼ :1 PM
VS ¼ 5 volt
GA ¼ 10
Find the instantaneous sensor circuit output voltage Vo(t).
3.
Given an engine that is equipped with a magnetic sensor mounted on the crankshaft such as depicted in Figure
6.7. There are Md lugs on the disk. The magnetic circuit for this sensor is depicted in Figure 6.9 with lateral
dimensions hc and wc as described in the text for this chapter. Let the magnetic ﬂux linking each turn of the N
turncoil be given by:
FðqÞ ¼ Fo

1 þ g cos
2p ðqm  qÞ
DqL

1qm  q1  Dq2
2
¼ Fo 1qm  q1 > Dq2
2
Where q ¼ angular position of the crankshaft
qM ¼ 2pm
Md
m ¼ 1; 2 . Md
Md ¼ number of tabs on the dish
DqL ¼ angular width of each lug and is small compared to 2p/Md
a)
Find the sensor open circuit terminal voltage Vo(t)
b)
Find the values for q for which
VoðtÞ ¼ 0
and dVoðtÞ
dt
6¼ 0
c)
Assume the existence of a zero crossing detector circuit and explain how this sensor can be used for
crankshaft position measurements.
4.
An optical crankshaft position sensor such as depicted in Figure 6.15a has four holes (as shown) in the disk.
The radius of the circle of centers for the holes is 1.5 inch and each hole has a ¼ inch diameter. Assume that the
ﬁber optical light pipe diameter is very small compared with the hole diameter and that its ends are located
along the circle of hole centers.
Let the optical power received by the phototransistor whenever a hole is present along the optical ﬁbers be Po.
Develop a piece-wise continuous model for the output voltage (VL) of the circuit of Figure 6.15b.
5.
Using the model for thermistor resistance Vs temperature (Eqn 59) and Eqn 60 are correct, show that the
equation for temperature T given in the text is correct.
6.
An engine is operating at a steady load and angular speed. The engine control is in closed loop. Assume that the
EGO sensor has ideal switching characteristics such as depicted in Figure 6.23 with the lean to rich transition at
exhaust equivalence ratio (lo) of 1.000 and with rich to lean transition at lo ¼ 1.035. Let the high output
voltage be 1.00 volts and the low output be 0.10 volts.
Quiz questions
581

Let lo(t) be periodic with period TEGO as shown in the ﬁgure below:
Sketch the waveform of the EGO sensor output voltage, clearly labeling all points.
7.
Although the dynamic model for a solenoid actuator is nonlinear, as explained in the text, there are certain
conﬁgurations for which the model for the moveable element motion (i.e. x(t)) can be linearized. One example
of such a situation is the solenoid actuated vacuum actuator. For this conﬁguration, the solenoid is designed
such that the viscous damping force is the dominant mechanical force on the moveable element. With respect to
the solenoid conﬁguration of Figure 6.29, the approximate mechanical model for the moveable element is
given by:
Fe ¼  Bs
dx
dt
2
Furthermore, for this situation the velocity of the moveable element is such that the velocity term in the circuit
portion of the model can be neglected such that this model becomes:
Vs ¼ Rsi þ
 
Lo
1 þ xo=g
!
di
dt
where Xo is the moveable element position against the upper mechanical stop.
Let the excitation voltage be a step such that
VsðtÞ ¼ 0
t < 0
¼ Vs
t  0
Let Ts denote the time at which the moveable element reaches the center post such that
XðTsÞ ¼ 0
Show that the delocity of the moveable element (relative to the frame) is given by
dx
dt ¼  V
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
Lo=ð2 g BsÞ
p
Rð1 þ x=gÞ
0  x  xo
Find the position of the moveable element x(t) for 0  t  Ts (corresponding to 0  x  xo).
Chapter 7
1.
A discrete time engine control is operating in a closed loop limit cycle mode of operation at a steady speed and
load. Assume an ideal EGO sensor having a lean to rich transition at exhaust gas equivalence ratio lo ¼ 1 and
from rich to lean at lo ¼ 1.03. For this steady operating condition, 1 lo is periodic and is given by
1.1
1.0
0.9
.5 TEGO
TEGO
1.5 TEGO
2 TEGO
t
λo
582
Quiz questions

loðbÞ ¼ 1:05
k ¼ 1; 2 . 10
¼ 0:97
k ¼ 11; 12 . 20
loðk þ 20Þ ¼ loðkÞ
loðkÞ ¼ loðtkÞ
where
tk ¼ kth sample
Sketch the waveform for the integral like term of the limit cycle control I(k) assuming I(0) ¼ 0.
2.
Explain how the I(k) term in the equation for fuel injector pulse duration (IF(k)) for the limit cycle fuel control
is analogous to the integral term in a PID control law.
3.
An engine incorporates a MAF sensor (as explained in Chapter 6) in a discrete time control system. Find the
algorithm for calculating _MaðkÞ from the MAP sensor terminal voltage vo(k)
Where
M
,
aðkÞ ¼ M
,
aðtkÞ
voðkÞ ¼ voðtkÞ
tn ¼ kth sample time
4.
Given an engine having a discrete time idle speed control system as depicted in Fig. 7.7, and having a plant
continuous time model transfer function as given in Eqn 25 of Chapter 7.
a)
Complete the derivation of Eqn 35 for the discrete time forward transfer function HF(z).
b)
Complete the derivation of the closed loop transfer function HCL(z) of Eqn 37.
c)
For the example step change in command idle speed, ﬁnd the discrete time system dynamic response
numerical values yk.
5.
For the example VVP discrete time control system shown in Figure 7.10, complete the derivation of the closed
loop control transfer function Hcl(z) of Eqn 51.
6.
An engine is equipped with a discrete time engine control having knock limited spark control. Assume that
knock sensors as described in Chapter 6 are incorporated, sketch a complete block diagram for this type of
ignition timing control and explain in detail the operation of your conﬁguration.
7.
A model for the ignition circuit was presented in Chapter 6. There it was shown that, during the dwell period,
the coil current increases from 0 exponentially, asymptotically approaching a saturation current Is where
Is ¼ Vs/(Rc + Ron) where Rc is the coil resistance and Ron is the transistor emitter to collector resistance when
the base current required to drive the transistor into saturation (see Chapter 3) is supplied by the engine control.
Assume that it has been determined empirically that the coil current must reach 0.9 Is to produce a spark of
sufﬁcient energy to reliably ignite the mixture. The dwell period is initiated by the engine control based upon
measurement of crankshaft angular position. Let Rc ¼ 2.7 U, Ron ¼ 1.5 U and coil inductance Lc ¼ 0.018 henry.
a)
Find the coil angle relative to the angle at which spark is to occur for an engine that is operating at 5000
RPM to assure a reliable spark (i.e. dwell crankshaft angle to either radians or degrees).
b)
How does this dwell angle vary as a function to RPM?
8.
A parallel hybrid vehicle as represented in Figure 7.28 is operating with electric propulsion from an induction
motor. The motor is operating in the region for which the slope dTe
dus
< 0 and operating at a relatively small slip
such that the approximate Te(s) is as given in this chapter for the small s case. Assume that the vehicle is being
operated at a steady 60 MHP along a level curve. The vehicle weight is 2800 lb, the time rolling resistance
Quiz questions
583

coefﬁcient is 0.021, the local air density is 0.0021 slug/ft3, the drag coefﬁcient is 0.30, the reference area is 10
ft2, the gear ratio from the motor to the wheel axis is 3.8, and there is no wind. The amplitude of the motor
excitation voltage Vs ¼ 150 v.
a)
Find the motor excitation frequency such that the slip s ¼ 0.075
b)
The vehicle encounters a hill having a slope of 5 up. Assume that the vehicle is to continue at a steady
state speed of 60 MPH along the hill slope. After a brief transient period which you are to ignore, ﬁnd the
amplitude at the excitation voltage such that the steady speed on the hill is maintained at 60 MPH.
Chapter 8
1.
A vehicle, having a weight of 2850 lb and a manual transmission, is travelling a long road having a slope of
+5 (i.e. upslope) at a steady speed of 55 MPH. Assume the following parameters:
mr ¼ 0:017 rolling resistance coefficient
CD ¼ 0:31 ¼ drag coefficient
Sref ¼ 21 ft2 ¼ reference area
local air density ¼ 0.0021 slug/ft3
gear ratio ¼ 4.1
wheel effective radius rw ¼ 1.2 ft
Find the engine brake torque required to maintain this steady speed.
2.
For the same vehicle as in Problem 1, ﬁnd the linearized plant transfer function for the variation in vehicle
speed (dV) for the vehicle on a level road (i.e. q ¼ 0)
HpðsÞ ¼ dVðsÞ
uðsÞ
3.
a)
For the plant of Problem 2, ﬁnd the closed loop transfer function HCL(s). For a PID control system in
which the desired speed is denoted Vd:
HCLðsÞ ¼ VðsÞ
VdðsÞ
Kp ¼ 10
KI ¼ 50
KD ¼ 25
b)
Is the closed loop system stable for these control gains?
4.
For the digital speed control system depicted in the block diagram of Figure 8.4, derive equations 18 and 24
ﬁlling in the missing step 5.
5.
For the vacuum operated cruise control throttle actuator of Figure 8.8, assume the following: barometric
pressure ¼ 14.0 psi, manifold pressure is 50% of barometric pressure, the actuator piston area is 1.7 in2, the
584
Quiz questions

throttle angle ðqtÞin radians is 0.4 times the force on the piston (i.e. force ¼ pressure  area). The maximum
throttle angle deﬂection (from closed throttle) is to be 60. Find the throttle angle vs control signal duty
cycle dp.
6.
For a vehicle with a digital advanced cruise control (i.e. one with automatic braking for maintaining vehicle
speed or long steep downgrades) develop a block diagram for the system when the vehicle is on this
downgrade. Show all components of the controller and assume that any required D/A conversion is via zero
order hold.
7.
For the ACC of Problem 6, let the system parameters be the same as those used in the example presented with
respect to Figure 8.2 and assume KB ¼ 15; ﬁnd the closed loop z-transfer function HCL(z) of the form given in
Eqn 24.
8.
A vehicle having a suspension system as depicted in Figure 8.21 is travelling a long, straight, horizontal road
at 70 MPH. Let the time origin be such that the braking force F is given by
F ¼ 0
t < 0
¼ Fo
t  0
a)
Find the dynamic pitch angle ap(t) for variable damping ratio Z assuming the natural frequency
uA ¼ 7.9 rad/sec for a spring rate K ¼ 2  104 lb/ft. The parameter Z should appear in the answer.
b)
Explain how electronically controlled strut damping affects the dynamic response of ap(t).
9.
Given a vehicle which is equipped with an electronic suspension having a quarter car model (QCM) as
depicted in Figure 8.24:
a)
show that Eqn 89 is correct for the transfer function Ha(s) and that Eqn 91 is correct for transfer function
HH(s).
b)
Find the sinusoidal frequency response HH(ju) for this QCM using the parameters given on p. 436.
10.
For the 4WS system depicted in Figure 8.32, compute the matrices A and B for the standard form state
variable equation:
_x ¼ Ax þ Bu
Use the exemplary parameters given on p. 455.
Chapter 9
1.
An automotive instrumentation system incorporates a multiplex input along with an 8-bit A/D converter, as
shown in Figure 9.5. The A/D is designed such that all output bits are 0’s for 0 volt input and all 1’s for 5 volt
analog input.
a)
Assuming that the conversion from analog to digital is perfectly linear, ﬁnd the voltage resolution
for the A/D in volts per bit. That is, what is the input voltage change for a 1-bit change in the A/D
output.
b)
Assume that the A/D converter rounds to the nearest 8-bit binary number for the conversion of
a continuous analog input, ﬁnd the A/D output for the following set of voltages: 2.43 volts; 3.17 volts; 4.05
volts; 0.09 volts.
2.
The multiplexed input of Problem 1 is to be used with N ¼ 10 sensors. If each input variable is to be measured
at a rate of 100 samples/sec, what is the maximum conversion time for the A/D if the system is to read each
Quiz questions
585

sensor during an input cycle and remain synchronous, and to sample periodically with no wait time between
successive cycles?
3.
A galvanometer such as is depicted in Figure 9.10 is to be used to display vehicle speed. Assume that the
inertial term in its dynamic model is negligible, that the electrical drive circuit is as depicted in Figure 9.11, and
that vs and Rs are the open circuit voltage and source impedance, respectively, of the analog output of the digital
instrumentation system.
a)
Find the transfer function Hg(s) for this display:
HgðsÞ ¼ qðsÞ
vðsÞ
In deriving this transfer function, use the same symbols as in the text for all relevant parameters.
b)
Find the poles of the transfer function in terms of the given parameter notation.
4.
An automotive ﬂat panel display consists of an array of 128 rows and 256 columns of LED elements. It is
operated in a raster scan pattern with a cycle frequency (or refresh rate) of 50 Hz. An element in the 57th row
and 101st column is to be activated, so ﬁnd the time from the beginning of the raster cycle at which this element
is activated.
5.
An automotive fuel quantity instrument is to be implemented with a potentiometer sensor such as is depicted in
Figure 9.24 where the sensor voltage Vo(F) is given by:
Vo ¼ 5
ﬃﬃﬃﬃ
F
p
0  F  1
The block diagram for this fuel measuring instrument is depicted in Figure 9.25. The signal processing block
(LPF) is a second-order Butterworth ﬁlter having a z-transfer function given by Eqn 29.
a)
Find the output yn of the LPF where the input xn is given by:
x ¼ VoðtnÞ
tn ¼ n T
T ¼ 0:001 sec
b)
Using the methods of Chapter 2, show that Eqn 29 is the correct z-transform for a second-order
Butterworth digital ﬁlter having normalized corner frequency Uc ¼ 0.001.
6.
Show that Eqn 28 is the correct z-transfer function for the display whose continuous time model
has transfer function HD(s) given by Eqn 25 assuming sample period T ¼ 0.001 sec, KD ¼ 0.5, and
s0 ¼ 0.5 rad/sec.
7.
A digital speed instrument has a block diagram as depicted in Figure 9.32. The speed sensor generates
a sequence of pulses of frequency Fp for vehicles speed V (in ft/sec) given by:
Fp ¼ 100 V
The electronic gate is closed for a period t ¼ 10 msec for each sample. At sample time tk the vehicle is
travelling at 72 MPH. Find the contents of the binary counter P (expressed in binary) for the period:
tk þ s  t  tkþ1
8.
An advanced vehicle navigation system combines the measurement of vehicle speed V and fuel consumption
rate with GPS navigation and a detailed electronic road map. The electronic map contains all distances along
each road segment for any given trip as well as legal speed limits for each segment. Assuming that the time
586
Quiz questions

intervals for any unplanned stop (e.g. trafﬁc congestion, trafﬁc signal lights, etc.) are negligible and that the
vehicle travels at exactly the legal speed limit:
a)
explain how such a system could be used to estimate the total fuel consumption
b)
let the fuel consumption rate ð_fÞ be a polenomial function of vehicle speed V of the form:
_f ¼
X
M
m¼0
amVm
Let a trip be planned that consists of N segments each having legal speed limit Vn and distance Dn (n ¼ 1, 2.N).
c)
Find the estimated total fuel consumption for (F) for this trip.
9.
For the trip of Problem 8, the actual vehicle speed can vary by 5% of the legal speed limit. Let fT be the true
fuel consumption for this same trip. Find an expression for the maximum error in fuel consumption EF:
EF ¼ F  FT
Find the upper and lower limits for EF.
Chapter 10
1.
Explain in detail how a model-based diagnosis of problems with a mass air ﬂow (MAF) sensor is possible if
sensors are incorporated for measuring manifold pressure (pm) and intake air temperature (Ti). What additional
sensor(s) for this diagnosis and what tabulated data (taken during engine mapping) are required for the engine
involved.
2.
For Problem 1, assume that a MAF sensor as depicted in Figure 6.2, a piezoresistive MAP sensor as depicted in
Figure 6.4, and a thermistor intake air temperature sensor as depicted in Figure 6.21, are employed in the
engine control system. Assume that any additional sensor required for the MAF sensor model based diagnosis
are available and that any required tabulated data is stored in ROM.
Using the models developed for each necessary sensor as given in Chapters 6 and 7, develop an expression for
the relationship between the terminal voltages of the MAF, MAP and Ti sensors for a properly operating MAF
sensor.
3.
A vehicle is travelling along a straight, level road in cruise control mode. The cruise control is a digital system
incorporating a vehicle speed sensor (VSS) as shown in Figure 8.6. The VSS disk is driven by the transmission
output shaft. The disk was made with M ¼ 25 lugs. At some time during the trip, one of the lugs becomes
detached owing to a manufacturing defect and is suddenly missing:
a)
Assuming all other vehicle components function without a failure, describe the change in sensor output
signal due to this failure.
b)
What is the effect on vehicle speed?
c)
Describe an onboard diagnostic system that could detect this VSS failure. You may make the following
simplifying assumptions:
i) the transmission maintains a unity gear ratio.
ii) the torque converter of the automatic transmission is in, and remains in, lock-up mode.
4.
A thermistor coolant temperature sensor such as is depicted in Figure 6.20, and connected in a circuit
conﬁguration of Figure 6.21, experiences a calibration change. The calibration change results in an indicated
temperature that is 25 C cooler than actual temperature. While operating on a very hot day in dense urban
trafﬁc, the engine overheats signiﬁcantly enough that a coolant hose fails and the vehicle must be towed for
repairs.
Quiz questions
587

a)
Explain the failure mechanism.
b)
Describe a diagnostic procedure by which this failure can be identiﬁed and proper repairs made.
Assume that both portable and service bay diagnostic tools are available.
c)
Develop a ﬂow chart for the diagnostic procedure.
NOTE: The solution to this problem is not necessarily unique.
5.
The digital control system of a 4-cylinder engine is equipped with a misﬁre detection system based upon the
nonuniformity index method of the present chapter. For the sake of simplifying calculations, assume that the
net torque Tn during any given engine cycle (i.e. 0  qe  4 p) is given by:
TnðqeÞ ¼ To þ dTm sin ð2mqeÞ
m ¼ 1; 2; 3; 4
Where qe ¼ crankshaft angular position.
a)
Show that for perfect combustion (i.e. no misﬁres) and dTm is the same for all 4 cylinders, the
non ¼ uniformity vector n is an eight-dimensional vector with all elements exactly zero.
b)
Let there be a partial misﬁre in cylinder 3 due to fuel injector calibration failure that is continuous such
that dTm given below is the same for all engine cycles:
dTm ¼ 0:6 To
m ¼ 1; 2; 4
¼ 0:4 To
m ¼ 3
Find the nonuniformity vector n and the nonuniformity index n ¼ jj n jj1.
6.
If a cylinder other than m ¼ 3 were the only misﬁring cylinder, explain how the nonuniformity vector n would
change and how this could lead to a method of identifying the misﬁring cylinder.
7.
A movable mass, switch type crash sensor such as depicted in Figure 10.18 is to be employed in an airbag
system. The deceleration of a vehicle during a crash is never a constant (e.g. see Figure 10.20). However, part
of the speciﬁcations for this sensor call for the switch activation to be tested under a steady acceleration
obtained by spinning the sensor on a centrifugal table. The speciﬁcations are that the switch only be closed for
acceleration exceeding a threshold value (aT) as given below:
ðopen switchÞ S ¼ 0
a < aT
ðclosed switchÞ S ¼ 1
a  aT
a)
Find the relationship between the mass M of the moveable element and the spring rate K to meet the above
criteria.
b)
For the sensor of part a, assume that M ¼ 8 oz, Fc ¼ 6 oz, xp ¼ ½ inch, and let the damping ratio for the
second order system Z ¼ 0.7 (see Chapter 1). If the threshold steady acceleration aT ¼ 2.7 g, ﬁnd the
response time for switch closure.
NOTE: A solution to this problem can be found either analytically via the methods presented in Chapter 1,
or via computer simulation (e.g. using MATLAB/SIMULINK).
588
Quiz questions

Index
Note: Page numbers with “f” denote ﬁgures; “t” tables.
A
Accelerometer, 441
based airbag system, 565f
Accumulator, 136
eight bits in, 137
Accumulator register, 136
Active region, 93
Actuation time interval, 397
Actuators, 2
analog (continuous time) throttle,
397
closed-loop control system
model, 24
cruise control system, 382e384,
387
duty-cycle-controlled throttle,
399
exemplary solenoid operated,
399
exhaust gas recirculation actuator
(EGR), 204e206, 210,
286e288, 287f, 335e337
fuel injectors (FI), 398
manifold-vacuum-operated,
398f
solenoid operated, 399
stepper motor, 397
vacuum-operated, 403e406
vacuum-operated throttle, 398,
398f
See also Automotive engine
control actuators
See also Throttle actuator
A/D converter, 107
switching operation,
108e109
Address bus, 132
Address offset, 143
Adiabatic gas law, 443
Adiabatic process, 189
Airbag electronics, 562e563
acceleration-sensitive switch,
565
accelerometer-based, 565, 565f
deployment system, 564f
deployment times, 563t
Airﬂow rate sensor, 236e242
Air/fuel ratio on engine perfor-
mance, 202e203
Air suspension system, 443
Aliasing errors, 60
Ambient air pressure (AAP),
319
Ambient air temperature (AAT),
319
Analog (continuous time) throttle
actuator, 397
Analog controller transfer function,
71
Analog corner frequency, 60
Analog ﬁltering/signal processing,
100
Analog multiplexing system,
466f
Analog-to-digital converter (A/D),
58
AND gate, 115e117
Anode, 83
Antilock brake system (ABS),
410e420
Arithmetic and logic unit (ALU),
140
Artiﬁcial intelligence (AI),
555e556
See also Expert systems in
automotive diagnostics
Assembler program, 149e150
Assembly language, 148e150, 149t
Automatic transmission control,
359e366, 363f
Automotive diagnostics
CAN network, 523
of catalytic converter, 526
computer-based instrumentation,
519
diagnostic fault codes,
529e543
electronic control system,
522e524
electronic subsystems (ECUs),
523
expert systems, 555e561
of fuel injector, 526
heated exhaust gas oxygen
concentration sensor (HEGO)
sensor, 533e539, 537f
model-based misﬁre detection
system, 544e555
model-based sensor failure
detection, 526e529
off-board diagnostics,
522e524
onboard diagnostics, 522,
525e526
onboard digital systems,
521e522
portable scan diagnostic tool
(PSDT), 523e524
589

Automotive diagnostics (Continued)
service bay diagnostic system,
524e525
at service facility, 526
Automotive engine control
actuators, 234e265,
279e288
exhaust gas recirculation (EGR),
286e288, 287f
fuel injection system,
284e286
ignition system, 304e307
stepper motors, 304
variable valve timing,
288e292
Automotive engine control sensors,
234e265, 319
airﬂow rate, 236e242
engine angular speed,
256e257
engine crankshaft angular
position, 245e247
exemplary manifold pressure
sensor conﬁguration, 243f
exhaust gas oxygen (EGO),
270e274
for feedback control, 270e276
Hall-effect position, 259e262,
260f
inductive variable reluctance
angular position, 255
knock, 276e279
lambda, 270
magnetic reluctance position,
247e259
mass airﬂow (MAF),
313e314
optical crankshaft position,
263e265
oxygen sensor improvements,
274e276
pressure measurements,
242e245
shielded-ﬁeld, 262
strain gauge MAP, 242e245,
244f
switching time for EGO sensor,
272e274
temperature, 268
throttle angle, 265e268
timing for ignition and fuel
delivery, 258e259
typical coolant, 268e270
variable reluctance, 254
variables measured, 236
zirconium dioxide (ZrO2) sensor,
270e271
Automotive instrumentation
early, 460
electronic, 460e461
modern, 460e463
B
Bandstop ﬁlter, 46
Band theory of electrons,
81e82
Base bias current, 92e93
Baseeemitter diode, 91
Binary digital circuits, 111
Binary number system, 113
decimal equivalent of, 113
decimal equivalent of N8,
113
M-digit octal number, 113
Binary-valued voltage, 398
Bipolar transistors, 96
operating characteristics for,
90e91
Birefringent material, 478
4-bit-adder circuit, 118f
8-bit microcomputer, 135e136
8-bit registers, 136
Boltzman’s constant, 44, 84
Boron, 80
Bottom dead center (BDC), 189,
288
Brake mep (bmep), 197e198
Brake power, 197
Brake-speciﬁc CO concentration,
202
Brake-speciﬁc fuel consumption
(BSFC), 198
Brake-speciﬁc HC concentration,
202
Brake-speciﬁc NOx concentration,
203, 211e212
Brake torque, 193, 197
Branching, 138
Branch instruction, 143
Bridge circuit, 238f
Brushless DC motor, 301e304,
302f, 371
Buffer, 147
Buses, 132e133
Butterworth analog prototype, 60
Butterworth ﬁlter, 46e47
magnitude and phase of
third-order, 47, 47f
Butterworth low-pass ﬁlter, 47
Byte, 132
C
CAFE (corporate average fuel
economy), 180e181
Calcite, 478
Calibration of engine, 201
Camber angle, 446
Camshaft, 190f, 191
Camshaft position sensor (CPS),
210
Camshaft position sensor for
determining start of each
engine cycle (CS POS/
RPM), 319
CAN network, 504e507, 523
Cartesian coordinate system,
381
Caster angle, 446
Cathode, 83
Cauer ﬁlter, 48
Central processing unit (CPU),
129e130, 154e155
Characteristics curves, 90e91,
See also transistor
Chassis dynamometer, 180e181,
180f
Chebyshev ﬁlter, 48
Clearance volume, 191
Clock, 134e135
Closed-loop control system,
21e27, 171
characteristic equation of, 29
with continuous time models, 71
discrete time, 72f, 77f
EGO sensor, 214e215
EGR control system,
336e337
of emissions and fuel economy
under various driving
conditions, 358
590
Index

faults, 535e536
fuel-control system, 211,
213e215, 323e327
of ignition timing, 347e353
microcomputer in, 171
stability of, 28
Closed-loop indicator (CLI),
536e539
Closed-loop limit-cycle control,
34e35
Closed-loop transfer function, 69,
71
Combinatorial logic circuits, 119
Common emitter forward current
gain, 91e92
Compiler, 148
Complementary-metal-oxide
semiconductor (CMOS), 98
Complex frequency transfer
function, 45
Compression ratio, 191
Computer-based instrumentation,
462, 462f
advantages, 469e470
analog inputs, 463e464
automotive diagnostics, 519
CAN communication system,
504e507
coolant temperature
measurement, 497e498
display devices, 470e474
(See also Display devices in
automotive instrumentation)
ﬂexibility aspects, 469
fuel gauge system, 470
fuel quantity measurement,
491e496
GPS navigation system,
511e519
high-speed digital communica-
tions (CAN), 502e507
input and output signal
conversion, 463e469, 464f
inputs, 463
multiplexing, 465e468
multirate sampling, 468e469
MUX function, 465e468
N analog sensors, 465e466
oil pressure measurement,
498e500
powertrain control system, 463
switches, 463
telematics, 510e511
trip information system,
507e509
vehicle speed measurement,
500e502
vehicle status sensors, 463
Condition code (CC) register,
136e138, 137f
Conduction band, 82
Conductivity of pure semi-
conductor, 80
Conductivity of material, 81
Conﬂict set in AI, 559
Continuous time voltage variable,
107
Control bus, 132e133
Convolution theorem, 8
Coolant temperature (CT), 319
measurement, 497e498
Cornering forces, 451
CPU registers, 135e140
Crankshaft angle, 193e194,
545e546
angular position and RPM sensor
(CPS), 319
angular position and speed, 552,
554
angular speed, 257, 552e553
angular speed sensor, 553f
ﬂuctuations in combustion
chamber, 195e196
instantaneous angular position,
553, 555
valve-opening period, 223
Critical damping, 389
Cruise control system, 382e399,
387f
actuator, 382e384, 387, 399
advanced, 406e409
analog version, 391, 404f
conﬁguration, 386f, 387f
control performance, 389f
digital, 390e394, 390f
drag coefﬁcient, 384
dynamic model, 384e385
electronics, 400e409
engine brake torque and speed,
385
hardware implementation issues,
394e396
linearized equation of motion,
385
microprocessor-based, 400e401
model for vehicle motion along
road, 383
under normal driving conditions,
383
operational transfer function, 386
output electrical signal, 383e384
PI controller, 387e389
powertrain, 383
dynamics, 383
proportional integral (PI) control
strategy, 387e389
total external forces acting on
vehicle, 383
vehicle dynamic equation of
motion, 388
vehicle speed, 382
z-operational transfer function,
392
Cutoff condition, 91
Cylinder displacement, 191
D
D/A converter, 110
Damping in suspension system, 421
Damping ratio, 389
Data bus enable (DBE), 139e140
Decimation, 468e469
Demux circuits, 468
Depletion region, 83e84
Diagnostics fault codes, 529e543
actual misﬁre detection,
548e550
cruise control brake circuit, 541f,
542f
fault code P0133, 535e536
ﬂowchart, 533e535, 534f
HEGO sensor low voltage fault,
533, 535e536, 537f, 538f,
543
manufacturer-speciﬁc codes,
530te533t
sample, 530te533t
Society of Automotive Engineers
(SAE) deﬁned, 529
for switch test, 540e542
Index
591

Diagnostics fault codes (Continued)
during vehicle repair/mainte-
nance, 533
wiring harness, 535
Diagnostic scan tool, 523e524,
523f
Differential, 366e368, 367f
Differential pressure sensor (DPS),
319
Digital circuits, 111e113
Digital control systems,
310e312
components of electronically
controlled engine, 313f
features, 312e316
Digital corner frequency, 60e61,
63
Digital cruise control system,
390e394, 390f
block diagram, 390f
closed-loop gain z-transform
function, 392
closed-loop transfer function,
392
controller parameters,
390e391
discrete time control system,
392
discrete time z-transform,
391e393
of integral term, 391
inverse z-transform, 393
output z-transform, 393
response to vehicle speed, 393,
393f
transfer function for, 390e391
z-operational transfer function
for controller, 392
z-transfer function, 391e392
for combination of ZOH and
plant, 391
z-transform, 393
Digital data demultiplexer, 469f
Digital engine control systems,
318f
acceleration/deceleration,
317e319, 358e359
acceleration enrichment, 328
automatic system adjustment,
356
automatic transmission control,
359e366, 363f
closed-loop control mode,
323e327, 325f, 358
closed-loop ignition control,
347e353
control modes for fuel control,
316e329
deceleration leaning, 328
differential and traction control,
366e368
electronic ignition control,
343e353
engine crank (starting) mode,
319e320, 357
engine start control scheme,
317
evaporative emissions canister
purge, 355
exhaust gas recirculation (EGR)
control, 335e337
idle speed control mode,
329e335, 330f
integrated, 354e356
knock detection system,
349e352, 350f, 351f
open-loop control mode, 317,
322e323, 357e358
secondary air management,
354e355, 355f
sensors, 319
spark advance control scheme,
353
system diagnosis, 356
torque converter lock-up control,
366
variable valve timing control,
337e343, 338f
warming up of engine, 320e322,
357
Digital ﬁlter
digital transfer function of,
55e56
sinusoidal frequency response of,
56e57
transfer function of, 57
Digital ﬁlter, 55e56
of analog signal, 58f
steady-state sinusoidal frequency
response, 57e58
Digital sinusoidal frequency
response, 63
Digital subsystem, 55e56
Digital transfer function of digital
ﬁlter, 55e56
Diode, 55e56, See also p-n diode
Discrete time systems theory,
51e52
automotive electronic systems,
51
closed-loop system, 68e71,
70f
conﬁguration, 52f
control systems, 63e68
example, 72e77
recursive model, 52
sequence of numerical values,
51e52
starred transfer function, 66
Display devices in automotive
instrumentation, 470e474
ammeter, 470
electro-optical, 473e474
electro-optical alphanumeric,
470
ﬂat panel (FPD) display,
483e491
fuel quantity gauge, 470
galvanometer, 471
light-emitting diode (LED),
474e476
liquid crystal display (LCD),
476e480
pole pieces and cylindrical core,
design of, 471
speedometer, 470
technologies for electronic
displays, 474
transmissive LCD, 480
vacuum-ﬂuorescent display
(VFD), 480e491
warning lamps, 470
Display random access memory,
489
Doping, 80
Driver electronics, 400
Duty-cycle-controlled throttle
actuator, 399
Dwell period, 306
Dynamic braking, 376
592
Index

Dynamic model of vehicle traveling
along straight line, 384
E
Early model, 90e91
Early voltage, 90e91
Earth-ﬁxed (ECEF) inertial coordi-
nate system, 382
Electric motor (EM), 292e304, 368
Electromagnetism theory, 254
Electronic engine control system,
235f
assembly of electronic and
electromechanical
components, 186
concept of, 184e193
engine ignition system, 230e231
exhaust catalytic converters,
206e209
exhaust emission regulations,
178e179
federal government test
procedures, 180e184
fuel control system, 209e219
fuel economy, 179e180
generic, 186f
idle speed control, 224e229
inputs to controller, 187
intake system with throttle plate,
185f
motivation for, 178
output from controller, 188e193
performance analysis of sensors,
186
terms used for engine’s
performance, 193e206
Electronic fuel control system,
209e219
catalytic converter, 211
closed-loop control mode, 211,
213e219
components, 209e210
control sequence, 212
exhaust gas oxygen
concentration, 214e215
frequency and deviation of fuel
controller, 217e219
open-loop control mode, 211,
213
working of, 210e211
Electronic instrumentation,
460e461
display device, 460e461
operation transfer function,
461e462
sensor, 460e462
signal processing, 460e461
Electronics
digital circuits, 111e113
diodes, 83e85
feedback techniques, 101e103
ﬁeld-effect transistor (FET),
96e99
integrated circuit (IC), 99e100,
124
logic circuits, 114e119
microprocessor (MPU),
124e126
operational ampliﬁer (op amp),
100
phase-locked loop (PLL),
104e106
rectiﬁer circuit, 85e99
sample and zero-order hold
circuit, 106e111
semiconductor devices, 80e85
summing mode op amp circuit,
103e111
synchronous counter, 120e124
transistors, 87e96
Electronic steering system,
446e449
Electronic suspension system,
420e446, 421f
Electron ignition control, 343e353
closed-loop timing, 347e353
coil driver circuits, 344f
4-cylinder engine, 344f
dwell period, 345e346
optimum ignition timing, 345
optimum spark timing, 345
“spark advance” (SA), 345
timing inputs, 345
total spark advance, 346e347
Electro-optical alphanumeric
display devices, 470
Engine angular speed sensor,
256e257
Engine coolant sensor (ECS), 210
Engine cycle time, 325
Engine mapping, 201e202
Engine position sensor (EPS), 210
English units, 37
Enhancement mode, 97
of FET circuit, 97
Environmental Protection Agency
(EPA), 522
Equivalence ratio, 203
Exemplary solenoid operated
actuator, 399
Exhaust catalytic converters,
206e209
oxidizing catalytic converter,
206e207
three-way catalyst (TWC),
207e209
Exhaust equivalence ratio, 325
Exhaust gas oxygen sensor (EGO),
210, 270e274
desirable characteristics, 272
switching time for, 272e274
voltage, 326
Exhaust gas recirculation actuator
(EGR), 210, 286e288, 287f,
335e337
and engineperformance,204e206
Exhaust port system, 189
Expert system, 524e525
in automotive diagnostics,
555e561
artiﬁcial intelligence (AI), 555
controlling mechanism of, 559
hypothetical, 556
inference engine, 556
knowledge base, 556
principles involved, 558
rule base, 558, 560f
stages of knowledge
acquisition, 557f
tools for mainframes, 558t
F
Fault-code, 522
Fault indication lamp (FIL), 525
Federal test procedures for engine
control, 180e184
CAFE (corporate average fuel
economy), 181
cost incentives, 184
driving schedules, 182f
Index
593

Federal test procedures for engine
control (Continued)
emission and MPG requirements,
183t
fuel economy requirements,
181e183
meeting government regulations,
183e184
regulation on nonmethane
hydrocarbon (NMHC), 181
standards for vehicle half-life,
183, 183t
use of digital electronic control,
184
Feedback techniques, 101e103
using microcomputer, 171e173,
172f
Ferromagnetic material
domains, 249
Fetched instruction, 142
Field-effect transistors (FET),
96e99, 109
ampliﬁer, 98f
analysis procedure for, 98
circuit schematic symbols, 97, 97f
electrodes, 97
input impedance for, 98e99
n-channel or p-channel, 96e97
“transconductance” for, 99
Filter design technique, 46e49
Filtering, 45e49
Firmware, 155
First-order time constant for
system, 10
Floating point operations (FLOPS),
130
Flywheel, 246
FM demodulator, 554
Forward bias, 84
Forward-biased diode, 84
Forward common emitter current
gain at zero bias, 90e91
valve timing and lift, 288
Four-wheel steering (4WS),
449e457
Free electrons, 82, See also n-type
semiconductor
Frequency mixing, 87
Friction mep (fmep), 197e198
Fuel consumption, 198e200
Fuel injection system, 284e286
Fuel injectors (FI), 209, 284e286
actuator, 398
deﬁned, 284
nozzle geometry, 284
signal, 284e286
Fuel rail, 284
Full-adder circuits, 118
Full hybrid electric vehicle, 368
G
Galvanometer, 471, 471f
dynamic equation of motion, 472
electrical input to, 472e473
magnetic ﬁeld conﬁguration,
472f
operational transfer function, 473
performance issues, 473
Geometric dilution of position
(GDOP), 517, 519, See also
GPS
Glass cockpit, 483
GPS, 511e519
Grounded emitter output
characteristics, 91f
H
Half-adder circuit, 118
Half-wave rectiﬁer circuit, 85, 86f
Hall effect, 260e262
position sensor, 259e262, 260f
Handling in driver/passenger
standpoint, 421
Hardware issues in control system,
394e396
computed discrete time control
signal, 394
gate for digital counters, 396
light detector, 394e395
magnetic speed sensor, 394e395
speed measurement system, 394,
395f, 396f
Hardware multiply circuit, 169
Heated exhaust gas oxygen
concentration sensor
(HEGO) sensor, 319,
533e539, 537f
High-voltage bus (HVB), 369e370
Holes, 82, See also p-types
semiconductor
Hot wire anemometer, 237e238
Hybrid electric vehicle (HEV),
368e380
Hydraulic lock conditions, 290
Hydrocarbons, 178e179
I
IC-engine-powered cars, 368
Ideal engine control, 314
Ideal sampled signal, 60
Ignition systems (IGN), 209,
304e307
Impulse response, 8
Indicated mean-effective pressure
(mep), 197e198
Indicated power, 196
Indicated torque, 193, 196
of M cylinder engine, 545
Indicator diagram
for actual engine, 192
for four-stroke engine, 191, 192f
Inductance, 281
Induction motor, 372
for hybrid vehicle, 372
Inference engine, 556
Inﬁnite impulse response (IIR), 56
Inlet air temperature (IAT), 319
Instantaneous net torque at wheels,
544
Instrument panel (IP), 462e463
Instrumentation, 35e39,
459e460
accuracy, 37
calibration, 37
computer-based, 462, 462f
dynamic response of, 38e39
errors in measurement, 37
precision, 37
reliability of, 39
standard magnitudes and, 37
Insulator, 80
Intake system, 314
Integrated circuits (IC), 99e100,
124
CPU, 129e130
Internal combustion engine (ICE),
368
engine misﬁre detection,
548e550
criterion for, 550
594
Index

identifying by isolating
cylinder, 550e551
“signature” nonuniformity
index, 550
engine overall efﬁciency, 200
four-stroke engine, 192f
four-stroke IC engine, 189, 191,
193, 288
IC engine cylinder and cam
actuation mechanism, 190f
Interpolation, 321
Interrupt, 163
Interstate freeway system, 2
Ionospheric index of refraction, 517
J
Jacobi elliptic function, 48
JK ﬂipeﬂop, 119e120
Jump instruction, 144
Jump-to-subroutine instruction,
144e147
Junction barrier potential, 83e84
K
Kalman ﬁlter gain, 516
Knock sensor, 276e279
Knocking, 348
Knowledge base, 556
Knowledge engineer, 556
L
Lambda sensor, 270
Laplace transforms
of differential equation, 6
inverse, 8, 59
Lean mixture of air/fuel, 203
Limit-cycle controller, 171
Linear continuous time system
theory, 5e15
Linear mapping transformation,
61e62
Linear region, 93, See also
Transistor
Linear time-invariant continuous
time system, 52
Loading errors, 37e38
Load line, 93
Logical shift, 150e151
Logic circuits, 114e119, 116f
combination of, 117e119
AND gate, 115e117
JK ﬂipeﬂop, 119e120
with memory (sequential),
119e120, 120f
NOT gate, 114
OR gate, 117
reseteset (ReS) ﬂipeﬂop,
119
Loop gain, 31e32
Lorentz force, 261
Low-pass ﬁlter, 45, 102f, 237, 465,
554
ideal, 60
instantaneous phase difference,
106
Low-voltage bus (LVB), 376
M
Magnetic ﬁeld intensity vector,
248
Magnetic ﬁeld theory, 306e307,
472
Magnetic ﬂux density vector, 248
Magnetic reluctance position
sensor, 247e259
Magnetization, 250
Magneto-rheological ﬂuid (MR),
442e443
Magnetostriction, 276e277
Main program loop, 175
Majority carriers, 82, See also
p-n junction
Manifold pressure port, 398
Manifold pressure sensor (MAP),
319
Manifold-vacuum-operated actu-
ator, 398f
Mass airﬂow (MAF) sensor, 209,
238f, 313e314, 319
MATLAB function, 48, 60
M-bit binary number, 113, 464
Mean best torque, 347
Mean-effective pressure (mep),
197
Mean squared error (MSE), 322
Measurement, 36
errors in, 37
systems, 39e45
Mechanical crash sensor, 564
Memory, 155e156
Memory internal timing, 134e135
Memory-mapped I/O, 147
Metal-oxide semiconductor
(MOS), 98
Microcomputers
accumulator register, 136
addressing peripherals, 135
analog-to-digital A/D converter,
159e161
architecture, 138e140
in automotive systems, 164e166,
462
based engine control system,
131e132
block diagram, 129f
branching, 138
branch instruction, 143
buffer, 147
bus timing signals, 135
central processing unit (CPU),
129e130, 154e155
registers, 135e140
condition code (CC) register,
136e138
in control systems, 170e176
in digital electronic systems,
168e170
digital-to-analog converter,
156e159
digital vs analog computers,
128e129
ﬂoating point operations
(FLOPS), 130
hardware, 154e164
initializing, system, 141
instrumentation applications of,
166e170
I/O parallel interface, 156
jump instruction, 144
jump-to-subroutine instruction,
144e147
vs mainframe computers, 130
memory, 130, 155e156
memory internal timing,
134e135
memory-mapped I/O, 147
multivariable and multiple task
systems, 175e176
operations, 132e135
operation codes, 141
Index
595

Microcomputers (Continued)
parts, 129e130
precision and accuracy of
calculations, 130
program, 130e131
program counter, 142
programming languages,
148e154
reading instructions, 140e147
read/write (R/W), 133e134,
134f
table lookup using, 173e175
tasks, 131e132
time for decoding, 134e135
Microcontroller, 400
Microinstructions, 125e126
Microprocessor (MPU),
124e126
Mild hybrids, 368
Minority carriers, 82, See also
p-n injunction
Misﬁre, 525
MKS system (meter, kilogram,
sec), 37
Mnemonics, 148e149, 149t
Model-based misﬁre detection
system, 544e555
Model-based sensor failure
detection, 526e529
of calibration change, 526
electrical systema, 528
independent check on MAF
calibration, 526
intake air density, 527
intake air temperature sensor,
527
MAF sensor calibration,
527e528
missing pulses, 528
volumetric efﬁciency of engine,
527
Multiple-bit-adder circuit, 118,
118f
Multiplexing, 465e468
analog system, 466f
digital, 467f
time-domain (TDM), 465
Multiplication of bit numbers,
118
Multirate sampling, 468e469
N
N-dimensional vector x, 18
Net energy/cycle, 193
Nickelemetal hydride (NiMH), 376
Nonrecursive ﬁlter, 56
Normalized analog corner
frequency, 61
NOT gate, 114
NPN transistor circuit, 112, 112f
n-type semiconductor, 80
O
Occupant protection system,
562e567
Octal number system, 113
Off-board diagnostics, 522, 561
Off condition, 91
Onboard diagnostics, 525e526,
543e544
limitation, 529
On-Board Diagnostics II (OBD II),
522, 543e544
Op-code decoder, 141
Open-loop control, 20e21
digital engine control systems,
317, 322e323, 357, 358
electronic fuel control system,
211, 213
open-loop discrete time control
system, 65f
Operational ampliﬁers (op amp),
100
closed-loop gain, 102e103
feedback techniques in, 101e103
inputs and outputs, 100, 100f
inverting and non-inverting
inputs, 101e102
low-pass ﬁlter, 102f
steady-state sinusoidal frequency
response, 103
Optical crankshaft position sensor,
263e265
Optoelectronics, 473e474
OR gate, 117
P
Parallel hybrid vehicle, 369e370
Parallel load serial down-count
binary counter, 401
Passband, 45
PD controller, 66e67
Phase, deﬁned, 288
Phase-locked loop (PLL),
104e106, 554
Phosphor, 480e481
PID control law, 71
PID controller, 24, 30, 33, 172e173
Piezoresistivity, 243
Pitch, 381
Planetary gears, 360, 362
Plasma frequency, 517e518
pen diode, 85
pen junction, 83e84
Pneumatic piston arrangement, 398
Pneumatic spring, 443
Polling, 162e163
Portable scan diagnostic tool
(PSDT), 523e524
Potentiometer, 265
Power, 196e198
Power spectral density, 43
Powertrain digital data line
(PDDL), 463
Printed circuit board, 99, 154e155
Process noise, 43
Program counter, 141e142
Programming languages
ANDed with signal B in SEAT,
153
assembly language, 148e150,
149t
AND function, 152
logic functions, 150
masking, 153
shift operation, 150e151
use of subroutine, 153e154
Prony brake, 197
Proportional control, 33
Proportional integral (PI) control
law, continuous time, 391
p-type semiconductor, 80, 82
Pulse transfer function, 66
Q
Quarter car model (QCM), 432
suspension conﬁguration, 433f
R
Random access display, 481e482
Random access memory (RAM),
131, 156, 400
596
Index

Random sensor errors, 42e44
Rare earth elements, 371
Reactor, 360e361
Reading instructions, 140e147
Read-only memory (ROM), 131,
155e156, 400
Real-time computing system,
164
Reciprocating torque, 545
associated with mth cylinder,
546
Reconstruction ﬁlter, 166e168
Rectiﬁer circuit, 85e99
alternating current voltage,
85e86
capacitor, 86
carrier frequency of information-
carrying signal, 87
input voltage, 86
output voltage, 86, 86f
Recursive ﬁlter equation, 62e63
Reference input, 21
Refraction index
ionosphere, 517
path length change due to, 518
troposphere, 518
Regenerative braking, 372
Registers, 121e122, 136
Reluctance, 254
Remanent magnetization, 250
Reseteset (ReS) ﬂipeﬂop, 119
Residue theorem, 8
Resistivity of material, 81
Return-from-subroutine (RTS)
instruction, 146e147, 146f
Reverse bias, 84
Reverse-biased diode, 84
Reverse magnetostriction, 277
Rich mixture of air/fuel, 203
Ride in driver/passenger stand-
point, 421
Ring gear, 362
Robustness of control-system
stability, 31e33
Roll, 381, See also Suspension
system
Root-locus techniques, 29e31
Rotary potentiometer, 261, 267
Rotor currents, 298e299, See also
Electric motor
S
Sample and hold circuit, 108
Sample and zero-order hold circuit,
106e111
Sampled data system, 51e52
Sampling, 162
Sampling frequency, 61
Sampling theorem, 60
Satellite elevation above Earth, 518
Saturation condition, 93
Secondary air management, 207,
354e355, 355f
Semiconductor materials, 80
band theory of electrons, 81e82
concentrations under thermal
equilibrium after doping, 82
conductivity of pure, 80
doping, 82
electrical conductivity, 80, 81f
electric ﬁeld intensity, 80e81, 83
energy levels, 82
mean velocities, 83
Sensors, 2, 40e42
noise amplitude of, 44
power spectral density, 43
random errors, 42e44
steady-state sinusoidal frequency
response for, 43
valve-positioning, 223e224
See also Automotive engine
control sensors
Sequential logic circuit, 119e120
Serial operation, 138
Series hybrid vehicle (SHV), 369
Service bay diagnostic system,
524e525
reading of stored fault code,
524
Shielded-ﬁeld sensor, 262
Shift register, 122e124
Signal processing, 45
in contemporary vehicle
instrumentation, 462
electronic instrumentation,
460e461
Signal-processing ﬁlter passband,
48
SIMULINK block, 327
Single cylinder of IC engine, 189,
190f
Sinusoidal frequency response,
56e63
Sliding mode observer (SMO), 415
Slip, deﬁned, 299e300
Solenoid operated actuator, 399
Solid-state diode, 83
Spark timing on engine perfor-
mance, 203e204
Speed-density method, 221e223,
See also Mass airﬂow
measurements
Sprung mass, 420e421
Stack pointer (SP), 145e146,
146f
Stacks, 145e146
Starred transform, 59
closed-loop system, 68e70
State variables, 18
Steady-state operating motor speed,
374
Stepper motor, 304, 329
displacement, 397
type actuator, 397
Stoichiometric mass ﬂow rate for
fuel, 224
Stoichiometric mixture, 203
Stopband, 45
Strain gauge manifold pressure
sensor sensor, 242e245,
244f
Strokes of engine, 189
Summing mode op amp circuit,
103e111
Sun gear, 362
Supercharged engine, 219
Surface-mounted ICs,
154e155
Suspension system
Synchronous counter,
120e124
circuit, 121f
registers, 121e122
shift register, 122e124
System
analog (continuous time), 5
block diagram representation of,
3e5
closed-loop control, 21e27
concept, 2e5
deﬁned, 2
Index
597

System (Continued)
electronic, 2, 3f
ﬁrst order, 9e11
instrumentation, 35e39
open-loop control, 20e21
second-order, 11e15
stability of, 28e33
state variable formulation of
models, 17e19
steady-state sinusoidal frequency
response of, 16e17
Systematic error, 37e39
T
Temperature compensating
resistance, 240
Temperature sensor, 268
Thermistor, 497
Three-way catalyst (TWC),
207e209
average air/fuel ratio to
tolerances, 208
chemical design, 207
conversion efﬁciency, 207e208,
209f
operation, 208
Throttle actuator, 386, 396e399
duty-cycle-controlled, 399
manifold-vacuum-operated
actuator, 398f
stepper motor displacement, 397
stepper motor-type actuator, 397
throttle plate angular displace-
ment, 397
Throttle angle sensor, 265e268
Throttle plate angular displace-
ment, 397
Throttle position sensor (TPS), 209,
319
Time-domain multiplexing (TDM),
465
Tire slip angles, 450e451
Tire-slip controller, 420
Top dead center (TDC), 189, 288
Torque, 193e196
Torque converter, 360, 360f
lock-up, 366
control, 366
Torque converter locking clutch
(TCC), 366
Traction control devices,
366e368
Transconductance, 99
of FET, 99
Transfer function, 6, 41e42, 47
digital, 62
digital ﬁlter, 57
of galvanometer display,
493e494
models characterized by, 22
poles of, 7
using MATLAB, 48
of zero-order hold, 59
Transﬂexive LCD structure, 480
Transistors, 87e96
a-c collector current, 95
applications, 93
base current, 95
baseeemitter junction, 89e90
“bipolar” or “ﬁeld effect”
categories, 87e88
circuit voltage gain, 95e96
collectorebase diode, 93
collectorebase junction,
88e89
conventional current ﬂow, 88
ﬁeld-effect (FET), 96e99
frequency dependence of
ampliﬁer gain, 96
linear ampliﬁcation, 93
NPN transistor, 88
operating characteristics, 90e91
schematic symbols, 88f
small signal linear incremental
transistor model, 94e95
z-transfer function, 391
z-transform function, 392
Transistor voltage/current
characteristics, 91e92, 91f
Transport delay, 217
Tropospheric index of refraction,
518
Truth table, 114
Twisted nematic liquid crystal,
476e480
Two-phase induction motor, torque
and instantaneous power of,
298
Two’s complement notation,
138
U
Ultra-caps, 376
Unsprung mass, 11, 420e421
V
Vacuum-operated actuator,
403e406
Vacuum-operated throttle actuator,
398, 398f
Valence band, 82
Valve overlap, 223
Valve-positioning sensor,
223e224
Valve timing, 191
Variable reluctance sensor, 254
Variable valve phasing, 191
mechanism model,
290e292
Variable valve timing,
288e292
alternate cam phasing mecha-
nism, 289f
camshaft movements, 289
and gas dynamics of cylinder,
288
mechanism for valve phasing,
289f
optimal cam timing, 288
spool valve actuation, 290
Vectored interrupt,
163e164
Vehicle motion controls
axes of control, 381
representative cruise control
system, 382e399
Vehicle speed, 382
Very large scale integrated circuits
(VLSI), 184
Voltage-controlled oscillator
(VCO), 105
capture range, 105
Volume ﬂow rate, 221, 224
W
Wheatstone bridge, 244
Word, 132
Y
Yaw, 381
598
Index

Z
Zero-crossing detector (ZCD), 257,
555
Zero-order hold (ZOH), 58e59, 64,
72, 135
approximate model for, 64e65
circuit, 110e111, 110f, 465
ideal, 64e65, 111
output, 65
Zirconium dioxide (ZrO2) sensor,
270e271
z-transform, 53, 73e74
digital ﬁlter, 55e56
discrete time control systems,
66e67
elementary properties of, 53
inverse, 54, 56, 58
starred transform of, 59e60
Index
599

This page intentionally left blank

