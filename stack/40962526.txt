 
 
Bayesian Modeling of ChIP-chip Data Through a High-Order Ising Model
Author(s): Qianxing Mo and  Faming Liang
Source: Biometrics, Vol. 66, No. 4 (DECEMBER 2010), pp. 1284-1294
Published by: International Biometric Society
Stable URL: https://www.jstor.org/stable/40962526
Accessed: 28-02-2023 12:50 UTC
 
REFERENCES 
Linked references are available on JSTOR for this article:
https://www.jstor.org/stable/40962526?seq=1&cid=pdf-reference#references_tab_contents 
You may need to log in to JSTOR to access the linked references.
 
JSTOR is a not-for-profit service that helps scholars, researchers, and students discover, use, and build upon a wide
range of content in a trusted digital archive. We use information technology and tools to increase productivity and
facilitate new forms of scholarship. For more information about JSTOR, please contact support@jstor.org.
 
Your use of the JSTOR archive indicates your acceptance of the Terms & Conditions of Use, available at
https://about.jstor.org/terms
International Biometric Society is collaborating with JSTOR to digitize, preserve and extend
access to Biometrics
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:50:34 UTC
All use subject to https://about.jstor.org/terms

 Biometrics 66, 1284-1294 DOI: 10.1111/j.l541-0420.2009.01379.x
 December 2010
 Bayesian Modeling of ChlP-chip Data Through a High-Order
 Ising Model
 Qianxing Mo1»* and Faming Liang2»**
 department of Epidemiology and Biostatistics, Memorial Sloan-Kettering Cancer Center,
 New York, New York 10065, U.S.A.
 department of Statistics, Texas A&M University, College Station, Texas 77843, U.S.A.
 * email: moq@mskcc.org
 ** email: fliang@stat.tamu.edu
 Summary. ChlP-chip experiments are procedures that combine chromatin immunoprecipitation (ChIP) and DNA microarray
 (chip) technology to study a variety of biological problems, including protein-DNA interaction, histone modification, and
 DNA methylation. The most important feature of ChlP-chip data is that the intensity measurements of probes are spatially
 correlated because the DNA fragments are hybridized to neighboring probes in the experiments. We propose a simple, but
 powerful Bayesian hierarchical approach to ChlP-chip data through an Ising model with high-order interactions. The proposed
 method naturally takes into account the intrinsic spatial structure of the data and can be used to analyze data from multiple
 platforms with different genomic resolutions. The model parameters are estimated using the Gibbs sampler. The proposed
 method is illustrated using two publicly available data sets from Affymetrix and Agilent platforms, and compared with three
 alternative Bayesian methods, namely, Bayesian hierarchical model, hierarchical gamma mixture model, and Tilemap hidden
 Markov model. The numerical results indicate that the proposed method performs as well as the other three methods for the
 data from Affymetrix tiling arrays, but significantly outperforms the other three methods for the data from Agilent promoter
 arrays. In addition, we find that the proposed method has better operating characteristics in terms of sensitivities and false
 discovery rates under various scenarios.
 Key WORDS: Affymetrix tiling arrays; Agilent promoter arrays; Bayesian hierarchical; ChlP-chip; Gibbs sampler; Ising
 model; Hidden Markov random field; Spatial statistics.
 1. Introduction
 The completion of the Human Genome Project and continu-
 ing improvement of microarray-based technology have revolu-
 tionized the research in molecular biology. One of the major
 objectives of molecular biology is to identify the locations
 of interactions between proteins and genomic DNA. Protein-
 DNA interactions play a key role in many cellular processes,
 including DNA replication, regulation of transcription and
 maintenance of chromosome structure, and so on. The in-
 teractions between transcription factors (TFs) and DNA are
 of particular interest because the interactions basically con-
 trol many crucial cellular reactions through regulation of gene
 expression. The term "ChIP" refers to chromatin immunopre-
 cipitation (IP), a technique used to precipitate target DNA
 fragments out of solution using antibodies that specifically
 bind to DNA-binding proteins. The other term "chip" is just
 an alternative name for microarray, which has been widely
 used for genome-wide gene expression profiling. The ChlP-
 chip is a powerful technique that has been used primarily to
 detect the binding sites of TFs in a genome-wide basis (Caw-
 ley et al., 2004; Boyer et al., 2005). Moreover, this technique
 has been extended to identify DNA sequences with histone
 modification (Bernstein et al., 2005) and specific methylation
 (Fouse et al., 2008).
 In a typical ChlP-chip experiment for DNA-binding pro-
 teins (for review, see Buck and Lieb, 2004), the protein of
 interest is cross-linked to DNA in vivo and the chromatin
 1284
 is sheared by sonication into small fragments, typically in
 200-1000 base pairs (bp). DNA fragments are immunopre-
 cipitated by using a specific antibody against the protein.
 The cross-links are reversed and the DNA fragments are re-
 leased. In two-color array systems, IP-enriched DNA frag-
 ments are amplified and labeled with fluorescent dye such
 as Cy5. DNA fragments prepared from mock IP with ei-
 ther no antibody or irrelevant antibodies are usually used as
 references, and similarly amplified and labeled with another
 fluorescent dye such as Cy3. Finally, the IP-enriched DNA
 and the reference DNA fragments are hybridized to a sin-
 gle tiling array. In one-color array systems, the IP-enriched
 DNA and reference DNA fragments are amplified, labeled
 with the same dye, and hybridized to two arrays, respectively.
 Tiling arrays vary in probe length and resolution depending
 on their manufacturers. For example, Affymetrix human tiling
 arrays such as chromosome 21/22 1.0 arrays (Affymetrix, Inc.,
 Santa Clara, CA, USA) use 25-mer oligonucelotide probe pairs
 (perfect match [PM] and mismatch [MM] probes) to inter-
 rogate the nonrepetitive regions of various genomes at an
 average resolution of 35 bp. Some newer Affymetrix arrays
 such as ENCODE 2. OR arrays have higher resolution (7 bp).
 Agilent human promoter arrays (Agilent Technologies, Inc.,
 Santa Clara, CA, USA) use 60-mer oligonucelotide probes to
 cover -5.5kb upstream to +2. 5kb downstream of the tran-
 scriptional start sites of nearly 17,000 genes at 100-300 bp
 resolution.
 © 2010, The International Biometrie Society
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:50:34 UTC
All use subject to https://about.jstor.org/terms

 A High- Order hing Model for ChlP-chip Data 1285
 To date, quite a few methods have been proposed for ChlP-
 chip data analysis. The most widely used methods are per-
 haps the sliding window-based methods, which are to test
 a hypothesis for each probe using the information from the
 probes within a sliding window of certain genomic distance,
 and then to correct for the multiple hypothesis tests. The
 test statistics used are varied. For example, Cawley et al.
 (2004) used Wilcoxon's rank sum statistic; Keles, Van der
 Laan, and Cawley (2006) used a scan statistic, which is the
 average of ¿-statistics within the sliding window; and Ji and
 Wong (2005) used a scan statistic, which is the average of
 empirical Bayesian ¿-statistics within the sliding window. Be-
 cause each test uses information from neighboring probes, the
 tests are not independent, rendering a difficult adjustment in
 the multiple hypothesis testing step.
 Bayesian methods are appealing alternative choices for
 ChlP-chip data, which have become increasingly popular in
 statistical genomics (Newton et al., 2004; Smyth, 2004; Ke-
 les, 2007; Gottardo et al., 2008). Currently, there are only
 a few Bayesian methods applied to ChlP-chip data. Keles
 (2007) fitted ChlP-chip data to a hierarchical gamma mix-
 ture model (HGMM), which is an extension of the hierar-
 chical mixture model used by Newton et al. (2004) for gene
 expression analysis. This method needs to partition the ge-
 nomic regions into nonoverlapping subregions and restricts
 each subregion to have at most one binding region. Addition-
 ally, the method needs to predetermine the length of bind-
 ing regions, which is not available in general. Gottardo et al.
 (2008) proposed a Bayesian hierarchical model (BAC) for
 ChlP-chip data analysis. The authors model probe intensi-
 ties using a mixture of normal distributions, and the spatial
 structure of the probes through a Gaussian intrinsic autore-
 gression model (Besag and Kooperberg, 1995). The strength
 of this method is that the spatial dependence of the probes is
 incorporated into the model, resulting in clustering effect of
 neighboring probes. The inference is based on the joint poste-
 rior probability (PP) of neighboring probes, which is found to
 be robust to outliers. However, as pointed out by the authors
 themselves, BAC could fail to detect the binding regions with
 a few probes to interrogate the target sequences. This hap-
 pens in the Agilent promoter arrays in which the average gap
 between probes is much longer than that in the Affymetrix
 tiling arrays. Another limitation of the approach is that it
 is very computationally intensive. The hidden Markov model
 (HMM) proposed by Ji and Wong (2005) models the probe
 dependence through an HMM, where the test statistics are
 treated as outcomes of binding and nonbinding hidden states.
 In terms of computation, this approach is the fastest among
 these Bayesian approaches. A limitation of this approach is
 that it does not make use of full information of neighboring
 probes in identification of binding sites; only the part con-
 tained in one side of neighboring probes is used due to the
 structure of the HMM.
 Although most of the aforementioned approaches work well
 for high-resolution arrays such as the Affymetrix tiling arrays,
 it is not clear whether they still work for low-resolution ar-
 rays such as the Agilent promoter arrays. In this article, we
 propose to model the ChlP-chip data via a high-order Ising
 model, which allows for the use of information of more neigh-
 boring probes. Our numerical results on two publicly available
 data sets and some simulated data sets show that our method
 performs as well as the three alternative Bayesian methods for
 the high- resolution arrays, but significantly outperforms the
 others for the low-resolution arrays. Another advantage of our
 model is that it is computationally efficient, although it also
 involves Markov chain Monte Carlo (MCMC) simulations.
 The remainder of this article is organized as follows. In
 Section 2, we describe our new Bayesian model and its MCMC
 implementation. In Section 3, we apply our method to two
 data sets from Affymetrix and Agilent platforms, and com-
 pare it with three alternative Bayesian methods. Section 4 is
 dedicated to the comparison of our method to other Bayesian
 methods through a series of simulation studies. Section 5 con-
 cludes the article with a brief discussion.
 2. A Hidden Markov Random Field-Based
 Bayesian Model
 2.1 The Model
 Let y = (2/1, . . . , yn) be a realization of enrichment measure-
 ments Y = (Yi, . . . , Yn ) on n probes along chromosomes, and
 let each probe associate with a binary latent variable Xi G
 {0,1}, where Xi = 1 denotes that the probe belongs to a
 binding region, and 0 otherwise. We assume, conditional on
 Xi = Xi , Yi follows the distribution
 fN(M0,cT02) ifz«=0,
 iN(/i!,a?) ifxi = l.
 In words, Y¿ is normally distributed with mean /x0 and vari-
 ance a' when the probe belongs to a nonbinding region, and
 mean 'x' and variance a', otherwise. Here, Yi could be any
 appropriate measurement for comparison of the IP-enriched
 and control samples. The assumptions are generally applicable
 when an appropriate measurement is used. For example, the
 measurement could be a Iog2 ratio of IP-enriched and control
 samples for a single replicate, or a summary statistic such as
 ¿-like statistic or mean difference for multiple replicates. Note
 that the proposed method is not designed to directly model
 the probe intensities. The sequence-specific effect of individual
 probes due to different binding affinities is not considered in
 the model because it can be generally removed in preparation
 of the data y. For example, this can be done by subtracting
 the probe intensities of the control samples from that of the
 IP-enriched samples. Furthermore, we assume, conditional on
 X = (Jfi, . . . , Xn ), Yi, . . . , Yn are independent. Thus, we have
 7r(y|x)V) = n(^exp(-^-#))1"IÍ f* 'v2tNto 2ao J J
 f* 'v2tNto ' 2ao J J
 where x = (x', . . . ,xn) is a realization of X, and ip =
 (/¿o,0o, /¿i,<7i) denotes a collection of the model parameters.
 2.2 The Priors
 Let Ào = an2 and Ai = erf2. To conduct a Bayesian analysis,
 we assume that (/x0, Ao) and (/¿1, Ai) are independent a priori,
 and they have the following prior densities:
 tt(/zo, Ao) oc -, tt(/xi, Ai) oc - -.
 Ao Ai
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:50:34 UTC
All use subject to https://about.jstor.org/terms

 1286 Biometrics, December 2010
 In addition, we model the hidden state vector by a higher-
 order Ising model
 *(x|^) = ^exp(¿r ^ *(**>*>)) ) «
 where ß > 0 is the interaction parameter, <£(/?) is the normal-
 izing constant of the distribution, W(i) is a sliding window
 centered at probe i, and ò{xì,Xj) = 1 if x¿ = Xj and -1 oth-
 erwise. The size of the sliding window can be chosen based on
 the length of the sheared DNA fragments and the probe reso-
 lution. If the sliding window only consists of the immediately
 adjacent probes, the model (2) is reduced to the standard
 Ising model.
 The rationale underlying the model (2) can be justified
 from the perspective of ChlP-chip experiments as follows.
 In the ChlP-chip experiments, genomic DNA is sheared into
 fragments with various lengths, usually ranging from 200 to
 1000 bp. The DNA fragments bound by binding proteins are
 enriched through IP. After amplification and labeling, the IP-
 enriched DNA fragments are further chopped to smaller pieces
 for hybridizations. As a result of this process, all probes in the
 vicinity of the binding sites have chances to hybridize to the
 IP-enriched DNA fragments. In contrast, if DNA fragments
 do not contain binding sites, we would expect that the signal
 intensities in the genomic regions are composed of background
 signals. Therefore, the probes belonging to the binding regions
 have relatively higher signal intensities than those belonging
 to nonbinding regions. That is, each of the binding and non-
 binding sites tends to be locally self-clustered. The cluster
 size may depend on the probe resolution. For an array with
 35 bp resolution, each binding region may consist of approxi-
 mately 10-58 probes; and for an array with 280 bp resolution,
 each binding region may consist of approximately one to seven
 probes. We note that the locally self-clustering phenomenon
 of the ChlP-chip data is extremely similar to the cooperative
 behavior of magnetic materials, which has been modeled by
 Potts or Ising models in physics. It is known that the Potts
 model is a multiclass generalization of the Ising model. If we
 code the probes belonging to the binding and nonbinding re-
 gions by 1 and 0, respectively, then the hidden state vector
 introduced in (1) can be viewed as a configuration of an Ising
 model and can thus be modeled by (2). We note that the idea
 of modeling the hidden state vector of the ChlP-chip data by
 an Ising model is not brand new. For example, the HMM used
 by Ji and Wong (2005) is essentially a first-order Ising model.
 The novelty of our model is that it allows for the higher-
 order interaction between probes. This, in return, improves
 the robustness of our method to outlying probes. The Gaus-
 sian intrinsic autoregression model used by Gottardo et al.
 (2008) can also be viewed as a continuous extension of the
 Ising model, which encourages neighboring probes to be of
 the same class (enriched or non-enriched).
 For the model (2), if ß < 0, the model tends to generate a
 spatial pattern with more adjacent probes being in opposite
 states; if ß = 0, then all probes are independent; and if ß > 0,
 the model (2) is called the ferromagnetic Ising model. A large
 positive value of ß gives rise to large clusters of probes. There-
 fore, we restrict ß to be positive in this article. Although ß
 can be restricted to be positive, it is
 unknown parameter. The reason is t
 tractable, and sampling from the pos
 would require an exact sampling step
 by Möller et al. (2006) or Huber (200
 number of probes we are dealing wi
 tational intensity required by the ex
 it is impractical to consider a fully 
 the following sections, we propose a 
 ing the value of ß based on the phys
 Ising model.
 In the context of clustering using ferromagnetic Potts
 models, Blatt, Wiseman, and Domany (1996) characterized
 the model behavior with three phases - paramagnetic, super-
 paramagnetic, and ferromagnetic - as the temperature (1/ß)
 decreases from high to low. The paramagnetic phase is a dis-
 order phase in which the spins are randomly distributed. In
 the super-paramagnetic phase, the spins are aligned in large
 clusters. The value of /?, at which the transition from the
 paramagnetic phase to the super-paramagnetic phase occurs,
 is called the critical value of the model. When the temper-
 ature is further lowered, a pseudotransition occurs, leading
 to the formation of ferromagnetic phase in which the system
 becomes completely ordered. Note that the problem of bind-
 ing sites detection is essentially a clustering problem, and our
 interest is to find probe clusters in the super-paramagnetic
 phase. Motivated by these observations, we propose to deter-
 mine the a priori value of ß by simulating of tt(x|/3) at a series
 of ß values arranged in an increasing order. We will use some
 real examples to illustrate this procedure in Section 3.
 2.3 The Full Conditionals and Gibbs Sampling
 Let n0 = Ym=i(1 ~ x») anc* ni = YH=i x* ke tne tota^ num"
 bers of nonbinding and binding probes, respectively. Let y0 =
 4 ^Xi^1 ~ Xi^Vi and & = 'k ¿<U XiVi be the samPle means
 of the measurements for nonbinding and binding probes, re-
 spectively. In addition, let N(a, 6) denote a Gaussian distri-
 bution with mean a and variance 6, Ga(a, b) a gamma dis-
 tribution with mean a/6 and variance a/ò2, and y'-- the
 full conditional distribution of y given everything else in the
 model. After some algebra, we get the following full condi-
 tional distributions:
 "•i-~N(*'¿;)' (3)
 Ao | • • • ~ Ga ( Ç, i ¿(1 - Xi)(Vi - ßo)2 J , (4)
 *|-~N(*'¿)' (5)
 Ail-^GafeiÇ^fo-jii)2], (6
 *(*, = 1 | . . •) = (l + (^) %xp(/?(no(i) - m(<))
 + ^(î/i-Mi)2-f(îfc-*>)2)) ' (7)
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:50:34 UTC
All use subject to https://about.jstor.org/terms

 A High-Order Ising Model for ChlP-chip Data 1287
 where t = l,...,n, and no(t) = 52j€W{i)J# 6(0, xá) and
 m(i) = ^2jeW^' j¿i £(l>£j) are the sums of interactions given
 probe i is a nonbinding or a binding probe in the sliding win-
 dow VK(i), respectively. Given the full conditional distribu-
 tions (3)-(7), it is straightforward to simulate from the poste-
 rior distributions using a cyclic Gibbs sampler. The posterior
 probabilities of the hidden states will be used for inference of
 binding sites. Because the model is not fully identifiable, the
 likelihood staying the same by switching (/z0, Ao) with (/ii, Ai)
 and switching all of the cluster labels (0 by 1 and 1 by 0),
 the outputs have been relabeled according to the constraint
 Mo < Mi-
 3. Applications
 3.1 Affymetrix and Agilent ChlP-chip Data
 Cawley et al. (2004) mapped the binding sites of three TFs,
 Spl, cMyc, and p53 on human chromosomes 21 and 22 using
 Affymetrix tiling arrays with an average of 35 bp resolution.
 All experiments were done with six replicates. Here we only
 focus on the p53 experiments in which antibody p53-D01 was
 used for the p53-specific IP, and the antibody against bacte-
 rial glutathione-S-transferase (GST) was used in the control
 experiment. The reason we choose this experiment is that it
 has the most validated regions (14 in total), which could be
 used as a gold standard for comparison. Only the PM inten-
 sities were used for the analysis because the MM intensities
 are poor measurements of nonspecific hybridization (Irizarry
 et al., 2003). Following the normalization methods used by
 Cawley et al. (2004), the PM intensities were Iog2 transformed
 and then quantile-normalized within treatment and control
 replicate groups, respectively. Finally, all arrays were scaled
 to have the same median value.
 Boyer et al. (2005) used Agilent promoter arrays to iden-
 tify the binding sites of three TFs Oct4, Sox2, and Nanog on
 18,002 transcription start sites of 17,917 unique genes, which
 were spanned on 10 arrays. Sixty-mer probes were used to
 interrogate the target genomic sequences at an average of 280
 bp resolution. In the experiments, enriched DNA was labeled
 with Cy5 fluorophore, and whole cell extract DNA was used
 as a control and labeled with Cy3 fluorophore. All experi-
 ments were done in duplicates. We only use Oct4 data for the
 purpose of illustration and comparison. The Cy5 and Cy3 in-
 tensities were Iog2 transformed and then quantile-normalized.
 3.2 Analysis of the p53 and Oct4 Data
 Similar to Ji and Wong's method (2005), we used a two-
 step approach for the data with multiple replicates. We
 first calculated the moderated ¿-statistic for each probe
 using the empirical Bayesian method (Smyth, 2004). The
 moderated ¿-statistic is a hybrid of classical and empir-
 ical Bayesian approaches in which the ordinary standard
 deviation (SD) is replaced by the posterior residual SD.
 For the case of two sample comparison, the moderated ¿-
 statistic can be easily calculated using the limma package in R
 (http://www.bioconductor.org). Hereafter, we will call the
 moderated ¿-statistic limma ¿-statistic. The limma ¿-statistic
 has been shown to be more powerful than the ordinal ¿-
 statistic in detection of differentially expressed genes for mi-
 croarray data, especially when the number of replicates is
 small. In the second step, we applied the proposed method
 to the limma ¿-statistics to identify binding sites.
 We applied our method to both the p53 and Oct4 data.
 We know that if a probe is on a binding site, it is very likely
 that its neighboring probes also have relatively high mea-
 surements. Bearing in mind this observation and the probe
 resolutions, we considered a second-order Ising model for
 both the p53 data and Oct4 data; that is, setting W(i) =
 {i - 2, i - 1, i + 1, i + 2} for all i except for the boundary
 probes. Because the enrichment measurement of a binding
 probe is usually several SDs higher than the mean enrich-
 ment measurements, we set the initial state of each probe to
 1 if its enrichment measurement is greater than two SDs of
 the mean value and 0 otherwise, in our simulations.
 To determine the value of ß, we first tried to get an esti-
 mate for the critical value of the Ising model, which is about
 1.0. The details about how to estimate the critical value are
 described in the Web Supplementary Material. It is important
 to know roughly the critical value as the phase transition oc-
 curs at that point. The Ising system is in the disorder phase
 if ß is less than the critical value, which does not reflect the
 TF-binding events. Therefore, ß should be at or above the
 critical value depending on the resolution of the arrays under
 study. According to our experience, for the arrays with high
 resolution, a relatively large value of /?, ranging between 2 and
 4, can be used, whereas for the arrays with low resolution, a
 relatively small value of /?, ranging between 1 and 1.5, can be
 used.
 The rationale under this criterion can be explained through
 our experiments as follows. Figure 1 shows the results from
 different values of ß, ranging from 0.75 to 4 with an incre-
 ment of 0.25. For the p53 data, at the PP cutoff 0.9 and
 false discovery rate (FDR) cutoff 0.05, thousands of regions
 are found when ß is less than or equal to 1. However, when
 ß increases to 1.25, the number of regions decreases dramat-
 ically to dozens, and then it changes only slightly when ß
 increases further. Similar results are observed for the Oct4
 data, where the dramatic change occurs at ß = 1.0. These
 observations suggest that a phase transition occurs, the Ising
 system changing from a disorder phase to an order phase. In
 the disorder phase, the interaction strength between neighbor-
 ing probes is weak, thus a large number of regions are falsely
 claimed to be the binding regions. In the order phase, the in-
 teraction strength between neighboring probes is strong, thus
 only a small number of regions are claimed to be the binding
 regions. Clearly, only the order phase mirrors the TF-binding
 events because we know that the genome is extremely domi-
 nated by the nonbinding regions. Therefore, we only consider
 the results when the Ising system is in the order phase. As
 shown in Figure 1, the performance of our method is quite
 robust to the choice of ß. In a wide range of ß, 1.25-4, all the
 14 validated are detected for the p53 data. The results shown
 in Table 1 and Figures 2 and 3 are based on the ß value of
 2.75 for both the p53 chromosome 21 and 22 data, and 1.0 for
 the Oct4 data. Figure 2 shows the posterior probabilities of
 the probes plotted against genomic positions for the p53 and
 Oct4 data. For the p53 data, most of the probes (99.7% for
 chromosome 21, and 99.5% for chromosome 22) have poste-
 rior probabilities equal to 0. Some regions containing consecu-
 tive probes with posterior probabilities close to 1 are sparsely
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:50:34 UTC
All use subject to https://about.jstor.org/terms

 1288 Biometrics, December 2010
 0 i p53 chromosome 21 -+ p53 chr
 8 S 1-Ò
 1 -*- pp > 0
 |- -+- FDR<0.05 8 "+" FDR<005 - .+ . FDR<005
 .2 o .9 .2 8"
 Ö) o o . O) - I O) i
 CD o 0} I (D e-i
 %_ LO k_ I v- g
 O o O O _ I O m
 II" 1S I 8 _
 E _ E - E §
 3 8 _ => =>
 Z © ~ ZI Z °
 I - 8
 1 1.5 2 2.5 3 3.5 4 1 1.5 2 2.5 3 3.5 4 0.75 1.5 2 2.5 3 3.5 4
 ß ß ß
 Figure 1. Nu
 0.75 to 4 wi
 Adjacent pro
 distributed 
 fied as the p
 by Cawley e
 by 500 bp o
 claimed to 
 on chromos
 PCR validate
 method, and
 overall, muc
 to 1, which 
 searched for
 At the PP c
 regions, wh
 typical bind
 the propose
 with poster
 relatively la
 resolutions, 
 binding regio
 p53 data in 
 contrast, th
 gion. Althou
 are much di
 method.
 3.3 Comparisons
 We compared our method to three alternative Bayesian ap-
 proaches, namely, BAC (Gottardo et al., 2008), Tilemap
 HMM (Ji and Wong, 2005), and HGMM (Keles, 2007). For
 the p53 data sets, there were five RT-PCR validated bind-
 ing regions for chromosome 21, and nine for chromosome 22.
 Therefore, these 14 validated regions were used as a gold stan-
 dard for the comparison. For the Oct4 data set, although
 there were not RT-PCR validated regions, the authors (Boyer
 et al., 2005) reported 367 potentially binding regions on 353
 genes that were co-occupied by the three TFs Oct4, Sox2,
 and Nanog. Although the FDR was not estimated for the 367
 regions, they still should be a good standard for the compar-
 ison considering that these regions were detected by all three
 experiments.
 To apply these methods to the ChlP-chip data, an impor-
 tant parameter that needed to be determined in advance is
 the size of the sliding window. For both data sets, we, fol-
 lowing the suggestions by their authors, adjusted the sliding
 window size according to the probe resolution and the av-
 erage length of sheared DNA fragments. For the Oct4 data,
 Boyer et al. (2005) reported that the maximum sheared DNA
 fragment size is about 550 bp, which suggests that the DNA
 fragments would approximately cover three to five probes,
 given that the probe resolution is about 280 bp. In fact, we
 have tried different window sizes for the other three methods
 and found the results were best when the size was set to this
 range, which is consistent with our estimation. More details
 about the parameters used for the analyses can be found in
 the Web Appendix. For the three alternative methods, we
 report the best results we could obtain in Table 1. The re-
 sults produced by the other parameters can be found in Web
 Tables 1-3.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:50:34 UTC
All use subject to https://about.jstor.org/terms

 A High- Order Ising Model for ChlP-chip Data 1289
 Table 1
 Number of regions detected by each method for the p53 and OciA data. All the methods are able to detect the 14 vali
 regions for the p53 data at fixed PP and FDR cutoffs. However, only the Ising method is able to detect most of the 
 regions for the OciA data.
 p53/Chrom 21 p53/Chrom 22 Oct4/Chrom 1-24
 Method Cutoff V(5) Total V(9) Total G(367) Total
 Ising PP > 0.95 5 84 9 87 277 714
 PP > 0.90 5 89 9 88 289 805
 FDR < 0.01 5 96 9 92 280 740
 FDR < 0.05 5 109 9 96 307 1048
 Top 20 4 20 3 20 20 20
 Top 40 5 40 8 40 40 40
 Top 60 5 60 9 60 52 60
 BAC PP > 0.95 5 61 9 89 10 13
 PP > 0.90 5 73 9 100 17 21
 FDR < 0.01 5 68 9 94 7 8
 FDR < 0.05 5 106 9 142 18 24
 Top 20 3 20 3 20 15 20
 Top 40 5 40 9 40 33 40
 Top 60 5 60 9 60 46 60
 Tilemap PP > 0.95 5 61 9 102 107 166
 HMM PP > 0.90 5 65 9 109 122 199
 FDR < 0.01 5 65 9 104 84 132
 FDR < 0.05 5 81 9 139 148 240
 Top 20 5 20 4 20 13 20
 Top 40 5 40 8 40 26 40
 Top 60 5 60 9 60 38 60
 HGMM PP > 0.95 5 31 9 96 51 82
 PP > 0.90 5 32 9 98 55 88
 FDR < 0.01 5 34 9 102 54 87
 FDR < 0.05 5 40 9 119 69 112
 Top 20 3 20 7 20 6 20
 Top 40 5 40 8 40 21 40
 Top 60 5 60 8 60 36 60
 To ease comparison, we select
 FDR was calculated using a dir
 in Newton et al. (2004). The 
 abilities exceed the cutoff wer
 Adjacent binding sites for whi
 than 500 bp were merged into
 results are summarized in Tab
 our method. For the p53 data,
 cutoff 0.01, the four methods
 ing regions. In terms of rankin
 regions on chromosome 21 are 
 their top 40 regions, and the 9
 some 22 are found by Ising, BA
 top 60 regions while 8 regions
 Oct4 data, at a PP cutoff of 
 our approach detects much mor
 methods in terms of gold reg
 It is pretty clear that the thr
 detect most of the binding reg
 dition, in terms of ranking perf
 gold regions are found by our 
 60 regions, respectively, which
 corresponding results produced
 Therefore, our approach perfo
 the p53 data, and
 Oct4 data.
 4. Simulation Studies
 We carried out a series of simulations to compare the pe
 formances of the proposed method and the three alternat
 Bayesian methods. To make a fair comparison, we tried 
 generate simulated data according to the underlying str
 ture of ChlP-chip data, instead of generating particular 
 to satisfy each model. The probe enrichment measureme
 in a typical binding region have a triangle- or a bell-sha
 structure (for example, see Figure 3A and C), where 
 peak is usually the center. We used two functions given 
 Mexp(-2DP/L) and Mexp(-4£>2/L2) to model the trian
 and the bell-shaped structures for the binding regions res
 tively, where M is the value of the peak, Dp is the geno
 distance between probe p and the peak, and L is the lengt
 the enriched region. The bell-shaped function has been u
 by Gottardo et al. (2008) in their simulation studies.
 Following the simulation strategy used by Gottardo et
 (2008), we simulated 100 data sets using the first 40,000 
 nomic positions of the Affymetrix chromosome 22 and 
 Agilent chromosome 1 as the genomic coordinates, respe
 tively. Each data set consisted of three replicates for bo
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:50:34 UTC
All use subject to https://about.jstor.org/terms

 1290 Biometrics, December 2010
 Figure 2. Posterior probabilities of probes in binding state versus 
 data. Most of the probes (99.7% for chromosome 21, and 99.5% fo
 essentially have 0 posterior probabilities. The 14 RT-PCR validated r
 Oct4 data are marked by + sign, and have consecutive probes with
 color in the electronic version of this article.
 control and treatment conditions, and each replicate had
 40,000 probes. Because the binding site of a DNA binding
 protein is usually about several bp, a probe can completely
 cover the binding site. Therefore, it is appropriate to choose
 the genomic position of a probe as a peak position. To gener-
 ate data for binding regions, we randomly selected 40 genomic
 positions as the peak positions. The values for the peaks were
 randomly generated from a uniform distribution between 3
 and 8, and the length of the binding regions (parameter for
 L) were randomly generated from a uniform distribution be-
 tween 400 bp and 1000 bp. The probes in a given binding
 region were set to the values according to the two functions
 described previously if the distances between the probes and
 the peak are less than or equal to L/2 bp, and zero other-
 wise. In addition, we also added background noises to the
 probes in the binding regions. Background noises were gener-
 ated from the standard normal distribution, or Laplace dis-
 tribution with mean 0 and variance 0.5. For the probes in the
 nonbinding regions, their values were set to pure background
 noises. HGMM requires the probe measurements to be pos-
 itive, thus we added a small constant to the data to make
 them become positive. Therefore, we generated eight differ-
 ent data sets corresponding to the eight combinations: two
 types of shape functions x two different genomic coordinates
 x two different background noises. The parameters for the
 four methods used in these simulations are described in the
 Web Appendix.
 We evaluated the performance of the four methods by com-
 paring the sensitivities and FDRs averaged across the 100
 data sets at various PP thresholds. The results based on the
 triangle-shaped function are summarized in Figure 4. When
 the Affymetrix genomic coordinate is used, Ising, BAC, and
 Tilemap HMM have sensitivities close to 1 at various thresh-
 olds, and they are much better than HGMM. In terms of sen-
 sitivity, Ising and Tilemap HMM methods perform the best,
 followed by BAC and HGMM (Figure 4A and B). When the
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:50:34 UTC
All use subject to https://about.jstor.org/terms

 A High- Order Ising Model for ChlP-chip Data 1291
 p53 Oct4
 "(A) J I [(Õ '
 ' '
 Is- Al f ' l' i /
 1 :l/V l' vr
 I
 32624400 32624800 32625200 32625600 29330000 29332000 29334000 29336000
 Genomic Position on Chromosome 21 Genomic Position on Chromosome 1
 p53 Oct4
 2 - /m • ••••••••••••••••••••• 2 " (D) # - •
 •'" CO tO Ì I ¡= 
 CO tO I TO (D ^.O '
 i,. ° . ° ' 1 ,. ° / ; '
 2 ° / ' 2 ,. ° / o
 2 8 o o. 8 / o '
 3- / ' 3- / '
 o ° o °
 g - ooooo ooooo g - ocP
 I I I I I I I I I I I
 32624400 32624800 32625200 32625600 29330000 29332000 29334000 29336000
 Genomic Position on Chromosome 21 Genomic Position on Chromosome 1
 Figure 3. Distribution of limma ¿-statistics and posterior probabilities of probes i
 for the p53 data (A and B) and the Oct4 data (C and D). The binding region for the
 due to the high probe resolution (35 bp). In contrast, the binding region for the Oc
 low probe resolution (280 bp).
 Agilent coordinate is used (Figure 4C and D), the Ising
 method still has sensitivities greater than 0.9 at various
 thresholds, which are much better than the others. In terms
 of FDRs, Ising, Tilemap HMM, and HGMM have low FDRs
 (<0.05) at various thresholds in all simulations (Figure 4E-
 H), which are lower than BAC's FDRs. Note that HGMM
 has low FDRs in simulations 3 and 4 due to the small num-
 bers of detected regions. Ising's FDRs decrease steadily when
 the thresholds increase in simulations 3 and 4. In contrast,
 BAC's FDRs appear to be constant at the fixed cutoffs (Fig-
 ure 4G and H). Similar results are obtained when the bell-
 shaped function is used (Web Figure 2). The three alterna-
 tive methods have improved sensitivities for the simulated
 low-resolution data, but our method still has the highest sen-
 sitivities under various conditions. In terms of FDRs, the re-
 sults are similar to the results based on the triangle-shaped
 function (Web Figure 2). We also evaluated the performance
 of the four methods using the plot of true FDR versus nom-
 inal FDR, which indicates whether true FDR deviates when
 nominal FDR is used for error rate control using the method
 introduced by Newton et al. (2004). Controlling the FDR at
 0.2, the FDR estimates produced by our method are closest
 to the true FDRs for the low-resolution data and the results
 produced by our method are comparable to those produced
 by the others for the high-resolution data (Web Figures 3 and
 4).
 5. Discussion
 In this article, we have developed a simple, but powerful
 Bayesian method to detect TF binding sites for the ChlP-
 chip experiments. We compared our method to three alterna-
 tive Bayesian methods on some real and simulated data sets.
 In terms of sensitivities and FDRs, our method performed at
 least as well as the others for the high-resolution data, but sig-
 nificantly outperformed the others for the low-resolution data.
 For the simulated data, which were generated according to the
 structure of the ChlP-chip data instead of a specific model,
 our method had high sensitivities and low FDRs in various
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:50:34 UTC
All use subject to https://about.jstor.org/terms

 1292 Biometrics, December 2010
 Figure 4. Comparison of sensitivities and FDRs for the methods Is
 data sets. The triangle-shaped function was used to simulate probe
 FDRs were averaged across 100 simulations. Regardless of the probe
 in all simulations at various PP cutoffs. The Ising method also has
 genomic coordinate and normal background; (B) and (F): Affymetr
 (G): Agilent genomic coordinate and normal background; (D) and (H
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:50:34 UTC
All use subject to https://about.jstor.org/terms

 A High- Order Ising Model for ChlP-chip Data 1293
 settings (Figure 4). It should be noted that our method can
 be used not only for the data with multiple replicates, but
 also for the data with a single replicate. This is extremely
 useful in practice. For example, due to the cost of ChlP-chip
 experiments, the investigators often want to make an early
 test whether or not their experiments work before carrying
 out further experiments. Our method can be used for this
 kind of test based on very few experiments.
 Why does our method outperform the other three Bayesian
 methods for the low-resolution data? The reason is that our
 model allows for the higher-order interaction between neigh-
 boring probes, and thus allows for more information of the
 data to be used in identification of binding regions. Compared
 to the HMM used by Ji and Wong (2005), which is essen-
 tially a first-order Ising model, our method produced more
 accurate identification of binding regions, especially for the
 low- resolut ion data as demonstrated by the Oct4 example.
 The BAC method (Gottardo et al., 2008) models the spatial
 dependence of probes via a Gaussian intrinsic autoregression
 model, which can be viewed as a continuous extension of an
 Ising model. To further make use of information of neighbor-
 ing probes, the BAC method uses an extra step to estimate
 the joint PP of the probes in a sliding window. However, as
 demonstrated by our numerical examples, this off-model rem-
 edy to the higher-order interaction is not very effective, espe-
 cially for the low-resolution data. HGMM does not incorpo-
 rate the dependence structure of neighboring probes into the
 model, and its implementation depends on the partition of
 the probes. Another advantage of our method over the BAC
 and HGMM methods is its computational efficiency. For a
 data set with 500,000 probes, to run 15,000 iterations on a
 64-bit Linux machine with 2.4 GHZ CPU, BAC cost about
 20 hours, but our method only cost about 20 minutes. HGMM
 needed about 4.5 hours for the computation (EM algorithm,
 100 iterations).
 The parameter ß plays an important role in our model,
 which can be chosen based on the physical property of the
 Ising model. First, we can use the Gibbs sampler to get an
 approximate estimate for the critical value of the Ising model.
 Note that the critical value of the Ising model is independent
 of the ChlP-chip data under study. Hence, the estimate we
 obtained for one data set can be used for others, as long as
 the same sliding window size is used in the analysis. Then
 a value of ß can be selected according to the resolution of
 the arrays under study. In general, a high resolution implies a
 strong probe interaction (a large ß value) and a low resolution
 implies a weak probe interaction (a small ß value). Based on
 our experience, for the high-resolution arrays, ß can be set to
 a value well above the critical value (e.g., 2-4); whereas for
 the low-resolution arrays, ß can be at or just above the critical
 value (e.g., 1-1.5). It is remarkable that the performance of
 our method is quite robust to the choice of ß (Figure 1).
 Another important parameter of our model is the size of the
 sliding window. In general, a wider sliding window allows for
 the use of more information of neighboring probes. However,
 the sensitivity of the method can be reduced if the window
 size is too large. In our experience, a balance between high
 sensitivity and low FDR can often be achieved when choosing
 a sliding window of size 4, i.e., allowing a probe (except for the
 boundary probes) to interact with its four nearest neighbor-
 ing probes. In addition, it should be noted that the definition
 of the sliding window in our model is flexible. The explicit
 genomic distance between probes may also be used. As a re-
 sult, the probe numbers vary in the predefined window (e.g.,
 500 bp), and the interaction between probes can be beyond
 the second order. In practice, it may not be necessary to use
 the explicit genomic distance because most of the probes are
 roughly equally spaced.
 Although ChlP-chip technique just appeared a few years
 ago, an emerging technique called ChlP-seq (chromatin IP
 followed by sequencing) is starting to replace ChlP-chip in
 many biological researches (see Park, 2009, for a review). Like
 the ChlP-chip data, the ChlP-seq data are spatially posi-
 tively correlated, so our model should also be applicable to
 the ChlP-seq data with some modifications. For example, the
 normal model for the summary measurement Y can be re-
 placed by a Poisson-like model, as the ChlP-seq technique
 directly "counts" the number of DNA fragments in the ex-
 periment. The proposed model for ChlP-chip data has been
 implemented in an R package called iChip, which is avail-
 able from the authors upon request or through Bioconductor
 (http : //www . bioconductor . org) .
 6. Supplementary Material
 The Web Appendix Figures, and Tables mentioned in this
 article are available under the Paper Information link at the
 Biometrics website http : //www . biometrics . tibs . org.
 Acknowledgements
 The authors thank Hongkai Ji for helpful discussion about
 Tilemap HMM, and the editor, the associate editor, and
 the referees for their comments, which have led to signif-
 icant improvement of this article. FL's research was par-
 tially supported by grants from the National Science Founda-
 tion (DMS-0607755) and the award (KUS-C1-016-04) made
 by King Abdullah University of Science and Technology
 (KAUST).
 References
 Bernstein, B. E., Kamal, M., Lindblad-Toh, K., Bekiranov, S., Baile
 D. K., Huebert, D. J., McMahon, S., Karlsson, E. K., Kulbokas, 
 J. 3rd, Gingeras, T. R., Schreiber, S. L., and Lander, E. S. (2005
 Genomic maps and comparative analysis of histone modifications
 in human and mouse. Cell 120, 169-181.
 Besag, J. and Kooperberg, C. (1995). On conditional and intrinsic 
 toregressions. Biometrika 82, 733-746.
 Blatt, M., Wiseman, S., and Domany, E. (1996). Clustering d
 through an analogy to the Potts model. Advances in Neural In
 formation Processing Systems 8, 416-422.
 Boyer, L. A., Lee, T. I., Cole, M. F., Johnstone, S. E., Levine, S.
 Zucker, J. P., Guenther, M. G., Kumar, R. M., Murray, H. L
 Jenner, R. G., GifFord, D. K., Melton, D. A., Jaenisch, R., an
 Young, R. A. (2005). Core transcriptional regulatory circuitry 
 human embryonic stem cells. Cell 122, 947-956.
 Buck, M. J. and Lieb, J. D. (2004). ChlP-chip: Considerations for t
 design, analysis and application of genome-wide chromatin im
 munoprecipitation experiments. Genomics 83, 349-360.
 Cawley, S., Bekiranov, S., Ng, H. H., Kapranov, P., Sekinger
 A., Kampa, D., Piccolboni, A., Sementchenko, V., Cheng
 J., Williams, A. J., Wheeler, R., Wong, B., Drenkow, J
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:50:34 UTC
All use subject to https://about.jstor.org/terms

 1294 Biometrics, December 2010
 Yamanaka, M., Patel, S., Brubaker, S., Tammana, H., Helt, G.,
 Struhl, K., and Gingeras, T. R. (2004). Unbiased mapping of tran-
 scription factor binding sites along human chromosomes 21 and
 22 points to widespread regulation of noncoding RNAs. Cell 116,
 499-509.
 Fouse, S., Shen, Y., Pellegrini, M., Cole, S., Meissner, A., Van Neste, L.,
 Jaenisch, R., and Fan, G. (2008). Promoter CpG methylation con-
 tributes to ES cell gene regulation in parallel with Oct4/Nanog,
 PcG complex, and histone H3 K4/K27 trimethylation. Cell Stem
 Cell 2, 160-169.
 Gottardo, R., Li, W., Johnson, W. E., and Liu, X. S. (2008). A flexible
 and powerful Bayesian hierarchical model for ChlP-chip experi-
 ments. Biometrics 64(2), 468-478.
 Huber, M. (2002). A bounding chain for Swendsen-Wang. Random
 Structures and Algorithms 22(1), 53-59.
 Irizarry, R., Hobbs, B., Collin, F., Beazer-Barclay, Y., Antonellis, K.,
 Scherf, U., and Speed, T. (2003). Exploration, normalization, and
 summaries of high density oligonucleotide array probe level data.
 Biostatistics 4, 249-264.
 Ji, H. and Wong, W. (2005). Tilemap: Create chromosomal map of
 tiling array hybridizations. Bioinformatics 18, 3629-3636.
 Keles, S. (2007). Mixture modeling for genome- wide localization of tran-
 scription factors. Biometrics 63, 10-21.
 Keles, S., Van der Laan, M. J., and Cawley, S. E. (2006). Multiple
 testing methods for ChlP-chip high density oligonucleotide array
 data. Journal of Computational Biology 13(3), 579-613.
 Möller, J., Pettitt, A., Berthelsen, K., and Reeves, R. (2006). An ef-
 ficient Markov chain Monte Carlo method for distributions with
 intractable normalising constants. Biometrika 93, 451-458.
 Newton, M., Noueiry, A., Sarkar, D., and Ahlquist, P. (2004). Detecting
 differential gene expression with a semiparametric hierarchical
 mixture method. Biostatistics 5, 155-176.
 Park, P. (2009). ChlP-seq: Advantages and challenges of a maturing
 technology. Nature Reviews Genetics 10(10), 669-680.
 Smyth, G. (2004). Linear models and empirical Bayes methods
 for assessing differential expression in microarray experiments.
 Statistical Applications in Genetics and Molecular Biology 3,
 Article 3.
 Received April 2009. Revised October 2009.
 Accepted November 2009.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:50:34 UTC
All use subject to https://about.jstor.org/terms

