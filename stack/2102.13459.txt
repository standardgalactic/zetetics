Geometrization of the local Langlands correspondence
Laurent Fargues and Peter Scholze
arXiv:2102.13459v2  [math.RT]  27 May 2021

Abstract. Following the idea of [Far16], we develop the foundations of the geometric Langlands
program on the Fargues–Fontaine curve. In particular, we deﬁne a category of ℓ-adic sheaves on
the stack BunG of G-bundles on the Fargues–Fontaine curve, prove a geometric Satake equivalence
over the Fargues–Fontaine curve, and study the stack of L-parameters. As applications, we prove
ﬁniteness results for the cohomology of local Shimura varieties and general moduli spaces of local
shtukas, and deﬁne L-parameters associated with irreducible smooth representations of G(E), a
map from the spectral Bernstein center to the Bernstein center, and the spectral action of the
category of perfect complexes on the stack of L-parameters on the category of ℓ-adic sheaves on
BunG.

Contents
Chapter I.
Introduction
7
I.1.
The local Langlands correspondence
7
I.2.
The big picture
8
I.3.
The Fargues–Fontaine curve
18
I.4.
The geometry of BunG
20
I.5.
ℓ-adic sheaves on BunG
23
I.6.
The geometric Satake equivalence
26
I.7.
Cohomology of moduli spaces of shtuka
30
I.8.
The stack of L-parameters
32
I.9.
Construction of L-parameters
34
I.10.
The spectral action
37
I.11.
The origin of the ideas
39
I.12.
Acknowledgments
43
I.13.
Notation
44
Chapter II.
The Fargues–Fontaine curve and vector bundles
47
II.1.
The Fargues–Fontaine curve
49
II.2.
Vector bundles on the Fargues–Fontaine curve
58
II.3.
Further results on Banach–Colmez spaces
76
Chapter III.
BunG
87
III.1.
Generalities
88
III.2.
The topological space |BunG|
89
III.3.
Beauville–Laszlo uniformization
97
III.4.
The semistable locus
100
III.5.
Non-semistable points
103
Chapter IV.
Geometry of diamonds
107
IV.1.
Artin stacks
107
IV.2.
Universally locally acyclic sheaves
114
IV.3.
Formal smoothness
130
IV.4.
A Jacobian criterion
133
IV.5.
Partial compactly supported cohomology
151
IV.6.
Hyperbolic localization
154
IV.7.
Drinfeld’s lemma
163
Chapter V.
D´et(BunG)
167
3

4
CONTENTS
V.1.
Classifying stacks
168
V.2.
´Etale sheaves on strata
171
V.3.
Local charts
173
V.4.
Compact generation
177
V.5.
Bernstein–Zelevinsky duality
180
V.6.
Verdier duality
181
V.7.
ULA sheaves
182
Chapter VI.
Geometric Satake
185
VI.1.
The Beilinson–Drinfeld Grassmannian
188
VI.2.
Schubert varieties
194
VI.3.
Semi-inﬁnite orbits
199
VI.4.
Equivariant sheaves
204
VI.5.
Aﬃne ﬂag variety
206
VI.6.
ULA sheaves
209
VI.7.
Perverse Sheaves
213
VI.8.
Convolution
221
VI.9.
Fusion
223
VI.10.
Tannakian reconstruction
228
VI.11.
Identiﬁcation of the dual group
232
VI.12.
Chevalley involution
236
Chapter VII.
D■(X)
239
VII.1.
Solid sheaves
241
VII.2.
Four functors
248
VII.3.
Relative homology
253
VII.4.
Relation to D´et
257
VII.5.
Dualizability
260
VII.6.
Lisse sheaves
264
VII.7.
Dlis(BunG)
267
Chapter VIII.
L-parameter
273
VIII.1.
The stack of L-parameters
275
VIII.2.
The singularities of the moduli space
278
VIII.3.
The coarse moduli space
282
VIII.4.
Excursion operators
287
VIII.5.
Modular representation theory
289
Chapter IX.
The Hecke action
309
IX.1.
Condensed ∞-categories
312
IX.2.
Hecke operators
313
IX.3.
Cohomology of local Shimura varieties
316
IX.4.
L-parameter
319
IX.5.
The Bernstein center
319
IX.6.
Properties of the correspondence
322
IX.7.
Applications to representations of G(E)
326

CONTENTS
5
Chapter X.
The spectral action
333
X.1.
Rational coeﬃcients
334
X.2.
Elliptic parameters
339
X.3.
Integral coeﬃcients
341
Bibliography
345


CHAPTER I
Introduction
I.1. The local Langlands correspondence
The local Langlands correspondence aims at a description of the irreducible smooth representa-
tions π of G(E), for a reductive group G over a local ﬁeld E. Until further notice, we will simplify
our life by assuming that G is split; the main text treats the case of general reductive G, requiring
only minor changes.
The case where E is archimedean, i.e. E = R or E = C, is the subject of Langlands’ classical
work [Lan89]. Based on the work of Harish-Chandra, cf. e.g. [HC66], Langlands associates to
each π an L-parameter, that is a continuous homomorphism
ϕπ : WE →bG(C)
where WE is the Weil group of E = R, C (given by WC = C× resp. a nonsplit extension 1 →WC →
WR →Gal(C/R) →1), and bG is the Langlands dual group. This is the split reductive group over
Z whose root datum is dual to the root datum of G. The map π 7→ϕπ has ﬁnite ﬁbres, and a lot of
work has been done on making the ﬁbres, the so-called L-packets, explicit. If G = GLn, the map
π 7→ϕπ is essentially a bijection.
Throughout this paper, we assume that E is nonarchimedean, of residue characteristic p > 0,
with residue ﬁeld Fq.
Langlands has conjectured that one can still naturally associate an L-
parameter
ϕπ : WE →bG(C)
to any irreducible smooth representation π of G(E).
In the nonarchimedean case, WE is the
dense subgroup of the absolute Galois group Gal(E|E), given by the preimage of Z ⊂Gal(Fq|Fq)
generated by the Frobenius x 7→xq. This raises the question where such a parameter should come
from. In particular,
(1) How does the Weil group WE relate to the representation theory of G(E)?
(2) How does the Langlands dual group bG arise?
The goal of this paper is to give a natural construction of a parameter ϕπ (only depending on
a choice of isomorphism C ∼= Qℓ), and in the process answer questions (1) and (2).
7

8
I. INTRODUCTION
I.2. The big picture
In algebraic geometry, to any ring A corresponds a space Spec A. The starting point of our
investigations is a careful reﬂection on the space Spec E associated with E.1 Note that the group
G(E) is the automorphism group of the trivial G-torsor over Spec E, while the Weil group of E is
essentially the absolute Galois group of E, that is the (´etale) fundamental group of Spec E. Thus,
G(E) relates to coherent information (especially G-torsors) on Spec E, while WE relates to ´etale
information on Spec E. Moreover, the perspective of G-torsors is a good one: Namely, for general
groups G there can be nontrivial G-torsors E on Spec E, whose automorphism groups are then
the so-called pure inner forms of Vogan [Vog93]. Vogan realized that from the perspective of the
local Langlands correspondence, and in particular the parametrization of the ﬁbres of π 7→ϕπ, it
is proﬁtable to consider all pure inner forms together; in particular, he was able to formulate a
precise form of the local Langlands conjecture (taking into account the ﬁbres of π 7→ϕπ) for pure
inner forms of (quasi)split groups. All pure inner forms together arise by looking at the groupoid
of all G-bundles on Spec E: This is given by
[∗/G](Spec E) =
G
[α]∈H1
´et(Spec E,G)
[∗/Gα(E)],
where H1
´et(Spec E, G) is the set of G-torsors on Spec E up to isomorphism, and Gα the corresponding
pure inner form of G. Also, we already note that representations of G(E) are equivalent to sheaves
on [∗/G(E)] (this is a tautology if G(E) were a discrete group; in the present context of smooth
representations, it is also true for the correct notion of “sheaf”), and hence sheaves on
[∗/G](Spec E) =
G
[α]∈H1
´et(Spec E,G)
[∗/Gα(E)],
are equivalent to tuples (πα)[α] of representations of Gα(E).2
Looking at the ´etale side of the correspondence, we observe that the local Langlands correspon-
dence makes the Weil group WE of E appear, not its absolute Galois group Gal(E|E). Recall that
WE ⊂Gal(E|E) is the dense subgroup given as the preimage of the inclusion Z ⊂Gal(Fq|Fq) ∼= bZ,
where Gal(Fq|Fq) is generated by its Frobenius morphism x 7→xq. On the level of geometry, this
change corresponds to replacing a scheme X over Fq with the (formal) quotient XFq/Frob.
In the function ﬁeld case E = Fq((t)), we are thus led to replace Spec E by Spec ˘E/ϕZ where
˘E = Fq((t)). We can actually proceed similarly in general, taking ˘E to be the completion of the
maximal unramiﬁed extension of E. For a natural deﬁnition of π1, one then has π1(Spec( ˘E)/ϕZ) =
WE — for example, Spec ˘E →Spec( ˘E)/ϕZ is a WE-torsor, where ˘E is a separable closure.
Let us analyze what this replacement entails on the other side of the correspondence: Looking
at the coherent theory of Spec ˘E/ϕZ, one is led to study ˘E-vector spaces V equipped with ϕ-linear
automorphisms σ. This is known as the category of isocrystals IsocE. The category of isocrystals
is much richer than the category of E-vector spaces, which it contains fully faithfully. Namely, by
1Needless to say, the following presentation bears no relation to the historical developments of the ideas, which
as usual followed a far more circuitous route. We will discuss some of our original motivation in Section I.11 below.
2The point of replacing [∗/G(E)] by [∗/G](Spec E) was also stressed by Bernstein.

I.2. THE BIG PICTURE
9
the Dieudonn´e–Manin classiﬁcation, the category IsocE is semisimple, with one simple object Vλ
for each rational number λ ∈Q. The endomorphism algebra of Vλ is given by the central simple
E-algebra Dλ of Brauer invariant λ ∈Q/Z. Thus, there is an equivalence of categories
IsocE ∼=
M
λ∈Q
VectDλ ⊗Vλ.
Here, if one writes λ = s
r with coprime integers s, r, r > 0, then Vλ ∼= ˘Er is of rank r with σ given
by the matrix







0
1
0
. . .
0
1
0
...
...
...
0
0
1
πs
0
0







where π ∈E is a uniformizer.
Above, we were considering G-torsors on Spec E, thus we should now look at G-torsors in IsocE.
These are known as G-isocrystals and have been extensively studied by Kottwitz [Kot85], [Kot97].
Their study has originally been motivated by the relation of isocrystals to p-divisible groups and ac-
cordingly a relation of G-isocrystals to the special ﬁbre of Shimura varieties (parametrizing abelian
varieties with G-structure, and thus p-divisible groups with G-structure). Traditionally, the set
of G-isocrystals is denoted B(E, G), and for b ∈B(E, G) we write Eb for the corresponding G-
isocrystal. In particular, Kottwitz has isolated the class of basic G-isocrystals; for G = GLn, a
G-isocrystal is just a rank n isocrystal, and it is basic precisely when it has only one slope λ. There
is an injection H1
´et(Spec E, G) ,→B(E, G) as any G-torsor on Spec E “pulls back” to a G-torsor in
IsocE; the image lands in B(E, G)basic. For any b ∈B(E, G)basic, the automorphism group of Eb is
an inner form Gb of G; the set of such inner forms of G is known as the extended pure inner forms
of G. Note that for G = GLn, there are no nontrivial pure inner forms of G, but all inner forms
of G are extended pure inner forms, precisely by the occurence of all central simple E-algebras
as Hλ for some slope λ. More generally, if the center of G is connected, then all inner forms of
G can be realized as extended pure inner forms. Kaletha, [Kal14], has extended Vogan’s results
on pure inner forms to extended pure inner forms, giving a precise form of the local Langlands
correspondence (describing the ﬁbres of π 7→ϕπ) for all extended pure inner forms and thereby
showing that G-isocrystals are proﬁtable from a purely representation-theoretic point of view. We
will actually argue below that it is best to include Gb for all b ∈B(E, G), not only the basic b; the
resulting automorphism groups Gb are then inner forms of Levi subgroups of G. Thus, we are led
to consider the groupoid of G-torsors in IsocE,
G-Isoc ∼=
G
[b]∈B(E,G)
[∗/Gb(E)].
Sheaves on this are then tuples of representations (πb)[b]∈B(E,G) of Gb(E). The local Langlands
conjecture, including its expected functorial behaviour with respect to passage to inner forms and
Levi subgroups, then still predicts that for any irreducible sheaf F — necessarily given by an
irreducible representation πb of Gb(E) for some b ∈B(E, G) — one can associate an L-parameter
ϕF : WE →bG(C).

10
I. INTRODUCTION
To go further, we need to bring geometry into the picture: Indeed, it will be via geometry that
(sheaves on the groupoid of) G-torsors on Spec ˘E/ϕZ will be related to the fundamental group WE
of Spec ˘E/ϕZ. The key idea is to study a moduli stack of G-torsors on Spec ˘E/ϕZ.
There are several ways to try to deﬁne such a moduli stack.
The most naive may be the
following. The category IsocE is an E-linear category. We may thus, for any E-algebra A, consider
G-torsors in IsocE ⊗E A. The resulting moduli stack will then actually be
G
b∈B(E,G)
[∗/Gb],
an Artin stack over E, given by a disjoint union of classifying stacks for the algebraic groups
Gb. This perspective is actually instrumental in deﬁning the Gb as algebraic groups. However, it
is not helpful for the goal of further geometrizing the situation. Namely, sheaves on [∗/Gb] are
representations of the algebraic group Gb, while we are interested in representations of the locally
proﬁnite group Gb(E).
A better perspective is to treat the choice of Fq as auxiliary, and replace it by a general Fq-
algebra R. In the equal characteristic case, we can then replace ˘E = Fq((t)) with R((t)). This carries
a Frobenius ϕ = ϕR acting on R. To pass to the quotient Spec R((t))/ϕZ, we need to assume that
the Frobenius of R is an automorphism, i.e. that R is perfect. (The restriction to perfect R will
become even more critical in the mixed characteristic case. For the purpose of considering ℓ-adic
sheaves, the passage to perfect rings is inconsequential, as ´etale sheaves on a scheme X and on its
perfection are naturally equivalent.) We are thus led to the moduli stack on perfect Fq-algebras
G-Isoc : {perfect Fq-algebras} →{groupoids} : R 7→{G-torsors on Spec R((t))/ϕZ}.
These are also known as families of G-isocrystals over the perfect scheme Spec R. (Note the curly
I in G-Isoc, to distinguish it from the groupoid G-Isoc.)
This deﬁnition can be extended to the case of mixed characteristic. Indeed, if R is a perfect
Fq-algebra, the analogue of R[[t]] is the unique π-adically complete ﬂat OE-algebra eR with eR/π = R;
explicitly, eR = WOE(R) = W(R) ⊗W(Fq) OE in terms of the p-typical Witt vectors W(R) or the
ramiﬁed Witt vectors WOE(R). Thus, if E is of mixed characteristic, we deﬁne
G-Isoc : {perfect Fq-algebras} →{groupoids} : R 7→{G-torsors on Spec(WOE(R)[ 1
π])/ϕZ}.
We will not use the stack G-Isoc in this paper. However, it has been highlighted recently among
others implicitly by Genestier–V. Laﬀorgue, [GL17], and explicitly by Gaitsgory, [Gai16, Section
4.2], and Zhu, [Zhu20], and one can hope that the results of this paper have a parallel expression in
terms of G-Isoc, so let us analyze it further in this introduction. It is often deﬁned in the following
slightly diﬀerent form. Namely, v-locally on R, any G-torsor over R((t)) resp. WOE(R)[ 1
π] is trivial
by a recent result of Ansch¨utz [Ans18]. Choosing such a trivialization, a family of G-isocrystals is
given by some element of LG(R), where we deﬁne the loop group
LG(R) = G(R((t))) (resp. LG(R) = G(WOE(R)[ 1
π])).
Changing the trivialization of the G-torsor amounts to σ-conjugation on LG, so as v-stacks
G-Isoc = LG/Ad,σLG
is the quotient of LG under σ-conjugation by LG.

I.2. THE BIG PICTURE
11
The stack G-Isoc can be analyzed. More precisely, we have the following result.3
Theorem I.2.1. The prestack G-Isoc is a stack for the v-topology on perfect Fq-algebras. It
admits a stratiﬁcation into locally closed substacks
G-Isocb ⊂G-Isoc
for b ∈B(E, G), consisting of the locus where at each geometric point, the G-isocrystal is isomorphic
to Eb. Moreover, each stratum
G-Isocb ∼= [∗/Gb(E)]
is a classifying stack for the locally proﬁnite group Gb(E).
The loop group LG is an ind-(inﬁnite dimensional perfect scheme), so the presentation
G-Isoc = LG/Ad,σLG
is of extremely inﬁnite nature. We expect that this is not an issue with the presentation, but
that the stack itself has no good ﬁniteness properties; in particular note that all strata appear
to be of the same dimension 0, while admitting nontrivial specialization relations. Xiao–Zhu (see
[XZ17], [Zhu20]) have nonetheless been able to deﬁne a category D(G-Isoc, Qℓ) of ℓ-adic sheaves
on G-Isoc, admitting a semi-orthogonal decomposition into the various D(G-Isocb, Qℓ).
Each
D(G-Isocb, Qℓ) ∼= D([∗/Gb(E)], Qℓ) is equivalent to the derived category of the category of smooth
representations of Gb(E) (on Qℓ-vector spaces). Here, as usual, we have to ﬁx an auxiliary prime
ℓ̸= p and an isomorphism C ∼= Qℓ.
At this point we have deﬁned a stack G-Isoc, with a closed immersion
i : [∗/G(E)] ∼= G-Isoc1 ⊂G-Isoc,
thus realizing a fully faithful embedding
i∗: D(G(E), Qℓ) ,→D(G-Isoc, Qℓ)
of the derived category of smooth representations of G(E) into the derived category of Qℓ-sheaves
on G-Isoc. It is in this way that we “geometrize the representation theory of G(E)”.
The key additional structure that we need are the Hecke operators: These will simultaneously
make the Weil group WE (i.e. π1(Spec ˘E/ϕZ)) and, by a careful study, also the Langlands dual
group bG appear. Recall that Hecke operators are related to modiﬁcations of G-torsors, and are
parametrized by a point x of the curve where the modiﬁcation happens, and the type of the
modiﬁcation at x (which can be combinatorially encoded in terms of a cocharacter of G — this
eventually leads to the appearance of bG). Often, the eﬀect of Hecke operators is locally constant
for varying x. In that case, letting x vary amounts to an action of π1(X), where X is the relevant
curve; thus, the curve should now be Spec ˘E/ϕZ.
Thus, if we want to deﬁne Hecke operators, we need to be able to consider modiﬁcations of
G-isocrystals. These modiﬁcations ought to happen at a section of Spec R((t)) →Spec R (resp. a
non-existent map Spec(W(R) ⊗W(Fq) E) →Spec R).
Unfortunately, the map R →R((t)) does
3This result seems to be well-known to experts, but we are not aware of a full reference. For the v-descent (even
arc-descent), see [Iva20, Lemma 5.9]. The stratiﬁcation is essentially constructed in [RR96]; the local constancy of
the Kottwitz map is proved in general in Corollary III.2.8. The identiﬁcation of the strata in some cases is in [CS17,
Proposition 4.3.13], and an argument in general will appear in upcoming work of Hamacher–Kim.

12
I. INTRODUCTION
not admit any sections. In fact, we would certainly want to consider continuous sections; such
continuous sections would then be in bijection with maps Fq((t)) = ˘E →R. In other words, in
agreement with the motivation from the previous paragraph, the relevant curve should be Spec ˘E,
or really Spec ˘E modulo Frobenius — so we can naturally hope to get actions of π1(Spec ˘E/ϕZ) by
the above recipe.
However, in order for this picture to be realized we need to be in a situation where we have
continuous maps Fq((t)) →R. In other words, we can only hope for sections if we put ourselves
into a setting where R is itself some kind of Banach ring.
This ﬁnally brings us to the setting considered in this paper. Namely, we replace the category
of perfect Fq-schemes with the category of perfectoid spaces Perf = PerfFq over Fq. Locally any
S ∈Perf is of the form S = Spa(R, R+) where R is a perfectoid Tate Fq-algebra: This means
that R is a perfect topological algebra that admits a topologically nilpotent unit ϖ ∈R (called a
pseudouniformizer) making it a Banach algebra over Fq((ϖ)). Moreover, R+ ⊂R is an open and
integrally closed subring of powerbounded elements. Often R+ = R◦is the subring of powerbounded
elements, and we consequently use the abbreviation Spa R = Spa(R, R◦). The geometric (rank 1)
points of S are given by Spa C for complete algebraically closed nonarchimedean ﬁelds C, and as
usual understanding geometric points is a key ﬁrst step. We refer to [SW20] for an introduction
to adic and perfectoid spaces.
For any S = Spa(R, R+), we need to deﬁne the analogue of Spec R((t))/ϕZ, taking the topology
of R into account. Note that for discrete R′, we have
Spa R′((t)) = Spa R′ ×Spa Fq Spa Fq((t)),
and we are always free to replace Spec R′((t))/ϕZ by Spa R′((t))/ϕZ as they have the same category
of vector bundles. This suggests that the analogue of Spec R′((t)) is
Spa(R, R+) ×Spa Fq Spa Fq((t)) = D∗
Spa(R,R+),
a punctured open unit disc over Spa(R, R+), with coordinate t. Note that
Spa(R, R+) ×Spa Fq Spa Fq((t)) ⊂Spa R+ ×Spa Fq Spa Fq[[t]] = Spa R+[[t]]
is the locus where t and ϖ ∈R+ are invertible, where ϖ is a topologically nilpotent unit of R. The
latter deﬁnition can be extended to mixed characteristic: We let
Spa(R, R+) ˙×Spa Fq Spa E ⊂Spa R+ ˙×Spa Fq Spa OE := Spa WOE(R+)
be the open subset where π and [ϖ] ∈WOE(R+) are invertible. This space is independent of the
choice of ϖ as for any other such ϖ′, one has ϖ|ϖ′n and ϖ′|ϖn for some n ≥1, and then the
same happens for their Teichm¨uller representatives. We note that the symbol ˙× is purely symbolic:
There is of course no map of adic spaces Spa E →Spa Fq along which a ﬁbre product could be
taken.
Definition I.2.2. The Fargues–Fontaine curve (for the local ﬁeld E, over S = Spa(R, R+) ∈
Perf) is the adic space over E deﬁned by
XS = XS,E =
 Spa(R, R+) ×Spa Fq Spa Fq((t))

/ϕZ,
respectively
XS = XS,E =
 Spa(R, R+) ˙×Spa Fq Spa E

/ϕZ,

I.2. THE BIG PICTURE
13
where the Frobenius ϕ acts on (R, R+).
A novel feature, compared to the discussion of G-isocrystals, is that the action of ϕ is free and
totally discontinuous, so the quotient by ϕ is well-deﬁned in the category of adic spaces. In fact,
on YS = Spa(R, R+) ˙×Spa Fq Spa E ⊂Spa WOE(R+) one can compare the absolute values of π and
[ϖ]. As both are topologically nilpotent units, the ratio
rad = log(|[ϖ]|)/ log(|π|) : |YS| →(0, ∞)
gives a well-deﬁned continuous map. The Frobenius on |YS| multiplies rad by q, proving that the
action is free and totally discontinuous.
We note that in the function ﬁeld case E = Fq((t)), the space
YS = S ×Spa Fq Spa Fq((t)) = D∗
S
is precisely a punctured open unit disc over S. In this picture, the radius function measures the
distance to the origin: Close to the origin, the radius map is close to 0, while close to the boundary
of the open unit disc it is close to ∞. The quotient by ϕ is however not an adic space over S
anymore, as ϕ acts on S. Thus,
XS = YS/ϕZ = D∗
S/ϕZ
is locally an adic space of ﬁnite type over S, but not globally so. This space, for S = Spa C a
geometric point, has been ﬁrst studied by Hartl–Pink [HP04].
If S = Spa C is a geometric point but E is general, this curve (or rather a closely related
schematic version) has been extensively studied by Fargues–Fontaine [FF18], where it was shown
that it plays a central role in p-adic Hodge theory. From the perspective of adic spaces, it has
been studied by Kedlaya–Liu [KL15]. In particular, in this case where S is a point, XS is indeed
a curve: It is a strongly noetherian adic space whose connected aﬃnoid subsets are spectra of
principal ideal domains. In particular, in this situation there is a well-behaved notion of “classical
points”, referring to those points that locally correspond to maximal ideals. These can be classiﬁed.
In the equal characteristic case, the description of
YS = D∗
S = S ×Spa Fq Spa Fq((t))
shows that the closed points are in bijection with maps S →Spa Fq((t)) up to Frobenius; where now
one has to take the quotient under t 7→tq. In mixed characteristic, the situation is more subtle,
and brings us to the tilting construction for perfectoid spaces.
Proposition I.2.3. If E is of mixed characteristic and S = Spa C is a geometric point, the
classical points of XC are in bijection with untilts C♯|E of C, up to the action of Frobenius.
Here, we recall that for any complete algebraically closed ﬁeld C′|E, or more generally any
perfectoid Tate ring R, one can form the tilt
R♭= lim
←−
x7→xp
R,
where the addition is deﬁned on the ring of integral elements in terms of the bijection R♭+ =
lim
←−x7→xp R+ ∼= lim
←−x7→xp R+/π, where now x 7→xp is compatible with addition on R+/π. Then R♭
is a perfectoid Tate algebra of characteristic p. Geometrically, sending Spa(R, R+) to Spa(R♭, R♭+)

14
I. INTRODUCTION
deﬁnes a tilting functor on perfectoid spaces T 7→T ♭, preserving the underlying topological space
and the ´etale site, cf. [SW20].
One sees that the classical points of XS, for S = Spa C a geometric point, are in bijection with
untilts S♯of S together with a map S →Spa E, modulo the action of Frobenius. Recall from
[SW20] that for any adic space Z over W(Fq), one deﬁnes a functor
Z♦: Perf →Sets : S 7→{S♯, f : S♯→Z}
sending a perfectoid space S over Fq to pairs S♯of an untilt of S, and a map S♯→Z. If Z is an
analytic adic space, then Z♦is a diamond, that is a quotient of a perfectoid space by a pro-´etale
equivalence relation. Then the classical points of XS are in bijection with the S-valued points of
the diamond
(Spa ˘E)♦/ϕZ.
More generally, for any S ∈Perf, maps S →(Spa ˘E)♦/ϕZ are in bijection with degree 1 Cartier
divisors DS ⊂XS, so we deﬁne
Div1 = (Spa ˘E)♦/ϕZ.
We warn the reader the action of the Frobenius here is a geometric Frobenius. In particular, it
only exists on (Spa ˘E)♦, not on Spa ˘E, in case E is of mixed characteristic. However, one still has
π1(Div1) = WE.
This ends our long stream of thoughts on the geometry of Spec E: We have arrived at the
Fargues–Fontaine curve, in its various incarnations. To orient the reader, we recall them here:
(i) For any complete algebraically closed nonarchimedean ﬁeld C|Fq, the curve XC = XC,E, a
strongly noetherian adic space over E, locally the adic spectrum of a principal ideal domain. One
can also construct a schematic version Xalg
C , with the same classical points and the same category
of vector bundles. The classical points are in bijection with untilts C♯|E of C, up to Frobenius.
(ii) More generally, for any perfectoid space S ∈Perf, the “family of curves” XS, again an adic
space over E, but no longer strongly noetherian. If S is aﬃnoid, there is a schematic version Xalg
S ,
with the same category of vector bundles.
(iii) The “mirror curve” Div1 = (Spa ˘E)♦/ϕZ, which is only a diamond. For any S ∈Perf, this
parametrizes “degree 1 Cartier divisors on XS”.
A peculiar phenomenon here is that there is no “absolute curve” of which all the others are
the base change. Another peculiar feature is that the space of degree 1 Cartier divisors is not the
curve itself.
Again, it is time to study G-torsors. This leads to the following deﬁnition.
Definition I.2.4. Let
BunG : Perf →{groupoids} : S 7→{G-torsors on XS}
be the moduli stack of G-torsors on the Fargues–Fontaine curve.
Remark I.2.5. Let us stress here that while “the Fargues–Fontaine curve” is not really a well-
deﬁned notion, “the moduli stack of G-torsors on the Fargues–Fontaine curve” is.

I.2. THE BIG PICTURE
15
As XS maps towards Spa ˘E/ϕZ, there is a natural pullback functor G-Isoc →BunG(S). The
following result is in most cases due to Fargues [Far18b], completed by Ansch¨utz, [Ans19].
Theorem I.2.6. If S = Spa C is a geometric point, the map
B(G) →BunG(S)/ ∼=
is a bijection. In particular, any vector bundle on XS is a direct sum of vector bundles OXS(λ)
associated to D−λ, λ ∈Q.
Under this bijection, b ∈B(G) is basic if and only if the corresponding G-torsor Eb on XS is
semistable in the sense of Atiyah–Bott [AB83].
However, it is no longer true that the automorphism groups are the same. On the level of the
stack, we have the following result.
Theorem I.2.7. The prestack BunG is a v-stack. It admits a stratiﬁcation into locally closed
substacks
ib : Bunb
G ⊂BunG
for b ∈B(G) consisting of the locus where at each geometric point, the G-torsor is isomorphic to
Eb. Moreover, each stratum
Bunb
G ∼= [∗/ eGb]
is a classifying space for a group eGb that is an extension of the locally proﬁnite group Gb(E) by a
“unipotent group diamond”.
The semistable locus Bunss
G ⊂BunG is an open substack, and
Bunss
G =
G
b∈B(G)basic
[∗/Gb(E)].
Remark I.2.8. The theorem looks formally extremely similar to Theorem I.2.1.
However,
there is a critical diﬀerence, namely the closure relations are reversed: For BunG, the inclusion of
Bunb
G for b ∈B(G) basic is an open immersion while it was a closed immersion in Theorem I.2.1.
Note that basic b ∈B(G) correspond to semistable G-bundles, and one would indeed expect the
semistable locus to be an open substack. Generally, BunG behaves much like the stack of G-bundles
on the projective line.
Remark I.2.9. We deﬁne a notion of Artin stacks in this perfectoid setting, and indeed BunG
is an Artin stack; we refer to Section I.4 for a more detailed description of our geometric results
on BunG. This shows that BunG has much better ﬁniteness properties than G-Isoc, even if it is
deﬁned on more exotic test objects.
We can deﬁne a derived category of ℓ-adic sheaves
D(BunG, Qℓ)
on BunG. This admits a semi-orthogonal decomposition into all D(Bunb
G, Qℓ), and
D(Bunb
G, Qℓ) ∼= D([∗/Gb(E)], Qℓ) ∼= D(Gb(E), Qℓ)
is equivalent to the derived category of smooth Gb(E)-representations.

16
I. INTRODUCTION
Remark I.2.10. It is reasonable to expect that this category is equivalent to the category
D(G-Isoc, Qℓ) deﬁned by Xiao–Zhu. However, we do not pursue this comparison here.
Finally, we can deﬁne the Hecke stack that will bring all key players together. Consider the
global Hecke stack HckG parametrizing pairs (E, E′) of G-bundles on XS, together with a map
S →Div1 giving rise to a degree 1 Cartier divisor DS ⊂XS, and an isomorphism
f : E|XS\DS ∼= E′|XS\DS
that is meromorphic along DS. This gives a correspondence
BunG
h1
←−HckG
h2
−→BunG ×Div1.
To deﬁne the Hecke operators, we need to bound the modiﬁcation, i.e. bound the poles of f along
DS. This is described by the local Hecke stack HckG, parametrizing pairs of G-torsors on the
completion of XS along DS, together with an isomorphism away from DS; thus, there is a natural
map HckG →HckG from the global to the local Hecke stack.
Geometrically, HckG admits a
Schubert stratiﬁcation in terms of the conjugacy classes of cocharacters of G; in particular, there
are closed Schubert cells HckG,≤µ for each conjugacy class µ : Gm →G. By pullback, this deﬁnes
a correspondence
BunG
h1,≤µ
←−−−HckG,≤µ
h2,≤µ
−−−→BunG ×Div1
where now h1,≤µ and h2,≤µ are proper. One can then consider Hecke operators
Rh2,≤µ,∗h∗
1,≤µ : D(BunG, Λ) →D(BunG ×Div1, Λ).
The following theorem ensures that Hecke operators are necessarily locally constant as one
varies the point of Div1, and hence give rise to representations of π1(Div1) = WE. In the following,
we are somewhat cavalier about the precise deﬁnition of D(−, Qℓ) employed, and the notion of
WE-equivariant objects: The ﬁne print is addressed in the main text.
Theorem I.2.11. Pullback along the map Div1 →[∗/WE] induces an equivalence
D(BunG ×Div1, Qℓ) ∼= D(BunG ×[∗/WE], Qℓ) ∼= D(BunG, Qℓ)BWE.
Thus, Hecke operators produce WE-equivariant objects in D(BunG, Qℓ), making the Weil group
appear naturally.
One also wants to understand how Hecke operators compose. This naturally leads to the study
of D(HckG, Qℓ) as a monoidal category, under convolution. Here, we have the geometric Satake
equivalence. In the setting of usual smooth projective curves (over C), this was established in
the papers of Lusztig [Lus83], Ginzburg [Gin90] and Mirkovi´c–Vilonen [MV07]. The theorem
below is a ﬁrst approximation; we will actually prove a more precise version with Zℓ-coeﬃcients,
describing all perverse sheaves on HckG, and applying to the Beilinson–Drinfeld Grassmannians in
the spirit of Gaitsgory’s paper [Gai07].
Theorem I.2.12. There is a natural monoidal functor from Rep bG to D(HckG, Qℓ).
Remark I.2.13. Our proof of Theorem I.2.12 follows the strategy of Mirkovi´c–Vilonen’s proof,
and in particular deﬁnes a natural symmetric monoidal structure on the category of perverse sheaves
by using the fusion product. This requires one to work over several copies of the base curve, and

I.2. THE BIG PICTURE
17
let the points collide. It is a priori very surprising that this can be done in mixed characteristic,
as it requires a space like Spa Qp ˙×Spa Fp Spa Qp. Spaces of this type do however exist as diamonds,
and this was one of the main innovations of [SW20].
Remark I.2.14. Using a degeneration of the local Hecke stack, which is essentially the B+
dR-
aﬃne Grassmannian of [SW20], to the Witt vector aﬃne Grassmannian, Theorem I.2.12 gives a
new proof of Zhu’s geometric Satake equivalence for the Witt vector aﬃne Grassmannian [Zhu17].
In fact, we even prove a version with Zℓ-coeﬃcients, thus also recovering the result of Yu [Yu19].
Remark I.2.15. Regarding the formalism of ℓ-adic sheaves, we warn the reader that we are
cheating slightly in the formulation of Theorem I.2.12; the deﬁnition of D(BunG, Qℓ) implicit above
is not the same as the one implicit in Theorem I.2.12. With torsion coeﬃcients, the problem would
disappear, and in any case the problems are essentially of technical nature.
Thus, this also makes the Langlands dual group bG appear naturally. For any representation V
of bG, we get a Hecke operator
TV : D(BunG, Qℓ) →D(BunG, Qℓ)BWE.
Moreover, the Hecke operators commute and
TV ⊗W ∼= TV ◦TW |∆(WE)
where we note that TV ◦TW naturally takes values in WE × WE-equivariant objects; the restriction
on the right means the restriction to the action of the diagonal copy ∆(WE) ⊂WE × WE.
At this point, the representation theory of G(E) (which sits fully faithfully in D(BunG, Qℓ)), the
Weil group WE, and the dual group bG, all interact with each other naturally. It turns out that this
categorical structure is precisely what is needed to construct L-parameters for (Schur-)irreducible
objects A ∈D(BunG, Qℓ), and in particular for irreducible smooth representations of G(E). We
will discuss the construction of L-parameters below in Section I.9.
We note that the whole situation is exactly parallel to the Betti geometric Langlands situa-
tion considered by Nadler–Yun [NY19], and indeed the whole strategy can be described as “the
geometric Langlands program on the Fargues–Fontaine curve”. It is curious that our quest was
to understand the local Langlands correspondence in an arithmetic setting, for potentially very
ramiﬁed representations, and eventually we solved it by relating it to the global Langlands corre-
spondence in a geometric setting, in the everywhere unramiﬁed setting.
In the rest of this introduction, we give a more detailed overview of various aspects of this
picture:
(i) The Fargues–Fontaine curve (Section I.3);
(ii) The geometry of the stack BunG (Section I.4);
(iii) The derived category of ℓ-adic sheaves on BunG (Section I.5);
(iv) The geometric Satake equivalence (Section I.6);
(v) Finiteness of the cohomology of Rapoport–Zink spaces, local Shimura varieties, and more gen-
eral moduli spaces of shtukas (Section I.7);
(vi) The stack of L-parameters (Section I.8);
(vii) The construction of L-parameters (Section I.9);

18
I. INTRODUCTION
(viii) The spectral action (Section I.10);
(ix) The origin of the ideas ﬂeshed out in this paper (Section I.11).
These items largely mirror the chapters of this paper, and each chapter begins with a reprise
of these introductions.
I.3. The Fargues–Fontaine curve
The Fargues–Fontaine curve has been studied extensively in the book of Fargues–Fontaine
[FF18] and further results, especially in the relative situation, have been obtained by Kedlaya–Liu
[KL15]. In the ﬁrst chapter, we reprove these foundational results, thereby also collecting and
unifying certain results (proved often only for E = Qp).
The ﬁrst results concern the Fargues–Fontaine curve XC = XS when S = Spa C for some
complete algebraically closed nonarchimedean ﬁeld C|Fq. We deﬁne a notion of classical points of
XC in that case; they form a subset of |XC|. The basic ﬁniteness properties of XC are summarized
in the following result.
Theorem I.3.1. The adic space XC is locally the adic spectrum Spa(B, B+) where B is a
principal ideal domain; the classical points of Spa(B, B+) ⊂XC are in bijection with the maximal
ideals of B. For each classical point x ∈XC, the residue ﬁeld of x is an untilt C♯of C over E,
and this induces a bijection of the classical points of XC with untilts C♯of C over E, taken up to
the action of Frobenius.
In the equal characteristic case, Theorem I.3.1 is an immediate consequence of the presentation
XC = D∗
C/ϕZ and classical results in rigid-analytic geometry. In the p-adic case, we use tilting
to reduce to the equal characteristic case. At one key turn, in order to understand Zariski closed
subsets of XC, we use the result that Zariski closed implies strongly Zariski closed [BS19]. Using
these ideas, we are able to give an essentially computation-free proof.
A key result is the classiﬁcation of vector bundles.
Theorem I.3.2. The functor from IsocE to vector bundles on XC induces a bijection on iso-
morphism classes. In particular, there is a unique stable vector bundle OXC(λ) of any slope λ ∈Q,
and any vector bundle E can be written as a direct sum of stable bundles.
We give a new self-contained proof of Theorem I.3.2, making critical use of the v-descent results
for vector bundles obtained in [Sch17a] and [SW20], and basic results on the geometry of Banach–
Colmez spaces established here. The proof in the equal characteristic case by Hartl–Pink [HP04]
and the proof of Kedlaya in the p-adic case [Ked04] relied on heavy computations, while the proof
of Fargues–Fontaine [FF18] relied on the description of the Lubin–Tate and Drinfeld moduli spaces
of π-divisible O-modules. Our proof is related to the arguments of Colmez in [Col02].
Allowing general S ∈PerfFq, we deﬁne the moduli space of degree 1 Cartier divisors as Div1 =
Spd ˘E/ϕZ. Given a map S →Div1, one can deﬁne an associated closed Cartier divisor DS ⊂XS;
locally, this is given by an untilt DS = S♯⊂XS of S over E, and this embeds Div1 into the space
of closed Cartier divisors on XS (justifying the name). Another important result is the following
ampleness result, cf. [KL15, Proposition 6.2.4], which implies that one can deﬁne an algebraic
version of the curve, admitting the same theory of vector bundles.

I.3. THE FARGUES–FONTAINE CURVE
19
Theorem I.3.3. Assume that S ∈Perf is aﬃnoid. For any vector bundle E on XS, the twist
E(n) is globally generated and has no higher cohomology for all n ≫0. Deﬁning the graded ring
P =
M
n≥0
H0(XS, OXS(n))
and the scheme Xalg
S
= Proj P, there is a natural map of locally ringed spaces XS →Xalg
S , pullback
along which deﬁnes an equivalence of categories of vector bundles, preserving cohomology.
If S = Spa C for some complete algebraically closed nonarchimedean ﬁeld C, then Xalg
C
is a
regular noetherian scheme of Krull dimension 1, locally the spectrum of a principal ideal domain,
and its closed points are in bijection with the classical points of XC.
We also need to understand families of vector bundles, i.e. vector bundles E on XS for general
S. Here, the main result is the following.
Theorem I.3.4. Let S ∈Perf and let E be a vector bundle on XS. Then the function taking a
point s ∈S to the Harder–Narasimhan polygon of E|Xs deﬁnes a semicontinuous function on S. If
it is constant, then E admits a global Harder–Narasimhan stratiﬁcation, and pro-´etale locally on S
one can ﬁnd an isomorphism with a direct sum of OXS(λ)’s.
In particular, if E is everywhere semistable of slope 0, then E is pro-´etale locally trivial, and the
category of such E is equivalent to the category of pro-´etale E-local systems on S.
The key to proving Theorem I.3.4 is the construction of certain global sections of E. To achieve
this, we use v-descent techniques, and an analysis of the spaces of global sections of E; these are
known as Banach–Colmez spaces, and were ﬁrst introduced (in slightly diﬀerent terms) in [Col02].
Definition I.3.5. Let E be a vector bundle on XS. The Banach–Colmez space BC(E) associated
with E is the locally spatial diamond over S whose T-valued points, for T ∈PerfS, are given by
BC(E)(T) = H0(XT , E|XT ).
Similarly, if E is everywhere of only negative Harder–Narasimhan slopes, the negative Banach–
Colmez space BC(E[1]) is the locally spatial diamond over S whose T-valued points are
BC(E[1])(T) = H1(XT , E|XT ).
Implicit here is that this functor actually deﬁnes a locally spatial diamond. For this, we calculate
some key examples of Banach–Colmez spaces. For example, if E = OXS(λ) with 0 < λ ≤[E : Qp]
(resp. all positive λ if E is of equal characteristic), then BC(E) is representable by a perfectoid open
unit disc (of dimension given by the numerator of λ). A special case of this is the identiﬁcation
of BC(OXS(1)) with the universal cover of a Lubin–Tate formal group law, yielding a very close
relation between Lubin–Tate theory, and thus local class ﬁeld theory, and the Fargues–Fontaine
curve; see also [Far18a]. On the other hand, for larger λ, or negative λ, Banach–Colmez spaces
are more exotic objects; for example, the negative Banach–Colmez space
BC(OXC(−1)[1]) ∼= (A1
C♯)♦/E

20
I. INTRODUCTION
is the quotient of the aﬃne line by the translation action of E ⊂A1
C♯.
We remark that our
proof of the classiﬁcation theorem, Theorem I.3.2, ultimately relies on the negative result that
BC(OXC(−1)[1]) is not representable by a perfectoid space!4
For the proof of Theorem I.3.4, a key result is that projectivized Banach–Colmez spaces
(BC(E) \ {0})/E×
are proper — they are the relevant analogues of “families of projective spaces over S”. In particular,
their image in S is a closed subset, and if the image is all of S, then we can ﬁnd a nowhere vanishing
section of E after a v-cover, as then the projectivized Banach–Colmez space is a v-cover of S. From
here, Theorem I.3.4 follows easily.
I.4. The geometry of BunG
Let us discuss the geometry of BunG. Here, G can be any reductive group over a nonarchimedean
local ﬁeld E, with residue ﬁeld Fq of characteristic p. Recall that Kottwitz’ set B(G) = B(E, G) of
G-isocrystals can be described combinatorially, by two discrete invariants. The ﬁrst is the Newton
point
ν : B(G) →(X∗(T)+
Q)Γ,
where T is the universal Cartan of G and Γ = Gal(E|E). More precisely, any G-isocrystal E deﬁnes
a slope morphism D →G ˘E where D is the diagonalizable group with cocharacter group Q; its
deﬁnition reduces to the case of GLn, where it amounts to the slope decomposition of isocrystals.
Isomorphisms of G-isocrystals lead to conjugate slope morphisms, and this deﬁnes the map ν.
The other map is the Kottwitz invariant
κ : B(G) →π1(GE)Γ.
Its deﬁnition is indirect, starting from tori, passing to the case of G with simply connected derived
group, and ﬁnally to the general case by z-extensions. Then Kottwitz shows that
(ν, κ) : B(G) →(X∗(T)+
Q)Γ × π1(GE)Γ
is injective.
Moreover, κ induces a bijection between B(G)basic and π1(GE)Γ.
The non-basic
elements can be described in terms of Levi subgroups.
Using ν and κ, one can deﬁne a partial order on B(G) by declaring b ≤b′ if κ(b) = κ(b′) and
νb ≤νb′ with respect to the dominance order.
Up to sign, one can think of ν, resp. κ, as the Harder–Narasimhan polygon, resp. ﬁrst Chern
class, of a G-bundle.
Theorem I.4.1. The prestack BunG satisﬁes the following properties.
(i) The prestack BunG is a stack for the v-topology.
(ii) The points | BunG | are naturally in bijection with Kottwitz’ set B(G) of G-isocrystals.
4Actually, we only know this for sure if E is p-adic; in the function ﬁeld case, we supply a small extra argument
circumventing the issue.

I.4. THE GEOMETRY OF BunG
21
(iii) The map
ν : | BunG | →B(G) →(X∗(T)+
Q)Γ
is semicontinuous, and
κ : | BunG | →B(G) →π1(GE)Γ
is locally constant. Equivalently, the map | BunG | →B(G) is continuous when B(G) is equipped
with the order topology.
(iv) For any b ∈B(G), the corresponding subfunctor
ib : Bunb
G = BunG ×| BunG |{b} ⊂BunG
is locally closed, and isomorphic to [∗/ eGb], where eGb is a v-sheaf of groups such that eGb →∗is
representable in locally spatial diamonds with π0 eGb = Gb(E). The connected component eG◦
b ⊂eGb
of the identity is cohomologically smooth of dimension ⟨2ρ, νb⟩.
(v) In particular, the semistable locus Bunss
G ⊂BunG is open, and given by
Bunss
G ∼=
G
b∈B(G)basic
[∗/Gb(E)].
(vi) For any b ∈B(G), there is a map
πb : Mb →BunG
that is representable in locally spatial diamonds, partially proper and cohomologically smooth, where
Mb parametrizes G-bundles E together with an increasing Q-ﬁltration whose associated graded is,
at all geometric points, isomorphic to Eb with its slope grading. The v-stack Mb is representable in
locally spatial diamonds, partially proper and cohomologically smooth over [∗/Gb(E)].
(vii) The v-stack BunG is a cohomologically smooth Artin stack of dimension 0.
As examples, let us analyze the case of GL1 and GL2. For GL1, and general tori, everything is
semistable, so
Pic := BunGL1 ∼=
G
Z
[∗/E×].
For GL2, the Kottwitz invariant gives a decomposition
BunGL2 =
G
α∈1
2 Z
Bunα
GL2 .
Each connected component has a unique semistable point, given by the basic element b ∈B(GL2)basic
with κ(b) = α. For b ∈B(GL2)basic ∼= 1
2Z, the corresponding group Gb(E) is given by GL2(E)
when b ∈Z, and by D× when b ∈1
2Z \ Z, where D|E is the quaternion algebra.
The non-semistable points of BunGL2 are given by extensions of line bundles, which are of the
form O(i) ⊕O(j) for some i, j ∈Z, with 2α = i + j. Let us understand the simplest degeneration
inside BunGL2, which is from O(1
2) to O ⊕O(1). The individual strata here are
[∗/D×], [∗/Aut(O ⊕O(1))].
Here
Aut(O ⊕O(1)) =

E×
BC(O(1))
0
E×

.

22
I. INTRODUCTION
Here BC(O(1)) is representable by a perfectoid open unit disc Spd Fq[[t1/p∞]].
In this case, the local chart Mb for BunGL2 parametrizes rank 2 bundles E written as an
extension
0 →L →E →L′ →0
such that at all geometric points, L ∼= O and L′ ∼= O(1). Fixing such isomorphisms deﬁnes a
E× × E×-torsor
f
Mb →Mb
with f
Mb = BC(O(−1)[1]) a “negative Banach–Colmez space”. This local chart shows that the
local structure of BunG is closely related to the structure of negative Banach–Colmez spaces. It
also shows that while the geometry of BunG is quite nonstandard, it is still fundamentally a ﬁnite-
dimensional and “smooth” situation.
For general G, we still get a decomposition into connected components
BunG =
G
α∈π1(G)Γ
Bunα
G
and each connected component Bunα
G admits a unique semistable point.
By a recent result of Viehmann [Vie21], the map | BunG | →B(G) is a homeomorphism. This
had previously been proved for G = GLn by Hansen [Han17] based on [BFH+17]; that argument
was extended to some classical groups in unpublished work of Hamann.
Let us say some words about the proof of Theorem I.4.1. Part (i) has essentially been proved
in [SW20], and part (ii) follows from the result of Fargues and Ansch¨utz, Theorem I.2.6. In part
(iii), the statement about ν reduces to GLn by an argument of Rapoport–Richartz [RR96], where
it is Theorem I.3.4. The statement about κ requires more work, at least in the general case: If
the derived group of G is simply connected, one can reduce to tori, which are not hard to handle.
In general, one approach is to use z-extensions eG →G to reduce to the case of simply connected
derived group. For this, one needs that Bun eG →BunG is a surjective map of v-stacks; we prove
this using Beauville–Laszlo uniformization. Alternatively, one can use the abelianized Kottwitz set
of Borovoi [Bor98], which we prove to behave well relatively over a perfectoid space S. Part (iv)
is a also consequence of Theorem I.3.4. Part (v) is a consequence of parts (iii) and (iv). The key
point is then part (vi), which will imply (vii) formally. The properties of Mb itself are easy to
establish — the analysis for GL2 above generalizes easily to show that f
Mb is a successive extension
of negative Banach–Colmez spaces. The key diﬃculty is to prove that
πb : Mb →BunG
is cohomologically smooth. Note that as we are working with perfectoid spaces, there are no tangent
spaces, and we cannot hope to prove smoothness via deformation theory. To attack this problem,
we nonetheless prove a general “Jacobian criterion of cohomological smoothness”. The setup here
is the following.
Let S be a perfectoid space, and let Z →XS be a smooth map of (sousperfectoid) adic spaces;
this means that Z is an adic space that is locally ´etale over a ﬁnite-dimensional ball over XS. In this
situation, we can deﬁne a v-sheaf MZ →S parametrizing sections of Z →XS, i.e. the S′-valued
points, for S′/S a perfectoid space, are given by the maps s : XS′ →Z lifting XS′ →XS. For
each such section, we get the vector bundle s∗TZ/XS on S′, where TZ/XS is the tangent bundle.

I.5. ℓ-ADIC SHEAVES ON BunG
23
Naively, deformations of S′ →MZ, i.e. of XS′ →Z over XS′ →XS, should correspond to global
sections H0(XS′, s∗TZ/XS), and obstructions to H1(XS′, s∗TZ/XS). If s∗TZ/XS has everywhere only
positive Harder–Narasimhan slopes, then this vanishes locally on S′. By analogy with the classical
situation, we would thus expect the open subspace
Msm
Z ⊂MZ,
where s∗TZ/XS has positive Harder–Narasimhan slopes, to be (cohomologically) smooth over S.
Our key geometric result conﬁrms this, at least if Z →XS is quasiprojective.
Theorem I.4.2. Assume that Z →XS can, locally on S, be embedded as a Zariski closed
subset of an open subset of (the adic space) Pn
XS. Then MZ →S is representable in locally spatial
diamonds, compactiﬁable, and of locally ﬁnite dim. trg. Moreover, the open subset Msm
Z ⊂MZ is
cohomologically smooth over S.
In the application, the space Z →XS will be the ﬂag variety parametrizing Q-ﬁltrations on a
given G-torsor E on XS. Then Mb will be an open subset of Msm
Z .
The proof of Theorem I.4.2 requires several innovations. The ﬁrst is a notion of formal smooth-
ness, in which inﬁnitesimal thickenings (that are not available in this perfectoid setting) are replaced
by small ´etale neighborhoods. This leads to a notion with a close relation to the notion of absolute
neighborhood retracts [Bor67] in classical topology. We prove that virtually all examples of coho-
mologically smooth maps are also formally smooth, including Banach–Colmez spaces and BunG. We
also prove that Msm
Z →S is formally smooth, which amounts to some delicate estimates, spreading
sections XT0 →Z into small neighborhoods of T0 ⊂T, for any Zariski closed immersion T0 ⊂T
of aﬃnoid perfectoid spaces — here we crucially use the assumption that all Harder–Narasimhan
slopes are positive. Coupled with the theorem that Zariski closed implies strongly Zariski closed
[BS19] this makes it possible to write Msm
Z , up to (cohomologically and formally) smooth maps,
as a retract of a space that is ´etale over a ball over S. Certainly in classical topology, this is not
enough to ensure cohomological smoothness — a coordinate cross is a retract of R2 — but it does
imply that the constant sheaf Fℓis universally locally acyclic over S. For this reason, and other
applications to sheaves on BunG as well as geometric Satake, we thus also develop a general theory
of universally locally acyclic sheaves in our setting. To ﬁnish the proof, we use a deformation to
the normal cone argument to show that the dualizing complex is “the same” as the one for the
Banach–Colmez space BC(s∗TZ/XS).
I.5. ℓ-adic sheaves on BunG
For our results, we need to deﬁne the category of ℓ-adic sheaves on BunG. More precisely, we
will deﬁne for each Zℓ-algebra Λ a category
D(BunG, Λ)
of sheaves of Λ-modules on BunG. If Λ is killed by some power of ℓ, such a deﬁnition is the main
achievement of [Sch17a]. Our main interest is however the case Λ = Qℓ. In the case of schemes (of
ﬁnite type over an algebraically closed ﬁeld), the passage from torsion coeﬃcients to Qℓ-coeﬃcients
is largely formal: Roughly,
D(X, Qℓ) = Ind(lim
←−
n
Db
c(X, Z/ℓnZ) ⊗ZℓQℓ).

24
I. INTRODUCTION
Behind this deﬁnition are however strong ﬁniteness results for constructible sheaves; in particular,
the morphism spaces between constructible sheaves are ﬁnite. For BunG, or for the category of
smooth representations, there are still compact objects (given by compactly induced representations
in the case of smooth representations), but their endomorphism algebras are Hecke algebras, which
are inﬁnite-dimensional. A deﬁnition along the same lines would then replace all Hecke algebras
by their ℓ-adic completions, which would drastically change the category of representations.
Our deﬁnition of D(BunG, Λ) in general involves some new ideas, employing the idea of solid
modules developed by Clausen–Scholze [CS] in the context of the pro-´etale (or v-)site; in the end,
D(BunG, Λ) is deﬁned as a certain full subcategory
Dlis(BunG, Λ) ⊂D■(BunG, Λ)
of the category D■(BunG, Λ) of solid complexes of Λ-modules on the v-site of BunG. The formalism
of solid sheaves, whose idea is due to Clausen and the second author, is developed in Chapter VII.
It presents some interesting surprises; in particular, there is always a left adjoint f♮to pullback f∗,
satisfying base change and a projection formula. (In return, Rf! fails to exist in general.)
Theorem I.5.1. Let Λ be any Zℓ-algebra.
(i) Via excision triangles, there is an inﬁnite semiorthogonal decomposition of D(BunG, Λ) into the
various D(Bunb
G, Λ) for b ∈B(G).
(ii) For each b ∈B(G), pullback along
Bunb
G ∼= [∗/ eGb] →[∗/Gb(E)]
gives an equivalence
D([∗/Gb(E)], Λ) ∼= D(Bunb
G, Λ),
and D([∗/Gb(E)], Λ) ∼= D(Gb(E), Λ) is equivalent to the derived category of the category of smooth
representations of Gb(E) on Λ-modules.
(iii) The category D(BunG, Λ) is compactly generated, and a complex A ∈D(BunG, Λ) is compact
if and only if for all b ∈B(G), the restriction
ib∗A ∈D(Bunb
G, Λ) ∼= D(Gb(E), Λ)
is compact, and zero for almost all b. Here, compactness in D(Gb(E), Λ) is equivalent to lying in
the thick triangulated subcategory generated by c-IndGb(E)
K
Λ as K runs over open pro-p-subgroups
of Gb(E).
(iv) On the subcategory D(BunG, Λ)ω ⊂D(BunG, Λ) of compact objects, there is a Bernstein–
Zelevinsky duality functor
DBZ : (D(BunG, Λ)ω)op →D(BunG, Λ)ω
with a functorial identiﬁcation
R Hom(A, B) ∼= π♮(DBZ(A) ⊗L
Λ B)
for B ∈D(BunG, Λ), where π : BunG →∗is the projection. The functor DBZ is an equivalence,
and D2
BZ is naturally equivalent to the identity. It is compatible with usual Bernstein–Zelevinsky
duality on D(Gb(E), Λ) for basic b ∈B(G).

I.5. ℓ-ADIC SHEAVES ON BunG
25
(v) An object A ∈D(BunG, Λ) is universally locally acyclic (with respect to BunG →∗) if and only
if for all b ∈B(G), the restriction
ib∗A ∈D(Bunb
G, Λ) ∼= D(Gb(E), Λ)
is admissible, i.e. for all pro-p open subgroups K ⊂Gb(E), the complex (ib∗A)K is perfect. Univer-
sally locally acyclic complexes are preserved by Verdier duality, and satisfy Verdier biduality.
This theorem extends many basic notions from representation theory — ﬁnitely presented
objects, admissible representations, Bernstein–Zelevinsky duality, smooth duality — to the setting
of D(BunG, Λ).
Parts (i) and (ii) are easy when Λ is ℓ-power torsion. In general, their proofs invoke the precise
deﬁnition of D(BunG, Λ) = Dlis(BunG, Λ) and are somewhat subtle. Part (iii) uses that ib∗admits a
left adjoint, which will then automatically preserve compact objects (inducing compact generators).
Using the diagram
[∗/Gb(E)]
qb
←−Mb
πb
−→BunG,
this left adjoint is deﬁned as πb♮q∗
b. The veriﬁcation that this is indeed a left adjoint amounts in
some sense to the assertion that Mb is “strictly local” along the closed subspace [∗/Gb(E)] ⊂Mb
in the sense that for all A ∈D(Mb, Λ), the restriction
RΓ(Mb, A) →RΓ([∗/Gb(E)], A)
is an isomorphism. This builds on a detailed analysis of the topological nature of Mb, in particular
that f
Mb \ ∗is a spatial diamond, and Theorem I.5.2 below. For part (iv), the constructions in (iii)
imply the existence of DBZ(A) on a class of generators, thus in general, and similar arguments to
the ones in (iii) prove the biduality. Finally, part (v) is essentially a formal consequence.
The key cohomological result for the proof is the following result, applied to f
Mb\∗(or quotients
of it). It plays on the subtle point that the point ∗is not quasiseparated.
Theorem I.5.2. Let X be a spatial diamond such that f : X →∗is partially proper, and of
ﬁnite dim. trg. Then for any aﬃnoid perfectoid space S, the base change XS = X × S naturally
admits two ends. Taking compactly supported cohomology with respect to one end (but no support
condition at the other end), one has
RΓ∂-c(XS, A) = 0
for all A ∈D+
■(X, Zℓ) (resp. all A ∈D■(X, Zℓ) if f is ℓ-cohomologically smooth).
As an example, if X = Spa Fq((t)), then XS = D∗
S is an open unit disc over S, whose two ends
are the origin and the boundary, and one has
RΓ∂-c(D∗
S, Zℓ) = 0.
In particular, the cohomology of Spa Fq[[t]] agrees with sections on the closed point, showing that
Spa Fq[[t]] is “strictly local”. The same phenomenon is at work for Mb.

26
I. INTRODUCTION
I.6. The geometric Satake equivalence
In order to deﬁne the Hecke operators, we need to prove the geometric Satake equivalence,
taking representations of the dual group bG to sheaves on the local Hecke stack. In order to analyze
compositions of Hecke operators, it will in fact be necessary to analyze modiﬁcations at several
points.
Thus, for any ﬁnite set I, we consider the moduli space (Div1)I parametrizing degree 1 Cartier
divisors Di ⊂XS, i ∈I. Locally on S, each Di deﬁnes an untilt S♯
i of S over E, and one can form
the completion B+ of OXS along the union of the Di. Inverting the Di deﬁnes a localization B of
B+. One can then deﬁne a positive loop group L+
(Div1)IG and loop group L(Div1)IG, with values
given by G(B+) resp. G(B); for brevity, we will simply write L+G and LG here. One can then
deﬁne the local Hecke stack
HckI
G = [L+G\LG/L+G] →(Div1)I.
For d = |I|, this is in fact already deﬁned over the moduli space Divd = (Div1)d/Σd of degree d
Cartier divisors. We will often break symmetry, and ﬁrst take the quotient on the right to deﬁne
the Beilinson–Drinfeld Grassmannian
GrI
G = LG/L+G →(Div1)I
so that
HckI
G = L+G\ GrI
G .
The Beilinson–Drinfeld Grassmannian GrI
G →(Div1)I is a small v-sheaf that can be written as
an increasing union of closed subsheaves that are proper and representable in spatial diamonds, by
bounding the relative position; this is one main result of [SW20]. On the other hand, L+G can
be written as an inverse limit of truncated positive loop groups, which are representable in locally
spatial diamonds and cohomologically smooth; moreover, on each bounded subset, it acts through
such a ﬁnite-dimensional quotient. This essentially reduces the study of all bounded subsets of
HckI
G to Artin stacks.
In particular, one can write the local Hecke stack as an increasing union of closed substacks
that are quasicompact over (Div1)I, by bounding the relative position. In the following, we assume
that the coeﬃcients Λ are killed by some power of ℓ, so that we can use the theory from [Sch17a].
Let
D´et(HckI
G, Λ)bd ⊂D´et(HckI
G, Λ)
be the full subcategory of all objects with quasicompact support over (Div1)I. This is a monoidal
category under convolution ⋆. Here, we use the convolution diagram
HckI
G ×(Div1)I HckI
G
(p1,p2)
←−−−−L+G\LG ×L+G LG/L+G m
−→HckI
G
and deﬁne
A ⋆B = Rm∗(p∗
1A ⊗L
Λ p∗
2B).
The map m is ind-proper (its ﬁbres are GrI
G), and in particular proper on any bounded subset;
thus, proper base change ensures that this deﬁnes an associative monoidal structure.
On D´et(HckI
G, Λ)bd, one can deﬁne a relative perverse t-structure (where an object is perverse if
and only if it is perverse over any geometric ﬁbre of (Div1)I). For this t-structure, the convolution

I.6. THE GEOMETRIC SATAKE EQUIVALENCE
27
⋆is left t-exact (and t-exactness only fails for issues related to non-ﬂatness over Λ). To prove that
there is a well-deﬁned t-structure, and the preservation of perversity under convolution, we adapt
Braden’s theorems [Bra03] on hyperbolic localization, and a degeneration to the Witt vector aﬃne
Grassmannian [Zhu17], [BS17]. We will discuss hyperbolic localization further below.
We remark that there is no general theory of perverse sheaves in p-adic geometry, the issue be-
ing that it is diﬃcult to unambiguously assign a dimension to a point of an adic space (cf. [Tem21]
for what is known about topological transcendence degrees of points, and the subtleties especially
in characteristic p). In particular, we would not know how to deﬁne a notion of perverse sheaf on
(Div1)I in general, which is the reason we revert to asking perversity only in the ﬁbres. Here, we
use that all geometric ﬁbres of the stack HckI
G →(Div1)I have only countably many points enu-
merated explicitly in terms of dominant cocharacters µi, and one can assign by hand the dimension
P
i⟨2ρ, µi⟩of the corresponding open Schubert cells.
Remark I.6.1. It seems to have been overlooked in the literature that for any map f : X →S
locally of ﬁnite type between schemes, one can deﬁne a relative perverse t-structure, with relative
perversity equivalent to perversity on all geometric ﬁbres. It is a nontrivial result that there indeed
is such a t-structure; this will appear in forthcoming work of Hansen and the second author. Thus,
there is a good notion of “families of perverse sheaves”.
Moreover, one can restrict to the complexes A ∈D´et(HckI
G, Λ)bd that are universally locally
acyclic over (Div1)I. This condition is also preserved under convolution.
Definition I.6.2. The Satake category
SatI
G(Λ) ⊂D´et(HckI
G, Λ)bd
is the category of all A ∈D´et(HckI
G, Λ)bd that are perverse, ﬂat over Λ (i.e., for all Λ-modules M,
also A ⊗L
Λ M is perverse), and universally locally acyclic over (Div1)I.
Intuitively, SatI
G(Λ) are the “ﬂat families of perverse sheaves on HckI
G →(Div1)I”, where
ﬂatness refers both to the geometric aspect of ﬂatness over (Div1)I (encoded in universal local
acyclicity) and the algebraic aspect of ﬂatness in the coeﬃcients Λ. The Satake category SatI
G(Λ)
is a monoidal category under convolution. Moreover, it is covariantly functorial in I.
In fact, the monoidal structure naturally upgrades to a symmetric monoidal structure. This
relies on the fusion product, for which it is critical to allow general ﬁnite sets I. Namely, given
ﬁnite sets I1, . . . , Ik, letting I = I1 ⊔. . . ⊔Ik, one has an isomorphism
HckI
G ×(Div1)I(Div1)I;I1,...,Ik ∼=
k
Y
j=1
HckIj
G ×(Div1)I(Div1)I;I1,...,Ik
where (Div1)I;I1,...,Ik ⊂(Div1)I is the open subset where xi ̸= xi′ whenever i, i′ ∈I lie in diﬀerent
Ij’s. The exterior tensor product then deﬁnes a functor
⊠k
j=1 :
k
Y
j=1
SatIj
G(Λ) →SatI;I1,...,Ik
G
(Λ)

28
I. INTRODUCTION
where SatI;I1,...,Ik
G
(Λ) is the variant of SatI
G(Λ) for HckI
G ×(Div1)I(Div1)I;I1,...,Ik. However, the re-
striction functor
SatI
G(Λ) →SatI;I1,...,Ik
G
(Λ)
is fully faithful, and the essential image of the exterior product lands in its essential image. Thus,
we get a natural functor
∗k
j=1 :
k
Y
j=1
SatIj
G(Λ) →SatI
G(Λ),
independent of the ordering of the Ij. In particular, for any I, we get a functor
SatI
G(Λ) × SatI
G(Λ) →SatI⊔I
G (Λ) →SatI
G(Λ),
using functoriality of SatJ
G(Λ) in J, which deﬁnes a symmetric monoidal structure ∗on SatI
G(Λ),
commuting with ⋆. This is called the fusion product. In general, for any symmetric monoidal
category (C, ∗) with a commuting monoidal structure ⋆, the monoidal structure ⋆necessarily agrees
with ∗; thus, the fusion product reﬁnes the convolution product. (As usual in geometric Satake, we
actually need to change ∗slightly by introducing certain signs into the commutativity constraint,
depending on the parity of the support of the perverse sheaves.)
Moreover, restricting A ∈SatI
G(Λ) to GrI
G and taking the pushforward to (Div1)I, all cohomol-
ogy sheaves are local systems of Λ-modules on (Div1)I. By a version of Drinfeld’s lemma, these
are equivalent to representations of W I
E on Λ-modules. This deﬁnes a symmetric monoidal ﬁbre
functor
F I : SatI
G(Λ) →RepW I
E(Λ),
where RepW I
E(Λ) is the category of continuous representations of W I
E on ﬁnite projective Λ-modules.
Using a version of Tannaka duality, one can then build a Hopf algebra in the Ind-category of
RepW I
E(Λ) so that SatI
G(Λ) is given by its category of representations (internal in RepW I
E(Λ)). For
any ﬁnite set I, this is given by the tensor product of I copies of the corresponding Hopf algebra
for I = {∗}, which in turn is given by some aﬃne group scheme G
V
over Λ with WE-action.
Theorem I.6.3. There is a canonical isomorphism G
V
∼= bGΛ with the Langlands dual group,
under which the action of WE on G
V
agrees with the usual action of WE on bG up to an explicit
cyclotomic twist.
If √q ∈Λ, the cyclotomic twist can be trivialized, and SatI
G(Λ) is naturally
equivalent to the category of ( bG ⋊WE)I-representations on ﬁnite projective Λ-modules.
This theorem is thus a version of the theorem of Mirkovi´c–Vilonen [MV07], coupled with the
reﬁnements of Gaitsgory [Gai07] for general I. (We remark that we formulate a theorem valid
for any Λ, not necessarily regular; such a formulation does not seem to be in the literature. Also,
we give a purely local proof: Most proofs require a globalization on a (usual) curve.) Contrary to
Mirkovi´c–Vilonen, we actually construct an explicit pinning of G
V
. For the proof, one can restrict
to Λ = Z/ℓnZ; passing to a limit over n, one can actually build a group scheme over Zℓ. Its generic
ﬁbre is reductive, as the Satake category with Qℓ-coeﬃcients is (geometrically) semisimple: For
this, we again use the degeneration to the Witt vector aﬃne Grassmannian and the decomposition
theorem for schemes. To identify the reductive group, we argue ﬁrst for tori, and then for rank
1 groups, where everything reduces to G = PGL2 which is easy to analyze by using the minus-
cule Schubert cell. Here, the pinning includes a cyclotomic twist as of course the cohomology of

I.6. THE GEOMETRIC SATAKE EQUIVALENCE
29
the minuscule Schubert variety P1 of GrPGL2 contains a cyclotomic twist. Afterwards, we apply
hyperbolic localization in order to construct symmetric monoidal functors SatG →SatM for any
Levi M of G, inducing dually maps M
V
→G
V
. This produces many Levi subgroups of G
V
Qℓfrom
which it is easy to get the isomorphism with bGQℓ, including a pinning. As these maps M
V
→G
V
are
even deﬁned integrally, and bG(Zℓ) ⊂bG(Qℓ) is a maximal compact open subgroup by Bruhat–Tits
theory, generated by the rank 1 Levi subgroups, one can then deduce that G
V
∼= bG integrally, again
with an explicit (cyclotomic) pinning.
We will also need the following addendum regarding a natural involution. Namely, the local
Hecke stack HckG has a natural involution sw given by reversing the roles of the two G-torsors; in
the presentation in terms of LG, this is induced by the inversion on LG. Then sw∗induces naturally
an involution of SatG(Λ), and this involution can be upgraded to a symmetric monoidal functor
commuting with the ﬁbre functor, thus realizing a WE-equivariant automorphism of G
V
∼= bG.
Proposition I.6.4. The action of sw∗on SatG induces the automorphism of bG that is the
Chevalley involution of the split group bG, conjugated by bρ(−1).
Critical to all of our arguments is the hyperbolic localization functor. In the setting of the
Beilinson–Drinfeld Grassmannian, assume that P +, P −⊂G are two opposite parabolics, with
common Levi M. We get a diagram
GrI
P +
q+
|
p+
#
GrI
G
GrI
M .
GrI
P −
q−
b
p−
;
We get two “constant term” functors
CT+ = R(p+)!(q+)∗, CT−= R(p−)∗R(q−)! : D´et(GrI
G, Λ)bd →D´et(GrI
M, Λ)bd,
and one can construct a natural transformation CT−→CT+.
The functor CT+ corresponds
classically to the Satake transform, of integrating along orbits under the unipotent radical of U+.
Hyperbolic localization claims that the transformation CT−→CT+ is an equivalence when re-
stricted to L+G-equivariant objects. This has many consequences; note that CT+ is built from left
adjoint functors while CT−is built from right adjoint functors, so if they are isomorphic, hyperbolic
localization has the best of both worlds. In particular, hyperbolic localization commutes with all
colimits and all limits, preserves (relative) perversity, universal local acyclicity, commutes with any
base change, etc. .
This is in fact a special case of the following more general assertion. Let S be any small v-stack,
and f : X →S be a proper map that is representable in spatial diamonds with dim. trg f < ∞.
Assume that there is an action of Gm on X/S, where Gm(R, R+) = R×. The ﬁxed points X0 ⊂X
of the Gm-action form a closed substack. We assume that one can deﬁne an attractor locus X+ ⊂X
and a repeller locus X−⊂X, given by disjoint unions of locally closed subspaces, on which the

30
I. INTRODUCTION
t ∈Gm-action admits a limit as t →0 (resp. t →∞). We get a diagram
X+
q+
~
p+
!
X
X0,
X−
q−
`
p−
=
generalizing (bounded parts of) the above diagram if one chooses a cocharacter µ : Gm →G whose
dynamic parabolics are P +, P −. One can deﬁne
L+ = R(p+)!(q+)∗, L−= R(p−)∗R(q−)! : D´et(X, Λ) →D´et(X0, Λ)
and a natural transformation L−→L+. The following is our version of Braden’s theorem [Bra03],
cf. also [Ric19].
Theorem I.6.5. The transformation L−→L+ is an equivalence when restricted to the essential
image of D´et(X/Gm, Λ) →D´et(X, Λ).
The proof makes use of the following principle: If Y →S is partially proper with a Gm-
action such that the quotient stack Y/Gm is qcqs over S, then again Y admits two ends, and the
partially compactly supported cohomology of Y with coeﬃcients in any A ∈D´et(Y/Gm, Λ) vanishes
identically.
I.7. Cohomology of moduli spaces of shtuka
At this point, we have deﬁned
D(BunG, Λ),
and using the geometric Satake equivalence and the diagram
HckI
G
q
/
h1
{
h2
&
HckI
G
BunG
BunG ×(Div1)I
one can deﬁne the Hecke operator
TV = Rh2∗(h∗
1 ⊗L
Λ q∗SV ) : D(BunG, Λ) →D(BunG ×(Div1)I, Λ)
for any V ∈SatI
G(Λ), where SV is the corresponding sheaf on HckI
G. This works at least if Λ is
killed by some power of ℓ. We can in fact extend this functor to all Zℓ-algebras Λ. Moreover,
its image lies in the full subcategory of those objects that are locally constant in the direction of
(Div1)I, thereby giving a functor
TV : D(BunG, Λ) →D(BunG, Λ)BW I
E

I.7. COHOMOLOGY OF MODULI SPACES OF SHTUKA
31
to the category of W I
E-equivariant objects in D(BunG, Λ). The proof is surprisingly formal: One
reduces to I = {∗} by an inductive argument, and then uses that Div1 = Spd ˘E/ϕZ is still just a
point. More precisely, one uses that
D(BunG, Λ) →D(BunG × Spd bE, Λ)
is an equivalence.
Remark I.7.1. To deﬁne D(BunG, Λ)BW I
E, we need to upgrade D(BunG, Λ) to a condensed
∞-category; then it is the notion of W I
E-equivariant objects for the condensed group W I
E.
A ﬁrst consequence of our results is that TV , forgetting the W I
E-equivariance, preserves ﬁniteness
properties. Note that TV ◦TW ∼= TV ⊗W as the geometric Satake equivalence is monoidal. This
formally implies that TV is left and right adjoint to TV ∗. From here, it is not hard to prove the
following result.
Theorem I.7.2. The functor TV : D(BunG, Λ) →D(BunG, Λ) preserves compact objects and
universally locally acyclic objects. Moreover, it commutes with Bernstein–Zelevinsky and Verdier
duality in the sense that there are natural isomorphisms DBZ(TV (A)) ∼= Tsw∗V ∨(DBZ(A)) and
RHom(TV (A), Λ) ∼= T(sw∗V )∨RHom(A, Λ).
Here sw∗is the involution of SatI
G which by Proposition I.6.4 is induced by the Chevalley
involution of bG, conjugated by bρ(−1).
This theorem has concrete consequences for the cohomology of moduli spaces of shtukas. For
simplicity, we formulate it here with coeﬃcients in a Λ-algebra that is killed by ℓn for some n; for the
general formulation, we would need to discuss more precisely the foundational issues surrounding
the derived categories. In [SW20, Lecture XXIII], for any collection {µi}i of conjugacy classes of
cocharacters with ﬁelds of deﬁnition Ei/E and b ∈B(G), there is deﬁned a tower of moduli spaces
of local shtukas
fK : (Sht(G,b,µ•),K)K⊂G(E) →
Y
i∈I
Spd ˘Ei
as K ranges over compact open subgroups of G(E), equipped with compatible ´etale period maps
πK : Sht(G,b,µ•),K →Grtw
G,Q
i∈I Spd ˘Ei,≤µ• .
Here, Grtw
G,Q
i∈I Spd ˘Ei →Q
i∈I Spd ˘E is a certain twisted form of the convolution aﬃne Grassman-
nian, cf. [SW20, Section 23.5]. Let W be the exterior tensor product ⊠i∈IVµi of highest weight
representations, and SW the corresponding sheaf on Grtw
G,Q
i∈I Spd ˘Ei. We continue to write SW for
its pullback to Sht(G,b,µ•),K.
Corollary I.7.3. The sheaf
RfK!SW ∈D([∗/Gb(E)] ×
Y
i∈I
Spd ˘Ei, Λ)
is equipped with partial Frobenii, thus descends to an object of
D([∗/Gb(E)] ×
Y
i∈I
Spd ˘Ei/ϕZ
i , Λ).

32
I. INTRODUCTION
This object lives in the full subcategory
D(Gb(E), Λ)B Q
i∈I WEi ⊂D([∗/Gb(E))] ×
Y
i∈I
Spd ˘Ei/ϕZ
i , Λ),
and its restriction to D(Gb(E), Λ) is compact. In particular, for any admissible representation ρ of
Gb(E), the object
R HomGb(E)(RfK!SW , ρ) ∈D(Λ)B Q
i∈I WEi
is a representation of Q
i∈I WEi on a perfect complex of Λ-modules. Taking the colimit over K, this
gives rise to a complex of admissible G(E)-representations
lim
−→
K
R HomGb(E)(RfK!SW , ρ)
equipped with a Q
i∈I WEi-action.
If ρ is compact, then so is
lim
−→
K
R HomGb(E)(RfK!SW , ρ)
as a complex of G(E)-representations.
Specializing to I = {∗} and µ minuscule, we get local Shimura varieties, and this proves the
ﬁniteness properties of [RV14, Proposition 6.1] unconditionally, as well as [RV14, Remark 6.2 (iii)].
We note that those properties seem inaccessible using only the deﬁnition of the moduli spaces of
shtukas, i.e. without the use of BunG.
I.8. The stack of L-parameters
Let us discuss the other side of the Langlands correspondence, namely (the stack of) L-
parameters. This has been previously done by Dat–Helm–Kurinczuk–Moss [DHKM20] and Zhu
[Zhu20]. One wants to deﬁne a scheme whose Λ-valued points, for a Zℓ-algebra Λ, are the contin-
uous 1-cocycles
ϕ : WE →bG(Λ).
(Here, we endow bG with its usual WE-action, that factors over a ﬁnite quotient Q of WE. As
discussed above, the diﬀerence between the two actions disappears over Zℓ[√q], and we ﬁnd it
much more convenient to use the standard normalization here, so that we can sometimes make use
of the algebraic group bG ⋊Q.)
There seems to be a mismatch here, in asking for an algebraic stack, but continuous cocycles.
Interestingly, there is a way to phrase the continuity condition that produces a scheme. Namely,
we consider Λ as a condensed Zℓ-algebra that is “relatively discrete over Zℓ”. Abstract Zℓ-modules
M embed fully faithfully into condensed Zℓ-modules, via sending M to Mdisc ⊗Zℓ,disc Zℓ.
Theorem I.8.1. There is a scheme Z1(WE, bG) over Zℓwhose Λ-valued points, for a Zℓ-algebra
Λ, are the condensed 1-cocycles
ϕ : WE →bG(Λ),
where we regard Λ as a relatively discrete condensed Zℓ-algebra. The scheme Z1(WE, bG) is a union
of open and closed aﬃne subschemes Z1(WE/P, bG) as P runs through open subgroups of the wild

I.8. THE STACK OF L-PARAMETERS
33
inertia subgroup of WE, and each Z1(WE/P, bG) is a ﬂat local complete intersection over Zℓof
dimension dim G.
The point here is that the inertia subgroup of WE has a Zℓ-factor, and this can map in interesting
ways to Λ when making this deﬁnition. To prove the theorem, following [DHKM20] and [Zhu20]
we deﬁne discrete dense subgroups W ⊂WE/P by discretizing the tame inertia, and the restriction
Z1(WE/P, bG) →Z1(W, bG) is an isomorphism, where the latter is clearly an aﬃne scheme.
We can also prove further results about the bG-action on Z1(WE, bG), or more precisely each
Z1(WE/P, bG). For this result, we need to exclude some small primes, but if G = GLn, all primes
ℓare allowed; for classical groups, all ℓ̸= 2 are allowed. More precisely, we say that ℓis very good
for bG if the following conditions are satisﬁed.
(i) The (algebraic) action of WE on bG factors over a ﬁnite quotient Q of order prime to ℓ.
(ii) The order of the fundamental group of the derived group of bG is prime to ℓ(equivalently, π0Z(G)
is of order prime to ℓ).
(iii) If G has factors of type B, C, or D, then ℓ̸= 2; if it has factors of type E, F, or G, then
ℓ̸= 2, 3; and if it has factors of type E8, then ℓ̸= 2, 3, 5.
Theorem I.8.2. Assume that ℓis a very good prime for bG. Then Hi( bG, O(Z1(WE/P, bG))) = 0
for i > 0 and the formation of the invariants O(Z1(WE/P, bG)) bG commutes with any base change.
The algebra O(Z1(WE/P, bG)) bG admits an explicit presentation in terms of excursion operators,
O(Z1(WE/P, bG))
bG = colim(n,Fn→W) O(Z1(Fn, bG))
bG
where the colimit runs over all maps from a free group Fn to W ⊂WE/P, and Z1(Fn, bG) ∼= bGn
with the simultaneous twisted bG-conjugation.
Moreover, the ∞-category Perf(Z1(WE/P, bG)/ bG) is generated under cones and retracts by the
image of Rep( bG) →Perf(Z1(WE/P, bG)/ bG), and Ind Perf(Z1(WE/P, bG)) is equivalent to the ∞-
category of modules over O(Z1(WE/P, bG)) in Ind Perf(B bG).
All of these results also hold with Qℓ-coeﬃcients, without any assumption on ℓ.
With Qℓ-coeﬃcients, these results are simple, as the representation theory of bG is semisimple.
However, with Zℓ-coeﬃcients, these results are quite subtle, and we need to dive into modular
representation theory of reductive groups. Very roughly, the proof of the theorem proceeds by
analyzing the closed bG-orbits in the stack of L-parameters ﬁrst, and then use a deformation to the
normal cone to understand the behaviour near any bG-orbit. We make critical use of some results
of Touz´e–van der Kallen [TvdK10]. Let us make some further remarks about the closed bG-orbits.
First, the closed bG-orbits in Z1(WE/P, bG)L, for any algebraically closed ﬁeld L over Zℓ, corre-
spond to the semisimple L-parameter ϕ : WE →bG(L), and also biject to the geometric points of
Spec O(Z1(WE/P, bG)) bG. Here, an L-parameter is semisimple if, whenever it factors over a para-
bolic bP ⊂bG, it also factors over a Levi c
M ⊂bP. Any semisimple parameter is in fact continuous
for the discrete topology on L, i.e. trivial on an open subgroup of IE. If L = Fℓand Q is of order
prime to ℓ, then ϕ is semisimple if and only if it factors over a ﬁnite quotient of order prime to ℓ.

34
I. INTRODUCTION
Its orbit in Z1(WE/P, bG)L is then given by bG/Sϕ where Sϕ ⊂bG is the centralizer of ϕ, which is
in that case the ﬁxed points under the action of a ﬁnite solvable group F of automorphisms of bG,
where the order of F is prime to ℓ. We need the following result.
Theorem I.8.3. Let H be a reductive group over an algebraically closed ﬁeld L of characteristic
ℓ. Let F be a ﬁnite group of order prime to ℓacting on H. Then HF is a smooth linear algebraic
group whose connected component is reductive, and with π0HF of order prime to ℓ. If F is solvable,
the image of Perf(BH) →Perf(BHF ) generates under cones and retracts.
The last part of this theorem is proved by a very explicit (and exhausting) analysis of all
possible cases. It would be desirable to have a more enlightening argument, possibly also removing
the assumption that F is solvable. In fact, we would expect similar results to hold true in the
case where W is replaced by the fundamental group of a Riemann surface. Our arguments are not
general enough to handle that case.
Remark I.8.4. While the hypotheses imposed on ℓare surely not optimal, we are quite sure
that some hypothesis on ℓis required in Theorem I.8.2. For example, if bG = PGL2 and ℓ= 2,
we expect problems to arise. For example, one can show that for X = bG with the conjugation
action by bG, the ∞-category Perf(X/ bG) is not generated under cones and retracts by the image
of Rep( bG). Our guess would be that the condition that ℓdoes not divide the order of π1( bGder) is
essential.
On the other hand, we expect that, for example by the use of z-embeddings [Kal14, Section 5],
one can reduce all relevant questions (like the general construction of maps on Bernstein centers
discussed below, or the construction of the spectral action) to the case where ℓdoes not divide the
order of π1( bGder). We are not taking this up here.
I.9. Construction of L-parameters
Finally, we can discuss the construction of L-parameters. Assume ﬁrst for simplicity that Λ =
Qℓwith ﬁxed √q ∈Qℓ, and let A ∈D(BunG, Qℓ) be any Schur-irreducible object, i.e. End(A) = Qℓ.
For example, A could correspond to an irreducible smooth representation of G(E), taking the
extension by zero along [∗/G(E)] ,→BunG. Then, following V. Laﬀorgue [Laf18], we can deﬁne
excursion operators as follows. For any representation V of ( bG⋊WE)I over Qℓ, together with maps
α : Qℓ→V | bG, β : V | bG →Qℓ
when restricted to the action of the diagonal copy bG ⊂( bG⋊WE)I, and elements γi ∈WE for i ∈I,
we can deﬁne the endomorphism
A Tα
−→TV (A)
(γi)i∈I
−−−−→TV (A)
Tβ
−→A
of A, deﬁning an element of Qℓ. With all the formalism in place, the following result is essentially
due to V. Laﬀorgue [Laf18, Proposition 11.7].
Proposition I.9.1. There is a unique continuous semisimple L-parameter
ϕA : WE →bG(Qℓ)

I.9. CONSTRUCTION OF L-PARAMETERS
35
such that for all (I, V, α, β, (γi)i∈I) as above, the excursion operator
A Tα
−→TV (A)
(γi)i∈I
−−−−→TV (A)
Tβ
−→A
is given by multiplication with the scalar
Qℓ
α−→V
(ϕA(γi)i∈I)
−−−−−−−→V
β−→Qℓ.
Note that in fact, the excursion operators deﬁne elements in the Bernstein center of G(E), as
they deﬁne endomorphisms of the identity functor. From this perspective, let us make the following
deﬁnition.
Definition I.9.2.
(i) The Bernstein center of G(E) is
Z(G(E), Λ) = π0End(idD(G(E),Λ)) =
lim
←−
K⊂G(E)
Z(Λ[K\G(E)/K])
where K runs over open pro-p subgroups of G(E), and Λ[K\G(E)/K] = EndG(E)(c-IndG(E)
K
Λ) is
the Hecke algebra of level K.
(ii) The geometric Bernstein center of G is
Zgeom(G, Λ) = π0End(idDlis(BunG,Λ)).
Inside Zgeom(G, Λ), we let Zgeom
Hecke(G, Λ) be the subring of all endomorphisms f : id →id commuting
with Hecke operators, in the sense that for all V ∈Rep( bGI) and A ∈Dlis(BunG, Λ), one has
TV (f(A)) = f(TV (A)) ∈End(TV (A)).
(iii) The spectral Bernstein center of G is
Zspec(G, Λ) = O(Z1(WE, bG)Λ)
bG,
the ring of global functions on the quotient stack Z1(WE, bG)Λ/ bG.
The inclusion D(G(E), Λ) ,→Dlis(BunG, Λ) induces a map of algebra Zgeom(G, Λ) →Z(G(E), Λ).
Now the construction of excursion operators, together with Theorem I.8.2 imply the following.
Here Λ is a Zℓ[√q]-algebra.
Proposition I.9.3. Assume that ℓis invertible in Λ, or ℓis a very good prime for bG. Then
there is a canonical map
Zspec(G, Λ) →Zgeom
Hecke(G, Λ) ⊂Zgeom(G, Λ),
and in particular a map
ΨG : Zspec(G, Λ) →Z(G(E), Λ).
In fact, even for general ℓ, one gets similar maps, up to replacing Z1(WE, bG) bG by a universally
homeomorphic scheme. The construction of L-parameters above is then a consequence of this map
on Bernstein centers. The existence of such an integral map is due to Helm–Moss [HM18] in the
case G = GLn.

36
I. INTRODUCTION
Remark I.9.4. In the function-ﬁeld case, a similar construction has been given by Genestier–
Laﬀorgue [GL17]. We expect that the two constructions agree, and that proving this is within
reach (as both are based on the cohomology of moduli spaces of shtukas), but have not thought
much about it.
We make the following conjecture regarding independence of ℓ. For its formulation, we note
that there is a natural Q-algebra Zspec(G, Q) whose base change to Qℓis Zspec(G, Qℓ) for any ℓ̸= p;
in fact, one can take the global functions on the stack of L-parameters that are continuous for the
discrete topology (i.e. trivial on an open subgroup of WE); see also [DHKM20].
Conjecture I.9.5. There is a (necessarily unique) map Zspec(G, Q(√q)) →Z(G(E), Q(√q))
that after base extension to any Qℓfor ℓ̸= p recovers the composite
Zspec(G, Qℓ(√q)) →Zgeom(G, Qℓ(√q)) →Z(G(E), Qℓ(√q)).
This would ensure that the L-parameters we construct are independent of ℓin the relevant
sense. Further conjectures about this map and its relation to the stable Bernstein center have
been formulated by Haines [Hai14] (see also [BKV15], [SS13, Section 6]). In particular, it is
conjectured that for G quasisplit, the map ΨG is injective, and its image can be characterized as
those elements of the Bernstein center of G(E) whose corresponding distribution is invariant under
stable conjugation.
One can also construct the map to the Bernstein center in terms of moduli spaces of local
shtukas, as follows.
For simplicity, we discuss this again only if Λ is a Z/ℓn-algebra for some
n. Given I and V as above, we can consider a variant Sht(G,1,V ),K of the spaces Sht(G,b,≤µ•),K
considered above, where the bound is given by the support of V and we ﬁx the element b = 1.
They come with an ´etale period map
πK : Sht(G,1,V ),K →Grtw
G,Qn
i=1 Spd ˘E
and a perverse sheaf SV . When restricted to the geometric diagonal
x : Spd bE →
n
Y
i=1
Spd ˘E,
they become a corresponding moduli space of shtukas with one leg
f∆
K : Sht(G,1,V | b
G) →Spd bE
with the sheaf SV | b
G. The sheaf SV | b
G admits maps α (resp. β) from (resp. to) the sheaf i∗Λ, where
i : G(E)/K = Sht(G,1,Qℓ),K ,→Sht(G,1,V | b
G),K is the subspace of shtukas with no legs. This produces
an endomorphism
c-IndG(E)
K
Λ α−→Rf∆
K!SV | b
G = (RfK!SV )x
(γi)i∈I
−−−−→(RfK!SV )x = Rf∆
K!SV | b
G
β−→c-IndG(E)
K
Λ.
Here, the action of (γi)i∈I is deﬁned by Corollary I.7.3. It follows from the deﬁnitions that this
is precisely the previous construction applied to the representation c-IndG(E)
K
Λ. Note that these
endomorphisms are G(E)-equivariant, so deﬁne elements in the Hecke algebra
Λ[K\G(E)/K] = EndG(E)(c-IndG(E)
K
Λ);

I.10. THE SPECTRAL ACTION
37
in fact, these elements are central (as follows by comparison to the previous construction). Taking
the inverse limit over K, one gets the elements in the Bernstein center of G(E).5
Concerning the L-parameters we construct, we can prove the following basic results.
Theorem I.9.6.
(i) If G = T is a torus, then π 7→ϕπ is the usual Langlands correspondence.
(ii) The correspondence π 7→ϕπ is compatible with twisting.
(iii) The correspondence π 7→ϕπ is compatible with central characters (cf. [Bor79, 10.1]).
(iv) The correspondence π 7→ϕπ is compatible with passage to congradients (cf. [AV16]).
(v) If G′ →G is a map of reductive groups inducing an isomorphism of adjoint groups, π is an
irreducible smooth representation of G(E) and π′ is an irreducible constitutent of π|G′(E), then ϕπ′
is the image of ϕπ under the induced map bG →c
G′.
(vi) If G = G1 × G2 is a product of two groups and π is an irreducible smooth representation of
G(E), then π = π1 ⊠π2 for irreducible smooth representations πi of Gi(E), and ϕπ = ϕπ1 × ϕπ2
under bG = bG1 × bG2.
(vii) If G = ResE′|EG′ is the Weil restriction of scalars of a reductive group G′ over some ﬁnite sep-
arable extension E′|E, so that G(E) = G′(E′), then L-parameters for G|E agree with L-parameters
for G′|E′.
(viii) The correspondence π 7→ϕπ is compatible with parabolic induction.
(ix) For G = GLn and supercuspidal π, the correspondence π 7→ϕπ agrees with the usual local
Langlands correspondence [LRS93], [HT01], [Hen00].
Note that parts (viii) and (ix) together say that for GLn and general π, the L-parameter ϕπ is
what is usually called the semisimple L-parameter.
I.10. The spectral action
The categorical structure we have constructed actually produces something better.
Let Λ
be the ring of integers in a ﬁnite extension of Qℓ(√q).
We have the stable ∞-category C =
Dlis(BunG, Λ)ω of compact objects, which is linear over Λ, and functorially in the ﬁnite set I an
exact monoidal functor RepΛ( bG⋊Q)I →EndΛ(C)BW I
E that is linear over RepΛ(QI); here, EndΛ(C)
denotes the stable ∞-category of Λ-linear endofunctors of C, and we regard it as being enriched in
condensed Λ-modules via regarding C as enriched in relatively discrete condensed Λ-modules. A
ﬁrst version of the following theorem is due to Nadler–Yun [NY19] in the context of Betti geometric
Langlands, and a more general version appeared in the work of Gaitsgory–Kazhdan–Rozenblyum–
Varshavsky [GKRV19]. Both references, however, eﬀectively assume that G is split, work only
with characteristic 0 coeﬃcients, and work with a discrete group in place of WE. At least the
extension to Zℓ-coeﬃcients is a nontrivial matter.
5When the second author gave his Berkeley lectures [SW20], this was the construction of excursion operators
that we envisaged. Note that a key step here is that the cohomology of moduli spaces of local shtukas deﬁnes a local
system on (Div1)I. It is however not clear how to prove this purely in terms of moduli space of shtukas. In the global
function ﬁeld case, this result has been obtained by Xue [Xue20].

38
I. INTRODUCTION
Note that Z1(WE, bG) is not quasicompact, as it has inﬁnitely many connected components; it
can be written as the increasing union of open and closed quasicompact subschemes Z1(WE/P, bG).
We say that an action of Perf(Z1(WE, bG)/ bG) on a stable ∞-category C is compactly supported if
for all X ∈C the functor Perf(Z1(WE, bG)/ bG) →C (induced by acting on X) factors over some
Perf(Z1(WE/P, bG)/ bG).
We stress again that for G = GLn, all ℓare very good, and for classical groups, all ℓ̸= 2 are
very good.
Theorem I.10.1. Assume that ℓis a very good prime for bG. Let C be a small Λ-linear stable ∞-
category. Then giving, functorially in the ﬁnite set I, an exact RepΛ(QI)-linear monoidal functor
Rep( bG ⋊Q)I →EndΛ(C)BW I
E
is equivalent to giving a compactly supported Λ-linear action of
Perf(Z1(WE, bG)Λ/ bG).
Here, given a compactly supported Λ-linear action of Perf(Z1(WE, bG)Λ/ bG), one can produce such
an exact RepΛ(QI)-linear monoidal functor
RepΛ( bG ⋊Q)I →EndΛ(C)BW I
E
functorially in I by composing the exact RepΛ(QI)-linear symmetric monoidal functor
Rep( bG ⋊Q)I →Perf(Z1(WE, bG)Λ/ bG)BW I
E
with the action of Perf(Z1(WE, bG)Λ/ bG).
The same result holds true with Λ a ﬁeld over Qℓ, for any prime ℓ.
Here, the exact RepΛ(QI)-linear symmetric monoidal functor
RepΛ( bG ⋊Q)I →Perf(Z1(WE, bG)Λ/ bG)BW I
E
is induced by tensor products and the exact RepΛ(Q)-linear symmetric monoidal functor
RepΛ( bG ⋊Q) →Perf(Z1(WE, bG)Λ/ bG)BWE
corresponding to the universal bG ⋊Q-torsor, with the universal WE-equivariance as parametrized
by Z1(WE, bG)/ bG.
The key part of the proof is actually the ﬁnal part of Theorem I.8.2 above, which eﬀectively
describes Perf(Z1(WE/P, bG)/ bG) in terms of generators and relations, as does the present theorem.
In particular, we get an action of Perf(Z1(WE, bG)Λ/ bG) on Dlis(BunG, Λ), suitably compatible
with the Hecke action.
With everything in place, it is now obvious that the main conjecture is the following, cf. [AG15],
[BZCHN20], [Zhu20], [Hel20]:6
6The formulation of the conjecture presumes a spectral action, which we have only constructed under a small
assumption on ℓ; implicit is thus that a spectral action, reﬁning the Hecke action, can be deﬁned for all ℓ.

I.11. THE ORIGIN OF THE IDEAS
39
Conjecture I.10.2. Assume that G is quasisplit and choose Whittaker data consisting of a
Borel B ⊂G and generic character ψ : U(E) →O×
L of the unipotent radical U ⊂B, where L/Qℓ
is some algebraic extension; also ﬁx √q ∈OL. Then there is an equivalence
D(BunG, OL)ω ∼= Db,qc
coh,Nilp(Z1(WE, bG)OL/ bG)
of stable ∞-categories equipped with actions of Perf(Z1(WE, bG)OL/ bG). Under this correspondence,
the structure sheaf of Z1(WE, bG)OL/ bG maps to the Whittaker sheaf, which is the sheaf concentrated
on Bun1
G corresponding to the Whittaker representations c-IndG(E)
U(E)ψ.
Here, we use the notion of complexes of coherent sheaves with nilpotent singular support, see
[AG15].
More precisely, Db,qc
coh,Nilp is the ∞-category of bounded complexes with quasicompact
support, coherent cohomology, and nilpotent singular support. With characteristic 0 coeﬃcients,
or at banal primes ℓ, the condition of nilpotent singular support is actually automatic.
If Wψ is the Whittaker sheaf and we note ∗the spectral action, the conjecture thus says that
Perfqc(Z1(WE, bG)OL/ bG) −→D(BunG, OL)
M 7−→M ∗Wψ
is fully faithful and extends to an equivalence of stable ∞-categories
D(BunG, OL)ω ∼= Db,qc
coh,Nilp(Z1(WE, bG)OL/ bG).
Recall that the left-hand side contains D(G(E), OL)ω fully faithfully, so in particular this ∞-
category should embed fully faithfully into the right-hand side.
This has been conjectured by
Hellmann in [Hel20] and Ben-Zvi–Chen–Helm–Nadler [BZCHN20] have proved parts of this
(they use Qℓ-coeﬃcients, and work with split groups and the Bernstein component corresponding
to representations with Iwahori ﬁxed vector).
Remark I.10.3. Consider the conjecture with coeﬃcients in Qℓ. Ideally, the conjecture should
also include a comparison of t-structures. Unfortunately, we did not immediately see a good can-
didate for matching t-structures. Ideally, this would compare the perverse t-structure on the left
(which is well-deﬁned, for abstract reasons, and appears at least implicitly in [CS17], [CS19a];
it seems to be the “correct” t-structure for questions of local-global compatibility) with some
“perverse-coherent” t-structure on the right. If so, the equivalence would also yield a bijection
between irreducible objects in the abelian hearts. On the left-hand side, these irreducible objects
would then be enumerated by pairs (b, πb) of an element b ∈B(G) and an irreducible smooth
representation πb of Gb(E), by using intermediate extensions. On the right-hand side, they would
likely correspond to a Frobenius-semisimple L-parameter ϕ : WE →bG(Qℓ) together with an irre-
ducible representation of the centralizer Sϕ of ϕ. Independently of the categorical conjecture, one
can wonder whether these two sets are in fact canonically in bijection.
I.11. The origin of the ideas
Finally, let us give some account of the historical developments of these ideas. Let us ﬁrst
recall some of our early work in the direction of local Langlands correspondences. Fargues [Far04]
has proved that in the cohomology of basic Rapoport–Zink spaces for GLn (and U(3)) and general

40
I. INTRODUCTION
minuscule cocharacters, an appropriate version of the local Langlands correspondence is realized.
Moreover, Fargues [Far08] has proved the duality isomorphism between the Lubin–Tate and Drin-
feld tower. Already at this point Fargues thought of this as an attempt to geometrize the Jacquet-
Langlands correspondence, see [Far08, Theorem 2 of the Pr´eambule]. On the other hand, Scholze
[Sch13] has given a new proof of the local Langlands correspondence for GLn. His results pointed
to the idea that there ought to exist certain sheaves on the moduli stack of p-divisible groups (which,
when restricted to perfect schemes, can be regarded as a “part” of the stack GLn -Isoc considered
above), giving a certain geometrization of the local Langlands correspondence, then formulated as
a certain character sheaf property (inspired by the character formulas in [Sch13]). Related ob-
servations were also made by Boyer (cf. e.g. [Boy09]) and in unpublished work of Dat. However,
Scholze was always uneasy with the very bad geometric properties of the stack of p-divisible groups.
At this point, both of us had essentially left behind local Langlands to study other questions.
Fargues found the fundamental curve of p-adic Hodge theory in his work with Fontaine [FF18]; an
initial critical motivation for Fargues was a development of “p-adic Hodge theory without Galois
actions”, i.e. for ﬁelds like Cp. Indeed, this was required in some of his work on Rapoport–Zink
spaces. On the other hand, Scholze developed perfectoid spaces [Sch12], motivated by the weight-
monodromy conjecture. After his talk at a conference in Princeton in March 2011, Weinstein gave
a talk about his results on the Lubin–Tate tower at inﬁnite level, which made it clear that it is
in fact a perfectoid space. Scholze at the time was already eager to understand the isomorphism
between Lubin–Tate and Drinfeld tower, and it now became clear that it should really be an iso-
morphism of perfectoid spaces. This was worked out in [SW13]. At the time of writing of [SW13],
the perspective of the Fargues–Fontaine curve had already become central, and we realized that
the isomorphism of the towers simply amounts to two dual descriptions of the space of minuscule
modiﬁcations On
X →OX( 1
n) on the Fargues–Fontaine curve, depending on which bundle is ﬁxed
and which one is the modiﬁcation. This was the ﬁrst clear connection between local Langlands (as
encoded in the cohomology of Lubin–Tate and Drinfeld space) and the theory of vector bundles
on the Fargues–Fontaine curve, which Scholze had however not taken seriously enough. Moreover,
Fargues had noted in [FF18], in the proof of “weakly admissible implies admissible”, that modiﬁca-
tions of vector bundles were playing an important role: the Hodge ﬁltration of a ﬁltered ϕ-module
allows one to deﬁne a new vector bundle by modifying the vector bundle associated to an isocrystal
i.e. by “applying a Hecke correspondence” as he said in the talk [Far10] at the conference in honor
of Jean-Marc Fontaine.
This duality perspective also put the two dual period morphisms into the center of attention:
The Hodge–de Rham period mapping, and the Hodge–Tate period mapping (which are swapped
under the duality isomorphism). Thinking about the Lubin–Tate tower as part of the moduli space
of elliptic curves, Scholze then realized that the Hodge–Tate period map even exists globally on the
moduli space of elliptic curves with inﬁnite level (on the level of Berkovich topological spaces, this
had also been observed by Fargues before). Moreover, Scholze realized that the Hodge–Tate period
map gives a substitute for the map from the moduli space of elliptic curves to the moduli space of
p-divisible groups, and that the sheaves he sought for a geometric interpretation of [Sch13] have a
better chance of existing on the target of the Hodge-Tate period map, which is simply a projective
space over Cp; he sketched these ideas in an MSRI talk [Sch14]. (Again, Dat has had similar
ideas.) Eventually, this perspective was used in his work with Caraiani [CS17], [CS19a] to study

I.11. THE ORIGIN OF THE IDEAS
41
torsion in the cohomology of Shimura varieties. The work with Caraiani required the classiﬁcation
of G-torsors on the Fargues–Fontaine curve, which was proved by Fargues [Far18b].
Increasingly taking the perspective of studying all geometric objects by mapping only perfectoid
spaces in, the idea of diamonds emerged quickly, including the possibility of getting several copies
of Spec Qp (the earliest published incarnation of this idea is [Wei17]), and of deﬁning general
moduli spaces of p-adic shtukas. These ideas were laid out in Scholze’s Berkeley course [SW20]
during the MSRI trimester in Fall 2014. The eventual goal was always to adapt V. Laﬀorgue’s
work [Laf18] to the case of p-adic ﬁelds; the original strategy was to deﬁne the desired excursion
operators via the cohomology of moduli spaces of local shtukas. At the beginning of the trimester,
Scholze was still very wary about the geometric Langlands program, as it did not seem to be able
to incorporate the subtle arithmetic properties of supercuspidal representations of p-adic groups.
It was thus a completely unexpected conceptual leap that in fact the best perspective for the whole
subject is to view the local Langlands correspondence as a geometric Langlands correspondence
on the Fargues–Fontaine curve, which Fargues suggested over a coﬀee break at MSRI (partly
inspired by having thought intensely about the space of G-bundles on the curve in relation to
[Far18b]). Fargues was taking the perspective of Hecke eigensheaves then, seeking to construct for
any (discrete) L-parameter ϕ an associated Hecke eigensheaf Aϕ on BunG with eigenvalue ϕ. This
should deﬁne a functor ϕ 7→Aϕ, and thus carry an action of the centralizer group Sϕ ⊂bG of ϕ,
and the corresponding Sϕ-isotypic decomposition of Aϕ should realize the internal structures of the
L-packets. Moreover, the Hecke eigensheaf property should imply the Kottwitz conjecture [RV14,
Conjecture 7.3] on the cohomology of local Shimura varieties. This made everything come together.
In particular, it gave a compelling geometric origin for the internal structure of L-packets, and also
matched the recent work of Kaletha [Kal14] who used basic G-isocrystals for the ﬁne study of
L-packets.
Unfortunately, the conjecture was formulated on extremely shaky grounds: It presumed that
one could work with the moduli stack BunG as if it were an object of usual algebraic geometry.
Of course, it also presumed that there is a version of geometric Satake, etc.pp.
On the other
hand, we realized that once we could merely formulate Fargues’ conjecture, enough machinery is
available to apply Laﬀorgue’s ideas [Laf18] to get the “automorphic-to-Galois” direction and deﬁne
(semisimple) L-parameters (as Genestier–Laﬀorgue [GL17] did in equal characteristic).
Since then, it has been a long and very painful process. The ﬁrst step was to give a good
deﬁnition of the category of geometric objects relevant to this picture, i.e. diamonds. In particular,
one had to prove that the relevant aﬃne Grassmannians have this property. This was the main
result of the Berkeley course [SW20]. For the proof, the concept of v-sheaves was introduced,
which has since taken on a life of its own also in algebraic geometry (cf. [BM18]). (Generally,
v-descent turned out to be an extremely powerful proof technique. We use it here to reprove the
basic theorems about the Fargues–Fontaine curve, recovering the main theorems of [FF18] and
[KL15] with little eﬀort.) Next, one had to develop a 6-functor formalism for the ´etale cohomology
of diamonds, which was achieved in [Sch17a], at least with torsion coeﬃcients.
The passage
to Qℓ-coeﬃcients requires more eﬀort than for schemes, and we will comment on it below.
A
central technique of [Sch17a] is pro-´etale descent, and more generally v-descent. In fact, virtually
all theorems of [Sch17a] are proved using such descent techniques, essentially reducing them to
proﬁnite collections of geometric points.
It came as a surprise to Scholze that this process of

42
I. INTRODUCTION
disassembling smooth spaces into proﬁnite sets has any power in proving geometric results, and
this realization gave a big impetus to the development of condensed mathematics (which in turn
fueled back into the present project).
At this point, it became possible to contemplate Fargues’ conjecture. In this respect, the ﬁrst
result that had to be established is that D´et(BunG, Z/ℓnZ) is well-behaved, for example satisﬁes
Verdier biduality for “admissible” sheaves. We found a proof, contingent on the cohomological
smoothness of a certain “chart” πb : Mb →BunG for BunG near any b ∈B(G); this was explained
in Scholze’s IH´ES course [Sch17b]. While for G = GLn, the cohomological smoothness of πb could
be proved by a direct attack, in general we could only formulate it as a special case of a general
“Jacobian criterion of smoothness” for spaces parametrizing sections of Z →XS for some smooth
adic space Z over the Fargues–Fontaine curve. Proving this Jacobian criterion required three further
key ideas. The ﬁrst is the notion of “formal smoothness”, where liftings to inﬁnitesimal thickenings
(that do not exist in perfectoid geometry) are replaced by liftings to actual small open (or ´etale)
neighborhoods.
The resulting notion is closely related to the notion of absolute neighborhood
retracts in classical topology [Bor67]. Through some actual “analysis”, it is not hard to prove
that the space of sections is formally smooth. Unfortunately, this does not seem to be enough to
guarantee cohomological smoothness. The ﬁrst issue is that formal smoothness does not imply any
ﬁnite-dimensionality. Here, the second key idea comes in, which is Bhatt’s realization [BS19] that
Zariski closed immersions are strongly Zariski closed in the sense of [Sch15, Section II.2] (contrary
to a claim made by Scholze there). At this point, it would be enough to show that spaces that
are formally smooth and Zariski closed in a ﬁnite-dimensional perfectoid ball are cohomologically
smooth. Unfortunately, despite many tries, we are still unable to prove that even the diﬀerent
notions of dimension of [Sch17a] (Krull dimension, dim. trg, cohomological dimension) agree for
such spaces. This may well be the most important foundational open problem in the theory:
Problem I.11.1. Let X ⊂eBn
C be Zariski closed, where eBn is a perfectoid ball. Show that X has
a well-behaved dimension.
In fact, we ﬁnd it crazy that we are able to prove all sorts of nontrivial geometric results without
ever being able to unambiguously talk about dimensions!
Our attacks on this failing, a third key idea comes in: Namely, the notion of universally locally
acyclic sheaves, that we also developed independently in order to prove geometric Satake. It is
easy to see that formal smoothness plus ﬁnite-dimensionality implies that the constant sheaf is
universally locally acyclic; it remains to see that the dualizing sheaf is invertible. This can be
proved by a deformation to the normal cone (using universal local acyclicity to spread the result on
the normal cone to a neighborhood). We found this argument at a conference in Luminy in July
2018; an inspiration to use a deformation to the normal cone may have been Clausen’s use in the
proof of the “linearization hypothesis”.
These results are enough to show that D´et(BunG, Z/ℓnZ) is well-behaved, and are already
enough to prove new ﬁniteness results on the cohomology of Rapoport–Zink spaces (with torsion
coeﬃcients). Our next emphasis was on geometric Satake. This essentially required the theory
of universally locally acyclic sheaves, and a version of Braden’s hyperbolic localization theorem
[Bra03]. We were able to ﬁnd substitutes for both. Regarding universally locally acyclic sheaves,
we were able to prove analogues of most basic theorems, however we failed to prove that in general

I.12. ACKNOWLEDGMENTS
43
they are preserved under relative Verdier duality (even while we could check it by hand in all
relevant cases). Lu–Zheng [LZ20] then found a new characterization of universally locally acyclic
sheaves, making stability under relative Verdier duality immediate. Their arguments immediately
transport to our setting. Eventually we used a slightly diﬀerent characterization, but in spirit the
argument is still the same as theirs. Regarding hyperbolic localization, we could not follow Braden’s
arguments that rely on nice coordinate choices. Instead, we reduce all arguments to the following
(simple to prove) principle: If X is a (partially proper) space with a Gm-action such that [X/Gm]
is qcqs, and A ∈D´et([X/Gm], Λ), then the partially compactly supported cohomology of X with
coeﬃcients in A vanishes. The idea here is that the Gm-action contracts X towards one of the ends.
Afterwards, the proof of geometric Satake largely follows the lines of [MV07], although there are
certain improvements in the argument; in particular, we give a simple reduction to groups of rank
1, and pin the isomorphism with the dual group.
Using these results, one has all ingredients in place, but only working with torsion coeﬃcients.
One can formally pass to ℓ-adically complete sheaves, but this leads to studying representations on
Banach Qℓ-vector spaces, which is very unnatural. During this time, Clausen came to Bonn, and
Clausen and Scholze started to develop condensed mathematics, and the theory of solid modules
[CS]. They realized that one could also deﬁne solid Zℓ-sheaves on schemes or diamonds, and that
this makes it possible to study representations on discrete Qℓ- or Qℓ-vector spaces, as desired.
We take this up here, and ﬁrst deﬁne solid Zℓ-sheaves on any small v-stack, together with some
5-functor formalism (involving relative homology in place of compactly supported cohomology;
its right adjoint is then pullback, so there are only 5 functors), and afterwards pass to a certain
subcategory of “lisse-´etale” sheaves to deﬁne the desired category Dlis(BunG, Qℓ), with exactly the
desired properties.
In the meantime, Nadler–Yun [NY19] and Gaitsgory–Kazhdan–Rozenblyum–Varshavsky [GKRV19]
showed that the categorical structures we have now constructed — D(BunG, Qℓ) together with the
action of Hecke operators — formally induce an action of the category of perfect complexes on
the stack of L-parameters on D(BunG, Qℓ), giving a categorical upgrade to the construction of
L-parameters based on excursion operators. (We were aware of some weak form of this, when
restricted to elliptic parameters; this was discussed in the last lecture of [Sch17b], based on some
unpublished results of Ansch¨utz.) Here, we make the eﬀort of proving a result with Zℓ-coeﬃcients,
at least under a minor assumption on ℓ.
I.12. Acknowledgments
We apologize for the long delay in the preparation of the manuscript. Already in April 2016,
an Oberwolfach Arbeitsgemeinschaft gave an introduction to these ideas. The required foundations
on ´etale cohomology of diamonds (with torsion coeﬃcients) were essentially worked out in the
winter term 2016/17, where also the ARGOS seminar in Bonn studied the evolving manuscript
[Sch17a], which was an enormous help. Next, we gave the CAGA course at the IH´ES in Spring
2017, [Sch11]. At the time we had essentially obtained enough results to achieve the construction of
L-parameters; the missing ingredient was the Jacobian criterion. In particular, we understood that
one has to use the local charts Mb to study BunG. In more detail, these results were discussed in
the ARGOS seminar in the summer term of 2017, and the proof of geometric Satake in the ARGOS
seminar in the summer term of 2018. We heartily thank all the participants of these seminars for

44
I. INTRODUCTION
working through these manuscripts, and their valuable feedback. In the meantime, in the spring
of 2018, we revised the Berkeley notes [SW20] and used [Sch17a] to give a full construction of
moduli spaces of p-adic shtukas. Then we eventually found a full proof of the Jacobian criterion
in July 2018 at a conference in Luminy. Our early attempts at writing up the results ran into the
issue that we wanted to ﬁrst prove basic sanity results on dimensions. Later, we got sidetracked
by the development of condensed mathematics with Dustin Clausen, which eventually made it
possible to use Qℓ-coeﬃcients in this paper, ﬁnally giving the most natural results. In fact, we
always wanted to develop the foundations so that papers such as the paper of Kaletha–Weinstein
[KW17] on the Kottwitz conjecture can build on a proper foundation, and prove results about
general smooth Qℓ-representations; we believe we have ﬁnally achieved this. In the winter term
2020/21, Scholze gave an (online) course in Bonn about these results, and wants to thank all the
participants for their valuable feedback. We thank the many mathematicians that we discussed
with about these results, including Johannes Ansch¨utz, David Ben-Zvi, Joseph Bernstein, Bhargav
Bhatt, Arthur-C´esar le Bras, Ana Caraiani, Dustin Clausen, Pierre Colmez, Jean-Fran¸cois Dat,
Vladimir Drinfeld, Jessica Fintzen, Dennis Gaitsgory, Toby Gee, David Hansen, Eugen Hellmann,
Alex Ivanov, Tasho Kaletha, Kiran Kedlaya, Dmitry Kubrak, Vincent Laﬀorgue, Judith Ludwig,
Andreas Mihatsch, Sophie Morel, Jan Nekov´aˇr, Wies lawa Nizio l, Vincent Pilloni, Michael Rapoport,
Timo Richarz, Will Sawin, Tony Scholl, Antoine Touz´e, Roman Travkin, Wilberd van der Kallen,
Yakov Varshavsky, Jared Weinstein, Zhiyou Wu, Xinwen Zhu, Konrad Zou, and undoubtedly many
others. Special thanks go to David Hansen for many comments on a preliminary draft. Moreover,
we thank Toby Gee, David Helm, Sug Woo Shin and especially Zhiyu Zhang for comments and
suggestions on a ﬁrst version.
During the preparation of this manuscript, Fargues was supported by the ANR grant ANR-14-
CE25 PerCoLaTor and the ERC Advanced Grant 742608 GeoLocLang, and Scholze was supported
by a DFG Leibniz Prize, and by the DFG under the Excellence Strategy – EXC-2047/1 – 390685813.
I.13. Notation
Throughout most of this paper, E denotes a nonarchimedean local ﬁeld with residue ﬁeld Fq
of characteristic p > 0, and we ﬁx an algebraic closure k = Fq of Fq. Then ˘E is the completed
unramiﬁed extension of E with residue ﬁeld k. We also ﬁx a separable closure E of E, with absolute
Galois group Γ = Gal(E|E), containing the Weil group WE, inertia subgroup IE, and wild inertia
PE. The letter P usually denotes open subgroups of PE.
The group G is usually a reductive group over E; reductive groups are always assumed to be
connected.
For any topological space X, we denote by X the sheaf taking any S (in the relevant test
category, usually a perfectoid space) to the continuous maps from |S| to X. This is in the spirit
of the passage from topological spaces to condensed sets, see [CS]. We make occasional use of the
condensed language, but do not make use of any nontrivial results from [CS]. In particular, our
discussion of solid ℓ-adic sheaves is self-contained.
We will occasionally use the “animated” terminology, see [CS], [ˇCS19b]. In particular, we use
the term anima for what is variously called spaces in [Lur09], ∞-groupoids, or homotopy types, and
for any ring A, the ∞-category of animated A-algebras is the ∞-category obtained from simplicial

I.13. NOTATION
45
A-algebras by inverting weak equivalences. Thus, animated A-algebras are freely generated under
sifted colimits by polynomial algebras A[X1, . . . , Xn].
If C is an (∞-)category equipped with an action of a group G, we write CBG for the (∞-)category
of G-equivariant objects in C. Note that the data here is really a functor BG →Cat∞, and CBG is
by deﬁnition the limit of this diagram. (It would be more customary to write CG, but this leads to
inconsistent notation.)


CHAPTER II
The Fargues–Fontaine curve and vector bundles
The goal of this chapter is to deﬁne the Fargues–Fontaine curve, in its various incarnations,
and the category of vector bundles on the Fargues–Fontaine curve. Throughout this chapter, we
ﬁx a nonarchimedean local ﬁeld E with residue ﬁeld Fq of characteristic p. We let OE ⊂E be the
ring of integers, and π a uniformizing element in E.
For any perfectoid space S over Fq, we introduce a curve YS, to be thought of as the product
S ×Spa Fq Spa OE, together with an open subset YS ⊂YS given by the locus where π ̸= 0. This
carries a Frobenius ϕ induced from the Frobenius on S, and XS is the quotient YS/ϕZ.
The ﬁrst results concern the Fargues–Fontaine curve XC = XS when S = Spa C for some
complete algebraically closed nonarchimedean ﬁeld C|Fq. We deﬁne a notion of classical points of
XC in that case; they form a subset of |XC|. The basic ﬁniteness properties of XC are summarized
in the following result.
Theorem II.0.1 (Proposition II.1.11, Corollary II.1.12, Deﬁnition/Proposition II.1.22). The
adic space YC is locally the adic spectrum Spa(B, B+) where B is a principal ideal domain; the
classical points of Spa(B, B+) ⊂YC are in bijection with the maximal ideals of B. For each classical
point x ∈YC, the residue ﬁeld of x is an untilt C♯of C over OE, and this induces a bijection of
the classical points of YC with untilts C♯of C over OE. A similar result holds true for YC ⊂YC,
and the quotient XC = YC/ϕZ.
In the equal characteristic case, this is an immediate consequence of YC = DC and classi-
cal results in rigid-analytic geometry. In the p-adic case, we use tilting to reduce to the equal
characteristic case. More precisely, if E is p-adic and E∞is the completion of E(π1/p∞), then
YC ×Spa OE Spa OE∞is perfectoid, with tilt given by a perfectoid open unit disc eDC. The corre-
sponding map |eDC| →|YC| induces a surjective map on classical points, see Proposition II.1.8. At
one key turn, in order to understand Zariski closed subsets of YC, we use the result that Zariski
closed subspaces are invariant under tilting, to reduce to eDC. More precisely, we recall the following
result.
Proposition II.0.2 ([Sch15, Section II.2], [BS19], [Sch17a, Deﬁnition 5.7, Theorem 5.8]).
Let S = Spa(R, R+) be an aﬃnoid perfectoid space with tilt S♭= Spa(R♭, R♭+). Then a closed
subspace Z ⊂|S| is the vanishing locus of an ideal I ⊂R if and only if Z ⊂|S| ∼= |S♭| is the
vanishing locus of an ideal J ⊂R♭. In that case, there is a universal perfectoid space SZ →S
such that |SZ| →|S| factors over Z, and SZ = Spa(T, T +) is aﬃnoid perfectoid with |SZ| →Z a
homeomorphism, R →T surjective, R+ →T + almost surjective, and T + is the integral closure of
R+ in T.
47

48
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
A key result is the classiﬁcation of vector bundles.
Theorem II.0.3 (Theorem II.2.14). The functor from IsocE to vector bundles on XC induces
a bijection on isomorphism classes. In particular, there is a unique stable vector bundle OXC(λ) of
any slope λ ∈Q, and any vector bundle E can be written as a direct sum of stable bundles.
We give a new self-contained proof of the classiﬁcation theorem, making critical use of the
v-descent results for vector bundles obtained in [Sch17a] and [SW20], and basic results on the
geometry of Banach–Colmez spaces established here.
Allowing general S ∈PerfFq, we deﬁne the moduli space of degree 1 Cartier divisors as Div1 =
Spd ˘E/ϕZ. Given a map S →Div1, one can deﬁne an associated closed Cartier divisor DS ⊂XS;
locally, this is given by an untilt DS = S♯⊂XS of S over E, and this embeds Div1 into the
space of closed Cartier divisors on XS. Another important result is the following ampleness result,
cf. [KL15, Proposition 6.2.4], which implies that one can deﬁne an algebraic version of the curve,
admitting the same theory of vector bundles.
Theorem II.0.4 (Theorem II.2.6, Proposition II.2.7, Proposition II.2.9). Assume that S ∈Perf
is aﬃnoid. For any vector bundle E on XS, the twist E(n) is globally generated and has no higher
cohomology for all n ≫0. Deﬁning the graded ring
P =
M
n≥0
H0(XS, OXS(n))
and the scheme Xalg
S
= Proj P, there is a natural map of locally ringed spaces XS →Xalg
S , pullback
along which deﬁnes an equivalence of categories of vector bundles, preserving cohomology.
If S = Spa C for some complete algebraically closed nonarchimedean ﬁeld C, then Xalg
C
is a
regular noetherian scheme of Krull dimension 1, locally the spectrum of a principal ideal domain,
and its closed points are in bijection with the classical points of XC.
We also need to understand families of vector bundles, i.e. vector bundles E on XS for general
S. Here, the main result is the following, which is originally due to Kedlaya–Liu [KL15].
Theorem II.0.5 (Theorem II.2.19, Corollary II.2.20). Let S ∈Perf and let E be a vector
bundle on XS.
Then the function taking a point s ∈S to the Harder–Narasimhan polygon of
E|Xs deﬁnes a semicontinuous function on S. If it is constant, then E admits a global Harder–
Narasimhan stratiﬁcation, and pro-´etale locally on S one can ﬁnd an isomorphism with a direct
sum of OXS(λ)’s.
In particular, if E is everywhere semistable of slope 0, then E is pro-´etale locally trivial, and the
category of such E is equivalent to the category of pro-´etale E-local systems on S.
The key to proving this theorem is the construction of certain global sections of E. To achieve
this, we use v-descent techniques, and an analysis of the spaces of global sections of E; these are
known as Banach–Colmez spaces, and were ﬁrst introduced (in slightly diﬀerent terms) in [Col02].
Definition II.0.6. Let E be a vector bundle on XS. The Banach–Colmez space BC(E) associated
with E is the locally spatial diamond over S whose T-valued points, for T ∈PerfS, are given by
BC(E)(T) = H0(XT , E|XT ).

II.1. THE FARGUES–FONTAINE CURVE
49
Similarly, if E is everywhere of only negative Harder–Narasimhan slopes, the negative Banach–
Colmez space BC(E[1]) is the locally spatial diamond over S whose T-valued points are
BC(E[1])(T) = H1(XT , E|XT ).
Implicit here is that this functor actually deﬁnes a locally spatial diamond. For this, we calculate
some key examples of Banach–Colmez spaces. For example, if E = OXS(λ) with 0 < λ ≤[E : Qp]
(resp. all positive λ if E is of equal characteristic), then BC(E) is representable by a perfectoid open
unit disc (of dimension given by the numerator of λ). A special case of this is the identiﬁcation
of BC(OXS(1)) with the universal cover of a Lubin–Tate formal group law, yielding a very close
relation between Lubin–Tate theory, and thus local class ﬁeld theory, and the Fargues–Fontaine
curve. This case actually plays a special role in getting some of the theory started, and we recall it
explicitly in Section II.2.1. On the other hand, for larger λ, or negative λ, Banach–Colmez spaces
are more exotic objects; for example, the negative Banach–Colmez space
BC(OXC(−1)[1]) ∼= (A1
C♯)♦/E
is the quotient of the aﬃne line by the translation action of E ⊂A1
C♯.
A key result is Proposition II.2.16, stating in particular that projectivized Banach–Colmez
spaces
(BC(E) \ {0})/E×
are proper — they are the relevant analogues of “families of projective spaces over S”. In particular,
their image in S is a closed subset, and if the image is all of S, then we can ﬁnd a nowhere vanishing
section of E after a v-cover, as then the projectivized Banach–Colmez space is a v-cover of S.
II.1. The Fargues–Fontaine curve
II.1.1. The curve YC. Recall that for any perfect Fq-algebra R, there is a unique π-adically
complete ﬂat OE-algebra eR such that eR = R/π. There is a unique multiplicative lift [·] : R →eR
of the identity R →R, called the Teichm¨uller lift. Explicitly, one can take
eR = WOE(R)
in terms of the ramiﬁed Witt vectors.
The construction of the Fargues–Fontaine curve is based on this construction on the level of
perfectoid spaces S over Fq. Its construction is done in three steps. First, one constructs a curve YS,
an adic space over OE, which carries a Frobenius action ϕ. Passing to the locus YS = YS \{π = 0},
i.e. the base change to E, the action of ϕ is free and totally discontinuous, so that one can pass to
the quotient XS = YS/ϕZ, which will be the Fargues–Fontaine curve.
We start by constructing YS in the aﬃnoid case. More precisely, if S = Spa(R, R+) is an
aﬃnoid perfectoid space over Fq, and ϖ ∈R+ is a pseudouniformizer (i.e. a topologically nilpotent
unit of R), we let
YS = Spa WOE(R+) \ V ([ϖ]).
This does not depend on the choice of ϖ, as for any choice of ϖ, ϖ′ ∈R, one has ϖ|ϖ′n, ϖ′|ϖn for
some n > 0. The q-th power Frobenius of R+ induces an automorphism ϕ of YS. To construct the
Fargues–Fontaine curve, we will eventually remove V (π) from YS and quotient by ϕ, but for now
we recall some properties of YS.

50
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
Proposition II.1.1. The above deﬁnes an analytic adic space YS over OE. Letting E∞be the
completion of E(π1/p∞), the base change
YS ×Spa OE Spa OE∞
is a perfectoid space, with tilt given by
S ×Fq Spa Fq[[t1/p∞]] = DS,perf,
a perfectoid open unit disc over S.
Proof. One can cover YS by the subsets YS,[0,n] := {|π|n ≤|[ϖ]| ̸= 0} ⊂YS, which are
rational subsets of Spa WOE(R+), where n > 0 is some integer that we assume to be a power of p
for simplicity. Then
YS,[0,n] = Spa(BS,[0,n], B+
S,[0,n])
where
BS,[0,n] = WOE(R+)⟨πn
[ϖ]⟩[ 1
[ϖ]]
and B+
S,[0,n] ⊂BS,[0,n] is the integral closure of WOE(R+)⟨πn
[ϖ]⟩. To see that YS is an adic space
(i.e. the structure presheaf is a sheaf) and YS ×Spa OE Spa OE∞is perfectoid, it is enough to
prove that BS,[0,n] b⊗OEOE∞is a perfectoid Tate algebra.
Indeed, the algebra BS,[0,n] splits oﬀ
BS,[0,n] b⊗OEOE∞as a direct factor as topological BS,[0,n]-module, and hence the sheaf property for
perfectoid spaces gives the result for YS,[0,n] and thus all of YS (cf. the sousperfectoid property of
[HK20], [SW20, Section 6.3]). Using the Frobenius automorphism of (R, R+), one can in fact
assume that n = 1.
Let us abbreviate
A = BS,[0,1] b⊗OEOE∞
and A+ ⊂A the integral closure of B+
S,[0,1] b⊗OEOE∞. In particular
A+
0 = (WOE(R+)b⊗OEOE∞)[( π
[ϖ])1/p∞]∧
[ϖ] ⊂A+,
and A = A+
0 [ 1
[ϖ]]. Note that
A+
0 /[ϖ] = (R+/ϖ ⊗Fq OE∞/π)[t1/p∞
1
]/(π1/pm −[ϖ]1/pmt1/pm
1
) ∼= R+/ϖ[t1/p∞
1
].
This implies already that A+
0 is integral perfectoid by [BMS18, Lemma 3.10 (ii)], and thus nec-
essarily (cf. [BMS18, Lemma 3.21]) A+
0 →A+ is an almost isomorphism and A+
0 [ 1
[ϖ]] ∼= A is
perfectoid. Moreover, one can see that the tilt of A is given by R⟨t1/p∞
1
⟩, where t♯
1 =
π
[ϖ], which
corresponds to the subset
{|t| ≤|ϖ| ̸= 0} ⊂S ×Fq Spa Fq[[t1/p∞]] = DS,perf.
□
Proposition II.1.2. For any perfectoid space T over Fq, giving an untilt T ♯of T together with
a map T ♯→YS of analytic adic spaces is equivalent to giving an untilt T ♯together with a map
T ♯→Spa OE, and a map T →S. In other words, there is a natural isomorphism
Y♦
S ∼= Spd OE × S.

II.1. THE FARGUES–FONTAINE CURVE
51
Proof. Changing notation, we need to see that for any perfectoid space T over OE, giving
a map T →YS is equivalent to giving a map T ♭→S.
Let T = Spa(A, A+).
Giving a map
T →YS is equivalent to giving a map WOE(R+) →A+ such that the image of [ϖ] in A is
invertible. By the universal property of WOE(R+) in case R+ is perfect, this is equivalent to giving
a map R+ →(A+)♭such that the image of ϖ in A♭is invertible. But this is precisely a map
T = Spa(A, A+) →S = Spa(R, R+).
□
In particular, there is a natural map
|YS| ∼= |Y♦
S | ∼= |(Spa OE)♦× S| →|S|.
The following proposition ensures that we may glue YS for general S, i.e. for any perfectoid
space S there is an analytic adic space YS equipped with an isomorphism
Y♦
S ∼= Spd OE × S
(and in particular a map |YS| →|S|) such that for U = Spa(R, R+) ⊂S an aﬃnoid subset, the
corresponding pullback of YS is given by YU.
Proposition II.1.3. If S′ ⊂S is an aﬃnoid subset, then YS′ →YS is an open immersion,
with
|YS′|
/

|YS|

S′
/ S
cartesian.
Proof. Let Z ⊂YS be the open subset corresponding to |YS| ×|S| |S′| ⊂|YS|.
Then by
functoriality of the constructions, we get a natural map YS′ →Z. To see that it is an isomorphism,
we can check after base change to OE∞(as the maps on structure sheaves are naturally split
injective). The base change of YS′ and Z become perfectoid, and hence it suﬃces to see that one
gets an isomorphism after passing to diamonds, where it follows from Proposition II.1.2.
□
Next, we recall the “sections of YS →S”.
Proposition II.1.4 ([SW20, Proposition 11.3.1]). Let S be a perfectoid space over Fq. The
following objects are in natural bijection.
(i) Sections of Y♦
S →S;
(ii) Morphisms S →Spd OE;
(iii) Untilts S♯over OE of S.
Moreover, given an untilt S♯over OE of S, there is a natural closed immersion of adic spaces
S♯,→YS
that presents S♯as a closed Cartier divisor in YS.

52
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
Proof. The equivalence of (i), (ii) and (iii) is a direct consequence of Proposition II.1.2. Thus,
let S♯be an untilt of S over OE. We may work locally, so assume S = Spa(R, R+) is aﬃnoid. Then
S♯= Spa(R♯, R♯+) is aﬃnoid perfectoid as well, and
R♯+ = WOE(R+)/ξ
for some nonzerodivisor ξ ∈WOE(R+) that can be chosen to be of the form π −a[ϖ] for some
a ∈WOE(R+) and suitable topologically nilpotent ϖ ∈R (choose ϖ ∈R+ a pseudouniformizing
element such that ϖ♯|π, and write π = ϖ♯θ(a) for some a). To see that S♯deﬁnes a closed Cartier
divisor in YS, that is to say the sequence
0 →OYS
ξ−→OYS →i∗OS♯→0
is exact with i : S♯,→YS, we need to see that for any open aﬃnoid U = Spa(A, A+) ⊂YS with
aﬃnoid perfectoid pullback V = Spa(B, B+) ⊂S♯, the sequence
0 →A
ξ−→A →B →0
is exact. To see this, we are free to localize near S♯= V (ξ) ⊂YS. In particular, replacing S by
V ♭, we can assume that V = S♯. In that case, any neighborhood of S♯= V (ξ) in YS contains
{|ξ| ≤|[ϖ]|n} for some n > 0, so we can assume that U is of this form.
Endow A with the spectral norm, where we normalize the norm on each completed residue ﬁeld
of YS by |[ϖ]| = 1
q. We claim that with this choice of norm, one has
|ξa| ≥q−n|a|
for all a ∈A. In particular, this implies that ξ : A →A is injective, and has closed image (as the
preimage of any Cauchy sequence in the image is a Cauchy image). On the other hand, R♯is the
separated completion of A/ξ, so B = A/ξ.
To verify the claimed inequality, it is enough to see that the norm of |a| is equal to the supremum
norm over {|ξ| = |[ϖ]|n}. In fact, it is enough to consider the points in the Shilov boundary, i.e. those
points Spa(C, OC) →U that admit a specialization Spa(C, C+) →YS whose image is not contained
in U; any such is necessarily contained in {|ξ| = |[ϖ]|n}. This will in fact hold for all functions on
U ×Spa OE Spa OE∞, for which the claim reduces to the tilt, which is an aﬃnoid subset of DS,perf.
By approximation, it then reduces to the case of aﬃnoid subsets of DS, where it is well-known that
the maximum is taken on the Shilov boundary. (Note that this question immediately reduces to
the case that S is a geometric point.)
□
Remark II.1.5. The preceding Cartier divisor satisﬁes the stronger property of being a “relative
Cartier divisor” in the sense that for all s ∈S its pullback to YSpa(K(s),K(s)+) is a Cartier divisor.
Now let us analyze the case S = Spa C for some complete algebraically closed nonarchimedean
ﬁeld over Fq.
Example II.1.6. Assume that E = Fq((t)) is of equal characteristic. Then YC = DC is an open
unit disc over C, with coordinate t. In particular, inside |YC|, we have the subset of classical points
|YC|cl ⊂|YC|, which can be identiﬁed as
|YC|cl = {x ∈C | |x| < 1}.

II.1. THE FARGUES–FONTAINE CURVE
53
Note that these classical points are in bijection with maps OE →C (over Fq), i.e. with “untilts of
C over OE”.
With suitable modiﬁcations, the same picture exists also when E is of mixed characteristic.
Definition/Proposition II.1.7. Any untilt C♯of C over OE deﬁnes a closed Cartier divisor
Spa C♯,→YS, and in particular a closed point of |YC|. This induces an injection from the set of
such untilts to |YC|.
The set of classical points |YC|cl ⊂|YC| is deﬁned to be the set of such points.
Proof. We have seen that any untilt C♯deﬁnes such a map Spa C♯,→YS. As it is a closed
Cartier divisor, the corresponding point is closed in |YC|. One can recover C♯as the completed
residue ﬁeld at the point, together with the map WOE(OC) →OC♯, which induces the isomorphism
OC ∼= O♭
C♯and thus C ∼= (C♯)♭, giving the untilt structure on C♯; this shows that the map is
injective.
□
Recall that YC is preperfectoid. In fact, if one picks a uniformizer π ∈E and lets E∞be the
completion of E(π1/p∞), then YC ×OE OE∞is perfectoid, and its tilt is given by
Spa C × Spa O♭
E∞∼= Spa C × Spa Fq[[t1/p∞]].
Thus, we get a map
|DC| = | Spa C × Spa Fq[[t]]| ∼= | Spa C × Spa Fq[[t1/p∞]]| ∼= |YC ×OE OE∞| →|YC|.
Proposition II.1.8. Under this map, the classical points |DC|cl = {x ∈C | |x| < 1} ⊂|DC|
are exactly the preimage of the classical points |YC|cl ⊂|YC|.
Unraveling the deﬁnitions, one sees that the map
{x ∈C | |x| < 1} = |DC|cl →|YC|cl
sends any x ∈C with |x| < 1 to the closed point deﬁned by the ideal (π −[x]). In particular, the
proposition shows that any classical point of YC can be written in this form.
Proof. This is clear as classical points are deﬁned in terms of maps of diamonds, which are
compatible with this tilting construction on topological spaces.
□
The formation of classical points is also compatible with changing C in the following sense.
Proposition II.1.9. Let C′|C be an extension of complete algebraically closed nonarchimedean
ﬁelds over Fq, inducing the map YC′ →YC. A point x ∈|YC| is classical if and only if its preimage
in |YC′| is a classical point. Moreover, if x ∈|YC| is a rank-1-point that is not classical, then there
is some C′|C such that the preimage of x contains a nonempty open subset of |YC′|.
In other words, one can recognize classical points as those points that actually stay points
after any base change; all other rank 1 points actually contain whole open subsets after some base
change.

54
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
Proof. It is clear that if x is classical, then its preimage is a classical point.
Conversely,
if x ∈|YC| is a rank 1 point, and S = Spd K(x), the point x is given by a morphism S →
Spa C × Spd OE.
If the preimage of x is a classical point, the induced morphism S →Spa C
becomes an isomorphism after pullback via Spa C′ →Spa C.
Since S is a v-sheaf ([Sch17a,
Proposition 11.9]) and Spa C′ →Spa C a v-cover, the morphism S →Spa C is an isomorphism,
and thus x is a classical point.
Now assume that x is nonclassical rank-1-point; we want to ﬁnd C′|C such that the preimage
of x contains an open subset of |YC′|. By Proposition II.1.8, it is enough to prove the similar result
for DC, using that |DC′| →|YC′| is open.1 Thus, assume x ∈|DC| is a non-classical point. Let C′
be a completed algebraic closure of the corresponding residue ﬁeld. Then the preimage of x in |DC′|
has a tautological section ex ∈DC′(C′) which is a classical point, and the preimage of x contains
a small disc B(ex, r) ⊂DC′ for some r > 0. Indeed, this follows from the description of the rank 1
points of DC as being either the Gauss norm for some disc B(x, r0) ⊂DC of radius r0 > 0, or the
inﬁmum of such over a decreasing sequence of balls (but with radii not converging to zero). See
Lemma II.1.10.
□
Lemma II.1.10. Let x ∈DC(C), ρ ∈(0, 1], and xρ ∈|DC| be the Gauss norm with radius ρ
centered at x. The preimage of xρ in |DC(xρ)| contains the open disk with radius ρ centered at
xρ ∈DC(xρ)(C(xρ)).
Proof. We can suppose x = 0. The point xρ is given by the morphism C⟨T⟩→C(xρ) that
sends T to t. Let y ∈|DC(xρ)|. This corresponds to a morphism C(xρ)⟨T⟩→C(xρ)(y). Let us note
u ∈C(xρ)(y) the image of T via the preceding map. Suppose y lies in the open disk with radius ρ
centered at xρ. This means |u −t| < ρ = |t|. Let us remark that this implies that for any n ≥1,
|un −tn| < ρn. For f = P
n≥0 anT ∈C⟨T⟩, one then has
|
X
n≥0
an(un −tn)| < sup
n≥0
|an|ρn = |
X
n≥0
antn|.
We deduce that
|
X
n≥0
anun| = |
X
n≥0
antn| = |f(xρ)|.
□
There is in fact another characterization of the classical points in terms of maximal ideals.
Proposition II.1.11. Let U = Spa(B, B+) ⊂YC be an aﬃnoid subset. Then for any maximal
ideal m ⊂B, the quotient B/m is a nonarchimedean ﬁeld, inducing an injection Spm(B) ,→|U|.
This gives a bijection between Spm(B) and |U|cl := |U| ∩|YC|cl ⊂|YC|.
Proof. First, if x ∈|U|cl, then it corresponds to a closed Cartier divisor Spa C♯,→U ⊂YC,
and thus deﬁnes a maximal ideal of B, yielding an injection |U|cl ,→Spm(B). We need to see that
this is a bijection.
Note that using the tilting map |DC| →|YC|, one sees that the preimage of U in |DC| has
only ﬁnitely many connected components (any quasicompact open subset of |DC| has ﬁnitely many
1Any quasicompact open of |DC′| is the base change of a quasicompact open of |YC′ ×Spa OE Spa OE′| for a ﬁnite
extension E′|E. Passing to the Galois hull of E′ and taking the orbit of the open subset under the Galois group, it
then follows from the map being a quotient map, as any map of analytic adic spaces.

II.1. THE FARGUES–FONTAINE CURVE
55
connected components); we can thus assume that U is connected. In that case, we claim that any
nonzero element f ∈B vanishes only at classical points of |U|. By Proposition II.1.9, it suﬃces to
see that for any nonempty open subset U′ ⊂U, the map O(U) →O(U′) is injective. In fact, if V (f)
contains a nonclassical point, it also contains a nonclassical rank 1 point as V (f) is generalizing,
then after base changing to some C′|C, V (f) contains an open subset U′, and this is impossible if
O(U) ,→O(U′). For this it suﬃces to prove that O(V ) ,→O(V ′) where V is a connected component
of U b⊗OEOE∞, and V ′ the intersection of U′ b⊗OEOE∞with this connected component. Now for
any g ∈O(V ) \ {0}, V (g) ̸= V , as perfectoid spaces are uniform (and hence vanishing at all points
implies vanishing). We thus have to prove that for any Zariski closed subset Z ⊊V , V ′ ̸⊂Z.
By Proposition II.0.2, it suﬃces to prove the similar property for open subsets V ′ ⊂V ⊂DC,perf,
with V connected. But then V ′ = W ′
perf and V = Wperf for W ′ ⊂W ⊂DC, and O(V ) →O(V ′) is
topologically free (with basis ti, i ∈[0, 1) ∩Z[p−1]) over the corresponding map O(W) →O(W ′)
of classical Tate algebras over C, for which injectivity is classical.
□
The previous proposition implies that, once U is connected, the rings B are principal ideal
domains (cf. [Ked16]).
Corollary II.1.12. Let U = Spa(B, B+) ⊂YC be an aﬃnoid subset. Then U has ﬁnitely many
connected components. Assuming that U is connected, the ring B is a principal ideal domain.
Proof. We have already seen in the preceding proof that U has ﬁnitely many connected
components. Moreover, each maximal ideal of B is principal, as it comes from a closed Cartier
divisor on U. Now take any nonzero f ∈B. We have seen that the vanishing locus of f is contained
in |U|cl, and it is also closed in |U|. It it thus a spectral space with no nontrivial specializations,
and therefore a proﬁnite set. We claim that it is in fact discrete. For this, let x ∈V (f) be any
point. We get a generator ξx ∈B for the corresponding maximal ideal. We claim that there is
some n ≥1 such that f = ξn
xg where g does not vanish at x. Assume otherwise. Note that the
spectral norm on U is given by the supremum over ﬁnitely many points, the Shilov boundary of U
(cf. proof of Proposition II.1.4). We may normalize ξx so that its norm at all of these ﬁnitely many
points is ≥1. Then for any n, if f = ξn
xgn, one has ||gn|| ≤||f||. But inside the open neighborhood
Ux = {|ξx| ≤|[ϖ]|} of x, this implies that ||f||Ux ≤|[ϖ]|n||f|| for all n, and thus ||f||Ux = 0 as
n →∞. Thus, f vanishes on all of Ux, which is a contradiction.
By the above, we can write f = ξn
xg where g does not vanish at x. But then g does not vanish
in a neighborhood of x, and therefore x ∈V (f) is an isolated point, and hence V (f) is proﬁnite and
discrete, and thus ﬁnite. Enumerating these points x1, . . . , xm, we can thus write f = ξn1
x1 · · · ξnm
xm g
where g does not vanish at x1, . . . , xm, and thus vanishes nowhere, and hence is a unit. This ﬁnishes
the proof.
□
Remark II.1.13. The main new ingredient compared to [Ked16] or [FF18, Theorem 2.5.1]
that allows us to shorten the proof is Proposition II.0.2, i.e. the use of the fact (proved in [BS19])
that “Zariski closed implies strongly Zariski closed” in the terminology of [Sch15, Section II.2].
Later (cf. Proposition IV.7.3), we will also need the following lemma about non-classical points
of YC = YC ×Spa OE Spa E.

56
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
Lemma II.1.14. There is a point x ∈|YC|, with completed residue ﬁeld K(x), such that the
induced map Gal(K(x)|K(x)) →IE is surjective, where IE is the inertia subgroup of the absolute
Galois group of E.
Note that a priori we have a map Gal(K(x)|K(x)) →Gal(E|E), but it is clear that its image
is contained in IE, as K(x) contains ˘E.
Proof. In fact, we can be explicit: Looking at the surjection
|D∗
C| →|YC|
from the tilting construction, the image of any Gaußpoint (corresponding to a disc of radius r,
0 < r < 1, around the origin) will have the desired property. This follows from the observation
that this locus of Gaußpoints lifts uniquely to |YC ×Spa ˘E Spa E′| for any ﬁnite extension E′| ˘E. In
fact, this cover admits a similar surjection from a punctured open unit disc over C, and there is
again one Gaußpoint for each radius (i.e. the set of Gaußpoints maps isomorphically to (0, ∞) via
rad : |YC| →(0, ∞)).
□
II.1.2. The Fargues–Fontaine curve. Now we can deﬁne the Fargues–Fontaine curve.
Definition II.1.15. For any perfectoid space S over Fq, the relative Fargues–Fontaine curve is
XS = YS/ϕZ
where
YS = YS ×Spa OE Spa E = YS \ V (π),
which for aﬃnoid S = Spa(R, R+) with pseudouniformizer ϖ is given by
YS = Spa WOE(R+) \ V (π[ϖ]).
To see that this is well-formed, we note the following proposition.
Proposition II.1.16. The action of ϕ on YS is free and totally discontinuous.
In fact, if
S = Spa(R, R+) is aﬃnoid and ϖ ∈R is a pseudouniformizer, one can deﬁne a map
rad : |YS| −→(0, ∞)
taking any point x ∈YS with rank-1-generalization ex to log |[ϖ](ex)|/ log |π(ex)|.
This factorizes
through the Berkovich space quotient of |YS| and satisﬁes rad ◦ϕ = q · rad.
For any interval I = [a, b] ⊂(0, ∞) with rational ends (possibly with a = b), there is the open
subset
YS,I = {|π|b ≤|[ϖ]| ≤|π|a} ⊂rad−1(I) ⊂YS
which is in fact a rational open subset of Spa WOE(R+) and thus aﬃnoid,
YS,I = Spa(BS,I, B+
S,I),
and one can form XS as the quotient of YS,[1,q] via the identiﬁcation ϕ : YS,[1,1] ∼= YS,[q,q].
In
particular, XS is qcqs in case S is aﬃnoid.
Proof. This follows directly from the deﬁnitions.
□

II.1. THE FARGUES–FONTAINE CURVE
57
In terms of the preceding radius function, the end 0 corresponds to the boundary divisor (π),
and ∞to the boundary divisor ([ϖ]).
For each s ∈S corresponding to a map Spa(K(s), K(s)+) →S, functoriality deﬁnes a morphism
XK(s),K(s)+ →XS.
We way think of XS as the collection of curves (XK(s),K(s)+)s∈S, the one
deﬁned and studied in [FF18], merged in a “family of curves”. Although XS does not sit over S,
the absolute Frobenius ϕ × ϕ of S × Spd(E) acts trivially on the topological space and one has
|XS| ∼= |X♦
S | ∼= |S × Spd(E)/ϕZ × id| ∼= |S × Spd(E)/id × ϕZ| −→|S|.
Thus the topological space |XS| sits over |S|, and for all S the map |XS| →|S| is qcqs. Here, we
used the following identiﬁcation of the diamond.
Proposition II.1.17. There is a natural isomorphism
Y ♦
S ∼= S × Spd(E),
descending to an isomorphism
X♦
S ∼= (S × Spd(E))/ϕZ × id.
Proof. This is immediate from Proposition II.1.2.
□
Moreover, we have the following version of Proposition II.1.4.
Proposition II.1.18. The following objects are naturally in bijection.
(i) Sections of Y ♦
S →S;
(ii) Maps S →Spd(E);
(iii) Untilts S♯over E of S.
Given such a datum, in particular an untilt S♯over E of S, there is a natural closed immersion
S♯,→YS presenting S♯as a closed Cartier divisor in YS. The composite map S♯→YS →XS is
still a closed Cartier divisor, and depends only on the composite S →Spd(E) →Spd(E)/ϕZ. In
this way, any map S →Spd(E)/ϕZ deﬁnes a closed Cartier divisor D ⊂XS; this gives an injection
of Spd(E)/ϕZ into the space of closed Cartier divisors on XS.
Proof. This is immediate from Proposition II.1.4.
□
Definition II.1.19. A closed Cartier divisor of degree 1 on XS is a closed Cartier divisor
D ⊂XS that arises from a map S →Spd(E)/ϕZ. Equivalently, it arises locally on S from an
untilt S♯over E of S.
In particular, we see that the moduli space Div1 of degree 1 closed Cartier divisors is given by
Div1 = Spd(E)/ϕZ.
Note that something strange is happening in the formalism here: Usually the curve itself would
represent the moduli space of degree 1 Cartier divisors!
Remark II.1.20. In [Far18a, D´eﬁnition 2.6] Fargues gives a deﬁnition of a Cartier divisor of
degree 1 on XS equivalent to the preceding one, similar to the deﬁnition of a relative Cartier divisor
in classical algebraic geometry.

58
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
Proposition II.1.21. The map Div1 →∗is proper, representable in spatial diamonds, and
cohomologically smooth.
Proof. First, Spd(E) →∗is representable in locally spatial diamonds and cohomologically
smooth by [Sch17a, Proposition 24.5] (for E = Qp, which formally implies the case of E ﬁnite over
Qp, and the equal characteristic case is handled in the proof). As | Spd(E) × S| ∼= |YS| →|S|, we
see that ϕZ acts totally discontinuously with quotient | Spd(E)/ϕZ × S| ∼= |XS| →|S| being qcqs
in case |S| is qcqs; thus, Spd(E)/ϕZ →∗is representable in spatial diamonds, in particular qcqs.
Then being proper follows from the valuative criterion [Sch17a, Proposition 18.3].
□
In particular, the map
|XS| = |Div1 × S| −→|S|
is open and closed. We can thus picture XS as being “a proper and smooth family over S”.
Further motivation for Deﬁnition II.1.19 is given by the following.
Definition/Proposition II.1.22. The classical points of XC are |XC|cl := |YC|cl/ϕZ ⊂
|XC| = |YC|/ϕZ. They are in bijection with (Spd(E)/ϕZ)(C) = Div1(C), i.e. are given untilts
of C over E up to Frobenius, or by degree 1 closed Cartier divisors on XC. For any aﬃnoid open
subset U = Spa(B, B+) ⊂XC, the maximal ideals of B are in bijection with |U|cl = |U| ∩|XC|cl.
Any such U has only ﬁnitely many connected components, and if U is connected, then B is a
principal ideal domain.
Proof. This follows immediately from Proposition II.1.11 and Corollary II.1.12 if U lifts to
YC. In general, YC →XC is locally split, so the result is true locally on U; and then it easily follows
by gluing in general.
□
II.2. Vector bundles on the Fargues–Fontaine curve
Let us recall a few basic facts about the cohomology of vector bundles. Suppose S = Spa(R, R+)
is aﬃnoid perfectoid. Then YS is ”Stein”, one has YS = S
I⊂(0,∞) Y(R,R+),I where
(i) as before I is a compact interval with rational ends
(ii) Y(R,R+),I is aﬃnoid sous-perfectoid
(iii) for I1 ⊂I2, the restriction morphism O(Y(R,R+),I2) →O(Y(R,R+),I1) has dense image.
Let F be a vector bundle on YS. Point (2) implies that Hi(YS,I, F|Y(R,R+),I) = 0 when i > 0. Point
(3) implies that R1 lim
←−I Γ(Y(R,R+),I, F) = 0 ([Gro61, 0.13.2.4]). We thus have Hi(YS, F) = 0 when
i > 0.
Thus, if E is a vector bundle on XS, one has
RΓ(XS, E) =

H0(YS, E|YS)
Id−ϕ
−−−−→H0(YS, E|YS)].
In particular, this vanishes in degree > 1.
Moreover, one has the following important (cohomological) descent result.

II.2. VECTOR BUNDLES ON THE FARGUES–FONTAINE CURVE
59
Proposition II.2.1. Let S be a perfectoid space over Fq and E a vector bundle on XS. The
functor taking any T ∈PerfS to
RΓ(XT , E|XT )
is a v-sheaf of complexes. In fact, the functor taking any T ∈PerfS to H0(YT , E|YT ) is a v-sheaf,
whose cohomology vanishes in case T is aﬃnoid.
Moreover, sending S to the groupoid of vector bundles on XS deﬁnes a v-stack.
Proof. By the displayed formula for RΓ(XS, E) as Frobenius ﬁxed points, it suﬃces to prove
the result about YT . We can assume that S = Spa(R, R+) is aﬃnoid, pick a pseudouniformizer
ϖ ∈R, and one can further reduce to the similar claim for YT,I for any compact interval I with
rational ends. We need to see that for any v-cover T = Spa(R′, R′+), the corresponding ˇCech
complex
0 →O(YS,I) →O(YT,I) →O(YT×ST,I) →. . .
of E-Banach spaces is exact. This can be checked after taking a completed tensor product with
E∞= E(π1/p∞)∧. In that case, all algebras become perfectoid, and YT,I ×E E∞→YS,I ×E E∞is a
v-cover of aﬃnoid perfectoid spaces, so the result follows from [Sch17a, Theorem 8.7, Proposition
8.8].
Similarly, one proves v-descent for the groupoid of vector bundles, cf. [SW20, Lemma 17.1.8,
Proposition 19.5.3].
□
If [E1 →E0] is a complex of vector bundles on XS sitting in homological degrees [0, 1], such that
H0(XT , E1|XT ) = 0 for all T ∈PerfS, we let
BC([E1 →E0]) : T 7→H0(XT , [E1 →E0]|XT )
be the corresponding v-sheaf on PerfS. We refer to this as the Banach–Colmez space associated
with [E1 →E0]. We will usually apply this only when either of E1 and E0 is zero.
Let us also recall the basic examples of vector bundles. Already here it is useful to ﬁx an
algebraically closed ﬁeld k|Fq, e.g. k = Fq. Let ˘E = WOE(k)[ 1
π], the complete unramiﬁed extension
of E with residue ﬁeld k. Recall that, functorially in S ∈Perfk, there is a natural exact ⊗-functor
Isock −→Bun(XS)
(D, ϕ) 7−→E(D, ϕ)
from the category of isocrystals (of a ﬁnite-dimensional ˘E-vector space D equipped with a σ-linear
automorphism ϕ : D
∼
−→D) to the category of vector bundles on XS, deﬁned via descending
D ⊗˘E OYS to XS via ϕ ⊗ϕ. We denote by OXS(n) the image of ( ˘E, π−nσ) (note the change of sign
— the functor E reverses slopes); more generally, if (Dλ, ϕλ) is the simple isocrystal of slope λ ∈Q
in the Dieudonn´e–Manin classiﬁcation, we let OXS(−λ) = E(Dλ, ϕλ).
II.2.1. Lubin–Tate formal groups. The claim of this paper is that the Fargues–Fontaine
curve enables a geometrization of the local Langlands correspondence. As a warm-up, let us recall
the relation between OXS(1) and local class ﬁeld theory in the form of Lubin–Tate theory.

60
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
Up to isomorphism, there is a unique 1-dimensional formal group G over O ˘E with action by
OE, such that the two induced actions on Lie G coincide; this is “the” Lubin–Tate formal group
G = GLT of E. Fixing a uniformizer π ∈E, we normalize this as follows. First, any Lubin–
Tate formal group law over OE is the unique (up to unique isomorphism) lift of a 1-dimensional
formal group over k whose Lie algebra has the correct OE-action. Now, if E is p-adic then Gk is
classiﬁed by Dieudonn´e theory by a ﬁnite projective WOE(k)-module M equipped with a σ-linear
isomorphism F : M[ 1
π] ∼= M[ 1
π] such that M ⊂F(M) ⊂1
πM.2 Here, we take M = WOE(k) with
F = 1
πσ. One can similarly deﬁne G in equal characteristic, but actually we will explain a diﬀerent
way to pin down the choice just below; under our normalization, G is already deﬁned over OE.
After passing to the generic ﬁbre, GE is isomorphic to the additive group Ga, compatibly with
the OE-action, and one can choose a coordinate on G ∼= Spf OE[[X]] so that explicitly, the logarithm
map is given by
logG : GE →Ga,E : X 7→X + 1
πXq + 1
π2 Xq2 + . . . +
1
πn Xqn + . . . .
Regarding the convergence of logG, we note that in fact it deﬁnes a map of rigid-analytic varieties
(i.e. adic spaces locally of ﬁnite type over E)
logG : Gad
E ∼= DE →Gad
a,E
from the open unit disc
Gad
E ∼= Spa OE[[X]] ×Spa OE Spa E
to the adic space corresponding to Ga. From the formula, one sees that in small enough discs
it deﬁnes an isomorphism, and via rescaling by powers of π (which on the level of Gad
E deﬁnes
ﬁnite ´etale covers of degree q, while it is an isomorphism on Gad
a,E), one sees that one has an exact
sequence
0 →Gad
E [π∞] →Gad
E →Gad
a,E →0
on the big ´etale site of adic spaces over Spa E, where Gad
E [π∞] ⊂Gad
E is the torsion subgroup.
This is, in fact, the generic ﬁbre of G[π∞] = S
n G[πn] over Spa OE, and each G[πn] = Spa An is
represented by some ﬁnite OE-algebra An of degree qn. Inductively, G[πn−1] ⊂G[πn] giving a map
An →An−1; after inverting π, this is split, and the other factor is a totally ramiﬁed extension
En|E. Then
Gad
E [π∞] =
[
n
Spa An[ 1
π] =
G
n
Spa En.
We also need the “universal cover” of G, deﬁned as
eG = lim
←−
×π
G ∼= SpfOE[[ e
X1/p∞]],
where the inverse limit is over the multiplication by π maps. The isomorphism with SpfOE[[ e
X1/p∞]]
is evident modulo π, but as this gives a perfect algebra, we see that in fact the isomorphism lifts
uniquely to OE. Explicitly, the coordinate e
X is given by
e
X = lim
n→∞Xqn
n
2As in [SW20, p. 99], we renormalize usual covariant Dieudonn´e theory for p-divisible groups by dividing F by
p; and then in the case of π-divisible OE-modules as here, we base change along W(k) ⊗Zp OE →WOE(k).

II.2. VECTOR BUNDLES ON THE FARGUES–FONTAINE CURVE
61
where Xn is the coordinate on the n-th copy of G in the formula eG = lim
←−×π G; in fact, e
X ≡Xqn
n
modulo πn. In particular, the logarithm map
logG : eGE →GE →Ga,E
is given by the series
X
i∈Z
πi e
Xq−i.
Note that for any π-adically complete OE-algebra A, one has
eG(A) ∼= eG(A/π) = HomOE(E/OE, G(A/π))[ 1
π].
Indeed, the ﬁrst equality follows from OE[[ e
X1/p∞]] being relatively perfect over OE, and the second
equality by noting that any element of G(A/π) is πn-torsion for some n. A diﬀerent description
based on eG = Spf OE[[ e
X1/p∞]] is
eG(A) = lim
←−
x7→xp
A◦◦= A♭,◦◦⊂A♭,
the subset of topologically nilpotent elements of the tilt.
This is related to the line bundle OXS(1) as follows.
Proposition II.2.2. Let S = Spa(R, R+) be an aﬃnoid perfectoid space over Fq and let S♯=
Spa(R♯, R♯+) be an untilt of S over E, giving rise to the closed immersion S♯,→XS. Let OXS(1)
be the line bundle on XS corresponding to the isocrystal (E, π−1). Then the map
eG(R♯+) ∼= R◦◦→H0(YS, OYS) : X 7→
X
i∈Z
πi[Xq−i]
deﬁnes a natural isomorphism
eG(R♯+) ∼= H0(XS, OXS(1)) = H0(YS, OYS)ϕ=π.
Under this isomorphism, the map
H0(XS, OXS(1)) →H0(S♯, OS♯) = R♯
of evaluation at S♯is given by the logarithm map
logG : eG(R♯+) →G(R♯+) →R♯.
Proof. The compatibility with the logarithm map is clear from the explicit formulas. Assume
ﬁrst that E is of characteristic p. Then H0(YS, OYS), where Y = D∗
S is a punctured open unit
disc over S, can be explicitly understood as certain power series P
i∈Z riπi with coeﬃcients ri ∈R
(subject to convergence conditions as i →±∞). Then
H0(XS, OXS(1)) = H0(YS, OYS)ϕ=π
amounts to those series such that ri = rq
i+1 for all i ∈Z. Thus, all ri are determined by r0, which
in turn can be any topologically nilpotent element of R. This gives the desired isomorphism
H0(XS, OXS(1)) ∼= R◦◦= eG(R+) = eG(R♯+)
(as eG = SpaOE[[ e
X1/p∞]] and R♯= R).

62
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
If E is p-adic, then we argue as follows. First, as in the proof of Proposition II.2.5 below, one
can rewrite H0(XS, OXS(1)) as Bϕ=π
R,[1,∞] where
BR,[1,∞] = O(Y[1,∞]), for Y[1,∞] = {|[ϖ]| ≤|π| ̸= 0} ⊂Spa WOE(R+).
By the contracting property of Frobenius, one can also replace BR,[1,∞] with the crystalline period
ring B+
crys of R♯+/π here, and then [SW13, Theorem A] gives the desired
Bϕ=π
R,[1,∞] = HomOE(E/OE, G(R♯+/π))[ 1
π] = eG(R♯+/π) = eG(R♯+).
That this agrees with the explicit formula follows from [SW13, Lemma 3.5.1].
□
Recall also that the ﬁeld E∞obtained as the completion of the union of all En is perfectoid — in
fact, one has a closed immersion Spf OE∞,→eG = Spf OE[[ e
X1/p∞]], which induces an isomorphism
Spf O♭
E∞∼= Spf Fq[[X1/p∞]]. Over E∞, we have an isomorphism OE ∼= (TπG)(OE∞) ⊂eG(OE∞). By
the proposition, if S♯lives over E∞, we get a nonzero section of OXS(1), vanishing at S♯⊂XS.
Proposition II.2.3. For any perfectoid space S with untilt S♯over E∞, the above construction
construction deﬁnes an exact sequence
0 →OXS →OXS(1) →OS♯→0
of OXS-modules.
Proof. The above constructions show that one has a map OXS →I(1) where I ⊂OXS is
the ideal sheaf of S♯, which by Proposition II.1.18 is a line bundle. To see that this map is an
isomorphism, it suﬃces to check on geometric points, so we can assume that S = Spa C for some
complete algebraically closed extension C of Fq. We have now ﬁxed some nonzero global section
of OXS(1), which by the above corresponds to some nonzero topologically nilpotent X = ϖ ∈C,
explicitly given by
f =
X
i∈Z
πi[Xq−i] ∈H0(YC, OYC)ϕ=π.
This is the base change of the function
X
i∈Z
πiXq−i ∈O((Spa OE[[X1/p∞]])E \ V (X)),
so it is enough to determine the vanishing locus of this function. But note that under the identiﬁ-
cation eG = Spf OE[[X1/p∞]], this is precisely the logarithm function
logG : eGad
E \ {0} →Gad
a,E;
thus, it is enough to determine the vanishing locus of the logarithm function. But this is precisely
G
n
Spa E∞⊂eGad
E \ {0},
with a simple zero at each of these points. This gives exactly the claimed statement (the Z many
copies are translates under π, which are also translates under ϕ as ϕ(f) = πf).
□

II.2. VECTOR BUNDLES ON THE FARGUES–FONTAINE CURVE
63
Corollary II.2.4 ([Far18a, Proposition 2.12]). There is a well-deﬁned map BC(O(1))\{0} →
Div1 sending a nonzero section f ∈H0(XS, OXS(1)) to the closed Cartier divisor given by V (f).
This descends to an isomorphism
(BC(O(1)) \ {0})/E× ∼= Div1.
Proof. Note that BC(O(1)) ∼= Spd Fq[[X1/p∞]] by Proposition II.2.2, and hence BC(O(1)) \
{0} ∼= Spa Fq((X1/p∞)) is representable by a perfectoid space. In fact, it is naturally isomorphic
to Spd E∞= Spa E♭
∞, and the previous proposition ensures that the map to Div1 is well-deﬁned
and corresponds to the projection Spd E∞→Spd E →Spd E/ϕZ = Div1. Here, the ﬁrst map
Spd E∞→Spd E is a quotient under O×
E, and the second map Spd E →Spd E/ϕZ then corresponds
to the quotient by πZ, as ϕ = π on BC(O(1)).
□
In particular, if one works on Perfk, then Div1 = Spd ˘E/ϕZ, whose π´et
1 is given by the absolute
Galois group of E. On the other hand, the preceding gives a canonical E×-torsor, giving a natural
map from the absolute Galois group of E to the proﬁnite completion of E×. By comparison with
Lubin–Tate theory, this is the usual Artin reciprocity map, see [Far18a, Section 2.3] for more
details.
II.2.2. Absolute Banach–Colmez spaces. In this section, we analyze the Banach–Colmez
spaces in the case E = E(D) for some isocrystal D = (D, ϕ). We then sometimes write BC(D) and
BC(D[1]) for the corresponding functors on Perfk; or also BC(O(λ)), BC(O(λ)[1]) for λ ∈Q when
D = D−λ. These are in fact already deﬁned for all S ∈PerfFq.
Proposition II.2.5. Let λ ∈Q.
(i) If λ < 0, then H0(XS, OXS(λ)) = 0 for all S ∈PerfFq. Moreover, the projection from
BC(O(λ)[1]) : S 7→H1(XS, OXS(λ))
to the point ∗is relatively representable in locally spatial diamonds, partially proper, and cohomo-
logically smooth.
(ii) For λ = 0, the map
E →BC(O)
is an isomorphism of pro-´etale sheaves, and the pro-´etale sheaﬁﬁcation of S 7→H1(XS, OXS) van-
ishes. In particular, for all S one gets an isomorphism
RΓpro´et(S, E) →RΓ(XS, OXS).
(iii) For λ > 0, one has H1(XS, OXS(λ)) = 0 for all aﬃnoid S ∈PerfFq, and the projection from
BC(O(λ)) : S 7→H0(XS, OXS(λ))
to the point ∗is relatively representable in locally spatial diamonds, partially proper, and cohomo-
logically smooth.
(iv) If 0 < λ ≤[E : Qp] (resp. for all positive λ if E is of equal characteristic), there is an
isomorphism
BC(O(λ)) ∼= Spd k[[x1/p∞
1
, . . . , x1/p∞
r
]]
where λ = r/s with coprime integers r, s > 0.

64
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
Proof. For all statements, we can reduce to the case λ = n ∈Z by replacing E by its
unramiﬁed extension of degree s.
Regarding the vanishing of H1(XS, OXS(n)) for n > 0 and
S = Spa(R, R+) aﬃnoid, pick a pseudouniformizer ϖ ∈R. In terms of the presentation of XS as
gluing YS,[1,q] along ϕ : YS,[1,1] ∼= YS,[q,q], it suﬃces to see that
ϕ −πn : BR,[1,q] →BR,[1,1]
is surjective. Any element of BR,[1,1] can be written as the sum of an element of BR,[0,1][ 1
π] and an
element of [ϖ]BR,[1,∞], corresponding to the aﬃnoid subsets
YS,[0,1] = {|π| ≤|[ϖ]| ̸= 0} ⊂Spa WOE(R+)
resp.
YS,[1,∞] = {|[ϖ]| ≤|π| ̸= 0} ⊂Spa WOE(R+).
If f ∈BR,[0,1], then the series
g = ϕ−1(f) + πnϕ−2(f) + π2nϕ−3(f) + . . .
converges in BR,[0,q] and thus in BR,[1,q], and f = ϕ(g) −πng. The same then applies to elements
of BR,[0,1][ 1
π]. On the other hand, if f ∈[ϖ]BR,[1,∞], then the series
g = −π−nf −ϕ(f) −πnϕ2(f) −. . .
converges in BR,[1,q], and f = ϕ(g) −πng.
In fact, the same arguments prove that the map
[BR,[1,∞]
ϕ−πn
−−−→BR,[1,∞]] →[BR,[1,q]
ϕ−πn
−−−→BR,[1,1]]
is a quasi-isomorphism. Indeed, we have a short exact sequence
0 →WOE(R+)[ 1
π] →BR,[1,∞] ⊕BR,[0,q][ 1
π] →BR,[1,q] →0
(obtained from sheafyness of WOE(R+)[ 1
π] when endowed with the π-adic topology on WOE(R+)),
and similarly
0 →WOE(R+)[ 1
π] →BR,[1,∞] ⊕BR,[0,1][ 1
π] →BR,[1,1] →0.
Therefore, it suﬃces to see that the maps
BR,[0,q][ 1
π]
ϕ−πn
−−−→BR,[0,1][ 1
π]
and
WOE(R+)[ 1
π]
ϕ−πn
−−−→WOE(R+)[ 1
π]
are isomorphisms. In both cases, this follows from convergence of ϕ−1 + πnϕ−2 + π2nϕ−3 + . . . on
these algebras, giving an explicit inverse.
For part (iv), note that in equal characteristic one can describe O(YS,I) = BR,I, for S =
Spa(R, R+) aﬃnoid, explicitly as power series P
i∈Z riπi with ri ∈R, satisfying some convergence
conditions as i →±∞. Taking the part where ϕ = πn, we require ϕ(ri) = ri+n, and we see that we
can freely choose r1, . . . , rn. The required convergence holds precisely when all ri are topologically
nilpotent, giving the isomorphism in that case. If E is p-adic, we can reduce to E = Qp (but now
λ rational, 0 < λ ≤1), taking a pushforward of the sheaf along XS,E = XS,Qp ×Qp E →XS,Qp.
In that case, the result follows from the equality H0(XS, OXS(λ)) = Bϕr=ps
R,[1,∞] proved above, and
[SW13, Theorem A, Proposition 3.1.3 (iii)].

II.2. VECTOR BUNDLES ON THE FARGUES–FONTAINE CURVE
65
In particular, for aﬃnoid S we can choose a ﬁbrewise nonzero map OXS →OXS(1), by taking
a map S →BC(O(1)) ∼= Spd Fq[[x1/p∞]] sending x to a pseudouniformizer. By Proposition II.2.3,
for any n ∈Z, we get an exact sequence
0 →OXS(n) →OXS(n + 1) →OS♯→0.
Applying this for n > 0, we get inductively an exact sequence
0 →BC(O(n))|S →BC(O(n + 1))|S →(A1
S♯)♦→0.
Starting with the base case n = 1 already handled, this allows one to prove part (iii) by induction,
using [Sch17a, Proposition 23.13].
Now for part (ii), we use the sequence for n = 0. In that case, for S = Spa(R, R+), we get an
exact sequence
0 →H0(XS, OXS) →H0(XS, OXS(1)) →R♯→H1(XS, OXS) →0
where the map in the middle can be identiﬁed with the logarithm map of the universal cover of the
Lubin–Tate formal group. This is pro-´etale locally surjective, with kernel given by E, proving (ii).
Finally, for part (i), we ﬁrst treat the case n = −1, where we get an exact sequence
0 →E →(A1
S♯)♦→BC(O(−1)[1])|S →0
showing in particular the vanishing of H0(XS, OXS(−1)) = 0. As E →(A1
S♯)♦is a closed immer-
sion, the result follows from [Sch17a, Proposition 24.2]. Now for n < −1, the result follows by
induction from the sequence
0 →(A1
S♯)♦→BC(O(−n)[1])|S →BC(O(−n + 1)[1])|S →0
and [Sch17a, Proposition 23.13].
□
II.2.3. The algebraic curve. We recall the following important ampleness result.
Theorem II.2.6 ([KL15, Proposition 6.2.4]). Let S = Spa(R, R+) be an aﬃnoid perfectoid
space over Fq and let E be any vector bundle on XS. Then there is an integer n0 such that for all
n ≥n0, the vector bundle E(n) is globally generated, i.e. there is a surjective map
Om
XS →E(n)
for some m ≥0, and moreover H1(XS, E(n)) = 0.
Proof. Pick a pseudouniformizer ϖ ∈R, thus deﬁning a radius function on YS. Write XS
as the quotient of YS,[1,q] along the isomorphism ϕ : YS,[1,1] ∼= YS,[q,q]. Correspondingly, E is given
by some ﬁnite projective BR,[1,q]-module M[1,q], with base changes M[1,1] and M[q,q] to BR,[1,1] and
BR,[q,q], and an isomorphism ϕM : M[q,q] ∼= M[1,1], linear over ϕ : BR,[q,q] ∼= BR,[1,1].
For convenience, we ﬁrst reduce to the case that M[1,q] is free (cf. [KL15, Corollary 1.5.3]).
Indeed, pick a surjection ψ : F[1,q] := Bm
R,[1,q] →M[1,q]. We want to endow the source with a similar

66
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
ϕ-module structure ϕF : F[q,q] ∼= F[1,1] (with obvious notation), making ψ equivariant. For this, we
would like to ﬁnd a lift
F[q,q]
ϕF
/
ψ

F[1,1]
ψ

M[q,q]
ϕM / M[1,1]
such that ϕF is an isomorphism. Let N[1,q] = ker(ψ), with base change N[q,q], N[1,1]. Choosing a
splitting F[1,q] ∼= M[1,q] ⊕N[1,q], we see that we could ﬁnd ϕF if there is an isomorphism ϕ∗N[q,q] ∼=
N[1,1] of BR,[1,1]-modules. But in the Grothendieck group of BR,[1,1]-modules, both are given by
[Bm
R,[1,1]]−[M[1,1]]. Thus, after possibly adding a free module (i.e. increasing m), they are isomorphic,
giving the claim.
Thus, we can assume that M[1,q] ∼= Bm
R,[1,q] is a free BR,[1,q]-module, and then
ϕM = A−1ϕ
for some matrix A ∈GLm(BR,[1,1]). Actually, repeating the above argument starting with the
presentation of XS as the quotient of YS,[q−1,q] via identifying YS,[q−1,1] with YS,[1,q], one can ensure
that
A ∈GLm(BR,[q−1,1]).
Twisting by OXS(n) amounts to replacing A by Aπn. Let us choose integers N and N′ such that
• the matrix A has entries in πNWOE(R+)⟨([ϖ]
π )±1⟩
• the matrix A−1 has entries in π−N′WOE(R+)⟨π
[ϖ], [ϖ]1/q
π
⟩.
By twisting, we can replace N and N′ by N + n and N′ + n; we can thus arrange that qN > N′,
N > 0.
Fix some rational r such that 1 < r ≤q. We will now show that there are m elements
v1, . . . , vm ∈(Bm
R,[1,q])ϕ=A = H0(XS, E)
that form a basis of Bm
R,[r,q]. Repeating the above analysis for diﬀerent strips (and diﬀerent choices
of pseudouniformizers ϖ ∈R to get overlapping strips), we can then get global generation of E.
In fact, we will choose vi to be of the form [ϖ]Mei −v′
i, for some positive integer M chosen
later, where ei ∈Bm
R,[1,q] is the i-th basis vector and v′
i is such that
||v′
i||BR,[r,q] ≤||[ϖ]M+1||BR,[r,q] = q−M−1.
Here, we endow all BR,I with the spectral norm, normalizing the norms on all completed residue
ﬁelds via ||[ϖ]|| = 1
q. These v1, . . . , vm restrict to a basis of Bm
R,[r,q] since the base change matrix
from the canonical basis is given by an element of
[ϖM](Id + [ϖ]Mm(B◦
R,[r,q])) ⊂GLm(BR,[r,q]).
In order to ﬁnd the v′
i, it suﬃces to prove that the map
ϕ −A : Bm
R,[1,q] →Bm
R,[1,1]

II.2. VECTOR BUNDLES ON THE FARGUES–FONTAINE CURVE
67
is surjective (yielding H1(XS, E) = 0), in the following quantitative way: If, for some positive
integer M chosen later,
w ∈πMWOE(R+)⟨([ϖ]
π )±1⟩m ⊂Bm
R,[1,1],
then there is some
v ∈Bm
R,[1,q]
such that
(II.2.1)
(ϕ −A)v = w and ||v||BR,[r,q] ≤q−M−1.
Indeed, we can then apply this to wi = (ϕ −A)([ϖ]Mei) (since N > 0 and thus A has entries in
WOE(R+)⟨([ϖ]
π )±1⟩), getting some v′
i with wi = (ϕ −A)(v′
i) and
||v′
i||BR,[r,q] ≤q−M−1,
as desired.
Thus, take any
w ∈πMWOE(R+)⟨([ϖ]
π )±1⟩m.
We can write
w = w1 + w2 where w1 ∈[ϖ]N−1πM−N+1WOE(R+)⟨π
[ϖ]⟩m, w2 ∈[ϖ]NπM−NWOE(R+)⟨[ϖ]
π ⟩m.
Let
v = ϕ−1(w1) −A−1w2 ∈Bm
R,[1,q] so that w′ := w −ϕ(v) + Av = ϕ(A−1w2) + Aϕ−1(w1).
Note that (as N > 0)
Aϕ−1(w1) ∈πN[ϖ](N−1)/qπM−N+1WOE(R+)⟨
π
[ϖ]1/q ⟩m ⊂πM+1WOE(R+)⟨([ϖ]
π )±1⟩m
and also (as qN > N′)
ϕ(A−1w2) ∈π−N′[ϖ]NqπMWOE(R+)⟨[ϖ]q
π ⟩m ⊂πM+1WOE(R+)⟨([ϖ]
π )±1⟩m
so that
w′ ∈πM+1WOE(R+)⟨([ϖ]
π )±1⟩m.
If one can thus prove the required bounds on v, this process will converge and prove the desired
statement. It remains to estimate v. On the one hand, its norm is clearly bounded in terms of the
norm of w (as both w1 and w2 are, and ϕ−1 and A−1 are bounded operators), and thus, since when
one iterates w goes to zero, v goes to zero, and the process converges by summing to obtain some
v such that (ϕ −A)v = w. But we need an improved estimate over BR,[r,q] to obtain (II.2.1). Note
that the norm of ϕ−1(w1) is bounded above by the norm of [ϖ](N−1)/qπM−N+1, which in BR,[r,q] is
given by q−(N−1)/q−rM+rN−r. This is at most q−M−1 once M is large enough. On the other hand,
w2 ∈πMWOE(R+)⟨[ϖ]
π ⟩m and so the norm of A−1w2 is bounded by the norm of π−N′πM, which in
BR,[r,q] is given by qrN′−rM. Again, this is at most q−M−1 once M is large enough. Thus, taking
M large enough (depending only on N, N′ and r > 1), the process above converges, giving the
desired result.
□
We have the following general GAGA theorem. Its proof is an axiomatization of [KL15, The-
orem 6.3.9].

68
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
Proposition II.2.7 (GAGA). Let (X, OX) be a locally ringed spectral space equipped with a
line bundle OX(1) such that for any vector bundle E on X, there is some n0 such that for all
n ≥n0, the bundle E(n) is globally generated. Moreover, assume that for i > 0, the cohomology
group Hi(X, E(n)) = 0 vanishes for all suﬃciently large n.
Let P = L
n≥0 H0(X, OX(n)) be the graded ring and Xalg = Proj(P).
There is a natural
map (X, OX) →Xalg of locally ringed topological spaces, and pullback along this map induces an
equivalence of categories between vector bundles on Xalg and vector bundles on (X, OX). Moreover,
for any vector bundle Ealg on Xalg with pullback E to X, the map
Hi(Xalg, Ealg) →Hi(X, E)
is an isomorphism for all i ≥0.
Recall that for any graded ring P = L
n≥0 Pn, one can deﬁne a separated scheme Proj(P)
by gluing Spec P[f−1]0 for all f ∈Pn, n > 0, where P[f−1]0 = lim
−→i f−iPin is the degree 0 part
of P[f−1].
In our situation, if n is large enough so that OX(n) is globally generated, then it
is enough to consider only f ∈Pn for this given n, and in fact only a ﬁnite set of them (as
X is quasicompact); in particular, Proj(P) is quasicompact. Moreover, one sees that there is a
tautological line bundle OProj(P)(n) for all suﬃciently large n, compatible with tensor products;
thus, there is also a tautological line bundle OProj(P)(1), which is an ample line bundle on Proj(P).
The pullback of OProj(P)(1) is then given by OX(1).
Proof. The construction of the map f : (X, OX) →Xalg is formal (and does not rely on any
assumptions): if g ∈Pn, then on the non-vanishing locus U = D(g) ⊂X, there is an isomorphism
g|U : OU
∼
−→OU(n). Now, for x =
a
gk ∈P[g−1]0, g−k
|U ◦a ∈O(U), and this deﬁnes a morphism of
rings P[g−1]0 →O(U). One deduces a morphism of locally ringed spaces U →D+(g), and those
glue when g varies to a morphism of locally ringed spaces (X, OX) →Xalg.
We consider the functor taking any vector bundle E on X to the quasicoherent OXalg-module E
associated to the graded P-module L
n≥0 H0(X, E(n)). This functor is exact as H1(X, E(n)) = 0
for all suﬃciently large n, and it commutes with twisting by O(1). We claim that it takes values
in vector bundles on Xalg. To see this, take a surjection Om
X →E(n) with kernel F, again a vector
bundle. The map Om
X →E(n) splits after twisting, i.e. for any f ∈Pn′ with n′ large enough, there
is a map E(n −n′) →Om
X such that E(n −n′) →Om
X →E(n) is multiplication by f. Indeed,
the obstruction to such a splitting is a class in H1(X,Hom(E, F)(n′)) which vanishes for n′ large
enough. This implies that E is a vector bundle on Spec P[f−1]0 for any such f, and these cover
Xalg.
There is a natural map f∗E →E, and the preceding arguments show that this is an isomorphism
(on the preimage of any Spec P[f−1]0, and thus globally). It now remains to show that if Ealg is
any vector bundle on Xalg, the map
Hi(Xalg, Ealg) →Hi(X, E)
is an isomorphism for all i ≥0. By ampleness of OXalg(1), there is some surjection OXalg(−n)m →
(Ealg)∨, with kernel a vector bundle F. Dualizing, we get an injection E →OXalg(n)m with cokernel
a vector bundle. This already gives injectivity on H0 by reduction to OXalg(n) where it is clear.

II.2. VECTOR BUNDLES ON THE FARGUES–FONTAINE CURVE
69
Applying this injectivity also for F, we then get bijectivity on H0. This already implies that we
get an equivalence of categories (exact in both directions). Finally, picking f1, . . . , fm ∈Pn so
that the Spec P[f−1
i
]0 cover Xalg, we can look at the corresponding ˇCech complex. Each term is a
ﬁltered colimit of global sections of vector bundles E(n) along multiplication by products of powers
of fi’s. This reduces the assertion to the case of H0 and the vanishing of Hi(X, E(n)) for n large
enough.
□
Remark II.2.8. One can check that Xalg is up to canonical isomorphism independent of the
choice of a line bundle OX(1) satisfying the preceding properties.
In particular, for any aﬃnoid perfectoid space S over Fq, we can deﬁne the algebraic curve
Xalg
S
= Proj
M
n≥0
H0(XS, OXS(n)).
There is a well-deﬁned map XS →Xalg
S
of locally ringed spectral spaces, pullback along which
deﬁnes an equivalence of categories of vector bundles, and is compatible with cohomology.
Notably, this connects the present discussion to the original deﬁnition of the Fargues–Fontaine
curve as given in [FF18], where the case S = Spa(F, OF ) is considered, for a perfectoid ﬁeld F of
characteristic p. We will restrict ourselves, as above, to the case that F = C is algebraically closed.
Proposition II.2.9. Let C be a complete algebraically closed nonarchimedean ﬁeld over Fq.
Then Xalg
C
is a connected regular noetherian scheme of Krull dimension 1, and the map |XC| →
|Xalg
C | induces a bijection between |XC|cl and the closed points of |Xalg
C |. Moreover, for any classical
point x ∈|XC|, the complement Xalg
C \ {x} is the spectrum of a principal ideal domain.
Proof. Let x ∈|XC|cl be any classical point, corresponding to some untilt C♯over E of C.
Using Lubin–Tate formal groups, we see that there is an exact sequence
0 →OXC →OXC(1) →OC♯→0
on XC. The corresponding section f ∈H0(XC, OXC(1)) deﬁnes its vanishing locus in Xalg
C , which
is then also given by Spec C♯. In particular, x deﬁnes a closed point of |Xalg
C |. Now we want to
show that P[f−1]0 is a principal ideal domain.
Thus, take any nonzero g ∈H0(XC, OXC(n)).
This has ﬁnitely many zeroes on XC, all at classical points x1, . . . , xm.
For each xi, we have
a section fxi ∈H0(XC, OXC(1)) as before, and then g = fn1
1 · · · fnm
m h for some ni ≥1, and
some h ∈H0(XC, OXC(n′)) that is everywhere nonzero. In particular, h deﬁnes an isomorphism
OXC →OXC(n′), whence n′ = 0, and h ∈E×. This decomposition implies easily that P[f−1]0 is
indeed a principal ideal domain, and it shows that all maximal ideals arise from classical points of
|XC|, ﬁnishing the proof.
□
II.2.4. Classiﬁcation of vector bundles. At this point, we can recall the classiﬁcation of
vector bundles over XC; so here we take S = Spa C for a complete algebraically closed nonar-
chimedean ﬁeld C over Fq. First, one classiﬁes line bundles.
Proposition II.2.10. The map Z →Pic(XC), n 7→OXC(n), is an isomorphism.

70
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
Proof. By Proposition II.2.9, any line bundle becomes trivial after removing one closed point
x ∈Xalg
C . As the local rings of Xalg
C
are discrete valuation rings, this implies that any line bundle
is of the form OXC(n[x]) for some n ∈Z. But OXC([x]) ∼= OXC(1) by Proposition II.2.2, so the
result follows.
□
In particular, one can deﬁne the degree of any vector bundle E on XC via
deg(E) = deg(det(E)) ∈Z
where det(E) is the determinant line bundle, and deg : Pic(XC) ∼= Z is the isomorphism from the
proposition. Of course, one can also deﬁne the rank rk(E) of any vector bundle, and thus for any
nonzero vector bundle its slope
µ(E) = deg(E)
rk(E) ∈Q.
It is easy to see that this satisﬁes the Harder–Narasimhan axiomatics (for example, rank and
degree are additive in short exact sequences). In particular, one can deﬁne semistable vector bundles
as those vector bundles E such that for all proper nonzero F ⊂E, one has µ(F) ≤µ(E). One says
that E is stable if in fact µ(F) < µ(E) for all such F.
Example II.2.11. For any λ ∈Q, the bundle OXC(λ) is stable of slope λ. Indeed, assume that
0 ̸= F ⊊OXC(λ) is a proper nonzero subbundle, and let r = rk(F), s = deg(F). Passing to r-th
wedge powers, we get an injection
det(F) ∼= OXC(s) ,→OXC(rλ)m,
using that Vr OXC(λ) is a direct sum of copies of OXC(rλ). This implies that s ≤rλ. Moreover, if
we have equality, then r is at least the denominator of λ, which is the rank of OXC(λ), i.e. F has
the same rank as OXC(λ). Thus, OXC(λ) is stable.
Proposition II.2.12. Any vector bundle E on XC admits a unique exhaustive separating Q-
indexed ﬁltration by saturated subbundles E≥λ ⊂E, called the Harder–Narasimhan ﬁltration, such
that
Eλ := E≥λ/E>λ, where E>λ =
[
λ′>λ
E≥λ′,
is semistable of slope λ. The formation of the Harder–Narasimhan ﬁltration is functorial in E. □
As a preparation for the next theorem, we note that the Harder–Narasimhan ﬁltration is also
compatible with change of C.
Proposition II.2.13. Let E be a vector bundle on XC, and let C′|C be an extension of complete
algebraically closed nonarchimedean ﬁelds, with pullback E′ of E to XC′. Then (E′)≥λ is the pullback
of E≥λ.
Similarly, if E′|E is a ﬁnite separable extension of degree r, and E′ is the pullback of E along
XC,E′ = XC,E ⊗E E′ →XC,E = XC, then (E′)≥λ is the pullback of E≥λ/r.
Proof. Consider the case of C′|C.
By uniqueness of the Harder–Narasimhan ﬁltration, it
suﬃces to see that pullbacks of semistable vector bundles remain semistable. Thus, assume that E
is semistable, and assume by way of contradiction that E′ is not semistable. By induction on the

II.2. VECTOR BUNDLES ON THE FARGUES–FONTAINE CURVE
71
rank, we can assume that the formation of the Harder–Narasimhan ﬁltration of E′ is compatible
with any base change.
Consider the ﬁrst nontrivial piece of the Harder–Narasimhan ﬁltration
0 ̸= F ⊊E. This is a vector bundle on XC′ with µ(F) > µ(E). We claim that F descends to XC.
By Proposition II.2.1, it suﬃces to see that the two pullbacks of F to XC′ b⊗CC′ agree. This is true
as there are no nonzero maps from F to E′/F after base change to XR for any perfectoid C′-algebra
R: If there were such a nonzero map, there would also be a nonzero map for some choice of R = C′′
a complete algebraically closed nonarchimedean ﬁeld. But then F is still semistable and all pieces
of the Harder–Narasimhan ﬁltration of E′/F are of smaller slope, so such maps do not exist.
For an extension E′|E, the similar arguments work, using Galois descent instead (noting that
one may assume that E′|E is Galois by passing to Galois hulls). Note that the pullback of OXC,E(1)
is OXC,E′(r), causing the mismatch in slopes.
□
The main theorem on the classiﬁcation of vector bundles is the following. Our proof follows
the arguments of Hartl-Pink, [HP04], to reduce to Lemma II.2.15 below. However, we give a new
and direct proof of this key lemma, which avoids any hard computations by using the geometry of
diamonds and v-descent. We thus get a new proof of the classiﬁcation theorem.3
Theorem II.2.14. Any vector bundle E on XC is isomorphic to a direct sum of vector bundles
of the form OXC(λ) with λ ∈Q. If E is semistable of slope λ, then E ∼= OXC(λ)m for some m ≥0.
Proof. We argue by induction on the rank n of E, so assume the theorem in rank ≤n −
1 (and for all choices of E); the case n = 1 has been handled already.
By the vanishing of
H1(XC, OXC(λ)) = 0 for λ > 0, the theorem follows for E if E is not semistable. Thus assume
E is semistable of slope λ = s
r with s ∈Z and r > 0 coprime. It suﬃces to ﬁnd a nonzero map
OXC(λ) →E: Indeed, by stability of OXC(λ), the map is necessarily injective (the category of semi-
stable vector bundles of slope λ is abelian with simple objects the stable vector bundles of slope
λ), and the quotient will then again be semistable of slope λ, and thus by induction isomorphic to
OXC(λ)m−1. One ﬁnishes by observing that Ext1
XC(OXC(λ), OXC(λ)) = 0 by Proposition II.2.5 (ii).
Thus, it suﬃces to ﬁnd a nonzero map OXC(λ) →E. Let E′|E be the unramiﬁed extension
of degree r, and consider the covering f : XC,E′ = XC,E ⊗E E′ →XC,E = XC. Then OXC(λ) =
f∗OXC,E′(s), and so it suﬃces to ﬁnd a nonzero map OXC,E′(s) →f∗E. In other words, up to
changing E, we can assume that λ ∈Z. Then by twisting, we can assume λ = 0.
Next, we observe that we are free to replace C by an extension. Indeed, consider the v-sheaf
sending S ∈PerfC to the isomorphisms E ∼= On
XC. This is a v-quasitorsor under GLn(E) (using
Proposition II.2.5 (ii)). If there is some extension of C where we can ﬁnd a nonzero section of E
(and thus also trivialize E), then it is a v-torsor under GLn(E). By v-descent of GLn(E)-torsors,
cf. [Sch17a, Lemma 10.13], it is then representable by a space pro-´etale over Spa C, and thus
admits a section.
3First, it has been proven for E of equal characteristic in [HP04] and for p-adic E by Kedlaya in [Ked04];
both of these proofs used heavy computations to prove Lemma II.2.15. A more elegant proof was given by Fargues–
Fontaine [FF18] (for all E) by reducing to the description of the Lubin–Tate and Drinfeld moduli spaces of π-
divisible OE-modules, and their Grothendieck–Messing period morphisms (which arguably also involve some nontrivial
computations). Finally, for p-adic E a proof is implicit in Colmez’ work [Col02] on Banach–Colmez spaces.

72
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
Let d ≥0 be minimal such that there is an injection OXC(−d) ,→E, possibly after base
enlarging C; by Theorem II.2.6 some such d exists. We want to see that d = 0, so assume d > 0 by
way of contradiction. By minimality of d, the quotient F = E/OXC(−d) is a vector bundle, and by
induction the classiﬁcation theorem holds true for F.
If d ≥2, then we can by induction ﬁnd an injection OXC(−d + 2) ,→F; taking the pullback
deﬁnes an extension
OXC(−d) →G →OXC(−d + 2).
so by twisting
OXC(−1) →G(d −1) →OXC(1).
By the key lemma, Lemma II.2.15 below, we would, possibly after enlarging C, get an injection
OXC ,→G(d −1), and hence an injection OXC(−d + 1) ,→G ,→E, contradicting our choice of d.
Thus, we may assume that d = 1. If F is not semistable, then it admits a subbundle F′ ⊂F
of degree ≥1 and rank ≤n −2. Applying the classiﬁcation theorem to the pullback
0 →OXC(−1) →E′ →F′ →0
of F′, which is of slope ≥0, we then get that E′ ⊂E has a global section.
It remains the case that d = 1 and that F is semistable, thus necessarily isomorphic to
OXC(
1
n−1). This is the content of the next lemma.
□
Lemma II.2.15. Let
0 →OXC(−1) →E →OXC( 1
n) →0
be an extension of vector bundles on XC, for some n ≥1. Then there is some extension C′|C of
complete algebraically closed nonarchimedean ﬁelds such that H0(XC′, E|XC′) ̸= 0.
Proof. Assume the contrary. Passing to Banach–Colmez spaces, we ﬁnd an injection of v-
sheaves
f : BC(OXC( 1
n)) ,→BC(OXC(−1)[1]).
The image cannot be contained in the classical points (as these form a totally disconnected subset
while the source is connected), so the image contains some non-classical point. After base change to
some C′|C, we thus ﬁnd that the image contains some nonempty open subset of BC(OXC(−1)[1]),
as follows from the presentation
BC(OXC(−1)[1]) = (A1
C♯)♦/E
and the similar behaviour of non-classical points of A1
C♯. Translating this nonempty open subset to
the origin, we ﬁnd that the image of f contains an open neighborhood of 0, and then by rescaling
by the contracting of E×, we ﬁnd that the map f must be surjective, and thus an isomorphism.
In particular, this would mean that BC(OXC(−1)[1]) is a perfectoid space. This is patently
absurd if E is p-adic, as then the given presentation shows that (A1
C♯)♦is pro-´etale over a perfectoid
space and thus itself a perfectoid space, but A1
C♯is clearly not a perfectoid space.4
In general, we can argue as follows. There is a nonzero map
BC(OXC( 1
n)) →(A1
C♯)♦
4We believe that also when E is of equal characteristic, BC(OXC(−1)[1]) is not a perfectoid space, but we were
not able to settle this easily.

II.2. VECTOR BUNDLES ON THE FARGUES–FONTAINE CURVE
73
as H0(OXC( 1
n)) maps nontrivially to its ﬁbre at the chosen untilt Spa C♯,→XC.
If f is an
isomorphism, we would then get a nonzero map
(A1
C♯)♦/E ∼= BC(OXC(−1)[1])
f−1
−−→BC(OXC( 1
n)) →(A1
C♯)♦.
On the other hand, one can classify all E-linear maps (A1
C♯)♦→(A1
C♯)♦.
The latter are the
same as maps A1
C♯→A1
C♯if E is p-adic (by [SW20, Proposition 10.2.3]), respectively maps
A1
C,perf →A1
C,perf if E is of equal characteristic. Thus, they are given by some convergent power
series g(X) that is additive, i.e. g(X + Y ) = g(X) + g(Y ), and satisﬁes g(aX) = ag(X) for all
a ∈E. (If E is of characteristic p, then g may a priori involve fractional powers X1/pi.) The
equation g(πX) = πg(X) alone in fact shows that only the linear coeﬃcient of g may be nonzero,
so g(X) = cX for some c ∈C♯, and thus g is either an isomorphism or zero. But our given map is
nonzero with nontrivial kernel, giving a contradiction.
□
II.2.5. Families of vector bundles. Using the ampleness of O(1), we can now prove the
following result on relative Banach–Colmez spaces.
Proposition II.2.16. Let S be a perfectoid space over Fq. Let E be a vector bundle on XS.
Then the Banach–Colmez space
BC(E) : T 7→H0(XT , E|XT )
is a locally spatial diamond, partially proper over S. Moreover, the projectivized Banach–Colmez
space
(BC(E) \ {0})/E×
is a locally spatial diamond, proper over S.
Proof. Note that BC(E) →S is separated: As it is a group, it suﬃces to see that the zero
section is closed, but being zero can be checked through the vanishing at all untilts T ♯of T, where
it deﬁnes Zariski closed conditions. Using Theorem II.2.6, choose a surjection OXS(−n)m →E∨.
Dualizing, we get an exact sequence
0 →E →OXS(n)m →F →0
for some vector bundle F. As BC(F) is separated, we see that BC(E) ⊂BC(OXS(n)m) is closed,
so the ﬁrst part follows from Proposition II.2.5 (iii). For the second part, we may assume that S
is qcqs. It is also enough to prove the similar result for (BC(E) \ {0})/πZ as the O×
E-action is free
(so one can apply the last part of [Sch17a, Proposition 11.24]). This follows from the following
general lemma about contracting group actions on locally spectral spaces, noting that checking
the conditions formally reduces to the case of BC(OXS(n)m) and from there to A1
S♯by evaluating
sections at some collection of untilts.
□
Lemma II.2.17. Let X be a taut locally spectral space such that for any x ∈X, the set Xx ⊂X
of generalizations of x is a totally ordered chain under specialization.
Let γ : X
∼
−→X be an
automorphism of X such that the subset X0 ⊂X of ﬁxed points is a spectral space. Moreover,
assume that
(i) for all x ∈X, the sequence γn(x) for n →∞converges towards X0, i.e. for all open neighborhoods
U of X0, one has γn(x) ∈U for all suﬃciently positive n;

74
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
(ii) for all x ∈X \ X0, the sequence γn(x) for n →−∞diverges, i.e. for all quasicompact open
subspaces U ⊂X, one has γn(x) ̸∈U for all suﬃciently negative n.
Then X0 ⊂X is a closed subspace, the action of γ on X \ X0 is free and totally discontinuous
(i.e. the action map (X \ X0) × Z →(X \ X0) × (X \ X0) is a closed immersion), and the quotient
(X \ X0)/γZ is a spectral space.
Remark II.2.18. For applications of this lemma, we recall the following facts:
(i) If X is any locally spatial diamond, then |X| is a locally spectral space such that all for all
x ∈|X|, the set of generalizations of x in |X| is a totally ordered chain under specialization.
Indeed, this follows from [Sch17a, Proposition 11.19] and the similar property for analytic adic
spaces.
(ii) If X is in addition partially proper over a spatial diamond, then |X| is taut by [Sch17a, Propo-
sition 18.10].
This means that the ﬁrst sentence of the lemma is practically always satisﬁed.
Proof. Let U ⊂X be some quasicompact open neighborhood of X0. First, we claim that one
can arrange that γ(U) ⊂U. Indeed, one has
U ⊂γ−1(U) ∪γ−2(U) ∪. . . ∪γ−n(U) ∪. . . ,
as for any x ∈U ⊂X, also γn(x) ∈U for all suﬃciently large n by assumption, and so x ∈γ−n(U)
for some n > 0. By quasicompacity of U, this implies that U ⊂γ−1(U) ∪. . . ∪γ−n(U) for some
n, and then U′ = U ∪γ−1(U) ∪. . . ∪γ−n+1(U) is a quasicompact open neighborhood of X0 with
γ(U′) ⊂U′.
Now ﬁx a quasicompact open neighborhood U of X0 with γ(U) ⊂U. We claim that
X0 =
\
n≥0
γn(U).
Indeed, if x ∈X \ X0, then by assumption there is some positive n such that γ−n(x) ̸∈U, giving
the result.
In particular, for any other quasicompact open neighborhood V of X0, there is some n such
that γn(U) ⊂V . Indeed, the sequence of spaces γn(U) \ V is a decreasing sequence of spectral
spaces with empty inverse limit, and so one of the terms is empty.
Consider the closure U ⊂X of U in X. As X is taut, this is still quasicompact. Repeating the
above argument, we see that for some n > 0, one has
U ⊂γ−1(U) ∪. . . ∪γ−n(U) = γ−n(U).
This implies that the sequences {γn(U)}n≥0 and {γn(U)}n≥0 are coﬁnal. In particular,
X0 =
\
n≥0
γn(U) =
\
n≥0
γn(U)
is a closed subset of X.
Next, we check that any point x ∈X \ X0 has an open neighborhood V such that {γn(V )}n∈Z
are pairwise disjoint; for this it suﬃces to arrange that V ∩γi(V ) = ∅for all i > 0. For this,

II.2. VECTOR BUNDLES ON THE FARGUES–FONTAINE CURVE
75
note that if n is chosen such that γn(U) ⊂U, then up to rescaling by a power of γ, we can
assume that x ∈U \ γn+1(U). Let V ⊂U \ γn+1(U) be a quasicompact open neighborhood of
x. Then γi(V ) ∩V = ∅as soon as i ≥n + 1. For the ﬁnitely many i = 1, . . . , n, we can use a
quasicompacity argument, and reduce to proving that if Xx is the localization of X at x (i.e., the
set of all generalizations of x), then Xx ∩γi(Xx) = ∅for i = 1, . . . , n. By our assumption on X,
the space Xx has a unique generic point η ∈Xx (Xx is pro-constructible in a spectral space thus
spectral and by our hypothesis Xx is irreducible), which must then also be the unique generic point
of γi(Xx) if Xx ∩γi(Xx) ̸= ∅. Thus, if Xx ∩γi(Xx) ̸= ∅, then γi(η) = η, so η ∈X0. But X0 is
closed, so that x ∈X0, which is a contradiction.
In particular, the action of γ on X \ X0 is free and totally discontinuous, and the quotient
X = (X \ X0)/γZ is a locally spectral space which is locally isomorphic to X \ X0. A basis of
open neighborhoods of X is given by the image of quasicompact open subsets V ⊂X \ X0 for
which {γn(V )}n∈Z are pairwise disjoint; it follows that these are quasicompact open subsets of X.
Also, the intersection of two such subsets is of the same form, so the quotient X is quasiseparated.
Finally, note that U \ γ(U) →X is a bijective continuous map, and the source is a spectral
space (as γ(U) ⊂U is a quasicompact open subspace of the spectral space U), and in particular
quasicompact, and so X is quasicompact.
□
The result on properness of the projectivized Banach–Colmez space enables us to give quick
proofs of the main results of [KL15] (including an extension to the case of general E, in particular
of equal characteristic).
Theorem II.2.19 ([KL15, Theorem 7.4.5, Theorem 7.4.9, Theorem 7.3.7, Proposition 7.3.6]).
Let S be a perfectoid space over Fq and let E be a vector bundle over XS of constant rank n.
(i) The function taking a geometric point Spa C →S of S to the Harder–Narasimhan polygon of
E|XC is upper semicontinuous.
(ii) Assume that the Harder–Narasimhan polygon of E is constant. Then there exists a global (sep-
arated exhaustive decreasing) Harder–Narasimhan ﬁltration
E≥λ ⊂E
specializing to the Harder–Narasimhan ﬁltration at each point. Moreover, after replacing S by a
pro-´etale cover, the Harder–Narasimhan ﬁltration can be split, and there are isomorphisms
Eλ ∼= OXS(λ)nλ
for some integers nλ ≥0.
Proof. Note that the Harder–Narasimhan polygon can be described as the convex hull of the
points (i, di) for i = 0, . . . , n, where di is the maximal integer such that H0(XC, (∧iE)(−di)|XC) ̸= 0.
To prove part (i), it therefore suﬃces to show that for any vector bundle F on XS, the locus of
all geometric points Spa C →S for which H0(XC, F|XC) ̸= 0 is closed in S. But note that this is
precisely the image of
(BC(F) \ {0})/E× →S.
As this map is proper by Proposition II.2.16, its image is closed. To see that the endpoint of
the Harder–Narasimhan polygon is locally constant, apply the preceding also to the dual of the
determinant of E.

76
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
For part (ii), it is enough to prove that v-locally on S, there exists an isomorphism E ∼=
L
λ OXS(λ)nλ. Indeed, the desired global Harder–Narasimhan ﬁltration will then exist v-locally,
and it necessarily descends. The trivialization of each Eλ amounts to a torsor under some locally
proﬁnite group, and can thus be done after a pro-´etale cover by [Sch17a, Lemma 10.13]. Then the
ability to split the ﬁltration follows from Proposition II.2.5 (i).
We argue by induction on the rank of E. Let λ be the maximal slope of E. We claim that
v-locally on S, there is a map OXS(λ) →E that is nonzero in each ﬁbre. Indeed, ﬁnding such a
map is equivalent to ﬁnding a ﬁbrewise nonzero map OXS →F =Hom(OXS(λ), E). But then
BC(F) \ {0} →(BC(F) \ {0})/E× →S
is a v-cover over which such a map exists: The ﬁrst map is an E×-torsor and thus a v-cover, while
the second map is proper and surjective on geometric points, thus surjective by [Sch17a, Lemma
12.11]. The dual map E∨→OXS(−λ) is surjective as can be checked over geometric points (using
that OXC(−λ) is stable), thus the cokernel of OXS(λ) →E is a vector bundle E′, that again has
constant Harder–Narasimhan polygon. By induction, one can ﬁnd an isomorphism
E′ ∼=
M
λ′≤λ
OXS(λ′)n′
λ′.
By Proposition II.2.5 (i)–(ii), the extension
0 →OXC(λ) →E →
M
λ′≤λ
OXS(λ′)n′
λ′ →0
can be split after a further pro-´etale cover, ﬁnishing the proof.
□
Let us explicitly note the following corollary.
Corollary II.2.20 ([KL15, Theorem 8.5.12]). Let S be a perfectoid space. The category of
pro-´etale E-local systems L is equivalent to the category of vector bundles on XS whose Harder–
Narasimhan polygon is constant 0, via L 7→L ⊗E OXS.
Proof. First, the functor is fully faithful, as we can see by pro-´etale descent (to assume L is
trivial) and Proposition II.2.5. Now essential surjectivity follows from Theorem II.2.19.
□
II.3. Further results on Banach–Colmez spaces
We include some further results on Banach–Colmez spaces.
II.3.1. Cohomology of families of vector bundles. First, we generalize the vanishing
results of Proposition II.2.5 to families of vector bundles. A key tool is given by the following
result, which is a small strengthening of [KL15, Lemma 8.8.13].
Proposition II.3.1. Let S be a perfectoid space over Fq, and let E be a vector bundle on XS
such that all Harder–Narasimhan slopes of E at all geometric points are nonnegative. Then locally
(in the analytic topology) on S, there is an exact sequence
0 →OXS(−1)d →F →E →0
where F is semistable of degree 0 at all geometric points.

II.3. FURTHER RESULTS ON BANACH–COLMEZ SPACES
77
Proof. We may assume that the degree of E is constant, given by some d ≥0. We can assume
S = Spa(R, R+) is aﬃnoid perfectoid and pick d untilts S♯
i = Spa(R♯
i, R♯+
i ) over E, i = 1, . . . , d,
such that S♯
1, . . . , S♯
d ⊂XS are pairwise disjoint; more precisely, choose d maps S →BC(O(1))\{0}.
Let Wi be the ﬁbre of E over R♯
i, which is a ﬁnite projective R♯
i-module. For any rank 1 quotients
Wi →R♯
i, we can pull back the sequence
0 →OXS(−1)d →Od
XS →
d
M
i=1
OS♯
i →0,
obtained from Proposition II.2.3, along
E →
d
M
i=1
E ⊗OXS OS♯
i =
d
M
i=1
Wi ⊗R♯
i OS♯
i →
d
M
i=1
OS♯
i
to get an extension
0 →OXS(−1)d →E′ →E →0.
We claim that one can choose, locally on S, the rank 1 quotients so that E′ is semistable of
degree 0. For this, we argue by induction on i = 1, . . . , d that one can choose (locally on S) the
quotients of W1, . . . , Wi so that the modiﬁcation
0 →OXS(−1)i →Ei →E →0,
invoking only the quotients of W1, . . . , Wi, has the property that the Harder–Narasimhan slopes of
Ei at all geometric points are nonnegative. It is in fact enough to handle the case i = 1, as the
inductive step then reduces to the similar assertion for the bundle E1 which is of smaller degree.
First, we handle the case that S = Spa(K, K+) for a perfectoid ﬁeld K (not necessarily alge-
braically closed). Then E has a Harder–Narasimhan ﬁltration, and look at the subbundle E≥λ ⊂E
of maximal slope, where necessarily λ > 0. Also recall that any nonsplit extension
0 →OXS(−1) →G →E≥λ →0
necessarily has nonnegative Harder–Narasimhan slopes (by looking at the Harder–Narasimhan poly-
gon, which has to lie strictly above the −1-line). Thus, it is enough to ensure that the pullback of
the extension to E≥λ is nonsplit. But if it splits, then the given map E≥λ →OS♯
1 lifts to a map
E≥λ →OXS; by consideration of slopes, this map is necessarily trivial. Thus, if we let W ′
1 ⊂W1
be the ﬁbre of E≥λ ⊂E at S♯
1, it suﬃces to pick a quotient W1 →K♯
1 whose restriction to W ′
1 is
nonzero.
Going back to general aﬃnoid S, pick any point s ∈S. By the preceding argument, we can
locally on S ﬁnd a quotient W1 →R♯
1 such that the corresponding extension E1 has the property
that the Harder–Narasimhan slopes at s are still nonnegative. By Theorem II.2.19, the same is
true in an open neighborhood, ﬁnishing the proof.
□
In applications, it is often more useful to have the following variant, switching which of the
two bundles is trivialized, at the expense of assuming strictly positive slopes (and allowing ´etale
localizations in place of analytic localizations — this is probably unnecessary).

78
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
Proposition II.3.2. Let S be a perfectoid space over Fq and let E be a vector bundle on XS
such that at all geometric points of S, all Harder–Narasimhan slopes of E are positive. Then ´etale
locally on S, there is a short exact sequence
0 →G →Om
XS →E →0
where G is semistable of slope −1 at all geometric points.
Proof. We can assume that E has constant degree d and rank r; we set m = d + r. Inside
BC(E)m, we can look at the locus U ⊂BC(E)m of those maps Om
XS →E that are surjective and
whose kernel is semistable of slope −1. This is an open subdiamond of BC(E)m: This is clear for
the condition of surjectivity (say, as the cokernel of the universal map On
XT →E|XT is supported
on a closed subset of XT , whose image is then closed in T), and then the locus where the kernel
is semistable of slope −1 is open by Theorem II.2.19. By Proposition II.3.1, we see moreover that
all geometric ﬁbres of U →S are nonempty. It thus suﬃces to prove that for any geometric point
T = Spa(C, C+) →S, given as a coﬁltered inverse limit of ´etale maps Si = Spa(Ri, R+
i ) →S, and
any section s ∈BC(E)(T), one can ﬁnd a sequence of i’s and sections si ∈BC(E)(Si) such that
si|T →s as i →∞. Indeed, applying this to Em in place of E and some section of U over T, one
of the si will then lie in U(Si), giving the desired short exact sequence.
To prove that one can approximate s, we argue in a way similar to the proof of Theorem II.2.6.
To facilitate the estimates, it is useful to assume that all Harder–Narasimhan slopes of E at T are
integral; this can always be achieved through pulling back E to a cover f : XS,E′ = XS ⊗E E′ →XS
for some unramiﬁed extension E′|E (as this pullback multiplies slopes by [E′ : E]), noting that E
is a direct factor of f∗f∗E = E ⊗E E′. We analyze E in terms of its pullback to YS,[1,q] and the
isomorphism over YS,[q,q] ∼= YS,[1,1]. Note that as BC,[1,q] is a principal ideal domain, the pullback of
E to YC,[1,q] is necessarily free, and by approximation we can already ﬁnd a basis over some YSi,[1,q];
replacing S by Si we can then assume that the pullback of E to YS,[1,q] is free. The descent datum
is then given by A−1ϕ for some matrix A ∈GLn(BR,[1,1]). After pullback to T, by Theorem II.2.14
and the assumption of integral slopes, one can in fact choose a basis so that A is a diagonal matrix
D with positive powers of π along the diagonal. Approximating this basis, we can assume that
A −D ∈πNB+
(R,R+),[1,1] for any chosen N > 0.
Now the map
ϕ −D : Br
R,[1,q] →Br
R,[1,1]
is surjective by Proposition II.2.5, and in fact there is some M (depending only on D, not on R)
such that for any x ∈(B+
(R,R+),[1,1])r, there is some y ∈π−M(B+
(R,R+),[1,q])r with x = (ϕ −D)(y).
There are two ways to see the existence of M: Either by an explicit reading of the proof of
Proposition II.2.5, or as follows. Assume no such M exists; then we can ﬁnd perfectoid algebras
R0, R1, . . . with integral elements R+
i
⊂Ri and pseudouniformizers ϖi ∈Ri, and sections xi ∈
(B+
(Ri,R+
i ),[1,1])r such that there is no yi ∈π−2i(B+
(Ri,R+
i ),[1,q])r with xi = (ϕ−D)(yi). Let R+ be the
product of all R+
i , and R = R+[ 1
ϖ] where ϖ = (ϖi)i ∈R+ = Q
i R+
i . Then all xi deﬁne elements
of (B+
(R,R+),[1,1])r, and x = x0 + πx1 + π2x2 + . . . another element. By surjectivity of ϕ −D, there
is some y ∈(B(R,R+),[1,q])r with x = (ϕ −D)(y). But then y ∈π−i(B+
(R,R+),[1,q])r for some i, and
then projecting along (R, R+) →(Ri, R+
i ) contradicts the choice of xi.

II.3. FURTHER RESULTS ON BANACH–COLMEZ SPACES
79
Taking N > M above, one sees that also
ϕ −A = ϕ −D + (D −A) : Br
R,[1,q] →Br
R,[1,1]
is surjective, with the same bound (in particular independent of R). But now the section s of E
over XT can be approximated by a section s′
i of BRi,[1,q], so that its image under ϕ −A will be
small. By the preceding surjectivity, we can then replace s′
i by si = s′
i + ϵi for some still small ϵi
such that
si ∈Bϕ=A
Ri,[1,q] = H0(XSi, E|XSi).
This gives the desired conclusion.
□
One can prove the following variants.
Corollary II.3.3. Let S be a perfectoid space over Fq and let E be a vector bundle on XS.
(i) Assume that all Harder–Narasimhan slopes of E are ≥1
r. Then locally on S, for some m ≥0
there is a short exact sequence
0 −→Om
XS −→F −→E −→0,
where F is ﬁbrewise semistable of slope 1
r.
(ii) Assume that all Harder–Narasimhan slopes of E are ≥1
r. Then locally on S, for some m ≥0
there is a short exact sequence
0 −→OXS( 1
2r)m −→F −→E −→0,
where F is ﬁbrewise semistable of slope 1
r.
(iii) Assume that all Harder–Narasimhan slopes of E are > 1
r. Then ´etale locally on S, for some
m ≥0 there is a short exact sequence
0 −→G −→OXS(1
r)m −→E −→0,
where G is ﬁbrewise semistable of slope 0.
(iv) Assume that all Harder–Narasimhan slopes of E are > 1
r. Then ´etale locally on S, for some
m ≥0 there is a short exact sequence
0 −→G −→OXS(1
r)m −→E −→0,
where G is ﬁbrewise semistable of slope
1
2r.
Proof. We can suppose S is aﬃnoid. We start with (i). Let πr : XS,r = YS/ϕrZ →XS be
the ﬁnite ´etale cover XS,Er = XS,E ⊗E Er →XS,E = XS, where Er is the unramiﬁed extension
of degree r of E. We apply Proposition II.3.1 to (π∗
rE)(−1). We get, locally on S, a short exact
sequence
0 →Om′
XS,Er →F′ →π∗
rE →0
where F′ is ﬁberwise semistable of slope 1. Thus, applying πr∗, we get a short exact sequence
0 →Om′r
XS →πr∗F′ →πr∗π∗
rE →0.
Here πr∗F′ is ﬁberwise semistable of slope 1
r. As E is a direct summand of πr∗π∗
rE = E ⊗E Er, we
get via pullback a similar exact sequence.

80
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
Arguing similarly with (π∗
2rE)(−2), we get part (ii) of the corollary. Invoking Proposition II.3.2
instead, we get parts (iii) and (iv).
□
Proposition II.3.4. Let S ∈PerfFq, and let E be a vector bundle on XS.
(i) If at all geometric points of S, all slopes of E are negative, then H0(XS, E) = 0.
(ii) If at all geometric points of S, all slopes of E are nonnegative, then there is a pro-´etale cover
eS →S such that
H1(XeS, E|X e
S) = 0.
(iii) If at all geometric points of S, all slopes of E are positive, then there is an ´etale cover S′ →S
such that for any aﬃnoid perfectoid T over S′, one has H1(XT , E|XT ) = 0.
Proof. Part (i) can be checked on geometric points, where it follows from Theorem II.2.14
and Proposition II.2.5 (i). For part (ii), we use Proposition II.3.1 to produce locally on S an exact
sequence
0 →OXS(−1)d →E′ →E →0
where E′ is everywhere semistable of degree 0. By Theorem II.2.19 we can ﬁnd a pro-´etale cover
of S over which E′ ∼= Or
XS. By the vanishing of H2, this induces a surjection from H1(XS, OXS)r
onto H1(X, E). Since H1(XS, OXS) = H1
pro´et(S, E) by Proposition II.2.5 (ii), this vanishes pro-´etale
locally on S.
For part (iii), we use Corollary II.3.3 (iii) to produce an ´etale cover of S over which there is an
exact sequence
0 →G →OXS(1
r)m →E →0.
For any aﬃnoid T|S, this induces a surjection from H1(XT , OXT (1
r)m) onto H1(XT , E|XT ), so we
conclude by Proposition II.2.5 (iii).
□
II.3.2. Families of Banach–Colmez spaces. We can now prove the following strengthening
of Proposition II.2.16.
Proposition II.3.5. Let S be a perfectoid space over Fq. Let [E1 →E0] be a map of vector
bundles on XS such that at all geometric points of S, the bundle E1 has only negative Harder–
Narasimhan slopes.
(i) The Banach–Colmez space
BC([E1 →E0]) : T 7→H0(XT , [E1 →E0]|XT )
is a locally spatial diamond, partially proper over S.
(ii) The projectivized Banach–Colmez space
(BC([E1 →E0]) \ {0})/E×
is a locally spatial diamond, proper over S.
(iii) Assume that all Harder–Narasimhan slopes of E0 at all geometric points are positive. Then
BC([E1 →E0]) →S
is cohomologically smooth.

II.3. FURTHER RESULTS ON BANACH–COLMEZ SPACES
81
Proof. All assertions are ´etale local (in fact v-local) on S. For parts (i) and (ii), let us ﬁrst
simplify the form of the complex [E1 →E0]. By Theorem II.2.6, we can ﬁnd (for S aﬃnoid) some
d > 0 and a surjection
OXS(−d)m →E0.
Let E′
1 be the kernel of E1 ⊕OXS(−d)m →E0. Then we ﬁnd a quasi-isomorphism
[E′
1 →OXS(−d)m] →[E1 →E0].
Note also that E′
1 still satisﬁes the assumption on negative slopes. We get an exact sequence
0 →BC([E′
1 →OXS(−d)m]) →BC(E′
1[1]) →BC(OXS(−d)m[1]).
As BC(OXS(−d)m[1]) is separated by Proposition II.2.5 (i), we see that parts (i) and (ii) reduce to
the case of BC(E′
1[1]). Now applying Corollary II.3.3 (iv) to the dual of E′
1, we get (´etale locally on
S) an exact sequence
0 →BC(E′
1[1]) →BC(OXS(−1
r)m[1]) →BC(G[1])
where G is semistable of slope
1
2r everywhere. In particular, BC(G[1]) is separated over S by pro-
´etale descent and Proposition II.2.5 (i). Thus, BC(E′
1[1]) ⊂BC(OXS(−1
r)m[1]) is a closed subfunctor,
ﬁnishing the proof of part (i) by applying Proposition II.2.5 (i) again. Part (ii) is then reduced to
the similar assertion for BC(OXS(−1
r)m[1]). Replacing E by its unramiﬁed extension of degree r,
this reduces to BC(OXS(−1)m[1]). Now, as in the proof of Proposition II.2.16, this follows from
Lemma II.2.17, where one checks the required contracting property of multiplication by π by using
the presentation
BC(OXS(−1)[1]) = (A1
S♯)♦/E
for an untilt S♯of S over E.
It remains to prove part (iii). Note that one has a short exact sequence
0 →BC(E0) →BC([E1 →E0]) →BC(E1[1]) →0;
by [Sch17a, Proposition 23.13], we can thus handle BC(E1[1]) and BC(E0) individually. For the
case of BC(E0), we use Corollary II.3.3 (iv) to get, pro-´etale locally on S, an exact sequence
0 →OXS( 1
2r)m′ →OXS(1
r)m →E0 →0,
inducing a similar sequence of Banach–Colmez spaces.
Then the result follows from [Sch17a,
Proposition 23.13]. For the case of BC(E1[1]), choose a surjection OXS(−d)m →E∨
1 for some d > 0;
we get an exact sequence
0 →E1 →OXS(d)m →F →0
where necessarily all Harder–Narasimhan slopes of F are positive everywhere. This gives an exact
sequence
0 →BC(OXS(d)m) →BC(F) →BC(E1[1]) →0,
so the result follows from [Sch17a, Proposition 23.13] and the case of positive slopes already
established.
□

82
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
II.3.3. Punctured absolute Banach–Colmez spaces. Finally, we analyze punctured ab-
solute Banach–Colmez spaces. Recall that, in the situation of Proposition II.2.5 (iv), one has
BC(O(d)) ∼= Spd(k[[x1/p∞
1
, . . . , x1/p∞
d
]]),
so the v-sheaf BC(O(d)) fails to be a perfectoid space, or even a diamond, as it contains the
non-analytic point Spd k. However, passing to the punctured Banach–Colmez space
BC(O(d)) \ {0} ∼= Spa(k[[x1/p∞
1
, . . . , x1/p∞
d
]])an
identiﬁes with the analytic points, which form a perfectoid space; in fact, a qcqs perfectoid space.
These objects ﬁrst showed up in [Far18a] in the case of positive slopes.
It was remarked in
[Far18a] that the punctured version BC(O(d)) \ {0} is a diamond for all d ≥1, that is moreover
simply connected when d > 2. This plays a key role in [Far18a] since after base changing from
Spd k to Spa C this is not simply connected anymore. In the above example,
BC(O(d)) \ {0} = Spa(k[[x1/p∞
1
, . . . , x1/p∞
d
]]) \ V (x1, · · · , xd)
is a qcqs perfectoid space that is simply connected when d > 1. After base changing to Spa(C)
this is a punctured n-dimensional open ball over Spa(C) that is not quasicompact anymore, and
not simply connected. Thus, some new interesting phenomena appear when we consider absolute
Banach–Colmez spaces.
Let us ﬁrst continue the discussion with the case of O(d) for d ≥1. In that case, there is a
relation to Cartier divisors. Recall that any closed Cartier divisor D ⊂XS is given by a line bundle
I on XS together with an injection I ,→OXS with closed image. We will only consider the case of
relative Cartier divisors, so that this map stays injective after base change to any geometric point.
Now Theorem II.2.19 implies that after replacing S by an open and closed cover, I is of degree −d
for some integer d ≥0, and that there is an E×-torsor of isomorphisms I ∼= OXS(−d). This shows
that the v-sheaf Div sending any S to the closed relative Cartier divisors is given by
Div =
G
d≥0
Divd, Divd ∼= (BC(O(d)) \ {0})/E×.
Note that we are implicitly using a diﬀerent deﬁnition of Div1 here, but Corollary II.2.4 shows that
they agree.
In particular, the moduli space Divd of degree d Cartier divisors is given by the projectivized
Banach–Colmez space for O(d). On the other hand, in terms of divisors we can see the following
proposition. Recall that one can take sums of Cartier divisors (by tensoring their ideal sheaves).
Proposition II.3.6. For any d ≥1, the sum map
(Div1)d →Divd : (D1, . . . , Dd) 7→D1 + . . . + Dd
is a quasi-pro-´etale cover, identifying
Divd = (Div1)d/Σd,
where Σd is the symmetric group. In particular, Divd is a diamond.
Proof. By Proposition II.2.16 (ii), all occuring spaces are proper over ∗. In particular, the sum
map is proper. To check surjectivity as v-sheaves, we can then check on geometric points, where it

II.3. FURTHER RESULTS ON BANACH–COLMEZ SPACES
83
follows from Proposition II.2.9 (in whose proof we checked that any element of Pd is a product of
elements of P1). In fact, we even get bijectivity up to the Σd-action, and thus the isomorphism
Divd = (Div1)d/Σd
as v-sheaves. But the projection (Div1)d →(Div1)d/Σd is quasi-pro-´etale by [Sch17a, Lemma
7.19, Deﬁnition 10.1 (i)]. As Div1 = Spd E/ϕZ is a diamond, it follows that Divd is a diamond by
[Sch17a, Proposition 11.4, Proposition 11.6].
□
Now we can analyze the case of general absolute Banach–Colmez spaces.
Proposition II.3.7. Let D be an isocrystal with only negative slopes (resp. with only positive
slopes), and work on Perfk.
(i) The punctured Banach–Colmez space BC(D) \ {0} (resp. BC(D[1]) \ {0}) is a spatial diamond.
(ii) The quotient
 BC(D) \ {0}

/E× −→∗
 resp.
 BC(D[1]) \ {0}

/E× −→∗

is proper, representable in spatial diamonds, and cohomologically smooth.
Proof. Part (ii) follows from Proposition II.3.5 and (for the cohomological smoothness after
taking the quotient by E×) [Sch17a, Proposition 24.2].
For part (i), we are going to apply Lemma II.3.8, so we ﬁrst want to see that BC(D) \ {0} is a
spatial v-sheaf. By the Dieudonn´e–Manin classiﬁcation, we can ﬁnd a basis for D so that ϕ is E-
rational and U := ϕN is a diagonal matrix with entries powers of π for some N > 0; this essentially
means that V is decent in the sense of [RZ96, Deﬁnition 1.8]. Then BC(D) (resp. BC(D[1])) is
already deﬁned on PerfFq, and the action of U agrees with the action of FrobN. Moreover, the
action of U−1 (resp. U) on | BC(D) ×Fq Spa Fq((t1/p∞))| (resp. | BC(D[1]) ×Fq Spa Fq((t1/p∞))|) still
satisﬁes the hypotheses of Lemma II.2.17. This implies that
(BC(D) \ {0})/ϕN ×Fq Spa Fq((t1/p∞))
is a spatial diamond, which can be translated into
(BC(D) \ {0}) ×Fq Spa Fq((t1/p∞))/ϕN
being a spatial diamond, as the absolute Frobenius acts trivially on the topological space. But
Spa Fq((t1/p∞))/ϕN →∗is qcqs, even proper, and cohomologically smooth. We can thus apply
point (i) of Lemma II.3.8 to conclude that BC(D) \ {0} (resp. BC(D[1]) \ {0}, for which the same
argument applies) is spatial.
It remains to see that it is a diamond. One easily reduces to the case that D is simple, and
allowing ourselves to replace E by a ﬁnite unramiﬁed extension, to D of rank 1.
The case of
positive Banach–Colmez spaces now follows from Proposition II.3.6, as it is an E×-torsor over a
diamond (so [Sch17a, Proposition 11.7] applies). It remains to prove that this is a diamond in
the case of a negative absolute Banach–Colmez spaces, i.e. for D = (E, πnϕ) with n > 0. Then
D := BC(D[1]) \ {0} classiﬁes extensions
0 −→OXS(−n) −→E −→OXS −→0

84
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
that are geometrically ﬁberwise non split on S (remark that those extensions are rigid). We now
apply point (ii) of Lemma II.3.8 using the Harder–Narasimhan stratiﬁcation of D deﬁned by E. We
can pass to the subsheaf of D where E is, at each geometric point, isomorphic to a given rank 2
bundle, necessarily of the form OXS(−n + i) ⊕OXS(−i) for some 0 < i ≤n
2 or to OXS(−n
2 ).
On such a stratum Dα ⊂D there is a global Harder–Narasimhan ﬁltration by Theorem II.2.19,
and trivializing the graded piece of lowest slope deﬁnes a pro-´etale morphism eDα →Dα.
For
S →eDα there is a morphism from OXS(−n) to this quotient of E by composing with the inclusion
OXS(−n) ,→E. Since the extension is non-split geometrically ﬁberwise on S, this morphism is non-
zero geometrically ﬁberwise. This deﬁnes a morphism eDα →X from eDα to a punctured positive
absolute Banach–Colmez space X, which is a diamond. Thus
eDα ⊂eDα × X
where the latter is a diamond as eDα →∗is representable in diamonds, so [Sch17a, Proposition
11.10] shows that eDα is a diamond.
□
Lemma II.3.8. Let F be a small v-sheaf.
(i) Suppose there exists a surjective qcqs cohomologically smooth morphism D →F where D is a
spatial diamond. Then F is a spatial v-sheaf.
(ii) Suppose moreover there is a family of locally closed generalizing subsets (Xα)α, Xα ⊂|F|, such
that for each α the associated subsheaf of F is a diamond. Then F is a spatial diamond.
Proof. For point (i), since D is qcqs and D →F qcqs surjective, F is qcqs. Since cohomo-
logically smooth implies universally open we can apply [Sch17a, Lemma 2.10] to conclude it is
spatial. For point (ii) we apply [Sch17a, Theorem 12.18]. Let Gα ⊂F be associated to Xα. From
[Sch17a, Lemma 7.6] we deduce that Gα ,→F is quasi-pro-´etale. This implies the result.
□
Remark II.3.9. The proof of Proposition II.3.7 for negative absolute Banach–Colmez space goes
the same way as the proof of the fact that Gr≤µ is a spatial diamond, [SW20, Theorem 19.2.4].
One ﬁrst proves this is a spatial v-sheaf and then one stratiﬁes it by locally closed generalizing
subsets that are diamonds.
Remark II.3.10. One has to be careful that although the absolute BC(O(d)) \ {0} is a spatial
diamond, (BC(O(d))\{0})/πZ is not spatial anymore since not quasiseparated, [Far18a, Remarque
2.15]. In this context the good object is the morphism (BC(O(d))\{0})/πZ →∗that is representable
in spatial diamonds.
Remark II.3.11. In the equal characteristic case, E = Fq((π)), the structure of punctured posi-
tive absolute Banach–Colmez spaces is much simpler since they are perfectoid spaces. Nevertheless
the structure of the punctured negative one is not, they are only spatial diamonds. We will see
below that BC(O(−1)[1]) is stratiﬁed into the open part, which can be written as the quotient of
Spd k((t)) by the action of a proﬁnite group, and a point Spd k. However, the degeneration to the
point happens at the boundary of the open unit disc as |t| →1, not as |t| →0 as in Spa k[[t]]. Thus
BC(O(−1)[1]) is a rather strange geometric object.5
5This example was critical in convincing us to not try to develop a version of the theory of diamonds that would
allow non-analytic test objects like Spa k[[t1/p∞]] and would thus make BC(O(1)) itself representable: After all, in the

II.3. FURTHER RESULTS ON BANACH–COLMEZ SPACES
85
Example II.3.12. The absolute BC(O(−1)[1]) \ {0} classiﬁes extensions
0 −→OXS(−1) −→E −→OXS →0
that are non-split ﬁberwise on S. Any such extension is, at each geometric point, isomorphic to
OXS(−1
2). Parametrizing isomorphisms E ∼= OXS(−1
2) deﬁnes a D×-torsor, where D is the quater-
nion algebra over E; here we use Theorem II.2.19. Remark that if 0 →OXS(−1) →OXS(−1
2) →
L →0 is an extension, then taking the determinant automatically ﬁxes an isomorphism L ∼= OXS,
and thus the E×-torsor of isomorphisms between OXS and L is trivial. From this we deduce that
BC(O(−1)[1]) \ {0} ≃(BC(O(1
2)) \ {0})/SL1(D)
with
BC(O(1
2)) \ {0} ≃Spa(k((x1/p∞)))
the punctured universal cover of a 1-dimensional formal π-divisible OE-module of height 2.
Let us compare this with our previous description of BC(O(−1)[1]) after pullback to Spa(C),
ﬁxing an untilt C♯over E and t ∈H0(XC, OXC(1)) \ {0}: the exact sequence
0 →OXC(−1) →OXC →OC♯→0
induces an isomorphism
BC(O(−1)[1]) ×k Spa(C) ∼= (A1
C♯)♦/E.
We thus have
BC(O(−1)[1]) \ {0} ×k Spa(C) ∼= (ΩC♯)♦/E
where Ω= A1
E \ E is Drinfeld’s upper half plane over E.
We deduce an isomorphism
 (BC(O(1
2)) \ {0}) ×k Spa(C)

/SL1(D) ∼= (ΩC♯)♦/E.
This isomorphism is in fact deduced from the isomorphism between Lubin–Tate and Drinfeld tow-
ers. In fact, [SW13], the Lubin–Tate tower in inﬁnite level, LT∞over Spa(C♯), is the moduli of
modiﬁcations O2
XS ,→OXS(1
2) at the point of the curve deﬁned by the untilt C♯. From this one
deduces a D×-equivariant isomorphism
LT♭
∞
. 
1
E
0
E×

∼= (BC(O(1
2)) \ {0}) ×k Spa(C).
Dividing this isomorphism by SL1(D) one obtains the preceding isomorphism.
Example II.3.13. The absolute BC(O(−2)[1]) \ {0} classiﬁes extensions
0 −→OXS(−1) −→E −→OXS(1) −→0
that are non-split ﬁberwise on S. There is only one Harder–Narasimhan stratum and geometrically
ﬁberwise on S, E is a trivial vector bundle. The moduli of surjections O2
XS ↠OXS(1) is the open
subset
U ⊂(BC(O(1)) \ {0}) ×k (BC(O(1)) \ {0})
context of absolute Banach–Colmez spaces, BC(O(1)) = Spd k[[t1/p∞]] and BC(O(−1)[1]) play very similar roles, so
the formalism should also treat them similarly.

86
II. THE FARGUES–FONTAINE CURVE AND VECTOR BUNDLES
equal to
U = (BC(O(1)) \ {0})2 \ (E× × 1).∆
where ∆is the diagonal of (BC(O(1))\{0})2, that is to say couples (x, y) of sections of H0(XS, OXS(1))
that are ﬁberwise/S non-zero and linearly independent over E. Here (E××1).∆is a locally proﬁnite
union of copies of ∆.
Again, by consideration of determinants, ker(O2
XS ↠OXS(1)) is canonically identiﬁed with
OXS(−1). This implies that
BC(O(−2)[1]) \ {0} = U/SL2(E).

CHAPTER III
BunG
Throughout this chapter, we ﬁx a reductive group G over the nonarchimedean local ﬁeld E.
As it will be important to study BunG over a geometric base point, we ﬁx from now on a complete
algebraically closed ﬁeld k over Fq and work with perfectoid spaces S over Spd k; write Perfk for
the category.
Definition III.0.1. Let BunG be the prestack taking a perfectoid space S ∈Perfk to the groupoid
of G-bundles on XS.
The main results of this chapter are summarized in the following theorem.
Theorem III.0.2 (Proposition III.1.3; Theorem III.2.2; Theorem III.2.3 and Theorem III.2.7;
Theorem III.4.5; Proposition III.5.3). The prestack BunG satisﬁes the following properties.
(i) The prestack BunG is a small v-stack.
(ii) The points | BunG | are naturally in bijection with Kottwitz’ set B(G) of G-isocrystals.
(iii) The map
ν : | BunG | →B(G) →(X∗(T)+
Q)Γ
is semicontinuous, and
κ : | BunG | →B(G) →π1(GE)Γ
is locally constant. Equivalently, the map | BunG | →B(G) is continuous when B(G) is equipped
with the order topology.
(iv) The semistable locus Bunss
G ⊂BunG is open, and given by
Bunss
G ∼=
G
b∈B(G)basic
[∗/Gb(E)].
(v) For any b ∈B(G), the corresponding subfunctor
ib : Bunb
G = BunG ×| BunG |{b} ⊂BunG
is locally closed, and isomorphic to [∗/ eGb], where eGb is a v-sheaf of groups such that eGb →∗is
representable in locally spatial diamonds with π0 eGb = Gb(E). The connected component eG◦
b ⊂eGb
of the identity is cohomologically smooth of dimension ⟨2ρ, νb⟩.
The hardest part of this theorem is that κ is locally constant.
We give two proofs of this
fact. If the derived group of G is simply connected, one can reduce to tori, which are not hard
to handle. In general, one approach is to use z-extensions eG →G to reduce to the case of simply
connected derived group. For this, one needs that Bun eG →BunG is a surjective map of v-stacks;
87

88
III. BunG
we prove this using Beauville–Laszlo uniformization. Alternatively, at least for p-adic E, one can
use the abelianized Kottwitz set of Borovoi [Bor98], which we prove to behave well relatively over
a perfectoid space S.
III.1. Generalities
There is a good notion of G-torsors in p-adic geometry:
Definition/Proposition III.1.1 ([SW20, Proposition 19.5.1]1). Let X be a sousperfectoid
space over E. The following categories are naturally equivalent.
(i) The category of adic spaces T →X with a G-action such that ´etale locally on X, there is a
G-equivariant isomorphism T ∼= G × X.
(ii) The category of ´etale sheaves Q on X equipped with an action of G such that ´etale locally,
Q ∼= G.
(iii) The category of exact ⊗-functors
RepEG →Bun(X)
to the category of vector bundles on X.
A G-bundle on X is an exact ⊗-functor
RepEG →Bun(X);
by the preceding, it can equivalently be considered in a geometric or cohomological manner.
In particular, G-torsors up to isomorphism are classiﬁed by H1
´et(X, G). By Proposition II.2.1,
the following deﬁnes a v-stack.
Definition III.1.2. Let BunG be the v-stack taking a perfectoid space S ∈Perfk to the groupoid
of G-bundles on XS.
Our goal in this chapter is to analyze this v-stack. Before going on, let us quickly observe that
it is small, i.e there are perfectoid spaces S, R with a v-surjection S →BunG and a v-surjection
R →S ×BunG S.
Proposition III.1.3. The v-stack BunG is small.
Proof. It is enough to prove that if Si = Spa(Ri, R+
i ), i ∈I, is an ω1-coﬁltered inverse system
of aﬃnoid perfectoid spaces with inverse limit S = Spa(R, R+), then
BunG(S) = lim
−→BunG(Si).
Indeed, then any section of BunG over an aﬃnoid perfectoid space S = Spa(R, R+) factors over S′ =
Spa(R′, R′+) for some topologically countably generated perfectoid algebra R′. But there is only a
set worth of such R′ up to isomorphism, and then taking the disjoint union T = F
S′,α∈BunG(S′) S′
gives a perfectoid space that surjects onto BunG. Moreover, the equivalence relation T ×BunG T
satisﬁes the same limit property, and hence also admits a similar surjection.
1The reference applies in the case of Zp, but it extends verbatim to OE.

III.2. THE TOPOLOGICAL SPACE |BunG|
89
To see the claim, note ﬁrst that R = lim
−→Ri as any Cauchy sequence already lies in some Ri.
The same applies to BR,I for any interval I, and hence one sees that
Bun(XS) = lim
−→Bun(XSi).
Now the deﬁnition of G-torsors gives the claim.
□
This proof uses virtually no knowledge about BunG and shows that any reasonable v-stack is
small.
III.2. The topological space |BunG|
III.2.1. Points. As a ﬁrst step, we recall the classiﬁcation of G-bundles on the Fargues–
Fontaine curve over geometric points. This is based on the following deﬁnition of Kottwitz, [Kot85].
Definition III.2.1. A G-isocrystal is an exact ⊗-functor
RepE G →IsocE .
The set of isomorphism classes of G-isocrystals is denoted B(G).
By Steinberg’s theorem, the underlying ﬁbre functor to ˘E-vector spaces is isomorphic to the
standard ﬁbre functor; this shows one can identify B(G) with the quotient of G( ˘E) under σ-
conjugation.
Composing with the exact ⊗-functor
IsocE →Bun(XS) : D 7→E(D)
any G-isocrystal deﬁnes a G-bundle on XS, for any S ∈Perfk.
Theorem III.2.2 ([Far18b], [Ans19]). For any complete algebraically closed nonarchimedean
ﬁeld C over k, the construction above deﬁnes a bijection
B(G) →BunG(C)/ ∼= .
Proof. For the convenience of the reader, and as some of the constructions will resurface later,
we give a sketch of the proof in [Ans19]. Any G-bundle on XC has its Harder–Narasimhan ﬁltration,
and the formation of the Harder–Narasimhan ﬁltration is compatible with tensor products. This
implies that any exact ⊗-functor RepE G →Bun(XC) lifts canonically to an exact ⊗-functor
RepE G →FilBun(XC) to Q-ﬁltered vector bundles. To check exactness, note that if E is p-adic,
the category RepE G is semisimple and thus exactness reduces to additivity, which is clear. If E
is of equal characteristic, one needs to argue more carefully, and we refer to the proof of [Ans19,
Theorem 3.11].
We can now project RepE G →FilBun(XC) to the category GrBun(XC) of Q-graded vector
bundles, and note that the essential image of this functor is landing in the category of bundles
L
λ Eλ such that each Eλ is semistable of slope λ. This category is in fact equivalent to IsocE by
Theorem II.2.14 and Proposition II.2.5 (ii). Thus, it suﬃces to see that the ﬁltration on the exact
⊗-functor RepE G →FilBun(XC) can be split.
Looking at splittings locally on XC, they exist, and form a torsor under a unipotent group
scheme U over XC, where U is parametrizing automorphisms of the ﬁltered ﬁbre functor that are

90
III. BunG
trivial on the graded pieces. One can then ﬁlter U by vector bundles of positive slopes, and using
the vanishing of their H1, we get the desired splitting.
□
In particular, using [Sch17a, Proposition 12.7] it follows that the map
B(G) −→|BunG|
is a bijection.
III.2.2. Harder–Narasimhan stratiﬁcation. Now we need to recall Kottwitz’s description
of B(G).
This relies on two invariants, the Newton point and the Kottwitz point.
Let E be a
separable closure of E and ﬁx a maximal torus inside a Borel subgroup T ⊂B ⊂GE; the set of
dominant cocharacters X∗(T)+ is naturally independent of the choice of T and B, and acquires an
action of Γ = Gal(E|E) via its identiﬁcation with
Hom(GmE, GE)/G(E)−conjugacy.
The Newton point is a map
ν : B(G) −→(X∗(T)+
Q)Γ
b 7−→νb.
When G = GLn, then X∗(T) ∼= Zn and the target is the set of nonincreasing sequences of rational
numbers, which are the slopes of the Newton polygon of the corresponding isocrystal. The Kottwitz
point is a map
κ : B(G) −→π1(G)Γ
b 7−→κ(b),
where π1(G) := π1(GQp) = X∗(T)/(coroot lattice) is the Borovoi fundamental group. For G = GLn,
this is naturally isomorphic to Z, and in this case κ(b) is the endpoint of the Newton polygon. In
general, this compatibility is expressed by saying that the images of κ(b) and νb in
π1(G)Γ
Q
agree (using an averaging operation for κ(b)). However, this means that in general κ(b) is not
determined by νb, as π1(GE)Γ may contain torsion.
The deﬁnition of κ is done in steps. First, one deﬁnes it for tori, where it is actually a bijection.
Then one deﬁnes it for G whose derived group is simply connected; in that case, it is simply done via
passage to the torus G/Gder which does not change π1. In general, one uses a z-extension eG →G
such that eG has simply connected derived group, observing that B( eG) →B(G) is surjective.
Borovoi, [Bor98], gave a more canonical construction of κ as an abelianization map that does
not use the choice of a z-extension, at least in the case of p-adic E. We will recall the construction
in Section III.2.4.2.
Finally, recall that (ν, κ) : B(G) →(X∗(T)+
Q)Γ × π1(G)Γ is injective.
Let v 7→v∗= w0(−v) be the involution of the positive Weyl chamber X∗(T)+
Q where w0 is the
longest element of the Weyl group. The Harder–Narasimhan polygon of Eb is ν∗
b . Its ﬁrst Chern
class is −κ(b).

III.2. THE TOPOLOGICAL SPACE |BunG|
91
We need to understand how ν and κ vary on B(G). The following result follows from Theo-
rem II.2.19 and [RR96, Lemma 2.2].
Theorem III.2.3 ([SW20, Corollary 22.5.1]). The map
ν∗: |BunG| ∼= B(G) →(X∗(T)+
Q)Γ
is upper semicontinuous.
We will later prove in Theorem III.2.7 that κ is locally constant on BunG.
III.2.3. Geometrically ﬁberwise trivial G-bundles. Let
[∗/G(E)]
be the classifying stack of pro-´etale G(E)-torsors, and
Bun1
G ⊂BunG
be the substack of geometrically ﬁberwise trivial G-bundles. One has H0(XS, OXS) = E(S) and
thus G(E) acts on the trivial G-bundle. From this we deduce a morphism
[∗/G(E)] −→Bun1
G .
We are going to prove that this is an isomorphism. Let us note that, although this is an isomor-
phism at the level of geometric points, we can not apply [SW20, Lemma 12.5] since it is not clear
that it is qcqs.
Theorems III.2.3 and III.2.7 (to follow) taken together imply that the locus
Bun1
G ⊂BunG
is an open substack. One of our proofs of Theorem III.2.7 will however require this statement as
an input. Of course, when π1(G)Γ is torsion free, that is to say H1(E, G) = {1}, Theorem III.2.3
is enough to obtain the openness.
Theorem III.2.4. The substack Bun1
G ⊂BunG is open, and the map
[∗/G(E)] ∼
−→Bun1
G
deﬁned above is an isomorphism.
Proof. Let S ∈Perfk be qcqs with a map to BunG. We need to see that the subset of |S| over
which this map is trivial at any geometric point is open; and that if this is all of S, then the data
is equivalent to a pro-´etale G(E)-torsor.
Let us check the openness assertion. If T →S is surjective with T qcqs then |T| →|S| is
a quotient map. We can thus assume that S is strictly totally disconnected. The locus where
the Newton point is identically zero is an open subset of S by Theorem III.2.3, so passing to
this open subset, we can assume that the Newton point is zero. In that case, for any algebraic
representation ρ : G →GLn, the corresponding rank n vector bundle on XS is trivial.
Now,
geometrically ﬁberwise on S trivial vector bundles on XS are equivalent to E-local systems on S by
Corollary II.2.20. On the other hand, as S is strictly totally disconnected, all E-local systems on S

92
III. BunG
are trivial (Lemma III.2.6 for G = GLn), and their category is equivalent to the category of ﬁnite
free modules over C0(|S|, E). Thus, the preceding discussion deﬁnes a ﬁbre functor on RepE(G)
with values in C0(|S|, E) = C0(π0(S), E), i.e. a G-torsor over Spec(C0(π0(S), E)). Note that for all
s ∈π0(S), the local ring lim
−→U∋s C0(|U|, E) is henselian as the local ring of the analytic adic space
π0(S)×Spa(E) at s. This implies that if this G-torsor is trivial at some point of S, then it is trivial
in a neighborhood. This concludes the openness assertion.
Moreover, the preceding argument shows that the map ∗→Bun1
G is a pro-´etale cover. As
∗×Bun1
G ∗= G(E), as automorphisms of the trivial G-torsor are given by G(E), we thus get the
desired isomorphism.
□
Remark III.2.5 ([Sch17a, Lemma 10.13]). If S is a perfectoid space, and T →S is a pro-´etale
G(E)-torsor then T is representable by a perfectoid space. In fact, T = lim
←−K K\T where K goes
through the set of compact open subgroups of G(E). By descent of ´etale separated morphisms
([Sch17a, Proposition 9.7]), for each such K, K\T is represented by a separated ´etale perfectoid
space over S. The transition morphisms in the preceding limit are ﬁnite ´etale.
Lemma III.2.6. Let S be a strictly totally disconnected perfectoid space. Then any pro-´etale
G(E)-torsor on S is trivial.
Proof. Let T →S be such a torsor.
Fix a compact open subgroup K ⊂G(E).
Since
K\T →S is an ´etale cover of perfectoid spaces it has a section and we can assume T →S is in fact
a K-torsor. Now, T = lim
←−U U\T where U goes through the set of distinguished open subgroups of
K. Each U\T →S is an ´etale K/U-torsor and is trivial. One concludes using that if U′ ⊂U then
K/U′(S) →K/U(S) is surjective.
□
III.2.4. Local constancy of the Kottwitz invariant. A central result is the following.
Theorem III.2.7. The map
κ : |BunG| ∼= B(G) →π1(G)Γ
is locally constant.
Let us note the following corollary. We give a new proof (and slight strengthening) of a result
of Rapoport–Richartz (when p | |π1(G)| the original proof used p-adic nearby cycles and relied on
a ﬁnite type hypothesis).
Corollary III.2.8 ([RR96, Corollary 3.11]). Let S be an Fq-scheme and E an G-isocrystal
on S. The map |S| →π1(G)Γ that sends a geometric point ¯s →S to κ(E¯s) is locally constant.
Proof. We can suppose S = Spec(R) is aﬃne and deﬁned over k. We get a small v-sheaf
Spd(R, R), and E deﬁnes a morphism Spd(R, R) →BunG. The induced map κ : | Spd(R, R)| →
| BunG | →π1(G)Γ is locally constant by Theorem III.2.7. As open and closed subsets of Spd(R, R)
are in bijection with open and closed subschemes of Spec(R) (by [SW20, Proposition 18.3.1] applied
to morphisms to ∗⊔∗), we can thus assume that κ : | Spd(R, R)| →| BunG | →π1(G)Γ is constant.
But now for any geometric point ¯s →S, the element κ(E¯s) ∈π1(G)Γ agrees with the image of
∗= | Spd(¯s, ¯s)| →| Spd(R, R)| →| BunG | →π1(G)Γ, giving the desired result.
□

III.2. THE TOPOLOGICAL SPACE |BunG|
93
Remark III.2.9. There is a natural map | Spd(R, R)| →| Spa(R, R)|, the latter of which admits
two natural maps to | Spec(R)| (given by the support of the valuation, or the prime ideal of all
elements of norm < 1). However, the maps κ deﬁned on | Spd(R, R)| and | Spec(R)| do not make
this diagram commute. Still, there is also the map | Spec(R)| →| Spd(R, R)|, used in the proof,
and this is continuous, and commutes with the κ maps.
We give two diﬀerent proofs of Theorem III.2.7.
III.2.4.1. First proof. For the ﬁrst proof of Theorem III.2.7, we also need the following lemma
that we will prove in the next section.
Lemma III.2.10. Let eG →G be a central extension with kernel a torus. Then
Bun eG →BunG
is a surjective map of v-stacks.
In fact, up to correctly interpreting all the relevant structure, if Z ⊂eG is the kernel, then BunZ
is a Picard stack (as for commutative Z one can tensor Z-bundles) which acts on Bun eG, and BunG
is the quotient stack. It is in fact clear that it is a quasitorsor, and the lemma ensures surjectivity.
First Proof of Theorem III.2.7. Picking a z-extension, we can by Lemma III.2.10 reduce
to the case that G has simply connected derived group. Then we may replace G by G/Gder, and so
reduce to the case that G is a torus. By a further application of Lemma III.2.10, we can reduce to
the case that G is an induced torus. In that case π1(G)Γ is torsion-free, and so the Kottwitz map
is determined by the Newton map, so the result follows from Theorem III.2.3, noting that in the
case of tori there are no nontrivial order relations so semicontinuity means local constancy.
□
It remains to prove Lemma III.2.10. This will be done in the next section, using Beauville–
Laszlo uniformization.
III.2.4.2. Second proof. For this proof, we assume that E is p-adic (otherwise certain non-´etale
ﬁnite ﬂat group schemes may appear). We deﬁne
Bab(G) = H1(WE, [Gsc( ˘E) →G( ˘E)]),
the abelianized Kottwitz set (cohomology with coeﬃcient in a crossed module, see [Bor98] and
[Lab99, Appendix B]). There is an abelianization map
B(G) −→Bab(G)
deduced from the morphism [1 →G] →[Gsc →G]. If T is a maximal torus in G with reciprocal
image Tsc in Gsc then
[Tsc →T] −→[Gsc →G]
is a homotopy equivalence. If Z, resp. Zsc, is the center of G, resp. Gsc, there is a homotopy
equivalence
[Zsc →Z] −→[Gsc →G].

94
III. BunG
Lemma III.2.11. There is an identiﬁcation
Bab(G) = π1(G)Γ
through which Kottwitz map κ is identiﬁed with the abelianization map B(G) →Bab(G).
Proof. Choose a maximal torus T in G. One has
Bab(G) = H1(WE, [Tsc( ˘E) →T( ˘E)])
= coker
 B(Tsc) →B(T)

since H2(WE, Tsc( ˘E)) = 0 (use [Ser94, Chapter II.3.3 example (c)] and [Ser94, Chapter III.2.3
Theorem 1’]). The result is deduced using Kottwitz description of B(Tsc) and B(T) = X∗(T)Γ.
□
For S ∈Perfk there is a morphism of sites
τ : (XS)´et −→S´et
deduced from the identiﬁcations
(XS)´et = (X♦
S )´et = (Div1
S)´et
and the projection Div1
S →S. Equivalently, τ ∗takes any ´etale T →S to XT →XS, which is again
´etale.
We now interpret some ´etale cohomology groups of the curve as Galois cohomology groups, as
in [Far18b] where this type of computation was done for the schematical curve attached to an
algebraically closed perfectoid ﬁeld.
Proposition III.2.12. Let S ∈Perfk.
(i) Let F be a locally constant sheaf of ﬁnite abelian groups on Spa(E)´et. One has
Rτ∗F|XS = RΓ´et(Spa(E), F)
as a constant complex on S´et.
(ii) If D is a diagonalizable algebraic group over E, the pro-´etale sheaf associated to
T/S 7−→H1
´et(XT , D)
is the constant sheaf with value H1(WE, D( ˘E)).
Proof. Let us note G = F|XS. There is a natural morphism RΓ´et(Spa(E), F) →Rτ∗G. The
morphism Div1
S →S is proper and applying [Sch17a, Corollary 16.10 (ii)], we are reduced to prove
that
H•
´et(Spa(E), F) ∼
−→H•
´et(XC,C+, G)
when C is an algebraically closed ﬁeld. Since XC,C+ is quasicompact quasiseparated
H•
´et(XC,C+ b⊗E bE, G) =
lim
−→
E′|E ﬁnite
H•(XC,C+ ⊗E E′, G),
and, using Galois descent, it thus suﬃces to prove that the left member vanishes in positive degrees,
and equals F|E in degree 0.

III.2. THE TOPOLOGICAL SPACE |BunG|
95
Let K = Fq((T)) and X(C,C+),K the equal characteristic Fargues–Fontaine curve over Spa(K).
Identifying bE
♭
with [
Ksep, one has
(X(C,C+),E b⊗E bE)♭= X(C,C+),K b⊗[
Ksep.
Using this we are reduced to prove that for any prime number n, for i > 0
Hi
´et(X(C,C+),K b⊗K [
Ksep, Z/nZ) = 0.
This is reduced, as above, to prove that any class in Hi
´et(X(C,C+),K, Z/nZ) is killed by pullback to
a ﬁnite separable extension of K.
When n ̸= p one has
RΓ´et(X(C,C+),K, Z/nZ) = RΓ(ϕZ, RΓ´et(D∗
C,C+, Z/nZ))
where T is the coordinate on the open punctured disk
D∗
C,C+ = Spa(C, C+) × Spa(K).
One has Hk(D∗
C,C+, Z/nZ)) = 0 for k > 1, and this is equal, via Kummer theory, to Z/nZ(−1) for
k = 1. The Kummer covering of D∗
C,C+ induced by T 7→T n kills any class in H1(D∗
C,C+, Z/nZ).
Also H0(D∗
C,C+, Z/nZ) = Z/nZ and the class in H1(ϕZ, Z/nZ) = Z/nZ is killed by passing up
along an unramiﬁed extension of K of degree n.
When n = p we use Artin-Schreier theory. Since C is an algebraically closed ﬁeld we have
Hi(X(C,C+),K, O) = 0 when i > 0. Since the adic space X(C,C+),K is noetherian we deduce that
Hi
´et(X(C,C+),K, O) = 0 for i > 0. Thus, Hi
´et(X(C,C+),K, Z/nZ) is 0 for i > 1 and coker(K
F−Id
−−−→K)
when i = 1, which is killed by pullback to an Artin-Schreier extension of K. This ﬁnishes the proof
of point (1).
For point (2). There is a natural morphism
H1(WE, D( ˘E)) →H1(XS, D)
(see just after the proof of this proposition). Suppose ﬁrst that D is a torus. Then point (2) is the
computation of the coarse moduli space of BunD as a pro-´etale stack. This itself is a consequence
of Theorem III.2.4 using a translation argument from 1 to any [b] ∈B(D) (use the Picard stack
structure on BunD).
For any D we use the exact sequence
1 −→D0 −→D −→π0(D) −→1.
For T/S there is a diagram
H0(E, π0(D))
B(D0)
H1(WE, D( ˘E))
H1(E, π0(D))
0
H0(XT , π0(D))
H1
´et(XT , D0)
H1
´et(XT , D)
H1
´et(XT , π0(D))
since H2(WE, D0( ˘E)) = 0 and H•(WE, π0(D)( ˘E)) = H•(WE, π0(D)(E)). The result is then de-
duced from part (1) and the torus case.
□

96
III. BunG
For S ∈Perfk there is a natural morphism of groups
Bab(G) −→H1
´et(XS, [Gsc →G]).
This is deduced from the natural continuous morphism of sites
(XS)´et −→{discrete WE-sets}.
Proposition III.2.13. For S ∈Perfk, the pro-´etale sheaf on S associated with
T/S 7−→H1
´et(XT , [Gsc →G])
is the constant sheaf with value Bab(G).
Proof. We use the homotopy equivalence [Zsc →Z] →[Gsc →G]. There is a diagram
H1(WE, Zsc( ˘E))
/
≃

H1(WE, Z( ˘E))
/
≃

H1(WE, [Gsc( ˘E) →G( ˘E)])
/

H2(WE, Zsc( ˘E))
≃

H1
´et(XT , Zsc)
/ H1
´et(XT , Z)
/ H1
´et(XT , [Zsc →Z])
/ H2
´et(XT , Zsc)
/ H2(WE, Z( ˘E))

≃
/
 _

H2(E, π0(Z))

≃

/ H2
´et(XT , Z)

/ H2
´et(XT , π0(Z))

.
Using Proposition III.2.12 and some diagram chasing we conclude.
□
Second Proof of Theorem III.2.7. The theorem is now deduced from the preceding Propo-
sition III.2.13 and the abelianization map H1
´et(XS, G) →H1
´et(XS, [Gsc →G]).
□
Remark III.2.14. Let Xalg
C
be the schematical curve associated to C|Fq algebraically closed.
The results of [Far18b] for the ´etale cohomology of torsion local systems, [Far18b, Theorem 3.7]
and the vanishing of the H2(XC, T) for a torus T, [Far18b, Theorem 2.7], can be stated in a more
uniform way; if D is a diagonalizable group over E then Hi(WE, D( ˘E))
∼
−→Hi
´et(XC, D) for 0 ≤
i ≤2. Weil cohomology of E is the natural cohomology theory that corresponds to ´etale cohomology
of the curve. For example Theorem III.2.2 can be restated as H1(WE, G( ˘E)) ∼
−→H1
´et(XC, G) for a
reductive group G.
III.2.5. The explicit description of | BunG |. Theorem III.2.3 and Theorem III.2.7 imply
that the map
| BunG | →B(G)
is continuous when the target is endowed with the topology induced by the order on (X∗(T)+
Q)Γ
and the discrete topology on π1(G)Γ.
Conjecture III.2.15. The map | BunG | →B(G) is a homeomorphism.

III.3. BEAUVILLE–LASZLO UNIFORMIZATION
97
In other words, whenever b, b′ ∈B(G) such that b > b′, there should be a specialization from b
to b′ in | BunG |.
The conjecture is known for G = GLn by work of Hansen, [Han17], based on [BFH+17]. The
argument has been extended to some other classical groups in unpublished work of Hamann. While
ﬁnishing our manuscript, a proof for general G has been given by Viehmann [Vie21].
We will later prove some weak form of the conjecture in Corollary IV.1.23, determining the
connected components of BunG using simple geometric considerations.
III.3. Beauville–Laszlo uniformization
Recall from [SW20, Lecture XIX] the B+
dR-aﬃne Grassmannian
GrG
of G over Spd E, sending an aﬃnoid perfectoid S = Spa(R, R+) over Spd E to the G-torsors
over Spec(B+
dR(R♯)) with a trivialization over BdR(R♯); here R♯/E is the untilt of R given by
S →Spd(E). In [SW20] this was considered over Spa(C♭) for some C|E algebraically closed but
we want now to consider it in a more “absolute” way over Spd(E).
Since any G-torsor over Spec(B+
dR(R♯)) is trivial locally on Spa(R, R+)´et, this coincides with
the ´etale sheaf associated to the presheaf (R, R+) 7→G(BdR(R♯))/G(B+
dR(R♯)).
This has an interpretation as a Beilinson–Drinfeld type aﬃne Grassmannian.
If E, E′ ∈
BunG(S) and D ∈Div1(S), a modiﬁcation between E and E′ at D is an isomorphism
E|XS\D
∼
−−→E′|XS\D
that is meromorphic along D.
The latter means that for any representation in RepE(G), the
associated isomorphism between vector bundles, F|XS\D
∼
−−→F′|XS\D extends to a morphism
F →F′(kD) for k ≫0 via F′ ,→F′(kD). Beauville–Laszlo gluing then identiﬁes
GrG /ϕZ −→Div1
with the moduli of D ∈Div1(S), E ∈BunG(XS), and a modiﬁcation between the trivial G-bundle
and E at D, cf. [SW20, Proposition 19.1.2]. This deﬁnes a morphism of v-stacks
GrG −→BunG .
Proposition III.3.1. The Beauville–Laszlo morphism
GrG −→BunG
is a surjective map of v-stacks; in fact, of pro-´etale stacks.
Proof. Pick any S = Spa(R, R+) ∈Perfk aﬃnoid perfectoid with a map to BunG, given
by some G-bundle E on XS. Fix an untilt S♯of S over Spa(E). To prove surjectivity as pro-
´etale stacks, we can assume that S is strictly totally disconnected. By [Far18b, Th´eor`eme 7.1]
(in case G quasisplit) and [Ans19, Theorem 6.5] (for general G), for any connected component
Spa(C, C+) ⊂S of S, the map GrG(C) →BunG(C) is surjective, so in particular, we can pick a
modiﬁcation E′
C of E|XC,C+ at Spa(C♯, C♯,+) ,→XC,C+ such that E′
C is trivial.

98
III. BunG
Now, since S is strictly totally disconnected, we can trivialize E at the completion at S♯; as
GrG(S) →GrG(C) is surjective (Lemma III.3.2), we can lift E′
C to a modiﬁcation E′ of E. Now
Theorem III.2.4 implies that E′ is trivial in a neighborhood of the given point, and as S is strictly
totally disconnected, the corresponding G(E)-torsor is trivial (Lemma III.2.6), so we can trivialize
E′ in a neighborhood of the given point. This shows that locally on S, the bundle E is in the image
of GrG →BunG, as desired.
□
Lemma III.3.2. For S = Spa(R, R+) a strictly totally disconnected perfectoid space over Spa(E),
and s ∈S, the map GrG(R) →GrG(K(s)) is surjective.
Proof. Set C = K(s). First note that R →C is surjective, as any connected component of S
is an intersection of open and closed subsets, and thus Zariski closed.
Since C is algebraically closed, GrG(C) = G(BdR(C))/G(B+
dR(C)). For any ﬁnite degree exten-
sion E′|E in C, since S ⊗E E′ →S is ´etale and S strictly totally disconnected, E′ can be embedded
in R. Fix such an E′ ⊂R that splits G and a pair T ⊂B inside GE′. Let ξ ∈WOE(R♭,+) be a
generator of the kernel of θ. The Cartan decomposition
G(BdR(C)) =
a
µ∈X∗(T)+
G(B+
dR(C))µ(ξ)G(B+
dR(C))
shows then that we only need to prove that G(B+
dR(R)) →G(B+
dR(C)) is surjective.
Let us ﬁrst remark that G(R) →G(C) is surjective. In fact, since S is totally disconnected it
suﬃces to check that G(OS,s) →G(C) is surjective. But this is a consequence of the smoothness
of G and the fact that OS,s is Henselian (with residue ﬁeld C).
Moreover G(B+
dR(R)) = lim
←−n≥1 G(B+
dR(R)/ Filn).
Using the surjectivity of Lie(G) ⊗R →
Lie(G) ⊗C the result is then deduced by an approximation argument.
□
Remark III.3.3. In the “classical case” of the moduli of G-bundles over a proper smooth
algebraic curve over a ﬁeld k, G/k, Proposition III.3.1 is true only when G is semi-simple ([DS95]).
Typically this is false for GLn in general. The main reason why it is true in our situation is that
Pic0(XC,C+) is trivial, equivalently that Xalg
C
\ {x} is the spectrum of a principal ideal domain in
Proposition II.2.9.
Lemma III.3.4. If G is split then
GrG =
lim
−→
µ∈X∗(T)+
GrG,≤µ
as a v-sheaf, where the index set is a partially ordered set according to the dominance order (µ ≤µ′
if µ′ −µ is a nonnegative integral sum of positive coroots).
Proof. Consider a morphism S →GrG with S quasicompact quasiseparated. Fix an embed-
ding G ,→GLn such that the image of T lies in the standard maximal torus of GLn. This induces
an embedding X∗(T)+ ,→Zn. One checks easily that the image of |S| →|GrGLn| lies in a ﬁnite
union of aﬃne Schubert cells. Since the ﬁbers of X∗(T)+ →Zn/Sn are ﬁnite we deduce that there
is a ﬁnite collection (µi)i, µi ∈X∗(T)+, such that the image of |S| →|GrG| lies in ∪i|GrG,≤µi|. By
[SW20, Proposition 19.2.3], Si := S ×GrG GrG,≤µi is closed in S and thus quasicompact. Since the

III.3. BEAUVILLE–LASZLO UNIFORMIZATION
99
morphism `
i Si →S is surjective at the level of points with quasicompact source it is quasicompact
and thus a v-cover. This allows us to conclude.
□
Lemma III.3.5. Suppose eG →G is a central extension with kernel a torus. Then
Gr eG →GrG
is a surjective map of v-sheaves.
Proof. Up to replacing E by a ﬁnite degree extension we can suppose G and eG are split. Fix
eT →T inside eG →G. According to Lemma III.3.4 it is enough to prove that for any eµ ∈X∗( eT)+,
if µ ∈X∗(T)+ is its image in G, then Gr eG,≤eµ →GrG,≤µ is surjective. This is clearly surjective
at the level of points since, if D is the kernel of eG →G, then H1
´et(Spec(BdR(C)), D) = 0, and
thus eG(BdR(C)) →G(BdR(C)) is surjective.
Since Gr eG,≤eµ is quasicompact over Spd(E) and
GrG,≤µ quasiseparated over Spd(E) (both are proper according to [SW20, Proposition 19.2.3]),
Gr eG,≤eµ →GrG,≤µ is quasicompact and thus a v-cover by [Sch17a, Lemma 12.11].
□
Using Proposition III.3.1, we thus have now a proof of Lemma III.2.10.
Let us record a few facts we can deduce from the preceding results.
Proposition III.3.6. Suppose G is split.
(i) There is a locally constant map |GrG| →π1(G) inducing a decomposition in open/closed sub-
sheaves
GrG =
a
α∈π1(G)
Grα
G
characterized by GrG,µ ⊂Grµ♯
G .
(ii) The composite
|GrG| Beauville–Laszlo
−−−−−−−−−−→| BunG |
κ
−−→π1(G)
is the opposite of the preceding map.
(iii) For each α ∈π1(G),
Grα
G =
lim
−→
µ∈X∗(T)+,µ♯=α
Grα
G,≤µ
as a ﬁltered colimit of v-sheaves.
Proof. Point (1) is reduced to the case when Gder is simply connected using Lemma III.3.5
and a z-extension. Now, if Gder is simply connected, for µ1, µ2 ∈X∗(T)+, µ1 ≤µ2 implies µ♯
1 = µ♯
2.
The result is then deduced from the fact that GrG,≤µ ⊂GrG is closed for any µ.
Point (2) is can be similarly reduced ﬁrst to the case that Gder is simply connected by passage
to a z-extension; then to the case of a torus by taking the quotient by Gder; then to the case of an
induced torus by another z-extension; and then to Gm by changing E. In that case, it follows from
Proposition II.2.3.
Point (3) is deduced from Lemma III.3.4 and the fact that for α ∈π1(G), {µ ∈X∗(T)+ | µ♯= α}
is a ﬁltered ordered set.
□

100
III. BunG
When G is not split, choosing E′|E Galois of ﬁnite degree splitting G, using the formula
GrG ×Spd(E) Spd(E′) = GrGE′, one deduces:
(i) There is a decomposition GrG = `
¯α∈Γ\π1(G) Gr¯α
G and a formula GrG = lim
−→¯µ∈Γ\X∗(T)+ GrG,≤¯µ
such that GrG,≤¯µ ⊂Gr
¯
µ♯
G .
(ii) The composite |GrG| BL
−−→| BunG | κ−→π1(G)Γ is induced by the opposite of Γ\π1(G) →π1(G)Γ
and the preceding decomposition.
This description of the Kottwitz map, together with Proposition III.3.1, in fact gives another
proof of Theorem III.2.7.
III.4. The semistable locus
III.4.1. Pure inner twisting. Recall the following. In the particular case of non abelian
group cohomology this is called “torsion au moyen d’un cocycle” in [Ser94, I.5.3].
Proposition III.4.1. Let X be a topos, H a group in X and T an H-torsor. Let HT = Aut(T)
as a group in X. Then:
(i) HT is the “pure inner twisting” of H by T, HT = H
H∧T where H acts by conjugation on H.
In particular [HT ] ∈H1(X, Had) is the image of [T] via H1(X, H) →H1(X, Had).
(ii) The morphism of stacks in X, [∗/H] →[∗/HT ], that sends an H-torsor S to Isom(S, T), is an
equivalence.
In the following we use the cohomological description of G-bundles on the curve as G-torsors
on the ´etale site of the sous-perfectoid space XS (here G is seen as an E-adic group, for (R, R+) a
sous-perfectoid E-algebra its Spa(R, R+)-points being G(R)).
Proposition III.4.2. Let S ∈Perfk, b ∈B(G) basic and Eb →XS the associated ´etale G-torsor.
Then the ´etale sheaf of groups Gb ×Spa(E) XS over XS is the pure inner twisting of G ×Spa(E) XS
by Eb.
Proof. One has
Eb = (G ˘E ×Spa( ˘E) YS)/((bσ) × ϕ)Z −→XS
where bσ acts on G ˘E by translation on the right. The G × XS = (G ˘E ×Spa( ˘E) YS)/(Id × ϕ)Z-torsor
structure is given by multiplication on the left on G ˘E. The group Gb × XS = (Gb × YS)/(Id × ϕ)Z
acts on this torsor on the right via the morphism Gb →G ˘E, which gives a morphism
Gb × XS →Aut(Eb).
After pullback via the ´etale cover YS →XS and evaluation on T = Spa(R, R+) →YS aﬃnoid
sous-perfectoid, this is identiﬁed with the map
Gb(R) = {g ∈G( ˘E ⊗E R) | g · (bσ ⊗1) = (bσ ⊗1) · g} −→G(R)
deduced from the ˘E-algebra structure of R. But as b is basic, the natural map
Gb ×E ˘E →G ×E ˘E

III.4. THE SEMISTABLE LOCUS
101
is an isomorphism, cf. [RZ96, Corollary 1.14].
□
Thus, extended pure inner forms, as deﬁned by Kottwitz, become pure inner forms, as deﬁned
by Vogan, when pulled back to the curve.
Corollary III.4.3. For b basic there is an isomorphism of v-stacks
BunG ≃BunGb
that induces an isomorphism Bunb
G ≃Bun1
Gb.
Example III.4.4. Take G = GLn and (D, ϕ) an isoclinic isocrystal of height n.
Let B =
End(D, ϕ) be the associated simple algebra over E.
Since (D, ϕ) is isoclinic the action of B
on E(D, ϕ) induces an isomorphism B ⊗E OXS
∼
−→End(E(D, ϕ)) for any S ∈Perfk. The stack
BunB× is identiﬁed with the stack S 7→{rank 1 locally free B ⊗E OXS-modules}. There is then an
isomorphism (Morita equivalence)
BunGLn
∼
−−→BunB×
E 7−→HomOXS (E, E(D, ϕ)).
III.4.2. Description of the semi-stable locus. Recall from [Far18b] that a G-bundle over
XC,C+ is semistable if and only if it corresponds to some basic element of B(G). Also recall that
for any b ∈B(G), the automorphism group of the corresponding G-isocrystal deﬁnes an algebraic
group Gb over G. If G is quasisplit, then Gb is an inner form of a Levi subgroup of G, and it is an
inner form of G precisely when b is basic. More generally Gb is an inner form of a Levi subgroup
of the quasisplit inner form of G.
Theorem III.4.5. The semistable locus
Bunss
G ⊂BunG
is open, and there is a canonical decomposition as open/closed substacks
Bunss
G =
a
b∈B(G)basic
Bunb
G.
For b basic there is an isomorphism
[∗/Gb(E)] ∼
−→Bunb
G.
Proof. Theorem III.2.3 implies that Bunss
G is open. Recall that the basic elements of B(G)
map isomorphically to π1(G)Γ via the Kottwitz map. Thus Theorem III.2.7 gives a disjoint decom-
position
Bunss
G =
a
b∈B(G)basic
Bunb
G.
The result is then a consequence of Proposition III.4.2 and Theorem III.2.4.
□
Example III.4.6. For a torus T, BunT = Bunss
T and there is an exact sequence of Picard stacks
0 −→[∗/T(E)] −→BunT −→X∗(T)Γ −→0,

102
III. BunG
where we recall that X∗(T)Γ = B(T).
The ﬁber of BunT →B(T) over β is a gerbe banded
by T(E) over ∗via the action Bun1
T . This gerbe is neutralized after choosing some b such that
[b] = β. In case there is a section of T( ˘E) ↠B(T), for example if B(T) is torsion free, then
BunT ≃[∗/T(E)] × X∗(T)Γ as a Picard stack.
III.4.3. Splittings of the Harder–Narasimhan ﬁltration. We can also consider the fol-
lowing moduli problem, parametrizing G-bundles with a splitting of their Harder–Narasimhan
ﬁltration.
Proposition III.4.7. Consider the functor BunHN-split
G
taking each S ∈Perfk to the groupoid
of exact ⊗-functors from RepE G to the category of Q-graded vector bundles E = L
λ Eλ on XS
such that Eλ is everywhere semistable of slope λ for all λ ∈Q. For any b ∈B(G), the bundle Eb
naturally reﬁnes to a Q-graded bundle Egr
b , using the Q-grading on isocrystals, and for S aﬃnoid
the natural map
Gb ×E Xalg
S
→Aut(Egr
b )
of group schemes over Xalg
S
is an isomorphism. In particular, we get a natural map
G
b∈B(G)
[∗/Gb(E)] →BunHN-split
G
,
and this is an isomorphism.
Proof. Recall that the natural map Gb ×E ˘E →G ×E ˘E, recording the map of underly-
ing ˘E-vector spaces, is a closed immersion identifying Gb ×E ˘E with the centralizer of the slope
homomorphism νb : D →G ×E ˘E, cf. [RZ96, Corollary 1.14]. This implies that the natural map
Gb ×E Xalg
S
→Aut(Egr
b )
is an isomorphism.
We get the evident functor from F
b∈B(G)[∗/Gb(E)] to this moduli problem, and it is clearly fully
faithful. To see that it is surjective, take any strictly totally disconnected S and an exact ⊗-functor
Egr from RepE G to such Q-graded vector bundles. For any point s ∈S, note that Q-graded vector
bundles of the given form on XK(s) are equivalent to IsocE, so at s ∈S there is an isomorphism
with some Egr
b . The type of the Q-ﬁltration is locally constant, so after replacing S by an open
neighborhood of s, we can assume that
Isom(Egr
b , Egr)
deﬁnes an Aut(Egr
b )-torsor over Xalg
S , i.e. a Gb-torsor over S. This deﬁnes a map S →BunGb,
taking s into Bun1
Gb, and by Theorem III.2.4 and Lemma III.2.6 it follows that after replacing S
by an open neighborhood, we can assume that the torsor is trivial. This concludes the proof of
surjectivity.
□

III.5. NON-SEMISTABLE POINTS
103
III.5. Non-semistable points
III.5.1. Structure of Aut(Eb). Next, we aim to describe the non-semi-stable strata Bunb
G.
Thus, ﬁx any b ∈B(G) and consider the associated G-bundle Eb on XS. For any algebraic repre-
sentation ρ : G →GLn, the corresponding vector bundle ρ∗Eb has its Harder–Narasimhan ﬁltration
(ρ∗Eb)≥λ ⊂ρ∗Eb, λ ∈Q. If G is quasisplit and we ﬁx a Borel B ⊂G, then this deﬁnes a reduction
of Eb to a parabolic P ⊂G containing B.
Now inside the automorphism v-sheaf
eGb = Aut(Eb)
(which necessarily preserves the Harder–Narasimhan ﬁltration of ρ∗Eb for any ρ ∈RepE(G)) one
can consider for any λ > 0 the subgroup
eG≥λ
b
⊂eGb
of all automorphisms γ : Eb
∼
−→Eb such that
(γ −1)(ρ∗Eb)≥λ′ ⊂(ρ∗Eb)≥λ′+λ
for all λ′ and all representations ρ of G. We also set eG>λ
b
= S
λ′>λ eG≥λ′
b
, noting that this union is
eventually constant.
As Gb(E) is the automorphism group of the isocrystal corresponding to b, and H0(XS, OXS) =
E(S), we have a natural injection
Gb(E) ,→eGb.
Now, for any automorphism γ of Eb and any representation ρ, γ induces an automorphism of the
Q-graded vector bundle
M
λ∈Q
Grλ(ρ∗Eb).
Using Proposition III.4.7, we deduce that the preceding injection has a section and
eGb = eG>0
b
⋊Gb(E).
For a G-bundle E on XS we note ad E for its adjoint bundle deduced by pushforward by the adjoint
representation G →GL(Lie(G)). This is in fact a Lie algebra bundle.
Proposition III.5.1. One has
eGb = eG>0
b
⋊Gb(E),
and for any λ > 0, there is a natural isomorphism
eG≥λ
b / eG>λ
b
∼
−−→BC((ad Eb)≥λ/(ad Eb)>λ),
the Banach–Colmez space associated to the slope −λ isoclinic part of (Lie(G) ⊗E ˘E, Ad(b)σ).
In particular, eGb is an extension of Gb(E) by a successive extension of positive Banach–Colmez
spaces, and thus eGb →∗is representable in locally spatial diamonds, of dimension ⟨2ρ, νb⟩(where
as usual ρ is the half-sum of the positive roots).
We refer to [SR72, Section IV] and [Zie15] for some general discussion of ﬁltered and graded
ﬁbre functors.

104
III. BunG
Proof. We already saw the ﬁrst part. For the second part, suppose S = Spa(R, R+) is aﬃnoid.
Let Xalg
R
be the schematical curve. We use the GAGA correspondence, Proposition II.2.7. Now, we
apply Proposition III.5.2 to Xalg
R
and the G-bundle Eb associated to b on Xalg
R . Let H be the inner
twisting of G × Xalg
R
by Eb as a reductive group scheme over Xalg
R . It is equipped with a ﬁltration
(H≥λ)λ≥0 satisfying
• H≥0/H>0 ∼= Gb ×E Xalg
R ,
• for λ > 0, H≥λ/H>λ = (ad Eb)≥λ/(ad Eb)>λ,
• eG≥λ
b (S) = H≥λ(Xalg
R ),
functorially in (R, R+); the ﬁrst part uses Proposition III.4.7. Since H1(Xalg
R , O(µ)) = 0 as soon
as µ > 0, we deduce by induction on µ > 0, starting with µ ≫0 and using the computation of
H≥µ/H>µ, that H1
´et(Xalg
R , H≥µ) = 0 for µ > 0. From this we deduce that
H≥λ(Xalg
R )/H>λ(Xalg
R ) = (H≥λ/H>λ)(Xalg
R ).
Finally, it remains to compute the dimension. This is given by
X
λ>0
λ · dim(ad Eb)≥λ/(ad Eb)>λ,
which is given by ⟨2ρ, νb⟩.
□
Proposition III.5.2. Let G be a reductive group over a ﬁeld K, and let X be a scheme
over K.
Let E be a G-bundle on X with automorphism group scheme H/X (an inner form
of G ×K X, cf. Proposition III.4.1). Consider a Q-ﬁltration on the ﬁbre functor RepK(G) →
{Vector bundles on X} associated with E. Deﬁning groups H≥λ ⊂H for λ ≥0 as before, they are
smooth group schemes, H≥0 is a parabolic subgroup with unipotent radical H>0, the Lie algebra of
H≥λ is given by (ad E)≥λ ⊂Lie ad E = Lie eG, and the quotient H≥λ/H>λ is a vector group, thus
H≥λ/H>λ ∼= (ad E)≥λ/(ad E)>λ
Proof. The Lie algebra of H is ad E.
All statements can be checked ´etale locally on X.
According to [Zie15, Theorem 1.3] the Q-ﬁltration on the ﬁber functor is split locally on X.
Moreover E is split ´etale locally on X. We can thus suppose that E is the trivial G-bundle and the
ﬁltration given by some ν : D/X →G ×K X. Then the statement is easily checked, see [SR72].
□
III.5.1.1. The quasi-split case. Suppose now that G is moreover quasi-split. Fix A ⊂T ⊂B
with A a maximal split torus and T a maximal torus of G inside a Borel subgroup B. Up to
σ-conjugating b one can suppose that νb : D →A and νb ∈X∗(A)+
Q. Let Mb be the centralizer of
νb and P +
b the parabolic subgroup associated to νb, the weights of νb in Lie(P +
b ) are ≥0. One has
B ⊂P +
b , P +
b
is a standard parabolic subgroup with standard Levi subgroup Mb. Let P −
b
be the
opposite parabolic subgroup, the weights of νb in Lie(P −
b ) are ≤0. One has b ∈Mb( ˘E) and we
denote it bM as an element of Mb( ˘E).

III.5. NON-SEMISTABLE POINTS
105
Then, if
Q = EbM
Mb
× P −
b ,
RuQ = EbM
Mb
× RuP −
b
as Xalg
R -group-schemes, one has
eGb(R, R+) = Q(Xalg
R )
eG>0
b (R, R+) = RuQ(Xalg
R ).
III.5.2. Description of Harder–Narasimhan strata. Now we can describe the structure
of the stratum Bunb
G.
Proposition III.5.3. Let b ∈B(G) be any element given by some G-isocrystal. The induced
map xb : ∗→Bunb
G is a surjective map of v-stacks, and ∗×Bunb
G ∗∼= eGb, so that
Bunb
G ∼= [∗/ eGb]
is the classifying stack of eGb-torsors. In particular, the map eGb →π0 eGb ∼= Gb(E) induces a map
Bunb
G →[∗/Gb(E)]
that admits a splitting.
Proof. Let S = Spa(R, R+) ∈Perfk be strictly totally disconnected and let E be a G-bundle
on Xalg
R , the schematical curve, all of whose geometric ﬁbers are isomorphic to Eb. In particular,
the Harder–Narasimhan polygon of ρ∗E is constant for all representations ρ : G →GLn, and thus
by Theorem II.2.19, the vector bundle ρ∗E admits a relative Harder–Narasimhan ﬁltration. This
deﬁnes a Q-ﬁltration on the ﬁber functor RepE(G) →{vector bundles on Xalg
R } deﬁned by E, and
exactness can be checked on geometric points where it holds by the classiﬁcation of G-bundles.
Since for any ρ, the Harder–Narasimhan polygon of ρ∗Eb and the one of ρ∗E are equal, the two
ﬁltered ﬁber functors on RepE(G) deﬁned by E and Eb are of the same type. Thus, ´etale locally on
Xalg
R
those two ﬁltered ﬁber functors are isomorphic. Let H = Aut(Eb) and H≥0 = Autﬁltered(Eb)
as group schemes over Xalg
R , cf. Proposition III.5.1. Now, look at
T = Isomﬁltered(Eb, E).
This is an H≥0-torsor over Xalg
R
that is a reduction to H≥0 of the H-torsor Isom(Eb, E). Let us look
at the image of [T] ∈H1
´et(Xalg
R , H≥0) in H1
´et(Xalg
R , H≥0/H>0), that is to say the H≥0/H>0-torsor
T/H>0. This parametrizes isomorphisms of graded ﬁber functors between the two obtained by
semi-simplifying the ﬁltered ﬁber functors attached to Eb and E. By Proposition III.4.7, this torsor
is locally trivial. Now the triviality of T follows from the vanishing of H1(Xalg
R , H>0). In fact, for
λ > 0, H1(Xalg
R , H≥λ/H>λ) = 0 since H1(Xalg
R , O(λ)) = 0.
It is clear that ∗×Bunb
G ∗is given by eGb, so the rest follows formally.
□

106
III. BunG
Remark III.5.4 (Followup to Remark III.2.5). From the vanishing of H1
v(S, eG>0
b ) for S aﬃnoid
perfectoid one deduces that for such S, any eGb-torsor is of the form T × eG>0
b
where T →S is a Gb(E)-
torsor. Here the action of g1 ⋊g2 ∈Gb(E)⋊eG>0
b
on T × eG>0
b
is given by (x, y) 7→(g1 ·x, g1g2yg−1
1 ).
In particular any eGb-torsor is representable in locally spatial diamonds.

CHAPTER IV
Geometry of diamonds
In this chapter, we extend various results on schemes to the setting of diamonds, showing that
many advanced results in ´etale cohomology of schemes have analogues for diamonds.
In Section IV.1, we introduce a notion of Artin v-stacks, and discuss some basic properties; in
particular, we show that BunG is a cohomologically smooth Artin v-stack. Moreover, we can deﬁne
a notion of dimension for Artin v-stacks, which we use to determine the connected components of
BunG. In Section IV.2, we develop the theory of universally locally acyclic sheaves. In Section IV.3,
we introduce a notion of formal smoothness for maps of v-stacks. In Section IV.4, we use the
previous sections to prove the Jacobian criterion for cohomological smoothness, by establishing
ﬁrst formal smoothness, and universal local acyclicity. In Section IV.5, we prove a result on the
vanishing of certain partially compactly supported cohomology groups, ensuring that for example
Spd k[[x1, . . . , xd]] behaves like a strictly local scheme for D´et. In Section IV.6, we establish Braden’s
theorem on hyperbolic localization in the world of diamonds. Finally, in Section IV.7, we establish
several version of Drinfeld’s lemma in the present setup. The theme here is the idea π1((Div1)I) =
W I
E. Unfortunately, we know no deﬁnition of π1 making this true, but for example it becomes true
when considering Λ-local systems for any Λ.
IV.1. Artin stacks
IV.1.1. Generalities.
IV.1.1.1. Deﬁnition and basic properties. In this paper, we consider many small v-stacks like
BunG as above. However, they are stacky in some controlled way, in that they are Artin v-stacks
in the sense of the following deﬁnition.
Definition IV.1.1. An Artin v-stack is a small v-stack X such that the diagonal ∆X : X →
X × X is representable in locally spatial diamonds, and there is some surjective map f : U →X
from a locally spatial diamond U such that f is separated and cohomologically smooth.
Remark IV.1.2. We are making the assumption that f is separated, because only in this case
we have deﬁned cohomological smoothness.
This means that we are imposing some (probably
unwanted) very mild separatedness conditions on Artin v-stacks. In particular, it implies that ∆X
is quasiseparated: Let f : U →X be as in the deﬁnition, and assume without loss of generality
that U is a disjoint union of spatial diamonds (replacing it by an open cover if necessary), so in
particular U is quasiseparated. As f is separated, the map U ×X U →U is separated, and in
particular U ×X U is again quasiseparated. This is the pullback of ∆X : X →X × X along the
surjection U × U →X × X, so ∆X is quasiseparated.
107

108
IV. GEOMETRY OF DIAMONDS
Remark IV.1.3. The stack BunG is not quasiseparated. In fact, [∗/G(E)] is already not qua-
siseparated since the sheaf of automorphisms of the trivial G-bundle, G(E), is not quasicompact.
This is diﬀerent from the “classical situation” of the stack of G-bundles on a proper smooth curve,
this one being quasiseparated (although not separated). In the “classical schematical case” of Artin
stacks it is a very mild assumption to suppose that Artin stacks are quasiseparated. In our situation
this would be a much too strong assumption, but it is still a very mild assumption to suppose that
the diagonal is quasiseparated.
Remark IV.1.4. By Remark IV.1.2, for any Artin v-stack X, the diagonal ∆X is quasisep-
arated. Conversely, let X be any small v-stack, and assume that there is some surjective map
U →X from a small v-sheaf. Then:
(i) If U is quasiseparated, then ∆X is quasiseparated, by the argument of Remark IV.1.2.
(ii) If U is a locally spatial diamond and U →X is representable in locally spatial diamonds, then
∆X is quasiseparated (as we may without loss of generality assume that U is quasiseparated, so
that (i) applies), and to check that ∆X is representable in locally spatial diamonds, it suﬃces to
see that ∆X is representable in diamonds. Indeed, [Sch17a, Proposition 13.4 (v)] shows that if ∆X
is quasiseparated and representable in diamonds, then representability in locally spatial diamonds
can be checked v-locally on the target. But the pullback of ∆X along U × U →X × X is U ×X U,
which is a locally spatial diamond as we assumed that U →X is representable in locally spatial
diamonds.
(iii) Finally, in the situation of (ii), checking whether ∆X is representable in diamonds can be done
after pullback along a map V →X ×X that is surjective as a map of pro-´etale stacks, by [Sch17a,
Proposition 13.2 (iii)].
In particular, if there is a map f : U →X from a locally spatial diamond U such that f is
separated, cohomologically smooth, representable in locally spatial diamonds, and surjective as a
map of pro-´etale stacks, then X is an Artin v-stack. If one only has a map f : U →X from a locally
spatial diamond such that f is separated, cohomologically smooth, representable in locally spatial
diamonds, and surjective as a map of v-stacks, then it remains to prove that ∆X is representable
in diamonds, which can be done after pullback along a map V →X × X that is surjective as a
map of pro-´etale stacks.
Remark IV.1.5. Since cohomologically smooth morphisms are open, to prove that a separated,
representable in locally spatial diamonds, cohomologically smooth morphism U →X is surjective,
it suﬃces to verify it on geometric points.
Remark IV.1.6. If X is a small v-stack with a map g : X →S to some “base” small v-stack S,
one might introduce a notion of an “Artin v-stack over S”, asking instead that ∆X/S : X →X ×S X
is representable in locally spatial diamonds; note that the condition on the chart f : U →X will
evidently remain the same as in the absolute case. We note that as long as the diagonal of S is
representable in locally spatial diamonds (for example, S is an Artin v-stack itself), this agrees
with the absolute notion. Indeed, if ∆X/S and ∆S are representable in locally spatial diamonds,
then also ∆X is representable in locally spatial diamonds, as X ×S X →X × X is a pullback of
∆S and thus representable in locally spatial diamonds, so ∆X is the composite of the two maps
X →X ×S X →X × X both of which are representable in locally spatial diamonds. Conversely,
assume that X and S are such that their diagonals are representable in locally spatial diamonds.

IV.1. ARTIN STACKS
109
Then both X and X ×S X are representable in locally spatial diamonds over X × X, thus any map
between them is.
Example IV.1.7. Any locally spatial diamond is an Artin v-stack.
Before giving other examples let us state a few properties.
Proposition IV.1.8.
(i) Any ﬁbre product of Artin v-stacks is an Artin v-stack.
(ii) Let S →∗be a pro-´etale surjective, representable in locally spatial diamonds, separated and
cohomologically smooth morphism of v-sheaves. The v-stack X is an Artin v-stack if and only if
X × S is an Artin v-stack.
(iii) If X is an Artin v-stack and f : Y →X is representable in locally spatial diamonds, then Y is
an Artin v-stack.
Proof. For point (1), if X = X2×X1 X3 is such a ﬁbre product and fi : Ui →Xi are separated,
representable in locally spatial diamonds, and cohomologically smooth surjective maps from locally
spatial diamonds Ui, then U = (U1 ×X2 U2) ×U2 (U2 ×X2 U3) is itself a locally spatial diamond
(using that ∆X2 is representable in locally spatial diamonds), and the projection f : U →X
is a separated, representable in locally spatial diamonds, and cohomologically smooth surjection.
For the diagonal, since ∆X2 and ∆X3 are representable in locally spatial diamonds, ∆X2 × ∆X3 :
X2 × X3 →(X2 × X3) × (X2 × X3) is representable in locally spatial diamonds. Since ∆X1 is
representable in locally spatial diamonds, its pullback by X2 × X3 →X1 × X1, that is to say
u : X2 ×X1 X3 →X2 × X3, is representable in locally spatial diamonds. Thus, ∆X2×X1X3 is a map
between stacks that are representable in locally spatial diamonds over (X2 × X3) × (X2 × X3), and
thus is representable in locally spatial diamonds.
For point (2), suppose X×S is an Artin v-stack. If U is a locally spatial diamond and U →X×S
is separated, representable in locally spatial diamonds, cohomologically smooth, and surjective, then
the composite U →X ×S →X is too. It remains to see that ∆X is representable in locally spatial
diamonds. By Remark IV.1.4 it suﬃces to prove that the pullback of ∆X by X × X × S →X × X
is representable in locally spatial diamonds. But this pullback is the composite of ∆X×S with
X × X × S × S →X × X × S, and we conclude since the projection S × S →S is representable in
locally spatial diamonds for evident reasons.
For point (3), if U is a locally spatial diamond and U →X is surjective, separated, representable
in locally spatial diamonds, and cohomologically smooth, then V = U ×X Y is a locally spatial
diamond, and V →Y is surjective, separated, representable in locally spatial diamonds, and
cohomologically smooth. It remains to see that ∆Y is representable in locally spatial diamonds.
By Remark IV.1.4, it suﬃces to see that ∆Y is representable in diamonds. But we can write ∆Y
as the composite Y →Y ×X Y →Y ×k Y . The ﬁrst map is 0-truncated and injective and thus
representable in diamonds by [Sch17a, Proposition 11.10], while the second map is a pullback of
∆X.
□
We can now give more examples.
Example IV.1.9.

110
IV. GEOMETRY OF DIAMONDS
(i) According to point (2) of Proposition IV.1.8, the v-stack X is an Artin v-stack if and only if
X × Spd E, resp. X × Spa(Fq((t1/p∞))), is an Artin v-stack. To check that X is an Artin v-stack
we can thus replace the base point ∗by Spd E, resp. Spa Fq((t1/p∞)).
(ii) For example, any small v-sheaf X such that X →∗is representable in locally spatial diamonds
is an Artin v-stack; e.g. X = ∗.
(iii) Using point (3) of Proposition IV.1.8 and [Sch17a, Proposition 11.20] we deduce that any
locally closed substack of an Artin v-stack is an Artin v-stack.
(iv) Let G be a locally proﬁnite group that admits a closed embedding into GLn(E) for some n.
Then the classifying stack [∗/G] is an Artin v-stack. For this it suﬃces to see that [Spd E/G] =
Spd E × [∗/G] is an Artin v-stack.
Now let H = GL♦
n,E; then there is a closed immersion
G×Spd E ,→H. The map H →Spd E is representable in locally spatial diamonds, separated, and
cohomologically smooth; hence so is H/G →[Spd E/G] (by [Sch17a, Proposition 13.4 (iv), Propo-
sition 23.15]), and H/G is a locally spatial diamond (itself cohomologically smooth over Spd E by
[Sch17a, Proposition 24.2] since this becomes cohomologically smooth over the separated ´etale
cover H/K →H/G for some compact open pro-p subgroup K of G). It is clear that the diagonal
of [∗/G] is representable in locally spatial diamonds.
Remark IV.1.10. If G is a smooth algebraic group over the ﬁeld k then Spec(k) →[Spec(k)/G]
is a smooth presentation of the Artin stack [Spec(k)/G]. However, in the situation of point (4)
of Example IV.1.9 the map f : ∗→[∗/G] is not cohomologically smooth since for its pullback
ef : G →∗, the sheaf ef!Λ is the sheaf of distributions on G with values in Λ.
IV.1.1.2. Smooth morphisms of Artin v-stacks. Notions that can be checked locally with respect
to cohomologically smooth maps can be extended to Artin v-stacks (except possibly for subtleties
regarding separatedness). In particular:
Definition IV.1.11. Let f : Y →X be a map of Artin v-stacks. Assume that there is some
separated, representable in locally spatial diamonds, and cohomologically smooth surjection g : V →
Y from a locally spatial diamond V such that f ◦g : V →X is separated. Then f is cohomologically
smooth if for any (equivalently, one) such g, the map f ◦g : V →X (which is separated by
assumption, and automatically representable in locally spatial diamonds) is cohomologically smooth.
In the preceding deﬁnition the “equivalently, one” assertion is deduced from [Sch17a, Propo-
sition 23.13] that says that cohomological smoothness is “cohomologically smooth local on the
source”.
More precisely, if checked for one then for all g : V →X separated cohomologically
smooth (not necessarily surjective) from a locally spatial diamond V , f ◦g is separated cohomo-
logically smooth.
Convention IV.1.12. In the following, whenever we say that a map f : Y →X of Artin
v-stacks is cohomologically smooth, we demand that there is some separated, representable in
locally spatial diamonds, and cohomologically smooth surjection g : V →Y from a locally spatial
diamond V such that f ◦g : V →X is separated. Note that this condition can be tested after
taking covers U →X by separated, representable in locally spatial diamonds, and cohomologically
smooth surjections; i.e. after replacing X by X ×Y U and Y by U. If X and Y have the property
that one can ﬁnd a cover U →X, V →Y , as above with U and V perfectoid spaces, and ∆X is
representable in perfectoid spaces, then the condition is automatic, as all maps of perfectoid spaces

IV.1. ARTIN STACKS
111
are locally separated. That being said there is no reason that this is true in general since there are
morphisms of spatial diamonds that are not locally separated.
We will not try to give a completely general 6-functor formalism that includes functors Rf! and
Rf! for stacky maps f (this would require some ∞-categorical setting). However, we can extend
the functor Rf! to cohomologically smooth maps of Artin v-stacks. Let Λ be a ring killed by some
integer n prime to p, or an adic ring as in [Sch17a, Section 26].
Definition IV.1.13. Let f : Y →X be a cohomologically smooth map of Artin v-stacks. The
dualizing complex Rf!Λ ∈D´et(Y, Λ) is the invertible object equipped with isomorphisms
Rg!(Rf!Λ) ∼= R(f ◦g)!Λ
for all separated, representable in locally spatial diamonds, and cohomologically smooth maps g :
V →Y from a locally spatial diamond V , such that for all cohomologically smooth maps h : V ′ →V
between such g′ : V ′ →Y and g : V →Y , the composite isomorphism
R(g′)!(Rf!Λ) ∼= R(f ◦g′)!Λ ∼= R(f ◦g ◦h)!Λ ∼= Rh!(R(f ◦g)!Λ) ∼= Rh!(Rg!(Rf!Λ)) ∼= R(g′)!(Rf!Λ)
is the identity.
As Rf!Λ is locally concentrated in one degree, it is easy to see that Rf!Λ is unique up to
unique isomorphism. Let us be more precise. Let C be the category whose objects are separated
cohomologically smooth morphisms V →Y with V a locally spatial diamond, and morphisms
(V ′
g′
−→Y ) →(V
g−→Y ) are couples (h, α) where h : V ′ →V is separated cohomologically smooth
and α : g ◦h ⇒g′ is a 2-morphism. Then the rule
(V
g−→Y ) 7−→RHomΛ(Rg!Λ, R(f ◦g)!Λ)
deﬁnes an element of
2-
lim
←−
(V →Y )∈C
{invertible objects in D´et(V, Λ)} ∼= {invertible objects in D´et(Y, Λ)}.
Remark IV.1.14. If g : V →Y is a compactiﬁable representable in locally spatial diamonds
morphism of small v-stacks with dim. trg g < ∞such that f ◦g satisﬁes the same hypothesis, it
is not clear that Rg!(Rf!Λ) ∼= R(f ◦g)!Λ. This is a priori true only when V is a locally spatial
diamond and g is separated cohomologically smooth, the only case we will need.
Definition IV.1.15. Let f : Y →X be a cohomologically smooth map of Artin v-stacks. The
functor
Rf! : D´et(X, Λ) →D´et(Y, Λ)
is given by Rf! = Rf!Λ ⊗L
Λ f∗.
Remark IV.1.16. Checking after a cohomologically smooth cover, one sees that Rf! preserves
all limits (and colimits) and hence admits a left adjoint Rf!.
Definition IV.1.17. Let f : Y →X be a cohomologically smooth map of Artin v-stacks and let
ℓ̸= p be a prime. Then f is pure of ℓ-dimension d ∈1
2Z if Rf!Fℓsits locally in homological degree
2d.

112
IV. GEOMETRY OF DIAMONDS
As Rf!Fℓis locally constant, any cohomologically smooth map f : Y →X of Artin v-stacks
decomposes uniquely into a disjoint union of fd : Yd →X that are pure of ℓ-dimension d. A priori
this decomposition may depend on ℓand include half-integers d, but this will not happen in any
examples that we study.
IV.1.2. The case of BunG.
IV.1.2.1. Smooth charts on BunG. One important example is the following. We use Beauville–
Laszlo uniformization to construct cohomologically smooth charts on BunG. More reﬁned charts
will be constructed in Theorem V.3.7. For ¯µ ∈X∗(T)+/Γ we note GrG,¯µ for the subsheaf of GrG
such that GrG,¯µ ×Spd(E) Spd(E′) = `
µ′≡µ GrG,µ′ where E′|E is a ﬁnite degree Galois extension
splitting G. We will use the following simple proposition.
Proposition IV.1.18. For any µ ∈X∗(T)+, the open Schubert cell GrG,µ / Spd E′ is cohomo-
logically smooth of ℓ-dimension ⟨2ρ, µ⟩.
We defer the proof to Proposition VI.2.4 as we do not want to make a digression on GrG here.
Theorem IV.1.19. The stack BunG is a cohomologically smooth Artin v-stack of ℓ-dimension
0. The Beauville–Laszlo map deﬁnes a separated cohomologically smooth cover
a
¯µ∈X∗(T)+/Γ
[G(E)\GrG,¯µ] −→BunG .
Proof. We check ﬁrst that ∆BunG is representable in locally spatial diamonds. For this, it
suﬃces to see that for a perfectoid space S with two G-bundles E1, E2 on XS, the functor of
isomorphisms between E1 and E2 is representable by a locally spatial diamond over S. By the
Tannakian formalism, one can reduce to vector bundles.
For example, according to Chevalley,
one can ﬁnd a faithful linear representation ρ : G →GLn, a representation ρ′ : GLn →GL(W),
and a line D ⊂W such that G is the stabilizer of D inside GLn. Then G-bundles on XS embed
fully faithfully into rank n vector bundles E together with a sub-line bundle L inside ρ′
∗E.
In
terms of those data, isomorphisms between (E1, L1) and (E2, L2) are given by a couple (α, β) where
α : E1
∼
−→E2, and β : L1
∼
−→L2 satisfy (ρ′
∗α)|L1 = β. Since the category of locally spatial diamonds
is stable under ﬁnite projective limits we are reduced to the case of the linear group. Now the
result is given by Lemma IV.1.20.
It remains to construct cohomologically smooth charts for BunG.
We ﬁrst prove that the
morphism
π :
a
¯µ∈X∗(T)+/Γ
[G(E)\GrG,¯µ] −→BunG ×k Spd ˘E
is separated cohomologically smooth. Since this is surjective at the level of geometric points we
deduce that it is a v-cover, cf. Remark IV.1.5.
To verify this, note that for a perfectoid space S mapping to BunG ×k Spd ˘E corresponding to
a G-bundle E on XS as well as a map S →Spd E inducing an untilt S♯/E and a closed immersion
i : S♯→XS, the ﬁbre of π over S parametrizes modiﬁcations of E of locally constant type that are
trivial at each geometric point. This is open in the space of all modiﬁcations of E of locally constant

IV.1. ARTIN STACKS
113
type, which is v-locally isomorphic to F
¯µ GrG,¯µ,E ×Spd ES →S. Thus, Proposition IV.1.18 gives
the desired cohomological smoothness.
Moreover, the preceding argument shows that when restricted to [G(E)\GrG,¯µ], the map π has
ℓ-dimension equal to ⟨2ρ, µ⟩. Thus, it now suﬃces to see that [G(E)\GrG,¯µ] is an ℓ-cohomologically
smooth Artin v-stack of ℓ-dimension equal to ⟨2ρ, µ⟩. But the map
[G(E)\GrG,¯µ] →[Spd E/G(E)]
is representable in locally spatial diamonds and ℓ-cohomologically smooth of ℓ-dimension equal to
⟨2ρ, µ⟩, as GrG,¯µ →∗is by Proposition IV.1.18. We conclude by using that [∗/G(E)] →∗is an
Artin v-stack, cohomologically smooth of ℓ-dimension 0, by Example IV.1.9 (4).
□
Lemma IV.1.20. For E1, E2 vector bundles on XS, the sheaf T/S 7→{surjections E1|XT ↠
E2|XT }, resp. T/S 7→Isom(E1|XT , E2|XT ), is representable by an open subdiamond of BC(E∨
1 ⊗E2).
In particular, those are locally spatial diamonds.
Proof. The case of isomorphisms is reduced to the case of surjections since a morphism u
of vector bundles is an isomorphisms if and only if u and u∨are surjective. For any morphism
g : E1 →E2, the support of its cokernel is a closed subset of |XS|, whose image in |S| is thus closed;
this implies the result.
□
Remark IV.1.21. It would be tempting to study D´et(BunG, Λ) using the preceding charts.
But, contrary to the sheaves coming from the geometric Satake correspondence, the sheaves on
GrG obtained via pullback from BunG are not locally constant on open Schubert strata. We will
prefer other smooth charts to study D´et(BunG, Λ), see Theorem V.3.7.
Moreover, each HN stratum Bunb
G gives another example.
Proposition IV.1.22. For every b ∈B(G), the stratum Bunb
G is a cohomologically smooth
Artin v-stack of ℓ-dimension −⟨2ρ, νb⟩.
Proof. Under the identiﬁcation Bunb
G ∼= [∗/ eGb], note that we have a map [∗/ eGb] →[∗/Gb(E)]
where the target is a cohomologically smooth Artin v-stack of dimension 0, while the ﬁbre admits a
cohomologically smooth surjection from ∗(as positive Banach–Colmez spaces are cohomologically
smooth) of ℓ-dimension ⟨2ρ, νb⟩. This gives the result.
□
IV.1.2.2. Connected components of BunG. A consequence is that we can classify the connected
components of BunG.
Corollary IV.1.23. The Kottwitz map induces a bijection
κ : π0(BunG) →π1(G)Γ.
Proof. The Kottwitz map is well-deﬁned and surjective. It remains to see that it is injective.
To see this, recall that the basic elements of B(G) biject via κ to π1(G)Γ. Thus, it suﬃces to see
that any nonempty open subsheaf U of BunG contains a basic point. Note that the topological
space (X∗(T)+
Q)Γ × π1(G)Γ equipped with the product topology given by the order on (X∗(T)+
Q)Γ
and the discrete topology on π1(G)Γ, is (T0), and an increasing union of ﬁnite open subspaces; and
| BunG | maps continuously to it. Pick some ﬁnite open V ⊂(X∗(T)+
Q)Γ × π1(G)Γ such that its

114
IV. GEOMETRY OF DIAMONDS
preimage in U is a nonempty open U′ ⊂U. Then U′ is a nonempty ﬁnite (T0) space, and thus has
an open point by Lemma IV.1.24.
Thus, there is some b ∈B(G) such that Bunb
G ⊂U ⊂BunG is open.
Combining Theo-
rem IV.1.19 and Proposition IV.1.22, this forces −⟨2ρ, νb⟩= 0, i.e. νb is central, which means that
b is basic.
□
Lemma IV.1.24. If X is a nonempty ﬁnite spectral space, that is to say a ﬁnite (T0) topological
space, there exists an open point x ∈X.
Proof. Take x maximal for the specialization relation, i.e. x is a maximal point. Then, since
X is (T0), X \ {x} = ∪y̸=x{y}, a ﬁnite union of closed spaces thus closed.
□
IV.2. Universally locally acyclic sheaves
IV.2.1. Deﬁnition and basic properties. In many of our results, and in particular in the
(formulation and) proof of the geometric Satake equivalence, a critical role is played by the notion
of universally locally acyclic (ULA) sheaves. Roughly speaking, for a morphism f : X →S of
schemes, these are constructible complexes of ´etale sheaves A on X whose relative cohomology is
constant in all ﬁbres of S, even locally. Technically, one requires that for all geometric points x of
X mapping to a geometric point s of S and a generization t of s in S, the natural map
RΓ(Xx, A) →RΓ(Xx ×Ss t, A)
is an isomorphism, where Xx is the strict henselization of X at x (and Ss is deﬁned similarly).
Moreover, the same property should hold universally after any base change along S′ →S.1 By
[Ill06, Corollary 3.5], universal local acyclicity is equivalent to asking that, again after any base
change, the map
RΓ(Xx, A) →RΓ(Xx ×Ss St, A)
is an isomorphism; we prefer the latter formulation as strict henselizations admit analogues for adic
spaces, while the actual ﬁbre over a point is only a pseudo-adic space in Huber’s sense [Hub96].
In the world of adic spaces, there are not enough specializations to make this an interesting
deﬁnition; for example, there are no specializations from GrG,µ into GrG,≤µ \ GrG,µ. Thus, we need
to adapt the deﬁnition by adding a condition on preservation of constructibility that is automatic
in the scheme case under standard ﬁniteness hypothesis, but becomes highly nontrivial in the case
of adic spaces.
Definition IV.2.1. Let f : X →S be a compactiﬁable map of locally spatial diamonds with
locally dim. trg f < ∞and let A ∈D´et(X, Λ) for some Λ with nΛ = 0 with n prime to p.
(i) The sheaf of complexes A is f-locally acyclic if
(a) For all geometric points x of X with image s in S and a generization t of s, the map
RΓ(Xx, A) →RΓ(Xx ×Ss St, A)
is an isomorphism.
1Recently, Gabber proved that this is automatic when S is noetherian and f is of ﬁnite type, cf. [LZ19, Corollary
6.6].

IV.2. UNIVERSALLY LOCALLY ACYCLIC SHEAVES
115
(b) For all separated ´etale maps j : U →X such that f ◦j is quasicompact, the complex R(f ◦
j)!(A|U) ∈D´et(S, Λ) is perfect-constructible.
(ii) The sheaf of complexes A is f-universally locally acyclic if for any map S′ →S of locally spatial
diamonds with base change f′ : X′ = X ×S S′ →S′ and A′ ∈D´et(X′, Λ) the pullback of A, the
sheaf of complexes A′ is f′-locally acyclic.
Recall that if (K, K+) is an aﬃnoid Huber ﬁeld, S = Spa(K, K+), then |S| = | Spec(K+/K00)|
as a topological spectral space, that is identiﬁed with the totally ordered set of open prime ideals
in K+.
For any s ∈S, Ss ⊂S is pro-constructible generalizing.
For example, the maximal
generalization is Spa(K, OK) = ∩a∈OK{|a| ≤1}.
Remark IV.2.2. In the setup of condition (a), note that Xx is a strictly local space, i.e. of the
form Spa(C, C+) where C is algebraically closed and C+ ⊂C is an open and bounded valuation
subring; thus, RΓ(Xx, A) = Ax is just the stalk of A.
Moreover, St ⊂Ss is a quasicompact
pro-constructible generalizing subspace, and thus Xx ×Ss St ⊂Xx is itself a quasicompact pro-
constructible generalizing subset that is strictly local. Its closed point y is the minimal generization
of x mapping to t, and RΓ(Xx ×Ss St, A) = Ay is the stalk at y. Thus, condition (a) means that A
is “overconvergent” along the horizontal lifts of generizations of S.
Remark IV.2.3.
(i) Another way to phrase the “relative overconvergence condition” (a), is to say that if ¯s is a
geometric point of S, ¯t a generization of ¯s, j : X ×S S¯t ,→X ×S S¯s, a pro-constructible generalizing
immersion, and B = A|X×SS¯s, then B = Rj∗j∗B (use quasicompact base change).
(ii) Still another way to phrase it is to say that for any Spa(C, C+) →S, if B = A|X×SSpa(C,C+),
and j : X ×S Spa(C, OC) ,→X ×S Spa(C, C+), then B = Rj∗j∗B.
(iii) Still another way is to say that if ¯x 7→¯s and f¯x : X¯x →S¯s then Rf¯x∗A|X¯x is overconvergent
i.e. constant.
In fact, asking for condition (a) universally, i.e. after any base change, amounts to asking that
A is overconvergent.
Proposition IV.2.4. Let f : X →S be a compactiﬁable map of locally spatial diamonds
with locally dim. trg f < ∞and let A ∈D´et(X, Λ) for some Λ with nΛ = 0 with n prime to p.
The condition (a) of Deﬁnition IV.2.1 holds after any base change S′ →S if and only if A is
overconvergent, i.e. for any specialization y ⇝x of geometric points of X, the map Ax →Ay is an
isomorphism.
Proof. The condition is clearly suﬃcient. For necessity, take the base change along Xx →S.
Then x lifts to a section x′ : Xx →X ×S Xx, and applying the relative overconvergence condition
to x′ 7→x and the generization y of x, we see that Ax →Ay is an isomorphism.
□
Proposition IV.2.5. Local acyclicity descends along v-covers of the target. More precisely, in
the setup of Deﬁnition IV.2.1, if S′ →S is a v-cover and A′ is f′-locally acyclic, then automatically
A is f-locally acyclic.
Proof. Condition (a) follows by lifting geometric points, and condition (b) descends by [Sch17a,
Proposition 20.13].
□

116
IV. GEOMETRY OF DIAMONDS
Proposition IV.2.6. Let Y be a spatial diamond.
(i) If F is a constructible ´etale sheaf of Λ-modules on Y , then F is locally constant if and only if
F is overconvergent.
(ii) If A ∈D´et,pc(Y, Λ), then A is overconvergent if and only if it is locally a constant perfect complex
of Λ-modules.
Proof. For a geometric point y of Y , writing Yy = Spa(C, C+) = lim
←−y→U U as a limit of the
´etale neighborhoods, according to [Sch17a, Proposition 20.7],
2- lim
−→
y→U
Cons(U, Λ) = Cons(Yy, Λ).
An ´etale sheaf on Yy = Spa(C, C+) is locally constant if and only if it is constant if and only if it
is overconvergent. This gives point (1). Point (2) goes the same way using [Sch17a, Proposition
20.15].
□
Remark IV.2.7. The preceding argument shows that if F is constructible on Y then F is
locally constant in a neighborhood of any maximal point of Y . For example, if Y = X♦with X
a K-rigid space, then any constructible sheaf on Y is locally constant in a neighborhood of all
classical Tate points of X. Thus, the diﬀerence between constructible and locally constant sheaves
shows up at rank > 1 valuations.
Example IV.2.8. Let j : B1
K \{0} ,→B1
K be the inclusion of the punctured disk inside the disk.
Then j!Λ is not constructible since not locally constant around {0}. Nevertheless, if R ∈|K×| and
x is the coordinate on B1
K, jR : {R ≤|x| ≤1} ,→B1
K, jR!Λ is constructible and j!Λ = lim
−→R→0 jR!Λ.
The category of ´etale sheaves of Λ-modules on a spatial diamond is the Ind-category of constructible
´etale sheaves, cf. [Sch17a, Proposition 20.6].
Proposition IV.2.9. Assume that f : S →S is the identity. Then A ∈D´et(S, Λ) is f-locally
acyclic if and only if it is locally constant with perfect ﬁbres.
Proof. Applying part (b) of the deﬁnition, we see that A is perfect-constructible. On the
other hand, part (a) says that A is overconvergent. This implies that A is locally constant by
Proposition IV.2.6.
□
Let us ﬁnish with a basic example of universally locally acyclic sheaves relevant to the smooth
base change theorem. A more general result will be given in Proposition IV.2.13.
Proposition IV.2.10. Assume that f : X →S is a separated map of locally spatial diamonds
that is ℓ-cohomological smooth for all divisors ℓof n, where nΛ = 0. If A ∈D´et(X, Λ) is locally
constant with perfect ﬁbres, then A is f-universally locally acyclic.
Proof. It is enough to show that A is f-locally acyclic, as the hypotheses are stable under base
change. Condition (a) follows directly from A being locally constant. Condition (b) follows from
the preservation of constructible sheaves of complexes under Rf! if f is quasicompact, separated
and cohomologically smooth, see [Sch17a, Proposition 23.12 (ii)].
□

IV.2. UNIVERSALLY LOCALLY ACYCLIC SHEAVES
117
IV.2.2. Proper push-forward, smooth pull-back. In the “classical algebraic case”, if Y
g−→
X
f−→S are morphisms of ﬁnite type between noetherian schemes, using proper and smooth base
change:
(i) if g is proper and A ∈Db
c(Y, Λ) is f ◦g -locally acyclic then Rg∗A is f-locally acyclic;
(ii) if g is smooth and A ∈Db
c(X, Λ) is f-locally acyclic then g∗A is f ◦g-locally acyclic. Moreover
if g is surjective then A ∈Db
c(X, Λ) is f-locally acyclic if and only if g∗A is f ◦g-locally acyclic.
We are going to see that the same phenomenon happens in our context.
The fact that local
acyclicity is smooth local on the source is essential to deﬁne local acyclicity for morphisms of Artin
v-stacks, cf. Deﬁnition IV.2.31.
Proposition IV.2.11. Let g : Y →X, f : X →S be maps of locally spatial diamonds where g
is proper and f is compactiﬁable and locally dim. trg g, dim. trg f < ∞. Assume that A ∈D´et(Y, Λ)
is f ◦g-locally acyclic (resp. f ◦g-universally locally acylic). Then Rg∗A ∈D´et(X, Λ) is f-locally
acyclic (resp. f-universally locally acyclic).
Proof. It is enough to consider the locally acyclic case, as the hypotheses are stable under
base change. For condition (a), we use Remark IV.2.3 (2). Let ¯s be a geometric point of S, with
S¯s = Spa(C, C+). Let us look at the cartesian diagram
Y ×Spa(C,C+) Spa(C, OC)
Y
X ×Spa(C,C+) Spa(C, OC)
X
k
g
j
one has by local acyclicity of f ◦g, A = Rk∗k∗A. Applying Rg∗, this gives the desired
Rg∗A = Rj∗j∗(Rg∗A).
For condition (b), take any separated ´etale map j : U →X such that f ◦j is quasicompact,
and set j′ : V = U ×X Y →Y , which is an ´etale map such that f ◦g ◦j′ is quasicompact. Let
g′ : V →U denote the pullback of g. Using proper base change and Rg∗= Rg!, we see that
R(f ◦j)!j∗Rg∗A = R(f ◦j)!Rg′
!j′∗A = R(f ◦g ◦j′)!j′∗A,
which is perfect-constructible by the assumption that A is f ◦g-locally acyclic.
□
In particular we have the following that generalizes the “proper and smooth case”.
Corollary IV.2.12. Let f : X →S be a proper map of locally spatial diamonds with dim. trg f <
∞and A ∈D´et(X, Λ) that is f-locally acyclic. Then Rf∗A is locally a constant perfect complex of
Λ-modules.
Next proposition says that local acyclicity is “cohomologically smooth local” on the source.
Proposition IV.2.13. Let f : X →S be a compactiﬁable map of locally spatial diamonds with
locally dim. trg f < ∞. For the statements in the locally acyclic case below, assume that S is spatial
and that the cohomological dimension of U´et for all quasicompact separated ´etale U →S is ≤N
for some ﬁxed integer N.

118
IV. GEOMETRY OF DIAMONDS
Let A ∈D´et(X, Λ) where nΛ = 0 for some n prime to p and let g : Y →X be a separated map
of locally spatial diamonds that is ℓ-cohomologically smooth for all ℓdividing n.
(i) If A is f-locally acyclic (resp. f-universally locally acyclic), then g∗A is f ◦g-locally acyclic
(resp. f ◦g-universally locally acyclic).
(ii) Conversely, if g∗A is f◦g-locally acyclic (resp. f◦g-universally locally acyclic) and g is surjective,
then A is f-locally acyclic (resp. f-universally locally acyclic).
Proof. It is enough to handle the locally acyclic case with the assumption on S; then the
universally locally acyclic case follows by testing after pullbacks to strictly totally disconnected
spaces. Let us treat point (i). We can assume that X and Y are qcqs, i.e. spatial. In fact, this
is clear for condition (a). For condition (b), if j : V →Y is separated ´etale such that f ◦g ◦j is
quasicompact, up to replacing S by an open cover we can suppose that S is spatial and thus V
is spatial (since f, g, and j are separated, f ◦g ◦j is separated quasicompact, and thus S spatial
implies X spatial). Then one can replace Y , resp. X, by the quasicompact open subsets j(V ),
resp. (g ◦j)(V ), that are separated over S and thus spatial too.
Condition (a) follows as pullbacks preserve stalks. For condition (b), let j : V →Y be any
quasicompact separated ´etale map. Then by the projection formula for g ◦j, one has
R(f ◦g ◦j)!j∗g∗A = Rf!(A ⊗L
Λ R(g ◦j)!Λ).
As g ◦j : V →X is a quasicompact separated ℓ-cohomologically smooth map, it follows that
R(g ◦j)!Λ ∈D´et(X, Λ) is perfect-constructible by [Sch17a, Proposition 23.12 (ii)].
Thus, the
desired result follows from Lemma IV.2.14.
In the converse direction, i.e. for part (ii), condition (a) of A being f-locally acyclic follows
by lifting geometric points from X to Y and noting that stalks do not change.
For condi-
tion (b), we may replace X by U to reduce to the assertion that Rf!A ∈D´et(S, Λ) is perfect-
constructible. Consider the thick triangulated subcategory C of D´et(X, Λ) of all B ∈D´et(X, Λ)
such that Rf!(A ⊗L
Λ B) ∈D´et(S, Λ) is perfect-constructible. We have to see that Λ ∈C. We know
that for all perfect-constructible C ∈D´et(Y, Λ), the perfect-constructible complex Rg!C lies in C.
Indeed, using [Sch17a, Proposition 20.17], this reduces to the case C = j!Λ where j : U →Y is a
quasicompact separated ´etale map, and then
Rf!(A ⊗L
Λ R(g ◦j)!Λ) = R(f ◦g)!(g∗A ⊗L
Λ Rj!Λ),
which is perfect-constructible as g∗A is f ◦g-locally acyclic. Thus, it is enough to show that the
set of Rg!C ∈D´et(X, Λ) with C ∈D´et(Y, Λ) perfect constructible form a set of compact genera-
tors of D´et(X, Λ). Equivalently, for any complex B ∈D´et(X, Λ) with R HomD´et(X,Λ)(Rg!C, B) =
0 for all perfect-constructible C ∈D´et(Y, Λ), then B = 0.
The hypothesis is equivalent to
R HomD´et(Y,Λ)(C, Rg!B) = 0 for all such C.
By [Sch17a, Proposition 20.17] and the standing
assumptions on ﬁnite cohomological dimension (on S, f and g), this implies that Rg!B = 0. As g is
ℓ-cohomologically smooth, this is equivalent to g∗B = 0, which implies B = 0 as g is surjective.
□
Lemma IV.2.14. Let f : X →S be a compactiﬁable map of locally spatial diamonds with
locally dim. trg f < ∞. Suppose there exists an integer N such that the cohomological dimension
of U´et is bounded by N for all U →X separated ´etale. Let A ∈D´et(X, Λ) be f-locally acyclic
and B ∈D´et(X, Λ) be perfect-constructible.
Then A ⊗L
Λ B satisﬁes condition (b) of Deﬁnition

IV.2. UNIVERSALLY LOCALLY ACYCLIC SHEAVES
119
IV.2.1: for any j : U →X separated ´etale such that f ◦j is quasicompact, R(f ◦j)!j∗(A ⊗L
Λ B) is
perfect-constructible.
Proof. We can suppose X is spatial. According to [Sch17a, Proposition 20.17], B lies in the
triangulated subcategory generated by j′
!Λ where j′ : U′ →X is separated quasicompact ´etale.
For such a B, using the projection formula, A ⊗L
Λ Rj′
!Λ = Rj′
!j′∗A. Thus, if V = U ×X U′ with
projection k : U ×X U′ →U,
j∗Rj′
!j′∗A = Rk!k∗j∗A.
We thus have
R(f ◦j)!j∗(A ⊗L
Λ Rj′
!B) = R(f ◦j ◦k)!(j ◦k)∗(A)
and we can conclude.
□
IV.2.3. Local acyclicity and duality. In this section, we prove that universal local acyclicity
behaves well with respect to Verdier duality.
IV.2.3.1. Compatibility with base change. We note that for f-ULA sheaves, the formation of
the (relative) Verdier dual
DX/S(A) := RHomΛ(A, Rf!Λ)
commutes with base change in S.
Proposition IV.2.15. Let f : X →S be a compactiﬁable map of locally spatial diamonds with
locally dim. trg f < ∞and let A ∈D´et(X, Λ) be f-universally locally acyclic. Let g : S′ →S be
a map of locally spatial diamonds with pullback f′ : X′ = X ×S S′ →S′, eg : X′ →X. Then the
composite
eg∗DX/S(A) →DX′/S′(eg∗A)
of the natural maps
eg∗RHomΛ(A, Rf!Λ) →RHomΛ(eg∗A, eg∗Rf!Λ) →RHomΛ(eg∗A, Rf′!Λ)
is an isomorphism.
More generally, for any B ∈D´et(S, Λ), the map
eg∗RHomΛ(A, Rf!B) →RHomΛ(eg∗A, Rf′!B)
is an isomorphism.
Proof. The assertion is local, so we may assume that X, S and S′ are spatial. By choosing a
strictly totally disconnected cover S′′ of S′, one reduces the result for S′ →S to the cases of S′′ →S′
and S′′ →S, so we may assume that S′ is strictly totally disconnected. In that case, by [Sch17a,
Proposition 20.17], whose hypothesis apply as X′ →S′ is of ﬁnite dim. trg and S′ is strictly totally
disconnected, it suﬃces to check on global sections over all quasicompact separated ´etale maps
V ′ →X′. According to Lemma IV.2.16 we can write S′ as a coﬁltered limit of quasicompact open
subsets S′
i of ﬁnite-dimensional balls over S. Then V ′ comes via pullback from a quasicompact

120
IV. GEOMETRY OF DIAMONDS
separated ´etale map Vi →X ×S S′
i for i large enough by [Sch17a, Proposition 11.23]. We thus
have a diagram with cartesian squares
V
V ′
X′
X ×S S′
i
X
S′
S′
i
S.
hi
The result we want to prove is immediate when S′ →S is cohomologically smooth. Up to replacing
X →S by V ′ →S′
i we are thus reduced to prove that RΓ(X′, eg∗DX/S(A)) ∼
−→RΓ(X′, DX′/S′(eg∗A)).
Thus, it suﬃces to check the result after applying Rf′
∗. In that case,
Rf′
∗eg∗RHomΛ(A, Rf!B) = g∗Rf∗RHomΛ(A, Rf!B)
= g∗RHomΛ(Rf!A, B),
using [Sch17a, Proposition 17.6, Theorem 1.8 (iv)]. On the other hand,
Rf′
∗RHomΛ(eg∗A, Rf′!B) = RHomΛ(Rf′
! eg∗A, B)
= RHomΛ(g∗Rf!A, B)
using [Sch17a, Theorem 1.8 (iv), Theorem 1.9 (ii)]. But by condition (b) of being f-locally acyclic,
the complex Rf!A ∈D´et(S, Λ) is perfect-constructible, and thus the formation of RHomΛ(Rf!A, B)
commutes with any base change by Lemma IV.2.17.
□
Lemma IV.2.16. Let S be a spatial diamond and X →S be a morphism from an aﬃnoid
perfectoid space to S. Then one can write X = lim
←−i Ui where Ui is a quasicompact open subset
inside a ﬁnite dimensional ball over S, and the projective limit is coﬁltered.
Proof. If I = O(X)+, one has a closed immersion over S deﬁned by elements of I, X ,→BI
S
where BI
S is the spatial diamond over S that represents the functor T/S 7→(O(T)+)I (an “inﬁnite
dimensional perfectoid ball over S” when S is perfectoid). Now,
BI
S = lim
←−
J⊂I
BJ
S
where J goes through the set of ﬁnite subsets of I and BI
S →BJ
S is the corresponding projection.
For each such J the composite X ,→BI
S ↠BJ
S is a spatial morphism of spatial diamonds. Its image
is a pro-constructible generalizing subset of BJ
S and can thus be written as T
α∈AJ Uα where Uα is
a quasicompact open subset of BJ
S. Then one has
X = lim
←−
J⊂I
lim
←−
α∈AJ
Uα.
□
Lemma IV.2.17. Let X be a spatial diamond and A ∈D´et(X, Λ) perfect-constructible, and let
B ∈D´et(X, Λ) be arbitrary. Then the formation of RHomΛ(A, B) commutes with any base change.

IV.2. UNIVERSALLY LOCALLY ACYCLIC SHEAVES
121
Proof. Using [Sch17a, Proposition 20.16 (iii)] this is reduced to the case when A = j!(L|Z)
where j : U →X is separated quasicompact ´etale, Z ⊂U closed constructible, and L ∈D´et(U, Λ)
locally constant with perfect ﬁbres. If j′ : U \ Z →X, that is again quasicompact (since Z is
constructible inside U) separated ´etale, using the exact sequence 0 →j′
!L →j!L →j!(L|Z) →0,
this is reduced to the case of A of the form j!L. In this case RHomΛ(A, −) is given by Rj∗(L∨⊗L
Λ−),
and this commutes with any base change by quasicompact base change, [Sch17a, Proposition
17.6].
□
One has to be careful that, in general, the naive dual of a perfect constructible complex is not
constructible. The following lemma says that in fact it is overconvergent, so never constructible
unless locally constant.
Lemma IV.2.18. For X a spatial diamond and A ∈D´et(X, Λ) perfect constructible, RHomΛ(A, Λ)
is overconvergent.
Proof. Using Lemma IV.2.17 this is reduced to the case when X = Spa(C, C+).
More-
over, one can assume that A = j!Λ for some quasicompact open immersion j : U →X. Then
RHomΛ(A, Λ) = Rj∗Λ = Λ, which is overconvergent.
□
IV.2.3.2. Twisted inverse images. Also, if A is f-ULA, then one can relate appropriately A-
twisted versions of f∗and Rf!.
Proposition IV.2.19. Let f : X →S be a compactiﬁable map of locally spatial diamonds
with locally dim. trg f < ∞and let A ∈D´et(X, Λ) be f-universally locally acyclic. Then for all
B ∈D´et(S, Λ), the natural map
DX/S(A) ⊗L
Λ f∗B →RHomΛ(A, Rf!B)
given as the composite
RHomΛ(A, Rf!Λ) ⊗L
Λ f∗B →RHomΛ(A, Rf!Λ ⊗L
Λ f∗B) →RHomΛ(A, Rf!B)
is an isomorphism.
Proof. First, we note that both sides commute with any base change, by Proposition IV.2.15.
It suﬃces to check that we get an isomorphism on stalks at all geometric points Spa(C, C+)
of X. For this, we may base change along the associated map Spa(C, C+) →S to reduce to the
case that S = Spa(C, C+) is strictly local, and we need to check that we get an isomorphism
at the stalk of a section s : S →X.
We may also assume that X is spatial, in which case
X is of bounded cohomological dimension, so [Sch17a, Proposition 20.17] applies, and perfect-
constructible complexes are the same thing as compact objects in D´et(X, Λ) = D(X´et, Λ).
Next, we note that the functor B 7→RHomΛ(A, Rf!B) is right adjoint to A′ 7→Rf!(A ⊗L
Λ A′).
The latter functor preserves perfect-constructible complexes, i.e. compact objects, by condition
(b), see Lemma IV.2.14. Thus, B 7→RHomΛ(A, Rf!B) commutes with arbitrary direct sums, see
Lemma IV.2.20. Obviously, the functor B 7→DX/S(A)⊗L
Λ f∗B also commutes with arbitrary direct
sums, so it follows that it suﬃces to check the assertion for B = j!Λ for some quasicompact open
immersion j : S′ = Spa(C, C′+) →S (the shifts of those compact objects generate D´et(S, Λ)). If
S′ = S, then B = Λ and the result is clear. Otherwise, the stalk of j!Λ at the closed point is zero,

122
IV. GEOMETRY OF DIAMONDS
and thus the stalk of the left-hand side DX/S(A) ⊗L
Λ f∗B at our ﬁxed section is zero. It remains to
see that the stalk of
RHomΛ(A, Rf!j!Λ)
at the (closed point of) the section s : S →X is zero. This stalk is given by the ﬁltered colimit
over all quasicompact open neighborhoods U ⊂X of s(S) of
R HomD´et(U,Λ)(A|U, Rf!j!Λ|U) = R HomD´et(S,Λ)(RfU!A|U, j!Λ),
where fU : U →S denotes the restriction of f (the possibility to use only open embeddings in place
of general ´etale maps results from the observation that the intersection of all these open subsets
is the strictly local space S already; the set of open neighborhoods of s(S) is coﬁnal among ´etale
neighborhoods of s(S)).
Now we claim that the inverse systems of all such U and of the compactiﬁcations U
/S are
coﬁnal. Note that the intersection of all U
/S (taken inside X
/S) is simply s(S): Indeed, given any
point x ∈X
/S \ s(S), there are disjoint open neighborhoods x ∈V and s(S) ⊂U. In fact, the
maximal Hausdorﬀquotient |X
/S|B is compact Hausdorﬀby [Sch17a, Proposition 13.11] and its
points can be identiﬁed with rank 1 points of X
/S, which are the same as rank 1 points of X. But
as s(S) ⊂X
/S is closed, no point outside s(S) admits the same rank 1 generalization, so x and s(S)
deﬁne distinct points of the Hausdorﬀspaces |X
/S|, so that the desired disjoint open neighborhoods
exist x ∈V and s(S) ⊂U exist. Then x ̸∈U
/S. Thus,
s(S) =
\
U⊃s(S)
U
/X.
Now given any open neighborhood U of s(S), the complement |X
/S| \ U is quasicompact, which
then implies that there is some U′ such that U′/S ⊂U. It follows that the direct systems of
RfU!A|U
and
RfU/S∗Ri!
U/SA
are equivalent, where iU/S : U
/S →X and fU/S : U
/S →S are the evident maps. Now observe that
if j′
X : Xη = X ×S Spa(C, OC) ,→X denotes the proconstructible generalizing immersion, then
condition (a) in being f-locally acyclic implies that A = Rj′
X∗A|Xη (see Remark IV.2.3), and then
RfU/S∗Ri!
U/SA = RfU/S∗Ri!
U/SRj′
X∗A|Xη
= RfU/S∗Rj′
U/S∗Ri!
U/S
η A|Xη
= Rj′
S∗RfU/S
η ∗Ri!
U/S
η A|Xη
with hopefully evident notation; in particular, j′
S : Spa(C, OC) →S = Spa(C, C+) denotes the
pro-open immersion of the generic point on the base.

IV.2. UNIVERSALLY LOCALLY ACYCLIC SHEAVES
123
In summary, we can rewrite the stalk of RHomΛ(A, Rf!j!Λ) at s(S) as the ﬁltered colimit of
R HomD´et(S,Λ)(Rj′
S∗RfU/S
η ∗Ri!
U/S
η A, j!Λ),
and we need to prove that this vanishes.
This follows from the observation that for all M ∈
D´et(Spa(C, OC), Λ) = D(Λ), one has
R HomD´et(S,Λ)(Rj′
S∗M, j!Λ) = 0.
For this, note that Rj′
S∗M = M is just the constant sheaf given by the complex of Λ-modules M,
and one has a triangle
R HomD´et(S,Λ)(M, j!Λ) →R HomD´et(S,Λ)(M, Λ) →R HomD´et(S,Λ)(M, i∗Λ),
where i denotes the complementary closed immersion. Both the second and last term are given by
R HomΛ(M, Λ), ﬁnishing the proof.
□
We used the following classical lemma, cf. [Nee96, Theorem 5.1].
Lemma IV.2.20. Let C and D be triangulated categories such that C is compactly generated. Let
F : C →D and G : D →C be such that G is right adjoint to F. If F sends compact objects to
compact objects then G commutes with arbitrary direct sums.
Proof. Since C is compactly generated it suﬃces to prove that for any compact object A in
C and any collection (Bi)i of objects of D, Hom(A, ⊕iG(Bi)) ∼
−→Hom(A, G(⊕iBi)). By compact-
ness of A, Hom(A, ⊕iG(Bi)) = ⊕i Hom(A, G(Bi)), by adjunction this is equal to ⊕i Hom(F(A), Bi),
since F(A) is compact this is equal to Hom(F(A), ⊕iBi), and by adjunction this is Hom(A, G(⊕iBi)).
□
Remark IV.2.21.
(i) In fact, outside of the overconvergence condition (a) in Deﬁnition IV.2.1, the property of Propo-
sition IV.2.19 characterizes locally acyclic complexes under the assumption that locally on X the
exists an integer N such that for any U →X quasicompact separated ´etale the cohomological
dimension of X´et is bounded by N. More precisely, if j : U →X is separated ´etale with f ◦j
quasicompact then R HomΛ(R(f ◦j)!A, B) = RΓ(U, RHomΛ(A, Rf!B)). Thus, if for all B one has
DX/S(A) ⊗L
Λ f∗B ∼
−→RHomΛ(A, Rf!B) then R(f ◦j)!A is compact since RΓ(U, −) commutes with
arbitrary direct sums.
(ii) Outside of the overconvergence condition (a) in Deﬁnition IV.2.1, the property of Proposi-
tion IV.2.19 universally on S characterize universally locally acyclic objects. In fact, using [Sch17a,
Proposition 20.13], the constructibility property is reduced to the case when the base is strictly
totally disconnected, in which case we can apply point (1).
Finally, let us note that all the previous results extend to the setting where the base S is a
general small v-stack, taking the following deﬁnition.
Definition IV.2.22. Let f : X →S be a map of small v-stacks that is compactiﬁable and
representable in locally spatial diamonds with locally dim. trg f < ∞. Let A ∈D´et(X, Λ). Then
A is f-universally locally acyclic if for any map S′ →S from a locally spatial diamond S′ with
pullback f′ : X′ = X ×S S′ →S′, the complex A|X′ ∈D´et(X′, Λ) is f′-locally acyclic.

124
IV. GEOMETRY OF DIAMONDS
IV.2.3.3. Dualizability. From the previous two propositions, we can deduce an analogue of a
recent result of Lu-Zheng, [LZ20], characterizing universal local acyclicity in terms of dualizability
in a certain monoidal category. We actually propose a diﬀerent such characterization closer to how
dualizability will appear later in the discussion of geometric Satake. In terms of applications to
abstract properties of universal local acyclicity, such as its preservation by Verdier duality, it leads
to the same results.
Fix a base small v-stack S, and a coeﬃcient ring Λ (killed by some integer prime to p). We
deﬁne a 2-category CS as follows. The objects of CS are maps f : X →S of small v-stacks that
are compactiﬁable, representable in locally spatial diamonds, with locally dim. trg f < ∞. For any
X, Y ∈CS, the category of maps FunCS(X, Y ) is the category D´et(X ×S Y, Λ). Note that any such
A ∈D´et(X ×S Y, Λ) deﬁnes in particular a functor
D´et(X, Λ) →D´et(Y, Λ) : B 7→Rπ2!(A ⊗L
Λ π∗
1B)
with kernel A, where π1 : X ×S Y →X, π2 : X ×S Y →Y are the two projections. The composition
in CS is now deﬁned to be compatible with this association. More precisely, the composition
FunCS(X, Y ) × FunCS(Y, Z) →FunCS(X, Z)
is deﬁned to be the functor
D´et(X ×S Y, Λ) × D´et(Y ×S Z, Λ) →D´et(X ×S Z, Λ) : (A, B) 7→A ⋆B = Rπ13!(π∗
12A ⊗L
Λ π∗
23B)
where πij denotes the various projections on X ×S Y ×S Z. It follows from the projection formula
that this indeed deﬁnes a 2-category CS. The identity morphism is given by R∆!Λ = R∆∗Λ ∈
D´et(X ×S X, Λ), where ∆: X ,→X ×S X is the diagonal. We note that CS is naturally equivalent
to Cop
S .
Indeed, D´et(X ×S Y, Λ) is invariant under switching X and Y , and the deﬁnition of
composition (and coherences) is compatible with this switch.
Recall that in any 2-category C, there is a notion of adjoints. Namely, a morphism f : X →Y
is a left adjoint of g : Y →X if there are maps α : idX →gf and β : fg →idY such that the
composites
f
fα
−−→fgf
βf
−→f, g
αg
−→gfg
gβ
−→g
are the identity.
If a right adjoint g of f exists, it is (together with the accompanying data)
moreover unique up to unique isomorphism.
As is clear from the deﬁnition, any functor of 2-
categories preserves adjunctions. In particular, this applies to pullback functors CS →CS′ for maps
S′ →S of small v-stacks, or to the functor from CS to triangulated categories taking X to D´et(X, Λ)
and A ∈FunCS(X, Y ) to the functor Rπ2!(A ⊗L
Λ π∗
1−) with kernel A.
Theorem IV.2.23. Let S be a small v-stack and X ∈CS, and A ∈D´et(X, Λ). The following
conditions are equivalent.
(i) The complex A is f-universally locally acyclic.
(ii) The natural map
p∗
1DX/S(A) ⊗L
Λ p∗
2A →RHomΛ(p∗
1A, Rp!
2A)
is an isomorphism, where p1, p2 : X ×S X →X are the two projections.
(iii) The object A ∈FunCS(X, S) is a left adjoint in CS. In that case, its right adjoint is given by
DX/S(A) ∈D´et(X, Λ) = FunCS(S, X).

IV.2. UNIVERSALLY LOCALLY ACYCLIC SHEAVES
125
Proof. That (i) implies (ii) follows from Proposition IV.2.15 and Proposition IV.2.19. For (ii)
implies (iii), we claim that A ∈FunCS(X, S) is indeed a left adjoint of DX/S(A) ∈FunCS(A). The
composites are given by
A ⋆DX/S(A) = Rf!(DX/S(A) ⊗L
Λ A) ∈D´et(S, Λ) = FunCS(S, S)
and
DX/S(A) ⋆A = p∗
1A ⊗L
Λ p∗
2DX/S(A) ∈D´et(X ×S X, Λ) = FunCS(X, X).
Then we take β : A ⋆DX/S(A) →idS to be given by the map Rf!(DX/S(A) ⊗L
Λ A) →Λ adjoint
to the map DX/S(A) ⊗L
Λ A →Rf!Λ which is just the tautological pairing. On the other hand, for
α : idX →DX/S(A) ⋆A, we have to produce a map
R∆!Λ →p∗
1A ⊗L
Λ p∗
2DX/S(A).
Using (ii), the right-hand side is naturally isomorphic to RHomΛ(p∗
1A, Rp!
2A). Now maps from
R∆!Λ are adjoint to sections of
R∆!RHomΛ(p∗
1A, Rp!
2A) ∼= RHomΛ(A, A)
(using [Sch17a, Theorem 1.8 (v)]), which has the natural identity section. It remains to prove that
certain composites are the identity. This follows from a straightforward diagram chase.
Finally, it remains to prove that (iii) implies (i).
We can assume that S is strictly totally
disconnected. It follows that the functor Rf!(A ⊗L
Λ −) admits a right adjoint that commutes with
all colimits. This implies that condition (b) in Deﬁnition IV.2.1 is satisﬁed. In fact, more precisely
we see that the right adjoint RHomΛ(A, Rf!−) is given by A′⊗L
Λf∗−for some A′ ∈D´et(X, Λ), and
by using the self-duality of Cop
S , we also see that RHomΛ(A′, Rf!−) is given by A⊗L
Λ f∗−. Applied
to the constant sheaf, this shows in particular that A ∼= RHomΛ(A′, Rf!Λ) is a Verdier dual.
For condition (a), we can assume that S = Spa(C, C+) and reduce to checking overconvergence
along sections s : S →X.
In fact, using part (2) of Remark IV.2.3, let j : Spa(C, OC) →
Spa(C, C+) be the pro-open immersion, with pullback jX : X ×Spa(C,C+) Spa(C, OC) →X, and
fη : X ×Spa(C,C+) Spa(C, OC) →Spa(C, OC) the restriction of f. To see the overconvergence, it is
enough to see that A ∼= RjX∗A0 for some A0. But
A ∼= RHomΛ(A′, Rf!Λ) ∼= RHomΛ(A′, Rf!Rj∗Λ)
∼= RHomΛ(A′, RjX∗Rf!
ηΛ) ∼= RjX∗RHomΛ(j∗
XA′, Rf!
ηΛ),
giving the desired overconvergence.
□
Before moving on, let us observe the following relative variant.
Proposition IV.2.24. Let S be a small v-stack and X, Y ∈CS. If Y/S is proper and A ∈
FunCS(X, Y ) = D´et(X ×S Y, Λ) is p2-universally locally acyclic, then it is a left adjoint and the
right adjoint is given by
DX×SY/Y (A) ∈D´et(X ×S Y, Λ) ∼= D´et(Y ×S X, Λ) = FunCS(Y, X).
The assumption that Y/S is proper is important here. Already if X = S and A = Λ ∈D´et(Y, Λ),
which is always idY -universally locally acyclic, being a left adjoint in CS implies that there is some
B ∈D´et(Y, Λ) for which Rf∗∼= Rf!(B ⊗L
Λ −).

126
IV. GEOMETRY OF DIAMONDS
Proof. We need to produce the maps α and β again. Let us give the construction of α, which
is the harder part. First, using the various projections πij on X ×S Y ×S X, we have
DX×SY/Y (A) ⋆A ∼= Rπ13!(π∗
12DX×SY/Y (A) ⊗L
Λ π∗
23A) ∼= Rπ13∗RHomΛ(π∗
12A, Rπ!
23A)
using that A is p2-universally locally acyclic, and properness of π13 (which is a base change of
Y →S). Now giving a map R∆!Λ →DX×SY/Y (A)⋆A, for ∆= ∆X/S, amounts to ﬁnding a section
of
R∆!Rπ13∗RHomΛ(π∗
12A, Rπ!
23A) ∼= Rp1∗R∆!
X×SY/Y RHomΛ(π∗
12A, Rπ!
23A) ∼= Rp1∗RHomΛ(A, A),
where we can take the identity.
□
Theorem IV.2.23 has the following notable consequences.
Corollary IV.2.25. Let f : X →S be a compactiﬁable map of locally spatial diamonds with
locally dim. trg f < ∞and let A ∈D´et(X, Λ) be f-universally locally acyclic. Then DX/S(A) is
again f-universally locally acyclic, and the biduality map
A →DX/S(DX/S(A))
is an isomorphism.
If fi : Xi →S for i = 1, 2 are compactiﬁable maps of small v-stacks that are representable in
locally spatial diamonds with locally dim. trg fi < ∞and Ai ∈D´et(Xi, Λ) are fi-universally locally
acyclic, then also A1⊠A2 ∈D´et(X1×S X2, Λ) is f1×S f2-universally locally acyclic, and the natural
map
DX1/S(A1) ⊠DX2/S(A2) →DX1×SX2/S(A1 ⊠A2)
is an isomorphism.
Proof. By Theorem IV.2.23, the object DX/S(A) ∈FunCS(S, X) is a right adjoint of A ∈
FunCS(X, S). But CS ∼= Cop
S ; under this equivalence, this means that DX/S(A) ∈FunCS(S, X) is a
left adjoint of A ∈FunCS(S, X). Thus, applying Theorem IV.2.23 again, the result follows.
For the second statement, note that Ai ∈D´et(Xi, Λ) deﬁne left adjoints, hence so does
A1 ⋆A2 = A1 ⊠A2 ∈D´et(X1 ×S X2, Λ) = FunCS(X1 ×S X2, S).
Its right adjoint is the similar composition, giving the claim.
□
The ﬁnal statement admits the following generalization concerning “compositions” of univer-
sally locally acyclic sheaves.
Proposition IV.2.26. Let g : Y →X and f : X →S be compactiﬁable maps of small
v-stacks representable in locally spatial diamonds with locally dim. trg f, dim. trg g < ∞, and let
A ∈D´et(X, Λ) be f-universally acyclic and B ∈D´et(Y, Λ) be g-universally locally acyclic. Then
g∗A ⊗L
Λ B is f ◦g-universally locally acyclic, and there is natural isomorphism
DY/S(g∗A ⊗L
Λ B) ∼= g∗DX/S(A) ⊗L
Λ DY/X(B).

IV.2. UNIVERSALLY LOCALLY ACYCLIC SHEAVES
127
Proof. It is easy to see that condition (a) of being locally acyclic holds universally, so it suﬃces
to identify the functor RHomΛ(g∗A ⊗L
Λ B, R(f ◦g)!−). We compute:
RHomΛ(g∗A ⊗L
Λ B, R(f ◦g)!−) = RHomΛ(B, RHomΛ(g∗A, Rg!Rf!−))
= RHomΛ(B, Rg!RHomΛ(A, Rf!−))
= DY/X(B) ⊗L
Λ g∗RHom(A, Rf!−)
= DY/X(B) ⊗L
Λ g∗DX/S(A) ⊗L
Λ g∗f∗−,
implying that it commutes with colimits, hence its left adjoint preserves perfect-constructible com-
plexes (after reduction to strictly totally disconnected S and X and Y spatial). Moreover, evaluating
this functor at Λ gives the identiﬁcation of the Verdier dual.
□
Let us also note another corollary of Theorem IV.2.23 concerning retracts.
Corollary IV.2.27. Let f : X →S and g : Y →S be maps of small v-stacks that are
compactiﬁable and representable in locally spatial diamonds with locally dim. trg f, dim. trg g < ∞.
Assume that f is a retract of g over S, i.e. there are maps i : X →Y , r : Y →X over S such that
ri = idX. If Λ is g-universally locally acyclic, then Λ is f-universally locally acyclic.
Proof. One can check this directly from the deﬁnitions, or note that the map in CS given by
Λ ∈D´et(X, Λ) = FunCS(X, S) is a retract of the map given by Λ ∈D´et(Y, Λ) = FunCS(Y, S), from
which one can easily obtain adjointness.
□
Moreover, in some cases the converse to Proposition IV.2.11 holds.
Proposition IV.2.28. Let g : Y →X, f : X →S be maps of locally spatial diamonds where g is
proper and quasi-pro-´etale and f is compactiﬁable and locally dim. trg f < ∞. Then A ∈D´et(Y, Λ)
is f ◦g-universally locally acyclic if and only if Rg∗A ∈D´et(X, Λ) is f-universally locally acyclic.
Proof. One direction is given by Proposition IV.2.11. For the converse, assume that Rg∗A
is f-universally locally acylic. To see that A is h = f ◦g-universally locally acyclic, it suﬃces by
Theorem IV.2.23 that the map
p∗
1,Y RHom(A, Rh!Λ) ⊗L
Λ p∗
2,Y A →RHom(p∗
1,Y A, Rp!
2,Y A)
in D´et(Y ×S Y, Λ) is an isomorphism, where p1,Y , p2,Y : Y ×S Y →Y are the two projections. As
g ×S g : Y ×S Y →X ×S X is proper and quasi-pro-´etale, pushforward along g ×S g is conservative:
By testing on stalks, this follows from the observation that for a proﬁnite set T, the global sections
functor RΓ(T, −) is conservative on D(T, Λ) (as one can write any stalk as a ﬁltered colimit of
functors that are direct summands of the global sections functor). Applying R(g×S g)∗= R(g×S g)!
to the displayed map, we get the map
p∗
1,XRHom(Rg∗A, Rf!Λ) ⊗L
Λ p∗
1,Y Rg∗A →RHom(p∗
1,XRg∗A, Rp!
2,XRg∗A)
where p1,X, p2,X : X ×S X →X are the two projections. This is an isomorphism precisely when
Rg∗A is f-universally locally acyclic.
□
The following corollary shows that smooth base change generalizes to universally locally acyclic
maps. The general version of this corollary was suggested by David Hansen.

128
IV. GEOMETRY OF DIAMONDS
Corollary IV.2.29 (ULA base change). Consider a cartesian diagram of small v-stacks
X′
eg
/
f′

X
f

S′
g
/ S
with f representable in locally spatial diamonds, compactiﬁable, locally dim. trg f < ∞. Assume
that Λ is f-universally locally acyclic. Then the base change map
f∗Rg∗A →Reg∗f′∗A
is an isomorphism.
More generally, if B ∈D´et(X, Λ) is f-universally locally acyclic and A ∈
D´et(S′, Λ), then
(f∗Rg∗A) ⊗L
Λ B ∼
−→Reg∗(f′∗A ⊗L
Λ eg∗B).
Proof. We apply Proposition IV.2.19 to the universally locally acyclic DX/S(B), so that by
Corollary IV.2.25, we get
f∗Rg∗A ⊗L
Λ B ∼= RHomΛ(DX/S(B), Rf!Rg∗A).
By [Sch17a, Theorem 1.9 (iii)], Rf!Rg∗A ∼= Reg∗Rf′!A, and then one can rewrite further as
RHomΛ(DX/S(B), Reg∗Rf′!A) ∼= Reg∗RHomΛ(eg∗DX/S(B), Rf′!A).
Now another application of Proposition IV.2.19 gives the result.
□
Finally let us note the following consequence of Theorem IV.2.23 and [LZ20].
Proposition IV.2.30. Let K be a complete non-archimedean ﬁeld with residue characteristic
p, f : X →S a separated morphism of K-schemes locally of ﬁnite type, and A ∈Db
c(X, Λ). Then
A is f-universally acyclic if and only if its analytiﬁcation Aad is fad,♦-universally locally acyclic,
where fad,♦: Xad,♦→Sad,♦.
Proof. The criterion of Theorem IV.2.23 (2) applies similarly in the algebraic case by [LZ20],
and all operations are compatible with passing to analytic adic spaces (and diamonds).
□
For example, if S = Spec K then any A is f-universally locally acyclic and thus Aad is fad,♦-
universally acyclic. This gives plenty of examples of ULA sheaves.
IV.2.4. Local acyclicity for morphisms of Artin v-stacks. Using the descent results
Remark IV.2.2 and Proposition IV.2.13, one can extend the previous deﬁnition and results to the
case of maps of Artin v-stacks as follows.
Definition IV.2.31. Let f : X →S be a map of Artin v-stacks and assume that there is
some separated, representable in locally spatial diamonds, and cohomologically smooth surjection
g : U →X from a locally spatial diamond U such that f ◦g : U →S is compactiﬁable with locally
dim. trg(f ◦g) < ∞. Then A ∈D´et(X, Λ) is f-universally locally acyclic if g∗A is f ◦g-universally
locally acyclic.

IV.2. UNIVERSALLY LOCALLY ACYCLIC SHEAVES
129
All previous results concerning universally locally acyclic complexes also hold in this setting
(assuming that the relevant operations are deﬁned in the case of interest – we did not deﬁne Rf!
and Rf! for general stacky maps), and follow by the reduction to the case when S and X are locally
spatial diamonds. In particular, the characterization in terms of dualizability gives the following.
Proposition IV.2.32. Let f : X →S be a cohomologically smooth map of Artin v-stacks, and
let A ∈D´et(X, Λ). Consider X ×S X with its two projections p1, p2 : X ×S X →X. Then A is
f-universally locally acyclic if and only if the natural map
p∗
1RHomΛ(A, Λ) ⊗L
Λ p∗
2A →RHomΛ(p∗
1A, p∗
2A)
is an isomorphism.
Proof. Taking a chart for S, we can assume that S is a locally spatial diamond, and then
taking a presentation for X we can assume that also X is a locally spatial diamond, noting that
the condition commutes with smooth base change. In that case, replacing some occurences of p∗
2
by Rp!
2 using cohomological smoothness, the result follows from Theorem IV.2.23.
□
There is a simple characterization of ℓ-cohomological smoothness in terms of universal local
acyclicity.
Proposition IV.2.33. Let f : X →S be a compactiﬁable map of v-stacks that is representable
in locally spatial diamonds with locally dim. trg f < ∞. Then f is ℓ-cohomologically smooth if and
only if Fℓis f-universally locally acyclic and its Verdier dual Rf!Fℓis invertible.
Note that in checking whether Fℓis f-universally locally acyclic, condition (a) of Deﬁni-
tion IV.2.1 is automatic. Also, by Theorem IV.2.23, the condition that Fℓis f-universally locally
acyclic is equivalent to the condition that the natural map
p∗
1Rf!Fℓ→Rp!
2Fℓ
is an isomorphism, where p1, p2 : X×SX →X are the two projections. Thus, f is ℓ-cohomologically
smooth if and only if Rf!Fℓis invertible and its formation commutes with any base change.
Proof. The conditions are clearly necessary. For the converse, we may assume that S is strictly
totally disconnected. By Proposition IV.2.19, the natural transformation of functors
Rf!Λ ⊗L
Λ f∗→Rf!
is an equivalence. As Rf!Λ is assumed to be invertible (it commutes with base change by Proposi-
tion IV.2.15), this shows that the condition of [Sch17a, Deﬁnition 23.8] is satisﬁed.
□
In particular, we can resolve a question from [Sch17a].
Corollary IV.2.34. The map f : Spd OE →Spd Fq is ℓ-cohomologically smooth for all ℓ̸= p.
Proof. This is clear if E is of equal characteristic, so assume that E is p-adic. First, we prove
that Fℓis f-ULA. This follows from f′ : Spd O e
E ∼= Spd Fq[[t1/p∞]] →Spd Fq being ℓ-cohomologically
smooth, where eE/E is some totally ramiﬁed Zp-extension, by the argument of the proof of [Sch17a,
Proposition 24.3] (in essence, the compactly supported pushforward for any base change of f are

130
IV. GEOMETRY OF DIAMONDS
the Zp-invariants inside the compactly supported pushforward for the corresponding base change
of f′, so constructibility of the latter implies constructibility of the former).
It remains to show that Rf!Fℓis invertible. If j : Spd E →Spd OE is the open immersion with
complement i : Spd Fq →Spd OE, we have Ri!Rf!Fℓ= Fℓby transitivity, and j∗Rf!Fℓ∼= Fℓ(1)[2]
by [Sch17a, Proposition 24.5], so we get a triangle
i∗Fℓ→Rf!Fℓ→Rj∗Fℓ(1)[2].
Using this, one computes Rf!Fℓ∼= Fℓ(1)[2], as desired.
□
IV.3. Formal smoothness
IV.3.1. Deﬁnition. A key step in the proof of Theorem IV.4.2, the Jacobian criterion of
cohomological smoothness, is the following notion of formal smoothness.
Definition IV.3.1. Let f : Y →X be a map of v-stacks. Then f is formally smooth if for
any aﬃnoid perfectoid space S of characteristic p with a Zariski closed subspace S0 ⊂S, and any
commutative diagram
S0
g0
/

Y
f

S
h
/ X,
there is some ´etale map S′ →S containing S0 in its image and a map g : S′ →Y ﬁtting in a
commutative diagram
S′ ×S S0
/

S0
g0
/

Y
f

S′
g
5
/ S
h
/ X.
This kind of formal smoothness is closely related to the notion of absolute neighborhood retracts
([Bor67], [Dol80]). In fact, suppose Y →X is formally smooth with Y and X aﬃnoid perfectoid.
Choose a Zariski closed embedding Y ,→BI
X for some set I. Then there exists an ´etale neighborhood
U →BI
X of Y such that the closed embedding
i : Y ×BI
X U ,→U
admits a retraction r : U →Y ×BI
X U, r ◦i = Id. Thus, Y/X is a retract of an (´etale) neighborhood
inside a ball/X.
IV.3.2. Examples and basic properties. We will see that formally smooth morphisms
share analogous properties to cohomologically smooth morphisms. Let’s begin with the following
observations:
(i) The composite of two formally smooth morphisms is formally smooth,
(ii) The formally smooth property is stable under pullback: if Y →X is formally smooth and
X′ →X is any map then Y ×X X′ →X′ is formally smooth.

IV.3. FORMAL SMOOTHNESS
131
(iii) Separated ´etale maps are formally smooth.
(iv) For morphisms of locally spatial diamonds, formal smoothness is ´etale local on the source and
the target.
Let us observe that, like cohomologically smooth morphisms, formally smooth morphisms are
universally open.
Proposition IV.3.2. Formally smooth maps are universally open.
Proof. Let Y →X be formally smooth. We can suppose X is aﬃnoid perfectoid. Since any
open subsheaf of Y is formally smooth over X we are reduced to prove that the image of Y →X
is open. Let S →Y be a morphism with S aﬃnoid perfectoid. Choose a Zariski closed embedding
S ,→BI
X for some set I. The formal smoothness assumption implies that there exists an ´etale
neighborhood U →BI
X of S ⊂BI
X such that S ×BI
X U →S →Y extends to a map U →Y ; in
particular, the image of S →Y →X is contained in the image of U →Y →X, and it suﬃces to
prove that the latter is open. We can suppose U is quasicompact and separated over BI
X. Writing
BI
X = lim
←−J BJ
X where J goes through the set of ﬁnite subsets of I, there exists a some J ⊂I ﬁnite
and V →BJ
X such that U →BI
X is the pullback of V →BJ
X via the projection BI
X →BJ
X, cf.
[Sch17a, Proposition 6.4]. Since BI
X →BJ
X is a v-cover,
Im(U →X) = Im(V →X).
Now, using that V →BJ
X →X is open, since cohomologically smooth for example, this is an open
subset of X.
□
Let us begin with some concrete examples. In the following, B →∗is the v-sheaf O+ on Perfk
and A1 →∗is the v-sheaf O.
Proposition IV.3.3. The morphisms B →∗, A1 →∗and Spd OE →∗are formally smooth.
Proof. Let S0 = Spa(R0, R+
0 ) ,→S = Spa(R, R+) be a Zariski closed embedding of aﬃnoid
perfectoid spaces. Then R →R0 is surjective, which immediately shows that A1 →∗is formally
smooth. The case of B →∗follows as B ⊂A1 is open. For Spd OE, note that any untilt of S0
can be given by some element ξ ∈WOE(R+
0 ) of the form ξ0 = π + P∞
n=0 πi[ri,0] where all ri ∈R◦◦
0 .
But R◦◦→R◦◦
0
is surjective (cf. the discussion after [Sch17a, Deﬁnition 5.7]), so one can lift all
ri,0 ∈R◦◦
0 to ri ∈R◦◦, and then ξ = π + P∞
n=0 πi[ri] deﬁnes an untilt of S over OE lifting the given
one on S0.
□
Corollary IV.3.4. Is f : Y →X is a smooth morphism of analytic adic spaces over Zp then
f♦: Y ♦→X♦is formally smooth.
Proof. Any smooth morphism is locally ´etale over a ﬁnite-dimensional ball.
□
Let us remark the following.
Proposition IV.3.5. If f : Y →X is a formally smooth and surjective map of v-stacks, then
f is surjective as a map of ´etale stacks. Equivalently, in case X is a perfectoid space, the map f
splits over an ´etale cover of X.

132
IV. GEOMETRY OF DIAMONDS
Proof. We can suppose X is aﬃnoid. There exists a surjective morphism X′ →X with X′
aﬃnoid perfectoid and a section s : X′ →Y of Y →X over X′. Let us choose a Zariski closed
embedding X′ ,→BI
X.
Applying the formal smoothness property we deduce there is an ´etale
neighborhood U →BI
X of X′ ⊂BI
X and a section over U of Y →X. It thus suﬃces to see that
U →X admits a section over an ´etale cover of X. As in the proof of Proposition IV.3.2 there exists
a ﬁnite subset J ⊂I, and quasicompact ´etale map V →BJ
X such that U →BI
X is the pullback
of V →BJ
X via the projection BI
X →BJ
X. This reduces us to the case I is ﬁnite. We may also
replace V by its image in BJ
X. At geometric points, the splitting follows from [Sch17a, Lemma
9.5]. Approximating a section over a geometric point over an ´etale neighborhood then gives the
desired splitting on an ´etale cover.
□
According to [Sch17a, Proposition 23.13] cohomological smoothness is cohomologically smooth
local on the source. The same holds for formally smooth morphisms.
Corollary IV.3.6. Let f : Y →X be a morphism of v-stacks. Suppose there exists a v-
surjective formally smooth morphism of v-stacks g : Y ′ →Y such that f ◦g is formally smooth.
Then f is formally smooth.
Proof. Given a test diagram g0 : S0 →Y , h : S →X as in Deﬁnition IV.3.1, we can ﬁrst
lift S0 →Y ´etale locally to Y ′ by Proposition IV.3.5, and the required ´etale neighborhoods lift to
S by [Sch17a, Proposition 6.4] applied to S0 as the intersection of all open neighborhoods in S.
Thus, the diagram can be lifted to a similar test diagram for Y ′ →X, which admits a solution by
assumption.
□
Let us remark the following.
Proposition IV.3.7. The stack BunG →∗is formally smooth.
Proof. Let S0 = Spa(R0, R+
0 ) ⊂S = Spa(R, R+) be a Zariski closed immersion of aﬃnoid
perfectoid spaces over Spd k, and ﬁx a pseudouniformizer ϖ ∈R. Let E0 be a G-bundle on XS0.
Pick any geometric point Spa(C, C+) →S0; we intend to ﬁnd an ´etale neighborhood U →S of
Spa(C, C+) in S such that the G-bundle over U ×S S0 extends to U.
Note that the pullback of E0 to YC,[1,q] is a trivial G-bundle, by Theorem III.2.2. From [GR03,
Proposition 5.4.21] (applied with R = lim
−→V O+(YV,[1,q]), t = π and I = 0, where V →S0 runs over
´etale neighborhoods of Spa(C, C+) in S0; all of these lift to S) it follows that after passing to an
´etale neighborhood as above, we can assume that the pullback of E0 to YS0,[1,q] is a trivial G-bundle.
In that case, E0 is given by some matrix A ∈G(BR0,[1,1]) encoding the descent. Applying [GR03,
Proposition 5.4.21] again, with
R =
lim
−→
S0⊂U⊂S
O+(YU,[1,1]), t = π, I = ker(R →lim
−→
U
O+(YU,[1,1])),
then shows that we may lift A into a neighborhood, as desired.
□
The following is the analog of Proposition II.3.5 (iii).

IV.4. A JACOBIAN CRITERION
133
Proposition IV.3.8. Let S be a perfectoid space and let [E1 →E0] be a map of vector bundles
on XS such that E0 is everywhere of positive Harder–Narasimhan slopes, and E1 is everywhere of
negative Harder–Narasimhan slopes. Then BC([E1 →E0]) →S is formally smooth.
Proof. Using the exact sequence
0 →BC(E0) →BC([E1 →E0]) →BC(E1[1]) →0
and Proposition II.3.4 (iii), one reduces to the individual cases of BC(E0) and BC(E1[1]). For E = E0,
we can use Corollary II.3.3 to choose ´etale locally on S a short exact sequence
0 →G →OXS(1
r)m →E →0
where G is ﬁberwise on S semistable of positive slope. Moreover, by Proposition II.3.4 (iii), one
can also ensure that H1(XS′, G|XS′) = 0 for all aﬃnoid perfectoid spaces S′ →S. In particular, if
S0 ⊂S is a Zariski closed immersion of aﬃnoid perfectoid spaces, the map OXS(1
r)m(S0) →E(S0)
is surjective, and we can replace E by OXS(1
r)m. But then Proposition II.2.5 (iv) shows that this
Banach–Colmez space is representable by a perfectoid open unit disc, which is formally smooth.
For E = E1, we can use Theorem II.2.6 to ﬁnd a short exact sequence
0 →E →OXS(d)m →G →0
for some d, m > 0, and this induces an exact sequence
0 →BC(G) →BC(OXS(d)m) →BC(E[1]) →0
where the middle term is formally smooth by the preceding, and the map BC(OXS(d)m) →BC(E[1])
is formally smooth (as ´etale locally surjective and its ﬁbre BC(G) is formally smooth). We conclude
by Corollary IV.3.6.
□
IV.4. A Jacobian criterion
The goal of this section is to prove that certain geometrically deﬁned diamonds are cohomo-
logically smooth when one expects them to be. We regard this result as the most profound in the
theory of diamonds so far: While we cannot control much of the geometry of these diamonds, in
particular we have no way to relate them to (perfectoid) balls in any reasonable way, we can still
prove relative Poincar´e duality for them. The spaces considered below also appear quite naturally
in a variety of contexts, so we expect the result to have many applications.
The setup is the following. Let S be a perfectoid space and let Z →XS be a smooth map of
sous-perfectoid adic spaces — deﬁning this concept of smoothness will be done in a ﬁrst subsection,
but it is essentially just a family of smooth rigid spaces over XS, in the usual sense. One can then
consider the v-sheaf MZ of sections of Z →XS, sending any perfectoid space S′ →S to the set
of maps XS′ →Z lifting XS′ →XS. In general, we cannot prove that MZ is a locally spatial
diamond, but this turns out to be true when Z is quasiprojective in the sense that it is a Zariski
closed subspace of an open subset of (the adic space) Pn
XS for some n ≥0.
In general, the space MZ →S is not (cohomologically) smooth: If tangent spaces of MZ →S
would exist, one would expect their ﬁbre over S′ →MZ, given by some section s : XS′ →Z,
to be given by H0(XS′, s∗TZ/XS), where TZ/XS is the tangent bundle of Z →XS; and then an
obstruction space would be given by H1(XS′, s∗TZ/XS). Thus, one can expect smoothness to hold

134
IV. GEOMETRY OF DIAMONDS
only when H1(XS′, s∗TZ/XS) vanishes. This holds true, locally on S′, if all slopes of s∗TZ/XS are
positive (by Proposition II.3.4 (iii)), suggesting the following deﬁnition.
Definition IV.4.1. Let Msm
Z
⊂MZ be the open subfunctor of all sections s : XS′ →Z such
that s∗TZ/XS has everywhere positive Harder–Narasimhan slopes.
Roughly speaking, one expects Msm
Z
to look inﬁnitesimally like the Banach–Colmez space
BC(s∗TZ/XS); these indeed are cohomologically smooth when all slopes are positive, by Propo-
sition II.3.5 (iii). Unfortunately, we are unable to prove a direct relation of this sort; however, we
will be able to relate these spaces via a “deformation to the normal cone”.
Our goal is to prove the following theorem.
Theorem IV.4.2. Let S be a perfectoid space and let Z →XS be a smooth map of sous-
perfectoid spaces such that Z admits a Zariski closed immersion into an open subset of (the adic
space) Pn
XS for some n ≥0. Then MZ is a locally spatial diamond, the map MZ →S is compact-
iﬁable, and Msm
Z →S is cohomologically smooth.
Moreover, for a geometric point x : Spa C →Msm
Z
given by a map Spa C →S and a section
s : XC →Z, the map Msm
Z →S is at x of ℓ-dimension equal to the degree of s∗TZ/XS.
Remark IV.4.3. The map Msm
Z →S is a natural example of a map that is only locally of ﬁnite
dimension, but not globally so (as there are many connected components of increasing dimension).
Remark IV.4.4. In the “classical context” of algebraic curves the preceding theorem is the
following (easy) result. Let X/k be a proper smooth curve and Z →X be quasi-projective smooth.
Consider MZ the functor on k-schemes that sends S to morphisms s : X ×k S →Z over X. This is
representable by a quasi-projective scheme over Spec(k). Let Msm
Z be the open sub-scheme deﬁned
by the condition that if s : X ×k S →Z is an S-point of Msm
Z
then the vector bundle s∗TZ/X has
no H1 ﬁberwise on S. Then Msm
Z →Spec(k) is smooth.
Remark IV.4.5. Suppose that W is a smooth quasi-projective E-scheme. The moduli space
MZ with Z = W ×E XS classiﬁes morphisms XS →W i.e. MZ is a moduli of morphisms from
families of Fargues–Fontaine curves to W. This is some kind of “Gromov–Witten” situation.
Remark IV.4.6. We could have made the a priori weaker assumption that Z admits a Zariski
closed immersion inside an open subset of P(E) where E is a vector bundle on XS. Nevertheless,
since the result is local on S and we can suppose it is aﬃnoid perfectoid, and since when S is
aﬃnoid perfectoid OXS(1) “is ample” i.e. there is a surjection OXS(−N)n ↠E for N, n ≫0, this
assumption is equivalent to the one we made i.e. we can suppose E is free.
Example IV.4.7 (The Quot diamond). Let E be a vector bundle on XS. We denote by
QuotE −→S
the moduli space over S of locally free quotients of E. Fixing the rank of such a quotient, one sees
that QuotE is a ﬁnite disjoint union of spaces MZ with Z →XS a Grassmannian of quotients of
E. This is thus representable in locally spatial diamonds, compactiﬁable, of locally ﬁnite dim. trg.
Let Quotsm
E
⊂QuotE be the open subset parametrizing quotients u : E →F such that ﬁberwise,
the greatest slope of ker u is strictly less than the smallest slope of F. According to Theorem IV.4.2
this is cohomologically smooth over S.

IV.4. A JACOBIAN CRITERION
135
Fix an integer n ≥1. For some N ∈Z and r ∈N≥1, let Quotn,sm,◦
O(N)r be the open subset of
Quotsm
O(N)r where the quotient has rank n and its slopes are greater than N.
When N and r
vary one constructs, as in the “classical case”, cohomologically smooth charts on BunGLn using
Quotn,sm,◦
O(N)r. In fact, the morphism
Quotn,sm,◦
O(N)r −→BunGLn
given by the quotient of O(N)r is separated cohomologically smooth.
When pulled back by a
morphism S →BunGLn with S perfectoid, this is an open subset of a positive Banach–Colmez
space.
We will not use the Quot diamond in the following. In section V.3, using the Jacobian criterion,
we will construct charts on BunG for any G that are better suited to our needs.
IV.4.1. Smooth maps of sous-perfectoid adic spaces. We need some background about
smooth morphisms of adic spaces in non-noetherian settings.
We choose the setting of sous-
perfectoid adic spaces as deﬁned by Hansen-Kedlaya, [HK20], cf. [SW20, Section 6.3]. Recall that
an adic space X is sous-perfectoid if it is analytic and admits an open cover by U = Spa(R, R+)
where each R is a sous-perfectoid Tate algebra, meaning that there is some perfectoid R-algebra eR
such that R →eR is a split injection in the category of topological R-modules.
The class of sous-perfectoid rings R is stable under passage to rational localizations, ﬁnite ´etale
maps, and R⟨T1, . . . , Tn⟩. As smooth maps should be built from these basic examples, we can hope
for a good theory of smooth maps of sous-perfectoid spaces.
Recall that a map f : Y →X of sous-perfectoid adic spaces is ´etale if locally on the source and
target it can be written as an open immersion followed by a ﬁnite ´etale map.
Definition IV.4.8. Let f : Y →X be a map of sous-perfectoid adic spaces. Then f is smooth
if one can cover Y by open subsets V ⊂Y such that there are ´etale maps V →Bd
X for some integer
d ≥0.
It can immediately be checked that analytiﬁcations of smooth schemes satisfy this condition.
Proposition IV.4.9. Let X = Spa(A, A+) be an aﬃnoid sous-perfectoid adic space, and let
f0 : Y0 →Spec A be a smooth map of schemes. Let f : Y →X be the analytiﬁcation of f0 : Y0 →
Spec A, representing the functor taking Spa(B, B+) →Spa(A, A+) to the Spec B-valued points of
Y0 →Spec A. Then f : Y →X is smooth.
Proof. Locally, f0 is the composite of an ´etale and the projection from aﬃne space. This
means that its analytiﬁcation is locally ´etale over the projection from the analytiﬁcation of aﬃne
space, which is a union of balls, giving the result.
□
Let us analyze some basic properties of smooth maps of sous-perfectoid adic spaces.
Proposition IV.4.10. Let f : Y →X and g : Z →Y be maps of sous-perfectoid adic
spaces.
(i) The property of f being smooth is local on Y .

136
IV. GEOMETRY OF DIAMONDS
(ii) If f and g are smooth, then so is f ◦g : Z →X.
(iii) If h : X′ →X is any map of sous-perfectoid adic spaces and f is smooth, then the ﬁbre product
Y ′ = Y ×X X′ in adic spaces exists, is sous-perfectoid, and f′ : Y ′ →X′ is smooth.
(iv) The map f is universally open.
(v) If f is surjective, then there is some ´etale cover X′ →X with a lift X′ →Y .
Regarding part (1), we note that we will see in Proposition IV.4.18 that the property of f being
smooth is in fact ´etale local on Y (and thus smooth local on X and Y , using (5)).
Proof. Part (1) is clear from the deﬁnition. For part (2), the composite is locally a composite
of an ´etale map, a projection from a ball, an ´etale map, and another projection from a ball; but we
can swap the two middle maps, and use that composites of ´etale maps are ´etale. Part (3) is again
clear, by the stability properties of sous-perfectoid rings mentioned above. For part (4), it is now
enough to see that f is open, and we can assume that f is a composite of an ´etale map and the
projection from a ball, both of which are open. For part (5), using that f is open, we can work
locally on Y and thus assume again that it is a composite of an ´etale map and the projection from
a ball; we can then replace Y by its open image in the ball. By [Sch17a, Lemma 9.5], for any
geometric point Spa(C, C+) →X of X, we can ﬁnd a lift to Y . Writing the geometric point as
the limit of aﬃnoid ´etale neighborhoods, the map to Y ⊂Bd
X can be approximated at some ﬁnite
stage, and then openness of Y ensures that it will still lie in Y . This gives the desired ´etale cover
of X over which f splits.
□
Of course, the most important structure of a smooth morphism is its module of K¨ahler diﬀer-
entials. Recall that if Y is sous-perfectoid, then one can deﬁne a stack (for the ´etale topology) of
vector bundles on Y , such that for Y = Spa(R, R+) aﬃnoid with R sous-perfectoid, the category
of vector bundles is equivalent to the category of ﬁnite projective R-modules; see [KL15], [SW20,
Theorem 5.2.8, Proposition 6.3.4]. By deﬁnition, a vector bundle on Y is an OY -module that is
locally free of ﬁnite rank.
Definition IV.4.11. Let f : Y →X be a smooth map of sous-perfectoid adic spaces, with
diagonal ∆f : Y →Y ×X Y . Let IY/X ⊂OY ×XY be the ideal sheaf. Then
Ω1
Y/X := IY/X/I2
Y/X
considered as OY ×XY /IY/X = OY -module.
It follows from the deﬁnition that there is a canonical OX-linear derivation d : OY →Ω1
Y/X,
given by g 7→g ⊗1 −1 ⊗g.
Proposition IV.4.12. Let f : Y →X be a smooth map of sous-perfectoid adic spaces. Then
Ω1
Y/X is a vector bundle on Y . There is a unique open and closed decomposition Y = Y0⊔Y1⊔. . .⊔Yn
such that Ω1
Y/X|Yd is of rank d for all d = 0, . . . , n. In that case, for any nonempty open subset
V ⊂Yd with an ´etale map V →Bd′
X, necessarily d′ = d.
We will say that f is smooth of dimension d if Ω1
Y/X is of rank d. By the proposition, this is
equivalent to asking that Y can be covered by open subsets V that admit ´etale maps V →Bd
X. In
particular, f is smooth of dimension 0 if and only if it is ´etale.

IV.4. A JACOBIAN CRITERION
137
Proof. It is enough to show that if f is a composite of an ´etale map Y →Bd
X with the
projection to X, then Ω1
Y/X is isomorphic to Od
Y . Indeed, this implies that Ω1
Y/X is a vector bundle
in general, of the expected rank; and the decomposition into open and closed pieces is then a general
property of vector bundles.
Let Y ′ = Bd
X. Then Y ×X Y →Y ′ ×X Y ′ is ´etale, and the map Y →Y ′ ×Y ′×XY ′ (Y ×X Y ) is
an open immersion (as the diagonal of the ´etale map Y →Y ′). It follows that IY/X is the pullback
of IY ′/X′. But Y ′ ,→Y ′ ×X Y ′ is of the form
Spa(R⟨T1, . . . , Tn⟩, R+⟨T1, . . . , Tn⟩) ,→Spa(R⟨T (1)
1 , . . . , T (1)
n , T (2)
1 , . . . , T (2)
n ⟩, R+⟨T (1)
1 , . . . , T (2)
n ⟩)
if X = Spa(R, R+), and the ideal sheaf is given by (T (1)
1
−T (2)
1 , . . . , T (1)
n
−T (2)
n ). This deﬁnes a
regular sequence after any ´etale localization, by the lemma below. This gives the claim.
□
Lemma IV.4.13. Let X = Spa(R⟨T1, . . . , Tn⟩, R+⟨T1, . . . , Tn⟩) where R is a sous-perfectoid Tate
ring, let Y = Spa(S, S+) where S is a sous-perfectoid Tate ring, and let f : Y →X be a smooth
map. Then T1, . . . , Tn deﬁne a regular sequence on S and (T1, . . . , Tn)S ⊂S is a closed ideal.
Proof. By induction, one can reduce to the case n = 1. The claim can be checked locally, so
we can assume that Y is ´etale over Bd
X for some d; replacing X by Bd
X, we can then assume that f is
´etale. Let Y0 ⊂Y be the base change to X0 = Spa(R, R+) = V (T) ⊂X; then Y and Y0 ×X0 X are
both ´etale over X and become isomorphic over X0 ⊂X. By spreading of ´etale maps, this implies
that they are isomorphic after base change to X′ = Spa(R⟨T ′⟩, R+⟨T ′⟩) where T ′ = ϖnT for some
n (and ϖ is a pseudouniformizer of R). This easily implies the result.
□
Locally around a section, any smooth space is a ball:
Lemma IV.4.14. Let f : Y →X be a smooth map of sous-perfectoid spaces with a section
s : Spa(K, K+) →Y for some point Spa(K, K+) →X. Then there are open neighborhoods U ⊂X
of Spa(K, K+) and V ⊂Y of s(Spa(K, K+)) such that U ∼= Bd
V .
Proof. We can assume that X and Y are aﬃnoid. If f is ´etale, then any section extends to a
small neighborhood (e.g. by [Sch17a, Lemma 15.6, Lemma 12.17]), and any section is necessarily
´etale and thus open, giving the result in that case. In general, we may work locally around the given
section, so we can assume that f is the composite of an ´etale map Y →Bd
X and the projection to X.
Using the ´etale case already handled, we can assume that Y is an open subset of Bd
X. Any section
Spa(K, K+) →Bd
X has a coﬁnal system of neighborhoods that are small balls over open subsets
of X: The section is given by d elements T1, . . . , Td ∈K+, and after picking a pseudouniformizer
ϖ and shrinking X, one can ﬁnd global sections T ′
1, . . . , T ′
d of O+
X(X) such that Ti ≡T ′
i mod ϖn.
Then {|T ′
1|, . . . , |T ′
d| ≤|ϖ|n} is a small ball over X, and the intersection of all these is Spa(K, K+).
Thus, one of these neighborhoods is contained in Y , as desired.
□
Proposition IV.4.15. Let fi : Yi →X, i = 1, 2, be smooth maps of sous-perfectoid adic spaces,
and let g : Y1 →Y2 be a map over X.
(i) If g is smooth, then the sequence
0 →g∗Ω1
Y2/X →Ω1
Y1/X →Ω1
Y1/Y2 →0
is exact.

138
IV. GEOMETRY OF DIAMONDS
(ii) Conversely, if g∗Ω1
Y2/X →Ω1
Y1/X is a locally split injection, then g is smooth.
In particular, if g∗Ω1
Y2/X →Ω1
Y1/X is an isomorphism, then g is ´etale.
Proof. Part (1) follows from a routine reduction to the case of projections from balls, where
it is clear.
For part (2), we may assume that Y1 →Bd1
X and Y2 →Bd2
X are ´etale.
It suﬃces
to see that the composite Y1 →Y2 →Bd2
X is smooth, as g is the composite of its base change
Y1 ×Bd2
X Y2 →Y2 with the section Y1 →Y1 ×Bd2
X Y2 of the ´etale map Y1 ×Bd2
X Y2 →Y1; any such
section is automatically itself ´etale. Thus, we may assume that Y2 = Bd2
X . Locally on Y1, we may
ﬁnd a projection g′ : Bd1
X →Bd1−d2
X
so that
(g′∗Ω1
Bd1−d2
X
/X)|Y1
is an orthogonal complement of g∗Ω1
Y2/X. Thus, we can assume that d1 = d2 =: d, and g∗Ω1
Y2/X →
Ω1
Y1/X is an isomorphism.
Our aim is now to prove that g : Y1 →Y2 = Bd
X is ´etale. We may assume that all of X, Y1 and
Y2 are aﬃnoid. Passing to the ﬁbre over a point S = Spa(K, K+) →X, this follows from a result of
Huber, [Hub96, Proposition 1.6.9 (iii)]. The resulting ´etale map Y1,S →Y2,S deforms uniquely to
a quasicompact separated ´etale map Y ′
1,U →Y2,U for a small enough neighborhood U ⊂X of S, by
[Sch17a, Lemma 12.17]. Moreover, the map Y1,U →Y2,U lifts uniquely to Y1,U →Y ′
1,U for U small
enough, by the same result. Replacing X by U, Y1 by Y1,U and Y2 by Y ′
1,U, we can now assume
that g : Y1 →Y2 is a map between sous-perfectoid spaces smooth over X that is an isomorphism
on one ﬁbre. It is enough to see that it is then an isomorphism in a neighborhood. To see this, we
may in fact work locally on Y2.
For this, we study Y1 ⊂Y1 ×X Y2 →Y2: Here Y1 ×X Y2 →Y2 is smooth, and Y1 ⊂Y1 ×X Y2
is locally the vanishing locus of d functions (as Y2 ⊂Y2 ×X Y2 is). Moreover, over ﬁbres lying over
the given point of X, the map Y1 →Y2 becomes an isomorphism, and in particular gives a section
of Y1 ×X Y2 →Y2. By Lemma IV.4.14, after shrinking Y2, we can assume that there is an open
neighborhood V ⊂Y1 ×X Y2 such that V ∼= Bd
Y2. Inside there, Y1 is (locally) given by the vanishing
of d functions, and is only a point in one ﬁbre. Now the result follows from the next lemma, using
Y2 in place of X.
□
Lemma IV.4.16. Let X = Spa(A, A+) be a sous-perfectoid aﬃnoid adic space with a point
X′ = Spa(K, K+) →X. Let f1, . . . , fn ∈A+⟨T1, . . . , Tn⟩be functions such that
K →K⟨T1, . . . , Tn⟩/(f1, . . . , fn)
is an isomorphism. Then, after replacing X by an open neighborhood of X′, the map
A →A⟨T1, . . . , Tn⟩/(f1, . . . , fn)
is an isomorphism.
Proof. For any ring B with elements g1, . . . , gn ∈B, consider the homological Koszul complex
Kos(B, (gi)n
i=1) = [B →Bn →. . . →Bn (g1,...,gn)
−−−−−−→B].

IV.4. A JACOBIAN CRITERION
139
We claim that, after shrinking X, we can in fact arrange that
A →Kos(A⟨T1, . . . , Tn⟩, (fi)n
i=1)
is a quasi-isomorphism.
Note that all terms of these complexes are free Banach-A-modules, and thus the formation of
this complex commutes with all base changes; and one can use descent to establish the statement.
In particular, we can reduce ﬁrst to the case that X is perfectoid, and then to the case that
X is strictly totally disconnected.
In that case, the map A →K is automatically surjective,
and so we can arrange that under the isomorphism K ∼= K⟨T1, . . . , Tn⟩/(f1, . . . , fn), all Ti are
mapped to 0. Moreover, applying another change of basis, we can arrange that the image of fi
in K⟨T1, . . . , Tn⟩/(T1, . . . , Tn)2 is given by aiTi for some nonzero scalar ai ∈K+. Note that we
are in fact allowed to also localize on Bn
X around the origin, as away from the origin the functions
f1, . . . , fn locally generate the unit ideal (in the ﬁbre, but thus in a small neighborhood). Doing
such a localization, we can now arrange that fi ≡Ti mod ϖ for some pseudouniformizer ϖ ∈A+.
But now in fact
A+ →Kos(A+⟨T1, . . . , Tn⟩, (fi)n
i=1)
is a quasi-isomorphism, as can be checked modulo ϖ, where it is the quasi-isomorphism
A+/ϖ →Kos(A+/ϖ[T1, . . . , Tn], (Ti)n
i=1).
□
Let us draw some consequences. First, we have the following form of the Jacobian criterion in
this setting.
Proposition IV.4.17. Let f : Y →X be a smooth map of sous-perfectoid adic spaces, and let
f1, . . . , fr ∈OY (Y ) be global functions such that df1, . . . , dfr ∈Ω1
Y/X(Y ) can locally be extended to
a basis of Ω1
Y/X. Then Z = V (f1, . . . , fr) ⊂Y is a sous-perfectoid space smooth over X.
Proof. We can assume that all fi ∈O+
Y (Y ) by rescaling, and we can locally ﬁnd fr+1, . . . , fn ∈
O+
Y (Y ) such that df1, . . . , dfn is a basis of Ω1
Y/X. This induces an ´etale map Y →Bn
X, and then
V (f1, . . . , fr) ⊂Y is the pullback of Br
X ⊂Bn
X, giving the desired result.
□
Moreover, we can prove that being smooth is ´etale local on the source.
Proposition IV.4.18. Let f : Y →X be a map of sous-perfectoid adic spaces. Assume that
there is some ´etale cover j : V →Y such that f ◦j is smooth. Then f is smooth.
Proof. By ´etale descent of vector bundles on sous-perfectoid adic spaces, Ω1
Y/X := IY/X/I2
Y/X
is a vector bundle, together with an OX-linear derivation d : OY →Ω1
Y/X. We claim that locally
we can ﬁnd functions f1, . . . , fn ∈OY such that df1, . . . , dfn ∈Ω1
Y/X is a basis. To do this, it
suﬃces to ﬁnd such functions over all ﬁbres Spa(K, K+) →X, as any approximation will then still
be a basis (small perturbations of a basis are still a basis). But over ﬁbres, the equivalence of the
constructions in [Hub96, 1.6.2] shows that the df for f ∈OX form generators of Ω1
Y/X.
Thus, assume that there are global sections f1, . . . , fn such that df1, . . . , dfn ∈Ω1
Y/X are a
basis. Rescaling the fi if necessary, they deﬁne a map g : Y →Bd
X that induces an isomorphism

140
IV. GEOMETRY OF DIAMONDS
g∗Ω1
Bd
X/X →Ω1
Y/X. By Proposition IV.4.15, the map Y →Bd
X is ´etale locally on Y ´etale. We may
assume that Y and X are aﬃnoid; in particular, all maps are separated. Then by [Sch17a, Lemma
15.6, Proposition 11.30] also Y →Bd
X is ´etale.
□
Finally, we note that if Y and Y ′ are both smooth over a sous-perfectoid space X, then the
concept of Zariski closed immersions Y ,→Y ′ over X is well-behaved.
Proposition IV.4.19. Let f : Y →X, f′ : Y ′ →X be smooth maps of sous-perfectoid adic
spaces, and let g : Y →Y ′ be a map over X. The following conditions are equivalent.
(i) There is a cover of Y ′ by open aﬃnoid V ′ = Spa(S′, S′+) such that V = Y ×Y ′ V ′ = Spa(S, S+)
is aﬃnoid and S′ →S is surjective, with S+ ⊂S the integral closure of the image of S′+.
(ii) For any open aﬃnoid V ′ = Spa(S′, S′+) ⊂Y ′, the preimage V = Y ×Y ′ V ′ = Spa(S, S+) is
aﬃnoid and S′ →S is surjective, with S+ ⊂S the integral closure of the image of S′+.
Moreover, in this case the ideal sheaf IY ⊂Y ′ ⊂OY ′ is pseudocoherent in the sense of [KL16],
and locally generated by sections f1, . . . , fr ∈OY ′ such that df1, . . . , dfr ∈Ω1
Y ′/X can locally be
extended to a basis.
Proof. We ﬁrst analyze the local structure under condition (1), so assume that Y ′ = Spa(S′, S′+)
and Y = Spa(S, S+) are aﬃnoid, with S′ →S surjective and S+ ⊂S the integral closure of the
image of S′+. It follows that g∗Ω1
Y ′/X →Ω1
Y/X is surjective, and letting d′ and d be the respective
dimensions of Y ′ and Y (which we may assume to be constant), we see that r = d′ −d ≥0 and that
locally we can ﬁnd f1, . . . , fr ∈IY ⊂Y ′ so that df1, . . . , dfr generate the kernel of g∗Ω1
Y ′/X →Ω1
Y/X
(as the kernel is generated by the closure of the image of IY ⊂Y ′). By Proposition IV.4.17, the van-
ishing locus of the fi deﬁnes a sous-perfectoid space Z ⊂Y ′ that is smooth over X. The induced
map Y →Z induces an isomorphism on diﬀerentials, hence is ´etale by Proposition IV.4.15; but it
is also a closed immersion, hence locally an isomorphism.
We see that the ideal sheaf IY ⊂Y ′ is locally generated by sections f1, . . . , fr as in the statement
of the proposition. By the proof of Proposition IV.4.17 and Lemma IV.4.13, it follows that the
ideal sheaf IY ⊂Y ′ is pseudocoherent in the sense of [KL16].
To ﬁnish the proof, it suﬃces to show that (1) implies (2). By the gluing result for pseudocoher-
ent modules of [KL16], the pseudocoherent sheaf IY ⊂Y ′ over V ′ corresponds to a pseudocoherent
module I ⊂S′, and then necessarily V = Spa(S, S+) where S = S′/I with S+ ⊂S the integral
closure of the image of S′+.
□
Definition IV.4.20. In the setup of Proposition IV.4.19, the map g is a Zariski closed immer-
sion if the equivalent conditions are satisﬁed.
IV.4.2. Maps from XS into Pn. Our arguments make critical use of the assumption that in
Theorem IV.4.2, the space Z →XS is locally closed in Pn
XS. For this reason, we analyze the special
case of Pn in this section.
Proposition IV.4.21. Let n ≥0 and consider the small v-sheaf MPn taking any perfectoid
space S to the set of maps XS →Pn
E. Then MPn →∗is partially proper and representable in

IV.4. A JACOBIAN CRITERION
141
locally spatial diamonds, and admits a decomposition into open and closed subspaces
MPn =
G
m≥0
Mm
Pn
such that each Mm
Pn →∗has ﬁnite dim. trg, and the degree of the pullback of OPn(1) to XMm
Pn is
m. In fact, there is a canonical open immersion
Mm
Pn ,→(BC(O(m)n+1) \ {0})/E×.
Proof. The degree of the pullback L/XS of OPn(1) to XS deﬁnes an open and closed decom-
position according to all m ∈Z. Fix some m. Then over the corresponding subspace Mm
Pn, we
can ﬁx a trivialization L ∼= OXS(m), which amounts to an E×-torsor. After this trivialization,
one parametrizes n + 1 sections of L ∼= OXS(m) without common zeroes. The condition of no
common zeroes is an open condition on S: Indeed, the common zeroes form a closed subspace of
|XS|, and the map |XS| →|S| is closed (see the proof of Lemma IV.1.20). This implies the desired
description.
□
Proposition IV.4.22. Let S be a perfectoid space and let Z →XS be a smooth map of sous-
perfectoid adic spaces such that Z admits a Zariski closed embedding into an open subspace of Pn
XS.
Then the induced functor
MZ →MPn
XS
is locally closed. More precisely, for any perfectoid space T →MPn
XS , the preimage of MZ is
representable by some perfectoid space TZ ⊂T that is ´etale locally Zariski closed in T, i.e. there
is some ´etale cover of T by aﬃnoid perfectoid T ′ = Spa(R, R+) →T such that TZ ×T T ′ =
Spa(RZ, R+
Z) is aﬃnoid perfectoid, with R →RZ surjective and R+
Z ⊂RZ the integral closure of
the image of R+.
In particular, the map MZ →S is representable in locally spatial diamonds and compactiﬁable,
of locally ﬁnite dim. trg.
Proof. Choose an open subspace W ⊂Pn
XS such that Z is Zariski closed in W. For any
perfectoid space T with a map T →MPn
XS corresponding to a map XT →Pn
XS over XS, the locus
TW ⊂T where the section factors over W is open. Indeed, this locus is the complement of the
image in |T| of the preimage of |Pn
XS \ W| under |XT | →|Pn
XS|, and |XT | →|T| is closed.
Replacing T by TW , we can assume that the section XT →Pn
XS factors over W. We may also
assume that T = Spa(R, R+) is aﬃnoid perfectoid and that S = T. Pick a pseudouniformizer
ϖ ∈R, in particular deﬁning the cover
YS,[1,q] = {|π|q ≤|[ϖ]| ≤|π|} ⊂Spa WOE(R+)
of XS. The pullback of the line bundle OPn(1) to XS along this section, and then to YS,[1,q], is ´etale
locally trivial, as when S is a geometric point, YS,[1,q] is aﬃnoid with ring of functions a principal
ideal domain by Corollary II.1.12. Replacing W by a small ´etale neighborhood of this section and
correspondingly shrinking S, we can assume that the pullback of OPn(1) to W[1,q] = W ×XS YS,[1,q]
is trivial. In that case the pullback Z[1,q] →YS,[1,q] of Z →XS is Zariski closed in an open subset
of
An+1
YS,[1,q].

142
IV. GEOMETRY OF DIAMONDS
Inside An+1
YS,[1,q], the image of YSpa(K,K+),[1,q] (via the given section) for a point Spa(K, K+) →S is
an intersection of small balls over YS′,[1,q] for small neighborhoods S′ ⊂S of Spa(K, K+). Thus,
one of these balls is contained in the open subset of which Z[1,q] is a Zariski closed subset. Thus,
after this further localization, we can assume that there is a Zariski closed immersion
Z[1,q] ,→Bn+1
YS,[1,q],
and in particular Z[1,q] is aﬃnoid and cut out by global functions on Bn+1
YS,[1,q] by Proposition IV.4.19.
Pulling back these functions along the given section YS,[1,q] →Bn+1
YS,[1,q], it suﬃces to see that if
S = Spa(R, R+) is an aﬃnoid perfectoid space of characteristic p with a choice of pseudouniformizer
ϖ ∈R and
f ∈BR,[1,q] = O(YS,[1,q])
is a function, then there is a universal perfectoid space S′ ⊂S for which the pullback of f is zero,
and S′ ⊂S is Zariski closed. This is given by Lemma IV.4.23.
□
Lemma IV.4.23. Let S = Spa(R, R+) ∈PerfFq be aﬃnoid perfectoid with a ﬁxed pseudo-
uniformizer ϖ, I ⊂(0, ∞) a compact interval with rational ends, and Z ⊂|YS,I| a closed subset
deﬁned by the vanishing locus of an ideal J ⊂O(YS,I). Then, via the open projection υ : |YS,I| →|S|,
the closed subset |S| \ υ(|YS,I| \ Z) is Zariski closed. The corresponding Zariski closed perfectoid
subspace of S is universal for perfectoid spaces T →S such that J 7→0 via O(YS,I) →O(YT,I).
Proof. Since Y ♦
S,I →S is cohomologically smooth, υ is open. We can suppose J = (f) with
f ∈O(YS,I). For any untilt of Fq((ϖ1/p∞)) over E such that |π|b ≤|[ϖ♯]| ≤|π|a if I = [a, b], we get
a corresponding untilt R♯of R over E, with a map BR,I →R♯. The locus where the image of f
in R♯vanishes is Zariski closed by Proposition II.0.2. Intersecting these Zariski closed subsets over
varying such untilts gives the vanishing locus of f, as in any ﬁbre, f vanishes as soon at it vanishes
at inﬁnitely many untilts (e.g., by Corollary II.1.12), and all rings are sous-perfectoid, in particular
uniform, so vanishing at all points implies vanishing.
□
IV.4.3. Formal smoothness of Msm
Z . The key result we need is the following.
Proposition IV.4.24. Let S = Spa(R, R+) be an aﬃnoid perfectoid space over Fq and let
Z →XS be a smooth map of sous-perfectoid adic spaces that is Zariski closed in an open subspace
of Pn
XS. Then Msm
Z →S is formally smooth.
Proof. Pick a test diagram as in Deﬁnition IV.3.1; we can and do assume that the S from
there is the given S, replacing the S in this proposition if necessary. This means we have a diagram
Z
XS0
XS
s0
and, up to replacing S by an ´etale neighborhood of S0 we try to extend the section s0 to a section
over XS (the dotted line in the diagram). Fix a geometric point Spa(C, C+) →S0; we will always

IV.4. A JACOBIAN CRITERION
143
allow ourselves to pass to ´etale neighborhoods of this point. Fix a pseudouniformizer ϖ ∈R and
consider the aﬃnoid cover YS,[1,q] →XS; recall that
YS,[1,q] = {|π|q ≤|[ϖ]| ≤|π|} ⊂Spa WOE(R+)
and we also consider its boundary annuli
YS,[1,1] = {|[ϖ]| = |π|}, YS,[q,q] = {|π|q = |[ϖ]|} ⊂YS,[1,q].
Let Z[1,q] →Z be its pullback; with pullback Z[1,1], Z[q,q] ⊂Z[1,q] of YS,[1,1], YS,[q,q] ⊂YS,[1,q]. In
particular, Z is obtained from Z[1,q] via identiﬁcation of its open subsets Z[1,1], Z[q,q] along the
isomorphism ϕ : Z[1,1] →Z[q,q].
Arguing as in the proof of Proposition IV.4.22, we can after ´etale localization on S embed
Z[1,q] ,→Bn+1
YS,[1,q]
as a Zariski closed subset. We thus have a diagram
Z[1,q]
Bn+1
YS,[1,q]
YS0,[1,q]
YS,[1,q].
Zariski closed
In particular, Z[1,q] is aﬃnoid.
Next, consider the K¨ahler diﬀerentials Ω1
Z[1,q]/YS,[1,q].
Again, as BC,[1,q] is a principal ideal
domain, its restriction to the section YSpa(C,C+),[1,q] ⊂Z[1,q] is trivial, and thus it is trivial in a small
neighborhood. It follows that after a further ´etale localization we can assume that Ω1
Z[1,q]/YS,[1,q] ∼=
Or
Z[1,q] is trivial. On the Zariski closed subset Z0,[1,q] ⊂Z[1,q], this implies that we may ﬁnd functions
f1, . . . , fr ∈O(Z0,[1,q]) vanishing on the section YS0,[1,q] →Z0,[1,q] and locally generating the ideal
of this closed immersion (use Proposition IV.4.19). In particular,
df1, . . . , dfr ∈Ω1
Z0,[1,q]/YS0,[1,q]
are generators at the image of the section YS0,[1,q] →Z0,[1,q], and thus in an open neighborhood.
Picking lifts of the fi to O(Z[1,q]) and shrinking Z[1,q], Proposition IV.4.15 implies that they deﬁne
an ´etale map
Z[1,q] →Br
YS,[1,q].
Moreover, over {0}YS0,[1,q] ⊂Br
YS,[1,q], this map admits a section. Shrinking further around this
section, we can thus arrange that there are open immersions
(πNB)r
YS,[1,q] ⊂Z[1,q] ⊂Br
YS,[1,q],
and that the section over YS0,[1,q] is given by the zero section.
The isomorphism ϕ : Z[1,1] →Z[q,q] induces a map
ϕ′ : (πNB)r
YS,[1,1] →Br
YS,[q,q].
Recall that for any compact interval I ⊂(0, ∞), the space
YS,I = Spa(BR,I, B+
(R,R+),I)

144
IV. GEOMETRY OF DIAMONDS
is aﬃnoid. The map ϕ′ is then given by a map
α : BR,[q,q]⟨T1, . . . , Tr⟩→BR,[1,1]⟨π−NT1, . . . , π−NTr⟩
linear over the isomorphism ϕ : BR,[q,q] →BR,[1,1]. The map α is determined by the images of
T1, . . . , Tn which are elements
αi ∈B+
(R,R+),[1,1]⟨π−NT1, . . . , π−NTr⟩.
These have the property that on the quotient BR0,[1,1] they vanish at T1 = . . . = Tr = 0 (as over
S0, the zero section is ϕ-invariant). Moreover, over the geometric point Spa(C, C+) →S0 ﬁxed at
the beginning, we can apply a linear change of coordinates in order to ensure that the derivative
at the origin is given by a standard matrix for an isocrystal of negative slopes; i.e., there are cycles
1, . . . , r1; r1 + 1, . . . , r2; . . .; ra−1 + 1, . . . , ra = r and positive integers d1, . . . , da such that
αi ≡Ti+1 in BC,[1,1][T1, . . . , Tr]/(T1, . . . , Tr)2
if i ̸= rj for some j = 1, . . . , a, and
αrj ≡π−djTrj−1+1 in BC,[1,1][T1, . . . , Tr]/(T1, . . . , Tr)2.
(Here, we set r0 = 0.) Approximating this linear change of basis over an ´etale neighborhood, we
respect the condition that the αi’s vanish at T1 = . . . = Tr = 0 over S0, while we can for any large
M arrange
αi ≡Ti+1 in B+
(R,R+),[1,1]/πM[π−NT1, . . . , π−NTr]/(π−NT1, . . . , π−NTr)2
if i ̸= rj and
αrj ≡π−djTrj−1+1 in B+
(R,R+),[1,1]/πM[π−NT1, . . . , π−NTr]/(π−NT1, . . . , π−NTr)2.
Moreover, rescaling all Ti by powers of π, and passing to a smaller neighborhood around S0, we
can then even ensure that
αi ∈Ti+1 + πMB+
(R,R+),[1,1]⟨T1, . . . , Tr⟩
for i ̸= rj and
αrj ∈π−djTrj−1+1 + πMB+
(R,R+),[1,1]⟨T1, . . . , Tr⟩.
At this point, the integers d1, . . . , da are ﬁxed, while we allow ourselves to choose M later, depending
only on these.
From this point on, we will no longer change S and S0, and instead will merely change coordi-
nates in the balls (by automorphisms). More precisely, we study the eﬀect of replacing Ti by Ti +ϵi
for some
ϵi ∈πd ker(B+
(R,R+),[1,q] →BR0,[1,q])
where we take d to be at least the maximum of all dj. This replaces αi by a new power series α′
i,
given by
α′
i(T1, . . . , Tr) = αi(T1, . . . , Ti + ϵi, . . . , Tr) −ϕ(ϵi)
and the α′
i’s still vanish at T1 = . . . = Tr = 0 over S0. Their nonconstant coeﬃcients will still have
the same properties as for αi (the linear coeﬃcients are unchanged, while all other coeﬃcients are
divisible by πM), and the constant coeﬃcient satisﬁes
α′
i(0, . . . , 0) ≡αi(0, . . . , 0) + ϵi+1 −ϕ(ϵi) in B+
(R,R+),[1,1]/πM+d

IV.4. A JACOBIAN CRITERION
145
if i ̸= rj and
α′
rj(0, . . . , 0) ≡αrj(0, . . . , 0) + π−djϵrj−1+1 −ϕ(ϵrj) in B+
(R,R+),[1,1]/πM+d.
Assume that by some inductive procedure we already achieved αi(0, . . . , 0) ∈πN′B+
(R,R+),[1,1] for
some N′ ≥M. By Lemma IV.4.25 below, there is some constant c depending only on d1, . . . , da
such that we can then ﬁnd ϵi ∈πN′−cB+
(R,R+),[1,1], vanishing over R0, with
αi(0, . . . , 0) = ϕ(ϵi) −ϵi+1
for i ̸= rj and
αrj(0, . . . , 0) = ϕ(ϵrj) −π−djϵrj−1+1.
This means that α′
i(0, . . . , 0) ∈πM+N′−cB+
(R,R+),[1,1], so if we choose M > c in the beginning (which
we can), then this inductive procedure converges, and in the limit we get a change of basis after
which the zero section deﬁnes a ϕ-invariant section of Z[1,q], thus a section s : XS →Z, as desired.
Note that we arranged that this section agrees with s0 over S0, as all coordinate changes did not
aﬀect the situation over S0.
□
We used the following quantitative version of vanishing of H1(XS, E) for E of positive slopes.
Lemma IV.4.25. Fix a standard Dieudonn´e module of negative slopes, given explicitly on a
basis e1, . . . , er by ﬁxing cycles 1, . . . , r1; r1 +1 . . . , r2; . . .; ra−1 +1, . . . , ra = r and positive integers
d1, . . . , da > 0, via
ϕ(ei) = ei+1 for i ̸= rj, ϕ(erj) = π−djerj−1+1.
Then there is an integer c ≥0 with the following property.
Let S = Spa(R, R+) be an aﬃnoid perfectoid space over Fq with Zariski closed subspace S0 =
Spa(R0, R+
0 ), and a pseudouniformizer ϖ ∈R. Let
I+
[1,q] = ker(B+
(R,R+),[1,q] →B+
(R0,R+
0 ),[1,q]), I+
[1,1] = ker(B+
(R,R+),[1,1] →B+
(R0,R+
0 ),[1,1]).
Then for all f1, . . . , fr ∈I+
[1,1] one can ﬁnd g1, . . . , gr ∈π−cI+
[1,q] such that
fi = ϕ(gi) −gi+1 for i ̸= rj, frj = ϕ(grj) −π−djgrj−1+1.
Proof. We may evidently assume that a = 1; set d = d1. By linearity, we can assume that all
but one of the fi’s is equal to zero. Thus, it suﬃces to see that for all positive integers r and N
there is c ≥0 such that for all f ∈I+
[1,1] one can ﬁnd some g ∈π−cI+
[1,qr] (for the evident deﬁnition
of I+
[1,qr]) such that
f = ϕr(g) −π−dg.
Replacing E by its unramiﬁed extension of degree r, we can then assume that r = 1. At this point,
we want to reduce to the qualitative version given by Lemma IV.4.26 below, saying that the map
ϕ −π−d : I[1,q] →I[1,1]
is surjective. Indeed, assume a constant c as desired would not exist. Then for any integer i ≥0 we
can ﬁnd some Zariski closed immersion S0,i = Spa(R0,i, R+
0,i) ⊂Si = Spa(Ri, R+
i ), with choices of
pseudouniformizers ϖi ∈Ri, as well as elements fi ∈I+
[1,1],i such that there is no g ∈π−2iI+
[1,q],i with

146
IV. GEOMETRY OF DIAMONDS
fi = ϕ(gi)−π−dgi. Then we can deﬁne R+ = Q
i R+
i with ϖ = (ϖi)i ∈R+, and R = R+[ 1
ϖ], which
deﬁnes an aﬃnoid perfectoid space S = Spa(R, R+), containing a Zariski closed subspace S0 ⊂S
deﬁned similarly. Moreover, the sequence (πifi)i deﬁnes an element of f ∈I+
[1,1]. As ϕ −π−d :
I[1,q] →I[1,1] is surjective by Lemma IV.4.26, we can ﬁnd some g ∈I[1,q] with f = ϕ(g)−π−dg. Then
πcg ∈I+
[1,q] for some c, and restricting g to S0,i ⊂Si with i > c gives the desired contradiction.
□
We reduced to the following qualitative version.
Lemma IV.4.26. Let d be a positive integer, let S0 = Spa(R0, R+
0 ) ⊂S = Spa(R, R+) be a
Zariski closed immersion of aﬃnoid perfectoid spaces over Fq, and let ϖ ∈R be a pseudouni-
formizer. Let
I[1,q] = ker(BR,[1,q] →BR0,[1,q]) , I[1,1] = ker(BR,[1,1] →BR0,[1,1]).
Then the map
ϕ −π−d : I[1,q] →I[1,1]
is surjective.
Proof. By the snake lemma and the vanishing H1(XS, OXS(d)) = 0 (Proposition II.2.5 (iii)),
the lemma is equivalent to the surjectivity of
H0(XS, OXS(d)) →H0(XS0, OXS0(d)).
For d ≤[E : Qp] (or if E is of equal characteristic), this follows directly from Proposition II.2.5 (iv)
and the surjectivity of R◦◦→R◦◦
0 .
In general, we can either note that the proof of Proposi-
tion II.2.5 (iii) also proves the lemma, or argue by induction by choosing an exact sequence
0 →OXS(d −2) →OXS(d −1)2 →OXS(d) →0
(the Koszul complex for two linearly independent sections of H0(XS, OXS(1))), and use the van-
ishing of H1(XS0, OXS0(d −2)) = 0 for d > 2, Proposition II.2.5 (iii). This induction gets started
as long as E ̸= Qp. For E = Qp, we can write OXS(d) as a direct summand of π∗π∗OXS(d) for any
extension π : XS,E →XS with E ̸= Qp.
□
IV.4.4. Universal local acyclicity of Msm
Z
→S. The next step in the proof of Theo-
rem IV.4.2 is to show that Fℓis universally locally acyclic.
Proposition IV.4.27. Let S be a perfectoid space and let Z →XS be a smooth map of sous-
perfectoid spaces such that Z is Zariski closed inside an open subset of Pn
XS for some n ≥0. Then,
for any ℓ̸= p, the sheaf Fℓis universally locally acyclic for the map
Msm
Z →S.
Proof. Recall from Proposition IV.4.22 that MZ →MPn
XS is a locally closed immersion, and
the open embedding
MPn
XS ,→
G
m≥0
(BC(OXS(m)n+1) \ {0})/E×
from Proposition IV.4.21. In the following, we ﬁx some m and work on the preimage of
(BC(OXS(m)n+1) \ {0})/E×.

IV.4. A JACOBIAN CRITERION
147
We choose a surjection g : T →BC(OXS(m)n+1 \ {0})/E× from a perfectoid space T as in
Lemma IV.4.28; in particular, g is separated, representable in locally spatial diamonds, cohomo-
logically smooth, and formally smooth. Moreover, locally T admits a Zariski closed immersion into
the perfectoid ball eBn
S over S. Taking the pullback of T to MZ, we get a surjection TZ →MZ for
some perfectoid space TZ such that ´etale locally TZ admits a Zariski closed immersion into a space
´etale over eBn
S.
It follows that one can cover MZ via maps h0 : T0 →MZ that are separated, representable in
locally spatial diamonds, cohomologically smooth, and formally smooth, and such that T0 admits
a Zariski closed immersion into some space ´etale over eBn
S. We can then also do the same for Msm
Z .
By Proposition IV.4.24, we can, up to further replacement of T0 by an ´etale cover, assume that the
map h0 extends to a map h : T →Msm
Z
for some perfectoid space T ´etale over eBn
S. Moreover, as
T0 →Msm
Z is formally smooth, we can, after a further ´etale localization, lift the map T →Msm
Z to
a retraction T →T0; thus, T0 is a retract of a space that is ´etale over a perfectoid ball. Now the
result follows from Corollary IV.2.27.
□
We used the following presentation of certain projectivized Banach–Colmez spaces.
Lemma IV.4.28. Let S be a perfectoid space over Fq and let E be a vector bundle on XS that is
everywhere of nonnegative Harder–Narasimhan slopes. There is a perfectoid space T →S that is
locally Zariski closed in a perfectoid ball eBn
S over S and that admits a surjective map
T →(BC(E) \ {0})/E×
over S that is separated, representable in locally spatial diamonds, cohomologically smooth, and
formally smooth.
Proof. The target parametrizes line bundles L on XS of slope zero together with a section of
E ⊗L that is nonzero ﬁbrewise on S. Parametrizing in addition an injection L ,→OXS(1) deﬁnes
a map that is separated, representable in locally spatial diamonds, cohomologically smooth, and
formally smooth (by Proposition II.3.5 and Proposition IV.3.8). Over this cover, one has locally
on S an untilt S♯over E corresponding to the support of the cokernel of L →OXS(1), and one
parametrizes nonzero sections of E(1) that vanish at S♯,→XS. This is Zariski closed (by [BS19,
Theorem 7.4, Remark 7.5]) inside the space of all sections of E(1). We see that it suﬃces to prove
the similar result with (BC(E) \ {0})/E× replaced by BC(E(1)) × Spd E, and this reduces to the
individual factors. For BC(E(1)), the result follows from the argument in Proposition IV.3.8. For
Spd E, there is nothing to do in equal characteristic, so assume that E is p-adic. Then we reduce
to [∗/O×
E] as the ﬁbres of Spd E →[∗/O×
E] over perfectoid spaces are given by BC(L) \ {0} for
some line bundle L of slope 1, and this in turn admits covers of the desired form. Finally, for
[∗/O×
E], we can pass to the ´etale cover [∗/1 + p2OE] ∼= [∗/OE], or to [∗/E]. This, ﬁnally, admits a
surjection from a perfectoid open unit disc BC(OXS(1)) with the desired properties by passing to
Banach–Colmez spaces in an exact sequence
0 →OXS →OXS(1
2) →OXS(1) →0
and using Proposition II.3.4.
□

148
IV. GEOMETRY OF DIAMONDS
IV.4.5. Deformation to the normal cone. The ﬁnal step in the proof of Theorem IV.4.2
is a deformation to the normal cone.
By Proposition IV.4.22 and Proposition IV.4.27 (and Proposition IV.2.33), in order to prove
Theorem IV.4.2 it only remains to prove that Rf!Fℓis invertible and sitting in the expected co-
homological degree. Picking a v-cover T →Msm
Z
by some perfectoid space T and using that the
formation of Rf!Fℓcommutes with any base change by Proposition IV.2.15, it suﬃces to prove the
following result.
Proposition IV.4.29. Let S be a perfectoid space and let Z →XS be a smooth map of sous-
perfectoid spaces such that Z admits a Zariski closed immersion into an open subset of (the adic
space) Pn
XS for some n ≥0. Let f : MZ →S be the moduli space of sections of Z →XS. Moreover,
let s : XS →Z be a section such that s∗TZ/XS is everywhere of positive Harder–Narasimhan slopes,
and of degree d.
Let t : S →MZ be the section of f corresponding to s. Then t∗Rf!Fℓis ´etale locally on S
isomorphic to Fℓ[2d].
Proof. We will prove this by deformation to the normal cone. In order to avoid a general
discussion of blow-ups etc., we will instead take an approach based on the local structure of Z near
a section as exhibited in the proof of Proposition IV.4.24.
We are free to make v-localizations on S (as being cohomologically smooth can be checked after
a v-cover), and replace Z by an open neighborhood of s(XS). With this freedom, we can follow the
proof of Proposition IV.4.24 and ensure that S = Spa(R, R+) is strictly totally disconnected with
pseudouniformizer ϖ, the pullback Z[1,q] →YS,[1,q] of Z →XS to
YS,[1,q] = {|π|q ≤|[ϖ]| ≤|π|} ⊂Spa WOE(R+)
satisﬁes
πNBr
YS,[1,q] ⊂Z[1,q] ⊂Br
YS,[1,q]
and the gluing isomorphism is given by power series
αi ∈Ti+1 + πMB+
(R,R+),[1,1]⟨T1, . . . , Tr⟩
resp.
αrj ∈π−djT rj−1+1 + πMB+
(R,R+),[1,1]⟨T1, . . . , Tr⟩
with notation following the proof of Proposition IV.4.24. Moreover, the constant coeﬃcients of all
αi vanish. These in fact deﬁne a map
ϕ : πdBr
YS,[1,1] →Br
YS,[q,q]
preserving the origin, where d is the maximum of the dj.
For any n ≥N, d, we can look at the subset
Z(n)
[1,q] = πnBr
YS,[1,q] ∪ϕ(πnBr
YS,[1,1]) ⊂Z[1,q],
which descends to an open subset Z(n) ⊂Z. Letting T (n)
i
= π−nTi, the gluing is then given by
power series α(n)
i
given by
α(n)
i
= π−nαi(πnT1, . . . , πnTn)

IV.4. A JACOBIAN CRITERION
149
which satisfy the same conditions, but the nonlinear coeﬃcients of α(n)
i
become more divisible by
π. The limit
α(∞)
i
= lim
−→
n→∞
α(n)
i
∈BR,[1,1]⟨T1, . . . , Tr⟩
exists, and is linear in the Ti.
Let S′ = S × N≥N ∪{∞}, using the proﬁnite set N≥N ∪{∞}. Let Z′ →XS′ be the smooth
map of sous-perfectoid spaces obtained by descending
Z′
[1,q] = Br
YS′,[1,q] ∪ϕ′(Br
YS′,[q,q])
along the isomorphism ϕ′ given by the power series
α′
i = (α(N)
i
, α(N+1)
i
, . . . , α(∞)
i
) ∈BR′,[1,1]⟨T1, . . . , Tr⟩.
Then the ﬁbre of Z′ →XS′ over S × {n} is given by Z(n), while its ﬁbre over S × {∞} is given
by an open subset Z(∞) of the Banach–Colmez space BC(s∗TZ/XS). Moreover, letting S′(>N) ⊂S′
be the complement of S × {N}, there is natural isomorphism γ : S′(>N) →S′ given by the shift
S × {n + 1} ∼= S × {n}, and this lifts to an open immersion
γ : Z′(>N) = Z′ ×XS′ XS′(>N) ,→Z′.
We need to check that Z′ →XS′ still satisﬁes the relevant quasiprojectivity assumption.
Lemma IV.4.30. The space Z′ →XS′ admits a Zariski closed immersion into an open subset
of Pm
XS′ for some m ≥0.
Proof. One may perform a parallel construction with Z replaced by an open subset of Pm
XS,
reducing us to the case that Z is open in Pm
XS. In that case, the key observation is that the blow-up
of Pm
XS at the section s : XS →Pm
XS is still projective, which is an easy consequence of XS admitting
enough line bundles.
□
Let f′ : MZ′ →S′ be the projection, with ﬁbres f(n) and f(∞). By Proposition IV.4.27, both
Fℓand Rf′!Fℓare f′-universally locally acyclic. In particular, the formation of Rf′!Fℓcommutes
with base change, and we see that the restriction of Rf′!Fℓto the ﬁbre over ∞is ´etale locally
isomorphic to Fℓ[2d], as an open subset of BC(s∗TZ/XS). As S is strictly totally disonnected, one
can choose a global isomorphism with Fℓ[2d].
The map from Fℓ[2d] to the ﬁbre of Rf′!Fℓover ∞extends to a small neighborhood; passing to
this small neighborhood, we can assume that there is a map
β : Fℓ[2d] →Rf′!Fℓ
that is an isomorphism in the ﬁbre over ∞. We can assume that this map is γ-equivariant (passing
to a smaller neighborhood). Let Q be the cone of β. Then Q is still f′-universally locally acyclic,
as is its Verdier dual
DMZ′/S′(Q) = RHomMZ′(Q, Rf′!Fℓ).
In particular, Rf′
!DMZ′/S′(Q) ∈D´et(S′, Fℓ) is constructible, and its restriction to S×{∞} is trivial.
This implies (e.g. by [Sch17a, Proposition 20.7]) that its restriction to S × {n, n + 1, . . . , ∞} is

150
IV. GEOMETRY OF DIAMONDS
trivial for some n ≫0. Passing to this subset, we can assume that Rf′
!DMZ′/S′(Q) = 0. Taking
Verdier duals and using Corollary IV.2.25, this implies that Rf′
∗Q = 0.
In particular, for all n ≥n0, we have Rf(n)
∗
Q|MZ(n) = 0. Using the γ-equivariance, this is
equivalent to
Rf(n)
∗
(Q|M(n0)
Z
)|MZ(n) = 0,
regarding MZ(n) ⊂MZ(n0) as an open subset. Taking the colimit over all n and using that the
system MZ(n) ⊂MZ(n0) has intersection s(S) ⊂MZ and is coﬁnal with a system of spatial
diamonds of ﬁnite cohomological dimension (as can be checked in the case of projective space),
[Sch17a, Proposition 14.9] implies that
s∗Q|MZ(n0) = lim
−→
n
Rf(n)
∗
(Q|MZ(n0))|MZ(n) = 0
(by applying it to the global sections on any quasicompact separated ´etale eS →S), and thus the
map
s∗β|MZ : Fℓ[2d] →s∗Rf!Fℓ
is an isomorphism, as desired. This ﬁnishes the proof of Proposition IV.4.29 and thus of Theo-
rem IV.4.2.
□
The idea of the preceding proof is the following. Let C →XS × A1 be the open subset of
the deformation to the normal cone of s : XS ,→Z (we did not develop the necessary formalism
to give a precise meaning to this in the context of smooth sous-perfectoid spaces, but it could be
done) whose ﬁber at 0 ∈A1 is the normal cone of the immersion s (the divisor over 0 ∈A1 of the
deformation to the normal cone is the union of two divisors: the projective completion of the normal
cone and the blow-up of Z along XS, both meeting at inﬁnity inside the projective completion).
One has a diagram
XS × A1 
/
$
C

A1
where outside t = 0 ∈A1 this is given by the section s : XS ,→Z, i.e. the pullback over Gm of the
preceding diagram gives the inclusion XS ×Gm ,→Z ×Gm, and at t = 0 this is the inclusion of XS
inside the normal cone of the section s. Let us note moreover that C is equipped with a Gm-action
compatible with the one on A1.
This gives rise to an E×-equivariant morphism with an equivariant section
MC
g

S × E
s
C
whose ﬁber at 0 ∈E is the zero section of BC(s∗TZ/XS) →S, and is isomorphic to MZ × E×
equipped with the section s outside of 0. Now, the complex s′∗Rg!Fℓis E×-equivariant on S × E.
Its ﬁber outside 0 ∈E, i.e. its restriction to S × E×, is s∗Rf!Fℓ, and its ﬁber at 0 is Fℓ(d)[2d],

IV.5. PARTIAL COMPACTLY SUPPORTED COHOMOLOGY
151
d = deg(TZ/XS) (since g is universally locally acyclic the dualizing complexe commutes with base
change).
Now one checks that one can replace the preceding diagram by a quasicompact OE \ {0}-
invariant open subset U ⊂MC together with an equivariant diagram
U
h

 
/ MC
g

S × OE
t
A
 
/ S × E.
s
C
In the preceding proof one replaces OE by πN∪{∞} ⊂OE, which does not change anything for
the argument. One concludes using that ×π “contracts everything to 0” and some constructibility
argument using the fact that U is spatial and some complexes are h-universally locally acyclic (see
the argument “Rf′
!DMZ′/S′(Q) ∈D´et(S′, Fℓ) is constructible” at the end of the proof of Proposition
IV.4.29).
IV.5. Partial compactly supported cohomology
Let us start by recalling the following basic vanishing result. Let C be a complete algebraically
closed nonarchimedean ﬁeld with pseudouniformizer ϖ ∈C. Let Spa Z((t)) ×Z Spa C = D∗
C be the
punctured open unit disc over C, and consider the subsets
j : U = {|t| ≤|ϖ|} ,→D∗
C, j′ : U′ = {|t| ≥|ϖ|} ,→D∗
C
Note that the punctured open unit disc has two ends: Towards the origin, and towards the boundary.
The open subsets U and U′ contain one end each.
Lemma IV.5.1. The partially compactly supported cohomology groups
RΓ(D∗
C, j!Λ) = 0 = RΓ(D∗
C, j′
!Λ)
vanish.
As usual Λ is any coeﬃcient ring killed by an integer n prime to p.
Proof. We treat the vanishing RΓ(D∗
C, j!Λ) = 0, the other one being similar. Let k : D∗
C ,→DC
be the inclusion. One has an exact triangle
(kj)!Λ −→Rk∗j!Λ −→i∗A
+1
−−−→
where i : {0} ,→DC. One has H0(A) = Λ, H1(A) = Λ(1), Hi(A) = 0 for i ̸= 0, 1, since A =
lim
−→n RΓ(Un, Λ) with Un = {|t| ≤|ϖn|} ⊂D∗
C being a punctured disc. We thus have to prove that
the preceding triangle induces an isomorphism A ∼
−→RΓc(U, Λ)[1]. Let ej : P1 \ {0, ∞} ,→P1 \ {0}.
There is a commutative diagram
RΓc(U, Λ)
RΓ(D∗
C, j!Λ)
A
RΓc(P1 \ {0, ∞}, Λ)
RΓ(P1 \ {0},ej!Λ)
A
.
≃
+1
+1

152
IV. GEOMETRY OF DIAMONDS
It thus suﬃces to check that
RΓ(P1 \ {0},ej!Λ) = 0,
for example in the algebraic setting using comparison theorems, which is an easy exercise.
□
Our goal now is to prove a very general version of such a result. Fix an algebraically closed
ﬁeld k|Fq and work on Perfk. Let X be a spatial diamond such that f : X →∗= Spd k is partially
proper with dim. trg f < ∞. Then the base change X ×k S of X to any spatial diamond S is not
itself quasicompact. Rather, it has two ends, and we will in this section study the cohomology with
compact support towards one of the ends.
To analyze the situation, pick quasi-pro-´etale and universally open surjections e
X →X and
eS →S from aﬃnoid perfectoid spaces (using [Sch17a, Proposition 11.24]), and pick maps e
X →
Spa k((t)) and eS →Spa k((u)) by choosing pseudouniformizers. We get a correspondence
e
X × eS
X × S
Spa k((t)) × Spa k((u)) = D∗
k((u))
where all maps are qcqs, and the left map is (universally) open. Now Spa k((t)) × Spa k((u)) is a
punctured open unit disc over Spa k((u)), and one can write it as the increasing union of the aﬃnoid
subspaces
{|u|b ≤|t| ≤|u|a} ⊂Spa k((t)) × Spa k((u))
for varying rational 0 < a ≤b < ∞. For any two choices of pseudouniformizers, a power of one
divides the other, so it follows that if eUa,b ⊂e
X × eS denotes the preimage of {|t|b ≤|u| ≤|t|a},
then the doubly-indexed ind-system {eUa,b}0<a≤b<∞is independent of the choice of the maps e
X →
Spa k((t)), eS →Spa k((u)).
Let Ua,b ⊂X × S be the image of eUa,b. As e
X × eS →X × S is open, this is a qcqs open subset
of X × S. Moreover, the doubly indexed ind-system {Ua,b}0<a≤b<∞is independent of all choices
made.
We let Ua = S
b<∞Ua,b and Ub = S
a>0 Ua,b and let
ja,b : Ua,b →X × S , ja : Ua →X × S , jb : Ub →X × S
be the open immersions. We can now deﬁne the cohomology groups of interest, or rather the version
of pushforward along β : X × S →S. As usual, Λ is a coeﬃcient ring killed by some integer n
prime to p.
Definition IV.5.2. The functors
Rβ!+, Rβ!−: D´et(X × S, Λ) →D´et(S, Λ)
are deﬁned by
Rβ!+C := lim
−→
a
Rβ∗(ja!C|Ua),
Rβ!−C := lim
−→
b
Rβ∗(jb!C|Ub)
for C ∈D´et(X × S, Λ).

IV.5. PARTIAL COMPACTLY SUPPORTED COHOMOLOGY
153
As the ind-systems of Ua and Ub are independent of all choices, these functors are canonical.
The main result is the following. Here α : X × S →X and β : X × S →S are the two
projections.
Theorem IV.5.3. Assume that C = α∗A ⊗L
Λ β∗B for A ∈D´et(X, Λ) and B ∈D´et(S, Λ). Then
Rβ!+C = 0 = Rβ!−C.
Remark IV.5.4. The essential case for applications is C = α∗A, i.e. B = Λ, and S = Spa k((t)).
In other words, we take any coeﬃcient system A on X, pull it back to X ×Spa k((t)), and then take
the partially compactly supported cohomology (relative to S). However, it is sometimes useful to
know the result in the relative case, i.e. for general S, and then it is also natural to allow twists by
B ∈D´et(S, Λ).
Proof. We write the proof for Rβ!+; the other case is exactly the same. Let X• →X be a
simplicial hypercover by aﬃnoid perfectoid spaces Xi = Spa(Ri, R+
i ) which are partially proper
over Spa k (i.e., R+
i is minimal, i.e. the integral closure of k + R◦◦). As X is a spatial diamond,
we can arrange that the Xi are the compactiﬁcations of quasi-pro-´etale maps to X (since X is
spatial it admits an hypercover X• →X with Xi aﬃnoid perfectoid and Xi →X quasi-pro-´etale,
since X →Spd k is partially proper this extends to a hypercover Xc
• →X where Xc
i is Huber’s
canonical compactiﬁcation over Spa(k)); in particular, gi : Xi →X satisﬁes dim. trg gi = 0 < ∞.
Let β• : X• × S →S be the corresponding projection. We claim that
Rβ!+C
is the limit of Rβ•,!+(C|X•×S), for any C ∈D´et(X × S, Λ). Writing C as a limit of its Postnikov
truncations ([Sch17a, Proposition 14.15]), we can assume C ∈D+
´et(X × S, Λ). Now gi : Xi →X
is a qcqs map between spaces partially proper over ∗, so gi is proper, and hence so its base change
hi : Xi × S →X × S. This implies that
Rβi,!+(h∗
i C) = Rβ!+(Rhi∗h∗
i C),
as jU! commutes with Rhi∗by [Sch17a, Theorem 19.2]. Now by [Sch17a, Proposition 17.3], one
sees that C is the limit of Rhi∗h∗
i C. But Rβ!+ commutes with this limit, using that the ﬁltered
colimit does as everything lies in D+ (with a uniform bound).
By the preceding reduction, we may assume that X = Spa(R, R+) is an aﬃnoid perfectoid
space. We can even assume that X has no nonsplit ﬁnite ´etale covers (by taking the Xi above to
be compactiﬁcations of strictly totally disconnected spaces). In that case, there is a map g : X →
Y = Spa K, where K is the completed algebraic closure of k((t)), which is necessarily proper (as X
and Y are partially proper over ∗), and as above one has
Rβ!+C = RβY,!+(Rh∗C)
where βY : Y × S →S is the projection and h : X × S →Y × S is the base change of g. Let
αY : Y × S →Y be the other projection. Then the projection formula (and properness of h)
[Sch17a, Proposition 22.11] show that
Rh∗C = Rh∗(α∗A ⊗L
Λ β∗B) ∼= Rh∗α∗A ⊗L
Λ β∗
Y B
and Rh∗α∗A ∼= α∗
Y Rg∗A by proper base change.

154
IV. GEOMETRY OF DIAMONDS
In other words, we can reduce to the case X = Spa K; in particular A ∈D´et(Spa K, Λ) = D(Λ)
is just a complex of Λ-modules. In that case, deﬁne Ua,b and Ua as above but taking X = e
X →
Spa k((t)) the natural map. We claim that in this case for all a > 0
Rβ∗(ja!C|Ua) = 0.
To prove this, it suﬃces to see that for all a′ > a > 0, the cone of
Rβ∗(ja′!C|Ua′) →Rβ∗(ja!C|Ua)
vanishes, as Rβ∗(ja!C|Ua) is the limit of these cones as a′ →∞. Now these cones depend on only
a quasicompact part of X × S, and hence their formation commutes with any base change in S,
cf. [Sch17a, Proposition 17.6]. Therefore, we can reduce to the case S = Spa(L, L+) for some
complete algebraically closed nonarchimedean ﬁeld L with open and bounded valuation subring
L+ ⊂L, and check on global sections RΓ(S, −). Moreover, the cone commutes with all direct sums
in C, so one can assume that A ∈D´et(Spa K, Λ) = D´et(Λ) is simply given by A = Λ.
It remains to prove the following statement: For all B ∈D´et(Spa(L, L+), Λ) one has
RΓ(Spa K × Spa(L, L+), ja!B|Ua) = 0.
If the stalk of B at the closed point vanishes, this follows from proper base change (writing Spa K ×
Spa(L, L+) as the union of its subspaces proper over Spa(L, L+)), [Sch17a, Theorem 19.2]. Thus
we may assume that B is concentrated at the closed point of S. Analyzing the structure of Ua,
one checks that in fact there is some map k((u)) →L such that the ﬁbres over the closed point
of Spa(L, L+) of Ua and {|t| ≤|u|a} agree. (A priori, it is a union of such subsets for a proﬁnite
set of maps k((u)) →L, but for any two such choices one is contained in the other, by comparing
valuations of the pseudouniformizers.) Thus, we can now assume that Ua = {|t| ≤|u|a}, and we
can also reduce to the case that B is constant. Now using as above that the cones for a′ > a > 0
commute with any base change in S and commute with direct sums in B, we can reduce to B = Λ
and the rank-1-geometric point S = Spa L where L is the completed algebraic closure of k((u)).
At this point, we can further replace Spa K by Spa k((t)): One can write Spa K as the inverse
limit over ﬁnite extensions of Spa k((t)), each of which is isomorphic to Spa k((t′)), and although a
priori RΓ(Spa K × Spa L, ja!Λ) does not take this inverse limit to a colimit, this does happen after
passing to cones for maps for a′ > a > 0, which suﬃces as above. Finally, we have reduced to
Lemma IV.5.1.
□
IV.6. Hyperbolic localization
In this section we extend some results of Braden, [Bra03], to the world of diamonds. Our
presentation is also inspired by the work of Richarz, [Ric19]. We will use these results throughout
our discussion of geometric Satake, starting in Section VI.3.
Let S be a small v-stack, and let f : X →S be proper and representable in spatial diamonds
with dim. trg f < ∞, and assume that there is a Gm-action on X/S, where Gm is the v-sheaf
sending Spa(R, R+) to R×. The ﬁxed point space X0 := XGm ⊂X deﬁnes a closed subfunctor.
We make the following assumption about the Gm-action. Here, (A1)+ (resp. (A1)−) denotes
the aﬃne line Spa(R, R+) 7→R with the natural Gm-action (resp. its inverse).

IV.6. HYPERBOLIC LOCALIZATION
155
Hypothesis IV.6.1. There is a decomposition of X0 into open and closed subsets X0
1, . . . , X0
n
such that for each i = 1, . . . , n, there are locally closed Gm-stable subfunctors X+
i , X−
i
⊂X with
X0 ∩X+
i
= X0
i (resp. X0 ∩X−
i
= X0
i ) such that the Gm-action on X+
i
(resp. X−
i ) extends to a
Gm-equivariant map (A1)+ × X+
i →X+
i
(resp. (A1)−× X−
i →X−
i ), and such that
X =
n[
i=1
X+
i =
n[
i=1
X−
i .
We let
X+ =
nG
i=1
X+
i
X−=
nG
i=1
X−
i ,
so that there are natural maps
q+ : X+ →X
q−: X−→X,
as well as closed immersions
i+ : X0 →X+
i−: X0 →X−
and projections
p+ : X+ →X0
p−: X−→X0;
here p+ is given by the restriction of (A1)+×X+
i →X+
i to {0}×X+
i , and p−is deﬁned analogously.
Although the decomposition of X0 into X0
i for i = 1, . . . , n is a choice, ultimately the functors
X+ and X−are independent of any choice. Indeed, we have the following functorial description.
Proposition IV.6.2. Consider the functor (X+)′ sending any perfectoid space T over S to the
set of Gm-equivariant maps from (A1)+ to X. There is a natural map X+ →(X+)′, as there is a
natural Gm-equivariant map (A1)+ × X+ →X+ →X. The map X+ →(X+)′ is an isomorphism.
Analogously, X−classiﬁes the set of Gm-equivariant maps from (A1)−to X.
Proof. It is enough to handle the case of X+. There is a natural map (X+)′ →X0 given by
evaluating the Gm-equivariant map on (A1)+×(X+)′ →X on {0}×X+. Let (X+
i )′ = (X+)′×X0X0
i ;
it is enough to prove that X+
i →(X+
i )′ is an isomorphism. For this, it is enough to prove that the
map (X+
i )′ →X given by evaluation at 1 is an injection whose image is contained in the locally
closed subspace X+
i ⊂X. This can be checked after pullback to an aﬃnoid perfectoid base space
S = Spa(R, R+). As X/S is proper (in particular, separated) and Gm × (X+
i )′ ⊂(A1)+ × (X+
i )′
is dense, it follows that the map (X+
i )′ →X is an injection. To bound its image, we can argue on
geometric points. If x ∈|X| is any point in the image of |(X+
i )′|, and ϖ ∈R is a pseudouniformizer

156
IV. GEOMETRY OF DIAMONDS
with induced action γ on X, then the sequence γn(x) converges to a point of |X0
i | for n →∞. On
the other hand, if x ̸∈|X+
i |, then x ∈|X+
j | for some j ̸= i, which implies that γn(x) converges to
a point of |X0
j | for n →∞; this is a contradiction.
Thus, (X+
i )′ embeds into X+
i ⊂X, but it also contains X+
i , so indeed X+
i = (X+
i )′.
□
Lemma IV.6.3. The map j : X0 →X+ ×X X−is an open and closed immersion.
More
precisely, for any i = 1, . . . , n, the map ji : X0
i →X+
i ×X X−
i
is an isomorphism.
Proof. It is enough to prove that for any i = 1, . . . , n, the map ji : X0
i →X+
i ×X X−
i
is
an isomorphism. As it is a closed immersion (as X0
i →X is a closed immersion and the target
embeds into X), it is enough to prove that it is bijective on geometric rank 1 points. Thus, we can
assume S = Spa C, and let x : Spa C = S →X be a section that factors over X+
i ×X X−
i . Then
the Gm-action on x extends to a Gm-equivariant map g : P1
C →X. Consider the preimage of X+
i
under g; this is a locally closed subfunctor, and it contains all geometric points. Indeed, on (A1)+
C,
the map g factors over X+
i by hypothesis, and at ∞, it maps into X0
i ⊂X+
i . This implies that the
preimage of X+
i under g is all of P1
C. In particular, we get a map
(A1)+ × P1
C →(A1)+ × X+
i →X+
i
which, when restricted to the copy of Gm embedded via t 7→(t, t−1), is constant with value x.
By continuity (and separatedness of X+
i ), this implies that it is also constant with value x when
restricted to A1 embedded via t 7→(t, t−1), i.e. the point (0, ∞) ∈(A1)+ × P1
C maps to x. On the
other hand, when restricted to Gm × {∞}, the map is constant with values in X0
i , and thus by
continuity also on (A1)+ × {∞}. This implies that x ∈X0
i , as desired.
□
In this setup, we can deﬁne two functors D´et(X, Λ) →D´et(X0, Λ). We use the diagrams
X±
X
X0.
p±
q±
Definition IV.6.4. Deﬁne the functors
L+
X/S = R(p+)!(q+)∗: D´et(X, Λ) →D´et(X0, Λ),
L−
X/S = R(p−)∗R(q−)! : D´et(X, Λ) →D´et(X0, Λ),
and a natural transformation L−
X/S →L+
X/S as follows. First, there are natural transformations
R(i+)! = R(p+)!R(i+)!R(i+)! →R(p+)! , R(p−)∗= (i−)∗(p−)∗R(p−)∗→(i−)∗,
and the desired transformation L−
X/S →L+
X/S arises as a composite
L−
X/S = R(p−)∗R(q−)! →(i−)∗R(q−)! →(Ri+)!(q+)∗→R(p+)!(q+)∗= L+
X/S,

IV.6. HYPERBOLIC LOCALIZATION
157
where the middle map (i−)∗R(q−)! →(Ri+)!(q+)∗of functors D´et(X, Λ) →D´et(X0, Λ) is deﬁned
as the following composite
(i−)∗R(q−)! →(i−)∗R(q−)!R(q+)∗(q+)∗
= (i−)∗R(eq−)∗R(eq+)!(q+)∗
→(i−)∗R(eq−)∗j∗j∗R(eq+)!(q+)∗
= (i−)∗(i−)∗Rj!R(eq+)!(q+)∗
= R(i+)!(q+)∗,
using base change in the cartesian diagram
X0 
j
/ X+ ×X X−
eq+

eq−/ X+
q+

X−
q−
/ X.
Equivalently, it is enough to deﬁne for each i = 1, . . . , n a natural transformation (i−
i )∗R(q−
i )! →
(Ri+
i )!(q+
i )∗of functors D´et(X, Λ) →D´et(X0
i , Λ). As
X0
i
i+
i
/
i−
i

X+
i
q+
i

X−
i
q−
i
/ X
is cartesian, this arises as the composite
(i−
i )∗R(q−
i )! →(i−
i )∗R(q−
i )!R(q+
i )∗(q+
i )∗= (i−
i )∗(i−
i )∗R(i+)!(q+
i )∗= R(i+)!(q+
i )∗.
The following is our version of Braden’s theorem, [Bra03], cf. [Ric19, Theorem B].
Theorem IV.6.5. For any A ∈D´et(X/Gm, Λ) whose restriction to X we continue to denote
by A, the map
L−
X/SA →L+
X/SA
is an isomorphism. In fact, moreover for any A+ ∈D´et(X+/Gm, Λ), the map
R(i+)!A+ →R(p+)!A+
is an isomorphism, and for any A−∈D´et(X−/Gm, Λ), the map
R(p−)∗A−→(i−)∗A−
is an isomorphism, so that
L−
X/SA = R(p−)∗R(q−)!A ∼= (i−)∗R(q−)!A ∼= R(i+)!(q+)∗A ∼= R(p+)!(q+)∗A = L+
X/SA
is a series of isomorphisms.
Before we start with the proof, we prove a certain general result about cohomology groups on
spaces with “two ends”, a ﬂow connecting the two ends, and cohomology of sheaves, equivariant
for the ﬂow, that are compactly supported at only one end.

158
IV. GEOMETRY OF DIAMONDS
Proposition IV.6.6. Let S = Spa(R, R+) be an aﬃnoid perfectoid space, ϖ ∈R a pseudouni-
formizer, let f : Y →S be a partially proper map of locally spatial diamonds, and assume that Y is
equipped with a Gm-action over S. Assume that the quotient v-stack Y/Gm is qcqs. In that case, we
can ﬁnd a quasicompact open subset V ⊂Y such that Gm ×V →Y is surjective and quasicompact.
Write
Gm,S = lim
−→
n≥0
Un , Un = {x ∈Gm,S | |x| ≤|ϖ|−n},
and let jn : Vn ⊂Y be the open image of the cohomologically smooth map Un×SV ⊂Gm,S×SY →Y .
In this situation, we deﬁne for any A ∈D´et(Y, Λ) the relative cohomology with partial supports
lim
−→
n
Rf∗(jn!A|Vn) ∈D´et(S, Λ) ;
this functor is canonically independent of the choices made in its deﬁnition.
For any A ∈D+
´et(Y/Gm, Λ) (resp. any A ∈D´et(Y/Gm, Λ) if dim. trg f < ∞),
lim
−→
n
Rf∗(jn!A|Vn) = 0.
Remark IV.6.7. Assume that S = Spa C is a geometric rank 1 point. Then we set
RΓc+(Y, A) = lim
−→
n
RΓ(Y, jn!AVn),
which is exactly the above functor lim
−→n Rf∗(jn!A|Vn) under the identiﬁcation D´et(S, Λ) = D(Λ).
Roughly speaking, the space Y has two ends, one given by S
n<0 γn(V ) for V large enough, where
γ is the automorphism of Y induced by ϖ ∈Gm(S), and the other given by S
n>0 γn(V ). We are
considering the cohomology groups of Y that have compact support in one of these directions, but
not in the other. If one replaces the Gm-action by its inverse, this implies a similar result for the
direction of compact support interchanged.
Proof. The proof is analogous to the proof of Theorem IV.5.3, reducing to the case Y =
Gm × S, where it is a simple computation. Indeed, one can assume that A ∈D+
´et(Y/Gm, Λ) by a
Postnikov limit argument (in case dim. trg f < ∞). Finding a v-hypercover of Y by spaces with
Gm-action of the form Gm × Xi, where each Xi is a proper spatial diamond over S, and using v-
hyperdescent, one reduces to the case Y = Gm × Xi. Then there is a projection Gm × Xi →Gm,S,
and one reduces to Y = Gm,S. In that case, the same arguments as in the previous section apply.
□
Proof of Theorem IV.6.5. We can assume that A ∈D+
´et(X/Gm, Λ) by pulling through the
Postnikov limit lim
←−n τ ≥−nA, noting that L+
X/S commutes with limits while (q+)∗commutes with
Postnikov limits and R(p+)! as well by ﬁnite cohomological dimension.
By choosing a v-hypercover of S by disjoint unions of strictly totally disconnected spaces S•,
and using v-hyperdescent, we can assume that S is a strictly totally disconnected space; indeed,
L+
X/S commutes with all limits, while (q+)∗and R(p+)! commute with any base change and so
preserve cartesian objects, and thus also commute with the hyperdescent.
We start by proving that for any A+ ∈D´et(X+/Gm, Λ), the map
R(i+)!A+ →R(p+)!A+

IV.6. HYPERBOLIC LOCALIZATION
159
is an isomorphism, and similarly for any A−∈D´et(X−/Gm, Λ), the map
R(p−)∗A−→(i−)∗A−
is an isomorphism. Let j+ : X+ \ X0 ,→X+, j−: X−\ X0 ,→X−denote the open embeddings.
Then there are exact triangles
(i+)∗R(i+)!A+ →A+ →R(j+)∗(j+)∗A+ , (j−)!(j−)∗A−→A−→(i−)∗(i−)∗A−.
Using these triangles, we see that it is enough to see that for any B+ ∈D´et((X+ \ X0)/Gm, Λ),
B−∈D´et((X−\ X0)/Gm, Λ), one has
R(p+)!R(j+)∗B+ = 0 , R(p−)∗R(j−)!B−= 0
as objects in D´et(X0, Λ). This follows from Proposition IV.6.6 applied to S = X0 and Y = X+\X0
(resp. Y = X−\ X0), and the following lemma.
Lemma IV.6.8. The Gm-action on X+ \ X0 (resp. X−\ X0) has the property that the quotient
v-stack (X+ \ X0)/Gm (resp. (X−\ X0)/Gm) is qcqs over S (thus, over X0).
Proof. It is enough to do the case of X+ \ X0, and we may restrict to X+
i \ X0
i . We can
assume that S = Spa(R, R+) is an aﬃnoid perfectoid space, and ﬁx a pseudouniformizer ϖ ∈R. As
Gm,S/ϖZ is qcqs (in fact proper — a Tate elliptic curve), it is equivalent to prove that (X+\X0)/γZ
is qcqs, where γ is the automorphism given by the action of ϖ ∈Gm(S).
Now we use the criterion of Lemma II.2.17 for the action of γ on |X+
i |. As a locally closed
partially proper subspace of the proper spatial diamond X over S, the locally spectral space |X+
i | is
taut, and the condition on generizations is always fulﬁlled for locally spatial diamonds. The spectral
closed subspace |X0
i | ⊂|X+
i | is ﬁxed by γ, and by assumption for all x ∈|X+
i |, the sequence γn(x)
for n →∞converges to a point of |X0
i | (as the Gm-action extends to (A1)+). It remains to see that
for all x ∈|X+
i \ X0
i |, the sequence γn(x) for n →−∞diverges in |X+
i |. But x ∈|X−
j | for some
j, and j ̸= i by Lemma IV.6.3. Thus, γn(x), for n →−∞, converges to a point of |X0
j |, which is
outside of |X+
i |, so the sequence diverges in |X+
i |.
□
Now it remains to see that for any A ∈D+
´et(X/Gm, Λ), the map
(i−)∗R(q−)!A →R(i+)!(q+)∗A
in D+
´et(X0, Λ) = D+((X0)´et, Λ) is an isomorphism. This can be done locally on X0, so ﬁx some
i ∈{1, . . . , n}, and choose a quasicompact open neighborhood U0 ⊂X of X0
i that does not meet
any X0
j for j ̸= i and such that X+
i ∩U0, X−
i ∩U0 ⊂U0 are closed. The Gm-orbit Y = Gm ·U0 ⊂X
is still open, and contains X+
i and X−
i , necessarily as closed subsets.
We are now in the situation of the next proposition. To check conditions (ii) and (iii) of that
proposition, note that we may ﬁnd a quasicompact open subspace V ⊂Y such that Y = γZ · V by
averaging U0 over {|ϖ| ≤|t| ≤1} ⊂Gm. Let W be the closure of S
n≥0 γn(V ) ⊂X. To check (iii),
it suﬃces (by symmetry) to see that
\
m≥0
γm(W) = X−
i

160
IV. GEOMETRY OF DIAMONDS
in X.
Note that X−
i
⊂S
n≥0 γn(V ) (as for all x ∈X−
i , the sequence γ−n(x) converges into
X0
i ⊂V ), so X−
i is contained in W, and thus in T
m≥0 γm(W). To prove the converse inclusion, let
W ′ = T
m≥0 γm(W). If X−
i ⊊W ′, then there is some j ̸= i such that X−
j contains a quasicompact
open subset A ⊂W ′. Then eA = S
n≥0 γ−n(A) is a γ−1-invariant open subset of W ′ whose closure
is γ−(N∪{∞}) · A; in particular, replacing A by γ−n(A) if necessary, we can arrange that this closure
is contained in any given small neighborhood of X0
j , and in particular intersects V trivially. Then
γn(V ) ∩A = γn(V ∩γ−n(A)) = ∅for all n ≥0, and hence A intersects S
n≥0 γn(V ) trivially, and
then also its closure W. But we assumed that A ⊂W ′ ⊂W, giving a contradiction.
□
Proposition IV.6.9. Let S = Spa(R, R+) be a strictly totally disconnected perfectoid space, let
f : Y →S be a compactiﬁable map of locally spatial diamonds, and assume that Y/S is equipped
with a Gm-action, with ﬁxed points Y 0 ⊂Y , and the following properties.
(i) There are Gm-invariant closed subspaces q+ : Y + ⊂Y , q−: Y −⊂Y , containing Y 0 (via
i+ : Y 0 →Y +, i−: Y 0 →Y −) such that the action maps extend to maps (A1)+ × Y + →Y +
resp. (A1)−× Y −→Y −.
(ii) The quotient v-stack Y/Gm is quasicompact. In particular, picking a pseudouniformizer ϖ ∈R
with induced action γ on Y , we can ﬁnd some quasicompact open V ⊂Y such that Y = γZ · V .
(iii) With V as in (ii), let W −be the closure of γN · V and W + the closure of γ−N · V . Then
T
n≥0 γn(W −) = Y −and T
n≥0 γ−n(W +) = Y +.
Then Y 0 is a spatial diamond, the diagram
Y 0
i+ /
i−

Y +
q+

Y −
q−
/ Y
is cartesian, the quotient v-stacks (Y \ Y +)/Gm and (Y \ Y −)/Gm are qcqs, and for all A ∈
D+
´et(Y/Gm, Λ) (resp. all A ∈D´et(Y/Gm, Λ) if dim. trg f < ∞) whose pullback to Y we continue to
denote by A, the map
(i−)∗R(q−)!A →(i−)∗R(q−)!(q+)∗(q+)∗A = (i−)∗(i−)∗R(i+)!(q+)∗A = R(i+)!(q+)∗A
in D´et(Y 0, Λ) is an isomorphism.
Proof. Note that Y 0/Gm ⊂Y/Gm is closed and thus Y 0/Gm is quasicompact. As the Gm-
action is trivial on Y 0, this implies that Y 0 is quasicompact. As Y 0 ⊂Y is closed and Y →S is
compaciﬁable and in particular quasiseparated, we see that Y 0 →S is qcqs. That the diagram is
cartesian follows from the proof of Lemma IV.6.3.
Next, we check that (Y \ Y +)/Gm and (Y \ Y −)/Gm are qcqs. By symmetry and as Gm,S/γZ
is qcqs, it suﬃces to see that (Y \ Y −)/γZ is qcqs. First, we check that it is quasiseparated. Take
any quasicompact open subspace V −⊂Y \ Y −
i ; we need to see there are only ﬁnitely many n
with V −∩γn(V −) ̸= ∅.
We can assume that V −⊂S
n≥0(V ) (translating by a power of γ if
necessary), and then V −is covered by the open subsets V −\ γm(W −) ⊂V −by the claim above.

IV.6. HYPERBOLIC LOCALIZATION
161
By quasicompacity, the intersection of V −with γm(W −) is empty for some large enough m, but
then also the intersection of V −with γm′(V −) ⊂γm(W −) for m′ ≥m is empty.
To see that (Y \ Y −)/γZ is quasicompact, note that V \ S
n>0 γn(V ) is a spectral space (as it
is closed in V ) that maps bijectively to (Y \ Y −)/γZ.
Now, for the cohomological statement, we can as usual assume that A ∈D+
´et(Y/Gm, Λ) by
a Postnikov limit argument.
Then we are interested in checking that a map in D+
´et(Y0, Λ) =
D+(Y0,´et, Λ) (cf. [Sch17a, Remark 14.14]) is an isomorphism, so we need to check that the sections
over all quasicompact separated ´etale Y ′
0 →Y0 agree. Now we claim that any such quasicompact
separated ´etale Y ′
0 →Y0 lifts to a Gm-equivariant quasicompact separated ´etale map Y ′ →Y ; this
will then allow us to assume Y ′
0 = Y0 via passing to the pullback of everything to Y ′.
To see that one may lift Y ′
0 →Y0 to Y ′ →Y , consider the open subspace V (n) ⊂Y given
as the intersection of S
m≥n γm(V ) with S
m≤−n γm(V ). It follows from the topological situation
that this is still quasicompact, and that the intersection of all V (n) is equal to Y0 (using condition
(iii)). Let Y (n) = γZ · V (n) ⊂Y . Then γ-equivariant quasicompact separated ´etale maps to Y (n)
are equivalent to quasicompact separated ´etale maps to V (n) together with isomorphisms between
the two pullbacks to V (n) ∩γ(V (n)). The latter data extends uniquely from Y0 to V (n) for small
enough n by [Sch17a, Proposition 11.23]. Repeating a similar argument after taking a product
with Gm,S/γZ (which is qcqs), and observing that the Y (n) are coﬁnal with their Gm-orbits, one
can then attain Gm-equivariance.
We have now reduced to checking the statement on global sections. Now consider the compact-
iﬁcation j : Y ,→Y = Y
/S →S. Note that Y satisﬁes all the same conditions of the proposition.
Restricted to Y0, this gives a quasicompact open immersion j0 : Y0 ,→Y0. By the above argument,
this quasicompact open immersion spreads to a quasicompact open immersion into Y , and by tak-
ing it small enough in the argument above, we can assume that it is contained in Y . This allows
us to assume that j is quasicompact. In that case the functor Rj∗commutes with all operations in
question by [Sch17a, Proposition 17.6, Proposition 23.16 (i)]. Thus, we can now moreover assume
that Y is partially proper.
Our goal now is to prove that when Y is partially proper and A ∈D+
´et(Y/Gm, Λ), the map
(i−)∗R(q−)!A →R(i+)!(q+)∗A
becomes an isomorphism after applying Rf0∗where f0 : Y0 →S is the proper map. For this, we
deﬁne another functor D´et(Y, Λ) →D´et(S, Λ), as follows. Let jn : Vn = S
m≥−n γn(V ) ,→Y for
n ≥0. Then we consider
A 7→F(A) = lim
−→
n
Rf∗(jn!A|Vn) : D´et(Y, Λ) →D´et(S, Λ).
Lemma IV.6.10. Let j−: Y \ Y −→Y , j+ : Y \ Y + →Y denote the open immersions.
(i) If A = Rj−
∗A−for A−∈D+
´et((Y \ Y −)/Gm, Λ), then F(A) = 0.
(ii) If A = j+
! A+ for A+ ∈D+
´et((Y \ Y +)/Gm, Λ), then F(A) = 0.
Proof. This follows Proposition IV.6.6 and condition (iii).
□

162
IV. GEOMETRY OF DIAMONDS
There are natural transformations Rf0∗R(p−)∗R(q−)! →F →Rf0∗R(p+)!(q+)∗, and the lemma
implies that these are equivalences when evaluated on A ∈D+
´et(Y/Gm, Λ). Using that also (Y + \
Y 0)/Gm and (Y −\ Y 0)/Gm are qcqs (as closed subspaces of (Y \ Y −)/Gm resp. (Y \ Y +)/Gm) so
that we can apply Proposition IV.6.6 again as in the beginning of the proof of Theorem IV.6.5, we
get an isomorphism
Rf0∗(i−)∗R(q−)!A ∼= Rf0∗R(p−)∗R(q−)!A ∼= F(A) ∼= Rf0∗R(p+)!(q+)∗A ∼= Rf0∗R(i+)!(q+)∗A.
We need to see that this implies that also the map
Rf0∗(i−)∗R(q−)!A →Rf0∗R(i+)!(q+)∗A
deﬁned in the statement of the proposition is an isomorphism. For this, observe that this map is
an isomorphism if and only if for A = j+
! A+ with A+ ∈D´et((Y \ Y +)/Gm, Λ), one has
Rf0∗(i−)∗R(q−)!A = 0.
But this follows from the existence of some isomorphism
Rf0∗(i−)∗R(q−)!A ∼= Rf0∗R(i+)!(q+)∗A = 0,
using (q+)∗A = (q+)∗j+
! A+ = 0.
□
Using Theorem IV.6.5, we give the following deﬁnition.
Definition IV.6.11. Let f : X →S with Gm-action be as above, satisfying Hypothesis IV.6.1.
Let D´et(X, Λ)Gm-mon ⊂D´et(X, Λ) be the full subcategory generated under ﬁnite colimits and retracts
by the image of D´et(X/Gm, Λ) →D´et(X, Λ). The hyperbolic localization functor is the functor
LX/S : D´et(X, Λ)Gm-mon →D´et(X0, Λ)
given by L−
X/S ∼= L+
X/S.
We observe that Theorem IV.6.5 implies the following further results.
Proposition IV.6.12. In the situation of Deﬁnition IV.6.11, let g : S′ →S be a map of small
v-stacks, with pullback f′ : X′ = X ×S S′ →S′, gX : X′ →X, g0 : X0′ →X0. Then there are
natural equivalences
g0∗LX/S ∼= LX′/S′g∗
X , LX/SRgX∗∼= Rg0
∗LX′/S′ , LX/SRgX! ∼= Rg0!LX′/S′ , Rg0!LX/S ∼= LX′/S′Rg!
X,
the latter two in case g is compactiﬁable and representable in locally spatial diamonds with dim. trg g <
∞(so that the relevant functors are deﬁned).
Proof. The ﬁrst and third assertions are clear for L+
X/S, while the second and fourth assertions
are clear for L−
X/S.
□
Proposition IV.6.13. In the situation of Deﬁnition IV.6.11, let A ∈D´et(X, Λ)Gm-mon and
B ∈D´et(S, Λ).
Let L′
X/S denote the hyperbolic localization functor for the inverse Gm-action.
Then there is natural isomorphism
RHom(LX/S(A), Rf0!B) ∼= L′
X/SRHom(A, Rf!B).
In particular, taking B = Λ, hyperbolic localization commutes with Verdier duality, up to changing
the Gm-action.

IV.7. DRINFELD’S LEMMA
163
Proof. More generally, for all A ∈D´et(X, Λ) and B ∈D´et(S, Λ), we have a natural isomor-
phism RHom(L+
X/S(A), Rf0!B) ∼= L′−
X/SRHom(A, Rf!B). Indeed,
RHom(L+
X/S(A), Rf0!B) = RHom(R(p+)!(q+)∗A, Rf0!B) ∼= R(p+)∗RHom((q+)∗A, R(p+)!Rf0!B)
∼= R(p+)∗RHom((q+)∗A, R(q+)!Rf!B) ∼= R(p+)∗R(q+)!RHom(A, Rf!B).
□
Proposition IV.6.14. In the situation of Deﬁnition IV.6.11, assume that A ∈D´et(X, Λ)Gm-mon
is f-universally locally acyclic.
Then LX/S(A) ∈D´et(X0, Λ) is universally locally acyclic with
respect to f0 : X0 ⊂X →S.
Proof. As the assumption is stable under base change, we may assume that S is strictly totally
disconnected, and it suﬃces to see that LX/S(A) is f0-locally acyclic. For condition (a), we can in
fact assume that S = Spa(C, C+) is strictly local; let j : S0 = Spa(C, OC) ⊂S be the generic open
point. Then we have to see that LX/S(A) = Rj0
∗(LX/S(A)|X0×SS0), where j0 : X0 ×S S0 →X0 is
the pullback of j. But this follows from Proposition IV.6.12 and the corresponding property of A.
For condition (b), it suﬃces to see that the functor RHomΛ(LX/S(A), Rf0!−) commutes with
all direct sums, as then its left adjoint Rf0!(LX/S(A) ⊗L
Λ −) preserves perfect-constructible com-
plexes. For this, we compute this functor:
RHomΛ(LX/S(A), Rf0!−) ∼= L′
X/SRHomΛ(A, Rf!−)
∼= L′
X/S(DX/S(A) ⊗L
Λ f∗−).
Here, we used Proposition IV.6.13 and Proposition IV.2.19. The ﬁnal functor clearly commutes
with all direct sums, giving the desired result.
□
IV.7. Drinfeld’s lemma
As a ﬁnal topic of this chapter, we prove the version of Drinfeld’s lemma that we will need in
this paper. Contrary to the classical formulation [Dri80, Theorem 2.1], cf. also [Lau04, Theorem
8.1.4], this version actually makes the Weil group of E, not the absolute Galois group of E, appear.
(Also, it is worth remarking that usually, a global Galois group appears, not a local Galois group.)
In this section, we work on Perfk where k = Fq. In that case, we can write the moduli space
of degree 1 Cartier divisors on the Fargues–Fontaine curve as Div1 = Spd ˘E/ϕZ. This admits a
natural map
ψ : Div1 →[∗/WE]
to the classifying space of the Weil group of E. Indeed, if C = bE is a completed algebraic closure
of E, then there is an action of WE on Spd C, with the inertia subgroup IE ⊂WE acting via its
usual action, while Frobenius elements act via the composite of the usual action and the Frobenius
of Spd C. More precisely, τ ∈WE acts as τ ◦Frob−deg τ where deg : WE →Z is the projection;
note that this as a map over Spd k as on Spd k the two Frobenii cancel. The natural map
[Spd C/WE] →[Spd ˘E/ϕZ]

164
IV. GEOMETRY OF DIAMONDS
is an isomorphism, thus yielding the natural map
ψ : [Spd ˘E/ϕZ] ∼= [Spd C/WE] →[∗/WE].
One could equivalently compute
WE × Spd C ∼= Spd C ×Div1 Spd C
for the natural map Spd C →Div1 to arrive at the result.
In particular, for any small v-stack X, we get a natural map
ψX : X × Div1 →X × [∗/WE].
Proposition IV.7.1. The functor
ψ∗
X : D´et(X × [∗/WE], Λ) →D´et(X × Div1, Λ)
is fully faithful. If the natural pullback functor
D´et(X, Λ) →D´et(X × Spd C, Λ)
is an equivalence, then ψ∗
X is also an equivalence.
Proof. We apply descent along ∗→[∗/WE]. This describes D´et(X × [∗/WE], Λ) in terms of
cartesian objects in D´et(X×WE•, Λ), and D´et(X×Div1, Λ) in terms of cartesian objects in D´et(X×
Spd C × WE•, Λ). By [Sch17a, Theorem 1.13], all functors D´et(X × WE•, Λ) →D´et(X × Spd C ×
WE•, Λ) are fully faithful; this implies the fully faithfulness. Moreover, for essential surjectivity on
cartesian objects it is enough to know essential surjectivity on the degree 0 part of the simplicial
resolution, i.e. for D´et(X, Λ) →D´et(X × Spd C, Λ), giving the desired result.
□
We note the following immediate corollary.
Corollary IV.7.2. For any ﬁnite set I, pullback along X × (Div1)I →X × [∗/W I
E] induces a
fully faithful functor
D´et(X × [∗/W I
E], Λ) →D´et(X × (Div1)I, Λ).
Proof. This follows inductively from Proposition IV.7.1.
□
We need the following reﬁnement, see Proposition VI.9.2. For any small v-stack Y , let
Dlc(Y, Λ) ⊂D´et(Y, Λ)
be the full subcategory of all objects that are locally constant with perfect ﬁbres.
Proposition IV.7.3. For any ﬁnite set I and any small v-stack X, the functor
Dlc(X × [∗/W I
E], Λ) →Dlc(X × (Div1)I, Λ)
is an equivalence of categories.
We will mostly be using this in case X is a point.

IV.7. DRINFELD’S LEMMA
165
Proof. By Corollary IV.7.2, the functor is fully faithful. By induction, we can reduce to the
case that I has one element. By descent, we can assume that X is strictly totally disconnected.
Note that X × Div1 is a spatial diamond, and using [Sch17a, Proposition 20.15] we can reduce to
the case that X = Spa(C, C+) is strictly local (by writing any connected component as a coﬁltered
inverse limit of its open and closed neighborhoods to see that then any object is locally in the image
of the functor). Moreover, the category Dlc is unchanged if we replace Spa(C, C+) by Spa(C, OC),
so we can assume that X is even a geometric rank 1 point.
At this point, we need to simplify the coeﬃcient ring Λ. The algebra Λ is a Z/nZ-algebra
for some n prime to p; we can then assume n is a power of some prime ℓ̸= p, and in fact even
n = ℓby an induction argument. By [Sch17a, Proposition 20.15], we can also assume that Λ is a
ﬁnitely generated Fℓ-algebra. Taking a surjection from a polynomial algebra, one can then assume
that Λ = Fℓ[T1, . . . , Td]. Applying [Sch17a, Proposition 20.15] again, we can assume that Λ is the
localization of Fℓ[T1, . . . , Td] at a closed point, or applying faithfully ﬂat descent in the coeﬃcients,
that Λ is the completion of Fℓ[T1, . . . , Td] at a closed point, but equipped with the discrete topology.
Also note that this ring is regular, so all truncations of perfect complexes are perfect, and we can
assume that the complex is concentrated in degree 0.
We are now in the following situation.
We have an ´etale sheaf A of Λ ∼= Fℓr[[T1, . . . , Td]]-
modules on S = Spa C × Div1, such that for some ﬁnitely generated Λ-module M, there are ´etale
local isomorphisms between A and the constant Λ-module associated to M. Our goal is to see that
after pullback along the WE-torsor
eS = Spa C × Spd bE →S = Spa C × Div1,
there is an isomorphism between A and M. To see this, we will also need to analyze the behaviour
at a carefully chosen geometric point. In fact, by Lemma II.1.14 we can ﬁnd a point Spa K →YC
of the curve YC associated with C such that the induced map Gal(K|K) →IE is surjective. This
induces a point y : Spd K →S, and we can lift it to a geometric point ey : Spd bK →eS. Deﬁne M
as the stalk of A at ey; our goal is then to prove the existence of a unique isomorphism between A|eY
and M that is the identity at ey.
To prove this, we ﬁrst reduce modulo (T1, . . . , Td)n. Then Λn := Λ/(T1, . . . , Td)n is a ﬁnite ring,
and the space of isomorphisms between A and M is parametrized by a scheme ﬁnite ´etale over Y .
By [SW20, Lemma 16.3.2], all such ﬁnite ´etale covers come via pullback from ﬁnite ´etale covers of
Div1, and are thus trivialized after pullback to eY ; this implies that there is a unique isomorphism
A/(T1, . . . , Td)n ∼= M/(T1, . . . , Td)n reducing to the identity at ey.
Taking the limit over n, we get an isomorphism bA|eY ∼= c
M|eY between the pro-´etale sheaves bA =
lim
←−n A/(T1, . . . , Td)n and c
M = lim
←−n M/(T1, . . . , Td)n after pullback to eY . This gives in particular
an automorphism of c
M over
eY ×Y eY ∼= WE × eY ,
and thus by connectedness of eY a continuous map WE →AutΛ(c
M) (in fact, it extends continuously
to the absolute Galois group of E). We claim that this map is trivial on an open subgroup of IE
(but not necessarily on an open subgroup of the absolute Galois group of E — here it is necessary
to pass to the Weil group). Indeed, restricting the map WE →AutΛ(c
M) to Gal(K|K) gives a

166
IV. GEOMETRY OF DIAMONDS
map Gal(K|K) →AutΛ(c
M) that is in fact continuous for the discrete topology on the target,
as a local system of A-modules on Spd K is given a continuous representation of Gal(K|K). As
Gal(K|K) →IE is surjective, we get the claim.
By equivariance under an open subgroup of IE, we ﬁnd that the isomorphism bA|eY ∼= c
M|eY
descends, necessarily uniquely, to an isomorphism over
Spa C × Spd E′
for some ﬁnite extension E′| ˘E. Now we take the pushforward of the isomorphism bA|Spa C×Spd E′ ∼=
c
M|Spa C×Spd E′ to the ´etale site of Spa C × Spd E′. As any ´etale U →Spa C × Spd E′ is locally
connected, we have H0(U, M) = H0(U, c
M) and then also H0(U, A) = H0(U, bA) (as A is ´etale locally
isomorphic to M) for all such U, so we get the desired isomorphism A|Spa C×Spd E′ ∼= M|Spa C×Spd E′.
□

CHAPTER V
D´et(BunG)
In this chapter, we want to understand the basic structure of D´et(BunG, Λ), building it up from
all D´et(Bunb
G, Λ), where we continue to work in the setting where Λ is killed by some integer n
prime to p.
Throughout this chapter, we ﬁx an algebraically closed ﬁeld k|Fq and work on Perfk. Our goal
is to prove the following theorem.
Theorem V.0.1 (Theorem V.3.7, Proposition V.3.6; Proposition V.2.2, Theorem V.1.1; Theo-
rem V.4.1; Theorem V.5.1; Theorem V.7.1). Let Λ be any ring killed by some integer n prime to
p.
(o) For any b ∈B(G), there is a map
πb : Mb →BunG
that is representable in locally spatial diamonds, partially proper and cohomologically smooth, where
Mb parametrizes G-bundles E together with an increasing Q-ﬁltration whose associated graded is,
at all geometric points, isomorphic to Eb with its slope grading. The v-stack Mb is representable in
locally spatial diamonds, partially proper and cohomologically smooth over [∗/Gb(E)].
(i) Via excision triangles, there is an inﬁnite semiorthogonal decomposition of D(BunG, Λ) into the
various D(Bunb
G, Λ) for b ∈B(G).
(ii) For each b ∈B(G), pullback along
Bunb
G ∼= [∗/ eGb] →[∗/Gb(E)]
gives an equivalence
D([∗/Gb(E)], Λ) ∼= D(Bunb
G, Λ),
and D([∗/Gb(E)], Λ) ∼= D(Gb(E), Λ) is equivalent to the derived category of the category of smooth
representations of Gb(E) on Λ-modules.
(iii) The category D(BunG, Λ) is compactly generated, and a complex A ∈D(BunG, Λ) is compact
if and only if for all b ∈B(G), the restriction
ib∗A ∈D(Bunb
G, Λ) ∼= D(Gb(E), Λ)
is compact, and zero for almost all b. Here, compactness in D(Gb(E), Λ) is equivalent to lying in
the thick triangulated subcategory generated by c-IndGb(E)
K
Λ as K runs over open pro-p-subgroups
of Gb(E).
167

168
V. D´et(BunG)
(iv) On the subcategory D(BunG, Λ)ω ⊂D(BunG, Λ) of compact objects, there is a Bernstein–
Zelevinsky duality functor
DBZ : (D(BunG, Λ)ω)op →D(BunG, Λ)ω
with a functorial identiﬁcation
R Hom(A, B) ∼= π♮(DBZ(A) ⊗L
Λ B)
for B ∈D(BunG, Λ), where π : BunG →∗is the projection. The functor DBZ is an equivalence,
and D2
BZ is naturally equivalent to the identity. It is compatible with usual Bernstein–Zelevinsky
duality on D(Gb(E), Λ) for basic b ∈B(G).
(v) An object A ∈D(BunG, Λ) is universally locally acyclic (with respect to BunG →∗) if and only
if for all b ∈B(G), the restriction
ib∗A ∈D(Bunb
G, Λ) ∼= D(Gb(E), Λ)
is admissible, i.e. for all pro-p open subgroups K ⊂Gb(E), the complex (ib∗A)K is perfect. Univer-
sally locally acyclic complexes are preserved by Verdier duality, and satisfy Verdier biduality.
V.1. Classifying stacks
First, we want to understand D´et([∗/G], Λ) for a locally pro-p-group G. Fix a coeﬃcient ring
Λ such that nΛ = 0 for some n prime to p, and assume that G is locally pro-p. Our aim is to prove
the following theorem.
Theorem V.1.1. Let D(G, Λ) be the derived category of the category of smooth representations
of G on Λ-modules. There is a natural symmetric monoidal equivalence
D(G, Λ) ≃D´et([∗/G], Λ)
under which the functor D(G, Λ) →D(Λ) forgetting the G-action gets identiﬁed with the pullback
functor D´et([∗/G], Λ) →D´et(∗, Λ) = D(Λ) under the projection ∗→[∗/G].
The same result holds true for the base change [Spa C/G] = [∗/G] × Spa C for any complete
algebraically closed nonarchimedean ﬁeld C/k; more precisely, the base change functor
D´et([∗/G], Λ) →D´et([Spa C/G], Λ)
is an equivalence.
Note that indeed
D´et(∗, Λ) = D(Λ).
This follows from applying [Sch17a, Theorem 1.13 (ii)] to the small v-stack X = ∗. In fact, for
any complete algebraically closed ﬁeld C, one has D´et(Spa C, Λ) = D(Λ) and there is a sequence
D(Λ) −→D´et(∗, Λ)
fully faithful
−−−−−−−−−→D´et(Spa C, Λ) = D(Λ)
and D(Λ) →D´et(∗, Λ) is thus an equivalence.

V.1. CLASSIFYING STACKS
169
Proof. We start by constructing a functor
D(G, Λ) →D´et([∗/G], Λ)
compatible with the derived tensor product and the forgetful functors. For this, one ﬁrst con-
structs a functor from the category of smooth representations of G on Λ-modules to the heart of
D´et([∗/G], Λ); note that this heart is a full subcategory of the heart of D([∗/G]v, Λ), which is the
category of v-sheaves on [∗/G]. Now one can send a smooth G-representation V to the v-sheaf
FV on [∗/G] that takes a perfectoid space X with a G-torsor e
X →X to the set of all continuous
G-equivariant maps from | e
X| to V . In fact one checks that for any perfectoid space S and any
locally proﬁnite set A,
|S × A| = |S| × A,
and thus | e
X| has a continuous G-action. As v-covers induce quotient maps by [Sch17a, Proposition
12.9], this is indeed a v-sheaf. Moreover, after pullback along ∗→[∗/G], it is given by the functor
which sends X to the set of continuous G-equivariant maps from |X|×G = |X ×G| to V . These are
canonically the same (via restriction to X ×{1}) as continuous maps |X| →V , so that FV |∗= V is
the v-sheaf corresponding to V . As V is discrete, this is a disjoint union of points, and in particular
(after pullback to any Spa C) an ´etale sheaf. According to [Sch17a, Deﬁnition 14.13], this implies
that FV ∈D´et([∗/G], Λ), as desired.
From now on, we will simply write V for FV . Given any complex of smooth G-representations
V •, one can form the corresponding complex V • of v-sheaves on [∗/G], which deﬁnes an object
of D´et([∗/G], Λ) ⊂D([∗/G]v, Λ) (using [Sch17a, Proposition 14.16]), giving the desired functor
D(G, Λ) →D´et([∗/G], Λ) compatible with the forgetful functors. One checks that this functor is
compatible with derived tensor products by unraveling the deﬁnitions.
To check whether the functor is an equivalence, we may by [Sch17a, Theorem 1.13 (ii)] replace
[∗/G] by its base change [Spa C/G] = [∗/G]×Spa C, where C is some complete algebraically closed
nonarchimedean ﬁeld.
For the v-stack X = [Spa C/G], we can also consider its ´etale site X´et ⊂Xv consisting of all
Y ∈Xv which are ´etale (and locally separated) over X. This recovers a classical site.
Lemma V.1.2. The ´etale site X´et is equivalent to the category G- Set of discrete G-sets, via
sending a discrete set S with continuous G-action to [S × Spa C/G].
Proof. It is clear that the functor S 7→[S × Spa C/G] maps to X´et ⊂Xv (as the pullback to
Spa C is given by S × Spa C), and is fully faithful. Conversely, if Y →X = [Spa C/G] is ´etale,
then the pullback of Y to Spa C is a discrete set, on which G acts continuously, giving the descent
datum deﬁning Y .
□
Lemma V.1.3. There is a natural equivalence D(G, Λ) ≃D(G- Set, Λ), such that the following
diagram commutes
D(G, Λ)
∼
=
/

D(G- Set, Λ)
∼
=
/ D([Spa C/G]´et, Λ)

D´et([∗/G], Λ) 
/ D´et([Spa C/G], Λ).

170
V. D´et(BunG)
Proof. It is enough to give an equivalence of abelian categories between smooth G-representations
on Λ-modules, and sheaves of Λ-modules on discrete G-sets. The construction of the functor is as
before, and it is clearly fully faithful. But any sheaf of Λ-modules F on G- Set comes from the
smooth G-representation V = lim
−→H⊂G F(G/H), where H runs over all open subgroups of G. One
directly veriﬁes that the diagram commutes.
□
It remains to see that the natural functor
D([Spa C/G]´et, Λ) →D´et([Spa C/G], Λ)
is an equivalence. We claim that this reduces to the case that G is pro-p: We ﬁrst reduce fully
faithfulness to this case. For this, we have to see that, if λ : Xv →X´et denotes the map of sites,
then for any A ∈D([Spa C/G]´et, Λ), the natural map
A →Rλ∗λ∗A
is an equivalence. This can be checked locally on [Spa C/G]´et, meaning that we can replace G
by an open pro-p-subgroup. Similarly, for essential surjectivity, one needs to see that for all B ∈
D´et([Spa C/G], Λ), the map λ∗Rλ∗B →B is an equivalence, which can again be checked locally.
Thus, we can assume that G is pro-p. Note that ([Spa C/G]´et, Λ) is locally of cohomological
dimension 0, as there is no continuous group cohomology of pro-p-groups on Λ-modules if nΛ = 0
for n prime to p. This implies (cf. [Sta, Tag 0719]) that D([Spa C/G]´et, Λ) is left-complete. As
D´et([Spa C/G], Λ) is also left-complete by [Sch17a, Proposition 14.11], it is enough to see that the
functor
D+([Spa C/G]´et, Λ) →D+
´et([Spa C/G], Λ)
is an equivalence. First, we check fully faithfulness, i.e. that the unit id →Rλ∗λ∗of the adjunction
is an equivalence. For this, it is enough to see that for any ´etale sheaf of Λ-modules, i.e. any smooth
G-representation V , one has
RΓ([Spa C/G]v, V ) = V G,
i.e. its H0 is V G and there are no higher Hi. However, one can compute v-cohomology using the
Cech nerve for the cover Spa C →[Spa C/G], which produces the complex of continuous cochains,
giving the desired result.
Finally, for essential surjectivity, it is now enough to check on the heart. But if F is a v-sheaf
on [Spa C/G] whose pullback to Spa C is an ´etale sheaf, then this pullback is a disjoint union of
points, thus separated and ´etale, and therefore F is itself a v-stack which is ´etale over [Spa C/G],
and so deﬁnes an object in the topos [Spa C/G]´et.
□
Corollary V.1.4. The operation
RHomΛ(−, Λ) : D´et([∗/G], Λ)op →D´et([∗/G], Λ)
corresponds to the derived smooth duality functor
A 7→(A∗)sm : D(G, Λ)op →D(G, Λ)
induced on derived categories by the left-exact smooth duality functor
V 7→(V ∗)sm = {f : V →Λ | ∃H ⊂G open ∀h ∈H, v ∈V : f(hv) = f(v)}.

V.2. ´ETALE SHEAVES ON STRATA
171
Proof. The operation A 7→(A∗)sm on D(G, Λ) satisﬁes the adjunction
HomD(G,Λ)(B, (A∗)sm) = HomD(G,Λ)(B ⊗L
Λ A, Λ)
for all B ∈D(G, Λ). As RHomΛ(−, Λ) is characterized by the similar adjunction in D´et([∗/G], Λ),
we get the result.
□
V.2. ´Etale sheaves on strata
We want to describe D´et(BunG, Λ) via its strata Bunb
G. For this, we need the following result
saying roughly that connected Banach–Colmez spaces are “contractible”.
Proposition V.2.1. Let f : S′ →S be a map of small v-stacks that is a torsor under BC(E)
resp. BC(E[1]), where E is a vector bundle on XS that is everywhere of positive (resp. negative)
slopes. Then the pullback functor
f∗: D´et(S, Λ) →D´et(S′, Λ)
is fully faithful.
Proof. By descent [Sch17a, Proposition 17.3, Remark 17.4], the problem is v-local on S,
and in particular one can assume that the torsor is split. In the positive case, we can use Corol-
lary II.3.3 (iv) to ﬁnd pro-´etale locally on S a short exact sequence
0 →OXS( 1
2r)m′ →OXS(1
r)m →E →0,
inducing a similar sequence on Banach–Colmez spaces. This reduces us to the case E = OXS( 1
n)
for some n (as then pullback under BC(OXS(1
r)m) →S is fully faithful, as is pullback under
BC(OXS(1
r)m) →S′ = BC(E)). In that case, BC(E) is a 1-dimensional perfectoid open unit ball
over S by Proposition II.2.5 (iv), in particular cohomologically smooth. It suﬃces to see that Rf!
is fully faithful, for which it suﬃces that for all A ∈D´et(S, Λ), the adjunction map
Rf!Rf!A →A
is an equivalence. But note that both Rf! and Rf! commute with any base change by [Sch17a,
Proposition 22.19, Proposition 23.12].
Thus, we may by passage to stalks reduce to the case
S = Spa(C, C+) where C is a complete algebraically closed nonarchimedean ﬁeld and C+ ⊂C an
open and bounded valuation subring, and in fact we only need to check the statement on global
sections. If the stalk of A at the closed point s ∈S is zero, then the same holds true for Rf!Rf!A
as Rf!A agrees with f∗A up to twist, so this follows from proper base change, [Sch17a, Theorem
19.2]. This allows us to reduce to the case that A is constant, and then as both Rf! and Rf!
commute with all direct sums, even to the case A = Λ. Thus, we are reduced to the computation
of the cohomology of the perfectoid open unit disc.
The case of negative Banach–Colmez spaces follows by taking an exact sequence
0 →E →OXS(d)m →G →0
and using the exact sequence
0 →BC(OXS(d)m) →BC(G) →BC(E[1]) →0.
□
Now we can formulate the desired result.

172
V. D´et(BunG)
Proposition V.2.2. For any b ∈B(G), the map
Bunb
G = [∗/ eGb] →[∗/Gb(E)]
induces via pullback an equivalence
D´et(Gb(E), Λ) ∼= D´et([∗/Gb(E), Λ]) ∼= D´et([∗/ eGb], Λ).
Moreover, for any complete algebraically closed nonarchimedean ﬁeld C/k, the map
D´et([∗/ eGb], Λ) →D´et([Spa C/ eGb], Λ)
is an equivalence.
Proof. Using [Sch17a, Theorem 1.13] and Theorem V.1.1, it is enough to prove that the
functor
D´et([Spa C/Gb(E)], Λ) →D´et([Spa C/ eGb], Λ)
is an equivalence. For this, it is enough to prove that pullback under the section [Spa C/Gb(E)] →
[Spa C/ eGb] induces a fully faithful functor
D´et([Spa C/ eGb], Λ) →D´et([Spa C/Gb(E)], Λ),
which follows from Proposition V.2.1.
□
We see that D´et(BunG, Λ) is glued from the categories D´et(Bunb
G, Λ) ∼= D(Gb(E), Λ), which are
entirely representation-theoretic.1 In particular, this implies that the base ﬁeld plays no role:
Corollary V.2.3. For any complete algebraically closed nonarchimedean ﬁeld C and any lo-
cally closed substack U ⊂BunG, the functor
D´et(U, Λ) →D´et(U × Spa C, Λ)
is an equivalence of categories.
Although this seems like a purely technical result, it will actually play a key role when we study
Hecke operators.
Proof. Fully faithfulness holds true by [Sch17a, Theorem 1.13 (ii)].
To see that it is an
equivalence of categories, it is enough to check on all quasicompact locally closed substacks U ⊂
BunG. These are stratiﬁed into ﬁnitely many locally closed substacks Bunb
G ⊂BunG, and we have
the corresponding excision exact sequences, so to get essential surjectivity, it is enough to check on
each stratum Bunb
G. Now it follows from Proposition V.2.2.
□
1It would be very interesting to understand the gluing of these categories in terms of pure representation theory.

V.3. LOCAL CHARTS
173
V.3. Local charts
For any b ∈B(G) we wish to construct a chart
πb : Mb →BunG
whose image contains Bunb
G, such that πb is separated, representable in locally spatial diamonds
and cohomologically smooth, and whose geometry can be understood explicitly.
Example V.3.1. Before we discuss the general case, let us brieﬂy discuss the ﬁrst interesting
case, namely G = GL2 and the non-basic element b corresponding to O(1) ⊕O. In that case, we
let Mb be the moduli space of extensions
0 →L →E →L′ →0
where L is of degree 0 and L′ is of degree 1. Mapping such an extension to E deﬁnes the map
Mb →BunG.
Note that there is a natural E× × E×-torsor f
Mb →Mb, parametrizing isomorphisms L ∼= O
and L′ ∼= O(1). On the other hand, it is clear that f
Mb = BC(O(−1)[1]) is a negative absolute
Banach–Colmez space; thus, Mb is very explicit.
Any extension E parametrized by Mb is either isomorphic to O⊕O(1), or to O(1
2). The ﬁbres of
πb : Mb →BunGL2 over a rank 2 bundle E are given by an open subset of the projectivized Banach–
Colmez space (BC(E)\{0})/E×. Thus, these ﬁbres interpolate between (BC(O(1
2))\{0})/E×, which
is cohomologically smooth by Proposition II.3.7, and
(BC(O ⊕O(1)) \ {0})/E× = (E × D \ {0})/E×.
The latter is still cohomologically smooth, although E × D is not — the quotient by E× gets rid
of the disconnected nature of the space. In this case, and in fact in complete generality for all
b ∈B(GLn), one can actually check cohomological smoothness of πb by hand.
To handle the
general case, we had to prove the Jacobian criterion, Theorem IV.4.2.
Coming back to the general case, we can in fact construct all Mb together, as follows.
Definition V.3.2. The v-stack M is the moduli stack taking S ∈Perfk to the groupoid of G-
bundles E on XS together with an increasing separated and exhaustive Q-ﬁltration (ρ∗E)≤λ ⊂ρ∗E
(ranging over algebraic representations ρ : G →GLn, and compatible with exact sequences and
tensor products) on the corresponding ﬁbre functor such that (letting (ρ∗E)<λ = S
λ′<λ(ρ∗E)≤λ′)
the quotient
(ρ∗E)λ = (ρ∗E)≤λ/(ρ∗E)<λ
is a semistable vector bundle of slope λ, for all λ ∈Q and representations ρ : G →GLn.
Note that by passing to the associated graded, M maps to the moduli stack of G-bundles in the
category of Q-graded vector bundles on XS where the weight λ piece is semistable of slope λ. By
Proposition III.4.7, this is isomorphic to F
b∈B(G)[∗/Gb(E)]. In particular M decomposes naturally
into a disjoint union
M =
G
b∈B(G)
Mb,

174
V. D´et(BunG)
and for each b ∈B(G), we have natural maps
qb : Mb →[∗/Gb(E)].
Example V.3.3. When G = GLn, M sends S to the groupoid of ﬁltered vector bundles
0 = Fil0 E ⊊Fil1 E ⊊· · · ⊊Filr E = E for some r, such that Fili+1 E/ Fili E is semistable and
the slopes (µ(Fili+1 E/ Fili E))0≤i<r form an increasing sequence (the opposite condition to the one
deﬁning the Harder–Narasimhan ﬁltration of a vector bundle). The maps qb send such a vector
bundle to the graded vector bundle Lr−1
i=0 Fili+1 E/ Fili E.
Example V.3.4. Suppose G is quasisplit. Let Mb be the centralizer of the slope morphism, as
a Levi subgroup. Let Pb be the parabolic subgroup with Levi Mb such that the weight of νb on
Lie Pb are positive. There is a diagram
BunPb
BunG
BunMb
induced by the inclusion Pb ⊂G and the quotient map Pb →Mb. There is a cartesian diagram
Mb
BunPb
Bunb
Mb
BunMb .
Proposition V.3.5. For any b ∈B(G), the map
qb : Mb →[∗/Gb(E)].
is partially proper, representable in locally spatial diamonds, and cohomologically smooth, of dimen-
sion ⟨2ρ, νb⟩. In fact, after pullback along ∗→[∗/Gb(E)], it is a successive torsor under negative
Banach–Colmez spaces.
In particular, Mb is a cohomologically smooth Artin v-stack, of dimension ⟨2ρ, νb⟩.
Proof. It suﬃces to check everything after pullback by the v-cover ∗→[∗/Gb(E)], f
Mb →Mb.
Let eG →XS be the automorphism group of Eb →XS, see Proposition III.5.2, the pure inner
twisting of G × XS by Eb.
This is equipped with a parabolic subgroup eG≤0, and moreover a
ﬁltration ( eG≤λ)λ≤0 with unipotent radical eG<0. This is the opposite parabolic subgroup to the
one used in the proof of Proposition III.5.1. Then f
Mb(S) is identiﬁed with the set of eG<0-torsors.
The result is deduced using the description of the graded pieces of ( eG≤λ)λ<0 as vector bundles of
negative slopes.
□
We ﬁrst prove some structural results about Mb and its universal Gb(E)-torsor f
Mb →Mb. A
general theme here is the subtle distinction between the absolute property of being a (locally spatial)
diamond (which f
Mb is not, but it has a large open part f
M◦
b ⊂f
Mb that is) and the relative notion
of f
Mb →∗being representable in (locally spatial) diamonds (which f
Mb is), and some related subtle
distinctions on absolute and relative quasicompactness.

V.3. LOCAL CHARTS
175
Proposition V.3.6. The map Mb →[∗/Gb(E)] has a section [∗/Gb(E)] →Mb given by the
closed substack where E is (at every geometric point) isomorphic to Eb, in which case (ρ∗E)≤λ ⊂ρ∗E
is a splitting of the Harder–Narasimhan ﬁltration of ρ∗E for all representations ρ : G →GLn.
Consider the open complement M◦
b = Mb \ [∗/Gb(E)], with preimage f
M◦
b = f
Mb \ {∗}. Then
f
M◦
b is a spatial diamond.
Moreover, if Uπ = νN
b (π) ∈Gb(E) for any large enough N (so that νN
b
: Gm →Gb is a
well-deﬁned cocharacter), then f
M◦
b/UZ
π →∗is proper.
Proof. To check that the substack where E is at every geometric point isomorphic to Eb is
closed, note that by semicontinuity it suﬃces to see that everywhere on Mb, the Newton point of
E is bounded by b. By [RR96, Lemma 2.2 (iv)], this reduces to the case of G = GLn, where it is
a simple consequence of the Harder–Narasimhan formalism (the Newton polygon of an extension
is always bounded by the Newton polygon of the split extension). On this closed substack, E has
two transverse ﬁltrations, given by (ρ∗E)≤λ and the Harder–Narasimhan ﬁltration; it follows that E
upgrades to a G-bundle in Q-graded vector bundles on the Fargues–Fontaine curve, with the weight
λ-piece semistable of slope λ. We see that this gives the desired section of Mb →[∗/Gb(E)], using
again Proposition III.4.7.
We claim that the action of Uπ on | f
Mb ×k Spa k((t))| satisﬁes the hypotheses of Lemma II.2.17,
with ﬁxed point locus given by the closed subspace ∗considered in the previous paragraph. Writing
f
Mb as a successive extension of Banach–Colmez spaces, it is clear that for all x ∈| f
Mb ×k Spa k((t))|
which are not in the closed substack, the sequence U−n
π (x) leaves any quasicompact open subspace
for large n: Look at the ﬁrst step in the successive extensions where x does not project to the origin.
Then x gives an element in the ﬁber over the origin, which is a negative Banach–Colmez space,
on which Uπ = νN
b (π) acts via a positive power of π; thus U−n
π (x) leaves any quasicompact open
subspace of this Banach–Colmez space. In particular, it follows that the ﬁxed points locus of Uπ is
precisely the origin. To apply Lemma II.2.17, it remains to see that for all x ∈| f
Mb ×k Spa k((t))|
and quasicompact open neighborhoods U of the origin, one has γm(x) ∈U for all suﬃciently large
m. This can be reduced to the case of GLn by the Tannakian formalism, so assume G = GLn for
this argument. Now ﬁx a map f : Spa(C, C+) →f
Mb ×k Spa k((t)) having x in its image; it suﬃces
to construct a map
Spa(C, C+) × N ∪{∞} →f
Mb ×k Spa k((t))
whose restriction to Spa(C, C+) × {0} is f and which is equivariant for the γ-action, with γ acting
on the left via shift on the proﬁnite set N∪{∞}. The map f classiﬁes some Q-ﬁltered vector bundle
E≤λ ⊂E of rank n on XC with L
λ Eλ ∼= Eb as Q-graded vector bundles. After pullback to YC,[1,q],
the ﬁltration is split, so we can ﬁnd an isomorphism
α : E|YC,[1,q] ∼= Eb|YC,[1,q]
of Q-ﬁltered vector bundles on YC,[1,q], such that α reduces on graded pieces to the given identiﬁ-
cation. The descent datum is now given by some isomorphism of Q-ﬁltered vector bundles
β : ϕ∗(Eb|YC,[q,q]) ∼= Eb|YC,[1,1]

176
V. D´et(BunG)
that reduces to the standard Frobenius on graded pieces. In other words, β is the standard Frobenius
on Eb multiplied by some
β′ : Eb|YC,[1,1] ∼= Eb|YC,[1,1]
and with respect to the Q-grading on Eb, the map β′ is the identity plus a lower triangular matrix.
The action of γ replaces β′ by its Uπ-conjugate. This multiplies all lower triangular entries by
powers of π, so
(β′, γ(β′), γ2(β′), . . . , 1)
composed with the standard Frobenius deﬁnes an isomorphism
ϕ∗(Eb|YS,[q,q]) ∼= Eb|YS,[1,1]
where S = Spa(C, C+)×N ∪{∞}. Using this as a descent datum deﬁnes a Q-ﬁltered vector bundle
on XS deﬁning the required map
S = Spa(C, C+) × N ∪{∞} →f
Mb ×k Spa k((t)).
This ﬁnishes the veriﬁcation of the hypotheses of Lemma II.2.17.
It is clear from the deﬁnition that f
M◦
b →∗is partially proper (as the theory of vector bundles
on the Fargues–Fontaine curve does not depend on R+). Thus, to show that f
M◦
b/UZ
π →∗is proper,
it suﬃces to see that the map is quasicompact, which can be checked after base change to Spa k((t));
then it follows from the previous discussion and Lemma II.2.17.
It remains to see that f
M◦
b is a spatial diamond. For this, we pick a representative b ∈G( ˘E) of
the σ-conjugacy class that is decent in the sense of [RZ96, Deﬁnition 1.8]. In particular, b ∈G(Es)
for some unramiﬁed extension Es|E of degree s, and f
M◦
b is already deﬁned over PerfFqs. Let Frobs
be the Frobenius x 7→xqs. As b is decent, the action of Uπ = νN
b (π) on f
M◦
b agrees with the action
of a power of Frobs for N large enough. We know that
f
M◦
b/UZ
π ×k Spa k((t))
is a spatial diamond (as it is proper over Spa k((t))).
Replacing Uπ by Frobs, and moving the
quotient by Frobenius to the other factor (which is allowed as the absolute Frobenius acts trivially
on topological spaces) one sees that also
f
M◦
b ×k Spa k((t))/ FrobZ
s
is a spatial diamond. But Spa k((t))/ FrobZ
s →∗is proper and cohomologically smooth. Thus,
Lemma II.3.8 shows that it is a spatial v-sheaf. By [Sch17a, Theorem 12.18], to see that f
M◦
b is a
spatial diamond, it suﬃces to check on points. Writing f
Mb as a successive extension of Banach–
Colmez spaces, any point in f
M◦
b has a minimal step where it does not map to the origin. Then
its image is a nontrivial point of an absolute Banach–Colmez space, and a punctured absolute
Banach–Colmez space is a diamond by Proposition II.3.7; the result follows.
□
The following theorem gives the desired local charts for BunG; its proof is based on the Jacobian
criterion for (cohomological) smoothness, Theorem IV.4.2.

V.4. COMPACT GENERATION
177
Theorem V.3.7. The map πb : Mb →BunG forgetting the ﬁltration is partially proper, repre-
sentable in locally spatial diamonds, and cohomologically smooth of ℓ-dimension ⟨2ρ, νb⟩.
The image of πb is open, and consists exactly of the set of points of | BunG | specializing to b.
Proof. Let S →BunG be some map for an aﬃnoid perfectoid space S, given by some G-bundle
E on XS. Then Mb ×BunG S parametrizes Q-ﬁltrations on E whose associated graded Q-bundle
corresponds to b. Such Q-ﬁltrations are parametrized by sections of a smooth projective ﬂag variety
Z = E/P →Xalg
S
for some parabolic P ⊂G ×E Xalg
S . Moreover, the condition on the associated
graded bundle and Proposition III.5.2 imply that Mb is an open subspace of Msm
Z , so the ﬁrst
sentence follows from Theorem IV.4.2.
For the ﬁnal assertion, note that by cohomological smoothness, the image must be open. Con-
versely, if b′ ∈| BunG | is in the image, then it follows from the explicit degeneration used in the
proof Proposition V.3.6 that Bunb
G lies in the closure of Bunb′
G, giving the desired result.
□
This ﬁnal assertion was proved in the case of G = GLn by Hansen [Han17], as a step towards
the identiﬁcation of | BunG |; indeed, [BFH+17] determines the image of πb for G = GLn.
V.4. Compact generation
We are now revisiting the notion of ﬁnite type smooth representation in terms of D´et(BunG, Λ).
The goal of this section is to prove the following theorem. As above, we ﬁx some coeﬃcient
ring Λ such that nΛ = 0 for some n prime to p.
Theorem V.4.1. For any locally closed substack U ⊂BunG, the triangulated category D´et(U, Λ)
is compactly generated. An object A ∈D´et(U, Λ) is compact if and only if for all b ∈B(G) contained
in U, the restriction
ib∗A ∈D´et(Bunb
G, Λ) ∼= D(Gb(E), Λ)
along ib : Bunb
G ⊂BunG is compact, and zero for almost all b. Here, compactness in D(Gb(E), Λ)
is equivalent to lying in the thick triangulated subcategory generated by c-IndGb(E)
K
Λ as K runs over
open pro-p-subgroups of Gb(E).
To prove the theorem, we exhibit a class of compact projective generators. The key result is
that f
Mb behaves like a strictly local scheme; in some vague sense, f
Mb is the strict henselization of
BunG at b.
Proposition V.4.2. Let b ∈B(G). For any A ∈D´et( f
Mb, Λ) with stalk A0 = i∗A ∈D´et(∗, Λ) ∼=
D(Λ) at the closed point i : ∗⊂f
Mb, the map
RΓ( f
Mb, A) →A0
is an isomorphism. In particular, RΓ( f
Mb, −) commutes with all direct sums.
Proof. Replacing A by the cone of A →i∗A0, we can assume that A = j!A′ for some A′ ∈
D´et( f
M◦
b, Λ). We have to see that
RΓ( f
Mb, j!A′) = 0.

178
V. D´et(BunG)
But this follows from Theorem IV.5.3 (applied with X = f
M◦
b and S = Spa k((t)), noting that base
change along S →∗follows from smooth base change), using that the partial compactiﬁcation
f
M◦
b ⊂f
Mb is precisely a compactiﬁcation towards one of the two ends of f
M◦
b, as follows from the
behaviour of the Frobenius action exhibited in the proof of Proposition V.3.6.
□
Remark V.4.3.
(i) Consider the v-sheaf X = Spd(k[[x1, . . . , xd]]) and the quasicompact open subset U = Spd(k[[x1, . . . , xd]])\
V (x1, . . . , xd) that is representable by a perfectoid space. When base changed to S = Spa(k((t))),
X becomes isomorphic to an open unit disk, U becomes the punctured unit disk that has two ends:
the origin and the exterior of the disk. The picture is thus analogous to the preceding one with
f
Mb, and for any A ∈D´et(X, Λ) one has RΓ(X, A) ∼= i∗A where i : Spd(k) ,→X is V (x1, . . . , xd).
(ii) This applies more generally to the v-sheaf associated to any W(k)-aﬃne formal scheme Spf(R)
with R an I-adic ring. Then, for any A ∈D´et(Spd(R), Λ) one has RΓ(Spd(R), A) = RΓ(Spd(R/I), i∗A)
with i : Spd(R/I) ,→Spd(R). In particular, for A ∈D´et(Spd(R) \ V (I), Λ), where here Spd(R) \
V (I) is representable by a spatial diamond and even a perfectoid space if R is a k-algebra, one has
RΓ(Spd(R) \ V (I), A) ∼= RΓ(Spd(R/I), i∗Rj∗A).
Thus, Proposition V.4.2 can be seen as a result about “nearby cycles on the strict henselianization
of BunG at b”.
Corollary V.4.4. Let b ∈B(G) and let K ⊂Gb(E) be an open pro-p-subgroup. Then for any
A ∈D´et( f
Mb/K, Λ) with pullback A0 = i∗A ∈D´et([∗/K], Λ) ∼= D(K, Λ) corresponding to a complex
V of smooth K-representations, the map
RΓ( f
Mb/K, A) →RΓ([∗/K], A0) ∼= V K
is an isomorphism. In particular, RΓ( f
Mb/K, −) commutes with all direct sums.
Proof. This follows formally from Proposition V.4.2 by descent along ψ : f
Mb →f
Mb/K; more
precisely, by writing any A as a direct summand of ψ∗ψ∗A.
□
Remark V.4.5. Let
i : [∗/Gb(E)] ,→Mb ←- M◦
b : j
be the usual diagram. From the corollary, one deduces that if one regards
i∗Rj∗A ∈D´et([∗/Gb(E)], Λ) ∼= D(Gb(E), Λ)
as a complex of Gb(E)-representations, then this is given by
RΓ( f
M◦
b, A).
As f
M◦
b is qcqs (and of ﬁnite cohomological dimension) by Proposition V.3.6, this commutes with
all direct sums in A.
For example, in the case of GL2 and Eb = O(1) ⊕O, one has
f
M◦
b = BC(O(−1)[1]) \ {0} = Spa k((t1/p∞))/SL1(D)
by Example II.3.12 and Example V.3.1. Thus, in this case one compute
i∗Rj∗A = RΓ(Spa k((t1/p∞))/SL1(D), A)

V.4. COMPACT GENERATION
179
which is a very explicit formula. If one would use the presentation
BC(O(−1)[1]) × Spa C = (A1
C♯)♦/E
instead, it would be considerably more diﬃcult to compute the answer. In particular, we critically
used quasicompacity of the absolute f
M◦
b, its base change f
M◦
b ×k Spa C is no longer quasicompact.
This highlights the importance of working with absolute objects, and of using the right local charts.
In fact, Theorem V.3.7, smooth base change, and this formula for i∗Rj∗show that the gluing
of the representation-theoretic strata D´et(Bunb
G, Λ) ∼= D(Gb(E), Λ) into D´et(BunG, Λ) is encoded
in the spaces f
M◦
b, showing that the local charts Mb are of fundamental and not just technical
importance.
Now we can prove Theorem V.4.1.
Proof of Theorem V.4.1. As for closed immersions i, the functor i∗preserves compact ob-
jects, it is enough to handle the case that U is an open substack. Let b ∈|U| ⊂BunG ∼= B(G) be
any point of U, and let K ⊂Gb(E) be an open pro-p-subgroup, giving rise to the map
fK : f
Mb/K →BunG .
By Corollary V.4.4 and Theorem V.3.7, we see that Ab
K := RfK!Rf!
KΛ ∈D´et(BunG, Λ) is compact;
in fact,
R Hom(Ab
K, B) ∼= R Hom(Rf!
KΛ, Rf!
KB) ∼= R Hom(Rf!
KΛ, f∗
KB ⊗L
Λ Rf!
KΛ)
∼= RΓ( f
Mb/K, f∗
KB) ∼= (ib∗B)K.
From this computation, we see that the collection of objects Ab
K for varying b ∈|U| and K ⊂Gb(E)
open pro-p form a class of compact generators: Indeed, if B is nonzero, then (ib∗B)K must be
nonzero for some b and K.
To prove the characterization of compact objects, we argue by induction on the number of
points of |U|, noting that any compact object must be concentrated on a quasicompact substack,
and thus on ﬁnitely many points.
So assume that |U| is ﬁnite, b ∈|U| is a closed point and
j : V = U \ {b} ⊂U is the open complement, so we know the result for V . It suﬃces to prove that
j∗preserves compact objects. Indeed, then A ∈D´et(U, Λ) is compact if and only if j∗A and ib∗A
are compact, and this gives by induction the desired characterization.
To see that j∗preserves compact objects, we can check on the given generators. For generators
Ab′
K corresponding to b′ ̸= b we get j∗Ab′
K = Ab′
K, so there is nothing to prove. On the other hand,
j∗Ab
K = Rf◦
K!f◦!
KΛ for
f◦
K : f
M◦
b/K →V ⊂BunG .
The compactness of j∗Ab
K then follows from RΓ( f
M◦
b/K, −) commuting with all direct sums. But
this is true as f
M◦
b is a spatial diamond of ﬁnite dim. trg, by Proposition V.3.6 and Proposition V.3.5,
and taking cohomology under K is exact.
□

180
V. D´et(BunG)
V.5. Bernstein–Zelevinsky duality
We note that one can deﬁne a Bernstein–Zelevinsky involution on (the compact objects of)
D´et(BunG, Λ). More precisely, we have the following result. Here, in anticipation of some functor
introduced later, we write
π♮: D´et(BunG, Λ) →D(∗, Λ) = D(Λ) : A 7→Rπ!(A ⊗L
Λ Rπ!Λ)
for the left adjoint of π∗, π : BunG →∗.
Theorem V.5.1. For any compact object A ∈D´et(BunG, Λ), there is a unique compact object
DBZ(A) ∈D´et(BunG, Λ) with a functorial identiﬁcation
R Hom(DBZ(A), B) ∼= π♮(A ⊗L
Λ B)
for B ∈D´et(BunG, Λ). Moreover, the functor DBZ is a contravariant autoequivalence of D´et(BunG, Λ)ω,
and D2
BZ is naturally isomorphic to the identity.
If U ⊂BunG is an open substack and A is concentrated on U, then so is DBZ(A). In particular,
DBZ restricts to an autoequivalence of the compact objects in D´et(Bunb
G, Λ) ∼= D(Gb(E), Λ) for
b ∈B(G) basic, and in that setting it is the usual Bernstein–Zelevinsky involution.
Proof. By the Yoneda lemma, the uniqueness of DBZ(A) is clear. For the existence, it suﬃces
to check on a system of generators, like A = ib
! c-IndGb(E)
K
Λ for varying b ∈B(G) and K ⊂Gb(E)
open pro-p. In that case, DBZ(A) = Ab
K by Corollary V.4.4. This also shows that if A is concentrated
on U, then so is DBZ(A).
Now note that
R Hom(DBZ(A), B) ∼= π♮(A ⊗L
Λ B) ∼= π♮(B ⊗L
Λ A) ∼= R Hom(DBZ(B), A).
In particular, taking B = DBZ(A), we see that there is a natural functorial map D2
BZ(A) →A.
We claim that this is an equivalence. It suﬃces to check on generators. We have seen that the
Bernstein–Zelevinsky dual of ib
! c-IndGb(E)
K
Λ is Ab
K. Its restriction to Bunb
G is again ib
! c-IndGb(E)
K
Λ,
so one easily checks that the map D2
BZ(A) →A is an isomorphism over Bunb
G. To see that it is
an isomorphism everywhere, one needs to see that if B = Rj∗B′, B′ ∈D´et(U, Λ) for some open
substack j : U ⊂BunG not containing Bunb
G, then
π♮(Ab
K ⊗L
Λ B) = 0.
Twisting a few things away and using the deﬁnition of Ab
K = RfK!Rf!
KΛ, this follows from the
assertion that for all A′ ∈D´et( f
M◦
b/K, Λ), with jK : f
M◦
b/K ,→f
Mb/K the open immersion, one
has
RΓc( f
Mb/K, RjK∗A′) = 0.
Using the trace map for f
Mb →f
Mb/K, this follows from Theorem IV.5.3, applied as before with
X = f
M◦
b and S = Spa k((t)), noting that base change along S →∗holds by smooth base change
and is conservative.
The comparison to Bernstein–Zelevinsky duality follows formally by taking B corresponding
to the regular representation of Gb(E), in which case π♮(A ⊗L
Λ B) is isomorphic to the underlying
chain complex of A. Moreover, as the regular representation has two commuting Gb(E)-actions,

V.6. VERDIER DUALITY
181
there is a residual Gb(E)-action, which is the usual action on A. This gives the usual deﬁnition of
the Bernstein–Zelevinsky involution as R Hom into the regular representation.
□
V.6. Verdier duality
It turns out that one can also understand how Verdier duality acts on D´et(BunG, Λ). The key
result is the following.
Theorem V.6.1. Let j : V ,→U be an open immersion of open substacks of BunG. For any
A ∈D´et(V, Λ), the natural map
j!RHomΛ(A, Λ) →RHomΛ(Rj∗A, Λ)
is an isomorphism in D´et(U, Λ).
Note that one always has
Rj∗RHomΛ(A, Λ) = RHomΛ(j!A, Λ);
the theorem asserts that this is also true with j! and Rj∗exchanged, which is related to a local
biduality statement: If A ∈D´et(V, Λ) is reﬂexive, the theorem implies formally that j!A ∈D´et(U, Λ)
is reﬂexive.
Proof. We can assume that U and V are quasicompact, and then by induction, we can assume
that V = U \ {b} for some closed b ∈|U|. The map is clearly an isomorphism over V , so it suﬃces
to see that for the compact objects
Ab
K = RfK!f!
KΛ, fK : f
Mb/K →U ⊂BunG,
one gets an isomorphism after applying R Hom(Ab
K, −). As R Hom(Ab
K, B) = (ib∗B)K, we see that
the left-hand side
R Hom(Ab
K, j!RHomΛ(A, Λ)) = 0
vanishes.
On the other hand, using the left adjoint π♮: D´et(BunG, Λ) →D(∗, Λ) ∼= D(Λ) of
pullback, we have
R Hom(Ab
K, RHomΛ(Rj∗A, Λ)) ∼= R Hom(Ab
K ⊗L
Λ Rj∗A, Λ) ∼= R Hom(π♮(Ab
K ⊗L
Λ Rj∗A), Λ).
But by Theorem V.5.1, and the identiﬁcation of the Bernstein–Zelevinsky dual of Ab
K as ib
! c-IndGb(E)
K
Λ,
one has
π♮(Ab
K ⊗L
Λ Rj∗A) ∼= R Hom(ib
! c-IndGb(E)
K
Λ, Rj∗A) ∼= R Hom(c-IndGb(E)
K
Λ, Rib!Rj∗A) = 0.
□
Recall that as a cohomologically smooth Artin stack of dimension 0, BunG admits a dualizing
complex DBunG ∈D´et(BunG, Λ) that is locally isomorphic to Λ[0].
Theorem V.6.2. For any open substack U ⊂BunG, an object A ∈D´et(U, Λ) is reﬂexive,
i.e. the natural map
A →RHomΛ(RHomΛ(A, DU), DU)
is an equivalence, if and only if for all b ∈B(G) lying in U with corresponding locally closed stratum
ib : Bunb
G →U, the restriction
ib∗A ∈D´et(Bunb
G, Λ) = D´et([∗/ eGb], Λ) ∼= D´et([∗/Gb(E)], Λ) = D(Gb(E), Λ)

182
V. D´et(BunG)
is reﬂexive as a complex of admissible Gb(E)-representations; this means that the complex of K-
invariants is reﬂexive in D(Λ) for all open pro-p-subgroups K ⊂Gb(E).
In the deﬁnition of reﬂexivity, we can replace DU by Λ (as this changes the dual by a twist,
and then the bidual stays the same). The theorem follows immediately from the following result.
Lemma V.6.3. Let U ⊂BunG be an open substack and A ∈D´et(U, Λ). For any b ∈B(G) lying
in U, there is a natural isomorphism
ib∗RHomΛ(RHomΛ(A, Λ), Λ) ∼= RHomΛ(RHomΛ(ib∗A, Λ), Λ).
Proof. We may assume that U ⊂BunG is the set of generalizations of b, and let j : V =
U \ {b} ,→U. Let B = j∗A. Using the exact triangle
j!B →A →ib
∗ib∗A →,
and the invertibility of ib!Λ (as Bunb
G is also cohomologically smooth), it is enough to prove that
ib∗RHomΛ(RHomΛ(j!B, Λ), Λ) = 0.
But RHomΛ(j!B, Λ) = Rj∗RHomΛ(B, Λ), and by Theorem V.6.1,
RHomΛ(Rj∗RHomΛ(B, Λ), Λ) = j!RHomΛ(RHomΛ(B, Λ), Λ).
□
V.7. ULA sheaves
Finally, we want to classify the objects A ∈D´et(BunG, Λ) that are universally locally acyclic
with respect to BunG →∗. Our goal is to prove the following theorem. This gives a geometric
interpretation of the classical notion of admissible representation in terms of D´et(BunG, Λ).
Theorem V.7.1. Let A ∈D´et(BunG, Λ). Then A is universally locally acyclic with respect to
BunG →∗if and only if for all b ∈B(G), the pullback ib∗A to ib : Bunb
G ,→BunG corresponds
under D´et(Bunb
G, Λ) ∼= D(Gb(E), Λ) to a complex Mb of smooth Gb(E)-representations for which
MK
b
is a perfect complex of Λ-modules for all open pro-p subgroups K ⊂Gb(E).
We want to use Proposition IV.2.32. As preparation, we need to understand D´et(BunG × BunG, Λ).
More generally, we have the following result.
Proposition V.7.2. Let G1 and G2 be two reductive groups over E, and let G = G1 × G2.
Then BunG ∼= BunG1 × BunG2, giving rise to an exterior tensor product
−⊠−: D´et(BunG1, Λ) × D´et(BunG2, Λ) →D´et(BunG, Λ).
For all compact objects Ai ∈D´et(BunGi, Λ), i = 1, 2, the exterior tensor product A1 ⊠A2 ∈
D´et(BunG, Λ) is compact, these objects form a class of compact generators, and for all further
objects Bi ∈D´et(BunGi, Λ), i = 1, 2, the natural map
R Hom(A1, B1) ⊗L
Λ R Hom(A2, B2) →R Hom(A1 ⊠A2, B1 ⊠B2)
is an isomorphism.

V.7. ULA SHEAVES
183
Remark V.7.3. The proposition says that as Λ-linear presentable stable ∞-categories, the
exterior tensor product functor
D´et(BunG1, Λ) ⊗D(Λ) D´et(BunG2, Λ) →D´et(BunG, Λ)
is an equivalence.
Proof. We use the compact generators Ai = Abi
Ki for certain bi ∈B(Gi), Ki ⊂Gi,bi(E) open
pro-p. These give rise to b = (b1, b2) ∈B(G) and K = K1 × K2 ⊂Gb(E) = G1,b1(E) × G2,b2(E),
and using
Mb ∼= Mb1 × Mb2
and the K¨unneth formula, one concludes that A1 ⊠A2 ∼= Ab
K, which is again compact. As B(G) =
B(G1) × B(G2) and open pro-p subgroups of the form K1 × K2 ⊂Gb(E) are coﬁnal, we see that
these objects form a set of compact generators.
Moreover, as R Hom(Ab
K, B) = (ib∗B)K for all B ∈D´et(BunG, Λ) and similarly for Abi
Ki, we also
see that the map
R Hom(Ab1
K1, B1) ⊗L
Λ R Hom(Ab2
K2, B2) →R Hom(Ab
K, B1 ⊠B2)
is an isomorphism. As these objects generate, the same follows for all compact A1, A2.
□
Now we can prove Theorem V.7.1.
Proof of Theorem V.7.1. By Proposition IV.2.32, we see that A being universally locally
acyclic is equivalent to the map
p∗
1RHom(A, Λ) ⊗L
Λ p∗
2A →RHom(p∗
1A, p∗
2A)
in D´et(BunG × BunG, Λ) ∼= D´et(BunG×G, Λ) being an isomorphism.
By Proposition V.7.2, this is equivalent to being an isomorphism after applying R Hom(A1 ⊠
A2, −) for varying compact Ai ∈D´et(BunGi, Λ). Using Proposition V.7.2, the left-hand side is
given by
R Hom(A1, RHom(A, Λ)) ⊗L
Λ R Hom(A2, A) ∼= R Hom(π♮(A1 ⊗L
Λ A), Λ) ⊗L
Λ R Hom(A2, A).
The right-hand side is, using π : BunG →∗for the projection,
R Hom(A1 ⊠A2, RHom(p∗
1A, p∗
2A)) ∼= R Hom((A1 ⊗L
Λ A) ⊠A2, p∗
2A)
∼= R Hom(p∗
1(A1 ⊗L
Λ A), p∗
2RHomΛ(A2, A))
∼= R Hom(A1 ⊗L
Λ A, Rp1∗p∗
2RHomΛ(A2, A))
∼= R Hom(A1 ⊗L
Λ A, π∗R Hom(A2, A))
∼= R Hom(π♮(A1 ⊗L
Λ A), R Hom(A2, A)),
using usual adjunctions and smooth base change for p2 and π several times. Under these isomor-
phisms, the map
R Hom(π♮(A1 ⊗L
Λ A), Λ) ⊗L
Λ R Hom(A2, A) →R Hom(π♮(A1 ⊗L
Λ A), R Hom(A2, A))

184
V. D´et(BunG)
is the natural map. This is an isomorphism as soon as π♮(A1⊗L
ΛA) ∈D(Λ) is perfect for all compact
A1. In fact, the converse is also true: If one takes A2 = DBZ(A1), then R Hom(A2, A) = π♮(A1⊗L
ΛA),
and hence it follows that for M = π♮(A1 ⊗L
Λ A) ∈D(Λ), the map
R Hom(M, Λ) ⊗L
Λ M →R Hom(M, M)
is an isomorphism, which means that M is dualizable in D(Λ), i.e. perfect.
Now we use the system of compact generators given by ib
! c-IndGb(E)
K
Λ for varying b ∈B(G),
with locally closed immersion ib : Bunb
G →BunG, and K ⊂Gb(E) open pro-p. This translates the
condition on perfectness of Rπ!(A1 ⊗L
Λ Rπ!Λ ⊗L
Λ A) into the desired condition on stalks.
□

CHAPTER VI
Geometric Satake
As before, we ﬁx a nonarchimedean local ﬁeld E with residue ﬁeld Fq of characteristic p and a
uniformizer π ∈E. Recall that for any perfectoid space S over Fq, we deﬁned the “curve” YS over
OE, as well as YS = YS \ V (π) and the quotient XS = YS/ϕZ.
In this chapter, we are interested in studying modiﬁcations of G-torsors on these spaces, and
perverse sheaves on such. Our discussion will mirror this three-step procedure of the construction
of XS: If one has understood the basic theory over YS, the basic results carry over easily to YS
and then to XS. While as in previous chapters our main focus is on XS, in this chapter we will
actually make critical use of YS in order to degenerate to the Witt vector aﬃne Grassmannian, and
hence to apply some results from the setting of schemes (notably the decomposition theorem). As
the discussion here is very much of a local sort, one can usually reduce easily to the case that G is
split, and hence admits a (split) reductive model over OE, and we will often ﬁx such a split model
of G.
For any d ≥0, we consider the moduli space Divd
Y parametrizing degree d Cartier divisors
D ⊂YS. For aﬃnoid S, one can form the completion B+ of OXS along D. Inverting D deﬁnes a
localization B of B+. One can then deﬁne a positive loop group L+
Divd
YG and loop group LDivd
YG,
with values given by G(B+) resp. G(B); for brevity, we will simply write L+G and LG here. One
can then deﬁne the local Hecke stack
HckG,Divd
Y = [L+G\LG/L+G] →Divd
Y
We will often break symmetry, and ﬁrst take the quotient on the right to deﬁne the Beilinson–
Drinfeld Grassmannian
GrG,Divd
Y = LG/L+G →Divd
Y
so that
HckI
G = L+G\ GrI
G .
The Beilinson–Drinfeld Grassmannian GrG,Divd
Y →Divd
Y is a small v-sheaf that can be written
as an increasing union of closed subsheaves that are proper and representable in spatial diamonds,
by bounding the relative position; this is one main result of [SW20]. On the other hand, L+G can
be written as an inverse limit of truncated positive loop groups, which are representable in locally
spatial diamonds and cohomologically smooth; moreover, on each bounded subset, it acts through
such a ﬁnite-dimensional quotient. This essentially reduces the study of all bounded subsets of
HckG,Divd
Y to Artin stacks.
185

186
VI. GEOMETRIC SATAKE
For any small v-stack S →Divd
Y, we let
HckG,S/Divd
Y = HckG,Divd
Y ×Divd
YS
be the pullback. Let
D´et(HckG,S/Divd
Y, Λ)bd ⊂D´et(HckG,S/Divd
Y, Λ)
be the full subcategory of all objects with quasicompact support over Divd
Y. This is a monoidal
category under convolution ⋆. Here, we use the convolution diagram
HckG,S/Divd
Y ×S HckG,S/Divd
Y
(p1,p2)
←−−−−L+G\LG ×L+G LG/L+G m
−→HckG,S/Divd
Y
and deﬁne
A ⋆B = Rm∗(p∗
1A ⊗L
Λ p∗
2B).
On D´et(HckG,S/Divd
Y, Λ)bd, one can deﬁne a relative perverse t-structure (where an object is
perverse if and only if it is perverse over any geometric ﬁbre of S), see Section VI.7. In particular,
this t-structure is compatible with any base change in S. For this t-structure, the convolution ⋆is
left t-exact (and t-exactness only fails for issues related to non-ﬂatness over Λ). To prove this, we
reinterpret convolution as fusion, and use some results on hyperbolic localization.
Moreover, one can restrict to the complexes A ∈D´et(HckG,S/Divd
Y, Λ)bd that are universally
locally acyclic over S. This condition is also preserved under convolution. For d = 1, or in general
when S maps to the locus of distinct untilts (Divd
Y)̸= ⊂Divd
Y, one can describe the category
of universally locally acyclic by the condition that the restriction to any Schubert cell is locally
constant with perfect ﬁbres. To prove that all such sheaves are universally locally acyclic, we also
introduce (for d = 1) the aﬃne ﬂag variety, in Section VI.5, and use their Demazure resolutions.
Definition VI.0.1. The Satake category
Sat(HckG,S/Divd
Y, Λ) ⊂D´et(HckG,S/Divd
Y, Λ)bd
is the category of all A ∈D´et(HckG,S/Divd
Y, Λ)bd that are perverse, ﬂat over Λ (i.e., for all Λ-modules
M, also A ⊗L
Λ M is perverse), and universally locally acyclic over (Div1)I.
Intuitively, Sat(HckG,S/Divd
Y, Λ) are the “ﬂat families of perverse sheaves on HckG,S/Divd
Y →
S”, where ﬂatness refers both to the geometric aspect of ﬂatness over S (encoded in universal
local acyclicity) and the algebraic aspect of ﬂatness in the coeﬃcients Λ. The Satake category
Sat(HckG,S/Divd
Y, Λ) is a monoidal category under convolution. The forgetful functor
Sat(HckG,S/Divd
Y, Λ) →D´et(GrG,S/Divd
Y, Λ)
is fully faithful. If d = 1 and S = Spd Fq, then one can compare it to the category considered by
Zhu [Zhu17] and Yu [Yu19], deﬁned in terms of the Witt vector aﬃne Grassmannian. Moreover,
the categories for S = Spd OC and S = Spd C are naturally equivalent to the category for S =
Spd Fq, via the base change functors; here C = bE. Thus, the Satake category is, after picking a
reductive model of G, naturally the same for the Witt vector aﬃne Grassmannian and the B+
dR-aﬃne
Grassmannian. At this point, we could in principle use Zhu’s results [Zhu17] (reﬁned integrally by
Yu [Yu19]) to identify the Satake category with the category of representations of bG, at least when

VI. GEOMETRIC SATAKE
187
G is unramiﬁed. However, for the applications we actually need ﬁner knowledge of the functoriality
of the Satake equivalence including the case for d > 1; we thus prove everything we need directly.
More precisely, we now switch to (Div1
X)d in place of Divd
Y, replacing also the use of YS by XS;
the two local Hecke stacks are locally isomorphic, so this poses no problems. For any ﬁnite set I,
let
HckI
G = HckG,(Div1
X)I
and consider the monoidal category
SatI
G(Λ) = Sat(HckI
G, Λ).
In fact, the monoidal structure naturally upgrades to a symmetric monoidal structure. This relies
on the fusion product, for which it is critical to allow general ﬁnite sets I. Namely, given ﬁnite sets
I1, . . . , Ik, letting I = I1 ⊔. . . ⊔Ik, one has an isomorphism
HckI
G ×(Div1)I(Div1)I;I1,...,Ik ∼=
k
Y
j=1
HckIj
G ×(Div1)I(Div1)I;I1,...,Ik
where (Div1)I;I1,...,Ik ⊂(Div1)I is the open subset where xi ̸= xi′ whenever i, i′ ∈I lie in diﬀerent
Ij’s. The exterior tensor product then deﬁnes a functor
⊠k
j=1 :
k
Y
j=1
SatIj
G(Λ) →SatI;I1,...,Ik
G
(Λ)
where SatI;I1,...,Ik
G
(Λ) is the variant of SatI
G(Λ) for HckI
G ×(Div1)I(Div1)I;I1,...,Ik. However, the re-
striction functor
SatI
G(Λ) →SatI;I1,...,Ik
G
(Λ)
is fully faithful, and the essential image of the exterior product lands in its essential image. Thus,
we get a natural functor
∗k
j=1 :
k
Y
j=1
SatIj
G(Λ) →SatI
G(Λ),
independent of the ordering of the Ij. In particular, for any I, we get a functor
SatI
G(Λ) × SatI
G(Λ) →SatI⊔I
G (Λ) →SatI
G(Λ),
using functoriality of SatJ
G(Λ) in J, which deﬁnes a symmetric monoidal structure ∗on SatI
G(Λ),
commuting with ⋆. This is called the fusion product. In general, for any symmetric monoidal
category (C, ∗) with a commuting monoidal structure ⋆, the monoidal structure ⋆necessarily agrees
with ∗; thus, the fusion product reﬁnes the convolution product. (As usual in geometric Satake, we
actually need to change ∗slightly by introducing certain signs into the commutativity constraint,
depending on the parity of the support of the perverse sheaves.)
Moreover, restricting A ∈SatI
G(Λ) to GrI
G and taking the pushforward to (Div1)I, all cohomol-
ogy sheaves are local systems of Λ-modules on (Div1)I. By a version of Drinfeld’s lemma, these
are equivalent to representations of W I
E on Λ-modules. This deﬁnes a symmetric monoidal ﬁbre
functor
F I : SatI
G(Λ) →RepW I
E(Λ),

188
VI. GEOMETRIC SATAKE
where RepW I
E(Λ) is the category of continuous representations of W I
E on ﬁnite projective Λ-modules.
Using a version of Tannaka duality, one can then build a Hopf algebra in the Ind-category of
RepW I
E(Λ) so that SatI
G(Λ) is given by its category of representations (internal in RepW I
E(Λ)). For
any ﬁnite set I, this is given by the tensor product of I copies of the corresponding Hopf algebra
for I = {∗}, which in turn is given by some aﬃne group scheme G
V
over Λ with WE-action.
Theorem VI.0.2 (Theorem VI.11.1). There is a canonical isomorphism G
V
∼= bG with the Lang-
lands dual group, under which the action of WE on G
V
agrees with the usual action of WE on bG up
to an explicit cyclotomic twist. If √q ∈Λ, the cyclotomic twist can be trivialized, and SatI
G(Λ) is
naturally equivalent to the category of ( bG ⋊WE)I-representations on ﬁnite projective Λ-modules.
For the proof, one can restrict to Λ = Z/ℓnZ; passing to a limit over n, one can actually
build a group scheme over Zℓ.
Its generic ﬁbre is reductive, as the Satake category with Qℓ-
coeﬃcients is (geometrically) semisimple: For this, we use the degeneration to the Witt vector
aﬃne Grassmannian and the decomposition theorem for schemes. To identify the reductive group,
we argue ﬁrst for tori, and then for rank 1 groups, where everything reduces to G = PGL2 which is
easy to analyze by using the minuscule Schubert cell. Here, the pinning includes a cyclotomic twist
as of course the cohomology of the minuscule Schubert variety P1 of GrPGL2 contains a cyclotomic
twist.
Afterwards, we apply hyperbolic localization in order to construct symmetric monoidal
functors SatG →SatM for any Levi M of G, inducing dually maps M
V
→G
V
. This produces many
Levi subgroups of G
V
Qℓfrom which it is easy to get the isomorphism with bGQℓ, including a pinning.
As these maps M
V
→G
V
are even deﬁned integrally, and bG(Zℓ) ⊂bG(Qℓ) is a maximal compact open
subgroup by Bruhat–Tits theory, generated by the rank 1 Levi subgroups, one can then deduce
that G
V
∼= bG integrally, again with an explicit (cyclotomic) pinning.
We will also need the following addendum regarding a natural involution. Namely, the local
Hecke stack HckI
G has a natural involution sw given by reversing the roles of the two G-torsors; in
the presentation in terms of LG, this is induced by the inversion on LG. Then sw∗induces naturally
an involution of SatI
G(Λ), and thus involution can be upgraded to a symmetric monoidal functor
commuting with the ﬁbre functor, thus realizing a WE-equivariant automorphism of ˇG ∼= bG.
Proposition VI.0.3 (Proposition VI.12.1). The action of sw∗on SatI
G induces the automor-
phism of bG that is the Chevalley involution of the split group bG, conjugated by bρ(−1).
VI.1. The Beilinson–Drinfeld Grassmannian
First, we deﬁne the base space of the Beilinson–Drinfeld Grassmannian for any d ≥0.
Definition VI.1.1. For any d ≥0, consider the small v-sheaves on PerfFq given by
Divd
Y = (Spd OE)d/Σd, Divd
Y = (Spd E)d/Σd, Divd
X = Divd = (Spd E/ϕZ)d/Σd,
where Σd is the symmetric group.
Proposition VI.1.2. For any d ≥0, there is a functorial injection
(i) from Divd
Y(S) into the set of closed Cartier divisors on YS,
(ii) from Divd
Y (S) into the set of closed Cartier divisors on YS,

VI.1. THE BEILINSON–DRINFELD GRASSMANNIAN
189
(iii) from Divd
X(S) into the set of closed Cartier divisors on XS.
Moreover, in case (i) and (ii), if S = Spa(R, R+) is aﬃnoid perfectoid, then for any closed Cartier
divisor D ⊂YS resp. D ⊂YS in the image of this embedding, the adic space D = Spa(Q, Q+) is
aﬃnoid. In case (iii), the same happens locally in the analytic topology on S.
Proof. We handle case (i) ﬁrst. Over (Spd OE)d and for S = Spa(R, R+) aﬃnoid, we get
d untilts R♯
i, i = 1, . . . , d of R, and there are elements ξi ∈WOE(R+) generating the kernel of
θi : WOE(R+) →R♯+
i . Each of the ξi deﬁnes a closed Cartier divisor by Proposition II.1.4. Then
ξ = Q
i ξi deﬁnes another closed Cartier divisor, given by Spa(A, A+) for A = WOE(R+)[ 1
[ϖ]]/ξ,
and A+ the integral closure of WOE(R+)/ξ, where ϖ ∈R is a pseudouniformizer.
Now the ideal sheaf of this closed Cartier divisor is a line bundle, and by [SW20, Proposition
19.5.3], line bundles on YS satisfy v-descent. Thus, even if we are only given a map S →Divd
Y =
(Spd OE)d/Σd, we can still deﬁne a line bundle I ⊂OYS, and it still deﬁnes a closed Cartier
divisor as this can be checked v-locally. Also, V (I) ⊂YS is quasicompact over S, as this can
again be checked v-locally. This implies that it is contained in some aﬃnoid YS,[0,n], and hence
D = Spa(A, A+) is aﬃnoid in general.
The case (ii) now follows formally by passing to an open subset, and case (iii) by passing to the
quotient under Frobenius.
□
Remark VI.1.3. As in [Far18a] one checks that Divd
Y(S) is the set of “relative Cartier divisors”
of degree d, that is to say Cartier divisors that give degree d Cartier divisors when pulled back via
any geometric point Spa(C, C+) →S. The same holds for Divd
Y and Divd
X.
In the following we will consider a perfectoid space S equipped with a map f : S →Divd
Y
(resp. f : S →Divd
Y , resp. f : S →Divd
X). We denote by DS ⊂YS (resp. DS ⊂YS, DS ⊂XS)
the corresponding closed Cartier divisor.
Let IS ⊂OYS (resp. IS ⊂OYS, IS ⊂OXS) be the
corresponding invertible ideal sheaf.
Let us note the following descent result for vector bundles.
Proposition VI.1.4. Sending S as above to the category of vector bundles on DS deﬁnes a
v-stack.
Proof. Any vector bundle on DS deﬁnes a v-sheaf on PerfS: This reduces formally to the
structure sheaf of DS, which then further reduces to the structure of OYS (resp. OYS, resp. OXS).
It remains to prove that v-descent of vector bundles is eﬀective. The case of XS reduces to YS as
locally on S, the relevant DS is isomorphic; and clearly YS reduces to YS.
Now assume ﬁrst that S = Spa(C, C+) for some complete algebraically closed C. Then DS
is given by a ﬁnite sum of degree 1 Cartier divisors on YS, and one can reduce by induction to
the case of degree 1 Cartier divisors, where the result is [SW20, Lemma 17.1.8] applied to the
corresponding untilt of S.
On the other hand, assume that T →S is an ´etale cover with a vector bundle ET on DT
equipped with a descent datum to DS; we want to prove descent to DS. By the argument of de
Jong–van der Put [dJvdP96, Proposition 3.2.2], cf. [KL15, Proposition 8.2.20], one can reduce to

190
VI. GEOMETRIC SATAKE
the case that T →S is a ﬁnite ´etale cover. Then DT →DS is also ﬁnite ´etale (as YT →YS is),
and the result follows from usual ﬁnite ´etale descent.
Now let S be general and T →S a v-cover with a vector bundle ET on DT equipped with a
descent datum to DS. For any geometric point Spa(C, C+) →S, one can descent ET×SSpa(C,C+) to
a vector bundle ESpa(C,C+) on DSpa(C,C+). Now we follow the proof of [SW20, Lemma 17.1.8] to
see that one can in fact descend ET in an ´etale neighborhood of Spa(C, C+), which is enough by the
previous paragraph. We can assume that S and T are aﬃnoid. As ESpa(C,C+) is necessarily free,
also ET×SSpa(C,C+) is free, and by an ´etale localization we can assume that ET is free. Then the
descent datum is given by some matrix with coeﬃcients in ODT ×ST . Moreover, by approximating
the basis coming via pullback from ESpa(C,C+), we can ensure that this matrix has coeﬃcients in
1+[ϖ]O+
YT ×ST (YT×ST,[0,n])/ξ for some n so that DS ⊂YS,[0,n]; here ξ is a generator of IS. Now one
uses that the v-cohomology group H1
v(S, O(Y[0,n])+) is almost zero, as follows from almost vanishing
in the perfectoid case, and writing it as a direct summand of the positive structure sheaf of the
base change to OE[π1/p∞]∧. Then the argument from [SW20, Lemma 17.1.8] applies, showing that
one can successively improve the basis to produce a basis invariant under the descent datum in the
limit.
□
Assuming that DS is aﬃnoid, as is the case locally on S, we let
B+
Divd
Y(S) (resp. B+
Divd
Y (S), resp. B+
Divd
X(S))
be (the global sections of) the completion of OYS along IS (resp. of OYS along IS, resp. of OXS
along IS), and
BDivd
(−)(S) = B+
Divd
(−)(S)[ 1
IS ].
This deﬁnes v-sheaves B+
Divd
(−) ⊂BDivd
(−) over Divd
(−) in all three cases. In the case of d = 1, those
rings are the ones that are usually denoted B+
dR, resp. BdR.
Definition VI.1.5. Let Z be an aﬃne scheme over OE.
The positive loop space L+
Divd
YZ
(resp. loop space LDivd
YZ) of Z is the v-sheaf over Divd
Y given by
S 7→L+
Divd
Y(S) = Z(B+
Divd
Y(S)) (resp. S 7→LDivd
Y(S) = Z(BDivd
Y(S))).
Similarly, if Z is an aﬃne scheme over E, one deﬁnes the positive loop space L+
Divd
Y Z and L+
Divd
XZ
(resp. loop space LDivd
Y Z and LDivd
XZ).
We note that we use aﬃnity of Z to see that these are actually v-sheaves. Now we can deﬁne
the local Hecke stacks.
Definition VI.1.6. Let G be a reductive group over OE (resp. over E, resp. over E). The
local Hecke stack HckG,Divd
Y (resp. HckG,Divd
Y , resp. HckG,Divd
X) is the functor sending an aﬃnoid
perfectoid S →Divd
Y (resp. S →Divd
Y , resp. S →Divd
X, assuming that DS is aﬃnoid) to the
groupoid of pairs of G-bundles E1, E2 over B+
Divd
Y(S) (resp. over B+
Divd
Y (S), resp. over B+
Divd
X(S))
together with an isomorphism E1 ∼= E2 over BDivd
Y(S) (resp. over BDivd
Y (S), resp. over BDivd
X(S)).

VI.1. THE BEILINSON–DRINFELD GRASSMANNIAN
191
Proposition VI.1.7. The local Hecke stack HckG,Divd
Y (resp. HckG,Divd
Y , resp. HckG,Divd
X) is a
small v-stack. There is a natural isomorphism of ´etale stacks over Divd
Y (resp. over Divd
Y , resp. over
Divd
X)
HckG,Divd
Y
∼= (L+
Divd
YG)\(LDivd
YG)/(L+
Divd
YG)
(resp.
HckG,Divd
Y
∼= (L+
Divd
Y G)\(LDivd
Y G)/(L+
Divd
Y G),
resp.
HckG,Divd
X
∼= (L+
Divd
XG)\(LDivd
XG)/(L+
Divd
XG).)
Proof. The category of vector bundles over B+
Divd
Y (resp. B+
Divd
Y , B+
Divd
X) satisﬁes v-descent:
It is enough to check this modulo powers of the ideal IS, where the result is Proposition VI.1.4.
By the Tannakian formalism, it follows that the category of G-bundles also satisﬁes v-descent, so
one can descend E1, E2. The isomorphism between E1 and E2 over BDivd
YS (resp. over BDivd
Y (S),
resp. over BDivd
X(S)) is then given by a section of an aﬃne scheme over the respective ring, which
again satisﬁes v-descent. Smallness follows from the argument of Proposition III.1.3.
Any G-bundle over B+
Divd
Y(S) is ´etale locally on S trivial. Indeed, if S is a geometric point then
B+
Divd
Y(S) is a product of complete discrete valuation rings with algebraically closed residue ﬁeld,
so that all G-torsors are trivial. In general, note that triviality of the G-torsor over B+
Divd
Y(S) is
implied by triviality modulo IS (as one can always lift sections over nilpotent thickenings). Then
the result follows from [GR03, Proposition 5.4.21]. Trivializing E1 and E2 ´etale locally then directly
produces the given presentations.
□
Similarly, one can deﬁne the Beilinson–Drinfeld Grassmannians.
Definition VI.1.8. Let G be a reductive group over OE (resp. over E, resp. over E). The
Beilinson–Drinfeld Grassmannian GrG,Divd
Y (resp. GrG,Divd
Y , resp. GrG,Divd
X) is the functor sending
an aﬃnoid perfectoid S →Divd
Y (resp. S →Divd
Y , resp. S →Divd
X, assuming again that DS is
aﬃnoid) to the groupoid of G-bundles E over B+
Divd
Y(S) (resp. over B+
Divd
Y (S), resp. over B+
Divd
X(S))
together with a trivialization of E over BDivd
Y(S) (resp. over BDivd
Y (S), resp. over BDivd
X(S)).
Proposition VI.1.9. The Beilinson–Drinfeld Grassmannian GrG,Divd
Y (resp. GrG,Divd
Y , resp. GrG,Divd
X)
is a small v-sheaf. There is a natural isomorphism of ´etale sheaves over Divd
Y (resp. over Divd
Y ,
resp. over Divd
X)
GrG,Divd
Y
∼= (LDivd
YG)/(L+
Divd
YG)
(resp.
GrG,Divd
Y
∼= (LDivd
Y G)/(L+
Divd
Y G),
resp.
GrG,Divd
X
∼= (LDivd
XG)/(L+
Divd
XG).)
Proof. The proof is identical to the proof of Proposition VI.1.7.
□

192
VI. GEOMETRIC SATAKE
The positive loop group L+
Divd
YG admits the natural ﬁltration by closed subgroups
(L+
Divd
YG)≥m ⊂L+
Divd
YG
deﬁned for all m ≥1 by the kernel of
G(B+
Divd
Y) →G(B+
Divd
Y/Im
S );
we refer to these as the principal congruence subgroups of L+
Divd
YG. Similar deﬁnitions of course
apply also over Divd
Y and Divd
X.
For d = 1, one can easily describe the graded pieces of this
ﬁltration (and again the result also holds for Div1
Y and Div1
X).
Proposition VI.1.10. There are natural isomorphisms
L+
Div1
YG/(L+
Div1
YG)≥1 ∼= G♦
and
(L+
Div1
YG)≥m/(L+
Div1
YG)≥m+1 ∼= (Lie G)♦{m}
where {m} signiﬁes a “Breuil-Kisin twist” by Im
S /Im+1
S
.
Proof. The ﬁrst equality follows directly from the deﬁnitions, while the second comes from
the exponential.
□
For general d, we still have the following result.
Proposition VI.1.11. For any d and m ≥1, the quotient
(L+
Divd
YG)≥m/(L+
Divd
YG)≥m+1
sends a perfectoid space S →Divd
Y with corresponding Cartier divisor DS ⊂YS with ideal sheaf IS
to
(Lie G ⊗OE Im
S /Im+1
S
)(S)
where Im
S /Im+1
S
is a line bundle on DS. This is representable in locally spatial diamonds, partially
proper, and cohomologically smooth of ℓ-dimension equal to d times the dimension of G.
Moreover, one can ﬁlter
(L+
Divd
YG)≥m/(L+
Divd
YG)≥m+1 ×Divd
Y (Div1
Y)d
with subquotients given by twists of
(Lie G)♦×Div1
Y,πi (Div1
Y)d
where πi : (Div1
Y)d →Div1
Y is the projection to the i-th factor.
Proof. The description of the subquotient follows from the exponential sequence again. To
check that it is representable in locally spatial diamonds, partially proper, and cohomologically
smooth, we can pull back to (Div1
Y)d, and then these properties follow from the existence of the
given ﬁltration. For this in turn, note that over (Div1
Y)d, we have d ideal sheaves I1, . . . , Id, and
one can ﬁlter ODS by ODS/I1, I1/I1I2, . . ., I1 · · · Id−1/I1 · · · Id, each of which is, after pullback
to an aﬃnoid perfectoid space S, isomorphic to OS♯
i .
□

VI.1. THE BEILINSON–DRINFELD GRASSMANNIAN
193
One can also show that the ﬁrst quotient is cohomologically smooth, but this is slightly more
subtle.
Proposition VI.1.12. For any d, the quotient
L+
Divd
YG/(L+
Divd
YG)≥1 →Divd
Y
parametrizes over a perfectoid space S →Divd
Y maps DS →G. For any quasiprojective smooth
scheme Z over OE, the sheaf
TZ →Divd
Y
taking a perfectoid S over Divd
Y to maps DS →Z is representable in locally spatial diamonds, par-
tially proper, and cohomologically smooth over Divd
Y of ℓ-dimension equal to d times the dimension
of Z; in particular, this applies to this quotient group.
Proof. The description of the quotient group is clear. To analyze TZ, we ﬁrst note that if Z
is an aﬃne space, then the result holds true, as was proved in the previous proposition. In fact,
after pullback via the quasi-pro-´etale surjective morphism (Div1
Y)d →Divd
Y, there is a sequence of
morphisms
TAn = W1 −→W2 −→· · · −→Wd+1 = (Div1
Y)d
where, for S aﬃnoid perfectoid with S →Wi+1 giving rise to the untilts (S♯
1, . . . , S♯
d) ∈(Div1
Y)d(S),
Wi ×Wi+1 S →S is locally on S isomorphic to An,♦
S♯
i .
If Z′ →Z is any separated ´etale map between schemes over OE, we claim that TZ′ →TZ is
also separated ´etale. For this, we analyze the pullback along any S →TZ given by some perfectoid
space S and a map DS →Z. Then D′ = DS ×Z Z′ →DS is separated ´etale, and the ﬁbre product
TZ′ ×TZ S parametrizes S′ →S with a lift DS′ →D′ over DS. By Lemma VI.1.13 below, this is
representable by a perfectoid space separated ´etale over S. In case Z′ →Z is an open immersion,
it follows that TZ′ →TZ is injective and ´etale, thus an open immersion.
Now note that for any geometric point of TZ, the corresponding map DS →Z has ﬁnite
image, and is thus contained in some open aﬃne subscheme. It follows that TZ admits an open
cover by TZ′ for aﬃne Z′. If Z is aﬃne, then one sees directly that TZ is representable in locally
spatial diamonds and partially proper by taking a closed immersion into An
OE for some n. For
cohomological smoothness, we observe that we can in fact choose these aﬃnes so that they admit
´etale maps to Ad
OE, as again we only need to arrange this at ﬁnitely many points at a time. Now
the result follows from the discussion of Ad
OE and of separated ´etale maps.
□
Lemma VI.1.13. Let S be a perfectoid space with a map S →Divd
Y giving rise to the Cartier
divisor DS ⊂YS. Let D′ →DS be a separated ´etale map. Then there is a separated ´etale map
S′ →S such that for T →S, maps T →S′ over S are equivalent to lifts DT →D′ over DS.
Proof. By descent of separated ´etale maps [Sch17a, Proposition 9.7], we can assume that S
is strictly totally disconnected. Exhausting D′ by a rising union of quasicompact subspaces, we can
assume that D′ is quasicompact. In any geometric ﬁbre, D′ is then a disjoint union of open subsets
(as any geometric ﬁbre is, up to nilpotents, a ﬁnite disjoint union of untilts Spa(C♯
i , C♯+
i )), and this
description spreads into a small neighborhood by [Sch17a, Proposition 11.23, Lemma 15.6]. We

194
VI. GEOMETRIC SATAKE
can thus reduce to the case that D′ →DS is an open immersion. Now the lemma follows from the
observation that the map |DS| →|S| is closed.
□
VI.2. Schubert varieties
Now we recall the Schubert varieties. Assume in this section that G is a split reductive group
over OE (or over E, but in that case we can always choose a model over OE). Fix a split torus
and Borel T ⊂B ⊂G. Note that we can always pass to the situation of split G by making a ﬁnite
´etale extension of OE resp. E; this way, the results of this section are useful in the general case.
Similarly, the cases of XS and YS reduce easily to the case of YS, so we only do the latter case
explicitly here.
Assume ﬁrst that d = 1. In that case, for every geometric point S = Spa(C, C+) →Div1
Y =
Spd OE given by an untilt S♯= Spa(C♯, C♯+) of S, one has B+
Div1
Y = B+
dR(C♯) and BDiv1
Y = BdR(C♯)
for the usual deﬁnition of B+
dR and BdR (relative to OE). Recall that B+
dR(C♯) is a complete discrete
valuation ring with residue ﬁeld C♯, fraction ﬁeld BdR(C♯), and uniformizer ξ. It follows that by
the Cartan decomposition
G(BdR(C♯)) =
G
µ∈X∗(T)+
G(B+
dR(C♯))µ(ξ)G(B+
dR(C♯)),
so as a set
HckG,Div1
Y(S)/∼= = X∗(T)+,
the dominant cocharacters of T. Recall that on X∗(T)+, we have the dominance order, where
µ ≥µ′ if µ −µ′ is a sum of positive coroots with Z≥0-coeﬃcients.
Remark VI.2.1. Since we work over Y and do not restrict ourselves to Y , we include the case
of the Cartier divisor π = 0. For this divisor, C♯= C and B+
dR(C♯) = WOE(C).
Definition VI.2.2. For any µ ∈X∗(T)+, let
HckG,Div1
Y,≤µ ⊂HckG,Div1
Y
be the subfunctor of all those maps S →HckG,Div1
Y such that at all geometric points S′ = Spa(C, C+) →
S, the corresponding S′-valued point is given by some µ′ ∈X∗(T)+ with µ′ ≤µ. Moreover,
GrG,Div1
Y,≤µ ⊂GrG,Div1
Y
is the preimage of HckG,Div1
Y,≤µ ⊂HckG,Div1
Y.
Recall the following result.
Proposition VI.2.3 ([SW20, Proposition 20.3.6]). The inclusion
HckG,Div1
Y,≤µ ⊂HckG,Div1
Y
is a closed subfunctor and
HckG,Div1
Y = lim
−→
µ
HckG,Div1
Y,≤µ;

VI.2. SCHUBERT VARIETIES
195
thus, similar properties hold for GrG,Div1
Y. Here, the index category is the partially ordered set of
µ’s under the dominance order, which is a disjoint union (over π1(G)) of ﬁltered partially ordered
sets.
The map GrG,Div1
Y,≤µ →Div1
Y is proper and representable in spatial diamonds.
Proof. It is enough to prove the assertions over GrG,Div1
Y as this is a v-cover of HckG,Div1
Y.
Then [SW20, Proposition 20.3.6] gives the results, except for the assertion that
GrG,Div1
Y = lim
−→
µ
GrG,Div1
Y,≤µ .
For this, note that the map from right to left is clearly an injection. For surjectivity, note that
for any quasicompact S with a map S →GrG,Div1
Y, only ﬁnitely many strata can be met, as the
meromorphic isomorphism of G-bundles necessarily has bounded poles. This, coupled with the
fact GrG,Div1
Y →Div1
Y is separated while GrG,Div1
Y,≤µ →Div1
Y is proper, implies that the map
F
µ GrG,Div1
Y,≤µ →GrG,Div1
Y is a v-cover, whence we get the desired surjectivity.
□
In particular,
HckG,Div1
Y,µ = HckG,Div1
Y,≤µ \
[
µ′<µ
HckG,Div1
Y,≤µ′ ⊂HckG,Div1
Y,≤µ
is an open subfunctor, and similarly its preimage GrG,Div1
Y,µ ⊂GrG,Div1
Y,≤µ. By the Cartan decom-
position, the space HckG,Div1
Y,µ has only one point in every geometric ﬁbre over Div1
Y. This point
can in fact be deﬁned as a global section
[µ] : Div1
Y →GrG,Div1
Y,µ
given by µ(ξ) ∈(LDiv1
YG)(S) whenever ξ is a local generator of IS; up to the action of L+
Div1
YG,
this is independent of the choice of ξ.
Proposition VI.2.4. The map
[µ] : Div1
Y →HckG,Div1
Y,µ
given by µ is a v-cover. This gives an isomorphism
HckG,Div1
Y,µ ∼= [Div1
Y/(L+
Div1
YG)µ]
where (L+
Div1
YG)µ ⊂L+
Div1
YG is the closed subgroup stabilizing the section [µ] of GrG,Div1
Y /Div1
Y.
Recalling the principal congruence subgroups
(L+
Div1
YG)≥m ⊂L+
Div1
YG,
we let
(L+
Div1
YG)≥m
µ
= (L+
Div1
YG)µ ∩(L+
Div1
YG)≥m ⊂(L+
Div1
YG)µ.
Then
(L+
Div1
YG)µ/(L+
Div1
YG)≥1
µ
∼= (P −
µ )♦⊂L+
Div1
YG/(L+
Div1
YG)≥1 ∼= G♦

196
VI. GEOMETRIC SATAKE
and
(L+
Div1
YG)≥m
µ
/(L+
Div1
YG)≥m+1
µ
∼= (Lie G)♦
µ≤m{m} ⊂(L+
Div1
YG)≥m/(L+
Div1
YG)≥m+1 ∼= (Lie G)♦{m},
where P −
µ ⊂G is the parabolic with Lie algebra (Lie G)µ≤0, and (Lie G)µ≤m ⊂Lie G is the subspace
on which µ acts via weights ≤m via the adjoint action.
In particular,
GrG,Div1
Y,µ ∼= L+
Div1
YG/(L+
Div1
YG)µ
is cohomologically smooth of ℓ-dimension ⟨2ρ, µ⟩over Div1
Y.
Proof. We ﬁrst handle the case G = GLn with its standard upper-triangular Borel and di-
agonal torus. In that case, µ is given by some sequence k1 ≥. . . ≥kn of integers, and GrG,Div1
Y,µ
parametrizes B+
Div1
Y-lattices
Ξ ⊂Bn
Div1
Y
that are of relative position µ at all points. Let S = Spa(R, R+) be an aﬃnoid perfectoid space
with a map S →Div1
Y = Spd OE given by an untilt S♯= Spa(R♯, R♯+) over OE of S. By the proof
of [SW20, Proposition 19.4.2], the R♯-modules
Fili
Ξ(R♯)n = (ξiΞ ∩B+
dR(R♯)n)/(ξiΞ ∩ξB+
dR(R♯)n)
are ﬁnite projective of rank equal to the number of occurrences of −i among k1, . . . , kn. Localizing,
we may assume that they are ﬁnite free. We may then pick a basis e1, . . . , en of (R♯)n so that
any Fili
Ξ(R♯)n is freely generated by a subset e1, . . . , eni of e1, . . . , en. Lifting eni−1+1, . . . , eni to
elements of fni−1+1, . . . , fni ∈ξiΞ∩B+
dR(R♯)n, and setting gni−1+1 = ξ−ifni−1+1, . . ., gni = ξ−ifni, or
equivalently gj = ξkjfj for j = 1, . . . , n, one sees that f1, . . . , fn form a B+
dR(R♯)-basis of B+
dR(R♯)n,
and g1, . . . , gn will form a B+
dR(R♯)-basis of Ξ. Thus, changing basis to the fi’s, one has moved Ξ
to the lattice
ξk1B+
dR(R♯) ⊕. . . ⊕ξknB+
dR(R♯).
This is the lattice corresponding to [µ] ∈GrGLn,Div1
Y, showing that the map
Div1
Y →HckGLn,Div1
Y,µ
is indeed surjective.
Moreover, the stabilizer (L+
Div1
Y GLn)µ of ξk1B+
dR(R♯) ⊕. . . ⊕ξknB+
dR(R♯) in L+
Div1
Y GLn is the
set of all matrices A = (Aij) ∈GLn(B+
Div1
Y) such that for i < j, Aij ∈ξki−kjB+
Div1
Y. This easily
implies the description of
(L+
Div1
Y GLn)µ/(L+
Div1
Y GLn)≥1
µ
∼= (P −
µ )♦⊂GL♦
n
and
(L+
Div1
Y GLn)≥m
µ
/(L+
Div1
Y GLn)≥m+1
µ
∼= (Lie GLn)♦
µ≤m{m} ⊂(Lie GLn)♦{m}.
The description also implies that (L+
Div1
Y GLn)µ contains L+
Div1
YP −
µ and (L+
Div1
YUa)≥µ(a) for any pos-
itive root a.

VI.2. SCHUBERT VARIETIES
197
In general, picking a closed immersion of G into GLn (compatible with the torus and the Borel),
one sees that
(L+
Div1
YG)µ/(L+
Div1
YG)≥1
µ
⊂(P −
µ )♦⊂G♦
and
(L+
Div1
YG)≥m
µ
/(L+
Div1
YG)≥m+1
µ
⊂(Lie G)♦
µ≤m{m} ⊂(Lie G)♦{m}
as these subquotients embed into the similar subquotient for GLn.
Moreover, one sees that
(L+
Div1
YG)µ contains L+
Div1
YP −
µ and (L+
Div1
YUa)≥µ(a) for any positive root a. These imply that the two
displayed inclusions are actually equalities.
A consequence of these considerations is that the map
L+
Div1
YG/(L+
Div1
YG)µ →L+
Div1
Y GLn /(L+
Div1
Y GLn)µ
is a closed immersion (as this happens on all subquotients for the principal congruence ﬁltra-
tion). The target is isomorphic to GrGLn,Div1
Y,µ, which contains GrG,Div1
Y,µ as a closed subspace (by
[SW20, Proposition 20.3.7]). We see that we get an inclusion
L+
Div1
YG/(L+
Div1
YG)µ ,→GrG,Div1
Y,µ ⊂GrGLn,Div1
Y,µ
of closed subspaces, with the same geometric points: This implies that it is an isomorphism (e.g.,
as the map is then necessarily a closed immersion, thus qcqs, so one can apply [Sch17a, Lemma
12.5]). From here, all statements follow.
□
Remark VI.2.5. The map
GrG,Div1
Y,µ = L+
Div1
YG/(L+
Div1
YG)µ →L+
Div1
YG/(L+
Div1
YG)≥1
µ
∼= (G/P−µ)♦
is the Bia lynicki-Birula map, see [CS17].
Passing to general d, we ﬁrst note that any geometric ﬁbre of
HckG,Divd
Y →Divd
Y
is isomorphic to a product of geometric ﬁbres of HckG,Div1
Y →Div1
Y.
More precisely, if f :
Spa(C, C+) →Divd
Y is a geometric point, it is given by an unordered tuple Spa(C♯
i , C♯+
i ), i ∈I with
|I| = d, of untilts over OE. Some of these may be equal, so one can partition I into sets I1, . . . , Ir
of equal untilts. Then we really have r untilts, given by maps f1, . . . , fr : Spa(C, C+) →Div1
Y, and
one has an isomorphism
HckG,Divd
Y ×Divd
Y,f Spa(C, C+) ∼=
r
Y
i=1
HckG,Div1
Y ×Div1
Y,fi Spa(C, C+),

198
VI. GEOMETRIC SATAKE
and similarly
L+
Divd
YG ×Divd
Y,f Spa(C, C+) ∼=
r
Y
i=1
L+
Div1
YG ×Div1
Y,fi Spa(C, C+),
LDivd
YG ×Divd
Y,f Spa(C, C+) ∼=
r
Y
i=1
LDiv1
YG ×Div1
Y,fi Spa(C, C+),
GrG,Divd
Y ×Divd
Y,f Spa(C, C+) ∼=
r
Y
i=1
GrG,Div1
Y ×Div1
Y,fi Spa(C, C+).
Indeed, it suﬃces to prove this on the level of the positive loop and loop group, where in turn it
follows from a similar decomposition of B+
Divd
Y after pullback, which is clear.
In particular, we can deﬁne the following version of Schubert varieties.
Definition VI.2.6. For any unordered collection µ• = (µj)j∈J of elements µj ∈X∗(T)+ with
|J| = d, let
HckG,Divd
Y,≤µ• ⊂HckG,Divd
Y
be the subfunctor of all those S →HckG,Divd
Y such that at all geometric points Spa(C, C+) →S,
then equipped with an (unordered) tuple of d untilts Spa(C♯
i , C♯+
i ), i ∈I with |I| = d, there is some
bijection between ψ : I ∼= J such that the relative position of E1 and E2 at Spa(C♯
i , C♯+
i ) is bounded
by
X
j∈J,C♯
ψ(j)∼
=C♯
i
µj.
Let
GrG,Divd
Y,≤µ• ⊂GrG,Divd
Y
be the preimage of HckG,Divd
Y,≤µ• ⊂HckG,Divd
Y.
Proposition VI.2.7. The inclusion
HckG,Divd
Y,≤µ• ⊂HckG,Divd
Y
is a closed subfunctor. The map GrG,Divd
Y,≤µ• →Divd
Y is proper, representable in spatial diamonds,
and of ﬁnite dim. trg.
Proof. This can be checked after pullback to (Div1
Y)d. Then it follows from [SW20, Propo-
sition 20.5.4].
□
Moreover, we have the following result. Here, we let
(L+
Divd
YG)<m = L+
Divd
YG/(L+
Divd
YG)≥m
be the quotient by the principal congruence subgroup.

VI.3. SEMI-INFINITE ORBITS
199
Proposition VI.2.8. For any µ• = (µj)j∈J as above, the action of L+
Divd
YG on GrG,Divd
Y,≤µ•
factors over (L+
Divd
YG)<m where m is chosen so that for µ = P
j∈J µj, all weights of µ on Lie G are
≤m.
Proof. We need to see that the action of (L+
Divd
YG)≥m is trivial. As everything is separated,
this can be checked on geometric points, where one reduces to d = 1 by a decomposition into
products. Then it follows from Proposition VI.2.4.
□
VI.3. Semi-inﬁnite orbits
For this section, we continue to assume that G is split, and again we only spell out the case of
Divd
Y; analogous results hold for Divd
Y and Divd
X, and follow easily from the case presented.
Previously, we stratiﬁed the aﬃne Grassmanian using the Cartan decomposition, the strata
being aﬃne Schubert cells. We now use the Iwasawa decomposition to obtain another stratiﬁcation
by semi-inﬁnite orbits.
Fix a cocharacter λ : Gm →T ⊂G, inducing a Levi Mλ with Lie algebra (Lie G)λ=0, a parabolic
Pλ = P +
λ with Lie algebra (Lie G)λ≥0 and its unipotent radical Uλ with Lie algebra (Lie G)λ>0. We
get an action of the v-sheaf Gm (taking an aﬃnoid perfectoid space S = Spa(R, R+) of characteristic
p to R×) on GrG,Divd
Y via the composition of the Teichm¨uller map
[·] : Gm →L+
Divd
YGm,
the map
L+
Divd
Yλ : L+
Divd
YGm →L+
Divd
YG
and the action of L+
Divd
YG on GrG,Divd
Y. We wish to apply Braden’s theorem in this setup. For this
purpose, we need to verify Hypothesis IV.6.1. To construct the required stratiﬁcation, we use the
aﬃne Grassmannian
GrPλ,Divd
Y
associated to the parabolic Pλ. Note that this admits a map
GrPλ,Divd
Y →GrMλ,Divd
Y →GrMλ,Divd
Y
where Mλ is the Levi quotient of Pλ and Mλ is the maximal torus quotient of Mλ (the cocenter).
Then GrMλ,Divd
Y admits a surjection from a disjoint union of copies of (Div1
Y)d parametrized by
X∗(Mλ)d. While there are many identiﬁcations between these copies, the sum µ := Pd
i=1 µi ∈
X∗(Mλ) deﬁnes a well-deﬁned locally constant function
(VI.3.1)
GrMλ,Divd
Y →X∗(Mλ).
More precisely, for Spa(C, C+) →GrMλ,Divd
Y a geometric point, let C♯
1, . . . , C♯
r be the corresponding
distinct untilts with 1 ≤r ≤d. Then
GrMλ,Divd
Y ×Divd
Y Spa(C, C+) ∼=
r
Y
i=1
GrMλ,Div1
Y ×Div1
Y Spa(C, C+)

200
VI. GEOMETRIC SATAKE
where the morphism Spa(C, C+) →Div1
Y is given by C♯
i on the i-th component of the product.
This is identiﬁed with
r
Y
i=1
X∗(Mλ) × Spa(C, C+)
and the weighted sum morphism X∗(Mλ)r →X∗(Mλ) (weighing each term with the multiplicity
of C♯
i as an untilt of C in the morphism Spa(C, C+) →Divd
Y) deﬁnes thus a function
GrMλ,Divd
Y ×Divd
Y Spa(C, C+) −→X∗(Mλ).
This deﬁnes the locally constant function of (VI.3.1).
For ν ∈X∗(Mλ) let
Grν
Pλ,Divd
Y ⊂GrPλ,Divd
Y
be the corresponding open and closed subset obtained as the preimage.
Proposition VI.3.1. The map
GrPλ,Divd
Y =
G
ν
Grν
Pλ,Divd
Y →GrG,Divd
Y
is bijective on geometric points, and it is a locally closed immersion on each Grν
Pλ,Divd
Y. The union
S
ν′≤ν Grν′
Pλ,Divd
Y has closed image in GrG,Divd
Y. The action of Gm via L+λ on GrPλ,Divd
Y extends to
an action of the monoid A1, and the Gm-ﬁxed points agree with GrMλ,Divd
Y.
Applying this proposition also in the case of the inverse Gm-action, and pulling back to a
relative Schubert variety, veriﬁes Hypothesis IV.6.1 in this situation.
Proof. The action of Gm on Pλ via conjugation extends to an action of the monoid A1.
Applying loop spaces to this observation and the observation that the map LDivd
YPλ →GrPλ,Divd
Y is
equivariant for the action of L+
Divd
YGm on the source via conjugation and on the target via the given
action (as we quotient by the right action of L+
Divd
YPλ) gives the action of the monoid L+
Divd
YA1,
and thus of A1 via restricting to Teichm¨uller elements. As everything is separated, this also shows
that Gm-ﬁxed points necessarily lie in the image of LDivd
YMλ, thus the Gm-ﬁxed points agree with
GrMλ,Divd
Y.
Bijectivity of the map
GrPλ,Divd
Y →GrG,Divd
Y
on geometric points follows from the Iwahori decomposition. It remains to prove that the map is
a locally closed immersion on each Grν
Pλ,Divd
Y, and the union over ν′ ≤ν is closed. Picking a closed
embedding into GLn, this reduces to the case G = GLn, and by writing any standard parabolic
as an intersection of maximal parabolics, we can assume that Pλ ⊂GLn is a maximal parabolic.
Passing to a higher exterior power, we can even assume that Pλ ⊂GLn is the mirabolic, ﬁxing
a one-dimensional quotient of the standard representation. In that case, GrGLn,Divd
Y parametrizes
ﬁnite projective B+
Divd
Y-modules M with an identiﬁcation M ⊗B+
Divd
Y
BDivd
Y
∼= Bn
Divd
Y, and GrPλ,Divd
Y

VI.3. SEMI-INFINITE ORBITS
201
parametrizes such M for which the image L ⊂BDivd
Y of M in the quotient Bn
Divd
Y →BDivd
Y :
(x1, . . . , xn) 7→xn is a line bundle over B+
Divd
Y. It also suﬃces to prove the result after pullback
along (Div1
Y)d →Divd
Y. Now the result follows from the next lemma.
□
In the following, the “relative position” of a B+-lattice L ⊂B to the standard lattice B+ ⊂B
refers to the image under the map
GrGm,Divd
Y →X∗(Gm) = Z
deﬁned above.
Lemma VI.3.2. Let S = Spa(R, R+) be an aﬃnoid perfectoid space over Fq with untilts S♯
i =
Spa(R♯
i, R♯+
i ) over OE for i = 1, . . . , n. Let ξi ∈WOE(R+) generate the kernel of θi : WOE(R+) →
R♯+
i
and let ξ = ξ1 · · · ξn. Let B+ be the ξ-adic completion of WOE(R+)[ 1
[ϖ]] where ϖ ∈R is a
pseudouniformizer, and let B = B+[1
ξ]. Finally, let
L ⊂B
be a ﬁnitely generated B+-module that is open and bounded, i.e. there is some integer N such that
ξNB+ ⊂L ⊂ξ−NB+ ⊂B.
For any m ∈Z, let Sm ⊂S be the subset of those points at which the relative position of L to
B+ ⊂B is given by m. Then S
m′≥m Sm′ is closed, and if Sm = S then the B+-module L is a line
bundle.
Proof. We can assume that L ⊂B+ via multiplying by a power of ξ. Let s ∈S be any
point, corresponding to a map Spa(K(s), K(s)+) →Sm. Let B+
s be the version of B+ constructed
from (K(s), K(s)+). Then B+
s is a ﬁnite product of discrete valuation rings, and the image Ls of
L ⊗B+ B+
s in B+
s is necessarily free of rank 1. Then s ∈Sm if and only if the length of B+
s /Ls
as B+
s -module is given by m. Localizing on S if necessary, we can ﬁnd an element l ∈L ⊂B
whose image in Ls is a generator. In a neighborhood of s, the element l generates a submodule
L′ = B+ · l ⊂L whose relative position to B+ is bounded above by m at all points by the next
lemma, and then the relative position of L ⊂B is also bounded above by m at all points as L′ ⊂L.
This gives the desired semicontinuity of the stratiﬁcation (noting that as L is open and bounded,
only ﬁnitely many values of m can appear). If Sm = S, then the containment L′ ⊂L has to be an
equality, and hence L = L′ is generated by l, so L is a line bundle.
□
Lemma VI.3.3. In the situation of the previous lemma, let f ∈B+ be any element, and consider
the map
|S| →Z≥0 ∪{∞}
sending any point s of S to the length of B+
s /f as B+
s -module. This map is semicontinuous in the
sense that for any m ≥0, the locus where it is ≤m is open.
Proof. For any i = 1, . . . , n, one can look at the closed subspace Si ⊂S where the image of f
in R♯
i vanishes. On the open complement of all Si, the function is identically 0. By induction, we
can thus pass to a closed subspace Si ⊂S, where we can consider the function fi = f
ξi ; the length
function for f is then the length function for fi plus one. This gives the result.
□

202
VI. GEOMETRIC SATAKE
Example VI.3.4. Suppose λ ∈X∗(T) is regular dominant. Then Pλ = B. We then obtain the
stratiﬁcation by semi-inﬁnite orbits
Sν = Grν
B,Divd
Y
for ν ∈X∗(T). One has Sν ,→GrG,Divd
Y, a locally closed immersion, and
GrG,Divd
Y =
[
ν∈X∗(T)
Grν
B,Divd
Y
(disjoint union) at the level of points.
We can now apply Theorem IV.6.5. Here, we also use the opposite parabolic P −
λ ⊂G. If
S →Divd
Y is a small v-stack, we denote
GrG,S/Divd
Y = GrG,Divd
Y ×Divd
YS
and similarly
HckG,S/Divd
Y = HckG,Divd
Y ×Divd
YS.
For any A ∈D´et(GrG,S/Divd
Y, Λ), we call A bounded if it arises via pushforward from some ﬁnite
union GrG,S/Divd
Y,≤µ• ⊂GrG,S/Divd
Y. We let
D´et(GrG,S/Divd
Y, Λ)bd ⊂D´et(GrG,S/Divd
Y, Λ)
be the corresponding full subcategory.
Corollary VI.3.5. Let S →Divd
Y be any small v-stack. Consider the diagram
GrPλ,Divd
Y
q+
x
p+
&
GrG,Divd
Y
GrMλ,Divd
Y
GrP −
λ ,Divd
Y
q−
f
p−
8
and denote by q+
S etc. the base change along S →Divd
Y. Consider the full subcategory
D´et(GrG,S/Divd
Y, Λ)Gm-mon,bd ⊂D´et(GrG,S/Divd
Y, Λ)bd
of all A ∈D´et(GrG,S/Divd
Y, Λ) that are bounded and Gm-monodromic in the sense of Deﬁnition IV.6.11.
On D´et(GrG,S/Divd
Y, Λ)Gm-mon,bd, the natural map
R(p−
S )∗R(q−
S )! →R(p+
S )!(q+
S )∗
is an equivalence, inducing a “constant term” functor
CTPλ : D´et(GrG,S/Divd
Y, Λ)Gm-mon,bd →D´et(GrMλ,S/Divd
Y, Λ)bd.
This functor commutes with any base change in S and preserves the condition of being universally
locally acyclic over S (which is well-deﬁned for bounded A).

VI.3. SEMI-INFINITE ORBITS
203
Proof. This follows from Proposition VI.3.1 and Theorem IV.6.5, Proposition IV.6.12 and
Proposition IV.6.14.
□
Example VI.3.6 (Follow-up to Example VI.3.4). In the context of Example VI.3.4, suppose
d = 1. Then, GrT,S/Div1
Y = X∗(T) × S, and the corresponding semi-inﬁnite orbits are denoted by
Sν ⊂GrG,Div1
Y for ν ∈X∗(T). Thus,
CTB(A) =
M
ν∈X∗(T)
R(pν)!(A|Sν)
with pν : Sν ×Div1
Y S →S ⊂GrT,S/Div1
Y the embedding indexed by ν.
As a ﬁnal topic here, let us analyze more closely the semi-inﬁnite orbits in the special ﬁbre,
i.e. for the Witt vector aﬃne Grassmannian GrWitt
G
(so that (GrWitt
G
)♦∼= GrG,Spd Fq/Div1
Y), which is
an increasing union of perfections of projective varieties over Fq by [BS17], cf. also [Zhu17]. For
any λ ∈X∗(T) as above, we have the semi-inﬁnite orbit
Sλ = LU · [λ] ⊂GrWitt
G
.
Proposition VI.3.7. For any µ ∈X∗(T)+, the intersection Sλ ∩GrWitt
G,≤µ is representable by an
aﬃne scheme.
Proof. Picking a closed immersion G ,→GLn, one can reduce to G = GLn. In that case, there
is an ample line bundle L on GrWitt
G
constructed in [BS17]. We ﬁrst claim that the pullback of L to
GrWitt
B
is trivial. Indeed, recall that if Spec R →GrWitt
G
corresponds to a lattice Ξ ⊂WOE(R)[ 1
π]n,
then L is given by det(π−mWOE(R)/Ξ) for any large enough m, using the determinant
det : Perf(WOE(R) on R) →Pic(R),
which is multiplicative in exact triangles.
On GrWitt
B
, one has a universal ﬁltration of Ξ com-
patible with the standard ﬁltration on the standard lattice, which induces a similar ﬁltration on
Ξ/πmWOE(R), where all the graded quotients are locally constant (and constant on Sλ). This
means that the line bundle is naturally trivialized over each connected component Sλ of GrWitt
B
.
We claim that this section over Sλ extends uniquely to a section over the closed subset S
λ′≤λ Sλ′
that vanishes over the complement of Sλ, showing that the intersection of Sλ with each GrWitt
G,≤µ
must be aﬃne. To see this, by the v-descent results of [BS17], it suﬃces to check that for any
rank 1 valuation ring V with a map Spec V →GrWitt
G
whose generic point Spec K maps into Sλ,
the section of L over Spec K extends to Spec V and is nonzero in the special ﬁbre precisely when
all of Spec V maps into Sλ. Now the ﬁltration
0 = ΞK,0 ⊂ΞK,1 ⊂. . . ⊂ΞK,n = ΞK
with
ΞK,i = ΞK ∩WOE(K)[ 1
π]i ⊂WOE(K)[ 1
π]i
has the property that
ΞK,i/ΞK,i−1 = πλiWOE(K)
for the cocharacter λ = (λ1, . . . , λn). Moreover, the ﬁltration by the ΞK,i extends integrally to the
ﬁltration
0 = Ξ0 ⊂Ξ1 ⊂. . . ⊂Ξn = Ξ

204
VI. GEOMETRIC SATAKE
with
Ξi = Ξ ∩WOE(V )[ 1
π]i ⊂WOE(V )[ 1
π]i,
which is still a ﬁltration by ﬁnite projective WOE(V )-modules by [SW20, Lemma 14.2.3]. The
injection of Ξi/Ξi−1 into WOE(V )[ 1
π] (projecting to the i-th coordinate) has image contained in
WOE(V )[ 1
π] ∩πλiWOE(K) = πλiWOE(V ),
so we get natural injections Ξi/Ξi−1 ,→πλiWOE(V ), that are isomorphisms after inverting π or [a]
for a pseudouniformizer a ∈V . Now the relevant line bundle can be written as the tensor product
of the line bundles given by the determinants of the complexes
πλiWOE(V )/(Ξi/Ξi−1) ∈Perf(WOE(R) on R).
These line bundles are indeed naturally trivial over K as the perfect complex is acyclic there. Now
this complex is concentrated in degree 0, and is torsion, so admits a ﬁltration by complexes of the
form V/a ∼= [aV ,→V ] for pseudouniformizers a ∈V . The associated line bundle on V is then given
by the alternating tensor product V ⊗V (aV )−1 = a−1V , and the natural section by 1 ∈a−1V . We
see that the section is indeed integral, and that it is nonzero in the special ﬁbre if and only if all
the above complexes are acyclic, equivalently if Ξi/Ξi−1 →πλiWOE(V ) is an isomorphism. But
this is precisely the condition that all of Spec V maps into Sλ.
□
The union S
λ,⟨2ρ,λ⟩≤d Sλ ⊂GrWitt
G
is closed, thus so is
[
λ,⟨2ρ,λ⟩≤d
Sλ ∩GrWitt
G,≤µ ⊂GrWitt
G,≤µ .
For d = ⟨2ρ, µ⟩, this is all of GrWitt
G,≤µ, while for d = −⟨2ρ, µ⟩it contains only a point, corresponding
to [λ] for λ the antidominant representative of the Weyl orbit of µ. Also, only d of the same parity
as ⟨2ρ, µ⟩are relevant. By Proposition VI.3.7, the successive complements
[
λ,⟨2ρ,λ⟩≤d
Sλ ∩GrWitt
G,≤µ \
[
λ,⟨2ρ,λ⟩≤d−2
Sλ ∩GrWitt
G,≤µ =
G
λ,⟨2ρ,λ⟩=d
Sλ ∩GrWitt
G,≤µ
are aﬃne. This means that at each step, the dimension can drop by at most 1. However, in ⟨2ρ, µ⟩
steps, it drops by ⟨2ρ, µ⟩. We get the following corollary on Mirkovi´c–Vilonen cycles, cf. [MV07,
Theorem 3.2], and [GHKR10], [Zhu17, Corollary 2.8] for a diﬀerent proof based on point counting,
the classical Satake isomorphism, and the Kato-Lusztig formula [Kat82], [Lus83].
Corollary VI.3.8. The scheme Sλ ∩GrWitt
G,≤µ is equidimensional of dimension ⟨ρ, µ + λ⟩.
VI.4. Equivariant sheaves
Now we go back to the setting of general reductive groups G over OE (resp. over E if we work
over Divd
Y or Divd
X). As usual, let Λ be some coeﬃcient ring killed by some integer n prime to p.
We want to study D´et(−, Λ) for the local Hecke stack
HckG,Divd
Y = L+
Divd
YG\ GrG,Divd
Y

VI.4. EQUIVARIANT SHEAVES
205
or its versions for Divd
Y and Divd
X. Neither this nor its bounded versions HckG,Divd
Y,≤µ• (say, when
G is split) is an Artin stack as L+
Divd
YG is not ﬁnite-dimensional. However, Proposition VI.2.8 shows
that on the bounded version, the action factors over a ﬁnite-dimensional quotient.
First, we observe that on the level of D´et(−, Λ), one can then forget about the rest of the action.
Proposition VI.4.1. Let H be a group small v-sheaf over a small v-sheaf S that admits a
ﬁltration H≥m ⊂H by closed subgroups such that, v-locally on S, for each m ≥1 each quotient
H≥m/H≥m+1 admits a further ﬁnite ﬁltration with graded pieces given by (A1
S♯)♦for some untilt
S♯of S (that may vary). Let X be some small v-sheaf over S with an action of H that factors over
H<m = H/H≥m for some m > 0. Then the pullback functor
D´et(H<m\X, Λ) →D´et(H\X, Λ)
is an equivalence.
Proof. Both stacks live over the classifying stack [H<m\S] of H<m over S. Applying descent
along S →[H<m\S], one reduces to the case that H<m is trivial. In that case, the map X/H →
X/H<m = X admits a section s : X →X/H, and it is enough to prove that s∗is fully faithful.
Doing descent once more, it is enough to prove that for any aﬃnoid perfectoid space S′ over S over
which a ﬁltration by A1’s exists, pullback
D´et(S′, Λ) →D´et(S′ × H, Λ)
is fully faithful. Replace S by S′ and let f : H →S be the projection. We need to see that for all
A ∈D´et(S, Λ), the map
A →Rf∗f∗A
is an isomorphism; doing this for all S, it is enough to check it on global sections, i.e.
RΓ(S, A) →RΓ(S × H, f∗A)
is an isomorphism. Using Postnikov towers, we can assume that A ∈D+
´et(S, Λ). We can write H as
a ﬁltered colimit of subgroups Hj ⊂H such that each Hj is a successive extension as before, but
now the quotients are balls inside each A1
S♯. In particular, each Hj is a spatial diamond, and it is
enough to prove that
RΓ(S, A) →RΓ(S × Hj, f∗A)
is an isomorphism for all j. Now each Hj = lim
←−m H<m
j
is an inverse limit of spatial diamonds, so
by [Sch17a, Proposition 14.9] it is enough to prove that
RΓ(S, A) →RΓ(S × H<m
j
, f∗
nA)
is an isomorphism for all m and j.
But this follows easily from each H<m
j
being a successive
extension of balls inside A1
S♯.
□
Using hyperbolic localization, we can prove the following important conservativity result.
Proposition VI.4.2. Assume that B ⊂G is a Borel. Let S →Divd
Y be any small v-sheaf. Let
A ∈D´et(HckG,S/Divd
Y, Λ) with support quasicompact over S. Assume that the hyperbolic localization
CTB(A) = 0 of the pullback of A to GrG,S/Divd
Y vanishes. Then A = 0.
The similar assertion holds with Divd
Y and Divd
X in place of Divd
Y.

206
VI. GEOMETRIC SATAKE
Proof. Note that the formation of CTB commutes with any base change in S, by Corol-
lary VI.3.5. We can thus assume that S = Spa(C, C+) is strictly local. Up to replacing d by a
smaller integer, removing double points, we can assume that the map S →Divd
Y is given by d
distinct untilts S♯
i over OE, i = 1, . . . , d. Let E′|E be an extension splitting G, assumed unramiﬁed
in our situation where we work over Y. We can then lift all S♯
i to OE′, and thereby reduce to the
case of split G. The corresponding geometric ﬁbre
HckG,S/Divd
Y
has a stratiﬁcation enumerated by µ1, . . . , µd ∈X∗(T)+, with strata
[S/(
d
Y
i=1
(L+
Div1
YG)µi ×Div1
Y S)].
If A is nonzero, we can ﬁnd a maximal such stratum on which A is nonzero.
Now we apply
Corollary VI.3.5, see Example VI.3.6. One has an isomorphism
S × X∗(T)d ∼= GrT,S/Divd
Y .
Over the copy of S enumerated by the antidominant representatives of (the Weyl group orbits
of) µ1, . . . , µn the functor CTB is the pullback of A to a section of the stratum corresponding to
µ1, . . . , µn ∈X∗(T)+ (which, as we recall, correspond to a maximal stratum where A is nonzero).
This shows that the restriction of A to a section over this maximal stratum is zero. This gives the
desired contradiction, so A = 0.
□
VI.5. Aﬃne ﬂag variety
At a few isolated spots, it will be useful to use the aﬃne ﬂag variety, the main point being that
the Schubert varieties in the aﬃne ﬂag variety admit explicit resolutions of singularities, given by
Demazure resolutions (also known as Bott–Samelson resolutions). It will be enough to appeal to
these in the setting of a split reductive group G, with a reductive model over OE and Borel B ⊂G
deﬁned over OE, for d = 1, and for a small v-stack S →Div1
Y factoring over Spd OC where C = bE,
so we restrict attention to this setting.
Consider the base change GA of G to A = WOE(OC♭). We have Fontaine’s map θ : A →OC,
and we can deﬁne an “Iwahori” group scheme I →GA, ﬂat over A, whose points in a ker θ-
torsionfree A-algebra R are given those elements g ∈G(R) such that θ(g) ∈G(R ⊗A OC) lies in
B(R ⊗A OC). Similarly, for any parabolic P ⊂G containing B, we get a “parahoric” group scheme
P →GA, ﬂat over A, whose points in a ker θ-torsionfree A-algebra R are those g ∈G(R) such
that θ(g) ∈P(R ⊗A OC). In particular, this applies to the parabolics Pi corresponding to the
simple reﬂections si; let Pi be the corresponding parahorics. Still more generally, for any aﬃne
simple reﬂection si, one can deﬁne a parabolic Pi →GA ﬂat over A, and such that I →GA factors
over Pi. (The construction of these parahoric group schemes over A can be reduced to the case
of WOE(k)[[u]] via a faithfully ﬂat embedding WOE(k)[[u]] ,→A along which everything arises via
base change, and then one can appeal to the work of Bruhat–Tits [BT84, Section 3.9.4].)

VI.5. AFFINE FLAG VARIETY
207
Definition VI.5.1. In the situation above, including a small v-stack S over Spd OC, mapping
to Div1
Y, let
FℓG,S →S
be the ´etale quotient LG/L+I, where L+I(R, R+) = I(B+
dR(R♯)).
Note here that as S lives over Spd OC, any Spa(R, R+) over S comes with an untilt R♯over
OC, in which case B+
dR(R♯) is an A = WOE(OC)-algebra, so that I(B+
dR(R♯)) is well-deﬁned.
Proposition VI.5.2. There is a natural projection map
FℓG,S →GrG,S/Div1
Y
that is a torsor under (G/B)♦. In particular, it is proper, representable in spatial diamonds, and
cohomologically smooth.
Proof. This follows from the identiﬁcation L+G/L+I ∼= (G/B)♦, which follows from the
deﬁnition, and the similar properties of (G/B)♦→Spd OE.
□
We analyze the stratiﬁcation of FℓG,S into L+I-orbits. Let N(T) ⊂T be the normalizer of T,
and
f
W = N(T)(BdR(C′))/T(B+
dR(C′))
be the aﬃne Weyl group, for any complete algebraically closed ﬁeld C′ over OE with a map
C♭→C′♭; this is naturally independent of the choice of C′. As T(BdR(C′))/T(B+
dR(C′)) ∼= X∗(T),
there is a short exact sequence
0 →X∗(T) →f
W →W →0,
where W is the usual Weyl group of G.
Proposition VI.5.3. The decomposition of FℓG,S(C′) into L+I(C′)-orbits is given by
FℓG,S(C′) =
G
w∈f
W
L+I(C) · w.
Proof. If C′ lives over E, we can choose an isomorphism BdR(C′) ∼= C′((ξ)) and the result
follows from the classical result.
If C′ lives over the residue ﬁeld Fq of E, this reduces to the
assertion for the Witt vector aﬃne ﬂag variety, for which we refer to [Zhu17].
□
Recall that f
W acts on X∗(T). Fixing the alcove a corresponding to the Iwahori group I, one
gets a set of aﬃne simple reﬂections si as the reﬂections along the faces of the alcove; these generate
a normal subgroup Waﬀ⊂f
W. Letting Ω⊂f
W denote the stabilizer of the alcove, there is a split
short exact sequence
1 →Waﬀ→f
W →Ω→1.
One gets the Bruhat order on f
W: If wi = wi,0ωi ∈f
W = Waﬀ⋊Ωfor i = 1, 2 are two elements,
then w1 ≤w2 if ω1 = ω2 and in one (hence every) presentation of w2 as a product of aﬃne simple
reﬂections, w1 is obtained by removing some factors.

208
VI. GEOMETRIC SATAKE
Definition VI.5.4. For w ∈f
W, the aﬃne Schubert cell is the subfunctor FℓG,w,S ⊂FℓG,S of
all maps Spa(R, R+) →FℓG,S that on all geometric points lie in the L+I-orbit of w. The aﬃne
Schubert variety is the subfunctor FℓG,≤w,S of all maps Spa(R, R+) →FℓG,S that on all geometric
points lie in the L+I-orbit of w′ for some w′ ≤w.
Theorem VI.5.5. For each w ∈f
W, the subfunctor FℓG,≤w,S ⊂FℓG,S is closed, and FℓG,≤w,S →
Spd OC is proper and representable in spatial diamonds, of ﬁnite dim. trg. The subfunctor FℓG,w,S ⊂
FℓG,≤w,S is open and dense.
Proof. We will prove the theorem by constructing the Demazure resolution of FℓG,≤w,S. Write
w = w0ω ∈f
W = Waﬀ⋊Ω, and ﬁx a decomposition w0 = Ql
j=1 sij as a product of aﬃne simple
reﬂections of minimal length, so l(w) = l(w0) = l. We write ˙w for the element w with such a choice
of decomposition.
For each aﬃne simple reﬂection si, we have a corresponding parahoric group Pi →GA corre-
sponding to the face of a; one has L+Pi/L+I ∼= (P1)♦.
Definition VI.5.6. The Demazure variety corresponding to ˙w is the ´etale sheaf
Dem ˙w,S = L+Psi1 ×L+I L+Psi2 ×L+I . . . ×L+I L+Psil/L+I →S,
equipped with the left L+I-action and the L+I-equivariant map
Dem ˙w,S →FℓG,S
given by (p1, . . . , pl) 7→p1 · · · pl · ω.
It is clear from the deﬁnition that Dem ˙w →S is a successive (P1)♦-ﬁbration over S, and in
particular is a spatial diamond, proper over S of ﬁnite dim. trg. As FℓG,S →S is partially proper,
it follows that the image of Dem ˙w,S →FℓG,S is proper. Moreover, the image can be identiﬁed on
geometric points, and we see that Dem ˙w,S →FℓG,≤w,S is surjective, FℓG,≤w,S ⊂FℓG,S is closed,
and FℓG,≤w,S is proper over S. In particular, FℓG,w,S ⊂FℓG,≤w,S is open, as the complement is a
ﬁnite union of closed subfunctors. As FℓG,S →GrG,S is locally a product with (G/B)♦, it follows
from [SW20, Theorem 19.2.4] that FℓG,S ×GrG,S GrG,≤µ,S is a spatial diamond, and thus so is
FℓG,≤w,S, as it is a closed subspace for µ large enough.
Also, by checking on geometric points and reducing to the classical case, the map Dem ˙w,S →
FℓG,≤w,S is an isomorphism over FℓG,w,S whose preimage is given by
(L+Psi1 \ L+I) ×L+I (L+Psi2 \ L+I) ×L+I . . . ×L+I (L+Psil \ L+I)/L+I.
This implies that FℓG,w,S ⊂FℓG,≤w,S is dense, as desired. As usual, a consequence of this discussion
is that the Bruhat order is independent of the choice of ˙w.
□
Using Demazure resolutions, one can prove that the standard sheaves on the aﬃne ﬂag variety
are universally locally acyclic.
Proposition VI.5.7. For any w ∈f
W, let jw : FℓG,w,S ,→FℓG,≤w,S be the open embedding.
Then jw!Λ ∈D´et(FℓG,≤w,S, Λ) is universally locally acyclic over S.

VI.6. ULA SHEAVES
209
Proof. Using Proposition IV.2.11, it suﬃces to prove the same for ejw : FℓG,w,S ,→Dem ˙w,S
and ejw!Λ. Then ejw!Λ can be resolved in terms of Λ and all i ˙w′, ˙w,∗Λ for
i ˙w′, ˙w : Dem ˙w′,S →Dem ˙w,S
the closed immersion from another Demazure variety, corresponding to a subword of ˙w′ of ˙w; note
that combinatorially, we are dealing with the situation of a normal crossing divisor at the boundary.
By cohomological smoothness of all Dem ˙w′,S →S and Proposition IV.2.11, the result follows.
□
VI.6. ULA sheaves
We will be interested in universally locally acyclic sheaves on the local Hecke stack.
Definition VI.6.1. Let S →Divd
Y be any small v-stack. An object
A ∈D´et(HckG,S/Divd
Y, Λ)
is universally locally acyclic over S if it is bounded, and its pullback to
GrG,S/Divd
Y
is universally locally acyclic over S.
Let
DULA
´et
(HckG,S/Divd
Y, Λ) ⊂D´et(HckG,S/Divd
Y, Λ)
be the corresponding full subcategory.
This deﬁnition is a priori not symmetric in the two bundles E1, E2 parametrized by the local
Hecke stack. However, we can check that it actually is.
Proposition VI.6.2. Consider the automorphism
sw : HckG,S/Divd
Y
∼= HckG,S/Divd
Y
switching E1 and E2. Then A ∈D´et(HckG,S/Divd
Y, Λ) is universally locally acyclic over S if and only
if sw∗A is universally locally acyclic over S.
Proof. Fix any large enough substack U ⊂HckG,S/Divd
Y quasicompact over S containing the
support of A. Let (LDivd
YG)U ⊂LDivd
YG be the preimage of U. Universal local acyclicity after
pullback to GrG,Divd
Y is equivalent to universal local acyclicity after pullback to
(LDivd
YG)U/(L+
Divd
YG)≥m
for any m > 0, by Proposition VI.1.11 and Proposition VI.1.12.
We need to see that this is
equivalent to universal local acyclicity after pullback to
(L+
Divd
YG)≥m\(LDivd
YG)U
for any m > 0. For this, we note that these two pro-systems in m are pro-isomorphic. By the
next lemma, the transition maps back and forth are also cohomologically smooth, which implies
the desired equivalence.
□

210
VI. GEOMETRIC SATAKE
In the following lemma, we call a map f universally locally acyclic if Λ is f-universally locally
acyclic.
Lemma VI.6.3. Let
X4
f3
−→X3
f2
−→X2
f1
−→X1
f0
−→X0
be surjective maps of locally spatial diamonds that are compactiﬁable and of locally ﬁnite dim. trg.
Assume that f0 ◦f1 and f1 ◦f2 are cohomologically smooth. Then f0 is universally locally acyclic.
If f1 is universally locally acyclic and f0 ◦f1 is cohomologically smooth, then f1 is cohomologically
smooth.
Thus, if f0 ◦f1, f1 ◦f2 and f2 ◦f3 are cohomologically smooth, then f0 and f1 are
cohomologically smooth.
We would expect that f3 : X4 →X3 should be unnecessary in order for f0 to be cohomologically
smooth.
Proof. We claim that for any map g0 : Y0 →X0, with pullbacks gi : Yi →Xi and efi : Yi+1 →
Yi, the natural transformation
ef∗
0 Rg!
0 →Rg!
1f∗
0
is an isomorphism. Indeed, we have natural maps
ef∗
2 ef∗
1 ef∗
0 Rg!
0 →ef∗
2 ef∗
1 Rg!
1f∗
0 →ef∗
2 Rg!
2f∗
1 f∗
0 →Rg!
3f∗
2 f∗
1 f∗
0
and the composite of any two maps is an isomorphism. By the two-out-of-six-lemma, this implies
that all maps are isomorphisms. By surjectivity of f1 and f2, this implies that ef∗
0 Rg!
0 →Rg!
1f∗
0
is an isomorphism. Applying this with Y0 = X1 and to the constant sheaf Λ then shows, by the
criterion of Theorem IV.2.23, that Λ is f0-universally locally acyclic.
Now assume that f1 is universally locally acyclic and f0 ◦f1 is cohomologically smooth, then
R(f0 ◦f1)!Λ ∼= f∗
1 Rf!
0Λ ⊗L
Λ Rf!
1Λ
is invertible. This implies that both tensor factors are invertible, and in particular Rf!
1Λ is invertible,
so f1 is cohomologically smooth. For the ﬁnal statement, we now know that the hypotheses imply
that f0 and f1 are universally locally acyclic, so the displayed equation implies that f0 and f1 are
cohomologically smooth.
□
Using the conversativity result Proposition VI.4.2, we can characterize universally locally acyclic
sheaves in terms of their hyperbolic localization. Note that we can always reduce to the case of
quasisplit G by ´etale localization on S.
Proposition VI.6.4. Let B ⊂G be a Borel with torus quotient T. Let S be a small v-stack
with a map S →Divd
Y, and let
A ∈D´et(HckG,S/Divd
Y, Λ)bd.
Then A is universally locally acyclic over S if and only if the hyperbolic localization
CTB(A) ∈D´et(GrT,S/Divd
Y, Λ)bd
is universally locally acyclic over S. This, in turn, is equivalent to the property that
RπT,S,∗CTB(A) ∈D´et(S, Λ)
is locally constant with perfect ﬁbres.

VI.6. ULA SHEAVES
211
Here
πT,S : GrT,S/Divd
Y →S
is the projection.
Proof. The forward direction follows from Corollary VI.3.5 and the ind-properness of πT,S and
Corollary IV.2.12. For the converse direction, we may assume that S is strictly totally disconnected
and G is split. Note that to prove universal local acyclicity of A, it is enough to prove that the
map
p∗
1RHom(A, Rπ!
G,SΛ) ⊗L
Λ p∗
2A →RHom(p∗
1A, Rp!
2A)
is an isomorphism (by Theorem IV.2.23). (Implicitly, we pass here to a bounded part of HckG,Divd
Y
and replace the quotient by L+
Divd
YG by a ﬁnite-dimensional quotient in order to be in the setting
of Artin stacks.) By Proposition VI.4.2 applied to G × G, it is enough to prove this after ap-
plying CTB−×B, where B−is the opposite Borel. Using that hyperbolic localization commutes
with exterior tensor products, and Proposition IV.6.13, this translates exactly into the similar iso-
morphism characterizing universal local acyclicity of CTB(A). The ﬁnal statement follows from
Proposition IV.2.28.
□
In the case of one leg, one can completely characterize universally locally acyclic sheaves.
Proposition VI.6.5. Assume that G is split. Let S →Div1
Y be any small v-stack. Consider
A ∈D´et(HckG,S/Div1
Y, Λ)bd.
Then A is universally locally acyclic over S if and only if for all µ ∈X∗(T)+, the restriction of A
to the section [µ] : S →HckG,S/Div1
Y is locally constant with perfect ﬁbres in D´et(S, Λ).
If G is not split, a similar characterization holds, by applying the result ´etale locally to reduce
to the case of split G. Again, there is also the obvious version for Div1
Y and Div1
X.
Proof. First, we prove that if all ﬁbres are locally constant with perfect ﬁbres, then A is
universally locally acyclic. This easily reduces to the case of jµ!Λ where
jµ : HckG,Div1
Y,µ ,→HckG,Div1
Y
is the inclusion of an open Schubert cell, and S = Div1
Y. We can also argue v-locally on Div1
Y and
so base change to the case S = Spd OC. In that case, Proposition VI.5.2 and Proposition IV.2.13
show that it suﬃces to prove the similar assertion for the aﬃne ﬂag variety, where it follows from
Proposition VI.5.7.
Now for the converse, we argue by induction on the support of A. On a maximal Schubert cell
GrG,S/Div1
Y,µ where A is nonzero, its restriction is universally locally acyclic, and as on the Hecke
stack this stratum is the classifying space of a (pro-)cohomologically smooth group, it follows that
the restriction of A along the section [µ] : S →HckG,S/Div1
Y is locally constant with perfect ﬁbres.
Replacing A by the cone of
jµ!A|HckG,S/Div1
Y ,µ →A,
the claim follows.
□

212
VI. GEOMETRIC SATAKE
In the following corollaries, we no longer assume that G is split.
Corollary VI.6.6. Let S →Div1
Y be any small v-stack. Then
DULA
´et
(HckG,S/Div1
Y, Λ)
is stable under Verdier duality and −⊗L
Λ −, RHomΛ(−, −) as well as j!j∗, Rj∗j∗, j!Rj!, Rj∗Rj!
where j is the locally closed immersion of a Schubert cell. Moreover, all of these operations commute
with all pullbacks in S.
Proof. Stability under Verdier duality and compatibility with base change in S follow from
Corollary IV.2.25. For the other assertions, one can reduce to the case that G is split by working
locally on S, where it follows from the previous proposition, and juggling with the six functors, and
the stalkwise characterization of the previous proposition.
□
Corollary VI.6.7. For a complete algebraically closed extension C of E with residue ﬁeld k,
taking S = Spd OC, S = Spd C and S = Spd k, the functors
DULA
´et
(HckG,Spd C/Div1
Y, Λ) ←DULA
´et
(HckG,Spd OC/Div1
Y, Λ) →DULA
´et
(HckG,Spd k/Div1
Y, Λ)
are equivalences.
Proof. Use that the formation of RHom commutes with any base change in S, and that the
category of locally constant sheaves with perfect ﬁbres on any such S is equivalent to the category
of perfect Λ-modules.
□
In fact, the previous results extend to the case of general d as long as S →Divd
Y has image in
the open subset (Divd
Y)̸= ⊂Divd
Y where all untilts are distinct. After passing to a ﬁnite ´etale cover
of S, we can then in fact assume that S maps to (Div1
Y)d
̸=.
Proposition VI.6.8. Assume that G is split. Let S →(Div1
Y)d
̸= →Divd
Y be a small v-stack.
Consider
A ∈D´et(HckG,S/Divd
Y, Λ)bd.
Then A is universally locally acyclic over S if and only if for all µ1, . . . , µd ∈X∗(T)+, the restriction
of A to the section [µ•] : S →HckG,S/Divd
Y is locally constant with perfect ﬁbres in D´et(S, Λ).
The category
DULA
´et
(HckG,S/Divd
Y, Λ)
is stable under Verdier duality and −⊗L
Λ −, RHomΛ(−, −) as well as j!j∗, Rj∗j∗, j!Rj!, Rj∗Rj!
where j is the locally closed immersion of a Schubert cell. Moreover, all of these operations commute
with all pullbacks in S.
Proof. We have the decomposition
HckG,S/Divd
Y
∼=
d
Y
i=1
HckG,S/πiDiv1
Y
where π1, . . . , πd : S →Div1
Y are the d projections, and the product on the right is taken over S. One
can then stratify according to Schubert cells parametrized by tuples µ• = (µ1, . . . , µd) and the above

VI.7. PERVERSE SHEAVES
213
arguments imply the result. Here, in the beginning, to see that jµ•!Λ is universally locally acyclic,
one uses that exterior tensor products preserve universal local acyclicity, see Corollary IV.2.25, to
reduce to the case of one leg.
□
VI.7. Perverse Sheaves
For any small v-stack S →Divd
Y, we deﬁne a (relative) perverse t-structure on
D´et(HckG,S/Divd
Y, Λ)bd.
Definition/Proposition VI.7.1. Let S →Divd
Y be a small v-stack. There is a unique t-
structure (pD≤0, pD≥0) on D´et(HckG,S/Divd
Y, Λ)bd such that
A ∈pD≤0
´et (HckG,S/Divd
Y, Λ)bd
if and only if for all geometric points Spa(C, C+) →S and open Schubert cells of
HckG,Spa(C,C+)/Divd
Y,
parametrized by some µ1, . . . , µr ∈X∗(T)+ (where r is the number of distinct untilts at Spa(C, C+) →
Divd
Y), the pullback of A to this open Schubert cell sits in cohomological degrees ≤−Pr
i=1⟨2ρ, µi⟩.
Proof. We note that on any bounded closed subset of Z ⊂HckG,Divd
Y there is a presentable
stable ∞-category D´et(Z ×Divd
Y S, Λ) reﬁning the derived category, and the given class of objects is
stable under all colimits and extensions (and is generated by a set of objects). Thus, the existence
and uniqueness of the t-structure follow from [Lur16, Proposition 1.4.4.11]. Moreover, one easily
checks that when enlarging Z, the inclusion functors are t-exact, so these glue to a t-structure in
the direct limit.
□
Let
Perv(HckG,S/Divd
Y, Λ) ⊂D´et(HckG,S/Divd
Y, Λ)bd
be the heart of the perverse t-structure. On it, pullback to the aﬃne Grassmannian is fully faithful.
Proposition VI.7.2. The pullback functor
Perv(HckG,S/Divd
Y, Λ) →D´et(GrG,S/Divd
Y, Λ)bd
is fully faithful.
Moreover, if
A ∈pD≤0
´et (HckG,S/Divd
Y, Λ)bd and B ∈pD≥0
´et (HckG,S/Divd
Y, Λ)bd,
then RHomΛ(A, B) ∈D≥0
´et (HckG,S/Divd
Y, Λ)bd.
Proof. For the ﬁnal statement, we need to see that if C ∈D≤−1
´et
(HckG,S/Divd
Y, Λ)bd, then there
are no nonzero maps C →RHomΛ(A, B); equivalently, there are no nonzero maps C ⊗L
Λ A →B.
But this follows from the simple observation that C ⊗L
Λ A lies in pD≤−1.

214
VI. GEOMETRIC SATAKE
Now using this property of RHomΛ(A, B), descent implies that it is enough to see that if
A, B ∈Perv(HckG,S/Divd
Y, Λ), then any map between their pullbacks to GrG,S/Divd
Y is automati-
cally invariant under the action of L+
Divd
YG. This follows from Lemma VI.7.3 applied to a ﬁnite-
dimensional approximation of
GrG,S/Divd
Y ×Divd
YL+
Divd
YG →GrG,S/Divd
Y .
□
We used the following lemma on actions of connected groups on ´etale sheaves.
Lemma VI.7.3. Let f : Y →X be a compactiﬁable cohomologically smooth map of locally spatial
diamonds with a section s : X →Y . Assume that all geometric ﬁbres of f are connected. Then for
all A ∈D≥0
´et (X, Λ), the map
H0(Rf∗f∗A) →H0(A)
given by evaluation at the section s is an isomorphism.
Proof. Note that
Rf∗f∗A ∼= RHom(Rf!Rf!Λ, A)
where Rf!Rf!Λ sits in cohomological degrees ≤0 with H0 ∼= Λ. Indeed, this reduces easily to
the case of discrete Λ, and then to Λ = Fℓ, and can be checked on geometric stalks.
But if
S = Spa(C, C+) and i : {s} ,→S is the closed point, then i∗Rf!Rf!Fℓ∈D(Fℓ) with dual
R Hom(i∗Rf!Rf!Fℓ, Fℓ) ∼= RΓ(Y, f∗i∗Fℓ)
which sits in degrees ≥0 and is equal to Fℓin degree 0, as the geometric ﬁbres are connected.
Using the section, we get Rf!Rf!Λ ∼= Λ ⊕B for some B that sits in cohomological degrees ≤−1,
and the lemma follows.
□
Unfortunately, it is a priori not easy to describe the category pD≥0. It is however possible to
describe it via hyperbolic localization. This also implies that pullbacks in S are t-exact.
Proposition VI.7.4. For any S′ →S →Divd
Y, pullback along
HckG,S′/Divd
Y →HckG,S/Divd
Y
is t-exact for the perverse t-structure. Moreover, if G is split, then
CTB : D´et(HckG,S/Divd
Y, Λ)bd →D´et(GrT,S/Divd
Y, Λ)
satisﬁes the following exactness property. There is the natural locally constant map GrT,Divd
Y →
X∗(T) measuring the sum of relative positions, and by pairing with 2ρ, we get a locally constant
map deg : GrT,Divd
Y →Z. Then CTB[deg] is t-exact for the perverse t-structure on the source, and
the standard t-structure on the right. As CTB[deg] is conservative, this implies in particular that
A ∈pD≤0
´et (HckG,S/Divd
Y, Λ)bd (resp. A ∈pD≥0
´et (HckG,S/Divd
Y, Λ)bd)
if and only if
CTB(A)[deg] ∈D≤0
´et (GrT,S/Divd
Y, Λ) (resp. CTB(A)[deg] ∈D≥0
´et (GrT,S/Divd
Y, Λ)).

VI.7. PERVERSE SHEAVES
215
Proof. To prove t-exactness of pullbacks, we need to see that pullback commutes with t-
truncations. By descent, it is enough to check that this holds v-locally on S; this allows us to
reduce to the case that G is split.
It is then enough to prove t-exactness of CTB[deg], as by
conservativity of CTB[deg] (see Proposition VI.4.2) this gives the characterization in terms of the
t-structure in terms of CTB[deg], and the latter characterization is clearly preserved under pullback
(as hyperbolic localization commutes with pullback, see Corollary VI.3.5).
We can assume that S →Divd
Y lifts to S →(Div1
Y)d. We have a stratiﬁcation of S into ﬁnitely
many strata ia : Sa ,→S, obtained by pulling back the partial diagonals of (Div1
Y)d. Accordingly,
we get triangles expressing A as a successive extension of ia!i∗
aA resp. Ria∗Ri!
aA; if A ∈pD≤0
(resp. A ∈pD≥0), then also all ia!i∗
aA ∈pD≤0 (resp. Ria∗Ri!
aA ∈pD≥0). This allows us to reduce
to the cases of ia!i∗
aA and Ria∗Ri!
aA. As hyperbolic localization commutes with all functors by
Proposition IV.6.12, we can then reduce to the case that S = Sa for some a.
Reducing d if
necessary, we can then assume that S maps into the locus of distinct untilts (Div1
Y)d
̸= ⊂(Div1
Y)d.
There is then a stratiﬁcation in terms of open Schubert cells
jµ• : HckG,S/Divd
Y,µ• ,→HckG,S/Divd
Y
parametrized by µ• = (µ1, . . . , µd), µi ∈X∗(T)+. Now A ∈pD≤0 if and only if all
j∗
µ•A ∈D≤−dµ•
for dµ• = Pd
i=1⟨2ρ, µi⟩, and dually A ∈pD≥0 if and only if all
Rj!
µ•A ∈D≥−dµ•.
Using excision triangles, we can then assume that
A = jµ•!Aµ•, Aµ• ∈D≤−dµ•(HckG,S/Divd
Y,µ•, Λ)
resp.
A = Rjµ•∗Aµ•, Aµ• ∈D≥−dµ•(HckG,S/Divd
Y,µ•, Λ).
Moreover, ﬁltering by cohomology sheaves, we can actually assume that Aµ• is concentrated in
degree −dµ•. Recall that
[µ•] : S →HckG,S/Divd
Y,µ•
is a v-cover, and the automorphism group of the stratum is an inverse limit of smooth and connected
groups (as follows from Proposition VI.2.4 and the K¨unneth formula); this implies that for com-
plexes concentrated in one degree, pullback under [µ•]∗is fully faithful, cf. Lemma VI.7.3. We can
thus assume that Aµ• comes via pullback from some B ∈D(S, Λ) concentrated in cohomological
degree −dµ•. Note that at this point, the desired statement (that CTB(A)[deg] sits in the correct
degrees) can be checked after pullback along Spa(C, C+) →S, so we can assume S = Spa(C, C+)
is strictly local, and it is enough to check that CTB(A)[deg] sits in the correct degrees in the ﬁbre
over the closed point of S. This ﬁbre in turn depends only on the restriction of A to the ﬁbre over
the closed point of S, by Proposition IV.6.12. We can thus assume that B is in fact constant. We
can assume Λ = Z/nZ for some n prime to p, and then by d´evissage that Λ = Fℓfor some ℓ̸= p.
One can then further reduce to the case B = Fℓ[dµ•]. Also, by the K¨unneth formula, we can then
reduce to the case d = 1. Thus, ﬁnally
A = jµ!Fℓ[⟨2ρ, µ⟩]

216
VI. GEOMETRIC SATAKE
resp.
A = Rjµ∗Fℓ[⟨2ρ, µ⟩],
and we want to see that CTB(A)[deg] ∈D≤0 (resp. CTB(A)[deg] ∈D≥0). By Proposition IV.6.13,
it suﬃces to handle the ﬁrst case. Note that A is now universally locally acyclic, and the claim
can be checked in the universal case S = Div1
Y. As GrT,Div1
Y →Div1
Y is a disjoint union of X∗(T)
many copies of Div1
Y, and the image is universally locally acyclic, thus locally constant, it is in fact
enough to check the result after pullback to the special ﬁbre S = Spd Fq →Div1
Y, where
GrG,Spd Fq/Div1
Y ∼= (GrWitt
G
)♦.
Using [Sch17a, Section 27], we can now translate all computations to the setting of schemes.
Let λ ∈X∗(T) be any element, giving rise to the semi-inﬁnite orbit Sλ ⊂GrWitt
G
, i.e.
Sλ = GrWitt
B
×GrWitt
T
[λ].
By Corollary VI.3.8, the dimension of Sλ ∩GrWitt
G,µ is bounded by ⟨ρ, λ + µ⟩. The restriction of
CTB(jµ!Fℓ[⟨2ρ, µ⟩])
to [λ] ∈GrWitt
T
is given by
RΓc((Sλ ∩GrWitt
G,µ )Fq, Fℓ)[⟨2ρ, µ⟩]
and thus sits in degrees ≤2⟨ρ, λ + µ⟩−⟨2ρ, µ⟩= ⟨2ρ, λ⟩, giving the desired bound.
□
We note that if d = 1, G is split, and S = Spd k →Div1
Y for k = Fq, then under the full
inclusion
Perv(HckG,Spd k/Div1
Y, Λ) ⊂D´et(GrG,Spd k/Div1
Y, Λ)bd,
the identiﬁcation GrG,Spd k/Div1
Y ∼= (GrWitt
G,k )♦and the full embedding
D´et(GrWitt
G,k , Λ)bd ,→D´et(GrG,Spd k/Div1
Y, Λ)bd
from [Sch17a, Proposition 27.2], the category
Perv(HckG,Spd k/Div1
Y, Λ)
identiﬁes with the full subcategory
PervL+G(GrWitt
G,k , Λ) ⊂D´et(GrWitt
G,k , Λ)bd
of L+G-equivariant perverse sheaves on GrWitt
G,k ; this was considered by Zhu [Zhu17] and Yu [Yu19].
In particular, this discussion implies the following result that we will need later.
Proposition VI.7.5. Assume that G is split, so that for any µ ∈X∗(T)+ we have the inclusion
jµ : HckG,Div1
Y,µ ,→HckG,Div1
Y
of the open Schubert cell, of dimension dµ = ⟨2ρ, µ⟩. Then
pjµ!Λ[dµ] = pH0(jµ!Λ[dµ]), pRjµ∗Λ[dµ] = pH0(Rjµ∗Λ[dµ])
are universally locally acyclic, and their image under CTB[deg] is locally ﬁnite free over Λ. Their
formation commutes with any base change in Λ. The natural map
pRjµ∗Λ[dµ](dµ) →D(pjµ!Λ[dµ])

VI.7. PERVERSE SHEAVES
217
is an isomorphism.
Moreover, if Λ is a Zℓ-algebra, then there is some integer a = a(µ) (independent of Λ) such
that the kernel and cokernel of the map
pH0(jµ!Λ[dµ]) →pH0(Rjµ∗Λ[dµ])
are killed by ℓa.
We remark that the ﬁnal statement ultimately makes use of the decomposition theorem (and
thus requires the degeneration to the Witt vector aﬃne Grassmannian).
Proof. Consider A = jµ!Λ[dµ] ∈pD≤0, which is universally locally acyclic. Then CTB(A)[deg]
sits in degrees ≤0, and is universally locally acyclic. Moreover, its degree 0 part is locally ﬁnite free
over Λ. Indeed, this can be computed in terms of the top compactly supported cohomology group
of the Mirkovi´c–Vilonen cycles Sλ ∩GrWitt
G,µ , which (as for any separated variety) is ﬁnite free over
Λ. As CTB(A)[deg] is t-exact, this implies that A′ = pH0(A) has the property that CTB(A′)[deg]
is locally ﬁnite free over Λ. Applying Verdier duality and using Proposition IV.6.13, we see that
CTB(D(A))[deg] ∼= D(w∗
0CTB(A)[deg]) (where w0 is the longest Weyl group element), which then
sits in cohomological degrees ≥0, and is ﬁnite free in degree 0, with degree 0 parts also under
Verdier duality. This shows that the natural map
pRjµ∗Λ[dµ](dµ) →D(pjµ!Λ[dµ])
is an isomorphism. The proof also shows that the formation commutes with any base change in Λ.
For the ﬁnal statement, we can ﬁrst of all reduce by universal local acyclicity and Corol-
lary VI.6.7 to the same statement on GrWitt
G,k . By base change, we can assume that Λ = Z/ℓNZ,
and we can even formally pass to the inverse limit over N, and then invert ℓ; it is thus enough to
show that on the perfectly projective scheme GrWitt
G,k,≤µ, the map
pjµ!Qℓ[dµ] →pRjµ∗Qℓ[dµ]
is an isomorphism. This follows from [Zhu17, Lemma 2.1], cf. also [Gai01, Proposition 1], [Lus83].
Let us recall the argument. It is enough to prove injectivity, as then surjectivity follows by Poincar´e
duality (as the two sheaves are Verdier dual, as we have already proved), using that we are working
with ﬁeld coeﬃcients now. Let jµ!∗Qℓ[dµ] be the image of the displayed map (i.e., the intersection
complex of GrWitt
G,k,≤µ). It is enough to see that for i : GrWitt
G,k,<µ ,→GrWitt
G,k,≤µ the complementary
closed, that i∗jµ!∗Qℓ[dµ] lies in pD≤−2. Indeed, we have a short exact sequence
0 →i∗K →pjµ!Qℓ[dµ] →jµ!∗Qℓ[dµ] →0
for some perverse sheaf K on GrWitt
G,k,<µ; but this gives a map i∗jµ!∗Qℓ[dµ] →K[1], so if i∗jµ!∗Qℓ[dµ] ∈
pD≤−2, then necessarily K = 0.
To prove that i∗jµ!∗Qℓ[dµ] ∈pD≤−2, it suﬃces to prove that all geometric ﬁbres of jµ!∗Qℓ[dµ]
are concentrated in degrees of the same parity as dµ; indeed, any other stratum in GrG,k,≤µ has
dimension of the same parity as dµ, so the trivial bound i∗jµ!∗Qℓ[dµ] ∈pD≤−1 gets ampliﬁed by
one on each stratum for parity reasons. This parity claim about the intersection complex can be
checked smooth locally. We have the smooth map FℓWitt
G,k
→GrWitt
G,k
from the Witt vector aﬃne
ﬂag variety, and choosing the element w in the Iwahori-Weyl group corresponding to the generic

218
VI. GEOMETRIC SATAKE
stratum on the preimage of the Schubert cell, we get the smooth map FℓWitt
G,k,≤w →GrWitt
G,k,≤µ. It
is thus enough to prove the similar claim about the intersection complex of FℓWitt
G,k,≤w. Choosing a
reduced expression ˙w = s1 · · · sr · ω as above, we get the Demazure-Bott-Samuelson resolution
π ˙w : DemWitt
˙w
→FℓWitt
G,k,≤w.
This has the property that all geometric ﬁbres admit stratiﬁcations into aﬃne spaces, cf. [Zhu17,
Section 1.4.2]. In particular, all geometric ﬁbres of Rπ ˙w∗Qℓsit only in even degrees. On the other
hand, by the decomposition theorem, the intersection complex is a direct summand of Rπ ˙w∗Qℓ[dµ],
giving the claim.
□
As a consequence of Proposition VI.7.4, we see, perhaps surprisingly, that containment in pD≥0
can be checked in geometric ﬁbres over S. (Note however that we are using a relative perverse
t-structure.) This gives a complete justiﬁcation for calling it a relative perverse t-structure.
Corollary VI.7.6. Let S →Divd
Y be any small v-stack and let
A ∈D´et(HckG,S/Divd
Y, Λ)bd.
Then A ∈pD≥0
´et if and only if this holds true after pullback to all strictly local Spa(C, C+) →S. In
particular,
A ∈Perv(HckG,S/Divd
Y, Λ)
if and only if for all strictly local Spa(C, C+) →S, the pullback of A to HckG,Spa(C,C+)/Divd
Y is
perverse.
Also note that over geometric points, we are simply considering the usual perverse t-structure
corresponding to the stratiﬁcation in terms of open Schubert cells, and then pD≥0 admits its usual
characterization in terms of !-restriction to the open Schubert cells.
Proof. It suﬃces to check after a cover, as pullback is t-exact.
This allows us to reduce
to the case that G is split.
But then it follows from the condition in terms of the hyperbolic
localization.
□
VI.7.1. The Satake category. We also get the following characterization. The condition
asked here is stronger than perversity.
Proposition VI.7.7. Let S be any small v-stack over Divd
Y and assume that G is split. Then
A ∈DULA
´et
(HckG,S/Divd
Y, Λ)
has the property that A is a ﬂat perverse sheaf (in the sense that A ⊗L
Λ M is perverse for all
Λ-modules M) if and only if
RπT∗CTB(A)[deg] ∈D´et(S, Λ)
is ´etale locally on S isomorphic to a ﬁnite projective Λ-module in degree 0.
Proof. The functor RπT∗CTB(A)[deg] preserves universally locally acyclic sheaves and hence
takes values in sheaves that are locally constant with perfect ﬁbres. By Proposition VI.7.4 and as
any bounded part of GrT,Divd
Y →Divd
Y is ﬁnite over the base, the condition A ∈pD≤0 is equivalent

VI.7. PERVERSE SHEAVES
219
to RπT∗CTB(A)[deg] ∈D≤0. The ﬂatness then ensures that this is locally isomorphic to a perfect
complex of Tor-amplitude [0, 0], i.e. a ﬁnite projective Λ-module in degree 0.
□
In the following deﬁnition, S →Divd
Y is any small v-stack, and G is general.
Definition VI.7.8. Let
Sat(HckG,S/Divd
Y, Λ) ⊂D´et(HckG,S/Divd
Y, Λ)
be the full subcategory of all objects that are universally locally acyclic and ﬂat perverse.
This deﬁnition has the virtue that it is invariant under switching sw∗. Let us give some examples
of objects in the Satake category, when d = 1. Assume for simplicity that G is split. For any
µ ∈X∗(T)+, we get the open Schubert cell
jµ : HckG,Div1
Y,µ ,→HckG,Div1
Y
of dimension dµ = ⟨2ρ, µ⟩. The following proposition gives the analogue of highest weight modules
in the Satake category.
Proposition VI.7.9. The perverse sheaves
pjµ!Λ[dµ] = pH0(jµ!Λ[dµ]), pRjµ∗Λ[dµ] = pH0(Rjµ∗Λ[dµ])
lie in the Satake category Sat(HckG,Div1
Y, Λ).
Proof. This follows from Proposition VI.7.7 and Proposition VI.7.5.
□
Definition/Proposition VI.7.10. The functor
RπG,S∗: Sat(HckG,S/Divd
Y, Λ) →D´et(S, Λ)
of pullback to GrG,S/Divd
Y and pushforward along πG,S : GrG,S/Divd
Y →S takes values in complexes
C ∈D´et(S, Λ) such that all Hi(C) are local systems of ﬁnite projective Λ-modules, and each functor
Hi(RπG,S∗) : Sat(HckG,S/Divd
Y, Λ) →LocSys(S, Λ).
is exact.
Let
FG,S =
M
i∈Z
Hi(RπG,S∗) : Sat(HckG,S/Divd
Y, Λ) →LocSys(S, Λ).
The functor FG,S is exact, faithful, and conservative. Moreover, if f : A →B is a map in
Sat(HckG,S/Divd
Y, Λ)
such that ker FG,S(f) is a direct summand of FG,S(A), then f admits a kernel in Sat(HckG,S/Divd
Y, Λ);
similarly for cokernels.
The ﬁnal statement in particular ensures the condition of “existence of coequalizers of FG,S-split
parallel pairs” appearing in the Barr–Beck theorem.

220
VI. GEOMETRIC SATAKE
Remark VI.7.11. It is not clear whether there are natural isomorphisms FG,S(sw∗A) ∼= FG,S(A),
so this ﬁbre functor is (at least a priori) destroying part of the symmetry. What makes this question
slightly delicate is that it is asking for extra structure, and ideally one would like to produce this
structure in a clean way; it is conceivable that one can reduce to geometric points and then use the
aﬃrmative answers we give later under stronger assumptions on S.
Proof. Localize on S to reduce to the case that G is split, and ﬁx a Borel B ⊂G with
torus T. Using the stratiﬁcation of GrG into the strata Sν, we get a ﬁltration on RπG,S∗A whose
associated graded is given by L
ν Rpν!A|Sν. Restricting to connected components of GrG and for A
in the Satake category, these are concentrated in degrees of the same parity, so the corresponding
spectral sequence necessarily degenerates. Thus, most of this follows from Proposition VI.7.7 and
Proposition VI.4.2. Faithfulness of FG,S reduces to conservativity and the Barr–Beck type assertion,
so it remains to prove the Barr–Beck type assertion. For this, consider the kernel of f in the category
of all perverse sheaves on HckG,S/Divd
Y. We need to see that this is still universally locally acyclic,
and ﬂat perverse. These properties can be checked after applying hyperbolic localization, shift
by deg, and pushforward to S (using various t-exactness properties), where they follow from the
assumption of being a direct summand.
□
The Satake category also carries a Verdier duality functor. Again, it is not clear that this
functor commutes naturally with sw∗(we will settle it later under stronger assumptions on S).
Proposition VI.7.12. The image of the fully faithful functor
Sat(HckG,S/Divd
Y, Λ) →D´et(GrG,S/Divd
Y, Λ)
is stable under Verdier duality DGrG,S/Divd
Y
/S. The induced functor
D : Sat(HckG,S/Divd
Y, Λ)op →Sat(HckG,S/Divd
Y, Λ)
is an equivalence, with D2 = id. Moreover, it makes the diagram
Sat(HckG,S/Divd
Y, Λ)op
D
/
FG,S

Sat(HckG,S/Divd
Y, Λ)
FG,S

LocSys(S, Λ)op
V 7→V ∗
/ LocSys(S, Λ)
commute naturally.
Proof. The Verdier dual D(A) ∈D´et(GrG,S/Divd
Y, Λ) can actually be deﬁned already in D´et(HckG,S/Divd
Y, Λ)bd
by using Verdier duality along bounded subsets of HckG →[∗/L+G]. It follows from Verdier du-
ality that it commutes with the passage to cohomology, i.e. the functor FG,S, and from this one
can deduce that it is ﬂat perverse and hence lies in the Satake category. Biduality follows from
Corollary IV.2.25.
□
Moreover, the formation of the Satake category is compatible with constant term functors. We
deﬁne a locally constant function
degP : GrM,Divd
Y →Z

VI.8. CONVOLUTION
221
as the composite of the projection to X∗(M) considered before and the map X∗(M) →Z given by
pairing with 2ρG −2ρM.
Proposition VI.7.13. Let P ⊂G be a parabolic with Levi M. Let S →Divd
Y be any small
v-stack. Consider the diagram
GrG,S/Divd
Y
qS
←−GrP,S/Divd
Y
pS
−→GrM,S/Divd
Y .
Then the functor RpS!q∗
S[degP ] deﬁnes a functor
CTP,S[degP ] : Sat(HckG,S/Divd
Y, Λ) →Sat(HckM,S/Divd
Y, Λ).
These functors are compatible with composition, i.e. if P ′ ⊂P is a further parabolic with image
Q ⊂M and Levi M′, then there is a natural equivalence
CTP ′,S[degP ′] ∼= CTQ,S[degQ] ◦CTP,S[degP ] : Sat(HckG,S/Divd
Y, Λ) →Sat(HckM′,S/Divd
Y, Λ)
(and for triple compositions, the obvious diagram commutes).
Proof. Let λ : Gm →G be a cocharacter such that P = Pλ. This induces in particular a Levi
splitting M ,→P as the centralizer of λ. We can then divide the diagram
GrG,S/Divd
Y
qS
←−GrP,S/Divd
Y
pS
−→GrM,S/Divd
Y .
by L+
Divd
YM to see that one can reﬁne RpS!q∗
S into a functor
D´et(HckG,S/Divd
Y, Λ) →D´et(HckM,S/Divd
Y, Λ)
via ﬁrst pulling back to L+
Divd
YM\ GrG,S/Divd
Y. It is clear that these functors are compatible with
composition.
We want to see that the image is contained in the Satake category. First, by Proposition IV.6.14,
we see that the image is universally locally acyclic. Now the claim follows from Proposition VI.7.7
and the compatibility with composition (used for the Borel B ⊂P), after passing to an ´etale cover
to assume that G is split.
□
VI.8. Convolution
For any d and small v-stack S →Divd
Y, the category
D´et(HckG,S/Divd
Y, Λ)
is naturally a monoidal category. Indeed, with all loop groups taken over Divd
Y, there is a convolution
morphism
HckG,Divd
Y ×Divd
Y HckG,Divd
Y
a←−L+G\LG ×L+G LG/L+G b−→L+G\LG/L+G = HckG,Divd
Y
where the morphism a is an L+G-torsor, and the right morphism is ind-proper (its ﬁbres are the
ﬁbres of GrG,Divd
Y →Divd
Y). If one denotes by aS and bS the pullbacks along S →Divd
Y, one can
then deﬁne the convolution product ⋆on
D´et(HckS/Divd
Y, Λ)bd

222
VI. GEOMETRIC SATAKE
via A1 ⋆A2 = RbS∗a∗
S(A1 ⊠A2) for A1, A2 ∈D´et(HckS/Divd
Y, Λ)bd. It is easy to see that this is
associative by writing out the corresponding convolution diagrams with multiple factors.
In fact, modulo the problem that [Divd
Y/L+
Divd
YG] →[Divd
Y/LDivd
YG] is not representable in lo-
cally spatial diamonds (only ind-representable), the category D´et(HckS/Divd
Y, Λ)bd is precisely the
category of endomorphisms of [Divd
Y/L+
Divd
YG]×Divd
YS in the 2-category CT for T = [Divd
Y/LDivd
YG]×Divd
Y
S. This problem is corrected by passing to bounded sheaves – one can extend the formalism to the
case of maps that are ind-representable in locally spatial diamonds, with closed immersions in the
ind-system, using categories of bounded sheaves as morphisms.
Convolution interacts nicely with the classes of sheaves we have previously singled out.
In
particular, it preserves (ﬂat) perverse sheaves; this observation goes back to Lusztig [Lus83].
Proposition VI.8.1. Let A1, A2 ∈D´et(HckS/Divd
Y, Λ)bd.
(i) If A1 and A2 are universally locally acyclic, then A1 ⋆A2 is universally locally acyclic.
(ii) If A1 and A2 lie in pD≤0, then A1 ⋆A2 ∈pD≤0.
(iii) If A1, A2 ∈Sat(HckG,S/Divd
Y, Λ), then also A1 ⋆A2 ∈Sat(HckG,S/Divd
Y, Λ).
Proof. Part (i) follows from Proposition IV.2.11 and Proposition IV.2.26. For part (ii), we
ﬁrst make some reductions. Namely, the claim can be checked if S = Spa(C, C+) is strictly local
and G split. Moreover, by a d´evissage one can assume that A1 and A2 are the !-extensions of the
constant sheaves on open Schubert cells; in particular, these are universally locally acyclic. By the
K¨unneth formula one can then reduce to the case d = 1. In that case, we can pass to the universal
case S = Div1
Y. Over (Div1
Y)2, we can consider the moduli space g
HckG,(Div1
Y)2 of G-bundles E0, E1,
E2 over B+
(Div1
Y)2 together with isomorphisms between E0 and E1 over B+
(Div1
Y)2[ 1
I1 ] and between E1
and E2 over B+
(Div1
Y)2[ 1
I2 ], where I1, I2 ⊂OYS are the ideal sheaves parametrizing the two Cartier
divisors. Away from the diagonal, this is isomorphic to HckG,(Div1
Y)2
̸=/Div2
Y, while over the diagonal
it is isomorphic to
L+
Div1
YG\LDiv1
YG ×
L+
Div1
Y
G
LDiv1
YG/L+
Div1
YG.
There are two natural projections
p1, p2 : g
HckG,(Div1
Y)2 →HckG,Div1
Y
keeping track of E0 and E1 resp. E1 and E2, and a projection
m : g
HckG,(Div1
Y)2 →HckG,(Div1
Y)2/Div2
Y
keeping track of E0 and E2. One can the form B = Rm∗(p∗
1A1 ⊗L
Λ p∗
2A2). Recall that we reduced
to the case that A1 and A2 are moreover universally locally acyclic. By Proposition IV.2.11 and
Proposition IV.2.26, one sees that also
B ∈DULA
´et
(HckG,(Div1
Y)2/Div2
Y, Λ).
Away from the diagonal, this is simply the exterior tensor product of A1 and A2 and in particular
lies in pD≤0. Looking at CTB(B)[deg], we get a universally locally acyclic sheaf on (a bounded

VI.9. FUSION
223
subset of) GrT,(Div1
Y)2/Div2
Y whose restriction away from the diagonal lies in degrees ≤0.
This
implies that the whole sheaf lies in degrees ≤0: As any bounded subset of GrT,(Div1
Y)2/Div2
Y is ﬁnite
over (Div1
Y)2, it suﬃces to check this for the pushforward to (Div1
Y)2. But this pushforward is
locally constant with perfect ﬁbres, and the complement of the diagonal is dense.
Thus, using Proposition VI.7.4, the restriction of B to the diagonal lies in pD≤0. But this
restriction is precisely A1 ⋆A2, giving the desired result. Finally, part (iii) easily follows from (i),
(ii), and the observation that convolution commutes with Verdier duality.
□
VI.8.1. Dualizability. Next, we observe that all objects are dualizable.
Proposition VI.8.2. All objects of the monoidal category Sat(HckG,S/Divd
Y, Λ) are (left and
right) dualizable.
The right dual of A ∈Sat(HckG,S/Divd
Y, Λ) is given by sw∗D(A) where sw :
HckG,Divd
Y
∼= HckG,Divd
Y is the switching isomorphism (induced by inversion on LDivd
YG).
Remark VI.8.3. In the classical setting, this is asserted without indication of proof in [MV07,
end of Section 11].
Proof. All objects of DULA(HckG,S/Divd
Y, Λ) are left dualizable, with right dual given by
sw∗D(A): This follows from Proposition IV.2.24 (modulo the technical nuisance that everything is
only ind-representable here; everything adapts to that setting). Here, sw simply arises by swapping
source and target. Also note that the condition of being universally locally acyclic is invariant
under sw∗by Proposition VI.6.2, so also using Proposition VI.7.12, the functor sw∗D(A) preserves
the Satake category.
□
Remark VI.8.4. Again, we stress that all results above also hold if G is reductive over E, and
we replace Divd
Y with Divd
Y or Divd
X. Indeed, the case of Divd
Y follows from the case of Divd
Y as it
is an open subset, at least if G admits a reductive model over OE. In general, this happens ´etale
locally, making it possible to reduce to this case. Then the case of Divd
X follows from the case of
Divd
Y as any map S →Divd
X can locally be lifted to a map S →Divd
Y in such a way that the
corresponding pullbacks of the local Hecke stacks are isomorphic.
VI.9. Fusion
Now let G be a reductive group over E. From now on, we ﬁx the base ﬁeld k = Fq and work
on the category Perfk. For brevity, we deﬁne for any ﬁnite set I with d = |I| the local Hecke stack
HckI
G = HckG,Divd
X ×Divd
X(Div1
X)I
and correspondingly
GrI
G = GrG,Divd
X ×Divd
X(Div1
X)I.
Definition VI.9.1. For any ﬁnite set I, the Satake category
SatI
G(Λ)
is the category Sat(HckI
G, Λ) of all
A ∈D´et(HckI
G, Λ)
that are universally locally acylic and ﬂat perverse over (Div1
X)I.

224
VI. GEOMETRIC SATAKE
By Proposition VI.7.10, we get a (not yet monoidal) ﬁbre functor
F I : SatI
G(Λ) →LocSys((Div1
X)I, Λ).
The target category LocSys((Div1
X)I, Λ) is in fact very explicit.
Proposition VI.9.2. The category LocSys((Div1
X)I, Λ) is naturally equivalent to the category
RepW I
E(Λ) of continuous representations of W I
E on ﬁnite projective Λ-modules.
Proof. This is a consequence of Proposition IV.7.3.
□
For any map f : I →J of ﬁnite sets, there is a natural monoidal functor SatI
G(Λ) →SatJ
G(Λ).
Indeed, there is a natural closed immersion HckJ
G ×(Div1
X)J(Div1
X)I ,→HckI
G, so pull-push along
HckI
G ←HckJ
G ×(Div1
X)J(Div1
X)I →HckJ
G
deﬁnes the desired functor. It is easy to see that this functor is compatible with composition of
maps of ﬁnite sets. Moreover, the functors SatI
G(Λ) →SatJ
G(Λ) make the diagram
SatI
G(Λ)
/
F I

SatJ
G(Λ)
F J

RepW I
E(Λ)
/ RepW J
E(Λ)
commute naturally, where the lower functor is pullback under W J
E →W I
E.
Actually, the functor I 7→SatI
G(Λ) has further functoriality, given by the fusion product.
Namely, for ﬁnite sets I1, . . . , Ik with disjoint union I = I1 ⊔. . . ⊔Ik, there is a natural monoidal
functor
SatI1
G (Λ) × . . . × SatIk
G (Λ) →SatI
G(Λ),
functorial in I1, . . . , Ik and compatible with composition. To construct this, let
j : (Div1
X)I;I1,...,Ik ⊂(Div1
X)I
be the open subset where xi ̸= xi′ whenever i, i′ ∈I = I1 ⊔. . . ⊔Ik lie in diﬀerent Ij’s, and let
SatI;I1,...,Ik
G
(Λ) ⊂DULA
´et
(HckI
G ×(Div1
X)I(Div1
X)I;I1,...,Ik, Λ)
be deﬁned similarly as SatI
G(Λ).
Proposition VI.9.3. The restriction functor
j∗: SatI
G(Λ) →SatI;I1,...,Ik
G
(Λ)
is fully faithful. Similarly,
j∗: LocSys((Div1
X)I, Λ) →LocSys((Div1
X)I;I1,...,Ik, Λ)
is fully faithful.

VI.9. FUSION
225
Proof. For the ﬁrst part, it suﬃces to prove that for all A ∈SatI
G(Λ), the natural map
A →pH0(Rj∗j∗A)
is an isomorphism. Let i : Z ,→(Div1
X)I be the complementary closed. It suﬃces to see that
i∗i!A ∈pD≥2. Working locally to reduce to the case G split, and applying the t-exact hyperbolic
localization functor RπT∗CTB[deg], taking values in local systems of ﬁnite projective Λ-modules
on SatI
G(Λ), this follows from the observation that i∗i!Λ ∈D≥2, which follows from the observation
that Z admits a stratiﬁcation (by partial diagonals) with smooth strata of ℓ-codimension ≥1 inside
the smooth (Div1
X)I.
This ﬁnal argument in fact proves directly the second part.
□
On the other hand, over (Div1
X)I;I1,...,Ik, one has
HckI
G ×(Div1
X)I(Div1
X)I;I1,...,Ik ∼=
k
Y
j=1
HckIj
G ×Q
j(Div1
X)Ij (Div1
X)I;I1,...,Ik,
so there is a natural monoidal functor
SatI1
G (Λ) × . . . × SatIk
G (Λ) →SatI;I1,...,Ik
G
(Λ)
given by exterior product. Actually, recall that when forming symmetric monoidal tensor products,
there are implicit sign rules when commuting factors. We change these here by hand. Namely, note
that each
HckI
G = (HckI
G)even ⊔(HckI
G)odd
decomposes into open and closed subsets given by the even and the odd part; the even part
contains those Schubert varieties for which dµ• = P
i⟨2ρ, µi⟩is even, while the odd part contains
those for which dµ• is odd. Note that the dominance order can only nontrivially compare elements
with the same parity, so these are really open and closed subsets. Also note that it follows from
Proposition VI.7.4 that for sheaves concentrated on the even (resp. odd) part, the functor F I is
concentrated in even (resp. odd) degrees. Now we impose that when forming the above exterior
product, we introduce a minus sign whenever we commute two sheaves concentrated on the odd
parts. A diﬀerent way to say it is that there is a natural commutative diagram
SatI1
G (Λ) × . . . × SatIk
G (Λ)
/
(F I1,...,F Ik)

SatI;I1,...,Ik
G
(Λ)
F I;I1,...,Ik

LocSys((Div1
X)I1, Λ) × . . . × LocSys((Div1
X)Ik, Λ)
⊠
/ LocSys((Div1
X)I;I1,...,Ik, Λ)
functorial in I1, . . . , Ik, and under permutations of the sets I1, . . . , Ik. Indeed, note that the functors
F I invoke a shift by deg, which exactly introduces this sign rule. This in fact pins down this choice
of signs by faithfulness of the functors.
Definition/Proposition VI.9.4. The image of
SatI1
G (Λ) × . . . × SatIk
G (Λ) →SatI;I1,...,Ik
G
(Λ)
lands in SatI
G(Λ) ⊂SatI;I1,...,Ik
G
(Λ), deﬁning the fusion product
∗: SatI1
G (Λ) × . . . × SatIk
G (Λ) →SatI
G(Λ),

226
VI. GEOMETRIC SATAKE
a functor of monoidal categories, functorial in I1, . . . , Ik. It makes the diagram
SatI1
G (Λ) × . . . × SatIk
G (Λ)
∗
/
(F I1,...,F Ik)

SatI
G(Λ)
F I

LocSys((Div1
X)I1, Λ) × . . . × LocSys((Div1
X)Ik, Λ)
⊠
/ LocSys((Div1
X)I, Λ)
commute functorially in I1, . . . , Ik and permutations of I1, . . . , Ik.
Proof. We can deﬁne a convolution local Hecke stack
HckI;I1,...,Ik
G
→(Div1
X)I
as follows. It parametrizes G-bundles E0, . . . , Ek over B+
(Div1
X)I together with isomorphisms of Ej−1
and Ej after inverting Ii for all i ∈Ij, for j = 1, . . . , k. Here Ii ⊂OXS is the ideal deﬁning the i-th
Cartier divisor. There are natural projections
pj : HckI;I1,...,Ik
G
→HckIj
G, j = 1, . . . , k
remembering Ej−1 and Ej, and
m : HckI;I1,...,Ik
G
→HckI
G
remembering E0 and Ek. Given Aj ∈SatIj
G(Λ), one can then deﬁne
B = Rm∗(p∗
1A1 ⊗L
Λ . . . ⊗L
Λ p∗
kAk) ∈D´et(HckI
G, Λ).
This is still universally locally acyclic, by Proposition IV.2.11 and Proposition IV.2.26.
After
pullback to (Div1
X)I;I1,...,Ik, the map m is an isomorphism, and we simply get the exterior product
of all Ai. Moreover, working locally to reduce to the case G is split, we see that RπT∗CTB(B)[deg]
is a local system of ﬁnite projective Λ-modules, as it is locally constant with perfect ﬁbres, and over
the dense open subset (Div1
X)I;I1,...,Ik, the perfect complex is a ﬁnite projective module in degree
0. This means that B ∈SatI
G(Λ), as desired.
□
In particular, for any ﬁnite set I, this structure makes SatI
G(Λ) into an E∞-monoid object in
monoidal categories, functorially in I, by using the composite
SatI
G(Λ) × . . . × SatI
G(Λ) →SatI⊔...⊔I
G
(Λ) →SatI
G(Λ),
using the functor corresponding to the natural map I ⊔. . . ⊔I →I.
Recall that E∞-monoid
structures on monoidal categories are the same as symmetric monoidal category structures reﬁning
the given monoidal category structure. Thus, each SatI
G(Λ) has become naturally a symmetric
monoidal category with the fusion product, reﬁning the monoidal convolution product; and every-
thing is functorial in I. Moreover, by the ﬁnal part of Deﬁnition/Proposition VI.9.4, the functor
F I : SatI
G(Λ) →LocSys((Div1
X)I, Λ) ∼= RepW I
E(Λ)
is a symmetric monoidal functor, functorially in I.
A consequence of these symmetric monoidal structures are the following natural isomorphisms.

VI.9. FUSION
227
Corollary VI.9.5. For A ∈SatI
G(Λ), there are natural isomorphisms
F I(sw∗A) ∼= F I(A), D(sw∗A) ∼= sw∗D(A).
Moreover, D is naturally a symmetric monoidal functor, and D◦F I ∼= (F I)∗as symmetric monoidal
functors.
Proof. By Proposition VI.8.2, all A ∈SatI
G(Λ) are dualizable, with dual sw∗D(A).
In a
symmetric monoidal category, this means that there are natural isomorphisms
sw∗Dsw∗D(A) ∼= A.
As both sw∗and D are self-inverse, this amounts to the commutation of D and sw∗.
Also, as F I is symmetric monoidal, it follows that F I(sw∗D(A)) and F I(A) are naturally dual.
But by Proposition VI.7.12, the dual of F I(A) is also F I(D(A)). Replacing D(A) by A, we ﬁnd a
natural isomorphism F I(sw∗A) ∼= F I(A).
Finally, it is easy to see that the whole construction of the fusion product is compatible with
Verdier duality, making Verdier duality a symmetric monoidal functor, compatibly with the ﬁbre
functor.
□
Moreover, the constant term functors are compatible with the fusion product. More precisely,
given a parabolic P ⊂G with Levi M, we have the constant term functors
CTI
P [degP ] : SatI
G(Λ) →SatI
M(Λ).
Proposition VI.9.6. For any ﬁnite set I decomposed into ﬁnite sets I = I1 ⊔. . . ⊔Ik, the
diagram
SatI1
G (Λ) × . . . × SatIk
G (Λ)
/
(CTI1
P [degP ],...,CT
Ik
P [degP ])

SatI
G(Λ)
CTI
P [degP ]

SatI1
M(Λ) × . . . × SatIk
M(Λ)
/ SatI
M(Λ)
commutes functorially in I and permutations of I1, . . . , Ik.
Proof. After passing to the open subset (Div1
X)I;I1,...,Ik, this follows from the K¨unneth formula,
so Proposition VI.9.3 gives the result.
□
In particular, the functor
CTI
P [degP ] : SatI
G(Λ) →SatI
M(Λ)
is naturally symmetric monoidal with respect to the fusion product. Moreover, everything is com-
patible with composition, for another parabolic P ′ ⊂P.

228
VI. GEOMETRIC SATAKE
VI.10. Tannakian reconstruction
Our next goal is to construct a group scheme whose category of representations recovers the
symmetric monoidal category SatI
G(Λ).
More precisely, we want to use some relative Tannaka
duality over RepW I
E(Λ).
To achieve this, we need the following proposition.
Given any ﬁnite
and Galois-stable subsets Wi ⊂X∗(T)+, i ∈I, closed under the dominance order, we have a
quasicompact closed substack
HckI
G,(Wi)i ⊂HckI
G
and we get a corresponding full subcategory
SatI
G,(Wi)i(Λ) ⊂SatI
G(Λ).
Proposition VI.10.1. The functor
F I : SatI
G,(Wi)i(Λ) →RepW I
E(Λ)
admits a left adjoint LI
(Wi)i, satisfying the following properties.
(i) There is a natural isomorphism
LI
(Wi)i(V ) ∼= LI
(Wi)i(1) ⊗V, V ∈RepW I
E(Λ),
where 1 ∈RepW I
E(Λ) is the tensor unit, and we use that SatI
G(Λ) is tensored over RepW I
E(Λ).
(ii) There is a natural isomorphism
LI
(Wi)i(1) ∼= ∗i∈I L{i}
Wi(1)
as the fusion of L{i}
Wi(1) ∈Sat{i}
G,Wi(Λ).
(iii) If I = {i} has one element and W = Wi, then the left adjoint is the restriction of the left
adjoint to
F ′ =
M
m
Hm(RπG∗) : Perv(Hck{i}
G,W , Λ) →ModWE(Λ).
Proof. It is enough to ﬁnd the value LI
(Wi)i(1) satisfying (ii) and (iii).
Indeed, then the
formula in (i) deﬁnes the left adjoint in general. Assume now that (iii) holds, and let us denote
PWi = L{i}
Wi(1). Then for part (ii) we ﬁrst observe that
F ′I =
M
m
Hm(RπG∗) : Perv(HckI
G,(Wi)i, Λ) →Shv´et((Div1
X)I, Λ)
admits a left adjoint, and this left adjoint evaluated on the unit, P(Wi)i, is generically on (Div1
X)I
given by an exterior tensor product of the corresponding left adjoints for I being a singleton.
Indeed, note that there is a natural map
P(Wi)i →∗i∈I PWi
adjoint to the section of
F ′I(∗i∈I PWi) ∼= ⊠i∈I F ′(PWi)
given by the exterior tensor product of the classes given by (iii). To check that this is an isomorphism
generically, we can by ´etale descent reduce to the case that G is split. In that case, one can make

VI.10. TANNAKIAN RECONSTRUCTION
229
the left adjoint explicit in terms of the left adjoint to hyperbolic localization. Writing hyperbolic
localization as a composite of !-pullback and ∗-pushforward, this left adjoint is then given in terms
of ∗-pullback and !-pushforward, and the perverse pH0.
As generically, everything decomposes
geometrically into a product, it follows from the K¨unneth formula that the left adjoint commutes
with exterior products. But as any B ∈SatI
G,(Wi)i(Λ) is equal to pH0(Rj∗j∗B) as in the discussion
of the fusion product, we see that
F ′I(B) ∼= Hom(P(Wi)i, B) ∼= Hom(P(Wi)i, pH0(Rj∗j∗B))
∼= Hom(P(Wi)i, Rj∗j∗B)
∼= Hom(j∗P(Wi)i, j∗B)
∼= Hom(j∗∗i∈I PWi, j∗B)
∼= Hom(∗i∈I PWi, pH0(Rj∗j∗B)) ∼= Hom(∗i∈I PWi, B).
It remains to prove part (iii). We can assume that Λ = Z/ℓcZ, using base change. Note ﬁrst
that
F ′ =
M
m
Hm(RπG∗) : Perv(Hck{i}
G,W , Λ) →ModWE(Λ)
admits a left adjoint L′
W , by the adjoint functor theorem. We need to see that when evaluated
at the unit, PW := L′
W (1) is universally locally acyclic, and ﬂat perverse. By the characterization
of these properties, it suﬃces to show that F ′(PW ) ∈ModWE(Λ) is a representation on a ﬁnite
projective Λ-module. This does not depend on the WE-action, so we can check these things after
pullback along Spd C →Div1
X, where C is a completed algebraic closure of E. In particular, we
can assume that G is split. For any open Schubert cell
jµ : HckG,Spd C,µ ,→HckG,Spd C,W
for µ ∈W, of dimension dµ = ⟨2ρ, µ⟩, we can compute
Hom(PW , pRjµ∗Λ[dµ]) = F ′(pRjµ∗Λ[dµ]).
By Proposition VI.7.9, this is a ﬁnite free Λ-module. Using adjunction, we thus see that
Hom(pj∗
µPW , Λ[dµ])
is a ﬁnite free Λ-module for all µ ∈W. Now pj∗
µPW is concentrated on an open Schubert cell
HckG,Spd C,µ, which is covered by Spd C, and concentrated in degree −dµ. It is thus given by the
constant sheaf M[dµ] for some Λ-module M, and we know that Hom(M, Λ) is ﬁnite free over Λ.
As we reduced to Λ = Z/ℓmZ, this implies that M is free.
Now argue by induction on W, and take a maximal element µ ∈W; let W = W \ {µ}. We get
an exact sequence
0 →K →pjµ!j∗
µPW →PW →Q →0
in Perv(HckG,Spd C, Λ) supported on W. In fact, we necessarily have Q = PW (as they represent the
same functor), for which we know by induction that F ′(Q) is a ﬁnite free Λ-module. We claim that
K = 0. As K lies in the kernel of pjµ!j∗
µPW →pRjµ∗j∗
µPW , it follows from Proposition VI.7.5 that
ℓaK = 0 for some a independent of Λ. Using functoriality of the construction for Λ′ = Z/ℓa+cZ →
Λ = Z/ℓcZ and that pjµ!j∗
µPW lies in the Satake category (so in particular it is ﬂat over Λ), we see
the image of K′ in K is equal to 0. On the other hand, as all constructions are compatible with base

230
VI. GEOMETRIC SATAKE
change, the map K′ →K had to be surjective. It follows that K = 0, as desired. (Alternatively,
we could have reduced to Zℓ-coeﬃcients, in which case pjµ!j∗
µPW →pRjµ∗j∗
µPW is injective (as the
kernel is both ℓ-torsion free and killed by ℓa), implying K = 0 directly.)
□
Now we use the following general Tannakian reconstruction result. This is essentially an ax-
iomatization of [MV07, Proposition 11.1]. Recall that a symmetric monoidal category is rigid if
all of its objects are dualizable.
Proposition VI.10.2. Let A be a rigid symmetric monoidal category, and let C be a symmetric
monoidal category with a tensor action of A. Moreover, let
F : C →A
be a symmetric monoidal A-linear conservative functor, such that C admits and F reﬂects coequaliz-
ers of F-split parallel pairs. Assume that C can be written as a ﬁltered union of full subcategories Ci,
stable under coequalizers of F-split parallel pairs and the A-action, such that F|Ci is representable
by some Xi ∈C.
Then
H = lim
−→
i
F(Xi)∨∈Ind(A)
admits a natural structure as a bialgebra (with commutative multiplication and associative comul-
tiplication), and C is naturally equivalent to the symmetric monoidal category of representations of
H in A. If C is rigid, then H admits an inverse, i.e. is a Hopf algebra.
Here, the symmetric monoidal category of representations of H is the category of comodules over
H as a coalgebra, endowed with the symmetric monoidal structure coming from the commutative
multiplication on H.
Proof. Consider Fi = F|Ci : Ci →A. This admits the left adjoint A 7→A ⊗Xi, as
HomCi(A ⊗Xi, Y ) ∼= HomCi(Xi, A∨⊗Y ) ∼= F(A∨⊗Y ) ∼= A∨⊗F(Y ) ∼= Hom(A, F(Y )).
By the Barr–Beck monadicity theorem, it follows that Ci is equivalent to the category of modules
over the monad
A 7→F(A ⊗Xi) ∼= A ⊗F(Xi).
Note that the monad structure here is equivalently turning F(Xi) into an associative algebra
Ai ∈A, and its category of modules is the category of modules over Ai. Passing to duals, we note
that F(Xi)∨is a coalgebra, and its category of comodules is equivalent to the category of modules
over Ai, i.e. to Ci. Now we can take a colimit over i and see that
H = lim
−→
i
F(Xi)∨
is naturally a coalgebra whose category of comodules in A is equivalent to C. The functor is the
following: Any X ∈C deﬁnes the object F(X) ∈A and for any i large enough so that X ∈Ci a
map F(X) ⊗Xi →X (by adjunction), thus a map
F(X) ⊗F(Xi) ∼= F(F(X) ⊗Xi) →F(X),
and hence dually we get the map
F(X) →F(X) ⊗F(Xi)∨→F(X) ⊗H.

VI.10. TANNAKIAN RECONSTRUCTION
231
Moreover, for any i, j there is some k such that
Ci ⊗Cj ⊂Ck :
indeed, Ci (resp. Cj) is generated by Xi (resp. Xj) under tensors with A and coequalizers of F-split
parallel pairs, so Ci ⊗Cj is generated by Xi ⊗Xj under these operations. Thus, for any k such that
Xi ⊗Xj ∈Ck, we actually have Ci ⊗Cj ⊂Ck. Let Xk ∈Ck represent F|Ck; then we have a natural
map
Xk →Xi ⊗Xj.
Indeed, this is adjoint to a map 1 →F(Xi ⊗Xj) = F(Xi) ⊗F(Xj), for which we use the tensor
product of the unit maps 1 →F(Xi), 1 →F(Xj). This means that there is a natural map
H ⊗H = lim
−→
i,j
F(Xi)∨⊗F(Xj)∨∼= lim
−→
i,j
F(Xi ⊗Xj)∨→lim
−→
k
F(Xk)∨= H,
which turns H into a commutative algebra, where the unit is induced by the maps Xi →1 adjoint
to 1 = F(1) ∈A (inducing maps 1 = F(1) →F(Xi)∨).
It is a matter of unraveling deﬁnitions that this makes H into a Hopf algebra whose symmetric
monoidal category of representations in A is exactly C. If C is rigid, one also sees that A admits
an inverse. Indeed, one can write
F(Xi)∨∼= F(X∨
i ) ∼=Hom(Xi, X∨
i ) ∼=Hom(Xi ⊗Xi, 1)
and the switching of the two factors deﬁnes the desired involution on A. Here Hom ∈A denotes
the internal Hom over A.
□
We can apply Proposition VI.10.2 to SatI
G(Λ) to get Hopf algebras
HI
G(Λ) ∈Ind(RepW I
E(Λ)).
Proposition VI.10.3. The exterior tensor product
⊠i∈I :
Y
i∈I
Sat{i}
G (Λ) →SatI
G(Λ)
induces an isomorphism
O
i∈I
H{i}
G (Λ) ∼= HI
G(Λ).
Proof. This is a consequence of the construction of the Hopf algebras together with Proposi-
tion VI.10.1 (ii), noting that
F I(∗i∈I Ai) ∼=
O
i∈I
F(Ai).
□
We see that all information about the categories SatI
G(Λ) is in the Hopf algebra
HG(Λ) = H{∗}
G (Λ) ∈Ind(RepWE(Λ)).
Note also that the construction of HG(Λ) is compatible with base change in Λ, so it is enough to
consider the case Λ = Z/nZ with n prime to p. In fact, note that we can formally take the inverse
limit over n to deﬁne
SatG(bZp) = lim
←−
n
SatG(Z/nZ)

232
VI. GEOMETRIC SATAKE
with a ﬁbre functor into
Repcont
WE (bZp) = lim
←−
n
RepWE(Z/nZ),
the category of continuous representations of WE on ﬁnite free bZp = lim
←−n Z/nZ-modules, yielding
a Hopf algebra
HG ∈Ind(Repcont
WE (bZp)).
This can equivalently be thought of as an aﬃne group scheme G
V
over bZp, with an action of WE
that is in a suitable sense continuous.
VI.11. Identiﬁcation of the dual group
Our goal is to identify G
V
with the Langlands dual group of G. Recall that the universal Cartan
of G deﬁnes a cocharacter group X∗as an ´etale sheaf on Spec(E), i.e. equivalently a ﬁnite free
abelian group X∗together with an action of the absolute Galois group of E, and in particular of
WE. It comes with the WE-stable set of coroots Φ∨⊂X∗, and the subset of positive roots Φ∨
+.
Dually, we have the cocharacters X∗and dominant Weyl chamber (X∗)+ ⊂X∗, and the roots
Φ ⊂X∗, containing the positive roots Φ+ ⊂Φ. These data give rise to a pinned Chevalley group
scheme bG over bZp (or already over Z, but we will only consider it over bZp) corresponding to the
dual root data (X∗, Φ, X∗, Φ∨). Being pinned, there are distinguished torus and Borel bT ⊂bB ⊂bG,
isomorphisms X∗( bT) ∼= X∗under which the positive coroots Φ∨
+ correspond to the weights of bT on
Lie bB/ Lie bT, so
Lie bB/ Lie bT =
M
a∈Φ∨
+
Lie bUa
for root subgroups bUa ⊂bB. Moreover, one has ﬁxed pinnings
ψa : Lie bUa ∼= bZp
for all simple roots a. We want to endow bG with a WE-action. We already have the WE-action on
(X∗, Φ, X∗, Φ∨), but we need to twist the action on the pinning. More precisely, let us write the
pinning instead with a Tate twist as
ψa : Lie bUa ∼= bZp(1).
Then WE acts naturally on the pinning as well, and thereby induces an action of WE on bG.
We aim to prove the following theorem. Recall that we write G
V
for the Tannaka group arising
from the Satake category. Generally, we will denote by −
V
various objects deﬁned via the Satake
category, while by b−we will denote objects formally deﬁned as Langlands duals.
Theorem VI.11.1. There is a canonical WE-equivariant isomorphism G
V
∼= bG.
We note that the formulation of this theorem is slightly more precise than the formulation in
[MV07], where no canonical isomorphism is given. Also, we handle the case of non-split groups.
Note that in particular, G
V
only depends on G up to inner automorphisms; this is not clear.

VI.11. IDENTIFICATION OF THE DUAL GROUP
233
To prove the theorem, we can work over Zℓfor some ℓ̸= p: Indeed, the statement of the
theorem is equivalent to having isomorphisms over Z/nZ for all n prime to p (by the Tannakian
perspective), so the reduction follows from the Chinese remainder theorem.
We will now ﬁrst prove the theorem when the group G is split; more precisely, if we have ﬁxed a
split torus and Borel T ⊂B ⊂G and trivializations of all simple root groups Ua ⊂B. Afterwards,
we will verify that the isomorphism does not depend on this pinning (essentially, as pinnings vary
algebraically, while automorphisms of bG/Zℓform an ℓ-adic group), and ﬁnally use Galois descent
to deduce the result in general.
Note ﬁrst that if G = T is a torus, then GrT,Div1
X ∼= X∗(T) × Div1
X, and it is clear that SatT
is just the category of X∗(T)-graded objects in Repcont
WE (Zℓ). This implies that T
V
∼= bT is the dual
torus with X∗( bT) = X∗(T).
We have the symmetric monoidal constant term functor
CTB[deg] : SatG →SatT ,
and it commutes with the ﬁbre functors by the identity L
i Hi(RπG∗) ∼= H0(RπT∗CTB[deg]). This
gives rise to a WE-equivariant map bT = T
V
→G
V
. Using the objects Aµ = pjµ!Zℓ[dµ], whose µ-weight
space is 1-dimensional, we see that the map T
V
→G
V
must be a closed immersion.
We have the following information about the generic ﬁbre G
V
Qℓ, following [MV07, Section 7].
First, it follows from Proposition VI.7.5 that its category of representations SatG(Qℓ) is given by
SatG(Qℓ) ∼=
M
µ
Repcont
WE (Qℓ) ⊗Aµ.
(Here
SatG(Qℓ) = SatG(Zℓ)[1
ℓ],
where SatG(Zℓ) = lim
←−m SatG(Z/ℓmZ).) The category of representations of G
V
Qℓas an abstract group
scheme is then given by
SatG(Qℓ) ⊗Repcont
WE (Qℓ) Vect(Qℓ) ∼=
M
µ
Vect(Qℓ) ⊗Aµ,
and in particular is semisimple. As Aµ ∗Aµ′ contains Aµ+µ′ as a direct summand and X+
∗is ﬁnitely
generated as a monoid, we see that SatG(Qℓ) has a ﬁnite number of tensor generators. This implies
that G
V
Qℓis of ﬁnite type by [DM82, Proposition 2.20]. Moreover, it is connected as SatG(Qℓ)
does not have nontrivial ﬁnite tensor subcategories (as for any Aµ with µ ̸= 0, the tensor category
generated by Aµ contains all Anµ), cf. [DM82, Corollary 2.22]. As SatG(Qℓ) is semisimple, we even
know that G
V
Qℓis reductive by [DM82, Proposition 2.23]. For any simple object Aµ, the weights
of Aµ on bTQℓ→G
V
Qℓare contained in the set of all λ ∈X∗= X∗( bT) such that the dominant
representative of λ is bounded by µ in the dominance order, and contains µ (with weight 1). This
implies that T
V
Qℓ→G
V
Qℓis a maximal torus of G
V
Qℓ. We can also deﬁne a subgroup B
V
⊂G
V
as the
stabilizer of the ﬁltration associated to the cohomological grading of F (stabilizing the ﬁltration
L
m≤i RmπG∗on the ﬁbre functor F = L
m RmπG∗); then B
V
Qℓ⊂G
V
Qℓis a Borel.

234
VI. GEOMETRIC SATAKE
Now we analyze the case G = PGL2. In that case, we have the minuscule cocharacter µ : Gm →
G giving rise to the minuscule Schubert cell GrG,Div1
X,µ ∼= P1
Div1
X. Then
F(Aµ) = H0(P1) ⊕H2(P1) = Zℓ⊕Zℓ(−1)
as WE-representation. This is a representation of G
V
, giving a natural map G
V
→GL(Zℓ⊕Zℓ(−1)).
We claim that this is a closed immersion, with image given by SL(Zℓ⊕Zℓ(−1)). Note that T
V
acts
on Zℓ⊕Zℓ(−1) with weight ±1, and in particular lands inside SL(Zℓ⊕Zℓ(−1)). As G
V
Qℓis reductive
of rank 1, it necessarily follows that
G
V
Qℓ→SL(Qℓ⊕Qℓ(−1))
is an isomorphism, and integrally we get a map G
V
→SL(Zℓ⊕Zℓ(−1)). This gives a map G
V
Fℓ→
SL(Fℓ⊕Fℓ(−1)). Let H ⊂SL(Fℓ⊕Fℓ(−1)) be the closed subgroup that is the image of G
V
Fℓ. Note
that the irreducible representations of G
V
Fℓ(as an abstract group) are in bijection with dominant
cocharacters, corresponding to the simple objects Bµ = jµ!∗Fℓon GrG,Spd C; each Bµ has a highest
weight vector given by weight µ. It follows that H satisﬁes the hypothesis of the next lemma.
Lemma VI.11.2. Let H be a closed subgroup of SL2 /Fℓcontaining the diagonal torus such that
its set of irreducible representations injects into Z≥0 via consideration of highest weight vectors.
Then H = SL2.
Proof. Using a power of Frobenius, one can assume that H is reduced, and thus smooth. By
[DM82, Corollary 2.22] and consideration of highest weight vectors, one also sees that H must
be connected. Then H is either the torus, or a Borel, or SL2. The ﬁrst cases lead to too many
irreducible representations.
□
Thus, the map G
V
Fℓ→SL(Fℓ⊕Fℓ(−1)) is surjective. Together with the isomorphism on the
generic ﬁbre, this implies formally that G
V
→SL(Zℓ⊕Zℓ(−1)) is an isomorphism by the following
lemma (used on the level of the corresponding Hopf algebras).
Lemma VI.11.3. Let f : M →N be a map of ﬂat Zℓ-modules such that M/ℓ→N/ℓis injective
and M[1
ℓ] →N[1
ℓ] is an isomorphism. Then f is an isomorphism.
Proof. As M is ﬂat, f : M →N is injective; moreover, for any x ∈N there is some minimal k
such that ℓkn = f(m) lies in the image of M. But if k > 0, then m lies in the kernel of M/ℓ→N/ℓ,
a contradiction.
□
The subgroup B
V
⊂G
V
is then given by the Borel stabilizing the line Zℓ⊂Zℓ⊕Zℓ(−1). Its
unipotent radical is the space of maps Zℓ(−1) →Zℓ, which is canonically isomorphic to Zℓ(1). This
ﬁnishes the proof of the theorem for G = PGL2.
If now G is of rank 1, we get the map G →Gad ∼= PGL2, where the isomorphism Gad ∼= PGL2
is uniquely determined by our choice of pinning. The map
GrG,Div1
X →GrGad,Div1
X
is an isomorphism when restricted to each connected component, inducing an isomorphism
GrG,Div1
X ∼= π1(G) ×π1(Gad) GrGad,Div1
X .

VI.11. IDENTIFICATION OF THE DUAL GROUP
235
Here of course π1(Gad) ∼= Z/2Z.
This implies that SatG can be equivalently described as the
category of A ∈SatGad together with a reﬁnement of the Z/2Z-grading to a π1(G)-grading. This
implies that G
V
= Gad
V
×µ2 Z
V
where Z
V
is the split torus with character group π1(G). Thus, one gets
an isomorphism G
V
∼= bG also in this case, including the isomorphism ψa on the root group.
Coming back to a general split group G, let a be any simple coroot.
We now look at the
corresponding minimal Levi subgroups Ma ⊂G properly containing T, with parabolic Pa ⊂B. We
have the symmetric monoidal constant term functor
CTPa[degPa] : SatG →SatMa,
commuting with the functors to SatT . This induces a map Ma
V
→G
V
, commuting with the inclusion
of T
V
into both. In particular, passing to Lie algebras, we see that a ∈X∗= X∗(T
V
) is a root of G
V
,
and a∨∈X∗= X∗(T
V
) is a coroot of G
V
. Moreover, if sa ∈W is the corresponding simple reﬂection
for G, we also see that sa ∈W
V
, the Weyl group of the reductive group G
V
Qℓ. Using this information
for all a, we see that W ⊂W
V
, and that under X∗= X∗(T
V
) resp. X∗= X∗(T
V
), we have
Φ∨⊂Φ(G
V
Qℓ), Φ ⊂Φ∨(G
V
Qℓ).
Moreover, for any irreducible object Aµ ∈SatG(Qℓ), the weights of Aµ are contained in the convex
hull of the W-orbit of µ. This implies that these inclusions must be isomorphisms — indeed, the
directions of the edges emanating from µ, for µ regular, correspond to Φ(G
V
Qℓ). Together with the
isomorphisms on simple root groups, we get a unique isomorphism
G
V
Qℓ∼= bGQℓ.
Under this isomorphism, the map c
Ma ∼= Ma
V
→G
V
is compatible with the map c
Ma →bG induced by
Langlands duality. It follows that
G
V
(˘Zℓ) ⊂G
V
(˘Qℓ) ∼= bG(˘Qℓ)
is a subgroup containing all c
Ma(˘Zℓ). But these generate bG(˘Zℓ), so bG(˘Zℓ) ⊂G
V
(˘Zℓ). Now pick a
representation G
V
→GLN (given by some object of SatG) that is a closed immersion over Qℓ. By
the inclusion bG(˘Zℓ) ⊂G
V
(˘Zℓ), we see that the map bGQℓ∼= G
V
Qℓ→GLN extends to a map bG →GLN.
By Lemma VI.11.4, this is necessarily a closed immersion, at least if ℓ̸= 2 or bG is simply connected.
We can always reduce to the case that bG is simply connected by arguing with the adjoint group Gad
(whose dual group d
Gad is simply connected) ﬁrst, as in the discussion of rank-1-groups above. It
then follows that G
V
→GLN factors over bG ,→GLN, giving a map G
V
→bG that is an isomorphism
in the generic ﬁbre, and surjective in the special ﬁbre (as any Fℓ-point of bG lifts to ˘Zℓ, and then to
G
V
(˘Zℓ)), and hence an isomorphism by Lemma VI.11.3.
Lemma VI.11.4 ([PY06, Corollary 5.2]). Let H be a reductive group over Zℓ, H′ some aﬃne
group scheme of ﬁnite type over Zℓ, and let ρ : H →H′ be a homomorphism that is a closed
immersion in the generic ﬁbre. Assume that ℓ̸= 2, or that no almost simple factor of the derived
group of HQℓis isomorphic to SO2n+1 (e.g., the derived group of H is simply connected). Then ρ
is a closed immersion.
This ﬁnishes the proof of Theorem VI.11.1 when G is split, and endowed with a splitting. Now
we prove independence of the choice of splitting. For this, we note that in fact the cohomological

236
VI. GEOMETRIC SATAKE
grading on F alone determines T
V
⊂G
V
as its stabilizer, and B
V
⊂G
V
as the stabilizer of the associated
ﬁltration. It remains to check that the isomorphisms
ψa : Lie bUa ∼= Zℓ(1)
are independent of the choices. For this, consider the ﬂag variety Fℓover E, parametrizing Borels
B ⊂G. Each such Borel comes with its torus T, which is the universal Cartan and thus descends to
E. Equivalently, note that tori over Fℓare equivalent to ´etale Z-local systems, and as Fℓis simply
connected all of them come via pullback from E; this then gives the so-called universal Cartan T
over E, which is split as G is split. Let a be a simple coroot of G. At each point of Fℓ, we get
the corresponding parabolic Pa ⊃B, with Levi Ma. Let f
Fℓa →Fℓparametrize pinnings of Ma,
i.e. isomorphisms of Ua with the additive group; this is a Gm-torsor. Over f
Fℓa, the universal group
Ma is constant, with adjoint group Ma,ad ∼= PGL2. Consider
S = f
Fℓ
♦/ϕZ →Spd E/ϕZ = Div1
X.
Applying the constant term functor for Pa over S gives a symmetric monoidal functor
Sat(HckG,Div1
X ×Div1
XS, Zℓ) →Sat(HckMa,Div1
X ×Div1
XS, Zℓ);
here, being symmetric monoidal is veriﬁed by repeating the construction of the fusion product after
the smooth pullback S →Div1
X. Both sides admit ﬁbre functors to LocSys(S, Zℓ); this contains
LocSys(Div1
X, Zℓ) = Repcont
WE (Zℓ) fully faithfully, and we can consider the symmetric monoidal full
subcategories on which the ﬁbre functors land in this subcategory. As the constant term functor is
compatible with ﬁbre functors, it induces a symmetric monoidal functor on these full subcategories,
which are then easily seen to be equivalent to SatG and SatM (reconstructing both starting from
Schubert cells). This shows that the constant term functor SatG →SatMa is naturally independent
of the choice of Borel, reducing us to the rank 1 case. In the rank 1 case, we can then further
reduce to PGL2, and we have the minuscule Schubert variety, which is the ﬂag variety Fℓ∼= P1 of
G ∼= PGL2. There are canonical isomorphisms
H0(Fℓ) = Zℓ, H2(Fℓ) = Zℓ(−1),
and bUa is canonically isomorphic to Hom(H2(Fℓ), H0(Fℓ)) ∼= Zℓ(1).
Thus, we have shown that if G is split, the isomorphism G
V
∼= bG is canonical. Finally, the
general case follows by Galois descent from a ﬁnite Galois extension E′|E splitting G.
VI.12. Chevalley involution
Any Chevalley group scheme bG comes with the Chevalley involution, induced by the map on
root data which on X∗is given by µ 7→−w0(µ) where w0 is the longest Weyl group element.
Under the geometric Satake equivalence, this has a geometric interpretation: Namely, it essentially
corresponds to the switching equivalence sw∗. Note that one can upgrade
sw∗: SatI
G(Λ) →SatI
G(Λ)
to a symmetric monoidal functor by writing it as the composition of Verdier duality and the
duality functor sw∗D in SatI
G(Λ); moreover, this symmetric monoidal functor commutes with the
ﬁbre functor F I (as symmetric monoidal functors), cf. Corollary VI.9.5. Thus, sw∗induces an
automorphism of the Tannaka group G
V
, commuting with the WE-action.

VI.12. CHEVALLEY INVOLUTION
237
Proposition VI.12.1. Under the isomorphism G
V
∼= bG with the dual group, the isomorphism
sw∗is given by the Chevalley involution, up to conjugation by bρ(−1) ∈bGad(Zℓ).
Remark VI.12.2. There is a diﬀerent construction of the commutativity constraint on SatG,
not employing the fusion product, that relies on the Chevalley involution — this is essentially a
categorical version of the classical Gelfand trick to prove commutativity of the Satake algebra.
For the Satake category, this construction was ﬁrst proposed by Ginzburg [Gin90], who however
overlooked the sign bρ(−1). Zhu’s proof [Zhu17] of the geometric Satake equivalence for GrWitt
G
used this approach, taking careful control of the signs; these are related to the work of Lusztig–Yun
[LY13]. We remark that Zhu gives a diﬀerent construction of the commutation of sw∗with the ﬁbre
functor, using instead that the two actions (on left and right) of H∗([∗/L+G], Qℓ) on H∗(HckG, A)
agree for A ∈SatG(Qℓ).
Proof. We note that this is really a proposition: The statement only asks about the com-
mutation of a certain diagram, not some extra structure. For the statement, we can also forget
about the WE-action. In particular, enlarging E, we can assume that G is split. As in the proof
of Theorem VI.11.1, one can reduce to the case that G is adjoint, so bG is semisimple and simply
connected. We also ﬁx a pinning of G.
Now, being pinned, G has its own Chevalley involution θ : G →G, and by the functoriality of all
constructions under isomorphisms, the induced automorphism of SatG corresponds to the Chevalley
involution of bG. In other words, we need to see that the automorphism θ∗sw∗: SatG →SatG (which
is symmetric monoidal, and commutes with the ﬁbre functors) induces conjugation by ρ
V
(−1) on G
V
.
We claim that the natural cohomological grading on the ﬁbre functor F : SatG(Λ) →RepWE(Λ)
is compatible with sw∗. In other words, we need to see that in Corollary VI.9.5, the isomorphism
F(A) ∼= F(sw∗A) is compatible with the grading, which follows from its construction. In particular,
it follows that the automorphism of G
V
restricts to the identity on the corresponding cocharacter
2ρ
V
: Gm ⊂G
V
. This implies already that it preserves T
V
and the Borel B
V
(as the centralizer and
dynamical parabolic).
Any such automorphism of G
V
is given by conjugation by some element
s ∈T
V
ad ⊂G
V
ad. We need to see that s = ρ
V
(−1). Equivalently, the automorphism acts by negation
on any simple root space U
V
a of G
V
.
We claim that the symmetric monoidal automorphism θ∗sw∗: SatG →SatG (commuting with
the ﬁbre functor) is compatible with the constant term functors CTP , for any standard parabolic
P ⊃B, and the similar functor on Levi subgroups. Let θ′ be the composition of θ with conjugation
by w0. We know, by the proof of Theorem VI.11.1, that any inner automorphism of G induces the
identity on G
V
. Thus, it suﬃces to prove the similar claim for θ′∗sw∗: SatG →SatG. Let P −⊂G
be the opposite parabolic of P; then θ′(P −) = P, and the induced automorphism of the Levi M
is given by the corresponding automorphism θ′
M deﬁned similarly as θ′. Now Proposition IV.6.13
and the fusion deﬁnition of the symmetric monoidal structure (along with the deﬁnition of sw∗as
the composite of Verdier duality and internal duality) give the claim.
These observations reduce us to the case G = PGL2. We note that in this case the Chevalley
involution is the identity, so we can ignore θ. We have the minuscule Schubert variety iµ : GrG,µ =
P1 ⊂GrG and the sheaf A = iµ∗Zℓ[1](1
2) ∈SatG (assuming without loss of generality √q ∈Λ to

238
VI. GEOMETRIC SATAKE
introduce a half-Tate twist), and we know G
V
= SL(F(A)), where
F(A) = F(A)1 ⊕F(A)−1 = H0(P1)(1
2) ⊕H2(P1)(1
2).
The image of A under sw∗is isomorphic to A itself; ﬁx an isomorphism. Then on the one hand
F(A) ∼= F(sw∗A)
as the functor sw∗: SatG →SatG commutes with the ﬁbre functor F, while on the other hand
F(sw∗A) ∼= F(A)
as the two objects are isomorphic. We need to see that the composite isomorphism is given by the
diagonal action of (u, −u) for some u ∈Z×
ℓ(this claim is independent of the chosen isomorphism
between A and sw∗A). We already know that the isomorphism is graded, so it is given by diagonal
multiplication by (u1, u2) for some units u1, u2 ∈Z×
ℓ.
Recall that the ﬁrst isomorphism is constructed as the composite of Verdier duality and internal
duality in SatG. Now the Verdier dual of A is A itself (because of the half-Tate twist), and the
Verdier duality pairing
F(A) ⊗F(A) →Zℓ
is the tautological pairing; in particular, restricted to F(A)−1⊗F(A)1 and F(A)1⊗F(A)−1 it is the
same map, up to the natural commutativity constraint on Zℓ-modules. It follows that the internal
dual A∨of A is also isomorphic to A, and picking such an identiﬁcation we need to understand the
induced pairing
F(A) ⊗F(A) →F(1) = Zℓ,
and show that when restricted to F(A)−1⊗F(A)1 and F(A)1⊗F(A)−1, the two induced maps diﬀer
by a sign (up to the natural commutativity constraint); this claim is again independent of the chosen
isomorphism between A∨and A. But this is a question purely internal to the symmetric monoidal
category SatG ∼= Rep(SL2) with its ﬁbre functor. In there, we have the tautological representation
V = Z2
ℓ= Zℓe1 ⊕Zℓe2, and it has the determinant pairing V ⊗V →Zℓas SL2-representation,
realizing the internal duality. The determinant pairing is alternating, so takes opposite signs on
(e1, e2) and (e2, e1), as desired.
□

CHAPTER VII
D■(X)
In order to deal with smooth representations of G(E) on Qℓ-vector spaces (not Banach spaces),
we extend (a modiﬁed form of) the 6-functor formalism from [Sch17a] to the larger class of solid
pro-´etale sheaves. The results in this chapter were obtained in discussions with Clausen, and Mann
has obtained analogues of some of these results in the case of schemes. (Strangely enough, in some
respects the formalism actually works better for diamonds than for schemes.)
More precisely, we want to ﬁnd a “good” category of Qℓ-sheaves on [∗/G(E)] that corresponds
to smooth representations of G(E) with values in Qℓ-vector spaces, and extends to a category of
Qℓ-sheaves on BunG with a good formalism of six operations that allows us to extend the preceding
results for ´etale torsion coeﬃcients. The ﬁrst idea would be to take pro-systems of ´etale torsion
sheaves as Zℓ-coeﬃcients and invert formally ℓ; this formalism is easy to construct, see [Sch17a,
Section 26]. This would give rise to continuous representations of G(E) in Qℓ-Banach spaces, and
we do not want that:
• supercuspidal representations of G(E) in Qℓ-vector spaces are deﬁned over a ﬁnite degree exten-
sion of Qℓ, and after twist admit an invariant lattice that allows us to complete them ℓ-adically,
but we do not want to make such a choice.
• we want to construct semi-simple Langlands parameters using the Bernstein center and not some
ℓ-adic completion of it.
• in usual discussions of the cohomology of the Lubin–Tate tower, or more general Rapoport–Zink
spaces, it is possible to use Qℓ-coeﬃcients while talking about usual smooth representations. We
want to be able to achieve the same on the level of BunG.
We could take Qℓ-pro-´etale sheaves. This would give rise to representations of G(E) (seen as
a condensed group) with values in condensed Qℓ-vector spaces. This category is too big; there is
no hope to obtain a formalism of six operations in this too general context. We need to ask for
some “completeness” of the sheaves, for which we take inspiration from the theory of solid abelian
groups developed in [CS].
The idea is the following. We deﬁne a category of solid pro-´etale Qℓ-sheaves on BunG with a
good formalism of (a modiﬁed form of) six operations. More precisely, for any small v-stack, we
deﬁne a full subcategory
D■(X, Zℓ) ⊂D(Xv, Zℓ),
compatible with pullback, and equipped with a symmetric monoidal tensor product (for which
pullback is symmetric monoidal). A complex is solid if and only if each cohomology sheaf is solid,
and this can be checked v-locally. The subcategory D■(X, Zℓ) is stable under all (derived) limits and
colimits, and the inclusion into D(Xv, Zℓ) admits a left adjoint. If X is a diamond, then D■(X, Zℓ)
239

240
VII. D■(X)
is also a full subcategory of D(Xqpro´et, Zℓ). If X is a spatial diamond, then on the abelian level, the
category of solid Zℓ-sheaves is the Ind-category of the Pro-category of constructible ´etale sheaves
killed by some power of ℓ. In this way, one can bootstrap many results from the usual ´etale case.
For any map f : Y →X of small v-stacks, the pullback functor f∗admits a right adjoint
Rf∗: D■(Y, Zℓ) →D■(X, Zℓ) that in fact commutes with any base change, see Proposition VII.2.4.
Similarly, the formation of RHom commutes with any base change. Both of these operations can
a priori be taken in all v-sheaves, but turn out to preserve solid sheaves. This already gives us four
operations.
Unfortunately, Rf! does not have the same good properties as usual. In particular, if f is proper
(and ﬁnite-dimensional), Rf∗does not in general satisfy a projection formula. As a remedy, it turns
out that for all f, the functor f∗admits a left adjoint
f♮: D■(Y, Zℓ) →D■(X, Zℓ),
given by “relative homology”. This is a completely novel feature, and already for closed immer-
sions this takes usual ´etale sheaves to complicated solid sheaves. Again f♮commutes with any
base change, and also satisﬁes the projection formula (which is just a condition here, as there is
automatically a natural map).
When f is “proper and smooth”, one can moreover relative f♮(“homology”) and Rf∗(“coho-
mology”) in the expected way. One also gets a formula for the dualizing complex of f in terms
of such functors. These results even extend to universally locally acyclic complexes. This solid
5-functor formalism thus has some excellent formal properties. We are somewhat confused about
exactly how expressive it is, and whether it is preferable over the standard 6-functor formalism.
One advantage is certainly that f♮is more canonical, and even deﬁned much more generally, than
Rf! (whose construction for stacky maps would require the resolution of very subtle homotopy
coherence issues, and also can only be deﬁned for certain (ﬁnite-dimensional) maps). The main
problem with the solid formalism is that a stratiﬁcation of a stack does not lead to a semi-orthogonal
decomposition on the level of D■.
On the other hand, for our concerns here, D■(BunG, Zℓ) is much too large. On [∗/G(E)] this
gives rise to representations of G(E) (as a condensed group) with values in solid Zℓ-modules. The
category of discrete Qℓ-vector spaces injects into the category of solid Zℓ-modules. In fact, Qℓ-vector
spaces are the same as Ind-ﬁnite dimensional vector spaces. Any ﬁnite dimensional Qℓ-vector space
is complete and thus “solid”. This means that if V is a Qℓ-vector space then it gives rise to the
solid condensed sheaf V ⊗Qdisc
ℓ
Qℓwhose value on the proﬁnite set S is
lim
−→
W⊂V
ﬁnite dim.
Cont(S, W).
The category of smooth representations of G(E) with values in discrete Qℓ-vector spaces injects
in the category of solid Qℓ-pro-´etale shaves on [∗/G(E)]. In fact, since ℓ̸= p and G(E) is locally
pro-p, representations of the condensed group G(E) on the condensed Qℓ-vector space V ⊗Qdisc
ℓ
Qℓ
are the same as smooth representations of G(E) on V .

VII.1. SOLID SHEAVES
241
We then cut out a subcategory Dlis(BunG, Qℓ) of D■(BunG, Zℓ) that gives back the category
of smooth representations of G(E) in Qℓ-vector spaces when we look at [∗/G(E)]. (Of course, we
can also stick with Zℓ-coeﬃcients.)
VII.1. Solid sheaves
In the following, bZ always denotes the pro-´etale sheaf bZ = lim
←−n Z/nZ where n runs over nonzero
integers. We will quickly restrict attention to bZp = lim
←−(n,p)=1 Z/nZ, allowing only n prime to p.
Let X be a spatial diamond. For any quasi-pro-´etale j : U →X that can be written as a
coﬁltered inverse limit of qcqs ´etale ji : Ui →X, we let
j♮bZ = lim
←−
i
ji!bZ;
as the pro-system of the Ui is unique, this is well-deﬁned. Note that there is a tautological section
of j♮bZ over U. Equivalently, if one writes bZ[U] for the free pro-´etale sheaf of bZ-modules generated
by U (noting that j∗admits a left adjoint on pro-´etale sheaves, being a slice), there is a natural
map bZ[U] →lim
←−i bZ[Ui] = j♮bZ.
When X = Spa(C), j♮bZ is the sheaf denoted bZ[U]■in [CS], and the same notation will be
appropriate here in general.
Definition VII.1.1. Let F be a pro-´etale sheaf of bZ-modules on X. Then F is solid if for all
j : U →X as above, the map
Hom(j♮bZ, F) →F(U)
is an isomorphism.
Let us begin with the following basic example. We note ν : Xqpro´et →X´et the projection to the
´etale site.
Proposition VII.1.2. For any ´etale sheaf F of Z/nZ-modules on X´et, ν∗F is solid.
Proof. This is a consequence of [Sch17a, Proposition 14.9].
□
The notion of solid sheaf is well-behaved:
Theorem VII.1.3. The category of solid bZ-sheaves on X is an abelian subcategory of all pro-
´etale bZ-sheaves on X, stable under all limits, colimits, and extensions. It is generated by the ﬁnitely
presented objects j♮bZ for quasi-pro-´etale j : U →X as above, and the inclusion admits a left adjoint
F 7→F ■that commutes with all colimits.
Let F be a pro-´etale bZ-sheaf on X. The following conditions are equivalent.
(1) The bZ-sheaf F is ﬁnitely presented in the category of all pro-´etale bZ-sheaves, and is solid.
(2) The bZ-sheaf F is solid, and ﬁnitely presented in the category of solid bZ-sheaves.
(3) The bZ-sheaf F can be written as a coﬁltered inverse limit of torsion constructible ´etale sheaves.

242
VII. D■(X)
For any such F, the underlying pro-´etale sheaf is representable by a spatial diamond. The category
of F satisfying (1) – (3) is stable under kernels, cokernels, and extensions, in particular an abelian
category, and is equivalent to the Pro-category of torsion constructible ´etale sheaves.
Moreover, the category of all solid bZ-sheaves on X is equivalent to the Ind-category of the
Pro-category of torsion constructible ´etale sheaves.
Question VII.1.4. If F is a pro-´etale bZ-sheaf on X whose underlying pro-´etale sheaf is repre-
sentable by a spatial diamond, or even is just qcqs, is F necessarily solid? If so, these conditions
would also be equivalent to (1) – (3).
Let us remark the following lemma.
Lemma VII.1.5. Any torsion constructible ´etale sheaf on the spatial diamond X is represented
by a spatial diamond.
Proof. Let F →X be such a sheaf.
We can ﬁnd a surjection of ´etale sheaves F′ =
L
i ji!Z/niZ →F for some quasicompact separated ´etale maps ji : Ui →X and nonzero inte-
gers ni (where the direct sum is ﬁnite). Then F′ is quasicompact separated ´etale over X, and
thus a spatial diamond; and the surjective map F′ →F is also quasicompact separated ´etale, in
particular universally open, and so also F is a spatial diamond.
□
Before starting the proof, we record a key proposition. Its proof is a rare instance that requires
w-contractible objects — in most proofs, strictly totally disconnected objects suﬃce.
Proposition VII.1.6. Let X be a spatial diamond and let Fi, i ∈I, be a coﬁltered system of
torsion constructible ´etale sheaves. Then for all j > 0 the higher inverse limit
Rj lim
←−
i
Fi = 0,
taken in the category of pro-´etale sheaves on X, vanishes.
Proof. The pro-´etale site of X has a basis given by the w-contractible Y →X, that is strictly
totally disconnected perfectoid spaces Y such that the closed points in |Y | are a closed subset and
π0Y is an extremally disconnected proﬁnite set; equivalently, any pro-´etale cover eY →Y splits,
cf. [BS15, Section 2.4] for a discussion of w-contractibility. Thus, it suﬃces to check sections on
Y . In other words, we may assume that X is w-contractible, and prove that
Rj lim
←−
i
Fi(X) = 0
for all j > 0. As X is strictly totally disconnected, sheaves on X´et are equivalent to sheaves on |X|.
Moreover, we have the closed immersion f : π0X →|X| given by the closed points, and pullback
along this map induces isomorphisms Fi(X) ∼= (f∗Fi)(π0X).
Let S = π0X be the extremally
disconnected proﬁnite set.
Then any torsion constructible sheaf on S is locally constant with ﬁnite ﬁbres. In particular,
f∗Fi maps isomorphically toHom(Hom(f∗Fi, S1), S1) where S1 = R/Z is the sheaf of continuous

VII.1. SOLID SHEAVES
243
maps to the circle. (We could for the moment also use Q/Z, but it will become critical that S1 is
compact.) It follows that
Rj lim
←−
i
Fi(X) = Extj
S(lim
−→
i
Hom(f∗Fi, S1), S1).
Thus, the result follows from the injectivity of S1 as stated in the next lemma.
□
Lemma VII.1.7. Let S be an extremally disconnected proﬁnite set. Then the abelian sheaf R/Z
on S is injective.
Proof. First, we note that R/Z is ﬂasque in a strong sense. Namely, if U ⊂S is any open
subset with closure U ⊂S, then U is the Stone-ˇCech compactiﬁcation of U (as U ⊂S is open by
one deﬁnition of extremally disconnected spaces, and then βU ⊔(S \ U) →S admits a splitting,
which in particular gives a splitting of the surjection βU →U that is the identity on U, thus
implying that βU ∼= U) and hence any section of R/Z over U extends uniquely to U as R/Z is
compact Hausdorﬀ. Also, all sections over U extend to S, as U is open and closed in S.
Let F ,→G be an injection of sheaves on S with a map F →R/Z. Using Zorn’s lemma,
choose a maximal subsheaf of G containing F with an extension of the map to R/Z. Replacing
F by this maximal subsheaf, we can assume that F is maximal already.
If F →G is not an
isomorphism, then it is not an isomorphism on global sections (any local section not in the image
can be extended by zero to form a global section not in the image), so we can ﬁnd a map Z →G
such that F′ = F ×G Z ⊂Z is a proper subsheaf, and we can replace G by Z and assume that F is
a proper subsheaf of Z.
For each integer n, we can look at the open subset jn : Un ⊂S where n ∈Z lies in F. On this
open subset, we have a map nZ →R/Z, and by the above this extends uniquely to jn : Un ,→S.
The extension jn!Z →R/Z necessarily agrees with the restriction of the given map F →R/Z on
the intersection jn!Z ∩F ⊂jn!Z, as this contains the dense subset jn!Z and R/Z is separated.
Thus, by maximality of F, we see that necessarily all Un are open and closed, hence so are
all Vn = Un \ S
m<n Um. Thus V1, V2, . . . ⊂S are pairwise disjoint open and closed subsets such
that F = L
n nZ|Vn. But one can then extend to L
n Z|Vn as the continuous maps from Vn to R/Z
form a divisible group. By maximality of F, this means that Vn is empty for all n > 1, and hence
F = Z|V1 is a direct summand of Z, in which case the possibility of extension is clear.
□
Now we can give the proof of Theorem VII.1.3.
Proof of Theorem VII.1.3. The Pro-category of torsion constructible ´etale sheaves is an
abelian category, and by Proposition VII.1.6 the functor to pro-´etale bZ-sheaves is exact. It is also
fully faithful: For this, it suﬃces to see that if Fi, i ∈I, is a coﬁltered inverse system of torsion
constructible ´etale sheaves and G is any ´etale sheaf, then
lim
−→
i
Hom(Fi, G) →Hom(lim
←−
i
Fi, G)
is an isomorphism. But the underlying pro-´etale sheaf of each Fi is a spatial diamond over X, so
by [Sch17a, Proposition 14.9] (applied with j = 0) we see that the similar result holds true when
then taking homomorphisms of pro-´etale sheaves (without the abelian group structure). Enforcing

244
VII. D■(X)
compatibility with addition amounts to a similar diagram for lim
←−i Fi × lim
←−i Fi to which the same
argument applies.
We see that the Pro-category of torsion constructible ´etale sheaves is a full subcategory C of all
pro-´etale bZ-modules on X, stable under the formation of kernels and cokernels. All of these sheaves
are solid: As the condition of being solid is stable under all limits, it suﬃces to see that any ´etale
sheaf is solid; this is Proposition VII.1.2.
Also, by [Sch17a, Lemma 11.22] and Lemma VII.1.5 all objects of C have as underlying pro-
´etale sheaf a spatial diamond. One also checks that C is stable under extensions, by reduction to
constructible sheaves (cf. proof of Proposition VII.1.12 below).
Next, we prove that (3) implies (1), so let F be in C; in particular, the underlying pro-´etale
sheaf is a spatial diamond. Then for any pro-´etale bZ-module G, one can describe Hom(F, G) as the
maps F →G of pro-´etale sheaves satisfying additivity and bZ-linearity, i.e. certain maps F ×F →G
resp. F × bZ →G agree. This description commutes with ﬁltered colimits (as for spatial diamonds
Y , the functor G 7→G(Y ) commutes with ﬁltered colimits).
Now we can describe the full category of solid bZ-sheaves. Indeed, using that j♮bZ is ﬁnitely
presented in all pro-´etale bZ-modules by the previous paragraph, we see from the deﬁnition that
the category of solid bZ-sheaves is stable under all ﬁltered colimits. In particular, we get an exact
functor from the Ind-category of C to solid bZ-sheaves. This is also fully faithful, as all objects
of C are ﬁnitely presented. Moreover, Ind(C) is an abelian category for formal reasons. We see
that Ind(C) is a full subcategory of the category of pro-´etale bZ-sheaves stable under kernels and
cokernels, and all of its objects are solid. Conversely, any solid bZ-sheaf admits a surjection from a
direct sum of objects of the form j♮bZ ∈C, and the kernel of any such surjection is still solid, so we
may write any solid bZ-sheaf as the cokernel of a map in Ind(C). As Ind(C) is stable under cokernels,
we see that Ind(C) is exactly the category of solid bZ-sheaves.
As ﬁltered colimits of solid sheaves stay solid, it is now formal that (1) implies (2), and (2)
implies (3) as C ⊂Ind(C) are the ﬁnitely presented objects (as C is idempotent-complete). This
ﬁnishes the proof of the equivalences.
The identiﬁcation with Ind(C) shows that the category of solid bZ-sheaves is stable under kernels,
cokernels, and ﬁltered colimits. The latter two imply stability under all colimits, and stability under
all limits is clear from the deﬁnition. One also easily checks stability under extensions by reduction
to C (again, cf. proof of Proposition VII.1.12). For the existence of the left adjoint, note that it
exists on the free pro-´etale bZ-modules generated by U, with value j♮bZ, i.e.
bZ[U]■= j♮bZ.
As these generate all pro-´etale bZ-modules, one ﬁnds that the left adjoint F 7→F ■exists in general:
one can write any F as a colimit lim
−→α bZ[Uα] and (lim
−→α bZ[Uα])■= lim
−→α bZ[Uα]■.
□
We have the following proposition on the functorial behaviour of the notion of solid bZ-sheaves.

VII.1. SOLID SHEAVES
245
Proposition VII.1.8. Let f : Y →X be a map of spatial diamonds. Then pullbacks of solid
bZ-sheaves are solid, and the functor f∗commutes with solidiﬁcation. Moreover, if f is surjective,
and F is a pro-´etale bZ-sheaf on X such that f∗F is solid, then F is solid.
Proof. Recall that f∗commutes with all limits (and of course colimits) by [Sch17a, Lemma
14.4]. To check that f∗commutes with solidiﬁcation, it suﬃces to check on the pro-´etale bZ-modules
bZ[U] generated by some quasi-pro-´etale j : U →X, and in that case the claim follows from f∗
commuting with all limits,
f∗(bZ[U]■) = f∗(lim
←−
i
bZ[Ui]) = lim
←−
i
f∗bZ[Ui] = lim
←−
i
bZ[f∗Ui] = bZ[f∗U]■.
In particular, applied to solid bZ-sheaves on X, this implies that their pullback to Y is already solid.
Now assume that f is surjective and F is a pro-´etale bZ-sheaf on X such that f∗F is solid. Let
j : U = lim
←−i Ui →X be a quasi-pro-´etale map. We ﬁrst check that
Hom(j♮bZ, F) →F(U)
is injective. Indeed, assume that g : j♮bZ →F lies in the kernel. Then after pullback to Y , this
map vanishes since f∗bZ[U]■= bZ[f∗U]■. But for any quasi-pro-´etale V →X, the map F(V ) →
(f∗F)(V ×X Y ) is injective (using [Sch17a, Proposition 14.7] one has f∗F(V ×X Y ) = (λ∗
XF)(V ×X
Y ) and we conclude since V ×X Y →V is a v-cover), so it follows that f = 0.
We see that an element of F(U) determines at most one map j♮bZ →F, and this assertion stays
true after any pullback. By [Sch17a, Proposition 14.7], it suﬃces to construct the map v-locally;
but it exists after pullback to Y →X, thus proving existence.
□
In particular, it makes sense to make the following deﬁnition.
Definition VII.1.9. Let Y be a small v-stack and let F be a v-sheaf of bZ-modules on Y . Then
F is solid if for all maps f : X →Y from a spatial diamond X, the pullback f∗F comes via pullback
from a solid bZ-sheaf on Xqpro´et.
Regarding passage to the derived category, we make the following deﬁnition.
Definition VII.1.10. Let X be a small v-stack. Let D■(X, bZ) ⊂D(Xv, bZ) be the full subcate-
gory of all A such that each cohomology sheaf Hi(A) is solid.
As being solid is stable under kernels, cokernels, and extensions, this deﬁnes a triangulated
subcategory.
If X is a diamond, one could alternatively deﬁne a full subcategory of D(Xqpro´et, bZ) by the same
condition, and pullback from the quasi-pro-´etale to the v-site deﬁnes a functor. This functor is an
equivalence, by repleteness (to handle Postnikov towers, cf. [BS15, Section 3]) and the following
proposition that is an amelioration of [Sch17a, Proposition 14.7] for solid sheaves.
Proposition VII.1.11. Let X be a diamond and let F be a sheaf of bZ-modules on Xqpro´et that
is solid. Let λ : Xv →Xqpro´et be the map of sites. Then F →Rλ∗λ∗F is an isomorphism.

246
VII. D■(X)
Proof. We may assume that X is spatial (or strictly totally disconnected). Then F is a ﬁltered
colimit of ﬁnitely presented solid bZ-sheaves, and the functor Rλ∗commutes with ﬁltered colimits in
D≥0. We may thus assume that F is ﬁnitely presented; in that case F is a coﬁltered limit of torsion
constructible ´etale sheaves, and λ∗commutes with all limits by [Sch17a, Lemma 14.4]. Thus, we
can assume that F is an ´etale sheaf, where the claim is [Sch17a, Proposition 14.7].
□
Moreover, solid objects in the derived category satisfy a derived and internal version of Deﬁni-
tion VII.1.1.
Proposition VII.1.12. Let X be a spatial diamond. For all A ∈D■(X, bZ), the map
RHom(j♮bZ, A) →Rj∗A|U
is an isomorphism for all quasi-pro-´etale j : U →X.
Proof. By taking a Postnikov limit, we can assume that A ∈D+
■(X, bZ), and then one reduces
to the case that A = F[0] is concentrated in degree 0. Now by a resolution of Breen [Bre78,
Section 3] (appropriately sheaﬁﬁed), there is a resolution of any bZ-sheaf G where all terms are ﬁnite
direct sums of sheaves of the form bZ[Gi × bZj]. If G is a spatial diamond, then all Gi × bZj are spatial
diamonds, hence
RHom(bZ[Gi × bZj], F)
commutes with all ﬁltered colimits.
Applied to G = j♮bZ, Breen’s resolution then implies that
RHom(G, −) commutes with all ﬁltered colimits.
We may thus assume that F is ﬁnitely presented. But then Theorem VII.1.3 implies that F is
a limit of constructible ´etale sheaves, so one can reduce to the case that F is an ´etale sheaf. But
then Breen’s resolution shows that
RHom(j♮bZ, F) = lim
−→
i
RHom(ji!bZ, F) = lim
−→
i
Rji∗F|Ui
and [Sch17a, Proposition 14.9] shows that this identiﬁes with Rj∗F|U.
□
Proposition VII.1.13. Let X be a spatial diamond. The inclusion
D■(X, bZ) ⊂D(Xqpro´et, bZ)
admits a left adjoint
A 7→A■: D(Xqpro´et, bZ) →D■(X, bZ).
Moreover, D■(X, bZ) identiﬁes with the derived category of solid bZ-sheaves on X, and A 7→A■with
the left derived functor of F 7→F ■. The formation of A 7→A■, for A ∈D(Xqpro´et, bZ), commutes
with any base change X′ →X of spatial diamonds.
Proof. This follows easily from Proposition VII.1.12.
□
Proposition VII.1.14. Let X be a spatial diamond. The kernel of A 7→A■is a tensor ideal.
In particular, there is a unique symmetric monoidal structure −
■⊗L−on D■(X, bZ) making A 7→A■
symmetric monoidal. It is the left derived functor of the induced symmetric monoidal structure on
solid bZ-sheaves. This symmetric monoidal structure commutes with all colimits (in each variable)
and any pullback.

VII.1. SOLID SHEAVES
247
Proof. To check that the kernel is a tensor ideal, take any quasi-pro-´etale j : U →X written as
a coﬁltered inverse limit of separated ´etale ji : Ui →X, and any further quasi-pro-´etale j′ : U′ →X.
Then for any solid A ∈D■(X, bZ), we know by Proposition VII.1.12 that the map
RHom(j♮bZ, A) →Rj∗A|U
is an isomorphism. Taking sections over U′ →X, this translates into
R Hom(j♮bZ ⊗L
bZ bZ[U′], A) →R Hom(bZ[U ×X U′], A)
being an isomorphism. In other words, taking the tensor product of bZ[U] →j♮bZ with bZ[U′] still
lies in the kernel, but these generate the tensor ideal generated by the kernel.
It is now formal that there is a unique symmetric monoidal structure −
■⊗L−on D■(X, bZ)
making A 7→A■symmetric monoidal (given by the solidiﬁcation of the tensor product in all solid
pro-´etale sheaves). As solidiﬁcation commutes with all colimits, so does this tensor product. On
generators j : U →X, j′ : U′ →X as above, it is given by j♮bZ
■⊗Lj′
♮bZ = (j ×X j′)♮bZ, which still
sits in degree 0; this implies that the functor is a left derived functor. Moreover, this description
commutes with any base change.
□
Moreover, the inclusion into all v-sheaves also admits a left adjoint, if X is a diamond. We will
later improve on this proposition when working with bZp-coeﬃcients.
Proposition VII.1.15. For any diamond X, the fully faithful embedding
D■(X, bZ) ⊂D(Xv, bZ)
admits a left adjoint A 7→A■. The formation of A■commutes with quasi-pro-´etale base change
X′ →X.
Proof. Assume ﬁrst that X is strictly totally disconnected. It suﬃces to construct the left
adjoint on a set of generators, such as the pro-´etale sheaves of bZ-modules generated by some strictly
totally disconnected Y →X. By [Sch17a, Lemma 14.5], there is a strictly totally disconnected
aﬃnoid pro-´etale j : Y ′ →X such that Y →X factors over a map Y →Y ′ that is surjective and
induces a bijection of connected components. Then for any B ∈D■(Y ′, bZ), the map
RΓ(Y ′, B) →RΓ(Y, B)
is an isomorphism. Indeed, by Postnikov limits this easily reduces to B = F[0] for a solid sheaf of
bZ-modules, and then to a ﬁnitely presented solid sheaf, and ﬁnally to a constructible ´etale sheaf,
for which the result is proved at the end of the proof of [Sch17a, Lemma 14.4]. This means that
the left adjoint A 7→A■when evaluated on bZ[Y ] exists and is given by j♮bZ.
The formation of Y ′ →X from Y →X commutes with any quasi-pro-´etale base change of
strictly totally disconnected X′ →X.
This implies that A 7→A■commutes with such base
changes. By descent, this implies the existence of the left adjoint in general, and its commutation
with quasi-pro-´etale base change.
□
As usual, we also want to have a theory with coeﬃcients in a ring Λ. As before, we assume that
Λ is constant in the sense that it comes via pullback from the point. In our case, this means that

248
VII. D■(X)
it comes via pullback from the pro-´etale site of a point, i.e. is a condensed ring [CS], and we need
to assume that it is solid over bZ; in other words, we allow as coeﬃcients any solid bZ-algebra Λ.
Via pullback, this gives rise to a v-sheaf of bZ-algebras on any small v-stack X, and we can consider
D(Xv, Λ).
Example VII.1.16. We may consider Λ = Zℓas the solid condensed ring lim
−→L|Qℓﬁnite OL.
Definition VII.1.17. Let D■(X, Λ) ⊂D(Xv, Λ) be the full subcategory of all A ∈D(Xv, Λ)
such that the image of A in D(Xv, bZ) is solid.
On the level of ∞-categorical enrichments, we thus see that D■(X, Λ) is the category of Λ-
modules in D■(X, bZ). It is then formal that the inclusion D■(X, Λ) ⊂D(Xv, Λ) admits a symmetric
monoidal left adjoint A 7→A■, compatible with forgetting the Λ-structure.
Remark VII.1.18. Let us brieﬂy compare the present theory with the one developed in [CS].
Over a geometric point X = Spa C, D■(X, bZ) is the derived category of solid bZ-modules in the
sense of [CS].
For general Λ, we are now simply considering Λ-modules in D■(X, bZ).
This is
in general diﬀerent from the theory of Λ■-modules, which would ask for a stronger completeness
notion relative to Λ. Our present theory corresponds to the analytic ring structure on Λ induced
from bZ■.
One might wonder whether for any analytic ring A in the sense of [CS] one can deﬁne a category
D(X, A) of “A-complete” pro-´etale sheaves on any spatial diamond X. This does not seem to be
the case; it is certainly not formal.
In fact, already for A = Z■, problems occur and there is
certainly no abelian category; it is still possible to deﬁne a nice derived category, though. For
general A, deﬁning D(X, A) also seems to require extra data beyond the analytic ring structure on
A.
VII.2. Four functors
Now we discuss some functors on solid sheaves. For this, we assume from now on that we work
with coeﬃcients Λ given by a solid bZp-algebra (so we stay away from p-adic coeﬃcients). For any
map f : Y →X of small v-stacks, we have the pullback functor f∗: D■(X, Λ) ⊂D■(Y, Λ). This
admits a right adjoint Rf∗; in fact, one can simply import Rf∗from the full D(Y, Λ):
Proposition VII.2.1. Let f : Y →X be a map of small v-stacks and let A ∈D■(Y, Λ) ⊂
D(Y, Λ). Then Rfv∗A ∈D(Xv, Λ) lies in D■(X, Λ). In particular, Rfv∗: D(Yv, Λ) →D(Xv, Λ)
restricts to a functor Rf∗: D■(Y, Λ) →D■(X, Λ) that is right adjoint to f∗.
Proof. We can formally reduce to the case Λ = bZp. The formation of Rfv∗commutes with
any pullback (as everything is a slice in the v-site), so using Proposition VII.1.8 we can assume
that X is a spatial diamond. Moreover, taking a simplicial resolution of Y by disjoint unions of
spatial diamonds, and using that D■(X, bZp) ⊂D(Xv, bZp) is stable under all derived limits (as it is
stable under all products), we can also assume that Y is a spatial diamond.
We may assume A ∈D+
■(Y, bZp) by a Postnikov limit, then that A = F[0] is concentrated in
degree 0, then that F is ﬁnitely presented by writing it as a ﬁltered colimit, and ﬁnally that F is

VII.2. FOUR FUNCTORS
249
a constructible ´etale sheaf by writing it as a coﬁltered limit. Now the result follows from [Sch17a,
Proposition 17.6].
□
Proposition VII.2.2. For any small v-stack X, the inclusion
D■(X, Λ) ⊂D(Xv, Λ)
admits a left adjoint
A 7→A■: D(Xv, Λ) →D■(X, Λ).
The functor A 7→A■commutes with any base change.
The kernel of A 7→A■is a tensor ideal. In particular, there is a unique symmetric monoidal
structure −
■⊗L
Λ−on D■(X, Λ) making A 7→A■a symmetric monoidal functor. The functor −
■⊗L
Λ−
commutes with all colimits (in each variable) and with all pullbacks f : Y →X.
We note that in the case of overlap with previous deﬁnitions of A 7→A■and −
■⊗L
Λ−, the
deﬁnitions agree, by uniqueness of the previous deﬁnitions.
Proof. Again, one can formally reduce to the case Λ = bZp. By descent, we can reduce to
the case that X is strictly totally disconnected. (Note that Y 7→D■(Y, bZp) is a v-sheaf of ∞-
categories — this is clear for D(Yv, bZp), and follows for D■as being solid can be checked v-locally
by Proposition VII.1.8.) In this case, we already know existence of the left adjoint A 7→A■by
Proposition VII.1.15.
We check that the left adjoint A 7→A■commutes with any base change f : Y →X. We already
know that pullbacks of solid objects stay solid, so we have to see that if A ∈D(Xv, bZp) satisﬁes
A■= 0, then also (f∗
v A)■= 0. But this statement is adjoint to the statement that Rfv∗preserves
D■, i.e. Proposition VII.2.1.
We need to see that the class of all A ∈D(Xv, bZp) with A■= 0 is a ⊗-ideal. But we have seen
that for all f : Y →X, also f∗
v A lies in the corresponding class for Y , and then so does fv♮f∗
v A (as
pullback preserves D■), where we write fv♮for the left adjoint of f∗
v (which exists as it is a slice).
But fv♮f∗
v A = A ⊗L
bZp fv♮bZp by the projection formula for slices, so this gives the desired claim.
□
It turns out that for Λ = bZp, the functor −
■⊗L−is actually almost exact. If one would work
with Λ = Fℓ-coeﬃcients, it would even be exact.
Proposition VII.2.3. Let X be a small v-stack and A, B ∈D■(X, bZp) be concentrated in degree
0. Then A
■⊗LB sits in cohomological degrees −1 and 0.
If X is a spatial diamond and F = lim
←−i Fi and G = lim
←−j Gj are ﬁnitely presented solid bZp-
sheaves written as coﬁltered limits of constructible ´etale sheaves killed by some integer prime to p,
then the natural map
F
■⊗LG →R lim
←−
i,j
Fi ⊗L Gj
is an isomorphism.

250
VII. D■(X)
Proof. It suﬃces to prove the ﬁnal assertion, as the statement on A
■⊗LB can be checked
after pullback to spatial diamonds, and then A and B can be written as ﬁltered colimits of ﬁnitely
presented solid bZp-sheaves (and Fi ⊗L Gj sits in degrees −1 and 0 as bZp has global dimension 1).
Resolving F and G, we can reduce to the case F = j♮bZp, G = j′
♮bZp. But their solid tensor product
is indeed given by (j ×X j′)♮bZp.
□
At this point, we have deﬁned D■(X, Λ) ⊂D(Xv, Λ) for any small v-stack X, and this sub-
category is preserved by pullback and pushforward, and in particular this gives such functors for
D■(X, Λ). Moreover, D■(X, Λ) has a natural symmetric monoidal structure −
■⊗L
Λ−, commuting
with colimits in both variables, and with pullbacks. Moreover, we have a functor
RHomΛ(−, −) : D■(X, Λ)op × D■(X, Λ) →D■(X, Λ),
a partial right adjoint to −
■⊗L
Λ−as usual. Again, it can be obtained from the corresponding
functor on D(Xv, Λ) via restriction. In fact, for all A ∈D(Xv, Λ) and B ∈D■(X, Λ), one has
RHomΛ(A, B) ∈D■(X, Λ). This can be reduced to Λ = bZp and the case A = f♮bZp for some
f : Y →X, and then it amounts to Rfv∗f∗
v B ∈D■(X, bZp), which follows from Proposition VII.2.1.
There is the following general base change result. We stress the absence of any conditions.
Proposition VII.2.4. Let
Y ′
g′
/
f′

Y
f

X′
g
/ X
be a cartesian diagram of small v-stacks. For all A ∈D■(Y, Λ), the base change map
g∗Rf∗A →Rf′
∗g′∗A
in D■(X′, Λ) is an isomorphism.
Similarly, for any map f : Y →X of small v-stacks and all A, B ∈D■(X, Λ), the map
f∗RHom(A, B) →RHom(f∗A, f∗B)
in D■(Y, Λ) is an isomorphism.
Proof. The base change is a direct consequence of Proposition VII.2.1, noting that in the
v-site, everything is a slice (and hence satisﬁes base change). The statement about RHom follows
similarly from the compatibility with the RHom as formed on the v-site, as was noted above.
□
The projection formula, however, fails to hold.
Warning VII.2.5. If f : Y →X is a proper map of small v-stacks that is representable in
spatial diamonds with dim. trg f < ∞, the map
A
■⊗LRf∗B →Rf∗(f∗A
■⊗LB)
may fail to be an isomorphism for A ∈D■(X, bZp) and B ∈D■(Y, bZp). In fact, already if X = BC is
a perfectoid ball and f = j : Y = Spa C →X is the inclusion of a point (which is quasi-pro-´etale),

VII.2. FOUR FUNCTORS
251
then this fails for A = j♮bZp and B = bZp. In fact, the map becomes j♮bZp →Rj∗bZp, which is far
from an isomorphism: For example, on global sections the left-hand side becomes bZp[−2], while the
right-hand side becomes bZp.
There is the following result on change of algebraically closed base ﬁeld, an analogue of [Sch17a,
Theorem 19.5].
Proposition VII.2.6. Let X be a small v-stack.
(i) Assume that X lives over k, where k is a discrete algebraically closed ﬁeld of characteristic p,
and k′/k is an extension of discrete algebraically closed base ﬁelds, X′ = X ×k k′. Then the pullback
functor
D■(X, Λ) →D■(X′, Λ)
is fully faithful.
(ii) Assume that X lives over k, where k is a discrete algebraically closed ﬁeld of characteristic p.
Let C/k be an algebraically closed complete nonarchimedean ﬁeld, and X′ = X ×k Spa(C, C+) for
some open and bounded valuation subring C+ ⊂C containing k. Then the pullback functor
D■(X, Λ) →D■(X′, Λ)
is fully faithful.
(iii) Assume that X lives over Spa(C, C+), where C is an algebraically closed complete nonar-
chimedean ﬁeld with an open and bounded valuation subring C+ ⊂C, C′/C is an extension
of algebraically closed complete nonarchimedean ﬁelds, and C′+ ⊂C′ an open and bounded val-
uation subring containing C+, such that Spa(C′, C′+) →Spa(C, C+) is surjective.
Then for
X′ = X ×Spa(C,C+) Spa(C′, C′+), the pullback functor
D■(X, Λ) →D■(X′, Λ)
is fully faithful.
Proof. We can assume Λ = bZp. As in [Sch17a, Theorem 19.5], it suﬃces to prove (iii) and
the restricted case of (ii) where C is the completed algebraic closure of k((t)) (and hence C+ = OC).
Let f : X′ →X be the map. We have to see that for all A ∈D■(X, bZp), the map
A →Rf∗f∗A
is an equivalence. This can be checked locally in the v-topology, so we can assume that X =
Spa(R, R+) is an aﬃnoid perfectoid space. By Postnikov limits, we can also assume that A ∈
D+
■(X, bZp), and then that A is concentrated in degree 0. In case (iii), we can now conclude by
writing A as a ﬁltered colimit of ﬁnitely presented solid bZp-modules, and these as coﬁltered limits
of constructible ´etale sheaves, noting that both operations commute with Rf∗and f∗(as f is qcqs
in case (iii)), and hence reducing us to [Sch17a, Theorem 19.5].
It remains to handle case (ii) when C is the completed algebraic closure of k((t)). In that case X′
lives over a punctured open unit disc D∗
X over X, and ﬁxing a pseudouniformizer ϖ ∈R, this can be
written as the increasing union of quasicompact open subspaces X′
n = {|t|n ≤|ϖ| ≤|t|1/n} ⊂X′,
with maps fn : X′
n →X. It suﬃces to prove that for all n, the map
A →Rfn∗f∗
nA

252
VII. D■(X)
is an isomorphism. These functors commute again with ﬁltered colimits of sheaves, and hence the
previous reductions apply and reduce the assertion to the ´etale case, which was handled in the
proof of [Sch17a, Theorem 19.5].
□
As an application, let us record the following versions of Proposition IV.7.1 and Corollary IV.7.2,
where we ﬁx an algebraically closed ﬁeld k|Fq and work on Perfk.
Corollary VII.2.7. For any small v-stack X, the functor
ψ∗
X : D■(X × [∗/WE], Λ) →D■(X × Div1, Λ)
is fully faithful. If the natural pullback functor
D■(X, Λ) →D■(X × Spd bE, Λ)
is an equivalence, then ψ∗
X is also an equivalence.
Proof. By descent along X →X × [∗/WE] this reduces to Proposition VII.2.6.
□
Corollary VII.2.8. For any small v-stack X and ﬁnite set I, pullback along X × (Div1)I →
X × [∗/W I
E] induces a fully faithful functor
D■(X × [∗/W I
E], Λ) →D■(X × (Div1)I, Λ).
Proof. This follows inductively from Corollary VII.2.7.
□
We also need a solid analogue of Theorem IV.5.3; we only prove a restricted variant, however.
As there, work over Perfk, and let X be a spatial diamond such that X →∗is proper, of ﬁnite
dim. trg, and take any spatial diamond S. As before, one can introduce the doubly-indexed ind-
system {Ua,b}(a,b) ⊂X × S, well-deﬁned up to ind-isomorphism; and then Ua = S
b<∞Ua,b and
Ub = S
a>0 Ua,b.
Definition VII.2.9. The functors
Rβ!+, Rβ!−: D■(X × S, Λ) →D■(S, Λ)
are deﬁned by
Rβ!+C := lim
−→
a
Rβ∗(ja!C|Ua),
Rβ!−C := lim
−→
b
Rβ∗(jb!C|Ub)
for C ∈D■(X × S, Λ).
Here ja! and jb! denote the left adjoints to j∗
a and j∗
b . Let α : X × S →X be the projection.
Theorem VII.2.10. Assume that C = α∗A for A ∈D■(X, Λ), and assume that either A ∈
D+
■(X, Λ), or that X →∗is cohomologically smooth. Then
Rβ!+C = 0 = Rβ!−C.

VII.3. RELATIVE HOMOLOGY
253
Proof. We can assume Λ = bZp. All operations commute with any base change; we can thus
assume that S = Spa K where K is the complete algebraic closure of k((t)). We observe that if
X →∗is cohomologically smooth, then Rβ∗: D■(X × S, Λ) →D■(S, Λ) has ﬁnite cohomological
dimension; this is a statement about sheaves concentrated in degree 0. Any such B can be written
as the countable limit of Rja,b,∗j∗
a,bB for the open immersions ja,b : Ua,b ⊂X × S; it is thus enough
to show that pushforward along Ua,b →S has ﬁnite cohomological dimension on solid sheaves.
As Ua,b →S is qcqs, we can reduce to ﬁnitely presented sheaves; these are coﬁltered limits of
constructible sheaves.
For constructible sheaves, the cohomological dimension is bounded, and
each cohomology group (recall that S = Spa K is a geometric point) is ﬁnite by [Sch17a, Theorem
25.1]. Thus, the coﬁltered limit stays in the same range of degrees.
It follows that we can assume that A ∈D+
■(X, bZp). Arguing as in the proof of Theorem IV.5.3,
we can then reduce to the case that X = Spa(R, R+) is an aﬃnoid perfectoid space with no nonsplit
ﬁnite ´etale covers, and then to X = Spa K where K is still the completed algebraic closure of k((t)).
In that case, as in the proof of Theorem IV.5.3, one can make a more precise assertion on actual
annuli; this statement is compatible with passage to ﬁltered colimits, reducing us to the case that
A is a ﬁnitely presented solid sheaf. For A ∈D■(Spa K, bZp), this means that A is a coﬁltered limit
of ﬁnite abelian groups killed by integers prime to p. We can also pull this coﬁltered limit through,
reducing us to Theorem IV.5.3.
□
VII.3. Relative homology
A unique feature of the formalism of solid sheaves is the existence of a general left adjoint to
pullback, with excellent properties. We continue to work with coeﬃcients in a solid bZp-algebra Λ.
Proposition VII.3.1. Let f : Y →X be any map of small v-stacks.
(i) The functor f∗: D■(X, Λ) →D■(Y, Λ) admits a left adjoint
f♮: D■(Y, Λ) →D■(X, Λ).
The natural map
f♮(A
■⊗L
Λf∗B) →f♮A
■⊗L
ΛB
is an isomorphism for all A ∈D■(Y, Λ) and B ∈D■(X, Λ). Similarly, the map
RHom(f♮A, B) →Rf∗RHom(A, f∗B)
is an isomorphism.
(ii) The formation of f♮commutes with restriction of coeﬃcients along a map Λ′ →Λ.
(iii) For any cartesian diagram
Y ′
g′
/
f′

Y
f

X′
g
/ X
of small v-stacks, the natural map
f′
♮g′∗A →g∗f♮A
is an isomorphism for all A ∈D■(Y, Λ).

254
VII. D■(X)
Proof. As f is a slice in the v-site, it is tautological that f∗
v : D(Xv, Λ) →D(Yv, Λ) admits
a left adjoint fv♮: D(Yv, Λ) →D(Xv, Λ). One can then deﬁne f♮as the solidiﬁcation of fv♮. By
general properties of slices, the map
fv♮(A ⊗L
Λ f∗B) →fv♮A ⊗L
Λ B
is an isomorphism. Passing to solidiﬁcations, using that that this is symmetric monoidal, then gives
that
f♮(A
■⊗L
Λf∗B) →f♮A
■⊗L
ΛB
is an isomorphism. The isomorphism
RHom(f♮A, B) ∼= Rf∗RHom(A, f∗B)
then follows by adjointness.
For part (ii), we can assume Λ′ = bZp, and check on generators. These are given by j♮bZp ⊗L
bZp Λ
for j : Y ′ →Y . The claim then follows from the projection formula.
Part (iii) is obtained by passing to left adjoints in Proposition VII.2.4.
□
Now if f is “proper and smooth”, we want to relate the left adjoint f♮(“homology”) and the
right adjoint Rf∗(“cohomology”). Thus, assume that f : Y →X is a proper map of small v-stacks
that is representable in spatial diamonds with dim. trg f < ∞, and cohomologically smooth, i.e. ℓ-
cohomologically smooth for all ℓ̸= p (or just all ℓrelevant for Λ). In this case, we want to express
Rf∗in terms of f♮. As a ﬁrst step, we show that Rf∗has bounded cohomological dimension.
Proposition VII.3.2. Let f : Y →X be a proper map of small v-stacks that is representable
in spatial diamonds with dim. trg f < ∞, and cohomologically smooth. Then Rf∗: D■(Y, Λ) →
D■(X, Λ) has bounded cohomological dimension and commutes with arbitrary direct sums. If X is
a spatial diamond (thus Y is) and F is a ﬁnitely presented solid bZp-sheaf on Y , then Rf∗F is a
bounded complex all of whose cohomology sheaves are ﬁnitely presented solid bZp-sheaves on X.
Proof. We can assume Λ = bZp. The commutation with arbitrary direct sums follows from
bounded cohomological dimension, as one can then reduce to the case of complexes concentrated
in degree 0, where Rf∗commutes with all direct sums as f is qcqs. For the claim about bounded
cohomological dimension, we can argue v-locally, and hence assume that X is a spatial diamond.
It suﬃces to prove that for all solid bZp-sheaves F on Y , the complex Rf∗F is bounded; this
reduces to the case of ﬁnitely presented solid bZp-sheaves as Rf∗commutes with ﬁltered colimits of
sheaves. Now if F is ﬁnitely presented, it is a coﬁltered limit of constructible ´etale sheaves killed
by some integer prime to p. As Rf∗commutes with this limit, it is now enough to see that Rf∗
preserves constructible complexes and has bounded amplitude. But this follows from cohomological
smoothness, cf. [Sch17a, Proposition 23.12 (ii)].
□
Next, we prove a projection formula for Rf∗.
Proposition VII.3.3. Let f : Y →X be a proper map of small v-stacks that is representable
in spatial diamonds with dim. trg f < ∞, and cohomologically smooth. Then for all A ∈D■(Y, Λ)
and B ∈D■(X, Λ), the projection map
Rf∗A
■⊗LB →Rf∗(A
■⊗Lf∗B)

VII.3. RELATIVE HOMOLOGY
255
is an isomorphism.
Proof. We can assume Λ = bZp. We note that Rf∗and
■⊗L both have bounded cohomological
dimension, so one easily reduces to the case that A and B are concentrated in degree 0. We can
also assume that X is a spatial diamond (thus Y is, too). Then we can write A and B as ﬁltered
colimits of ﬁnitely presented solid bZp-sheaves, and reduce to the case that A and B are coﬁltered
limits of constructible ´etale sheaves killed by some integer prime to p. In that case, it follows
from Proposition VII.2.3 and Proposition VII.3.2 that all operations commute with these coﬁltered
limits, and one reduces to the case that A and B are constructible ´etale sheaves killed by some
integer prime to p. Now it follows from [Sch17a, Proposition 22.11].
□
Moreover, the functor Rf∗interacts well with g♮for maps g : X′ →X.
Proposition VII.3.4. Let
Y ′
g′
/
f′

Y
f

X′
g
/ X
be a cartesian diagram of small v-stacks, where f : Y →X is proper, representable in spatial
diamonds, with dim. trg f < ∞and cohomologically smooth. Then the natural transformation
g♮Rf′
∗A →Rf∗g′
♮A
is an isomorphism for all A ∈D■(Y ′, Λ).
Proof. We can assume Λ = bZp. By Proposition VII.3.2 both sides commute with Postnikov
limits, so we can assume A ∈D+, and then reduce to the case that A is concentrated in degree
0. We may assume that X is a spatial diamond, and one can also reduce to the case X′ is a
spatial diamond, by writing A as the geometric realization of h′
•♮h′∗
• A for some simplicial hyper-
cover h• : X′
• →X′ by disjoint unions of spatial diamonds, and its pullback h′
• : Y ′
• →Y ′ (and
using Proposition VII.3.2 to commute the geometric realization with pushforward). Under these
circumstances, one can write A as a ﬁltered colimit of ﬁnitely presented solid bZp-modules, and
hence reduce to the case that A is a coﬁltered limit of constructible ´etale sheaves killed by some
integer prime to p. By Proposition VII.3.2 the complex Rf′
∗A is then bounded with all cohomology
sheaves ﬁnitely presented solid bZp-modules. As g♮preserves pseudocoherent objects, it follows that
the map g♮Rf′
∗A →Rf∗g′
♮A is a map of bounded to the right complexes in D■(X, bZp) all of whose
cohomology sheaves are ﬁnitely presented solid bZp-modules. If the cone of this map is nonzero,
then by looking at its ﬁrst nonzero cohomology sheaf, we ﬁnd some nonzero map to a constructible
´etale sheaf B on X, killed by some integer prime to p. Note that, using the usual ´etale Rf! functor,
there is a natural adjunction
R Hom(Rf∗g′
♮A, B) ∼= R Hom(g′
♮A, Rf!B) :
Indeed, it suﬃces to check this when g′
♮A is replaced by a ﬁnitely presented solid bZp-module, by a
Postnikov tower (and as all cohomology sheaves of g′
♮A are of this form). Writing this as a coﬁltered

256
VII. D■(X)
limit of constructible ´etale sheaves killed by some integer prime to p, both sides turn this coﬁltered
limit into a ﬁltered colimit, so the claim reduces to the usual ´etale adjunction.
Applying R Hom(−, B) to the map g♮Rf′
∗A →Rf∗g′
♮A will thus produce R Hom(A, −) applied
to the base change map
Rf′!g∗B ←g′∗Rf!B,
which is an isomorphism by [Sch17a, Proposition 23.12 (iii)].
□
Now we can describe the functor Rf∗. Indeed, consider the diagram
Y
∆f / Y ×X Y
π2
/
π1

Y
f

Y
f
/ X.
Then, under our assumption that f : Y →X is a proper map of small v-stacks that is representable
in spatial diamonds with dim. trg f < ∞and cohomologically smooth, we have
Rf∗A ∼= Rf∗π2♮∆f♮A
∼= f♮Rπ1∗∆f♮A
∼= f♮Rπ1∗∆f♮∆∗
fπ∗
1A
∼= f♮Rπ1∗(∆f♮Λ
■⊗L
Λπ∗
1A)
∼= f♮(Rπ1∗∆f♮Λ
■⊗L
ΛA).
We combine this with the following observation.
Proposition VII.3.5. Let f : Y →X be a proper map of small v-stacks that is representable
in spatial diamonds with dim. trg f < ∞and cohomologically smooth. Then
Rπ1∗∆f♮Λ ∈D■(Y, Λ)
is invertible, and its inverse is canonically isomorphic to
Rf!Λ := lim
←−
n
Rf!Z/nZ ⊗L
bZp Λ.
Thus, there is a canonical isomorphism
f♮A ∼= Rf∗(A
■⊗L
ΛRf!Λ) : D■(Y, Λ) →D■(X, Λ).
Thus, we get a somewhat unusual formula for the dualizing complex. We remark that the ﬁbres
of Rπ1∗∆f♮bZp are given by the limit of RΓc(U, bZp) over all ´etale neighborhoods U of the given
geometric point.
Remark VII.3.6. We see here that an important instance of Rf! admits an alternative de-
scription in terms of g♮functors. We are a bit confused about exactly how expressive the present
5-functor formalism is. So far, we were always able to translate any argument in terms of a 6-
functor formalism into this 5-functor formalism, although it is often a nontrivial matter and there
seems to be no completely general recipe.

VII.4. RELATION TO D´et
257
Proof. We can assume Λ = bZp. By the isomorphism Rf∗∼= f♮(Rπ1∗∆f♮bZp
■⊗LA), it follows
that Rf∗: D■(Y, bZp) →D■(X, bZp) admits a right adjoint, given by
A 7→RHom(Rπ1∗∆f♮bZp, f∗A).
We claim that this right adjoint maps D´et(X, Z/nZ) into D´et(Y, Z/nZ) for any n prime to p, and
thus agrees with the right adjoint Rf! in that setting. This claim can be checked v-locally, so we
can assume that X is a spatial diamond. Then Rπ1∗∆f♮bZp ∈D■(Y, bZp) is a bounded complex
all of whose cohomology sheaves are ﬁnitely presented solid, by Proposition VII.3.2 and as ∆f
is quasi-pro-´etale (so ∆f♮bZp is ﬁnitely presented solid). This implies that RHom(Rπ1∗∆f♮bZp, −)
preserves D´et(Y, Z/nZ).
Thus, for any A ∈D´et(X, Z/nZ), there is a natural isomorphism
Rf!A ∼= RHom(Rπ1∗∆f♮bZp, f∗A).
Applied with A = Z/nZ, this gives isomorphisms
Rf!Z/nZ ∼= RHom(Rπ1∗∆f♮bZp, Z/nZ).
It remains to see that Rπ1∗∆f♮bZp is invertible; more precisely, we already get a natural map
Rπ1∗∆f♮bZp →(Rf!bZp)−1
that we want to prove is an isomorphism. This can again be checked v-locally, so we can assume
that X is a spatial diamond. Then Rπ1∗∆f♮bZp is a bounded complex all of whose cohomology
sheaves are ﬁnitely presented solid; so as in the proof of Proposition VII.3.4, it is enough to check
that one gets isomorphisms after applying RHom(−, B) for any B ∈D´et(Y, Z/nZ). But
RHom(Rπ1∗∆f♮bZp, B) ∼= Rπ1∗RHom(∆f♮bZp, Rπ!
1B)
∼= ∆∗
fRπ!
1B
∼= B ⊗L
Z/nZ Rf!Z/nZ,
giving the result.
The ﬁnal statement follows formally from the identiﬁcation of Rπ1∗∆f♮Λ and the discussion
leading up to the proposition.
□
VII.4. Relation to D´et
Assume now that Λ is discrete. In particular, also being a bZp-algebra, we have nΛ = 0 for
some n prime to p. We wish to understand the relation between D´et(X, Λ) and D■(X, Λ), and the
functors deﬁned on them.
VII.4.1. Naive embedding. For any small v-stack X, we have a fully faithful embedding
D´et(X, Λ) ,→D■(X, Λ)
as full subcategories of D(Xv, Λ). As usual, the adjoint functor theorem implies that this admits a
right adjoint RX´et : D■(X, Λ) →D´et(X, Λ). The full inclusion D´et(X, Λ) ⊂D■(X, Λ) is symmetric

258
VII. D■(X)
monoidal, and compatible with pullback. Moreover, by [Sch17a, Proposition 17.6], it also com-
mutes with Rf∗if f : Y →X is qcqs and one restricts to D+; or in general f is qcqs and of ﬁnite
cohomological dimension. Moreover, one always has
RX´etRf∗∼= Rf∗RY ´et.
Similarly, passing to right adjoints in the commutation with tensor products, we also have
RX´etRHomD■(X,Λ)(A, B) ∼= RHomD´et(X,Λ)(A, RX´etB)
if A ∈D´et(X, Λ) and B ∈D■(X, Λ). If A is perfect-constructible, then for all B ∈D´et(X, Λ), one
actually has
RHomD´et(X,Λ)(A, B) ∼= RHomD■(X,Λ)(A, B) :
by descent, it suﬃces to check this when X is spatial diamond, and then one reduces to A = j!Λ for
some quasicompact separated ´etale map j : U →X. In that case, it follows from Rj∗commuting
with the embedding D´et(X, Λ) →D■(X, Λ), as it is qcqs and has cohomological dimension 0.
VII.4.2. Dual embedding. For a small v-stack X, let D†
´et(X, Λ) ⊂D´et(X, Λ) be the full
subcategory of overconvergent objects.
Recall that A ∈D´et(X, Λ) is overconvergent if for any
strictly local Spa(C, C+) →X, the map
RΓ(Spa(C, C+), A) →RΓ(Spa(C, OC), A)
is an isomorphism.
Proposition VII.4.1. Assume that Λ = Z/nZ with n prime to p. For any overconvergent
A ∈D†
´et(X, Λ), let
A∨= RHomD■(X,Λ)(A, Λ) ∈D■(X, Λ).
Then the functor
D†
´et(X, Λ)op →D■(X, Λ) : A 7→A∨
is fully faithful, t-exact (for the standard t-structure), compatible with pullback, and the map
A →RHomD■(X,Λ)(A∨, Λ)
is an isomorphism.
Proof. As the formation of RHom in the solid context commutes with any base change, all
assertions can be proved by v-descent, so we can assume that X is strictly totally disconnected.
Then D†
´et(X, Λ) ∼= D(π0X, Λ). The heart of the standard t-structure is then an abelian category
with compact projective generators i∗Λ for open and closed subsets i : S ⊂π0X, and the whole
category is the Ind-category of the constructible complexes of Λ-modules on π0X (which are locally
constant with ﬁnite ﬁbres).
Passage to the naive dual is an autoequivalence on constructible
complexes (as Λ is selﬁnjective), and thus embeds the whole Ind-category fully faithfully into the
Pro-category of constructible complexes of Λ-modules on π0X, which sits fully faithfully inside the
category of ﬁnitely presented solid sheaves on X. This already establishes that the functor is fully
faithful and t-exact, and we already observed at the beginning that it commutes with any pullback.
It remains to prove that
A →RHomD■(X,Λ)(A∨, Λ)

VII.4. RELATION TO D´et
259
is an isomorphism. Again, we can assume Λ = Fℓso that all operations are t-exact. Again, the
statement is clear if A is constructible, and in general it follows from Breen’s resolution that the
Pro-structure on A∨dualizes to a ﬁltered colimit on applying RHomD■(X,Λ)(−, B).
□
The functor A 7→A∨is also close to being symmetric monoidal. Note that it is lax-symmetric
monoidal, i.e. there is a natural functorial map
A∨
■⊗L
ΛB∨→(A ⊗L
Λ B)∨.
Proposition VII.4.2. Assume that A ∈D†
´et(X, Λ) has ﬁnite Tor-amplitude over Λ = Z/nZ,
i.e. for all quotients Λ →Fℓ, the complex A ⊗L
Λ Fℓ∈D†
´et(X, Fℓ) is bounded. Then for all B ∈
D†
´et(X, Λ), the maps
A∨
■⊗L
ΛB∨→(A ⊗L
Λ B)∨, A ⊗L
Λ B →RHomD■(X,Λ)(A∨, B)
are isomorphisms.
Proof. The second follows from the ﬁrst: Using Proposition VII.4.1,
RHomD■(X,Λ)(A∨, B) ∼= RHomD■(X,Λ)(A∨, RHomD■(X,Λ)(B∨, Λ)) ∼= RHomD■(X,Λ)(A∨
■⊗L
ΛB∨, Λ),
which one can further rewrite to A ⊗L
Λ B assuming the ﬁrst isomorphism.
We can assume Λ = Fℓ, and that A is concentrated in degree 0. Now as functors of B, all
operations are t-exact, so we can reduce to the case that also B is concentrated in degree 0. We
can assume that X is strictly totally disconnected, and then D†
´et(X, Fℓ) ∼= D(π0X, Fℓ). Then A
and B are ﬁltered colimits of constructible sheaves on π0X, and RHom(−, Fℓ) is a contravariant
autoequivalence on constructible Fℓ-sheaves on π0X. Then the result follows by observing that
A 7→A∨simply exchanges the Ind-category of constructible Fℓ-sheaves on π0X with its Pro-
category.
□
As noted above, the functor A 7→A∨is compatible with pullback. Regarding pushforward, we
have the following result.
Proposition VII.4.3. Let f : Y →X be a proper map of small v-stacks that is representable
in spatial diamonds with dim. trg f < ∞. Let A ∈D†
´et(Y, Λ) with dual A∨∈D■(Y, Λ). Then there
is a natural isomorphism
(Rf∗A)∨∼= f♮A∨.
Note that Rf∗A is again overconvergent, by proper base change.
Proof. One has
RHomD■(X,Λ)(f♮A∨, Λ) ∼= Rf∗RHomD■(Y,Λ)(A∨, Λ) ∼= Rf∗A,
so by biduality one gets a natural map
f♮A∨→(Rf∗A)∨;
we claim that this is an isomorphism. This can be checked v-locally on X, so we can assume that
X is w-contractible. One can assume A is bounded above (i.e. A ∈D−) as both functors take

260
VII. D■(X)
very coconnective objects to very connective objects; by shifting, we can assume A ∈D≤0. Now
using a Postnikov limit and the assumption dim. trg f < ∞, we can also assume that A ∈D+, and
hence reduce to A sitting in degree 0. Now we can choose a hypercover of Y by perfectoid spaces
Yi that are the canonical compactiﬁcations (relative to X) of w-contractible spaces. One can then
replace Y by one of the Yi, so assume that Y is the canonical compactiﬁcation of a w-contractible
space.
In particular, D†
´et(Y, Λ) ∼= D(π0Y, Λ), and all operations can be computed on the level
of π0f : π0Y →π0X instead. Here, the result amounts again to the duality between Ind- and
Pro-objects in the category of constructible sheaves on proﬁnite sets.
□
VII.5. Dualizability
It turns out that most of the results above on Poincar´e duality hold verbatim if the assumption
that f is cohomologically smooth is relaxed to the assumption that Fℓis f-universally locally acyclic
for all ℓ̸= p. In fact, even more generally, one can obtain certain results comparing twisted forms
of f♮and Rf∗for any f-universally locally acyclic complex A.
Assume that Λ is a quotient of bZp of the form lim
←−n Z/nZ where n now runs only over some
integers prime to p. If f : X →S is a compactiﬁable map of small v-stacks that is representable
in locally spatial diamonds with locally dim. trg f < ∞, we deﬁne the category DULA(X/S, Λ) of
f-universally locally acyclic complexes with coeﬃcients Λ as the limit of the full subcategories
DULA(X/S, Z/nZ) ⊂D´et(X, Z/nZ)
of f-universally locally acyclic objects in D´et(X, Z/nZ), for n running over the same set of integers
prime to p.
Equivalently, DULA(X/S, Λ) is the category of all A ∈D■(X, Λ) such that An =
A ⊗L
Λ Z/nZ lies in D´et(X, Z/nZ) for all such n, is f-universally locally acyclic, and A is the derived
limit of the An.
Given such an A, in particular all An are overconvergent, and the functor
A 7→A∨= RHomD■(X,Λ)(A, Λ) = R lim
←−
n
A∨
n ∈D■(X, Λ)
deﬁnes another fully faithful (contravariant) embedding
DULA(X/S, Λ)op ,→D■(X, Λ)
of f-universally locally acyclic complexes into D■(X, Λ). We can also precompose with Verdier
duality DX/S to obtain a covariant fully faithful embedding
DULA(X/S, Λ) ,→D■(X, Λ) : A 7→DX/S(A)∨.
Example VII.5.1. Assume that S = Spa C is a geometric point, and X is the analytiﬁcation
of an algebraic variety Xalg/ Spec C. Then any constructible complex on Xalg is universally locally
acyclic over S, yielding a fully faithful embedding
Db
c(Xalg, Zℓ) ,→DULA(X/S, Zℓ) ,→D■(X, Zℓ),
embedding the usual bounded derived category of constructible Zℓ-sheaves on Xalg into D■(X, Zℓ).
The image lands in bounded complexes with ﬁnitely presented solid cohomology sheaves; in fact,
in compact objects. Thus, this fully faithful embedding extends to a fully faithful embedding
Ind Db
c(Xalg, Zℓ) ,→D■(X, Zℓ).

VII.5. DUALIZABILITY
261
The category on the left is the one customarily associated to Xalg. This functor takes the sheaf
i∗Zℓ, for a point i : Spec C →Xalg, to the solid sheaf i♮Zℓ.
In many papers in geometric Langlands and related ﬁelds, one often ﬁnds the following con-
struction. If Y is a stack on the category of schemes over Spec C, let
D(Y, Zℓ) :=
lim
←−
Xalg→Y
Ind Db
c(Xalg, Zℓ)
where Xalg runs over schemes of ﬁnite type over Spec C, and the transition functors are given by
Rf!. This, in fact, embeds naturally into D■(Y ♦, Zℓ) via the previous embedding, noting that it
intertwines Rf! with the usual pullback f∗on solid sheaves. In fact,
DX′/S(Rf!A)∨∼= (f∗DX/S(A))∨∼= f∗DX/S(A)∨
for a map f : X′alg →Xalg of algebraic varieties over Spec C.
Now for A ∈DULA(X/S, Λ), we analyze the functor
f♮(DX/S(A)∨
■⊗L
Λ−) : D■(X, Λ) →D■(S, Λ).
We note that from the deﬁnition one sees that this functor commutes with all colimits, the formation
of this functor commutes with any base change, and it satisﬁes the projection formula. In fact, this
functor extends the functor Rf!(A ⊗L
Λ −).
Proposition VII.5.2. Assume that A ∈DULA(X/S, Λ) has bounded Tor-amplitude. Let Z/nZ
be a discrete quotient of Λ. For B ∈D´et(X, Z/nZ), there is a natural equivalence
f♮(DX/S(A)∨
■⊗L
ΛB) ∼= Rf!(An ⊗L
Z/nZ B) ∈D´et(S, Z/nZ).
Proof. We can assume Λ = Z/nZ. Note that for any C ∈D´et(S, Λ), one has
R HomΛ(f♮(DX/S(A)∨
■⊗L
ΛB), C) ∼= R HomΛ(DX/S(A)∨
■⊗L
ΛB, f∗C)
∼= R HomΛ(B, RHomD■(X,Λ)(DX/S(A)∨, f∗C))
∼= R HomΛ(B, DX/S(A) ⊗L
Λ f∗C)
∼= R HomΛ(B, RHomD´et(X,Λ)(A, Rf!C))
∼= R HomΛ(A ⊗L
Λ B, Rf!C)
∼= R HomΛ(Rf!(A ⊗L
Λ B), C).
Here, we use Proposition VII.4.1 and Proposition IV.2.19. In particular, there is a natural map
f♮(DX/S(A)∨
■⊗L
ΛB) →Rf!(A ⊗L
Λ B).
We claim that this is an isomorphism. This can be checked v-locally, so we can assume that S is
strictly totally disconnected. We can assume that X is a spatial diamond by localization. As the
functor commutes with all colimits in B, we can also assume that B = j!Λ for some quasicompact
separated ´etale j : V →X. Replacing X by V , we can then even assume B = Λ.
Now DX/S(A) lies in D+ and then again DX/S(A)∨in D−.
It follows that DX/S(A)∨is a
complex that is bounded above, and ﬁnitely presented solid in each degree. Thus f♮DX/S(A)∨is

262
VII. D■(X)
of the same form, and so is the cone Q of f♮DX/S(A)∨→Rf!A. If Q is nonzero, we can look at
the largest i such that Hi(Q) is nonzero. This is ﬁnitely presented solid, so a coﬁltered limit of
constructible ´etale sheaves. But R Hom(Q, C) = 0 for all C ∈D´et(S, Λ), so it follows that indeed
Q = 0.
□
If f is moreover proper, one can also prove the following version of A-twisted Poincar´e duality.
Proposition VII.5.3. Assume that f : X →S is a proper map of small v-stacks that is
representable in spatial diamonds with dim. trg f < ∞.
Let A ∈DULA(X/S, Λ) with bounded
Tor-amplitude. Then there is a natural equivalence
f♮(DX/S(A)∨
■⊗L
Λ−) ∼= Rf∗RHomD■(X,Λ)(A∨, −)
of functors D■(X, Λ) →D■(S, Λ).
Proof. First, we construct the natural transformation. Let π1, π2 : X ×S X →X be the two
projections. Giving a map
f♮(DX/S(A)∨
■⊗L
ΛB) →Rf∗RHomD■(X,Λ)(A∨, B)
is equivalent to giving a map
f∗f♮(DX/S(A)∨
■⊗L
ΛB)
■⊗L
ΛA∨→B.
But
f∗f♮(DX/S(A)∨
■⊗L
ΛB)
■⊗L
ΛA∨∼= π1♮π∗
2(DX/S(A)∨
■⊗L
ΛB)
■⊗L
ΛA∨
∼= π1♮(π∗
2DX/S(A)∨
■⊗L
Λπ∗
2B
■⊗L
Λπ∗
1A∨).
Thus, it suﬃces to construct a functorial map
π∗
2DX/S(A)∨
■⊗L
Λπ∗
1A∨
■⊗L
Λπ∗
2B →π∗
1B.
For this in turn it suﬃces to construct a natural map
π∗
2DX/S(A)∨
■⊗L
Λπ∗
1A∨→∆♮Λ
where ∆: X ,→X ×S X is the diagonal.
Here ∆♮Λ ∼= (∆∗Λ)∨by Proposition VII.4.3 and
π∗
2DX/S(A)∨
■⊗L
Λπ∗
1A∨∼= (π∗
2DX/S(A) ⊗L
Λ π∗
1A)∨by Proposition VII.4.2. Thus, we have to ﬁnd a
map
∆∗Λ →π∗
2DX/S(A) ⊗L
Λ π∗
1A
or equivalently a section of R∆!(π∗
2DX/S(A)⊗L
Λπ∗
1A). But π∗
2DX/S(A)⊗L
Λπ∗
1A ∼= RHom(π∗
2A, Rπ!
1A)
as A is f-universally locally acyclic, and then
R∆!(π∗
2DX/S(A) ⊗L
Λ π∗
1A) ∼= R∆!RHom(π∗
2A, Rπ!
1A) ∼= RHom(A, A),
where we ﬁnd the identity section.
To show that the map is an isomorphism, we can now localize on S, and in particular assume
that S is strictly totally disconnected. By the bounded assumption on A and ﬁnite cohomological
dimension of f, the functor Rf∗RHomΛ(A∨, −) commutes with all direct sums, and hence we
can assume that B is ﬁnitely presented solid (concentrated in degree 0). Then we can write B

VII.5. DUALIZABILITY
263
as a coﬁltered limit of constructible ´etale sheaves, and the left-hand side commutes with such
limits; so we can reduce to B being a constructible ´etale sheaf, where the result follows from
Proposition VII.5.2 and Proposition VII.4.1.
□
From the perspective of using sheaves as kernels of induced functors, we have the following
picture. We can introduce a variant of the category CS introduced above. Namely, for any small
v-stack S, let us consider the 2-category CS,■whose objects are relatively 0-truncated small v-stacks
X over S, and whose categories of morphisms
FunCS,■(X, Y ) = D■(X ×S Y, Λ)
are given by solid complexes. Again, to any X ∈CS,■, we can associate the triangulated category
D■(X, Λ) and to any A ∈D■(X ×S Y, Λ) the functor
p2♮(A
■⊗L
Λp∗
1) : D■(X, Λ) →D■(Y, Λ)
with kernel A. The composition in CS,■is deﬁned by the convolution
D■(X ×S Y, Λ) × D■(Y ×S Z, Λ) →D■(X ×S Z, Λ) : (A, B) 7→A ⋆B = p13♮(p∗
12A
■⊗L
Λp∗
23B).
We wish to compare CS and CS,■. Note that the naive embedding D´et(X ×S Y, Λ) ,→D■(X ×S
Y, Λ) is not compatible with the convolution (as one employs Rπ13! while the other employs π13♮).
On the other hand, we can restrict to the sub-2-category C†
S ⊂CS whose objects are only the proper
X/S representable in spatial diamonds of ﬁnite dim. trg, and with
FunC†
S(X, Y ) = D†
´et,ftor(X ×S Y, Λ),
where the subscript ftor stands for ﬁnite Tor-dimension over Λ.
Then there is a fully faithful
embedding C†
S ,→Cco
S,■where the superscript co means that we change the direction of the arrows
within each FunCS,■(X, Y ). Indeed, for any X, Y ∈C†
S, the functor A 7→A∨deﬁnes a fully faithful
embedding
FunC†
S(X, Y ) = D†
´et,ftor(X ×S Y, Λ) ,→D■(X ×S Y, Λ)op = FunCco
S,■(X, Y ).
This is compatible with composition by Proposition VII.4.2 and Proposition VII.4.3. This discus-
sion leads to another proof of Proposition VII.5.3:
Corollary VII.5.4. Let f : X →S be a proper map of small v-stacks that is representable in
spatial diamonds with dim. trg f < ∞. Let A ∈D´et(X, Λ) be f-universally locally acyclic and of
ﬁnite Tor-dimension over Λ. Then A∨∈D■(X, Λ) = FunCS,■(X, S) is right adjoint to
DX/S(A)∨∈D■(X, Λ) = FunCS,■(S, X).
In particular, the functor
f♮(A∨
■⊗L
Λ−) : D■(X, Λ) →D■(S, Λ)
is right adjoint to the functor
DX/S(A)∨
■⊗L
Λf∗−: D■(S, Λ) →D■(X, Λ),
so
f♮(A∨
■⊗L
Λ−) ∼= Rf∗RHomΛ(DX/S(A)∨, −) : D■(X, Λ) →D■(S, Λ).

264
VII. D■(X)
Moreover, when applied to the Satake category, we get a fully faithful embedding
(SatI
G)op ,→D■(HckI
G, bZp) : A 7→A∨
compatible with the monoidal structure (and functorially in I), where the right-hand side is given
by
FunCS,■([(Div1)I
X/L+
(Div1
X)IG], [(Div1)I
X/L+
(Div1
X)IG])
for S = [(Div1
X)I/L(Div1
X)IG]. Precomposing with Verdier duality, we get a covariant fully faithful
embedding
SatI
G ,→D■(HckI
G, bZp) : A 7→DX/S(A)∨.
By Proposition VII.5.2, when one uses objects in the Satake category as kernels to deﬁne Hecke
operators, this fully faithful embedding makes it possible to extend Hecke operators from D´et to
D■.
VII.6. Lisse sheaves
The category D■(X, Λ) is huge: Already if X is a point and Λ = Fℓ, it is the derived category
of solid Fℓ-vector spaces, which is much larger than the category of usual discrete Fℓ-vector spaces.
When applied to BunG, we would however really like to study smooth representations on discrete
Λ-modules.
As coeﬃcients, we will from now on choose a discrete Zℓ-algebra Λ for some ℓ̸= p, or rather
the corresponding condensed ring Λ := Zℓ⊗Zℓ,disc Λdisc. (For a technical reason, we have to restrict
attention to a particular prime ℓ.)
It turns out that when X is an Artin v-stack, one can deﬁne a full subcategory Dlis(X, Λ) ⊂
D■(X, Λ) that when specialized to X = BunG has the desired properties. Here the subscript “lis”
is an abbreviation of “lisse” (french smooth), and is not meant to evoke lisse sheaves in the sense
of locally constant sheaves, but lisse-´etale sheaves in the sense of Artin stacks [LMB00].
Definition VII.6.1. Let X be an Artin v-stack. The full subcategory Dlis(X, Λ) ⊂D■(X, Λ)
is the smallest triangulated subcategory stable under all direct sums that contains f♮Λ for all maps
f : Y →X that are separated, representable in locally spatial diamonds, and ℓ-cohomologically
smooth.
In principle, one could give this deﬁnition even when X is any small v-stack, but in that case
there might be very few objects.
Proposition VII.6.2. Let X be an Artin v-stack. The full subcategory Dlis(X, Λ) ⊂D■(X, Λ)
is stable under −
■⊗L
Λ−.
Moreover, if f : Y →X is a map of Artin v-stacks, then f∗maps
Dlis(X, Λ) ⊂D■(X, Λ) into Dlis(Y, Λ) ⊂D■(Y, Λ).
Proof. As tensor products and pullbacks commute with all direct sums, it suﬃces to check
the claim on the generators g♮Λ for maps g : Z →X that are separated, representable in locally
spatial diamonds, and ℓ-cohomologically smooth. Now the result follows as pullbacks and products
of such maps are of the same form.
□

VII.6. LISSE SHEAVES
265
Proposition VII.6.3. Let X be an Artin v-stack. The inclusion Dlis(X, Λ) ⊂D■(X, Λ) admits
a right adjoint
A 7→Alis : D■(X, Λ) →Dlis(X, Λ).
The kernel of A 7→Alis is the class of all A ∈D■(X, Λ) such that A(Y ) = 0 for all f : Y →X that
are separated, representable in locally spatial diamonds, and ℓ-cohomologically smooth.
Proof. The existence of the right adjoint is formal. We note that the ∞-category D■(X, Λ) is
not itself presentable, but rather is the large ﬁltered colimit of presentable ∞-categories D■(Xκ, Λ)
for uncountable strong limit cardinals κ (restricting the v-site to κ-small perfectoid spaces). Also
note that Dlis(X, Λ) is contained in D■(Xκ, Λ) for some κ: This can be checked when X is a spatial
diamond and for the generators f♮Λ ∼= f♮Zℓ⊗L
ZℓΛ when f : Y →X is in addition quasicompact,
in which case f♮Zℓis the limit of f♮Z/ℓmZ all of which lie in D´et(X, Z/ℓmZ), so we conclude by
[Sch17a, Remark 17.4]. It follows that the right adjoints to Dlis(X, Λ) →D■(Xκ, Λ) for all large
enough κ glue to the desired right adjoint.
The description of the kernel is formal.
□
Using Proposition VII.6.3, we can then also deﬁne RHomlis(A, B) ∈Dlis(X, Λ) for A, B ∈
Dlis(X, Λ) and Rflis∗: Dlis(Y, Λ) →Dlis(X, Λ) for a map f : Y →X of Artin v-stacks, satisfying
the usual adjunction to the tensor product and pullback.
The goal of passing to Dlis is to make sheaves “discrete” again. Recall the following result.
Proposition VII.6.4. For any condensed ring A with underlying ring A(∗), the functor M 7→
M ⊗A(∗) A induces a fully faithful functor
D(A(∗)) ,→D(A)
from the derived category of usual A(∗)-modules to the derived category of condensed modules over
the condensed ring A.
Proof. We need to see that for any M, N ∈D(A(∗)), the map
R HomA(∗)(M, N) →R HomA(M ⊗A(∗) A, N ⊗A(∗) A)
is an isomorphism. The class of all M for which this happens is triangulated and stable under all
direct sums, so it suﬃces to consider M = A(∗). Then it amounts to
N(∗) →(N ⊗A(∗) A)(∗)
being an isomorphism, which follows from evaluation at ∗being symmetric monoidal.
□
In particular, we have the following result for a geometric point.
Proposition VII.6.5. Let X = Spa C for some complete algebraically closed nonarchimedean
ﬁeld C. Then Dlis(X, Λ) ∼= D(Λ), the derived category of (relatively) discrete Λ-modules.
Proof. We need to see that for all separated ℓ-cohomologically smooth maps f : Y →X of
spatial diamonds, one has f♮Λ ∈D(Λ). This reduces to Λ = Zℓ. In that case, f♮Zℓ= lim
←−m f♮Z/ℓmZ,
where by Proposition VII.5.2 each
f♮Z/ℓmZ ∼= Rf!Rf!Z/ℓmZ,

266
VII. D■(X)
which is a perfect complex of Z/ℓmZ-modules, in particular discrete. Taking the limit over m, we
get a perfect complex of Zℓ-modules, which is in particular (relatively) discrete over Zℓ.
□
When working with torsion coeﬃcients, one recovers D´et.
Proposition VII.6.6. Let X be an Artin v-stack, and assume that Λ is killed by a power of
ℓ. Then Dlis(X, Λ) ⊂D■(X, Λ) is contained in the image of the naive embedding D´et(X, Λ) ,→
D■(X, Λ). If there is a separated ℓ-cohomologically smooth surjection U →X from a locally spatial
diamond U, such that U´et has a basis with bounded ℓ-cohomological dimension, then it induces an
equivalence Dlis(X, Λ) ∼= D´et(X, Λ).
Proof. If f : Y →X is separated, representable in locally spatial diamonds, and ℓ-cohomologically
smooth, then f♮Λ = Rf!Rf!Λ lies in D´et(X, Λ), hence Dlis(X, Λ) ⊂D´et(X, Λ). To check equality,
we can work on an atlas, so by the assumption we can reduce to the case that X is a locally
spatial diamond for which X´et has a basis with bounded ℓ-cohomological dimension. In that case
D´et(X, Λ) ∼= D(X´et, Λ) by [Sch17a, Proposition 20.17] (the proof only needs a basis with bounded
cohomological dimension), which is generated by j!Λ for j : U →X quasicompact separated ´etale,
which is thus also contained in Dlis(X, Λ).
□
The most severe problem with the general formalism of solid sheaves is that stratiﬁcations
of a space do not lead to corresponding decompositions of sheaves into pieces on the individual
strata. This problem is somewhat salvaged by Dlis(X, Λ): We expect that it holds true if X and its
stratiﬁcation are suﬃciently nice. Here is a simple instance that will be suﬃcient for our purposes.
Proposition VII.6.7. Let X be a locally spatial diamond with a closed point x ∈X, giving a
corresponding closed subdiamond i : Z ⊂X with complement j : U ⊂X. Assume that Z = Spa C
is representable, with C an algebraically closed nonarchimedean ﬁeld. Moreover, assume that Z
can be written as a coﬁltered intersection of quasicompact open neighborhoods V ⊂X such that
RΓ(V, Fℓ) ∼= Fℓ.
Then one has a semi-orthogonal decomposition of Dlis(X, Λ) into Dlis(U, Λ) and Dlis(Z, Λ) ∼=
D(Λ).
Proof. We may assume that X is spatial. We analyze the quotient of Dlis(X, Λ) by j!Dlis(U, Λ).
This is equivalently the subcategory of all A ∈Dlis(X, Λ) with j∗A = 0.
It is generated by
the images of f♮Λ for f : Y →X cohomologically smooth separated map of spatial diamonds;
under the embedding of the quotient category back into Dlis(X, Λ), this corresponds to the cone
of j!j∗f♮Λ →f♮Λ. Let M = i∗f♮Λ ∈Dlis(Z, Λ) ∼= D(Λ), which in fact is a perfect complex of
Λ-modules (by the proof of Proposition VII.6.5). Then we claim that there is an isomorphism
cone(j!j∗f♮Λ →f♮Λ) ∼= cone(j!M →M).
To see this, it suﬃces to prove that there is some open neighborhood V of Z such that f♮Λ|V ∼= M,
the constant sheaf associated with M. We can reduce to Λ = Zℓ. As f♮Fℓis constructible, we can
ﬁnd some such V for which f♮Fℓ|V ∼= M/ℓ. Picking such an isomorphism reducing to the identity
at x, and choosing V with the property RΓ(V, Fℓ) ∼= Fℓ, we see that in fact the isomorphism lifts
uniquely to Z/ℓmZ for each m, and thus by taking the limit over m to the desired isomorphism
f♮Λ|V ∼= M.

VII.7. Dlis(BunG)
267
Thus, the quotient of Dlis(X, Λ) by j!Dlis(U, Λ) is generated by the constant sheaf Λ. Moreover,
the endomorphisms of Λ in the quotient category are given by the cone of
RΓ(X, j!Λ) →RΓ(X, Λ).
This is equivalently the ﬁltered colimit of RΓ(V, Λ) over all open neighborhoods V of Z; we can
restrict to those for which RΓ(V, Fℓ) ∼= Fℓ. This implies formally that RΓ(V, Zℓ) ∼= Zℓby passing
to limits and then RΓ(V, Λ) ∼= Λ by passing to ﬁltered colimits. Thus, we get the desired semi-
orthogonal decomposition.
□
VII.7. Dlis(BunG)
Our goal now is to extend the results of Chapter V to the case of Dlis(BunG, Λ). This will
notably include the case Λ = Qℓ.
Thus, let again be E any nonarchimedean local ﬁeld with residue ﬁeld Fq and G a reduc-
tive group over E. We work with Perfk where k = Fq, and ﬁx a complete algebraically closed
nonarchimedean ﬁeld C/k.
Proposition VII.7.1. Let b ∈B(G). The pullback functors
Dlis(Bunb
G, Λ) →Dlis([∗/Gb(E)], Λ) →Dlis([Spa C/Gb(E)], Λ),
Dlis(Bunb
G, Λ) →Dlis(Bunb
G × Spa C, Λ) →Dlis([Spa C/Gb(E)], Λ)
are equivalences, and all categories are naturally equivalent (as symmetric monoidal categories) to
the derived category D(Gb(E), Λ) of smooth representations of Gb(E) on discrete Λ-modules.
Proof. Recall that the map s : [∗/Gb(E)] →Bunb
G is cohomologically smooth and surjective; in
fact, its ﬁbres are successive extensions of positive Banach–Colmez spaces. This implies that s♮Λ ∼=
Λ. This, in turn, implies by the projection formula for s♮that s♮s∗A ∼= A for all A ∈D■(Bunb
G, Λ),
thus giving fully faithfulness.
The same applies after base change to Spa C.
Moreover, using
pullback under the projection Bunb
G →[∗/Gb(E)], we see that s∗is also necessarily essentially
surjective.
It remains to show that the pullback Dlis([∗/Gb(E)], Λ) →Dlis([Spa C/Gb(E)], Λ) is an equiv-
alence, and identify this symmetric monoidal category with D(Gb(E), Λ). By Proposition VII.2.6,
the functor Dlis([∗/Gb(E)], Λ) →Dlis([Spa C/Gb(E)], Λ) is fully faithful. One can easily build a
functor D(Gb(E), Λ) →Dlis([∗/Gb(E)], Λ), and it is enough to see that the composite functor
D(Gb(E), Λ) →Dlis([∗/Gb(E)], Λ) →Dlis([Spa C/Gb(E)], Λ)
is an equivalence. Using that D(Gb(E), Λ) is generated by c-IndGb(E)
K
Λ for K ⊂Gb(E) open pro-p,
one easily sees that the functor is fully faithful, so it remains to prove essential surjectivity. Using
descent along Spa C →[Spa C/Gb(E)] and the equivalence Dlis(Spa C, Λ) ∼= D(Λ), the target maps
fully faithfully into the derived category of representations of the condensed group Gb(E) on the
full subcategory of condensed Λ-modules of the form M ⊗Zℓ,disc Zℓfor Λ-modules M. As Gb(E)
is locally pro-p, any such action in fact comes from a smooth action on M: For K ⊂Gb(E) pro-
p, the K-orbit of any m ∈M lies in some compact submodule, thus in M ⊗Zℓ,disc Zℓfor some
ﬁnitely generated Zℓ-submodule M′ ⊂M. The action of K on m then gives a continuous map

268
VII. D■(X)
K →GL(M′). As the target is locally pro-ℓ, this map has ﬁnite image, so that the action of K on
m is locally constant.
□
Recall that for any b ∈B(G), we have the cohomologically smooth chart πb : Mb →BunG near
Bunb
G. This comes with a projection qb : Mb →[∗/Gb(E)] which has a natural section, given by
the preimage of Bunb
G ⊂BunG in Mb. Over Mb, we have the Gb(E)-torsor f
Mb →Mb, and for
any complete algebraically closed ﬁeld C over k = Fq, the base change
f
Mb,C = f
Mb ×Spd k Spa C
is representable by a locally spatial diamond, endowed with a distinguished point i : Spa C ,→f
Mb,C.
Recall that f
Mb,C is a successive extension of negative Banach–Colmez spaces. Iteratively restricting
to small quasicompact balls inside these negative Banach–Colmez spaces, we see that the closed
subset i : Spa C ,→f
Mb,C can be written as coﬁltered intersection of quasicompact open subsets V
for which RΓ(V, Fℓ) ∼= Fℓ.
Proposition VII.7.2. For any b ∈B(G) with locally closed immersion ib : Bunb
G →BunG, the
functor
ib∗: Dlis(BunG, Λ) →Dlis(Bunb
G, Λ) ∼= Dlis([∗/Gb(E)], Λ)
admits a left adjoint, given by
πb♮q∗
b : Dlis([∗/Gb(E)], Λ) →Dlis(BunG, Λ).
The unit of the adjunction is given by the equivalence id ∼= ib∗πb♮q∗
b arising from base change, and
the identiﬁcation of the pullback of ib along πb with [∗/Gb(E)] ⊂Mb.
Proof. As D([∗/Gb(E)], Λ) ∼= D(Gb(E), Λ) is generated by c-IndGb(E)
K
Λ for open pro-p sub-
groups K ⊂Gb(E), and as we already determined the unit of the adjunction, it suﬃces to verify
the adjunction on these objects. Let Mb,K = f
Mb/K →Mb. This comes with a closed immersion
iK : [∗/K] →Mb,K. It suﬃces to see that for all A ∈Dlis(Mb,K, Λ), the map
RΓ(Mb,K, A) →RΓ([∗/K], A)
is an isomorphism, where we continue to denote by A any of its pullbacks.
Assume ﬁrst that
A = j!A0 for some A0 ∈Dlis(M◦
b,K, Λ). Then the result follows from Theorem VII.2.10. In general
we can then replace A by the cone of j!A →A in the displayed formula.
For this statement,
we can even base change to Spa C for some complete algebraically closed nonarchimedean ﬁeld
C|k, and allow more generally any A ∈Dlis(Mb,K,C, Λ). We can then assume that A = f♮Zℓfor
some ℓ-cohomologically smooth separated qcqs map f : Y →Mb,K,C. Then as in the proof of
Proposition VII.6.7, A is constant in a neighborhood of [Spa C/K], which implies the result (as
Spa C ⊂f
Mb,C is a coﬁltered intersection of quasicompact open V ’s with trivial cohomology).
□
Proposition VII.7.3. For any quasicompact open substack U ⊂BunG, the category Dlis(U, Λ)
admits a semi-orthogonal decomposition into the categories Dlis(Bunb
G, Λ) ∼= D(Gb(E), Λ) for b ∈
|U| ⊂B(G). Moreover, for any not necessarily quasicompact U, the functor Dlis(U, Λ) →Dlis(U×Spd k
Spa C, Λ) is an equivalence.

VII.7. Dlis(BunG)
269
Proof. We argue by induction on |U|, so take some closed element b ∈|U| ⊂B(G) and
let i : Bunb
G →U and j : V →U be the closed and complementary open substacks. We know
that Dlis(U, Λ) →Dlis(U ×Spd k Spa C, Λ) is fully faithful by Proposition VII.2.6, and by induction
Dlis(V, Λ) →Dlis(V ×Spd k Spa C, Λ) is an equivalence.
Now by the previous proposition, ib∗admits the left adjoint
πb♮q∗
b : Dlis([∗/Gb(E)], Λ) →Dlis(U, Λ),
and in fact the proof of that proposition shows (using our standing induction assumption) that,
composed with the embedding into Dlis(U ×Spd k Spa C, Λ), it continues to be a left adjoint to
ib∗: Dlis(U ×Spd k Spa C, Λ) →D([Spa C/Gb(E)], Λ) ∼= D([∗/Gb(E)], Λ).
The unit id →ib∗πb♮q∗
b of the adjunction is an equivalence. We see that Dlis(U ×Spd k Spa C, Λ)
has full subcategories given by j!Dlis(V, Λ) and the essential image of πb♮q∗
b (both of which lie
in Dlis(U, Λ)). To see that one has a semi-orthogonal decomposition, it suﬃces to see that if A ∈
Dlis(U×Spd kSpa C, Λ) with i∗A = j∗A = 0, then A = 0. This can be checked after pullback to f
Mb,C,
where it follows from Proposition VII.6.7. This also shows that Dlis(U, Λ) →Dlis(U ×Spd k Spa C, Λ)
is an equivalence.
□
Now we also want to analyze the compact objects as well as the universally locally acyclic
objects, and various dualities. We start with the compact objects.
Proposition VII.7.4. The category Dlis(BunG, Λ) is compactly generated.
An object A ∈
Dlis(BunG, Λ) is compact if and only if it has ﬁnite support and ib∗A ∈Dlis(Bunb
G, Λ) ∼= D(Gb(E), Λ)
is compact for all b ∈B(G), i.e. lies in the thick triangulated subcategory generated by c-IndGb(E)
K
Λ
for open pro-p subgroups K ⊂Gb(E).
Moreover, for each b and K ⊂Gb(E) pro-p, letting
fK : Mb,K →BunG
be the natural map, the object Ab
K = fK♮Λ ∈Dlis(BunG, Λ) is compact, and these generate
Dlis(BunG, Λ).
Proof. By Proposition VII.7.3, the left adjoints πb♮q∗
b to ib∗generate Dlis(BunG, Λ); as ib∗
commutes with colimits, these left adjoints also preserve compact objects. As each D(Gb(E), Λ) is
compactly generated, it follows that Dlis(BunG, Λ) is compactly generated, with compact generators
Ab
K.
To see that the given property characterizes compact objects, we argue by induction over
quasicompact open substacks U ⊂BunG. Pick any closed b ∈|U| ⊂B(G), and assume the result
for the complementary open j : V ⊂U. We ﬁrst show that all of the given compact generators
(coming from b′ ∈|U| ⊂B(G)) have the property that all of their stalks are compact.
This
is clear by induction if b′ ∈|V |, so we can assume b′ = b.
Then we need to see that j∗πb♮q∗
b
preserves compact objects. But this follows from Lemma VII.7.5 below. Using the semi-orthogonal
decomposition structure, it now follows that conversely, all A with compact stalks are compact.
□
Lemma VII.7.5. For K ⊂Gb(E) an open pro-p subgroup, the functor
RΓ(M◦
b,K, −) : D■(M◦
b,K, Λ) →D(Λ)

270
VII. D■(X)
has ﬁnite cohomological dimension and commutes with all direct sums.
Proof. As M◦
b,K = f
M◦
b/K where f
M◦
b is a spatial diamond, it suﬃces to prove that the functor
has ﬁnite cohomological dimension. It suﬃces to prove this for f
M◦
b (as taking K-invariants is exact).
One can formally reduce to Λ = Zℓand then to ﬁnitely presented solid Zℓ-sheaves F on f
M◦
b. Now
these can be written as coﬁltered inverse limits of constructible Fi. The RΓ( f
M◦
b, Fi) are uniformly
bounded; to see that their derived limit is also bounded, it is then suﬃcient to see that each
Hj( f
M◦
b, Fi) is ﬁnite. By Theorem IV.5.3, this is isomorphic to Hj+1
c
( f
M◦
b, Fi). But RΓc( f
M◦
b, −)
preserves compact objects as its right adjoint commutes with all colimits (as f
M◦
b is cohomologically
smooth over Spd k, being open in a successive extension of negative Banach–Colmez spaces).
□
Next, we study Bernstein–Zelevinsky duality.
Denoting π : BunG →∗the projection, the
pullback π∗has a left adjoint
π♮: Dlis(BunG, Λ) →Dlis(∗, Λ) ∼= D(Λ).
This induces a pairing
Dlis(BunG, Λ) × Dlis(BunG, Λ) →D(Λ) : (A, B) 7→π♮(A
■⊗L
ΛB).
Proposition VII.7.6. For any compact object A ∈Dlis(BunG, Λ), there is a unique compact
object DBZ(A) ∈Dlis(BunG, Λ) with a functorial identiﬁcation
R Hom(DBZ(A), B) ∼= π♮(A
■⊗L
ΛB)
for B ∈Dlis(BunG, Λ). Moreover, the functor DBZ is a contravariant autoequivalence of Dlis(BunG, Λ)ω,
and D2
BZ is naturally isomorphic to the identity.
If U ⊂BunG is an open substack and A is concentrated on U, then so is DBZ(A). In particular,
DBZ restricts to an autoequivalence of the compact objects in Dlis(Bunb
G, Λ) ∼= D(Gb(E), Λ) for
b ∈B(G) basic, and in that setting it is the usual Bernstein–Zelevinsky involution.
Proof. The existence of DBZ follows as in Theorem V.5.1, using the left adjoint given by
Proposition VII.7.2; this construction also shows that DBZ preserves Dlis(U, Λ), and for basic b it
recovers the usual Bernstein–Zelevinsky involution by the same argument as in Theorem V.5.1.
We also formally get a morphism D2
BZ(A) →A by adjunctions. We need to see that this is an
isomorphism. It suﬃces to check on generators. The Bernstein–Zelevinsky dual of ib
! c-IndGb(E)
K
Λ is
Ab
K = fK♮Λ, for fK : Mb,K →BunG the natural map. Its restriction to Bunb
G is again ib
! c-IndGb(E)
K
Λ,
so one easily checks that the map D2
BZ(A) →A is an isomorphism over Bunb
G. To see that it is
an isomorphism everywhere, one needs to see that if B = Rj∗B′, B′ ∈Dlis(U, Λ) for some open
substack j : U ⊂BunG not containing Bunb
G, then
π♮(Ab
K
■⊗L
ΛB) = 0.
Twisting a few things away and using the deﬁnition of Ab
K = fK♮Λ, this follows from the assertion
that for all A′ ∈Dlis(M◦
b,K, Λ), with jK : M◦
b,K ,→Mb,K the open immersion, one has
RΓc(Mb,K, RjK∗A′) = 0.

VII.7. Dlis(BunG)
271
Using the trace map for f
Mb →Mb,K, this follows from Theorem VII.2.10.
□
As in Theorem V.6.1, this has the following consequence for Verdier duality.
Proposition VII.7.7. Let j : V ,→U be an open immersion of open substacks of BunG. For
any A ∈Dlis(V, Λ), the natural map
j!RHomlis(A, Λ) →RHomlis(Rjlis∗A, Λ)
is an isomorphism in Dlis(U, Λ).
Proof. The proof is identical to the proof of Theorem V.6.1.
□
Using this, one can characterize the reﬂexive objects as in Theorem V.6.2; we omit it here.
Finally, one can also characterize the universally locally acyclic A ∈Dlis(BunG, Λ). Note that we
have not deﬁned a notion of universal local acyclicity for lisse sheaves, but in our present situation we
can simply import the characterization from Proposition IV.2.32 and make the following deﬁnition.
Definition VII.7.8. A complex A ∈Dlis(BunG, Λ) is universally locally acyclic (with respect
to BunG →∗) if the natural map
p∗
1RHomlis(A, Λ)
■⊗L
Λp∗
2A →RHomlis(p∗
1A, p∗
2A)
is an isomorphism, where p1, p2 : BunG × BunG →BunG are the two projections.
We get the following version of Theorem V.7.1.
Proposition VII.7.9. Let A ∈Dlis(BunG, Λ). Then A is universally locally acyclic if and only
if for all b ∈B(G), the pullback ib∗A to ib : Bunb
G ,→BunG corresponds under Dlis(Bunb
G, Λ) ∼=
D(Gb(E), Λ) to a complex Mb of smooth Gb(E)-representations for which MK is a perfect complex
of Λ-modules for all open pro-p subgroups K ⊂Gb(E).
The proof is identical to the proof of Theorem V.7.1, and proceeds by proving ﬁrst the following
proposition.
Proposition VII.7.10. Let G1 and G2 be two reductive groups over E, and let G = G1 × G2.
Consider the exterior tensor product
−⊠−: Dlis(BunG1, Λ) × Dlis(BunG2, Λ) →Dlis(BunG, Λ).
For all compact objects Ai ∈Dlis(BunGi, Λ), i = 1, 2, the exterior tensor product A1 ⊠A2 ∈
D´et(BunG, Λ) is compact, these objects form a class of compact generators, and for all further
objects Bi ∈Dlis(BunGi, Λ), i = 1, 2, the natural map
R Hom(A1, B1) ⊗L
Λ R Hom(A2, B2) →R Hom(A1 ⊠A2, B1 ⊠B2)
is an isomorphism.
Proof. The proof is identical to the proof of Proposition V.7.2.
□


CHAPTER VIII
L-parameter
It is time to understand the other side of the correspondence: In this chapter, we deﬁne, and
study basic properties of, the stack of L-parameters. These results have recently been obtained
by Dat–Helm–Kurinczuk–Moss [DHKM20], and also Zhu [Zhu20]; previous work in a related
direction includes [Hel16], [HH20], [BG19], [BP19], [LTX+19, Appendix E].
In this chapter, we ﬁx again a nonarchimedean local ﬁeld E with residue ﬁeld Fq of characteristic
p, and a reductive group G over E, as well as a prime ℓ̸= p. We get the dual group bG/Zℓ, which we
endow with its usual “algebraic” action by WE; the action thus factors over a ﬁnite quotient Q of
WE, and we ﬁx such a quotient Q of WE. (The diﬀerence to the cyclotomically twisted WE-action
disappears after base change to Zℓ[√q], and we could thus obtain analogues of all results below for
this other action by a simple descent along Zℓ[√q]/Zℓ.) We deﬁne a scheme whose Λ-valued points,
for a Zℓ-algebra Λ, are the condensed 1-cocycles
ϕ : WE →bG(Λ),
where Λ = Λdisc ⊗Zℓ,disc Zℓis regarded as a relatively discrete condensed Zℓ-module.
Theorem VIII.0.1 (Theorem VIII.1.3). There is a scheme Z1(WE, bG) over Zℓwhose Λ-valued
points, for a Zℓ-algebra Λ, are the condensed 1-cocycles
ϕ : WE →bG(Λ).
The scheme Z1(WE, bG) is a union of open and closed aﬃne subschemes Z1(WE/P, bG) as P runs
through open subgroups of the wild inertia subgroup of WE, and each Z1(WE/P, bG) is a ﬂat local
complete intersection over Zℓof dimension dim G.
To prove the theorem, following [DHKM20] and [Zhu20] we deﬁne discrete dense subgroups
W ⊂WE/P by discretizing the tame inertia, and the restriction Z1(WE/P, bG) →Z1(W, bG) is an
isomorphism, where the latter is clearly an aﬃne scheme.
We can also prove further results about the bG-action on Z1(WE, bG), or more precisely each
Z1(WE/P, bG). For this result, we need to exclude some small primes, but if G = GLn, all primes
ℓare allowed; for classical groups, all ℓ̸= 2 are allowed. More precisely, we say that ℓis very good
for bG if the following conditions are satisﬁed.
(i) The (algebraic) action of WE on bG factors over a ﬁnite quotient Q of order prime to ℓ.
(ii) The order of the fundamental group of the derived group of bG is prime to ℓ(equivalently, π0Z(G)
is of order prime to ℓ).
273

274
VIII. L-PARAMETER
(iii) If G has factors of type B, C, or D, then ℓ̸= 2; if it has factors of type E, F, or G, then
ℓ̸= 2, 3; and if it has factors of type E8, then ℓ̸= 2, 3, 5.
Theorem VIII.0.2 (Theorem VIII.5.1). Assume that ℓis a very good prime for bG.
Then
Hi( bG, O(Z1(WE/P, bG))) = 0 for i > 0 and the formation of the invariants O(Z1(WE/P, bG)) bG
commutes with any base change. The algebra O(Z1(WE/P, bG)) bG admits an explicit presentation in
terms of excursion operators,
O(Z1(WE/P, bG))
bG = colim(n,Fn→W) O(Z1(Fn, bG))
bG
where the colimit runs over all maps from a free group Fn to W ⊂WE/P, and Z1(Fn, bG) ∼= bGn
with the simultaneous twisted bG-conjugation.
Moreover, the ∞-category Perf(Z1(WE/P, bG)/ bG) is generated under cones and retracts by the
image of Rep( bG) →Perf(Z1(WE/P, bG)/ bG), and Ind Perf(Z1(WE/P, bG)) is equivalent to the ∞-
category of modules over O(Z1(WE/P, bG)) in Ind Perf(B bG).
All of these results also hold with Qℓ-coeﬃcients, without any assumption on ℓ.
With Qℓ-coeﬃcients, these results are simple, as the representation theory of bG is semisimple.
However, with Zℓ-coeﬃcients, these results are quite subtle, and we need to dive into modular
representation theory of reductive groups. Very roughly, the proof of the theorem proceeds by
analyzing the closed bG-orbits in the stack of L-parameters ﬁrst, and then use a deformation to the
normal cone to understand the behaviour near any bG-orbit. We make critical use of some results
of Touz´e–van der Kallen [TvdK10]. Let us make some further remarks about the closed bG-orbits.
First, the closed bG-orbits in Z1(WE/P, bG)L, for any algebraically closed ﬁeld L over Zℓ, corre-
spond to the semisimple L-parameter ϕ : WE →bG(L), and also biject to the geometric points of
Spec O(Z1(WE/P, bG)) bG. Here, an L-parameter is semisimple if, whenever it factors over a para-
bolic bP ⊂bG, it also factors over a Levi c
M ⊂bP. Any semisimple parameter is in fact continuous
for the discrete topology on L, i.e. trivial on an open subgroup of IE. If L = Fℓand Q is of order
prime to ℓ, then ϕ is semisimple if and only if it factors over a ﬁnite quotient of order prime to ℓ.
Its orbit in Z1(WE/P, bG)L is then given by bG/Sϕ where Sϕ ⊂bG is the centralizer of ϕ, which is
in that case the ﬁxed points under the action of a ﬁnite solvable group F of automorphisms of bG,
where the order of F is prime to ℓ. We need the following result.
Theorem VIII.0.3 (Theorem VIII.5.14). Let H be a reductive group over an algebraically closed
ﬁeld L of characteristic ℓ. Let F be a ﬁnite group of order prime to ℓacting on H. Then HF is
a smooth linear algebraic group whose connected component is reductive, and with π0HF of order
prime to ℓ. If F is solvable, the image of Perf(BH) →Perf(BHF ) generates the whole category
under cones and retracts.
The last part of this theorem is proved by a very explicit (and exhausting) analysis of all
possible cases. It would be desirable to have a more enlightening argument, possibly also removing
the assumption that F is solvable. In fact, we would expect similar results to hold true in the
case where W is replaced by the fundamental group of a Riemann surface. Our arguments are not
general enough to handle that case.

VIII.1. THE STACK OF L-PARAMETERS
275
Remark VIII.0.4. While the hypotheses imposed on ℓare surely not optimal, we are quite
sure that some hypothesis on ℓis required in Theorem I.8.2. For example, if bG = PGL2 and ℓ= 2,
we expect problems to arise. For example, one can show that for X = bG with the conjugation
action by bG, the ∞-category Perf(X/ bG) is not generated under cones and retracts by the image
of Rep( bG). Our guess would be that the condition that ℓdoes not divide the order of π1( bGder) is
essential.
On the other hand, we expect that, for example by the use of z-embeddings [Kal14, Section 5],
one can reduce all relevant questions (like the general construction of maps on Bernstein centers
discussed below, or the construction of the spectral action) to the case where ℓdoes not divide the
order of π1( bGder). We are not taking this up here.
VIII.1. The stack of L-parameters
VIII.1.1. Deﬁnition and representability. Recall that for a reductive group G over a
nonarchimedean local ﬁeld E, we have the dual group bG over Zℓ, equipped with an action of the
Weil group WE. In this chapter, we use the standard action.
Now let Λ be any Zℓ-algebra. As in the last chapter, we regard it as a condensed Zℓ-algebra, as
Λdisc⊗Zℓ,disc Zℓ. Its value on a proﬁnite set S is the ring of maps S →Λ that take values in a sub-Zℓ-
module of ﬁnite type and are continuous. For example, if Λ = Qℓthen Λ(S) = lim
−→L⊂QℓCont(S, L)
with L|Qℓﬁnite.
Definition VIII.1.1. An L-parameter for G, with coeﬃcients in Λ, is a section
ϕ : WE →bG(Λ) ⋊WE
of the natural map of condensed groups
bG(Λ) ⋊WE →WE.
Equivalently, an L-parameter for G with coeﬃcients in Λ is a (condensed) 1-cocycle
ϕ : WE →bG(Λ)
for the given WE-action on bG.
More concretely, an L-parameter with values in Λ is a 1-cocycle ϕ : WE →bG(Λ) such that if
bG ,→GLN, the associated map WE →GLN(Λ) is continuous. The preceding means the matrix
coeﬃcients of its restriction to IE are maps IE →Λ that take values in ﬁnite type Zℓ-modules and
are continuous.
Remark VIII.1.2. The standard action of WE factors over a ﬁnite quotient Q. This means
that L-parameters are also equivalent to maps WE →bG(Λ) ⋊Q lifting WE →Q.
The ﬁrst main result is the following.
Theorem VIII.1.3. There is a scheme Z1(WE, bG) over Zℓparametrizing L-parameters for G,
which is a disjoint union of aﬃne schemes of ﬁnite type over Zℓ. It is ﬂat and a relative complete
intersection of dimension dim G = dim bG.

276
VIII. L-PARAMETER
Proof. Any condensed 1-cocycle ϕ : WE →bG(Λ) is trivial on an open subgroup of the wild
inertia subgroup PE; note also that PE acts on bG through a ﬁnite quotient. Moreover, for any
γ ∈PE acting trivially on bG, the locus where ϕ(γ) = 1 is open and closed: Taking a closed
embedding bG ,→GLN, this follows from A = 1 being a connected component of the locus of all
A ∈GLN such that Apr = 1, as can be checked by observing that the tangent space at A = 1 is
trivial. It follows that the moduli space of L-parameters decomposes as a disjoint union of open
and closed subspaces according to the kernel of ϕ on PE.
Thus, ﬁx now some quotient WE →W ′
E by an open subgroup of PE such that the action of WE
on bG factors over W ′
E. We are interested in the moduli space of condensed 1-cocycles W ′
E →bG(Λ).
Inside W ′
E, we look at the discrete dense subgroup W ⊂W ′
E generated by the image of PE, a choice
of generator of the tame inertia τ, and a choice of Frobenius σ. Thus, W sits in an exact sequence
0 →I →W →σZ →0
where I in turn sits in an exact sequence
0 →P →I →τ
Z[ 1
p] →0
where P is a ﬁnite p-group. Moreover, in W/P, the elements τ and σ satisfy the commutation
σ−1τσ = τ q.
Now observe that any condensed 1-cocycle W ′
E →bG(Λ) is already determined by its restriction
to the discrete group W, as bG(Λ) is quasiseparated and W ⊂W ′
E is dense. Conversely, we claim
that any 1-cocycle W →bG(Λ) extends uniquely to a condensed 1-cocycle W ′
E →bG(Λ). To check
this, we may replace E by a ﬁnite extension; we can thus pass to a setting where the action of W ′
E
on bG is trivial, and where P = 1. Taking a closed immersion bG ,→GLN, it then suﬃces to see that
any representation of τ
Z[ 1
p] ⋊σZ on a ﬁnite free Λ-module extends uniquely to a representation of
the condensed group bZp ⋊σZ. For this, in turn, it suﬃces to see that for any A ∈GLN(Λ) such
that A is conjugate to Aq, the map
Z →GLN(Λ) : n 7→An
extends uniquely to bZp. The assumption on A implies that all eigenvalues of A at all geometric
points of Spec Λ are roots of unity of order prime to p; replacing A by a prime-to-p-power (as we
may) we can thus reduce to the case that A is unipotent, i.e. A −1 is nilpotent. But then n 7→Xn
extends to a continuous map
n 7→Xn = (1 + (X −1))n =
X
i≥0
n
i

(X −1)i,
deﬁning a map Zℓ→GLN(Λ) (and hence bZp →Zℓ→GLN(Λ)).
Thus, we need to see that the space X = Z1(W, bG) of all 1-cocycles ϕ : W →bG(Λ) is an aﬃne
scheme of ﬁnite type over Zℓthat is ﬂat and a relative complete intersection of dimension dim bG.
It is clear that it is an aﬃne scheme of ﬁnite type over Zℓas W is discrete and ﬁnitely generated.
To prove the geometric properties, we ﬁnd it slightly more convenient to argue with the Artin
stack [X/ bG], which we aim to prove is ﬂat and a relative complete intersection of dimension 0 over
Zℓ.

VIII.1. THE STACK OF L-PARAMETERS
277
We can understand the deformation theory of [X/ bG]: If Λ is a ﬁeld, then the obstruction group
is H2(W,bg ⊗ZℓΛ) (where bg is the Lie algebra of bG), the tangent space is H1(W,bg ⊗ZℓΛ), and the
inﬁnitesimal automorphisms are H0(W,bg⊗ZℓΛ), where in all cases the action of W is twisted by the
local 1-cocycle ϕ. Now note that by direct computation the prime-to-p cohomological dimension of
W is 2, and the Euler characteristic of any representation is equal to 0. Thus, this analysis shows
that we only have to prove that all ﬁbres of [X/ bG] →Spec Zℓare of dimension at most 0.
Note that X is actually naturally deﬁned over Z[ 1
p] (as bG is, and the discretization W of W ′
E is
independent of ℓ). It follows that it suﬃces to bound the dimension of the ﬁbre over Fℓ(as if we
can do this for all closed points of Spec Z[ 1
p], it follows over the generic ﬁbre by constructibility of
the dimension of ﬁbers). To do this, we switch back to the picture of condensed 1-cocycles on WE.
From now on, we work over Fℓ.
The stack [Z1(WE, bG)Fℓ/ bG] maps to the similar stack parametrizing 1-cocycles ϕIℓ: Iℓ→bG(Λ)
of the prime-to-ℓinertia subgroup Iℓ, up to conjugation. By deformation theory, that stack is
smooth and each connected component is a quotient of Spec Fℓby the centralizer group CϕIℓ⊂bGFℓ,
which is a smooth group, whose identity component is reductive by [PY02, Theorem 2.1]. We may
thus ﬁx ϕIℓ: Iℓ→bG(Fℓ) and consider the open and closed subscheme XϕIℓ⊂Z1(WE, bG)Fℓof all
1-cocycles ϕ : WE →bG(Λ) whose restriction to Iℓis equal to ϕIℓ. Our goal is to show that XϕIℓ
is of dimension at most dim CϕIℓ.
Consider the centralizer eC of ϕIℓinside bGFℓ⋊Q. Then XϕIℓmaps with ﬁnite ﬁbres to the
space of maps
f : WE/Iℓ∼= Zℓ⋊σZ −→eC/ϕIℓ(Iℓ).
Note that, by representability of XϕIℓ, the universal map f factors over a quotient of the form
Z/ℓmZ ⋊σZ. Finally, we have reduced to Lemma VIII.1.4 below.
□
Lemma VIII.1.4. Let H be a smooth group scheme over Fℓwhose identity component is reduc-
tive. Then the aﬃne scheme parametrizing maps of groups
Z/ℓmZ ⋊σZ →H,
where σ acts on Z/ℓmZ via multiplication by q, is of dimension at most dim H.
Proof. The image of the generator of Z/ℓmZ is a unipotent element of H. By ﬁniteness of
the number of unipotent conjugacy classes, cf. [Lus76], [FG12, Corollary 2.6], we can stratify the
scheme according to the conjugacy class of the image of τ. But for each ﬁxed conjugacy class,
one has to choose the image of σ so as to conjugate τ into τ q: This bounds the dimension of each
stratum by the dimension of the conjugacy class of τ (giving the choices for τ) plus the codimension
of the conjugacy class of τ (giving the choices for σ, for any given τ), which is the dimension of
H.
□
We observe the following corollary of the proof.
Proposition VIII.1.5. Assume that WE acts on bG via a ﬁnite quotient Q of order prime to
ℓ. Let L = Fℓ. Let ϕ : WE →bG(L) be any L-parameter. Then the bG-orbit of ϕ in Z1(WE, bG)L is
closed if and only if the map ϕ factors over a ﬁnite quotient of WE of order prime to ℓ.

278
VIII. L-PARAMETER
Proof. In the notation of the proof, the group CϕIℓhas connected components of order prime
to ℓ, see Proposition VIII.5.11 below, so one will apply Lemma VIII.1.4 to a group H with π0H
of order prime to ℓ. This implies that the unipotent element is actually an element of H◦, and its
orbit is closed only if it is trivial. Moreover, the image of the Frobenius σ deﬁnes a closed orbit if
and only if it is semisimple, i.e. of order prime to ℓ, giving the claim.
□
VIII.2. The singularities of the moduli space
The following proposition was already implicitly noted in the proof of Theorem VIII.1.3.
Proposition VIII.2.1. For any parameter ϕ : WE →bG(Λ)⋊Q corresponding to x : Spec(Λ) →
[Z1(WE, bG)/ bG],
x∗L∨
Z1(WE, bG)/ bG = RΓ(WE, (bg ⊗ZℓΛ)ϕ)[1]
where (bg ⊗ZℓΛ)ϕ is bg ⊗ZℓΛ equipped with the twisted action of WE deduced from ϕ.
Proof. This would be clear if we deﬁned the moduli problem on all animated Zℓ-algebras,
by deformation theory. Then the cohomological dimension of WE would imply that this moduli
problem is a derived local complete intersection, of expected dimension 0. However, we proved that
Z1(WE, bG)/ bG is a local complete intersection Artin stack of dimension 0, hence it represents the
correct moduli problem even on all animated Zℓ-algebras, thus giving the result.
□
Proposition VIII.2.2. Let M be a free Λ-module of ﬁnite rank equipped with a condensed action
of WE. Then RΓ(WE, M) is a perfect complex of Λ-modules and there is a canonical isomorphism
RΓ(WE, M)∗∼= RΓ(WE, M∗(1))[2].
Proof. This follows from Poincar´e duality applied to Div1 →∗, using Proposition VII.3.5 and
the discussion before. It can also be proved by hand, by comparing the WE-cohomology with the
W-cohomology, for a discretization W of WE/P as before.
□
Corollary VIII.2.3. For any parameter ϕ : WE →bG(Λ)⋊WE corresponding to x : Spec(Λ) →
[Z1(WE, bG)/ bG],
x∗LZ1(WE, bG)/ bG = RΓ(WE, (bg∗⊗ZℓΛ)ϕ(1))[1]
where (bg∗⊗ZℓΛ)ϕ is bg∗⊗ZℓΛ equipped with the twisted action of WE deduced from ϕ.
VIII.2.1. The characteristic zero case. Fix an isomorphism IE/PE ∼= bZp.
There is a
bGQℓ-equivariant “unipotent monodromy” morphism
M : Z1(WE, bG)Qℓ−→N bGQℓ
where N bGQℓis the nilpotent cone inside bg ⊗Qℓ.
In fact, one can lift the inclusion Zℓ,→bZp ∼= IE/PE to a morphism Zℓ→IE.
Now, if
ϕ : WE →bG(Λ), with Λ a Qℓ-algebra, is a parameter, then ϕ|Zℓ: Zℓ→bG(Λ) is such that for
n ≫0, ϕ|ℓnZℓis a morphism of condensed groups satisfying
ϕ(σm)ϕ|ℓnZℓϕ(σm)−1 = ϕqm
|ℓnZℓ

VIII.2. THE SINGULARITIES OF THE MODULI SPACE
279
for m ≫0. One deduces, using an embedding of bG in GLN, that there is a unique N ∈N bG(Λ)
such that for n ≫0 and x ∈ℓnZℓ,
ϕ(x) = exp(xN).
Using these observations, we get a comparison to Weil–Deligne L-parameters.
Definition VIII.2.4. For Λ a Qℓ-algebra one deﬁnes ParWD
bG
(Λ) to be the set of pairs (ϕ0, N)
where
(i) ϕ0 : WE →bG(Λdisc) is a condensed 1-cocycle,
(ii) N ∈N bG ⊗Qℓsatisﬁes Ad(ϕ0(σ)).σN = q|σ|N for all σ ∈WE.
Then we have the following result, which is essentially Grothendieck’s quasi-unipotence theorem.
Proposition VIII.2.5 ([Zhu20, Lemma 3.1.8]). There is a bG-equivariant isomorphism
Z1(WE, bG) ⊗Qℓ
∼
−→ParWD
bG
.
However, we warn the reader that this isomorphism depends on some auxiliary choices, such as
that of a Frobenius element.
VIII.2.2. The singular support.
VIII.2.2.1. General construction. Recall the following construction, see for example [AG15].
Let A →B be a ﬂat map of commutative rings. One has the Hochschild cohomology
HH•(B/A) = Ext•
B⊗AB(B, B).
Note that any M ∈D(B ⊗A B) induces a functor D(B) →D(B), via N 7→M ⊗L
B N (with the
“left” B-module structure). Here, M = B ∈D(B ⊗A B), via the multiplication B ⊗A B →B,
induces the identity functor. It follows that there is a natural map
HHi(B/A) = Exti
B⊗AB(B, B) →Exti
B(N, N)
for any N ∈D(B). Moreover, Hochschild cohomology is naturally a graded algebra, and this map
is a map of algebras
HH•(B/A) →Ext•
B(N, N).
There is an identiﬁcation ([ML95, Theorem X.3.1])
HH2(B/A) = Ext1
B(LB/A, B)
which itself is nothing else than ExalcomA(B, B) ([Gro64, Chap.0, Sec. 18.4]). We thus have an
identiﬁcation
HH2(B/A) = H1(L∨
B/A).
Suppose now that A →B is syntomic, i.e. ﬂat and a local complete intersection. Let X = Spec B →
S = Spec A be the associated map of aﬃne schemes.
Definition VIII.2.6. The scheme
SingX/S −→X
represents the functor T/X 7→H−1(LX/S ⊗L
OX OT ).

280
VIII. L-PARAMETER
In fact, locally on X, LX/S is isomorphic to a complex of vector bundles [E−1 →E0] and then
SingX/S is the kernel of V(E−1) →V(E0). Explicitly, SingX/S is the aﬃne scheme with
O(SingX/S) = Sym•
BH1(L∨
B/A).
This is an X-group scheme equipped with an action of Gm. The image of SingX/S \ {0} →X is
the closed subset complementary of the smooth locus of X →S.
Consider now any
N ∈Db
coh(X),
and the graded B-algebra Ext•
B(N, N). Using the map
H1(L∨
B/A) = HH2(B/A) →Ext2
B(N, N),
this is in fact naturally a (graded) O(SingX/S)-algebra.
This deﬁnes a Gm-equivariant quasi-
coherent sheaf
µ End(N)
on SingX/S.
Suppose now moreover that S is regular.
Theorem VIII.2.7 ([Gul74, Theorem 3.1],[AG15, Appendix D]). For N ∈Db
coh(X), the
quasi-coherent sheaf µ End(N) on SingX/S is coherent.
Definition VIII.2.8. The singular support of N, SingSupp(N), is the support of µ End(F) as
a closed conical subset of SingX/S.
Of course, the image of SingSupp(N) →X is contained in Supp(N).
Theorem VIII.2.9 ([AG15, Theorem 4.2.6]). The following are equivalent:
(i) N is a perfect complex,
(ii) SingSupp(N) is contained in the zero section of SingX/S.
Proof. We have to prove that if Exti
B(N, N) = 0 for i ≫0 then N is a perfect complex. This
is for example a consequence of [Jor08]. Since S is regular X is Gorenstein. According to [Jor08],
if N is a B-module of ﬁnite type that satisﬁes Exti
B(N, N) = 0 for i > n, then pdBN ≤n. In
general, up to taking a shift of N, we can ﬁnd a map N →N′, where N′ is a ﬁnitely generated
B-module concentrated in degree 0, such that the cone C of N →N′ is perfect. Suppose that
Exti
B(N, N) = 0 for i ≫0. In the long exact sequence
· · · −→Exti
B(C, N) −→Exti
B(N′, N) −→Exti
B(N, N) −→· · ·
one has Exti
B(C, N) = 0 for i ≫0 since C is perfect and Exti
B(N, N) = 0 for i ≫0 by hypothesis.
We deduce that Exti
B(N′, N) = 0 for i ≫0. In the long exact sequence
· · · −→Exti
B(N′, N) −→Exti
B(N′, N′) −→Exti
B(N′, C) −→· · ·
we have Exti
B(N′, C) = 0 for i ≫0 since C is perfect and A has ﬁnite injective dimension over
itself since it is Gorenstein. Thus, for i ≫0, Exti
B(N′, N′) ∼
−→Exti
B(N′, N) and this vanishes. We
can thus apply Jorgensen’s theorem to N′ to conclude that N′, and hence N, is perfect.
□

VIII.2. THE SINGULARITIES OF THE MODULI SPACE
281
Let us note the following corollary.
Corollary VIII.2.10. The image of SingSupp(N) \ {0} →X is the complementary of the
biggest open subset of X on which N is a perfect complex.
VIII.2.2.2. The case of Z1(WE, bG). Now we apply the preceding theory in the case A = Zℓand
X = Z1(WE, bG) (which is only a union of aﬃne schemes, but this is not a problem). We can also
pass to the quotient stack Z1(WE, bG)/ bG. According to Corollary VIII.2.3, there is an embedding
Sing[Z1(WE, bG)/ bG]/Zℓ
[bg∗/ bG] ×B bG [Z1(WE, bG)/ bG]
[Z1(WE, bG)/ bG]
where bg = Lie bG and [bg∗/ bG] is seen here as a vector bundle on B bG = [Spec Zℓ/ bG]. Let N ∗
bG ⊂bg∗
be the nilpotent cone; by this we mean the closed subset of all bG-orbits whose closure contains
the origin. (If there is a bG-equivariant isomorphism between bg∗and bg, this would identify with
the usual nilpotent cone.) Since this is stable under the adjoint action this deﬁnes a Zariski closed
substack
[N ∗
bG/ bG] ×B bG [Z1(WE, bG)/ bG]
[bg∗/ bG] ×B bG [Z1(WE, bG)/ bG]
[Z1(WE, bG)/ bG].
Proposition VIII.2.11. For a Zℓ-ﬁeld L and a point x : Spec(L) →[Z1(WE, bG)/ bG] we have
x∗Sing[Z1(WE, bG)/ bG]/Zℓ⊂N ∗
bG ⊗ZℓL
in the following two cases:
(i) L|Qℓ,
(ii) ℓdoes not divide the order of the fundamental group of the adjoint form of G, and if n = fE′/E
with WE′ = ker(WE →Out( bG)), ℓ̸ |qen −1 for any exponent e of bG.
Proof. If x corresponds to the parameter ϕ then x∗Sing[Z1(WE, bG)/ bG]/Zℓ= H0(WE,bg∗⊗ZℓL(1))
where the WE action on bg∗⊗ZℓL(1) is twisted by ϕ. For an element v ∈bg ∼= bg∗in this subspace
we thus have that σ.v and qv are in the same orbits under the adjoint action of bG(L) (here σ.v is
given by the action of WE on bg∗deﬁning the L-group). We thus obtain that v is conjugated under
the adjoint action to qnv. There is a morphism
bg −→bg  bG = bt  W ∼= Am
Zℓ
given by m homogeneous polynomials of degrees the exponents of the root system. This implies
that the image of v in Am(L) is zero and thus v lies in the nilpotent cone.
□

282
VIII. L-PARAMETER
The supremum of the exponents of bG is the Coxeter number h of G. The preceding condition
is satisﬁed if for example ℓ> qhn −1. We refer to [DHKM20, Section 5.3] for ﬁner deﬁnitions and
results about bG-banal primes; we have not tried to optimize the condition above, and it is likely
that with their results one can obtain a much better condition on ℓ.
Remark VIII.2.12. In the non-banal case things become more complicated and the Arinkin–
Gaitsgory condition of nilpotent singular support becomes important. This is also the case when in-
teresting congruences modulo ℓbetween smooth irreducible representations of G(E) occur, cf. [DHKM20,
Section 1.5].
VIII.3. The coarse moduli space
Let us now describe the corresponding coarse moduli space, i.e. we consider the quotient
Z1(WE, bG)  bG
taken in the category of schemes. Concretely, for every connected component Spec A ⊂Z1(WE, bG),
we get a corresponding connected component Spec A bG ⊂Z1(WE, bG)  bG.
VIII.3.1. Geometric points. For any algebraically closed ﬁeld L over Zℓ, the L-valued points
of Z1(WE, bG)L  bG are in bijection with the closed bG-orbits in Z1(WE, bG)L.
We want to describe L-valued points with closed bG-orbit as the “semisimple” parameters. For
this, recall (cf. [Bor79]) that parabolic subgroups of bGL ⋊WE surjecting onto WE are up to bG(L)-
conjugation given by bPL ⋊WE for a standard parabolic P ⊂G∗of the quasisplit inner form G∗of
G. A Levi subgroup is given by c
ML ⋊WE where M ⊂P is the standard Levi. We now call them
the parabolic subgroups of bG ⋊WE i.e. we always suppose they surject to WE. If b∆are the simple
roots of bG then the standard parabolic subgroups are in bijection with the ﬁnite WE-stable subsets
of b∆.
Definition VIII.3.1. Let L be an algebraically closed ﬁeld over Zℓ. An L-parameter ϕ : WE →
bG(L)⋊WE is semisimple if whenever the image of ϕ is contained in a parabolic subgroup of bG⋊WE
then it is contained in a Levi subgroup of this parabolic subgroup.
In terms of the standard parabolic subgroups this means that if some bG(L)-conjugate ϕ′ of ϕ
factorizes through bP(L) ⋊WE, then there exists g ∈bP(L) such that gϕ′g−1 = prLM ◦ϕ′, where
prLM : bP(L) ⋊WE →c
M(L) ⋊WE is the projection onto the standard Levi subgroup.
Proposition VIII.3.2 ([DHKM20, Proposition 4.13]). Let L be an algebraically closed ﬁeld
over Zℓand ϕ : WE →bG(L) ⋊WE a parameter. The following are equivalent:
(i) The bG-orbit of ϕ in Z1(WE, bG)L is closed.
(ii) For any conjugate ϕ′ of ϕ such that ϕ′ : WE →bP(L) ⋊WE factors over a standard parabolic
subgroup, ϕ is bG(L)-conjugate to prLM ◦ϕ′.
(iii) ϕ is semi-simple.

VIII.3. THE COARSE MODULI SPACE
283
Proof. We use the Hilbert–Mumford–Kempf theorem, cf. [Kem78, Corollary 3.5]. Let λ :
Gm →bGL. Up to conjugation we can assume λ ∈X∗( bT)+. For each τ ∈WE there is a morphism
evτ : Z1(WE, bG)L →bG given by evaluating a parameter on τ. Thus, if limt→0 λ(t) · ϕ exists, i.e.
the associated morphism Gm,L →Z1(WE, bG)L extends to A1
L, for each τ ∈WE one has λτ = λ and
ϕ(τ) ∈Qλ(L) ⋊τ, cf. Lemma VIII.3.3. One thus has Qλ = bP for P a standard parabolic subgroup
of G∗, and ϕ : WE →bP ⋊WE.
For g ∈bP, limt→0 λ(t)gλ(t)−1 is the projection onto the standard Levi subgroup c
M. Thus,
using the evaluation morphism evτ for each τ we deduce that limt→0 λ(t) · ϕ, if it exists, is given by
the composite WE
ϕ−→bP(L)⋊WE
proj
−−→c
M(L)⋊WE. Reciprocally, since the morphism Gm× bP →bP,
given by (t, g) 7→λ(t)gλ(t)−1 extends to A1 × bP with ﬁber over 0 ∈A1 given by the projection to
c
M, for any ϕ : WE →bP ⋊WE, limt→0 λ(t) · ϕ exists.
From this analysis we deduce the equivalence between (1) and (2). It is clear that (3) implies
(2). For the proof of (2) implies (3) we use the results of [BMR05] and [Ric88]. For this we see
parameters as morphisms W →bG(Λ) ⋊Q where W is discrete ﬁnitely generated as in the proof
of Theorem VIII.1.3, and Q is a ﬁnite quotient of W. Let ϕ : W →bG(L) ⋊Q satisfying (2). Let
H ⊂bGL ⋊Q be the Zariski closure of the image of ϕ. Then if (x1, . . . , xn) ∈( bG(L) × Q)n are the
images of a set of generators of W, applying the Hilbert–Mumford–Kempf criterion we see that
the bGL-orbit of (x1, . . . , xn) via the diagonal action is closed, cf. the proof of [BMR05, Lemma
2.17]. We can then apply [Ric88], cf. [BMR05, Proposition 2.16], to deduce that H is strongly
reductive in bGL ⋊Q and thus bGL-completely reducible. Strictly speaking, since we are working in
a non-connected situation, we use in fact [BMR05, Section 6].
□
Lemma VIII.3.3. For λ : Gm →bGL and g ⋊τ ∈bG(L)⋊WE, the limit limt→0 λ(t)gλ(t)−τ exists
if and only if g ∈Qλ(L), the parabolic subgroup attached to λ, and λτ = λ.
Proof. Up to conjugation we can suppose λ ∈X∗(T)+. Then, Qλ and Qλτ are standard
parabolic subgroups of bG. Let us write g = g′ .wg′′ with g′ ∈Qλ(L), g′′ ∈Qλτ (L) and w ∈c
W.
Then, writing
λ(t)gλ(t)−τ = (λ(t)g′λ(t)−1)(λ(t)
.wλ(t)−τ)(λ(t)τg′′λ(t)−τ),
one deduces that limt→0 λ(t)
.wλ(t)−τ exists. Thus, limt→0(λ(λ−τ)w)(t) exists and thus λ = (λτ)w.
Since λτ ∈X∗( bT)+ we deduce λ = λτ and λw = λ.
□
The proof shows that up to replacing bG(L) ⋊WE by bG(L) ⋊Q for some ﬁnite quotient Q of
WE (as we can), semisimplicity of ϕ is equivalent to the Zariski closure of the image of ϕ being
completely reducible in the terminology of [BMR05, Section 6].
VIII.3.2. A presentation of O(Z1(WE, bG)). It will be useful to have a presentation of the
algebra O(Z1(WE, bG)), or rather of the ﬁnite type Zℓ-algebras O(Z1(WE/P, bG)) for open subgroups
P of the wild inertia (with the property that the action of WE on bG factors over WE/P). Pick a
discrete dense subgroup W ⊂WE/P as above, so that Z1(WE/P, bG) = Z1(W, bG). For any n ≥0
with a map Fn →W, we get a bG-equivariant map
O(Z1(Fn, bG)) →O(Z1(W, bG)),

284
VIII. L-PARAMETER
where the source is isomorphic to O( bGn) with appropriately twisted diagonal bG-conjugation. Con-
sider the category {(n, Fn →W)} consisting of maps from ﬁnite free groups to W, with maps given
by commutative diagrams Fn →Fm →W; this is a sifted index category (as it admits coproducts).
The map
colim(n,Fn→W) O(Z1(Fn, bG)) →O(Z1(W, bG))
is an isomorphism of algebras with bG-action (as 1-cocycles from W to bG are uniquely speciﬁed by
compatible collections of 1-cocycles Fn →bG for all Fn →W). By Haboush’s theorem on geometric
reductivity [Hab75] it follows that the map
colim(n,Fn→W) O(Z1(Fn, bG))
bG →O(Z1(W, bG))
bG
on bG-invariants is a universal homeomorphism of ﬁnite type Zℓ-algebras, and an isomorphism after
inverting ℓ.
Definition VIII.3.4. The algebra of excursion operators (for Z1(W, bG)) is
Exc(W, bG) = colim(n,Fn→W) O(Z1(Fn, bG))
bG.
We see in particular that the geometric points of Exc(W, bG) and Z1(W, bG) agree.
Actually, the following higher-categorical variant is true.
Proposition VIII.3.5. Working in the derived ∞-category D(Zℓ), the map
colim(n,Fn→W) O(Z1(Fn, bG)) →O(Z1(W, bG))
is an isomorphism.
Proof. The left-hand side deﬁnes an animated Zℓ-algebra, in fact the universal animated Zℓ-
algebra A with a condensed 1-cocycle W →bG(A), and the right-hand side is given by π0A. Now
the deformation-theoretic arguments from the proof of Theorem VIII.1.3 show that A is a derived
complete intersection, but as π0A has the correct dimension, we get A = π0A.
□
We will later prove an even ﬁner version, incorporating the bG-action; we defer the proof to
Section VIII.5.
Theorem VIII.3.6. Assume that ℓis a very good prime for bG. Then the map
colim(n,Fn→W) O(Z1(Fn, bG)) →O(Z1(W, bG))
is an isomorphism in the presentable stable ∞-category Ind Perf(B bG).
In particular, the map
Exc(W, bG) = colim(n,Fn→W) O(Z1(Fn, bG))
bG →O(Z1(W, bG))
bG
is an isomorphism.
In particular, we see that the algebra of excursion operators plays a central role. In the next
subsection, we analyze it more explicitly.

VIII.3. THE COARSE MODULI SPACE
285
VIII.3.3. The algebra of excursion operators. Fix a ﬁnite quotient Q of WE over which
the WE-action on bG factors. Let ( bG ⋊Q)n  bG be the quotient of ( bG ⋊Q)n under simultaneous
conjugation by bG.
Proposition VIII.3.7. The algebra of excursion operators Exc(W, bG) is the universal Zℓ-
algebra A equipped with maps
Θn : O(( bG ⋊Q)n  bG) →Map(W n, A)
for n ≥1, linear over O(Qn) →Map(W n, A), subject to the following relations. If g : {1, . . . , m} →
{1, . . . , n} is any map, the induced diagram
O(( bG ⋊Q)m  bG)
/

Map(W m, A)

O(( bG ⋊Q)n  bG)
/ Map(W n, A)
commutes, where both vertical maps are the natural pullback maps.
On the other hand, g also
induces a map ( bG ⋊Q)m →( bG ⋊Q)n, multiplying in every ﬁbre over i = 1, . . . , n the terms in
g−1(i) (ordered by virtue of their ordering as a subset of {1, . . . , m}). This map is equivariant
under diagonal bG-conjugation, and hence descends to the quotient. Similarly, g induces a map
W m →W n. Then also the induced diagram
O(( bG ⋊Q)n  bG)
/

Map(W n, A)

O(( bG ⋊Q)m  bG)
/ Map(W m, A)
commutes.
The ℓ-torsion free quotient of Exc(W, bG) is also the universal ﬂat Zℓ-algebra A′ equipped with
maps
Θ′
n : O(( bG ⋊Q)n  bG) →Map((WE/P)n, A′)
for n ≥1, linear over O(Qn) →Map((WE/P)n, A′), satisfying the same relations as in Propo-
sition VIII.3.7, where the right-hand side Map((WE/P)n, A′) denotes the maps of condensed sets
(where as usual A′ is considered as relatively discrete over Zℓ). In particular, the ℓ-torsion free
quotient of Exc(W, bG) is independent of the discretization W of WE/P.
We do not know whether it is necessary to pass to the ℓ-torsion free quotient for the ﬁnal
assertion. Note that if ℓis very good for bG, then Exc(W, bG) ∼= O(Z1(WE/P, bG)) bG is ﬂat over Zℓ.
Moreover note that the ℓ-torsion in Exc(W, bG) is always nilpotent, so passing to this quotient is a
universal homeomorphism.
Proof. The datum of the Θn is equivalent the datum of a map of algebras
O(Z1(Fn, bG))
bG →A
for each map Fn →W.
The relations encode the relations arising in the diagram category
(n, Fn →W) corresponding to maps Fm →Fn (over W) either sending generators to generators, or

286
VIII. L-PARAMETER
multiplying subsets of generators. If one would also allow the inversion of elements, then this would
generate all required relations. We leave it as an exercise to see that this relation, corresponding
to Fn →Fn which is the identity on the ﬁrst n −1 generators and inverts the n-th generator, is
in fact enforced by the others. (Hint: Look at the part of Θn+1 corresponding to (γ1, . . . , γn, γ−1
n )
and use that under multiplication of the last two variables, this maps to (γ1, . . . , γn−1, 1), which
arises from (γ1, . . . , γn−1).)
The second description is a priori stronger as Map((WE/P)n, A′) injects into Map(W n, A′) as
W ⊂WE/P is dense. The ℓ-torsion free quotient of Exc(W, bG) injects into O(Z1(WE/P, bG)) bG (as
we have an isomorphism after inverting ℓ), and it is clear that the elements of Map(W n, Exc(W, bG))
map to elements of Map((WE/P)n, O(Z1(WE/P, bG)) bG).
Thus, this already happens on the ℓ-
torsion free quotient of Exc(W, bG), which thus has the desired universal property.
□
Regarding the passage to WE in place of WE/P, where there is no natural (ﬁnite type) algebra
anymore, we still have the following result.
Proposition VIII.3.8. Let L be an algebraically closed ﬁeld over Zℓ. Then the following are
in canonical bijection.
(i) Semisimple L-parameters ϕ : WE →bG(L) ⋊WE, up to bG(L)-conjugation.
(ii) L-valued points of Z1(WE, bG)  bG.
(iii)) Collections of maps of Zℓ-algebras
Θn : O(( bG ⋊Q)n  bG) →Map(W n
E, L)
for n ≥1, linear over O(Qn) →Map(W n
E, L), such that for any map g : {1, . . . , m} →{1, . . . , n},
the diagrams
O(( bG ⋊Q)m  bG)
Θm /

Map(W m
E , L)

O(( bG ⋊Q)n  bG)
Θn / Map(W n
E, L)
induced by pullback, and
O(( bG ⋊Q)n  bG)
Θn /

Map(W n
E, L)

O(( bG ⋊Q)m  bG)
Θm / Map(W m
E , L)
induced by multiplication, commute.
Proof. We already know that (i) and (ii) are in natural bijection. The recipe above gives a
canonical map from (ii) to (iii). Now take data as in (iii). Forgetting the continuity of all maps,
we see that data as in (iii) gives rise to a semisimple 1-cocycles ϕ : WE →bG(L) (of discrete
groups), up to conjugation. We need to see that if the data in (iii) are maps of condensed sets,
then ϕ is also a map of condensed sets (this condition does not depend on the representative of its
conjugacy class). Consider the corresponding map ϕ′ : WE →bG(L) ⋊Q and let Z ⊂bGL ⋊Q be

VIII.4. EXCURSION OPERATORS
287
the Zariski closure of its image; by semisimplicity, Z is completely reductive. We can ﬁnd ﬁnitely
many elements γ1, . . . , γn ∈WE such that Z is also the normalizer of the ϕ′(γi). By a theorem
of Richardson [Ric88], see [BMR05, Corollary 3.7] in the positive characteristic case, it follows
that the orbit of (ϕ′(γ1), . . . , ϕ′(γn)) under simultaneous bG-conjugation is closed. Moreover, for
any further element γ, the bG-orbit of (ϕ′(γ1), . . . , ϕ′(γn), ϕ′(γ)) maps isomorphically to the bG-orbit
of (ϕ′(γ1), . . . , ϕ′(γn)) as both are given by bG/Z. It follows that ϕ′(γ) ∈bG(L) ⋊Q is determined
uniquely by the condition that (ϕ′(γ1), . . . , ϕ′(γn), ϕ′(γ)) lies in the correct bG-orbit (which is closed).
This is determined by the map
O(( bG ⋊Q)n+1  bG) →Map(W n+1
E
, L)
when evaluated at (γ1, . . . , γn, γ). As we required this to be a map of condensed sets, the result
follows.
□
VIII.4. Excursion operators
One can use Proposition VIII.3.8 to construct L-parameters in the following general categorical
situation. In order to avoid topological problems, we work in the setting of the discrete subgroup
W ⊂WE/P; in fact, we can take here any discrete group W. Let Λ be a discrete Zℓ-algebra and
let C be a Zℓ-linear category. Assume that functorially in ﬁnite sets I, we are given a monoidal
RepZℓ(QI)-linear functor
RepZℓ( bG ⋊Q)I →End(C)BW I : V 7→TV
where End(C) is the category of endomorphisms of C, and End(C)BW I
E is the category of F ∈End(C)
equipped with a map of groups W I →Aut(F).
The goal of this section is to prove the following theorem; this is essentially due to V. Laﬀorgue
[Laf18].
Theorem VIII.4.1. Given the above categorical data, there is a natural map of algebras
Exc(W, bG) = colim(n,Fn→W) O(Z1(Fn, bG))
bG →End(idC)
to the Bernstein center of C (i.e., the algebra of endomorphisms of the identity of C).
To prove Theorem VIII.4.1, we construct explicit “excursion operators”. These are associated
to the following data.
Definition VIII.4.2. An excursion datum is a tuple D = (I, V, α, β, (γi)i∈I) consisting of a
ﬁnite set I, an object V ∈RepZℓ(( bG ⋊Q)I) with maps α : 1 →V |RepZℓ( bG), β : V |RepZℓ( bG) →1 and
elements γi ∈W, i ∈I.
Here, the restriction RepZℓ(( bG ⋊Q)I) →RepZℓ( bG) is the restriction to the diagonal copy of
bG ⊂bGI ⊂( bG ⋊Q)I.
Now consider excursion data D = (I, V, α, β, (γi)i∈I). These give rise to an endomorphism of
the identity functor of C, as follows.
SD : id = T1
Tα
−→TV
(γi)i∈I
−−−−→TV
Tβ
−→T1 = id.

288
VIII. L-PARAMETER
Varying the γi, this gives a map of groups
W I →Aut(idC)
to the automorphisms of the identity functor on C.
We note that if we have two excursion data D = (I, V, α, β, (γi)i∈I) and D′ = (I, V ′, α′, β′, (γi)i∈I)
with same ﬁnite set I and elements γi ∈W, and a map g : V →V ′ taking α to α′ and β′ to β (by
post- and pre-composition), then SD = SD′. Indeed, the diagram
T1
Tα / TV
(γi)i∈I/
Tg

TV
Tβ
/
Tg

T1
T1
Tα′ / TV ′
(γi)i∈I/ TV ′
Tβ′
/ T1
commutes. Now note that (V, α, β) give rise to an element
f = f(V, α, β) ∈O( bG\( bG ⋊Q)I/ bG),
the quotient under diagonal left and right multiplication. Indeed, given any gi ∈bG ⋊Q, i ∈I, one
can form the composite
1 α−→V
(gi)i∈I
−−−−→V
β−→1,
giving an element of the base ring; as α and β are equivariant for the diagonal bG-action, this indeed
gives an element
f = f(V, α, β) ∈O( bG\( bG ⋊Q)I/ bG).
Conversely, given f we can look at the ( bG⋊Q)I-representation V = Vf ⊂O(( bG⋊Q)I/ bG) generated
by f. This comes with a map αf : 1 →Vf|RepZℓ( bG) induced by the element f, and a map βf :
Vf|RepZℓ( bG) →1 given by evaluation at 1 ∈( bG ⋊Q)I. If we replace V by the subrepresentation
generated by α, then there is a natural map V →Vf taking α to αf and βf to β. The above
commutative diagrams then imply that SD depends on (V, α, β) only through f, and we get a map
(a priori, of Zℓ-modules)
ΘI : O( bG\( bG ⋊Q)I/ bG) →Map(W I, End(idC)).
Restricted to O(QI), this is given by the natural map O(QI) →Map(W I, Λ) (and Λ →End(idC)).
Also, it follows from the deﬁnitions that for any map g : I →J, the diagram
O( bG\( bG ⋊Q)I/ bG)
ΘI /

Map(W I, End(idC))

O( bG\( bG ⋊Q)J/ bG)
ΘJ / Map(W J, End(idC)),
induced by pullback along g, is cartesian.
We want to check that ΘI is a map of algebras. For this, we use a version of “convolution
product = fusion product” in this situation. Namely, given f1, f2 ∈O( bG\( bG ⋊Q)I/ bG), we can
build their exterior product f1 ⊠f2 ∈O( bG\( bG ⋊Q)I⊔I/ bG). Then one easily checks
ΘI⊔I(f1 ⊠f2)((γi, γ′
i)i∈I) = ΘI(f1)((γi)i∈I)ΘI(f2)((γ′
i)i∈I).

VIII.5. MODULAR REPRESENTATION THEORY
289
Applying now functoriality for pullback under I ⊔I →I, it follows that indeed ΘI(f1f2) =
ΘI(f1)ΘI(f2).
For any n ≥0, we can identify
O( bG\( bG ⋊Q){0,...,n}/ bG) ⊗O(Q{0,...,n}) O(Q{1,...,n}) ∼= O(( bG ⋊Q)n  bG)
via pullback under (g1, . . . , gn) 7→(1, g1, . . . , gn). This translates Θ{0,...,n} into maps of Zℓ-algebras
Θn : O(( bG ⋊Q)n  bG) →Map(W n, End(idC))
over O(Qn) →Map(W n, Λ), still satisfying compatibility with pullback under maps g : {1, . . . , m} →
{1, . . . , n}.
Arguing also as in [Laf18, Lemma 10.1, equation (10.5)] and the resulting [Laf18, Proposition
10.8 (iii), Deﬁnition-Proposition 11.3 (d)], one sees that the maps Θn are also compatible with the
multiplication maps induced by such maps g, thus ﬁnishing the proof of Theorem VIII.4.1.
In particular, using the description of geometric points, Theorem VIII.4.1 implies the following
proposition.
Corollary VIII.4.3. Assume that Λ = L is an algebraically closed ﬁeld and X ∈C is an object
with End(X) = L. Then there is, up to bG(L)-conjugation, a unique semisimple L-parameter
ϕX : W →bG(L) ⋊W
such that for all excursion data D = (I, V, α, β, (γi)i∈I), the endomorphism SD(X) ∈End(X) = L,
X = T1(X) α−→TV (X)
(γi)i∈I
−−−−→TV (X)
β−→T1(X) = X,
is given by the composite
L α−→V
(ϕX(γi))i∈I
−−−−−−−→V
β−→L.
VIII.5. Modular representation theory
The goal of this section is to give a proof of Theorem VIII.3.6.
In fact, we prove a slight
reﬁnement of it, concerning perfect complexes, that will be useful in the construction of the spectral
action.
Theorem VIII.5.1. Assume that ℓis a very good prime for bG. Then the map
colim(n,Fn→W) O(Z1(Fn, bG)) →O(Z1(W, bG))
is an isomorphism in the presentable stable ∞-category Ind Perf(B bG). Moreover, the ∞-category
Perf(Z1(W, bG)/ bG) is generated under cones and retracts by Perf(B bG), and Ind Perf(Z1(W, bG)/ bG)
identiﬁes with the ∞-category of modules over O(Z1(W, bG)) in Ind Perf(B bG).
The diﬃculties in this theorem all arise on the special ﬁbre. Indeed, we will show below that
we can reduce to the following version in characteristic ℓ.

290
VIII. L-PARAMETER
Theorem VIII.5.2. Assume that ℓis a very good prime for bG, and let L = Fℓ. Then the map
colim(n,Fn→W) O(Z1(Fn, bG)L) →O(Z1(W, bG)L)
is an isomorphism in the presentable stable ∞-category Ind Perf(B bG). Moreover, the ∞-category
Perf(Z1(W, bG)L/ bG) is generated under cones and retracts by Perf(B bG).
Then we have the following reduction:
Theorem VIII.5.2 implies Theorem VIII.5.1. For the colimit claim, we need to see that
for all representations V of bG, the map
colim(n,Fn→W) RΓ( bG, O(Z1(Fn, bG)) ⊗V ) →RΓ( bG, O(Z1(W, bG)) ⊗V )
is an isomorphism. It is an isomorphism after inverting ℓ, as then the representation theory of bG
is semisimple, and it is true on underlying complexes by Proposition VIII.3.5. Thus, it suﬃces to
show that it is an isomorphism after reduction modulo ℓ, or even after base change to L, which
follows from Theorem VIII.5.2.
For the other half, note ﬁrst that if Perf(B bG) generates Perf(Z1(W, bG)/ bG), then it follows
by Barr–Beck–Lurie [Lur16, Theorem 4.7.4.5] that Ind Perf(Z1(W, bG)/ bG) is the ∞-category of
modules over O(Z1(W, bG)) in Ind Perf(B bG). Now take any V ∈Perf(Z1(W, bG)/ bG). As its lowest
cohomology group is ﬁnitely generated, we can ﬁnd some surjection from an induced vector bundle
onto it, and by passing to cones reduce the perfect amplitude until V is a bG-equivariant vector
bundle on Z1(W, bG). We may then again ﬁnd a representation W of bG and a surjection W ⊗
O(Z1(W, bG)) →V . This map splits after inverting ℓ, showing that V is a retract of an induced
vector bundle up to a power of ℓ. Thus, it suﬃces to show that V/ℓlies in this subcategory, and
this follows from Theorem VIII.5.2.
□
Thus, we concentrate now on Theorem VIII.5.2, which takes place over an algebraically closed
base ﬁeld L of characteristic ℓ. For the proof, we need many preparations on the modular represen-
tation theory of reductive groups, for bG and many of its subgroups. As everything here happens on
the dual side but we do not want to clutter notation, we will change notation, only for this section,
and write G for reductive groups over L.
VIII.5.1. Good ﬁltrations. First, we need to recall the notion of good ﬁltrations. Let G
be a reductive group over L; as disconnected groups will appear frequently below, we stress that
reductive groups are always connected for us, so in particular G is assumed to be connected here.
Let T ⊂B ⊂G be a torus and Borel for G. For any dominant cocharacter λ of T, we have the
induced representation
∇λ = H0(G/B, O(λ)).
A representation V of G has a good ﬁltration if it admits an exhaustive ﬁltration
0 = V−1 ⊂V0 ⊂V1 ⊂. . . ⊂V
such that each Vi/Vi−1 is isomorphic to a direct sum of ∇λ’s. If one picks a total ordering 0 =
λ0, λ1, . . . of the dominant cocharacters, compatible with their dominance order, one can choose

VIII.5. MODULAR REPRESENTATION THEORY
291
Vi ⊂V to be the maximal subrepresentation admitting only weights λj with j ≤i. In that case,
(Vi/Vi−1)∗is generated by its highest weight space W ∗
i , and by adjunction there is a map
Vi/Vi−1 →Wi ⊗∇λi;
then V admits a good ﬁltration if and only if all of these maps are isomorphisms. For this, it is
in fact enough that Vi →Wi ⊗∇λi is surjective: The kernel is necessarily given by Vi−1, as it has
only smaller weights.
A key result is that if V and W admit good G-ﬁltrations, then so does V ⊗W; this is a theorem
of Donkin [Don85] and Mathieu [Mat90] in general. Moreover, if V admits a good ﬁltration, then
Hi(G, V ) = 0 for i > 0: This clearly reduces to the case of V = ∇λ, in which case it follows from
Kempf’s vanishing theorem [Kem76]. These results imply the following standard characterization
of modules admitting a good ﬁltration.
Proposition VIII.5.3 ([Don81]). A G-representation V admits a good ﬁltration if and only
if for all λ, one has
Hi(G, V ⊗∇λ) = 0
for i > 0.
Using this, one can deﬁne a well-behaved notion of a “good ﬁltration dimension” of V , referring
to the minimal i such that Hj(G, V ⊗∇λ) = 0 for all λ and j > i.
Equivalently, there is a
resolution of length i by representations with a good ﬁltration. We will use the following deep
result of Touz´e–van der Kallen [TvdK10, Corollary 1.5].
Theorem VIII.5.4. Let A be a ﬁnitely generated L-algebra with an action of G. Let M be a
G-equivariant ﬁnitely generated A-module. Then Hi(G, M) is a ﬁnitely generated AG-module for
all i ≥0. Moreover, if A has a good ﬁltration, then M has ﬁnite good ﬁltration dimension.
Another key result we need is the following.
Theorem VIII.5.5 ([Kop84], [Don88]). The G × G-representation O(G) (via left and right
multiplication) admits a good ﬁltration.
In particular, we have the following corollary. For any n ≥0, let Fn be the free group on n
letters.
Corollary VIII.5.6. For any map Fn →Aut(G), the G-representation O(Z1(Fn, G)) admits
a good ﬁltration.
Proof. Note that Z1(Fn, G) = Gn, where the G-action is that of simultaenous twisted conju-
gation (by the n given automorphisms of G). But O(Gn) admits a good ﬁltration as representation
of G2n, and restricting to G ⊂G2n it remains good by stability under tensor products (and as the
induced representations of G2n are tensor products of induced representations of each factor).
□
Another property of relevance to us is the following.
Theorem VIII.5.7 ([AJ84, 4.4]). Assume that ℓis very good for G. Then all symmetric powers
Symng∗have a good ﬁltration.

292
VIII. L-PARAMETER
VIII.5.2. Reductions. To prove Theorem VIII.5.2, we will use the following criterion.
Theorem VIII.5.8. Let X be an aﬃne scheme of ﬁnite type over L equipped with an action of
a reductive group G. Assume the following conditions.
(i) The scheme X is a local complete intersection.
(ii) For any closed G-orbit Z ∼= G/H ⊂X, the algebra O(G/H) has a good G-ﬁltration, and the
image of Perf(BG) →Perf(BH) generates under cones and retracts.
(iii) With Z as in (ii), the G-equivariant LZ/X[−1] ∈D[−1,0](O(Z)) has the property that all
Symn
O(Z)(LZ/X[−1]) ∈D[−n,0](O(Z)) have good ﬁltration dimension 0; i.e., for all induced rep-
resentations V , one has
Hi(G, Symn
O(Z)(LZ/X[−1]) ⊗V ) = 0
for i ≥1.
Then O(X) has a good G-ﬁltration, and Perf(X/G) is generated (under cones and retracts) by
Perf(BG).
Proof. To see that A = O(X) has a good ﬁltration, we need to show that for every G-
representation V with a good ﬁltration, Hi(G, V ⊗O(X)) = 0 for i > 0. Note that this cohomology
group is a ﬁnitely generated AG-module by Theorem VIII.5.4. If it is not zero, pick some closed
point of Spec AG in its support, and let Z ⊂X be the corresponding closed G-orbit. There is
a (derived) ﬁltration I• ⊂A such that I0 = A, I1 is the ideal of Z, and in general In/LIn+1 ∼=
Symn
O(Z)(LZ/X[−1]). Indeed, if X was smooth, we could simply take the ﬁltration by powers of
the ideal I. In general, we may pick a G-equivariant simplicial resolution of A by smooth algebras,
and totalize the corresponding ﬁltrations. Consider the G-equivariant animated A-algebra
eA =
M
n∈Z
In
where by deﬁnition In = A for n ≤0. (Again, this can be deﬁned by passage to G-equivariant
smooth resolutions.) Let t ∈eA be the generator in degree −1. Then
eA/Lt =
M
n≥0
In/LIn+1 =
M
n≥0
Symn
O(Z)(LZ/X[−1])
has good ﬁltration dimension ≤0. We also note that it is concentrated in a bounded range of
degrees, bounded by the number of generators for the ideal deﬁning the (local) complete intersection
A. This implies that for any V with a good G-ﬁltration, Hi(G, V ⊗eA) are coherent H0(G, eA)-
modules whose reduction modulo t vanishes for i > 0. Moreover, after inverting t, one has eA[t−1] =
A[t±1]. Thus, the support of Hi(G, V ⊗eA) in Spec H0(G, eA) contains Spec O(Z)[t±1]. As it is
closed, it contains the spectrum of L
n≤0(A/I)G = O(Z)[t], and thus meets the locus t = 0, in
contradiction to its vanishing modulo t. We note that it follows now that also eA has good ﬁltration
dimension ≤0, as all Hi(G, V ⊗eA) vanish after inverting t and after reduction modulo t.
Now we prove that Perf(X/G) is generated by Perf(BG).
Given N ∈Perf(Spec A/G), let
i ∈Z be maximal such that Hi(N) ̸= 0. We may pick a G-representation V with a map V [−i] →
N|Perf(BG) so that A ⊗ZℓV [−i] →N has the property that the induced map on Hi is surjective.

VIII.5. MODULAR REPRESENTATION THEORY
293
Passing to the ﬁbre, we may then induct on the perfect amplitude of N to reduce to the case that
N = M[0] is a vector bundle.
Now we use the theorem of Touz´e–van der Kallen, Theorem VIII.5.4, which ensures that M
has ﬁnite good ﬁltration dimension, i.e. there is some integer i such that for all λ and all j > i
one has Hj(G, M ⊗∇λ) = 0 for j > i. By Proposition VIII.5.9, when we choose V above, we can
assume that V ∗admits a good ﬁltration. Choosing such a V for N = M∗[0], we can thus ﬁnd a
strict injection M →A ⊗V ∗of vector bundles such that V ∗admits a good ﬁltration. Passing to
the cokernel then decrases the good ﬁltration dimension of M, and we can reduce to the case that
M has a good ﬁltration.
We have a G-equivariant resolution
. . . →A ⊗A ⊗M →A ⊗M →M
of G-equivariant A-modules, which is canonically split in Ind Perf(BG). The class of all M for
which this is a resolution in Ind Perf(X/G) is exactly the class of all M generated under cones
and retracts by Perf(BG) – in one direction, it is a resolution in Ind Perf(X/G) when M arises via
pullback from BG (as it can then be split), and thus for all M generated by Perf(BG). In the other
direction, if it is a resolution in Ind Perf(X/G), then it follows that M is generated by Perf(BG)
as all other terms arise via pullback from BG. Now note that this is a resolution in Ind Perf(X/G)
if and only if for all N ∈Perf(X/G), which we may again assume to be a G-equivariant ﬁnite
projective A-module with a good G-ﬁltration, the complex
. . . →(N ⊗A ⊗M)G →(N ⊗M)G →(N ⊗A M)G →0
is exact, and Hi(G, N ⊗AM) = 0 for i > 0. (Note that all terms N ⊗M, N ⊗A⊗M etc. have a good
G-ﬁltration, hence there is no higher G-cohomology.) In particular, these observations show that
if M has a good ﬁltration and lies in the full subcategory of Perf(X/G) generated by Perf(BG),
then for all G-equivariant ﬁnite projective A-modules N with a good ﬁltration, also M ⊗A N has
a good G-ﬁltration.
We note that the previous arguments also apply in case A = O(Z) for an orbit Z as in (ii),
in which case the assumption of (ii) implies that for two G-equivariant O(Z)-perfect complexes
M1, M2 ∈Perf(Spec O(Z)/G) with G-good ﬁltration dimension ≤0, also their tensor product is of
G-good ﬁltration dimension ≤0.
Coming back to a general G-equivariant ﬁnite projective A-module M, we can now ﬁnd some
large enough V ⊂M with a good ﬁltration inducing a surjection A ⊗V →M. Moreover, as
(M ⊗L[G/U])G is ﬁnitely generated over (A ⊗L[G/U])G (for example, by Theorem VIII.5.4), we
can even ensure that the map stays surjective after tensoring with L[G/U] = L
λ ∇λ and taking
G-invariants. This implies that the kernel M′ of A ⊗V →M still has a good ﬁltration.
In other words, we can ﬁnd an inﬁnite resolution
. . . →A ⊗V1 →A ⊗V0 →M →0
such that all Vi are G-representations with a good ﬁltration, and the kernel Mi of A⊗Vi →A⊗Vi−1
is always a G-equivariant ﬁnite projective A-module that admits a good ﬁltration. In particular, it
is a resolution in Ind Perf(BG). It suﬃces to see that this is in fact a resolution in Ind Perf(X/G).
To see this, we need to see that for any N ∈Perf(X/G), which we may assume to be a G-equivariant

294
VIII. L-PARAMETER
vector bundle admitting a good G-ﬁltration, also the complex
. . . →N ⊗V1 →N ⊗V0 →N ⊗A M →0
is a resolution in Ind Perf(BG). We note that this is automatic if N ⊗A Mi has a good G-ﬁltration
for all i.
Now assume that for any closed point x of Spec AG, with localization (AG)x at x, that M ⊗AG
AG
x ∈Perf(Spec(A ⊗AG AG
x )/G) is generated by Perf(BG). Then in particular, also Mi ⊗AG AG
x is
generated by Perf(BG), and hence N ⊗A Mi ⊗AG AG
x has a good G-ﬁltration. This then implies
that the AG-module H>0(G, N ⊗A Mi ⊗V ) vanishes locally on Spec AG for any representation V
with good G-ﬁltration, and hence vanishes, thus showing that N ⊗A Mi has a good G-ﬁltration.
By the above, this then implies that M is also globally generated by Perf(BG).
We can thus work locally on Spec AG, and we ﬁx a closed point, corresponding to a closed
G-orbit Z ⊂X. With
eA =
M
n∈Z
In
as above, which we endow with an action of eG = G × Gm (where Gm acts via the grading), we
consider eG-equivariant ﬁnite projective eA-module f
M = M ⊗A eA. By Theorem VIII.5.4, the O(Z)-
module M ⊗A A/I has ﬁnite good ﬁltration dimension, and as all In/LIn+1 have good ﬁltration
dimension ≤0, it follows that f
M/t = L
n≥0(M ⊗A A/I) ⊗A/I In/LIn+1 has ﬁnite good ﬁltration
dimension. By ﬁnite generation arguments on cohomology groups, this then also implies that f
M
has ﬁnite good ﬁltration dimension. Arguing as for the A-module M, we can then ﬁrst arrange
that f
M has good ﬁltration dimension ≤0, and then ﬁnd V0, V1, . . . ∈Perf[−1,0](BG) with good
ﬁltration dimension ≤0 such that
. . . →eA ⊗V1 →eA ⊗V0 →f
M →0
is a resolution in Ind Perf(B eG), with the limit f
Mi of [ eA ⊗Vi →eA ⊗Vi−1 →. . . →f
M] being a
eG-equivariant ﬁnite projective eA-module with good ﬁltration dimension ≤0. Reducing modulo t,
the sequence
. . . →eA/t ⊗V1 →eA/t ⊗V0 →f
M/t →0
is a resolution in Ind Perf(Spec( eA/t)/G), as in fact f
M/t = (M ⊗AA/I)⊗A/I eA/t lies in the subcate-
gory generated by Perf(BG), as this is true for M ⊗AA/I ∈Perf(Z/G) = Perf(BH) by assumption
(ii). Indeed, reversing some arguments above, this implies that for all G-equivariant ﬁnite projective
eA/t-modules N with good ﬁltration dimension ≤0, also N ⊗e
A/t f
Mi/t has good ﬁltration dimension
≤0, which gives that the displayed resolution is indeed a resolution in Ind Perf(Spec( eA/t)/G).
Now consider any e
N ∈Perf(Spec eA/ eG). We are interested to what extent
. . . →( e
N ⊗V1)G →( e
N ⊗V0)G →( e
N ⊗e
A f
M)G →0
is a resolution.
All the cohomology groups are ﬁnitely generated H0(G, eA)-modules, and their
reduction modulo t vanishes. This implies, as above, that their support is disjoint from the eG-orbit
Spec O(Z)[t±1] →Spec eA (as the closure of this orbit meets the ﬁbre t = 0).

VIII.5. MODULAR REPRESENTATION THEORY
295
We can apply this in particular to e
N = N ⊗A eA for some G-equivariant ﬁnite projective A-
module with good ﬁltration. Inverting t in the above sequence, we get the complex
. . . →(N ⊗V1)G[t±1] →(N ⊗V0)G[t±1] →(N ⊗A M)G[t±1] →0
such that the support of its cohomology groups is disjoint from Spec O(Z)[t±1]. In other words, we
get that
. . . →(N ⊗V1)G ⊗AG AG
x →(N ⊗V0)G ⊗AG AG
x →(N ⊗A M)G ⊗AG AG
x →0
is exact, which implies that
. . . →A ⊗AG AG
x ⊗V1 →A ⊗AG AG
x ⊗V0 →M ⊗AG AG
x →0
is a resolution in Ind Perf(Spec(A ⊗AG AG
x )/G). (Note that we can repeat the arguments after
replacing AG by some localization of it, and N there.) In particular, M ⊗AG AG
x ∈Perf(Spec(A⊗AG
AG
x )/G) is generated by Perf(BG). As we discussed above, this result for all closed points x ∈
Spec AG gives the claim.
□
Proposition VIII.5.9. Let V be a representation of G. Then there is a surjection W →V
such that W ∗admits a good ﬁltration.
Proof. We can look at the subcategory of Rep(G) where all weights are within some ﬁnite
set (closed under the dominance order). It is well-known that this category admits a projective
generator P, and the projective generator has the property that its dual P ∗has a good ﬁltration;
this follows for example from H1(G, P ∗⊗Zℓ∇λ) = Ext1(P, ∇λ) = 0 for all relevant ∇, and the
characterization of Proposition VIII.5.3. This implies the proposition.
□
To produce examples of algebras satisfying Theorem VIII.5.8, we will use the following propo-
sition.
Proposition VIII.5.10. Let A• →A be a G-equivariant simplicial resolution of algebras of ﬁ-
nite type over L equipped with an action of G, such that A and all A• are local complete intersections.
Assume that Ai has a good G-ﬁltration for all i, and that for all closed orbits Z ∼= G/H ⊂Spec A,
O(Z) admits a good G-ﬁltration and the image of Perf(BG) →Perf(BH) generates under cones
and retracts. Moreover, assume that for all i ≥0 and n ≥0,
Symn(LZ/ Spec Ai[−1]) ∈Perf(O(Z)/G)
has good ﬁltration dimension ≤0, and that for varying i, LZ/ Spec Ai ∈Perf(O(Z)/G) = Perf(BH)
involves only ﬁnitely many irreducible representations of H. Then the map
colim A• →A
is an isomorphism in Ind Perf(BG), and for all n ≥0 the map
colim Symn(LZ/ Spec A•[−1]) →Symn(LZ/ Spec A[−1]) ∈Perf(O(Z)/G)
is an isomorphism, so the right-hand side has good ﬁltration dimension ≤0.
Proof. First, note that the map
colim LZ/ Spec A• →LZ/ Spec A,

296
VIII. L-PARAMETER
which is necessarily an isomorphism in D(L), is also an isomorphism in Ind Perf(O(Z)/G) =
Ind Perf(BH) as it involves only ﬁnitely many irreducible representations of H. Similarly,
colim Symn(LZ/ Spec A•[−1]) →Symn(LZ/ Spec A[−1])
is an isomorphism in Ind Perf(O(Z)/G), and in particular in Ind Perf(BG). As all terms on the left
have good ﬁltration dimension ≤0, this implies that also Symn(LZ/ Spec A[−1]) has good ﬁltration
dimension ≤0.
In particular, Theorem VIII.5.8 implies that A has a good G-ﬁltration. It remains to see that
colim A• →A
is an isomorphism in Ind Perf(BG).
Equivalently, for any representation V of G with a good
ﬁltration, the map
colim(A• ⊗V )G →(A ⊗V )G
is an isomorphism.
Assume ﬁrst that V = L is trivial. Then AG
• is a simplicial ﬁnite type L-algebra, and thus its
colimit B is an animated L-algebra that is almost of ﬁnite type; in other words, π0B is a ﬁnite
type L-algebra, and πiB is a ﬁnitely generated π0B-module for i > 0. Moreover, it follows from
Haboush’s theorem that the map π0B →AG is a universal homeomorphism. Thus, if the map
B →AG is not an isomorphism, the homotopy groups of its cone are ﬁnitely generated π0B-
algebras, and we can take some closed point of Spec π0B ∼= Spec AG in its support, corresponding
to some closed G-orbit Z ∼= G/H ⊂Spec A.
We can then form eA and eA• as in the proof of
Theorem VIII.5.8, and look at the map
colim eAG
• →eAG.
Again, the homotopy groups of the cone are ﬁnitely generated, and so as in the proof of Theo-
rem VIII.5.8 it suﬃces to show that it is an isomorphism after reduction modulo t. But modulo t,
we get eAi/t = L
n≥0 Symn(LZ/ Spec Ai[−1]) and similarly for eA/t, and the claim follows from the
ﬁrst paragraph of the proof.
To see that for all V with a good ﬁltration, the map
colim(A• ⊗V )G →(A ⊗V )G
is an isomorphism, we note that now both sides are in D≤0(AG) with ﬁnitely generated cohomology
groups. We can then pick Z as before, and reduce to showing that
colim( eA• ⊗V )G →( eA ⊗V )G
is an isomorphism after reduction modulo t, where it follows again from the direct sum decompo-
sition of eA•/t and eA/t.
□
VIII.5.3. Fixed point groups. We will need to know some properties of the ﬁxed points
H = GF of reductive groups G under a (ﬁnite) group F of automorphisms of G. These will in
general not stay connected, so to facilitate inductive arguments, we will also not assume that G is
connected here. We will, however, usually make the assumption that π0G is of order prime to the
characteristic ℓof the base ﬁeld, and we will also assume that F is of order prime to ℓ.
First, we have the following structural result.

VIII.5. MODULAR REPRESENTATION THEORY
297
Proposition VIII.5.11. Let L be an algebraically closed ﬁeld of characteristic ℓ> 0, and let
G be a smooth linear algebraic group over L such that G◦is reductive and π0G is of order prime
to ℓ. Assume that F is a ﬁnite group of order prime to ℓacting on G and let H = GF be the ﬁxed
points. Then H is a smooth linear algebraic group, H◦is reductive, and π0H is of order prime to
ℓ.
We note that our proof of the last part of this proposition probably uses unnecessarily heavy
machinery. Under the assumption that F is solvable, we will later give a completely explicit proof.
Proof. It is a standard fact that the ﬁxed points of a smooth aﬃne scheme under a ﬁnite
group of order prime to the characteristic is still aﬃne and smooth. Moreover, by [PY02, Theorem
2.1], H◦is reductive.
For the ﬁnal statement, we can ﬁrst assume that G is connected (as π0G is of order prime
to ℓ), and thus reductive.
We consider the action of G on Q
F G, where it acts on the factor
enumerated by Θ ∈F through Θ-twisted conjugation. Note that O(Q
F G) has a good G-ﬁltration.
By Theorem VIII.5.4, for any G-equivariant ﬁnitely generated O(Q
F G)-module M, the good
ﬁltration dimension of M is ﬁnite, and in particular Hi(G, M) = 0 for all large enough i.
Now G/H is a closed orbit of G acting on Q
F G (the orbit of the identity element). Moreover,
if π0H has an element of order ℓ, then we get a subgroup H′ ⊂H with π0H′ ∼= Z/ℓZ. In that case,
RΓ(G, O(G/H′)) ∼= RΓ(H′, L) ∼= RΓ(Z/ℓZ, L)
has cohomology in all positive degrees, while O(G/H′) correponds to a G-equivariant coherent
sheaf on Q
F G (equipped with its Θ-conjugation), so this contradicts the previous paragraph.
□
We will also need the following result.
Proposition VIII.5.12. In the situation of Proposition VIII.5.11, assume that the simply con-
nected cover G′ of G◦
der has the property that all Symng′∗have a good G′-ﬁltration. Then O(G/H)
has a good G-ﬁltration.
We recall that the assumption on symmetric powers of g′∗is satisﬁed for all ℓin type A, for
all ℓ̸= 2 in classical types, for all ℓ̸= 2, 3 in exceptional types except for E8, where one needs
ℓ̸= 2, 3, 5.
Remark VIII.5.13. The result reduces easily to the case that G is connected, semisimple
and simply connected. In that case, the result is related, but apparently somewhat weaker, than
the assertion that H◦⊂G is a Donkin subgroup, meaning that for any representation V of G
with a good G-ﬁltration, its restriction to H◦has a good H◦-ﬁltration; here we only prove that
Hi(H◦, V ) = 0 for i > 0. This stronger statement that H◦⊂G is a Donkin subgroup is actually
known in most cases, at least when F is solvable so that one can reduce to automorphisms of
prime order. In particular, involutions are handled completely in [Bru98, Section 2], [vdK01],
and the (few) remaining cases are mostly done in [HM13, Theorem 4.3.3]. In particular, assuming
F solvable, one can show this way that the conclusion of the proposition is true for all ℓin classical
types or G2. The missing cases are the centralizers of semisimple elements of order 3 in F4, E6 and
E7, and of order 3 and 5 in E8. These cases are not handled for small ℓin [HM13, Theorem 4.3.3].

298
VIII. L-PARAMETER
Proof. We need to see that for all G-representations V with a good ﬁltration, one has
Hi(G, O(G/H) ⊗V ) = 0 for i > 0. This translates into Hi(H, V |H) = 0 for i > 0. The lat-
ter can be checked after replacing H by H◦
der (as π0H is of order prime to ℓ), or even a ﬁnite cover
of it. From these remarks, one sees that one can assume that G is connected, semisimple and simply
connected.
As in the proof of Proposition VIII.5.11, we can embed G/H into Q
F G. Moreover, F acts in
the following way on Q
F G: It takes a tuple (gf)f∈F to (gff′f(gf′)−1)f. This action commutes with
the simultaneous twisted G-conjugation. Moreover, the ﬁxed points of F are exactly the 1-cocycles
Z1(F, G) ⊂Q
F G, with their G-conjugation. The map G/H ,→Z1(F, G) is the inclusion of a
connected component. Note that
LQ
F G|Z1(F,G) →LZ1(F,G)
is a map of G-equivariant vector bundles on Z1(F, G), and it moreover carries a commuting F-
action, where the target is the F-orbits of the source. As F is of order prime to ℓ, it follows that
the map splits. In particular, restricting to G/H, we see that
LQ
F G|G/H →LG/H
splits G-equivariantly. Using the transitivity triangle, it follows that if I ⊂O(Q
F G) is the ideal
sheaf of G/H, then I/I2 is a G-equivariant direct summand of LQ
F G|G/H. Note that G-equivariant
vector bundles on G/H are equivalent to representations of H, and LQ
F G|G/H corresponds to the
representation L
F g∗|H.
Taking symmetric powers, it follows that for all n, In/LIn+1 is a G-
equivariant direct summand of the G-equivariant vector bundle on G/H corresponding to a direct
sum of copies of Symng∗|H.
Now let A = O(Q
F G) with its G-action and F-action and G- and F-stable ideal I ⊂A. We
consider the complex
. . . →A⊗F 2 →A⊗F →A →O(Z1(F, G)) →0
computing the F-orbits on A, in the sense of animated L-algebras. This still computes O(Z1(F, G)),
as F is of order prime to ℓand A is smooth. Let A• = A⊗F • be the corresponding simplicial L-
algebra, with ideal I• ⊂A• of G/H. Let
eA• =
M
n∈Z
eIn
• ,
where eIn
• = A• for n ≤0. This deﬁnes a simplicial L[t]-algebra, where t is the natural degenerator
in degree −1. Then eA•[t−1] = A•[t±1] and eA•/t is the symmetric algebra on eI•/eI2
• over O(G/H).
In particular, this is a resolution of O(G/H), and in fact eA• is a resolution of O(G/H)[t].
Note that the good ﬁltration dimension of each eAn is bounded by the good ﬁltration dimension
of O(G/H) plus 1. To see this, note that eAn[t−1] = An[t±1] has a good ﬁltration, so it is enough
to show that the good ﬁltration dimension of eAn/t is bounded by the good ﬁltration dimension of
O(G/H). This is because all symmetric powers of eIn/eI2
n are direct summands of direct sums of
copies of symmetric powers of g∗restricted to H. We checked this for n = 0, but for n > 0 one
simply gets more copies of g∗(or applies the reasoning with F replaced by F n+1).

VIII.5. MODULAR REPRESENTATION THEORY
299
We claim that for all G-representations V , the map
colim RΓ(G, eA• ⊗V ) →RΓ(G, O(G/H)[t] ⊗V )
is an isomorphism.
Consider the simplicial L-algebra eAG
• , and its colimit B, an animated L-
algebra (with π0B ﬁnitely generated, and all πiB ﬁnitely generated π0B-modules). Then for all
i, Hi(G, eA• ⊗V ) deﬁnes a degree-wise ﬁnitely generated eAG
• -module (by Theorem VIII.5.4), and
hence its colimit deﬁnes an animated B-module whose πj is ﬁnitely generated over π0B, for all j.
By the good ﬁltration bounds, we also know that these cohomology groups vanish for i suﬃciently
large. This implies that each cohomology group of the left-hand side is ﬁnitely generated over π0B.
Moreover, by Haboush’s theorem, the map π0B →O(G/H)[t] is a universal homeomorphism, and
hence also the right-hand side is ﬁnitely generated over π0B. In particular, the cohomology groups
of the cone have support which is a closed G-invariant subset of Spec π0B ∼= Spec O(G/H)[t]. All
in all, it follows that it suﬃces to prove that the map is an isomorphism modulo t. But modulo t,
we consider
colim RΓ(G, eA•/t ⊗V ) →RΓ(G, O(G/H) ⊗V )
and all eA•/t are given by the symmetric algebras on eI•/eI2
• over O(G/H), and hence everything
decomposes into a direct sum over n of the degree n parts. In degree 0, it is the constant simplicial
object given by O(G/H). In degree 1, the corresponding simplicial G-equivariant O(G/H)-module
eI•/eI2
•
is contractible, as it comes from some computation of F-homology, and F is of order prime to
ℓ. Passing to symmetric powers, the simplicial objects stay contractible, and stay so after taking
G-cohomology.
Inverting t, we ﬁnd that
colim RΓ(G, A• ⊗V )[t±1] →RΓ(G, O(G/H) ⊗V )[t±1]
is an isomorphism; we can then omit the variable t. Applying this to V with a good ﬁltration,
we note that all A• have a good G-ﬁltration, hence so does A• ⊗V , and the left-hand side sits in
cohomological degrees ≤0. Thus, the same is true for the right-hand side, showing that O(G/H)
has a good G-ﬁltration.
□
We will need to know that in the situation of Proposition VIII.5.11, the image of Perf(BG) →
Perf(BH) generates (under cones and retracts), at least if F is solvable. It is very likely that this
assumption is superﬂuous.
Theorem VIII.5.14. Let L be an algebraically closed ﬁeld of characteristic ℓ> 0, and let G be
a smooth linear algebraic group over L such that G◦is reductive, and π0G is of order prime to ℓ.
Assume that F is a ﬁnite group of order prime to ℓacting on G and let H = GF be the ﬁxed points.
Then H is a smooth linear algebraic group such that H◦is reductive, π0H is of order prime to ℓ,
and the image of Perf(BG) →Perf(BH) generates under cones and retracts.
Remark VIII.5.15. The following example shows that the hypothesis that F is of order prime
to ℓis important, and cannot even be weakened to for example “quasi-semisimple” automorphisms
(preserving a Borel and a torus); also, the example shows that the precise form of the center is
critical in the theorem. If G = (SL2 × SL2)/µ2 with the automorphism switching the two factors,
then H = PGL2 × (µ2 × µ2)/µ2. If we had ℓ= 2 – this is excluded by the hypotheses – then

300
VIII. L-PARAMETER
one can show that for all objects A ∈Perf(BH) in the image of Perf(BG), the summand A1
of A with nontrivial central character has the property that the (homotopy) invariants of the
Z/2Z ⊂PGL2-action on A1 are a perfect complex. This implies that the nontrivial character of H
is not generated by Perf(BG) under cones and retracts. On the other hand, the conclusion of the
theorem is (trivially) true for the simply connected and adjoint form of G, as then the inclusion
H ⊂G admits a retraction.
Before starting the proof of Theorem VIII.5.14, let us recall the following lemma.
Lemma VIII.5.16. Let C be an idempotent-complete stable ∞-category, and let D ⊂C be a
full idempotent-complete stable ∞-subcategory, with idempotent-completed Verdier quotient E. Let
S ⊂C be a collection of objects of C. Then S generates C under cones, shifts, and retracts if and
only if the image of S in E generates E under cones, shifts, and retracts, and all of objects of D
are in the full ∞-subcategory of C generated by S under cones, shifts, and retracts.
Proof. Let C′ ⊂C be the full idempotent-complete stable ∞-category generated by S; this is,
equivalently, the full ∞-subcategory generated by S under cones, shifts, and retracts. We want to
see that C′ = C. Passing to Ind-categories, we have a Verdier quotient sequence
Ind(D) →Ind(C) →Ind(E)
and the quotient Ind(C) →Ind(E) has a right adjoint R : Ind(E) →Ind(C); see, for example [NS18,
Theorem I.3.3, Proposition I.3.5]. In particular, for any X ∈Ind(C), with image X ∈Ind(E), the
cone of X →R(X) lies in Ind(D) ⊂Ind(C).
To see that C′ →C is essentially surjective, we need to see that for all X ∈Ind(C) with
Hom(X′, X) = 0 for all X′ ∈C′, one has X = 0. Now by assumption all objects of D lie in C′, so
in particular Hom(Y, X) = 0 for all Y ∈D. As Hom(Y, R(X)) = Hom(Y , X) = 0 for all such Y (as
Y = 0 ∈E), we see that Hom(Y, cone(X →R(X))) = 0 for all Y ∈D. As the cone lies in Ind(D),
this implies that the cone is equal to 0, so X = R(X). But then Hom(X′, R(X)) = Hom(X′, X) = 0
for all X′ ∈S, which implies that X = 0 by the assumption that S generates E under cones, shifts,
and retracts.
□
An application of this is the following result.
Lemma VIII.5.17. Let G be a connected reductive group and H ⊂G be a connected reductive
subgroup of the same rank. Then the image of Perf(BG) →Perf(BH) generates under cones and
retracts.
Proof. Let T ⊂H be a maximal torus.
Then it is also a maximal torus of G.
For any
subset W ⊂X∗(T) stable under the Weyl group of G and the dominance order, we have the
subcategory PerfW (BG) consisting of those representations whose weights lie in T, and similarly
the subcategory PerfW (BH); obviously, restriction gives a functor PerfW (BG) →PerfW (BH). We
claim by induction on W that the image generates under cones and retracts. We may always write
W = W ′ ∪W ′′ where W ′′ is a single Weyl group orbit, and W ′ is still stable under the dominance
order. Then PerfW (BG)/ PerfW ′(BG) is isomorphic to Perf(L), and is generated by the highest
weight representation V of weight given by W ′′. Note that that all the weight spaces of V with
weights in W ′′ have multiplicity exactly 1. The quotient PerfW (BH)/ PerfW ′(BH) is isomorphic

VIII.5. MODULAR REPRESENTATION THEORY
301
to a product of copies of Perf(L), enumerated by all the orbits of W ′′ under the Weyl group WH
of H. The induced map on quotients Perf(L) →Q
W ′′/WH Perf(L) is the diagonal embedding,
by the multiplicity 1 observation. Thus, its image generates under retracts, and we conclude by
induction.
□
A variation of Lemma VIII.5.16 is the following.
Lemma VIII.5.18. Let G be a linear algebraic group over L and let G′ ⊂G be a normal subgroup,
with quotient G = G/G′, and assume that the map L →O(G) splits as G-representations. Let
C ⊂Perf(BG) be an idempotent-complete stable ∞-subcategory such that for all X, Y ∈C also
X ⊗Y ∈C. Assume that C contains Perf(BG) and the image of C in Perf(BG′) generates under
cones and retracts. Then C = Perf(BG).
Proof. The functor Ind Perf(BG) →Ind Perf(BG′) admits a right adjoint R : Ind Perf(BG′) →
Ind Perf(BG), given by pushforward along f : BG′ →BG. Note that these functors preserve the
coconnective part of these ∞-categories, and Ind Perf≥0(BG) ∼= D≥0(BG). In particular, this in-
duces a monad on Ind Perf(BG), given by Rf∗f∗. By the projection formula, this monad is given
by V 7→V ⊗O(G). By the assumption that L →O(G) splits as G-representations, it follows that
for all V ∈Ind Perf(BG), V is a direct summand of V ⊗O(G).
Now take any V ∈Ind Perf(BG); we want to see that it lies in Ind(C). Let V ′ ∈Ind Perf(BG′)
be the image of V . The functor Ind(C) →Ind Perf(BG′) is surjective, so we can write V ′ as the
image of some X ∈Ind(C) ⊂Ind Perf(BG). Then V is a direct summand of R(V ′) = X ⊗O(G).
As O(G) ∈Ind Perf(BG) lies in Ind(C) by assumption, and tensor products preserve Ind(C), we
get the result.
□
Proof of Theorem VIII.5.14. By induction, we can assume that F is cyclic of prime order
p ̸= ℓ. The following argument actually proves simultaneously that π0H is of order prime to ℓ, and
H◦is reductive, but this is already part of Proposition VIII.5.11.
For the statement that Perf(BG) →Perf(BH) generates, we ﬁrst reduce to the case that G is
connected and semisimple. Indeed, we have an exact sequence
1 →G◦
der →G →D →1
where D◦is a torus and π0D is of order prime to ℓ; in particular D has semisimple representation
theory and L →O(D) splits as D-representations. Intersecting with H, we get a similar exact
sequence, and then Lemma VIII.5.18 reduces us to the case of G◦
der.
Now we claim that we can reduce to the case that Θ permutes the almost simple factors of G
transitively. Let G1 →G be the simply connected cover, to which Θ lifts, and let H1 = GΘ
1 be the
corresponding ﬁxed points.
Lemma VIII.5.19. Let G be a connected semisimple group, and let Θ : G →G be an automor-
phism of order p ̸= ℓ; it also induces an automorphism Θ : G1 →G1 of the simply connected cover.
Let H = GΘ ⊂G be the ﬁxed points, and similarly H1 = GΘ
1 . Then H1 is connected, and π0H is
an elementary abelian p-group which injects naturally into the coinvariants ker(Z(G1) →Z(G))Θ.
Proof. For the claim that H1 is connected, see [Ste68, Theorem 8.1].
We deﬁne a map
ψ : H →ker(Z(G1) →Z(G))Θ. Given h ∈H, lift to eh ∈G1. Then ehΘ(eh)−1 must lie in the kernel

302
VIII. L-PARAMETER
of G1 →G, i.e. in the kernel of Z(G1) →Z(G). Taking a diﬀerent choice of eh multiplies ehΘ(eh)−1
by zΘ(z)−1, so the image in the coinvariants is well-deﬁned. Moreover, it is clear that the image
is 0 when h ∈H lifts to H1. Conversely, if the image in the coinvariants is 0, then we can ﬁnd a
choice of eh so that eh = Θ(eh), i.e. we can lift h to eh ∈H1. This shows that π0H = H/im(H1 →H)
injects into ker(Z(G1) →Z(G))Θ. It is also easy to check that it is a group homomorphism, so
π0H is an abelian group.
Moreover, all elements of π0H are of order p. Indeed, consider ehΘ(eh)−1 above. Its image in the
coinvariants agrees with Θi(eh)Θi+1(eh)−1 for all i = 0, . . . , p −1, so its p-th power is ehΘp(eh)−1 = 1,
as Θ is of order p.
□
Now assume that the theorem holds when Θ permutes the almost simple factors of G
transitively. This implies that it holds for all simply connected groups: Indeed, we can decompose
these into factors. Now for general G, we induct on the order of ker(Z(G1) →Z(G)). Assume that
there is some normal Θ-stable connected semisimple subgroup G′ ⊂G such that G = G/G′ has
almost simple factors permuted transitively by Θ, and ker(Z(G1) →Z(G))Θ ̸= 0. In that case,
let G
′ →G be the cover with ker(Z(G
′) →Z(G)) = ker(Z(G1) →Z(G))Θ, and let G′ →G be
its pullback. Then Θ also acts on G′, and the action on W = ker(Z(G′) →Z(G)) is trivial. In
particular, if H′ = (G′)Θ, then H′ contains W = ker(Z(G′) →Z(G)). By induction, we can assume
that Perf(BG′) →Perf(BH′) generates under cones and retracts.
Both categories decompose
into direct sums over the characters of W, so it follows that also Perf(BG) →Perf(B(H′/W))
generates under cones and retracts. Now H′/W ⊂H is a union of connected components, so by
Lemma VIII.5.18, it suﬃces to shows that O(H/H′) is generated by Perf(BG). But as G′ = G×GG
′,
we also similarly have H′ = H ×H H
′, and hence H/H′ = H/H
′, and hence this part follows from
O(H/H
′) being generated by Perf(BG).
Thus, we can assume that for all such quotients G, one has ker(Z(G1) →Z(G))Θ = 0. This
actually implies that ker(Z(G1) →Z(G)) is of order prime to p.
If this happens for all such
quotients G, then in fact ker(Z(G1) →Z(G)) is of order prime to p. By Lemma VIII.5.19, it
is then the case that H is connected.
If ker(Z(G1) →Z(G))Θ ̸= 0, then we can pass to the
corresponding cover G′ →G and the previous arguments reduce us to G′. Thus, we can further
assume that ker(Z(G1) →Z(G))Θ = 0. In that case also the Θ-invariants are trivial (as the group
is prime to p), and the map H1 →H is an isomorphism. Moreover, we can ﬁnd a maximal quotient
G →G′ such that ker(Z(G1) →Z(G′)) is prime to p and ker(Z(G1) →Z(G′))Θ = 0, and this
decomposes into factors. This ﬁnishes the reduction to the case when Θ permutes the
almost simple factors of G transitively.
Assume that there is more than one simple factor. Then Θ permutes them cyclically,
with Θp acting as the identity, so G1 = Q
Z/pZ H1. There is nothing to do in the simply connected
types E8, F4 and G2. Consider next the types B, C, D and E7 where the fundamental
group is a 2-group. Assume ﬁrst that also p > 2. Then as in the previous paragraph, we can
assume that G1 →G is the maximal Θ-stable quotient such that H1 = H = GΘ; then Z(H) →Z(G)
is an isomorphism. Let V be any representation of H. Then V splits oﬀV ⊗V ∗⊗V , and inductively
it splits oﬀV ⊗m ⊗V ∗⊗(m−1) for any m ≥1. In type B, C, Dn with n even and E7, take m = p:
Then V ⊗(p−1) is a representation of the adjoint form, hence generated by Perf(BG), and V ⊗p lifts to
a representation of G, whence lies in the subcategory of Perf(BH) generated by Perf(BG), showing

VIII.5. MODULAR REPRESENTATION THEORY
303
that also V lies in there. In type Dn with n odd, the same argument works if p ≡1 mod 4; if
p ≡3 mod 4, take m = p + 1: Then V ⊗m is a representation of the adjoint group, and V ∗⊗(m−1)
extends to G. Now consider the case p = 2 in type B, C, D and E7, so necessarily ℓ̸= 2.
In type B, C and E7, one has Z(G1) = (Z/2Z)2, and besides the simply connected and adjoint
form where the claim is clear, there is only one Θ-stable subgroup. In that case G = (H1 ×H1)/µ2,
with µ2 diagonally embedded, and the ﬁxed points are given by H = H1/µ2 × (µ2 × µ2)/µ2. By
Lemma VIII.5.18, it suﬃces to generate the nontrivial character of (µ2 × µ2)/µ2. In type B, the
exterior tensor product of two copies of the spinor representation deﬁnes a representation W of G
of dimension a power of 2 whose restriction to H has nontrivial central character, and admits a
character as a summand, thus generating the nontrivial character of µ2 × µ2/µ2. In type C, one
can argue similarly with two copies of the i-th exterior power of the standard representation of
Sp2n, with 0 < i < 2n odd such that
 2n
i

is not divisible by ℓ– for example, take for i the exact
power of ℓdividing n. In type E7, there is an embedding into Sp56, reducing to type C. In type
D, we make a case distinction according to the size of π1(G), whose size is a power of 2 between 1
and 16, where the extreme cases are clear. If it is of size 2, then G = (Spin2n × Spin2n)/µ2 where
the µ2 is diagonally embedded, and in each copy is the kernel of Spin2n →SO2n. In that case
H = SO2n × (µ2 × µ2)/µ2, which can be handled similarly to type B. If π1(G) is of size 8, then
G = (SO2n × SO2n)/µ2 and H = PSO2n × (µ2 × µ2)/µ2. This case can be handled like the case
of type C. There remains the case that π1(G) is of size 4, where either G = SO2n × SO2n where
the claim is clear, or else G ∼= (Spin2n × Spin2n)/Z where Z is the center of Spin2n, embedded
either diagonally, or twisted via the outer automorphism of Spin2n in one copy. In this case we
also need to distinguish between even and odd n. Assume ﬁrst that n is odd and Z is embedded
diagonally. Then H = PSO2n ×(µ2 ×µ2)/µ2. This case can be reduced to the case that π1(G) is of
order 2 by passing to a cover. If n is odd and Z is embedded twisted via the outer automorphism,
then H ∼= (SO2n × µ4)/µ2, so H◦∼= SO2n and π0H ∼= Z/2Z. The set of connected components
actually maps isomorphically to the components in the case where π1(G) is of order 8, so O(π0H)
is generated by Perf(BG) via reduction to that case. Moreover, taking an exterior tensor product
of two copies of a spinor representation gives a representation of G whose restriction to H◦= SO2n
generates the part with nontrivial central character. Now assume that n is even, and Z is embedded
diagonally. Then H = PSO2n ×(Z ×Z)/Z, and again one can generate the characters of (Z ×Z)/Z
via restrictions of exterior tensor products of spinor representations. Finally, if n is even and Z is
embedded twisted via the outer automorphism, then H = SO2n. Taking an exterior tensor product
of the two distinct spinor representations deﬁnes a representation of G whose restriction to H
generates the part of Perf(BH) with nontrivial central character. This ﬁnishes types B, C, D
and E7. Consider next type E6, where the fundamental group is Z/3Z. Assume ﬁrst
p ̸= 3. As before, one can reduce to the case G1 →G is the maximal Θ-stable quotient such that
H1 = H = GΘ is the simply connected form of E6. In that case, we use again that any V can be
split oﬀfrom V ⊗m ⊗V ∗⊗(m−1). If p ≡1 mod 3, we can take m = p, otherwise m = p + 1: In the
ﬁrst case V ⊗m extends to G and V ∗⊗(m−1) is a representation of the adjoint group, in the second
case it is the other way around. Now consider p = 3, so necessarily ℓ̸= 3. Then G1 = E3
6 and
Z(G1) = (Z/3Z)3. The order of π1(G) is then a power of 3 between 1 and 27, with the extreme
cases being trivial, and in both other cases there is exactly one possibility. For π1(G) of order 3,
we get H = E6,ad × Z where Z ∼= µ3 is a central subgroup, given as the kernel of the sum map
µ3
3 →µ3 quotient by the diagonal copy of µ3. Consider the 27-dimensional representation V of E6.
Then W = V ⊗V ∗⊗1 deﬁnes a representation of G on which Z acts via a nontrivial character, and

304
VIII. L-PARAMETER
the restriction of W to H splits oﬀthis character (as the dimension of W is a power of 3, hence
invertible modulo ℓ). If π1(G) is of order 9, then H = E6,ad × Z′, where Z′ ∼= µ3 is the quotient of
µ3
3 by the kernel of the sum map. In this case, V ⊗V ⊗V deﬁnes a representation of G on which
Z′ acts via a nontrivial character, and the same argument applies.
It remains to handle type A. Thus, G = (Q
Z/pZ SLn)/Z. Let n′ be the maximal divisor
of n that is prime to p. We can decompose Z = Zp × Zp where Zp is of order a power of p, and
Zp is prime to p. We can assume that Zp ⊂µp
n′ is the set of all elements with product 1 (which
is the maximal Θ-invariant complement to the diagonal copy of µn′). On the other hand, letting
pa be the exact power of p dividing n, Zp is a subgroup of µp
pa ∼= (Z/paZ)p that is stable under the
the Θ-action. One can then show that π0H ∼= H1(Θ, Zp). We will now inductively reduce to the
case that Zp is trivial, by replacing Zp by a (certain) subgroup Z′
p ⊂Zp of index p and arguing
that the result for G′ = (Q
Z/pZ SLn)/Z′
pZp implies the result for G. First note that Z′
p/Zp ⊂G′
is necessarily contained in H′ = (G′)Θ, so if Perf(BG′) →Perf(BH′) generates under cones and
retracts, the same is true for Perf(BG) →Perf(B(im(H′ →H))). By Lemma VIII.5.18, it remains
to generate O(H/H′). This is given by H1(Θ, Zp)/H1(Θ, Z′
p), which injects into H1(Θ, Zp/Z′
p) ∼=
Z/pZ. Moreover, if a′ is chosen maximal so that Zp ⊂(pa′Z/paZ)p, we can assume that Z′
p contains
(pa′+1Z/paZ)p∩Zp. With this choice, we can assume that (pa′+1Z/paZ)p ⊂Z′
p ⊂Zp ⊂(pa′Z/paZ)p,
which then determines Z′
p uniquely (given Zp), as Fp
p has a unique Θ-stable ﬁltration. Now choose
i, 0 < i < n, with i not divisible by p, such that
 n
i

is not divisible by ℓ– for example, take
for i the exact power of ℓdividing n, which works as long as n is not itself a power of ℓ, but
then Zp = 0 anyway. Then consider the n′pa−a′−1-th tensor power V of the i-th exterior tensor
power of the standard representation; this V is of dimension prime to ℓ, and a representation of
SLn /µn′pa−a′−1 whose central character on µpa−a′/µpa−a′−1 is nontrivial. Taking tensor products
of V , one can then deﬁne a representation of G whose central character factors over a nontrivial
character of Zp/Z′
p, from which one gets the desired result. Thus, in type A, we can assume that
Zp = 0. Then G = (Q
Z/pZ SLn)/Zp and H = SLn. We show that the standard representation V
of H is a retract of a representation of G; this implies the same for its exterior powers, and these
generated Perf(BH). We can split oﬀV from any V ⊗m ⊗V ∗⊗(m−1). Choose a positive integer
q such that pq ≡1 mod n′ and let m = pq. Then V ⊗m = (V ⊗q)⊗p extends to a representation
of G, while V ∗⊗(m−1) is a representation of PGLn, which also extends to G. This ﬁnishes the
reduction to the case that G is almost simple.
Thus, from now on assume that G is almost simple. Assume ﬁrst that Θ is an
inner automorphism. If G is simply connected, then H ⊂G is the centralizer of a semisimple
element, and thus connected and of the same rank as G, so the claim follows from Lemma VIII.5.17.
Moreover, for inner automorphisms Lemma VIII.5.19 shows that the connected components of H
always inject into the ones for the adjoint form, and moreover the center of G is always contained
in H. So for inner automorphisms, it remains to handle the case of adjoint G. Moreover,
by Lemma VIII.5.18, it suﬃces to show that O(π0H) is in the subcategory of Perf(BH) generated
under cones and retracts by the image of Perf(BG) →Perf(BH). As a general observation, we
note that the adjoint representation g is a representation of G, and it restricts to a representation of
H ×Z/pZ. We may decompose according to the (semisimple) action of Θ ∈Z/pZ, and in particular

VIII.5. MODULAR REPRESENTATION THEORY
305
the ﬁxed points h = gΘ are a retract of g|H. This implies that also all Vi h ∈Perf(BH) are retracts
of Vi g|H.
Now we go through the list of types. Note that by Lemma VIII.5.19, π0H is an elementary
abelian p-group injecting into Z(Gsc).
In particular, for p > 3, only G = PGLpn is relevant.
Moreover, the only relevant H is given by GLp
n /Gm ⋊Z/pZ, which occurs for the centralizer of the
semisimple element that is the image of the diagonal element of GLpn with n occurences of each p-th
root of unity. Changing the center, we can also look at restriction from GLpn to GLp
n ⋊Z/pZ. For
any i, consider the representation Vi(std) of GLpn. Its restriction to GLp
n decomposes as a direct
sum (as the standard representation decomposes, and a wedge power of a direct sum decomposes
into various pieces), in particular a canonical direct summand Lp
j=1
Vi(stdj) where stdj is the
standard representation of the j-th factor of GLp
n. In particular, as a representation of H, the
restriction of Vi(std) contains Lp
j=1
Vi(stdj), which is naturally a representation of H. If we take
i = n, then each Vi(stdj) is just the determinant of the standard representation. Thus, we get a
representation W of Gp
m ⋊Z/pZ. This group has semisimple representation theory, and W ⊗W ∗
admits O(Z/pZ) as a direct summand, so the claim follows. This handles the case of type A, in
fact for all p ≥2.
Let us next do the remaining case for p = 3, which is E6. In that case, H◦is of the form SL3
3/µ2
3
(for some embedding of µ2
3 into the center µ3
3), and π0H = Z/3Z permutes the three factors. In
particular, h|H◦decomposes into the direct sum of the adjoint representations of the three factors
(each of which is of dimension 8), permuted cyclically by π0H. Taking V8 h, it contains a direct
summand that restricted to H◦is the direct sum of V8 sl3 ∼= L for each factor, permuted cyclically
by π0H; in other words, the regular representation of π0H.
The remaining types are now B, C, D and E7, all for p = 2 (in particular, ℓ̸= 2). In type
B, G = SO2n+1, and we are looking at the centralizer of a diagonal element with entries 1 and
−1. This is of the form S(Om × O2n+1−m) for some m = 1, . . . , n. This maps naturally to Om,
identifying connected components. The natural representation decomposes into the sum of the
natural representations of Om and O2n+1−m. As before, it follows that all exterior powers of the
natural representation of Om lie in the relevant subcategory of Perf(BH), but its determinant
deﬁnes a representation of Om that restricts to the nontrivial character of π0H.
In type C, G = PSp2n, and we are looking at the centralizer of an element of GSp2n that has
diagonal entries 1 and −1. There are two cases where π0H is nontrivial. On the one hand, if
n = 2m, one can get H◦= Sp2
2m/µ2 with π0H = Z/2Z; this case can be handled like the case
of E6, taking Vd h for d the dimension of Sp2m. In the other case, we get H = GLn/µ2 ⋊Z/2Z,
where the action is given by A 7→tA−1. In that case, we again enlarge the center as in type A,
so consider eH = (GLn × Gm) ⋊Z/2Z ⊂eG = GSp2n, where (A, λ) ∈GLn × Gm embeds GSp2n
via the block diagonal matrix with entries A and λtA−1, and Z/2Z maps to the block matrix

0
In
In
0

. Restricting the natural representation of GSp2n to eH, its restriction to eH◦is a sum
of two n-dimensional representations, permuted by π0 eH. Passing to the n-th exterior power, we
get as a direct summand a 2-dimensional representation W of the torus quotient G2
m ⋊Z/2Z of eH,
and W ⊗W ∗contains O(Z/2Z) as a direct summand.

306
VIII. L-PARAMETER
In type D, G = PSO2n, and we are looking at the centralizer of a diagonal element of eG = GSO2n
with entries ±1. In the following, we describe the preimage of H ⊂G in eG. Unless the number of
1’s and −1’s agrees, this is of the form GSO2n ∩(GLm × GL2n−m) for some even m, 0 < m < n.
In that case, H has two connected components, and these two connected components are still
seen when taking the centralizer S(Om × O2n−m) in SO2n, so we may replace the adjoint group
by SO2n in this example.
Then the same argument as for type B works.
There remains the
case that the number of 1’s and −1’s agree, in which case there are two conjugacy classes. In
one case, one gets eH = GSO2n ∩(GLn × GLn ⋊Z/2Z). If n is odd, then this intersection agrees
with GSO2n ∩(GLn × GLn), and the previous argument applies. If n is even, then π0 eH agrees
with Z(Gsc) = (Z/2Z)2. Restricting Vn of the standard representation of GSO2n to eH admits a
2-dimensional summand W which on eH◦factors over the torus quotient Gm. Let us identify this
W: We can also ﬁrst restrict from GL2n to GL2
n ⋊Z/2Z, in which case we get a representation
of G2
m ⋊Z/2Z that on G2
m is the direct sum of the two characters given by the two projections.
In particular, W ⊗W ∗already admits O(Z/2Z) as a direct summand for GL2
n ⋊Z/2Z, and hence
continues to do so after restriction to eH. We may then apply Lemma VIII.5.18 to reduce to the
intersection of GSO2n with GL2
n, where we can as before reduce to the cover SO2n of G = PSO2n,
and the argument of type B applies. Finally, there is an inner involution for which eH◦= GLn ×Gm
with π0 eH = Z/2Z. This can be handled like the similar case in type C.
For inner automorphisms, it remains to handle the case of E7. In that case, there is an em-
bedding E7 →eG = Sp56 mapping the center to the center. In particular, any semisimple element
of E7,ad maps to a semisimple element of PSp56, and we get an inclusion H ⊂eH of centralizers.
Lemma VIII.5.19 implies that π0H →π0 eH is injective, so this case reduces to type C.
Now we consider the case Θ is an outer automorphism.
Let us ﬁrst treat the
case of triality, so p = 3 (and ℓ̸= 3). Then G is of type D4 and either simply connected or
adjoint. By Lemma VIII.5.19, the ﬁxed points H are always connected. Moreover, H is unchanged
by taking G adjoint, so we can assume G adjoint.
There are two conjugacy of order 3 outer
automorphisms of Spin8 (see e.g. [Tit59]): The diagram automorphism with ﬁxed points G2, and
an automorphism whose ﬁxed points agree with the ﬁxed points of the order 3 semisimple element
of G2 with centralizer PGL3 ⊂G2. The second case thus follows from the ﬁrst. For the ﬁrst, note
ﬁrst that any highest weight for G2 lifts to a highest weight for Spin8, so it follows easily from
highest weight theory that Perf(BSpin8) →Perf(BG2) generates under cones and retracts. Now
for the adjoint form, there is the problem that there is a fundamental weight for G2 that does not
lift to a highest weight for PSpin8; rather, if would lift to either of the three fundamental weights
for Spin8 giving the two spinor representations V1, V2 and the standard representation V3 (which
are permuted under triality). But then V = V1 ⊗V2 ⊗V3 has trivial central character, and upon
restriction to G2 all three of these are isomorphic and selfdual. Thus V1|G2 splits oﬀV |G2 (as in
general W splits oﬀW ⊗W ∗⊗W), giving the desired result.
It remains to handle the case of outer involutions, so p = 2 (and ℓ̸= 2). In con-
tinuing the tradition of handling exceptional cases ﬁrst for outer involutions, consider E6.
By
Lemma VIII.5.19, the ﬁxed points are necessarily connected, and moreover are unchanged when
going to the adjoint form of E6. We can thus assume that the group is adjoint. There are two
conjugacy classes of outer automorphisms of E6: The diagram automorphism, with ﬁxed points

VIII.5. MODULAR REPRESENTATION THEORY
307
F4, and one automorphism with ﬁxed points PSp8. Consider ﬁrst the diagram automorphism. If
G is simply connected, any highest weight of F4 or PSp8 lifts to a highest weight for E6, and the
claim is easy. Otherwise, if G is adjoint, let W be an irreducible representation of the simply
connected form of E6 with nontrivial central character. Then W|F4 is selfdual, so W|F4 splits oﬀ
(W ⊗W ⊗W)|F4, and W ⊗W ⊗W is always a representation of the adjoint form G.
In type A, if the simply connected cover is SLn with n odd, there is just one conjugacy class
of outer involutions, with ﬁxed points SOn (independently of the center of G). The worst case is
thus G = PGLn. But for any irreducible representation V of SLn, the restriction of V to SOn is
selfdual, and hence V |SOn splits oﬀV ⊗n|SOn (noting that n is odd), where V ⊗n is a representation
of the adjoint form G. This reduces us back to the simply connected case, where the claim follows
easily from highest weights. If the simply connected cover is SL2n, there are two conjugacy classes
of outer involutions, with ﬁxed points Sp2n resp. SO2n (for the simply connected form). Arguing as
for SLn with n odd, we can assume that the fundamental group of G is a 2-group (but the 2-part of
π1(G) changes the structure of H), and so G = SL2n/µ2a for some a ≥0 such that 2a divides 2n.
In the simply connected form, a = 0, both cases follow from consideration of highest weights. In
general, we reduce to the simply connected case by induction on a. Unless a is the exact power of
2 dividing 2n (and assuming a > 0), one has H = H◦× µ2a+1/µ2a where H◦is PSp2n resp. PSO2n.
Moreover, H′ →H factors over a µ2-cover H′ →H◦, so by Lemma VIII.5.18, it suﬃces to generate
the nontrivial character of µ2a+1/µ2a. For this, take V the i-th exterior power of the standard
representation where i is the exact power of ℓdividing n, so that V is of dimension prime to ℓ.
Consider V ⊗2a. This is a representation of G such that the central character of µ2a+1/µ2a ⊂G is
nontrivial. The restriction of V to H will then split oﬀthe nontrivial character of µ2a+1/µ2a, noting
that the restriction of V ⊗2a to PSp2n resp. PSO2n splits oﬀthe trivial representation (as a > 0
and V becomes selfdual). It remains to consider the case that a is the exact power of 2 dividing
2n. In the symplectic case, H is connected, and the reduction to H′ works immediately. In the
orthogonal case, H is given by PO2n, and we need to construct the nontrivial character of π0H.
Here, we observe as above that the subcategory of Perf(BH) generated by Perf(BG) under cones
and retracts contains all wedge powers of h = so2n. Taking the determinant of h, we observe that
it gives the nontrivial character of π0H, giving the claim.
In type D, we consider ﬁrst type Dn with n odd. In the simply connected form H ⊂Spin2n, the
centralizer is the diagonal µ2-cover H →SOm×SO2n−m for some odd m. This case is again handled
by highest weights. For the intermediate form G = SO2n, the centralizer is S(Om × O2n−m) =
SOm × SO2n−m × µ4/µ2. In that case, let V be a spinor representation of Spin2n, and consider
V ⊗2. Then V becomes selfdual upon restriction to Spinm × Spin2n−m (as there is only one spinor
representation in type B), and hence V ⊗2 splits oﬀthe trivial representation as a representation
of SOm × SO2n−m. On the other hand, the central character is the nontrivial character of µ4/µ2,
so V ⊗2 restricted to H splits oﬀthe nontrivial character of µ4/µ2 and hence Lemma VIII.5.18
handles this case again. Finally, if G = PSO2n is adjoint, then the centralizer is SOm × SO2n−m
and connected as long as m ̸= n, when the reduction to the previous case is immediate. If on
the other hand m = n, then the centralizer H has H◦= SOn × SOn and π0H = Z/2Z, switching
the two factors. Here we use again that the adjoint representation h lies in the subcategory of
Perf(BH) generated by Perf(BG) under cones and retracts. This is given by son ×son, where π0H
switches the two factors. Passing to the d-th exterior power, where d is the dimension of son, we
get a two-dimensional summand given by the sum of two copies of the determinants of son, with

308
VIII. L-PARAMETER
π0H acting by switching. This generates the regular representation of π0H, as desired. Finally,
consider the case of Dn with n even. In that case, the discussion works in exactly the same way
(except that µ4 is replaced by µ2 × µ2, which however causes no diﬀerence), except that as m is
still odd the case m = n cannot occur, so the most diﬃcult case does not arise.
□
VIII.5.4. End of proof. Finally, we can prove Theorem VIII.5.2. We switch back to the
notation employed there.
Note that W can be written (inside animated groups) as a geometric realization of a simplicial
group which is ﬁnite free in each degree. In particular, the sifted colimit
colim(n,Fn→W) O(Z1(Fn, bG)L)
can be understood to be a geometric realization of a simplicial diagram.
We want to use Proposition VIII.5.10 to show that
colim(n,Fn→W) O(Z1(Fn, bG)L) →O(Z1(W, bG)L)
is an isomorphism in Ind Perf(B bG), and that Z1(W, bG)L satisﬁes the hypotheses of Theorem VIII.5.8.
To do so, it suﬃces to see that for all closed bG-orbits Z ∼= bG/H ⊂Z1(W, bG)L, the bG-representation
O(Z) has a good ﬁltration, the image of Perf(B bG) →Perf(BH) generates under cones and retracts,
and for any closed immersion
Z ∼= Z1(W, bG) ⊂Z1(Fn, bG) ∼= bGn,
the conormal sheaf I/I2 deﬁnes a representation of H that is a direct summand of a direct sum of
copies of bg∗|H.
Note that by Proposition VIII.1.5, any such closed orbit Z has the property that ϕ : WE →bG(L)
factors over a ﬁnite quotient F of order prime to ℓ. Then H = Cent bG(ϕ) ⊂bG is the centralizer of
a group of automorphisms of bG of order prime to ℓ. By Proposition VIII.5.12, O( bG/H) has a good
bG-ﬁltration, and by Theorem VIII.5.14, the map Perf(B bG) →Perf(BH) generates under cones
and retracts. Finally, the claim about the conormal sheaf for the closed immersion
Z ⊂Z1(Fn, bG) ∼= bGn
can be reduced to the case that Fn →WE has the property that the images of the generators give
a set of representatives for the quotient WE →F in WE, where it follows from the argument in the
proof of Proposition VIII.5.12.

CHAPTER IX
The Hecke action
The time has come to put everything together. As before, let E be any nonarchimedean local
ﬁeld with residue ﬁeld Fq of residue characteristic p, and let G be a reductive group over E. For any
Zℓ-algebra Λ, we have deﬁned Dlis(BunG, Λ), we have the geometric Satake equivalence relating bG
to perverse sheaves on the Hecke stack, and we have studied the stack of L-parameters.
Our ﬁrst task is to use the geometric Satake equivalence to deﬁne the Hecke operators on
Dlis(BunG, Λ). As in the last chapter, we work over a Zℓ[√q]-algebra Λ in order to trivialize the
cyclotomic twist in the geometric Satake equivalence; let Q be a ﬁnite quotient of WE over which
the action on bG factors. If Λ is killed by a power of ℓ, then we can deﬁne Hecke operators in the
following standard way. For any ﬁnite set I and V ∈RepΛ( bG ⋊Q)I, we get a perverse sheaf SV on
HckI
G, which we can pull back to the global Hecke stack HckI
G; we denote its pullback still by SV .
Using the correspondence
HckI
G
p1
{
p2
&
BunG
BunG ×(Div1)I
we get the Hecke operator
TV : D´et(BunG, Λ) →D´et(BunG ×(Div1)I, Λ) : A 7→Rp2∗(p∗
1A ⊗L
Λ SV ).
By Corollary IV.7.2, the target has D´et(BunG ×[∗/W I
E], Λ) as a full subcategory, and we will see
below that TV will factor over this subcategory. Working ∞-categorically in order to have descent,
and using a little bit of condensed formalism in order to deal with W I
E not being discrete, we can
in fact rewrite
D´et(BunG ×[∗/W I
E], Λ) ∼= D´et(BunG, Λ)BW I
E
as the W I
E-equivariant objects of the condensed ∞-category D´et(BunG, Λ); we will discuss the
condensed structure below.
The following theorem summarizes the properties of the Hecke operators.
In particular, it
asserts that these functors are deﬁned even when Λ is not torsion.
Theorem IX.0.1 (Theorem IX.2.2; Corollary IX.2.4, Proposition IX.5.1). For any Zℓ[√q]-
algebra Λ, any ﬁnite set I, and any V ∈RepΛ( bG ⋊Q)I, there is a natural Hecke operator
TV : Dlis(BunG, Λ) →Dlis(BunG, Λ)BW I
E.
309

310
IX. THE HECKE ACTION
(i) Forgetting the W I
E-action, i.e. as an endofunctor of Dlis(BunG, Λ), the functor TV is functorial
in V ∈RepΛ bGI.
Moreover, TV commutes with all limits and colimits, and preserves compact
objects and universally locally acyclic objects. Letting sw∗: RepΛ bGI →RepΛ bGI be the involution
of Proposition VI.12.1, there are natural isomorphisms
DBZ(TV (A)) ∼= Tsw∗V ∨(DBZ(A)) , RHomlis(TV (A), Λ) ∼= Tsw∗V ∨RHomlis(A, Λ).
(ii) As a functor of V , it induces an exact RepΛ(QI)-linear monoidal functor
RepΛ( bG ⋊Q)I →EndΛ(Dlis(BunG, Λ)ω)BW I
E.
Moreover, for any compact object X ∈Dlis(BunG, Λ)ω, there is some open subgroup P of the wild
inertia subgroup of WE such that for all I and V , the P I-action on TV (X) is trivial. In particular,
one can write Dlis(BunG, Λ)ω as an increasing union of full stable ∞-subcategories DP
lis(BunG, Λ)ω
such that the Hecke action deﬁnes functors
RepΛ( bG ⋊Q)I →EndΛ(DP
lis(BunG, Λ)ω)B(WE/P)I.
(iii) Varying also I, the functors of (ii) are functorial in I.
In particular, the categories DP
lis(BunG, Λ)ω ﬁt the bill of the discussion of Section VIII.4, so
Theorem VIII.4.1 gives a construction of excursion operators. To state the outcome, we make the
following deﬁnitions as in the introduction.
Definition IX.0.2.
(i) The Bernstein center of G(E) is
Z(G(E), Λ) = π0End(idD(G(E),Λ)) =
lim
←−
K⊂G(E)
Z(Λ[K\G(E)/K])
where K runs over open pro-p subgroups of G(E), and Λ[K\G(E)/K] = EndG(E)(c-IndG(E)
K
Λ) is
the Hecke algebra of level K.
(ii) The geometric Bernstein center of G is
Zgeom(G, Λ) = π0End(idDlis(BunG,Λ)).
Inside Zgeom(G, Λ), we let Zgeom
Hecke(G, Λ) be the subring of all endomorphisms f : id →id commuting
with Hecke operators, in the sense that for all V ∈Rep( bGI) and A ∈Dlis(BunG, Λ), one has
TV (f(A)) = f(TV (A)) ∈End(TV (A)).
(iii) The spectral Bernstein center of G is
Zspec(G, Λ) = O(Z1(WE, bG)Λ)
bG,
the ring of global functions on Z1(WE, bG)Λ  bG.
The inclusion D(G(E), Λ) ,→Dlis(BunG, Λ) induces a map of algebra Zgeom(G, Λ) →Z(G(E), Λ).
Corollary IX.0.3. Assume that ℓis invertible in Λ, or ℓis a very good prime for bG. Then
there is a canonical map
Zspec(G, Λ) →Zgeom
Hecke(G, Λ) ⊂Zgeom(G, Λ),

IX. THE HECKE ACTION
311
and in particular a map
ΨG : Zspec(G, Λ) →Z(G(E), Λ).
In general, there is such a map, up to replacing Z1(WE, bG)Λ  bG by a universally homeomorphic
scheme.
In particular, if Λ = L is an algebraically closed ﬁeld over Zℓ[√q], we get the following con-
struction of L-parameters.
Definition IX.0.4. Let L be an algebraically closed ﬁeld over Zℓ[√q], and let A ∈Dlis(BunG, L)
be a Schur-irreducible object, i.e. End(A) = L as condensed algebras.
Then there is a unique
semisimple L-parameter
ϕA : WE →bG(L) ⋊Q
such that for all excursion data (I, V, α, β, (γi)i∈I) consisting of a ﬁnite set I, V ∈Rep(( bG ⋊Q)I),
α : 1 →V | bG, β : V | bG →1 and γi ∈WE for i ∈I, the endomorphism
A = T1(A) α−→TV (A)
(γi)i∈I
−−−−→TV (A)
β−→T1(A) = A
is given by the scalar
L α−→V
(ϕA(γi))i∈I
−−−−−−−→V
β−→L.
We can apply this in particular in the case of irreducible smooth representations π of G(E).
Concerning the L-parameters we construct, we can prove the following basic results. (In fact, we
prove slightly ﬁner results on the level of Bernstein centers.)
Theorem IX.0.5 (Sections IX.6, IX.7).
(i) If G = T is a torus, then π 7→ϕπ is the usual Langlands correspondence.
(ii) The correspondence π 7→ϕπ is compatible with twisting.
(iii) The correspondence π 7→ϕπ is compatible with central characters (cf. [Bor79, 10.1]).
(iv) The correspondence π 7→ϕπ is compatible with passage to congradients (cf. [AV16]).
(v) If G′ →G is a map of reductive groups inducing an isomorphism of adjoint groups, π is an
irreducible smooth representation of G(E) and π′ is an irreducible constitutent of π|G′(E), then ϕπ′
is the image of ϕπ under the induced map bG →c
G′.
(vi) If G = G1 × G2 is a product of two groups and π is an irreducible smooth representation of
G(E), then π = π1 ⊠π2 for irreducible smooth representations πi of Gi(E), and ϕπ = ϕπ1 × ϕπ2
under bG = bG1 × bG2.
(vii) If G = ResE′|EG′ is the Weil restriction of scalars of a reductive group G′ over some ﬁnite sep-
arable extension E′|E, so that G(E) = G′(E′), then L-parameters for G|E agree with L-parameters
for G′|E′.
(viii) The correspondence π 7→ϕπ is compatible with parabolic induction.
(ix) For G = GLn and supercuspidal π, the correspondence π 7→ϕπ agrees with the usual local
Langlands correspondence [LRS93], [HT01], [Hen00].

312
IX. THE HECKE ACTION
IX.1. Condensed ∞-categories
In order to meaningfully talk about W I
E-equivariant objects in Dlis(BunG, Λ), we need to give
Dlis(BunG, Λ) the structure of a condensed ∞-category. This is in fact easy to do: We can associate
to any extremally disconnected proﬁnite set S the ∞-category Dlis(BunG ×S, Λ). This is a full
condensed ∞-subcategory of the condensed ∞-category D■(BunG, Λ), taking any proﬁnite S to
D■(BunG ×S, Λ). The latter deﬁnes a hypersheaf in S, by v-hyperdescent of D■(X, Λ) (as follows
from the case of D(Xv, Λ)). With this deﬁnition, it becomes a direct consequence of descent that
D■(BunG ×[∗/W I
E], Λ) ∼= D■(BunG, Λ)BW I
E,
where the latter is the evaluation of the condensed ∞-category D■(BunG, Λ) on the condensed an-
ima BW I
E. More concretely, this is the ∞-category of objects A ∈D■(BunG, Λ) together with a map
of condensed animated groups W I
E →Aut(A). We see in particular that to deﬁne D■(BunG, Λ)BW I
E,
we do not need to know the full structure as a condensed ∞-category. Rather, we only need the
structure as an ∞-category enriched in condensed anima. This structure on D■(BunG, Λ) induces
a similar structure on Dlis(BunG, Λ).
For the discussion of Hecke operators, we observe in particular the following result, that follows
directly from the discussion above.
Proposition IX.1.1. Pullback under BunG ×(Div1)I →BunG ×[∗/W I
E] induces a fully faithful
functor
Dlis(BunG, Λ)BW I
E ,→D■(BunG, Λ)BW I
E ∼= D■(BunG ×[∗/W I
E], Λ) ,→D■(BunG ×(Div1)I, Λ).
The essential image consists of all objects A ∈D■(BunG ×[∗/W I
E], Λ) whose pullback to BunG lies
in Dlis(BunG, Λ).
□
In fact, this structure of Dlis(BunG, Λ) as an ∞-category enriched in condensed anima, in fact
condensed animated Λ-modules, can be obtained in the following way from its structure as a Λ-
linear stable ∞-category.
Proposition IX.1.2. For A ∈Dlis(BunG, Λ)ω and B ∈Dlis(BunG, Λ), the condensed animated
Λ-module HomDlis(BunG,Λ)(A, B) is relatively discrete over Zℓ.
In other words, the condensed structure on Dlis(BunG, Λ) can also be deﬁned as the relatively
discrete condensed structure when restricted to compact objects, and in general induced from this.
In particular, when restricting attention to the compact objects Dlis(BunG, Λ)ω, it is simply the
relatively discrete condensed structure.
Proof. Take some b ∈B(G) and K ⊂Gb(E) an open pro-p-subgroup, and let fK : f
Mb/K →
BunG be the local chart. We can assume A = fK♮Zℓ, as these form a family of generators. By ad-
junction, it is enough to show that for any B′ ∈Dlis( f
Mb/K, Λ), the global sections RΓ( f
Mb/K, B′)
have the relatively discrete condensed Zℓ-module structure. We claim that the restriction map
RΓ( f
Mb/K, B′′) →RΓ([∗/K], B′) is an isomorphism, where [∗/K] ⊂f
Mb/K is the base point.
Without the condensed structure, this was proved in the proof of Proposition VII.7.2, but actu-
ally the proof applies with condensed structure (as Theorem VII.2.10 remembers the condensed

IX.2. HECKE OPERATORS
313
structure). But RΓ([∗/K], B′) is a direct summand of the stalk of B′ at ∗, which has the relatively
discrete condensed Zℓ-module structure (as this is true for all objects of Dlis(∗, Λ)).
□
IX.2. Hecke operators
The geometric Satake equivalence gives exact RepZℓ[√q](QI)-linear monoidal functors
RepZℓ[√q]( bG ⋊Q)I →PervULA(HckI
G, Zℓ[√q]) : V 7→SV .
Moreover, this association is functorial in I. We can compose with the functor A 7→D(A)∨(where
the Verdier duality is relative to the projection HckI
G →[(Div1)I/L+G]) to get exact RepZℓ[√q](QI)-
linear monoidal functors
RepZℓ[√q]( bG ⋊Q)I →D■(HckI
G, Zℓ[√q]),
functorially in I. Here, the functor A 7→D(A)∨is monoidal with respect to the usual convolution
on perverse sheaves, and the convolution of Section VII.5 on the right.
We note that as the
convolution on D■makes use only of pullback, tensor product, and π♮-functors, all of which are
deﬁned naturally on ∞-categories, this monoidal structure is actually a monoidal structure on
the ∞-category D■(HckI
G, Zℓ[√q]). (We would have to work harder to obtain this structure when
employing lower-!-functors, as we have not deﬁned them in a suﬃciently structured way.) Also,
the functor from RepZℓ[√q]( bG ⋊Q)I is monoidal in this setting, as on perverse sheaves there are no
higher coherences to take care of.
This extends by linearity uniquely to an exact RepΛ(QI)-linear monoidal functor
RepΛ( bG ⋊Q)I →D■(HckI
G, Λ) : V 7→S′
V ;
here, we implicitly use highest weight theory to show
Perf(B( bG ⋊Q)I
Zℓ[√q]) ⊗Perf(BQI
Zℓ[√q]) Perf(BQI
Λ) ∼= Perf(B( bG ⋊Q)I
Λ),
and that the free stable ∞-category with an exact functor from RepΛ( bG⋊Q)I is Perf(B( bG⋊Q)I
Λ).
Pulling back to the global Hecke stack, we get exact RepΛ(QI)-linear monoidal functors
RepΛ( bG ⋊Q)I →D■(HckI
G, Λ).
On the other hand, there is a natural exact RepΛ(QI)-linear monoidal functor
D■(HckI
G, Λ) →EndD■((Div1)I,Λ)(D■(BunG ×(Div1)I, Λ)),
where the right-hand side denotes the D■((Div1)I, Λ)-linear endofunctors. In particular, any V ∈
RepΛ( bG ⋊Q)I gives rise to a functor
TV : Dlis(BunG, Λ) →D■(BunG ×(Div1)I, Λ)
via
TV (A) = p2♮(p∗
1A
■⊗L
ΛS′
V )

314
IX. THE HECKE ACTION
where we consider the usual diagram
HckI
G
p1
{
p2
'
BunG
BunG ×(Div1)I.
Note that we have thus essentially used the translation of Proposition VII.5.2 to extend the Hecke
operators from the case of torsion rings Λ to all Λ.
We note that if we pull back to the diagonal geometric point Spd C →(Div1)I, where C = bE,
then this functor depends only on the composite
RepΛ( bG ⋊Q)I →D■(HckI
G, Λ) →D■(HckI
G ×(Div1)I Spd C, Λ),
and this composite factors naturally over RepΛ( bGI).
Proposition IX.2.1. For any V ∈RepΛ( bGI), the functor
TV : D■(BunG × Spd C, Λ) →D■(BunG × Spd C, Λ)
restricts to a functor
TV : Dlis(BunG, Λ) →Dlis(BunG, Λ).
Proof. By highest weight theory, one can reduce to the case that V is an exterior tensor
product of representations of bG, and then by using that V 7→TV is monoidal, we can reduce to the
tensor factors, which reduces us to the case I = {∗}. Consider the Hecke diagram
BunG,C
h1
←−HckG,C
h2
−→BunG,C
where HckG,C parametrizes over S ∈PerfC pairs of G-torsors E1, E2 on XS together with an isomor-
phism over XS\S♯meromorphic along S♯. It suﬃces to see that for all B ∈DULA(HckG,Spd C/Div1
X, Zℓ),
the object
h2♮(h∗
1A
■⊗Lq∗B∨) ∈Dlis(BunG,C, Λ).
Now the category of such B is generated (under colimits) by the objects Rf ˙w∗Zℓfor
f ˙w : L+I\Dem ˙w →HckG,Spd C/Div1
X
a Demazure resolution (modulo action of Iwahori) of some Schubert variety in the aﬃne ﬂag variety.
Using Proposition VII.4.3, it thus suﬃces to see that for the corresponding push-pull correspondence
on BunG,C with kernel given by the Demazure resolution, one has preservation of Dlis(BunG,C, Λ).
But this is a proper and cohomologically smooth correspondence.
□
Theorem IX.2.2. For any V ∈RepΛ( bGI), the action of TV on Dlis(BunG, Λ) preserves all
limits and colimits, and the full subcategories of compact objects, and of universally locally acyclic
objects. Moreover, for the automorphism sw∗of RepΛ( bGI) given by Proposition VI.12.1, there are
natural isomorphisms
DBZ(TV (A)) ∼= Tsw∗V ∨(DBZ(A)) , RHomlis(TV (A), Λ) ∼= Tsw∗V ∨RHomlis(A, Λ).

IX.2. HECKE OPERATORS
315
Proof. The functor V 7→TV is monoidal. As V is dualizable in the Satake category, with
dual V ∨, it follows that TV has a left and a right adjoint, given by TV ∨, and hence it fol-
lows formally that it preserves all limits and colimits, and compact objects.
Now recall that
A ∈Dlis(BunG, Λ) is universally locally acyclic if and only if for all compact B ∈Dlis(BunG, Λ),
the object R HomΛ(B, A) ∈D(Λ) is perfect, by Proposition VII.7.9. Thus, the preservation of
universally locally acyclic objects follows by adjointness from the preservation of compact objects.
For the duality statements, we note that, for π : BunG →∗the projection, there are natural
isomorphisms
π♮(TV (A)
■⊗L
ΛB) ∼= π♮(A
■⊗L
ΛTsw∗V (B)),
as follows from the deﬁnition of the Hecke operator, and Proposition VI.12.1: Both sides identify
with the homology of HckI
G ×(Div1)I Spd C with coeﬃcients in h∗
1A
■⊗L
Λh∗
2B
■⊗L
ΛS′
V . The displayed
equation implies the statement for Bernstein–Zelevinsky duals by also using that Tsw∗V ∨is right
adjoint to Tsw∗V , and the statement for naive duals by using that Tsw∗V ∨is left adjoint to Tsw∗V .
□
Composing Hecke operators, we get the following corollary.
Corollary IX.2.3. For any V ∈RepΛ( bG ⋊Q)I, the functor
TV : Dlis(BunG, Λ) →D■(BunG ×(Div1
X)I, Λ)
takes image in the full subcategory D■(BunG ×[∗/W I
E], Λ); moreover, all objects in the image have
the property that their pullback to D■(BunG, Λ) lies in Dlis(BunG, Λ), so by Proposition IX.1.1 the
functor TV induces a functor
Dlis(BunG, Λ) →Dlis(BunG, Λ)BW I
E.
Proof. We only need to see that the image lands in D■(BunG ×[∗/W I
E], Λ); the rest follows
from Proposition IX.2.1. One can reduce to the case that V is an exterior tensor product of |I|
representations Vi ∈RepΛ( bG ⋊Q) — one can always ﬁnd a, possibly inﬁnite, resolution by such
exterior tensor products that involves only ﬁnitely many weights of bGI, and thus induces a resolution
in D■(HckI
G, Λ) — and thus reduce to I = {∗}. By Corollary VII.2.7, it suﬃces to see that the
pullback to D■(BunG × Spd C, Λ) lies in D■(BunG, Λ). But by Proposition IX.2.1, we know that
it lies in Dlis(BunG × Spd C, Λ), and Dlis(BunG, Λ) →Dlis(BunG × Spd C, Λ) is an equivalence by
Proposition VII.7.3.
□
Finally, we get the following Hecke action.
Corollary IX.2.4. Endowing the stable Zℓ-linear ∞-category Dlis(BunG, Λ)ω with the rela-
tively discrete condensed structure, the Hecke action deﬁnes exact RepΛ(QI)-linear monoidal func-
tors
RepΛ( bG ⋊Q)I →EndΛ(Dlis(BunG, Λ)ω)BW I
E,
functorially in I.

316
IX. THE HECKE ACTION
IX.3. Cohomology of local Shimura varieties
Theorem IX.2.2 encodes strong ﬁniteness properties for the cohomology of local Shimura vari-
eties, giving unconditional proofs, and reﬁnements, of the results of [RV14, Section 6]. For this, we
ﬁrst specialize to E = Qp as this is the standard setting of local Shimura varieties. Consider any
local Shimura datum, consisting of a reductive group G over Qp, a conjugacy class of minuscule
cocharacters µ : Gm →GQp with ﬁeld of deﬁnition E|Qp and some element b ∈B(G, µ) ⊂B(G).
(Beware that we are making a small sin here in changing the meaning of the letter E, using it now
in its usual meaning as a reﬂex ﬁeld.) In [SW20, Lecture 24], we construct a tower of partially
proper smooth rigid-analytic spaces
(M(G,b,µ),K)K⊂G(Qp)
over ˘E, equipped with a Weil descent datum. Each object in the tower carries an action of Gb(Qp),
and the tower carries an action of G(Qp). Following Huber [Hub98], one deﬁnes
RΓc(M(G,b,µ),K,C, Zℓ) = lim
−→
U
RΓc(U, Zℓ)
where U ⊂M(G,b,µ),K,C runs through quasicompact open subsets, and one deﬁnes RΓc(U, Zℓ) =
lim
←−m RΓc(U, Z/ℓmZ). This carries an action of Gb(Qp) as well as an action of the Weil group WE.
Theorem IX.3.1. The complex RΓc(M(G,b,µ),K,C, Zℓ) is naturally a complex of smooth Gb(Qp)-
representations, and, if K is pro-p, a compact object in D(Gb(Qp), Zℓ). Moreover, the action of
WE is continuous.
In particular, each Hi
c(M(G,b,µ),K,C, Zℓ) is a ﬁnitely generated smooth Gb(Qp)-representation.
By descent, this is true even for all K (not necessarily pro-p).
Proof. Let fK : M(G,b,µ),K,C →Spa C be the projection. Up to shift, we can replace Zℓby
the dualizing complex Rf!
KZℓ. Now by Proposition VII.5.2, one has
RfK!Rf!
KZℓ|U ∼= fK♮Zℓ|U
for any quasicompact U ⊂M(G,b,µ),K,C. As the left-hand side is perfect, it is given by its limit
over reductions modulo ℓm. We see that Hi
c(M(G,b,µ),K,C, Zℓ) can be identiﬁed with Hi(fK♮Zℓ) up
to shift.
Now µ gives rise to a Hecke operator Tµ = TVµ where Vµ is the highest weight representation
of weight µ. It corresponds to the Hecke correspondence on BunG,C parametrizing modiﬁcations
of type µ; this Hecke correspondence is proper and smooth over both factors. We apply Tµ to the
compact object
A = j!c-IndG(Qp)
K
Zℓ∈Dlis(BunG, Zℓ)
where j : Bun1
G ∼= [∗/G(Qp)] ,→BunG is the open immersion. By Theorem IX.2.2, also Tµ(A) is
compact. By Proposition VII.7.4, it follows that also ib∗Tµ(A) ∈Dlis(Bunb
G, Zℓ) ∼= D(Gb(Qp), Zℓ)
is compact. But this is, up to shift again, precisely fK♮Zℓ, by the identiﬁcation of M(G,b,µ),K,C with
the space of modiﬁcations of G-torsors of type µ from the G-bundle Eb to the G-bundle E1, up to
the action of K (cf. [SW20, Lecture 23, 24]).

IX.3. COHOMOLOGY OF LOCAL SHIMURA VARIETIES
317
Descending to E, note that Tµ can be deﬁned with values in D■(BunG × Spd E/ϕZ, Zℓ), and
takes values in those sheaves whose pullback to BunG,C lies in Dlis(BunG, Zℓ). Thus WE, as a
condensed group, acts on ib∗Tµ(A) ∈Dlis(Bunb
G, Zℓ) ∼= D(Gb(Qp), Zℓ) considered as representations
on condensed Zℓ-modules. In classical language, this means that the action is continuous.
□
In particular, for each admissible representation ρ of Gb(Qp) on a Zℓ-algebra Λ, the complex
R HomGb(Qp)(RΓc(M(G,b,µ),K,C, Zℓ), ρ)
is a perfect complex of Λ-modules. Passing to the colimit over K, one obtains at least on each
cohomology group an admissible G(Qp)-representation. In fact, as Tµ is left adjoint to Tµ∨, we see
that this is (up to shift) given by
i1∗Tµ∨(Rib
∗[ρ]) ∈Dlis(Bun1
G, Λ) ∼= D(G(Qp), Λ).
Here ib : Bunb
G ,→BunG is the inclusion, and [ρ] ∈D(Gb(Qp), Λ) ∼= Dlis(Bunb
G, Λ) can be a complex
of smooth Gb(Qp)-representations. This shows in particular that there is in fact a natural complex
of admissible G(Qp)-representations underlying
R HomGb(Qp)(RΓc(M(G,b,µ),K,C, Zℓ), ρ).
Assuming again that ρ is admissible, one can pull through Verdier duality,
i1∗Tµ∨(Rib
∗[ρ]) ∼= i1∗Tµ∨(Rib
∗D([ρ∨]))
∼= i1∗Tµ∨(D(ib
! [ρ∨]))
∼= i1∗D(Tsw∗µ(ib
! [ρ∨]))
∼= D(i1∗Tsw∗µ(ib
! [ρ∨])).
As Tsw∗µ also preserves compact objects, it follows that [RV14, Remark 6.2 (iii)] has a positive
answer: If Λ = Qℓand ρ has ﬁnite length, then also each cohomology group of
R HomGb(Qp)(RΓc(M(G,b,µ),K,C, Zℓ), ρ)
has ﬁnite length. Indeed, with Qℓ-coeﬃcients, the category of smooth representations has ﬁnite
global dimension, and hence being compact is equivalent to each cohomology group being ﬁnitely
generated. Compact objects are preserved under the Hecke operators, and so we see that each
cohomology group is ﬁnitely generated. Being also admissible, it is then of ﬁnite length by Howe’s
theorem [Ren10, VI.6.3].
The same arguments apply to prove Corollary I.7.3. Let us recall the setup. We start with
a general E now. As in [SW20, Lecture XXIII], for any collection {µi}i of conjugacy classes of
cocharacters with ﬁelds of deﬁnition Ei/E and b ∈B(G), there is a tower of moduli spaces of local
shtukas
fK : (Sht(G,b,µ•),K)K⊂G(E) →
Y
i∈I
Spd ˘Ei
as K ranges over compact open subgroups of G(E), equipped with compatible ´etale period maps
πK : Sht(G,b,µ•),K →Grtw
G,Q
i∈I Spd ˘Ei,≤µ• .

318
IX. THE HECKE ACTION
Here, Grtw
G,Q
i∈I Spd ˘Ei →Q
i∈I Spd ˘E is a certain twisted form of the convolution aﬃne Grassman-
nian, cf. [SW20, Section 23.5]. Let W be the exterior tensor product ⊠i∈IVµi of highest weight
representations, and SW the corresponding sheaf on Grtw
G,Q
i∈I Spd ˘Ei. More precisely, away from
Frobenius-twisted partial diagonals, Grtw
G,Q
i∈I Spd ˘Ei is isomorphic to the Beilinson–Drinfeld Grass-
mannian GrG,Q
i∈I Spd ˘Ei, and we have deﬁned SW on this locus. One can uniquely extend over these
Frobenius-twisted partial diagonals to universally locally acyclic, necessarily perverse, sheaves, as in
the discussion of the fusion product. We continue to write SW for its pullback to Sht(G,b,µ•),K. Let
S′
W = D(SW )∨be the corresponding solid sheaf. By Proposition VII.5.2, with torsion coeﬃcients
fK♮S′
W agrees with RfK!SW , but fK♮S′
W is well-deﬁned in general.
Proposition IX.3.2. The sheaf
fK♮S′
W ∈D■([∗/Gb(E)] ×
Y
i∈I
Spd ˘Ei, Λ)
is equipped with partial Frobenii, thus descends to an object of
D■([∗/Gb(E)] ×
Y
i∈I
Spd ˘Ei/ϕZ
i , Λ).
This object lives in the full ∞-subcategory
D(Gb(E), Λ)B Q
i∈I WEi ⊂D■([∗/Gb(E))] ×
Y
i∈I
Spd ˘Ei/ϕZ
i , Λ),
and its restriction to D(Gb(E), Λ) is compact. In particular, for any admissible representation ρ of
Gb(E), the object
R HomGb(E)(fK♮S′
W , ρ) ∈D(Λ)B Q
i∈I WEi
is a representation of Q
i∈I WEi on a perfect complex of Λ-modules. Taking the colimit over K, this
gives rise to a complex of admissible G(E)-representations
lim
−→
K
R HomGb(E)(fK♮S′
W , ρ)
equipped with a Q
i∈I WEi-action.
If ρ is compact, then so is
lim
−→
K
R HomGb(E)(fK♮S′
W , ρ)
as a complex of G(E)-representations.
Proof. The key observation is that fK♮S′
W can be identiﬁed with TW (j![c-IndG(E)
K
Λ])|Bunb
G. A
priori, for the latter, we have to look at the moduli space M of modiﬁcations of type bounded by
µ• from Eb to the trivial vector bundle, up to the action of K, and take the homology of M with
coeﬃcients in S′
W ; more precisely, the relative homology of M →Q
i∈I Spd ˘Ei/ϕZ
i . After pull back
to Q
i∈I Spd ˘Ei, there is a natural map from M to Sht(G,b,µ•,K) that is an isomorphism away from
Frobenius-twisted partial diagonals. Indeed, Sht(G,b,µ•,K) parametrizes G-torsors over YS together
with an isomorphism with their Frobenius pullback away from the given points, together with a
level-K-trivialization of the G-bundle near {π = 0}. This induces two vector bundles on XS, given
by the bundles near {π = 0} and near {[ϖ] = 0}, and these are identiﬁed away from the images of

IX.5. THE BERNSTEIN CENTER
319
the punctures in XS. As long as their images in XS are disjoint, one can reverse this procedure.
Now the fusion compatibility of SW (and thus S′
W ) implies the desired result.
In particular, this shows that fK♮S′
W admits natural partial Frobenius operators. The rest of
the proof is now as before.
□
IX.4. L-parameter
We can now deﬁne L-parameter.
Definition/Proposition IX.4.1. Let L be an algebraically closed ﬁeld over Zℓ[√q], and let
A ∈Dlis(BunG, L) be a Schur-irreducible object, i.e. End(A) = L as condensed algebras. Then
there is a unique semisimple L-parameter
ϕA : WE →bG(L) ⋊Q
such that for all excursion data (I, V, α, β, (γi)i∈I) consisting of a ﬁnite set I, V ∈Rep(( bG ⋊Q)I),
α : 1 →V | bG, β : V | bG →1 and γi ∈WE for i ∈I, the endomorphism
A = T1(A) α−→TV (A)
(γi)i∈I
−−−−→TV (A)
β−→T1(A) = A
is given by the scalar
L α−→V
(ϕA(γi))i∈I
−−−−−−−→V
β−→L.
Proof. By the arguments of Section VIII.4, we can build excursion data as required for Propo-
sition VIII.3.8.
□
IX.5. The Bernstein center
As before, there is the problem that the stack Z1(WE, bG) of L-parameters is not quasicompact,
but an inﬁnite disjoint union. We can now actually decompose Dlis(BunG, Λ) into a direct product
according to the connected components of Z1(WE, bG). We start with the following observation.
Proposition IX.5.1. Let A ∈Dlis(BunG, Λ)ω be any compact object. Then there is an open
subgroup P ⊂WE of the wild inertia subgroup such that for all ﬁnite sets I and all V ∈Rep(( bG ⋊
Q)I), the object
TV (A) ∈Dlis(BunG, Λ)BW I
E
lies in the full ∞-subcategory
Dlis(BunG, Λ)B(WE/P)I ⊂Dlis(BunG, Λ)BW I
E.
Proof. First, note that indeed the functor
Dlis(BunG, Λ)B(WE/P)I →Dlis(BunG, Λ)BW I
E.
is fully faithful; this follows from fully faithfulness of the pullback functor
f∗: D■(BunG ×[∗/(WE/P)I], Λ) →D■(BunG ×[∗/W I
E], Λ),
which in turn follows from f♮Λ ∼= Λ (and the projection formula for f♮), which can be deduced
via base change from the case of [∗/W I
E] →[∗/(WE/P)I], or after pullback to a v-cover Spa C →

320
IX. THE HECKE ACTION
[∗/(WE/P)I], for [Spa C/P I] →Spa C, where it amounts to the vanishing of the Λ-homology of
P I.
Now note that if P I acts trivially on TV (A) and on TW (A) for two V, W ∈RepZℓ(( bG ⋊Q)I),
then it also acts trivially on TV ⊗W (A) = TV (TW (A)) = TW (TV (A)): Indeed, the W I⊔I
E
-action on
TV (TW (A)) ∼= TV ⊠W (A) ∼= TW (TV (A)) is trivial on P I⊔∅and P ∅⊔I, thus on P I⊔I, and hence the
diagonal W I
E-action is trivial on P I. Using reductions to exterior tensor products, we can also
reduce to I = {∗}. Then if V ∈RepZℓ( bG ⋊Q) is a ⊗-generator, it follows that it suﬃces that P
acts trivially on TV (A). But
Dlis(BunG, Λ)BWE =
[
P
Dlis(BunG, Λ)B(WE/P)
as for any relatively discrete condensed animated Zℓ-module M with a map WE →Aut(M), the
map factors over WE/P for some P. Indeed, one can reduce to M concentrated in degree 0, and
then to M ﬁnitely generated, so that Aut(M) is proﬁnite, and locally pro-ℓ.
□
Fix some open subgroup P of the wild inertia subgroup of WE, and let
DP
lis(BunG, Λ)ω ⊂Dlis(BunG, Λ)ω
be the full ∞-subcategory of all A such that P I acts trivially on TV (A) for all V ∈Rep(( bG ⋊Q)I).
Pick W ⊂WE/P a discrete dense subgroup, by discretizing the tame inertia, as before. Then
Theorem VIII.4.1 gives a canonical map of algebras
Exc(W, bG) →Z(DP
lis(BunG, Λ)ω) = π0End(idDP
lis(BunG,Λ)ω).
As Exc(W, bG) ⊗Λ →O(Z1(WE/P, bG)Λ) bG is a universal homeomorphism, there are in partic-
ular idempotents corresponding to the connected components of Z1(WE/P, bG)Λ. Their action on
DP
lis(BunG, Λ)ω then induces a direct sum decomposition
DP
lis(BunG, Λ)ω =
M
c∈π0Z1(WE/P, bG)Λ
Dc
lis(BunG, Λ)ω.
Taking now a union over all P, we get a direct sum decomposition
Dlis(BunG, Λ)ω =
M
c∈π0Z1(WE, bG)Λ
Dc
lis(BunG, Λ)ω.
On the level of Ind-categories, this gives a direct product
Dlis(BunG, Λ) =
Y
c∈π0Z1(WE, bG)Λ
Dc
lis(BunG, Λ).
Note in particular that any Schur-irreducible object A ∈Dlis(BunG, Λ) necessarily lies in one
of these factors, given by some connected component c of Z1(WE, bG)Λ; and then the L-parameter
ϕA of A necessarily lies in this connected component.

IX.5. THE BERNSTEIN CENTER
321
Using excursion operators, we get the following result on the “Bernstein center”. Note that for
G = GLn, all ℓare allowed, so this is a generalization of results of Helm–Moss, [HM18], noting
that by the fully faithful functor D(G(E), Λ) ,→Dlis(BunG, Λ), there is a map of algebras
Zgeom(G, Λ) →Z(G(E), Λ)
to the usual Bernstein center of smooth G(E)-representations on Λ-modules.
Theorem IX.5.2. Assume that ℓis invertible in Λ, or that ℓis a very good prime for bG. Then
there is a natural map
Zspec(G, Λ) →Zgeom(G, Λ)
compatible with the above decomposition into connected components. Moreover, for all ﬁnite sets I,
all V ∈RepΛ( bGI), and all A ∈Dlis(BunG, Λ), the diagram
Zspec(G, Λ)
/
'
End(A)

End(TV (A))
commutes, so the map factors over Zgeom
Hecke(G, Λ) ⊂Zgeom(G, Λ).
Of course, as noted above, in general we still have maps
Exc(W, bG) →Z(DP
lis(BunG, Λ)ω)
and Exc(W, bG) →O(Z1(WE/P, bG)) bG is a universal homeomorphism. The commutation with the
Hecke action is true here as well.
Proof. This follows from the decomposition into connected components, the map Exc(W, bG)Λ →
Z(DP
lis(BunG, Λ)ω) above, and Theorem VIII.3.6. The statement about commutation with Hecke
operators follows from the construction of excursion operators and the commutation of Hecke op-
erators.
□
Before going on, we make the following observation regarding duality. The Bernstein–Zelevinsky
duality functor DBZ on Dlis(BunG, Λ) induces an involution Dgeom of Zgeom(G, Λ). On the other
hand, on Z1(WE, bG), the Chevalley involution of bG induces an involution; after passing to the
quotient by the conjugation action of bG, we can also forget about the inner automorphism appearing
in Proposition VI.12.1. Let Dspec be the induced involution of Zspec(G, Λ).
Proposition IX.5.3. Assume that ℓis very good for bG, or ℓis invertible in Λ.
Then the
diagram
Zspec(G, Λ)
Dspec

/ Zgeom(G, Λ)
Dgeom

Zspec(G, Λ)
/ Zgeom(G, Λ)
commutes.
The formation of L-parameters for irreducible smooth representations of G(E) is compatible
with passage to Bernstein–Zelevinsky duals, and to smooth duals.

322
IX. THE HECKE ACTION
Proof. The commutation follows easily from the construction of excursion operators and
Proposition VI.12.1.
For the ﬁnal part, it now follows that the formation of L-parameters is
compatible with passage to Bernstein–Zelevinsky duals. For supercuspidal representations, this
agrees with the smooth dual. In general, the claim for smooth duals follows from the compatibility
with parabolic induction proved below.
□
IX.6. Properties of the correspondence
As usual, we ﬁx an open subgroup P of the wild inertia of WE (mapping trivially to Q), and a
discretization W ⊂WE/P.
IX.6.1. Isogenies.
Theorem IX.6.1. Let G′ →G be a map of reductive groups inducing an isomorphism of adjoint
groups, inducing a dual map bG →c
G′, and π : BunG′ →BunG. Then for any A ∈DP
lis(BunG, Λ)
the diagram
Exc(W, c
G′)Λ
/

End(π∗A)
Exc(W, bG)Λ
/ End(A)
O
commutes. In particular, if L is an algebraically closed ﬁeld, A is Schur-irreducible and A′ is a
Schur-irreducible constituent of π∗A, then ϕA′ is the composite of ϕA with bG →c
G′. Moreover, if
either ℓis invertible in Λ or ℓis very good for bG and c
G′, the diagram
Zspec(c
G′, Λ)
/

End(π∗A)
Zspec( bG, Λ)
/ End(A)
O
commutes.
Proof. Consider any excursion operator for G′, given by some ﬁnite set I, a representation
V ′ ∈RepΛ((c
G′ ⋊Q)I), maps α : 1 →V ′|c
G′, β : V ′|c
G′ →1 and elements γi ∈Γ as usual. Consider
the diagram
BunG′
π

HckI
G′
h′
1
o
πH

h′
2
/ BunG′ ×(Div1)I
π

BunG
HckI
G
h1
o
h2
/ BunG ×(Div1)I.
Then
TV ′(π∗A) = h′
2♮(h′∗
1 π∗A
■⊗L
ΛS′
V ′).

IX.6. PROPERTIES OF THE CORRESPONDENCE
323
We are interested in computing an endomorphism of π∗A; in particular, it is enough to compute
π♮TV ′(π∗A). But
π♮TV ′(π∗A) = π♮h′
2♮(h′∗
1 π∗A
■⊗L
ΛS′
V ′)
∼= h2♮πH♮(π∗
Hh∗
1A
■⊗L
ΛSV ′)
∼= h2♮(h∗
1A
■⊗L
ΛπH♮S′
V ′)
∼= h2♮(h∗
1A
■⊗L
ΛS′
V ) = TV (A).
This identiﬁcation is functorial in V ′ and I, and is over BunG ×(Div1)I, hence implies the desired
equality of excursion operators. Here, to identify πH♮SV ′, we use that the diagram
HckI
G′
/
πH

HckI
G′

HckI
G
/ HckI
G
is cartesian, and the compatibility of the geometric Satake equivalence with the map G →G′
inducing isomorphisms of adjoint groups, as in the proof of Theorem VI.11.1.
□
IX.6.2. Products.
Proposition IX.6.2. If G = G1 × G2 is a product of two groups, then the diagram
Exc(W, c
G1)Λ ⊗Λ Exc(W, c
G2)Λ
∼
=

/ Z(DP
lis(BunG1, Λ)) ⊗Λ Z(DP
lis(BunG2, Λ))

Exc(W, bG)
/ Z(DP
lis(BunG, Λ))
commutes.
In particular, if Λ = L is an algebraically closed ﬁeld and A1, A2 ∈Dlis(BunG, L) are Schur-
irreducible, and A is a Schur-irreducible constituent of A1 ⊠A2, then
ϕA = (ϕA1, ϕA2) : WE →bG(L) ∼= c
G1(L) × c
G2(L).
If ℓis invertible in Λ or is very good for c
G1 and c
G2, then the diagram
Zspec(G1, Λ) ⊗Λ Zspec(G2, Λ)
∼
=

/ Zgeom(G1, Λ) ⊗Λ Zgeom(G1, Λ)

Zspec(G, Λ)
/ Zgeom(G, Λ)
commutes.
Proof. The statement can be checked using excursion operators, and the proof is a straight-
forward diagram chase, noting that everything decomposes into products.
□

324
IX. THE HECKE ACTION
IX.6.3. Weil restriction.
Proposition IX.6.3. If G = ResE′|EG′ is a Weil restriction of scalars of some reductive group
G′ over some ﬁnite separable extension E′ of E. Choose P to be an open subgroup of the wild inertia
of WE′ ⊂WE, and let W ′ ⊂WE′/P be the preimage of W ⊂WE/P. Then there are canonical
identiﬁcations BunG′ ∼= BunG, Z1(WE, bG) ∼= Z1(WE′, c
G′) and Exc(W, bG) ∼= Exc(W ′, c
G′), and the
diagram
Exc(W ′, c
G′)
∼
=

/ Z(DP
lis(BunG′, Λ))
∼
=

Exc(W, bG)
/ Z(DP
lis(BunG, Λ))
commutes. In particular, L-parameters are compatible with Weil restriction. If ℓis invertible in Λ
or is very good for bG and c
G′, then the diagram
Zspec(G′, Λ)
∼
=

/ Zgeom(G′, Λ)
∼
=

Zspec(G, Λ)
/ Zgeom(G, Λ)
commutes.
Proof. The most nontrivial of these identiﬁcations is the identiﬁcation
Exc(W, bG) ∼= Exc(W ′, c
G′).
One way to understand this is to use the presentation
Exc(W, bG) = colim(n,Fn→W) O(Z1(Fn, bG))
bG
(and the similar presentation for Exc(W ′, c
G′)) and the natural isomorphism Z1(Fn, bG)  bG ∼=
Z1(Fn ×W W ′, c
G′)  c
G′ of aﬃne schemes (and then passing to global sections), noting that Fn ×W
W ′ ⊂Fn is a subgroup of ﬁnite index, and thus itself a ﬁnitely generated free group. This shows in
fact that restricting to those maps Fn →W factoring over W ′ produces the same colimit, and so
Exc(W, bG) = colim(n,Fn→W) O(Z1(Fn, bG))
bG
∼
←−colim(n,Fn→W ′) O(Z1(Fn, bG))
bG
∼= colim(n,Fn→W ′) O(Z1(Fn, c
G′))
c
G′
= Exc(W ′, c
G′).
Now consider an excursion operator for G′, including a representation V ′ of (c
G′ ⋊WE′)I. Note
that bG ⋊WE contains bG ⋊WE′ as a subgroup, and this admits a surjection onto c
G′ ⋊WE′ (noting
that bG = Q
E′,→E c
G′, where we picked out an embedding E′ ,→E and hence a projection bG →c
G′
when we regarded WE′ ⊂WE as a subgroup). In this way, one can inﬂate V ′ to a representation of

IX.6. PROPERTIES OF THE CORRESPONDENCE
325
( bG ⋊WE′)I and then induce to ( bG ⋊WE)I to get a representation V of ( bG ⋊WE)I. Geometrically,
this procedure amounts to the commutative diagram
BunG′
∼
=

HckI
G′
h′
1
o
h′
2 /
ψ

BunG′ ×(Div′1)I

BunG
HckI
G
h1
o
h2
/ BunG ×(Div1)I
and taking ψ∗on sheaves. More precisely, we note that
HckI
G′ →HckI
G ×(Div1)I(Div′1)I
is a closed immersion (and arises via pullback from a similar closed immersion of local Hecke stacks).
Now the claim follows from a diagram chase.
□
IX.6.4. Tori. If G = T is a torus, then
Dlis(BunT , Λ) ∼=
Y
b∈B(T)=π1(T)Γ
D(T(E), Λ)
and in particular
Zgeom(T, Λ) =
Y
b∈B(T)
Z(T(E), Λ)
where Z(T(E), Λ) is the Bernstein center of T(E); explicitly, this is
Z(T(E), Λ) =
lim
←−
K⊂T(E)
Λ[T(E)/K]
where K runs over open subgroups of T(E).
For tori, the representation theory of bT is semisimple even integrally, so we get a map
Zspec(T, Λ) →Zgeom(T, Λ).
Proposition IX.6.4. There is a natural isomorphism
Zspec(T, Λ) ∼=
lim
←−
K⊂T(E)
Λ[T(E)/K].
Proof. One can resolve T by products of induced tori and then reduce to the case that T
is induced, and then by Weil restrictions of scalars to T = Gm.
In that case Z1(WE, Gm) =
Hom(E∗, Gm) by local class ﬁeld theory, giving the result.
□
Proposition IX.6.5. Under the above identiﬁcations
Zspec(T, Λ) =
lim
←−
K⊂T(E)
Λ[T(E)/K]
and
Zgeom(T, Λ) =
Y
b∈B(T)
lim
←−
K⊂T(E)
Λ[T(E)/K],
the map
Zspec(T, Λ) →Zgeom(T, Λ)

326
IX. THE HECKE ACTION
is the diagonal embedding.
Proof. We may resolve T by induced tori and use Theorem IX.6.1, Proposition IX.6.2 and
Proposition IX.6.3 to reduce to the case of T = Gm. It is enough to compute the excursion operators
corresponding to I = {1, 2}, V = std ⊠std∨and the tautological maps α : 1 →std ⊗std∨and
β : std ⊗std∨→1. It is then an easy consequence of Section II.2.1.
□
Proposition IX.6.5 in particular shows that the L-parameters we construct for tori are the
usual L-parameters, and together with Theorem IX.6.1 and Proposition IX.6.2 implies that L-
parameters are compatible with central characters (in case of connected center) and twisting, by
applying Theorem IX.6.1 to the maps Z × G →G and G →G × D where Z ⊂G is the center and
G →D is the quotient by the derived group. To deduce compatibility with central characters in
general, one can reduce to the case of connected center using z-extensions [Kal18, Section 5].
IX.7. Applications to representations of G(E)
Finally, we apply the preceding results to representations of G(E). To simplify the statements,
we assume from now on that either ℓis invertible in Λ, or that ℓis very good for bG; in general,
similar statements hold true up to replacing O(Z1(WE/P, bG)) bG by the algebra Exc(W, bG) as above.
We get the following map to the Bernstein center.
Definition IX.7.1. The map
ΨG : Zspec(G, Λ) →Z(G(E), Λ)
is the composite
Zspec(G, Λ) →Zgeom(G, Λ) →Z(G(E), Λ)
induced by the fully faithful functor
j! : D(G(E), Λ) ∼= Dlis(Bun1
G, Λ) →Dlis(BunG, Λ).
More generally, for any b ∈B(G), we can deﬁne a map
Ψb
G : Zspec(G, Λ) →Z(Gb(E), Λ)
to the Bernstein center for Gb(E) by using the fully faithful embedding
D(Gb(E), Λ) ∼= Dlis(Bunb
G, Λ) →Dlis(BunG, Λ)
determined for example by the left adjoint to ib∗, where ib : Bunb
G ,→BunG is the locally closed
embedding (see Proposition VII.7.2). (Recall that in the Dlis-setting, we do not have a general
ib
! -functor, although it can be deﬁned in the present situation. All these maps will induce the same
map to the Bernstein center.)

IX.7. APPLICATIONS TO REPRESENTATIONS OF G(E)
327
IX.7.1. Compatibility with Gb. One can describe the maps Ψb
G for b ̸= 1 in terms of the
maps ΨGb. Note that c
Gb is naturally a Levi subgroup of bG, as Gb, ˘E ⊂G ˘E is the centralizer of the
slope morphism νb : D →G ˘E. This extends naturally to a morphism of L-groups
c
Gb ⋊Q →bG ⋊Q
where as usual Q is a ﬁnite quotient of WE over which the action on bG factors. However, from
geometric Satake we rather get the natural inclusion
Gb
V
⋊WE →G
V
⋊WE
where the WE-actions include the cyclotomic twist. The latter induces a map
Z1(WE, c
Gb) →Z1(WE, bG)
that in terms of the usual WE-action is given by sending a 1-cocycle ϕ : WE →c
Gb(A) to the
1-cocycle
WE →bG(A) : w 7→(2ρ bG −2ρc
Gb)(√q)|w|ϕ(w)
where | · | : WE →WE/IE ∼= Z is normalized as usual by sending a geometric Frobenius to 1.
Theorem IX.7.2. For all G and b ∈B(G), the diagram
Zspec(G, Λ)
Ψb
G /

Z(D(Gb(E), Λ))
Zspec(Gb, Λ)
ΨGb
6
commutes.
Proof. We note that to prove the theorem, we can assume that Λ is killed by power of ℓ(if ℓ
is not very good for bG, replacing the left-hand side with an algebra of excursion operators), as the
result for Λ = Zℓ[√q] implies it in general, and the right-hand side
Z(D(Gb(E), Λ)) =
lim
←−
K⊂Gb(E)
Z(Λ[Gb(E)  K])
is ℓ-adically separated in that case. This means we can avoid the subtleties of Dlis in place of D´et.
If b is basic, the theorem follows from the identiﬁcation BunG ∼= BunGb of Corollary III.4.3,
which is equivariant for the Hecke action.
In general, we ﬁrst reduce to the case that G is quasisplit.
Take a z-embedding G ,→G′
as in [Kal18, Section 5], with quotient a torus D, so that the center Z(G′) is connected. Then
BunG = BunG′ ×BunD{∗} and the map B(G) →B(G′) is injective.
To see the latter, by the
description of the stacks, it suﬃces to see that for all b ∈B(G) with image b′ ∈B(G′), the map
G′
b′(E) →D(E) is surjective. But for any b ∈B(G), the map Gb →G′
b′ is a z-embedding with
quotient D, and Z′(E) →D(E) is surjective by [Kal18, Fact 5.5], where also Z′ ⊂G′
b′, so in
particular G′
b′(E) →D(E) is surjective. An element of
Z(D(Gb(E), Λ)) =
lim
←−
K⊂Gb(E)
Z(Λ[Gb(E)  K])

328
IX. THE HECKE ACTION
of the Bernstein center of Gb(E) is determined by its action on π′|Gb(E) for representations π′ of
G′
b′(E). By Theorem IX.6.1, we can thus reduce to G′ in place of G, i.e. that the center of G is
connected. When Z(G) is connected, there is some basic b0 ∈B(G) such that Gb0 is quasisplit.
Using the Hecke-equivariant isomorphism BunG ∼= BunGb0 we can thus assume that G is quasisplit.
Now if G is quasisplit, ﬁx a Borel B ⊂G. Any b ∈B(G) then admits a reduction to a canonical
parabolic P = Pb ⊂G containing B. Pick a cocharacter µ : Gm →G with dynamical parabolic P.
For any N ≥0, let bN = bµ(πN): This is a sequence of elements of B(G) associated to the same
parabolic P but increasingly instable. Moreover, Gb = GbN . We note that the diagram
Zspec(G, Λ)
Ψb
G /
=

Z(Gb(E), Λ)
=

Zspec(G, Λ)
ΨbN
G / Z(GbN (E), Λ)
commutes. For this, take any representation σ of Gb(E) and consider the sheaf AN ∈D´et(BunG, Λ)
concentrated on BunbN
G , corresponding to the representation σ. Let V ∈Rep bG be the highest
weight representation with weight µN. We claim that TV (AN)|Bunb
G is given by the representation
σ.
As Hecke operators commute with excursion operators, this implies the desired result.
To
compute TV (AN)|Bunb
G, we have to analyze the moduli space of modiﬁcations of Eb of type bounded
by µN that are isomorphic to EbN . There is in fact precisely one such modiﬁcation, given by pushout
of the standard modiﬁcation of line bundles from O to O(1) via µN : Gm →G; its type is exactly
µN. This gives the claim.
Now to prove the theorem, we have to prove the commutativity of the diagram for any excursion
operator, given by excursion data (I, V, α, β, (γi)i∈I). For any such excursion data, we can pick N
large enough so that any modiﬁcation of EbN to itself, of type bounded by V , is automatically
compatible with the Harder–Narasimhan reduction to P. In that case, for σ and AN as above, to
analyze the excursion operators
AN = T1(AN) α−→TV (AN)
(γi)i∈I
−−−−→TV (AN)
β−→T1(AN) = AN,
we have to analyze the moduli space of modiﬁcations of EbN , at I varying points, of type bounded
by V , and that are isomorphic to EbN .
By assumption on N, this is the same as the moduli
space of such modiﬁcations as P-bundles. This maps to the similar moduli space parametrizing
modiﬁcations as M-bundles, where M is the Levi of P (and Gb = MbM for a basic bM ∈B(M)).
We want to compute TV (AN). Note that AN comes from A′
N ∈D´et(BunP , Λ) as it is concentrated
on BunbN
G ∼= BunbN
P ⊂BunP , by the Harder–Narasimhan reduction.

IX.7. APPLICATIONS TO REPRESENTATIONS OF G(E)
329
Consider the diagram
BunM
ψ

HckI
M,P
ψH

h′′
1
o
h′′
2
/ BunP ×(Div1)I
=

BunP
π

HckI
P
h′
1
o
πH

h′
2
/ BunP ×(Div1)I
π

BunM
HckI
M
h1
o
h2
/ BunM ×(Div1)I
where HckI
M,P is deﬁned as the ﬁbre product HckI
P ×BunP BunM, and thus parametrizes modiﬁca-
tions from an M-bundle to a P-bundle.
We need to compute TV (AN)|BunbN
G , which by the above argument that any modiﬁcation of EbN
to itself of type bounded by V is a modiﬁcation as P-bundles, can be computed in terms of the
middle diagram, as
Rh′
2!(h′∗
1 A′
N ⊗L
Λ SV )|BunbN
P
where SV ∈HckI
G is the perverse sheaf determined by V under the geometric Satake equivalence,
and we continue to denote by SV any of its pullbacks.
There is some BN ∈D´et(BunM, Λ) such that A′
N = Rψ!BN. In fact, one can take BN = Rπ!A′
N,
noting that on the support of A′
N, the map π : BunP →BunM is (cohomologically) smooth, so
Rπ! is deﬁned on A′
N (although π is a stacky map). (Indeed, everything is concentrated on one
stratum, and the relevant categories are all equivalent to D(Gb(E), Λ).) Moreover, to compute the
restriction to BunbN
P
it is enough to do the computation after applying Rπ!. We compute:
Rπ!Rh′
2!(h′∗
1 A′
N ⊗L
Λ SV ) = Rπ!Rh′
2!RψH!(h′′∗
1 BN ⊗L
Λ SV )
= Rh2!(h∗
1BN ⊗L
Λ Rg!SV )
where g : HckI
M,P →HckI
M is the projection. But this is the pullback of the map L+M\ GrI
P →
L+M\ GrI
M = HckI
M under HckI
M →HckI
M. This means that Rg!SV arises via pullback from
CTP (SV ) ∈D´et(HckI
M, Λ). Up to the shift [degP ], this agrees with SV |( c
M⋊Q)I , where the restriction
involves a cyclotomic twist, as above. (It is the canonical restriction along M
V
→G
V
for the canonical
WE-actions arising geometrically.) Now the excursion operators, which involve maps from and to
the sheaf corresponding to V = 1, require only the connected component where degP = 0, so we
can ignore the shift.
With these translations, we see that the excursion operators on BunbN
G
and on BunbN
M agree,
giving the desired result.
□
IX.7.2. Parabolic induction. A corollary of this result is compatibility with parabolic in-
duction.

330
IX. THE HECKE ACTION
Corollary IX.7.3. Let G be a reductive group with a parabolic P ⊂G and Levi P →M. Then
for all representations σ of M(E) with (unnormalized) parabolic induction IndG(E)
P(E)σ, the diagram
Zspec(G, Λ)
/

End(IndG(E)
P(E)σ)
Zspec(M, Λ)
/ End(σ)
O
commutes. In particular, the formation of L-parameters is compatible with parabolic induction:
If Λ = L is an algebraically closed ﬁeld, σ is irreducible and eσ is an irreducible subquotient of
IndG(E)
P(E)σ, then ϕeσ is conjugate to the composite
WE
ϕσ
−−→c
M(L) ⋊WE →bG(L) ⋊WE
where the map c
M ⋊WE →bG ⋊WE is deﬁned as above, involving the cyclotomic twist.
Proof. It suﬃces to prove the result for σ = c-IndM(E)
K
Λ for K ⊂M(E) an open pro-p-
subgroup, and then one can assume Λ = Zℓ[√q], where one can further by ℓ-adic separatedness
reduce to torsion coeﬃcients.
Let µ : Gm →G be a cocharacter with dynamical parabolic P and let b = µ(π) ∈B(G).
Then Gb = M, and we can build a sheaf A ∈D´et(BunG, Λ) concentrated on Bunb
G, given by the
representation σ. Let V ∈Rep( bG) be a highest weight representation of weight µ. Then TV (A)|Bun1
G
is given by IndG(E)
P(E)σ: To see this, we have to understand the moduli space of modiﬁcation of the
trivial G-torsor of type bounded by µ that are isomorphic to Eb. This is in fact given by G(E)/P(E),
the G(E)-orbit of the pushout of the modiﬁcation from O to O(1) via µ. All of these modiﬁcations
are of type exactly µ. This easily gives the claim on TV (A)|Bun1
G. Now as Hecke operators commute
with excursion operators, the excursion operators on IndG(E)
P(E)σ agree with those on A, and these
are determined by Theorem IX.7.2, giving the result.
□
IX.7.3. The case G = GLn. For the group G = GLn, we can identify the L-parameters
with the usual L-parameters of [LRS93], [HT01], [Hen00]. This is the only place of this paper
where we rely on previous work on the local Langlands correspondence, or (implicitly) rely on
global arguments. More precisely, we use the identiﬁcation of the cohomology of the Lubin–Tate
and Drinfeld tower, see [Boy99], [Har97], [HT01], [Hau05], [Dat07]. In the proof, we use the
translation between Hecke operators and local Shimura varieties as Section IX.3, together with the
description of these as the Lubin–Tate tower and Drinfeld tower in special cases, see [SW13].
Theorem IX.7.4. Let π be any irreducible smooth representation of GLn(E) over some alge-
braically closed ﬁeld L over Qℓ(√q). Then the L-parameter ϕπ agrees with the usual (semisimpliﬁed)
L-parameter.
Proof. By Corollary IX.7.3, we can assume that π is supercuspidal. We only need to evaluate
the excursion operators for the excursion data given by I = {1, 2}, the representation V = std⊠std∨

IX.7. APPLICATIONS TO REPRESENTATIONS OF G(E)
331
of d
GLn
2, and the tautological maps α : 1 →std ⊗std∨and β : std ⊗std∨→1, as these excursion
operators determine the trace of the representation (and thus the semisimpliﬁed representation).
First, we analyze these excursion operators on the sheaf B which is the sheaf on Bunb
GLn for
b corresponding to the bundle O(−1
n), given by the representation σ = JL(π) of D×; here D is
the division algebra of invariant
1
n. The Hecke operator TV is the composite of two operators.
The ﬁrst Hecke operator, corresponding to std, takes minuscule modiﬁcations O(−1
n) ⊂E with
cokernel a skyscraper sheaf of rank 1. Such an E is necessarily isomorphic to On, and the Hecke
operator will then produce the σ-isotypic part of the cohomology of the Lubin–Tate tower, which
is π ⊗ρπ, where ρπ is the irreducible n-dimensional WE-representation associated to π by the
local Langlands correspondence. (Note that the shift [n −1], as well as the cyclotomic twist ( n−1
2 )
that usually appears, is hidden inside the normalization of the perverse sheaf corresponding to the
standard representation.) Now the second Hecke operator, when restricted to Bunb
GLn, produces
the π-isotypic component of the cohomology of the Drinfeld tower, which is σ ⊗ρ∗
π. In total, we see
that TV (B)|Bunb
GLn is given by π ⊗ρπ ⊗ρ∗
π as representation of D× × WE × WE. By irreducibility
of ρπ, the WE-equivariant map σ →σ ⊗ρπ ⊗ρ∗
π induced by α (and the similar backwards induced
by β) must agree up to scalar with the obvious map. The scalar of the total composite can be
identiﬁed by taking both elements of WE to be equal to 1. This shows that B has the correct
L-parameter. Now use that the sheaf corresponding to π appears as a summand of Tstd(B) (after
forgetting the WE-action) to conclude the same for π.
□
In particular, it follows that the map
Zspec(GLn, Qℓ) →Z(GLn(E), Qℓ)
to the Bernstein center agrees with the usual map. We recall that we have already proved that this
map reﬁnes to a map
Zspec(GLn, Λ) →Z(GLn(E), Λ)
to the integral Bernstein center (where Λ = Zℓ[√q]), recovering a result of Helm–Moss [HM18].


CHAPTER X
The spectral action
As a ﬁnal topic, we construct the spectral action. We will ﬁrst construct it with characteristic
0 coeﬃcients, and then explain reﬁnements with integral coeﬃcients.
Let Λ be the ring of integers in a ﬁnite extension of Qℓ(√q). We have the stable ∞-category
C = Dlis(BunG, Λ)ω of compact objects, which is linear over Λ, and functorially in the ﬁnite set I
an exact monoidal functor RepΛ( bG ⋊Q)I →EndΛ(C)BW I
E that is linear over RepΛ(QI). A ﬁrst
version of the following theorem is due to Nadler–Yun [NY19] in the context of Betti geometric
Langlands, and a more general version appeared in the work of Gaitsgory–Kazhdan–Rozenblyum–
Varshavsky [GKRV19]. Both references, however, eﬀectively assume that G is split, work only
with characteristic 0 coeﬃcients, and work with a discrete group in place of WE. At least the
extension to Zℓ-coeﬃcients is a nontrivial matter.
Note that Z1(WE, bG) is not quasicompact, as it has inﬁnitely many connected components; it
can be written as the increasing union of open and closed quasicompact subschemes Z1(WE/P, bG).
We say that an action of Perf(Z1(WE, bG)/ bG) on a stable ∞-category C is compactly supported if
for all X ∈C the functor Perf(Z1(WE, bG)/ bG) →C (induced by acting on X) factors over some
Perf(Z1(WE/P, bG)/ bG).
The goal of this chapter is to prove the following theorem. Recall that for G = GLn, all ℓare
very good, and for classical groups, all ℓ̸= 2 are very good.
Theorem X.0.1. Assume that ℓis a very good prime for bG. Let C be a small idempotent-
complete Λ-linear stable ∞-category. Then giving, functorially in the ﬁnite set I, an exact RepΛ(QI)-
linear monoidal functor
RepΛ( bG ⋊Q)I →EndΛ(C)BW I
E
is equivalent to giving a compactly supported Λ-linear action of
Perf(Z1(WE, bG)Λ/ bG).
Here, given a Λ-linear action of Perf(Z1(WE, bG)Λ/ bG), one can produce such an exact RepΛ(QI)-
linear monoidal functor
RepΛ( bG ⋊Q)I →EndΛ(C)BW I
E
functorially in I by composing the exact RepΛ(QI)-linear symmetric monoidal functor
RepΛ( bG ⋊Q)I →Perf(Z1(WE, bG)Λ/ bG)BW I
E
with the action of Perf(Z1(WE, bG)Λ/ bG).
The same result holds true if Λ is a ﬁeld over Qℓ(√q), for any prime ℓ.
333

334
X. THE SPECTRAL ACTION
Here, the exact RepΛ(QI)-linear symmetric monoidal functor
RepΛ( bG ⋊Q)I →Perf(Z1(WE, bG)Λ/ bG)BW I
E
is induced by tensor products and the exact RepΛ(Q)-linear symmetric monoidal functor
RepΛ( bG ⋊Q) →Perf(Z1(WE, bG)Λ/ bG)BWE
corresponding to the universal bG ⋊Q-torsor, with the universal WE-equivariance as parametrized
by Z1(WE, bG)/ bG.
Before starting the proof, we note that the proof of Proposition IX.5.1 shows that we may
replace WE by WE/P in the statement of Theorem X.0.1. Choosing moreover a discretization
W ⊂WE/P, we reduce to the following variant.
Theorem X.0.2. Assume that ℓis a very good prime for bG. Let C be a small idempotent-
complete Λ-linear stable ∞-category. Then giving, functorially in the ﬁnite set I, an exact RepΛ(QI)-
linear monoidal functor
RepΛ( bG ⋊Q)I →EndΛ(C)BW I
is equivalent to giving a Λ-linear action of
Perf(Z1(W, bG)Λ/ bG),
with the same compatibility as above. The same result holds true if Λ is a ﬁeld over Qℓ, for any
prime ℓ.
X.1. Rational coeﬃcients
With rational coeﬃcients, we can prove a much more general result, following [GKRV19].
Consider a reductive group H over a ﬁeld L of characteristic 0 (like bG over Qℓ) with an action of
a ﬁnite group Q. Let S be any anima over BQ (like BW, where W ⊂WE/P is a discretization of
WE/P for an open subgroup of the wild inertia, as usual). We can then consider the (derived) stack
MapBQ(S, B(H ⋊Q)) over L, whose values in an animated L-algebra A are the maps of anima
S →B(H ⋊Q)(A) over BQ. This recovers the stack [Z1(W, bG)Qℓ/ bG] in the above example, using
Proposition VIII.3.5.
In general, MapBQ(S, B(H ⋊Q)) is the fpqc quotient of an aﬃne derived scheme by a power
of H. Indeed, pick a surjection S′ →S ×BQ ∗from a set S′. Then MapBQ(S, B(H ⋊Q)) maps
to BHS′; we claim that the ﬁbre is an aﬃne derived scheme, i.e. representable by an animated
L-algebra. For this, note that
MapBQ(S, B(H ⋊Q)) →Map(S ×BQ ∗, BH)
is relatively representable, as it is given by the Q-ﬁxed points. To show that the right-hand side
is relatively representable over BHS′, we can replace S ×BQ ∗by a connected anima T, and S′
by a point. Then Map(T, BH) ×BH ∗parametrizes pointed maps T →BH, which are equivalent
to maps of E1-groups Ω(T) →H. Writing Ω(T) as a sifted colimit of ﬁnite free groups Fn, one
reduces to representability of maps of groups Fn →H, which is representable by Hn.

X.1. RATIONAL COEFFICIENTS
335
Theorem X.1.1. Let C be an idempotent-complete small stable L-linear ∞-category. Giving,
functorially in ﬁnite sets I, an exact RepL(QI)-linear monoidal functor
RepL((H ⋊Q)I) →EndL(C)SI
is equivalent to giving an L-linear action of Perf(MapBQ(S, B(H ⋊Q))) on C. Here, given such an
action of Perf(MapBQ(S, B(H ⋊Q))), one gets exact RepL(QI)-linear monoidal functors
RepL((H ⋊Q)I) →EndL(C)SI
by precomposing the exact monoidal functor Perf(MapBQ(S, B(H ⋊Q))) →EndL(C) with the nat-
ural exact RepL(QI)-linear symmetric monoidal functor
RepL((H ⋊Q)I) →Perf(MapBQ(S, B(H ⋊Q)))SI
given by I-fold tensor product of the exact RepL(Q)-linear symmetric monoidal functor
RepL(H ⋊Q) →Perf(MapBQ(S, B(H ⋊Q)))S
assigning to each s ∈S pullback along evaluation at s, MapBQ(S, B(H ⋊Q)) →B(H ⋊Q).
Proof. Note ﬁrst that, for any L-linear idempotent-complete small stable ∞-category C, giving
an exact L-linear functor RepL((H ⋊Q)I) →C is equivalent to giving an exact L-linear functor of
stable ∞-categories Perf((H ⋊Q)I) →C, as the ∞-category of perfect complexes is freely generated
by the exact category of representations. Indeed, such functors extend to the ∞-category obtained
by inverting quasi-isomorphisms in Chb(RepL(H ⋊Q)I), and this is Perf(B(H ⋊Q)I).
For any S, we have the anima F1(S) of L-linear actions of Perf(MapBQ(S, B(H ⋊Q))) on C,
and the anima F2(S) of functorial exact monoidal functors
RepL((H ⋊Q)I) →EndL(C)SI
linear over RepL(QI), and a natural map F1(S) →F2(S) functorial in S (where both F1 and F2
are contravariant functors of S). Both functors take sifted colimits in S to limits. This is clear
for F2 (as S 7→SI commutes with sifted colimits). For F1, it is enough to see that taking S to
Perf(MapBQ(S, B(H ⋊Q))) commutes with sifted colimits (taken in idempotent-complete stable
∞-categories), which is Lemma X.1.2 below.
Therefore it suﬃces to handle the case that S is a ﬁnite set, for which the map S →BQ can
be factored over ∗. Then MapBQ(S, B(H ⋊Q)) ∼= BHS. Similarly, exact monoidal functors
RepL((H ⋊Q)I) →EndL(C)SI
linear over RepL(QI) are equivalent to exact monoidal functors
RepL(HI) →EndL(C)SI
linear over L. Here, we use Perf(B(H ⋊Q)I) ⊗Perf(BQI) Perf(L) ∼= Perf(BHI), which follows easily
from highest weight theory.
The latter data is equivalent to maps
Hom(I, S) = SI →Funmon
ex,L(RepL(HI), EndL(C))

336
X. THE SPECTRAL ACTION
functorially in I, where Funmon
ex,L denotes the exact L-linear monoidal functors. Both sides here are
functors in I, and on the left-hand side we have a representable functor. By the Yoneda lemma, it
follows that this data is equivalent to L-linear exact monoidal functors
RepL(HS) →EndL(C).
Such actions extend uniquely to Perf(BHS), giving the desired result.
□
Lemma X.1.2. The functor taking an anima S over BQ to Perf(MapBQ(S, B(H⋊Q))), regarded
as an idempotent-complete stable ∞-category, commutes with sifted colimits. More precisely, as a
functor into L-linear symmetric monoidal idempotent-complete stable ∞-categories, it commutes
with all colimits.
Proof. We ﬁrst check that it commutes with ﬁltered colimits. For this, let Si, i ∈I, be a
ﬁltered diagram of anima over BQ, and choose compatible surjections S′
i →Si ×BQ ∗from sets S′
i.
Let S = colimi Si and S′ = colimi S′
i, which is a set surjecting onto S ×BQ ∗. Letting Gi = HS′
i
and G = HS′, we get presentations MapBQ(Si, B(H ⋊Q)) = Xi/Gi as quotients of aﬃne derived
L-schemes Xi by the pro-reductive group Gi, and similarly MapBQ(S, B(H ⋊Q)) = X/G, with
X = lim
←−i Xi and G = lim
←−i Gi. We claim that in this generality
lim
−→
i
Perf(Xi/Gi) →Perf(X/G)
is an isomorphism of idempotent-complete stable ∞-categories.
Assume ﬁrst that all X = Spec L are a point. Then note that Perf(BG) is generated by Rep(G),
which is easily seen to be the ﬁltered colimit lim
−→i Rep(Gi), and (by writing it as limit of reductive
groups) is seen to be semisimple. The claim is easily checked in this case.
In general, Perf(X/G) is generated by Rep(G) as an idempotent complete stable ∞-category.
Indeed, given any perfect complex A ∈Perf(X/G), we can look at the largest n for which the
cohomology sheaf Hn(A) is nonzero; after shift, n = 0. Pick V ∈Rep(G) with a map V →H0(A)
such that V ⊗L OX/G →H0(A) is surjective. By semisimplicity of Rep(G), we can lift V →H0(A)
to V →A, and then pass to the cone of V ⊗L OX/G →A to reduce the projective amplitude until
A is a vector bundle. In that case the homotopy ﬁbre B of V ⊗L OX/G →A is again a vector
bundle, and the map V ⊗L OX/G →A splits, as the obstruction is H1(X/G, A∨⊗OX/G B), which
vanishes by semisimplicity of Rep(G).
This already proves essential surjectivity.
For fully faithfulness, it suﬃces by passage to
internal Hom’s to show that for all Ai0 ∈Perf(Xi0/Gi0) (for some chosen i0) with pullbacks
Ai ∈Perf(Xi/Gi) for i →i0 and A ∈Perf(X/G), the map lim
−→i RΓ(Xi/Gi, Ai) →RΓ(X/G, A) is
an isomorphism. By semisimplicity of Rep(Gi) and Rep(G), it suﬃces to see that lim
−→i RΓ(Xi, Ai) →
RΓ(X, A) is an isomorphism, which is clear by aﬃneness.
This handles the case of ﬁltered colimits. For the more precise claim, it is also easy to see that
it commutes with disjoint unions. It is now enough to handle pushouts, so consider a diagram
S1 ←S0 →S2 of anima over BQ, with pushout S. We can assume that the maps S0 →S1 and
S0 →S2 are surjective, as otherwise we can use compatibility with disjoint unions (replacing S2 by
the disjoint union of the image of S0 and its complement). Then choose a surjection S′ →S0×BQ∗,

X.1. RATIONAL COEFFICIENTS
337
which induces similar surjections in the other cases. Thus, we get aﬃne derived L-schemes X1 →
X0 ←X2 with actions by G = HS′, and X = X1 ×X0 X2, and we want to see that the functor
Perf(X1/G) ⊗Perf(X0/G) Perf(X2/G) →Perf(X1 ×X X2/G)
is an equivalence.
On the level of Ind-categories, Ind Perf(Xi/G) is the ∞-category of O(Xi)-
modules in Ind Perf(BG): This is a consequence of Barr–Beck and the fact observed above that
Perf(BG) generates Perf(Xi/G), so that the forgetful functor Ind Perf(Xi/G) →Ind Perf(BG)
is conservative.
It follows that the tensor product is the ∞-category of O(X1) ⊗O(X0) O(X2)-
modules in Ind Perf(BG), the tensor product taken in the symmetric monoidal stable ∞-category
Ind Perf(BG). The map O(X1) ⊗O(X0) O(X2) →O(X) is an isomorphism in Ind Perf(BG): This
can be checked after the forgetful functor Ind Perf(BG) →D(L) as it is conservative (using that G
is pro-reductive, hence Rep(G) is semisimple), and then it amounts to X = X1 ×X0 X2.
□
In particular, we get the following corollary.
Corollary X.1.3. Let L be a ﬁeld over Qℓ(√q). There is a natural compactly supported L-
linear action of Perf(Z1(WE, bG)L/ bG) on Dlis(BunG, L)ω, uniquely characterized by the requirement
that by restricting along the RepL(QI)-linear maps
RepL(( bG ⋊Q)I) →Perf(Z1(WE, bG)L/ bG)BW I
E
it induces the Hecke action, which gives functorially in the ﬁnite set I exact RepL(QI)-linear func-
tors
RepL(( bG ⋊Q)I) →EndL(Dlis(BunG, L)ω)BW I
E.
Proof. We can reduce to the subcategories DP
lis(BunG, L)ω ⊂Dlis(BunG, L) for open sub-
groups P of the wild inertia of WE, acting trivially on bG. Then we can replace WE by WE/P
throughout. In that case, restricting the given Hecke action to W ⊂WE/P, Theorem X.1.1 gives
an action of Perf(Z1(W, bG)L/ bG), and Z1(W, bG) = Z1(WE/P, bG), so we get the desired action of
Perf(Z1(WE/P, bG)L/ bG).
□
With this action, we can formulate the main conjecture, “the categorical form of the geometric
Langlands conjecture on the Fargues–Fontaine curve”. Recall that for a quasisplit reductive group
G over E, Whittaker data consist of a choice of a Borel B ⊂G with unipotent radical U ⊂B,
together with a generic character ψ : U(E) →Q
×
ℓ. As usual, we also ﬁx √q ∈Qℓ.
Conjecture X.1.4. There is an equivalence of Qℓ-linear small stable ∞-categories
Dlis(BunG, Qℓ)ω ∼= Db,qc
coh (Z1(WE, bG)Qℓ/ bG)
linear over Perf(Z1(WE, bG)Qℓ/ bG), under which the structure sheaf on the right corresponds to
the Whittaker sheaf Wψ, which is the sheaf concentrated on Bun1
G ⊂BunG corresponding to the
representation c-IndG(E)
U(E)ψ of G(E).
To be precise, Db,qc
coh (Z1(WE, bG)Qℓ/ bG) refers here to the ∞-category of those bounded complexes
with coherent cohomology that also have quasicompact support, i.e. only live on ﬁnitely many
connected components, and the ﬁnal compatibility statement is really on the level of Ind-objects

338
X. THE SPECTRAL ACTION
(or after restriction to connected components). The linearity condition over Perf(Z1(WE, bG)Qℓ/ bG)
means that this equivalence is compatible with the spectral action.
Remark X.1.5. There is an orthogonal decomposition
Dlis(BunG, Qℓ)ω =
M
α∈π1(G)Γ
Dlis(Bunc1=α
G
, Qℓ)ω
given by the connected components of BunG. There is a morphism Z( bG)Γ →IdZ1(WE, bG)Qℓ/ bG, as
Z( bG)Γ ⊂bG acts trivially on Z1(WE, bG). There is an associated “eigenspace” decomposition
Db,qc
coh (Z1(WE, bG)Qℓ/ bG) =
M
χ∈X∗(Z( bG)Γ)
Db,qc
coh (Z1(WE, bG)Qℓ/ bG)χ.
Compatibility with the spectral action implies that via the identiﬁcation π1(G)Γ = X∗(Z( bG)Γ)
those two decompositions should match.
Another way to phrase the preceding conjecture is to say that, noting ∗the spectral action, the
“non-abelian Fourier transform”
Perfqc(Z1(WE, bG)Qℓ/ bG) −→Dlis(BunG, Qℓ)
M 7−→M ∗Wψ
is fully faithful and extends to an equivalence of Qℓ-linear small stable ∞-categories
Db,qc
coh (Z1(WE, bG)Qℓ/ bG) ∼
−→Dlis(BunG, Qℓ)ω.
Example X.1.6. Fully faithfulness in the categorical conjecture, applied to the structure sheaf,
implies that
Zspec(G, Qℓ) ∼
−→End(c-IndG(E)
U(E)ψ).
Example X.1.7 (Kernel of functoriality). Conjecture X.1.4 implies the existence of a kernel of
functoriality for the local Langlands correspondence in the following way. Let
f : LH →LG
be an L-morphism between the L-groups of two quasi-split reductive groups H and G over E. This
deﬁnes a morphism of stacks
Z1(WE, bH)Qℓ/ bH −→Z1(WE, bG)Qℓ/ bG,
and pushforward along this map induces a functor
Ind Db,qc
coh (Z1(WE, bH)Qℓ/ bH) →Ind Db,qc
coh (Z1(WE, bG)Qℓ/ bG).
(There may be slightly diﬀerent ways of handling the singularities here. One way to argue is to
observe that pushforward is naturally a functor
D≥0
qcoh(Z1(WE, bH)Qℓ/ bH) →D≥0
qcoh(Z1(WE, bG)Qℓ/ bG),
and D≥0
qcoh = IndDb,qc,≥0
coh
, and then extend by shifts.) The categorical equivalence then leads to a
canonical functor
Dlis(BunH, Qℓ) →Dlis(BunG, Qℓ).

X.2. ELLIPTIC PARAMETERS
339
By the self-duality of Dlis coming from Bernstein–Zelevinsky duality, and Proposition VII.7.10, any
such functor is given by a kernel
Af ∈Dlis(BunH × BunG, Qℓ).
One could, in fact, identify the image of Af under the categorical equivalence for H × G; up
to minor twists, it should be given by the structure sheaf of the graph of Z1(WE, bH)Qℓ/ bH −→
Z1(WE, bG)Qℓ/ bG. It would be very interesting if some examples of such kernels Af can be con-
structed explicitly.
Since D(H(E), Qℓ), resp. D(G(E), Qℓ), are direct factors of Dlis(BunH, Qℓ), resp. Dlis(BunG, Qℓ),
this should give rise to the “classical” Langlands functoriality D(H(E), Qℓ) →D(G(E), Qℓ).
Remark X.1.8. Above, we assumed G and H are quasisplit. To some extent, this is necessary,
as the Jacquet–Langlands correspondence cannot be given by a completely canonical functor (in
particular, one deﬁned over Qℓ): In fact, as is well-known, any discrete series representation of
GLn(E) is deﬁned over its ﬁeld of moduli but this is not the case for smooth irreducible represen-
tations of D× if D is a division algebra over E.
Let us now explain how Fargues’s original conjecture ﬁts into this context. Let ϕ : WE →bG(Qℓ)
be a Langlands parameter. Consider the map i : Spec Qℓ→Z1(WE, bG)Qℓ/ bG corresponding to ϕ,
and let
Eϕ = i∗Qℓ∈Dqcoh(Z1(WE, bG)Qℓ/ bG) = Ind Perfqc(Z1(WE, bG)Qℓ/ bG).
Factoring the map i via [Spec Qℓ/Sϕ], one actually sees that Eϕ carries naturally an action of Sϕ.
Moreover, if one acts via tensoring with a representation V of bG⋊Q, then by the projection formula
the sheaf Eϕ gets taken to itself, tensored with the WE-representation V ◦ϕ. Using the spectral
action, we ﬁnd an Sϕ-equivariant “automorphic complex”
Autϕ = Eϕ ∗Wψ ∈Dlis(BunG, Qℓ).
It already follows that Autϕ ∈Dlis(BunG, Qℓ) is a Hecke eigensheaf, with eigenvalue ϕ, so the
spectral action produces Hecke eigensheaves. Except, it is not clear whether Autϕ ̸= 0. Under the
fully faithfulness part of the categorical conjecture, one sees that it must be nonzero, and moreover
have some of the properties stated in [Far16], in particular regarding the relation to L-packets.
The particular case of elliptic parameters is further spelled out in the next section.
X.2. Elliptic parameters
Let us make explicit what the spectral action, and Conjecture X.1.4, entails in the case of
elliptic parameters. As coeﬃcients, we take L = Qℓfor simplicity.
Definition X.2.1. An L-parameter ϕ : WE →bG(Qℓ) is elliptic if it is semisimple and the
centralizer Sϕ ⊂bGQℓhas the property that Sϕ/Z( bG)Γ
Qℓis ﬁnite.
By deformation theory, it follows that the unramiﬁed twists of ϕ deﬁne a connected component
Cϕ ,→[Z1(WE, bG)Qℓ/ bG].

340
X. THE SPECTRAL ACTION
Thus, the spectral action (in fact, the excursion operators are enough for this, see the discussion
around Theorem IX.5.2) implies that there is a corresponding direct summand
DCϕ
lis (BunG, Qℓ)ω ⊂Dlis(BunG, Qℓ)ω.
For any Schur-irreducible A ∈DCϕ
lis (BunG, Qℓ)ω, the excursion operators act via scalars on A,
as determined by an unramiﬁed twist of ϕ. In particular, they act in this way on ib∗A for any
b ∈B(G). By compatibility with parabolic induction, it follows that for any A ∈DCϕ
lis (BunG, Qℓ)ω,
the restriction ib∗A is equal to 0 if b is not basic (if it was not zero, one could ﬁnd an irreducible
subquotient to which this argument applies). Thus,
DCϕ
lis (BunG, Qℓ)ω ∼=
M
b∈B(G)basic
DCϕ(Gb(E), Qℓ)ω.
Moreover, all A ∈DCϕ(Gb(E), Qℓ)ω must lie in only supercuspidal components of the Bernstein
center, again by compatibility with parabolic induction. If Z( bG)Γ is ﬁnite (equivalently, if the
connected split center of G is trivial), then Cϕ = [∗/Sϕ] is a point and it follows that all A are
ﬁnite direct sums of shifts supercuspidal representations of Gb(E), and so
DCϕ
lis (BunG, Qℓ)ω ∼=
M
b∈B(G)basic
M
π
Perf(Qℓ) ⊗π,
where π runs over supercuspidal Qℓ-representations of Gb(E) with L-parameter ϕπ = ϕ.
In general, acting on DCϕ
lis (BunG, Qℓ)ω, we have the direct summand
Perf(Cϕ)
of
Perf([Z1(WE, bG)Qℓ/ bG]).
If Z( bG)Γ is ﬁnite, one has Cϕ = [∗/Sϕ], and hence we get an action of Rep(Sϕ) on DCϕ
lis (BunG, Qℓ)ω.
In general, one can get a similar picture by ﬁxing central characters; let us for simplicity only spell
out the case when Z( bG)Γ is ﬁnite, i.e. the connected split center of G is trivial.
If πb is a supercuspidal representation of some Gb(E) with ϕπb = ϕ, and W ∈Rep(Sϕ) then
acting via W on πb we get some object
ActW (πb) ∈
M
b′∈B(G)basic
M
π
Perf(Qℓ) ⊗π.
Assume that W|Z( bG)Γ is isotypic, given by some character χ : Z( bG)Γ →Q
×
ℓ. As Z( bG)Γ is the
diagonalizable group with characters π1(G)Γ, it follows that we get an element bχ ∈π1(G)Γ =
B(G)basic. Then ActW (πb) is concentrated on b′ = b + bχ, and so
ActW (πb) ∼=
M
πb′
Vπb′ ⊗πb′
for a certain multiplicity space Vπb′ ∈Perf(Qℓ), where πb′ runs over supercuspidal representations
of Gb′(E), b′ = b + bχ, with L-parameter ϕπb′ = ϕ.

X.3. INTEGRAL COEFFICIENTS
341
The conjectural description of L-packets [Kal14] then suggests the following conjecture, which
is (up to the added t-exactness) the specialization of Conjecture X.1.4 to the case of elliptic L-
parameters.
Conjecture X.2.2. Assume that G is quasisplit, with a ﬁxed Whittaker datum, and that the
connected split center of G is trivial. Then there is a unique generic supercuspidal representation
π of G(E) with L-parameter ϕπ = ϕ, and the functor
Perf([Spec Qℓ/Sϕ]) →DCϕ
lis (BunG, Qℓ)ω : W 7→ActW (π)
is an equivalence. In particular, the set of irreducible supercuspidal representations of some Gb(E)
with L-parameter ϕ is in bijection with the set of irreducible representations of Sϕ.
Moreover, the equivalence is t-exact for the standard t-structures on source and target.
Thus, the conjecture gives an explicit parametrization of L-packets.
Let us explain what the compatibility of the spectral action with Hecke operators entails in this
case. Given V ∈Rep( bG ⋊Q), the restriction of V to Sϕ admits a commuting WE-action given by
ϕ. This deﬁnes a functor
Rep( bG ⋊Q) →Rep(Sϕ)BWE.
Now the diagram of monoidal functors
Rep( bG ⋊Q)
/

EndQℓ(DCϕ
lis (BunG, Qℓ))BWE
Rep(Sϕ)BWE
5
commutes; this follows from the compatibility of the spectral action with the Hecke action.
Concretely, given π as above and V ∈Rep( bG ⋊Q), decompose the image of V in Rep(Sϕ)BWE
as a direct sum L
i∈I Wi ⊗σi where Wi ∈Rep(Sϕ) is irreducible and σi is some continuous repre-
sentation of WE on a ﬁnite-dimensional Qℓ-space. Then
TV (π) ∼=
M
i∈I
ActWi(π) ⊗σi.
Recall that TV (π) can be calculated concretely through the cohomology of local Shimura va-
rieties, or in general moduli spaces of local shtukas. Noting that the functor ActWi is realizing a
form of the Jacquet–Langlands correspondence relating diﬀerent inner forms, the formula above is
essentially the conjecture of Kottwitz [RV14, Conjecture 7.3]. In fact, assuming Conjecture X.2.2,
it is an easy exercise to deduce [RV14, Conjecture 7.3], assuming that the parametrization of the
Conjecture X.2.2 agrees with the parametrization implicit in [RV14, Conjecture 7.3].
X.3. Integral coeﬃcients
We want to construct the spectral action with integral coeﬃcients. Unfortunately, the naive
analogue of Theorem X.1.1 is not true, the problem being that the analogue of Lemma X.1.2 fails.
However, the rest of the argument still works, and gives the following result.

342
X. THE SPECTRAL ACTION
Consider a split reductive group H over a discrete valuation ring R with an action of a ﬁnite
group Q. Let S be any anima over BQ. As before, we can deﬁne a derived stack MapBQ(S, B(H ⋊
Q)) over R, whose values in an animated R-algebra A are the maps of anima S →B(H ⋊Q)(A)
over BQ. In general, the functor S 7→Perf(MapBQ(S, B(H ⋊Q))) does not commute with sifted
colimits in S.
However, we can consider the best approximation to it that does commute with sifted colimits.
Note that the ∞-category of anima over BQ is the animation of the category of sets equipped
with a Q-torsor; it is freely generated under sifted colimits by the category of ﬁnite sets equipped
with a Q-torsor. Thus, the sifted-colimit approximation to S 7→Perf(MapBQ(S, B(H ⋊Q))) is the
animation of its restriction to ﬁnite sets with Q-torsors; we denote it by
S 7→Perf(MapΣ
BQ(S, B(H ⋊Q))),
with the idea in mind that it is like the ∞-category of perfect complexes on some (nonexistent)
derived stack MapΣ
BQ(S, B(H⋊Q)), gotten as a (co-)sifted limit approximation to MapΣ
BQ(S, B(H⋊
Q)). The symbol Σ here is in reference to the notation used in [Lur09, Section 5.5.8] in relation to
sifted colimits. Thus Perf(MapΣ
BQ(S, B(H ⋊Q))) is an R-linear idempotent-complete small stable
∞-category, mapping to Perf(MapBQ(S, B(H ⋊Q))).
Proposition X.3.1. Let C be an R-linear idempotent-complete small stable ∞-category. Giving,
functorially in ﬁnite sets I, an exact RepR(QI)-linear monoidal functor
RepR((H ⋊Q)I) →EndR(C)SI
is equivalent to giving an R-linear action of Perf(MapΣ
BQ(S, B(H ⋊Q))) on C. Here, given such an
action of Perf(MapΣ
BQ(S, B(H ⋊Q))), one gets exact RepR(QI)-linear monoidal functors
RepR((H ⋊Q)I) →EndR(C)SI
by composing the exact monoidal functor Perf(MapΣ
BQ(S, B(H ⋊Q))) →EndR(C) with the natural
exact RepR(QI)-linear symmetric monoidal functor
RepR((H ⋊Q)I) →Perf(MapΣ
BQ(S, B(H ⋊Q)))SI
given by I-fold tensor product of the exact RepR(Q)-linear symmetric monoidal functor
RepR(H ⋊Q) →Perf(MapΣ
BQ(S, B(H ⋊Q)))S
assigning to each s ∈S pullback along evaluation at s, MapBQ(S, B(H ⋊Q)) →B(H ⋊Q); more
precisely, it is deﬁned in this way if S is a ﬁnite set, and in general by animation.
Proof. This follows from the proof of Theorem X.1.1.
□
To make use of Proposition X.3.1, we need to ﬁnd suﬃciently many situations in which the
functor
Perf(MapΣ
BQ(S, B(H ⋊Q))) →Perf(MapBQ(S, B(H ⋊Q)))
is an equivalence, and speciﬁcally we need to prove this for MapBQ(BW, B( bG⋊Q)) = Z1(W, bG)/ bG.
First, we have the following result.

X.3. INTEGRAL COEFFICIENTS
343
Proposition X.3.2. The functor S 7→Perf(MapΣ
BQ(S, B(H ⋊Q))) from anima over BQ to
symmetric monoidal idempotent-complete stable R-linear ∞-categories commutes with all colimits.
Proof. As the functor commutes with sifted colimits by deﬁnition, it suﬃces to show that
when restricted to ﬁnite sets S equipped with Q-torsors, it commutes with disjoint unions. But for
such S, the map S →BQ can be factored over a point, and then MapBQ(S, B(H ⋊Q)) = BHS.
Thus, one has to see that for two ﬁnite sets S1, S2, the functor
Perf(BHS1) ⊗Perf(R) Perf(BHS2) →Perf(BHS1⊔S2)
is an equivalence. But this follows easily from highest weight theory, which for any split reductive
group H ﬁlters Perf(BH) in terms of copies of Perf(R) enumerated by highest weights.
□
Proposition X.3.3. Assume that S = BFn is the classifying space of a free group. Then the
functor
Perf(MapΣ
BQ(S, B(H ⋊Q))) →Perf(MapBQ(S, B(H ⋊Q)))
is fully faithful, and the essential image is the idempotent-complete stable ∞-subcategory generated
by the image of RepR(H).
Proof. Represent BFn →BQ by a map Fn →Q, and let σ1, . . . , σn ∈Q be the images of the
generators. Then MapBQ(S, B(H ⋊Q)) can be identiﬁed with [Hn/H], where H acts on Hn via
the (σ1, . . . , σn)-twisted diagonal conjugation action. We claim that
Perf(MapΣ
BQ(S, B(H ⋊Q)))
is the ∞-category of compact objects in the ∞-category of modules over O(Hn) in Ind Perf(BH);
in fact, this is equivalent to the claim, as by Barr–Beck this gives a description of the full ∞-
subcategory of Perf([Hn/H]) generated by Perf(BH).
As O(Hn) = O(H) ⊗. . . ⊗O(H) in Ind Perf(BH), one reduces to the case n = 1. In that case
S = BF1 is a circle, which we can present as a pushout of ∗⊔∗⇒∗. Thus, we have to compute
Perf(BH) ⊗Perf(BH2) Perf(BH)
where the two implicit maps H →H2 are given by the diagonal and the σ-twisted diagonal,
respectively.
As the pullback functors Perf(BH2) →Perf(BH) generate the image, we can
write Perf(BH) = Perf(H/H2) as the compact objects in the ∞-category of O(H)-modules in
Ind Perf(BH2). Similarly, the expected answer Perf([H/H]) = Perf([H × H/H2]) is given by the
compact objects in the ∞-category of modules over O(H × H) = O(H) ⊗O(H) in Ind Perf(BH2),
thus implying the result.
□
Proposition X.3.4. Let S = BΓ, where Γ is any discrete group, and lift the map S →BQ to
a map Γ →Q. Note that one can write
BΓ = colim(n,Fn→Γ) BFn
as a sifted colimit (in anima). Then Perf(MapΣ
BQ(S, B(H ⋊Q))) is the ∞-category of compact
objects in the ∞-category of modules over
colim(n,Fn→Γ) O(Hn)
in Ind Perf(BH), where O(Hn) is equipped with the twisted (via the map Fn →Γ →Q) diagonal
conjugation of H.

344
X. THE SPECTRAL ACTION
Proof. As E1-groups in anima are equivalent to animated groups, with compact projective
generators the free groups Fn, it follows that BΓ is the sifted colimit colim(n,Fn→Γ) BFn. Now the
result follows from the previous proposition (and its proof), together with the commutation with
sifted colimits.
□
Combining this with Theorem VIII.5.1, we have ﬁnished the proof of Theorem X.0.2. In par-
ticular, this gives the spectral action on Dlis(BunG).
Let us end by stating again the main conjecture with integral coeﬃcients.
Here, we again
presume that the spectral action is deﬁned for all ℓ.
Conjecture X.3.5. Assume that G is quasisplit and choose Whittaker data consisting of a
Borel B ⊂G and generic character ψ : U(E) →O×
L of the unipotent radical U ⊂B, where L/Qℓ
is some algebraic extension; also ﬁx √q ∈OL. Then there is an equivalence
D(BunG, OL)ω ∼= Db,qc
coh,Nilp(Z1(WE, bG)OL/ bG)
of stable ∞-categories equipped with actions of Perf(Z1(WE, bG)OL/ bG). Under this correspondence,
the structure sheaf of Z1(WE, bG)OL/ bG maps to the Whittaker sheaf, which is the sheaf concentrated
on Bun1
G corresponding to the Whittaker representations c-IndG(E)
U(E)ψ.
The notion of nilpotent singular support here is deﬁned via the results of Section VIII.2.2.

Bibliography
[AB83]
M. F. Atiyah and R. Bott, The Yang-Mills equations over Riemann surfaces, Philos. Trans. Roy. Soc.
London Ser. A 308 (1983), no. 1505, 523–615.
[AG15]
D. Arinkin and D. Gaitsgory, Singular support of coherent sheaves and the geometric Langlands conjec-
ture, Selecta Math. (N.S.) 21 (2015), no. 1, 1–199.
[AJ84]
H. H. Andersen and J. C. Jantzen, Cohomology of induced representations for algebraic groups, Math.
Ann. 269 (1984), no. 4, 487–525.
[Ans18]
J. Ansch¨utz, Extending torsors on the punctured Spec(Ainf), arXiv:1804.06356, 2018.
[Ans19]
, Reductive group schemes over the Fargues-Fontaine curve, Math. Ann. 374 (2019), no. 3-4,
1219–1260.
[AV16]
J. Adams and D. A. Vogan, Jr., Contragredient representations and characterizing the local Langlands
correspondence, Amer. J. Math. 138 (2016), no. 3, 657–682.
[BFH+17]
C. Birkbeck, T. Feng, D. Hansen, S. Hong, Q. Li, A. Wang, and L. Ye, Extensions of vector bundles on
the Fargues-Fontaine curve, arXiv:1705.00710, to appear in J. Inst. Math. Jussieu, 2017.
[BG19]
R. Bellovin and T. Gee, G-valued local deformation rings and global lifts, Algebra Number Theory 13
(2019), no. 2, 333–378.
[BKV15]
R. Bezrukavnikov, D. Kazhdan, and Y. Varshavsky, A categorical approach to the stable center conjecture,
Ast´erisque (2015), no. 369, 27–97.
[BM18]
B. Bhatt and A. Mathew, The arc-topology, arXiv:1807.04725, 2018.
[BMR05]
M. Bate, B. Martin, and G. R¨ohrle, A geometric approach to complete reducibility, Invent. Math. 161
(2005), no. 1, 177–218.
[BMS18]
B. Bhatt, M. Morrow, and P. Scholze, Integral p-adic Hodge theory, Publ. Math. Inst. Hautes ´Etudes
Sci. 128 (2018), 219–397.
[Bor67]
K. Borsuk, Theory of retracts, Monograﬁe Matematyczne, Tom 44, Pa´nstwowe Wydawnictwo Naukowe,
Warsaw, 1967.
[Bor79]
A. Borel, Automorphic L-functions, Automorphic forms, representations and L-functions (Proc. Sympos.
Pure Math., Oregon State Univ., Corvallis, Ore., 1977), Part 2, Proc. Sympos. Pure Math., XXXIII,
Amer. Math. Soc., Providence, R.I., 1979, pp. 27–61.
[Bor98]
M. Borovoi, Abelian Galois cohomology of reductive groups, Mem. Amer. Math. Soc. 132 (1998), no. 626,
viii+50.
[Boy99]
P. Boyer, Mauvaise r´eduction des vari´et´es de Drinfeld et correspondance de Langlands locale, Invent.
Math. 138 (1999), no. 3, 573–629.
[Boy09]
, Monodromie du faisceau pervers des cycles ´evanescents de quelques vari´et´es de Shimura simples,
Invent. Math. 177 (2009), no. 2, 239–280.
[BP19]
J. Booher and S. Patrikis, G-valued Galois deformation rings when ℓ̸= p, Math. Res. Lett. 26 (2019),
no. 4, 973–990.
[Bra03]
T. Braden, Hyperbolic localization of intersection cohomology, Transform. Groups 8 (2003), no. 3, 209–
216.
[Bre78]
L. Breen, Extensions du groupe additif, Inst. Hautes ´Etudes Sci. Publ. Math. (1978), no. 48, 39–125.
[Bru98]
J. Brundan, Dense orbits and double cosets, Algebraic groups and their representations (Cambridge,
1997), NATO Adv. Sci. Inst. Ser. C Math. Phys. Sci., vol. 517, Kluwer Acad. Publ., Dordrecht, 1998,
pp. 259–274.
[BS15]
B. Bhatt and P. Scholze, The pro-´etale topology for schemes, Ast´erisque (2015), no. 369, 99–201.
345

346
BIBLIOGRAPHY
[BS17]
, Projectivity of the Witt vector aﬃne Grassmannian, Invent. Math. 209 (2017), no. 2, 329–423.
[BS19]
, Prisms and prismatic cohomology, arXiv:1905.08229, 2019.
[BT84]
F. Bruhat and J. Tits, Groupes r´eductifs sur un corps local. II. Sch´emas en groupes. Existence d’une
donn´ee radicielle valu´ee, Inst. Hautes ´Etudes Sci. Publ. Math. (1984), no. 60, 197–376.
[BZCHN20] D. Ben-Zvi, H. Chen, D. Helm, and D. Nadler, Coherent Springer theory and the categorical Deligne-
Langlands correspondence, arXiv:2010.02321, 2020.
[Col02]
P. Colmez, Espaces de Banach de dimension ﬁnie, J. Inst. Math. Jussieu 1 (2002), no. 3, 331–439.
[CS]
D. Clausen and P. Scholze, Condensed Mathematics, in preparation, see www.math.uni-bonn.de/people/
scholze/Condensed.pdf, www.math.uni-bonn.de/people/scholze/Analytic.pdf for an account.
[CS17]
A. Caraiani and P. Scholze, On the generic part of the cohomology of compact unitary Shimura varieties,
Ann. of Math. (2) 186 (2017), no. 3, 649–766.
[CS19a]
,
On
the
generic
part
of
the
cohomology
of
non-compact
unitary
Shimura
varieties,
arXiv:1909.01898, 2019.
[ˇCS19b]
K. ˇCesnaviˇcius and P. Scholze, Purity for ﬂat cohomology, arXiv:1912.10932, 2019.
[Dat07]
J.-F. Dat, Th´eorie de Lubin-Tate non-ab´elienne et repr´esentations elliptiques, Invent. Math. 169 (2007),
no. 1, 75–152.
[DHKM20]
J.-F. Dat, D. Helm, R. Kurinczuk, and G. Moss, Moduli of Langlands Parameters, arXiv:2009.06708,
2020.
[dJvdP96]
J. de Jong and M. van der Put, ´Etale cohomology of rigid analytic spaces, Doc. Math. 1 (1996), No. 01,
1–56 (electronic).
[DM82]
P. Deligne and J. S. Milne, Tannakian categories, Hodge cycles, motives, and Shimura varieties, Lect.
Notes Math. 900, 101-228 (1982), 1982.
[Dol80]
A. Dold, Lectures on algebraic topology, second ed., Grundlehren der Mathematischen Wissenschaften,
vol. 200, Springer-Verlag, Berlin-New York, 1980.
[Don81]
Stephen Donkin, A ﬁltration for rational modules, Math. Z. 177 (1981), no. 1, 1–8.
[Don85]
, Rational representations of algebraic groups, Lecture Notes in Mathematics, vol. 1140, Springer-
Verlag, Berlin, 1985, Tensor products and ﬁltration.
[Don88]
, Skew modules for reductive groups, J. Algebra 113 (1988), no. 2, 465–479.
[Dri80]
V. G. Drinfeld, Langlands’ conjecture for GL(2) over functional ﬁelds, Proceedings of the International
Congress of Mathematicians (Helsinki, 1978), Acad. Sci. Fennica, Helsinki, 1980, pp. 565–574.
[DS95]
V. G. Drinfeld and C. Simpson, B-structures on G-bundles and local triviality, Math. Res. Lett. 2 (1995),
no. 6, 823–829.
[Far04]
L. Fargues, Cohomologie des espaces de modules de groupes p-divisibles et correspondances de Langlands
locales, Vari´et´es de Shimura, espaces de Rapoport-Zink et correspondances de Langlands locales, no.
291, Ast´erisque, 2004, pp. 1–199.
[Far08]
, L’isomorphisme entre les tours de Lubin-Tate et de Drinfeld et applications cohomologiques,
L’isomorphisme entre les tours de Lubin-Tate et de Drinfeld, Progr. Math., vol. 262, Birkh¨auser, Basel,
2008, pp. 1–325.
[Far10]
, Talk at the conference in honor of Jean-Marc Fontaine, https://webusers.imj-prg.fr/
~laurent.fargues/ExposeConfFontaine.pdf, 2010.
[Far16]
, Geometrization of the local Langlands correspondence: an overview, arXiv:1602.00999, 2016.
[Far18a]
, From local class ﬁeld to the curve and vice versa, Algebraic geometry: Salt Lake City 2015,
Proc. Sympos. Pure Math., vol. 97, Amer. Math. Soc., Providence, RI, 2018, pp. 181–198.
[Far18b]
, G-torseurs en th´eorie de Hodge p-adique, to appear, Comp. Math., 2018.
[FF18]
L. Fargues and J.-M. Fontaine, Courbes et ﬁbr´es vectoriels en th´eorie de Hodge p-adique, Ast´erisque
(2018), no. 406, xiii+382, With a preface by Pierre Colmez.
[FG12]
J. Fulman and R. Guralnick, Bounds on the number and sizes of conjugacy classes in ﬁnite Chevalley
groups with applications to derangements, Trans. Amer. Math. Soc. 364 (2012), no. 6, 3023–3070.
[Gai01]
D. Gaitsgory, Construction of central elements in the aﬃne Hecke algebra via nearby cycles, Invent.
Math. 144 (2001), no. 2, 253–280.
[Gai07]
, On de Jong’s conjecture, Israel J. Math. 157 (2007), 155–191.
[Gai16]
, From geometric to function-theoretic Langlands (or how to invent shtukas), arXiv:1606.09608,
2016.

BIBLIOGRAPHY
347
[GHKR10]
U. G¨ortz, T. J. Haines, R. E. Kottwitz, and D. C. Reuman, Aﬃne Deligne-Lusztig varieties in aﬃne
ﬂag varieties, Compos. Math. 146 (2010), no. 5, 1339–1382.
[Gin90]
V. A. Ginzburg, Sheaves on a loop group, and Langlands duality, Funktsional. Anal. i Prilozhen. 24
(1990), no. 4, 76–77.
[GKRV19]
D. Gaitsgory, D. Kazhdan, N. Rozenblyum, and Y. Varshavsky, A toy model for the Drinfeld-Laﬀorgue
shtuka construction, arXiv:1908.05420, 2019.
[GL17]
A. Genestier and V. Laﬀorgue, Chtoucas restreints pour les groupes r´eductifs et param´etrisation de
Langlands locale, arXiv:1709.00978, 2017.
[GR03]
O. Gabber and L. Ramero, Almost ring theory, Lecture Notes in Mathematics, vol. 1800, Springer-Verlag,
Berlin, 2003.
[Gro61]
A. Grothendieck, ´El´ements de g´eom´etrie alg´ebrique. III. ´Etude cohomologique des faisceaux coh´erents. I,
Inst. Hautes ´Etudes Sci. Publ. Math. (1961), no. 11, 167.
[Gro64]
, ´El´ements de g´eom´etrie alg´ebrique. IV. ´Etude locale des sch´emas et des morphismes de sch´emas.
I, Inst. Hautes ´Etudes Sci. Publ. Math. (1964), no. 20, 259.
[Gul74]
T. H. Gulliksen, A change of ring theorem with applications to Poincar´e series and intersection multi-
plicity, Math. Scand. 34 (1974), 167–183.
[Hab75]
W. J. Haboush, Reductive groups are geometrically reductive, Ann. of Math. (2) 102 (1975), no. 1, 67–83.
[Hai14]
T. J. Haines, The stable Bernstein center and test functions for Shimura varieties, Automorphic forms
and Galois representations. Vol. 2, London Math. Soc. Lecture Note Ser., vol. 415, Cambridge Univ.
Press, Cambridge, 2014, pp. 118–186.
[Han17]
D.
Hansen,
Degenerating
vector
bundles
in
p-adic
Hodge
theory,
http://www.davidrenshawhansen.com/degen.pdf, to appear in J. Inst. Math. Jussieu, 2017.
[Har97]
M. Harris, Supercuspidal representations in the cohomology of Drinfeld upper half spaces; elaboration of
Carayol’s program, Invent. Math. 129 (1997), no. 1, 75–119.
[Hau05]
T. Hausberger, Uniformisation des vari´et´es de Laumon-Rapoport-Stuhler et conjecture de Drinfeld-
Carayol, Ann. Inst. Fourier (Grenoble) 55 (2005), no. 4, 1285–1371.
[HC66]
Harish-Chandra, Discrete series for semisimple Lie groups. II. Explicit determination of the characters,
Acta Math. 116 (1966), 1–111.
[Hel16]
D. Helm, The Bernstein center of the category of smooth W(k)[GLn(F)]-modules, Forum Math. Sigma
4 (2016), Paper No. e11, 98.
[Hel20]
E. Hellmann, On the derived category of the iwahori-hecke algebra, arXiv:2006.03013, 2020.
[Hen00]
G. Henniart, Une preuve simple des conjectures de Langlands pour GL(n) sur un corps p-adique, Invent.
Math. 139 (2000), no. 2, 439–455.
[HH20]
U. Hartl and E. Hellmann, The universal family of semistable p-adic Galois representations, Algebra
Number Theory 14 (2020), no. 5, 1055–1121.
[HK20]
D.
Hansen
and
K.
S.
Kedlaya,
Sheaﬁness
criteria
for
Huber
rings,
https://kskedlaya.org/papers/criteria.pdf, 2020.
[HM13]
C. Hague and G. McNinch, Some good-ﬁltration subgroups of simple algebraic groups, J. Pure Appl.
Algebra 217 (2013), no. 12, 2400–2413.
[HM18]
D. Helm and G. Moss, Converse theorems and the local Langlands correspondence in families, Invent.
Math. 214 (2018), no. 2, 999–1022.
[HP04]
U. Hartl and R. Pink, Vector bundles with a Frobenius structure on the punctured unit disc, Compos.
Math. 140 (2004), no. 3, 689–716.
[HT01]
M. Harris and R. Taylor, The geometry and cohomology of some simple Shimura varieties, Annals of
Mathematics Studies, vol. 151, Princeton University Press, Princeton, NJ, 2001, With an appendix by
Vladimir G. Berkovich.
[Hub96]
R. Huber, ´Etale cohomology of rigid analytic varieties and adic spaces, Aspects of Mathematics, E30,
Friedr. Vieweg & Sohn, Braunschweig, 1996.
[Hub98]
, A comparison theorem for ℓ-adic cohomology, Compositio Math. 112 (1998), no. 2, 217–235.
[Ill06]
L. Illusie, Vanishing cycles over general bases, after P. Deligne, O. Gabber, G. Laumon and F. Orgogozo,
https://www.imo.universite-paris-saclay.fr/~illusie/vanishing1b.pdf, 2006.
[Iva20]
A. B. Ivanov, On ind-representability of loop Deligne–Lusztig sheaves, arXiv:2003.04399, 2020.

348
BIBLIOGRAPHY
[Jor08]
D. A. Jorgensen, Finite projective dimension and the vanishing of ExtR(M, M), Comm. Algebra 36
(2008), no. 12, 4461–4471.
[Kal14]
T. Kaletha, Supercuspidal L-packets via isocrystals, Amer. J. Math. 136 (2014), no. 1, 203–239.
[Kal18]
, Rigid inner forms vs isocrystals, J. Eur. Math. Soc. (JEMS) 20 (2018), no. 1, 61–101.
[Kat82]
S. Kato, Spherical functions and a q-analogue of Kostant’s weight multiplicity formula, Invent. Math.
66 (1982), no. 3, 461–468.
[Ked04]
K. S. Kedlaya, A p-adic local monodromy theorem, Ann. of Math. (2) 160 (2004), no. 1, 93–184.
[Ked16]
, Noetherian properties of Fargues-Fontaine curves, Int. Math. Res. Not. IMRN (2016), no. 8,
2544–2567.
[Kem76]
G. R. Kempf, Linear systems on homogeneous spaces, Ann. of Math. (2) 103 (1976), no. 3, 557–591.
[Kem78]
, Instability in invariant theory, Ann. of Math. (2) 108 (1978), no. 2, 299–316.
[KL15]
K. S. Kedlaya and R. Liu, Relative p-adic Hodge theory: foundations, Ast´erisque (2015), no. 371, 239pp.
[KL16]
, Relative p-adic Hodge theory, II: Imperfect period rings, arXiv:1602.06899, 2016.
[Kop84]
M. Koppinen, Good bimodule ﬁltrations for coordinate rings, J. London Math. Soc. (2) 30 (1984), no. 2,
244–250.
[Kot85]
R. E. Kottwitz, Isocrystals with additional structure, Compositio Math. 56 (1985), no. 2, 201–220.
[Kot97]
, Isocrystals with additional structure. II, Compositio Math. 109 (1997), no. 3, 255–339.
[KW17]
T. Kaletha and J. Weinstein, On the Kottwitz conjecture for local Shimura varieties, arXiv:1709.06651,
2017.
[Lab99]
J.-P. Labesse, Cohomologie, stabilisation et changement de base, Ast´erisque (1999), no. 257, vi+161pp,
Appendix A by Laurent Clozel and Labesse, and Appendix B by Lawrence Breen.
[Laf18]
V. Laﬀorgue, Chtoucas pour les groupes r´eductifs et param´etrisation de Langlands globale, J. Amer.
Math. Soc. 31 (2018), no. 3, 719–891.
[Lan89]
R. P. Langlands, On the classiﬁcation of irreducible representations of real algebraic groups, Represen-
tation theory and harmonic analysis on semisimple Lie groups, Math. Surveys Monogr., vol. 31, Amer.
Math. Soc., Providence, RI, 1989, pp. 101–170.
[Lau04]
E. Lau, On generalized D-shtukas, Thesis, 2004.
[LMB00]
G. Laumon and L. Moret-Bailly, Champs alg´ebriques, Ergebnisse der Mathematik und ihrer Grenzgebiete.
3. Folge. A Series of Modern Surveys in Mathematics [Results in Mathematics and Related Areas. 3rd
Series. A Series of Modern Surveys in Mathematics], vol. 39, Springer-Verlag, Berlin, 2000.
[LRS93]
G. Laumon, M. Rapoport, and U. Stuhler, D-elliptic sheaves and the Langlands correspondence, Invent.
Math. 113 (1993), no. 2, 217–338.
[LTX+19]
Y. Liu, Y. Tian, L. Xiao, W. Zhang, and X. Zhu, On the Beilinson-Bloch-Kato conjecture for Rankin-
Selberg motives, arXiv:1912.11942, 2019.
[Lur09]
J. Lurie, Higher topos theory, Annals of Mathematics Studies, vol. 170, Princeton University Press,
Princeton, NJ, 2009.
[Lur16]
, Higher algebra, http://www.math.harvard.edu/~lurie/papers/HA.pdf, 2016.
[Lus76]
G. Lusztig, On the ﬁniteness of the number of unipotent classes, Invent. Math. 34 (1976), no. 3, 201–213.
[Lus83]
, Singularities, character formulas, and a q-analog of weight multiplicities, Analysis and topology
on singular spaces, II, III (Luminy, 1981), Ast´erisque, vol. 101, Soc. Math. France, Paris, 1983, pp. 208–
229.
[LY13]
G. Lusztig and Z. Yun, A (−q)-analogue of weight multiplicities, J. Ramanujan Math. Soc. 28A (2013),
311–340.
[LZ19]
Q. Lu and W. Zheng, Duality and nearby cycles over general bases, Duke Math. J. 168 (2019), no. 16,
3135–3213.
[LZ20]
, Categorical traces and a relative Lefschetz-Verdier formula, arXiv:2005.08522, 2020.
[Mat90]
O. Mathieu, Filtrations of G-modules, Ann. Sci. ´Ecole Norm. Sup. (4) 23 (1990), no. 4, 625–644.
[ML95]
S. Mac Lane, Homology, Classics in Mathematics, Springer-Verlag, Berlin, 1995, Reprint of the 1975
edition.
[MV07]
I. Mirkovi´c and K. Vilonen, Geometric Langlands duality and representations of algebraic groups over
commutative rings, Ann. of Math. (2) 166 (2007), no. 1, 95–143.
[Nee96]
A. Neeman, The Grothendieck duality theorem via Bousﬁeld’s techniques and Brown representability, J.
Amer. Math. Soc. 9 (1996), no. 1, 205–236.

BIBLIOGRAPHY
349
[NS18]
T. Nikolaus and P. Scholze, On topological cyclic homology, Acta Math. 221 (2018), no. 2, 203–409.
[NY19]
D. Nadler and Z. Yun, Spectral action in Betti geometric Langlands, Israel J. Math. 232 (2019), no. 1,
299–349.
[PY02]
G. Prasad and J.-K. Yu, On ﬁnite group actions on reductive groups and buildings, Invent. Math. 147
(2002), no. 3, 545–560.
[PY06]
, On quasi-reductive group schemes, J. Algebraic Geom. 15 (2006), no. 3, 507–549, With an
appendix by Brian Conrad.
[Ren10]
D. Renard, Repr´esentations des groupes r´eductifs p-adiques, Cours Sp´ecialis´es, vol. 17, Soci´et´e
Math´ematique de France, Paris, 2010.
[Ric88]
R. W. Richardson, Conjugacy classes of n-tuples in Lie algebras and algebraic groups, Duke Math. J. 57
(1988), no. 1, 1–35.
[Ric19]
T. Richarz, Spaces with Gm-action, hyperbolic localization and nearby cycles, J. Algebraic Geom. 28
(2019), no. 2, 251–289.
[RR96]
M. Rapoport and M. Richartz, On the classiﬁcation and specialization of F-isocrystals with additional
structure, Compositio Math. 103 (1996), no. 2, 153–181.
[RV14]
M. Rapoport and E. Viehmann, Towards a theory of local Shimura varieties, M¨unster J. Math. 7 (2014),
no. 1, 273–326.
[RZ96]
M. Rapoport and Th. Zink, Period spaces for p-divisible groups, Annals of Mathematics Studies, vol.
141, Princeton University Press, Princeton, NJ, 1996.
[Sch11]
P. Scholze, Perfectoid Spaces and the Weight-Monodromy Conjecture, 2011, Cours d’Arithm´etique et de
G´eom´etrie Alg´ebrique, http://www.ihes.fr/~abbes/CAGA/scholze.html.
[Sch12]
, Perfectoid spaces, Publ. Math. Inst. Hautes ´Etudes Sci. 116 (2012), 245–313.
[Sch13]
, The local Langlands correspondence for GLn over p-adic ﬁelds, Invent. Math. 192 (2013), no. 3,
663–715.
[Sch14]
, The local Langlands correspondence and equivariant sheaves on projective space, 2014, https:
//www.msri.org/workshops/731/schedules/17615.
[Sch15]
, On torsion in the cohomology of locally symmetric varieties, Ann. of Math. (2) 182 (2015),
no. 3, 945–1066.
[Sch17a]
, ´Etale cohomology of diamonds, www.math.uni-bonn.de/people/scholze/EtCohDiamonds.pdf,
2017.
[Sch17b]
, On the local Langlands conjectures for reductive groups, 2017, Hadamard lectures at the IH´ES.
[Ser94]
J.-P. Serre, Cohomologie galoisienne, ﬁfth ed., Lecture Notes in Mathematics, vol. 5, Springer-Verlag,
Berlin, 1994.
[SR72]
N. Saavedra Rivano, Cat´egories Tannakiennes, Lecture Notes in Mathematics, Vol. 265, Springer-Verlag,
Berlin-New York, 1972.
[SS13]
P. Scholze and S. W. Shin, On the cohomology of compact unitary group Shimura varieties at ramiﬁed
split places, J. Amer. Math. Soc. 26 (2013), no. 1, 261–294.
[Sta]
The Stacks Project Authors, Stacks Project, http://stacks.math.columbia.edu.
[Ste68]
R. Steinberg, Endomorphisms of linear algebraic groups, Memoirs of the American Mathematical Society,
No. 80, American Mathematical Society, Providence, R.I., 1968.
[SW13]
P. Scholze and J. Weinstein, Moduli of p-divisible groups, Cambridge Journal of Mathematics 1 (2013),
no. 2, 145–237.
[SW20]
, Berkeley lectures on p-adic geometry, vol. 207, Princeton, NJ: Princeton University Press, 2020.
[Tem21]
M. Temkin, Topological transcendence degree, J. Algebra 568 (2021), 35–60.
[Tit59]
J. Tits, Sur la trialit´e et certains groupes qui s’en d´eduisent, Inst. Hautes ´Etudes Sci. Publ. Math. (1959),
no. 2, 13–60.
[TvdK10]
A. Touz´e and W. van der Kallen, Bifunctor cohomology and cohomological ﬁnite generation for reductive
groups, Duke Math. J. 151 (2010), no. 2, 251–278.
[vdK01]
W. van der Kallen, Steinberg modules and Donkin pairs, Transform. Groups 6 (2001), no. 1, 87–98.
[Vie21]
E. Viehmann, On the Newton strata in the B+
dR-Grassmannian, arXiv:2101.07510, 2021.
[Vog93]
D. Vogan, Jr., The local Langlands conjecture, Representation theory of groups and algebras, Contemp.
Math., vol. 145, Amer. Math. Soc., Providence, RI, 1993, pp. 305–379.

350
BIBLIOGRAPHY
[Wei17]
J. Weinstein, Gal(Qp/Qp) as a geometric fundamental group, Int. Math. Res. Not. IMRN (2017), no. 10,
2964–2997.
[Xue20]
C. Xue, Smoothness of cohomology sheaves of stacks of shtukas, arXiv:2012.12833, 2020.
[XZ17]
L. Xiao and X. Zhu, Cycles on Shimura varieties via geometric Satake, arXiv:1707.05700, 2017.
[Yu19]
J. Yu, The integral geometric Satake equivalence in mixed characteristic, arXiv:1903.11132, 2019.
[Zhu17]
X. Zhu, Aﬃne Grassmannians and the geometric Satake in mixed characteristic, Ann. of Math. (2) 185
(2017), no. 2, 403–492.
[Zhu20]
, Coherent sheaves on the stack of Langlands parameters, arXiv:2008.02998, 2020.
[Zie15]
P. Ziegler, Graded and ﬁltered ﬁber functors on Tannakian categories, J. Inst. Math. Jussieu 14 (2015),
no. 1, 87–130.

