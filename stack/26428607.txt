Board of the Foundation of the Scandinavian Journal of Statistics
 
 
Exact Goodness-of-Fit Testing for the Ising Model
Author(s): ABRAHAM MARTÍN DEL CAMPO, SARAH CEPEDA and  CAROLINE UHLER
Source: Scandinavian Journal of Statistics, Vol. 44, No. 2 (June 2017), pp. 285-306
Published by: Wiley on behalf of Board of the Foundation of the Scandinavian Journal of
Statistics
Stable URL: https://www.jstor.org/stable/26428607
Accessed: 28-02-2023 12:51 UTC
 
JSTOR is a not-for-profit service that helps scholars, researchers, and students discover, use, and build upon a wide
range of content in a trusted digital archive. We use information technology and tools to increase productivity and
facilitate new forms of scholarship. For more information about JSTOR, please contact support@jstor.org.
 
Your use of the JSTOR archive indicates your acceptance of the Terms & Conditions of Use, available at
https://about.jstor.org/terms
Wiley, Board of the Foundation of the Scandinavian Journal of Statistics are
collaborating with JSTOR to digitize, preserve and extend access to Scandinavian Journal of
Statistics
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 Scandinavian Journal of Statistics, Vol. 44: 285-306, 2017
 doi: 10.1111/sjoa 12251
 © 2016 Board of the Foundation of the Scandinavian Journal of Statistics. Published by Wiley Publishing Ltd.
 Exact Goodness-of-Fit Testing for the
 Ising Model
 ABRAHAM MARTIN DEL CAMPO
 Centro de Investigation en Matemâticas, A. C.
 SARAH CEPEDA
 Institute of Science and Technology Austria
 CAROLINE UHLER
 lMDoraiory jor injormaiion ana Decision systems ana institute jor vata, systems ana society,
 Massachusetts Institute of Technology
 ABSTRACT. The Ising model is one of the simplest and most famous models of interacting sys
 tems. It was originally proposed to model ferromagnetic interactions in statistical physics and is
 now widely used to model spatial processes in many areas such as ecology, sociology, and genet
 ics, usually without testing its goodness of fit. Here, we propose various test statistics and an
 exact goodness-of-fit test for the finite-lattice Ising model. The theory of Markov bases has been
 developed in algebraic statistics for exact goodness-of-fit testing using a Monte Carlo approach.
 However, finding a Markov basis is often computationally intractable. Thus, we develop a Monte
 Carlo method for exact goodness-of-fit testing for the Ising model that avoids computing a Markov
 basis and also leads to a better connectivity of the Markov chain and hence to a faster convergence.
 We show how this method can be applied to analyze the spatial organization of receptors on the
 cell membrane.
 Key words: goodness-of-fit testing, Ising model, Markov Chain Monte Carlo
 1. Introduction
 The Ising model was invented as a mathematical model of ferromagnetism in statistical
 mechanics, and it first appeared in a paper based on Ising's PhD thesis (Ising, 1925). The
 model consists of binary variables, called spins, which are usually arranged on an integer lattice,
 allowing each spin to interact only with its neighbours. The Ising model has played a central
 role in statistical mechanics; see Brush (1967) for a review. Because the Ising model allows a
 simplified representation of complex interactions, it has been used in various areas, for exam
 ple, for image analysis pioneered by Besag (1986,1993), to model social and political behaviour
 (Galam et al, 1982; Galam & Moscovici, 1991), to model the interactions of neurons (Schnei
 dman etal, 2006; Tkacik et al., 2014; Tkacik et al, 2006) or to analyze genetic data (Majewski
 et al, 2001). Statistical inference for the Ising model is often made on the basis of a single
 observed lattice configuration. In this paper, we propose a method for goodness-of-fit testing
 for the Ising model that can be applied in this setting.
 Among the many contributions of Julian Besag, he wrote a series of papers on hypothesis
 testing for spatial data when asymptotic approximations are inadequate (Besag, 1974; 1977;
 Besag & Clifford, 1989; Bunea & Besag, 2000). He proposed and applied Monte Carlo tests
 for this purpose (Besag, 1972; 1974); an irreducible, aperiodic Markov chain starting in the
 observed configuration is built on the set of all spatial configurations with the same sufficient
 statistics. The true (non-asymptotic) conditional /»-value is approximated by the /»-value result
 ing from the distribution of a test statistic evaluated at the Monte Carlo samples. The main
 difficulty of this approach is to guarantee irreducibility of the Markov chain. Besag & Clifford
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 286 A. Martin del Campo, S. Cepeda and C. Uhler
 Scand J Statist 44
 (1989) discussed hypothesis testing specifically for the Ising model and proposed using simple
 swaps of two randomly chosen lattice points of different states, accepting those which preserve
 the sufficient statistics. As noted by Bunea & Besag (2000), this algorithm leads to a reducible
 Markov chain without any guarantees of converging to the correct conditional distribution. It
 remained an open problem to develop an irreducible version of this algorithm, a problem we
 solve in this paper.
 Diaconis & Sturmfels (1998) introduced Markov bases and developed a general framework
 for sampling from a conditional distribution (given the sufficient statistics) in discrete expo
 nential families. A Markov basis is a set of moves that connect any two configurations with
 the same sufficient statistics by passing only through configurations that preserve the sufficient
 statistics. Thus, a Markov basis allows building an irreducible Markov chain and performing
 non-asymptotic goodness-of-fit testing. As shown by Diaconis & Sturmfels (1998), finding a
 Markov basis for a particular model is equivalent to finding generators for a specific ideal in
 a polynomial ring and can (in principle) be computed using Gröbner bases techniques. This
 spurred more research in algebraic statistics, see (Aoki et al., 2012; Drton et al., 2009; Hosten
 & Sullivant, 2007; Rapallo, 2003; Pistone & Rogantin, 2013) or more recently (Cai et al., 2014;
 Gross et al., 2016; Koyamaef al., 2015; Rauh & Sullivant, 2016; Slavkovic et al., 2014). How
 ever, computing a Markov basis is often computationally intractable, making the Markov basis
 approach to goodness-of-fit testing ineffective in many applications. As we show in Section 2.2,
 a Markov basis for the Ising model on a 3x3 lattice consists already of 1334 moves. Comput
 ing a Markov basis for the Ising model on a 4x4 lattice is computationally infeasible using the
 current Gröbner basis technology. A similar problematic has been observed for other models,
 for instance for network models (Petrovic et al., 2010). Here, the largest models considered so
 far are food webs of around 40 nodes (Gross et al., 2016; Ogawa et al., 2013). Kahle & Rauh
 (2013) have a collection of Markov bases that have been computed during the last years.
 In this paper, we propose a method for sampling from a conditional distribution (given the
 sufficient statistics) that circumvents the need of computing a Markov basis. The idea is to use
 a set of simple moves, a subset of the Markov basis, which can be computed easily but does not
 necessarily lead to a connected Markov chain. We then build a connected Markov chain using
 these simple moves by allowing the sufficient statistics to change slightly. For fast convergence
 of the Markov chain, it is desirable to determine the minimal amount of change needed in
 the sufficient statistics to guarantee connectedness, and we prove that just allowing the direct
 neighbours is sufficient. This results in an irreducible version of the algorithm by Bunea &
 Besag (2000), and we show how it can be applied for goodness-of-fit testing in the Ising model.
 We briefly review other methods that have previously been proposed in order to bypass the
 computational bottleneck of computing the whole Markov basis for goodness-of-fit testing and
 compare these methods to our approach: for applications to contingency tables, it has been
 shown that a simpler subset of the full Markov basis is sufficient to build a connected Markov
 chain in certain restricted settings, with constraints either on the sufficient statistics (Chen et
 al., 2010) or on the table entries (Rapallo & Yoshida, 2010). Note that this is possible because
 using a Markov basis to build a Markov chain guarantees its connectedness for any sufficient
 statistic and one can do better for particular sufficient statistics. A different approach is to use
 a lattice basis instead of the full Markov basis (Drton et al., 2009, Chapter 1). A lattice basis
 is a subset of a Markov basis and therefore easier to compute. However, in order to guarantee
 connectedness of the Markov chain, one needs to use integer combinations of the elements of
 a lattice basis (Aoki et al., 2012, Chapter 16). A third approach is based on computing the
 Markov basis dynamically; at each step, this framework finds a subset of the Markov basis
 elements that connect the current iterate to all its neighbours (Dobra, 2012; Gross et al., 2016).
 The advantage of our method compared with the first approach is that it is applicable to any
 ©2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 Scand J Statist 44
 Goodness-of-fit test for the Ising model 287
 sufficient statistic. Compared with the second and third approach, our method reduces the size
 of the moves needed for performing hypothesis testing in the Ising model further and allows
 application to lattices of size 800 x 800 as required for the biological data set in Section 6.
 However, in contrast to the three approaches described earlier that are not application specific,
 our method is specific to hypothesis testing in the Ising model.
 Our paper is structured as follows: in Section 2, we introduce notation for the finite-lattice
 Ising model and describe the sufficient statistics for this model. We also introduce Markov
 bases in the context of Ising models and determine a Markov basis for the two-dimensional
 Ising model of size 3x3. Section 3 contains the main results of this paper. We prove that simple
 swaps are sufficient for constructing an irreducible, aperiodic and reversible Markov chain when
 allowing a bounded change in the sufficient statistics of size 2d~x, where d denotes the ambient
 dimension of the Ising model. In Section 4, we discuss several test statistics for the Ising model,
 and we analyze their performance using simulated data in Section 5. Finally, in Section 6, we
 apply our exact goodness-of-fit test for the Ising model to biological data and analyze the
 spatial organization of receptors on the cell membrane.
 2. Background
 2.1. Ising model
 The Ising model was originally introduced to study magnetic phase transitions and is now one
 of the most famous models of interacting systems (Brush, 1967; Ising, 1925). The Ising model
 consists of a collection of binary random variables, the spins, which are usually arranged on
 an integer lattice, with the edges representing interaction between spins. In this section, we
 introduce some notation and recall the mathematical definition of the Ising model. Let [&]
 denote the set of integers {1,..., k). For N\,...,Nd e Z>o, let L denote the ^-dimensional
 lattice graph of size A'i x... x , whose set of vertices V consists of the elements in [A'i ] x... x
 [Nj] and whose edge set E consists of pairs i, j € V such that i and j agree in all coordinates
 except for one in which they differ by one. To each vertex i e V, we associate a binary random
 variable Yj taking values in {0, 1} and edges represent interaction between the adjacent random
 variables. A configuration is an element y € S := {0, ] , To each configuration y, we
 associate the following two quantities:
 Tx (y) := £ yt, T2(y) := £ |yt - yj |, (1)
 ieV UJ)eE
 where the first quantity count
 the number of edges between v
 n
 u
 Fig. I. A lattice configuration for the two-dimensional Ising model. [Colour figure can be viewed at
 wileyonlinelibrary.com]
 © 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 288 A. Martin del Campo, S. Cepeda and C. Uhler
 Scand J Statist 44
 For d = 2, we represent a configuration y by a diagram, where the vertices of L are
 represented by squares in a grid, the edges correspond to two adjacent squares, the ones in
 the configuration are represented by coloured squares and the zeroes by white squares. For
 instance, the configuration
 y = (0,0,0,0,0, 0,1,1,1,0, 0,0,1,0,0, 0,1,0,1,0, 0,0,0,0,0) € {0,1 }5xS
 (the entries are read column-wise) is represented by the diagram depicted in Fig. 1. This
 example has T\{y) = 6 and T2(y) = 18.
 For the Ising model, the probability of observing a configuration y € S is given by the
 Boltzmann distribution:
 P(v\ _ exp(«-^(y) + ß-T2(y))
 y) Z(a,ß) ' K)
 where a, ß are the model param
 quantities T\ (y ) and T2(y) are t
 an extra parameter representin
 ever, we focus on the simplifie
 temperature.
 Working over the state sp
 ration y e S by -1 lead to a con
 Boltzmann distribution with suff
 fi(x) := ^ xi, t2{x) XiXj.
 ieV (iJ)eE
 Because
 fi(x) = 2-Tx{y)-\V\, fi(x) = |£| — 2 - T2(y), (3)
 where |F| = f[f=i Ni *s ^ number of vertices and \E\ = ' Y\jj=i Nj)
 number of edges in L, there is a one-to-one correspondence between the two representatio
 In the following, we work over the state space S, because this simplifies notation.
 Our goal is to develop an exact goodness-of-fit test for the Ising model that is applica
 when only a single lattice configuration is observed. Our null hypothesis is that an observe
 configuration y e S is sampled from the Boltzman distribution (2) for unspecified par
 ters a and ß. In Section 4, we describe several alternatives such as the presence of long-ran
 interactions or non-homogeneity.
 For fixed a,b e Z>o, we define the corresponding configuration sample space by
 S(a,b) := {ye S \ Tl(y)=a, T2(y) = b).
 We denote the distribution of a Boltzmann random variable Y conditioned on the values of t
 sufficient statistics by
 n(y) := Prob(K = y\T](Y) = a, T2(Y) = b).
 A simple computation shows that for the Ising model, n is the uniform distribution on S(a
 Then, the conditional /»-value of a given configuration y can be approximated using Marko
 chain Monte Carlo (MCMC) algorithms for sampling configurations from the conditional
 tribution n. However, MCMC methods for hypothesis testing in the Ising model have vario
 computational obstructions: the sample space S(a,b) grows exponentially with the size of 
 lattice L rendering direct sampling infeasible. In addition, to ensure that the conditional dis
 bution n is the stationary distribution of the Markov chain, the chain needs to be irreduci
 © 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 Scand J Statist 44
 Goodness-of-fit test for the Ising model 289
 (i.e. connected). This is difficult to achieve because the space S(a, b) has a complicated combi
 natorial structure. One way to overcome this problem is to use a Markov basis to construct the
 Markov chain. We now formally introduce Markov bases and then discuss the computational
 limitations of this approach in the Ising model.
 2.2. Markov bases
 First, note that every integer vector z 6 zNi><"xNd can be written uniquely as a difference
 z = z+ -z~ of two nonnegative vectors with disjoint support. A Markov basis in the context
 of the Ising model is defined as follows.
 Definition 1. A Markov basis for the Ising model is a set Z C ZNiX~ *Nd of integer vectors
 such that
 (i) All z € Z satisfy T\ (z+) = T\ (z~) and 7"2(z+) = TMO
 (ii) For any a, b e Z>o and any x,y 6 S(a, b), there exist Zi,..., Zk € Z such that
 k t
 y = x + Zj
 i = 1 i=l
 The elements of Z are ca
 odic, reversible and irreduci
 Metropolis-Hastings algorithm
 ing the move from ytoy+z
 See Diaconis & Sturmfels (199
 for the Ising model, the acce
 As explained in Diaconis & S
 algebraically. For the Ising m
 nomial ring C\Py I y e 5] of
 configurations. Similarly, we
 with two sets of indetermina
 L. Given a configuration y 6
 by restricting L to the vert
 yi 7^ yj }• Then we define a
 *(py) := n n n ^ n
 ieVy ieVWy (iJ)eEy (iJ)eE\Ey
 Let C[m, v, p, q) be the polynomial ring in four indeterminates and consider the mon
 homomorphism \fr : C[uj,Vj,pij,qij] -*■ <C[w, v, p,q] defined by
 f(uj):=u, f{vj):= v, f(pij) := p, f{qij):=q,
 for all i e V and (i,j) e E. With these definitions, we obtain that
 (^ o <t>)(Py) = vT>(y)u\V\-Ti(y)pT2(y)q\E\-T2(y)t
 where, as in (3), |K| = fjf=i Ni is the number of vertices and |£| = Y.f=\ (W'-O'FIy#/ Nj)
 is the number of edges in L. Then it follows directly from Diaconis & Sturmfels (1998, Section
 3) that any generating set for the ideal I := ker(^ o 0) is a Markov basis for the Ising model.
 © 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 290 A. Martin del Campo, S. Cepeda and C. Uhler
 Scand J Statist 44
 Example 2. Let y = (0,1,0,0,1,1,0,0,0) be a configuration on a 3 x 3 lattice L as represented
 by the following diagram
 We denote the vertices of L column-wise by {1,2,..., 9}. Then the induced subgraph Cy has
 vertices Vy = {2,5,6} corresponding to the coloured squares in the diagram. In this example,
 Ey = {(1,2), (2, 3), (3, 6), (4, 5), (5, 8), (6, 9)}. Therefore, the image of y under <p is
 <t>(Py) = v2 V5 t>6 U\ U3 U4 Uj Us U9 p\2 P23 P36 P45 P58 /?69?14 <725 <747 <756 <778 <789,
 and the image under the composition of <j> and x/r is
 (fo4>){Py) = v3u6p6q6,
 where the sufficient statistics 7"i (y) and 7"o( >') are the exponents of the indeterminates v and p,
 respectively. □
 For the 3x3 lattice, w
 4ti2 (4ti2 team, 2015
 mials of degree two, 
 generator of I involve
 ufct Hii
 Note that both configurations have the same sufficient statisti
 mean that if the chain is in the configuration on the right, we w
 on the left. Examples of elements of degree two and three in th
 as follows:
 Fgfffl-prapH and Wsro-WWH
 Note that the sum of the sufficient statistics of the configurations on the positive and the neg
 ative side are the same. When hypothesis testing is based on one observed configuration only,
 then only the degree one moves are of interest; however, if we had multiple observed configura
 tions, then we would also use the higher degree moves. Because the number of indeterminates
 involved in these Grobner bases computations grows exponentially with the size of the lat
 tice, we were not able to compute a Markov basis for a lattice of size 4x4 or larger using the
 current technology. One could optimize the Markov basis computation by considering other
 parameterizations of the model (Pistone & Rogantin, 2012) or by computing a Markov sub
 basis (Aoki et al., 2012, Chapter 16) that contains only the degree 1 moves. Also, it would be
 interesting to study the structure of the Universal Grobner basis or the Graver basis (Drton et
 al., 2009, Chapter 1) (both contain the Markov basis as a subset) for the Ising model, because
 these bases are often easier to describe algebraically, in particular, in the presence of symme
 tries. However, even with these approaches, it would be difficult to compute the moves needed
 for a lattice of size 10 x 10 (requires computations in a ring with over 100 indeterminates), let
 alone a lattice of size 800 x 800, as would be required for the example discussed in Section 6.
 ©2016 Board of the Foundation of the Scandinavian Journal of Statistics.
 {2,5,6} corresponding to the coloured squares in the diagram. In t
 (2, 3), (3, 6), (4, 5), (5, 8), (6, 9)}. Therefore, the image of y under <p i
 : V2 Vs t>6 "1 "3 U4 Uj Us U9 p\2 P23 P36 P45 P58 /?69?14 <725<747<756
 : under the composition of <p and \jr is
 Py) = v3u6p6q6,
 icient statistics 7"i (y) and Toiy) are the exponents of the indetermin;
 Î lattice, we computed a Markov basis for the ideal I using the algebi
 im, 2015). The Markov basis consists of 466 binomials of degree oi
 ;e two, and 4 binomials of degree three. For instance, the following
 ' involves the configuration y from Example 2:
 □id mi
 th configurations have the same sufficient statisti
 tie chain is in the configuration on the right, we wo
 samples of elements of degree two and three in th
 KS ~ and PHPfflPS3 W
 sum of the sufficient statistics of the configurations on the positive
 the same. When hypothesis testing is based on one observed configi
 degree one moves are of interest; however, if we had multiple observe
 : would also use the higher degree moves. Because the number of in<
 lese Gröbner bases computations grows exponentially with the siz
 not able to compute a Markov basis for a lattice of size 4x4 or lar|
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 Scand J Statist 44
 Goodness-of-fit test for the Ising model 291
 3. Constructing an irreducible Markov chain
 Besag & Clifford (1989) described a Metropolis-Hastings algorithm for conditional hypothesis
 testing in the Ising model. At each iteration, two lattice points of different states are randomly
 selected, and their states are switched if this preserves the sufficient statistics. However, as noted
 by Bunea & Besag (2000), this algorithm in general produces a reducible Markov chain on
 S(a,b)\ hence, it may not result in uniform samples from S(a,b) and lead to inaccurate p
 values. On the other hand, as we have seen in the previous section, computing a Markov basis
 for this problem guarantees irreducibility but is computationally intractable. In the following,
 we show how to modify the algorithm proposed by Besag & Clifford (1989) to obtain an irre
 ducible Markov chain without computing a Markov basis. Our method consists of using the
 simple moves considered by Besag and Clifford, but to expand the sample space and allow the
 sufficient statistics to change slightly. In this section, we prove that the resulting Markov chain
 is irreducible by exploiting the combinatorics underlying the Ising model.
 We define a simple swap to be an integer vector z € ZN>X- ■xNd of the form z = e, — ej,
 where the e, 's denote the canonical basis vectors of ZN[ X'"X ^. Simple swaps correspond
 to switching the states of two lattice points in configuration y, that is, replacing a pair
 (y,= 0, y j = 1 ) by (>'/ = l,>'y=0). Throughout the paper, Z denotes the set of simple swaps. Let
 y e S(a,b) be a configuration with yt =0 and yj = 1 and let z e Z be the simple swap e,- — ey-.
 Then T\ (_y) = T\ (>'+z) by construction, but 72(.V + z) may disagree with 72(v) = b. We say
 that two configurations y, y' e S (a, b) are S(a, b)-connected by Z, if there is a path between
 y and y' in S (a, b) consisting of simple swaps z € Z, that is, if there exist z\,...,zk £ Z
 such that
 k t.
 y' = y + Y
 With this no
 the Markov c
 y' = y+z. Acce
 example that 
 Example 3. C
 y,y' € 5(4,8)
 configuration
 statistics. □
 Interestingly
 Ising model.
 Hastings alg
 S*(a,b) such 
 then project 
 Fig. 2. Simple 
 [Colour figure 
 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 292 A. Martin del Campo, S. Cepeda and C. Uhler
 Scand J Statist 44
 and aperiodic, because there is some holding probability. Before presenting the construction of
 the set S*(a,b) and the proof of irreducibility of the resulting Markov chain, we introduce a
 special class of configurations.
 3.1. Max-singleton configurations
 A crucial element in the proof of irreducibility consists of configurations that maximize the
 number of singletons. Let L = (V, E) be the graph of a -dimensional integer lattice of size
 N\x...x Nj. Then each vertex ( e V is adjacent to 2d other vertices, except for those on the
 boundary of L. To simplify our exposition and not worry about boundary effects, we assume
 that all configurations have value 0 on the boundary.
 Let y € S be a configuration and Cy the induced subgraph defined by the vertices Vy. For a
 connected component C of Cy, the size \ C | is the number of vertices in C. A connected compo
 nent of size one is called a singleton. A max-singleton configuration for S (a, b) is a configuration
 y* e S(a, b) that maximizes the number of singletons.
 3.2. Irreducibility in the one-dimensional Ising model
 We now prove that the original algorithm by Besag & Clifford (1989) using simple swaps results
 in an irreducible Markov chain for the one-dimensional Ising model. Recall that the set S*(a, b)
 is defined as the smallest set that contains the sample space S(a,b), and for which, any two con
 figurations in S(a, b) can be connected by simple swaps Z without leaving S*(a,b), so we need
 to show that S*{a,b) = S(a, b). We do this by proving that the max-singleton configuration in
 S(a,b) for the one-dimensional Ising model is unique and then showing that any configuration
 y € S(a,b) is S (a, /))-connected by simple swaps to the unique max-singleton configuration.
 The proofs of the following results are given in the Appendix.
 Lemma 4. The max-singleton configuration of S(a, b) for the one-dimensional Ising model is
 unique (up to location of its connected components) and consists of b/ 2— 1 singletons and one
 connected component of size a — b/ 2+ 1.
 Theorem 5. For a,b e N and y e S(a,b), let y* e S {a, b) denote the unique max-singleton
 configuration. There exists a sequence zi,---,Zk e Z such that
 k I
 y* = y + z
 i = 1 / = 1
 By noting that all steps in the proof of The
 of the Markov chain based on simple swaps
 3.3. Irreducibility in the two-dimensional Is
 Example 3 illustrated that simple swaps 
 Markov chain for the two-dimensional Is
 S{a,b), the number b = T2(y) is always ev
 This can be seen by analyzing the induced 
 Hence, because simple swaps preserve the s
 S(a,b) is given by S(a,b) U S(a, b ± 2). We 
 is sufficient for the two-dimensional Is
 As for the one-dimensional case, we start b
 ©2016 Board of the Foundation of the Scandinavian Jo
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 Scand J Statist 44
 Goodness-of-fit test for the Ising model 293
 Fig. 3. A rectangular configuration y\j = (3,4,2,1,3). [Colour figure can be viewed at
 wileyonlinelibrary.com]
 then show that any configuration y € S (a, b) is S*(a, £)-connected by Z to the max-singleton
 configuration. The technical details can be found in the Appendix.
 Definition 6. A rectangular configuration >'□ is defined by (n, m, d\, d2, s) with n ,m, d\, dj, s e
 Z>o, f/2 £ {0, I}, <^2 £ d 1 < m < n and is of the following form: the induced subgraph Cy
 consists of s singletons and one additional connected component of size nm+d \ +d2, namely,
 a rectangle B of size nxm with a block of size d\ xl lying on one of the shorter sides of B and
 d2 vertices on the longer side of B.
 Figure 3 shows a rectangular configuration, where S is a rectangle of size 3x4, that is, n = 4,
 m = 3, and d\ = 2, J2 = 1, and s = 3. Note that a rectangular configuration ya defined by
 (n, m, d\, d2 ,s) has sufficient statistics
 T\ (>□) = nm + d\ + d2 + s, T2(yn) = 2(n + m + ôj, +d2 + 2s),
 where Stjt = 0 when d\ = 0, and = 1 otherwise. The following result shows that the max
 singleton configuration for the two-dimensional Ising model is a rectangular configuration. The
 proof is given in the Appendix.
 Lemma 7. The max-singleton configuration of S (a, b) for the two-dimensional Ising model is
 unique ( up to location) and corresponds to a rectangular configuration (n,m,d\,d2,s) with
 b/2- 1 - V4a -b+ 1
 m = [s/a — jJ, r = I -—- I,
 L m J
 r ~ ' '/= \rnr\ anc' b — As — 2(m + r) = 2,
 r otherwise,
 (d\, d2) =
 (a — s — mn, 0) ifb — As — 2(m -f r) = 0
 (a — s — tnn — 1,1) ifb — As — 2(m + r) = 2'
 As an example, consider the configurations of 5(18,30). The max-singleton configuration
 prescribed by Lemma 7 is a rectangular configuration with s = 3, m = 3, n — 4, d\ =2, and
 fi?2 = L This is precisely the one shown in Fig. 3 earlier.
 © 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 294 A. Martin del Campo, S. Cepeda and C. Uhler
 Scand J Statist 44
 To prove that S* (a, b) = S (a, b) U S (a, b ± 2), we first show that any rectangular configura
 tion ya e S (a, b) is S*(a, /) (-connected by Z to the max-singleton configuration y* € S (a, b).
 Then we show that any configuration y € S(a, b) is S*(a, è)-connected by Z to a rectangu
 lar configuration yo e S (a, b). By reversing the steps, this proves that any two configurations
 y,y' g S(a,b) are S*(a, />)-connected by Z. The proof of the following result is simple but
 technical and is therefore given in the Appendix.
 Proposition 8. Let >'□ e S (a, b) be a rectangular configuration, and let x* e S(a,b) be the
 max-singleton configuration. Then there exits a sequence z i,..., Zk 6 Z such that
 k i
 x* = yq +
 i=1 (=1
 We conclude with our
 Hastings algorithm. To
 enough space to locate 
 Theorem 9. Assume a
 that
 k e
 y = y' + T
 ( = i f' = i
 Proof As a consequence of Propo
 S(a,b) is S * (a, b) -connected to
 smallest rectangle containing Cy
 we remove all singletons from 
 connected components in the ou
 without loss of generality that Co
 We now show that by simple swa
 Ci,..., Q to form a rectangle C w
 We move each connected compone
 R,
 i
 I
 I
 I
 I
 (a) Bounding region and its outermost layer. (b) The rectangular configuration C.
 R.
 Co
 n
 cA
 ct-i
 ~c2
 (a) Bounding region and its outermost layer.
 (b) The rectangular configuration C.
 Fig. 4. Construction of the rectangular configuration C. [Colour figure can be viewed at
 wileyonlinelibrary.com]
 ©2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 Scand J Statist 44
 Goodness-of-fit test for the Ising model 295
 A1->B1
 A1-»B2
 A1->B3
 A2—>B1
 A2—>B2
 A3—»B1
 A3—>B2
 -2-swap
 O-swap
 +2-swap
 -2-swap
 O-swap
 O-swap
 +2-swap
 B
 ■■5
 Al—>B1
 A1-»B2
 A1->B3
 A2—»B1
 A2—»B2
 A3—>B1
 A3—>B2
 —2-swap
 O-swap
 +2-swap
 —2-swap
 O-swap
 O-swap
 +2-swap
 B
 ■■5
 Fig. 5. Types of simple swaps we use. [Colour figure can be viewed at wileyonlinelibrary.com]
 degree. In Fig. 5, we illustrate the different scenarios and the corresponding change in T2(y)
 for moving a vertex (indicated by a dashed box) in table A to the position indicated in table B.
 If |Q I = 1, then it is either a singleton and we move it outside of R or it is a vertex of degree
 1 (Al). Starting a new row on top of Co corresponds to scenario B2, so the first move is a 0
 swap (A1-»B2), meaning that 7*2 (y ) remains the same. If | C; | > 1, then the extremal sites are
 of degree 1 (A2) or of degree 2 (A3). So in this case, the first move is either a 0-swap (A2-»B2)
 or a +2-swap (A3—>B2). The remaining swaps to move C,- on top of Co are either —2-swaps
 (A 1 —s-B 1 or A2-»B1) or 0-swaps (A3—s-Bl). If the configuration lies in S(a, b—2) and the next
 move is of type A1-»B1, we instead create a singleton (A1->B3) and obtain a configuration
 in S(a, b). Note that if the first move is a +2-swap (A3-»B2), then the last remaining move in
 Cj is a —2-swap (Al-s-Bl), because we first swap extremal sites of smallest degree. So because
 |Co 1 > I Cj |, we are never in the situation in which we make two +2-swaps before a —2-swap.
 In this way, we transform the connected components Cj,..., Q into a rectangular config
 uration C. We repeat the process by letting Cq, C[,... ,C'f, be the components of the next
 layer in R with Cq denoting the largest connected component. If |Cq| < |Co|, then we move
 Cq, Cj, ..., C'v on top of C as before. Otherwise, we move Co U C on top of Cq and proceed
 with C,',..., C'v as before with C\,..., Q. We continue inductively until we reach a rectangu
 lar configuration (with d2 = 0) that lies either in S(a,b) or S(a,b—2). In the latter case, we
 obtain a rectangular configuration in S(a,b) by reducing d\ by one and letting dj = 1 as in
 the proof of Proposition 8 in the Appendix (Fig. Bl). □
 3.4. Higher dimensional Ising model
 We now show how our Metropolis-Hastings algorithm can be extended t
 Ising model when d > 3. Let L = (V, E) be the (/-dimensional lattice gra
 Nfi. Let S*[ (a, b) denote the smallest expanded sample space such that any
 ^/-dimensional lattice are «S^(a,è)-connected by Z. In Section 3.2, we sh
 S(a,b), and in Section 3.3, we proved that Sj(a,b) = S(a,b) U S(a,b
 d—1 -dimensional configuration can be realized as a configuration in a (/-
 it must hold that (a, b) ç ,S* (a, b). Moreover, let us consider the (/-d
 of Example 3, where y is a hyper-rectangular configuration of size 2 x
 dimensional lattice. Note that any simple swap z 6 Z satisfies T2(y
 T2(y+Z) = 7200 + 2{d—1) and hence S(a,b ± 2(d— 1)) ç S*{a,b). We
 expansion is in fact sufficient, that is,
 S*d(a, b) = (a, b) U S(a, b±2(d- 1)).
 For instance, for the three-dimensional lattice, this means that S^(a,b) = S (a, b) U S (a, b ±
 2) U S(a, b ± 4). The proof of irreducibility in the (/-dimensional case is analogous to the
 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 296 A. Martin del Campo, S. Cepeda and C. Uhler
 Scand J Statist 44
 Fig. 6. A three-dimensional rectangular configuration. [Colour figure can be viewed at wileyonlineli
 brary.com]
 two-dimensional case. We therefore omit the details and only show how to generalize the two
 most important elements of the proof, namely, the concept of a rectangular configuration and
 the types of simple swaps in Fig. 5 to connect any configuration to a rectangular configuration.
 Definition 10. A d-dimensional rectangular configuration consists of ,v singletons and one addi
 tional connected component B that decomposes into B = (Bd, B^—i,..., B\, üS ), where B(j
 is a tZ-dimensional rectangular block of size m i xm 2 x... x m(j with m 1 < »12 < ... < m a. For
 each k = 2,... ,d—1, Bk is a A:-dimensional rectangular configuration that lies in the small
 est facet (of size m\ x ... x mk-\) of the k + l-dimensional rectangular block B,t+i. Lastly,
 d2 € {0, 1}.
 A three-dimensional rectangular configuration is shown in Fig. 6. The d-dimensional ana
 logue of the simple swaps in Fig. 5 is swaps of a vertex that is adjacent to either 1,2 d
 neighbours (as indicated in Table A in Fig. 5 for the two-dimensional case), to a position
 (indicated in Table B in Fig. 5 for the two-dimensional case) with either 0, 1, 2,..., d—1, or d
 neighbours. With this observation, it is straightforward to generalize the proofs for the two
 dimensional setting to show irreducibility of our Metropolis-Hastings algorithm for the Ising
 model in higher dimensions.
 Theorem 11. Suppose a « \V\. For any d-dimensional configurations y,y' € S(a,b), there
 exits a sequence z 1 Zk € Z such that
 k t
 y = y' + ^
 (=i (=i
 4. Test statistics for 
 After showing how
 S(a, b), we now descr
 null model is the Isi
 ence of long-range i
 describe both alternatives and various test statistics.
 ©2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 Scand J Statist 44
 Goodness-of-fit test for the Ising model 297
 4.1. Presence of long-range interactions
 This alternative hypothesis is defined by
 exp(a ■ T\(y) + fi ■ T2(y) + y ■ T3(y))
 Prob(.y) =
 Z(a,p,y)
 where a, fi and y are the model parameters, Z(a, y) is the normalizing constant, and T\ (>•),
 T2(y), and T3(y) are the minimal sufficient statistics, where 7] (y) and 7'2(>») are the sufficient
 statistics of the Ising model as defined in (1). For instance, y could correspond to the interaction
 between second-nearest neighbours with
 Ti(y) = \yt-yk\
 <.i,j),(j.k)eE
 A particular example of this model is a model with interaction between diagonal neigh
 ?300 = \yi-ykV (4)
 UJ),U,k)eE
 i,k diagonal neighbours
 Or y could correspond to an overall effect for example with
 T,(V\ - 11 if£<€K J/is even,
 W ~ j 0 otherwise, (5)
 an indicator function taking the value 1 if the number of ones i
 the value 0 otherwise.
 Besag (1977) proposed as a test statistic for the Ising model to use
 • the number of diagonal pairs, that is, the number of patterns of the form ■—I (and its
 rotational analogue) in a configuration.
 Applied in a one-sided test, this statistic may be an indicator for the presence of positive
 higher-order interaction. However, one also expects to see a large number of diagonal pairs
 under the Ising model with negative nearest-neighbour interaction. As we show in our sim
 ulations in Section 5, other statistics are therefore usually more adequate for goodness-of-fit
 testing in the Ising model. We propose and analyze the following two test statistics to be used
 for two-sided tests, namely,
 • the number of adjacent pairs, that is, the number of patterns of the form (and the
 rotational analogues) in a configuration;
 • the number of consecutive pairs, that is, the number of patterns of the form I—I—MS
 (and the vertical analogues) in a configuration.
 Note that the presence of a very large or very small number of adjacent pairs or consecutive
 pairs is not expected under the Ising model for any choice of the parameters, and this is an
 indicator for the presence of positive or negative long-range interactions.
 4.2. Presence of non-homogeneity
 This alternative hypothesis is defined by
 Prob( v) = exP&'-vaty<+Zuj>.EPu\yj -v/1) (6)
 Z(a,P)
 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
 , and 73( v) are the minimal sufficient statistics, where T\ (y) and 72 (y) are the sufficier
 ics of the Ising model as defined in ( 1). For instance, y could correspond to the interactio
 zn second-nearest neighbours with
 n3(y) = \yi-ykV
 ticular example of this model is a model with interaction between 
 3 (>0 = 53 \yi~ykV (4
 UJ),U,k)eE
 i,k diagonal neighbours
 y could correspond to an overall effect for example with
 3W=(lif^^'iseven' (5
 J 0 otherwise,
 licator function taking the value 1 if the number of ones in the lattice is even and takin
 lue 0 otherwise.
 ag (1977) proposed as a test statistic for the Ising model to use
 the number of diagonal pairs, that is, the number of patterns of the form ■—I (and it
 rotational analogue) in a configuration.
 5lied in a one-sided test, this statistic may be an indicator for the presence of positiv
 -order interaction. However, one also expects to see a large number of diagonal pair
 the Ising model with negative nearest-neighbour interaction. As we show in our sim
 is in Section 5, other statistics are therefore usually more adequate for goodness-of-fi
 ; in the Ising model. We propose and analyze the following two test statistics to be usee
 o-sided tests, namely,
 the number of adjacent pairs, that is, the number of patterns of the form *■ (and th
 rotational analogues) in a configuration;
 the number of consecutive pairs, that is, the number of patterns of the form
 (and the vertical analogues) in a configuration.
 te that the presence of a very large or very small number of adjacent pairs or consecutiv'
 is not expected under the Ising model for any choice of the parameters, and this is ai
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 298 A. Martin del Campo, S. Cepeda and C. Uhler
 Scand J Statist 44
 where a el'K| and ß e R|£| are the model parameters and Z(a, ß) is the normalizing con
 stant. We consider the following test statistics for non-homogeneity: let y € S denote the
 configuration of the current step of the Markov chain. We uniformly sample K pairs of disjoint
 square sub-configurations xj, xf of y of size N x N and compute
 aj := Ti(xl), b} := T2(xx), af := Tx{x2), bf := T2(x2), for i = 1,..K.
 The following test statistics measure the degree of non-homogeneity in a configuration:
 • Vertex-non-homogeneity: dT\ := max, = [ « \aj — af |. We expect this test statistic to
 be small under homogeneity when a,- = a for all i e V.
 • Edge-non-homogeneity: dT2 := max,-—i ^ \bj — bf |. We expect this test statistic to be
 small under homogeneity when ßjj = ß for all (i,j)eE.
 • General non-homogeneity: dT\2 := max 2Arf)v-i))' where N2 is the number of
 vertices and 2N(N-l) is the number of edges in an N x N sublattice; this is used for
 normalization. This test statistic is a combination of the previous two test statistics.
 5. Simulations
 In this section, we compare the performance of the test statistics described in Section 4 for
 recognizing departure from the Ising model and discuss some simulation results. We performed
 simulations on the 10 x 10 lattice and analyzed the type-I and type-II errors of the different test
 statistics. We generated data under four different models:
 (1) Ising model
 (i) with positive interaction, that is, ß > 0,
 (ii) with negative interaction, that is, ß < 0.
 (2) Non-Ising model with interaction between diagonal neighbours as described in (4).
 (3) Non-Ising model with vertex-non-homogeneity as described in (6).
 (4) Non-Ising model with an overall effect defined by a = 0, ß = 0 and y = 1/5 as
 described in (5).
 We generated data from these models by MCMC simulation using periodic boundary con
 ditions. We performed two sets of simulations, namely, one set of simulations to compare the
 test statistics for the Ising model with positive interaction to the three non-Ising models and a
 second set of simulations to compare the test statistics for the Ising model with negative interac
 tion to the three non-Ising models. The values for the model parameters were chosen in such a
 way that, at equilibrium, the resulting data under the different models have the same sufficient
 statistics, namely, T\ (_y) = 52 and T2(y) = 70 in the first set of experiments and T\ {y) = 57
 and 720) = in the second. To generate the data sets, a Markov chain was initiated in
 a random configuration, and the standard Metropolis-Hastings algorithm for minimizing the
 energy was used for 10,000 steps. After removing the first 1000 steps as burn-in, we chose at
 random one of the remaining configurations with the given values of T\ and T2. The data sets
 for the different models are made available on the website of the first author.
 We then generated three Markov chains with 100,000 iterations each as explained in Section 3
 and used the tools described by Gilks et al. (1996) to assess convergence of the chains. This
 included analyzing the Gelman-Rubin statistic and the autocorrelations. We combined the
 three Markov chains to generate the posterior distribution of the six test statistics given in
 Section 4. For the non-homogeneity tests, we sampled K = 100 pairs of subtables of size 3x3.
 © 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 Scand J Statist 44
 Goodness-of-fit test for the Ising model 299
 Posterior Diagonal Pairs Posterior Adjacent Pairs
 <D
 Q
 □ Model 1 i ( 4 )
 o Model 2(0)
 A Model 3(2)
 x Model 4(5)
 4 6 8 10
 Diagonal Pairs
 (a)
 □
 o
 A
 X
 Model 1i (0.32)
 Model 2 ( 0.2 )
 Model 3 ( 0.72 )
 Model 4 ( 0.32 )
 d Model 1i (8)
 o Model 2(5)
 A Model 3 (18)
 x Model 4(8)
 □ Model
 o Model
 a Model
 x Model
 1i (24)
 2(53)
 3(17)
 4(31 )
 S
 o
 10 15 20
 dT1
 (d)
 Posterior dT12
 0.2 0.4 0.6 0.8
 dT12
 10 20 30 40
 Adjacent Pairs
 (b)
 Posterior dT1
 Posterior Consecutive Pairs
 Model 1i (6) 1
 Model 2(1)
 Model 3(3)
 Model 4(7)
 5 10 15
 Consecutive Pairs
 (c)
 Posterior dT2
 (e)
 (0
 Posterior Diagonal Pairs
 Posterior Adjacent Pairs
 CO
 c
 0)
 O
 □ Model 1 i (4)
 o Model 2(0)
 A Model 3(2)
 x Model 4(5)
 4 6 8
 Diagonal Pairs
 (a)
 □
 o
 A
 X
 Model 1i (0.32)
 Model 2 (0.2)
 Model 3 ( 0.72 )
 Model 4 (0.32 )
 a Model 1i (8)
 o Model 2(5)
 A Model 3 (18)
 x Model 4(8)
 □ Model
 o Model
 a Model
 x Model
 1i (24)
 2(53)
 3(17)
 4(31 )
 ~ °
 CO
 C
 CD
 O g
 d
 10 15 20
 dT1
 (d)
 Posterior dT12
 0.2 0.4 0.6 0.8
 dT12
 10 20 30 40
 Adjacent Pairs
 (b)
 Posterior dT1
 Posterior Consecutive Pairs
 5 10 15
 Consecutive Pairs
 (c)
 Posterior dT2
 Model 1 i (9)
 Model 2(4)
 Model 3 (10)
 Model 4 (12)
 (e)
 (0
 Fig. 7. Posterior distribution of the six test statistics defined in Section 4 for the first set of experiments
 based on three chains of 10,000 Monte Carlo steps each; the sufficient statistics of the observed configura
 tions from the four models are T\(y) = 52 and Toiy) = 70; the observed value of each test statistic is
 given in the legends and depicted in the plots. [Colour figure can be viewed at wileyonlinelibrary.com]
 Figure 7 shows the posterior distribution of the six test statistics described in Section 4 for
 the first set of simulations with an Ising model with positive interaction and sufficient statistics
 TI (y) = 52 and T2(y) = 70. The observed values of the test statistics for the four different
 models are given in the legends and depicted in the plots. The mean, standard deviation and
 various quantiles of the posterior distributions are given in Table 1. As seen in Fig. 7 and in
 Table 1, none of the tests reject the null hypothesis for data generated under the Ising model
 © 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 300 A. Martin del Campo, S. Cepeda and C. Uhler Scand J Statist 44
 Table 1. Summary statistics of the posterior distributions for the first set of experiments
 Test
 Mean
 a
 Quantiles
 0.025 0.05 0.5 0.95 0.975
 Diagonal pairs
 Adjacent pairs
 Consecutive pairs
 3.727558 1.7006851 1
 19.851085 3.9803748 13
 7.160328 2.3170231 3
 8.394267 2.829628 4
 8.2569350 2.8088039 4
 0.3430878 0.1075384 0.175
 14 7 7
 13 20 27 28
 4 7 11 12
 4 8 14 15
 4 8 13 15
 0.2 0.32 0.56 0.6
 dT i
 dT2
 dT\2
 with positive interaction (model li) using a significance level of 0.05. For data generated under
 the non-Ising model with interaction of diagonal neighbours (model 2), the null hypothesis
 is rejected by all three tests for large-range interaction (a)-(c), but the null hypothesis is not
 rejected by the tests for non-homogeneity (d)-(f). For data generated under the non-Ising model
 with vertex-non-homogeneity (model 3), the null hypothesis is rejected using the vertex-non
 homogeneity test dT\ and the general non-homogeneity test dT\2 (Fig. 7D and E), and it is
 not rejected using any other tests. This shows the importance of non-homogeneity tests. As
 shown in these simulations, recognizing an overall effect is difficult. Interestingly, test (b) which
 counts the adjacent pairs is able to recognize departure from the Ising model for this example.
 Figure 8 shows the posterior distribution of the six test statistics for the second set of simu
 lations with an Ising model with negative interaction and sufficient statistics T\ (y ) = 57 and
 7*2(y) = 106. The observed values of the test statistics for the four different models are given
 in the legends and depicted in the plots. The mean, standard deviation and various quantiles of
 the posterior distributions are given in Table 2. As seen in Fig. 8 and in Table 2, none of the tests
 reject the null hypothesis for data generated under the Ising model with negative interaction
 (model Iii). However, the test based on the number of diagonal pairs is close to rejection even
 for a moderate negative interaction. For a larger negative interaction, this test rejects the null
 hypothesis leading to a large type-I error. For data generated under the non-Ising model with
 interaction of diagonal neighbours (model 2), the null hypothesis is only rejected by test (b)
 based on counting the number of adjacent pairs. For data generated under the non-Ising model
 with vertex-non-homogeneity (model 3), the null hypothesis is rejected by two tests for large
 range interactions, namely, tests (a) and (b) and weakly rejected by the vertex-homogeneity test
 dT\ (Fig. 8D). As in the first set of simulations, it is very difficult to recognize an overall effect.
 Based on our simulation results, we decided to use two test statistics for analyzing the spatial
 organization of receptors on the cell membrane in Section 6, namely, the test statistic based on
 counting adjacent pairs and the general non-homogeneity test dT\2- In our simulations, these
 test statistics seem to have a low type-I and type-II error rate.
 6. Applications to biological data
 In this section, we present an application of our methods to biological data. The data concern
 the spatial distribution of receptors on the cell membrane, and it consists of an image of a cell
 membrane in super resolution, where receptors are highlighted against all other components.
 In order to minimize the border effect that would confer higher density of receptors around the
 edges in the picture, only a central lattice of 800x800 pixels was chosen. This corresponds to
 the largest square completely enclosed within the circular border. To each pixel, we associate a
 random variable yi that takes values 0 or 1 indicating whether a receptor was present in pixel
 i. We apply our goodness-of-fit methodology to test if the spatial distribution of the receptors
 follows an Ising model.
 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
 0.025 0.05
 0
 pairs 3.727558
 pairs 19.851085
 ive pairs 7.160328
 8.394267
 8.2569350
 1.7006851 1 1
 3.9803748 13 13 2
 2.3170231 3 4
 2.829628 4 4 !
 2.8088039 4 4 !
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 Scand J Statist 44
 Goodness-of-fit test for the Ising model 301
 Posterior Diagonal Pairs
 Posterior Adjacent Pairs
 10 15 20
 Diagonal Pairs
 (a)
 Posterior Consecutive Pairs
 5 10 15 20 25 30 35
 Adjacent Pairs
 (b)
 Posterior dT1
 5 10
 Consecutive Pairs
 (c)
 Posterior dT2
 (d)
 Posterior dT12
 □ Model 1 ii ( 6 )
 o Model 2(6)
 A Model 3 (12) I
 x Model 4(10)
 0.1 0.2 0.3 0.4 0.5 0.6 0.7
 dT12
 (e)
 (f)
 Posterior Diagonal Pairs
 Posterior Adjacent Pairs
 10 15 20
 Diagonal Pairs
 (a)
 Posterior Consecutive Pairs
 5 10
 Consecutive Pairs
 (c)
 Posterior dT2
 □ Model 1 ii ( 6)
 o Model 2(6)
 A Model 3 (12) I
 x Model 4(10)
 (e)
 C
 0
 o
 10 15 20 25 30 35
 Adjacent Pairs
 (b)
 Posterior dT1
 (d)
 Posterior dT12
 □ Model 1ii (0.24) |
 o Model 2 ( 0.2)
 a Model 3 (0.32)
 x Model 4 ( 0.25 )
 0.1 0.2 0.3 0.4 0.5 0.6 0.7
 dT12
 (f)
 Fig. 8. Posterior distribution of the six test statistics defined in Section 4 for the second set of experiments
 based on three chains of 10,000 Monte Carlo steps each; the sufficient statistics of the observed configura
 tions from the four models are T\ (y) = 57 and T2 (y) = 106; the observed value of each test statistic is
 given in the legends and depicted in the plots. [Colour figure can be viewed at wileyonlinelibrary.com]
 The observed configuration y has sufficient statistics T\ (y) = 14, 483 and T2(y) = 51, 145.
 As test statistics, we used the count of adjacent pairs and the non-homogeneity test dT\2. The
 observed values were 3977 for the adjacent pairs and 0.1389184 for dT\2- The Monte Carlo
 simulation consisted of 50 different realizations of a 40,000 step Markov chain starting from
 the observed configuration. After removing the first 10,000 steps as burn-in, we analyzed the
 convergence of the chains by studying the Gelman-Rubin statistic and the autocorrelations
 © 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 302 A. Martin del Campo, S. Cepeda and C. Uhler Scand J Statist 44
 Table 2. Summary statistics of the posterior distributions for the second set of experiments
 Test
 Mean
 a
 Diagonal pairs
 Adjacent pairs
 Consecutive pairs
 dT\
 cLT2
 dT\2
 13.4802400
 17.8396450
 4.7658575
 5.345140
 8.9426925
 0.2543455
 3.4080909
 3.8995787
 2.2035294
 1.703516
 3.1193738
 0.0696624
 Testing for non-lsing-type interactions
 4400 4600
 Adjacent pairs
 Quantiles
 0.025 0.05 0.5 0.95
 0.975
 lal pairs 13.4802400
 :nt pairs 17.8396450
 ;utive pairs 4.7658575
 5.345140
 3.4080909 7 8 14
 3.8995787 10 12 18
 2.2035294 1 1 5
 1.703516 3 3 5
 Testing for non-lsing-type interactions
 observed value (3977)
 4400 4600
 Adjacent pairs
 Testing for non-homogeneity
 Fig. 9. Posterior distribution of the two test statistics based on 50 chains 
 starting from the biological data; the observed value of each test statisti
 figure can be viewed at wileyonlinelibrary.com]
 as described in Gilks et al. (1996). We combined the 50 Markov 
 rior distribution of the test statistics, illustrated in Fig. 9. For th
 sampled K = 500 pairs of subtables of size 50x50.
 The hypothesis of nearest-neighbour interaction was discarded a
 0.001 and the homogeneity hypothesis at significance level p < 0.0
 References
 4ti2 team. (2015). 4ti2—a software package for algebraic, geometric and combinatorial problems on linear
 spaces. Available at: www.4ti2.de.
 Aoki, S., Hara, H. & Takemura, A. (2012). Markov bases in algebraic statistics. Springer, New York.
 Besag, J. (1972). Nearest-neighbour systems and the auto-logistic model for binary data. J. Roy. Statist.
 Soc. Ser. B 34, 75-83.
 Besag, J. (1974). Spatial interaction and the statistical analysis of lattice systems. J. Roy. Statist. Soc. Ser.
 B 36, 192-236. With discussion by D. R. Cox, A. G. Hawkes, P. Clifford, P. Whittle, K. Ord, R. Mead, J.
 M. Hammersley, and M. S. Bartlett and with a reply by the author.
 Besag, J. (1977). Some methods of statistical analysis for spatial data. In Proceedings of the 41st Session of
 the International Statistical Institute (New Delhi, 1977), Vol. 2. Bull. Inst. Internat. Statist. 47, 77-91,
 138-147. With discussion.
 Besag, J. (1986). On the statistical analysis of dirty pictures. J. Roy. Statist. Soc. Ser. B 48, 259-302.
 Besag, J. (1993). Towards Bayesian image analysis. J. Appl. Statist. 20, 107-119.
 Besag, J. & Clifford, P. (1989). Generalized Monte Carlo significance tests. Biometrika 76, 633-642.
 Brush, S. G. (1967). History of the Lenz-Ising model. Rev. Mod. Phys. 39, 883-893.
 Bunea, F. & Besag, J. (2000). MCMC in I x J x K contingency tables. In Monte Carlo methods (Toronto,
 ON, 1998), volume 26 of Fields Inst. Commun. Amer. Math. Soc., Providence, RI; 25-36.
 © 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 Scand J Statist 44 Goodness-of-fit test for the Ising model 303
 Cai, S., Li, B. & Guo, J. (2014). A simplification of computing Markov bases for graphical m
 underlying graphs are suspensions of graphs. Stat. Sinica 24,447-461.
 Chen, Y., Dinwoodie, I. H. & Yoshida, R. (2010). Markov chains, quotient ideals and conne
 positive margins. In Algebraic and geometric methods in statistics Cambridge Univ. Press
 99-110.
 Diaconis, P. & Sturmfels, B. ( 1998). Algebraic algorithms for sampling from conditional distributions. Ann.
 Statist. 26, 363-397.
 Dobra, A. (2012). Dynamic Markov bases. J. Comput. Graph. Statist. 21,496-517.
 Drton, M., Sturmfels, B. & Sullivant, S. (2009). Lectures on algebraic statistics of Oberwolfach seminars,
 Vol. 39, Birkhäuser Verlag, Basel.
 Galam, S., Gefen, Y. & Shapir, Y. (1982). Sociophysics: A new approach of sociological collective
 behaviour. I. mean-behaviour description of a strike. J. Math. Sociol. 9,1-13.
 Galam, S. & Moscovici, S. (1991). Towards a theory of collective phenomena: Consensus and attitude
 changes in groups. Eur. J. Soc. Psychol 21,49-74.
 Gilks, W. R., Richardson, S. & Spiegelhalter, D. J. (eds). (1996). Markov Chain Monte Carlo in practice,
 Interdiscip. Statist. Chapman & Hall, London.
 Gross, E., Petrovic, S. & Stasi, D. (2016). Goodness-of-fit for log-linear network models: Dynamic Markov
 bases using hypergraphs. Ann. Inst. Statist. Math, 1-32.
 Harary, F. & Harborth, H. (1976). Extremal animals. J. Combin. Inform. System Sei. 1,1-8.
 Hosten, S. & Sullivant, S. (2007). A finiteness theorem for Markov bases of hierarchical models. J. Comb.
 Theory ( Series A ) 114, 311-321.
 Ising, E. (1925). Beitrag zur theorie des ferromagnetismus. Z. Phy. 31,253-258.
 Kahle, T. & Rauh, J. (2013). The Markov bases database. Available from: http://markov-bases.de/ [accessed
 March 2016],
 Koyama, T., Ogawa, M. & Takemura, A. (2015). Markov degree of configurations defined by fibers of a
 configuration. J. Algebr. Stat. 6, 80-107.
 Majewski, J., Li, H. & Ott, J. (2001). The Ising model in physics and statistical genetics. Am. J. Hum. Genet.
 69, 853-862.
 Ogawa, M., Hara, H. & Takemura, A. (2013). Graver basis for an undirected graph and its application to
 testing the beta model of random graphs. Ann. Inst. Statist. Math. 65,191-212.
 Petrovic, S., Rinaldo, A. & Fienberg, S. E. (2010). Algebraic statistics for a directed random graph model
 with reciprocation. In Algebraic methods in statistics and probability II, volume 516 of contemp. math.
 Amer. Math. Soc., Providence, RI; 261-283.
 Pistone, G. & Rogantin, M. (2013). The algebra of reversible Markov chains. Ann. Inst. Statist. Math. 65,
 269-293.
 Pistone, G. & Rogantin, M. P. (2012). Toric statistical models: Ising and Markov. In Harmony of Gröbner
 bases and the modern industrial society World Sei. Publ., Hackensack, NJ; 288-313.
 Rapallo, F. (2003). Algebraic Markov bases and MCMC for two-way contingency tables. Scand. J. Stat.
 30, 385-397.
 Rapallo, F. & Yoshida, R. (2010). Markov bases and subbases for bounded contingency tables. Ann. Inst.
 Statist. Math. 62, 785-805.
 Rauh, J. & Sullivant, S. (2016). Lifting Markov bases and higher codimension toric fiber products. J.
 Symbolic Comput. 74, 276-307.
 Schneidman, E., Berry, M. J., Segev, R. & Bialek, W. (2006). Weak pairwise correlations imply strongly
 correlated network states in a neural population. Nature 440,1007-1012.
 Slavkovic, A. B., Zhu, X. & Petrovic, S. (2014). Fibers of multi-way contingency tables given conditionals:
 Relation to marginals, cell bounds and Markov bases. Ann. Inst. Statist. Math, 1-28.
 Tkacik, G., Marre, O., Amodei, D„ Schneidman, E., Bialek, W. & Berry II, M. J. (2014). Searching for
 collective behavior in a large network of sensory neurons. PLoS Comput. Biol 10, el 003408.
 Tkacik, G., Schneidman, E., Berry II, M. J. & Bialek, W. (2006). Ising models for networks of real neurons.
 Preprint arXiv 0611072.
 Received February 2015, in final form May 2016
 Abraham Martin del Campo, Centro de Investigation en Matemäticas, A.C., Jalisco s/n, Col. Valenciana,
 36023 Guanajuato, Gto., México.
 E-mail: abraham.mc@cimat.mx
 © 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 304 A. Martin del Campo, S. Cepeda and C. Uhler
 Scand J Statist 44
 Appendix A: Proofs for the one-dimensional Ising model
 A.l Proof of Lemma 4
 Suppose that y e S(a,b) and write y = (c,s), where 5 is the number of singletons of
 y and c is a configuration without singletons. We need to show that if y is a max-singleton
 configuration, then c consists of at most one connected component of size |c| = a — b/2 + 1.
 Assume that c has (at least) two connected components Ci, C2 of size k\, k2 > 1, respec
 tively. Write Ci = yil+iyil+2...yil+kl and similarly C2 = yi2+iyi2+2..-yi2+k2 with
 i\+k\ < i2. Without loss of generality, assume that yj = 0 for all j € {ii +k\ +1, ...12 — 1}.
 Consider the simple swap Z\ = e,-, _)_Ar, +1 ~e/2 at,d notice that c +z contains two components,
 of sizes k\ +1 and k2—\, respectively. Therefore, we can find simple swaps zi,.. -,Zk2-1 such
 thatc+2i + .. .+z;t2_i contains one component of size A: 1 +£2—1 and one singleton. However,
 the configuration y + z 1 +... + Zk2-\ contains one more singleton than y, which contradicts
 the maximality ofy. □
 A. 2 Proof of Proposition 5
 Write y = (c, s) where s is the numb
 tons. In particular, we can write c 
 components of length larger than o
 i = 1, If I = 0,1 then y is already an
 i > 2. As in the proof of Lemma 4, w
 increase the length of Q_i until
 decrease the length of Q_i and incre
 gleton and the latter becomes a com
 way, we can reduce Q, Q_ 1,..., C2 in
 k\ + k2 + ... + ka — (I — 1). The 
 Appendix B: Proofs for the two-dimens
 B.l Proof of Lemma 7
 Let y* e S (a, b) be a max-singleton 
 and let c denote the configuration 
 because ,v is maximal, we are interes
 optimization problem:
 minimize 72(c)
 C
 subject to T\(c) = a- s.
 Let Lc = (Vc,Sc) be the subgraph induced by the configuration c. Because 72(c) =
 4(a— s) — 2|£c|, minimizing 72(c) is equivalent to maximizing \£c\. In the language of grid
 graphs, Harary & Harborth (1976) showed that the maximal number of edges that a graph like
 Cc can have is [2(a—,v)-2Va--'>J, and this maximum is attained when Cc comes from a rectan
 gular configuration c* defined by (r,m,d\, d2,5) with s =0,m = [*Ja - .vj, r = [(a - s)/m\,
 d\ = a - s - mr and d2 = 0. As a result, T2{c) is lower bounded as follows:
 4{a — s) — 2[2(a — s) — 2s/a — sj < T2(c) — b — As. (Bl)
 © 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 Scand J Statist 44
 Goodness-of-fit test for the Ising model 305
 Because b is always even, we find that (Bl) is equivalent to
 A a - b
 —-— < (a — s) — *Ja — s.
 By squaring and solving the quadratic equation, we obtain
 (Aa—b)/2 + 1 + ~jAa—è+1
 a — s >
 Because we are interested in the solution that maximizes the number of sing
 (Aa-b)/2 + 1 + jAa-b+l
 b/2 — 1 — ~jAa—b+l
 (B2)
 Hence, the max-singleton configuration y* is a rectangular configuration, where the number
 of singletons is given in (B2) and the additional connected component consists of a box of size
 m xr. We still need to increase the first sufficient statistic by a—s—mr and the second sufficient
 statistic by b — 4s — 2(m+r). Note that because s is maximized, b — As — 2(m+r) € {0,2}, thus
 letting n = r and
 (di, d2)
 (a—s — mn, 0) if b — 4s — 2(m+r) = 0
 (a — s — mn — 1,1) if b — 4s — 2(m+r) - 2
 completes the proof for all cases except for the case«— s —mr = 0 and b—4,s—2(m+r) = 2. For
 this case, we reduce the second sufficient statistic as illustrated in Fig. Bl. Thus, the resulting
 rectangular configuration is of size (r—\,m,m — 1,1, s). We complete the proof by letting n =
 r — 1 and noting that the condition a—s — mr = 0 is equivalent to a—s/m being integer. □
 B.2 Proof of Proposition 8
 Writer = (n,m,d\ ,do,s). In addition, suppose that n — m > I ; otherwise, y would already
 be an optimal rectangular configuration. We need to show that the nx/n-rectangular block B
 can be rearranged into a rectangular block of size n'xrn' with 0 <n' — m'< 1 with only 0- or
 ±2-swaps. For this, we use moves of the type indicated in Fig. 5 to move one of the sides of B
 of length m to an adjacent side in B as indicated in Fig. B2.
 (i) If 0 = c?2 < d\ and n—1— d\ < m, then let k = n—1— d\, so we only need Z\,...,Zk
 moves, all of type A3—»B1 (thus they are 0-moves). As a result, we obtain a rectangular
 configuration (m', n',d[, d'2,s) with m' = m+\,n' = n—\,d[ = d\ — (n— m—1).
 (ii) If 0 = d2 < d\ but n— 1— d\ > m, then we use moves where z i ,..., Zm-1
 are swaps of type A3->B1 and a move zm of type A1 —> B1, which is a (—2)-swap, so
 the resulting configuration will have m' = m,n' = n — \ ,d\ = m + d\. Notice that the
 Fig. Bl. Turning a configuration (n.m.0,0, s) to (n—1, m,m—1,1,5). [Colour figure can be viewed at
 wileyonlinelibrary.com]
 © 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

 306 A. Martin del Campo, S. Cepeda and C. Uhler
 Scand J Statist 44
 Fig. B2. Changing the shape of the rectangular block B. [Colour figure can be viewed at
 wileyonlinelibrary.com]
 resulting configuration may not be rectangular if d[ > m', but we repeat this step until
 we are in the situation of (i) or (iv).
 (iii) If d\ = 0, then we just move one of the sides of length m on top, which will require
 moves zi,... ,zm, where zi is of type A3->B2, Z2, ■ ■ ■ ,zm-\ of type A3-»B1, and zm
 of type Al-^-Bl.
 (iv) If d2 = 1, then we first make a swap of type A1-^B1 to join ^2 to the d\ block, giving
 as a result a configuration with d[ = d\ + 1, di = 0 but that lie in S (a, b—2).
 We can always continue in this way, repeating steps (i)-(iv), with the subtle difference that
 if at some point the configuration lies in S(a, b—2) we will replace the move of type Al—>-Bl
 by one of type Al—^B3. In this way, at the end of each step, either n decreases by one or m
 increases by one, resulting in a configuration with n' — m' < 1.
 If at the end of this procedure the resulting rectangular configuration y' = (m, m, d\, d2, s')
 lies in S(a,b—2), we move to one in S(a,b) as follows. If either d2 = 1 or d\ = 1, make a
 simple swap of type Al->-B3 to obtain a configuration in S(a, b) with either d^ = 0, or d[ = 0
 and s' = j+1. If d2 =0 and d 1 > 1, then we make a +2-swap of type A3-»B2 to obtain a
 configuration with d'z = 1 and d[ = d\— 1.
 Lastly, if d\ =0, then the current configuration has shape (n, m , 0,0, .v) and with a 2-swap
 of type A3-»B2 we make a configuration that has shape («—1, l,s), as depicted in
 Fig. B1 earlier. □
 © 2016 Board of the Foundation of the Scandinavian Journal of Statistics.
This content downloaded from 132.174.252.114 on Tue, 28 Feb 2023 12:51:06 UTC
All use subject to https://about.jstor.org/terms

