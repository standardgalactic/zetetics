Bayesian nonparametric regression for
survival and event history data
Andrea Hennerfeind
MÂ¨unchen, 17.03.2006


Bayesian nonparametric regression for
survival and event history data
Andrea Hennerfeind
Dissertation
an der FakultÂ¨at fÂ¨ur Mathematik, Informatik und Statistik
der Ludwigâ€“Maximiliansâ€“UniversitÂ¨at
MÂ¨unchen
vorgelegt von
Andrea Hennerfeind
aus Freising
MÂ¨unchen, den 17.03.2006

Erstgutachter: Prof. Dr. Ludwig Fahrmeir
Zweitgutachter: Prof. Dr. Stefan Lang
Drittgutachter: Prof. Dr. Claudia Czado
Rigorosum: 22.6.2006

v
Vorwort
Diese Arbeit entstand wÂ¨ahrend meiner TÂ¨atigkeit als Mitarbeiter im Sonderforschungs-
bereich 386 â€Statistische Analyse diskreter Strukturenâ€ am Institut fÂ¨ur Statistik an der
LMU MÂ¨unchen und wurde somit durch Mittel der Deutschen Forschungsgemeinschaft
gefÂ¨ordert. In diesen Jahren haben mich viele Leute begleitet, die wesentlich zum Gelingen
meiner Dissertation und zu einem angenehmen Arbeitsklima beigetragen haben.
Zu allererst mÂ¨ochte ich meinem Doktorvater Ludwig Fahrmeir aufrichtig fÂ¨ur seine hervor-
ragende Betreuung danken. Ohne sein Vertrauen, seine UnterstÂ¨utzung und seine sympa-
thische, unkomplizierte und wohlwollende Art, wÂ¨are diese Arbeit sicher nie entstanden. Ein
ganz besonderer Dank gilt auch meinem Zweitgutachter Stefan Lang, der mir in den vergan-
genen Jahren in den verschiedensten Hinrichtungen (mein aktueller Lieblingsâ€“Versprecher)
eine unendlich groÃŸe Hilfe war.
Des weiteren gebÂ¨uhrt mein Dank auch allen Â¨ubrigen Lehrstuhlâ€“ und Institutsmitarbeitern.
Insbesondere danke ich Christiane Belitz und Leyre Osuna, die das zweifelhafte VergnÂ¨ugen
hatten, mich als BÂ¨urokollegin zu haben. Beide haben entscheidend dazu beigetragen, dass
ich mich am Institut so wohl gefÂ¨uhlt habe und standen mir bei allen kleineren und grÂ¨oÃŸeren
Problemen stets mit Rat und Tat zur Seite. Entgegen anders lautender GerÂ¨uchte musste
ich im â€™MÂ¨adchenbÂ¨uroâ€™ zum GlÂ¨uck nie Â¨uber die neueste Schuhmode diskutieren. Bei Thomas
Kneib mÂ¨ochte ich mich fÂ¨ur die vielen hilfreichen Diskussionen und Inspirationen bedanken.
â€™Du tatest etwas groÃŸes ohne Geld zu kalkulieren.â€™ Meiner â€™Grundausstattungâ€™ Alexander
Jerak habe ich meine Existenz als â€™ErgÂ¨anzungsausstattungâ€™ zu verdanken. Danke auch fÂ¨ur
die vielen aufbauenden Worte, wenn wir alle mal wieder an unseren FÂ¨ahigkeiten gezweifelt
haben. Auf keinen Fall unerwÂ¨ahnt lassen mÂ¨ochte ich Renata Gebhardt, die durch ihre
lebendige Art stets fÂ¨ur Aufmunterung gesorgt hat, und Susanne Heim, die fÂ¨ur unsere Fort-
bildungsreise nach Florenz die schÂ¨onste aller UnterkÂ¨unfte ausï¬ndig gemacht hat und stets
eine kompetente Ansprechpartnerin in Sachen â€™fMRIâ€™ war. Bei Petra Kragler mÂ¨ochte ich
mich herzlich fÂ¨ur Ihre Formulierungshilfen und gelegentliche Aufmunterungen bedanken.
Weiterhin mÂ¨ochte ich mich bei meinen Koautoren Leonhard Held und Erik Sauleau fÂ¨ur die
angenehme und fruchtbare Zusammenarbeit bedanken. Claudia Czado danke ich dafÂ¨ur,
dass sie sich meiner Arbeit freundlicherweise als externe Gutachterin angenommen hat.
Nicht zuletzt mÂ¨ochte ich von ganzem Herzen meinen Eltern und meiner Schwester danken,

vi
die immer vollstes Vertrauen in mich gesetzt haben und mir den nÂ¨otigen familiÂ¨aren RÂ¨uckhalt
gegeben haben. Danke, dass ich mich immer voll auf Euch verlassen kann!
Mein grÂ¨oÃŸter Dank gilt meinem Freund Andreas Brezger, der immer fÂ¨ur mich da war.
Danke fÂ¨ur die endlosen fachlichen Diskussionen und ErlÂ¨auterungen, fÂ¨ur wertvolle RatschlÂ¨age,
fÂ¨ur all die Ermutigungen, fÂ¨ur den Trost und die Ablenkung und natÂ¨urlich auch fÂ¨ur die vie-
len schÂ¨onen gemeinsamen Erlebnisse in den letzten Jahren!
MÂ¨unchen, Juli 2006
Andrea Hennerfeind

vii
Zusammenfassung
Die Â¨Uberlebenszeitanalyse, oder allgemeiner die Verweildaueranalyse ï¬ndet in der Praxis
zahlreiche Anwendungen vom klassischen Fall der klinischen Studie bis hin zur Model-
lierung von Kreditrisiken. Oftmals sind die Standardâ€“Modelle jedoch nicht ï¬‚exibel genug,
um der Modellierung komplexer Kovariableninformationen gerecht zu werden. Neben para-
metrisch und nichtparametrisch modellierten Kovariableneï¬€ekten, sowie rÂ¨aumlichen Eï¬€ek-
ten und zufÂ¨alligen Eï¬€ekten zur BerÂ¨ucksichtigung von unbeobachteter HeterogenitÂ¨at, ist
bei der Verweildaueranalyse auch hÂ¨auï¬g eine ï¬‚exible, nichtparametrische Modellierung
von zeitlich variierenden Eï¬€ekten gefragt.
Diese Arbeit beschÂ¨aftigt sich mit der Entwicklung von Bayesianischen Verweildauer-
modellen, die Erweiterungen des klassischen Coxâ€“Modells darstellen. Indem die Hazardrate
durch einen strukturierten additiven PrÂ¨adiktor modelliert wird, entsteht ein ï¬‚exibles Mo-
dell zur Analyse von stetigen Verweildauern unter adÂ¨aquater BerÂ¨ucksichtigung verschie-
denster Arten von Kovariablen. Zeitlich variierende Eï¬€ekte werden dabei durch Pâ€“Splines
modelliert. Die SchÂ¨atzung erfolgt mit Hilfe von Markov Chain Monte Carlo Verfahren.
Weitere Kapitel beschÂ¨aftigen sich mit der sogenannten relativen Â¨Uberlebenszeitanalyse
und mit Mehrzustandsmodellen. Bei ersterem geht es darum, ein zusÂ¨atzliches Risiko einer
bestimmten Subpopulation zu modellieren, das Â¨uber das allgemeine Risiko in der gesamten
Population hinaus besteht. Mehrzustandsmodelle stellen eine Verallgemeinerung der Ver-
weildauermodelle dar.
Anstelle eines bestimmten Â¨Ubergangs kÂ¨onnen hier mehrere ver-
schiedene Â¨UbergÂ¨ange simultan analysiert werden.
Die in dieser Arbeit vorgestellten Methoden werden jeweils auf komplexe, reale Problem-
stellungen angewandt und erweisen sich als wirkungsvolle und ï¬‚exible Instrumente.
Abstract
Survival analysis, or more generally duration time analysis has a large number of practi-
cal applications ranging from the classical ï¬eld of clinical studies to credit risk analysis. In
most cases however, standard survival models do not oï¬€er enough ï¬‚exibility to give appro-
priate consideration to modelling complex covariate eï¬€ects. In addition to parametric and

viii
nonparametric eï¬€ects as well as spatial eï¬€ects and random eï¬€ects to capture unobserved
heterogeneity, duration time analysis often demands a ï¬‚exible nonparametric estimation
of timeâ€“varying eï¬€ects.
This thesis is concerned with developing Bayesian duration time models representing
extensions to the classical Cox model. Modelling the hazard rate through a structured
additive predictor leads to a ï¬‚exible model for the analysis of continuous duration times
having regard to the inï¬‚uence of several diï¬€erent types of covariates. Timeâ€“varying eï¬€ects
are modelled by Pâ€“splines. Inference is accomplished using Markov Chain Monte Carlo
simulation techniques.
Further topics are the soâ€“called relative survival analysis and multiâ€“state models. The
former topic is concerned with modelling the excess risk of a certain subpopulation relative
to the base risk that is present in the whole population. Multiâ€“state models are a general-
ization of duration time models. Instead of analyzing one particular transition only they
allow for the simultaneous analysis of diverse transitions.
The methods presented within this thesis are applied to several complex, real problems
and prove to be eï¬€ective and ï¬‚exible tools.

Contents
Vorwort
v
1
Introduction
1
1.1
Basic concepts . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
2
1.2
The Cox model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
3
1.3
Extensions of the Cox model . . . . . . . . . . . . . . . . . . . . . . . . . .
5
1.4
Full likelihood . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
6
1.4.1
Right censoring . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
6
1.4.2
Left truncation . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
8
1.4.3
Timeâ€“varying covariates . . . . . . . . . . . . . . . . . . . . . . . .
9
1.5
Modelling the baseline hazard . . . . . . . . . . . . . . . . . . . . . . . . .
11
1.5.1
Weibull model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
11
1.5.2
Piecewise exponential model (p.e.m.) . . . . . . . . . . . . . . . . .
12
1.5.3
Pâ€“spline model . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
15
1.6
Relations to other survival models . . . . . . . . . . . . . . . . . . . . . . .
19
1.6.1
Discrete time survival analysis . . . . . . . . . . . . . . . . . . . . .
19
1.6.2
Logâ€“locationâ€“scale models . . . . . . . . . . . . . . . . . . . . . . .
22
1.7
Competing risks and multiâ€“state models
. . . . . . . . . . . . . . . . . . .
23
1.8
Overview . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
25
2
Nonparametric regression for survival data
27
2.1
Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
27
2.2
Models, likelihood and priors . . . . . . . . . . . . . . . . . . . . . . . . . .
30
2.2.1
Observation model and likelihood . . . . . . . . . . . . . . . . . . .
30

x
CONTENTS
2.2.2
Priors for parameters and functions
. . . . . . . . . . . . . . . . .
32
2.3
Markov chain Monte Carlo inference
. . . . . . . . . . . . . . . . . . . . .
38
2.3.1
Updating full conditionals . . . . . . . . . . . . . . . . . . . . . . .
40
2.3.2
Model choice
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
42
2.3.3
Propriety of posteriors in geoadditive survival models . . . . . . . .
42
2.4
Simulation Study . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
44
2.5
Application
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
59
2.5.1
Overdraft credit risk . . . . . . . . . . . . . . . . . . . . . . . . . .
60
2.5.2
Long term care insurance . . . . . . . . . . . . . . . . . . . . . . . .
61
2.5.3
Waiting times to CABG . . . . . . . . . . . . . . . . . . . . . . . .
68
2.6
Conclusion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
74
3
Relative Survival Analysis
77
3.1
Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
77
3.2
Model, likelihood and priors . . . . . . . . . . . . . . . . . . . . . . . . . .
78
3.3
Markov chain Monte Carlo inference
. . . . . . . . . . . . . . . . . . . . .
80
3.4
Application
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
82
3.5
Simulation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
88
3.6
Conclusion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
92
4
Multiâ€“state models
95
4.1
Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
95
4.2
Models, likelihood, priors and MCMC inference
. . . . . . . . . . . . . . .
97
4.3
Markov Chain Monte Carlo inference . . . . . . . . . . . . . . . . . . . . .
99
4.4
Application
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
101
4.4.1
Biological valve prostheses . . . . . . . . . . . . . . . . . . . . . . .
101
4.4.2
Human sleep processes . . . . . . . . . . . . . . . . . . . . . . . . .
103
4.5
Conclusion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
111
5
Bayesian survival and multiâ€“state analysis with BayesX: a tutorial
113
5.1
BayesX . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
114
5.2
Getting started . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
114
5.3
Dataset objects . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
115

Contents
xi
5.4
Map objects . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
116
5.5
Bayesreg objects
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
120
5.5.1
Survival models . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
120
5.5.2
Relative survival analysis . . . . . . . . . . . . . . . . . . . . . . . .
124
5.5.3
Multiâ€“state models . . . . . . . . . . . . . . . . . . . . . . . . . . .
126
5.6
Post estimation commands . . . . . . . . . . . . . . . . . . . . . . . . . . .
130
A Calculation of IWLS weights
133
A.1 Geoadditive survival analysis . . . . . . . . . . . . . . . . . . . . . . . . . .
133
A.2 Relative survival analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . .
137

xii
Contents

Chapter 1
Introduction
The analysis of survival times is a speciï¬c type of regression analysis that has gained
considerable attention particularly in the classical ï¬eld of medical applications, wherefrom
the conventional denotation â€™survival analysisâ€™ arises.
The primary interest in medical
trials usually is the analysis of the inï¬‚uence of special drugs or therapies on the survival
times of patients that are diagnosed with a certain disease. Generally, survival analysis
is concerned with analyzing the inï¬‚uence of covariates on the duration time up to any
predeï¬ned event of interest. As will be illustrated in this work there is a number of further
ï¬elds of applications including for example the ï¬eld of credit scoring, where the life of a
loan up to a default is analyzed.
In survival analysis a distinction is drawn between discrete time survival analysis, where
survival times are only given in certain units of time and continuous time survival analysis.
The former can be ascribed to binary response models and may therefore be based on
methodology for binary logit, probit or grouped Cox models. For this reason we will only
deal with the more challenging case, where survival times are measured on a continuous
time scale. Grouping the data for a discrete time survival analysis is possible, but leads to
a loss of information and is therefore not recommended. Another idea might be to analyze
survival times with generalized linear models for nonnegative continuous responses (like
lognormal or gamma regression). However, these methods do not account for censoring
and truncation, two speciï¬cs of survival data that are due to the fact that survival times
can often not be observed completely but only within a speciï¬c observation period. For
this reasons continuous time survival analysis actually is a separate area of statistical

2
1. Introduction
analysis that is treated extensively in the literature, see e.g. Lawless (1982), Kalbï¬‚eisch
and Prentice (1980), Blossfeld, Hamerle and Mayer (1989) and Klein and Moeschberger
(2003), or Andersen, Borgan, Gill and Keiding (1993) for a counting process representation.
1.1
Basic concepts
Consider survival time to be a nonnegative continuous random variable T, with density
function f(t). Then the corresponding distribution function F(t), which is the probability
of not surviving until time t is given by
F(t) = P(T â‰¤t) =
Z t
0
f(u)du.
In survival analysis however, it is more common to examine the so called survivor function,
which is the probability of the complementary event, i.e. the probability of surviving until
time t. It given by
S(t) = 1 âˆ’F(t) = P(T > t).
Another quantity that plays a decisive role in survival analysis is the hazard function Î»(t),
which is deï¬ned by
Î»(t) = lim
âˆ†tâ†’0
P(t â‰¤T < t + âˆ†t|T â‰¥t)
âˆ†t
and determines the instantaneous rate of death or failure at time t subject to the condition
of survival up to time t.
The following equations, where Î›(t) =
R t
0 Î»(t) denotes the cumulative hazard function,
show how the quantities introduced above are related to each other:
Î»(t)
=
f(t)
S(t)
S(t)
=
exp(âˆ’Î›(t))
f(t)
=
Î»(t)S(t) = Î»(t) exp(âˆ’Î›(t))
The distribution of T is completely determined by one of these quantities. As an illustration
consider the Weibull distribution, where the hazard rate has the following structure
Î»(t) = Î»Î±(Î»t)Î±âˆ’1,

1.2 The Cox model
3
with scale parameter Î» > 0 and shape parameter Î± > 0 (see Figure 1.3 below for a graphical
representation). The survivor function is thus given by
S(t)
=
exp

âˆ’
Z t
0
Î»(u)du

= exp

âˆ’
Z t
0
Î»Î±(Î»u)Î±âˆ’1du

=
exp

âˆ’Î»Î±Î»Î±âˆ’1
Z t
0
uÎ±âˆ’1du

= exp
 âˆ’Î»Î±Î±[Î±âˆ’1uÎ±]t
0

= exp
 âˆ’Î»Î±Î±(Î±âˆ’1tÎ±)

=
exp (âˆ’(Î»t)Î±)
leading to
f(t) = Î»(t)S(t) = Î»Î±(Î»t)Î±âˆ’1 exp (âˆ’(Î»t)Î±) ,
which is indeed the density function of a Weibull distribution with parameters Î» and Î±.
The exponential model, where the hazard rate is constant over time, i.e. Î»(t) = Î» > 0 is
included as the special case of Î± = 1.
1.2
The Cox model
Consider survival data in conventional form, i.e. assume that each individual i in the study
has a lifetime Ti and a censoring time Ci that are independent random variables (random
censoring). The observed lifetime is then ti = min(Ti, Ci), and Î´i denotes the censoring
indicator given by
Î´i =
(
1
Ti â‰¤Ci
0
else
(1.1)
In addition to the lifetime one usually considers some individualâ€“speciï¬c covariates that
are assumed to have an inï¬‚uence on the lifetime. The data is then given by
(ti, Î´i; vi),
i = 1, . . . , n,
(1.2)
where vi = (vi1, . . . , vir) is the vector of the r covariates observed with individual i. Note
that covariates may also be timeâ€“dependent, but for the moment we restrict discussion
to timeâ€“constant covariates for simplicity. The benchmark in the area of analyzing the
inï¬‚uence of covariates on survival time is the proportional hazards model introduced by

4
1. Introduction
Cox (1972). Here the hazard rate of individual i is modelled as the product
Î»i(t, vi) = Î»0(t) Â· exp(vi1Î³1 + . . . + virÎ³r) = Î»0(t) Â· exp(vâ€²
iÎ³),
(1.3)
where Î»0(t) is the baseline hazard, that remains unspeciï¬ed and is independent of the
covariates, but only depends on time t.
In contrast, the inï¬‚uence of the covariates is
independent of time and modelled via a linear predictor vâ€²
iÎ³ with a vector of regression
coeï¬ƒcients Î³ = (Î³1, . . . , Î³r). Through the exponential link function, the covariates act
multiplicatively on the hazard rate.
In the case of timeâ€“constant covariates the time
constance of the inï¬‚uence of the covariates implicates that the hazard rates of any two
individuals are proportional, which explains why the Cox model is called a proportional
hazards model. Let vi and vj denote the covariate vectors of two individuals i and j, then
the ratio of the hazard rates of these individuals is given by
Î»i(t, vi)
Î»j(t, vj) = Î»0(t) Â· exp(vâ€²
iÎ³)
Î»0(t) Â· exp(vâ€²
jÎ³) = exp ((vi âˆ’vj)â€²Î³) ,
which yields
Î»i(t, vi) = c Â· Î»j(t, vj),
c = exp ((vi âˆ’vj)â€²Î³) .
This implicit assumption of the traditional Cox model is rather restrictive and does often
not hold in practice. However, this assumption is crucial for inference based on the partial
likelihood proposed by Cox. Supposing that the baseline hazard Î»0(t) is arbitrary, the
partial likelihood is derived by considering the observed survival times ti (at which we
assume for simplicity that ti Ì¸= tj for i Ì¸= j) and risk sets
R(ti) = {j|tj â‰¥ti}
including all individuals j whose survival time is at least ti, i.e. all individuals that are still
at risk shortly before ti. Given that time ti is an observed failure time and conditionally
on the risk set R(ti) the probability that the failure is actually observed on individual i
(instead of any other individual j âˆˆR(ti)) is given by
P(i fails at ti|one failure at ti, R(ti)) =
exp (vâ€²
iÎ³)
P
jâˆˆR(ti) exp
 vâ€²
jÎ³
,

1.3 Extensions of the Cox model
5
which is independent of Î»0(t). Under the assumption of independence the partial likelihood
is hence given by
L(Î³) =
n
Y
i=1
exp (vâ€²
iÎ³)
P
jâˆˆR(ti) exp
 vâ€²
jÎ³
.
The regression parameters Î³ may then be estimated by maximizing the partial likelihood.
Based on the estimated parameters Ë†Î³ the cumulative baseline hazard Î›0(t) =
R t
0 Î»0(u)du
may be estimated in a second step via the plugâ€“in estimator by Breslow, which is deï¬ned
as follows
Ë†Î›0(t) =
X
i:tiâ‰¤t
1
P
jâˆˆR(ti) exp(vâ€²
j Ë†Î³).
(1.4)
Note that Ë†Î›0(t) is a step function with jumps at the observed survival times ti.
1.3
Extensions of the Cox model
To many complex applications the basic Cox model (1.3) is not adequate with respect to
several aspects such as
â€¢ In applications where predictions are of interest an improved, smooth estimation of
the baseline eï¬€ect is needed.
â€¢ Eï¬€ects of continuous covariates might be of any unknown nonlinear form.
â€¢ Some eï¬€ects might be timeâ€“varying, at which the variation is of any unknown (non-
linear) form.
â€¢ Survival times might be spatially correlated.
â€¢ Unobserved heterogeneity among individuals or units might be present.
â€¢ Nonlinear interactions between covariates might exist.
In this thesis, we propose geoadditive survival models as a ï¬‚exible spatial and spatioâ€“
temporal generalization of Coxâ€“type models. Within a uniï¬ed framework, we extend the
common linear predictor of the Cox model to an additive predictor, including a spatial
component for geographical eï¬€ects and nonparametric terms for modelling and exploring

6
1. Introduction
unknown functional forms of the baseline hazard rate, of nonlinear eï¬€ects of continuous
covariates and further time scales, such as calendar time, and of timeâ€“varying coeï¬ƒcients.
The incorporation of such nonparametric components and their simultaneous estimation
with the baseline hazard and the spatial eï¬€ects motivates the term â€geoadditiveâ€, originally
introduced by Kammann and Wand (2003) in a mixed model approach to semiparametric
Gaussian regression. In addition, uncorrelated random eï¬€ects (also referred to as frailty
eï¬€ects) or nonlinear twoâ€“way interactions can be incorporated if appropriate.
Modelling and inference is developed from a Bayesian perspective, using information
from the full likelihood rather than from a partial likelihood.
1.4
Full likelihood
In survival analysis the complexity of the likelihood depends on what kind of censoring
and/or truncation is present in the data. Figure 1.1 illustrates some examples of observation
structures that we treat within this thesis.
1.4.1
Right censoring
Usually right censored data are considered, where the exact survival time is only observed
for some individuals, whereas others are only observed until a certain point of time prior to
the event of interest. This involves that it is only known that the survival time is greater
than the observed survival time. Right censoring typically appears in studies where indi-
viduals enter the study gradually and are only followed within a certain observation period.
Observations where the event did not take place until the end of the observation period are
right censored. A censoring concept that is often assumed to hold was already presented
in Section 1.2 and is called random censoring. Here the survival time Ti and the censoring
time Ci of each individual i, i = 1, . . . , n are assumed to be independent random variables,
the observed survival time ti is the minimum of those two variables and the censoring indi-
cator Î´i is deï¬ned as in (1.1). Considering timeâ€“constant covariates vi = (vi1, . . . , vip) and
under the assumption of nonâ€“informative censoring, i.e. the assumption that the censoring
time is not determined by parameters of interest, the likelihood contribution of individual

1.4 Full likelihood
7
-
6
calendar
time
values of
covariates
v1 = 2, v2 = 3
v1 = 2, v2 = 2
v1 = 2, v2 = 1
v1 = 1, v2 = 3
v1 = 1, v2 = 2
v1 = 1, v2 = 1
unknown
t
d
t
d
t
@
@
R
death
t
d
t
d
@
@
R
censoring
  
@
@
R
truncation
@
@
R
truncation
@
@
R
death
t
d
t
d
  
death
t

-
observation period
no censoring, no truncation, timeâ€“constant covariates v1 = 2, v2 = 1
right censored, no truncation, timeâ€“constant covariates v1 = 1, v2 = 1
no censoring, no truncation, v1 = 2, v2 is changing from 2 to 3
no censoring, left truncated, timeâ€“constant covariates v1 = 2, v2 = 3
right censored, left truncated, v1 = 1, v2 is changing from 2 to 3
Figure 1.1: Illustration of 5 diï¬€erent rightâ€“censoring and leftâ€“truncation schemes each with
two covariates v1 âˆˆ{1, 2} and v2 âˆˆ{1, 2, 3}, that may be timeâ€“constant or timeâ€“varying.

8
1. Introduction
i is given by
Li
=
(
fi(ti, vi) = Î»i(ti, vi) Â· Si(ti, vi),
Î´i = 1
Si(ti, vi),
Î´i = 0
=
Î»i(ti, vi)Î´i Â· Si(ti, vi)
=
Î»i(ti, vi)Î´i Â· exp

âˆ’
Z ti
0
Î»i(u, vi)du

.
(1.5)
For nonâ€“censored observations the likelihood is as usual given by the density fi at ti, vi,
whilst the likelihood for censored observations, where it is only known that the survival
time is at least ti, is given by the survivor function Si at ti, vi. Thus, under the usual
assumption of conditional independence the likelihood for the whole sample (ti, Î´i, vi),
i = 1, . . . , n is given by
L =
n
Y
i=1
Li =
n
Y
i=1
Î»i(ti, vi)Î´i Â· Si(ti, vi).
1.4.2
Left truncation
Left truncation is the second type of incompletely observed survival data that we deal
with in this thesis. Here survival times of certain individuals can only be observed on
condition that they exceed a certain, individualâ€“speciï¬c truncation time T tr
i
involving that
some survival times are not to be observed. Left truncation typically occurs in observation
studies where individuals that have already been at risk for a known, individualâ€“speciï¬c
amount of time ttr
i at the beginning of the observation period are included (additionally
to individuals that get at risk at a later date within the observation period and thus enter
the study gradually). Note that those observations would not be included if their survival
time was shorter than ttr
i , i.e. it has to be considered that no shorter survival time than ttr
i
may be observed with those individuals. This matter of fact is crucial in data situations,
where those individuals being at risk at earlier times diï¬€er from individuals being at risk
later, regarding values of inï¬‚uential covariates. Considering timeâ€“constant covariates, right
censoring and left truncation the data are given by

1.4 Full likelihood
9
(ti, Î´i, ttr
i ; vi),
i = 1, . . . , n,
where ttr
i
= 0 if observation i is not left truncated and ttr
i
> 0 if observation i is left
truncated. The individual likelihood contribution of individual i is given by
Li
=
ï£±
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£²
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£³
Si(ti, vi),
Î´i = 0, ttr
i = 0
Î»i(ti, vi) Â· Si(ti, vi),
Î´i = 1, ttr
i = 0
Si(ti,vi)
Si(ttr
i ,vi),
Î´i = 0, ttr
i > 0
Î»i(ti, vi) Si(ti,vi)
Si(ttr
i ,vi),
Î´i = 1, ttr
i > 0
=
Î»i(ti, vi)Î´i Â· exp
 
âˆ’
Z ti
ttr
i
Î»i(u, vi)du
!
,
(1.6)
where left truncation is accounted for by conditioning on Ti > ttr
i , which results in a division
by S(ttr
i , vi). For a detailed derivation of these likelihoods see e.g. Klein and Moeschberger
(2003).
Again, under the usual assumption of conditional independence the likelihood
for the whole sample (ti, Î´i, ttr
i , vi), i = 1, . . . , n is given by the product of the individual
likelihood contributions.
1.4.3
Timeâ€“varying covariates
So far we have only considered timeâ€“constant covariates.
Now we will illustrate, how
the likelihood of survival data with timeâ€“varying (piecewise constant) covariates can be
rewritten in the form of the likelihood of left truncated survival data with timeâ€“constant
covariates. For this purpose consider for instance survival data
(ti, Î´i, ttr
i ; vi(t)),
i = 1, . . . , n,
where v(t) is a timeâ€“varying covariate that may take two diï¬€erent values v(1) and v(2). The
likelihood contribution of an observation i with a trajectory as displayed in Figure 1.2,
where t(1)
i
and t(2)
i
mark the points of time when the covariates change, is given by

10
1. Introduction
-
t
d
0
ttr
i
t
d
t(1)
i
t
d
t(2)
i
t
d
ti
t
unknown
v(1)
v(2)
Figure 1.2:
Exemplary trajectory for a timeâ€“varying covariate v(t) with two diï¬€erent values
v(1) and v(2).
Li
=
Î»i(ti, vi(ti))Î´i Â· exp
 
âˆ’
Z ti
ttr
i
Î»i(u, vi(u))du
!
=
Î»i(ti, v(1))Î´i Â· exp
 
âˆ’
Z t(1)
i
ttr
i
Î»i(u, v(1))du âˆ’
Z t(2)
i
t(1)
i
Î»i(u, v(2))du âˆ’
Z ti
t(2)
i
Î»i(u, v(1))du
!
=
Î»i(t(1)
i , v(1))0 Â· exp
 
âˆ’
Z t(1)
i
ttr
i
Î»i(u, v(1))du
!
Î»i(t(2)
i , v(2))0 Â· exp
 
âˆ’
Z t(2)
i
t(1)
i
Î»i(u, v(2))du
!
Î»i(ti, v(1))Î´i Â· exp
 
âˆ’
Z ti
t(2)
i
Î»i(u, v(1))du
!
.
This individual likelihood is identical to the likelihood of three left truncated observations
with a timeâ€“constant covariate given by
ti
Î´i
ttr
i
vi
t(1)
i
0
ttr
i
v(1)
t(2)
i
0
t(1)
i
v(2)
ti
Î´i
t(2)
i
v(1)
For this reason timeâ€“varying covariates can be included in the settings described before
via data augmentation.

1.5 Modelling the baseline hazard
11
1.5
Modelling the baseline hazard
As can be seen from equations (1.5) and (1.6) the calculation of the likelihood involves
solving integrals over the baseline hazard rate, which is the only component that depends
on time in case of timeâ€“constant covariate eï¬€ects. Depending on the complexity of the
assumed structure of the baseline hazard the integrals may be solved analytically or a
numerical integration technique may be required.
Starting from the Cox model (1.3)
where the baseline hazard is typically unspeciï¬ed, we present three alternatives to specify
the baseline hazard and their implications with calculating the likelihood.
1.5.1
Weibull model
The ï¬rst alternative is a parametric Weibull model, where the baseline hazard rate is given
by
Î»0(t) = Î±tÎ±âˆ’1
with an unknown shape parameter Î± > 0. Note that the exponential model, where the
baseline hazard is timeâ€“constant is included as the special case of Î± = 1, whereas values
of Î± < 1 (Î± > 1) yield a decreasing (increasing) baseline hazard. To give an example,
Figure 1.3 displays the shapes of Î»0(t) for Î± = 0.75, Î± = 1 and Î± = 1.25. Usually the
Weibull distribution is deï¬ned by a shape and a scale parameter. With our model the
scale parameter is included as an additive intercept term Î³0 in the linear predictor, i.e. the
model is given by
Î»i(t, vi)
=
Î±tÎ±âˆ’1 Â· exp (Î³0 + vâ€²
iÎ³) .
The integral in the likelihood given in (1.6) can be calculated analytically as follows
Z ti
ttr
i
Î»i(u, vi)du
=
Z ti
ttr
i
Î±uÎ±âˆ’1 Â· exp (Î³0 + vâ€²
iÎ³) du
=
exp (Î³0 + vâ€²
iÎ³) Â·
Z ti
ttr
i
Î±uÎ±âˆ’1du
=
exp (Î³0 + vâ€²
iÎ³) Â· [uÎ±]ti
ttr
i
=
exp (Î³0 + vâ€²
iÎ³) Â·
 (ti)Î± âˆ’(ttr
i )Î±
.

12
1. Introduction
0
1
2
3
0
1
2
3
4
5
t
alpha=1
alpha=0.75
alpha=1.25
Figure 1.3:
Shape of the Weibull baseline hazard Î±tÎ±âˆ’1 for diï¬€erent values of Î±.
Thus a Weibull hazard rate allows for an easy estimation and is a frequently used model
assumption. However, the ï¬‚exibility is limited since the shape of the baseline hazard rate
is restricted to monotonic functions as displayed in Figure 1.3.
1.5.2
Piecewise exponential model (p.e.m.)
The basic idea of the p.e.m. is to divide the time axis into a grid that may be equidistant,
according to quantiles or of any arbitrary structure given by the intervals
(0 = Î¾0, Î¾1], (Î¾1, Î¾2], . . . , (Î¾sâˆ’1, Î¾s], . . . , (Î¾mâˆ’1, Î¾m], (Î¾m, âˆ),
where Î¾m is the largest of all observed survival times ti, i = 1, . . . , n. The baseline hazard
rate Î»0(t) is assumed to be piecewise constant on that grid, i.e.
Î»0(t) = Î»0s,
Î»0s â‰¥0
for times t within the intervals (Î¾sâˆ’1, Î¾s], s = 1, ..., m.
Since estimating the unknown
parameters Î»0s would involve imposing the restrictions Î»0s â‰¥0, s = 1, . . . , m, we prefer to
estimate the unrestricted parameters g0s = log(Î»0s) instead, i.e. we deï¬ne
Î³0(t) = log(Î»0(t)) = Î³0s

1.5 Modelling the baseline hazard
13
for times t in the interval (Î¾sâˆ’1, Î¾s], s = 1, ..., m. Furthermore, let Î·i(ti, vi) denote the
whole linear predictor of individual i including the logâ€“baseline hazard, i.e.
Î·i(t, vi)
=
Î³0(t) + vâ€²
iÎ³
and hence
Î»i(t, vi)
=
Î»0(t) Â· exp (vâ€²
iÎ³) = exp (Î³0(t) + vâ€²
iÎ³) = exp(Î·i(t, vi))
Here, Î·is = Î³0s + vâ€²
iÎ³ denotes the piecewise constant linear predictor in the time interval
(Î¾sâˆ’1, Î¾s], s = 1, ..., m.
In the case of a p.e.m., the integral reduces to a sum, and, after some calculations, the
likelihood contribution of observation i in each time interval (Î¾sâˆ’1, Î¾s] can be expressed as
Lis = exp (yisÎ·is âˆ’exp (âˆ†is + Î·is))
where
yis
=
(
1
ti âˆˆ(Î¾sâˆ’1, Î¾s],Î´i = 1
0
else.
âˆ†âˆ—
is
=
ï£±
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£²
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£´
ï£³
0,
Î¾s < ttr
i
Î¾s âˆ’ttr
i ,
Î¾sâˆ’1 < ttr
i â‰¤Î¾s < ti
ti âˆ’ttr
i ,
Î¾sâˆ’1 < ttr
i < ti â‰¤Î¾s
Î¾s âˆ’Î¾sâˆ’1,
ttr
i â‰¤Î¾sâˆ’1 < Î¾s < ti
ti âˆ’Î¾sâˆ’1,
ttr
i < Î¾sâˆ’1 < ti â‰¤Î¾s
0,
ti â‰¤Î¾sâˆ’1
âˆ†is
=
log âˆ†âˆ—
is
(âˆ†is = âˆ’âˆif âˆ†âˆ—
is = 0).
That is to say that the likelihood of a p.e.m. is proportional to a Poissonâ€“likelihood with re-
sponses yis and with the predictor Î·is containing an additional oï¬€set term âˆ†is, see Fahrmeir
and Tutz (2001, Section 9.1) or Ibrahim et al. (2001, Section 3.1) for details. This result
yields that a p.e.m. may be estimated based on methodology for Poisson regression mod-
els, i.e. within the context of generalized linear models (GLMs) via data augmentation.
In practise this means that the data set has to be modiï¬ed in such a way that for every
individual i there is an observation row for each interval (Î¾sâˆ’1, Î¾s] beginning with the in-
terval that includes the left truncation time ttr
i up to the interval in that observation time
ti ends. Instead of the indicator of nonâ€“censoring Î´i the modiï¬ed data set contains the

14
1. Introduction
indicator yis, instead of survival time ti the variable Î¾s as well as the oï¬€set âˆ†is (covariates
are duplicated). To give a short example, if we have an equidistant grid with length 0.1,
the observations
i
t
Î´
ttr
v1
v2
1
0.35
1
0.16
0
3
2
0.12
0
0
1
5
...
...
...
...
have to be modiï¬ed to
i
y
Î¾
âˆ†
v1
v2
1
0
0.2
log(0.04)
0
3
1
0
0.3
log(0.10)
0
3
1
1
0.4
log(0.05)
0
3
2
0
0.1
log(0.10)
1
5
2
0
0.2
log(0.02)
1
5
...
...
...
...
...
...
and a Poisson regression with response y, covariates Î¾, v1 and v2 and oï¬€set âˆ†may be
accomplished.
Note that timeâ€“varying covariates can be accounted for by varying the
covariates adequately from line to line in the table above. Hence, the assumption of a
p.e.m. is quite convenient, however, due to the assumption of a piecewise constant hazard
rate the estimated (logâ€“)baseline eï¬€ect is a step function on the deï¬ned grid, which may
not be adequate with continuous survival times. Furthermore it is a moot question how
to choose an â€idealâ€ grid. While a small grid size might lead to intervals with sparse data
and hence unreliable estimates of the according parameters, a large grid size might not
allow for enough ï¬‚exibility. Within our Bayesian analysis we will use a rather small grid
size and specify random walk priors (as described in Fahrmeir and Lang (2001a)) for the
parameters Î³0s to penalize too abrupt jumps between neighboring parameters Î³0,sâˆ’1 and
Î³0s yielding a ï¬‚exible â€smooth step functionâ€.

1.5 Modelling the baseline hazard
15
1.5.3
Pâ€“spline model
Modelling the baseline hazard by a (Bayesian) Pâ€“spline is the most ï¬‚exible alternative, that
will be primarily discussed within this thesis. While the logâ€“baseline hazard is assumed to
be a piecewise constant function with the p.e.m., i.e. a polynomial of degree zero within each
predeï¬ned interval, we now consider extensions to piecewise polynomials of an arbitrary
degree l. Depending on the degree l this leads to more or less smooth functions instead of
step functions. Again, the time axis is divided into a grid
(0 = Î¾0, Î¾1], (Î¾1, Î¾2], . . . , (Î¾sâˆ’1, Î¾s], . . . , (Î¾mâˆ’1, Î¾m], (Î¾m, âˆ),
where Î¾s are usually called (inner) knots within the context of spline regression. Then a
polynomial spline has the following smoothness properties:
â€¢ A spline is a polynomial of degree l within each interval Î¾sâˆ’1, Î¾s, s = 1, . . . , m.
â€¢ A spline is l âˆ’1 times diï¬€erentiable at the knots Î¾s.
As shown in De Boor (1978) a spline with those properties may for example be written
as a linear combination of M = m + l Bâ€“spline basis functions Bsl of degree l. Hence
the function g0(t) = log(Î»0(t)) that is denoting the (smooth) function that describes the
logâ€“baseline eï¬€ect can be written as
g0(t) =
M
X
s=1
Î²sBsl(t),
where Î²s, s = 1, . . . , M are unknown parameters.
Note, that we are again estimating
the logâ€“baseline hazard instead of the baseline hazard to avoid implying the restriction
Î»0(t) â‰¥0. Figure 1.4 shows Bâ€“spline basis functions for degrees l = 0, l = 1 and l = 2,
respectively, with only several basis functions being displayed for reasons of clarity. Bâ€“
spline basis functions of degree zero are piecewise constant and do not overlap (in this
respect that each basis function Bs0 is nonzero only within the interval (Î¾sâˆ’1, Î¾s]), which
again illustrates that the p.e.m. is included as the special case of l = 0. Bâ€“spline basis
functions of degree one are nonzero within the range of two subsequent intervals (Î¾sâˆ’1, Î¾s]
and (Î¾s, Î¾s+1] and are linear functions within each interval, whereas basis functions of degree
two are nonzero within the range of three subsequent intervals and are quadratic functions

16
1. Introduction
within each interval. Bâ€“spline basis functions of degree l = 3 (not shown) would be nonzero
within the range of four subsequent intervals and be cubic functions within each interval
etc. Figure 1.5 exemplarily shows the construction of a Bâ€“spline of degree l = 2 with
m = 5 inner knots. Panel (a) displays the M = l + m = 6 basis functions Bs2 that cover
the considered range of (0, 1] in a way that for each point within this interval l + 1 = 3
basis functions take (positive) values diï¬€erent from zero. The weighted basis functions
Î²sBs2 are displayed in panel (b) and panel (c) shows the resulting spline function, which
is the sum of the weighted basis functions PM
s=1 Î²sBs2. For more details on Bâ€“splines see
De Boor (2001).
Î¾1
Î¾2
Î¾3
Î¾4
Î¾5
Î¾6
Î¾7
Î¾8
Î¾9
Î¾10
 
 
 
 
 	
 
 
 
 
 




































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































 
 
 
 
 	
 
 
 
 
 




























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































Figure 1.4:
Some Bâ€“spline Basis functions for degrees l = 0, l = 1, and l = 2, respectively.
Besides the degree l the structure of the resulting spline considerably depends on the
number and the position of the knots. While a small number of knots might not guarantee
enough ï¬‚exibility, a very large number of knots might lead to overâ€“ï¬tting and thus deliver
unreliable results. An attractive solution to this problem are penalized splines (Pâ€“splines),
that are based on roughness penalties and presented by Eilers and Marx (1996). The basic
idea is to use a rather large number of equidistant knots, but penalize too rough functions

1.5 Modelling the baseline hazard
17
-0.5 -0.25
 0
 0.25  0.5  0.75
 1
 1.25  1.5
 0
 0.2
 0.4
 0.6
(a) basis functions
-0.5 -0.25
 0
 0.25  0.5  0.75
 1
 1.25  1.5
 0
 0.2
 0.4
(b) weighted basis functions
 0
 0.25
 0.5
 0.75
 1
 0.2
 0.4
 0.6
(c) resulting spline
Figure 1.5:
Construction of Bâ€“splines: 6 Bâ€“spline basis functions of degree l = 2 with 5 inner
knots at 0.0, 0.25, 0.5, 0.75 and 1.0 (a), weighted basis functions (b), and the resulting spline (c).
by imposing diï¬€erence penalties on neighboring parameters Î²sâˆ’1 and Î²s. In this thesis we
will use Bayesian versions of Pâ€“splines as developed in Lang and Brezger (2004).
While the integrals in the likelihood (1.5) and (1.6), respectively, can be solved analyti-
cally with the two previously presented approaches (Weibull model and p.e.m.), this is not
in general true for survival models where the baseline hazard is modelled by a Pâ€“spline.
Apart from Bâ€“splines of degree l = 0 and l = 1 these integrals can only be solved nu-
merically. For this we use numerical integration in form of the trapezoidal rule. Here the
basic idea is to approximate the function Î»0(t) by a piecewise linear function ËœÎ»0(t) as dis-
played in Figure 1.6, where the area under ËœÎ»0 is trapezoidal within each interval. In order
to guarantee that the approximation is also fairly accurate in time slices where observed
survival times are sparse, equidistant time points are used as additional knots besides the
observed life times ti. Now an integral
R t
0 Î»0(u)du is approximated by
R t
0 ËœÎ»0(u)du, which is
the sum of the areas of the corresponding trapezoids. For an interval (tiâˆ’1, ti] the area of

18
1. Introduction
t
a0
a1
a2
a3
a4
a5
t1
t2 t3
t4
t5
t6
t7
t8
t9
Figure 1.6:
Trapezoidal rule: The function Î»0(t) (dashed line) is approximated by a piecewise
linear function through the points (ti, Î»0(ti)), where ti are (ordered) observed survival times,
as well as the additional points (as, Î»0(as)) with a0 = 0.
Hence the integral
R t9
0 Î»0(u)du is
approximated by the sum of the areas of the gray shaded trapezoids.
the corresponding trapezoid would for example be given by
1
2 Â· (ti âˆ’tiâˆ’1) Â· (Î»0(ti) + Î»0(tiâˆ’1)).
Note, that we discussed the case of data where no left truncation is present, but the trape-
zoidal rule may be applied to left truncated observations as well. Here we use the truncation
times ttr
i as additional knots in Figure 1.6 and approximate the integrals
R ti
ttr
i Î»0(u)du by
R ti
ttr
i
ËœÎ»0(u)du.

1.6 Relations to other survival models
19
1.6
Relations to other survival models
The scope of this section is to clarify in what way the extended continuousâ€“time Cox model
that is presented in this thesis is related to some other common survival models, namely
to discrete time survival models and to locationâ€“scale models for log(T), which are also
called accelerated failure time (AFT) models.
1.6.1
Discrete time survival analysis
Discrete time survival models are basically used in two diï¬€erent situations. Firstly they
are used in cases where failures actually only occur at discrete time points. This is for
example the case with durations of unemployment, since employments usually end and
begin with monthly allowance. The second situation is given where failures may occur at
any arbitrary point of time, however survival times can not be observed continuously, but
are only known to lie between two successive follow ups. This case is known as interval
censoring and typically occurs in medical studies where data can only be observed at
regular consultations.
Now consider discrete time D âˆˆ{1, 2, . . .}, then the discrete hazard function is given
by
Î»discr(s, v) = P(D = s|D â‰¥s, v),
s = 1, 2, . . .
which is the probability of failure at time point s, given that the failure time is at least s
and given the covariates v.
The grouped proportional hazards model
Consider the case of interval censoring where survival times T are continuous but are only
observed at k follow up times Î¾s, s = 1, . . . , k. Let time be divided in intervals
[Î¾0, Î¾1), [Î¾1, Î¾2), . . . , [Î¾sâˆ’1, Î¾s), . . . , [Î¾qâˆ’1, Î¾q), [Î¾k, âˆ)
where Î¾0 = 0 and q = k âˆ’1. Then D = s, s = 1, . . . , q denotes failure within the according
interval, i.e. T âˆˆ[Î¾sâˆ’1, Î¾s) and the discrete hazard function is given by

20
1. Introduction
Î»discr(s, v)
=
P(D = s|D â‰¥s, v) = P(T < Î¾s|T â‰¥Î¾sâˆ’1, v)
=
P(Î¾sâˆ’1 â‰¤T < Î¾s|v)
P(T â‰¥Î¾sâˆ’1|v)
= F(Î¾s, v) âˆ’F(Î¾sâˆ’1, v)
S(Î¾sâˆ’1, v)
=
S(Î¾sâˆ’1, v) âˆ’S(Î¾s, v)
S(Î¾sâˆ’1, v)
=
1 âˆ’S(Î¾s, v)
S(Î¾sâˆ’1, v)
=
1 âˆ’
exp

âˆ’
R Î¾s
0 Î»(t, v)dt

exp

âˆ’
R Î¾sâˆ’1
0
Î»(t, v)dt

=
1 âˆ’exp

âˆ’
Z Î¾s
Î¾sâˆ’1
Î»(t, v)dt

,
(1.7)
i.e. the discrete hazard function Î»discr may be written as a function of the continuous
survivor function S and the continuous hazard rate Î», respectively. Inserting the formula
of the proportional hazards model or Cox model for continuous time (1.3) given by
Î»(t, v) = Î»0(t) Â· exp (vâ€²Î³)
into (1.7) yields the grouped proportional hazards model given by
Î»discr(s, v)
=
1 âˆ’exp

âˆ’exp(vâ€²Î³)
Z Î¾s
Î¾sâˆ’1
Î»0(t)dt

=
1 âˆ’exp (âˆ’exp(Î³0s + vâ€²Î³))
with Î³0s = log
R Î¾s
Î¾sâˆ’1 Î»0(t)dt

. An alternative formulation is given by
log(âˆ’log(1 âˆ’Î»discr(s, v))) = Î³0s + vâ€²Î³
and hence the grouped proportional hazards model is a sequential complementary logâ€“
log model. Though in general grouping implies a loss of information (see e.g. Gould and
Lawless (1988)), it should be annotated that the parameter vector Î³ remains unchanged
by the transition between the continuous and the discrete model.

1.6 Relations to other survival models
21
Models for binary response
While sequential models for ordinal responses ï¬t for the estimation of discrete time survival
models without rightâ€“censoring, binary models for the indicators
yis =
(
1
di = s and Î´i = 1
0
else
i = 1, . . . , n,
s = 1, . . . , di
(1.8)
that indicate whether or not a failure occurred with individual i at time s or in interval
[Î¾sâˆ’1, Î¾s), respectively, may be used instead for discrete survival analysis in cases where
rightâ€“censoring is present. For the purpose of ï¬tting a binary model, the survival data
have to be augmented in a similar way as described in Subsection 1.5.2 for the p.e.m.
Note however, that the p.e.m. is a continuous time survival model, where the information
on the exact survival time (within each interval) is retained and enters the model via an
oï¬€set term. To give a short example, rightâ€“censored discrete time survival data with two
covariates v1 and v2 given by
i
d
Î´
v1
v2
1
3
1
0
3
2
2
0
1
5
...
...
...
...
...
have to be augmented to
i
s
y
v1
v2
1
1
0
0
3
1
2
0
0
3
1
3
1
0
3
2
1
0
1
5
2
2
0
1
5
...
...
...
...
...
where for every individual i one line has to be created for each discrete point in time s
(every time interval, respectively) at which the individual is observed.
Covariates are
duplicated and an indicator variable yis is created according to (1.8), that takes the

22
1. Introduction
value 0 in every line related to a rightâ€“censored observation i and takes the value 1 in
the last line related to an uncensored observation i and 0 in the preceding lines.
In
practice such a data augmentation for right censored data with timeâ€“constant covari-
ates might for example be accomplished with the STATA command prsnperd as illus-
trated on http://www.ats.ucla.edu/stat/stata/library/survival2.htm. Note that
leftâ€“truncation and timeâ€“varying covariates can be easily accounted for by omitting the
accordant ï¬rst lines in the tabular above and varying the covariates adequately from line
to line, respectively. The discrete hazard function may now equivalently be written as
Î»discr
i
(s, vi) = P(yis = 1|vi)
and a binary regression with response yis and covariates s, v1 and v2 may be accomplished.
Thompson (1977) for example considers the logistic model
Î»discr(s, v) =
exp(Î³0s + vâ€²Î³)
1 + exp(Î³0s + vâ€²Î³)
(1.9)
and shows that this model is very similar to the proportional hazards model if grouping
intervals become short.
1.6.2
Logâ€“locationâ€“scale models
Logâ€“locationâ€“scale models are an alternative model class for continuous survival data,
where, in contrast to the classical Cox model (with timeâ€“constant covariates and timeâ€“
constant eï¬€ects of covariates), proportional hazards are not presumed in general.
To
account for the nonnegativity of survival time, log(T) instead of T is related to a linear
predictor given by
log(T) = Î³0 + vâ€²Î³ + ÏƒÎµ,
(1.10)
where Ïƒ is a constant scale parameter and Îµ is an error term independent of v. For the
special case where Îµ follows the standard extreme value distribution, we retain a Weibull
model with Î» = exp (âˆ’(Î³0 + vâ€²Î³)) and Î± = 1/Ïƒ, which is a proportional hazards model.
However, other distributions of Îµ do not yield proportional hazards models. Assuming a
normal distribution for Îµ, for example, results in lognormal distributed survival times and
a nonproportional hazards model. In the case of parametric models the parameters can
be estimated easily via maximum likelihood techniques. Since such parametric approaches

1.7 Competing risks and multiâ€“state models
23
are quite restrictive, semiâ€“parametric procedures that leave the distribution of the error
term unspeciï¬ed and only provide the estimation of the parameter vector Î³ may be used
alternatively, see e.g. Kalbï¬‚eisch and Prentice (2002). However, there is no pendant to the
Breslow estimator (1.4) (which is used with Cox models to estimate the cumulative baseline
hazard on the basis of the estimated parameter vector Ë†Î³) and hence semiâ€“parametric
procedures may not be used in cases where prediction is of interest. A method that oï¬€ers
a joint estimation of the parameter vector Î³ and the baseline hazard with a ï¬‚exible, smooth
error distribution is presented by KomÂ´arek, Lesaï¬€re and Hilton (2005), who propose to use
a mixture of normals for the error distribution, with mixture weights being smoothed.
The model assumption in (1.10) may be rewritten as
T = exp(Î³0 + vâ€²Î³) exp(ÏƒÎµ),
which, according to Lesaï¬€re, KomÂ´arek and Declerck (2004), leads to a hazard rate of the
following structure
Î»(t, v) = exp (âˆ’(Î³0 + vâ€²Î³)) Â· Î»0(exp(âˆ’(Î³0 + vâ€²Î³)) Â· t),
i.e. as with the Cox model the covariates act multiplicatively on the hazard rate, but
here the eï¬€ect of a covariate additionally acts as an acceleration (deceleration) of the
event time, which explains why such models are also referred to as accelerated failure time
models (AFT). In this way classical AFT models seem to be more general than classical
Cox models, however, in contrast to Cox models, AFT models do not allow for the inclusion
of timeâ€“varying covariates and timeâ€“varying eï¬€ects. For this reason we focus on extensions
of the Cox model, where the inclusion of timeâ€“varying covariates and timeâ€“varying eï¬€ects
yields nonproportional hazards models.
1.7
Competing risks and multiâ€“state models
So far we have only considered one type of failure. However, with a number of applications
one may distinguish between several types of failures or events. In clinical studies, for
example, the events may stand for several causes of death. Models for this type of data
are referred to as competing risks models. Let h = 1, . . . , H denote the distinct events.

24
1. Introduction
Corresponding to the deï¬nition of the hazard rate in (1.3) eventâ€“speciï¬c individual hazard
rates Î»hi are given by
Î»hi(t, vhi) = Î»h0(t) exp (vâ€²
hiÎ³h) ,
h = 1, . . . , H.
(1.11)
Here, Î»h0(t) denotes the eventâ€“speciï¬c baseline hazard, vhi denotes the vector of covariates
having an inï¬‚uence on the accordant hazard rate and Î³h is the related eventâ€“speciï¬c
vector of parameters.
As mentioned in the context of Cox models this basic model is
not adequate to many complex applications and needs to be extended with respect to the
aspects mentioned in Section 1.3.
Note, that in a discrete time setting competing risks models may be analyzed by mul-
ticategorical regression models via data augmentation (in a similar way as described above
for models for binary response). Fahrmeir and Lang (2001b), for example, present ï¬‚exible,
Bayesian multicategorical regression models to analyze discrete unemployment durations,
with ï¬nding a fullâ€“time employment and ï¬nding a partâ€“time employment as competing
events.
Multiâ€“state models present a further extension to survival models. The models de-
scribed so far only consider one initial state and one or a number of terminating events.
Multiâ€“state models on the other hand may be applied to analyze general event history
data. Here the various events are considered as transitions from one state to another. This
type of data is for example given in clinical studies where the interest lies in analyzing
transitions between diï¬€erent states of health.
Eventâ€“speciï¬c or transitionâ€“speciï¬c hazard rates are deï¬ned as before in (1.11), but
the likelihood of multiâ€“state models is slightly more complex than the likelihood of com-
peting risks models. While (survival models and) competing risks models assume that
each individual is at risk to experience any event during the whole observation time, this is
not necessarily true with multiâ€“state models. Here, a state structure speciï¬es the diverse
states (that might be absorbing or transient) and deï¬nes which transitions are possible
and which ones are not. Thus it is important to consider that some individuals might not
be at risk to experience certain events over periods of time being in certain states. For this
reason the application of multicategorical regression models to discrete time event history
data is not completely straightforward, but demands some additional consideration.

1.8 Overview
25
1.8
Overview
The thesis is organized as follows.
The second chapter, which forms the core of this
thesis, is based on the manuscript â€Geoadditive Survival Modelsâ€ by Hennerfeind, Brezger
and Fahrmeir that is accepted for publication in the Journal of the American Statistical
Association (JASA) Theory and Methods Section. Here we will present our nonparametric
Bayesian survival model approach to extend the basic Cox model with respect to the
aspects listed in Section 1.3. We will describe models, likelihood and priors for unknown
functions and parameters, discuss the inference via MCMC and present some simulations
and applications to diï¬€erent data sets.
In the third chapter of this thesis we deal with so called relative survival analysis, that
is used to model the excess risk of a certain subpopulation relative to the base risk that
is present in the whole population. Such models are typically used in the area of clinical
studies, that aim at identifying prognostic factors for disease speciï¬c mortality with data
on speciï¬c causes of death being not available. Our work has been motivated by real data
on breast cancer where causes of death are not known. This chapter forms an extension
of the analyses presented in the manuscript â€Age, period and cohort eï¬€ects in Bayesian
smoothing of spatial cancer survival with geoadditive modelsâ€ by Sauleau, Hennerfeind,
Buemi and Held which is accepted for publication in Statistics in Medicine. The usefulness
of our relative survival approach is supported by means of a simulated data set.
The fourth chapter is concerned with extensions to more general event history models.
Embedded in the counting process framework (Andersen, Borgan, Gill and Keiding 1993)
we present ï¬‚exible multiâ€“state models that are used to model transitions between a ï¬nite
number of diï¬€erent states and include the survival model as well as the competing risks
model as special cases.
Applications to medical data on structural valve degeneration
of biological prostheses and to sleepâ€“electroencephalography data with multiple recurrent
states of sleep illustrate our methods.
All approaches presented within this thesis are implemented in the statistical software
package BayesX. In Chapter 5 we present a tutorial to exemplify how Bayesian survival
and multiâ€“state models may be analyzed using BayesX.

26
1. Introduction

Chapter 2
Nonparametric regression for
survival data
2.1
Introduction
In epidemiological, economic or social science applications, survival data often contain
geographical or spatial information such as the district or postal code of the residence of
individuals in the study. Analyzing and modelling geographical patterns for survival or
waiting times, in addition to the impact of other covariates, is of obvious interest in many
studies. For example, Henderson, Shimakura and Gorst (2002) model spatial variation
in survival of acute myeloid leukemia patients in northwest England, Banerjee, Wall and
Carlin (2003) apply a spatial frailty model to infant mortality in Minnesota, and Li and
Ryan (2002) analyze the eï¬€ect of risk factors on the onset of childhood asthma with spatial
data from the East Boston Asthma Study. In Subsection 2.5.3 of this thesis, we will apply
our approach to data on waiting times to coronary artery bypass graft (CABG). Within a
discreteâ€“time setting, spatial survival data from this study are analyzed by Crook, Knorrâ€“
Held and Hemingway (2003), and Fahrmeir, Lang, Wolï¬€and Bender (2003) investigate the
impact of small area labor market regions and other covariates, such as calendar time, age
and unemployment beneï¬ts, on unemployment duration with discreteâ€“time models.
A particular advantage of our approach is that all unknown functions and parameters
are treated within a uniï¬ed general framework by assigning appropriate priors with the
same structure but diï¬€erent forms and degrees of smoothness. Based on previous work

28
2. Nonparametric regression for survival data
(Fahrmeir and Lang, 2001a; Lang and Brezger, 2004) on semiparametric regression, non-
linear eï¬€ects of unknown functions of time, in particular the logâ€“baseline hazard rate, and
of continuous covariates or further time scales are modelled through Bayesian versions of
penalized splines (Pâ€“splines) introduced by Eilers and Marx (1996), Marx and Eilers (1998)
for generalized additive models in a frequentist setting. Basically, time is treated in the
same way as a continuous covariate, but the degree and amount of smoothness may be
diï¬€erent. For example, simple random walk priors for the logâ€“baseline eï¬€ect in a piecewise
exponential model are Pâ€“splines of degree zero. The spatial component is modelled by
Gaussian Markov random ï¬eld (MRF) priors, as common in disease mapping, by twoâ€“
dimensional penalized tensorâ€“product splines, or by a geostatistical (kriging) stationary
Gaussian random ï¬eld (GRF) model. From a computational point of view, MRFâ€™s and Pâ€“
splines are clearly preferable to GRFâ€™s because their posterior precision matrices are band
matrices or can be transformed into a band matrixâ€“like structure. This special structure
considerably speeds up computations and enhances numerical stability compared to the
full precision matrices arising from the GRF approach.
For data observed on a irregular discrete lattice, MRFâ€™s seem to be most appropriate. If
exact locations are available, Pâ€“spline or GRF surface smoothers seem to be more natural,
but they can also be applied to discrete lattices after computing centroids of regions.
Our uniï¬ed general framework also has theoretical and computational advantages for
posterior analysis. Extending previous results for mixed models in Sun, Tsutakawa and
Speckman (1999), we can show propriety of posteriors under regularity conditions. This
is important, because some of our priors are diï¬€use or partially improper. From the com-
putational point of view, full conditionals of blocks of parameters have similar structure,
and lead to eï¬ƒcient MCMC techniques. Smoothing parameters are an integral part of
the model and can be estimated jointly with unknown functions and other parameters.
Inferential procedures have been implemented in C++ as part of BayesX (Brezger, Kneib
and Lang 2005).
Nonâ€“ and semiparametric Bayesian survival models have become quite popular in re-
cent years, and some previous work deals with special or related cases of our approach.
For fully Bayesian models without a spatial component Ibrahim, Chen and Sinha (2001)
provide a good introduction and overview. Joint estimation of the baseline hazard and
usual linear covariate eï¬€ects in the Cox model has been considered by several authors.

2.1 Introduction
29
Gamerman (1991) proposes a Gaussian random walk model for the logâ€“baseline hazard in
the piecewise exponential model, and Sinha (1993) suggests a joint Gaussian smoothness
prior, and Cai, Hyndman and Wand (2002) and Cai and Betensky (2003) use a mixed
model representation of linear regression splines to estimate the baseline hazard. In all
these approaches, however, eï¬€ects of continuous covariates are assumed to be of the usual
linear parametric form, and no spatial component is present.
Survival models with a spatial component have recently been suggested in several pub-
lications. The approaches diï¬€er in the speciï¬cation of the baseline hazard rate and in the
model chosen for the spatial component, but the remaining part of the predictor is still of
linear parametric form. Thus, nonâ€“parametric terms for ï¬‚exible modelling and estimation
of the eï¬€ects of continuous covariates, further time scales and timeâ€“varying coeï¬ƒcients
are not considered in these approaches. Li and Ryan (2002) add a spatial component in
form of a stationary Gaussian process to the linear predictor of the Cox model. Treating
the baseline hazard as a nuisance parameter, inference for the linear predictor and for
correlation function parameters is based on a marginal rank likelihood. No procedure for
estimating the spatial (random) eï¬€ects is provided. Henderson et al. (2002) propose a Cox
model with conditionally independent spatial gamma frailties, with means following either
a geostatistical model or a Markov random ï¬eld. For inference they use MCMC methods,
except the baseline hazard estimate. For this they plug in the Breslow estimator at each
iteration of the chain. Banerjee et al. (2003) assume a parametric Weibull baseline hazard
and geostatistical or MRF priors for the spatial component. In comparison they prefer
MRF priors, since computing times for geostatistical GRF models are much larger. This is
in agreement with our own ï¬ndings. Banerjee and Carlin (2003) develop Bayesian spatioâ€“
temporal survival models, modelling baseline hazard functions nonparametrically through
a beta mixture approach and assuming MRF or CAR (conditionally autoregressive) priors
for spatial eï¬€ects, and Carlin and Banerjee (2002) extend this approach to multivariate
MRF models, with applications to cancer survival data from Iowa. A good overview is
given in Banerjee et al. (2004).
An empirical Bayes pendant to our semiparametric fully Bayesian approach has been
developed in Kneib and Fahrmeir (2004) (see also Kneib, 2006).
The rest of the chapter is organized as follows. In Section 2.2 we describe models,
likelihood, and priors for unknown functions and parameters. MCMC inference and model

30
2. Nonparametric regression for survival data
choice are outlined in Subsection 2.3.1 and Subsection 2.3.2, respectively, and Subsection
2.3.3 provides results on the propriety of posteriors in geoadditive survival models under
regularity assumptions. Performance is studied in Section 2.4 through simulation studies.
Applications in Section 2.5 illustrate the method.
2.2
Models, likelihood and priors
2.2.1
Observation model and likelihood
Consider survival data in usual form, i.e., it is assumed that each individual i in the study
has a lifetime Ti and a censoring time Ci that are independent random variables. The
observed lifetime is then ti = min(Ti, Ci), and Î´i denotes the censoring indicator. The data
are then given by
(ti, Î´i; vi),
i = 1, . . . , n,
(2.1)
where vi is the vector of covariates. Covariates may also be timeâ€“dependent, but we restrict
discussion to timeâ€“constant covariates for simplicity. The same applies to left truncation
(see Subsection 1.4.2), which might easily be included, but it is not discussed here for
facility of inspection.
In Coxâ€™s proportional model the hazard rate for individual i is assumed as the product
Î»i(t; vi) = Î»0(t) exp(Î³1vi1 + . . . + Î³rvir) = Î»0(t) exp(vâ€²
iÎ³).
(2.2)
The baseline hazard rate is unspeciï¬ed, and, through the exponential link function, the
covariates v = (v1, . . . , vr) act multiplicatively on the hazard rate. As pointed out in the
introduction, in a number of applications there is a need for extending this basic model
with respect to several aspects. We propose novel nonparametric Bayesian survival mod-
els that can deal with these issues in a ï¬‚exible and uniï¬ed framework. Reparametrizing
the baseline hazard rate through exp{g0(t)}, g0(t) = log{Î»0(t)} and partitioning the vec-
tor of covariates into groups of covariates x, z, s and v, we extend model (2.2) to the
nonparametric multiplicative observation model
Î»i(t) := Î»i(t; xi, zi, si, vi) = exp{Î·i(t)}
(2.3)

2.2 Models, likelihood and priors
31
with geoadditive predictor
Î·i(t) = g0(t) +
p
X
j=1
gj(t)zij +
q
X
j=1
fj(xij) + fspat(si) + vâ€²
iÎ³ + bgi.
(2.4)
Here g0(t) = log{Î»0(t)} is the logâ€“baseline eï¬€ect, gj(t) is a timeâ€“varying eï¬€ect of the
covariate zj, and fj(xj) is the nonlinear eï¬€ect of a continuous covariate xj. The function
fspat(s) is a (structured) spatial eï¬€ect, where s, s = 1, . . . , S is either a spatial index,
with si = s if subject i is from area s, or an exact spatial coordinate s = (xs, ys), e.g. for
centroids of regions or if exact locations of individuals are known. The vector Î³ is the
vector of usual linear ï¬xed eï¬€ects, and bg is a subjectâ€“ or groupâ€“speciï¬c frailty or random
eï¬€ect, with bgi = bg if individual i is in group g, g = 1, ..., G. For G = n, we obtain
individualâ€“speciï¬c frailties, for G < n, bg might be the eï¬€ect of center g in a multicenter
study or the unstructured (uncorrelated random) spatial eï¬€ect of an area (i.e. bg = bs), for
example. Random slopes could also be introduced, but we omit this here. Several other
extensions of the model, such as choice of other link functions, inclusion of interactions and
competing risks, are possible. We discuss this in the concluding section. For identiï¬ability
reasons, we center all unknown functions about zero, and include an intercept term in the
parametric linear term.
Under the assumption about noninformative censoring, the likelihood is given by
L
=
n
Y
i=1
Î»i(ti)Î´i Â· exp

âˆ’
Z ti
0
Î»i(u)du

=
n
Y
i=1
Î»i(ti)Î´i Â· Si(ti) ,
(2.5)
inserting (2.3) and (2.4).
To obtain a uniï¬ed and generic notation, we rewrite the observation model in general
matrix notation. This is useful for deï¬ning priors in the next subsection and for developing
posterior analysis in Section 2.3 as well as for describing results on propriety of posteriors
for mixed models in Subsection 2.3.3.
Let Î· = (Î·1, . . . , Î·i, . . . , Î·n)â€² denote the predictor vector, where Î·i := Î·i(ti) is the value
of predictor (2.4) at the observed lifetime ti, i = 1, . . . , n.
Correspondingly, let gj =
(gj(t1), . . . , gj(tn))â€² denote the vector of evaluations of the functions gj(t), j = 0, . . . , p,
f j = (fj(x1j), . . . , fj(xnj))â€² the vector of evaluations of the functions fj(xj), j = 1, . . . , q,

32
2. Nonparametric regression for survival data
f spat = (fspat(s1), . . . , fspat(sn))â€² the vector of spatial eï¬€ects, and b = (bg1, . . . , bgn)â€² the
vector of uncorrelated random eï¬€ects. Furthermore, let Ëœgj = (gj(t1)z1j, . . . , gj(tn)znj)â€², j =
1, . . . , p.
In the following, we can always express vectors g0, Ëœgj, f j, f spat and b as the matrix prod-
uct of an appropriately deï¬ned design matrix Z, say, and a (possibly highâ€“dimensional)
vector Î² of parameters, e.g. Ëœgj = ZjÎ²j, f j = ZjÎ²j, etc. Then, after reindexing, we can
represent the predictor vector Î· in generic notation as
Î· = V Î³ + Z0Î²0 + . . . + ZmÎ²m.
(2.6)
2.2.2
Priors for parameters and functions
The Bayesian model formulation is completed by assumptions about priors for parameters
and functions. For ï¬xed eï¬€ect parameters Î³ in (2.6) we assume diï¬€use priors p(Î³) âˆconst.
A weakly informative normal prior would be another choice. Uncorrelated random eï¬€ects
are assumed to be i.i.d. Gaussian, bg âˆ¼N(0, Ï„ 2
b ).
Priors for functions and spatial components are deï¬ned by a suitable design matrix
Zj, j = 0, . . . , m, and a prior for the parameter vector Î²j. The general form of a prior for
Î²j in (2.6) is
p(Î²j|Ï„ 2
j ) âˆÏ„
âˆ’rj
j
exp

âˆ’1
2Ï„ 2
j
Î²â€²
jKjÎ²j

,
(2.7)
where Kj is a precision or penalty matrix of rank(Kj) = rj, shrinking parameters towards
zero or penalizing too abrupt jumps between neighboring parameters. For Pâ€“splines and
MRF priors, Kj will be rank deï¬cient, i.e., rj < dj = dim(Î²j), and the prior is partially
improper.
For unknown functions fj(xj) or gj(t), we assume Bayesian Pâ€“spline priors as in Lang
and Brezger (2004). Random walk priors, suggested in Fahrmeir and Lang (2001a), may
be used as smoothness priors for the baseline eï¬€ect and timeâ€“varying covariate eï¬€ects in a
piecewise exponential model, correspond to the special case of Pâ€“splines with degree zero.
The basic idea of Pâ€“spline regression (Eilers and Marx 1996) is to approximate a function
fj(xj) as a linear combination of Bâ€“spline basis functions Bm, i.e.
fj(xj) =
dj
X
m=1
Î²jmBm(xj).
(2.8)

2.2 Models, likelihood and priors
33
The basis functions Bm are Bâ€“splines of degree l deï¬ned over a grid of equally spaced
knots xmin = Î¾0 < Î¾1 < . . . < Î¾s = xmax, dj = l + s. The number of knots is moderate,
but not too small, to maintain ï¬‚exibility, but smoothness of the function is encouraged by
diï¬€erence penalties for neighboring coeï¬ƒcients in the sequence Î²j = (Î²j1, . . . , Î²jdj)â€². The
Bayesian analogue are ï¬rst or second order random walk smoothness priors
Î²jm = Î²j,mâˆ’1 + ujm
or
Î²jm = 2Î²j,mâˆ’1 âˆ’Î²j,mâˆ’2 + ujm
(2.9)
with i.i.d. Gaussian errors ujm âˆ¼N(0, Ï„ 2
j ) and diï¬€use priors p(Î²j1) âˆconst, or p(Î²j1)
and p(Î²j2) âˆconst, for initial values. A ï¬rst order random walk penalizes abrupt jumps
Î²jm âˆ’Î²j,mâˆ’1, and a second order random walk penalizes deviations from a linear trend.
The amount of smoothness or penalization is controlled by the variance Ï„ 2
j , which acts
as a smoothness (hyperâ€“)parameter, with hyperprior deï¬ned by (2.13). The joint prior
of the regression parameters Î²j is Gaussian and can be easily computed as a product of
conditional densities deï¬ned by (2.9) as
Î²j | Ï„ 2
j âˆÏ„
âˆ’rj
j
exp

âˆ’1
2Ï„ 2
j
Î²j
â€²KjÎ²j

,
(2.10)
which is the generic form (2.7).
The penalty matrix Kj is of the form Kj = Dâ€²D, where D is a ï¬rst or second order
diï¬€erence matrix. For second order random walks, for example, D is given by
Ddjâˆ’2Ã—dj =
ï£«
ï£¬
ï£¬
ï£­
1
âˆ’2
1
...
...
...
1
âˆ’2
1
ï£¶
ï£·
ï£·
ï£¸.
The matrix Kj has band structure which is very useful for computationally eï¬ƒcient MCMC
updating schemes (compare Section 2.3). It has rank rj = djâˆ’1 and rj = djâˆ’2 for ï¬rst and
second order random walk priors, respectively. The nÃ—dj design matrix Zj consists of the
basis functions evaluated at the observations xij, i.e., Zj(i, m) = Bm(xij). Priors for the
unknown functions gj(t) are deï¬ned in complete analogy as in (2.8) and (2.9). The design
matrix for timeâ€“varying eï¬€ect terms Ëœgj, j = 1, . . . , p is derived as Zj(i, m) = zijBm(xij).
A common choice for approximating smooth curves are quadratic or cubic Bâ€“splines and
a second order penalty. This speciï¬cation is also preferred by Eilers and Marx (1996) and
Lang and Brezger (2004) in order to obtain suï¬ƒciently smooth results. Computationally,

34
2. Nonparametric regression for survival data
linear splines are simpler. The simplest choice are Bâ€“splines of degree zero, i.e. Bm(x) â‰¡1
over the mâ€“th interval, and Bm(x) â‰¡0 elsewhere. Then the eï¬€ect is approximated by
a piecewise constant function, and the function values follow a random walk model as in
Fahrmeir and Lang (2001a). This special choice, with time t as covariate, is the easiest way
to smooth the baseline in the piecewise exponential model; moreover the integral in the
likelihood (2.5) reduces to a sum, see the next section. With Pâ€“splines of higher degree,
however, estimation of smooth baseline eï¬€ects is improved in terms of MSEs, see Section
2.4. Another nice feature of cubic Bâ€“splines is that the well known smoothing splines
appear as a special case with knots at every observation point.
For comparison we also consider an alternative parametric form. In the parametric case
we choose a Weibull form for the baseline hazard (Banerjee, Wall and Carlin (2003)):
Î»0(ti) = Î±tÎ±âˆ’1
i
.
(2.11)
A GA(0.01, 0.01) prior is assumed for Î±, so that Î± has a prior mean of 1 (corresponding to
a constant hazard over time) and a large variance of 100.
For the structured spatial eï¬€ect fspat(s) we assume either Markov random ï¬eld (MRF)
priors, twoâ€“dimensional tensor product Pâ€“spline priors, or Gaussian random ï¬eld (GRF)
priors, common in geostatistics (kriging).
In the case of MRF priors we deï¬ne areas as neighbors if they share a common boundary
and assume that the eï¬€ect of an area s is conditionally Gaussian, with the mean of the
eï¬€ects of neighboring areas as expectation and a variance that is inverse proportional to
the number of neighbors of area s. Setting fspat(s) := Î²spat
s
we have
Î²spat
s
| Î²spat
sâ€²
, sâ€² Ì¸= s âˆ¼N
 
1
Ns
X
sâ€²âˆˆÎ´s
Î²spat
sâ€²
, Ï„ 2
spat
Ns
!
,
where Ns is the number of neighbors of area s, and sâ€² âˆˆÎ´s denotes that area sâ€² is a
neighbor of area s. The n Ã— S design matrix Zspat is now a 0/1 incidence matrix. Its
value in the iâ€“th row and sâ€“th column is 1 if observation i is located in site or region
s, and zero otherwise. The S Ã— S penalty matrix Kspat has the form of an adjacency
matrix with rank(Kspat) = rspat = S âˆ’1. As for oneâ€“dimensional functions the amount of
spatial smoothness is controlled by the variance Ï„ 2
spat. A generalization to weighted means
of neighboring areas is possible but not considered here.

2.2 Models, likelihood and priors
35
Our second approach is based on twoâ€“dimensional Pâ€“splines, a rather parsimonious, but
ï¬‚exible method for modelling interactions between continuous covariates described in Lang
and Brezger (2004) for Gaussian regression. Considering the xâ€“ and yâ€“coordinates of the
geographical center of each area, the spatial eï¬€ect can be seen as an interaction between two
continuous covariates xs and ys. The assumption is that the unknown structured spatial
eï¬€ect fspat(s) can be approximated by the tensor product of oneâ€“dimensional Bâ€“splines,
i.e.
fspat(s) = fspat(xs, ys) =
dspat
X
m1=1
dspat
X
m2=1
Î²spat
m1m2Bspat,m1(xs)Bspat,m2(ys).
Now the Bâ€“splines of degree l are deï¬ned over a regular twoâ€“dimensional grid of a moderate,
but not too small number of equally spaced knots Î¾ÏÎ½, Ï, Î½ = 1, . . . , dspat âˆ’1. We restrict
ourselves to an equal number of knots for each direction. Knots are equally spaced within
each direction, but the distance may diï¬€er between direction xs and ys. Priors for Î²spat =
(Î²spat
11 , . . . , Î²spat
1dspat, . . . , Î²spat
dspat1, . . . , Î²spat
dspatdspat)â€² are based on MRF priors for spatial data on a
regular lattice (see e.g. Besag and Kooperberg, 1995). Since there is no natural ordering of
parameters, priors have to be deï¬ned by specifying the conditional distributions of Î²spat
m1m2
given neighboring parameters and the variance component Ï„ 2
spat. The most commonly used
prior speciï¬cation based on the four nearest neighbors can be deï¬ned by
Î²spat
m1m2|Â· âˆ¼N
1
4(Î²spat
m1âˆ’1,m2 + Î²spat
m1+1,m2 + Î²spat
m1,m2âˆ’1 + Î²spat
m1,m2+1), Ï„ 2
spat
4

(2.12)
for m1, m2 = 2, . . . , dspat âˆ’1 and appropriate changes for corners and edges. For example,
for the upper left corner we obtain Î²spat
11 |Â· âˆ¼N( 1
2(Î²spat
12
+ Î²spat
21 ),
Ï„ 2
spat
2 ). For the left edge, we
get Î²spat
1m2|Â· âˆ¼N( 1
3(Î²spat
1,m2+1 + Î²spat
1,m2âˆ’1 + Î²spat
2,m2),
Ï„ 2
spat
3 ).
The prior (2.12) is a direct generalization of a ï¬rst order random walk in one dimension.
Its conditional mean can be interpreted as a least squares locally linear ï¬t at knot position
Î¾ÏÎ½ given the neighboring parameters. More details can be found in Lang and Brezger
(2004). Deï¬ning Kspat = Dâ€²
1D1 + Dâ€²
2D2, where D1 = I âŠ—D and D2 = D âŠ—I, the
prior can again be expressed in the general form (2.7). Here, D is the ï¬rst order diï¬€erence
matrix known from the oneâ€“dimensional case, and Dâ€²
1D1 corresponds to the penalization
in the direction of x and Dâ€²
2D2 corresponds to the penalization in the direction of y.
Our third option are stationary Gaussian random ï¬eld (GRF) priors, which can be
seen as twoâ€“dimensional surface smoothers based on special basis functions, e.g. radial

36
2. Nonparametric regression for survival data
basis functions, and have been used by Kammann and Wand (2003) for modelling the
spatial component in Gaussian regression models. The spatial component fspat(s) = Î²spat
s
is assumed to follow a zero mean stationary Gaussian random ï¬eld {Î²spat
s
: s âˆˆR2} with
variance Ï„ 2
spat and use an isotropic covariance function cov(Î²spat
s
, Î²spat
sâ€²
) = C(âˆ¥s âˆ’sâ€²âˆ¥) as
proposed by Stein (1999). For a ï¬nite array s âˆˆ{1, . . . , S} of sites as in our application
the prior can be brought in the general form
Î²spat | Ï„ 2
spat âˆexp

âˆ’
1
2Ï„ 2
spat
(Î²spat)â€²KspatÎ²spat

with penalty matrix Kspat = Câˆ’1, where C[k, l] = C(âˆ¥sk âˆ’slâˆ¥), 1 â‰¤k, l â‰¤n, and design
matrix Zspat = C.
For the covariance function C(r) we follow again recommendations of Stein (1999) and
use the MatÂ´ern family of covariance functions C(r; Ï, Î½). For the special case Î½ = 1.5 for
the smoothness parameter the covariance functions simplify to
C(r; Ï, Î½) = Ï„ 2
spat(1 + |r|/Ï)eâˆ’|r|/Ï,
which is the simplest member of the MatÂ´ern family that results in diï¬€erentiable surface
estimates as Kammann and Wand (2003) point out. The parameter Ï controls how fast
covariances die out with increasing distance r. We choose Ï according to the rule
Ë†Ï = max
k,l âˆ¥sk âˆ’slâˆ¥/c
to ensure scale invariability. This rule proved to work well in practice. The constant c is
chosen in such a way that C(c) is small, e.g. C(c) = 0.001.
While the dimension of the penalty matrix in a MRF equals the number of diï¬€erent
regions S, in a GRF the dimension corresponds to the number of distinct locations which
is likely to be close to or equal to the sample size. To reduce this computational burden
Kammann and Wand (2003) propose lowâ€“rank kriging to approximate stationary Gaussian
random ï¬elds. Therefore they deï¬ne a â€™representativeâ€™ subset of knots D = {Îº1, . . . , ÎºM}
of the set of distinct locations by applying a space ï¬lling algorithm (compare Johnson et
al. (1990) and Nychka and Saltzman (1998) for details). Based on these knots, we obtain
the approximation fspat(s) = zâ€²
spat(s)Î²spat with the Mâ€“dimensional design vector zspat(s) =
(C(âˆ¥s âˆ’Îº1âˆ¥), . . . , C(âˆ¥s âˆ’ÎºMâˆ¥))â€² and penalty matrix Kspat = ËœC and ËœC[k, l] = C(âˆ¥Îºk âˆ’

2.2 Models, likelihood and priors
37
Îºlâˆ¥). The number of knots controls the tradeâ€“oï¬€between accuracy of the approximation
and numerical simpliï¬cation. Details on GRF and (lowâ€“rank) kriging can be found in
Kammann and Wand (2003), Kneib and Fahrmeir (2005) or Kneib (2006).
Still a serious drawback of this approach is the computational eï¬€ort involved. Since
the penalty matrix Kspat has no longer band structure it is not possible to employ eï¬ƒcient
matrix algorithms for sparse matrices like the Cholesky decomposition in order to draw
samples from our multivariate normal proposal density and to compute the determinant of
the precision matrix, which is needed to calculate the acceptance probability of the MHâ€“
step in every iteration (compare Section 2.3). For the application in Section 2.5, e.g., this
means that the required CPU time multiplies approximately by the factor 20, even if we
use lowâ€“rank kriging with a moderate number of 100 knots. It depends mainly on the data
at hand, which of the diï¬€erent approaches leads to the best ï¬t. For data observed on a
discrete lattice or on the level of geographical regions as in our application, MRFs seem to
be most adequate, while surface smoothers as 2d Pâ€“splines or kriging may be more natural
in situations where exact locations are available. In general, MRFs exhibit more rough
results, while 2d Pâ€“splines produce the smoothest estimates. GRFs also tend to give quite
smooth curves.
A decision between MRFs and 2d Pâ€“splines or GRFs, respectively, may depend on
ones beliefs about the characteristics of the corresponding eï¬€ect. If an eï¬€ect is supposed
to vary smoothly (e.g. in case it is inï¬‚uenced by temperature or atmospheric pressure)
surface estimators can be expected to be the better choice. If, on the other hand, an eï¬€ect
is likely to be induced, for example, by characteristics of geographical or political units,
which may depend on neighbors, but may quite as well be rather heterogenic, then a MRF
should be preferred. However, in applications sometimes surface estimators outperform
MRFs even for discrete data (and vice versa). This may be due to some regions having
few neighbors or observations, since a more smooth surface estimator is able to reduce the
bias for such regions.
In real data applications we do not know how much of the spatial variation is explained
by structured, spatially correlated eï¬€ects and how much by unstructured, uncorrelated
eï¬€ects. Therefore we may ï¬t an additional (unstructured) areaâ€“speciï¬c random eï¬€ect. We
recommend to interpret only the sum of the two eï¬€ects, since identiï¬ability is weak in that
case.

38
2. Nonparametric regression for survival data
We routinely assign inverse Gamma priors IG(aj; bj)
p(Ï„ 2
j ) âˆ
1
(Ï„ 2
j )aj+1 exp

âˆ’bj
Ï„ 2
j

(2.13)
to all variances.
They are proper for aj > 0, bj > 0, and we use aj = bj = 0.001
as a standard choice for a weakly informative prior.
From our experience results are
rather insensitive to the choice of aj > 0 and bj > 0 for moderate to large data sets and
the posterior distribution is proper in any case under some regularity assumptions (see
Subsection 2.3.3 and Hennerfeind, Brezger and Fahrmeir (2005) for a proof). However,
since the limiting case, when aj and bj are zero, leads to an improper posterior distribution,
we present a sensitivity analysis in Section 2.4 and compare the results to those we obtained
with a uniform prior for the standard deviation Ï„j, as proposed in Gelman (2004). Note
that uniform priors are a special (improper) case of the prior (2.13) with aj = âˆ’0.5, bj = 0,
still leading to proper posteriors under regularity assumptions.
The Bayesian model speciï¬cation is completed by assuming that all priors for parame-
ters are conditionally independent, and that all priors are mutually independent.
2.3
Markov chain Monte Carlo inference
In what follows, let Î² = (Î²â€²
0, ..., Î²â€²
m)â€² denote the vector of all regression coeï¬ƒcients in the
generic notation (2.6), Î³ the vector of ï¬xed eï¬€ects, and Ï„ 2 = (Ï„ 2
0 , ..., Ï„ 2
m) the vector of all
variance components. Full Bayesian inference is based on the entire posterior distribution
p(Î², Î³, Ï„ 2 | data) âˆL(Î², Î³, Ï„ 2) p(Î², Î³, Ï„ 2).
Due to the (conditional) independence assumptions, the joint prior factorizes into
p(Î², Î³, Ï„ 2) =
( m
Y
j=0
p(Î²j | Ï„ 2
j )p(Ï„ 2
j )
)
p(Î³),
where the last factor can be omitted for diï¬€use ï¬xed eï¬€ect priors.
The likelihood L(Î², Î³, Ï„ 2) is given by inserting (2.3), (2.4) into (2.5), but the integral
requires integration over all terms depending on survival time t, i.e. terms of the form
Ii =
Z ti
0
exp
 
g0(u) +
p
X
j=1
gj(u)zij
!
du,
(2.14)

2.3 Markov chain Monte Carlo inference
39
where gj(t) = P Î²jmBm(t). Apart from Bâ€“splines Bm(t) of degree zero, i.e. random walk
models, and linear Bâ€“splines, these integrals are not available in closed form. The ï¬rst
case leads to the piecewise exponential model: The time axis is divided into a grid
0 = Î¾0 < Î¾1 < ... < Î¾tâˆ’1 < Î¾t < ... < Î¾s = tmax,
and gj(t) is assumed to be a piecewise constant function, i.e.
gj(t) = Î²jt
in time interval (Î¾tâˆ’1, Î¾t], t = 1, ..., s. In this case, the integral reduces to a sum, and, after
some calculations, the logâ€“likelihood contribution of observation i in the interval (Î¾tâˆ’1, Î¾t]
can be expressed as
lit = yitÎ·it âˆ’exp (âˆ†it + Î·it)
where
yit =
(
1
ti âˆˆ(Î¾tâˆ’1, Î¾t],Î´i = 1
0
else.
âˆ†â€²
it =
ï£±
ï£´
ï£´
ï£²
ï£´
ï£´
ï£³
Î¾t âˆ’Î¾tâˆ’1,
Î¾t < ti
ti âˆ’Î¾tâˆ’1,
Î¾tâˆ’1 < ti â‰¤Î¾t
0,
Î¾tâˆ’1 â‰¥ti
âˆ†it = log âˆ†â€²
it
(âˆ†it = âˆ’âˆif âˆ†â€²
it = 0).
This likelihood is proportional to a Poissonâ€“likelihood, with the predictor Î·it containing
an additional oï¬€set term âˆ†it, see Fahrmeir and Tutz (2001, Section 9.1) or Ibrahim et
al. (2001, Section 3.1) for details.
For linear Bâ€“splines, the integrals can still be solved analytically, but expressions are
rather messy and the computational eï¬€ort is quite high, see Cai et al. (2002, Appendix).
Following their suggestion, we use simple numerical integration in form of the trapezoidal
rule for linear Bâ€“splines as well as for the commonly used cubic Bâ€“splines, where analytical
integration is not possible anyway.

40
2. Nonparametric regression for survival data
2.3.1
Updating full conditionals
Full Bayesian inference via MCMC simulation is based on updating full conditionals of
single parameters or blocks of parameters, given the rest of the data. For updating the
parameter vectors Î²j, which correspond to the timeâ€“independent functions fj(xj), as well
as spatial eï¬€ects Î²spat, ï¬xed eï¬€ects Î³ and random eï¬€ects b, we use a slightly modiï¬ed
version of an MHâ€“algorithm based on iteratively weighted least squares (IWLS) proposals,
developed for ï¬xed and random eï¬€ects by Gamerman (1997) and adapted to generalized
additive mixed models in Brezger and Lang (2006).
Suppose we want to update Î²j, with current value Î²c
j of the chain. Then a new value Î²p
j
is proposed by drawing a random vector from a (highâ€“dimensional) multivariate Gaussian
proposal distribution q(Î²c
j, Î²p
j), which is obtained from a quadratic approximation of the
logâ€“likelihood by a second order Taylor expansion with respect to Î²c
j, in analogy to IWLS
iterations in generalized linear models.
More precisely, the goal is to approximate the
posterior by a Gaussian distribution, obtained by accomplishing one IWLS step in every
iteration of the sampler. Then, random samples have to be drawn from a high dimensional
multivariate Gaussian distribution with precision matrix and mean
P j = Zâ€²
jW (Î²c
j)Zj + 1
Ï„ 2
j
Kj,
mj = P âˆ’1
j Zâ€²
jW (Î²c
j)(Ëœy âˆ’ËœÎ·).
Here, ËœÎ·i = Î·i(ti) âˆ’fj(xij), W (Î²c
j) = diag(w1, . . . , wn) is the weight matrix for IWLS with
weights calculated from the current state Î²c
j as follows
wi = exp
 
q
X
j=1
fj(xij) + fspat(si) + vâ€²
iÎ³ + bgi
!
Â· Ii.
Concisely written we get wi =
R ti
0 Î»i(u)du = Î›i(ti), which is the cumulative hazard rate.
The working observations Ëœyi are given by
Ëœyi = Î·i(ti) + Î´i
wi
âˆ’1.
See Appendix A1 for a detailed derivation of those quantities. The proposed vector Î²p
j is
accepted as the new state of the chain with probability
Î±(Î²c
j, Î²p
j) = min

1, p(Î²p
j | Â·)q(Î²p
j, Î²c
j)
p(Î²c
j | Â·)q(Î²c
j, Î²p
j)


2.3 Markov chain Monte Carlo inference
41
where p(Î²j | Â·) is the full conditional for Î²j (i.e. the conditional distribution of Î²j given
all other parameters and the data).
For a fast implementation, we use the fact that the precision matrices of the Gaussian
proposal distributions are banded for MRS and 2d Pâ€“spline models, so that Cholesky
decompositions can be performed eï¬ƒciently. Now, random numbers from the high dimen-
sional proposal distributions can be eï¬ƒciently drawn using an algorithm by Rue (2001).
The acceptance probability Î±(Î²c
j, Î²p
j) involves the determinant det(P j) of the proposal den-
sity, since P j depends on Î²c
j. Fortunately, this quantity is obtained as a simple byâ€“product
of the Cholesky decomposition with negligible computational eï¬€ort.
Note, however, that this is not the case for GRF models. Here, Kj is not banded, and
thus P j is not banded, either. Therefore, drawing from the proposal and evaluating its
determinant is much more demanding in terms of CPU time.
For the parameters Î²j corresponding to the functions g0(t), ..., gp(t) depending on time
t, the IWLSâ€“MH algorithm requires considerably more computational eï¬€ort, because the
integrals in the logâ€“likelihood as well as ï¬rst and second derivatives are involved now.
Therefore, we adopt a computationally faster MHâ€“algorithm based on conditional prior
proposals, although IWLSâ€“MH has better mixing properties.
This algorithm was ï¬rst
developed by Knorrâ€“Held (1999) for state space models and extended for generalized ad-
ditive mixed models in Fahrmeir and Lang (2001a). It requires only evaluation of the
logâ€“likelihood, not of derivatives. However, draws are not performed for the entire vector
Î²j, but iteratively for blocks of subvectors, see Fahrmeir and Lang (2001a) for details. In
the case of the parametric Weibull prior (2.11) a new value Î±p is proposed by drawing from
a Gamma distribution GA(Î±c Â· bw, bw), with Î±c denoting the current value of the chain and
bw being tuned automatically during the burnâ€“in period.
The full conditionals for the variance parameters Ï„ 2
j are (proper) inverse Gamma with
parameters
aâ€²
j = aj + 1
2rj
and
bâ€²
j = bj + 1
2Î²â€²
jKjÎ²j,
including the case aj = âˆ’0.5, bj = 0 of uniform priors on Ï„j. Updating can be done by
simple Gibbs steps, drawing random numbers directly from the inverse Gamma densities.
In complete analogy, the full conditional for a variance component Ï„ 2
spat of the spatial eï¬€ect
and Ï„ 2
b of a random intercept or slope is again an inverse gamma distribution, and updating

42
2. Nonparametric regression for survival data
is straightforward.
2.3.2
Model choice
Bayesian model choice is an area of ongoing research with several competing proposals
ranging from (modiï¬ed) Bayes factors to posterior predictive loss approaches (Gelfand and
Gosh 1998).
We routinely use the Deviance Information Criterion (DIC) developed in
Spiegelhalter, Best, Carlin and van der Linde (2002). It is given as
DIC = D(Î¸) + 2pD = D(Î¸) + pD,
where Î¸ is the vector of parameters, D(Î¸) is the deviance of the model evaluated at the
posterior mean estimate Î¸, D(Î¸) is the posterior mean of the deviance and pD = D(Î¸) âˆ’
D(Î¸) is the eï¬€ective number of parameters. Since it is at least unclear, how the saturated
model should be deï¬ned in the case of survival data when the baseline hazard and other
nonparametric functions are parameters of interest, we use the unstandardized deviance
D(Î¸) = âˆ’2Â·logâ€“likelihood instead of the saturated deviance. Banerjee and Carlin (2004,
Section 4) provide good arguments why the DIC is a reasonable criterion in connection
with censored survival data.
2.3.3
Propriety of posteriors in geoadditive survival models
Consider a geoadditive survival model with predictor in generic form (2.6), where Z 0Î²0
corresponds to an eï¬€ect with prior (2.7) for Î²0 such that dim(Î²0) = d0 â‰¥dj, rank(K0) =
r0 â‰¥rj, j = 1, . . . , m. This assumption is usually fulï¬lled for the spatial component or for
a highâ€“dimensional vector of groupâ€“speciï¬c uncorrelated random eï¬€ects.
Denote by Î·u, V u, Zu = (Z1u, ..., Zmu), Z0u the (subâ€“)predictor and subâ€“design ma-
trices corresponding to uncensored observations. Assume that the following conditions
hold:
(C1) rank(V u) = rank(V ) = p = dim(Î³),
rank(Zju) = rank(Zj) = dj = dim(Î²j),
j = 0, ..., m
rank(Zâ€²
uRZu + K) = d
where d = d1 + ... + dm,
K = diag(K1, ..., Km),
R = I âˆ’V u(V â€²
uV u)âˆ’1V â€²
u

2.3 Markov chain Monte Carlo inference
43
(C2) The priors p(Ï„ 2
j ), j = 1, ..., m, are proper, and
R
p(Ï„ 2
0 )Ï„ âˆ’(r0âˆ’pâˆ’(dâˆ’r)âˆ’(d0âˆ’r0))
0
dÏ„ 2
0 < âˆ,
where r = r1 + ... + rm.
Theorem 1: If conditions (C1), (C2) hold then the posterior p(Î³, Î², Î²0, Ï„ 2, Ï„ 2
0 | y), where
Ï„ 2 = (Ï„ 2
1 , . . . , Ï„ 2
m)â€² and Î² = (Î²1, . . . , Î²m)â€², is proper.
The following corollary is easier to check.
Corollary 1: Assume proper inverse Gamma priors Ga(aj, bj) for Ï„ 2
j with j = 0, ..., m and
r0 + 2a0 âˆ’p âˆ’(d âˆ’r) âˆ’(d0 âˆ’r0) > 0.
If condition (C1) holds, then the posterior p(Î³, Î², Î²0, Ï„ 2, Ï„ 2
0 | y) is proper.
Proofs are based on Sun et al. (1999), and are outlined in Hennerfeind, Brezger and
Fahrmeir (2005).
Remark 1: Condition (C1) is equivalent to rank(Z0u)=d0 and
rank
 
V â€²
uV u
V â€²
uZu
Zâ€²
uV u
Zâ€²
uZu + K
!
= p + d
Remark 2: Under additional assumptions, proper posteriors may also be obtained for
aj < 0, bj = 0, e.g. for the uniform prior on Ï„j. A rigorous proof could be based on a
generalization of Sun, Tsutakawa and He (2001).
Remark 3: Informally expressed condition (C1) is fulï¬lled if the information provided
by uncensored observations is suï¬ƒcient to support the estimation of each single parameter
in (Î³, Î², Î²0). Considering the cases where Î²0 denotes a spatial eï¬€ect or a groupâ€“speciï¬c
random eï¬€ect, rank(Z0u)=d0 is fulï¬lled if the data set comprises at least one uncensored
observation per area or group, respectively. Condition (C2) is fulï¬lled if the inverse Gamma
priors for Ï„ 2
j are proper and r0 + 2a0 is greater than the number of improper priors for
parameters in (Î³, Î², Î²0).
Note that these conditions are suï¬ƒcient conditions and may be weakened in some places.

44
2. Nonparametric regression for survival data
2.4
Simulation Study
Performance was investigated through simulation studies. In particular we were interested
in the following questions: How inï¬‚uential is the choice of MRF versus smoother spatial
priors and the choice of a piecewise exponential model (Pâ€“spline of degree zero) versus
a cubic Pâ€“spline model for the baseline hazard rate? How sensitive are the results with
respect to the hyperparameters for the variance parameters? And how does a Pâ€“spline
model perform compared to a Weibullâ€“model in cases where the Weibull assumption is
indeed true and in cases where it is not true, respectively.
Simulation Setup I
Life times Ti, i = 1, ..., 1236, were generated from Weibull distributions according to the
hazard model
Î»i(t) = Î»0(t) exp(f1(xi) + fspat(si) + Î³vi) = exp(log(3t2) + sin(xi) + sin(xsi Â· ysi) âˆ’0.3vi),
(2.15)
with Weibull baseline hazard rate Î»0(t) = 3t2, a binary covariate v, with the vis randomly
drawn from a Bernoulli B(1; 0.5) distribution, and a continuous covariate x, with the xis
randomly drawn from a uniform U[âˆ’3, 3] distribution. The spatial covariate si denotes
one of the s = 1, . . . , S = 309 counties of the former Federal Republic of Germany and xsi
and ysi are the centered coordinates of the geographic center of county si. We simulated
four observations per county, resulting in 309 Ã— 4 = 1236 observations in total.
The
censoring was done as follows: We randomly selected a certain proportion of observations
(â‰ˆ17% and â‰ˆ50%, respectively) that were to be censored. Censoring variables Ci for
these selected observations were then generated as i.i.d. draws from corresponding uniform
U[0, Ti] distributions.
Keeping the predictor ï¬xed, 100 replications {T (r)
i
, C(r)
i , i = 1, ..., 1236} respectively
{(t(r)
i , Î´(r)
i ), i = 1, ..., 1236}, r = 1, ..., 100 of censored survival times were generated.
To investigate the ï¬rst question, the logâ€“baseline hazard g0(t) was modelled by second
order random walk priors, corresponding to a piecewise exponential model, and alterna-
tively as a cubic Pâ€“spline with 20 knots. The spatial eï¬€ect was modelled as a MRF and
alternatively as a twoâ€“dimensional cubic Pâ€“spline with 12 Ã— 12 knots. Simulations with

2.4 Simulation Study
45
GRF priors are not feasible due to much higher computation times, but the general mes-
sage will be the same. A cubic Pâ€“spline prior with 20 knots was chosen for f1(x) = sin(x)
in each case. Hyperparameters of inverse Gamma priors for variance components were set
to a = 0.001, b = 0.001, the standard choice.
For each replication r = 1, ..., 100, we computed the mean square errors
MSEr(g0) =
1
1236
1236
X
i=1
(bg(r)
0 (t(r)
i ) âˆ’g0(t(r)
i ))2,
for the logâ€“baseline hazard g0(t),
MSEr(f1) =
1
1236
1236
X
i=1
( bf (r)
1 (xi) âˆ’f1(xi))2
for f1(x) = sin(x), and
MSEr(fspat) =
1
1236
1236
X
i=1
( bf (r)
spat(si) âˆ’fspat(si))2
for the spatial eï¬€ect fspat(s) = sin(xc Â· yc), where bg(r)
0
and bf (r)
k , k = 1, spat, are posterior
mean estimates for simulation run r. The MSE(Î³) was computed in the usual way.
Results: MRF versus 2d Pâ€“spline, p.e.m. versus Pâ€“spline model
Figures 2.1 and 2.2 display boxplots of the logarithmic MSEs (log(MSEr), r = 1 . . . , 100).
As was to be expected, the Pâ€“spline model has smaller MSEs for g0 when compared to
the piecewise exponential model. Interestingly, the MSEs for Î³ = âˆ’0.3, f1(x) and fspat(s)
are more or less unaï¬€ected by the choice of the smoothness prior for the logâ€“baseline g0(t).
Estimated functions of replication r, with r chosen such that MSEr is the median of
MSE1, . . . , MSE100, for g0(t), f1(x) and fspat(s) are displayed in Figures 2.3â€“2.5 (for the
censoring level of 17%). Regarding the two diï¬€erent levels of censoring Figures 2.1 and 2.2
show that the estimation of the logâ€“baseline eï¬€ect is the eï¬€ect that is strongest inï¬‚uenced
by the level of censoring. While increasing the censoring level from 17% to 50% leads to
an approximately 2.75 times larger MSE for g0(t) the MSE for fspat(s) is only increased
by a factor of ca. 1.35. Due to the simulation scheme, where the spatial eï¬€ect is deï¬ned as
a smooth 2â€“dimensional function of the spatial coordinates (fspat(si) = sin(xsi Â· ysi)), the
MSEs for fspat are smaller when a 2â€“dimensional Pâ€“spline prior is assumed instead of a
MRF prior.

46
2. Nonparametric regression for survival data
MRF
2d Pâ€“spline
low
high
âˆ’3
âˆ’2
âˆ’1
0
pem
pâˆ’spline
pem
pâˆ’spline
g_0
low
high
âˆ’3
âˆ’2
âˆ’1
0
pem
pâˆ’spline
pem
pâˆ’spline
g_0
low
high
âˆ’8
âˆ’7
âˆ’6
âˆ’5
âˆ’4
âˆ’3
âˆ’2
pem
pâˆ’spline
pem
pâˆ’spline
f_1
low
high
âˆ’8
âˆ’7
âˆ’6
âˆ’5
âˆ’4
âˆ’3
âˆ’2
pem
pâˆ’spline
pem
pâˆ’spline
f_1
Figure 2.1:
Simulation: model comparison via boxplots of logâ€“MSEs for data sets with
low (ca. 17%) and high censoring level (ca. 50%), for estimations with MRF priors (left
panel) and 2â€“d Pâ€“spline priors (right panel) for the spatial eï¬€ect each with cubic Pâ€“spline
priors for the logâ€“baseline and p.e.m.s, respectively.

2.4 Simulation Study
47
MRF
2d Pâ€“spline
low
high
âˆ’5
âˆ’4
âˆ’3
âˆ’2
pem
pâˆ’spline
pem
pâˆ’spline
f_spat
low
high
âˆ’5
âˆ’4
âˆ’3
âˆ’2
pem
pâˆ’spline
pem
pâˆ’spline
f_spat
low
high
âˆ’20
âˆ’15
âˆ’10
âˆ’5
0
pem
pâˆ’spline
pem
pâˆ’spline
gamma
low
high
âˆ’20
âˆ’15
âˆ’10
âˆ’5
0
pem
pâˆ’spline
pem
pâˆ’spline
gamma
Figure 2.2:
Simulation: model comparison via boxplots of logâ€“MSEs for data sets with
low (ca. 17%) and high censoring level (ca. 50%), for estimations with MRF priors (left
panel) and 2â€“d Pâ€“spline priors (right panel) for the spatial eï¬€ect each with cubic Pâ€“spline
priors for the logâ€“baseline and p.e.m.s, respectively.

48
2. Nonparametric regression for survival data
âˆ’6
âˆ’4
âˆ’2
0
2
4
g_0(t)
0
1
2
3
t
(a) p.e.m., MRF
âˆ’6
âˆ’4
âˆ’2
0
2
4
g_0(t)
0
1
2
3
t
(b) p.e.m., 2d Pâ€“spline
âˆ’6
âˆ’4
âˆ’2
0
2
4
g_0(t)
0
1
2
3
t
(c) Pâ€“spline model, MRF
âˆ’6
âˆ’4
âˆ’2
0
2
4
g_0(t)
0
1
2
3
t
(d) Pâ€“spline model, 2d Pâ€“spline
Figure 2.3: (logâ€“)Baseline eï¬€ects g0(t) for the various model speciï¬cations; displayed are
posterior mean estimates and 95% credible intervals of run r, with r chosen such that
MSEr is the median of MSE1, . . . , MSE100 (solid line and grey shaded area), and the
true (logâ€“)baseline eï¬€ect (dashed line).
a) p.e.m., MRF, r=11, MSE=0.183 b) p.e.m.,
2d Pâ€“spline, r=51, MSE=0.181 c) Pâ€“spline model, MRF, r=51, MSE=0.148 d) Pâ€“spline
model, 2d Pâ€“spline, r=7, MSE=0.145

2.4 Simulation Study
49
âˆ’1.5
âˆ’1
âˆ’.5
0
.5
1
1.5
f_1(x)
âˆ’3
âˆ’2
âˆ’1
0
1
2
3
x
(a) p.e.m., MRF
âˆ’1.5
âˆ’1
âˆ’.5
0
.5
1
1.5
f_1(x)
âˆ’3
âˆ’2
âˆ’1
0
1
2
3
x
(b) p.e.m., 2d Pâ€“spline
âˆ’1.5
âˆ’1
âˆ’.5
0
.5
1
1.5
f_1(x)
âˆ’3
âˆ’2
âˆ’1
0
1
2
3
x
(c) Pâ€“spline model, MRF
âˆ’1.5
âˆ’1
âˆ’.5
0
.5
1
1.5
f_1(x)
âˆ’3
âˆ’2
âˆ’1
0
1
2
3
x
(d) Pâ€“spline model, 2d Pâ€“spline
Figure 2.4:
Nonparametric eï¬€ects f1(x) for the various model speciï¬cations; displayed
are posterior mean estimates and 95% credible intervals of run r, with r chosen such that
MSEr is the median of MSE1, . . . , MSE100 (solid line and grey shaded area), and the
true function (dashed line). a) p.e.m., MRF, r=53, MSE=0.0064 b) p.e.m., 2d Pâ€“spline,
r=36, MSE=0.0053 c) Pâ€“spline model, MRF, r=67, MSE=0.0068 d) Pâ€“spline model, 2d
Pâ€“spline, r=19, MSE=0.0056

50
2. Nonparametric regression for survival data
(a)
(b)
(c)
(d)
(e)
Figure 2.5:
Spatial eï¬€ects for the various model speciï¬cations with eï¬€ects ranging from
-1.3 to 1.65; displayed are posterior mean estimates of run r, with r chosen such that MSEr
is the median of MSE1, . . . , MSE100 a) true function b) p.e.m., MRF, r=41, MSE=0.041
c) p.e.m., 2d Pâ€“spline, r=13, MSE=0.021 d) Pâ€“spline model, MRF, r=12, MSE=0.042 e)
Pâ€“spline model, 2d Pâ€“spline, r=13, MSE=0.021

2.4 Simulation Study
51
0
200
400
600
800
1000
âˆ’9
âˆ’7
âˆ’5
g_0(t),a=b=0.001
iteration
Î²1
0
200
400
600
800
1000
âˆ’10
âˆ’7
âˆ’5
g_0(t),a=b=1eâˆ’08
iteration
Î²1
0
200
400
600
800
1000
âˆ’12
âˆ’9
âˆ’6
g_0(t),a=âˆ’0.5,b=0
iteration
Î²1
0
200
400
600
800
1000
0.4
1.0
g_0(t),a=b=0.001
iteration
Î²13
0
200
400
600
800
1000
0.4
1.0
g_0(t),a=b=1eâˆ’08
iteration
Î²13
0
200
400
600
800
1000
0.4
1.0
g_0(t),a=âˆ’0.5,b=0
iteration
Î²13
0
200
400
600
800
1000
âˆ’1.0
0.5
f_1(x),a=b=0.001
iteration
Î²1
0
200
400
600
800
1000
âˆ’1.5
0.0
1.5
f_1(x),a=b=1eâˆ’08
iteration
Î²1
0
200
400
600
800
1000
âˆ’1.0
0.5
f_1(x),a=âˆ’0.5,b=0
iteration
Î²1
0
200
400
600
800
1000
0.2
0.5
f_1(x),a=b=0.001
iteration
Î²13
0
200
400
600
800
1000
0.2
0.5
0.8
f_1(x),a=b=1eâˆ’08
iteration
Î²13
0
200
400
600
800
1000
0.2
0.5
f_1(x),a=âˆ’0.5,b=0
iteration
Î²13
0
200
400
600
800
1000
âˆ’1.0
0.5
f_spat(s),a=b=0.001
iteration
Î²1
0
200
400
600
800
1000
âˆ’1.0
0.5
f_spat(s),a=b=1eâˆ’08
iteration
Î²1
0
200
400
600
800
1000
âˆ’1.0
0.5
f_spat(s),a=âˆ’0.5,b=0
iteration
Î²1
0
200
400
600
800
1000
0.5
1.5
f_spat(s),a=b=0.001
iteration
Î²13
0
200
400
600
800
1000
0.0
1.0
2.0
f_spat(s),a=b=1eâˆ’08
iteration
Î²13
0
200
400
600
800
1000
0.0
1.0
2.0
f_spat(s),a=âˆ’0.5,b=0
iteration
Î²13
Figure 2.6: Selected sampling paths of run r = 1 for parameters Î²j,1 and Î²j,13, j = 0, 1, spat and
diï¬€erent choices for the parameters a and b of the IG(a; b) hyperpriors.

52
2. Nonparametric regression for survival data
Results: inï¬‚uence of hyperparameters
To investigate the second question, in particular to analyze the behavior of the Markov
chains when a and b approach zero (and the prior for the hyperparameters thus approaches
the IG(0; 0) distribution, that leads to an improper posterior), we focus on the Pâ€“spline
model with MRFâ€“prior and a censoring level of 17% and alternatively set a = b = 0.0001,
a = b = 0.00001 and a = b = 0.00000001. We additionally run the simulation study with
a = âˆ’0.5, b = 0, i.e. uniform priors on the standard deviations Ï„0, Ï„1 and Ï„spat that act as
smoothing parameters for the logâ€“baseline, the nonlinear eï¬€ect of x and the spatial eï¬€ect,
respectively. Selected sampling paths of run r = 1 are exemplarily shown in Figure 2.6.
We did not face problems with mixing or convergence of Markov chains with any of these
prior distributions. An exception are the ï¬rst one or two parameters of the baseline eï¬€ect,
i.e. Î²0,1 and Î²0,2, corresponding to the eï¬€ect of small times t, where the mixing properties
are not always optimal. This can be explained by the very steep increase of the â€™trueâ€™ logâ€“
baseline, reaching to minus inï¬nity as t approaches zero whereas it is quite ï¬‚at elsewhere.
In this situation a global variance might not be an ideal choice. Another point may be
the usage of conditional prior proposals that usually lead to poorer mixing properties than
IWLSâ€“proposals do. Figure 2.7 displays kernel density estimators of the posterior mean
of the variance parameters based on bÏ„ 2
j
(r)
, r = 1, . . . , 100 for j = 0, 1, spat.
Obviously
the diï¬€erent choices of the hyperparameters a and b of the inverse Gamma prior do not
seem to have much eï¬€ect, whereas the uniform prior on the standard deviations tends to
result in somewhat larger estimates for the variance parameters and thus in less smooth
eï¬€ects. The posterior distribution of the variance parameter of the spatial eï¬€ect is quite
robust, as the full conditional is dominated by the values of rj =rank(Kj) and Î²â€²
jKjÎ²j at
this. Figure 2.8 displays boxplots of the logarithmic MSEs (log(MSEr), r = 1, . . . , 100),
that are computed as before. While the MSEs are quite unaï¬€ected by the choice of the
hyperparameters a = b of the inverse Gamma prior, the uniform prior results in a slightly
smaller MSE for g0(t), but a slightly bigger MSE for f1(x). Altogether we come to the
conclusion that (at least with this model) it does not seem to be crucial, which one of these
weakly informative priors is assumed for the variance parameters.

2.4 Simulation Study
53
0.0
0.1
0.2
0.3
0.4
0
2
4
6
8
10
variance of logâˆ’baseline effect
Ï„2^
Density
a=b=0.001,          Âµ^=.117
a=b=0.0001,        Âµ^=.113
a=b=0.00001,      Âµ^=.116
a=b=0.00000001,Âµ^=.110
uniform prior,       Âµ^=.158
0.02
0.04
0.06
0.08
0.10
0
10
20
30
40
50
60
variance of nonparametric effect of x
Ï„2^
Density
a=b=0.001,          Âµ^=.0408
a=b=0.0001,        Âµ^=.0400
a=b=0.00001,      Âµ^=.0400
a=b=0.00000001,Âµ^=.0401
uniform prior,       Âµ^=.0522
0.3
0.4
0.5
0.6
0.7
0
2
4
6
8
variance of spatial effect
Ï„2^
Density
a=b=0.001,          Âµ^=.461
a=b=0.0001,        Âµ^=.461
a=b=0.00001,      Âµ^=.460
a=b=0.00000001,Âµ^=.462
uniform prior,       Âµ^=.472
Figure 2.7:
Kernel density estimates based on bÏ„ 2
j
(r)
, r = 1, . . . , 100 for j = 0, 1 and spat,
respectively. Ë†Âµ denotes the mean estimated smoothing parameter.

54
2. Nonparametric regression for survival data
âˆ’3.5
âˆ’3
âˆ’2.5
âˆ’2
âˆ’1.5
âˆ’1
0.001
0.0001
1eâˆ’05
1eâˆ’08
âˆ’0.5,0
g_0
âˆ’7
âˆ’6
âˆ’5
âˆ’4
âˆ’3
0.001
0.0001
1eâˆ’05
1eâˆ’08
âˆ’0.5,0
f_1
âˆ’3.5
âˆ’3
âˆ’2.5
0.001
0.0001
1eâˆ’05
1eâˆ’08
âˆ’0.5,0
f_spat
âˆ’20
âˆ’15
âˆ’10
âˆ’5
0
0.001
0.0001
1eâˆ’05
1eâˆ’08
âˆ’0.5,0
gamma
Figure 2.8: Simulation: Comparison via boxplots of logMSEs for estimations with IG(a; b)
hyperpriors for a = b = 0.001, a = b = 0.0001, a = b = 1e âˆ’05, a = b = 1e âˆ’08 and
a = âˆ’0.5, b = 0 respectively.

2.4 Simulation Study
55
g_0
gamma
âˆ’20
âˆ’15
âˆ’10
âˆ’5
0
pâˆ’spline weibull pâˆ’spline weibull pâˆ’spline weibull
f_1
(a) Weibull hazard with Î± = 2
g_0
gamma
âˆ’20
âˆ’15
âˆ’10
âˆ’5
0
pâˆ’spline weibull pâˆ’spline weibull pâˆ’spline weibull
f_1
(b) linear baseline hazard
g_0
gamma
âˆ’20
âˆ’15
âˆ’10
âˆ’5
0
pâˆ’spline weibull pâˆ’spline weibull pâˆ’spline weibull
f_1
(c) bathtubâ€“shaped baseline hazard
Figure 2.9: Simulation: model comparison via boxplots of logâ€“MSEs.

56
2. Nonparametric regression for survival data
Weibull baseline with Î± = 2
âˆ’6
âˆ’4
âˆ’2
0
2
4
g_0(t)
0
1
2
3
4
t
âˆ’6
âˆ’4
âˆ’2
0
2
4
g_0(t)
0
1
2
3
4
t
linear baseline
âˆ’6
âˆ’4
âˆ’2
0
2
4
g_0(t)
0
1
2
3
4
t
âˆ’6
âˆ’4
âˆ’2
0
2
4
g_0(t)
0
1
2
3
4
t
bathtubâ€“shaped baseline
âˆ’2
âˆ’1
0
1
2
g_0(t)
0
1
2
3
4
5
6
7
8
t
âˆ’2
âˆ’1
0
1
2
g_0(t)
0
1
2
3
4
5
6
7
8
t
Figure 2.10:
Simulation: posterior mean estimates together with 95% credible intervals for the
logâ€“baseline eï¬€ects (solid line and grey shaded area) of run r, with r chosen such that MSEr(g0(t))
is the median of MSE1(g0(t)), . . . , MSE100(g0(t)) and the true logâ€“baseline (dashed line).

2.4 Simulation Study
57
Simulation setup II
To shed some light on the question what is lost and gained by applying a Pâ€“spline model
instead of a Weibullâ€“model in cases where the true baseline hazard is Weibull shaped and
not Weibull shaped, respectively, lifetimes Ti, i = 1, . . . , 1000 were generated according to
the hazard models
Î»i(t) = Î»0(t) Â· exp(Î³vi + f1(xi)) = Î»0(t) Â· exp (0.3vi + sin(xi)) ,
with v and x denoting a binary and a continuous covariate as in (2.15). The baseline
hazard Î»0(t) is once chosen to be a Weibull baseline with shape parameter Î± = 2, i.e.
Î»0(t) = Î± Â· tÎ±âˆ’1 = 2 Â· t
once to be a likewise monotonic, linear, but nonâ€“Weibull hazard rate given by
Î»0(t) = 0.25 + 2 Â· t
and once to be bathtubâ€“shaped according to the following equation
Î»0(t) =
(
0.75 Â· (cos(t) + 1.5) ,
t â‰¤2Ï€
0.75 Â· (1 + 1.5),
t > 2Ï€
i.e. the baseline hazard is assumed to be initially high, to decrease after some time and
increase again later on until the time t = 2Ï€, from where on the hazard stays constant.
Such bathtubâ€“shaped hazard rates appear quite frequently in survival time studies and
can not be comprehended with parametric approaches like the Weibull model.
While lifetimes Ti may be generated straightforward by drawing random numbers from
according Weibull distributions in the former case, i.e. Weibull distributions with shape
parameter Î± and scale parameter (1/ exp(0.3vi + sin(xi)))
1
Î±, a more elaborate simulation
technique is required for the second and third choice for the baseline hazard. Two possibil-
ities are for example given by the thinning method, a kind of rejection algorithm, where a
dominating hazard rate is required (see Lewis and Shedler, 1979) and the inversion method,
that is applicable in cases where the cumulative baseline hazard Î›0(t) and its inverse Î›âˆ’1
0 (t)
may at least be evaluated numerically (see e.g. Devroye, 1986 and Bender et al., 2005).

58
2. Nonparametric regression for survival data
With our simulation we used the inversion method, where lifetimes Ti are generated as
follows
Ti = Î›âˆ’1
0 (âˆ’log(Ui) exp(âˆ’0.3vi âˆ’sin(xi))) ,
with Ui randomly drawn from a standard uniform distribution, i.e. Ui âˆ¼U[0, 1]. As before
the censoring was done in a second step: We randomly selected a proportion of ca. 30% of
observations that were to be censored. Censoring variables Ci for these selected observa-
tions were then generated as i.i.d. draws from corresponding uniform U[0, Ti] distributions.
Again, keeping the predictor ï¬xed, 100 replications {T (r)
i
, C(r)
i , i = 1, ..., 1000} respec-
tively {(t(r)
i , Î´(r)
i ), i = 1, ..., 1000}, r = 1, ..., 100 of censored survival times were generated
with each of the three baseline hazards. Estimation was done with a cubic Pâ€“spline prior
with 20 equidistant knots for the logâ€“baseline eï¬€ect g0(t) and with a Weibull model with
a GA(0.01; 0.01)â€“prior on Î± as described in (2.11), respectively. A cubic Pâ€“spline prior
with 20 knots was also assumed for the nonparametric eï¬€ect of x and a diï¬€use prior was
assumed for the ï¬xed eï¬€ect of v.
Results: Pâ€“spline model versus Weibull model
The MSEs were calculated as described above and Figure 2.9 displays boxplots of the log-
arithmic MSEs. As before with the comparison between Pâ€“spline models and p.e.m.s the
MSEs of f1 and Î³ corresponding to the nonparametric eï¬€ect of the continuous covariate x
and the ï¬xed eï¬€ect of the binary covariate v are barely aï¬€ected by the choice of the prior
for the baseline hazard. However, as was to be expected the MSE of the logâ€“baseline
eï¬€ect g0(t) is smaller with the Weibull model in the case where the true baseline hazard
has a Weibull structure (Figure 2.9a)), but the MSE is smaller with the Pâ€“spline model in
case of Î»0(t) = 0.25 + 2 Â· t and the bathtubâ€“shaped baseline hazard (Figure 2.9 b) and c)).
Estimated logâ€“baseline hazards of replication r, with r chosen such that MSEr(g0(t)) is
the median of MSE1(g0(t)), . . . , MSE100(g0(t)) are displayed in Figure 2.10. Concerning
the simulation where the true baseline hazard has an exact Weibull structure, Figure 2.10
reveals that the Weibull model yields very good results for Ë†g0(t). The cubic Pâ€“spline model
also yields quite satisfactory results for the most part, but does not reï¬‚ect the steep increase
at the beginning (note that g0(0) = âˆ’âˆwith Weibull hazard rates), which is the main rea-
son for the discrepancy in MSE when compared to the Weibull model. Bayesian Pâ€“splines

2.5 Application
59
with locally adaptive variances as developed in the context of generalized additive models
in Lang and Brezger (2004) for functions with changing curvature (and highly oscillating
functions) might provide a solution. Here the global variance parameters Ï„ 2
j in equation
(2.9) are replaced by local variances Ï„ 2
j /Î´jm, where the weights Î´jm are additional hyperpa-
rameters. Regarding the linear nonâ€“Weibull shaped baseline hazard (Î»0(t) = 0.25 + 2 Â· t),
results are contrary to those the simulation with Weibull structure yields. While the cubic
Pâ€“spline model reï¬‚ects the shape of the logâ€“baseline satisfactorily, the true shape can by
deï¬nition not be reï¬‚ected correctly by the Weibull model, which heavily underestimates
the logâ€“baseline for very small values of t. The bathtubâ€“shaped baseline is again reï¬‚ected
rather suï¬ƒciently by the Pâ€“spline model, but also this structure can not at all be retrieved
with a Weibull model, which suggests a largely ï¬‚at baseline hazard with an increased risk
for very small values of t.
Conclusion
Altogether we come to the conclusion that the choice of the prior for the baseline hazard
does not seem to be very important in cases where the only interest is to gain information
on timeâ€“constant eï¬€ects of covariates. However, in cases where the baseline hazard is of
interest, we do not recommend to use a Weibull model since it is quite restrictive and only
outperforms the Pâ€“spline model in cases where the baseline hazard actually is Weibull
shaped. A ï¬‚exible estimation becomes even more important in cases where timeâ€“varying
eï¬€ects of covariates are to be examined.
2.5
Application
To illustrate our methods we present three applications to complex data sets with slightly
diï¬€erent requirements, with spatial information being given for the last data set only. The
examples arise from diï¬€erent ï¬elds, namely from the ï¬elds of credit risk, insurance and
biometrics.
Unless otherwise noted:
â€¢ timeâ€“varying as well as nonparametric eï¬€ects of continuous covariates are modelled

60
2. Nonparametric regression for survival data
by cubic Pâ€“splines with 20 knots,
â€¢ diï¬€use priors are assumed for ï¬xed eï¬€ect parameters,
â€¢ MRF priors are assumed for structured spatial eï¬€ects,
â€¢ unstructured (uncorrelated) random eï¬€ects are assumed to be i.i.d. Gaussian with
mean zero,
â€¢ the parameters of IG(a; b) hyperpriors for variance parameters are set to a = b =
0.001.
2.5.1
Overdraft credit risk
Our ï¬rst application is on overdraft credit data from a Swiss bank. The data comprises
information on the monthly account movements of 2891 debtors (companies) with date
of ï¬rst borrowing within the observation period, i.e. between June, 1999 and June, 2004.
Besides the date when the credit was ï¬rst granted (date), the observed credit duration
ti and the external covariate â€rate of unemploymentâ€ (unempl), the following continuous,
monthly varying covariates are given:
â€¢ tvb: transaction volume (receipts of payments, credit items etc.)/borrowings (aver-
aged over 5 months, restricted to values between 0 and 20)
â€¢ ndtl: number of days with transgressed credit limit
The question of interest is to analyze the inï¬‚uence of these covariates on the risk of default,
i.e. the risk that a debtor cannot repay his credit. There are only 69 (ca. 2.4%) defaults
observed, whereas 2109 credits (ca. 73%) are still existing at the end of the observation
period in June 2004. The remaining 713 credits (ca. 25%) are either repayed between
June 99 and June 2004 or sold to another bank. It is unknown which case is true and we
consider these 713 observations as well as the 2109 observations, where credits were still
existing in June 2004 as right censored and deï¬ne the indicator of nonâ€“censoring of debtor
i, i = 1, . . . , 3068 as follows:
Î´i =
(
1
default of debtor i
0
else

2.5 Application
61
Since all covariates are continuous, the hazard rate Î»i(t) is modelled as follows
Î»i(t) = exp(g0(t) + ftvb(tvbi) + funempl(unempli) + fndtl(ndtli) + fdate(datei)),
where the logâ€“baseline eï¬€ect g0(t) as well as all other eï¬€ects are modelled by Pâ€“splines.
Since the distribution of the number of days with transgressed credit limits is quite leftâ€“
skew, the position of the 20 knots was chosen according to quantiles in the case of fndtl.
The estimated eï¬€ects are shown in Figure 2.11. It can be concluded that the logâ€“baseline
hazard rate is highest in the ï¬rst months after a credit is ï¬rst granted and is decreasing
almost linearly with time. The eï¬€ect of the covariate transaction volume/borrowings is
uâ€“shaped, meaning that low values near zero and high values near 20 lead to an increased
default risk. While it is quite perspicuous that debtors with a transaction volume that is
very low compared to their borrowings and a consequently low value of tvb are at a high
risk, it is less clear why the risk is increased with debtors with high values of tvb. A possible
explanation is that this eï¬€ect is caused by debtors that already have a bad credit history
and thus a reduced credit limit resulting in low borrowings and a therefor high value of tvb.
The eï¬€ect of the rate of unemployment is roughly linearly increasing, meaning that the risk
of default is rising with an increasing rate of unemployment. Furthermore we observe that
credits that were ï¬rst granted at the beginning of the observation period are at a higher
risk than credits granted in later years. This might either be due to an improved credit
risk management and a more restrictive credit policy or to the economic cycle. As was to
be expected the risk is rising with the number of days with transgressed credit limit, where
the increase is steepest in the beginning.
2.5.2
Long term care insurance
As a further illustration, we analyze data on survival time after entering long term care in-
surance (LTC) from a German private insurance company. The data was recorded between
April 1, 1995, when compulsory LTC insurance was introduced by the German government,
and December 31, 1998. It contains information on 5603 recipients of beneï¬ts from LTC
insurance. This data set has already been analyzed by Czado and Rudolph (2002), and
more details on the data set are given there. In a ï¬rst step, they analyzed the data with a
conventional Cox model with ï¬xed eï¬€ects of covariates and products of covariates. After

62
2. Nonparametric regression for survival data
a) logâ€“baseline eï¬€ect g0(t)
âˆ’8
âˆ’6
âˆ’4
âˆ’2
0
2
4
6
0
10
20
30
40
50
60
t
b) eï¬€ect of tvb
c) eï¬€ect of unempl
âˆ’8
âˆ’6
âˆ’4
âˆ’2
0
2
4
6
0
5
10
15
20
transaction volume/borrowings
âˆ’8
âˆ’6
âˆ’4
âˆ’2
0
2
4
6
1.5
2
2.5
3
3.5
4
4.5
rate of unemployment
d) eï¬€ect of date
e) eï¬€ect of ndtl
âˆ’8
âˆ’6
âˆ’4
âˆ’2
0
2
4
6
Jan 00
Jan 01
Jan 02
Jan 03
Jan 04
date
âˆ’8
âˆ’6
âˆ’4
âˆ’2
0
2
4
6
0
10
20
30
number of days with transgressed limit
Figure 2.11: Overdraft credit risk: posterior means together with pointwise 80% and 95%
credible intervals

2.5 Application
63
careful model diagnosis (and the inclusion of two dummyâ€“coded variables for modelling
deviations from linear eï¬€ects) they extended their Cox model to a model with timeâ€“varying
eï¬€ects, which were modelled through 0â€“1 step functions. Our analysis is based on their
ï¬nal model â€“ CR model for short. The covariates that are included are sex of claimant
(1=female, 0=male) and the following timeâ€“dependent covariates:
age(t) = age of claimant when a state transition occurs at time t,
nh(t) =
(
1
care in a nursing home at time t
0
care at home at time t
leveli(t) =
(
1
care at level i at time t, i = 2, 3
0
else,
with level1(t) as the reference category. Transition times between care levels and care
required (at home or in a nursing home) and dates of death or rightâ€“censoring are given
in day units. The three levels of care (and beneï¬ts) are deï¬ned as follows:
â€¢ Level 1: Care level 1 is reserved to persons in considerable need of LTC. They would
at least once a day require help for at least two activities in areas of personal hygiene,
nutrition or mobility. They would also need help several times a week with household
chores. Care level 1 can only be granted if the applicant needs help for at least 90
minutes a day, including 45 minutes of basic care.
â€¢ Level 2: Care level 2 is earâ€“marked for persons in severe need of LTC. They need
help at least three times a day with personal hygiene, eating or getting around. In
addition, they need help several days a week in housekeeping. In care level 2 the time
of help required must be at least 3 hours a day, of which 2 hours must be needed for
basic care.
â€¢ Level 3: Care level 3 is reserved to persons in extreme need of care. They require
roundâ€“theâ€“clock help every day, as well as household help several times a week. Care
level 3 demands that the applicant needs at least 5 hours help a day, including a
minimum of 4 hours of basic care.

64
2. Nonparametric regression for survival data
BPH
CR
mean
std. dev.
mean
std. dev.
level2
0.81
0.07
0.81
0.07
level3
1.71
0.07
1.75
0.07
sex Â· nh
-0.42
0.10
-0.44
0.10
level2 Â· nh
-0.33
0.15
-0.33
0.14
level3 Â· nh
-0.66
0.14
-0.67
0.14
Table 2.1: LTC data: posterior means and standard deviations for ï¬xed eï¬€ects
The exact date of ï¬rst receipt of beneï¬ts is given for every claimant. In most cases this
date is prior to April 1, 1995, i.e. most of the observations are left truncated (ca. 70%).
Furthermore, about 60% of the observations are right censored.
As a start we apply a Bayesian multiplicative proportional hazard (BPH for short)
model Î»(t) = exp(Î·(t)) with predictor
Î·(t)
=
g0(t) + Î³l2 Â· level2(t) + Î³l3 Â· level3(t) +
fage(age) + fsex(age) Â· sex + fnh(age) Â· nh(t) +
Î³snh Â· (sex Â· nh(t)) + Î³l2nh Â· (level2(t) Â· nh(t)) + Î³l3nh Â· (level3(t) Â· nh(t))
Results for ï¬xed eï¬€ects are given in Table 2.1. The logâ€“baseline g0(t) and the main eï¬€ect of
age as well as the ageâ€“dependent eï¬€ects fsex(age) of sex and fnh(age) of nh are displayed in
Figure 2.12. Our results for the ageâ€“independent eï¬€ects are highly comparable to those of
the CR model. Although diï¬€erences concerning modelling of the ageâ€“dependent functions
lead to slightly diï¬€ering results, the ageâ€“dependent eï¬€ects are as well quite similar for the
most part.
We conclude from our results that the hazard rate is increased in the ï¬rst three to four
years of receiving beneï¬ts. The hazard is also increased for claimants receiving more care
(Level 2 and Level 3), but these main eï¬€ects decrease by ca. 40% for claimants living in
a nursing home. Furthermore, care in a nursing home seems to decrease the hazard rate
with young people, but increase the hazard risk in the case of elderly claimants. Compared
to male claimants, female claimants living in a nursing home have a lower hazard. The
main eï¬€ect of age increases almost linearly, while the interaction with sex is quite small.

2.5 Application
65
âˆ’1
0
1
2
g_0(t)
0
5
10
15
20
25
t
(a) BPH
âˆ’2
âˆ’1
0
1
2
ageâˆ’dependent effects
0
10
20
30
40
50
60
70
80
90 100 110
age
f_age
f_nh
f_sex
(b) BPH
âˆ’2
âˆ’1
0
1
2
ageâˆ’dependent effects
0
10
20
30
40
50
60
70
80
90 100 110
age
f_age
f_nh
f_sex
(c) CR
Figure 2.12: LTC data: posterior mean together with 80% and 95% credible intervals of the
centered logâ€“baseline eï¬€ect (a), main eï¬€ect of age (centered) and ageâ€“dependent eï¬€ects of
nh and sex for BPH (b) and CR (c)

66
2. Nonparametric regression for survival data
mean
std. dev.
sex Â· nh
-0.42
0.10
level2 Â· nh
-0.33
0.14
level3 Â· nh
-0.59
0.14
Table 2.2: LTC data, BNPH model: posterior means and standard deviations for ï¬xed
eï¬€ects
The latter is comparable with the ï¬xed eï¬€ect interaction (including two steps) of the CR
model only for age over 50 years.
Since Czado and Rudolph found out that the eï¬€ect of care level is timeâ€“dependent, we
modify our PHâ€“model to a nonproportional hazard (BNPH for short) model with predictor
Î·(t)
=
g0(t) + gl2(t) Â· level2(t) + gl3(t) Â· level3(t) +
fage(age) + fsex(age) Â· sex + fnh(age) Â· nh(t) +
Î³snh Â· (sex Â· nh(t)) + Î³l2nh Â· (level2(t) Â· nh(t)) + Î³l3nh Â· (level3(t) Â· nh(t)).
In contrast to the global logâ€“baseline hazard rate estimated with the BPH model the
logâ€“baseline hazard rate g0(t) and the eï¬€ect gl2(t) of level2 are now more or less timeâ€“
constant (compare Figure 2.13 a) and b)). Note that g0(t) is centered about zero, while
gl2(t) â‰ˆconst. = 0.74. This means that the timeâ€“variation in the eï¬€ect of level2(t) of the
CR model cannot be detected. The increased hazard for level3(t) for smaller t (Figure
2.13 c)) corresponds to a similar ï¬nding of the initial CR. A possible interpretation is that
this eï¬€ect is caused by individuals which are already in a bad health state and therefore
need level 3 care immediately at the beginning of LTC. The BNPH model with timeâ€“
varying eï¬€ects of level2 and level3 can be interpreted as a model with three separate
baseline eï¬€ects g0(t), g0(t) + gl2(t), g0(t) + gl3(t) for claimants needing care of level 1,2
or 3, respectively. The corresponding estimated curves are displayed in Figure 2.13 d). As
can be gathered form Figure 2.13 e) and Table 2.2 the remaining eï¬€ects are quite similar
to those the BPH model yields.

2.5 Application
67
âˆ’2
âˆ’1
0
1
2
3
4
g_0(t)
0
5
10
15
20
25
t
(a)
âˆ’2
âˆ’1
0
1
2
3
4
g_l2(t)
0
5
10
15
20
25
t
(b)
âˆ’2
âˆ’1
0
1
2
3
4
g_l3(t)
0
5
10
15
20
25
t
(c)
âˆ’2
âˆ’1
0
1
2
3
4
logâˆ’baseline effects
0
5
10
15
20
25
t
level 1
level 2
level 3
(d)
âˆ’2
âˆ’1
0
1
2
3
4
ageâˆ’dependent effects
0
10
20
30
40
50
60
70
80
90 100 110
age
f_age
f_nh
f_sex
(e)
Figure 2.13: LTC data, BNPH model: a)â€“c) posterior means together with 80% and 95%
credible intervals of timeâ€“dependent eï¬€ects, d) posterior means of logâ€“baseline eï¬€ects for
claimants needing care level 1, 2 and 3, respectively, d) posterior means of ageâ€“dependent
eï¬€ects

68
2. Nonparametric regression for survival data
2.5.3
Waiting times to CABG
As a third illustration we apply our methods to data from a study in London and Essex that
aims to analyze the eï¬€ects of area of residence and further individual speciï¬c covariates on
waiting times to coronary artery bypass graft (CABG). The data comprise observations for
3015 patients with deï¬nite coronary artery disease who were referred to one cardiothoracic
unit from ï¬ve contiguous health authorities. Waiting times from angiography to CABG
are given in days. Covariates are, among others, sex, age (in years), number of diseased
vessels (1, 2, 3), and the area of residence (one of 488 electoral wards).
The data were previously analyzed by Crook et al. (2003) who classiï¬ed waiting times
in months and applied discreteâ€“time survival methodology as described for example in
Fahrmeir and Tutz (2001, chap. 9). Here we apply continuousâ€“time geoadditive survival
models, with waiting times given in days as in the original data set. We analyzed and
compared a hierarchy of models, with model comparison based on the deviance information
criterion (DIC), developed in Spiegelhalter et al. (2002). Whilst a logâ€“baseline eï¬€ect is
included in any model, covariate eï¬€ects are only added gradually.
The (logâ€“)baseline
prior was assumed as a (logâ€“)piecewise exponential model with grid length â–³= 50 days
and, alternatively, as a cubic Pâ€“spline model with 20 knots. Table 2.3 gives values for ï¬t
(deviance) and complexity (eï¬€ective number of parameters pD) for a selected number of
models. A comparison between the two baseline speciï¬cations shows that the complexity
is quite alike, whereas the ï¬t is essentially better with the Pâ€“spline model than with the
p.e.m. The ranking of the models is the same as in Crook et al. (2003).
In the following we will present detailed results for the best models in terms of DIC.
Models 7 and 8 correspond to a continuousâ€“time model with hazard rate
Î»(t) = exp(g0(t) + fage(age) + fspat(ward) + Î³1sex + Î³2dv2 + Î³3dv3),
where g0(t) is the logâ€“baseline rate, fage(age) is the nonlinear eï¬€ect of age and fspat(ward)
is the structured spatial eï¬€ect. The remaining covariates are dummyâ€“coded: sex = 1 for
female, and sex = 0 for male, dv2 = 1 if the number of diseased vessels equals 2, dv2 = 0
else, and dv3 = 1 if the number of diseased vessels equals 3, dv3 = 0 else. For comparison
we also estimated model 8 with a Weibull prior (2.11) for the baseline hazard. The DIC
of this Weibull model is 15273, composed of a deviance of 15190 and pD=42. Accordingly
the p.e.m. and the Pâ€“splineâ€“model yield a lower DIC in spite of being less parsimonious.

2.5 Application
69
Table 2.3: Model comparison based on the DIC
Pâ€“splineâ€“model
p.e.m.
model speciï¬cation
dev.
pD
DIC
dev.
pD
DIC
1
g0(t)
15607
13
15632
15777
12
15800
2
g0(t)+R
15553
38
15630
15722
38
15798
3
g0(t)+MRF+R
15523
47
15616
15693
44
15782
4
g0(t)+MRF
15532
40
15611
15705
38
15780
5
g0(t)+fage+sex+dv2+dv3
15069
20
15108
15234
19
15273
6
g0(t)+fage+sex+dv2+dv3+R
14934
79
15092
15085
83
15251
7
g0(t)+GRF+fage+sex+dv2+dv3
15017
33
15082
â€“
â€“
â€“
8
g0(t)+MRF+fage+sex+dv2+dv3
14967
56
15079
15125
58
15241
9
g0(t)+MRF+fage+sex+dv2+dv3+R
14943
68
15078
15097
71
15240
10
g0(t)+MRF+fage+sex+g1(t)dv2+g2(t)dv3
14945
64
15073
15107
65
15237
Since the DIC is not improved substantially by adding a random (unstructured) spatial
eï¬€ect (indicated by the letter R in Table 2.3) we do not discuss model 9 in detail.
Since the distribution of the values of age is quite skew, it would be an interesting
alternative to choose a Pâ€“spline prior with knot positions according to quantiles, but we
used equidistant knots here, which is our standard choice. The spatial eï¬€ect fspat(ward)
is modelled through a MRF prior.
In the case of the Pâ€“spline model we alternatively
modelled the spatial eï¬€ect through a GRF prior with 100 knots (model 7). Although this
model is more parsimonious, the DIC is greater than with a MRF prior due to a greater
deviance. Since the data augmentation that has to be accomplished for the p.e.m. results
in an â€observation numberâ€ of more than 30000, a GRF prior would lead to a computation
time of several days, which is not very viable.
The nonproportional hazard model 10, which has the lowest DIC of all models we
compared, is a modiï¬cation of the geoadditive proportional hazard rate model 8, where
the ï¬xed eï¬€ects Î³2 and Î³3 of dv2 and dv3 are replaced by time varying eï¬€ects.
Inverse Gamma priors IG(0.001; 0.001) were routinely assumed for the variances, but
we also speciï¬ed uniform priors on standard deviations for comparison. The results were
quite alike (similar values of DIC and estimated eï¬€ects), but uniform priors tend to lead to a

70
2. Nonparametric regression for survival data
Table 2.4: Posterior mean estimates and standard deviations for the ï¬xed eï¬€ects on time to
CABG
eï¬€ect
Pâ€“spline m., GRF
Pâ€“spline m., MRF
p.e.m., MRF
Weibull m., MRF
sex
-0.04
(0.08)
-0.05
(0.08)
-0.04
(0.08)
-0.04
(0.08)
dv2
1.48
(0.10)
1.49
(0.10)
1.50
(0.10)
1.48
(0.10)
dv3
1.79
(0.09)
1.81
(0.09)
1.82
(0.09)
1.79
(0.10)
slightly better ï¬t coming along with a somewhat larger number of eï¬€ective parameters pD.
However, in contrast to our simulation study, we sometimes faced problems with mixing
of Markov chains with IG(Îµ, Îµ) priors with very small Îµâ€™s (like Îµ = 0.00000001) in the case
of the age eï¬€ect, which is presumably due to the skew distribution of the values of age
(i.e. the small number of young patients).
Table 2.4 contains estimation results for the ï¬xed eï¬€ects in models 7 and 8. While
the eï¬€ect of sex is nonsigniï¬cant, the eï¬€ects of two or three diseased vessels are clearly
signiï¬cant and show that waiting times are decreasing with increasing number of vessels.
These results correspond to the ï¬ndings of Crook et al. (2003). The nonparametric baseline
eï¬€ects in Figure 2.14 show an initially high, but strongly decreasing chance of CABG
immediately after diagnosis, followed by a slow increase between 150 and 450 days. Later,
the chance of being operated decreases. The overall pattern is similar to the results in
Crook et al. (2003), obtained with a discreteâ€“time model. However, with the Pâ€“spline
prior we get a distinctly smoother curve. The Weibull model also yields a sharp decline
in the ï¬rst days after diagnosis, however, due to the monotonicity of a Weibull baseline,
the slow increase between 150 and 450 days can not be detected. The eï¬€ect of age (Figure
2.14) is almost constant between 40 and 80 years and does not have signiï¬cant inï¬‚uence
on the waiting time. Also, the estimates under a piecewise exponential, a cubic Pâ€“spline
and a Weibull baseline prior are visually indistinguishable â€“ regardless of which prior is
chosen for the structured spatial eï¬€ect.
The maps in Figure 2.15 show the estimates for the structured spatial eï¬€ects and give
an impression of the spatially varying chance of CABG with green (red) areas indicating
an increased (decreased) eï¬€ect. Again, the estimates under a piecewise exponential and
a cubic Pâ€“spline baseline prior are visually nearly indistinguishable in the case of a MRF

2.5 Application
71
Pâ€“spline
MRF
âˆ’15
âˆ’13
âˆ’11
âˆ’9
âˆ’7
âˆ’5
g_0(t)
0
250
500
750
1000
t
âˆ’3
âˆ’2
âˆ’1
0
1
f_age(age)
20
30
40
50
60
70
80
90
age
p.e.m.
MRF
âˆ’15
âˆ’13
âˆ’11
âˆ’9
âˆ’7
âˆ’5
g_0(t)
0
250
500
750
1000
t
âˆ’3
âˆ’2
âˆ’1
0
1
f_age(age)
20
30
40
50
60
70
80
90
age
Pâ€“spline
GRF
âˆ’15
âˆ’13
âˆ’11
âˆ’9
âˆ’7
âˆ’5
g_0(t)
0
250
500
750
1000
t
âˆ’3
âˆ’2
âˆ’1
0
1
f_age(age)
20
30
40
50
60
70
80
90
age
Weibull
MRF
âˆ’15
âˆ’13
âˆ’11
âˆ’9
âˆ’7
âˆ’5
g_0(t)
0
250
500
750
1000
t
âˆ’3
âˆ’2
âˆ’1
0
1
f_age(age)
20
30
40
50
60
70
80
90
age
Figure 2.14:
Posterior mean estimate for the (logâ€“)baseline eï¬€ect including the intercept term
(left panel) and the (centered) eï¬€ect of age on time to CABG (right panel) together with 80%
and 95% credible intervals

72
2. Nonparametric regression for survival data
Pâ€“spline model, GRF
Pâ€“spline model, MRF
âˆ’0.5
0.5
0
âˆ’0.5
0.5
0
Figure 2.15:
Posterior mean estimates of the structured spatial eï¬€ect on time to CABG; the
estimates under the p.e.m. with a MRF prior are visually indistinguishable from those of the
Pâ€“spline model with MRF prior, and are therefore not shown here
Pâ€“spline model, GRF
Pâ€“spline model, MRF
Figure 2.16:
Posterior probabilities of the structured spatial eï¬€ects, with white (black) areas
indicating that at least 80% of the sample estimates were positive (negative)

2.5 Application
73
Pâ€“spline model
p.e.m.
âˆ’2
âˆ’1
0
1
2
3
4
5
0
100
200
300
400
500
600
700
800
900
1000
1100
t
dv1
dv2
dv3
âˆ’2
âˆ’1
0
1
2
3
4
5
0
100
200
300
400
500
600
700
800
900
1000
1100
t
dv1
dv2
dv3
Figure 2.17: (logâ€“)baseline eï¬€ects on time to CABG: posterior mean estimates for 1 diseased
vessel (dv1), 2 diseased vessels (dv2) and 3 diseased vessels (dv3)
prior. Also a Weibull prior yields virtually the same result (not shown). Predictably, the
GRF prior results in a smoother estimated spatial eï¬€ect than the MRF prior does, but
besides that the results are quite alike. Areas with increased chances are Chelmsford and
Malden in North Essex, while in areas around Harlow in North Essex and Walthamstow
and Chingford in North East London chances are lower, that means patients have to wait
longer for surgery. The maps in Figure 2.16 show posterior probabilities of these spatial
eï¬€ects.
White (black) areas indicate that at least 80 % of the sample estimates were
positive (negative). Remaining grey areas are considered as â€™nonsigniï¬cantâ€™. Striped areas
denote wards, where no patient was observed.
Model 10 with timeâ€“varying eï¬€ects g1(t) and g2(t) of dv2 and dv3 can be interpreted as
a model with three separate baseline eï¬€ects g0(t), g0(t)+g1(t), g0(t)+g2(t) for patients with
one, two or three diseased vessels, respectively. The corresponding estimated curves are
displayed in Figure 2.17 and indicate that the proportional hazards assumption is violated,
because the baseline eï¬€ect of patients with three diseased vessels crosses the two other
curves.

74
2. Nonparametric regression for survival data
Diï¬€erent choices for hyperpriors
In the following we exemplary present some additional results of model 8 that were obtained
with other choices of IG(a; b) priors. In addition to our standard choice a = b = 0.001 we
set a = b = 1e âˆ’08 and a = âˆ’0.5, b = 0 (i.e. uniform prior on the standard deviation).
Figure 2.18 exemplarily shows sampling paths of the ï¬rst and 19th parameter of each
vector Î²j, j = 0, age, spat corresponding to the logâ€“baseline eï¬€ect, the eï¬€ect of age and the
spatial eï¬€ect, respectively. Independently of the choice of the prior for the hyperparameters
the mixing is not optimal for the ï¬rst parameters of the parameterâ€“vector Î²0 corresponding
to the logâ€“baseline eï¬€ect. In accordance with our simulation study this might be due to the
usage of conditional prior proposals and the assumption of a global variance, since the eï¬€ect
is steeply dropping in the ï¬rst 100 days, but comparatively ï¬‚at elsewhere. Apart from that
we did not face problems with mixing or convergence in the case of IG(0.001; 0.001) and
IG(âˆ’0.5; 0) priors. However, in the case of an IG(1eâˆ’08; 1eâˆ’08) prior mixing properties
are poor for the ï¬rst parameters of the eï¬€ect of age, where we have sparse data since there
is only a very small number of young patients that suï¬€er from coronary artery diseases. As
shown in Figure 2.19 a) the estimated logâ€“baseline eï¬€ects g0(t) are not inï¬‚uenced by the
choice of the hyperprior. The same applies to the ï¬xed eï¬€ects as well as the spatial eï¬€ect.
Figure 2.19 b) however reveals a much smoother eï¬€ect with the IG(1e âˆ’08; 1e âˆ’08) prior
compared to the eï¬€ects the other two choices for the hyperpriors yield. But since credible
intervals are quite large, each estimated eï¬€ect is within the 95% credible interval of each
other estimated eï¬€ect of age.
We conclude that the results are in general quite insensitive regarding the choice of
nonâ€“informative hyperpriors. However, in situations where data are sparse IG(a; b) priors
with a and b close to zero might lead to poor mixing and are therefore not recommended.
2.6
Conclusion
Spatial extensions of statistical models for analyzing survival data will be of increasing
relevance because spatial smallâ€“area information is often available. Assessment of spatial
eï¬€ects on hazard or survivor functions is not only of interest in its own but can be quite
useful for detecting unobserved covariates which carry spatial information. In this chapter,

2.6 Conclusion
75
0
200
400
600
800
1000
5
7
9
g_0,a=b=0.001
iteration
Î²1
0
200
400
600
800
1000
5
7
9
g_0,a=b=1eâˆ’08
iteration
Î²1
0
200
400
600
800
1000
5
7
9
g_0,a=âˆ’0.5,b=0
iteration
Î²1
0
200
400
600
800
1000
âˆ’3
âˆ’1
g_0,a=b=0.001
iteration
Î²19
0
200
400
600
800
1000
âˆ’3
âˆ’1
g_0,a=b=1eâˆ’08
iteration
Î²19
0
200
400
600
800
1000
âˆ’3
âˆ’1
g_0,a=âˆ’0.5,b=0
iteration
Î²19
0
200
400
600
800
1000
âˆ’10
âˆ’4
0
f_age,a=b=0.001
iteration
Î²1
0
200
400
600
800
1000
âˆ’6
âˆ’2
f_age,a=b=1eâˆ’08
iteration
Î²1
0
200
400
600
800
1000
âˆ’15
âˆ’5
f_age,a=âˆ’0.5,b=0
iteration
Î²1
0
200
400
600
800
1000
âˆ’0.2
0.6
1.2
f_age,a=b=0.001
iteration
Î²19
0
200
400
600
800
1000
0.0
0.6
f_age,a=b=1eâˆ’08
iteration
Î²19
0
200
400
600
800
1000
âˆ’0.5
1.0
f_age,a=âˆ’0.5,b=0
iteration
Î²19
0
200
400
600
800
1000
âˆ’1.5
0.0
1.5
f_spat,a=b=0.001
iteration
Î²1
0
200
400
600
800
1000
âˆ’1.0
0.5
f_spat,a=b=1eâˆ’08
iteration
Î²1
0
200
400
600
800
1000
âˆ’1.0
0.5
f_spat,a=âˆ’0.5,b=0
iteration
Î²1
0
200
400
600
800
1000
âˆ’1.0
0.0
1.0
f_spat,a=b=0.001
iteration
Î²19
0
200
400
600
800
1000
âˆ’1.0
0.5
f_spat,a=b=1eâˆ’08
iteration
Î²19
0
200
400
600
800
1000
âˆ’1.0
0.5
f_spat,a=âˆ’0.5,b=0
iteration
Î²19
Figure 2.18: Selected sampling paths for parameters Î²j,1 and Î²j,19, j = 0, age, spat and diï¬€erent
choices for the parameters a and b of the IG(a; b) hyperpriors.

76
2. Nonparametric regression for survival data
âˆ’2
âˆ’1
0
1
2
3
g_0(t)
0
200
400
600
800
1000
1200
t
a=b=0.001
a=b=1eâˆ’08
a=âˆ’0.5,b=0
(a)
âˆ’1
âˆ’.5
0
.5
f_age
20
40
60
80
100
age
a=b=0.001
a=b=1eâˆ’08
a=âˆ’0.5,b=0
(b)
Figure 2.19: Estimated logâ€“baseline eï¬€ects g0(t) and eï¬€ects of age fage with diï¬€erent
speciï¬cations of IG(a; b) hyperpriors.
we have developed a ï¬‚exible class of nonparametric geoadditive survival models within a
uniï¬ed Bayesian framework for modelling and inference. Model choice is an important
area of ongoing research. A comparison of competing proposals in the context of ï¬‚exible
Bayesian event history models will be of considerable importance.

Chapter 3
Relative Survival Analysis
3.1
Introduction
Many clinical studies aim at identifying prognostic factors for disease speciï¬c mortality.
However, data on speciï¬c causes of death is often not available or not reliable (Percy et
al. (1981)) and thus it is not possible to diï¬€erentiate between cases of death that are
actually related to the disease of interest and those cases of death that are related to
other causes that are independent of this disease. Since the composition of patients in
a clinical study usually is quite heterogenous concerning covariates like age (which is the
main inï¬‚uencing factor for natural mortality), the natural mortality risk may diï¬€er heavily
between patients. Thus it might very well be the case that a higher number of deaths
is observed with older people although a disease is more likely to be lethal with younger
people. In such situations the Cox model is not suitable since therewith it is not possible to
distinguish whether a variable like sex or age has an eï¬€ect on disease speciï¬c mortality, on
natural mortality or on both. Consequently this model will deliver eï¬€ects that represent
some mixture of the eï¬€ects on natural and disease related mortality and may therefore be
misleading regarding the identiï¬cation of prognostic factors. Moreover, comparisons of the
results from diï¬€erent populationâ€“based prognostic studies are diï¬ƒcult due to diï¬€erences
in the natural mortality of the populations. A remedy to this problem is provided by a
relative survival analysis which allows for a correction for the eï¬€ect of other independent
causes of death by using the natural mortality in the underlying population as a reference.
Several models for relative survival analysis in a frequentist setting have been discussed

78
3. Relative Survival Analysis
in the literature.
Esteve et al. (1990) assume that the observed hazard for total mor-
tality is the sum of two hazards, namely the expected, natural mortality hazard and a
disease related mortality hazard. Whereas the ï¬rst component is obtained from exter-
nal sources the disease related hazard is estimated parametrically assuming a piecewise
constant baseline eï¬€ect and timeâ€“constant ï¬xed eï¬€ects of covariates. This approach was
extended by Bolard et al. (2001) and Giorgi et al. (2003) by allowing for timeâ€“varying
eï¬€ects, i.e. dropping the proportional hazards assumption. Bolard et al. (2001) consider
timeâ€“byâ€“covariate interactions originally proposed by Cox (1972) as well as piecewise pro-
portional hazards, developed by Moreau et al. (1985) for crude survival analysis.
The
drawbacks of these methods are that temporal variations in the eï¬€ects of covariates are
limited to preâ€“speciï¬ed parametric forms of interaction functions and stepâ€“functions on
preâ€“speciï¬ed time intervals, respectively. A more ï¬‚exible method is proposed by Giorgi et
al. (2003) who assume quadratic Bâ€“splines with two inner knots for the baseline eï¬€ect as
well as for timeâ€“varying eï¬€ects of covariates. In the Bayesian approach we present here
we extend the model of Esteve et al. (1990) by modelling the disease related hazard with
a ï¬‚exible geoadditive predictor that may include a logâ€“baseline eï¬€ect, nonlinear eï¬€ects of
continuous covariates and timeâ€“varying eï¬€ects modelled by Pâ€“splines, as well as a spatial
eï¬€ect, random eï¬€ects and the usual ï¬xed eï¬€ects.
The rest of this chapter is organized as follows. In Section 3.2 we describe models,
likelihood and priors for unknown functions and parameters.
Some comments on the
inference via MCMC are given in Section 3.3. To illustrate our approach we present an
application to data on the survival of women suï¬€ering from breast cancer in Section 3.4.
Reliability of our approach is veriï¬ed in Section 3.5 by means of a simulated data set with
known risk proï¬le.
3.2
Model, likelihood and priors
Consider rightâ€“censored survival data as described in Subsection 2.2.1 in which Ti now
denotes survival time of observation i until death of any cause, ti denotes the observed
survival time and Î´i denotes the censoring indicator. Following Esteve et al. (1990) we as-
sume that the hazard rate for total mortality Î»i(t, ai, covi) := Î»i(t) at time t after diagnosis
of an individual i with age ai at diagnosis and a vector of covariates covi = (zi, xi, si, vi)

3.2 Model, likelihood and priors
79
(possibly including age) is deï¬ned as the following sum of two hazards:
Î»i(t, ai, covi) := Î»i(t)
=
Î»e
i(ai + t, covsub
i
) + Î»c
i(t, covi)
(3.1)
=
Î»e
i(ai + t, covsub
i
) + exp (Î·i(t, covi))
The ï¬rst summand Î»e
i(ai + t, covsub
i
) represents the expected hazard for natural mortality
in a population and is obtained from mortality tables using external sources, i.e. there are
no unknown parameters involved here. This component depends only on age at time t after
diagnosis (i.e. ai + t) and covsub
i
, a subvector including those covariates in covi mortality
tables account for (usually sex and period). The second summand Î»c
i(t, covi) is the disease
related mortality hazard rate which is estimated from the data at hand. This component
is modelled by a ï¬‚exible, possibly geoadditive predictor as in (2.4). To simplify notation
the dependence on covsub
i
and covi, respectively will be suppressed in the following, i.e. we
deï¬ne Î»e
i(ai + t, covsub
i
) := Î»e
i(ai + t) and Î»c
i(t, covi) := Î»c
i(t). Depending on what kind of
covariates are given in covi, the predictor may be composed of the following summands:
Î·i(t, covi) := Î·i(t) = g0(t) +
p
X
j=1
gj(t)zij +
q
X
j=1
fj(xij) + fspat(si) + vâ€²
iÎ³ + bgi,
(3.2)
where g0(t) = log{Î»0(t)} is the (disease related) logâ€“baseline hazard, gj(t) are timeâ€“varying
eï¬€ects of covariates zj, fj(xj) is the nonlinear eï¬€ect of a continuous covariate xj, fspat(si)
is the (structured) eï¬€ect of a spatial covariate s, Î³ is the vector of linear eï¬€ects and bg is
a unitâ€“ or groupâ€“speciï¬c frailty or random eï¬€ect (see Subsection 2.2.1 for a more detailed
description).
Once more, for a interpretation of equation (3.1) one may say that the natural mortality
hazard Î»e
i covers the basic mortality risk a population is exposed to and the disease related
hazard Î»c
i models the excess mortality risk that patients are exposed to beyond the basic
risk due to the disease they suï¬€er from. From a statistical point of view Î»e
i is an additive
oï¬€set.
Under the assumption about noninformative censoring the likelihood is given by
L
=
n
Y
i=1
(Î»i(ti))Î´i Â· exp

âˆ’
Z ti
0
Î»i(u)du


80
3. Relative Survival Analysis
Inserting (3.1) results in
L
=
n
Y
i=1
(Î»e
i(ai + ti) + Î»c
i(ti))Î´i exp
ï£«
ï£­âˆ’
ti
Z
0
(Î»e
i(ai + u) + Î»c
i(u)) du
ï£¶
ï£¸
=
n
Y
i=1
(Î»e
i(ai + ti) + Î»c
i(ti))Î´i exp
ï£«
ï£­âˆ’
ti
Z
0
Î»c
i(u)du
ï£¶
ï£¸exp
ï£«
ï£­âˆ’
ti
Z
0
Î»e
i(ai + u)du
ï£¶
ï£¸,(3.3)
where the last factor does not depend on the parameters to be estimated.
Hence the
following proportionality holds
L
âˆ
n
Y
i=1
(Î»e
i(ai + ti) + Î»c
i(ti))Î´i exp

âˆ’
Z ti
0
Î»c
i(u)du

.
(3.4)
This formula only diï¬€ers from the likelihood of a crude survival model given in (2.5) by
the term Î»e
i(ai + ti).
Again, for deï¬ning priors and developing posterior analysis we can rewrite the observa-
tion model in generic matrix notation and represent the predictor Î· = (Î·1, . . . , Î·i, . . . , Î·n)â€²,
where Î·i := Î·i(ti), as
Î· = V Î³ + Z0Î²0 + . . . + ZmÎ²m.
(3.5)
See Subsection 2.2.1 for details. Then, to complete the Bayesian model formulation priors
for parameters and functions are assumed as described for the crude survival analysis in
Subsection 2.2.2, i.e. we assume diï¬€use priors for ï¬xed eï¬€ect parameters, i.i.d. Gaussian
priors for uncorrelated random eï¬€ects, Pâ€“splines for the baseline eï¬€ect, nonparametric ef-
fects of continuous covariates and timeâ€“varying eï¬€ects, Markov random ï¬eld (MRF) priors,
twoâ€“dimensional tensor product Pâ€“spline priors, or Gaussian random ï¬eld (GRF) priors
for structured spatial eï¬€ects and inverse Gamma hyperpriors for all variance components.
3.3
Markov chain Monte Carlo inference
As before in Section 2.3 let Î² = (Î²â€²
0, ..., Î²â€²
m)â€² denote the vector of all regression coeï¬ƒcients
in the generic notation (3.5), Î³ the vector of ï¬xed eï¬€ects, and Ï„ 2 = (Ï„ 2
0 , ..., Ï„ 2
m) the vec-
tor of all variance components. Full Bayesian inference is based on the entire posterior
distribution
p(Î², Î³, Ï„ 2 | data) âˆL(Î², Î³, Ï„ 2) p(Î², Î³, Ï„ 2).

3.3 Markov chain Monte Carlo inference
81
Due to the (conditional) independence assumptions, the joint prior factorizes into
p(Î², Î³, Ï„ 2) =
( m
Y
j=0
p(Î²j | Ï„ 2
j )p(Ï„ 2
j )
)
p(Î³),
where the last factor can be omitted for diï¬€use ï¬xed eï¬€ect priors. The likelihood L(Î², Î³, Ï„ 2)
is given by inserting (3.2) into (3.4). Note that the integral does not require integration
over the natural mortality hazard Î»e
i(ai + t) (which is ï¬x anyway), but just over the same
terms as before with the crude survival analysis, i.e. terms of the form
Ii =
Z ti
0
exp
 
g0(u) +
p
X
j=1
gj(u)zij
!
du,
where gj(t) = P Î²jmBm(t). As described in Section 2.3 we usually use the trapezoidal rule
to solve these integrals numerically.
Again, full Bayesian inference via MCMC simulation is based on updating full condi-
tionals of single parameters or blocks of parameters, given the rest of the data. Basically
all parameters are updated as described in Section 2.3. However, the calculation of the
means and precision matrices of the multivariate Gaussian distributions, that are used
within the IWLSâ€“MH algorithm to approximate the posterior of the parameter vectors Î²j,
which correspond to the timeâ€“independent functions fj(xj), as well as spatial eï¬€ects Î²spat,
ï¬xed eï¬€ects Î³ and random eï¬€ects b, is slightly more complex. Suppose we want to update
Î²j, with current value Î²c
j of the chain. Then a new value Î²p
j is proposed by drawing a
random vector from a multivariate Gaussian distribution with precision matrix and mean
P j = Zâ€²
jW (Î²c
j)Zj + 1
Ï„ 2
j
Kj,
mj = P âˆ’1
j Zâ€²
jW (Î²c
j)(Ëœy âˆ’ËœÎ·).
where ËœÎ·i = Î·i(ti) âˆ’fj(xij), W (Î²c
j) = diag(w1, . . . , wn) is the weight matrix for IWLS with
weights
wi
=
Î›c
i(ti) âˆ’Î»e
i(ai + ti)Î»c
i(ti)Î´i
Î»i(ti)2
obtained form the current state Î²c
j and with Î›c
i(ti) =
R ti
0 Î»c
i(u)du. The working observations
Ëœyi are given by
Ëœyi = Î·i(ti) + Î´iÎ»c
i(ti)/Î»i(ti) âˆ’Î›c
i(ti)
wi
.
See Appendix A2 for a detailed derivation of those quantities.

82
3. Relative Survival Analysis
3.4
Application
We illustrate our method by an application to data on breast cancer that was gathered in
the years from 1988 to 2002 by a cancer registry that covers the Hautâ€“Rhin â€™departmentâ€™
which is located in the north-east of France, adjacent to Germany and Switzerland. This
department has 3525 km2 and 707555 inhabitants (in 1999) and is partitioned into 377
municipalities. The largest distance between the centroids of two municipalities is about
95 kms. The data set contains 3726 cases of breast cancer diagnosed between January the
1st 1988 and January the 1st 1998. There were 1235 (â‰ˆ33%) deaths observed whereas
the causes of death are unknown. Observed lifetimes are given in days and range from 0
to 14 years, with a median of 6.4 years. Covariates are age at time of diagnosis (ranging
from 20.6 years to 87.1 years), date of diagnosis (ranging from 1988.0 (i.e. 01.01.1988) to
1998.0), area of residence (one of 377 municipalities) and number of metastases at the date
of diagnosis (no metastasis, one metastasis or more than one metastasis). This is part of
a data set that has been analyzed via crude survival analysis by Sauleau et al. (2006).
For comparison only we analyze the data with the crude survival model (2.3) although
this model does not account for natural mortality and is thus not appropriate to the data
at hand where causes of death are not available. Generally the speciï¬cation of the hazard
rate is given by
Î»i(t, covi)
=
exp(Î·i(t, covi))
(3.6)
covi
=
(ai, pi, si, meta1i, meta2i),
where t is time since diagnosis and covi is the vector of covariates with ai denoting the age
of patient i at date of diagnosis pi (period), si denoting the municipality patient i resides
in and the dummyâ€“coded covariates meta1i and meta2i denoting, whether patient i has
one metastasis and more than one metastasis, respectively.
A relative survival analysis should be more suitable and deliver better results. Therefore
we alternatively assume a composed hazard rate of the following structure
Î»i(t, covi)
=
Î»e
i(ai + t, pi + t) + exp(Î·i(t, covi))
(3.7)
covi
=
(ai, pi, si, meta1i, meta2i),
where Î»e
i(ai + t, pi + t) is the natural mortality rate of women of age ai + t at date pi + t
as recorded in mortality tables for the Hautâ€“Rhin department.
The second summand

3.4 Application
83
Î»c
i = exp(Î·i(t, covi) represents the disease related hazard rate and is modelled in the same
way as the hazard rate in (3.6).
A hierarchy of models is analyzed with both approaches and compared via the deviance
information criterion (DIC). Whilst a logâ€“baseline eï¬€ect g0(t) modelled by a cubic Pâ€“
spline prior with 20 knots is included in any model, covariate eï¬€ects are only included
gradually. Eï¬€ects fa(ai) and fp(pi) of continuous covariates are modelled by cubic Pâ€“splines
with 20 knots. Diï¬€use priors are assigned to the ï¬xed eï¬€ects Î³1 and Î³2 of the dummyâ€“
coded covariates meta1 and meta2. The structured spatial eï¬€ect fspat(si) is modelled by a
MRF prior which is our standard choice with areaâ€“level data. An unstructured (random)
spatial eï¬€ect bsi is included additionally or alternatively in some of the models. Table 3.1
gives values for ï¬t and complexity of a selected number of models according to the two
components of the deviance information criterion. Model I, which contains a structured
spatial eï¬€ect modelled by a MRFâ€“prior, the eï¬€ect of the number of metastases and the
eï¬€ect of age, yields a DIC of 9308 for the crude survival model with hazard rate (3.6) and
9249 for the relative survival model. Leaving out one or more of these eï¬€ects leads to a
larger DIC. As Table 3.1 shows the DIC is slightly reduced by the additional inclusion of a
period eï¬€ect. Models III and IV are versions of model II where the spatial eï¬€ect is modelled
by an unstructured (random) eï¬€ect bs and the sum of a structured and an unstructured
eï¬€ect, respectively. However, those models will not be discussed here since they do not
lead to an improvement in terms of DIC. Figure 3.1 displays the estimated nonparametric
eï¬€ects of model II with predictor
Î·i = g0(t) + fa(ai) + fp(pi) + fspat(si) + Î³1meta1 + Î³2meta2.
With the software BayesX all unknown functions are centered about zero, and an intercept
term is included in the parametric linear term for identiï¬ability reasons. For plotting, the
estimated eï¬€ects of age ai and period pi are all centered at the observed values, i.e.
3726
X
i=1
Ë†fa(ai) =
3726
X
i=1
Ë†fp(pi) = 0,
while the intercept is added to the logâ€“baseline eï¬€ects.
Hence it can be derived from
Figure 3.1(a) and (b) that the estimated global risk level is higher with the crude survival
model (since the logâ€“baseline eï¬€ect resulting from a crude survival analysis exceeds the

84
3. Relative Survival Analysis
logâ€“baseline eï¬€ect resulting from a relative survival analysis). This results from the fact
that the crude survival analysis delivers an estimation of the risk of dying of any cause,
whereas only the disease related excess mortality risk of breast cancer patients is estimated
by means of a relative survival analysis, where the natural mortality risk is accounted for
separately. Panels (a) and (b) further reveal that the crude survival analysis yields a fairly
constant logâ€“baseline eï¬€ect g0(t), whereas a relative survival analysis results in an eï¬€ect,
that is increasing in the ï¬rst two years and decreasing in the time between the third and
the 11th year after diagnosis. Presumably the decrease in risk is not reï¬‚ected in panel
(a) as not accounting for natural mortality that is increasing with time after diagnosis
(since patients are aging) might lead to a neutralization. The estimated eï¬€ects of age at
time of diagnosis exhibit an uâ€“shaped risk proï¬le and are displayed in panels (c) and (d).
While a crude survival analysis yields an increased risk for patients diagnosed with breast
cancer in their younger days, but a still much higher risk for those women diagnosed at
an age of more than 70 years, a relative survival analysis suggests that women diseased in
early life have the greatest risk. This result is in accordance with the fact that cancers are
often more aggressive with younger people. The diï¬€erences between the two approaches
were to be expected since older women have a higher natural mortality risk that is not
accounted for separately with the crude, but only with the relative survival analysis. As
displayed in panels (e) and (f) both approaches yield a higher risk for patients that were
diagnosed with breast cancer in earlier periods. This eï¬€ect might be explained by medical
progress. Figures 3.2 (a) and (b) display the values of the structured spatial eï¬€ect in each
municipality. The two approaches yield a similar spatial pattern, but it is more pronounced
with the relative survival analysis. The risk seems to be higher in the south of the region.
None of these eï¬€ects is signiï¬cant on a level of 95%, but a couple of regions exhibit eï¬€ects
that are signiï¬cant on a level of 80%, such as some regions in the northâ€“east that have
a lower risk (Figures 3.2(c) and (d)). The estimated parameters Ë†Î³1 and Ë†Î³2 for the ï¬xed
eï¬€ects of meta1 and meta2 are greater with the relative survival approach. In detail the
results are as follows:
crude
relative
Ë†Î³1
0.66
0.96
Ë†Î³2
2.23
2.74
meaning that compared to patients with no metastases the hazard rate is about 1.9 (9.3)

3.4 Application
85
crude survival
relative survival
Model
D(Â¯Î¸)
pD
DIC
D(Â¯Î¸)
pD
DIC
I
g0(t) + f(a) + fspat(s) + meta
9268
20
9308
9208
20
9249
II
g0(t) + f(a) + f(p) + fspat(s) + meta
9259
24
9307
9200
23
9246
III
g0(t) + f(a) + f(p) + bs + meta
9264
24
9312
9205
24
9253
IV
g0(t) + f(a) + f(p) + fspat(s) + bs + meta
9250
29
9308
9192
28
9248
V
g0(t) + f(a) + f(p) + fspat(s) + g(t) âˆ—meta
9239
28
9296
9187
27
9241
Table 3.1:
Deviance, eï¬€ective number of parameters pD and DIC for some of the models we
compare.
and 2.6 (15.5) times higher for patients with one (more than one) metastasis, respectively.
To investigate if the proportional hazards assumption is appropriate, the number of
metastases is included as a covariate with timeâ€“varying eï¬€ect in model II, i.e. the diseaseâ€“
related logâ€“hazard of model V is
Î»c
i = exp (g0(t) + meta1i Â· g1(t) + meta2i Â· g2(t) + fage(ai) + fp(pi) + fspat(si)) .
Here g0(t) is the logâ€“baseline eï¬€ect for patients without metastases, g0(t)+g1(t) corresponds
to the logâ€“baseline for patients with one metastasis and g0(t)+g2(t) for patients with more
than one metastasis. The timeâ€“dependent functions gk(t), k = 0, 1, 2 are modelled with
cubic Pâ€“spline priors with 20 knots. As displayed in Table 3.1 the DIC is reduced by
allowing for a temporal variation in the eï¬€ect of the number of metastases. The three
logâ€“baseline eï¬€ects are plotted in Figure 3.3 and reveal that the diï¬€erences in risk between
the patient groups seem to diminish with time after diagnosis. The logâ€“baseline eï¬€ect for
patients with more than one metastasis even crosses the other curves, but this result must
not be overâ€“interpreted since there are only 70 patients with more than one metastasis in
the study. The remaining estimated eï¬€ects of model V resemble the results of model II
and are not shown for this reason.

86
3. Relative Survival Analysis
âˆ’7
âˆ’6
âˆ’5
âˆ’4
âˆ’3
g_0(t)
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
t
(a) logâ€“baseline eï¬€ect g0(t)
âˆ’7
âˆ’6
âˆ’5
âˆ’4
âˆ’3
g_0(t)
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
t
(b) logâ€“baseline eï¬€ect g0(t)
âˆ’2
âˆ’1
0
1
2
f_age
20
30
40
50
60
70
80
90
age
(c) centered eï¬€ect of age
âˆ’2
âˆ’1
0
1
2
f_age
20
30
40
50
60
70
80
90
age
(d) centered eï¬€ect of age
âˆ’.5
0
.5
f_p
1988
1989
1990
1991
1992
1993
1994
1995
1996
1997
1998
period
(e) centered eï¬€ect of period
âˆ’.5
0
.5
f_p
1988
1989
1990
1991
1992
1993
1994
1995
1996
1997
1998
period
(f) centered eï¬€ect of period
Figure 3.1: Model II: Posterior means and pointwise 80% and 95% conï¬dence intervals for the
baseline eï¬€ect including the intercept term (a,b), the centered eï¬€ect of age (c,d) and the centered
eï¬€ect of period (e,f). Figures b,d and f result from a relative survival analysis.

3.4 Application
87
âˆ’0.25
0.25
0
(a)
âˆ’0.25
0.25
0
(b)
(c)
(d)
Figure 3.2: Model II: posterior means of the structured spatial eï¬€ect (MRF) and posterior
probabilities for a nominal level of 80%, where black denotes regions with strictly negative credible
intervals and white denotes regions with strictly positive credible intervals. Panels b) and d) result
from a relative survival analysis.

88
3. Relative Survival Analysis
âˆ’4
âˆ’3
âˆ’2
âˆ’1
0
1
2
3
4
logâˆ’baseline effects
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
t
no meta
1 meta
more than 1 meta
(a) crude survival
âˆ’4
âˆ’3
âˆ’2
âˆ’1
0
1
2
3
4
logâˆ’baseline effects
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
t
no meta
1 meta
more than 1 meta
(b) relative survival
Figure 3.3: Model V: posterior means of the logâ€“baseline eï¬€ects for patients with no metastases,
one metastasis and more than one metastasis (dots in the lowest, middle and highest row mark
observed lifetimes of patients with no metastases, one metastasis and more than one metastasis,
respectively)
3.5
Simulation
To verify the reliability of our relative survival model and to show that a model that
does not account for natural mortality can indeed be misleading concerning the eï¬€ects of
covariates in such cases where data on speciï¬c causes of death is not available, we simulate
an appropriate data set with known risk proï¬le. Survival times are generated according to
a hazard rate that is the sum of a natural hazard rate and a disease related hazard rate.
This data set is then analyzed with a crude survival model like in (2.3) and with a relative
survival model like in (3.1) and the results are compared subsequently.
As for the data generation we simulate survival times based on the covariates of our
real breast cancer data set, using known speciï¬cations for the baseline and the covariate
eï¬€ects that resemble the eï¬€ects estimated by the relative survival analysis of the real data
set. However, for the sake of simpliï¬cation we neither consider a spatial eï¬€ect nor a period
eï¬€ect. We ï¬rst simulate survival times for each subject and the censoring is done in a
second step. In detail, survival times Ti, i = 1, . . . , 3726, are generated according to the
following hazard rate model

3.5 Simulation
89
Î»i(t, ai, meta1i, meta2i)
=
Î»e
i(ai + t) + Î»c
i(t, ai, meta1i, meta2i)
=
Î»e
i(ai + t) + exp(g0(t) + fage(ai) + Î³1meta1i + Î³2meta2i),
where the natural hazard rate Î»e
i is chosen in order to resemble the natural mortality rates
used with the application, but only depends on ai + t, which is the age of individual i at
time t after diagnosis. In our application natural mortality also depends on calendar time,
but we did not consider this here. As illustrated in Figure 3.4(a) the natural hazard rate
is increasing exponentially with age at time t after diagnosis. The disease related hazard
rate Î»c
i depends on time t after diagnosis, the age at time of diagnosis ai, and the two
binary covariates meta1i and meta2i, which indicate whether an individual i has one and
more than one metastasis, respectively. As displayed in Figure 3.4(b) the disease related
logâ€“baseline g0(t) is increasing in the ï¬rst 2.5 years after diagnosis, decreasing in the time
span between 2.5 and 12 years and staying constant afterwards. In contrast to the natural
mortality risk, the eï¬€ect of age on the disease related risk is uâ€“shaped and highest with
patients diseased in early life, whereas it is less increased with the initially oldest patients
in the study, who are diagnosed with breast cancer at the age of 87 (Figure 3.4(c)). Finally
the disease related logâ€“hazard is increased by Î³1 = 0.95 and Î³2 = 2.75 for individuals with
one metastasis (meta1i = 1) and more than one metastasis (meta2i = 1), respectively.
Since the data used in our application were only gathered until the year 2002 we consider
all survival times exceeding the year 2002 as censored, i.e. observed survival times are given
by ti = min(Ti, 2002.0 âˆ’pi) with pi denoting the exact date of diagnosis observed in the
real data set. This mechanism results in a censoring rate of approximately 60% (compared
to approximately 67% with the real data set).
The data set generated in this way is initially analyzed with a crude survival model like
in (2.3) that does not distinguish between natural mortality and disease related mortality.
More precisely we wrongly assume a hazard rate as follows:
Î»i(t, ai, meta1i, meta2i)
=
exp(g0(t) + fage(ai) + Î³1meta1i + Î³2meta2i),
where the logâ€“baseline g0(t) and the ageâ€“eï¬€ect fage are modelled as cubic Pâ€“splines with 20
knots (with second order random walk smoothness priors and IG(0.001, 0.001) priors for

90
3. Relative Survival Analysis
0
.1
.2
.3
.4
.5
lambda_e
20
40
60
80
100
a_i+t
a) natural hazard rate against age
Î»e
i(ai + t) = exp ((ai + t âˆ’30)/10) /2500
âˆ’.75
âˆ’.5
âˆ’.25
0
.25
.5
.75
g_0(t)
0
2
4
6
8
10
12
14
t
b) disease related logâ€“baseline eï¬€ect
g0(t) =
(
0.5 Â· sin(t/3 + 0.75) âˆ’4 , t â‰¤4.5Ï€ âˆ’2.25
âˆ’4.5
, t > 4.5Ï€ âˆ’2.25
0
.5
1
1.5
f_age
20
40
60
80
a_i
c) disease related eï¬€ect of age at time of diagnosis
fage(ai) = ((ai âˆ’60)/35)2
Figure 3.4: Simulation: speciï¬cations for the natural hazard rate, the disease related logâ€“baseline
eï¬€ect and the disease related eï¬€ect of age at time of diagnosis

3.5 Simulation
91
the variance components) and Î³1 and Î³2 are ï¬xed eï¬€ects with diï¬€use priors. Expectedly
the estimated logâ€“baseline and the eï¬€ect of age do not reï¬‚ect the true disease related
eï¬€ects but rather present a mixture of the two eï¬€ects on natural mortality and disease
related mortality. The estimated logâ€“baseline eï¬€ect is increasing in the ï¬rst years after
diagnosis, but the subsequent decline is less steep than with the true logâ€“baseline eï¬€ect
(Figure 3.5(a)). While the disease related logâ€“baseline is decreasing between the 2.5th and
12th year after diagnosis, the natural mortality risk of each single patient is increasing
with time (since people are getting older) and these two eï¬€ects seem to kind of balance.
As can be seen from Figure 3.5(c) the crude survival model underestimates the risk for
women diagnosed with breast cancer in early years and overestimates the risk of women
diseased at an old age. Again, this high risk for older people results from the increasing
natural mortality risk that is not accounted for separately. Finally also the ï¬xed eï¬€ects of
the covariates meta1 and meta2 are not estimated correctly, but are rather underestimated
by Ë†Î³1 = 0.68 and Ë†Î³2 = 2.33 (with standard deviations of 0.05 and 0.13, respectively). This
underestimation is due to the fact that only a part of the cases of death (namely those
cases that are related to the disease) are in association with the number of metastases,
whereas the crude survival analysis estimates the average inï¬‚uence based on all cases of
death.
Now we reâ€“analyze the generated data set with a relative survival model as described
in (3.1). That is we assume a hazard rate as follows:
Î»i(t, ai, meta1i, meta2i)
=
Î»e
i(ai + t) + Î»c
i(t, ai, meta1i, meta2i)
=
exp
  ai+tâˆ’30
10

2500
+ exp(g0(t) + fage(ai) + Î³1meta1i + Î³2meta2i),
where the disease related hazard rate Î»c
i is modelled as the total hazard rate Î»i was modelled
before. However, the total hazard is now amended by the known natural mortality rate
Î»e
i in order to account for cases of death that are not related to the disease of interest. As
displayed in Figures 3.5(b) and (d) the true disease related logâ€“baseline and the eï¬€ect of
age are now estimated quite satisfactorily, even though the eï¬€ect of age is a bit too ï¬‚at
which might be due to the very small number of young patients. Also the ï¬xed eï¬€ects of
meta1i and meta2i are estimated quite well with Ë†Î³1 = 0.98 and Ë†Î³2 = 2.79 (with standard
deviations of 0.07 and 0.15, respectively).

92
3. Relative Survival Analysis
3.6
Conclusion
In summary it can be ascertained that the simulation supports the usefulness of the relative
survival approach since it yields results that are highly comparable to those of our appli-
cation. As the simulation has shown, a model that does not account for natural mortality
is not suitable for the identiï¬cation of prognostic factors for disease speciï¬c mortality in
cases where data on causes of death is not available since eï¬€ects of covariates on natural
mortality and eï¬€ects on disease speciï¬c mortality intermix and can not be separated easily
ex post.

3.6 Conclusion
93
crude survival
relative survival
âˆ’7
âˆ’6
âˆ’5
âˆ’4
âˆ’3
g_0(t)
0
2
4
6
8
10
12
14
t
(a) logâ€“baseline eï¬€ect g0(t)
âˆ’7
âˆ’6
âˆ’5
âˆ’4
âˆ’3
g_0(t)
0
2
4
6
8
10
12
14
t
(b) logâ€“baseline eï¬€ect g0(t)
âˆ’1
âˆ’.5
0
.5
1
1.5
2
f_age
20
40
60
80
age
(c) centered eï¬€ect of age
âˆ’1
âˆ’.5
0
.5
1
1.5
2
f_age
20
40
60
80
age
(d) centered eï¬€ect of age
Figure 3.5:
Simulation: posterior means (solid line) together with pointwise 80% and 95%
conï¬dence intervals and true disease related eï¬€ects (dashed lines) for the logâ€“baseline eï¬€ect
including the intercept term (a,b) and the centered eï¬€ect of age (c,d). Figures b and d result
from a relative survival analysis.

94
3. Relative Survival Analysis

Chapter 4
Multiâ€“state models
4.1
Introduction
In the previous chapters we described methods for analyzing data, where only one type of
event is considered. This chapter is concerned with extensions to more general event history
data, that is ascertained by observing individuals over time and contains information on
the times of occurrence of certain events and the types of events that occur.
In the simplest case one may distinguish between several distinct types of terminating
events, i.e. from a statistical point of view each event represents a transition from a transient
state to a certain absorbing state. Here just one transient state, but an arbitrary, ï¬nite
number of absorbing states may be considered. Models for this type of data are referred
to as competing risks models. In clinical studies, for example, the competing risks might
be the diverse causes of death.
The most general case that we discuss is given by continuousâ€“time multiâ€“state models.
Here the various events are considered as transitions from one state to another. A state
structure speciï¬es the diverse states (that might be absorbing or transient) and deï¬nes
which transitions are possible. Each individual may experience a certain number of events
over time, i.e. pass through the considered, possibly recurrent states, with transition times
being arbitrary and measured on a continuous timeâ€“scale. Hence we consider individual
counting processes instead of individual survival times. This type of data is for example
given in clinical studies where the interest lies in analyzing transitions between diï¬€erent
states of health. Note that survival data represent a special type of event history data

96
4. Multiâ€“state models
with just one type of event that is a transition from the only transient state to the only
absorbing state.
Multiâ€“state models are discussed widely in the literature. Andersen and Keiding (2002)
provide a good overview over multiâ€“state models with linear predictors in a frequentist set-
ting. Fahrmeir and Klinger (1998) propose a nonparametric multiplicative multiâ€“state haz-
ard model that allows to model nonlinear functional forms of covariates and timeâ€“varying
eï¬€ects, with estimation being based on penalized likelihoods and smoothing splines. While
several models for the analysis of spatially correlated survival data have been proposed
in recent publications, spatial models have received far less attention in the more general
setting of multiâ€“state models.
Within this chapter we will illustrate how the Bayesian methods presented in Chapter
2 for analyzing extended Cox models are carried forward to continuousâ€“time multiâ€“state
models.
We present an approach where the hazard or transition rates for the partic-
ular events are modelled via independent structured additive predictors each including
a nonparametrically modelled logâ€“baseline eï¬€ect as well as transitionâ€“speciï¬c eï¬€ects of
(timeâ€“independent or timeâ€“dependent) covariates with possibly linear, nonlinear, spatially
correlated, timeâ€“varying or random eï¬€ects. In principle diï¬€erent time scales, like e.g. time
since an individualâ€“speciï¬c initial point of time and duration in the current state could
be considered as basic times for the various transition rates of a multiâ€“state model. For
simpliï¬cation however, in what follows we consider time t since an individualâ€“speciï¬c ini-
tial point of time as the basic time scale with every transition rate, while other time scales
might be treated as timeâ€“dependent, but piecewise constant covariates.
The rest of this chapter is organized as follows. In Section 4.2 we will describe models,
likelihood and priors for unknown functions and parameters. In Section 4.3 we comment
on how the MCMC inference described in Section 2.3 for extended Cox models may be
utilized with multiâ€“state models. In Section 4.4 we illustrate our methods by applications
to medical data on structural valve degeneration (SVD) of biological prostheses where
reoperation and death without previous reoperation act as competing risks, and to sleepâ€“
electroencephalography data with multiple recurrent states of sleep.

4.2 Models, likelihood, priors and MCMC inference
97
4.2
Models, likelihood, priors and MCMC inference
Within this chapter we will present two alternative representations of multiâ€“state data. We
start oï¬€with a notation embedded in the counting process framework (Andersen, Borgan,
Gill and Keiding 1993), which is quite common with multiâ€“state data. The second notation
is more closely related to the representation of survival data as introduced in Subsection
2.2.1.
Consider n individuals and let Nhi, for h = 1, . . . , H, i = 1, . . . , n, denote the counting
processes for events of type h, where Nhi(t) is the number of observed type h events expe-
rienced by the ith individual up to time t. We assume that individual intensity processes
exist and have multiplicative structure
Î±hi(t) = Yhi(t)Î»hi{t; zhi(t), xhi(t), shi(t), vhi(t)},
(4.1)
where Yhi(t) are leftâ€“continuous 1â€“0 processes indicating whether or not individual i is
at risk of experiencing a type h event just before time t. The individual type h hazard
or transition rate Î»hi in (4.1) depends on t and on possibly transitionâ€“speciï¬c and timeâ€“
dependent covariates. As in (2.4), the covariate vector zhi(t) is assumed to have timeâ€“
varying eï¬€ects, xhi(t) consists of continuous covariates with possibly nonlinear eï¬€ects, shi
denotes a spatial location and vhi(t) comprises covariates with linear eï¬€ects. Note that
right censored survival data with lifetimes Ti, independent censoring times Ci, i = 1, . . . , n,
observed lifetimes ti = min(Ti, Ci), and censoring indicators Î´i are a special case with
h = 1, Ni(t) = I(Ti â‰¤t, Î´i = 1), Yi(t) = I(ti â‰¥t) and Î»i(t) as in (2.3) and (2.4).
The transition rate Î»hi(t) for individual i is assumed to follow a multiplicative model
Î»hi(t) := Î»hi(t; zhi(t), xhi(t), shi(t), vhi(t)) = exp(Î·hi(t)),
(4.2)
with the general form of the predictor given by
Î·hi(t) = gh0(t) +
p
X
j=1
ghj(t)zhij +
p+q
X
j=p+1
fhj(xhij(t)) + fh,spat(shi) + vâ€²
hi(t)Î³h.
(4.3)
Here gh0(t) = log (Î»h0(t)) is the logâ€“baseline eï¬€ect for transition h, ghj(t) are timeâ€“
varying eï¬€ects of covariates zhj(t), fhj(xhj(t)) is the nonlinear eï¬€ect of xhj(t), fh,spat is
the spatially correlated eï¬€ect of sh, and Î³h is the vector of usual linear ï¬xed eï¬€ects.

98
4. Multiâ€“state models
As a further extension, i.i.d. random eï¬€ects (also referred to as frailty eï¬€ects) and ran-
dom slopes could be introduced in (4.3), but we omit this here.
For given predictors
Î· = {Î·hi, h = 1, . . . , H, i = 1, . . . , n}, the individual likelihood Li(Î·) and the likelihood
L(Î·) are given by
Li(Î·)
=
H
Y
h=1
Z âˆ
0
Î»hi(s)dNhi(s) Â· exp

âˆ’
Z âˆ
0
Yhi(s)Î»hi(s)ds

(4.4)
L(Î·)
=
n
Y
i=1
Li(Î·).
Note that the ï¬rst integral in (4.4) always reduces to a sum because Nhi(s) is a step function.
Numerical problems arise in the evaluation of the second integral in (4.4). Again, only if
timeâ€“varying functions in the predictor are step functions, this integral also reduces to a
sum (compare Section 2.3). Otherwise numerical integration in form of the trapezoidal
rule is employed as illustrated in Figure 1.6 in Chapter 1.
An alternative formulation of the likelihood, that shows the close connection to survival
models more clearly, arises from considering multiâ€“state data where for each individual i
times of occurrences of certain events ti1, ti2, . . . , tini (as well as possibly a left truncation
time ti0) and Hâ€“dimensional eventâ€“type indicators Î´i1, Î´i2, . . . , Î´ini are given, that indicate
which type of event occurred and are deï¬ned as follows
Î´ikh =
(
1
individual i experienced a type h event at time tik
0
else
for k = 1, . . . , ni and h = 1, . . . , H. Note that Î´ini = (0, . . . , 0) if an observation is right
censored, i.e. if individual i is in a transient state at time tini but for some reason the
observation is discontinued at that point of time. Furthermore a state structure has to be
given that deï¬nes which state transitions are possible and hence deï¬nes the risk processes
Yhi(t). Via this kind of notation the individual likelihood may be alternatively written as
Li(Î·) =
H
Y
h=1
ni
Y
k=1
"
Î»hi(tik)Î´ikh Â· exp
(
âˆ’
Z tik
ti,kâˆ’1
Yhi(s)Î»hi(s)ds
)#
.
(4.5)
From this equation it can be seen how the likelihood of such a multiâ€“state model is mul-
tiplicatively composed of likelihood contributions of according survival models (for left
truncated data) where one of the H events is modelled at each.

4.3 Markov Chain Monte Carlo inference
99
As regards assumptions about priors for parameters and functions and hyperpriors for
variance components we may refer to Subsection 2.2.1 since we do not assume correla-
tions of any kind between transition rates and the priors do not depend on the type h
of transition (see Conclusion for a short discussion of this assumption). Hence with each
single transition rate may be proceeded as described in Chapter 2 for the hazard rate of
a survival model, i.e. each transitionâ€“speciï¬c logâ€“baseline eï¬€ect gh0 as well as every un-
known function fhj and ghj might for example be modelled via a Bayesian Pâ€“spline, while
diï¬€use priors are assumed for ï¬xed eï¬€ects parameters Î³h and MRF priors are our stan-
dard choice for structured spatial eï¬€ects fh,spat. In the framework of the generic notation
as described for survival models in (2.6), after reindexing we can represent the predictor
vectors Î·h=(Î·h1(t1,1), . . . , Î·h1(t1,n1), . . . , Î·hn(tn,1, . . . , Î·hn(tn,nn))â€² as
Î·h = VhÎ³h + Zh0Î²h0 + . . . + ZhmhÎ²hmh.
(4.6)
Priors for functions and spatial components are then deï¬ned by suitable design matrices
Zhj, h = 1, . . . , H, j = 0, . . . , mh, and a prior for each corresponding parameter vector Î²hj.
The general form of a prior for Î²hj is given by
p(Î²hj|Ï„ 2
hj)
âˆ
Ï„
âˆ’rhj
hj
exp
 
âˆ’1
2Ï„ 2
hj
Î²â€²
hjKhjÎ²hj
!
,
(4.7)
where Khj is an adequate precision or penalty matrix of rank(Khj) = rhj, shrinking
parameters towards zero or penalizing too abrupt jumps between neighboring parameters.
We assign inverse Gamma priors IG(ahj; bhj)
p(Ï„ 2
hj)
âˆ
1
(Ï„ 2
hj)ahj+1 exp
 
âˆ’bhj
Ï„ 2
hj
!
(4.8)
to all variances, with ahj = bhj = 0.001 being our standard choice.
4.3
Markov Chain Monte Carlo inference
As with survival models, full Bayesian inference via MCMC simulation is again based on
updating full conditionals of single parameters or blocks of parameters (each with para-
meters corresponding to the same transition rate Î»hi), given the rest of the data. For

100
4. Multiâ€“state models
updating the parameter vectors Î²hj, which correspond to the timeâ€“independent functions
fhj, as well as spatial eï¬€ects Î²spat
h
, which correspond to spatial functions fh,spat, ï¬xed eï¬€ects
Î³h and random eï¬€ects bh, we use the slightly modiï¬ed version of the MHâ€“algorithm based
on iteratively weighted least squares (IWLS) proposals, which is described in Section 2.3
and the Appendix, respectively, for survival models. The full conditional of a parameter
vector Î²hj with prior p
 Î²hj|Ï„ 2
hj

is for example given by
p(Î²hj|Â·)
âˆ
L(Î²hj) Â· p(Î²hj|Ï„ 2
hj)
=
n
Y
i=1
H
Y
Ëœh=1
ni
Y
k=1
"
Î»Ëœhi(tik)Î´ikËœh Â· exp
(
âˆ’
Z tik
ti,kâˆ’1
YËœhi(s)Î»Ëœhi(s)ds
)#
Â· p
 Î²hj|Ï„ 2
hj

âˆ
n
Y
i=1
ni
Y
k=1
"
Î»hi(tik)Î´ikh Â· exp
(
âˆ’
Z tik
ti,kâˆ’1
Yhi(s)Î»hi(s)ds
)#
Â· p
 Î²hj|Ï„ 2
hj

=
n
Y
i=1
ni
Y
k=1

Lhik
 Î²hj

Â· p
 Î²hj|Ï„ 2
hj

,
at which the second proportionality holds because the transition rates Î»Ëœhi, Ëœh Ì¸= h do not
depend on Î²hj.
Note that for Yhi = 1 the likelihood contribution Lhik has the same
structure as an individual likelihood contribution Li for a leftâ€“truncated survival time
(compare equations (1.6) and (2.5)). For Yhi = 0 it follows that Î´ikh = 0, since a type h
transition can only be observed if the individual is at risk for a type h transition, i.e. if
Yhi = 1. Hence Yhi = 0 implies that Lhik = 1. As a consequence of these insights IWLS
proposals for the parameter vectors Î²hj may be derived in the same manner as described in
Section 2.3 and the Appendix, respectively. Thus, a new value Î²p
hj is proposed by drawing
a random sample from a high dimensional multivariate Gaussian distribution q(Î²c
hj, Î²p
hj)
which is obtained from a quadratic approximation of the logâ€“likelihood by a second order
Taylor expansion with respect to the current value of the chain Î²c
hj. The precision matrix
and mean of this proposal distribution are given by
P hj = Zâ€²
hjW h(Î²c
hj)Zhj + 1
Ï„ 2
hj
Khj,
mhj = P âˆ’1
hj Zâ€²
hjW h(Î²c
hj)(Ëœyh âˆ’ËœÎ·h).

4.4 Application
101
Here, ËœÎ·h = Î·hâˆ’ZhjÎ²hj, W h(Î²c
hj) = diag(wh,1,1, . . . , wh,n,nn) is the weight matrix for IWLS
with weights calculated from the current state Î²c
hj as follows
whik =
Z tik
ti,kâˆ’1
Yhi(s)Î»hi(s)ds,
i = 1, . . . , n,
k = 1, . . . , ni.
The vector of working observations Ëœyh is given by
Ëœyh = Wâˆ’1
h (Î²c
hj)âˆ†h âˆ’1l + Î·h
with âˆ†h = (Î´1,1,h, . . . , Î´n,nn,h)â€². The proposed vector Î²p
hj is accepted as the new state of
the chain with probability
Î±(Î²c
hj, Î²p
hj) = min
 
1, p(Î²p
hj | Â·)q(Î²p
hj, Î²c
hj)
p(Î²c
hj | Â·)q(Î²c
hj, Î²p
hj)
!
.
For the parameters Î²hj corresponding to the functions gh0(t), ..., ghp(t) depending on
time t, we again adopt the computationally faster MHâ€“algorithm based on conditional
prior proposals, that only requires evaluation of the logâ€“likelihood, not of derivatives (see
Fahrmeir and Lang (2001a) for details).
The full conditionals for the variance parameters Ï„ 2
hj are (proper) inverse Gamma with
parameters
aâ€²
hj = ahj + 1
2rhj
and
bâ€²
hj = bhj + 1
2Î²â€²
hjKhjÎ²hj,
Updating can be done by simple Gibbs steps, drawing random numbers directly from the
inverse Gamma densities.
4.4
Application
4.4.1
Biological valve prostheses
Our ï¬rst application is on data from 455 patients who underwent biological mitral valve
replacement (MVR) at the German Heart Center in Munich between 1974 and 2000. This
data has been analyzed before by Kaempchen et al. (2003) and more details about the
medical background may be found therein. The aim of our analysis is to assess the inï¬‚uence
of several covariates on reoperation free survival, at which death and reoperation due to
a failure of the biological valve are considered as competing risks. The state structure of

102
4. Multiâ€“state models
this competing risks model is illustrated in Figure 4.1. Note that death after reoperation
is not of interest with this analysis and is therefore not considered. Within the observation
period 212 patients died without a previous reoperation and 125 patients had to undergo
a reoperation; the remaining 118 observations are rightâ€“censored.
Covariates that are
given include the sex and the age of patients at valve replacement as well as the diagnosis
(insuï¬ƒciency, narrowness or malformation of the mitral valve) and information on the
initial valve replacement, namely the date of implantation and whether or not an additional
aortocoronary venous bypass (ACVB) was accomplished. Including all the covariates, the
transition rates Î»ri (reoperation) and Î»di (death without previous reoperation) are modelled
as follows
Î»ri(t)
=
exp [gr0(t) + fr,age(agei) + fr,date(datei)
+Î³r1 Â· sexi + Î³r2 Â· diag1i + Î³r3 Â· diag2i + Î³r4 Â· acvbi]
Î»di(t)
=
exp [gd0(t) + fd,age(agei) + fd,date(datei)
+Î³d1 Â· sexi + Î³d2 Â· diag1i + Î³d3 Â· diag2i + Î³d4 Â· acvbi] ,
where t is time since valve replacement, gh0, h = r, d are the logâ€“baseline eï¬€ects, fh,age and
fh,date are nonlinear eï¬€ects of the age of a patient at valve replacement and of the date
of valve replacement, respectively. All of these possibly nonlinear eï¬€ects are modelled via
cubic Pâ€“splines with 20 knots. The remaining covariates are dummyâ€“coded: sex = 1 for
female, and sex = 0 for male, diag1 = 1 if the patient was diagnosed with an insuï¬ƒciency
of the mitral valve, diag1 = 0 else, diag2 = 1 if the patient was diagnosed with a
narrowness of the mitral valve, diag2 = 0 else and acvb = 1 if an additional ACVB
was accomplished, acvb = 0 else. Diï¬€use priors were assumed for the parameters Î³.
Figure 4.2 displays the estimated nonlinear eï¬€ects. Concerning the risk of a reoperation
we observe that the risk is highest between ca. 9.5 and 16.5 years after the initial valve
replacement, while it is lower in the ï¬rst 9.5 years and after 16.5 years of reoperation free
survival, at which conï¬dence intervals become quite broad for t > 20 years. The risk of
death without previous reoperation on the other hand is very high directly after the valve
replacement and is steeply decreasing within the ï¬rst 2 years and slowly increasing from
that time on. The initially high risk might arise from consequences of the operation or
incompatibilities, while the slow increase for t > 2 is due to aging. The eï¬€ect of age at

4.4 Application
103
survival without reoperation
reoperation
death
     
@
@
@
@
@
R
Î»r
Î»d
Figure 4.1:
State structure of the competing risks model for the analysis of reoperation free
survival after biological mitral valve replacement.
valve replacement turns out to be rather linear with both predictors. While the risk of a
reoperation is decreasing with increasing age it is vice versa with the risk of death without
previous reoperation. This result seems quite perspicuous. The lifespan of patients that
got a biological valve prostheses at the age of 80 or more, for example, is likely to be shorter
than the endurance of the valve prostheses. The date of the valve replacement does not
seem to have an inï¬‚uence on any of the two risks. In the ï¬rst instance this appears to be
very disappointing since it would mean there has been no medical progress within 26 years.
However, medical progress involved that over the years more and more patients with very
severe illnesses could be operated, that would not have been operated in earlier years since
there would have been no chances of success. Consequently the composition of patient
groups with respect to the severity of the illness is heterogeneous over the years. Hence
our result is likely to be due to the fact that the severity of the illness is not considered with
our analysis as it is only recorded with 116 out of those 455 patients. Concerning the ï¬xed
eï¬€ects we observe that an additional ACVB reduces the risk of a reoperation signiï¬cantly
on the basis of a 80% signiï¬cance level (Ë†Î³r4 = âˆ’1.32, with a standard deviation of 0.79),
while the remaining ï¬xed eï¬€ects are not signiï¬cant (compare Table 4.1).
4.4.2
Human sleep processes
Our second application is about analyzing human sleep processes. The data set arises from
recordings of electroencephalographic (EEG) data during one night taken for a group of 27

104
4. Multiâ€“state models
Î»r (â†’reoperation)
Î»d (â†’death)
âˆ’6
âˆ’4
âˆ’2
0
2
4
g_r0(t)
0
5
10
15
20
25
t [years]
(a) logâ€“baseline eï¬€ect
âˆ’6
âˆ’4
âˆ’2
0
2
4
g_d0(t)
0
5
10
15
20
25
t [years]
(b) logâ€“baseline eï¬€ect
âˆ’6
âˆ’4
âˆ’2
0
2
4
f_r,age
20
40
60
80
age
(c) eï¬€ect of age
âˆ’6
âˆ’4
âˆ’2
0
2
4
f_d,age
20
40
60
80
age
(d) eï¬€ect of age
âˆ’6
âˆ’4
âˆ’2
0
2
4
f_r,date
1975
1980
1985
1990
1995
2000
date
(e) eï¬€ect of date
âˆ’6
âˆ’4
âˆ’2
0
2
4
f_d,date
1975
1980
1985
1990
1995
2000
date
(f) eï¬€ect of date
Figure 4.2: MVR data: posterior mean together with 80% and 95% credible intervals of
the centered logâ€“baseline eï¬€ects (a) and (b), the eï¬€ects of age (c) and (d), and the eï¬€ects
of date (e) and (f) on the competing risks reoperation (left panel) and death (right panel).

4.4 Application
105
Î»r
Î»d
mean
std. dev.
mean
std. dev.
sex
0.17
0.22
-0.01
0.15
diag1
-0.29
0.25
0.14
0.18
diag2
0.07
0.23
-0.13
0.21
acvb
-1.32
0.79
0.11
0.20
Table 4.1: MVR data: posterior mean estimations of ï¬xed eï¬€ects Î³ together with standard
deviations.
patients at the Maxâ€“Planckâ€“Institut fÂ¨ur Psychiatrie in Munich. Sleepâ€“EEG data describe
the nocturnal sleep rhythm, usually classiï¬ed in several stages such as awake, nonâ€“rapid
eye movement (NREM) and rapid eye movement (REM). Such sleep states indicating the
depth of sleep are recorded every 30 seconds. In addition, secretion of several hormones is
measured every 10, 20 or 30 minutes. The hormone cortisol is for example supposed to be
interrelated with the sleep structure. Figure 4.3 exemplarily displays the processes of sleep
states and nocturnal cortisol secretion for two patients. Without any kind of smoothing
it is diï¬ƒcult to identify typical sleep patterns. Furthermore individualâ€“speciï¬c sleeping
customs must be considered in order to detect population eï¬€ects.
Besides a dynamic analysis of the transition intensities between the distinct states,
a main concern is to investigate the question whether high cortisol concentrations have
a positive eï¬€ect on the propensity to REM sleep, which has been hypothesized in simple
correlation and variance analyses. It is also of interest to allow this eï¬€ect to vary over night.
Due to the very low number of direct transitions from AWAKE to REM, we consider only
a somewhat reduced state structure, which is illustrated in Figure 4.4 and comprises the
following four types of events
h = 1
transition from AWAKE to SLEEP,
(AS)
h = 2
transition from SLEEP to AWAKE,
(SA)
h = 3
transition from REM to NREM,
(RN)
h = 4
transition from NREM to REM,
(NR)
where SLEEP implies REM and NREM sleep states. In principle it might be of interest

106
4. Multiâ€“state models
AWAKE
NREM
REM
state
0
2
4
6
8
 
0
50
100
150
200
cortisol [nmol/l]
0
2
4
6
8
time since sleep onset [hours]
AWAKE
NREM
REM
state
0
2
4
6
8
 
0
50
100
150
200
cortisol [nmol/l]
0
2
4
6
8
time since sleep onset [hours]
Figure 4.3: Individual sleep processes for two patients (i = 1 and i = 21, respectively) together
with the corresponding cortisol secretion.

4.4 Application
107
AWAKE
NREM
REM
-

Î»NR
Î»RN
?
6
SLEEP
Î»AS
Î»SA
Figure 4.4:
State structure for the analysis of human sleep processes.
to separately analyze the transitions AWAKE â†’REM, AWAKE â†’NREM and NREM
â†’AWAKE, REM â†’AWAKE, respectively, but our data pool is not suï¬ƒcient for such
a detailed analysis. In order to achieve some synchronization we take time t since sleep
onset as basic time scale.
For the analysis of the possibly timeâ€“varying eï¬€ect of high
cortisol secretion on the transition intensity from NREM to REM, we generate the timeâ€“
dependent dummy coded covariate ci(t), which takes the value one if the concentration
of cortisol is higher than 90 nmol/l at time t with patient i and the value zero otherwise.
Observed concentrations of cortisol range from 1 to 450 nmol/l, with 90 nmol/l being the
70% quantile. Based on the previous considerations, we analyze a multiâ€“state model with
the following four transition rates
Î»hi
=
exp (gh0(t) + bhi) ,
h = AS, SA, RN
Î»hi
=
exp (gh0(t) + ci(t) Â· gh1(t) + bhi) ,
h = NR
at which again cubic Pâ€“spline priors are assumed for the transitionâ€“speciï¬c logâ€“baseline
eï¬€ects gh0(t), h = AS, SA, RN, NR, as well as for the timeâ€“varying eï¬€ect of a high cortisol
level on the transition from NREM to REM gNR,1(t). The term bhi denotes transitionâ€“
and patientâ€“speciï¬c random eï¬€ects with i.i.d. Gaussian priors bhi âˆ¼N(0, Ï„ 2
hb).
Estimated results for the timeâ€“varying baseline eï¬€ects gh0(t) for the transitions h =

108
4. Multiâ€“state models
AS, SA, RN, NR and the timeâ€“varying eï¬€ect of a high cortisol level on the transition from
NREM to REM gNR,1(t) are displayed in Figure 4.5. As was to be expected the tendency to
fall asleep again is particularly low for patients who awake in the beginning and at the end
of the night, i.e. within the time spans t < 1 and t > 7, respectively. We further conclude
from our results that the propensity to fall asleep is notably high around t âˆˆ[2, 3.3] and
seems to have a local minimum around ï¬ve hours after sleep onset.
By contrast, the
tendency to wake up is roughly uâ€“shaped and rather high in the beginning and especially
high at the end of the night while it is lowermost around t âˆˆ[4, 6]. The intensity for
the transition from REM to NREM sleep is highest directly after sleep onset and is then
decreasing until t â‰ˆ4, increasing again until t â‰ˆ6 and staying rather constant from that
time on. Concerning the inverse transition from NREM to REM sleep, the logâ€“baseline
eï¬€ect gNR,0(t) marks the eï¬€ect for a low level of cortisol, while gNR,1(t) describes deviations
from this eï¬€ect if the level of cortisol is high, i.e. exceeds 90 nmol/l. In case the cortisol
level is low, the intensity for a transition from NREM to REM is initially very low, but
steeply increasing within the ï¬rst hour after initial sleep onset followed by some ups and
downs with peaks at t â‰ˆ1.3, t â‰ˆ3.0, t â‰ˆ4.9 and (possibly) t â‰ˆ7.8, i.e. we observe a cyclic
developing with two pronounced peaks in the ï¬rst half of the night and two poor peaks
in the second half of the night. Since high levels of cortisol appear very rarely within the
ï¬rst hours after sleep onset, the (pointwise) credible intervals for the timeâ€“varying eï¬€ect
gNR,1(t) of ci(t) become quite broad for t < 2. Hence we can not draw any conclusions for
this time span. Figure 4.5 f) however, which displays the timeâ€“varying eï¬€ect gNR,1(t) for
t > 4, exhibits an increased propensity to REM sleep for a time span around six hours after
sleep onset. This is to say that our analysis only supports the hypothesis posted above
(high cortisol concentrations have a positive eï¬€ect on the propensity to REM sleep) for a
time span around t âˆˆ[5.5, 6.8].
The estimated individualâ€“ and transitionâ€“speciï¬c random
eï¬€ects are displayed in Figure 4.6. There are several persons that show especially high or
low tendencies for one or more transitions. Patient i = 5 for example has an exceptionally
high tendency to awake, coming along with an exceptionally low tendency to fall asleep and
a low propensity to REM sleep. The individual sleep process of patient i = 5 is displayed
in Figure 4.7 and supports those results since it clearly diï¬€ers from the prevailing sleep
patterns as exemplarily displayed in Figure 4.3.

4.4 Application
109
âˆ’1.5
âˆ’1
âˆ’.5
0
.5
AS:g_0
0
2
4
6
8
time since sleep onset [hours]
(a) AWAKE â†’SLEEP
âˆ’.5
0
.5
1
1.5
SA:g_0
0
2
4
6
8
time since sleep onset [hours]
(b) SLEEP â†’AWAKE
âˆ’1
âˆ’.5
0
.5
1
1.5
RN:g_0
0
2
4
6
8
time since sleep onset [hours]
(c) REM â†’NREM
âˆ’15
âˆ’10
âˆ’5
0
5
NR:g_0
0
2
4
6
8
time since sleep onset [hours]
(d) NREM â†’REM
âˆ’30
âˆ’20
âˆ’10
0
10
NR:g_1
0
2
4
6
8
time since sleep onset [hours]
(e) NREM â†’REM
âˆ’3
âˆ’2
âˆ’1
0
1
2
NR:g_1
4
5
6
7
8
time since sleep onset [hours]
(f) NREM â†’REM
Figure 4.5:
Human Sleep Processes: Posterior mean estimates for the timeâ€“dependent eï¬€ects
gh0(t), h = AS, SA, RN, NR and gNR,1(t) together with 80% and 95% credible intervals.

110
4. Multiâ€“state models
âˆ’2
âˆ’1
0
1
AS:random effect
1
5
10
15
20
25
i
(a) AWAKE â†’SLEEP
âˆ’2
âˆ’1
0
1
SA:random effect
1
5
10
15
20
25
i
(b) SLEEP â†’AWAKE
âˆ’2
âˆ’1
0
1
RN:random effect
1
5
10
15
20
25
i
(c) REM â†’NREM
âˆ’2
âˆ’1
0
1
NR:random effect
1
5
10
15
20
25
i
(d) NREM â†’REM
Figure 4.6:
Human Sleep Processes: Posterior mean estimates (black dots) of the transitionâ€“
and individualâ€“speciï¬c random eï¬€ects bhi for h = AS, SA, RN, NR and i = 1, . . . , 27.
Grey
crosses denote signiï¬cance on a 95% level with -1: signiï¬cant negative eï¬€ect, 0: no signiï¬cant
eï¬€ect and +1: signiï¬cant positive eï¬€ect.

4.5 Conclusion
111
AWAKE
NREM
REM
state
0
2
4
6
8
time since sleep onset [hours]
Figure 4.7:
Individual sleep process for patient i = 5.
4.5
Conclusion
Within this chapter we have shown how the geoadditive survival models presented in Chap-
ter 2 are generalized to multiplicative continuousâ€“time multiâ€“state models. Our approach
allows the estimation of transitionâ€“speciï¬c nonlinear logâ€“baseline eï¬€ects as well as timeâ€“
varying eï¬€ects of covariates, nonlinear eï¬€ects of continuous covariates and an appropriate
consideration of unobserved unitâ€“ or clusterâ€“speciï¬c and spatial heterogeneity.
So far we have only considered transitionâ€“speciï¬c eï¬€ects and did not assume any corre-
lation structure between transition rates. With some applications however, it might make
sense to assume that unitâ€“ or clusterâ€“speciï¬c random eï¬€ects or structured spatial eï¬€ects
are correlated across (some or all) transition rates or are even transitionâ€“independent.
Extensions towards this aspect are topics of future work.

112
4. Multiâ€“state models

Chapter 5
Bayesian survival and multiâ€“state
analysis with BayesX: a tutorial
All models presented in this thesis are implemented in the statistical software package
BayesX. The focus of this chapter is to demonstrate how complex survival data and multiâ€“
state data may be analyzed within BayesX based on MCMC techniques. For this purpose
the estimation of some of the survival models presented in Subsection 2.5.3 to analyze
waiting times on CABG as well as the estimation of the relative survival model presented
in Section 3.5 on the basis of simulated breast cancer data, and the estimation of the
multiâ€“state model presented in Subsection 4.4.2 to analyze human sleep processes are
described in detail. For a description of the data sets we refer to the according subsections.
Note that in addition to MCMC techniques BayesX also provides restricted maximum
likelihood (REML) techniques as described in Kneib (2006) for the estimation of crude
survival models and multi state models.
This chapter is organized as follows. After some comments on the overall capabilities
of BayesX and the general structure of this software package given in Section 5.1 and in
Section 5.2, respectively, we start with the analysis in Section 5.3, which is concerned with
a description on how to create a dataset object to incorporate, handle and manipulate the
data. Since we want to estimate a spatial eï¬€ect of the ward with the CABG data, we need
the boundaries of the districts to compute the neighborhood information of the map of
London and Essex. This information will be stored in a map object. Section 5.4 describes
how to create and handle these objects. Estimation of the regression models is carried

114
5. Bayesian survival and multiâ€“state analysis with BayesX: a tutorial
out in Section 5.5 using bayesreg objects. Section 5.6 describes post estimation commands
which can be used to investigate the sampling paths and the autocorrelation functions of
the estimated parameters.
5.1
BayesX
BayesX is a public domain software package for performing complex full and empirical
Bayesian inference to estimate ï¬‚exible regression models with structured additive predic-
tors. Functions for handling and manipulating data sets and geographical maps, and for
visualizing results are added for convenient use. BayesX is available at
http://www.stat.uni-muenchen.de/~bayesx
An overview over the capabilities of BayesX is given in Brezger, Kneib and Lang (2005).
For more detailed information on all available features and the methodological background
see the manuals that are provided in addition to the software BayesX and the references
given therein.
5.2
Getting started
After having started BayesX, a main window with four subâ€“windows appears on the screen.
These are a command window for entering and executing code, an output window for
displaying results, a review window for easy access to past commands, and an object browser
that displays all objects currently available.
BayesX is object oriented although the concept is limited, i.e. inheritance and other
concepts of object oriented languages like C++ or Sâ€“plus are not supported. For every
object type a number of objectâ€“speciï¬c methods may be applied to a particular object.
The syntax for generating a new object in BayesX is
> objecttype objectname
where objecttype is the type of the object, e.g. dataset, and objectname is the name
to be given to the new object.

5.3 Dataset objects
115
5.3
Dataset objects
In a ï¬rst step we read the available data set information into BayesX. This is done by
creating three dataset objects named cabg, cancer and sleep for the CABG data, the
(simulated) breast cancer data and the human sleep data, respectively, by typing:
> dataset cabg
> dataset cancer
> dataset sleep
in the command window. We store the data in cabg, cancer and sleep using the method
infile. If the data is provided in the external ASCII ï¬les c:\data\cabg.raw, c:\data\
cancer.raw and c:\data\sleep.raw, respectively, we may type
> cabg.infile using c:\data\cabg.raw
> cancer.infile using c:\data\cancer.raw
> sleep.infile using c:\data\sleep.raw
Note, that this command supposes that the variable names are given in the ï¬rst row of
the according external ï¬le. In case the variable names are not given in the ï¬le we would
have to supply them right after the keyword infile. If a data set has more than 10000
observations it is recommended to set the option maxobs to the according number of rows.
This option allows BayesX to allocate enough memory to store all the data right from the
start, which speeds up the execution time of the infile command.
After having read in the data set information we can inspect the data visually. Exe-
cuting the command
> cabg.describe
for example opens an objectâ€“viewer window containing the according CABG data in form
of a spreadsheet. This can also be achieved by doubleâ€“clicking on the according dataset
object in the object browser.

116
5. Bayesian survival and multiâ€“state analysis with BayesX: a tutorial
Further methods allow to examine the variables in the dataset object. For a categorial
variable the tabulate command may be used to produce a frequency table and for con-
tinuous variables the descriptive command prints several characteristics of the variable
in the output window.
There are also methods to manipulate variables and generate new variables in a dataset
object. Assume for example that cagb includes the categorical variable numdv that takes the
values 1,2 and 3 and indicates the number of diseased vessels. Then the dummy variables
dv2 and dv3 that are used for the estimation may be created and added to cabg using
method generate. This might be done by executing the following commands
> cabg.generate dv2=0
> cabg.replace dv2=1 if numdv=2
> cabg.generate dv3=0
> cabg.replace dv3=1 if numdv=3
or in condensed form by executing the commands
> cabg.generate dv2=(numdv=2)
> cabg.generate dv3=(numdv=3)
Here (numdv=2) may be interpreted as the (rowâ€“wise) query â€is numdv equal to 2 or not?â€
(written as numdv==2 with some programming languages). Hence the ï¬rst command causes
BayesX to add a new covariate dv2 to the dataset object cabg, that takes the value TRUE
coded as 1 if the corresponding row of numdv equals 2 and the value FALSE coded as 0
otherwise.
5.4
Map objects
In the following we want to estimate a spatially correlated eï¬€ect of the ward a patient with
coronary artery disease lives. Therefore we need the boundaries of the wards in London and
Essex to compute the neighborhood information of the map of this part of Great Britain.
We therefore create a map object

5.4 Map objects
117
> map m
and read in the boundaries using the infile command of map objects:
> m.infile using c:\data\LondonEssex.bnd
Having read in the boundary information, BayesX automatically computes the neighbor-
hood matrix of the map. The ï¬le following the keyword using is assumed to contain the
boundaries in form of closed polygons. To give an example we print a small part of the
boundary ï¬le of London and Essex. The map corresponding to the section of the boundary
ï¬le can be found in Figure 5.1.
...
"8849",37
532351,181179
532407,181166
532404,181147
532399,181143
532399,181136
532409,181131
532412,181116
532418,181112
532424,181109
532446,181106
532446,181082
532463,181082
532511,181083
532532,181082
532528,181060
532530,181050
532558,181064
532579,181072
532572,181051
532571,181045
532563,181013
532561,180999
532608,180984
532589,180926
532502,180952
532491,180920
532445,180932
532448,180959
532450,180969
532383,180991

118
5. Bayesian survival and multiâ€“state analysis with BayesX: a tutorial
532373,180941
532345,180944
532310,180952
532320,181015
532324,181059
532350,181163
532351,181179
...
For each region of the map the boundary ï¬le must contain the identifying name of the
region, the number of vertices the polygon consists of and the vertices of the polygons that
form the boundary of the region. The ï¬rst line always contains the region code surrounded
by quotation marks and the number of vertices the polygon of the region consists of. Note
that the ï¬rst vertex (532351,181179 with our example) has to be repeated at the end to
obtain a closed polygon and hence the number of vertices of a pentagon would for example
be 6. The region code and the number of vertices must be separated by a comma. The
subsequent lines contain the vertices that are to be connected by straight lines and thus
form the boundary of the region. The vertices are represented by the according coordinates,
which must be separated by a comma. Compare Chapter 5 of the complete BayesX manual
for a detailed description of some special cases, e.g. regions divided into subregions.
Figure 5.1: Corresponding graph of the section of the boundary ï¬le
Map objects may be visualized using method describe:
> m.describe
resulting in the graph shown in Figure 5.2. Additionally, describe prints further infor-
mation about the map object in the output window including the name of the object, the
number of regions, the minimum and maximum number of neighbors and the bandwidth
of the corresponding adjacency or neighborhood matrix:

5.4 Map objects
119
MAP m
Number of regions: 488
Minimum number of neighbors: 1
Maximum number of neighbors: 14
Bandsize of corresponding adjacency matrix: 39
Figure 5.2: The wards of London and Essex.
The numerical complexity associated with the estimation of structured spatial eï¬€ects us-
ing MCMC techniques depends essentially on the structure of the neighborhood matrix.
Often the geographical information stored in a boundary ï¬le does not represent the â€idealâ€
ordering (as regards to the estimation problem) of the districts or regions. Therefore it
may be useful to reorder the map using method reorder:
> m.reorder
Usually reordering results in a smaller bandwidth although the bandwidth is not the cri-
terion that is minimized by reorder. Instead the envelope of the neighborhood matrix is
minimized (compare George and Liu, 1981).
In order to avoid reordering the map object every time you start BayesX it is useful
to store the reordered version in a separate ï¬le. This can be achieved using the outfile
command of map objects:
> m.outfile, replace using c:\data\LondonEssexSort.bnd

120
5. Bayesian survival and multiâ€“state analysis with BayesX: a tutorial
The reordered map is now stored in the given ï¬le. Note, that specifying the option replace
allows BayesX to overwrite an existing ï¬le with the same name. Without this option an
error message would be raised if the given ï¬le is already existing.
Reading the boundary information from an external ï¬le and computing the neighborhood
matrix may be a computationally intensive task if the map contains a large number of
regions or if the polygons are given in great detail. To avoid doing these computation
in every BayesX session, we store the neighborhood information in a soâ€“called graph ï¬le
using method outfile together with the graph option:
> m.outfile, replace graph using c:\data\LondonEssexSort.gra
For more information on graph ï¬les we refer to Chapter 5 of the complete BayesX manual.
5.5
Bayesreg objects
We start with a detailed description of the estimation of survival models presented in
Subsection 2.5.3 to analyze waiting times on CABG. The description of the estimation of
relative survival models presented in Section 3.5, and the description of the multiâ€“state
models presented in Subsection 4.4.2 to analyze human sleep processes follow thereafter.
5.5.1
Survival models
To estimate a survival model using MCMC techniques we ï¬rst create a bayesreg object
which we name surv_m8:
> bayesreg surv_m8
By default estimation results are written to the subdirectory output of the installation
directory. In this case the default ï¬lenames are composed of the name of the bayesreg
object and the type of the speciï¬c ï¬le. Usually it is more convenient to store the results
in a userâ€“speciï¬ed directory. To deï¬ne this directory we use the outfile command of
bayesreg objects:
> surv_m8.outfile = c:\data\m8

5.5 Bayesreg objects
121
Note, that outfile does not only specify a directory but also a base ï¬lename (the char-
acters â€™m8â€™ in our example). Therefore executing the command above leads to storage of
the results in the directory â€™c:\dataâ€™ and all generated ï¬lenames start with the characters
â€™m8â€™.
In addition to parameter estimates BayesX also gives acceptance rates for the diï¬€erent
eï¬€ects and some further information on the estimation process. In contrast to parameter
estimates this information is not stored automatically but is printed in the output window.
Therefore it is useful to store the contents of the output window. This can be achieved
automatically by opening a log ï¬le using the logopen command
> logopen, replace using c:\data\cabg_log.txt
After opening a log ï¬le, every information written to the output window is also stored in
this ï¬le. Option replace allows BayesX to overwrite an existing ï¬le with the same name
as the speciï¬ed log ï¬le. Without replace results are appended to an existing ï¬le.
Our dataset object cabg contains the imported variables ward (electorial ward a patient
resides in), time (time since diagnosis), delta (indicator of nonâ€“censoring), sex (1=male,
0=female), numdv (number of diseased vessels) and age (age of patient at time of diagnosis)
as well as the newly generated dummy variables dv2 and dv3. Models 7 and 8 presented
in Subsection 2.5.3 correspond to a continuousâ€“time survival model with hazard rate:
Î»(t) = exp(g0(t) + fage(age) + fspat(ward) + Î³1sex + Î³2dv2 + Î³3dv3),
The logâ€“baseline eï¬€ect g0 and the continuous covariate age are assumed to have a possibly
nonlinear eï¬€ect on the hazard and are therefore modelled nonparametrically via Pâ€“splines.
The eï¬€ect of the spatial covariate ward is assumed to be spatially correlated, at which model
7 assumes a GRF prior and model 8 assumes a MRF prior. Note that the neighborhood
matrix and possible weights associated with the neighbors are obtained from the map object
m (compare Section 5.4).
To estimate model 8 (MRF prior for the spatial eï¬€ect) we use method regress of bayesreg
objects:
> surv_m8.regress delta = time(baseline) + age(psplinerw2)
+ ward(spatial,map=m,proposal=iwlsmode) + sex + dv2 + dv3,
family=cox iterations=30000 burnin=10000 step=20 predict using cabg

122
5. Bayesian survival and multiâ€“state analysis with BayesX: a tutorial
Note that with family=cox BayesX expects the indicator of nonâ€“censoring (named delta
in our example) to be entered on the left side of the equals sign. This indicator has to
be a 0â€“1 coded variable taking the value 0 if an observation is censored and the value 1
otherwise. Furthermore a baseline term has to be entered on the right side of the equals
sign, which is modelled by a Pâ€“spline with second order random walk prior. Note that the
variable time which indicates the observed survival time has to be greater than zero. In
case the global option begin is not speciï¬ed after the comma, it is assumed that each row
in the data set represents an observation from t = 0 to t = time, i.e. no left truncation
and timeâ€“varying covariates are present. The eï¬€ect of age is also modelled by a Pâ€“spline
with second order random walk prior, which is speciï¬ed by psplinerw2. By default, the
degree of a spline is 3 and the number of inner knots is 20. Full details about all possible
options for Pâ€“splines are given in Section 7.1 of the BayesX reference manual. Concerning
the spatial covariate ward, the term spatial deï¬nes a MRF prior where the neighborhood
matrix is speciï¬ed via the option map. The additional option proposal may be used to
specify the type of proposal density, with proposal=iwlsmode indicating an iteratively
weighted least squares (IWLS) proposal based on posterior mode estimation (see Brezger
and Lang (2006) for details). With this example iwlsmode turned out to yield higher
acceptance rates than the IWLS proposal based on the posterior mean which would be
used by default.
Options iterations, burnin and step deï¬ne properties of the MCMCâ€“algorithm. The
total number of MCMC iterations is given by iterations while the number of burn in
iterations is given by burnin. Therefore we obtain a sample of 20000 random numbers
with the above speciï¬cations. Since, in general, these random numbers are correlated, we
do not use all of them but thin out the Markov chain by the thinning parameter step.
Specifying step=20 as above forces BayesX to store only every 20th sampled parameter
which leads to a random sample of length 1000 for every parameter in our example. With
iterations=30000 the simulation run time of model 8 is about 40 minutes (Pentium 4
CPU 2.8 GHz).
If option predict is speciï¬ed, samples of the unstandardized deviance, the eï¬€ective number
of parameters pD, and the deviance information criterion DIC of the model are computed,
see Spiegelhalter et al. (2002).
In addition, estimates for the linear predictor and the
expectation of every observation are obtained.

5.5 Bayesreg objects
123
For the estimation of model 7 (GRF prior with 100 knots for the spatial eï¬€ect) we enter
the commands
> bayesreg surv_m7
> surv_m7.outfile = c:\data\m7
> surv_m7.regress delta = time(baseline) + age(psplinerw2)
+ ward(geokriging,map=m,nrknots=100) + sex + dv2 + dv3,
family=cox iterations=30000 burnin=10000 step=20 predict using cabg
For clarity we created a new bayesreg object surv_m7 and speciï¬ed the base ï¬lename m7
by the outfile command. Note that using the bayesreg object surv_m8 without changing
the base ï¬lename would also be possible, but would lead to overwriting result ï¬les. With
iterations=30000 the simulation run time of model 7 is about 700 minutes (Pentium 4
CPU 2.8 GHz).
Recall the hazard rate of Model 10
Î»(t) = exp (g0(t) + fage(age) + fspat(ward) + Î³1sex + g1(t)dv2 + g2(t)dv3) ,
where the eï¬€ect of the number of diseased vessels is modelled as a timeâ€“varying eï¬€ect.
This model is estimated as follows
> bayesreg surv_m10
> surv_m10.outfile = c:\data\m10
> surv_m10.regress delta = time(baseline) + age(psplinerw2)
+ ward(spatial,map=m,proposal=iwlsmode) + sex
+ dv2*time(baseline) + dv3*time(baseline),
family=cox iterations=30000 burnin=10000 step=20 predict using cabg
The third command speciï¬es cubic Pâ€“spline priors for the timeâ€“varying eï¬€ects of the
dummy variables dv2 and dv3. With iterations=30000 the simulation run time of model
10 is about 70 minutes (Pentium 4 CPU 2.8 GHz).
To shed some light on the inï¬‚uence of diï¬€erent choices for hyperpriors we presented some
additional results of model 8 that were obtained with other choices of IG(a; b) priors. The
following command may for example be used to specify uniform priors on the standard
deviations (i.e. set a = âˆ’0.5 and b = 0)

124
5. Bayesian survival and multiâ€“state analysis with BayesX: a tutorial
> bayesreg surv_m8u
> surv_m8u.outfile = c:\data\m8_uniform
> surv_m8u.regress delta=time(baseline,a=-0.5,b=0)+age(psplinerw2,a=-0.5,b=0)
+ward(spatial,map=m,proposal=iwlsmode,a=-0.5,b=0)+sex+dv2+dv3,
family=cox iterations=12000 burnin=2000 step=10 predict using cabg
In case the options a and b are not speciï¬ed the parameters a and b are set to the default
values a = b = 0.001.
In addition to the information being printed to the output window results for each eï¬€ect
are written to external ASCII ï¬les. The names of these ï¬les are given in the output window.
By default the ï¬les contain the posterior mean and median, the posterior 2.5%, 10%, 90%
and 97.5% quantiles, and the corresponding 95% and 80% posterior probabilities of the
estimated eï¬€ects. The posterior quantiles and posterior probabilities may be changed by
the user using the global options level1 and level2.
The output window also contains information on how to visualize the estimation results.
For more details on visualizing estimation results we refer to Chapter 9 of the BayesX
reference manual.
Having ï¬nished the estimation we may close the log ï¬le by typing logclose. Note, that
the log ï¬le is closed automatically when you exit BayesX.
5.5.2
Relative survival analysis
To estimate the relative survival model presented in Section 3.5 we again start by creating
a bayesreg object by typing
> bayesreg rs
Note that we could also use the existing bayesreg object surv, but we prefer to create a
new one named rs for reasons of clarity. To store the results in the directory c:\data and
to specify rs as a base ï¬lename we enter the command
> rs.outfile = c:\data\rs
A log ï¬le where the contents of the output window are stored is then opened by

5.5 Bayesreg objects
125
> logopen, replace using c:\data\breastcancer_log.txt
The ï¬rst lines of the dataset object cancer are given by
time
delta
age
meta1 meta2 age_plus_time lambda_e
5.718018
0
46.6694
0
0
52.38742
.0037526
7.738525
0
50.91581
0
0
58.65434
.0070227
3.518052
1
63.14305
1
0
66.6611
.0156398
.5538804
1
78.95688
1
0
79.51076
.0565308
7.741333
0
80.16427
0
0
87.9056
.1308785
5.816528
0
82.85284
0
0
88.66936
.1412662
4.694092
0
83.3922
0
0
88.08629
.1332648
.9661008
1
83.95345
0
1
84.91956
.0970926
4.458618
0
80.96372
1
0
85.42234
.102099
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
where time is time t since diagnosis (in years), delta is the indicator of nonâ€“censoring,
which takes the value one if the patient died and the value zero if the observation is rightâ€“
censored. The covariate age denotes the age of the patient at time of diagnosis and the
dummy variables meta1 and meta2 indicate whether the number of metastases is one or
more than one, respectively. The variable age_plus_time is an auxiliary variable that
was used to generate the expected hazard rate. It is given by the sum of age and time
and denotes the age of the patient at the end of the observation, i.e. the age at death
or at the time, when the observation was rightâ€“censored. Finally, lambda_e denotes the
expected hazard rate, which with our example is given by lambda_e(age_plus_time) =
exp ((age_plus_time âˆ’30)/10) /2500. Note that a dataset object used for the estimation
of a relative survival model has to contain the expected hazard rate Î»e, that usually depends
on the age at death, the sex of a patient and possibly the date of death or further covariates.
Typically this variable will have to be generated in advance with the help of mortality
tables. Here it is important to consider that the observed survival time t and the hazard
rate Î»e refer to the same time unit. Mortality tables usually contain annual data. In that
case the survival times would have to be given in years as well.

126
5. Bayesian survival and multiâ€“state analysis with BayesX: a tutorial
The model presented in Section 3.5 corresponds to a relative survival model with hazard
rate:
Î»
=
Î»e(age, t) + Î»c(t, age, meta1, meta2)
=
Î»e(age + t) + exp(g0(t) + fage(age) + Î³1meta1 + Î³2meta2),
where the hazard rate is additively composed of the known expected hazard rate Î»e and
the unknown diseaseâ€“speciï¬c hazard rate Î»c. The logâ€“baseline eï¬€ect g0 and the continuous
covariate age are assumed to have a possibly nonlinear eï¬€ect on the (diseaseâ€“speciï¬c)
hazard and are therefore modelled nonparametrically via Pâ€“splines.
To estimate this model we again use method regress of bayesreg objects:
> rs.regress delta = time(baseline) + age(psplinerw2)
+ meta1 + meta2 + lambda_e(offest),
family=cox iterations=30000 burnin=10000 step=20 using rs
Note that the only diï¬€erence to the estimation of crude survival models as presented in the
previous subsection is the additional term lambda_e(offset), that is used to specify the
variable lambda_e as the expected hazard rate. With iterations=30000 the simulation
run time of this model is about 30 minutes (Pentium 4 CPU 2.8 GHz).
Again, additionally to the information being printed to the output window results for each
eï¬€ect are written to external ASCII ï¬les, with the names of these ï¬les being given in
the output window. Having ï¬nished the estimation we may close the log ï¬le by typing
logclose.
5.5.3
Multiâ€“state models
To estimate the multiâ€“state models presented in Subsection 4.4.2 we again start by creating
a bayesreg object by typing
> bayesreg ms
To store the results in the directory c:\data and to specify ms as a base ï¬lename we enter
the command

5.5 Bayesreg objects
127
id
identiï¬cation number of subject
beg
time of transition to the current state (admission time)
end
time of transition to the next state (emission time)
tas
1 a transition AWAKEâ†’SLEEP is observed at t = end
0 else
tsa
1 a transition SLEEPâ†’AWAKE is observed at t = end
0 else
trn
1 a transition REMâ†’NREM is observed at t = end
0 else
tnr
1 a transition NREMâ†’REM is observed at t = end
0 else
st
1 subject is currently in state AWAKE
2 subject is currently in state NREM
3 subject is currently in state REM
cort
cortisol level in nmol/l
Table 5.1: Original variables of the dataset object sleep.

128
5. Bayesian survival and multiâ€“state analysis with BayesX: a tutorial
> ms.outfile = c:\data\ms
A log ï¬le where the contents of the output window are stored is then opened by
> logopen, replace using c:\data\humansleep_log.txt
The original variables of the dataset object sleep are summarized and explained in Table
5.1. The additional dummy coded covariate corthigh, which indicates whether or not the
cortisol secretion is higher than 90 nmol/l is generated by typing
> sleep.generate corthigh = (cort>90)
Now the ï¬rst lines of the dataset object sleep are given by
id
st
beg
end
tas tsa trn tnr cort corthigh
1
2
0
1
0
1
0
0
52.6
0
1
1
1
5
1
0
0
0
52.6
0
1
2
5
8
0
1
0
0
52.6
0
1
1
8
10
1
0
0
0
52.6
0
1
2
10
36
0
0
0
0
52.6
0
1
2
36
76
0
0
0
0
46.9
0
1
2
76
108
0
0
0
1
47.5
0
1
3
108
109
0
0
1
0
47.5
0
1
2
109
110
0
0
0
1
47.5
0
1
3
110
111
0
0
1
0
47.5
0
1
2
111
115
0
0
0
1
47.5
0
1
3
115
116
0
0
0
0
47.5
0
1
3
116
126
0
0
1
0
37.4
0
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
Note that the states have to be numbered consecutively from 1 to H, at which numbers are
exchangeable. Since we are considering continuous time scales, an observation should start
at t = 0 (unless the observation is left truncated) and the variables beg and end should
be generated so that within each observation process beg equals the value of end in the
previous row (unless observations are fragmentary only).

5.5 Bayesreg objects
129
The transition rates of the multiâ€“state model analyzed in Subsection 4.4.2 are given by
Î»h
=
exp (gh0(t) + bh) ,
h = AS, SA, RN
Î»h
=
exp (gh0(t) + c(t) Â· gh1(t) + bh) ,
h = NR
This model is estimated with BayesX by entering the following command
> ms.mregress tas = end(baseline) + id(random):
tsa = end(baseline) + id(random):
trn = end(baseline) + id(random):
tnr = end(baseline) + corthigh*end(baseline) + id(random),
family=multistate begin=beg state=st iterations=30000 burnin=10000
step=20 using sleep
Note that the command regress used with the estimation of Cox models (and other
models with univariate response) is now replaced by the command mregress which is used
to analyze models with multivariate responses. With family=multistate BayesX expects
the speciï¬cation of at least two transitions separated by a colon, at which the corresponding
0â€“1 coded transition indicators are to be entered on the left side of the equals sign. With
the command above BayesX assumes cubic Pâ€“spline priors with 20 knots and second
order random walk priors for the logâ€“baseline eï¬€ects as well as the timeâ€“varying eï¬€ect of
corthigh, diï¬€use priors for the ï¬xed eï¬€ects of sex and i.i.d. Gaussian priors with mean
zero for each individual and transition speciï¬c random eï¬€ect. With iterations=30000
the simulation run time is about 160 minutes (Pentium 4 CPU 2.8 GHz). Concerning the
state structure, BayesX assumes that an observation with current state st is at risk of
experiencing a transition of type h if the data set contains at least one type h transition
with the accordant state st. For checking purposes the following matrix, that indicates
the number of type h transitions observed with every single state, is printed in the output
window.

130
5. Bayesian survival and multiâ€“state analysis with BayesX: a tutorial
Matrix of possible transitions:
Transition
1
2
3
4
State
1
460 0
0
0
2
0
399 0
306
3
0
77
234 0
Again, additionally to the information being printed to the output window results for each
eï¬€ect are written to external ASCII ï¬les, with the names of these ï¬les being given in
the output window. Having ï¬nished the estimation we may close the log ï¬le by typing
logclose.
5.6
Post estimation commands
Bayesreg objects provide some post estimation commands to get sampled parameters or to
plot autocorrelation functions of sampled parameters. For example
> surv_m8.plotautocor, maxlag=250
computes the autocorrelation functions for all parameters estimated with the regress
command (lastly) entered with the bayesreg object surv_m8. Here verb+maxlag+ speciï¬es
the maximum lag number.
If the number of parameters is large this may be computationally expensive, so BayesX
provides a second possibility to compute autocorrelation functions. Adding the option
mean to the plotautocor command as in
> surv_m8.plotautocor, mean
leads to the computation of only the minimum, mean and maximum autocorrelation
functions.
Note, that executing the plotautocor command also stores the computed autocorrelation
functions in a ï¬le named autocor.raw in the output directory of the bayesreg object.

5.6 Post estimation commands
131
To save memory, the sampling paths of the estimated parameters are only stored tem-
porarily by default and will be destroyed, when the corresponding bayesreg object is deleted.
If we want to store the sampling paths permanently, we have to execute the getsample
command
> surv_m8.getsample
which stores the sampled parameters in ASCII ï¬les in the output directory. To avoid
too large ï¬les, the samples are typically partitioned into several ï¬les.

132
5. Bayesian survival and multiâ€“state analysis with BayesX: a tutorial

Appendix A
Calculation of IWLS weights
A.1
Geoadditive survival analysis
In Subsection 2.3.1, which is concerned with Bayesian inference for geoadditive survival
models, we describe how to update parameter vectors corresponding to timeâ€“independent
eï¬€ects by an MHâ€“algorithm based on IWLS proposals. The IWLS weights wi and working
observations Ëœyi used with this algorithm are derived as follows.
As speciï¬ed in equation (2.4) the geoadditive predictor of our survival models is given by
Î·i(t) = g0(t) +
p
X
j=1
gj(t)zij +
q
X
j=1
fj(xij) + fspat(si) + vâ€²
iÎ³ + bgi.
Suppose for example we want to update the parameter vector Î²j = (Î²j1, . . . , Î²j,dj)â€² corre-
sponding to a timeâ€“independent function fj(xij), which is modelled by a Pâ€“spline. With
the generic notation of Subsection 2.2.1 this function may be written as
fj(xij) =
dj
X
m=1
Î²jmBm(xij) = ZjiÎ²j
with Bm denoting Bâ€“spline basis functions and Zji =
 B1(xij), . . . , Bdj(xij)

denoting the
iâ€“th row of the design matrix Zj introduced in Subsection 2.2.1. The predictor Î·i(t) and
the vector of predictors Î· = (Î·1(t1), . . . , Î·n(tn))â€², respectively, may now be rewritten as
Î·i(t) = ZjiÎ²j + ËœÎ·i(t),
Î· = ZjÎ²j + ËœÎ·

134
A. Calculation of IWLS weights
The following proportionality holds for the full conditional of Î²j
p(Î²j|Â·) âˆL(Î²j) Â· p(Î²j|Ï„ 2
j )
(A.1)
with the ï¬rst factor denoting the likelihood that depends among others upon Î²j and the
second factor denoting the prior of Î²j. The dependency of the likelihood on Î²j may be
expressed as follows
L(Î²j)
=
n
Y
i=1
Î»i(ti)Î´i Â· exp

âˆ’
Z ti
0
Î»i(u)du

=
exp
" n
X
i=1

Î´iÎ·i(t) âˆ’
Z ti
0
exp(Î·i(u))du
#
=
exp
" n
X
i=1

Î´i(ZjiÎ²j + ËœÎ·i(t)) âˆ’
Z ti
0
exp(ZjiÎ²j + ËœÎ·i(u))du
#
=
exp
" n
X
i=1
li(Î²j)
#
= exp

l(Î²j)

with li denoting the individual logâ€“likelihood. As speciï¬ed in equation (2.7), the general
form of a prior for Î²j is
p(Î²j|Ï„ 2
j ) âˆÏ„
âˆ’rj
j
exp

âˆ’1
2Ï„ 2
j
Î²â€²
jKjÎ²j

,
Suppose the current value of the chain is Î²c
j. Then a new value Î²p
j is proposed by drawing
a random vector from a multivariate Gaussian proposal distribution, which is obtain from
a quadratic approximation of the logâ€“likelihood by a second order Taylor expansion with
respect to Î²c
j given by
l(Î²p
j) â‰ˆl(Î²c
j) + (Î²p
j âˆ’Î²c
j)â€²s(Î²c
j) + 1
2(Î²p
j âˆ’Î²c
j)â€²H(Î²c
j)(Î²p
j âˆ’Î²c
j)
(A.2)
at which s and H are the score function and the Hessian matrix (with respect to Î²j),
respectively. Inserting (A.2) in (A.1) yields

A.1 Geoadditive survival analysis
135
p(Î²p
j|Â·)
âˆ
exp

l(Î²p
j) âˆ’1
2Î²â€²
j
Kj
Ï„ 2
j
Î²j

â‰ˆ
exp

(Î²p
j)â€²s(Î²c
j) + 1
2(Î²p
j)â€²H(Î²c
j)Î²p
j âˆ’(Î²p
j)â€²H(Î²c
j)Î²c
j âˆ’1
2(Î²p
j)â€²Kj
Ï„ 2
j
Î²p
j

=
exp

(Î²p
j)â€²s(Î²c
j) + 1
2(Î²p
j)â€²H(Î²c
j)Î²p
j âˆ’(Î²p
j)â€²H(Î²c
j)Î²c
j âˆ’1
2(Î²p
j)â€²Kj
Ï„ 2
j
Î²p
j

=
exp

âˆ’1
2(Î²p
j)â€²

âˆ’H(Î²c
j) + Kj
Ï„ 2
j

Î²p
j + (Î²p
j)â€²  s(Î²c
j) âˆ’H(Î²c
j)Î²c
j

which is proportional to a multivariate Gaussian distribution with precision matrix and
mean
Pj = âˆ’H(Î²c
j) + Kj
Ï„ 2
j
,
mj = (Pj)âˆ’1  s(Î²c
j) âˆ’H(Î²c
j)Î²c
j

.
(A.3)
For the calculation of Pj and mj we need to compute the score function s and the Hessian
matrix H. The score function s is given by
s(Î²j) =
 n
X
i
âˆ‚li(Î²j)
âˆ‚Î²j1
, . . . ,
n
X
i
âˆ‚li(Î²j)
âˆ‚Î²j,dj
!â€²
with
li(Î²j)
=
Î´i(ZjiÎ²j + ËœÎ·i(t)) âˆ’
Z ti
0
exp(ZjiÎ²j + ËœÎ·i(u))du
=
Î´iZjiÎ²j + Î´iËœÎ·i(t) âˆ’exp(ZjiÎ²j)
Z ti
0
exp(ËœÎ·i(u))du
and thus
âˆ‚li(Î²j)
âˆ‚Î²jm
=
Î´iZjim âˆ’Zjim exp(ZjiÎ²j)
Z ti
0
exp(ËœÎ·i(u))du
=
Î´iZjim âˆ’Zjim
Z ti
0
exp(Î·i(u))du
at which Zjim is the element in the iâ€“th row and mâ€“th column of the design matrix Zj.
Hence the score vector s(Î²j) is given by
s(Î²j) = Zâ€²
jâˆ†âˆ’Zâ€²
j Ëœ
W(Î²j)
(A.4)

136
A. Calculation of IWLS weights
at which âˆ†= (Î´1, . . . , Î´n)â€² and Ëœ
W = (w1, . . . , wn)â€² with
wi =
Z ti
0
exp(Î·i(u))du = Î›i(ti).
(A.5)
The Hessian matrix H is deï¬ned as follows
H(Î²j) =
 n
X
i=1
âˆ‚li(Î²j)
âˆ‚Î²jmâˆ‚Î²jk
!
m,k=1,...,dj
Computing the partial derivatives delivers
âˆ‚li(Î²j)
âˆ‚Î²jmâˆ‚Î²jk
= âˆ’ZjimZjik
Z ti
0
exp(Î·i(u))du
leading to
H(Î²j) = âˆ’Zâ€²
jW(Î²j)Zj
(A.6)
with the weight matrix W = diag(w1, . . . , wn) with wi as deï¬ned in (A.5).
Inserting (A.4) and (A.6) in (A.3) yields
Pj
=
Zâ€²
jW(Î²c
j)Zj + Kj
Ï„ 2
j
mj
=
(Pj)âˆ’1 
Zâ€²
jâˆ†âˆ’Zâ€²
j Ëœ
W(Î²c
j) + Zâ€²
jW(Î²c
j)ZjÎ²c
j

=
(Pj)âˆ’1Zâ€²
jW(Î²c
j)
 Wâˆ’1(Î²c
j)âˆ†âˆ’1l + ZjÎ²c
j

=
(Pj)âˆ’1Zâ€²
jW(Î²c
j)
 Wâˆ’1(Î²c
j)âˆ†âˆ’1l + Î· âˆ’ËœÎ·

=
(Pj)âˆ’1Zâ€²
jW(Î²c
j) (Ëœy âˆ’ËœÎ·)
with the nâ€“dimensional vector of working observations
Ëœy = Wâˆ’1(Î²c
j)âˆ†âˆ’1l + Î· =

Î·1(t1) + Î´1
w1
âˆ’1, . . . , Î·n(tn) + Î´n
wn
âˆ’1
â€²

A.2 Relative survival analysis
137
A.2
Relative survival analysis
As mentioned in Section 3.3 updating of parameter vectors Î²j corresponding to timeâ€“
independent eï¬€ects within a relative survival model is performed according to the same
principle as described above for crude survival models. However, as a consequence of the
slightly more complex likelihood the weights and working observations that are used within
the IWLSâ€“MH algorithm are slightly more complex as well. Using the results of (A.3) those
quantities are derived as follows.
For updating the parameter vector Î²j again consider the following decomposition of Î·i(t) =
log (Î»c
i(t)) and Î· = (Î·1(ti), . . . , Î·n(tn))â€², respectively
Î·i(t) = ZjiÎ²j + ËœÎ·i(t),
Î· = ZjÎ²j + ËœÎ·
With Î»i = Î»e
i + Î»c
i, where Î»e
i := Î»e
i(ai + ti) denotes the expected hazard and Î»c
i = Î»c
i(ti)
denotes the disease related hazard, it can be seen easily from (3.3) that the individual
logâ€“likelihood li(Î²j) is given by
li(Î²j)
=
Î´i log (Î»e
i + Î»c
i) âˆ’
Z ti
0
Î»e
i(ai + u)du âˆ’
Z ti
0
Î»c
i(u)du
=
Î´i log
 Î»e
i + exp
 ZjiÎ²j + ËœÎ·i(ti)

âˆ’
Z ti
0
Î»e
i(ai + u)du âˆ’
Z ti
0
exp
 ZjiÎ²j + ËœÎ·i(u)

du
=
Î´i log
 Î»e
i + exp
 ZjiÎ²j

exp (ËœÎ·i(ti))

âˆ’
Z ti
0
Î»e
i(ai + u)du âˆ’exp
 ZjiÎ²j
 Z ti
0
exp (ËœÎ·i(u)) du
Hence the partial derivative is given by
âˆ‚li(Î²j)
âˆ‚Î²jm
=
Î´i
Î»e
i + Î»c
i
Zjim exp
 ZjiÎ²j

exp (ËœÎ·i(ti))
âˆ’0 âˆ’Zjim exp
 ZjiÎ²j
 Z ti
0
exp (ËœÎ·i(u)) du
=
Î´iÎ»c
i
Î»e
i + Î»c
i
Zjim âˆ’Zjim
Z ti
0
Î»c
i(u)du

138
A. Calculation of IWLS weights
and thus we get
s(Î²j) = Zâ€²
jâˆ†âˆ’Zâ€²
j Ëœ
W
(A.7)
with âˆ†=

Î´1Î»c
1
Î»e
1+Î»c
1, . . . ,
Î´nÎ»c
n
Î»en+Î»cn
â€²
and Ëœ
W = ( Ëœw1, . . . , Ëœwn)â€² with
Ëœwi =
Z ti
0
Î»c
i(u)du = Î›c
i(ti)
(A.8)
By means of the quotient rule the elements of the Hessian matrix H are computed as
follows
âˆ‚li(Î²j)
âˆ‚Î²jmâˆ‚Î²jk
=
(Î»e
i + Î»c
i) âˆ‚Î´iÎ»c
iZjim
âˆ‚Î²jk
âˆ’Î´iÎ»c
iZjim
âˆ‚Î»e
i +Î»c
i
âˆ‚Î²jk
(Î»e
i + Î»c
i)2
âˆ’ZjimZjik
Z ti
0
Î»c
i(u)du
=
(Î»e
i + Î»c
i) Î´iZjimZjikÎ»c
i âˆ’Î´iÎ»c
iZjimZjikÎ»c
i
(Î»e
i + Î»c
i)2
âˆ’ZjimZjik
Z ti
0
Î»c
i(u)du
=
Î»e
iÎ´iZjimZjikÎ»c
i
(Î»e
i + Î»c
i)2
âˆ’ZjimZjik
Z ti
0
Î»c
i(u)du
=
Zjim
Î»e
iÎ»c
iÎ´i
(Î»e
i + Î»c
i)2Zjik âˆ’Zjim
Z ti
0
Î»c
i(u)duZjik
=
âˆ’Zjim
Z ti
0
Î»c
i(u)du âˆ’
Î»e
iÎ»c
iÎ´i
(Î»e
i + Î»c
i)2

Zjik
The Hessian matrix H may now be written as
H(Î²j) = âˆ’Zâ€²
jWZj
(A.9)
with W = diag(w1, . . . , wn) at which
wi = Ëœwi âˆ’
Î»e
iÎ»c
iÎ´i
(Î»e
i + Î»c
i)2 = Î›c
i(ti) âˆ’Î»e
iÎ»c
iÎ´i
Î»2
i
Inserting (A.7) and (A.9) in (A.3) yields the precision matrix and the mean of the Gaussian
proposal density for Î²p
j as well as the working observations Ëœy, which are derived as follows

A.2 Relative survival analysis
139
mj
=
(Pj)âˆ’1  s(Î²c
j) âˆ’H(Î²c
j)Î²c
j

=
(Pj)âˆ’1 
Zâ€²
jâˆ†âˆ’Zâ€²
j Ëœ
W(Î²c
j) + Zâ€²
jW(Î²c
j)ZjÎ²c
j

=
(Pj)âˆ’1Zâ€²
jW(Î²c
j)

Wâˆ’1(Î²c
j)âˆ†âˆ’Wâˆ’1(Î²c
j) Ëœ
W(Î²c
j) + ZjÎ²c
j

=
(Pj)âˆ’1Zâ€²
jW(Î²c
j)

Wâˆ’1(Î²c
j)

âˆ†âˆ’Ëœ
W(Î²c
j)

+ Î· âˆ’ËœÎ·

=
(Pj)âˆ’1Zâ€²
jW(Î²c
j) (Ëœy âˆ’ËœÎ·)
with Ëœy = (Ëœy1, . . . , Ëœyn), at which
Ëœyi = Î·i(ti) + Î´iÎ»c
i/Î»i âˆ’Ëœwi
wi
.

140
A. Calculation of IWLS weights

Bibliography
Andersen, P.K., Borgan, âˆ…., Gill, R.D., and Keiding, N. (1993), Statistical models based on
counting processes, New York: Springer.
Andersen, P.K., and Keiding, N. (2002), â€Multiâ€“state models for event history analysis,â€
Statistical Methods in Medical Research, 11, 91â€“15.
Banerjee, S., and Carlin, B.P. (2003), â€Semiparametric Spatiotemporal Frailty Modelling,â€
Environmetrics, 14, 523â€“535.
Banerjee, S., and Carlin, B.P. (2004), â€Parametric Spatial Cure Rate Models for Intervalâ€“
Cencored Timeâ€“toâ€“Relapse Data,â€ Biometrics, 60, 268â€“275.
Banerjee, S., Carlin, B.P., and Gelfand, A.E. (2004), Hierarchical Modeling and Analysis
for Spatial Data, Chapman and Hall/CRC, Boca Raton.
Banerjee, S., Wall, M. M., and Carlin, B. P. (2003), â€Frailty modeling for spatially corre-
lated survival data, with application to infant mortality in Minnesota,â€ Biostatistics,
4, 123â€“142.
Bender, R., Augustin, T., and Blettner, M. (2005), â€Generating survival times to simulate
Cox proportional hazards models,â€ Statistics in Medicine, 24, 1713â€“1723.
Besag, J. and Kooperberg, C. (1995), â€On Conditional and Intrinsic Autoregressions,â€
Biometrika, 82, 733â€“746.
Blossfeld, H.-P., Hamerle, A., and Mayer, K.U. (1989). Event History Analysis. Hillsdale,
N.J.: Lawrence Erlbaum Associates.
Bolard, P., Quantin, C., Esteve, J., Faivre, J., and Abrahamowicz, M. (2001), â€Mod-
elling timeâ€“dependent hazard ratios in relative survival: Application to colon cancer,â€
Journal of Clinical Epidemiology, 54, 986â€“996.

142
BIBLIOGRAPHY
Brezger, A., Kneib, T., and Lang, S. (2005), â€BayesX: Analysing Bayesian Semiparametric
Regression Models,â€ Journal of statistical software, Vol. 14, Issue 11. Open domain
software available from http://www.stat.uni-muenchen.de/~bayesx/.
Brezger, A., and Lang, S. (2006), â€Generalized structured additive regression based on
Bayesian Pâ€“splines,â€ Computational Statistics and Data Analysis, 50, 967â€“991.
Cai, T., and Betensky, R. A. (2003), â€Hazard Regression for Interval Censored Data with
Penalized Spline,â€ Biometrics, 59, 570â€“9.
Cai, T., Hyndman, R., and Wand, M. (2002), â€Mixed model-based hazard estimation,â€
Journal of Computational and Graphical Statistics, 11, 784â€“798.
Carlin, B. P., and Banerjee, S. (2002), â€Hierarchical Multivariate CAR Models for Spatioâ€“
Temporally Correlated Data,â€ In: Bayesian Statistics 7, eds. J.M. Bernardo et al.,
Oxford: Oxford University Press.
Cox, D.R. (1972), â€Regression models and life tables,â€ Journal of the Royal Statistical
Society, Series B, 34, 187â€“220.
Crook, A., Knorr-Held, L., and Hemingway, H. (2003), â€Measuring spatial eï¬€ects in time
to event data: a case study using months from angiography to coronary artery bypass
graft (CABG),â€ Statistics in Medicine, 22, 2943â€“2961.
Czado, C., and Rudolph, F. (2002), â€Application of survival analysis methods to longâ€“term
care insurance,â€ Insurance: Mathematics and Economics, 31 (3), 395â€“413.
De Boor, C. (2001), A practical guide to Splines, New York.
Devroye L. (1986), Nonâ€“uniform random variate generation, New York: Springer.
Eilers, P.H.C., and Marx, B.D. (1996), â€Flexible smoothing using B-splines and penalized
likelihoodâ€ (with comments and rejoinder), Statistical Science, 11 (2), 89â€“121.
Esteve, J., Benhamou, E., Croasdale, M., and Raymond, L. (1990), â€Relative Survival and
the estimation of net survival: elements for further discussion,â€ Statistics in Medicine,
9, 529â€“538.
Fahrmeir, L., and Klinger, A. (1998), â€A nonparametric multiplicative hazard model for
event history data,â€ Biometrika, 85(3), 581â€“592.

BIBLIOGRAPHY
143
Fahrmeir, L., and Lang, S. (2001a), â€Bayesian Inference for Generalized Additive Mixed
Models Based on Markov Random Field Priors,â€ Journal of the Royal Statistical So-
ciety, Ser. C, 50, 201â€“220.
Fahrmeir, L., and Lang, S. (2001b), â€Bayesian semiparametric regression analysis of mul-
ticategorical timeâ€“space data,â€ Annals of the Institute of Statistical Mathematics, 53,
11â€“30.
Fahrmeir, L., Lang, S.,Wolï¬€, J., and Bender, S. (2003), â€Semiparametric Bayesian Time-
Space Analysis of Unemployment Duration,â€ Journal of the German Statistical Society
(Allgemeines Statistisches Archiv), 87, 281â€“307.
Fahrmeir, L., and Tutz, G. (2001), Multivariate Statistical Modelling based on Generalized
Linear Models, Springerâ€“Verlag, New York.
Gamerman, D. (1997), â€Eï¬ƒcient Sampling from the Posterior Distribution in Generalized
Linear Models,â€ Statistics and Computing, 7, 57â€“68.
Gelfand, A.E., and Gosh, S.K. (1998), â€Model Choice: A Minimum Posterior Predictive
Loss Approach,â€ Biometrika, 85, 1â€“11.
Gelman, A. (2004), â€Prior distributions for variance parameters in hierarchical models,â€
provided by Economics Working Paper Archive at WUSTL in its series Econometrics
with number 0404001.
George, A. and Liu, J.W. (1981), Computer Solution of Large Sparse Positive Deï¬nite
Systems, Prenticeâ€“Hall.
Giorgi, R., Abrahamowicz, M., Quantin, C., Bolard, P., Esteve, J., Gouvernet, J. and
Faivre, J. (2003), â€A relative survival regression model using Bâ€“spline functions to
model nonâ€“proportional hazards,â€ Statistics in Medicine, 22, 2767â€“2784.
Gould, A., and Lawless, J.F. (1988), â€Estimation Eï¬ƒciency in Lifetime Regression Models
when Responses are Censored or Grouped,â€ Comm. Statist. Simul., 17, 689â€“712.
Henderson, R., Shimakura, S., and Gorst, D. (2002), â€Modeling Spatial Variation in
Leukemia Survival Data,â€ Journal of the American Statistical Assosiation, 97, 965â€“
972.
Hennerfeind, A., Brezger, A., and Fahrmeir, L. (2005), â€Geoadditive Survival Models: A
Supplement,â€ SFB 386 Discussion Paper 454, University of Munich. Available from
http://www.stat.uni-muenchen.de/sfb386/.

144
BIBLIOGRAPHY
Hennerfeind, A., Brezger, A., and Fahrmeir, L. (2005), â€Geoadditive Survival Models,â€
Journal of the American Statistical Association, Theory and Methods, to appear.
Ibrahim, J.G., Chen, M.H., and Sinha, D. (2001), Bayesian Survial Analysis. Springer
Series in Statistics, New York.
Kaempchen, S., Guenther, T., Toschke, M., Grunkemeier, G.L., Wottke, m., and Lange,
R. (2003), â€Assessing the beneï¬t of biological valve prostheses: cumulative incidence
(actual) vs. Kaplanâ€“Meier (actuarial) analysis,â€ European Journal of Cardioâ€“thoracic
Surgery, 23, 710â€“714.
Kalbï¬‚eich, J. and Prentice, R. (2002). The Statistical Analysis of Failure Time Data, 2nd
edition. Hoboken: John Wiley & Sons.
Kammann, E.E., and Wand, M.P. (2003), â€Geoadditive models,â€ Journal of the Royal
Statistical Society, Ser. C, 52, 1â€“18.
Klein, J.P. and Moeschberger, M.L. (2003). Survival analysis. Springer, New York.
Kneib, T. (2006). Mixed model based inference in structured additive regression. PhD thesis,
Dr. Hut Verlag.
Kneib, T. and Fahrmeir, L. (2004), â€A mixed model approach for structured hazard
regression,â€ SFB 386 Discussion Paper 400, University of Munich. Available from
http://www.stat.uni-muenchen.de/sfb386/, accepted for publication in the Scan-
dinavian Journal of Statistics.
Kneib, T. and Fahrmeir, L. (2005), â€Structured additive regression for multicategorical
space-time data: A mixed model approach,â€ Biometrics, to appear.
Knorrâ€“Held, L. (1999), â€Conditional Prior Proposals in Dynamic Models,â€ Scandinavian
Journal of Statistics, 26, 129â€“144.
KomÂ´arek, A., Lesaï¬€re, E., and Hilton, J.F. (2005), â€Accelerated failure time model for
arbitrarly censored data with smoothed error distribution,â€ Journal of Computational
and Graphical Statistics, 45, 726â€“745.
Lang, S., and Brezger, A. (2004), â€Bayesian Pâ€“splines,â€ Journal of Computational and
Graphical Statistics, 13, 183â€“212.
Lawless, J.F. (1982), Statistical Models and Methods for Lifetime Data. New York: Wiley.

BIBLIOGRAPHY
145
Lesaï¬€re, E., KomÂ´arek, A., and Declerck, D. (2004), â€An overview of methods for intervalâ€“
censored data with an emphasis on applications in dentistry,â€ Technical report 0453,
IAP network. Available from http://www.stat.ucl.ac.be/IAP.
Lewis, P. A. W. and Shedler, G. S. (1979), â€Simulation of nonhomogeneous Poisson
processes by thinning,â€ Naval Research Logistics Quarterly, 26, 403â€“414.
Li, Y., and Ryan, L. (2002), â€Modeling Spatial Survival Data Using Semiparametric Frailty
Models,â€ Biometrics, 58, 287â€“297.
Marx, B.D., and Eilers, P. (1998), â€Direct Generalized Additive Modeling with Penalized
Likelihood,â€ Computational Statistics and Data Analysis, 28, 193â€“209.
Percy, C.L., Stanek, E., and Gloeckler, L. (1981), â€Accuracy of cancer death certiï¬cates
and its eï¬€ect on cancer mortality statistics,â€ American Journal of Public Health, 71,
242â€“250.
Rue, H. (2001), â€Fast sampling of Gaussian Markov random ï¬elds,â€ Journal of the Royal
Statistical Society, Ser. B, 63, 325â€“338.
Sauleau, E.-A., Hennerfeind, A., Buemi, A., and Held, L. (2006), â€Age, period and cohort
eï¬€ects in Bayesian smoothing of spatial cancer survival with geoadditive models,â€
Statistics in Medicine, to appear.
Spiegelhalter, D.J., Best, N.G., Carlin, B.P., and van der Linde, A. (2002), â€Bayesian
measures of model complexity and ï¬tâ€ (with discussion and rejoinder), Journal of the
Royal Statistical Society, Ser. B, 64, 583â€“639.
Stein, M.L. (1999), Interpolation of spatial data. Some theory for kriging, Springer, New
York.
Sun, D., Tsutakawa, R.K. and Speckman, P.L. (1999), â€Posterior distribution of hierarchi-
cal models using CAR(1) distributions,â€ Biometrika, 86, 341â€“350.
Sun, D., Tsutakawa, R.K. and He, Z. (2001), â€Propriety of posteriors with improper priors
in hierarchical linear mixed models,â€ Statistica Sinica, 11, 77â€“95.
Thompson, W.A.,Jr. (1977), â€On the Treatment of Grouped Observations in Life Studies,â€
Biometrics, 33, 463â€“470.

146

LEBENSLAUF
Andrea Hennerfeind
geboren am 11. August 1976 in Freising
Schulbildung:
1982â€“1986
Grundschule St. Lantbert in Freising
1986â€“1995
Josefâ€“Hofmillerâ€“Gymnasium in Freising
(mathematischâ€“naturwissenschaftlich)
Studium:
1995â€“2001
Studium der Statistik an der Ludwigâ€“Maximiliansâ€“UniversitÂ¨at
MÂ¨unchen mit dem Anwendungsgebiet Versicherungswissenschaften
und der speziellen Ausrichtung mathematische Statistik
Sep. 1997
Diplomâ€“VorprÂ¨ufung
Mai 2001
Diplomâ€“HauptprÂ¨ufung
Beruf:
seit Juli 2001
wissenschaftlicher Mitarbeiter im Sonderforschungsbereich 386
â€Statistische Analyse diskreter Strukturenâ€ bei Prof. Dr. L.
Fahrmeir am Institut fÂ¨ur Statistik der
Ludwigâ€“Maximiliansâ€“UniversitÂ¨at MÂ¨unchen

