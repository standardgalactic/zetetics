Graduate Theses and Dissertations
Iowa State University Capstones, Theses and
Dissertations
2017
Bayesian inference of virus evolutionary models
from next-generation sequencing data
Emily Anne King
Iowa State University
Follow this and additional works at: https://lib.dr.iastate.edu/etd
Part of the Biostatistics Commons, and the Genetics Commons
This Dissertation is brought to you for free and open access by the Iowa State University Capstones, Theses and Dissertations at Iowa State University
Digital Repository. It has been accepted for inclusion in Graduate Theses and Dissertations by an authorized administrator of Iowa State University
Digital Repository. For more information, please contact digirep@iastate.edu.
Recommended Citation
King, Emily Anne, "Bayesian inference of virus evolutionary models from next-generation sequencing data" (2017). Graduate Theses
and Dissertations. 15337.
https://lib.dr.iastate.edu/etd/15337

Bayesian inference of virus evolutionary models
from next-generation sequencing data
by
Emily Anne King
A dissertation submitted to the graduate faculty
in partial fulﬁllment of the requirements for the degree of
DOCTOR OF PHILOSOPHY
Major: Statistics
Program of Study Committee:
Karin Dorman, Major Professor
Susan Carpenter
Mark Kaiser
Daniel Nettleton
Stephan Vardeman
Iowa State University
Ames, Iowa
2017
Copyright c⃝Emily Anne King, 2017. All rights reserved.

ii
TABLE OF CONTENTS
LIST OF TABLES. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
v
LIST OF FIGURES. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . vii
ACKNOWLEDGMENTS . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . ix
ABSTRACT . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
x
CHAPTER 1. INTRODUCTION . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
1
1.1
Next-generation sequencing
. . . . . . . . . . . . . . . . . . . . . . . . .
1
1.2
Quasispecies model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
2
1.2.1
Theory . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
2
1.2.2
Applications . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
3
1.2.3
Equilibrium validity
. . . . . . . . . . . . . . . . . . . . . . . . .
6
1.3
Virus and immune system dynamics . . . . . . . . . . . . . . . . . . . . .
7
1.4
Outline of thesis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
10
CHAPTER 2. BAYESIAN ESTIMATION OF SINGLE NUCLEOTIDE MUTA-
TION FITNESS EFFECTS AND THEIR INTERACTIONS IN EQUILIBRIUM
QUASISPECIES . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12
2.1
Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
13
2.2
Methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
16
2.2.1
Model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
16
2.2.2
Model simpliﬁcation under the PEQuasi method . . . . . . . . . .
19
2.2.3
Inference . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
25

iii
2.2.4
Simulation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
28
2.2.5
HIV-1 data
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
29
2.3
Results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
30
2.3.1
HIV-1 data
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
31
2.3.2
Simulation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
41
2.4
Discussion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
51
CHAPTER 3. APPLICABILITY OF THE EQUILIBRIUM QUASISPECIES MODEL
TO MULTIMODAL VIRUS POPULATIONS. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59
3.1
Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
59
3.2
Bounds on haplotype ﬁtness . . . . . . . . . . . . . . . . . . . . . . . . .
62
3.2.1
Case: A=2, L=1
. . . . . . . . . . . . . . . . . . . . . . . . . . .
63
3.2.2
General case . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
63
3.2.3
Numerical exploration of bounds on w
. . . . . . . . . . . . . . .
65
3.3
Eﬀect of Hamming distance on quasispecies equilibrium . . . . . . . . . .
68
3.4
Approach to equilibrium . . . . . . . . . . . . . . . . . . . . . . . . . . .
71
3.5
Discussion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
77
CHAPTER 4. ESTIMATING VIRUS AND ANTIBODY DYNAMICAL MODEL
PARAMETERS . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 81
4.1
Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
81
4.2
Methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
83
4.2.1
Process model . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
83
4.2.2
Data . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
85
4.2.3
Statistical model
. . . . . . . . . . . . . . . . . . . . . . . . . . .
86
4.2.4
Simulated datasets . . . . . . . . . . . . . . . . . . . . . . . . . .
89
4.2.5
Estimation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
94
4.2.6
CAP256 dataset . . . . . . . . . . . . . . . . . . . . . . . . . . . .
97

iv
4.3
Results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 100
4.3.1
Simulated datasets . . . . . . . . . . . . . . . . . . . . . . . . . . 100
4.3.2
CAP256 dataset . . . . . . . . . . . . . . . . . . . . . . . . . . . . 105
4.4
Discussion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 113
CHAPTER 5. CONCLUSION. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .116
BIBLIOGRAPHY . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .120
CHAPTER A. QUASISPECIES EQUILIBRIUM SUPPLEMENTARY METH-
ODS AND RESULTS . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .138
A.1 MCMC starting values . . . . . . . . . . . . . . . . . . . . . . . . . . . . 138
A.2 Run settings and convergence diagnostics . . . . . . . . . . . . . . . . . . 141
A.3 Simulation procedure . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 142
A.4 Processing HIV-1 gag dataset . . . . . . . . . . . . . . . . . . . . . . . . 144
A.5 Complete parameter estimates for HIV-1 datasets . . . . . . . . . . . . . 148
A.6 Alternative values of ﬁxed parameters for HIV-1 datasets . . . . . . . . . 161
A.7 Robustness to violations of pairwise-only epistasis . . . . . . . . . . . . . 169
A.8 Sensitivity to ﬁxed parameters . . . . . . . . . . . . . . . . . . . . . . . . 178
A.9 Eﬀect of composite haplotype . . . . . . . . . . . . . . . . . . . . . . . . 182
A.10 Assessing lack of ﬁt from omitted interactions . . . . . . . . . . . . . . . 183
CHAPTER B. VIRUS-ANTIBODY LOTKA-VOLTERRA SUPPLEMENTARY
METHODS AND RESULTS . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .193
B.1 Starting values
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 193
B.2 Processing CAP256 NGS datasets . . . . . . . . . . . . . . . . . . . . . . 194
B.3 Identiﬁability
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 200
B.4 Additional ﬁgures . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 203

v
LIST OF TABLES
Table 2.1
Example dataset illustrating site partitioning
. . . . . . .
24
Table 2.2
Example design matrix, site 4 . . . . . . . . . . . . . . . .
25
Table 2.3
Example design matrix for sites 1-3 . . . . . . . . . . . . .
26
Table 2.4
HIV-1 gag ﬁtness eﬀect estimates . . . . . . . . . . . . . .
35
Table 2.5
HIV-1 gag posterior predictive p-values . . . . . . . . . . .
37
Table 2.6
HIV-1 V3 loop parameter estimates . . . . . . . . . . . . .
39
Table 2.7
HIV-1 V3 loop posterior predictive p-values
. . . . . . . .
40
Table 2.8
Characteristics of simulated datasets . . . . . . . . . . . .
41
Table 2.9
PEQuasi estimation of ﬁtness eﬀects . . . . . . . . . . . .
42
Table 2.10
PEQuasi sensitivity to mutation rate . . . . . . . . . . . .
46
Table 2.11
PEQuasi sensitivity to transition/transversion ratio . . . .
48
Table 2.12
PEQuasi and QuasiFit haplotype ﬁtness estimates . . . . .
49
Table 3.1
Peak ﬁtness diﬀerence as function of distance
. . . . . . .
69
Table 3.2
Peak ﬁtness diﬀerence as function of cloud . . . . . . . . .
70
Table 4.1
Lotka-Volterra simulated dataset parameters . . . . . . . .
90
Table 4.2
Lotka-Volterra simulation conditions . . . . . . . . . . . .
90
Table 4.3
CAP256 virus-antibody interaction parameter estimates
. 110
Table 4.4
CAP256 virus growth rate estimates
. . . . . . . . . . . . 113
Table A.1
ˆR from HIV-1 datasets . . . . . . . . . . . . . . . . . . . . 142
Table A.2
Loss of HIV-1 gag reads due to ﬁltering by primer content
146

vi
Table A.3
Number of HIV-1 gag reads mapped to each amplicon
. . 147
Table A.4
Rejection of tags due to insuﬃcient or contradictory data . 148
Table A.5
All estimated eﬀects HIV-1 gag , cluster 1 . . . . . . . . . 148
Table A.6
All estimated eﬀects HIV-1 gag, cluster 2 . . . . . . . . . . 149
Table A.7
All estimated eﬀects HIV-1 gag epitopes, cluster 3 . . . . . 152
Table A.8
All estimated eﬀects HIV-1 V3 loop, cluster 1 . . . . . . . 153
Table A.9
All estimated eﬀects HIV-1 V3 loop, cluster 2 . . . . . . . 159
Table A.10
Comparison of site partitions
. . . . . . . . . . . . . . . . 164
Table A.11
Posterior predictive p-values HIV-1 gag reanalysis . . . . . 165
Table A.12
Posterior predictive p-values HIV-1 V3 loop reanalysis
. . 166
Table A.13
Posterior predictive statistic Ts
. . . . . . . . . . . . . . . 169
Table A.14
Simulated dataset characteristics, higher order epistasis . . 171
Table A.15
Estimation of ﬁtness eﬀects, higher order epistasis . . . . . 171
Table A.16
Estimation of haplotype ﬁtnesses, higher order epistasis . . 174
Table A.17
Posterior predictive p-values, higher order epistasis
. . . . 176
Table A.18
Simulated datasets used in sensitivity analysis . . . . . . . 178
Table A.19
Fitness eﬀect sensitivity to prior . . . . . . . . . . . . . . . 189
Table A.20
Posterior predictive checks for misspeciﬁed mutation rate . 190
Table A.21
Simulated datasets, composite haplotype comparison . . . 190
Table A.22
Comparison of PEQuasi, QuasiFit, and PEQuasiDiag . . . 191
Table A.23
Simulated datasets with interaction omission . . . . . . . . 191
Table A.24
Eﬀect of omitting unsupported interactions on estimation
191
Table A.25
Posterior predictive checks, interaction omission . . . . . . 192

vii
LIST OF FIGURES
Figure 1.1
B-cell clonal lineage . . . . . . . . . . . . . . . . . . . . .
8
Figure 2.1
Quasispecies model simpliﬁcation
. . . . . . . . . . . . .
21
Figure 2.2
Haplotype clustering
. . . . . . . . . . . . . . . . . . . .
25
Figure 2.3
HIV-1 gag cluster reference sequences . . . . . . . . . . .
33
Figure 2.4
HIV-1 V3-loop cluster reference sequences . . . . . . . . .
36
Figure 2.5
Absolute error of ﬁtness eﬀect estimates . . . . . . . . . .
43
Figure 2.6
Fitness eﬀect estimate error as function of q . . . . . . . .
47
Figure 2.7
Comparison of PEQuasi and QuasiFit absolute error . . .
50
Figure 2.8
Estimates of select HIV-1 haplotype ﬁtnesses . . . . . . .
51
Figure 3.1
Bounds on haplotype ﬁtness as function of p
. . . . . . .
66
Figure 3.2
Fitness landscape structure . . . . . . . . . . . . . . . . .
73
Figure 3.3
Convergence to quasispecies equilibrium . . . . . . . . . .
74
Figure 3.4
Local quasispecies equilibrium convergence . . . . . . . .
75
Figure 4.1
Example simulated trajectories . . . . . . . . . . . . . . .
91
Figure 4.2
HIV-1 neutralization by CAP256-VRC26 . . . . . . . . .
92
Figure 4.3
CAP256-VRC26.25 amino acid resistance scores
. . . . .
93
Figure 4.4
Credible interval coverage of model parameters . . . . . . 101
Figure 4.5
Posterior probability of virus elimination in simulation . . 102
Figure 4.6
Posterior probability of interaction diﬀerences, simulation
103
Figure 4.7
Fitted trajectories for a low sample size dataset . . . . . . 106

viii
Figure 4.8
Fitted trajectories for a moderate sample size dataset . . 107
Figure 4.9
Model166b ﬁtted virus and antibody trajectories . . . . . 111
Figure 4.10
Model169 ﬁtted virus and antibody trajectories . . . . . . 112
Figure 4.11
Posterior probability of elimination by CAP256-VRC26 . 113
Figure A.1
Prior sensitivity of HIV-1 ﬁtness eﬀect posterior
. . . . . 167
Figure A.2
HIV-1 ﬁtness estimate sensitivity to LD cutoﬀand prior . 168
Figure A.3
Parameter estimation error, higher order interactions . . . 172
Figure A.4
QuasiFit and PEQuasi, higher order interactions . . . . . 173
Figure A.5
Eﬀect of omitting higher order terms on rank correlation
177
Figure A.6
Sensitivity of ﬁtness eﬀect estimates to prior
. . . . . . . 179
Figure A.7
Sensitivity of rare haplotype ﬁtness estimates to prior . . 180
Figure A.8
PEQuasi and QuasiFit equilibrium approximations . . . . 184
Figure A.9
Absolute error, PEQuasi, QuasiFit, and PEQuasiDiag . . 185
Figure A.10
Eﬀect of site partitioning on ﬁtness estimates . . . . . . . 188
Figure B.1
Hamming distance to nearest CAP256-VRC26 sequence . 197
Figure B.2
Proportion of virus sample discarded
. . . . . . . . . . . 198
Figure B.3
Fitted trajectories for a low noise simulated dataset
. . . 204
Figure B.4
Fitted trajectories for a large simulated dataset . . . . . . 205
Figure B.5
Model166 parameter estimates by mode . . . . . . . . . . 206

ix
ACKNOWLEDGMENTS
First, I would like to thank my advisor Karin Dorman for her guidance through the
journey of planning, researching, and writing this Ph.D. thesis. She allowed me indepen-
dence, while contributing insights, critical feedback, and encouragement in discussions
and in manuscript comments that were invaluable to completion of this thesis. I am
fortunate to have an advisor generous with her time and expertise and committed to
supporting students in achieving their goals.
I would like to thank my committee members Susan Carpenter, Mark Kaiser, Daniel
Nettleton, and Stephen Vardeman.
All committee members contributed feedback at
preliminary stages of this project. I learned a lot from the classes of Dr. Nettleton and
Dr. Kaiser that has been of use in writing this thesis. I would also like to give a special
thank you to Dr. Carpenter for the opportunity to attend and present at her group
meetings and for assistance with biological interpretations of our results. The Dorman
lab group also provided feedback on presentations.
I am grateful for the many funding sources I have had through my graduate career.
I was supported by the NSF-GRFP program Fall 2011 through Summer 2013, by a
research assistantship from Amgen in the 2015 calender year, and by funding from the
Dale D. Grosvenor Chair held by my major professor Karin Dorman.
This dissertation would not have been possible without publicly available sequencing
data deposited on Sequence Read Archive. I am grateful to the creators of these datasets
and to the funding sources making them publicly accessible.
Finally, I would like to thank my parents Rebecca Herb and Henry King and my
partner Nicholas Leskiw, who have been consistently supportive.

x
ABSTRACT
There is a rich tradition in mathematical biology of modeling virus population dynam-
ics within hosts. Such models can reproduce trends in the progression of viral infections
such as HIV-1, and have also generated insights on the emergence of drug resistance
and treatment strategies. Existing mathematical work has focused on the problem of
predicting dynamics given model parameters. The problem of estimating model param-
eters from observed data has received little attention. One reason is likely the historical
diﬃculty of obtaining high-resolution samples of virus diversity within hosts. Now, next-
generation sequencing (NGS) approaches developed in the past decade can supply such
data.
This thesis presents two Bayesian methods that harness classical models to generate
testable hypotheses from NGS datasets. The quasispecies equilibrium explains genetic
variation in virus populations as a balance between mutation and selection. We use
this model to infer ﬁtness eﬀects of individual mutations and pairs of interacting mu-
tations. Although our method provides a high resolution and accurate picture of the
ﬁtness landscape when equilibrium holds, we demonstrate the common observation of
populations with coexisting, divergent viruses is unlikely to be consistent with equilib-
rium. Our second statistical method estimates virus growth rates and binding aﬃnity
between viruses and antibodies using the generalized Lotka-Volterra model. Immune re-
sponses can explain coexistence of abundant virus variants and their trajectories through
time. Additionally, we can draw inferences about immune escape and antibody genetic
variants responsible for improved virus recognition.

1
CHAPTER 1.
INTRODUCTION
This thesis presents Bayesian statistical methods for two inﬂuential virus evolution-
ary models and evaluates their potential for use on next-generation sequencing (NGS)
datasets. The quasispecies model describes how processes of mutation and selection in-
teract to maintain genetically diverse virus populations. We apply this model to estimate
ﬁtness eﬀects of genetic mutations and their interactions. The second model is a version
of the generalized Lotka-Volterra model. We use this model to estimate virus-immune
system interactions, of interest in vaccine development. In this chapter, we introduce
these two models and associated biological concepts.
1.1
Next-generation sequencing
The development of next-generation sequencing technologies has revolutionized biol-
ogy by enabling the creation of massive genetic datasets [1]. Next-generation sequencing
datasets consist of tens of thousands to hundreds of millions of short genetic sequences,
or reads. Each read is a string of nucleotide bases (A, C, G, or T). In the datasets we
analyze, reads are on the order of hundreds of bases, though read lengths vary with plat-
form. Reads are aligned, either to a single reference genome or to one another so that a
correspondence may be established between positions in diﬀerent reads. In the context
of our research, such technologies enable characterization of the mutant spectra of virus
populations at unprecedented resolution [2, 3] and similarly allow characterization of the
diversity of the immune repertoire [4].

2
1.2
Quasispecies model
1.2.1
Theory
Consider the population of viruses within a host as a collection of genetic sequences,
or haplotypes, spanning a common genetic region. Each genetic sequence is a string
of characters from an alphabet A. We will use the DNA alphabet {A, C, G, T} in this
work as common technologies output DNA sequences, for example, cDNA obtained from
HIV-1 virus particles sampled from blood of infected patients. Other choices such as
a binary alphabet are possible.
The quasispecies equation, originally formulated by
Manfred Eigen in 1971 [5], describes the genetic composition of a haploid population
as a function of haplotype ﬁtnesses and mutation rate between haplotypes. Consider a
haploid population with M possible haplotypes. Let Q be an M × M matrix such that
qij gives the probability that replication of haplotype j gives rise to haplotype i. Let wi
be the nonnegative ﬁtness of haplotype i and W = diag(w). Let p(t) be the vector of
haplotype relative frequencies at time t. The mutation-selection process is deﬁned by a
system of diﬀerential equations
˙p(t) = QW p(t) −w(t)p(t),
(1.1)
where
w(t) =
M
X
i=1
wipi(t)
is the mean ﬁtness at time t. At equilibrium, the relative frequency of each haplotype,
p, satisﬁes
QW p = λp.
(1.2)
By the Perron-Frobenius theorem, a suﬃcient but not necessary condition for the ex-
istence and uniqueness of a positive solution to Eq. (2.2) is wi > 0 for all i and Q is

3
primitive [6]. The leading eigenvalue of QW is w = PM
i=1 wipi, the mean ﬁtness at
equilibrium [7, 8].
Since the original statement of this model, there has been a large body of theoretical
work on its properties. One important result is the existence of the error threshold,
the critical mutation rate at which there is an abrupt transition between a population
dominated by the ﬁttest, or master, sequence and a population approaching a uniform
distribution over haplotypes. In practice, a uniform distribution across sequences is not
possible at ﬁnite population size, so the quasispecies will become delocalized and ran-
domly drift through sequence space [6]. The error threshold depends on sequence length,
so it can also be interpreted as the maximum length sequence that can be maintained
for a given mutation rate, explaining why viruses using error-prone reverse transcriptase
or RNA-dependent RNA polymerase in their replication cycle never attain the genome
size of the largest DNA viruses. Another important result is that in a species with high
mutation rate, the ﬁtness of mutants produced by a master sequence is important in
determining whether that sequence will be dominant in the population. A less ﬁt master
sequence may be selected if mutations from the sequence have a lower ﬁtness cost [9].
1.2.2
Applications
Throughout most of the history of the quasispecies model, connections to empirical
data were restricted to assessing whether observed virus populations qualitatively agreed
with model predictions. This work was reviewed by Domingo and colleagues [10]. For
example, researchers found high genetic variation in laboratory Qβ-phage populations,
but a stable consensus sequence through time [11]. A consensus sequence is a genetic
sequence formed from the most common nucleotide at each position in a sample. The
quasispecies interpretation is that mutants have high frequency in the population because
they are being produced at a high rate, but the consensus sequence is stable because
any particular mutant is less ﬁt than the consensus sequence so does not achieve high

4
population frequency. Artiﬁcially increasing replication ﬁdelity in picornavirus leads to
less heterogeneity, as predicted by the quasispecies model, and additionally is shown to
negatively impact response to selection [12]. Work on artiﬁcially increasing mutation
rates also supports the prediction that suﬃciently high mutation rates can result in loss
of population ﬁtness [13].
The only existing method to ﬁt the quasispecies model to empirical data is QuasiFit
[14]. This method, described in more detail below, uses sample haplotype counts to infer
a ﬁtness landscape for observed haplotypes under the assumption of quasispecies equi-
librium. A ﬁtness landscape is a map assigning a nonnegative ﬁtness to each haplotype.
Consider a sample of N length L haplotypes from a virus population. Each haplotype
is assumed to span the entire genetic region. Let A be the genetic alphabet. There are
|A|L possible length L sequences, but for all but the smallest L, the sample will only
contain a small fraction of the possible sequences. Additionally, |A|L will be suﬃciently
large that computing the equilibrium over all sequences is intractable. Let G be the set of
unique observed haplotypes. For each pair of length L sequences, the Hamming distance
is deﬁned to be the number of positions at which they diﬀer. Consider an undirected
graph in which distinct sequences are nodes. An edge connects two nodes if and only
if their corresponding sequences are separated by a Hamming distance of 1. This graph
is referred to as the Hamming graph. QuasiFit models only the ﬁtness of haplotypes in
Gc = G ∪C where C is a set of unobserved haplotypes added to ensure connectivity of
the subgraph of the Hamming graph restricted to sequences in Gc.
Let G = |Gc|.
Let ni be the count of haplotype i in the sample, i = 1, . . . , G,
PG
i=1 ni = N. QuasiFit models (n1, . . . , nG) as a multinomial sample from a population
at quasispecies equilibrium and estimates the equilibrium ﬁtness vector w. To ensure
model identiﬁability, w is ﬁxed to 1 and the mutation matrix Q is also ﬁxed [15]. Then,
n ∼Multinomial(N, p(w)),

5
and p(w) is the solution to
Qdiag(w)p(w) = p(w).
The notation p(w) emphasizes that the quasispecies equilibrium is a function of the
ﬁtness vector w. Assume equal mutation probability between all alleles q/(|A| −1).
Let dij be the Hamming distance between haplotype i and haplotype j. Then assuming
independent sites,
qij =







(1 −q)L−dij

q
|A|−1
dij
i ̸= j
1 −P
k̸=i qkj
i = j.
(1.3)
Under this assumption, qii = (1 −q)L. However, because in general Gc does not include
all possible haplotypes, qii > (1−q)L. QuasiFit also implements a more general mutation
model in which transitions (interchanges of A and G or C and T) occur at a diﬀerent
rate from transversions (mutations between all other nucleotide pairs).
QuasiFit estimates ﬁtnesses using a Bayesian approach, diﬀerential evolution MCMC
[16]. They take advantage of a bijection between relative frequency vectors corresponding
to valid equilibrium quasispecies and their ﬁtnesses for ﬁxed mutation rate to improve
sampling eﬃciency, and use a uniform prior over ﬁtnesses, subject to the constraint
that mean equilibrium ﬁtness is 1. They demonstrate improved performance on sim-
ulated data in estimating ﬁtness rank order over a naive method assuming more com-
mon haplotypes are more ﬁt, even under misspeciﬁcation of the mutation matrix and
in nonequilibrium populations. They apply their estimation method to HIV-1 spacer
peptide p1 and capsid protein p7, a total of 209 nucleotide bases. They inferred ﬁtness
diﬀerences among haplotypes and found evidence for epistatic interactions among amino
acid variants.

6
1.2.3
Equilibrium validity
Results from analysis of the single peak quasispecies model indicate the population
should either be dominated by the ﬁttest sequence surrounded by a cloud of rare mutants
or delocalized in sequence space if mutation rate exceeds the error threshold. Neither
of these outcomes approximates many virus populations observed in deep sequencing
studies, which may contain multiple abundant haplotypes, possibly separated from one
another by several mutations. However, other theoretical work on quasispecies in mul-
tipeak ﬁtness landscapes provides insight into the circumstances under which such a
population may be considered an equilibrium quasispecies. In the case of a ﬁtness land-
scape over 2L sequences with two neutral ﬁtness peaks, additional results are available
in the limit as mutation rate approaches zero [9]. Two ﬁtness peaks are neutral if they
have equal ﬁtnesses. Assume a mutation matrix as given in Eq. (1.3). The equilib-
rium distribution depends on the distance between the two ﬁtness peaks. Call the two
haplotypes at the ﬁtness peaks h1 and h2 and their equilibrium relative frequencies ph1
and ph2. When the Hamming distance d1,2 between h1 and h2 is one, the quasispecies
converges to ph1 = ph2 = 0.5 as the mutation rate approaches 0. When d1,2 = 2, the
quasispecies approaches a distribution in which ph1 = α and ph2 = 1−α where 0 < α < 1
is determined by the relative ﬁtness of haplotypes in the neighborhoods of h1 and h2.
When d1,2 = 3, the quasispecies approaches a distribution with either ph1 = 1 or ph2 = 1,
according to which mutant cloud has higher ﬁtness. This work suggests that populations
with two common haplotypes separated by a distance of more than 2 are diﬃcult to
explain as equilibrium quasispecies at realistic mutation rates near zero.
In addition, quasispecies delocalization occurs on a ﬁtness landscape in which many
haplotypes have the maximum ﬁtness [6]. The diﬃculty of maintaining an equilibrium
distribution over an extensive neutral network of haplotypes is one of the major criticisms
of the applicability of the quasispecies model [17]. Others have argued that truly neutral
sites are rare in compact genomes [10]. Application of the quasispecies model to real

7
datasets must be accompanied by careful consideration of the temporal and genetic
scales over which it applies.
1.3
Virus and immune system dynamics
If quasispecies equilibrium cannot explain the coexistence and dynamics of distant
sequences in Hamming space, we must seek other explanations. One explanation for
variation is interaction between viruses and the adaptive immune system [8, 18]. To this
end, we develop a statistical approach for inferring these interactions, and apply it to a
dataset from an HIV-1 infected patient.
The adaptive immune system is a subsystem of the immune system. Unlike innate
immune responses, adaptive immune responses are speciﬁc to a particular pathogen. B
and T cells are the two main cell types of the adaptive immune system. Because the
dataset we analyze consists of sequences of antibodies, produced by B-cells, we will focus
on them.
Antibodies are Y-shaped proteins consisting of a heavy chain and a light chain (Fig-
ure 1.1). The chains have a constant region and a variable region. The amino acid
sequence of the variable region will determine whether or not the antibody is able to
bind to a speciﬁc antigen. V(D)J recombination contributes to variable region diversity.
Germline, or reproductive cells, contains many diﬀerent copies of gene segments called
V, D, and J. In V(D)J recombination, the B-cell genome is modiﬁed to produce a heavy
chain gene consisting of V, D, and J segments and a light chain gene consisting of V and
J segments. Light chains can belong to the κ or the λ family. Diﬀerent combinations of
V, D, and J segments will produce antibodies with diﬀerent variable regions.
B-cells derived from the same ancestor are called a clonal lineage. If the ancestral
cell is deﬁned after V(D)J recombination of heavy and light chains, all cells in the clonal
lineage will use the same germline gene copies. Genetic diversity within a clonal lineage

8
progenitor
UCA
V(D)J recombination
a
b
germline sequence
V
V
V
V
V
V
D
D
J
J
J
C
J
J
J
C
heavy chain
light chain
V
V
D J
C
J
C
antigen
heavy
chain
light
chain
variable
region
Figure 1.1: (a) Development of B-cell clonal lineage from a progenitor cell containing
the germline sequence with many copies of V, D, and J genes. C encodes the constant
region. Antibody heavy and light chain gene building blocks are determined by V(D)J
recombination. The universal common ancestor (UCA) of the lineage is deﬁned after
V(D)J recombination. The UCA replicates by division, and its progeny in turn replicate.
Mutations may occur during replication (shown as dots on the line representing the
genome). Antibody sequences with a common ancestor share mutations (sequences below
black bar). (b) Structure of an antibody (IGg). Heavy chains shown in blue, light chains
shown in orange. Lighter colors on each chain show the variable region and darker colors
show the constant region. An antigen is shown binding at one of the antigen binding
sites.

9
is generated by somatic hypermutation. Mutation rate in the variable region is up to 106
times higher than typical mutation rates during DNA replication [19]. This is one step
of a process called aﬃnity maturation, in which B-cells with improved antigen binding
are generated and selected. As one B-cell in a clonal lineage divides to form two cells,
the relationships between the cells will be a tree. To form natural subgroups of B-cells,
we can cut the tree along a branch coinciding with the appearance of a particular genetic
variant of interest. We will call this a phylogenetic grouping.
As the B-cell lineage evolves, so does the virus population. The part of the antigen to
which the antibody binds is called the epitope. Escape mutants are viruses with genetic
changes that reduce or eliminate recognition of the epitope by the immune system. Such
mutants often carry a ﬁtness cost, meaning they will not be selected in the absence of an
immune response directed at that epitope [20]. Virus genetic variation can be explained
as the result of a dynamic process in which new escape mutants rise in frequency, while
those targeted by the adaptive immune response decline in frequency. The adaptive im-
mune response may eventually evolve to target the escape mutants, leading to a complex
pattern of rise and fall of particular sequences. Mathematical models of this process
explain some observed trends in viral load in the progression of HIV-1 infection [21, 22].
One of the most basic models of interaction of antigenically variable viruses with
immune system components contains only strain speciﬁc immune responses [8]. Let Vi(t)
be the population size of virus i at time t and Ai(t) be the strength of the immune
response against virus i at time t. Assume
˙Vi(t) = rVi(t) −pAi(t)Vi(t) i = 1, . . . , n
(1.4)
and
˙Ai(t) = cVi(t) −bAi(t) i = 1, . . . , n.
(1.5)

10
Model parameters are virus replication rate r, immune response degradation rate b, virus
elimination rate p, and immune system stimulation rate c. Note none of the rates in this
model diﬀer between strains. There are also no cross-reactive immune responses in which
one immune cell or antibody is capable of eliminating multiple virus strains.
In the model of Eq. (1.4) and Eq. (1.5), immune response stimulation depends only
on Vi(t), but in alternative model versions it depends on Vi(t)Ai(t). In this case, the
virus-antibody model becomes a special case of the generalized Lotka-Volterra model.
We propose to use the generalized Lotka-Volterra model to model virus-antibody dy-
namics. The Lotka-Volterra model is a classical ecological model used in current NGS
applications, including metagenomics [23, 24] and virus dynamics [25]. The generalized
Lotka-Volterra model describes the dynamics of n species. Each species has a ﬁtness fi
which is determined by its growth rate ri and interactions with other species given in
the matrix C.
˙Xi(t) = fi(t)Xi(t)
(1.6)
f(t) = r + CX(t)
(1.7)
Although even the basic model in Eq. (1.4) and Eq. (1.5) includes more than one
virus genotype, previous attempts to estimate parameters of such models did not incor-
porate genetic variability among viruses. Historically, data used in estimation consisted
only of viral load trajectories and sometimes, dynamics of one or more immune system
components. Datasets with detailed genetic information have recently appeared [18, 26],
creating an opportunity to ﬁt such models.
1.4
Outline of thesis
In Chapter 2, we describe a method to estimate the ﬁtness eﬀects of individual muta-
tions and their interactions in virus populations assuming quasispecies equilibrium. We

11
demonstrate its performance on simulated datasets and apply it to two HIV-1 datasets.
We ﬁnd ﬁtness diﬀerences among mutations and evidence for interactions between sites
responsible for the maintenance of common haplotypes. In Chapter 3, we explore the lim-
itations of the quasispecies model to explain patterns of virus genetic diversity observed
in HIV-1 patients. Coexistence of high frequency variants is often observed in HIV-1
datasets, but maintaining coexistence at equilibrium requires that their ﬁtnesses be ap-
proximately equal. This same fact means the approach to equilibrium is prohibitively
slow. In Chapter 4, we present estimation for a nonequilibrium dynamical model in-
cluding interaction with the host immune system applied to real and simulated datasets.
This method shows promise on simulated data, but larger antibody datasets than that
currently available will likely be needed. Chapter 5 summarizes conclusions and suggests
directions for future research.

12
CHAPTER 2.
BAYESIAN ESTIMATION OF SINGLE
NUCLEOTIDE MUTATION FITNESS EFFECTS AND
THEIR INTERACTIONS IN EQUILIBRIUM
QUASISPECIES
A paper to be submitted to Genetics
Emily King and Karin Dorman
Abstract
The rapidly increasing availability of high-resolution sequencing data from virus sam-
ples enables new research on evolution in highly variable populations with potential ap-
plications to human health. The quasispecies equilibrium is an inﬂuential model explain-
ing genetic variation in virus populations as a balance between mutation and selection.
It has only recently been applied to estimate ﬁtnesses of whole viruses from sequenc-
ing data. We propose a new Bayesian method applying the quasispecies equilibrium
model to estimate ﬁtness eﬀects of single nucleotide mutations and their interactions
from counts of genetic variants in a cross-sectional intrahost sample.
We apply this
method to two datasets from HIV-1 infected patients and examine the statistical proper-
ties of the method in simulation. We identify several highly ﬁt single mutants in an HIV-1
gag epitope and the V3 loop and substantial interactions between pairs of mutations.
In some striking cases, the presence of a second mutation can substantially decrease the

13
ﬁtness cost of another mutation. Tests of our method on simulated datasets show it is
competitive with the existing approach to quasispecies ﬁtness estimation in discovering
the correct rank order of haplotype ﬁtnesses, credible interval coverage, and estimation
error. Unlike the previous method however, our method can uncover hypotheses about
individual mutations and pairs of mutations that can be tested through further biological
experimentation.
2.1
Introduction
The advent of next-generation sequencing (NGS) technologies has provided previously
unavailable opportunities to study the in vivo diversity and evolution of viruses at high
resolution [2, 3]. It is known that variant pools within hosts contribute to treatment
resistance [27, 28], cell tropism [29, 30], and immune escape [31, 32]. Studies using NGS
technology have demonstrated the role of preexisting resistance variants in treatment
response [33], documented genetic changes during host adaptation [34, 35], linked within-
host and between-host evolution [36, 37], and revealed immune escape variants with
importance in vaccine development [38, 39]. Ubiquitous in these studies is the assumption
that the persistence or emergence of functional variants is largely driven by selection,
but it remains challenging to parse the speciﬁc genetic determinants of viral ﬁtness, such
as the eﬀects of point mutations [40, 41, 42] or epistatic interactions between variants
at multiple loci [43, 44].
In particular, few studies of ﬁtness have used NGS data,
and methodology to determine the contribution of molecular ﬁtness using NGS data is
limited.
As viruses are haploid, a virus genome can be represented with a single genetic se-
quence, or haplotype. Mutational ﬁtness eﬀects and interactions generate a ﬁtness land-
scape, a map assigning a reproductive capacity, or ﬁtness, to each haplotype. The map
may vary with environment. Though temporal changes in variant frequencies can be

14
particularly useful for parsing genetic ﬁtness [45, 46, 47, 48], our focus is on estimation
of genetic ﬁtness determinants from within-host cross-sectional data.
Fitness eﬀects,
averaged across nucleotide positions, can be estimated in conjunction with phylogenetic
analysis [49, 50], but such approaches are not designed for use with viruses from a single
host, where coexistence of interacting variants violates the fundamental assumption that
lineages evolve independently. Haplotype ﬁtnesses have been inferred using spin models
[51] from a database of consensus sequences across hosts. Fitness main and epistatic
eﬀects may also be inferred from in vitro ﬁtness measurements performed on a collection
of virus population samples diﬀering in consensus sequence and minority variant com-
position [52]. Sample amino acid frequencies at each site are used to predict population
ﬁtness under the assumption that the eﬀect of an allele on population ﬁtness is the allele
relative frequency times an allele ﬁtness eﬀect parameter. These existing methods do
not directly model in vivo ﬁtness landscapes within a host as they rely either on in vitro
ﬁtness measurements or on the estimation of a population-level ﬁtness landscape. The
within-host ﬁtness landscape can diﬀer dramatically from the population-level ﬁtness
landscape because individuals vary in important ﬁtness landscape determinants such as
drug treatment and immune response.
The quasispecies model [5, 53] is a popular mathematical model that has been invoked
to explain virus variant pools as a product of mutation and selection [11]. Because RNA
viruses replicate with high error rates, a diverse cloud of mutants persists even when
there is a single ﬁttest variant. A quasispecies equilibrium is a speciﬁc distribution of
viral variants achieved when a quasispecies model with constant mutation rates and
ﬁtnesses reaches mathematical equilibrium. Although the quasispecies model is widely
used in theoretical modeling [9, 8, 54, 18] and supported by empirical work [10], it has
rarely been used for statistical inference with virus data. The richness of modern NGS
data now makes it possible to compare the quasispecies equilibrium to in vivo virus
abundance data for the purposes of estimating mutation rates, ﬁtnesses, or both.

15
To our knowledge, QuasiFit [14] is the ﬁrst and only method available to estimate
parameters of the quasispecies from virus haplotype counts at a single time point. Quasi-
Fit assumes error-free haplotypes of ﬁxed length each with a distinct ﬁtness value that
are multinomially sampled from a virus population at quasispecies equilibrium. To esti-
mate the eﬀects of individual mutations and pairs of mutations, there are some ex post
facto strategies [14, 55]. Epistasis can be estimated as a linear combination of observed
haplotype ﬁtnesses. If haplotypes 00, 01, 10 and 11 are all observed, then epistasis may
be measured as f11 −f01 −f10 + f00 [14], where fij is the ﬁtness of haplotype ij. This
approach is meaningful if all alleles are present on the same genetic background, but
it is not clear what is to be done if, for example, allele combination 11 is observed in
multiple haplotypes or no haplotypes. Another possibility is to reparametrize QuasiFit’s
saturated ﬁtness model in terms of main and epistatic eﬀects [55, 56]. This approach is
demonstrated for a genetic region of length two [55], but the exponential growth of the
number of haplotypes with the number of sampled sites would make direct extension to
longer genetic regions computationally prohibitive.
We propose a Bayesian method to infer eﬀects of individual mutations and epistatic
interactions under the assumption of quasispecies equilibrium. Following previous work
[52, 57], we model log ﬁtness as a function of main eﬀects (individual mutation eﬀects)
and pairwise epistatic interaction terms. Our proposed method, which we will refer to
as the PEQuasi method, is the ﬁrst to statistically estimate main and epistatic eﬀects
using the quasispecies equilibrium model. Estimation of main eﬀects permits inference
concerning which mutations are better-tolerated against a reference genetic background.
Whether epistatic interactions are positive or negative determines whether co-occurring
mutations are beneﬁcial (positive epistasis) or deleterious (negative epistasis). In simula-
tion, PEQuasi performs well estimating mutation and epistatic eﬀects, particularly those
contributing to common haplotype ﬁtnesses, but it also achieves accurate estimation of
haplotype ﬁtnesses, comparable to QuasiFit. We demonstrate the method can detect

16
previously known and novel ﬁtness eﬀects when applied to published sequence data from
two regions of the HIV-1 genome: HIV-1 gag [58] and V3 loop [29].
2.2
Methods
2.2.1
Model
2.2.1.1
Quasispecies equilibrium
We model virus genetic diversity using the quasispecies equation, originally formu-
lated by Manfred Eigen in 1971 [5]. Consider a haploid population with M possible
haplotypes. Let Q be an M × M matrix such that qij gives the probability that repli-
cation of haplotype j gives rise to haplotype i. Let wi be the nonnegative ﬁtness of
haplotype i and W = diag(w). Let p(t) be the vector of haplotype relative frequencies
at time t. The mutation-selection process is deﬁned by a system of diﬀerential equations
˙p(t) = QW p(t) −w(t)p(t),
(2.1)
where
w(t) =
M
X
i=1
wipi(t)
is the mean ﬁtness at time t.
At equilibrium, the population relative frequency of each haplotype, p, satisﬁes
QW p = λp.
(2.2)
By the Perron-Frobenius theorem, a suﬃcient but not necessary condition for the ex-
istence and uniqueness of a positive solution to Eq. (2.2) is wi > 0 for all i and Q is
primitive [6]. The leading eigenvalue of QW is w = PM
i=1 wipi, the mean ﬁtness at
equilibrium [7, 8].

17
2.2.1.2
Symmetric mutation and pairwise-only epistasis
Fitting the quasispecies model to data requires some constraints on the elements of Q
and W [15]. Here, we describe the constraints used in our proposed PEQuasi method.
We model a genetic region of length L with A possible characters at each position,
for example A = 4 for DNA sequences, leading to M = AL possible haplotypes after
neglecting the possibility of insertions or deletions.
As in [14], we assume mutation rates are completely known so we can focus on
estimation of ﬁtnesses. In addition, we assume the probability of mutation qij between
any pair of haplotypes (i, j) depends only on their Hamming distance dij. Let q be the
per site mutation probability. Then,
qij = (1 −q)L−dij

q
A −1
dij
.
(2.3)
The constraint could easily be relaxed to a more general model of mutation allowing
diﬀerent rates of mutation between diﬀerent base pairs, though a symmetric matrix is
desirable because it allows faster eigendecomposition of QW .
The PEQuasi method assumes pairwise-only epistasis. Let haplotype i have base bil
at site l. Assume wi > 0 for all i. The log ﬁtness of haplotype i is
log wi = µ +
L
X
l=1
σl,bil +
X
1≤l<m≤L
ρ(l,bil),(m,bim),
(2.4)
where σl,bil ∈R are allele eﬀect terms and ρ(l,bil),(m,bim) ∈R are pairwise epistatic eﬀect
terms, additive on a log scale. One haplotype is designated the reference. We choose
the most common haplotype as the reference, since it generally results in more tightly
constrained estimates of remaining eﬀects. All terms associated with the reference haplo-
type are set to zero to make the remaining eﬀects estimable. Additionally, the intercept
µ is set to zero because previous work has shown that at least one constraint on the

18
ﬁtness vector w is required for structural global identiﬁability [15]. It will be convenient
to express the haplotype ﬁtness vector in matrix notation. Let β = (σ′, ρ′)′ and X be a
design matrix such that
log w = Xβ.
(2.5)
We will refer to the ﬁtness landscape model Eq. (2.4) as the pairwise-only epistasis (PE)
ﬁtness model. The PE model has been previously used to infer HIV-1 ﬁtnesses at the
amino acid level from in vitro replication data [52, 57]. Note that under our assumptions
a unique quasispecies equilibrium exists by the Perron-Frobenius theorem because all
elements of are strictly positive.
2.2.1.3
Statistical Model
We assume the data consist of counts of distinct length L haplotypes without indel
variants, and that sequencing errors can either be ignored or have been removed prior
to analysis. In the next section 2.2.2, we explain how and why sites are partitioned
to simplify inference. The result is ng independent subsets of sites indexed by s. The
ﬁtness eﬀects of alleles in a site subset can be described using Eq. (2.5), with parameter
vector βs of length ks the concatenation of {σl,bil, ρ(l,bil),(m,bim) : l, m ∈site subset s}. We
assume the observed data are independent multinomial samples of Gs distinct haplotypes
within site subsets (we will call them subhaplotypes later). While there is no analytic
formula for the likelihood, it can be written in terms of the equilibrium solution ps(βs)
of Eq. (2.2) for the site subset, now clearly indicating the dependence on βs. Let yis be
the count of the ith subhaplotype in site subset s, i = 1, . . . , ms. Treating the mutation
rate as ﬁxed, the likelihood is
p(y|β) ∝
ng
Y
s=1
Gs
Y
i=1
[pis(βs)]yis .

19
We seek a Bayesian solution and impose a Laplace prior centered at zero
p(β) ∝
ng
Y
s=1
ks
Y
j=1
e−λ|βsj|
for all ﬁtness eﬀect parameters β. Then, the parameters associated with site subsets are
independent in the posterior distribution
p(β|y) ∝
ng
Y
s=1
 Gs
Y
i=1
[pis(βs)]yis
!  ks
Y
j=1
e−λ|βsj|
!
.
2.2.2
Model simpliﬁcation under the PEQuasi method
The equilibrium quasispecies is a distribution of all possible haplotypes in a genetic
region of length L. Inference under this model is threatened by two problems. First, the
solution via eigendecomposition becomes numerically unstable when two or more isolated
haplotypes coexist with no observed intermediates. Second, the number of haplotypes
grows exponentially with L, so it quickly becomes infeasible to compute the quasispecies
equilibrium, perform statistical estimation, or even store the matrix QW for regions
larger than a few nucleotides.
Fitting the quasispecies model requires reductions in
model complexity, including strategies to handle well-separated haplotypes, as well as
fewer haplotypes M and fewer parameters β. This section describes our procedure, part
of the PEQuasi method, for model simpliﬁcation (Fig. 2.1).
2.2.2.1
Haplotype clustering
The equilibrium distribution becomes numerically unstable to compute and biolog-
ically untenable on multimodal ﬁtness surfaces with unﬁt intermediate haplotypes be-
tween modes [9]. Increased numerical precision can generate a solution for haplotypes
separated by up to three mutations [14], however theoretical work indicates that the
ﬁtnesses of cloud haplotypes become increasingly important in determining equilibrium

20
haplotype relative frequencies as the Hamming distance between the peaks increases [9].
When these are absent from the sample, we can infer little about their ﬁtnesses and con-
sequently little about the relative heights of ﬁtness peaks. Meanwhile, the quasispecies
equilibrium itself becomes biologically unrealistic. For suﬃciently unﬁt clouds and small
enough mutation rates, random genetic drift begins to dominate, and the equilibrium is
never reached [9]. Even before genetic drift dominates, we have observed in simulation
that the time to reach equilibrium for well-separated ﬁtness peaks easily exceeds the
duration of within-host infections
Nevertheless, it is reasonable to suspect that well-populated haplotypes around a
ﬁtness peak will achieve a quasi-equilibrium that reﬂects the ﬁtness eﬀects of involved
alleles. Thus, we propose to cluster haplotypes by Hamming distance, ﬁtting the qua-
sispecies equilibrium separately to each cluster. Speciﬁcally, we consider all unique hap-
lotypes occurring at least k times. In our analysis of HIV-1 data, we chose k = 1. We
connect a pair of haplotypes if they are separated by a Hamming distance of one. Clus-
ters are formed from maximal connected components of this graph, computed using the
igraph R package [59]. Next, if k > 1, all remaining observed haplotypes occurring fewer
than k times are added to the graph. They are assigned to any cluster to which they
are connected, but they do not act to merge clusters. Isolated clusters, consisting of
haplotypes that all occur less than k times, are dropped from any further analysis.
2.2.2.2
Partitioning sites
The L sites can be partitioned using non-zero interactions, supplemented to ensure
transitivity, as an equivalence relation. This partition induces a decomposition of the
matrix QW in Eq. (2.2) into a Kronecker product of mutation and ﬁtness eﬀect matri-
ces speciﬁc to each subset of sites [60], reducing the quasispecies equilibrium calculation
from an eigendecomposition of the full AL × AL matrix to the more tractable eigende-
composition of smaller sub-matrices. If we refer to the combinations of alleles observed

21
Cluster haplotypes
for each cluster
Partition sites
for multi-site elements
for single site elements
Collapse all un-
observed subhap-
lotypes into Hu
Retain all alleles
in quasispecies
Drop parameters
not in ﬁtness of
present subhaplotypes
Compute separate
equilibrium for each
partition element
Figure 2.1: Model simpliﬁcation. This ﬂow chart outlines our procedure for reducing the
dimension of the model in terms of both haplotypes and number of model parameters.

22
on subsets of the L sites as subhaplotypes, then the full-length haplotype relative fre-
quencies can be computed as products of subhaplotype relative frequencies determined
from the sub-matrices.
The prevalence of epistatic interactions in viruses [44, 52] suggests that dropping all
interaction parameters will generally not provide a good ﬁt to the data. However, not all
pairs of sites show evidence of association, so although we do not a priori know which
interactions are zero, we can ﬁnd interaction terms with little apparent support in the
data. In practice, we uncover evidence of association by testing each pair of sites using
the fisher.test function in R with simulated p-values. The resulting set of p-values is
adjusted for multiple testing using the Benjamini and Hochberg method [61]. Controlling
the false discovery rate at 0.1, signiﬁcant evidence of association is used to partition the
sites. Throughout the rest of the methods, we will often simplify terminology by referring
to subhaplotypes as haplotypes, even though all subsequent actions are operating on
subhaplotypes observed on subsets of sites.
2.2.2.3
Dropping unobserved haplotypes
Using eigendecomposition to compute the equilibrium distribution over the four nu-
cleotide bases at a single site is trivial, but computing the equilibrium distribution over
multi-site haplotypes quickly becomes intractable. We retain all alleles in single site
subsets, but we propose to simplify calculations on site subsets of size two or more by
dropping all unobserved haplotypes from the model. Others have made similar simpli-
ﬁcations. For example, [14] did not partition sites, but they dropped most unobserved
full-length haplotypes from their model, only retaining unobserved haplotypes necessary
to connect observed haplotypes in Hamming space. Little can be inferred about the
ﬁtness of absent haplotypes and, by extension, any parameter only contributing to the
ﬁtnesses of absent haplotypes. It is a reasonable compromise to drop these unobserved
haplotypes and focus computations on parameters that can be expressed as linear com-

23
binations of log ﬁtnesses of observed haplotypes, from now on referred to as estimable
parameters.
If haplotypes are removed from the quasispecies, Eq. (2.3) no longer yields a stochastic
mutation matrix. We address this problem by hypothesizing a composite haplotype Hu ,
which is the collection of all unobserved haplotypes in a site subset. The elements of the
corresponding row are set to restore a column stochastic matrix, so qHui = P
j∈Hu qji,
the column entries are set to ensure a symmetric matrix to ease computation of the
quasispecies distribution, and haplotype Hu is assigned an arbitrary, low ﬁtness. For all
analyses presented, we set the log ﬁtness of Hu, σH, to -0.5. A similar strategy was used
in a non-equilibrium model for within-host inﬂuenza time series data including mutation
and selection [48], but this method set the return probabilities qiHu ≡0, which is a
reasonable approximation because of the low probability of back mutation of low ﬁtness
haplotypes to observed haplotypes, but slows inference in the quasispecies equilibrium
model because of the resulting asymmetric matrix.
In contrast, QuasiFit adds extra mass to the diagonal elements of the mutation matrix
between observed haplotypes to preserve column stochasticity [14]. We will refer to this
method as the diagonal method. Appendix A.9 demonstrates the improved performance
of our composite haplotype method over the diagonal method.
If only ﬁtnesses of present haplotypes are modeled, the design matrix X in Eq. (2.5)
will likely not have full column rank.
An unnecessarily large number of parameters
will be estimated, potentially slowing convergence of the MCMC algorithm. Thus, we
remove parameters not involved in the ﬁtness of any present haplotype and combine
aliased parameters [62] into single parameters.
2.2.2.4
An example
We now illustrate the PEQuasi model simpliﬁcation strategy on a toy dataset. Ta-
ble 2.1(a) shows counts of all observed genotypes for nucleotide sequences of length

24
Table 2.1: Example data before and after site partitioning. (a) Haplotype counts for
an example dataset. Reference alleles are denoted by ‘.’ After partitioning sites, (c) all
subhaplotypes (single site alleles, in this case), whether observed or not, are retained at
site 4 and (b) only observed subhaplotypes are retained in site subset {1, 2, 3}. In this
subset, Hu is the composite haplotypes consisting of all unobserved haplotypes.
(a) Haplotype counts.
Haplotype
Count
....
8606
GGG.
1267
...A
38
..G.
24
.GG.
19
GG..
19
G...
17
GGGA
9
GTG.
1
(b) Subhaplotype counts,
sites 1, 2, and 3.
Subhaplotype
Count
...
8644
GGG
1276
..G
24
.GG
19
GG.
19
G..
17
GTG
1
Hu
0
(c) Subhaplotype counts,
site 4.
Subhaplotype
Count
A
47
.
9953
G
0
T
0
L = 4. The reference allele at each site is indicated by ‘.’ and carries the baseline ﬁtness
implied by the constraints on our ﬁtness parameters β. All haplotypes form a single
cluster if k = 1, because all present haplotypes form a connected graph (Figure 2.2).
In this example, all sites but the fourth show evidence of dependence with another site
when controlling FDR at 10%. Therefore, the genetic region is split into two site subsets:
{1, 2, 3} and {4} (Tables 2.1(b) and 2.1(c)).
All named alleles may have main eﬀects, e.g. σ1,G for the main eﬀect of allele G at
the ﬁrst site, and pairs of alleles may have interactions eﬀects, e.g. ρ(1,G),(4,A) for the
interaction between allele G at the ﬁrst site and allele A at the fourth site. The design
matrix for Site 4 includes rows for each possible allele at Site 4, including unobserved
alleles (Table 2.2). The design matrix for the other three sites includes rows for all ob-
served subhaplotypes (Table 2.3) and an extra row with ﬁxed ﬁtness for the composite
subhaplotypes Hu. Furthermore, since parameters σ2,T, ρ(1,G),(2,T), and ρ(2,T),(3,G) are
aliased, we collapse them into a single parameter σ2,T = ρ(1,G),(2,T) = ρ(2,T),(3,G).
In
this example, only the parameters σ1,G, σ3,G, and σ4,A are estimable because the other
parameters cannot be represented as linear combinations of observed haplotype log ﬁt-
nesses. Though there are many nonestimable parameters in this example, in the real

25
....
...A
..G.
.GG.
G...
GG..
GGG.
GTG.
GGGA
Figure 2.2: Example network of haplotypes in 2.1(a). Lines connect haplotypes separated
by Hamming distance 1. Using cutoﬀk = 1, we include all haplotypes in a single cluster.
and simulated datasets we analyze, less than 1% of parameters appearing in the ﬁtness
of sampled haplotypes were nonestimable.
Table 2.2: Design matrix for site 4
σ4,A
σ4,G
σ4,T
A
1
0
0
.
0
0
0
G
0
1
0
T
0
0
1
2.2.3
Inference
Parameters were estimated using the aﬃne-invariant ensemble sampler [63] as imple-
mented in the python package emcee [64]. This sampler is a population MCMC method
that runs many simultaneous chains and proposes updates for one chain based on other
chain positions. Let Xk(t) denote the position of chain k at time t, and Xk, without ar-
gument, the current position of chain k. The collection S = {Xk} is called the ensemble.
Let S−k = {Xj : j ̸= k}. The proposal for the new position of walker k at time t + 1 is:
X∗= X + Z[Xk(t) −X]

26
Table 2.3: Design matrix for haplotypes at sites 1, 2, and 3, including
only present haplotypes the composite haplotype, and parameters
involved in their ﬁtnesses. The ﬁtness eﬀect σH of the composite
haplotype is ﬁxed (not estimated).
σ1,G
σ2,G
σ2,T 1
σ3,G
ρ(1,G),(2,G)
ρ(1,G),(3,G)
ρ(2,G),(3,G)
σH
...
0
0
0
0
0
0
0
0
GGG
1
1
0
1
1
1
1
0
..G
0
0
0
1
0
0
0
0
.GG
0
1
0
1
0
0
1
0
GG.
1
1
0
0
1
0
0
0
G..
1
0
0
0
0
0
0
0
GTG
1
0
1
1
0
1
0
0
Hu
0
0
0
0
0
0
0
1
1 =ρ(1,G),(2,T) = ρ(2,T),(3,G)
where X is a random walker position drawn from S−k = {Xj : j ̸= k} and Z is a random
variable with pdf
g(z) ∝1
√zI

z ∈
1
a, a

.
The parameter a is tunable, with recommendation a = 2 suggested by the authors of
emcee, following [63]. The proposal is accepted with probability
min

1, ZD−1 p(X∗|y)
p(Xk(t)|y)

,
where D is the dimension of the parameter space and p(·|y) is the posterior density.
In our experience, with some theoretical support [9], tight constraints on the feasible
quasispecies ﬁtness parameters demand careful initialization of the sampler. With the
constraint that the mean ﬁtness at equilibrium is one, the quasispecies equation Eq. (2.2)
can be solved for any equilibrium vector p and ﬁxed mutation matrix Q as
w = diag(p)−1Q−1p.
(2.6)
Here, we have dropped the site subset index s to simplify notation. This equation can
be used to ﬁnd a starting value for w via the maximum likelihood estimate of haplo-

27
type relative frequencies ˆp [14] provided all elements of ˆp are nonzero. The PE ﬁtness
model Eq. (2.4) suggests estimating β from log w through a least squares ﬁt. In practice,
we use a constrained, weighted least squares approach with additional modiﬁcations to
ensure a valid quasispecies vector. Details are in Appendix A.1.
Separate MCMC samplers were run for each haplotype cluster and site group. In
all cases we used 200 walkers and retained 1,500 samples per walker after burn-in and
thinning. Details are in Appendix A.2.
Posterior predictive checks [65] are used to assess the adequacy of the ﬁtted model.
For every 250th retained sample β(i) from the posterior distribution (six samples per
walker and m = 1, 200 total samples), we simulated a new sample of the same size as
the original from the equilibrium distribution p(β(i)). In addition to counts of each hap-
lotype, we computed unnormalized linkage disequilibrium DAB = pAB −pApB between
each pair of observed non-reference alleles A and B, the total number of sampled haplo-
types (nh), and the number of singleton haplotypes (ns). For each statistic, we compute
a posterior predictive p-value using
max
 
1, 2 × min
 
1
m
m
X
i=1
I
 X(i)
rep ≤xobs

, 1
m
m
X
i=1
I
 X(i)
rep ≥xobs

!!
,
where X(i)
rep is the ith posterior predictive statistic and xobs is the observed value in the
dataset. Posterior predictive checks of haplotype counts and linkage disequilibrium are
expected to help in detection of incorrectly omitted interaction terms or violations of the
PE assumption due to the presence of higher order epistasis terms. Counts of singleton
haplotypes and total haplotypes may detect misspeciﬁed mutation rates or inappropriate
shrinkage of ﬁtness eﬀects. However, the potential to sample the composite haplotype Hu
in the posterior predictive distribution complicates use of these metrics. We can compute
a lower bound on the counts by assuming each occurrence of Hu is the same haplotype

28
and an upper bound by assuming each occurrence of Hu is a diﬀerent haplotype. Lack of
ﬁt is determined from the proportion of samples in which xobs falls outside these bounds.
2.2.4
Simulation
We designed a simulation study to (1) verify parameter estimates and credible in-
terval coverage under optimal conditions, (2) evaluate the sensitivity of the estimation
procedure to model assumptions and the values of ﬁxed parameters, and (3) compare
haplotype ﬁtness estimates with those provided by QuasiFit [14]. Simulated datasets
consisted of 1,000 or 10,000 four-site haplotypes. With only four sites and four bases per
site, it is computationally feasible to compute the equilibrium distribution over the entire
space of haplotypes, allowing simulation of data from the exact quasispecies equilibrium.
At the same time, ﬁtting the quasispecies model remains a moderate computational
challenge.
The simulation conditions were motivated by real data to make them as biologically
plausible as possible. In particular, we modeled our quasispecies after some of the am-
plicon data generated by [58]. After processing the data as described in §2.2.5, reads in
each amplicon were divided into clusters using the method described in section §2.2.2.1
with the count cutoﬀk equal to three. The number of clusters per amplicon varied from
one to 11, with a total of 35 clusters across the seven amplicons. Seven clusters from six
amplicons with coverage greater than 10,000 reads were selected as the basis of simulated
datasets.
To create our faux quasispecies, we used the 28 non-primer sites with the highest
minor allele frequencies from each of the clusters. Sites with higher minor allele fre-
quencies were preferred because there is greater power to detect linkage disequilibrium,
creating a more challenging estimation problem. The 28 sites were randomly separated
into seven sets of four sites. We will refer to each of these 49 groups of sites (7 sets
of sites in 7 clusters) as simulation conditions. For each simulation condition, quasis-

29
pecies equilibrium parameters consistent with the observed four-site haplotype relative
frequencies and the assumption of pairwise-only epistasis were generated using a model
ﬁtting process. Details of the procedures we used to ﬁnd these quasispecies equilibria are
discussed in Appendix A.3. Then, given quasispecies equilibria, we simulated datasets
with 1,000 or 10,000 haplotypes from a multinomial distribution over the full set of 44
haplotypes with a mutation probability of 3 × 10−5 per site per replication between all
nucleotides [66]. After generating simulated datasets, analyses were performed using
PEQuasi as described previously in §2.2.1 and §2.2.2.
2.2.5
HIV-1 data
2.2.5.1
HIV-1 gag epitopes
Both the simulated data and one of the real datasets were derived from the HIV-
1 data studied by [58] (NCBI Sequence Read Archive accession SRR1266602), where
HIV-1 RNA was extracted from 1 mL plasma taken from a patient on four diﬀerent
days post-infection. Twelve regions of approximately 188 nucleotide bases in the HIV-1
gag gene, some overlapping, were PCR-ampliﬁed using sequence-speciﬁc forward and
reverse primers. Each primer contained six random nucleotides that together formed
a 12-nucleotide tag to identify each ampliﬁed fragment. After a second PCR reaction,
products were sequenced using 2 × 100 paired-end reads on the Illumina HiSeq 2000.
From the SRA dataset, we constructed error corrected consensus (ecc) reads from
paired end reads sharing the same tag using a pipeline, detailed in Appendix A.4 and
inspired by, but not identical to, that of the original authors. We selected gag amino
acids 119-133 for analysis because this region contains two overlapping epitopes [58].
There were 47,234 ecc reads available for the amplicon containing this region. The ecc
reads were clustered using methods in §2.2.2.1 with k = 1. Analysis focused on the
largest three clusters, together containing 99.8% of all amplicon ecc reads. The total

30
number of sequences in each cluster were 37,653, 6,927 and 2,568, representing 306, 98
and 40 unique sequences, respectively.
2.2.5.2
HIV-1 V3 loop
The original source of this dataset was a study of gp120 from two HIV-1 infected
individuals sampled at ﬁve time points using Roche 454 sequencing [29] (NCBI Sequence
Read Archive accession SRR069893). Reads were aligned to HXB2 (GenBank acces-
sion number K03455.1), the same reference sequence used by the original authors, using
BWA-MEM [67] with default settings. A consensus sequence was constructed from the
aligned reads to produce a reference for a second alignment with BWA-MEM. The orig-
inal authors used a custom aligner, but otherwise followed a similar protocol. In the
second alignment, 1,626 aligned reads spanned the entire V3 loop region, comparable to
the 1,609 reads originally reported. Generally, aligned reads containing indel variants
were discarded (106 reads). However, a group of 270 reads containing the same three
nucleotide deletion was retained as this deletion was common among CXCR4-using vari-
ants from this patient [29]. The remaining reads were clustered into maximal connected
components using the method in §2.2.2.1 with k = 1. A total of 20 clusters were found.
Analysis focused on two clusters containing 1,195 and 252 reads, 89% of aligned reads
covering the V3 loop and 95% of all reads retained after removing reads with indels.
2.3
Results
We report inference of genetic ﬁtness eﬀects in the two HIV-1 datasets and method
performance in simulation. The main eﬀect of allele al at site l is the diﬀerence in log
ﬁtness produced by changing the reference allele at site l to al while leaving other sites
at their reference state. Beneﬁcial alleles have positive main eﬀects, deleterious alleles
have negative main eﬀects, and neutral alleles have zero main eﬀects. The interaction

31
between allele al at site l and allele am at site m is the diﬀerence in log ﬁtness between
a haplotype containing both alleles and the log ﬁtness predicted from allele main eﬀects
alone. Epistasis is inferred whenever there is a nonzero interaction. It is possible to
distinguish between antagonistic epistasis, in which the ﬁtness eﬀect of an allele pair is
smaller in magnitude than would be predicted from the individual eﬀects, and synergistic
epistasis, in which the magnitude is larger. Some aliased parameters also have meaningful
interpretations. For example, σl,al = ρ(l,al),(m,am) is the eﬀect of changing the reference
allele at site l to al on a reference haplotype with allele m substituted at site am.
In our experience, the ﬁtnesses of common haplotypes are tightly constrained at
the quasispecies equilibrium. Therefore, we expect parameters expressible as a linear
combination of the ﬁtnesses of common haplotypes to be tightly constrained as well. It
is helpful to introduce some notation for this phenomenon. Let Sp be the set of haplotypes
with population relative frequency at least p. Let E(S) be the set of all parameters that
may be expressed as linear combinations of log ﬁtnesses of haplotypes in S under the
PE ﬁtness model. We will say the parameter θ is p-estimable if θ ∈E(Sp). For any
parameter θ, deﬁne pmax(θ) = sup{p : θ ∈E(Sp)}.
2.3.1
HIV-1 data
Although we estimate ﬁtness eﬀects of nucleotide mutations, we are able to interpret
the associated amino acid changes in HIV-1 datasets because there were no estimated
interactions between nucleotides in the same codon. Additionally, because true parame-
ter values are unknown, we present posterior predictive checks. Convergence diagnostics
for each dataset are given in Appendix A.2.
2.3.1.1
HIV-1 gag epitopes
These data were originally obtained to study HIV-1 gag variation in a single patient
soon after infection [58]. The study used a nucleotide tagging approach to obtain error-

32
corrected sequences from Illumina paired-end reads. The authors found two subpopula-
tions alternating in dominance and detected the presence of previously described CD8+
T cell escape variants. We analyzed sequence data from the patient’s third visit, 43 days
after symptom onset and coinciding with peak viremia. We analyzed a 45 nucleotide
genetic region, of interest because it contained two previously described, overlapping
epitopes. Following the original authors [58], the ﬁrst nucleotide position in the focal
region will be numbered 355, and the ﬁrst amino acid position will be numbered 119.
Our dataset preprocessing identiﬁed three clusters. The two largest clusters appear to
match the two main groups reported by [58], who had suggested the patient was infected
by two or more founder viruses.
Cluster reference sequences, i.e. the most common
haplotypes in each cluster, are shown in Fig. 2.3 along with observed single nucleotide
variants and epitope locations. Variants are color-coded by the magnitude of their main
eﬀect. Cluster 1 in this analysis approximately corresponds to the authors’ less abundant
cluster containing amino acid variants 123E and 126N. The largest cluster 2 corresponds
to the authors’ other major cluster containing amino acid variants 123D and 126H. The
smallest cluster 3 has subtype B consensus variants 123G and 126S, also reported by the
authors at low frequency [58].
All main eﬀects are inferred to be deleterious relative to the most common sequence,
but some main eﬀects are only mildly deleterious. Because absent alleles can be com-
patible with a wide range of ﬁtnesses under the quasispecies equilibrium model, alleles
inferred to have a greater ﬁtness than absent alleles are of signiﬁcance. We have pos-
terior samples of absent allele ﬁtnesses for all datasets because absent allele ﬁtnesses
are inferred in single site subsets. Let D be the set of absent alleles with estimated
ﬁtnesses. We deﬁne a mildly deleterious allele to be an allele with a main eﬀect larger
than the ﬁtness main eﬀect of all absent alleles in at least 95% of posterior samples, i.e

33
Figure 2.3: Reference sequences and observed variants in HIV-1 gag dataset. Variants
are colored by their main eﬀect estimates. Hatched shading indicates the main eﬀect
is aliased with an interaction. Reference sequence positions diﬀering between clusters
highlighted in blue. Synonymous nucleotide changes are in italics.

34
one satisfying
min
(
1
m
m
X
i=1
I(σ(i)
l,al −σ(i)
s,as > 0) : (s, as) ∈D
)
≥0.95.
(2.7)
Posterior medians and 95% credible intervals for these select main eﬀects estimates are
reported in Table 2.4. (A complete list of all parameters and estimates are available
in Appendix A.5.)
All mildly deleterious eﬀects were nonsynonymous.
Both alleles
inferred to be mildly deleterious in cluster 1 were the dominant allele in cluster 2. One
of the two variants inferred to be only mildly deleterious in cluster 2 was the dominant
allele in cluster 1. Credible intervals for interaction eﬀects suggest at least two nonzero
interactions at the amino acid level (Table 2.4). In cluster 1, positive epistasis is detected
between F132Y and G124S (the latter previously identiﬁed as an escape variant [58]).
These two variants were both present in the cluster 2 reference haplotype. The epistasis
is antagonistic as F132Y is deleterious (Appendix A.5, Table A.5) and G124S is mildly
deleterious, but the combination is less deleterious. Another antagonistic interaction is
detected in cluster 2, where amino acid variant Y132F is only mildly deleterious in the
presence of variant H126N, but highly deleterious otherwise (Appendix A.5, Table A.6).
These two variants are present together in the cluster 1 consensus. Though individually
deleterious in one cluster, the positive interaction of these amino acid pairs may explain
their successful coexistence in the most common haplotype in another cluster.
Posterior predictive statistics are described in §2.2.3. Statistics used in the posterior
predictive analysis are haplotype counts, unnormalized linkage disequilibrium Dlal,mam
between alleles al at site l and am at site m, the total number of observed haplotypes
nh and the number of singleton haplotypes ns. In the table, haplotypes are represented
by their non-reference alleles. The posterior predictive analysis reveals an excess of total
and singleton haplotypes in datasets simulated from the posterior predictive distribution
(Table 2.5). Using a lower value of the prior parameter λ reduces the excess haplotypes in

35
simulated datasets (Table A.11), suggesting the prior preference for neutral ﬁtness eﬀects
is driving this lack of ﬁt. Three additional statistics show strong evidence of lack of ﬁt
in cluster 2. Alleles 375C and 395T do not co-occur in any posterior predictive sample,
but do so once in the observed data, causing a lack of ﬁt in both a haplotype count and
the linkage disequilibrium statistic D375C,395T. D376A,398A is also smaller in samples from
the posterior predictive distribution. Allele 398A is rare, only occurring three times in
the data and always with 376A. The pairs of sites involved in these quantities are in
diﬀerent site subsets, meaning their interaction was constrained to be zero (Table A.10).
Reanalysis with a higher value of the linkage disequilibrium cutoﬀputs these sites in the
same site subset, and alleviates lack of ﬁt for these quantities (Table A.11). However, no
new nonzero interactions are inferred.
Table 2.4: Select eﬀects estimated for the HIV-1 gag epitopes dataset.
Main eﬀect
estimates are displayed for all alleles inferred to be mildly deleterious and ordered from
highest to lowest ﬁtness. All nonzero interaction eﬀects displayed, ordered from largest
to smallest eﬀect magnitude. Amino acid variants are of the form XsY where X is the
cluster reference amino acid, s is the site, and Y is the variant.
Cluster
Parameter
Variant
Median
Lower
Upper
1
σ370,A
G124S
−4.2 × 10−5
−4.4 × 10−5
−3.9 × 10−5
2
σ376,A
H126N
−7.7 × 10−5
−8.0 × 10−5
−7.5 × 10−5
3
σ386,A
S129N
−4.5 × 10−3
−1.1 × 10−2
−2.2 × 10−3
1
σ395,A
F132Y
−5.4 × 10−3
−1.1 × 10−2
−3.1 × 10−3
3
σ359,T
A120V
−9.3 × 10−3
−3.6 × 10−2
−3.5 × 10−3
2
σ356,T
A119V
−2.4 × 10−2
−4.1 × 10−2
−1.5 × 10−2
2
ρ(376,A),(395,T )
H126N,Y132F
1.3 × 10−1
5.7 × 10−2
3.0 × 10−1
2
σ386,A = ρ(376,A),(386,A)
H126N,S129N
−1.6 × 10−2
−6.6 × 10−2
−5.9 × 10−3
2
σ359,T = ρ(359,T ),(376,A)
A120V,H126N
−9.1 × 10−3
−2.6 × 10−2
−4.1 × 10−3
1
ρ(370,A),(395,A)
G124S,F132Y
5.3 × 10−3
3.0 × 10−3
1.1 × 10−2
2.3.1.2
HIV-1 V3 loop
This dataset consists of HIV-1 gp120 Roche 454 reads from patient D, a participant
in a clinical study of the maraviroc antiviral [29], which inhibits virus entry by the
CCR5, but not the CXCR4, co-receptor.
The patient discontinued the study upon
showing insuﬃcient response to therapy. Since the authors studied the emergence and

36
Figure 2.4: Reference sequences and observed variants in HIV-1 V3 loop dataset. Vari-
ants are colored by their main eﬀect estimates. Hatched shading indicates the main eﬀect
is aliased with an interaction. Reference sequence positions diﬀering between clusters
highlighted in blue. Synonymous nucleotide changes are in italics.

37
Table 2.5: All quantities X with posterior predictive p-value less than 0.01 in the HIV-1
gag epitopes dataset ordered by cluster and p-value. For each statistic, the table shows
the p-value, the observed value, and the posterior predictive median.
Cluster
X
p-value
xobs
(Xrep)0.5
1
ns
< 0.001
9
55
1
nh
< 0.001
15
75
2
375C,395T
< 0.001
1
0
2
ns
< 0.001
19
60
2
nh
< 0.001
38
134
2
D376A,398A
0.003
0.00007
-0.0000032
2
D375C,395T
0.005
0.000026
-0.00000017
3
REF
< 0.001
2545
2507
3
ns
< 0.001
5
28
3
nh
< 0.001
11
41
evolution of viral variants using the CXCR4 co-receptor, we analyzed the 105 nucleotide
V3 loop region implicated in co-receptor choice using reads collected 10 weeks after
therapy discontinuation.
Positions in this dataset are numbered relative to the start of the V3 loop (coordinate
7110 in the HXB2 reference). We report results for the two most abundant and diverse
clusters of reads (Figure 2.4).
In the largest cluster (cluster 1), 92% of amino acid
sequences match the consensus for viruses predicted to use the CCR5 co-receptor [29].
In the smaller cluster (cluster 2), 64% of translated reads match the reported CXCR4-
using consensus.
All single mutations were inferred to be deleterious relative to the reference sequence
(Appendix A.5, Table A.8), but 19 in cluster 1 and four in cluster 2 were inferred to
be only mildly deleterious (Table 2.6). Two of the mildly deleterious cluster 1 main
eﬀects led to amino acid changes G24R and A33V, previously reported to be associated
with CXCR4-using variants in this patient [29]. However, the smallest main eﬀects (ap-
proximately neutral with respect to the reference) were synonymous changes. In cluster
2, there were four nonsynonymous main eﬀects approximately neutral with respect to
the reference. The smallest was reported by the original authors as a minor variant
among viruses predicted to use CXCR4. The second smallest occurs at a site diﬀering

38
between the CXCR4 consensus and the CCR5 consensus. No interactions were included
in the cluster 2 analysis because it partitioned into singletons only. In cluster 1, main ef-
fects aliased with interactions and all variants involved in the 13 interaction terms were
synonymous. Of the interactions with an inferred sign, ﬁve were synergistic negative
interactions and four were antagonistic positive interactions. The abundance of inter-
actions between synonymous variants in this cluster is diﬃcult to explain biologically.
RNA secondary structure may lead to epistasis [68], but HIV-1 V3 and other env vari-
able regions are relatively unstructured [69]. Hitchhiking of neutral variants following a
selective sweep with insuﬃcient time to equilibrate may be the most likely explanation.
Simulated datasets from the posterior predictive distribution have similar counts of
singleton and unique haplotypes to the observed data. Lack of ﬁt appears in counts of
rare haplotypes two or more mutations distant from the reference haplotype and the
associated measures of linkage disequilibrium (Table 2.7). All quantities showing lack of
ﬁt involved sites in diﬀerent site subsets, constrained to be unlinked (Table A.10). Vari-
ants 90G (I30M) and 98T (A33V) occur together more than predicted and both produce
amino acid changes reported for predicted CXCR4-using variants.
Other overrepre-
sented variant combinations are less interpretable. Increasing the LD p-value threshold
for grouping sites from 0.10 to 0.50 reduces the number of haplotype counts and LD
statistics showing lack of ﬁt (Table A.12), but does not eliminate them since most site
pairs implicated by the posterior predictive checks remain in diﬀerent site subsets. Still,
there is little information to estimate further interactions: 95% credible intervals for all
originally omitted interactions included zero in the reanalysis.

39
Table 2.6: Select eﬀects estimated from the HIV-1 V3 loop dataset. Main eﬀects shown
if mildly deleterious. All parameters including interaction eﬀects shown. Amino acid
variants are of the form XsY where X is the cluster reference amino acid, s is the site,
and Y is the variant. A dot indicates a synonymous variant.
Cluster
Parameter
Variant
Median
Lower
Upper
1
σ75,C
.
−8.3 × 10−6
−1.4 × 10−5
−3.3 × 10−6
1
σ93,G
.
−1.7 × 10−5
−2.6 × 10−5
−9.7 × 10−6
2
σ32,A
R11H
−1.8 × 10−5
−2.6 × 10−5
−1.1 × 10−5
1
σ3,C
.
−2.4 × 10−5
−3.3 × 10−5
−1.6 × 10−5
1
σ60,C
.
−1.3 × 10−4
−2.1 × 10−4
−8.3 × 10−5
1
σ15,T
.
−7.7 × 10−4
−1.3 × 10−2
−1.0 × 10−4
2
σ19,C
Y7H
−9.3 × 10−4
−4.0 × 10−3
−3.4 × 10−4
2
σ81,G
I27M
−9.3 × 10−4
−4.0 × 10−3
−3.4 × 10−4
1
σ87,C
.
−1.3 × 10−3
−5.5 × 10−3
−4.8 × 10−4
2
σ91,G
R31G
−1.5 × 10−3
−9.7 × 10−3
−4.4 × 10−4
1
σ54,G
.
−1.5 × 10−3
−5.3 × 10−3
−6.0 × 10−4
1
σ36,G
I12M
−1.8 × 10−3
−4.2 × 10−3
−9.1 × 10−4
1
σ103,C
C35R
−1.8 × 10−3
−4.2 × 10−3
−9.1 × 10−4
1
σ96,G
.
−2.5 × 10−3
−7.2 × 10−3
−1.2 × 10−3
1
σ9,G
.
−3.2 × 10−3
−1.1 × 10−2
−1.3 × 10−3
1
σ14,G
N5S
−4.4 × 10−3
−1.8 × 10−2
−1.6 × 10−3
1
σ98,T
A33V
−4.4 × 10−3
−1.8 × 10−2
−1.6 × 10−3
1
σ16,G
N6D
−4.4 × 10−3
−1.8 × 10−2
−1.6 × 10−3
1
σ70,A
G24R
−6.7 × 10−3
−3.8 × 10−2
−2.1 × 10−3
1
σ20,G
N7S
−6.8 × 10−3
−3.8 × 10−2
−2.1 × 10−3
1
σ101,G
H34R
−6.8 × 10−3
−3.8 × 10−2
−2.1 × 10−3
1
σ74,G
D25G
−6.8 × 10−3
−3.8 × 10−2
−2.1 × 10−3
1
σ25,G
R9G
−6.8 × 10−3
−3.8 × 10−2
−2.1 × 10−3
1
ρ(15,T ),(93,G)
.
−5.1 × 10−3
−9.8 × 10−2
−6.9 × 10−5
1
ρ(75,C),(93,G)
.
−4.4 × 10−3
−4.5 × 10−2
−8.8 × 10−4
1
ρ(54,G),(75,C)
.
1.5 × 10−3
6.0 × 10−4
5.3 × 10−3
1
ρ(3,C),(54,G)
.
−1.3 × 10−3
−1.0 × 10−2
−2.8 × 10−4
1
ρ(3,C),(87,C)
.
1.3 × 10−3
4.3 × 10−4
5.4 × 10−3
1
ρ(3,C),(15,T )
.
7.3 × 10−4
6.8 × 10−5
1.3 × 10−2
1
σ78,C = ρ(78,C),(87,C)
.
7.2 × 10−4
−7.6 × 10−3
4.8 × 10−3
1
ρ(15,T ),(60,C)
.
1.2 × 10−4
5.8 × 10−5
2.0 × 10−4
1
ρ(3,C),(93,G)
.
−9.0 × 10−5
−2.0 × 10−4
−3.0 × 10−5
1
σ12,C = ρ(12,C),(75,C)
.
−8.8 × 10−5
−1.6 × 10−4
−4.8 × 10−5
1
ρ(3,C),(75,C)
.
−2.5 × 10−5
−5.6 × 10−5
−5.7 × 10−7

40
Table 2.7: All quantities X with posterior predictive p-value less than 0.01 in the HIV-1
V3 loop dataset ordered by cluster and p-value. For each statistic, the table shows the
p-value, the observed value, and the posterior predictive median.
Cluster
X
p-value
xobs
(Xrep)0.5
1
93G,103C
< 0.001
5
0
1
3C,17G,54G,75C
< 0.001
1
0
1
6G,78C,87C
< 0.001
1
0
1
D90G,98T
< 0.001
0.00083
0
1
D93G,103C
< 0.001
0.0034
-0.00018
1
16G,60C
0.002
2
0
1
3C,69G,101G
0.002
1
0
1
75C,90G,98T
0.002
1
0
1
20G,36G,75C
0.002
1
0
1
D6G,78C
0.002
0.00082
0
1
D69G,101G
0.005
0.00083
0
1
D6G,87C
0.007
0.0008
0
1
D78C,86G
0.007
0.0008
-0.000016
1
15T,60C,103C
0.008
1
0
1
D3C,25G
0.008
0.0018
0
1
D20G,36G
0.008
0.00082
-0.000007
1
D33C,87C
0.008
0.0008
0
3
10T,19C,32A
< 0.001
1
0
3
D10T,19C
0.002
0.0039
0
3
D19C,32A
0.005
0.011
0

41
2.3.2
Simulation
Table 2.8: Characteristics of simulated datasets. Cells give the total number of param-
eters across 49 simulated datasets at each of two sample sizes N. Separate counts are
given for 0.01-estimable parameters and parameters that are not 0.01-estimable. Total is
the total number of ﬁtness eﬀect parameters appearing in the ﬁtnesses of observed hap-
lotypes. Columns Main, Interaction, and Mixed subdivide ﬁtness eﬀect parameters into
main eﬀects, interaction eﬀects, and groups of aliased parameters including both main
eﬀects and interactions. Note one fewer 0.01-estimable parameter at N=10,000. This is
because due to the presence of rare haplotypes at N=10,000, two previously aliased pa-
rameters were no longer aliased, and the component parameters were not 0.01-estimable.
Number of
Eﬀects In Model
N
pmax(θ)
Haplotypes
Total
Main
Interaction
Mixed
1000
< 0.01
151
156
133
14
9
1000
≥0.01
41
34
32
1
1
10000
< 0.01
403
379
330
38
11
10000
≥0.01
41
33
32
1
0
Our simulation study evaluates the quality of inference from the posterior distribu-
tions of haplotype ﬁtnesses and ﬁtness eﬀect parameters (main eﬀects, interactions, and
aliased eﬀects) on 49 simulated datasets at each of two sample sizes.
Datasets con-
sisting of 1,000 or 10,000 length-four haplotypes were simulated under the quasispecies
equilibrium assuming the PE ﬁtness model. Simulated datasets were designed to mimic
haplotype distributions observed in HIV-1 gag (§2.2.4).
We assess performance using rank correlation and absolute deviation between the
posterior median and true parameter values. Additionally, we compare the coverage of
95% and 80% credible intervals to the nominal level. For each measure of performance, we
present its mean and standard error across the 49 simulated datasets. We also compute
the same metrics on subcategories of parameters without regard to dataset membership.
For example, we report the proportion of 0.01-estimable parameters across all datasets
contained within their 95% credible intervals.
Table 2.8 summarizes the characteristics of the simulated datasets.
As expected,
more rare haplotypes are present when the number of sampled haplotypes N is larger.
Relatively few interaction parameters and aliased parameters including interaction eﬀects

42
(mixed parameters) are included in the models. Most parameters are not 0.01-estimable,
and interaction eﬀects and mixed parameters are less likely to be 0.01-estimable.
2.3.2.1
Estimation of ﬁtness main eﬀects and interactions
Table 2.9: Parameter estimation using PEQuasi. Parameters separated by whether they
are main eﬀects or interactions and by estimability. Dataset means and standard errors
also shown. Table shows coverage of 80% and 95% credible intervals, Kendall’s Tau
between true and posterior median parameters, the percent of 95% credible intervals
excluding zero, and the proportion of the former for which the inferred parameter sign
matched the truth.
Coverage
Sign
N
Type
80%
95%
Tau
% Inferred
% Correct
1000
Interaction
0.67
0.73
0.26
60
100
1000
Main Eﬀect
0.71
0.96
0.65
97.58
100
1000
Mixed
0.8
1
0.73
70
100
1000
< 0.01-estble
0.69
0.94
0.55
93.59
100
1000
≥0.01-estble
0.82
0.97
0.92
91.18
100
1000
Dataset Mean (SE)
0.73 (0.04)
0.97 (0.01)
0.72 (0.06)
94.55 (2.01)
100 (0)
10000
Interaction
0.67
0.87
0.7
69.23
100
10000
Main Eﬀect
0.72
0.94
0.73
99.45
100
10000
Mixed
0.82
0.91
0.6
100
100
10000
< 0.01-estble
0.72
0.93
0.72
96.83
100
10000
≥0.01-estble
0.64
0.91
0.98
93.94
100
10000
Dataset Mean (SE)
0.72 (0.03)
0.93 (0.01)
0.79 (0.03)
97.07 (0.81)
100 (0)
The rank order of ﬁtness eﬀects is biologically meaningful since it captures the relative
tolerance for single nucleotide mutations and pairs of mutations. Based on prior work
[14], it is also expected to be relatively robust to assumption violations. We measure
Kendall’s Tau rank correlation between the true parameter value θ and the posterior
median ˆθ. Rank correlation is variable across datasets, but moderately high, especially
for 0.01-estimable parameters (Table 2.9). Rank correlation is insensitive to the choice
of prior parameter λ (Appendix A.8, Table A.19).
Another performance measure is the absolute diﬀerence between true parameter val-
ues and their posterior medians. We ﬁnd a log-linear relationship between pmax(θ) and
|θ −ˆθ| (Figure 2.5). The absolute error of ˆθ is very low if θ is estimated from suﬃ-

43
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GGG
G
G
G
G
G
G
G
G
G
G
G
G
G
1e−07
1e−05
1e−03
1e−01
1e−05
1e−03
1e−01
pmax(θ)
|θ−θ^|
Parameter Type
G
Interaction
Main Effect
Mixed
N
G
G
1000
10000
Figure 2.5: Absolute diﬀerence between posterior median ˆθ and parameter value θ used
in simulation versus pmax(θ) for diﬀerent sample sizes N and classes of parameters (main
eﬀect, interaction, or aliased main eﬀects and interactions).
Note, both axes are on
logarithmic scale.

44
ciently common haplotypes. For example, the absolute error is typically below 0.001
for 0.01-estimable parameters. In addition, increasing the sample size improves estima-
tion. For a ﬁxed value of pmax(θ), error tends to be lower when N is higher. Choice of
prior parameter λ matters little to median absolute deviation for 0.01-estimable param-
eters (Appendix A.8, Table A.19). For parameters associated with rare haplotypes, the
optimal value of λ is likely to depend on the underlying distribution of ﬁtness eﬀects.
We also assessed performance through credible interval coverage. Averaged across
datasets, coverage of 95% credible intervals is close to the nominal level. Coverage of 80%
credible intervals falls short of the nominal level (Table 2.9). Credible interval coverage is
lower for interaction parameters than for any other type of parameter. Credible interval
coverage of parameters with very little supporting data, speciﬁcally, not 0.001-estimable,
can be greatly reduced if λ is too high, but otherwise the choice of λ has little impact on
coverage (Appendix A.8, Table A.19). Poor interval coverage may in part be attributable
to the prior. However, 0.01-estimable parameters, with estimates and credible interval
widths less sensitive to λ, do not always have higher coverage in our simulated datasets. It
is diﬃcult to detect diﬀerences in coverage between 0.01-estimable and other parameters
due to the small number of the former.
Signs of main eﬀect parameters determine which mutations are deleterious or beneﬁ-
cial with respect to the reference background. Signs of interaction parameters distinguish
positive and negative epistasis. On average, over 90% of 95% credible intervals exclude
zero, meaning a sign can be inferred at the 95% level, and all inferred signs were correct
(Table 2.9). Signs are more likely to be inferred for main eﬀects than interaction param-
eters: over 97% of main eﬀects had an inferred sign, compared to 60-70% of interaction
parameters.
The preceding results demonstrate statistical performance on datasets simulated
without higher order epistatic eﬀects. It is possible to assess the impact of higher order
epistasis by analyzing datasets simulated under a saturated ﬁtness model with only one

45
linear constraint on haplotype ﬁtnesses ensuring identiﬁability. By reparametrizing the
saturated model in terms of epistatic eﬀects of up to order L, we can compare main eﬀects
and pairwise interactions under the PE model to the true values used in simulation (Ap-
pendix A.7).
Comparing performance of PEQuasi and PEQuasi modiﬁed to include
higher order ﬁtness eﬀects allows us to quantify the performance impact of omitting
these parameters. Failure to include higher order epistatic terms lowers rank correlation,
credible interval coverage, and correct inference of parameter signs (Table A.15), though
the severity of the impact varies across parameters and datasets. Datasets in which the
impact is greatest have detectable lack of ﬁt by posterior predictive checks (Table A.17,
Figure A.5).
2.3.2.2
Misspeciﬁed mutation rate
Both QuasiFit and PEQuasi assume mutation rates are completely known, which if
correct, increases the power to detect ﬁtness eﬀects. We assess sensitivity to mutation
rate misspeciﬁcation by selecting 14 simulated datasets (two from each cluster) simulated
under the PE model with mutation rate 3×10−5 and reﬁtting them with six misspeciﬁed
mutation rates between 3 × 10−6 and 3 × 10−4. We do not expect high credible interval
coverage or low absolute error under these conditions, but previous results suggest rank
correlation may be well-preserved [14].
Estimated ﬁtness eﬀects ˆθ tend to be larger in magnitude (more negative, for main
eﬀects) for higher mutation rates, probably because high variant abundance can now be
explained as mutation from the ﬁttest variant. Thus, main eﬀects tend to be underesti-
mated when the mutation rate exceeds the truth. As a consequence, misspeciﬁcation of
mutation rate tends to increase absolute error (Figure 2.6), especially for 0.01-estimable
parameters and coverage of 95% credible intervals (Table 2.10).
Posterior predictive
checks usually provide little evidence for lack of ﬁt, although using a mutation rate 10-
fold too high resulted in either an excess of observed haplotypes or an unusually high

46
occurrence of Hu in 10 of 14 simulated datasets (Appendix A.8, Table A.20). Despite
the estimation error and our inability to detect it, rank correlations between ˆθ and θ
are barely aﬀected (Table 2.10) and all inferred parameter signs were correct (data not
shown).
The same 14 simulated datasets were also used to explore the eﬀects of misspeciﬁed
mutation matrix structure. The datasets were simulated with a transition/transversion
ratio κ equal to one and ﬁt to the quasispecies model assuming the same per site mu-
tation rate, but with transition/transversion ratios varying between two and six. All
examined performance metrics worsen, though rank correlations indicate we retain some
ability to distinguish the relative magnitude of ﬁtness eﬀects (Table 2.11). Misspeci-
ﬁed transition/transversion ratio aﬀects ﬁtness eﬀect rank order because the magnitude
and possibly direction of mutation rate misspeciﬁcation diﬀers between pairs of muta-
tions. Main eﬀects associated with mutations whose rate has been disproportionately
overestimated will be disproportionately underestimated.
Table 2.10: Performance of PEQuasi as a function of mutation rate used in ﬁtting the
model on 14 datasets of 10,000 simulated haplotypes. The true value of mutation rate
was 3×10−5. Table shows Kendall’s Tau between true and posterior median parameters,
coverage of 95% credible intervals, mean absolute value of parameter estimates, and mean
95% credible interval width.
q
Tau
Coverage
|ˆθ|
θ0.975 −θ0.025
3.0 × 10−6
0.74
0.42
0.012
0.09
1.0 × 10−5
0.75
0.50
0.023
0.12
1.5 × 10−5
0.75
0.62
0.029
0.13
3.0 × 10−5
0.76
0.91
0.043
0.16
6.0 × 10−5
0.76
0.61
0.065
0.19
9.0 × 10−5
0.76
0.56
0.081
0.21
3.0 × 10−4
0.75
0.40
0.161
0.29
2.3.2.3
Estimation of haplotype ﬁtness and comparison to QuasiFit
We are aware of one other method that estimates quasispecies equilibrium model
parameters: QuasiFit [14]. This method has a working implementation freely available
for download. We ran QuasiFit using the default diﬀerential evolution MCMC tuning

47
GG
G
G
G
G
G
G
GGG
G
GG
G
G
GG
G
G
GGGGG
GG
G
G
G
G
G
G
G
G
G
G
G
GGGG
G
G
GG
G
G
G
G
GGG
G
G
G
G
G
G
G
G
G
G
GG
G
G
GG
GGG
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
GG
G
GG
G
G
G
G
G
G
GGG
G
G
G
G
G
GG
G
GGGGGG
GG
G
G
G
G
G
G
G
G
G
G
G
GGG
G
G
G
GG
G
G
G
G
GGG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
GGG
GGG
G
G
G
G
G
G
G
G
G
GG
GG
G
G
G
G
G
GG
G
G
GG
G
GG
G
G
GG
G
G
GGG
G
G
G
G
G
GG
G
GGGGGG
G
G
G
G
G
G
G
G
G
G
GG
G
GGG
G
G
G
GG
G
G
G
G
GGGG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
GGG
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
GG
GG
GG
GG
G
GG
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
GG
G
G
GGG
GG
G
G
G
G
G
G
G
G
G
G
GGG
G
G
G
G
G
G
G
G
G
GGG
G
G
G
G
G
G
GG
G
G
G
G
G
G
GG
GGG
GG
G
G
G
GG
G
G
G
G
GG
G
G
GG
G
G
G
G
GGG
G
GG
G
GGG
G
G
G
G
G
G
G
G
G
G
G
G
GGG
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
GGG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GGG
GGG
G
G
G
G
GG
G
G
GGG
G
G
G
G
G
G
G
G
G
G
GG
GG
GG
G
GG
G
GG
G
G
G
G
GG
GG
GG
G
GG
G
G
G
G
G
GGG
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
GGG
G
G
G
G
G
G
G
G
G
G
G
GGG
G
G
G
GGG
GGG
GG
GGGGG
GG
G
G
G
GG
G
GGGG
G
G
G
G
G
G
GG
G
G
GG
G
G
GG
G
G
GG
G
G
G
G
G
G
G
G
G
G
GG
G
GGGGGG
G
G
G
G
G
G
G
G
G
GGG
G
GGG
G
G
G
G
G
G
G
G
G
GGGG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
GGG
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
GGG
G
G
GG
G
G
GG
G
G
G
G
G
GGG
GG
GG
G
G
GG
GGG
G
G
G
G
GG
GG
GGGGG
G
G
G
G
G
G
GG
G
G
GG
G
GG
G
G
G
G
G
G
GG
GG
G
GG
G
G
G
G
G
G
GG
G
G
GG
G
GG
G
G
G
G
G
G
GG
GG
G
GGG
GG
G
G
G
GG
G
G
GG
G
GG
G
G
G
G
G
G
GGG
G
G
G
G
G
G
G
G
GGG
G
G
G
GG
G
GG
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
G
GGG
G
G
G
GG
G
GG
G
G
G
GG
G
GG
GGG
GG
G
G
G
G
GGG
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
GG
GG
G
G
G
G
G
G
G
G
G
GG
GG
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
GG
G
G
N = 10000
pmax(θ) < 0.001
0.001 ≤pmax(θ) < 0.01
pmax(θ) ≥0.01
3e−06
1e−05
1.5e−05
3e−05
6e−05
9e−05
3e−04
0.001
0.010
0.100
0.001
0.100
1e−05
1e−03
Mutation Rate
|θ−θ^|
Figure 2.6: Absolute error in parameter estimation for diﬀerent values of the per site
mutation rate used in ﬁtting the model. The true value of θ is compared to the posterior
median ˆθ. The x-axis is not to scale. Boxplots show the distribution of absolute error for
parameter values involved in the ﬁtness of present haplotypes, combined across datasets.
Parameters are divided in to three bins according to their value of pmax(θ): pmax(θ) >
0.01, 0.001 ≤pmax(θ) ≤0.01, and pmax(θ) < 0.001.
Results are from 14 simulated
datasets of N = 10, 000 four-site haplotypes simulated under the quasispecies model
with a mutation rate of 3 × 10−5.

48
Table 2.11: Performance of PEQuasi on 14 datasets of 10,000 simulated haplotypes as
a function of transition/transversion ratio κ. The true value used in simulation was 1.
Table shows Kendall’s Tau between true and posterior median parameters, coverage of
95% credible intervals and median absolute deviation of parameter estimates (MAD).
κ
Tau
MAD
Coverage
1
0.76
0.017
0.91
2
0.72
0.022
0.72
4
0.66
0.028
0.59
6
0.62
0.031
0.51
parameters and its native initialization method.
The number of walkers, number of
iterations, and spacing between iterations in QuasiFit were set to the same values used
in PEQuasi for multi-site subsets (§2.2.3). Both PEQuasi and QuasiFit used the true
per site mutation rate 3 × 10−5, equal transition and transversion mutation rates, and
were required to meet the same convergence criteria.
QuasiFit estimates haplotype ﬁtnesses without parsing the ﬁtness into the main, in-
teraction, and combined eﬀects of individual alleles, so we only compare haplotype ﬁtness
estimates. Rank correlation between posterior median and true haplotype ﬁtnesses are
comparable for PEQuasi and QuasiFit (Table 2.12). Both methods performed better at
higher sample size. On average, posterior median haplotype ﬁtnesses using PEQuasi are
closer to the true value, especially for highly abundant haplotypes (Figure 2.7) Cover-
age of credible intervals for haplotype ﬁtnesses is slightly below the nominal level using
the PEQuasi method, but QuasiFit coverage is further reduced, apparently due to the
much lower coverage for common haplotype ﬁtnesses (Table 2.12). The diﬀerent ways
the two methods account for unobserved haplotypes may explain PEQuasi’s advantage
(Appendix A.9, Table A.22 and Figure A.9).
Unlike PEQuasi’s ﬁtness model, QuasiFit’s saturated ﬁtness model can accommodate
ﬁtness landscapes including higher order epistatic interactions. When data are simulated
under a model including higher order epistasis terms, rank correlation between true and
posterior median haplotype ﬁtnesses remains comparable between the two methods (Ap-
pendix A.7, Table A.16). Both methods have low credible interval coverage, but QuasiFit

49
performs better when averaged across datasets and haplotypes. Still, PEQuasi retains its
advantage over QuasiFit in point estimation and credible interval coverage for common
haplotype ﬁtnesses. Even when no higher order interaction terms are present, PEQuasi
may ﬁt a diﬀerent ﬁtness model than QuasiFit if it incorrectly omits interaction terms,
but we found little evidence that these omissions aﬀect performance (Appendix A.10,
Table A.24).
Because ﬁtting the quasispecies model is computationally intensive, timing is another
important consideration when comparing QuasiFit and PEQuasi. Eﬀective sample sizes,
after discarding the ﬁrst half of iterations as burn-in, were computed in R using the
package coda [70]. PEQuasi and QuasiFit were compared by dividing the eﬀective sample
size by the total run time.
QuasiFit easily outperformed PEQuasi by this measure,
increasing the eﬀective sample size by an average 673 per second, compared to PEQuasi,
which increased the eﬀective sample size by an average of nine per second. The superior
performance of QuasiFit is driven both by fewer seconds per iteration and typically larger
eﬀective sample size for the same number of iterations.
Table 2.12: Haplotype ﬁtness estimation using PEQuasi and QuasiFit for two diﬀerent
values of sample size. Parameters separated by estimability. Dataset means and standard
errors also shown. Table shows coverage of 80% and 95% credible intervals and Kendall’s
Tau between true and posterior median ﬁtness.
Coverage
N
Method
Type
80%
95%
Tau
1000
PEQuasi
< 0.01-estble
0.66
0.91
0.49
1000
QuasiFit
< 0.01-estble
0.76
0.93
0.55
1000
PEQuasi
≥0.01-estble
0.83
0.98
0.93
1000
QuasiFit
≥0.01-estble
0.44
0.63
0.87
10000
PEQuasi
< 0.01-estble
0.72
0.92
0.69
10000
QuasiFit
< 0.01-estble
0.78
0.92
0.67
10000
PEQuasi
≥0.01-estble
0.68
0.93
0.97
10000
QuasiFit
≥0.01-estble
0.15
0.2
0.88
1000
PEQuasi
Dataset Mean (SE)
0.71 (0.04)
0.95 (0.02)
0.68 (0.06)
1000
QuasiFit
Dataset Mean (SE)
0.69 (0.03)
0.86 (0.02)
0.67 (0.06)
10000
PEQuasi
Dataset Mean (SE)
0.72 (0.03)
0.92 (0.01)
0.76 (0.03)
10000
QuasiFit
Dataset Mean (SE)
0.72 (0.02)
0.86 (0.01)
0.73 (0.03)

50
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GGG
G
G
G
G
GG
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
GG
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
1000
10000
1e−07
1e−04
1e−01
1e−07
1e−04
1e−01
1e−06
1e−04
1e−02
|θ−θ^|PWEQuasi
|θ−θ^|QuasiFit
0.1
0.2
0.3
0.4
0.5
p
Figure 2.7: Absolute error in posterior median haplotype ﬁtnesses using the QuasiFit and
PEQuasi methods. Panels show results for 49 simulated datasets at diﬀerent numbers of
simulated haplotypes N. Color scale shows the haplotype population relative frequency.

51
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
gag−1
V3−1
0.01
0.10
0.01
0.10
0.99980
0.99985
0.99990
0.99995
1.00000
Relative Frequency
w^
Hamming 
 Distance
GG
GG
GG
1
2
3
Figure 2.8: Posterior median and 95% credible intervals for select haplotype ﬁtnesses in
cluster 1 of the HIV-1 gag dataset and cluster 1 of the HIV-1 V3 loop dataset. Fitness
estimates are shown for all haplotypes occurring more than 10 times and at greater than
1% relative frequency. The reference haplotype ﬁtness estimate is not shown as it is ﬁxed
at 1. Points are colored by the Hamming distance from the reference sequence.
2.4
Discussion
We have introduced the PEQuasi method for estimating mutational ﬁtness eﬀects
and pairwise epistasis from a cross-sectional sample of viruses within a host, evaluated
its performance on simulated data, compared it to an alternative method QuasiFit, and
demonstrated its application to the analysis of HIV-1 ﬁtness landscapes. An important
advantage of the PEQuasi method over the QuasiFit method is providing estimates for
the eﬀects of individual mutations and pairs of mutations.
The authors of QuasiFit
provide some suggestions about how such a goal might be accomplished using their
method [14, 55], but no generally applicable algorithm.
Our method found evidence for nonsynonymous mutations with only small deleterious
eﬀects on ﬁtness relative to ﬁtness peaks in HIV-1 gag and the HIV-1 V3 loop. In the

52
HIV-1 gag epitopes dataset, some of these were previously recognized escape mutants.
Our estimated ﬁtness eﬀects can suggest pathways between ﬁtness peaks (cluster centers).
For example, in cluster 2, H126N is relatively well tolerated, but Y132F is not. However,
Y132F is better tolerated in the presence of H126N. Both variants co-occur in the cluster
1 peak.
Haplotype ﬁtness inferences diﬀered from those based on a naive approach. It is
natural to assume that the most common haplotypes are the most ﬁt, but the quasis-
pecies model predicts some common haplotypes are abundant only because they are well-
connected, through mutation, to more ﬁt haplotypes. In fact, the quasispecies equilibrium
model explains simulated datasets better than the most common/most ﬁt assumption
even when the quasispecies has not reached equilibrium [14]. Our data conﬁrm this dis-
connect between haplotype abundance and ﬁtness. While there is a positive association
between abundance and estimated ﬁtness (rank correlation in HIV-1 datasets between
0.55 and 0.87), rare haplotypes at high Hamming distance from the most abundant
sequence are sometimes inferred to be more ﬁt than more common variants (Figure 2.8).
Our analysis of simulated data allowed us to compare PEQuasi and QuasiFit. Using
the PEQuasi method, haplotype ﬁtness estimates may be computed from their con-
stituent ﬁtness eﬀects and compared to QuasiFit’s estimates. The PEQuasi method has
comparable rank correlation between true and estimated haplotype ﬁtnesses to QuasiFit.
Under correct model speciﬁcation, credible interval coverage is closer to the nominal level.
QuasiFit frequently estimates rare haplotype ﬁtnesses more accurately, while PEQuasi
estimates common haplotype ﬁtnesses more accurately. Although computational speed
of PEQuasi is adequate to analyze genetic regions of interest to investigators, QuasiFit
can obtain the same number of samples from the posterior distribution in considerably
less time, and appears to have a more robust initialization method leading to fewer
convergence problems. Unfortunately, QuasiFit’s initialization and sampling methods

53
cannot be directly applied to the PEQuasi method as they depend on having exactly one
linear constraint on haplotype ﬁtnesses.
Three major diﬀerences between PEQuasi and QuasiFit might explain the observed
diﬀerences in estimation performance: the diﬀerent ﬁtness models, diﬀerences in prior
distribution, and diﬀerent strategies for adjusting the mutation matrix for unobserved
haplotypes. Although the pairwise interaction model Eq. (2.4) is a reparametrization
of the saturated ﬁtness model in all our simulated datasets, the PEQuasi ﬁtted model
may not be because our methodology drops what it deems to be weak interactions. We
explored the eﬀect of omitting interaction parameters, changing the Laplace prior param-
eter, and using QuasiFit’s diagonal mutation matrix strategy on PEQuasi performance.
While QuasiFit uses a ﬂat prior for unobserved haplotype ﬁtnesses, PEQuasi uses a
Laplace prior with parameter λ. At our default value λ = 10, allele ﬁtness eﬀects are
pulled towards neutrality. Setting the prior parameter λ = 1 will result in a more uniform
distribution of unobserved single nucleotide mutant haplotype ﬁtnesses (Appendix A.8).
Suﬃciently low values of λ will pull ﬁtness estimates strongly towards lethality. The
optimal value of the prior parameter λ should depend on the underlying distribution
of single nucleotide mutation ﬁtness eﬀects. Prior parameter λ = 1 might be expected
to most closely resemble QuasiFit’s prior assumptions. Using this value of the prior
parameter improves PEQuasi credible interval coverage of < 0.001-estimable parameters
over the coverage at the default value of 10.
For suﬃciently short genetic regions, it is possible to compare the composite haplo-
type approximation to the quasispecies equilibrium with exact results. In this case, we
ﬁnd the approximation is good, and that it is better than the approximation without
the composite haplotype (A.9). We reanalyzed our simulated datasets using QuasiFit’s
diagonal method in place of our composite haplotype method. Absolute diﬀerences in
parameter estimates are small (Figure A.9), but nonetheless appreciably impact rank
correlation and credible interval coverage of common haplotype ﬁtnesses as these in-

54
tervals are suﬃciently narrow (Table A.22). This may explain superior estimation of
common haplotype ﬁtnesses using PEQuasi.
The PEQuasi approach to dropping interactions between sites showing insuﬃcient
evidence of LD permits the application of this method to longer genetic regions. Unlinked
sites are consistent with a model in which all interactions between the sites are zero,
though it is possible there are underlying nonzero interaction terms. We prefer to use
the simplest model that can explain the observed data for reasons of parsimony and
computational convenience. In real and simulated datasets reanalyzed with a higher LD
p-value cutoﬀthan the default value, we ﬁnd 95% credible intervals for originally omitted
interactions almost always include zero. Including additional parameters in real datasets
can sometimes alleviate lack of ﬁt, but in simulated data, the eﬀect on rank correlation,
credible interval coverage, and median absolute deviation of other parameters appears
minor (Appendix A.10) as changes in point estimates tend to be small relative to their
uncertainty.
In our model, main eﬀect parameters are clearly interpreted as the eﬀect of single
nucleotide diﬀerences from the reference haplotype on log ﬁtness. Interpretation of in-
teraction and aliased parameters warrants additional consideration. The only estimable
quantities are linear combinations of haplotype ﬁtnesses. This means we cannot dis-
tinguish where interactions are occurring biologically. For example, consider a simple
population with reference haplotype AA and other haplotypes AC, CA, and CC. Sup-
pose a molecular interaction enhances the function of AA relative to other haplotypes.
This interaction will lead to ρ(1,C),(2,C) > 0 in our parameterization. Alternative full rank
parametrization will change which parameters become nonzero as a result of this physical
interaction, but no linear model of haplotype ﬁtnesses can identify which speciﬁc alleles
in a site pair with a nonzero interaction are involved in molecular interactions.
Aliased parameters of the form σ(l,al) = ρ(l,al),(m,am) also deserve special consideration
as the data may contain some information about the constituent parameters even though

55
they are not individually estimable in our current model. If a common and an unobserved
haplotype are separated by a Hamming distance of 1, we can generally infer the ﬁtness
of the latter is lower. Otherwise, we would expect it to dominate the population (if
suﬃciently ﬁtter than the most common haplotype), or to coexist at high frequency with
the dominate haplotype if neutral [9]. For example, if we observed a sample with 600 AA,
100 CA and 300 CC, but no occurrence of AC, we may infer that σ2,C < 0 (otherwise we
would expect to see AC in the sample) and that ρ(1,C),(2,C) > 0 (otherwise, given the low
value of σ2,C we would not expect to see CC). Our current method would simply infer that
σ2,C = ρ(1,C),(2,C) > 0 with no indication of which term(s) in the aliased parameter were
positive. It is possible to augment the set of haplotypes with the unobserved haplotype
AC in order to get this information about parameter signs. However, we ﬁnd doing so
frequently introduces a prohibitively large number of haplotypes.
The presence of higher order interactions violates the assumption of the PEQuasi
model and can increase error of main eﬀect and interaction estimates. When such terms
are not aliased with lower order terms, haplotype ﬁtness estimation is also aﬀected. How-
ever, estimates of common haplotype ﬁtnesses are minimally aﬀected. The existence of
datasets in which the PEQuasi observed haplotype ﬁtness model diﬀers from the satu-
rated model requires the presence of a large fraction of the total possible combinations
of alleles at L ≥3 sites. For example, for L = 3 and two observed alleles per site, all
eight possible combinations of alleles must be observed in the data. Most amplicons and
clusters in the HIV-1 gag dataset did not have this property. Of amplicons that did have
this property, a small number of very rare haplotypes were responsible, suggesting that
although higher order interactions may occur in real ﬁtness landscapes [56], methods
relying on observed haplotype counts can seldom estimate them.
Omission of important interaction terms, the presence of higher order interactions,
misspeciﬁcation of the mutation matrix, and poor choice of prior parameter λ can aﬀect
ﬁtness eﬀect estimation. In particular, we have shown that misspeciﬁcation of mutation

56
rate decreases credible interval coverage and misspeciﬁed transition to transversion ratio
additionally decreases rank correlation between estimated and true ﬁtness eﬀects. In
some cases, we can detect these problems with posterior predictive checks. We used
posterior predictive checks to assess the ability of the ﬁtted model to explain observed
properties of the HIV datasets. In both datasets, we found some evidence of rare allele
combinations that did not appear in the posterior predictive distribution. However, a
measurement of average mutational distance of rare haplotypes from common haplotypes
was not higher in data than in posterior predictive samples, suggesting that although any
given combination of rare alleles may be unusual, it is not unusual to have some such
combination under the ﬁtted model (Table A.13).
Additionally, posterior predictive
checks indicate that the uncorrected HIV-1 V3 reads match posterior predictive samples
in the total number of haplotypes and total number of singleton haplotypes. However,
the error-corrected HIV-1 gag dataset has fewer total and singleton haplotypes than
expected. In the analysis of both real datasets, our estimates of rare variant ﬁtness eﬀects
should be biased towards neutrality due to the choice of prior parameter. Reanalysis of
the HIV-1 gag dataset with the prior parameter λ = 0.1 reduces the number of unique
haplotypes in posterior predictive datasets, but the largest cluster is still less diverse
than any posterior predictive sample (Table A.11). It is hard to explain this eﬀect by
overestimation of rare haplotype ﬁtnesses, as the new prior distribution strongly favored
near lethality of rare and absent alleles (Figure A.1). Fitting the model with a too high
mutation rate can produce an excess of unique haplotypes in the posterior predictive
distribution (Table A.20). Alternatively, it is possible some step in the sequencing or
data processing procedure reduced diversity in the processed dataset relative to the
population.
NGS reads contain errors with rates varying based on platform, position within the
read, sequence context, and error type [71]. Sequencing errors might be expected to
inﬂate estimates of rare variant ﬁtnesses by increasing their prevalence in the dataset

57
relative to their population frequencies. Newer sequencing strategies involving replicate
reads of fragments derived from the same original virus haplotype [45, 72] may be a way
to reduce error rates. One of the two HIV datasets analyzed in this paper was generated
using this strategy [58], and we used a larger region of this dataset to generate our
simulated datasets. Methods for constructing error-corrected haplotypes (e.g. ShoRAH
[73]) may be applied when replication is unavailable, for example in the HIV-1 V3 loop
dataset. This dataset was sequenced using Roche 454 pyrosequencing, which produces
more indel errors than substitution errors. We removed sequences with indel variants, but
elected not to perform other error correction out of the concern that it would also remove
genuine biological variation.
Alignment is another concern, especially for the highly
variable V3 loop dataset. Poor aligner and reference choice could lead to discarding true
variants due to insuﬃcient similarity with the reference [29]. We are encouraged that
we found similar numbers of aligned reads as reported in the original reference, but the
authors’ custom alignment procedure might produce better results.
Perhaps the most serious concern about both PEQuasi and QuasiFit is whether the
assumption of quasispecies equilibrium is a reasonable approximation to reality. Nonequi-
librium could occur because of a long equilibration time in a static ﬁtness landscape, or
because of a rapidly changing landscape. Encouragingly, the authors of QuasiFit ﬁnd
that their method still ﬁnds information about the rank order of haplotype ﬁtnesses in
nonequilibrium populations [14]. We additionally focus our modeling eﬀorts on clus-
ters of haplotypes connected in Hamming space, rather than connecting clusters with
unobserved haplotypes, reasoning there is more potential for equilibration within such
a cluster than between distant clusters. Our choice of datasets to analyze reﬂects ge-
netic regions of interest to biologists, but on such datasets the equilibrium assumption
may be the most questionable. The HIV-1 V3 loop region may still be far from equilib-
rium in Patient D due to initiation and cessation of maraviroc treatment, both of which
would be expected to change the ﬁtness landscape for this region. The region of interest

58
in HIV-1 gag was identiﬁed as two overlapping epitopes, which could also experience
changing selection pressure from an evolving immune response. However, alternative as-
sumptions are also suspect. The authors observed an alternation in the most abundant
variants between time points [58], which is not only inconsistent with a single quasis-
pecies equilibrium, but also is diﬃcult to explain with a static ﬁtness landscape, assumed
by alternative methods [74]. Despite changes in selection, local regions of sequence space
could still be close to equilibrium. Depending on parameters of the quasispecies model,
equilibration in suﬃciently local regions of sequence space could be fast relative to the
timescale of sequence landscape change. The most apparent trends in both datasets are
frequency changes of major clusters of sequences. Fitness landscape changes might aﬀect
which of two distant peaks are favored without having a large eﬀect on the relative ﬁtness
of variants within each peak. Other virus populations showing less variation and more
temporal stability, such as some Antarctic picorna-like viruses described in [75], may be
better candidates for ﬁtting the quasispecies equilibrium model.
The quasispecies model has been highly inﬂuential in the understanding of RNA virus
evolution [76]. It provides an explanation of the sometimes overwhelming diversity of
virus populations in terms of two fundamental processes. If the model is correct, we
can estimate mutational ﬁtness eﬀects with unprecedented detail from the rich datasets
currently available. In our analysis of HIV-1 gag epitopes, estimation of main eﬀects and
interactions generated testable hypotheses about viable evolutionary pathways between
ﬁtness peaks. Fitting the quasispecies model can also help us learn in what contexts and
over what genetic scales it best applies, important given the prominence of this model.
Our analysis of the HIV-1 V3 loop revealed evidence for large numbers of interactions
between synonymous variants under the quasispecies equilibrium assumption. Because
the V3 loop is not thought to be rich in RNA secondary structure, our ﬁnding of sig-
niﬁcant interactions between synonymous changes under the quasispecies equilibrium
assumption raises the possibility that other evolutionary mechanisms are at play.

59
CHAPTER 3.
APPLICABILITY OF THE EQUILIBRIUM
QUASISPECIES MODEL TO MULTIMODAL VIRUS
POPULATIONS
3.1
Introduction
The quasispecies equilibrium model, introduced in §1.2, is a popular model for virus
populations.
For a simple, single peak ﬁtness landscape, at low mutation rates, the
ﬁttest sequence and its single nucleotide mutants will dominate the population. At high
mutation rates, the ﬁttest sequence is no longer most abundant and the population
distribution of sequences approaches a uniform distribution over the entire sequence
space [6]. For simple ﬁtness landscapes, there is an abrupt transition between these two
regimes [77] at a mutation rate termed the error threshold [5]. Life exists below the error
threshold and in some cases it may be reasonable to assume quasispecies equilibrium is
achieved.
The advent of high throughput sequencing is now making it possible to estimate
ﬁtnesses from sequencing data. For example, a recent Bayesian method, QuasiFit, es-
timates virus haplotype ﬁtnesses from a cross-sectional sample under the quasispecies
equilibrium model [14]. In Chapter 2, we presented a new method for estimating the
eﬀects of single nucleotide mutations and epistatic interactions on ﬁtness, also from cross-
sectional samples. Neither dataset we analyzed there displays patterns characteristic of a
single peak landscape. While certain haplotypes are far more common than others, there
are multiple abundant, and sometimes highly separated, haplotypes. For example, the

60
two most common haplotypes in the 45 nucleotide HIV-1 gag epitopes region [58] occur
at respective relative frequencies of 70% and 11%, and are separated by a Hamming
distance of ﬁve. It is possible to explain such an outcome with a quasispecies equilib-
rium, but the conditions may be highly restrictive and biologically implausible. Now
that quasispecies equilibrium can be compared with real data, it is time to assess the
biological relevance of the model. Do real populations exist at quasispecies equilibrium?
Or are they close enough to produce meaningful ﬁtness and mutation estimates?
One troubling aspect of estimation at the quasispecies equilibrium is that the smallest
magnitude ﬁtness eﬀects are the best estimated. We explain this counterintuitive result
by the suggestion that small deviations from the ﬁtness of the dominant sequence have
large eﬀects on equilibrium relative frequency. Any large ﬁtness deviation will lead to
a low equilibrium relative frequency and little data for estimation. Diﬀerences between
small relative frequencies may be diﬃcult to estimate in realistically sized samples so
there are limits on what ﬁtness eﬀects are well-estimated when quasispecies equilibrium
holds and therefore what biological questions may be answered. In particular, while
we can easily distinguish neutral or almost neutral mutations from highly deleterious
mutations, we cannot distinguish a moderately deleterious mutation (say, one that de-
creases ﬁtness by 50%) from a lethal mutation under the quasispecies equilibrium model
at realistic sample sizes.
It is also striking how diﬃcult it is to ﬁnd ﬁtnesses capable of reproducing observed
population diversity under realistic mutation rates. Assuming a mutation rate of 3×10−5,
coexistence of multiple haplotypes at high relative frequency requires tight constraints on
the ﬁtness landscape. Indeed, credible intervals for such haplotype ﬁtnesses are inﬁnites-
imally narrow in our simulation study §2.3.2 and naive initialization approaches were
unsuccessful §A.1. Achieving coexistence became even more diﬃcult as more mutations
separated common haplotypes. It was extremely diﬃcult to generate synthetic quasis-
pecies with two common haplotypes (ﬁtness peaks) separated by a Hamming distance of

61
two or greater without common intermediates. Such quasispecies were highly sensitive to
the ﬁtnesses of the single mutants surrounding each ﬁtness peak. At Hamming distances
greater than three, the quasispecies became highly sensitive to ﬁtness landscape pertur-
bations on the order of machine precision. Perturbation sensitivity presents a challenge
to model realism because even in a stable environmental, it is unrealistic to assume that
two distinct haplotypes have precisely equal ﬁtness.
Finally, analysis of HIV-1 data produced results that were diﬃcult to interpret from a
biological standpoint. While almost neutral ﬁtness eﬀects and interactions in the HIV-1
gag dataset were interpretable, it is surprising that no synonymous mutations (mutations
not altering amino acid sequence) were among them. Synonymous mutations can aﬀect
ﬁtness through their eﬀects on RNA secondary structure, binding and methylation sites
and through codon use eﬀects, and it is therefore not surprising to ﬁnd deviations from
neutrality [78, 79]. However, other studies of HIV-1 support the claim that synonymous
mutations are on average less deleterious than nonsynonymous mutations via dN/dS < 1
for most sites [80, 81], as does our analysis of the V3 loop ﬁtness landscape. The main
discrepancy of the V3 loop analysis with biological predictions is ﬁnding nonzero interac-
tions between synonymous mutations at well-separated sites. RNA secondary structure
is a possible explanation as it involves pairing between possibly distant bases. How-
ever, comparisons with measurements using the SHAPE method for detecting secondary
structure indicate the sites involved in interactions are not likely to be involved in sec-
ondary structure [69]. Together, these observations raise concerns about the real life
applicability of the quasispecies equilibrium.
In this chapter, we use quasispecies equilibrium to derive bounds for haplotype ﬁtness
as a function of haplotype equilibrium relative frequencies to support the claim haplo-
type ﬁtnesses are constrained near one at equilibrium. Using QuasiFit with quadruple
precision enabled, we show the eﬀect of distance between haplotypes, mutant cloud ﬁt-
ness, and ﬁtness of intermediate haplotypes on ﬁtness estimates in a quasispecies of

62
length three haplotypes. Finally, we address the question of the time to reach equilib-
rium in a quasispecies, showing the importance of Hamming distance between ﬁtness
peaks, mutant cloud ﬁtness, mutation rate, and peak ﬁtness on the rate of approach
to equilibrium. We conclude it is diﬃcult to explain coexisting common haplotypes at
quasispecies equilibrium, especially at high Hamming distances.
3.2
Bounds on haplotype ﬁtness
In this section, we bound the ﬁtness of a haplotype in the quasispecies equilibrium
model as a function of the per site per replication event mutation rate q, its equilibrium
relative frequency p, the number of alleles per site A and haplotype length L. Then, for a
range of values of p, q, and L, we numerically widen the bounds to account for sampling
uncertainty of p.
Assume quasispecies equilibrium over a genetic region of length L with A alleles
per site. Adopt the identiﬁability constraint that mean ﬁtness at equilibrium is 1 and
assume a mutation matrix of the form given in Eq. (2.3). Assume all haplotype ﬁtnesses
are strictly greater than zero. Then Eq. (2.6) applies. This equation gives a formula for
the ﬁtness of haplotype i
wi =
AL
X
l=1
pl
pi
˜qil
(3.1)
in terms of equilibrium haplotype relative frequencies and elements of the inverse muta-
tion matrix ˜qil. This equation can be used to obtain exact ﬁtness values wi for the case
L = 1 and bounds on ﬁtness for L > 1. For the remainder of the section, also assume
q
A−1 < 0.5, which will always hold if a particular allele is more likely to be correctly than
incorrectly copied.

63
3.2.1
Case: A=2, L=1
Label the alleles 0 and 1 and deﬁne mutation matrix
Q =


1 −q
q
q
1 −q

.
Eq. (3.1) gives
w0 = 1 −q
1 −2q −
q
1 −2q
1 −p0
p0
w1 = 1 −q
1 −2q −
q
1 −2q
p0
1 −p0
.
If p0 = q or 1 −p0 = q, one ﬁtness will be zero and the other
1
1−q. If either p0 < q or
1−p0 < q, p = (p0, 1−p0) does not correspond to a valid quasispecies because it implies
negative elements in w. For q near zero, using a ﬁrst-order Taylor series expansion,
w0 ≈1 + q

1 −1 −p0
p0

w1 ≈1 + q

1 −
p0
1 −p0

.
When both haplotypes are common and the mutation rate is low, both ﬁtness values will
be close to 1.
3.2.2
General case
Consider haplotypes of length L with A alleles per site, labeled (0, 1, . . . , A-1). Let
Q1 =

1 −
Aq
A −1

I +
q
A −111′

64
be the mutation matrix for L = 1. Provided q ̸= A−1
A
this matrix has an inverse.
Q−1
1
=
1
1 −
A
A−1q

I −
q
A −111′

.
If haplotypes of length L are considered as integers in base A and ordered accordingly,
under Eq. (2.3) the mutation matrix Q can be written as Kronecker product [60]
QL = Q1 ⊗QL−1.
Q−1
L = Q−1
1
⊗Q−1
L−1
exists with elements
˜qil =
1
(1 −
A
A−1q)L

1 −
q
A −1
dil 
−
q
A −1
L−dil
.
Rewrite Eq. (3.1) as
wi =
AL
X
l=1
pl
pi
˜qil = ˜qii +
X
l̸=i
pl
pi
˜qil
(3.2)
=
 1 −
q
A−1
L
(1 −
A
A−1q)L +
1
(1 −
A
A−1q)L
X
l̸=i
pl
pi

1 −
q
A −1
dil 
−
q
A −1
L−dil
and assuming
 1 −
q
A−1

>
q
A−1, for L > 1, oﬀ-diagonal elements of Q−1 are bounded
below by
bl =
1
(1 −
A
A−1q)L

1 −
q
A −1
L−1 
−
q
A −1
1
(3.3)
and above by
bu =
1
(1 −
A
A−1q)L

1 −
q
A −1
L−2 
−
q
A −1
2
.
(3.4)

65
For L = 1 all oﬀ-diagonal elements are equal to the lower bound. The bounds for L > 1
imply bounds
Bl,i =
 1 −
q
A−1
L
(1 −
A
A−1q)L + 1 −pi
pi
bl ≤wi ≤
 1 −
q
A−1
L
(1 −
A
A−1q)L + 1 −pi
pi
bu = Bu,i
(3.5)
For L = 1, wi is exactly equal to the lower bound in the equation above.
The lower bound Bl,i is zero if pi =
q
A−1 and negative below this value. For L = 1,
this implies an invalid quasispecies as Bl,i = wi. Otherwise, the lower bound is adjusted
to zero, always a lower bound on ﬁtness in our model. Similarly,
1
pi is always an upper
bound for wi if the mean ﬁtness at equilibrium is 1. For high pi and per haplotype
mutation rates, this bound is tighter than Bu,i so we use it instead. If it is less than the
lower bound, the quasispecies is invalid. Deﬁne
Rq =
1 −
q
A−1
1 −
Aq
A−1
.
Rq > 1 for all q > 0 and A ≥1. Bu,i > 1 as RL
q > 1 and 1−pi
pi bu > 0. As haplotype i
becomes dominant, both bounds approach a common limit.
lim
pi→1 Bl,i = lim
pi→1 Bu,i = RL
q
(3.6)
Bl,i is monotonically increasing in pi and Bu,i is monotonically decreasing in pi, so bounds
become tighter as pi increases. For suﬃciently small per haplotype mutation rate and
suﬃciently common haplotypes, ﬁtness upper and lower bounds are near the population
mean ﬁtness 1.
3.2.3
Numerical exploration of bounds on w
Figure 3.1 shows the upper and lower bounds on haplotype ﬁtness as a function of
equilibrium relative frequency computed from Eq. (3.5). Bounds Bl and Bu are initially

66
L=1
L=10
L=100
L=1000
L=10000
q=1e−08
q=1e−07
q=1e−06
q=1e−05
q=1e−04
q=0.001
1e−05
1e−03
1e−01
1e−05
1e−03
1e−01
1e−05
1e−03
1e−01
1e−05
1e−03
1e−01
1e−05
1e−03
1e−01
0.997
0.998
0.999
1.000
0.97
0.98
0.99
1.00
0.7
0.8
0.9
1.0
0.0
0.3
0.6
0.9
0
1
2
0
1
2
3
p
fitness
Figure 3.1: Lower and upper bounds on haplotype ﬁtness as a function of equilibrium
haplotype relative frequency. Area between upper and lower bounds is shaded. Rows
show results for diﬀerent mutation rates (note diﬀerent y-scales). Columns show results
for diﬀerent genome length. Bottom right panel omitted as common haplotypes cannot
exist in this scenario. Dashed lines show bounds with sampling uncertainty for a sample
of size 10,000. Results for A=2 and A=4 were qualitatively similar so we only show the
latter.

67
loose but converge as predicted to a common value as p increases. Tight bounds are
achieved more rapidly at lower mutation rates. Also as predicted, the plateau in the
lower bound usually occurs at a ﬁtness of approximately one. The exception is at high
values of per haplotype genome mutation rate (roughly around 0.1 to 1 per haplotype).
For the highest value of per haplotype mutation rate we considered, the plateau is at
a suﬃciently high ﬁtness value that ﬁtnesses of all other haplotypes would have to be
negative, in violation of model assumptions, to explain the occurrence of this haplotype
in the population so this panel is omitted.
We can also adjust bounds for sampling uncertainty. For a given count c and sam-
ple size N, we can compute a conﬁdence interval using the binom.test function in R.
From Eq. (3.5) for L > 1, the upper bound is monotonically decreasing in p and the
lower bound is monotonically increasing in p. Therefore for L > 1 we can compute
bounds using the lower conﬁdence limit of p to obtain bounds on the haplotype ﬁtness
that hold for all plausible values of p. For L = 1, in which upper and lower bounds are
always equal, we compute a lower bound from the lower conﬁdence limit of p and an
upper bound from the upper conﬁdence limit.
Even accounting for sampling uncertainty, we remain conﬁdent that many sampled
haplotypes have ﬁtness close to one (dashed lines in Figure 3.1) solely based on these
bounds. For suﬃciently low per haplotype mutation rates and sample sizes, the ﬁtness
of any sampled haplotype may be conﬁdently bounded near one. This supports the idea
that credible intervals for common haplotype ﬁtnesses must be narrow under a broad
range of conditions in the quasispecies equilibrium model.
In ﬁtting the quasispecies equilibrium model, we have also observed that ﬁtness cred-
ible intervals for rare haplotypes tend to be wider. Though we observe bounds on wi
become tighter as pi increases, for L > 1, ﬁtness uncertainty in Figure 3.1 could pri-
marily reﬂect loose bounds rather than sampling uncertainty. However, for L = 1, all
uncertainty is from sampling. At low values of mutation rate, even a count of 1 may

68
be highly informative about the ﬁtness of a haplotype if the mutation rate is suﬃciently
low and the sample size is suﬃciently small. For higher values of mutation rate similar
to those we used in our simulation study, a count of 1 is compatible with virtually any
value of ﬁtness between zero and 1.
In summary, for all but the highest per haplotype mutation rates, haplotype ﬁtnesses
compatible a given equilibrium relative frequency are highly constrained. Constraints on
ﬁtness given a sample from a quasispecies will be looser because a given sample count is
compatible with a range of equilibrium relative frequencies, but can still be tight.
3.3
Eﬀect of Hamming distance on quasispecies equilibrium
In the previous section, we showed the assumption of quasispecies equilibrium implies
tight constraints on the relative ﬁtness of common haplotypes. However, that analysis
did not address how ﬁtness landscape structure inﬂuences the strength of the constraint.
Our experience leads us to believe constraints on common haplotype ﬁtness are strongest
for ﬁtness landscapes with multiple peaks surrounded by low ﬁtness valleys, and that
constraints on ﬁtness may extend to the mutant clouds surrounding each haplotype.
In this section we ﬁt the quasispecies model to artiﬁcial datasets with two common
haplotypes, which we will call modal haplotypes. We vary the Hamming distance between
modal haplotypes and the abundance structure of their mutant clouds. Our numerical
exploration of these populations reveals tight, possibly unrealistic, constraints on the
ﬁtness parameters consistent with bimodality.
Throughout this section, we consider a genetic region with L = 3 sites and A = 2
alleles per site, for a total of eight haplotypes. We assume a population with two modal
haplotypes, one at approximately 90% relative frequency and another at approximately
10% relative frequency. Each common haplotype is surrounded by a cloud of rare single
nucleotide mutants with overlap in clouds when modal haplotypes are close. We use

69
QuasiFit to estimate the ﬁtness landscape associated with each synthetic population.
We use a large sample size, 300,000, to reduce uncertainty in the estimated haplotype
ﬁtnesses. Errors in the standard eigendecomposition algorithms provided by R and scipy
make it diﬃcult to study such quasispecies, but the QuasiFit quadruple precision sam-
pler [14] makes exploration feasible. For all simulated datasets, QuasiFit was run with
default settings except the parameter κ was set to 1 (same mutation rate between all base
pairs). We attempted to analyze length four haplotypes with Hamming distance four
between modal haplotypes, but QuasiFit’s usually rapid initialization procedure failed
to terminate when applied to such datasets.
Table 3.1: Posterior median and 95% credible interval for ﬁtness diﬀerence between
modal haplotypes for diﬀerent values of their Hamming distance dH. Table also gives
haplotype counts for each synthetic dataset.
dH AAA
CCC
ACC
CAC
CCA
AAC
ACA
CAA
median
lower
upper
1
269974
0
0
1
1
9
9
30006
8.9E-05
8.8E-05
9.0E-05
2
269973
1
0
0
29997
9
10
10
4.7E-09
2.5E-09
7.6E-09
3
269973 29997
1
1
1
9
9
9
1.6E-15
-6.6E-10
1.3E-09
In our ﬁrst simulation, we set the combined cloud relative frequency in the sample
to 10−4 and vary the Hamming distance between common haplotypes from one to three.
Observed counts and ﬁtness estimates for this simulation are given in Table 3.1. As
the distance between the two modal haplotypes increases, the point estimate of the
ﬁtness diﬀerence approaches zero. At a Hamming distance of two, we detect the more
common haplotype as more ﬁt, but the set of possible ﬁtness parameters consistent with
the observed haplotype counts is minuscule. By a Hamming distance of three, there is
no detectable ﬁtness diﬀerence even using our very large sample size. At all Hamming
distances, marginal distributions of cloud haplotype ﬁtnesses are relatively wide, with
95% credible interval widths ranging from 0.48 to 0.95. However, when modal haplotypes
are separated by Hamming distance two or three, modal haplotype ﬁtness estimates are
correlated with ﬁtness estimates of haplotypes in their Hamming distance one clouds
(data not shown).

70
Table 3.2: Posterior median and 95% credible interval for ﬁtness
diﬀerence between modal haplotypes separated by Hamming dis-
tance 3 for diﬀerent values of cloud haplotype frequency. Cloud
haplotypes either occur in proportion to the abundance of their
nearest modal haplotype or at equal frequency for both peaks.
Table also gives haplotype counts for each synthetic dataset. For
a given modal haplotype, all cloud members have equal frequen-
cies.
pcloud
AAA
CCC
ACC1
AAC2
median
lower
upper
1.0E-04
269973
29997
1
9
1.6E-15
-6.6E-10
1.3E-09
1.0E-03
269730
29970
10
90
-7.1E-10
-3.9E-09
3.3E-09
1.0E-02
267300
29700
100
900
-5.7E-10
-1.2E-08
1.2E-08
1.0E-01
243000
27000
1000
9000
-9.5E-10
-4.5E-08
4.3E-08
1.0E-04
269973
29997
5
5
3.7E-09
1.7E-09
6.4E-09
1.0E-03
269730
29970
50
50
4.4E-08
3.6E-08
5.2E-08
1.0E-02
267300
29700
500
500
4.5E-07
4.2E-07
4.7E-07
1.0E-01
243000
27000
5000
5000
4.9E-06
4.8E-06
5.0E-06
1 =CAC=CCA
2 =ACA=CAA
To suss the cause of the tight equality constraints on the ﬁtnesses of the two modal
haplotypes, we hold the Hamming distance at three and vary the total cloud relative
frequency between 10−4 and 10−1 in our second set of simulations. If we increase the
cloud haplotypes in proportion to the frequency of their closest modal haplotype, the rel-
ative ﬁtnesses of the two common variants remain indistinguishable, although the range
of plausible values increases slightly (Table 3.2). Only when the frequency of the mu-
tant cloud is not explained by the mutation rate cum frequency of the associated modal
haplotype, are ﬁtness diﬀerences plausible, in fact necessary to explain the cloud frequen-
cies. For example, when the clouds of both parent haplotypes occur at equal frequency,
then we are conﬁdent that the more common haplotype has greater ﬁtness (Table 3.2).
We still detect a ﬁtness diﬀerence if only one mutant per cloud is disproportionately
abundant (data not shown). Furthermore, as the cloud frequency increases, the point
estimate of the ﬁtness diﬀerence between the two haplotypes increases.
When L = 3 and A = 2, all cloud haplotypes are also intermediate between two
Hamming distance three peaks. It seems plausible that intermediate haplotypes would

71
have a special status as they provide a mutational connection between the two peaks.
However, in artiﬁcial datasets with three alleles per site, we obtain virtually identical
posterior distributions of peak ﬁtness diﬀerences regardless of whether cloud haplotypes
with elevated abundance are intermediate between ﬁtness peaks (not shown). While the
cloud abundance distribution aﬀects estimates of peak ﬁtnesses, which cloud elements
have each abundance does not seem important.
We conclude from these simulations that the ﬁtnesses of highly separated haplotypes
are determined by their mutant clouds and assumptions about mutation rates. In partic-
ular, our simulations show that over-populated mutant clouds imply lower ﬁtness of their
center haplotype, whose success is partly explained by inﬂux from its successful mutant
cloud. If mutation rates are homogeneous throughout the ﬁtness landscape, the coexis-
tence of common, but separated haplotypes demands unrealistically matched ﬁtnesses,
especially when there is no evidence for diﬀerences in the collective ﬁtnesses of their mu-
tant clouds. The concern is not simply the narrowness of credible intervals for individual
ﬁtnesses, as this may not be surprising at a large sample size, but that extremely small
variations in ﬁtness underlie large diﬀerences in equilibrium relative frequency, suggest-
ing that populations are not stable even in the face of minor perturbations of the ﬁtness
landscape, a prediction that does not seem consistent with life as we know it.
3.4
Approach to equilibrium
Another concern with the quasispecies model is the timescale of approach to equilib-
rium relative to the timescale of within-host infection and the timescale of ﬁtness land-
scape change. This may be a greater concern when there are highly separated haplotypes
with only low ﬁtness intermediates. Here, we are speciﬁcally concerned with how closely
the mutant distribution surrounding a ﬁtness peak approaches its equilibrium value.
Several existing publications address rate of convergence to equilibrium. For example,

72
Fegn and colleagues [82] deﬁne relaxation time τ in the quasispecies model as analogous
to correlation length in statistical mechanics, computed from the ﬁrst two eigenvalues
of the matrix QW . Other existing works concern the timescale of approach to a ﬁtness
optimum on a single peak landscape [83, 84] or complex ﬁtness surface [85, 86] starting
at an arbitrary point possibly far from the optimum. This is an important question, but
distinct from the subject of this work. Here, we consider a population initialized at a
local ﬁtness optimum, and determine how quickly the surrounding mutant distribution
approaches its equilibrium value. Additionally, because observed virus populations often
contain more than one modal sequence, we consider two peak ﬁtness landscapes.
We look at timescale of approach to equilibrium of artiﬁcial quasispecies over a ge-
netic region of length L = 3 with A = 4 alleles per site by numerical integration of
the quasispecies equation Eq. (2.1) starting from a genetically homogeneous population
composed of a single founder haplotype. We consider two ﬁtness peaks separated by
Hamming distance of zero (one peak), one or two. We assign four ﬁtness values. The
ﬁrst peak has ﬁtness value f1. The second peak, if present, is either a neutral variant,
f2 = f1, or suﬃciently unﬁt so that the ﬁrst peak haplotype is between 2 and 1,000 times
more abundant at equilibrium. The haplotypes occupying these peaks will be referred to
as h1 and h2 respectively and their equilibrium ratio will be denoted by p1,eq/p2,eq. If the
Hamming distance d1,2 between the ﬁrst two peaks is two we additionally assign ﬁtness
f3 between 0.5 and 0.9999 to one haplotype h3 connecting the two peaks in Hamming
space. Other haplotypes, which we will call cloud haplotypes, are assigned relative ﬁtness
f4 = 0.5 which determines the appropriate value of f2 in combination with f3. Figure 3.2
shows an example ﬁtness landscape for d1,2 with only two alleles per site for simplicity.
The probability that error-prone replication of haplotype j produces haplotype i
follows the mutation model in Eq. (2.3). We considered two diﬀerent mutation rates q:
the widely used reverse transcriptase mutation rate 3 × 10−5 and a higher mutation rate
4 × 10−3 reported in a recent publication for HIV-1 [87]. We evaluate the composition

73
CCC
f4
CAC
f4
CCA
f2
ACC
f4
ACA
f4
CAA
f3
AAC
f4
AAA
f1
Figure 3.2: Eight haplotype landscape with d1,2 = 2 illustrating our ﬁtness landscape
structure.
of the ﬁnite time quasispecies over a time span of 104 units. Because increasing the time
scale x-fold has the same eﬀect on the ﬁnite time quasispecies as increasing all ﬁtnesses
x-fold, we do not separately consider varying f1 and t. However, correspondence between
our time scale and interpretable units such as days will depend on plausible values of the
replication rate. With f1 = 1, each time unit will correspond to one day if we assume a
doubling time of the ﬁttest sequence growing in isolation without mutation is 0.69 days.
This is close to the reported estimate of 0.65 days for HIV-1 in vivo [88].
There are many possible metrics for how close a population is to equilibrium. We
chose to look at Euclidean distance between nonequilibrium and equilibrium relative
frequency vectors and abundance ratios of haplotypes in each ﬁtness class. We show the
ratio of peak 2 abundance to its equilibrium value in Figure 3.3. Qualitative patterns
for mutants surrounding peak 2 are similar and not shown.
Underrepresentation of
peak 2 and surrounding haplotypes is compensated by overrepresentation of haplotypes
surrounding peak 1.
For many studied parameter conﬁgurations, approach to equilibrium is slow relative
to timescales of within-host infection (Figure 3.3). This is especially true when mutation
rate is at the lower reverse transcriptase error rate, when h1 and h2 are approximately
equal in abundance, and f3 is small. When q = 3×10−5, f1 = f2 = 1, f3 = f4 = 0.5, and

74
d1, 2 = 1 , f3 = 0.5
d1, 2 = 2 , f3 = 0.5
d1, 2 = 2 , f3 = 0.9
d1, 2 = 2 , f3 = 0.99
d1, 2 = 2 , f3 = 0.9999
q = 3e−05
q = 0.004
10
1000
10
1000
10
1000
10
1000
10
1000
1e−08
1e−05
1e−02
1e−08
1e−05
1e−02
t
p2(t) p2, eq
p1, eq p2, eq
1
2
5
10
20
50
100
200
500
1000
Figure 3.3: Temporal evolution of three-site quasispecies on bimodal ﬁtness landscape
initialized from most ﬁt haplotype. We show the ratio of the population relative frequency
p2(t) of the lower peak h2 to its equilibrium value p2,eq through time. Color indicates
the ratio of h1 and h2 equilibrium frequency. Rows show results for two diﬀerent values
of mutation rate q, while columns show results for diﬀerent ﬁtness landscape conﬁgu-
rations. In the ﬁrst column, the two “peaks” are adjacent, satisfying d1,2 = 1. In the
remaining columns, d1,2 = 2 and one haplotype connecting h1 and h2 is assigned ﬁtness
f3. Conditions with f2 < f3 not shown as in this case h2 is not a ﬁtness peak. In all
cases f4 = 0.5.

75
dh1, h2 = 0 , f3 = 0.5
dh1, h2 = 1 , f3 = 0.5
dh1, h2 = 2 , f3 = 0.5
q = 3e−05
q = 0.004
10
1000
10
1000
10
1000
1e−12
1e−08
1e−04
1e−12
1e−08
1e−04
t
deuc(plocal(t), peq)
p1, eq p2, eq
1
2
5
10
20
50
100
200
500
1000
Figure 3.4: Temporal evolution of local quasispecies plocal(t) initialized from most ﬁt
haplotype. A local quasispecies is here deﬁned as haplotype relative frequencies renor-
malized to the set of all haplotypes hi such that di,1 > di,2. The y-axis shows Euclidean
distance deuc to the renormalized equilibrium quasispecies, truncated at 10−15. The left-
most panel shows results for a single peak quasispecies, where the local quasispecies is
the whole quasispecies. The middle panel shows results for d1,2 = 1, and the rightmost
panel shows results for d1,2 = 2. Conditions with f2 < f3 not shown as in this case h2 is
not a ﬁtness peak. In all cases f3 = f4 = 0.5.

76
d1,2 = 2, even after 10,000 generations, abundance of peak 2 is only 0.0003%, compared
to equilibrium value just under 50%. While it could conceivably be detected as a ﬁtness
peak given its abundance several orders of magnitude over that expected by production
from mutation from h1, its rarity would make it hard to detect at realistic sequencing
depths.
When d1,2 = 1, h2 is generated by mutation from h1 at higher frequency, so p2(t)/p2,eq
is higher after the same amount of time. For example, when mutation rate is 0.004, d1,2 =
1, and h2 makes up 0.5% of the equilibrium population, peak 2 abundance achieves 90%
of its equilibrium value by 10 time units, which is rapid relative to the timescale of chronic
infection. Even so, we cannot assume that haplotypes separated by a Hamming distance
of 1 will reach equilibrium over realistic timescales. At the lower reverse transcriptase
error rate and when f1 = f2, p2(t) remains several fold below its equilibrium value after
10,000 time units. Though equilibrium is approached more rapidly for peaks when f3
is higher, p2(t) remains orders of magnitude below its equilibrium value for most of the
course of infection.
In contrast to bimodal ﬁtness landscapes, mutant distributions in single peak ﬁtness
landscapes initialized with pure modal haplotype rapidly approach equilibrium (Fig-
ure 3.4, left) (unless f4 ≈1, not shown: for almost ﬂat landscapes, approach is slow
because the equilibrium distribution is approximately uniform over haplotypes). For bi-
modal ﬁtness landscapes, we can deﬁne a local equilibrium around h1 as the quasispecies
equilibrium renormalized to the set of haplotypes closer to h1 than h2, i.e.
plocal,i =







pi,eq
P
j:dj,1<dj,2 pj,eq
di,1 < di,2
0
otherwise.
We can compute the same renormalized relative frequencies for the nonequilibrium qua-
sispecies to determine the approach to local equilibrium. Approach to local equilibrium

77
occurs in phases. The ﬁrst phase closely resembles the rapid approach to equilibrium on
a single peak ﬁtness landscape at a rate that does not depend strongly on mutation rate
or distance between the two peaks (Figure 3.4, center and right). In the second phase,
the distance plateaus at value that is higher for higher q, d1,2 and p1,eq/p2,eq. The plateau
may occur because although all local haplotypes are closest to the ﬁttest peak, they are
at diﬀerent distances from the second peak, so diﬀer in the relative amounts of ﬂux from
this peak. The ﬁnal distance to the local equilibrium is approached much more slowly,
and for d1,2 = 2 is not achieved by 10,000 time units except for under the most favorable
values of q and p1,eq/p2,eq.
3.5
Discussion
Our work supports the concern that extensive neutral variation delays the approach
to the quasispecies equilibrium to the extent that it is an unrealistic assumption for
natural populations [17, 89]. Further, we show neither precise neutrality nor extensive
neutral networks are needed to make the quasispecies equilibrium assumption suspect.
Our bounds on quasispecies ﬁtness show mathematically that the quasispecies equilib-
rium constrains the ﬁtness of common haplotypes near one, and therefore also constrains
their relative ﬁtnesses near one. Analysis of synthetic datasets demonstrates that relative
ﬁtnesses of common haplotypes are more tightly constrained when they are separated
by a greater Hamming distance and that relative cloud abundance is important to esti-
mating the ﬁtness of distant haplotypes. Our observations are consistent with a previous
study deriving the behavior of quasispecies with two equal magnitude ﬁtness peaks as
the mutation rate approaches zero. When separated by a Hamming distance of 2, their
relative abundance at equilibrium becomes sensitive to the ﬁtnesses of surrounding hap-
lotypes. When separated by a Hamming distance of 3, the population approaches either
100% peak 1 or 100% peak 2 [9]. Fitness constraints implied by coexistence require ex-

78
tremely similar peak haplotype ﬁtnesses. Small ﬁtness landscape ﬂuctuations can cause
drastic changes in equilibrium relative frequencies, making stable bimodal equilibrium
populations implausible.
Quasispecies equilibrium is rapidly established is when there is a single ﬁtness peak
surrounded by a low ﬁtness cloud. When there are multiple common coexisting haplo-
types under the quasispecies equilibrium, convergence to equilibrium from a single ini-
tial infecting haplotype is frequently slow relative to the typical timescale of within-host
evolution. This is likely because coexistence of two high-frequency haplotypes under
quasispecies equilibrium generally requires a very small ﬁtness diﬀerence between the
two §3.2. However, the near neutrality of the two haplotypes also means convergence to
their equilibrium relative frequencies is slow.
Convergence to equilibrium is faster when haplotypes are only separated by a Ham-
ming distance of one, or when relatively high ﬁtness intermediates connect two ﬁtness
peaks, compatible with our clustering strategy. However, it is still questionable whether
equilibrium will be achieved over the course of infection, particularly if the ﬁtness land-
scape is not static. The fact that neutral Hamming distance one haplotypes can fail to
rapidly achieve their equilibrium relative frequencies under plausible assumptions about
mutation rate and virus doubling time may explain the dearth of synonymous mutants
from the reference sequence in the HIV-1 gag sample, leading to their low estimated ﬁt-
ness. An explanation for linkage between synonymous variants is less directly apparent.
However, if these variants were out of equilibrium due to an event such as a selective
sweep, there would not be strong selective forces to rapidly restore equilibrium.
Equilibrium is a more realistic assumption if HIV-1 mutation rates are close to a recent
high estimate [87]. Assuming a lower doubling time for HIV-1 such as an alternative
estimate of 0.42 days [90] would reduce the number of days required to produce a given
change in relative frequency. Additional downward adjustment to doubling time might
be made to account for the fact that the entire population is not reproducing at the

79
rate of the ﬁttest sequence. Increasing ﬁtnesses of cloud haplotypes can increase the rate
at which the quasispecies approaches equilibrium, presumably by increasing mutational
ﬂow between peaks.
Except for using a higher value of mutation rate, changes to these parameters are not
on the scale to dramatically improve results. There is a tension inherent in quasispecies
equilibrium estimation because we are best able to estimate ﬁtnesses of common haplo-
types assuming the population is at equilibrium, but the abundance of such haplotypes
is also likely not explained by equilibrium processes. Haplotypes with 0.001-estimable,
but not 0.01-estimable ﬁtnesses (see §2.3) seem the most promising for both satisfying
the equilibrium assumption at realistic timescales and having ﬁtnesses constrained by
the data. In some cases, we may be able to detect that a haplotype is overrepresented
relative to what would be predicted from mutational production from more abundant
haplotypes even when it is still far below its equilibrium abundance. In such a case
we might correctly estimate its ﬁtness to be large relative to that of surrounding hap-
lotypes even if we underestimate it. Such results could explain how QuasiFit recovers
information about ﬁtness rank order in nonequilibrium populations [14].
This work is not intended to claim the quasispecies model has no value as a model
of within-host evolution. For example, the existence of error thresholds has been shown
to be robust to numerous deviations from the simple ﬁtness landscape for which it was
originally described [91] and may inform antiviral strategies [92]. Rather, we advocate
careful consideration of what aspects of genetic variation are explained by quasispecies
equilibrium. An approximate local equilibrium of minor variants surrounding a ﬁtness
peak is rapidly established, but multimodal virus populations are diﬃcult to explain as
an equilibrium phenomenon. This justiﬁes our decision to model separate quasispecies
equilibria for widely separated modal haplotypes, and suggest even more clustering is
warranted.

80
If equilibrium is not an explanation, it further supports alternative explanations for
multimodality. Coexistence of distant haplotypes on ﬁnite timescales might be explained
by coinfection. Coexistence might be temporary as a lower ﬁtness infecting sequence is
replaced by a higher ﬁtness mutant. However, this does not explain cyclic patterns of
variant abundance [58]. Alternative explanations include time-varying immune pressures
[8, 83], genetic hitchhiking and clonal interference [93], or complementation between
haplotypes [94, 95].

81
CHAPTER 4.
ESTIMATING VIRUS AND ANTIBODY
DYNAMICAL MODEL PARAMETERS
4.1
Introduction
Neutralizing antibodies shape HIV-1 evolution by blocking infectivity and driving
immune escape and are of interest in vaccine development and antibody-based thera-
peutics [96]. Broadly neutralizing antibodies are a subset of neutralizing antibodies that
can neutralize many diﬀerent HIV-1 strains. Because of the high genetic diversity of
HIV-1, an eﬀective vaccine must produce an immune response against a diverse array of
virus strains, so vaccines that elicit the development of broadly neutralizing antibodies
are considered a promising route to developing an eﬀective HIV-1 vaccine [97]. Under-
standing how and when virus elicits neutralization breadth may inform vaccine design
[26, 98].
Neutralization is traditionally determined through laboratory assays. The molecular
basis of antibody-antigen interactions can be elucidated through laborious laboratory
techniques such as analysis of crystallization and structure determination or mutagene-
sis [99]. The region of the virus or other antigen to which an antibody binds is called
the epitope. Computational antibody-speciﬁc epitope prediction methods are in devel-
opment [100, 99], but many such approaches require extensive supplementary data such
as large training sets, experimental data, or crystal structures [99]. Antibody reper-
toire sequencing [4] using next-generation sequencing (NGS) technologies is expected to
improve predictions [99]. In a recent attempt to harness such data, maximum entropy

82
models trained on sequences with known aﬃnity were used to predict aﬃnity of other
antibody lineages identiﬁed by immune repertoire sequencing [101].
Integration of immune repertoire sequencing data with host virus population sequenc-
ing [2, 3] suggests an alternative way to ﬁnd candidate virus-antibody interactions. An-
tibody production is stimulated by the presence of antigen, while virus replication is
blocked in the presence of high levels of neutralizing antibody targeted at the virus. It
may be possible to ﬁnd signatures of antibody-virus interaction in time series of vari-
ant abundances. Dynamic models of virus-immune system interactions have been the
subject of theoretical work [8] and also applied to estimate the role of immune system
components in controlling virus infection [102, 103, 104, 105]. Although theoretical re-
sults have been qualitatively compared to patterns in real data [21, 22], models used in
estimation attempts did not distinguish among genetic variants, meaning they cannot
identify which antibodies are responsible for neutralization or which virus variants allow
escape. The idea of identifying antibodies responding to a particular antigen through
antibody temporal dynamics was recently applied in a study of antibody response to
inﬂuenza vaccine [106], but this study did not incorporate virus genetic diversity.
To our knowledge, there is one set of studies providing both antibody and virus NGS
reads from the same donor. The authors sequenced antibody variable region [107] and
HIV-1 V1V2 [26] from CAP256, a donor enrolled in the CAPRISA acute infection study
[108] who developed neutralization breadth. This donor was superinfected with a second
strain (SU) 15 weeks after primary infection with strain PI. The authors isolated an
antibody lineage (CAP256-VRC26) with an associated epitope on V1V2 [107, 109]. Early
members of the CAP256-VRC26 lineage neutralized SU but did not confer neutralization
breadth. They also exhibited little to no detectable neutralization activity against viruses
with escape variants in two key amino acid residues of the epitope. Later lineage members
were shown to neutralize viruses containing some or all of these escape variants, which

83
was also associated with an increase in neutralization breadth measured using a panel of
196 viruses from multiple HIV-1 subtypes [26].
Our goal is to present a statistical method to test for interactions among viruses and
antibodies from NGS time series data, demonstrate its performance on simulated data,
and apply it to the data generated by Bhiman et al. [26] and Doria Rose et al. [107].
Taking advantage of this well-curated system will allow us to assess the biological validity
of our inferences. The authors supported their claims about genetic changes that drive
virus-antibody interaction through a combination of laboratory assays, protein struc-
ture analysis and qualitative analysis of time series data. We determine whether virus
and antibody time series data support a role of the CAP256-VRC26 lineage in neu-
tralizing HIV-1, whether escape variants identiﬁed by the authors exhibit statistically
distinguishable dynamics, and whether a major structural change occurring early in the
development of the CAP256-VRC26 lineage is associated with neutralization breadth
and potency. We hope this analysis will reveal the potential for using NGS data to ﬁnd
antibody-virus interactions. In addition to providing hypotheses about virus-antibody
interactions testable via laboratory assays and structural research, such methods will
inform our understanding of how host-pathogen interactions shape evolution of both
viruses and the immune response.
4.2
Methods
4.2.1
Process model
We model virus and antibody dynamics using a special case of the generalized Lotka-
Volterra model. Let Ai(t) be the concentration of antibody i at time t, i = 1, . . . , na and
Vj(t) be the concentration of virus j at time t, j = 1, . . . , nv.
˙Ai(t) = Ai(t)
 
−di + s
nv
X
j=1
BijVj(t)
!
(4.1)

84
˙Vj(t) = Vj(t)
 
rj −1
K
nv
X
k=1
rkVk(t) −c
na
X
i=1
BijAi(t)
!
(4.2)
Parameters are antibody degradation rates di, virus reproduction rates rj, binding
aﬃnity Bij of antibody i and virus j, parameter K controlling the extent to which viruses
are inhibited by other viruses, virus elimination rate c and antibody stimulation rate s.
We call c the rate of elimination rather than clearance or neutralization to avoid implying
a speciﬁc immune mechanism for reduction of virus levels in response to antibody. In
general, we expect parameters d, r, B, K, c, and s to be nonnegative, but do not impose
this as a constraint because there are biological reasons why this might not be so (for
example, cooperative interactions among viruses [94] or the immune response enhancing
virus growth [110]). It is necessary to put one constraint on Bij, s and c for identiﬁability.
We will use the constraint c = 1. The Lotka-Volterra model has been used in theoretical
modeling of virus immune system interactions [21, 8] and in parameter estimation for
metagenomic dynamics [23, 24].
Our parameterization of virus-virus interactions, in
which the inhibitory eﬀect of virus k on virus j is proportional to rk, comes from a
previous study [25] modeling Potato virus Y, which found this model ﬁt better than
alternative models.
In preliminary work, we determined that ﬁtting the model using a numerical ODE
solver was not computationally feasible, and that well-known smoothing approaches to
avoid a numerical solver [111, 112] produced unstable parameter estimates highly sen-
sitive to choice of tuning parameters and poorly estimated trajectories. Therefore, we
propose to decouple the ODE system in Eq. (4.1) and Eq. (4.2). Assume K is suﬃciently
large and all |cBij| suﬃciently high that virus levels are controlled by antibody rather
than the carrying capacity of the system. Then Eq. (4.2) reduces to
˙Vj(t) ≈Vj(t)
 
rj −c
na
X
i=1
BijAi(t)
!
.

85
Instead of modeling Ai(t) using an ODE system, we approximate it with spline functions
log Ai(t) ≈
Ri+2
X
l=1
β(i)
l ψ(i)
l (t)
(4.3)
where ψ(i) is a ﬁxed natural cubic spline basis with Ri knots. Knot locations are deter-
mined by measurement time quantiles. We model log Ai(t) so any β(i) ∈RRi+2 produces
a nonnegative antibody trajectory. Then
˙Vj(t) ≈Vj(t)
 
rj −c
na
X
i=1
Bij exp
"Ri+2
X
l=1
β(i)
l ψ(i)
l (t)
#!
.
If we consider Ai(t) as a ﬁxed function of t and not as part of the ODE system, this is
now a separable diﬀerential equation with solution
log Vj(t) ≈log Vj(0) + trj −c
na
X
i=1
Bij
Z t
x=0
exp
 Ri+2
X
l=1
β(i)
l ψ(i)
k (x)
!
dx.
(4.4)
One might also consider a similar approach in which virus abundance is modeled
using a spline function and decoupled diﬀerential equations model antibody abundance.
We encountered greater mixing problems using such an approach in simulation, so we
do not discuss it further.
4.2.2
Data
Let t1, . . . , tn be the set of sampling times. Not all entities are sampled at each time
point, so we introduce the set TE to contain the indices of times when entity E is sampled.
We assume the data consist of virus counts vj(tk), k ∈Tv j = 1, . . . , nv, antibody counts
ai(tk) k ∈Ta, i = 1, . . . , na + 1, and viral load measurements l(tk) k ∈Tl. The sums
Nv(tk) = Pnv
j=1 vj(tk) and Na(tk) = Pna+1
i=1 ai(tk) are total sampled virus and antibody
counts at time tk, and are considered ﬁxed.

86
Viral load measures the total concentration of HIV-1 (or other virus of interest)
through time, but we do not assume we have a comparable concentration measure for
antibodies as this information is unavailable in the dataset we analyze [107]. Instead, we
assume we are modeling a single clonal lineage. We indirectly measure its concentration
by observing ana+1(tk), the count of antibodies at time t not belonging to the clonal
lineage of interest, and assuming a constant concentration of these antibodies An+1(t) =
CAB through time.
4.2.3
Statistical model
4.2.3.1
Sampling distribution
We assume virus and antibody counts are multinomially distributed with parame-
ter θ, where θ is Dirichlet distributed with mean determined by the Lotka-Volterra and
spline model predictions respectively. The Dirichlet-multinomial distribution has previ-
ously been used to model metagenomic [113] and virus NGS data [25] as a way to account
for heterogeneity among individuals. Although our data come from a single individual,
we use the Dirichlet-multinomial distribution to account for deviations from multinomial
sampling in the sequencing process (for example, due to replicate reads from the same
initial virus copy) and in recognition that the underlying population is unlikely to per-
fectly follow the trajectory predicted by the Lotka-Volterra model. We prefer to use a
model for nonnegative count data rather than a normal approximation as we have many
low or zero counts.
The statistical model for the data is
v(tk)
indep
∼Dirichlet-Multinomial(Nv(tk), αV (tk)) tk ∈Tv
(4.5)
a(tk)
indep
∼Dirichlet-Multinomial(Na(tk), αA(tk)) tk ∈Ta
(4.6)

87
l(tk)
indep
∼Log Normal(log L(tk), σ2
L) tk ∈Tl
(4.7)
αV (tk) = φV pV (tk)
αA(tk) = φApA(tk)
Let V (t) = (V1(t), . . . , Vnv(t))′ be the vector of virus concentration at time t. Let
A(t) = (A1(t), . . . , Ana+1(t))′ be the vector of antibody concentrations in the lineage of
interest concatenated with the concentration of antibodies outside the lineage of interest
at time t.
L(tk) =
nv
X
j=1
Vj(tk)
(4.8)
pVj(tk) = Vj(tk)
L(tk)
(4.9)
pAi(tk) =
Ai(tk)
Pna+1
l=1 Al(tk)
=
Ai(tk)
CAB + Pna
l=1 Al(tk)
(4.10)
CAB is arbitrarily set to 1 when ﬁtting the model as this quantity is not measured
in real datasets. This is equivalent to rescaling antibody concentrations by 1/CAB, so
estimates of Bij will be CAB-fold higher than the value used in simulation from Eq. (4.6).
Additionally, c and Bij are not both identiﬁable, so we set c = 1. Therefore we are
actually estimating ˜Bij = cCABBij. We do not consider this a problem as we only intend
to interpret signs and relative magnitudes of Bij.
The antibody and virus models can be written in matrix notation. Let log A be the
concatenation of log Ai(tk), k ∈Ta, 1 ≤i ≤na. Let log V be a |Tv ∪Tl| × nv matrix with

88
log Vkj = log Vj(tk), k ∈Tv ∪Tvl. Then we can reexpress Eq. (4.3) and Eq. (4.4) as linear
models.
log A = Xaβ
(4.11)
log V = Xv(β)


log V (0)′
r′
−B


(4.12)
β is the concatenation of β(1), . . . , β(na) such that β′ = (β(1)′, . . . , β(na)′) and Xv is
written as a function of β to emphasize the dependence.
4.2.3.2
Prior distribution
Independent prior distributions for parameters were as follows
β(i)
l
iid∼N(0, 100) 1 ≤i ≤na, 1 ≤l ≤Ri + 2
log Vj(0)
iid∼N(−10, 10) 1 ≤j ≤nv
Bij
iid∼N(0, 104) 1 ≤i ≤na, 1 ≤j ≤nv
rj
iid∼N(0, 10) 1 ≤j ≤nv
σL ∼Inv-Gamma(3, 1)
φA ∼Gamma(1, 0.001)
φV ∼Gamma(1, 0.001).

89
With only six antibody time points, simulation U suﬀered from poor statistical iden-
tiﬁability. To overcome this, we used a tighter prior distribution
rj
iid∼N(4, 1)
for virus reproductive rate.
As HIV-1 doubling time has previously been measured
[90, 88], it may not be unreasonable to impose an informative prior on r. For analysis
of CAP256 data we used
rj
iid∼N(9, 4)
derived from a doubling time of approximately 0.4 to 0.9 days from published sources
[90, 88].
4.2.4
Simulated datasets
Datasets were simulated using the model in Eq. (4.5)-Eq. (4.7) with na = 2 and nv =
3. Underlying concentration functions V (t) and A(t) were determined from Eq. (4.1)-
Eq. (4.2) rather than the decoupled system used in ﬁtting. Values of B21 (the largest
interaction parameter), s, d and r were randomly perturbed using normally distributed
noise to generate simulated datasets.
Initial concentrations A(0) and V (0), K and
Bij/B21 were ﬁxed. Mean parameter values and standard deviations used in simula-
tion are given in Table 4.1. Parameter values used to simulate datasets were addition-
ally required to yield trajectories satisfying the criteria that maxt∈t1,...,tn pAi(t) ≥0.2,
maxt∈t1,...,tn pVj(t) ≥0.2, and mint∈t1,...,tn L(t) ≥0.001. These conditions were imposed
to avoid virus extinction and maintain substantial virus and antibody diversity, as ob-
served in many persistent viral infections. CAB was set to 200×maxt∈t1,...,tn,i∈1,...,na Ai(t),
making the peak relative abundance of the clonal lineage comparable to that of CAP256-
VRC26 [107]. An example trajectory is shown in Figure 4.1.

90
Ten simulated datasets were generated for each of four simulation conditions (Ta-
ble 4.2).
Simulation conditions varied the number of time points and measurement
noise. Log viral load measurement standard deviation σL was speciﬁed as a fraction fσL
of the range in log10 viral load over the sampling period. In simulation condition U, the
6 antibody and 22 virus observations with unequal spacing replicate what is available
in the CAP256 dataset [107, 26]. In particular, the viral load and virus count measure-
ment times did not perfectly coincide. We did not vary the length of the observation
interval across simulation conditions: observations are more densely spaced in simulation
conditions with more time points.
Table 4.1: Normal mean and standard deviation used to generate simulated dataset
parameter values.
Parameter
Mean
SD
log A1(0)
0.00
0.00
log A2(0)
-6.91
0.00
log V1(0)
0.00
0.00
log V2(0)
-9.21
0.00
log V3(0)
-13.82
0.00
d1
0.25
0.05
d2
0.25
0.05
r1
5.00
0.05
r2
4.00
0.05
r3
3.00
0.05
K
1000000.00
0.00
B11/B21
0.50
0.00
B21
1.00
1.00
B12/B21
0.01
0.00
B22/B21
0.50
0.00
B13/B21
0.01
0.00
B23/B21
0.30
0.00
s
1.00
1.00
Table 4.2: Number and spacing of data points and values of noise parameters under four
simulation conditions E, L, Q and U. n = |Ta ∪Tv ∪Tl|.
|Ta|
|Tv|
|Tl|
φA
φV
fσL
spacing
description
E
31
31
31
10000
50
0.15
Equal
Moderate n
L
151
151
151
10000
50
0.15
Equal
High n
Q
31
31
31
100000
500
0.015
Equal
Low noise
U
6
22
22
10000
50
0.15
Unequal
Current n

91
pA 1
pA 2
0
5
10
15
0
5
10
15
0.000
0.001
0.002
0.003
0.004
0.005
Time
pA
pV 1
pV 2
pV 3
0
5
10
15
0
5
10
15
0
5
10
15
0.00
0.25
0.50
0.75
1.00
Time
pV
0.01
1.00
0
5
10
15
Time
L
Figure 4.1: Underlying trajectories for an example dataset.
Plots show the relative
frequency of each antibody in the clonal lineage (top row), the relative frequency of each
virus (middle row), and the log viral load through time (bottom row).

92
Figure 4.2: Neutralization of virus constructs by CAP256-VRC26 lineage members and
neutralization breadth. Constructs were generated by site-directed mutagenesis of SU.
Neutralization breadth measures the proportion of autologous viruses neutralized by
the antibody. Panel a shows estimated antibody phylogenetic relationships. Panel b
shows neutralization results for antibodies without the Cys-Cys motif. Panel c shows
results for antibodies after the appearance of the Cys-Cys motif. Coloring shows IC50
titers. Lower IC50 titer indicates more potent neutralization. Reprinted with permission
from Viral variants that initiate and drive maturation of V1V2-directed HIV-1 broadly
neutralizing antibodies by Jinal N Bhiman et al et al., October 2015, retrieved from
http://www.nature.com Copyright 2015, Nature Publishing Group.

93
Figure 4.3: Amino acid resistance scores measured using a panel of 198 HIV-1 sequences.
Resistance score is deﬁned as the proportion of sequences containing each amino acid
residue that were resistant to neutralization by CAP256-VRC26.25. The bottom panel
shows the relative abundance of each residue.
Reprinted with permission from New
Member of the V1V2-Directed CAP256-VRC26 Lineage That Shows Increased Breadth
and Exceptional Potency, by Nicole A. Doria Rose et al., January 2016, retrieved from
http://jvi.asm.org/ Copyright 2016, American Society for Microbiology.

94
4.2.5
Estimation
Model parameters were estimated using stan (cmd-stan.2.14.0) [114] with a single
chain. For simulation condition L, stan’s default settings were used as these datasets used
more evaluation time per iteration but had fast mixing. For other simulation conditions,
we increased both the number of warmup samples and the number of retained samples
to 5000. Maximum depth was increased to 15 for simulation condition U as these were
particularly susceptible to poor mixing.
4.2.5.1
Initialization
Initial parameter values are estimated using a generalized least squares approach.
Because linear models are ﬁt to virus and antibody levels, which are not directly observed,
we approximate them using the following procedure.
1. Approximate antibody and virus relative frequencies from observed counts supple-
mented with pseudocounts to avoid zero values
˜pAi(tk) =
ai(tk) + 1
Pna+1
l=1 (al(tk) + 1)
˜pVj(tk) =
vj(tk) + 1
Pnv
l=1(vl(tk) + 1).
2. Smooth viral load using a natural cubic spline with R = |Tl| −2. Smoothing is
necessary because Tl need not coincide with Tv. Let ˜l(tk) be the smoothed value of
the viral load at times tk : k ∈Tv.
3. Approximate virus abundance by
˜Vj(tk) = ˜l(tk)˜pVj(tk)
(4.13)

95
4. Approximate antibody abundance by
log ˜Ai(tk) = log
˜pAi(t)
1 −Pna
i=1 ˜pAi(t),
(4.14)
obtained from solving Eq. (4.10) for log Ai(tk) as a function of pA(tk) with CAB = 1.
Initial parameter estimates for (β, φA) and (γ, φV , σL) conditional on β are obtained
through maximum likelihood estimation from an approximating normal distribution with
approximate relative frequencies ˜pA and ˜pV and approximate trajectory data log ˜
A and
log ˜V in place of pA, pV , log A and log V (see §B.1).
4.2.5.2
Integral computation
The integrals in Eq. (4.4) are computationally expensive.
In particular, a naive
implementation using standard numerical integration tools would require recomputing
the value of the natural cubic spline basis at numerous points for multiple iterations.
Instead, we used Simpson’s method for numerical integration. The natural cubic spline
basis functions were computed once at closely spaced points. Then, the ﬁtted spline
curve can be computed at each point using linear algebra. The number of points per
interval was determined by suﬃcient closeness to the value produced using R’s integrate
function, deﬁned as either an absolute diﬀerence of 10−10 or a relative diﬀerence of 10−5
at least squares parameter estimates from transformed antibody data in Eq. (4.14).
4.2.5.3
Choice of knots
The number of spline knots is chosen by the PRESS statistic [115] using the same
pseudocount adjusted transformed observations as given in Eq. (4.13) and Eq. (4.14).
The PRESS statistic we used is equivalent to leave-one-out cross validation when per-
forming ordinary least squares estimation separately on the transformed virus and anti-
body data (leave-one-out cross validation using our full Bayesian model would be pro-

96
hibitively time consuming). A separate number of spine knots was selected for each
antibody. Speciﬁcally, we compute
PRESSi(Ri) =
1
|Ta|
X
k∈Ta
 
log ˜ai(tk) −zk(Ri)′ ˆβ(i)(Ri)
1 −hkk(Ri)
!2
,
where zk(Ri)′ is the row corresponding to tk of the natural cubic spline design matrix
with Ri quantile knots, ˆβ(i)(Ri) is the least squares estimate of β(i) from this design
matrix and data ˜ai, and hkk(Ri) is the kth diagonal element of the corresponding design
matrix. Natural cubic spline ﬁts were performed in R [116] using the ns function. We
choose the number of knots for antibody i by
ˆRi = arg min{PRESSi(Ri) : 0 ≤Ri ≤|Ta| −4}.
We ﬁnd the PRESS statistic eﬀective for simulated datasets with suﬃcient numbers of
time points. However, we found this criterion favored a linear ﬁt with the smallest number
of sampled time points (six), and led to slow convergence and sometimes multimodal
posterior distributions.
Therefore, for these datasets we used ﬁve spline knots.
We
acknowledge such a decision would be more diﬃcult on dataset in which the underlying
trajectory was unknown, but the presence of a multimodal posterior may be informative.
4.2.5.4
Convergence
Eﬀective sample size was computed using rstan from retained samples after warmup.
To be accepted, a run was required to have eﬀective sample size at least 100 for all Bij.
Otherwise we reran stan with modiﬁed tuning parameters. Speciﬁcally, for one dataset
in simulation condition Q, we increased the maximum depth parameter to 15 upon
observing the depth of evaluations achieved the maximum depth for nearly all iterations.
In another dataset in simulation condition U, we increased the target acceptance rate δ

97
from 0.8 to 0.9 in response to poor mixing associated with low evaluation depth in some
regions of the parameter space.
Another diagnostic speciﬁc to stan, divergent transitions, was a greater concern.
stan proposes new states using a position-momentum trajectory evaluated with a leapfrog
integrator. The divergent transitions diagnostic indicates the step size of this integrator
is too large, causing integration instability, which can lead the sampler to miss high prob-
ability areas, biasing parameter estimates [117]. Small numbers of divergent transitions
can sometimes be eliminated by increasing the target acceptance rate, but large numbers
require reparametrization to eliminate [118]. In simulation condition L, there were no
divergent transitions under default settings. In simulation conditions E and Q, there
were divergent transitions in 7 and 3 datasets respectively. Increasing target acceptance
probability eliminated divergent transitions in 6 and 1 of these datasets respectively. In
simulation condition U, there were large numbers of divergent transitions in all datasets
which were not eliminated by increasing target acceptance probability.
4.2.6
CAP256 dataset
Antibody reads were generated by amplicon 454 pyrosequencing of cDNA from sam-
pled mRNA [107]. cDNA synthesis used oligo-dT(12-18) primers, which hybridize to the
poly(A) tail of mRNA. PCR primers were speciﬁc to all lambda families (light chain
sequencing) or to VH3 (heavy chain sequencing). VH3 speciﬁc primers were used be-
cause the CAP256-VRC26 lineage derives from the germline VH3-30 gene. Reads were
obtained from six time points between 15 and 206 weeks. Sequences were available from
three additional time points, but are excluded from our analysis because diﬀerent se-
quencing methods were used on these samples. Generation of aligned CAP256-VRC26
protein sequences from data obtained from SRA (SRR1057693-SRR1057707) is described
in B.2. We assigned V and J germline genes to antibody reads using mixcr-2.0 [119].
Reads with assignments matching that of CAP256-VRC26 and with less than 5% di-

98
vergence from at least one CAP256-VRC26 sequence in GenBank were assigned to the
lineage, translated, and aligned to the CAP256-VCR26 reconstructed universal common
ancestor (GenBank KJ134860) using the Needleman-Wunsch algorithm.
Viruses reads were generated on an Illumina MiSeq using 2×300 paired-end sequenc-
ing [26] on cDNA of HIV-1 RNA isolated from plasma. The cDNA synthesis primer was
designed to bind to the C3 region of HIV-1 env. PCR primers were designed to amplify
the V1 to V3 region. Generation of aligned V1V2 protein sequencing from data obtained
from SRA (SRR2241766-SRR2441794) is also described in B.2. Counts of error cor-
rected sequences at each of 28 time points were generated using dada2 [120]. Sequences
containing stop codons or not mapping to HIV-1 V1V2 were removed. The remaining
unique amino acid sequences were aligned using mafft [121].
Our statistical model presented in §4.2.1 does not specify how distinct virus and
antibody entities should be delimited.
With unlimited computational resources and
suﬃciently densely sampled, high quality data, we might wish to ﬁt a separate trajectory
for every suﬃciently common virus epitope variant and every distinct antibody CDRH3.
In practice, we must group virus and antibody haplotypes for computational feasibility.
Additionally, high diversity and rapid evolution of CAP256-VRC26 CDRH3 means we
are rarely able to identify precisely the same antibody sequence at more than one time
point. Finally, features of the HIV-1 dataset suggest substantial PCR recombination,
making association between variant loci questionable. Instead, we take advantage of
the fact that previous authors have generated hypotheses about important virus and
antibody positions, and group sequences based on residues at those select positions.
Phylogenetic analysis of CAP256-VRC26 sequences showed an early divergence be-
tween antibodies related to CAP256-VRC26.1 and antibodies related to CAP256-VRC26.2-
12 [107, 109]. This divergence was associated with a mutation from arginine to glycine at
CDRH3 position 3. The change coincides with the appearance of two cysteine residues
at positions 7 and 27 that form a disulphide bond (Cys-Cys). Constructs possessing the

99
position 3 arginine but lacking the cysteine residues show reduced neutralization breadth
[107] and neutralization breadth was also low for both of two isolated antibodies lacking
the double cysteine (Figure 4.2,[26, 109]). Antibody sequences were divided into two
groups (na = 2), one with the CDRH3 mutations G3R, X7C and X27C characteristic
of later lineage members and one group of sequences lacking one or more these muta-
tions. Most (90%) of sampled sequences assigned to CAP256-VRC26 either possessed
all three mutations or no mutations. We computed ai(t), at seven time points t from 15
to 206 weeks post infection, while ana+1(t) was computed as the total number of heavy
chain reads at time t assigned V and J germline genes by mixcr but not assigned to
CAP256-VCR26.
Bhiman et al. identiﬁed env residues 166 and 169 (numbered relative to HXB2) as
important in immune escape, and compared CAP256-VRC26 neutralization of viruses
varying at these positions, so we deﬁne virus variants by residues at these positions. We
ﬁt two separate models, diﬀering in which of two virus amino acid residues generates
groupings.
We will call these Model166 and Model169 according to the residue.
In
Model166, we separately modeled trajectories for PI and SU consensus residue R and
mutations R166S and R166K. In Model169, we separately modeled trajectories for SU
consensus variant K, PI consensus variant Q, and previously-identiﬁed escape mutants
169E and 169I. Counts of minor variants, comprising less than 1% of reads, formed a
single group in each analysis so that nv = 4 for Model166 and nv = 5 for Model169. Viral
load from 28 time points was taken from the supplementary materials to Bhiman et al.
[26]. We excluded time points before 15 weeks because antibody measurements are only
available starting at week 15 and because the introduction of a second virus strain from
an outside source is not accounted for in our model. With these time points excluded,
|Tv| = 22 and |Tl| = 22. Measurement times do not always coincide so |Tv ∩Tl| = 20.

100
4.3
Results
4.3.1
Simulated datasets
We analyze ten simulated datasets from each of four simulation conditions (Table 4.2).
The primary research questions of interest are whether we are able to detect interactions
between viruses and antibodies, and if so, whether the strength of the interaction depends
on the presence a particular genetic variant. For example, a virus escape mutant would
be expected to have weaker interactions with antibodies targeting the wild-type virus.
Performance measures will be 95% credible interval coverage and posterior probability
of antibody-virus association.
The latter is measured as the proportion of posterior
samples in each simulated dataset in which each parameter Bij > 0. We also compute
the posterior probability of diﬀerences among antibody variants in their interaction with
a particular virus variant and of diﬀerences among virus variants in their interaction with
a particular antibody.
For most parameters, 95% credible intervals contain the true value for eight to ten
simulated datasets regardless of simulation condition (Figure 4.4). Coverage for param-
eter B11 is lower for all except simulation condition L (largest sample size). There is a
systematic tendency to overestimate the strength of this interaction under other simu-
lation conditions (not shown). Credible interval coverage for the parameter φA is also
lower than that of other parameters. This parameter is systematically underestimated
in all datasets, leading to an inﬂated estimate of the Dirichlet-multinomial variance of
antibody counts. There is a concerning tendency for worse credible interval coverage
in parameters B11, r1 and σL when observation noise is lower (simulation condition Q
versus E). Further examination reveals estimates of r1 and σL are systematically above
their true values in condition Q (not shown).
Posterior probabilities that B11, B22 and B23 are greater than zero are almost uni-
formly high across simulation conditions, though in some datasets under Simulation

101
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
φA
φV
σVL
 B12 (0.01)
 B22 (0.5)
 B13 (0.01)
 B23 (0.3)
r2
r3
 B11 (0.5)
 B21 (1)
 log V1(0)
 log V2(0)
 log V3(0)
r1
U
E
Q
L
U
E
Q
L
U
E
Q
L
U
E
Q
L
0.00
0.25
0.50
0.75
1.00
0.00
0.25
0.50
0.75
1.00
0.00
0.25
0.50
0.75
1.00
0.00
0.25
0.50
0.75
1.00
Simulation Condition
95% credible interval coverage
Figure 4.4: Coverage of 95% credible intervals for each simulation and spline condition.
Simulation conditions vary in error variance, number, and spacing of time points; refer
to Table 4.2. There are 10 replicate datasets for each simulation condition. Dashed line
at 0.95. Number in parenthesis shows true value of Bij/B21.

102
G G
G
G
G
GGG
GG
G
GG
G G
G
GG
GG
GG
GG
G G
GGG
G
GG
G
G G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G G
G G
GGG
GG
GG
GG
G
GGG
GG
GG
G
GG
GG
GGG
GG
GG
GGG
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
GGG
G
GG
G
G
G
GG
G G
G G
GGG
GGG
GGG
GG
GG
G
GG
GG
GG
GG
G
 B21 > 0 (1)
 B22 > 0 (0.5)
 B23 > 0 (0.3)
 B11 > 0 (0.5)
 B12 > 0 (0.01)
 B13 > 0 (0.01)
U
E
Q
L
U
E
Q
L
U
E
Q
L
0.00
0.25
0.50
0.75
1.00
0.00
0.25
0.50
0.75
1.00
Simulation Condition
Posterior Probabililty
Figure 4.5: Posterior probability that each antibody-virus interaction parameter is pos-
itive (antibody eliminates virus). Simulation conditions vary in error variance, number,
and spacing of time points; refer to Table 4.2. There are 10 replicate datasets for each
simulation condition. Dashed line at 0.95. Number in parenthesis shows true value of
Bij/B21.

103
G
GGG
G
GG
GGG
G
G
G
G
GG
GGGG
G
G
G G
G
GG
G
G
G
G
GGG
G
GGG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GGG
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
GGG
G
GG
GGG
GGG
GG
GG
G
GG
GG
G
GG
GG
GG
G
G
GG
G
G
G
G
G
G
GGG
G
GGGG
G
GGG
GG
G
G
GG
G
GG
GG
GGG
GG
GG
GGG
G G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GGG
G
G
G
G
G
GGG
GGG
G
G
GG
G
GG
GGG
GG
G
G
GG
GG
G
G
GG
GG
G
G
G
G
GGG
G
G
G
GGG
GGGG
G
G
G
G
GG
G
G
GG
GGG
G
GG
GGG
G
GGG
B21 −B22 > 0
B21 −B23 > 0
B22 −B23 > 0
B12 −B13 > 0
B12 −B22 > 0
B13 −B23 > 0
B11 −B12 > 0
B11 −B13 > 0
B11 −B21 > 0
U
E
Q
L
U
E
Q
L
U
E
Q
L
0.00
0.25
0.50
0.75
1.00
0.00
0.25
0.50
0.75
1.00
0.00
0.25
0.50
0.75
1.00
Simulation Condition
Posterior Probabililty
True Sign
G
G
G
0
<0
>0
Figure 4.6: Posterior probability of Bij > Bil (antibody i eliminates virus j more eﬀec-
tively than virus l) or that Bij > Bkj (virus j is eliminated more eﬀectively by antibody
i than antibody k). Simulation conditions vary in error variance, number, and spacing
of time points; refer to Table 4.2. There are 10 replicate datasets for each simulation
condition. Dashed lines at 0.025 and 0.975. Color shows whether the true diﬀerence is
positive, negative, or zero.

104
Condition U (lowest sample size) they drop below 95%.
Additionally, the posterior
probability that B11 > 0 tends to be lower under simulation condition L (largest sample
size). Although B21 is the highest magnitude interaction, the posterior probability of
B21 > 0 tends to be moderate. It may be hard to detect because virus 1 is eﬀectively
driven to extinction early in the simulation by antibody 1, leaving little evidence for
its association with antibody 2 (Figure 4.1). Posterior probabilities that B12 > 0 and
B13 > 0 are highly variable by simulation, unsurprising as these interactions were very
weak.
Relative magnitudes of virus and antibody interactions also have meaningful inter-
pretations. Across simulation conditions, we are generally conﬁdent antibody 1 is more
eﬀective in eliminating virus 1 than virus 2 or 3 (Figure 4.6). We would conclude virus
variants 2 and 3 confer escape from antibody 1. However, we are generally unable to
recognize that antibody 2 is even more eﬀective than antibody 1 at eliminating virus
1, though we begin to see more support for this at the largest sample size (simulation
condition L). We correctly tend not to see strong support for a diﬀerence in the eﬀect of
antibody 1 on viruses 2 and 3. Under most simulation conditions, we are also conﬁdent
that antibody 2 eliminates viruses 2 and 3 better than antibody 1, though we are less
conﬁdent in some simulation condition U datasets (lowest sample size). Similarly, except
some simulation condition U datasets, we are conﬁdent that antibody 2 is more eﬀective
at eliminating virus 2 than virus 3. We are usually unable to detect the diﬀerences in
elimination rate between virus 1 and viruses 2 and 3 by antibody 2.
Fitted trajectories reveal possible explanations for our results. They are shown for
a randomly selected dataset for each simulation condition (Figure 4.7-4.8, Figure B.3-
B.4). There is a tendency to estimate the peak in antibody 1 as occurring later than it
truly does. This eﬀect is strongest under simulation condition U (Figure 4.7), but also
observed in some other datasets (Figure 4.8). This might contribute to overestimation of
B11. If the peak occurs after virus 1 has been cleared, then smaller amounts of antibody

105
may be considered responsible for the decline in virus 1. Replicating the abrupt increase
in antibody 1 appears to be a challenge when spline knots are determined by data
quantiles. When there are adequate knots in the region of rapid change, other regions
are overﬁt (Figure B.4). The complicated shape of the antibody 2 time trajectory is
diﬃcult to capture with only 6 data points, so there is unsurprisingly high uncertainty in
this trajectory under Simulation Condition U (Figure 4.7). The true viral load trajectory
also has a tendency to fall outside its credible interval under this simulation condition,
though its basic shape is captured.
4.3.2
CAP256 dataset
Analysis of simulated datasets suggests that capturing the shape of antibody trajec-
tories with a small number of data points requires almost as many basis functions as
data points. Therefore, instead of selecting the number of basis functions using PRESS,
we used 6 spline basis functions for all antibody trajectories, one less than the number of
time points. We ran four separate chains for each analysis and computed the potential
scale reduction factor ˆR in rstan [122] in addition to ensuring suﬃcient eﬀective sam-
ple size. Chains were initialized from a normal distribution centered at starting values
in 4.2.5.1. The standard deviation of each parameter was set equal to half the absolute
value of its mean. Simulated starting values causing numerical errors in evaluating the
posterior were resimulated.
When presenting estimates of antibody-virus interaction parameters, we will use the
notation Bi,j where i is C (double cysteine), X (any other motif), or CAP256 −V RC26
(all lineage members) and j gives the virus amino acid at the position of interest. Z
denotes any amino acid other than the focal amino acids.

106
GGGGGGG
GGG
G
G
G
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
G
G
GGG
G
GGGGGG
GG
G
GGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
G
GG
G
G
G
G
G
GG
G
G
G
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
G
GG
G
G
G
G
G
GG
G
G
G
G
pA1
pA2
0
5
10
15
0
5
10
15
0.000
0.002
0.004
0.006
0.008
Time
pA
Type
G
G
Truth
Median
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G GGGG
G
GGGG
GGGGGG
G G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G GGGG
G
GGGG
GGGGGG
G G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GGG
G
G G
G
G
G
G
GG
GGGGG G G G G G
G
GGG
G
G G
G
G
G
G
GG
GGGGG G G G G G
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGG
G
G
G
G
G
G
G
GG
GGGGG G G G G G
G
GGG
G
G
G
G
G
G
G
GG
GGGGG G G G G G
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGG
G
G
G
G
G
G
G
GG
GGGGG G G G G G
G
GGG
G
G
G
G
G
G
G
GG
GGGGG G G G G G
G
pV1
pV2
pV3
0
5
10
15
0
5
10
15
0
5
10
15
0.00
0.25
0.50
0.75
1.00
Time
pV
Type
G
G
Truth
Median
G
G
G
G
G
GG
G
GGG
G
G
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
G
GGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
G
G
G
GGGG
G
GGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
G
G
G
G
G
G
G
G
G
G
G G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G G
G
G
G
G
G
G
G
G
G
G
0.01
1.00
0
5
10
15
Time
log L
Type
G
G
Truth
Median
Figure 4.7: Randomly chosen ﬁtted trajectory for Simulation Condition U. Blue: poste-
rior median, Red: Truth, Black: data, shaded: trajectory 95% credible interval.

107
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGG
G
G
G
G
G
GGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
G
GGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GG
G
G
G
G
G
G G
G
GG
G
G
G GG G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
GG
G
G
G
G
G
G
G
GG
G
G
G GG
G
G GG G
G
GG
G
G
G
G
G
G G
G
GG
G
G
G GG G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
GG
G
G
G
G
G
G
G
GG
G
G
G GG
G
G GG G
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
G
GG
G
G
G
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GG
G
G
G
G
G
G G
G
GG
G
G
G GG G
G
G GG G
G
G
G
G
G
G
G
G
G
G
G G
G G
G
GG
G
G
G
GG
G
G
GG
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G GG
G
G
GG
G
G
G
G
G
G G
G
GG
G
G
G GG G
G
G GG G
G
G
G
G
G
G
G
G
G
G
G G
G G
G
GG
G
G
G
GG
G
G
GG
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G GG
G
G
pA1
pA2
0
5
10
15
0
5
10
15
0.000
0.002
0.004
0.006
Time
pA
Type
G
G
Truth
Median
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G GGGG
G
GGGG
GGGGGG
G G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G GGGGG
G
G
G
G
GGGGG
G
GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G GGGG
G
GGGG
GGGGGG
G G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G GGGGG
G
G
G
G
GGGGG
G
GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GG
G
G
G
G
G
GG
G
GG
G
G GGGG
G GGGG
G
G
G
G
G
G
G
G
G
G G
G
G
G
G
GG
G
G GGG
G GGGG
G GG
GG
G
GG
G
G GGG
G GGGG
G
GG
G
G
G
G
G
GG
G
GG
G
G GGGG
G GGGG
G
G
G
G
G
G
G
G
G
G G
G
G
G
G
GG
G
G GGG
G GGGG
G GG
GG
G
GG
G
G GGG
G GGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G GGGGG
G
G
G
G
GGGGG
G
GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G GGGGG
G
G
G
G
GGGGG
G
GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GG
G
G
G
G
G
G
G
G
GG
G
G
G
GGG
G
GGGG
G
G
G
G
G
G
G
G
G
G G
G
G
G
G
GG
G
G GGG
G GGGG
G GG
GG
G
GG
G
G
GGG
G
GGG
G
G
GG
G
G
G
G
G
G
G
G
GG
G
G
G
GGG
G
GGGG
G
G
G
G
G
G
G
G
G
G G
G
G
G
G
GG
G
G GGG
G GGGG
G GG
GG
G
GG
G
G
GGG
G
GGG
G
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GG
G
G
G
G
G
G
G
G
GG
G
G
G
GGG
G
GGGG
G
G
G
G
G
G
G
G
G
G GG
GG
G
GG
G
G GGG
G GGGG
G GG
GG
G
GG
G
G
GGG
G
GGG
G
G
GG
G
G
G
G
G
G
G
G
GG
G
G
G
GGG
G
GGGG
G
G
G
G
G
G
G
G
G
G GG
GG
G
GG
G
G GGG
G GGGG
G GG
GG
G
GG
G
G
GGG
G
GGG
G
G
pV1
pV2
pV3
0
5
10
15
0
5
10
15
0
5
10
15
0.00
0.25
0.50
0.75
1.00
Time
pV
Type
G
G
Truth
Median
GGGGGGG
G
GGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
G
G
G
G
G
G
GG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
G
GGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
G
GGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
G
G
G
G
G
G
GG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
G
GGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GG
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
GG
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
GG
G
G
GG
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
GG
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
GG
G
G
1e−02
1e+00
1e+02
1e+04
0
5
10
15
Time
log L
Type
G
G
Truth
Median
Figure 4.8: Randomly chosen ﬁtted trajectory for Simulation Condition E. Blue: poste-
rior median, Red: Truth, Black: data, shaded: trajectory 95% credible interval.

108
4.3.2.1
Site 166
Samples from the posterior distribution of B under Model166 were bimodal. Posterior
medians of parameters other than B were similar between modes (Figure B.5) as were
median ﬁtted trajectories and posterior probabilities.
However, the two modes had
essentially non-overlapping distributions of BC,Q, BX,Q, BC,K, and BX,K. In each mode,
one of BC,Q and BX,Q is greater than zero and the less than zero, and likewise for BC,K
and BX,K. This suggests it is diﬃcult to identify separate eﬀects of antibodies with and
without the Cys-Cys motif(C and X). It also suggests diﬀerences among the antibodies in
their eﬀects, but any way of grouping antibodies is likely to share this defect. Therefore,
we ran a second analysis in which all CAP256-VRC26 antibodies were put in the same
group (na = 1). We will call this Model166b.
The second analysis met the requirements for eﬀective sample size and ˆR, showing
no evidence of mixing problems between chains (maximum single variable ˆR =1.003).
Using a suﬃciently high value of target acceptance rate, there were also no divergent
transitions. Although there is high uncertainty in the estimated antibody trajectory, the
ﬁtted model is able to reproduce major patterns in the virus trajectory (Figure 4.9). The
posterior probability that CAP256-VRC26 eliminates virus with the reference allele 166R
is very high (Figure 4.11). The posterior probability of elimination of 166S is lower. The
posterior probability of elimination of viruses containing 166K is near zero which, because
the distribution is continuous, means the posterior probability that CAP256-VRC26 pro-
motes growth of 166K is near 1 (Table 4.3). Although it is possible for non-neutralizing
antibody to enhance HIV-1 infectivity through interaction with cellular receptors [110],
it is more likely that this inference is due to a negative estimated growth rate for this
virus (Table 4.4). 95% credible intervals for diﬀerences between all pairs of interactions
exclude zero (not shown). We would conclude that CAP256-VRC26 is more eﬀective at
eliminating sequences with the reference variant 166R than sequences with alleles 166S
and 166K, in agreement with neutralization data (Figure 4.2), and that 166S is elimi-

109
nated more eﬀectively than 166K. Data on neutralization of 166S is only available for
one antibody, CAP256-VRC26.25, the CAP256-VRC26 lineage member with the great-
est known neutralization breadth (Figure 4.3)[109]. Of 198 sequences tested, no sequence
containing 166S was neutralized by this antibody, but many sequences containing 166K
were neutralized, which is not consistent with our inference.
4.3.2.2
Site 169
The potential scale reduction factor ˆR did not show evidence of lack of convergence
(maximum single value ˆR =1.006). However, there were 73 divergent transitions (out of
20,000 samples) even after increasing the target acceptance fraction to 0.999. We present
our results, with the caveat that divergent transitions could bias them.
Our estimates are not generally in agreement with neutralization results (Figure 4.2-
4.3). There is a high posterior probability that viruses containing PI consensus residue
169Q are eliminated by early lineage members lacking the Cys-Cys disulphide bond
(Figure 4.11), though neutralization assays only show evidence for later lineage members
neutralizing this virus (Figure 4.2). Posterior probability of elimination of viruses con-
taining SU consensus variant 169K is low for both antibody groups despite ﬁndings that
early lineage members targeted the SU virus [26]. High posterior probability of elimi-
nation of 169I by later lineage members is in agreement with published neutralization
assays, though the probability of elimination by earlier lineage members is also fairly high
but unsupported. Finally, there is high posterior probability that earlier but not later
lineage members eliminate viruses containing 169E. In fact, there is no evidence from
neutralization assays that any CAP256-VCR26 lineage members neutralize this virus,
though neutralization of this variant was tested for a smaller subset of CAP256-VRC26
lineage members. 169E seems to prevent neutralization by the most broadly neutralizing
antibody (Figure 4.3) and by the twelve originally isolated antibodies [107].

110
Diﬀerences between our inferences and results from neutralization assays are a con-
cern. Fitted antibody trajectories do not resemble patterns in the data (Figure 4.10),
although ﬁtted virus and viral load trajectories do. It is possible that poorly matching
antibody trajectories are given high posterior probability because these trajectories bet-
ter explain virus levels, and use of a Dirichlet-multinomial model allows us to explain
large deviations between antibody counts and underlying means.
The inconsistency is surprising, as neutralization measurements are qualitatively
consistent with trajectory shapes. The SU consensus variant 169K, susceptible to all
CAP256-VRC26 antibodies, precipitously declines.
Variant 169E, apparently able to
escape neutralization by all lineage members, increases steadily in relative abundance
shortly after lineage appearance. Variants 169Q and 169I, susceptible to neutralization
by some but not all lineage members exhibit complex patterns of abundance through
time. Nonetheless, when we ﬁt the Lotka-Volterra model, we ﬁnd the authors’ proposed
explanation does not quantitatively reproduce these trends. Timing mismatches suggest
why. For example, the replacement of 169Q by 169K occurs before CAP256-VRC26
antibodies are ﬁrst documented.
Table 4.3: Posterior medians and 95% credible intervals of virus antibody interaction
parameters.
Analysis
Parameter
Median
Lower
Upper
Model166b
BCAP 256−V RC26,R
11
4
90
Model166b
BCAP 256−V RC26,S
3
-7
41
Model166b
BCAP 256−V RC26,K
-21
-156
-8
Model166b
BCAP 256−V RC26,Z
-1
-25
20
Model169
BC,Q
-1871
-11661
1593
Model169
BX,Q
5390
1195
15955
Model169
BC,K
-2402
-11964
120
Model169
BX,K
-1273
-6387
588
Model169
BC,I
3827
110
16049
Model169
BX,I
1009
-1508
6005
Model169
BC,E
-662
-5934
1603
Model169
BX,E
1708
-128
6903
Model169
BC,Z
-264
-6680
4294
Model169
BX,Z
2774
358
9435

111
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGG
GGGGGGGGGGGGGG
G
G
G
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
pACAP256−VRC26
50
100
150
200
0.000
0.005
0.010
0.015
Time
pA
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGG
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
G
G
G
G
G
G
G
G G
GGGGGGGGG
G
G
G
G
G
G
G
G
G
G
G
G G
GGGGGGGGG
G
G
G
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGG
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
G
G
G
G
G
G
G
G
G
GGGGGGGG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GGGGGGGG
G
G
G
G
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGG
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G G
G
G
G
G
G
G
G
G
GGGGGGGGG G G G G G
G
G
G
G
G
G
G
G
GGGGGGGGG G G G
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGG
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG G G G
G
G
G
G
G G
GGGGGGGG
G
G G G G G G G
G
G
G
G
G G
GGGGGGGG
G
G G G
pVK
pVR
pVS
pVZ
50
100
150
200
50
100
150
200
50
100
150
200
50
100
150
200
0.00
0.25
0.50
0.75
1.00
Time
pV
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGG
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
G
G
G
G
G
G
G
G
G
G G G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G G G
G
G
G
G
G
G
G
G
G
1e+05
1e+06
50
100
150
200
Time
log L
Figure 4.9: Posterior median and 95% credible intervals for Model166b ﬁtted trajectories
with na = 1. Viruses labeled by their position 166 amino acid. Z is all amino acids other
than R,S,K.

112
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGG
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
G
G
G G
G
G
G
G
G
G G
G
G
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGG
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
pAC
pAX
50
100
150
200
50
100
150
200
0.000
0.002
0.004
0.006
Time
pA
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGG
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
G
G
G
G
G
G
G
G
G
GGGGGGGGG
G
G
G
G
G
G
G
G
G
G
G
G
G
GGGGGGGGG
G
G
G
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGG
GGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
G
GG
G
G
G
G G G
GGGGG
G
G
GG
G
G
G
G
G
GG
G
G
G
G G G
GGGGG
G
G
GG
G
G
G
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGG
G
G
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG G GG
G
G
G
G G G
G
G
GGGGGGGG GGG G GG
G
G
G
G G G
G
G
GGGGGGGG GG
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGG
G
G
GGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
G G
G
G
G
G
G
G
G
G
G
GGG
G
G
GG
G
G
G
G
G G
G
G
G
G
G
G
G
G
G
GGG
G
G
GG
G
G
G
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGG
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG G GG
G
G
G
G G G
GGGGG
G
GGGG GGG G GG
G
G
G
G G G
GGGGG
G
GGGG GG
pVE
pVI
pVK
pVQ
pVZ
50
100 150 200
50
100 150 200
50
100 150 200
50
100 150 200
50
100 150 200
0.00
0.25
0.50
0.75
1.00
Time
pV
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGGGGG
G
GGGGGGG
G
G
G
GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG
G
G
G
G
G
G
G
G
G
G
G G G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G G G
G
G
G
G
G
G
G
G
G
1e+04
1e+05
1e+06
50
100
150
200
Time
log L
Figure 4.10: Posterior median and 95% credible intervals for Model169 ﬁtted trajectories
with na = 2. Viruses labeled by their position 169 amino acid. Z is all amino acids other
than Q,K,I,E. Antibodies labeled according to whether they possess a double cysteine
(C) or not (X) in CDRH3.

113
G
G
G
G
G
G
G
G
G
G
G
CAP256−VRC26 (all)
CAP256−VRC26 Cys−Cys
CAP256−VRC26 Other
166R
166S
166K
169Q
169K
169I
169E
169Q
169K
169I
169E
0.00
0.25
0.50
0.75
1.00
Virus Variant
Posterior Probability
 of Elimination
Figure 4.11:
Posterior probability of antibody eliminating each virus variant under
Model166b and Model169. Panels show results for diﬀerent antibody groups.
Table 4.4: Posterior medians and 95% credible intervals of virus growth rates.
Analysis
Parameter
Median
Lower
Upper
Model166b
rR
0.01
-0.01
0.03
Model166b
rS
0.01
-0.01
0.04
Model166b
rK
-0.07
-0.11
-0.04
Model166b
rZ
-0.02
-0.06
0.01
Model169
rQ
1.24
0.46
2.41
Model169
rK
-0.44
-0.92
0.02
Model169
rI
0.35
-0.16
1.16
Model169
rE
0.43
-0.03
1.21
Model169
rZ
0.65
0.10
1.53
4.4
Discussion
With suﬃcient data, we can estimate antibody-virus interaction parameters in datasets
simulated under the Lotka-Volterra model and successfully rank interactions by their
strength. When analyzing an HIV-1 dataset, however, our results were often inconsis-
tent with results of neutralization assays, especially for Model169. Possible explanations
for the discrepancy include the small number of antibody time points, variables aﬀect-
ing viral load unaccounted for by our model, improper grouping of virus and antibody
sequences, and incompleteness of available neutralization information.
From our analysis of simulated datasets, we learned it was diﬃcult to estimate spline
functions adequately capturing the shape of antibody trajectories with small numbers of
data points. It was especially diﬃcult to capture an abrupt rise in antibody levels, as
was present in both the real dataset and simulated data. With too few basis functions,

114
the estimate of the peak location is shifted towards the center of the observation times
relative to its true position.
This shift is noticeable even when using |Ta| −1 basis
functions at the smallest sample size, and sometimes even with a large number of data
points (Figure 4.7). We chose knot positions using data quantiles to ensure estimability.
We also considered placing more knots in areas of high change in the data as a way
to capture the peak timing without excessive numbers of knots. Our strategy worked
well for the smallest datasets, but in other situations produced very poor least squares
trajectory estimates. Existing methods for spline knot placement (e.g. [123, 124, 125])
might improve ﬁt.
Fitted spline functions in the CAP256 dataset analysis explained patterns in the
virus data, but did not always closely match antibody observations. In our analysis of
simulated datasets, we knew precisely which antibodies aﬀected virus abundance and
that all antibodies and viruses within a class had the same dynamics. This is not true
for the real dataset. Other immune system components such as T-cells and the innate
immune system are also likely to aﬀect HIV-1 abundance. CD4+ T-cells, macrophages,
and dendritic cells have a special role in HIV-1 dynamics as HIV-1 infects them. Addi-
tionally, antibodies not belonging to the CAP256-VRC26 lineage could target the virus.
Estimated virus growth rates in our model (Table 4.4) are well below those reported for
early infection [90, 88] and sometimes even negative, suggesting controls on virus growth
not accounted for by antibody data. It is possible that our ﬁtted antibody trajecto-
ries, especially in Model169, are reﬂecting the actions of these components rather than
CAP256-VRC26 antibodies alone.
Another possible explanation for discrepancy between our measurements of virus
elimination and laboratory neutralization measurements is that CAP256-VRC26 aﬀects
processes other than neutralization such as by promoting clearance of free virus or in-
fected cells by the immune system in a way that diﬀers between variants.
There is
evidence that other HIV-1 broadly neutralizing antibodies enhance clearance of infected

115
cells [126]. A large part of our discrepancy is overestimation of the eﬀect of early relative
to late lineage members. This could be explained if CAP256-VRC26 lineage members
lacking the Cys-Cys motif were less eﬀective at neutralization but more eﬀective at sim-
ulating other immune responses.
Although presence of the double cysteine motif seems to separate later antibodies with
broader neutralization capability from earlier antibodies targeting SU, there is extensive
variability in neutralization by the former group [26, 109].
Neutralization was only
measured for two antibodies in the latter group so its variation is poorly characterized.
Although grouping antibodies by the presence or absence of the double cysteine is not
ideal, there are few other options.
Rapid evolution in antibody CDRH3 amino acid
sequence means some grouping of antibodies with diﬀerent sequences is inevitable if we
would like our modeled entities to be observed at multiple time points. High variability
across CDRH3 mean that we cannot capture diversity using genotype at only a small
number of sites. Grouping sequences based on presence or absence of the Cys-Cys motif
approximates cutting the antibody phylogeny (Figure 1.1) at the time of appearance of
that motif and allowing separate parameters in each group.
Unlike a static version of the quasispecies equilibrium model, the generalized Lotka-
Volterra model is capable of explaining observed patterns of virus variant abundance
through time in real datasets. However, additional development of both datasets and
statistical methods will be needed. Antibody measurements at more time points will
be needed. Statistical work will need to develop scalable approaches to handle realistic
situations in which we lack a priori hypotheses about which virus and antibody variants
interact.

116
CHAPTER 5.
CONCLUSION
We developed a method to estimate ﬁtness eﬀects of individual mutations and pairs
of mutations from counts of sequences in a cross-sectional sample of viruses within a host.
This method successfully estimates ﬁtness eﬀects in simulated datasets as long as the
associated sequences are not extremely rare and produces interpretable inferences when
applied to two HIV-1 datasets. It compares favorably to a competing approach [14] in
rank order of haplotype ﬁtness estimates and credible interval coverage, and unlike that
approach, decomposes haplotype ﬁtness eﬀects into ﬁtness eﬀects of individual mutations.
In order to estimate ﬁtnesses from a single sample, our method makes the strong
and possibly unrealistic assumption of quasispecies equilibrium. Our work in Chapter
3 shows that equilibrium of low ﬁtness variants surrounding a peak is rapidly attained.
For ﬁtness landscapes with such a geometry, equilibrium is indeed a realistic assumption.
However, the complex population structures frequently observed in HIV-1 patients are
more diﬃcult to explain as an equilibrium phenomenon. They are especially diﬃcult to
explain when the quasispecies consists of highly separated ﬁtness peaks with low ﬁtness
clouds. In such a scenario, the quasispecies renormalized to a local region around a ﬁtness
peak rapidly approaches a near-equilibrium state, but the relative frequency of haplotypes
at each peak converges very slowly to the equilibrium value. This justiﬁes our strategy of
clustering haplotypes, but also suggests more stringent clustering may be warranted. It is
clear that valuable information may be extracted even from nonequilibrium populations,
but the eﬀects on inference must be better characterized. Prior work [14] suggests that

117
rank order of haplotype ﬁtnesses can be recovered, but the eﬀect on inference of allele
ﬁtness eﬀects, and epistatic interactions in particular, is unknown.
Our concerns about whether the quasispecies equilibrium model could explain ob-
served diversity led us to models of virus populations incorporating immune selection.
The availability of both virus and antibody sequencing datasets from the same host pro-
vides an opportunity to ﬁt such models. This work is a ﬁrst attempt at statistically
modeling interactions of virus-antibody pairs from next-generation sequencing time se-
ries. Although this method is able to recover information from simulated datasets, when
applied to virus and antibody sequencing datasets from a patient infected with HIV-1,
parameter estimates were diﬃcult to reconcile with laboratory neutralization measure-
ments.
The basic principle that virus levels should decrease in response to increased antibody
levels and that antibody levels should increase in response to increased levels of its target
antigen appears sound, but the question of how to best detect that signal in large datasets
in the presence of numerous competing signals remains open. Future work for antibody-
virus interactions must address the problem of how to extract meaningful signals from the
data in the face of numerous unmeasured variables aﬀecting virus dynamics. Scalability
is also crucial to transition from inferring interactions between a small number of sites
with a priori evidence of importance to many potentially irrelevant candidate sites over
large genomic regions.
Increasing the number of measurement time points is likely to improve inferences, but
metagenomic [23, 24] and viral [25] analyses using the Lotka-Volterra model have ben-
eﬁted from replication across individuals. Convergence in individual immune responses
[127] provides some hope of similar replication in studies of virus-immune system interac-
tion, though modiﬁcations will be needed to ensure comparable features across individu-
als. Antibody clonal lineages are by deﬁnition descended from a single ancestral cell, so
the same clonal lineage will not be present in more than one individual. Alternative fea-

118
tures include which germline genes are used in the antibody, protein structural features,
and levels of germline divergence. Another way antibodies might be comparable across
individuals is if we model the eﬀect of antibody therapeutics rather than host-produced
antibody.
Finer-scale phylogenetic grouping of antibodies might be a way to decrease variability
within groups while maintaining continuity across time points. Alternatively, if structural
information were available, we could cluster antibodies with similar antigen binding site
structures.
Use of hierarchical models on virus-antibody interaction parameters and
on virus growth rates could improve on our current approach, which forces the same
parameter values on virus haplotypes with potentially heterogeneous dynamics.
For
example, we might ﬁt a model in which virus growth rates were decomposed into an
average growth rate common to all viruses and contributions from individual alleles,
with the latter modeled according to a hierarchical model. The eﬀect of antibody on
virus could be similarly modeled, with a sparse prior reﬂecting our belief that only a small
number of sites should be important to interaction with a particular antibody. Fitting
such complex models will likely require both more measurement time points (especially
for antibodies) and more scalable approaches to inference.
Our model necessitates attributing variation in virus levels to levels of antibodies
grouped in a prespeciﬁed manner, to virus intrinsic growth rates, or to measurement
noise uncorrelated through time. A modiﬁed version of the Kalman ﬁlter appropriate
for models with nonlinear terms, such as the unscented Kalman ﬁlter [128], would ac-
count for likely autocorrelation in virus levels unaccounted for by model terms. Using
such an approach, we might be able to eﬃciently model both virus eﬀect on antibody
levels and antibody eﬀect on virus levels, which our current inference strategy does not
permit. Semi-mechanistic models in which some unknown parameters vary as a smooth
function through time are another proposed way to account for the inevitable eﬀects of

119
unmeasured biological variables [129, 130]. For example, a semi-mechanistic model could
be used for virus growth rates in the absence of antibodies.
The development of scalable approaches to inferring interactions between viruses and
antibodies might draw inspiration from the inference of regulatory networks from gene
expression time series [131]. However, unlike models of multispecies interactions, gene
regulatory network models commonly use linear diﬀerential equations. There is also more
potential for replication across individuals as individuals of a species share more or less
the same set of genes.
Datasets from a single individual with both antibody and virus time series data have
only appeared in the past two years [107, 26]. If this gives rise to a new area of research,
as did virus sequencing [2] and immune repertoire sequencing [4] individually, statistical
inference methods for the datasets will be an asset in suggesting interactions for further
study supported by time series data.

120
REFERENCES
[1] Michael L Metzker. Sequencing technologies-the next generation. Nature Reviews
Genetics, 11(1):31–46, 2010.
[2] Niko Beerenwinkel, Huldrych F G¨unthard, Volker Roth, and Karin J Metzner.
Challenges and opportunities in estimating viral genetic diversity from next-
generation sequencing data. Frontiers in Microbiology, 3, 2012.
[3] Kerensa McElroy, Torsten Thomas, and Fabio Luciani. Deep sequencing of evolving
pathogen populations: applications, errors, and bioinformatic solutions. Microbial
Informatics and Experimentation, 4(1):1, 2014.
[4] George Georgiou, Gregory C Ippolito, John Beausang, Christian E Busse, Hedda
Wardemann, and Stephen R Quake. The promise and challenge of high-throughput
sequencing of the antibody repertoire. Nature Biotechnology, 32(2):158–168, 2014.
[5] Manfred Eigen. Selforganization of matter and the evolution of biological macro-
molecules. Naturwissenschaften, 58(10):465–523, 1971.
[6] Peter Schuster and Peter F Stadler. Early replicons: origin and evolution. Origin
and Evolution of Viruses, 2:1–42, 2008.
[7] Colin J Thompson and John L McBride. On Eigen’s theory of the self-organization
of matter and the evolution of biological macromolecules.
Mathematical Bio-
sciences, 21(1):127–142, 1974.

121
[8] Martin A Nowak and Robert M May. Virus dynamics. Oxford University Press,
Oxford, 2000.
[9] Peter Schuster and J¨org Swetina. Stationary mutant distributions and evolutionary
optimization. Bulletin of Mathematical Biology, 50(6):635–660, 1988.
[10] Esteban Domingo, Julie Sheldon, and Celia Perales. Viral quasispecies evolution.
Microbiology and Molecular Biology Reviews, 76(2):159–216, 2012.
[11] Esteban Domingo, Donna Sabo, Tadatsugu Taniguchi, and Charles Weissmann.
Nucleotide sequence heterogeneity of an RNA phage population. Cell, 13(4):735–
744, 1978.
[12] Marco Vignuzzi and Raul Andino. Biological implications of picornavirus ﬁdelity
mutants. In Ellie Ehrenfeld, Estaban Domingo, and Raymond P Roos, editors, The
Picornaviruses, chapter 13, pages 213–227. ASM Press, Washington, DC, 2010.
[13] Lawrence A Loeb, John M Essigmann, Farhad Kazazi, Jue Zhang, Karl D Rose,
and James I Mullins. Lethal mutagenesis of HIV with mutagenic nucleoside analogs.
Proceedings of the National Academy of Sciences, 96(4):1492–1497, 1999.
[14] David Seifert, Francesca Di Giallonardo, Karin J Metzner, Huldrych F G¨unthard,
and Niko Beerenwinkel. A framework for inferring ﬁtness landscapes of patient-
derived viruses using quasispecies theory. Genetics, 199(1):191–203, 2015.
[15] Paola Falugi and Laura Giarr´e. Identiﬁcation and validation of quasispecies models
for biological systems. Systems & Control Letters, 58(7):529–539, 2009.
[16] Cajo JF Ter Braak. A Markov Chain Monte Carlo version of the genetic algo-
rithm Diﬀerential Evolution: easy Bayesian computing for real parameter spaces.
Statistics and Computing, 16(3):239–249, 2006.

122
[17] Gareth M Jenkins, Michael Worobey, Christopher H Woelk, and Edward C Holmes.
Evidence for the non-quasispecies evolution of RNA viruses. Molecular Biology and
Evolution, 18(6):987–994, 2001.
[18] Hyung-June Woo and Jaques Reifman. A quantitative quasispecies theory-based
model of virus escape mutation under immune selection. Proceedings of the National
Academy of Sciences, 109(32):12980–12985, 2012.
[19] Valerie H Odegard and David G Schatz.
Targeting of somatic hypermutation.
Nature Reviews Immunology, 6(8):573–583, 2006.
[20] Javier Martinez-Picado, Julia G Prado, Elizabeth E Fry, Katja Pfaﬀerott, Alasdair
Leslie, Senica Chetty, Christina Thobakgale, Isobel Honeyborne, Hayley Crawford,
Philippa Matthews, et al. Fitness cost of escape mutations in p24 gag in associ-
ation with control of human immunodeﬁciency virus type 1. Journal of Virology,
80(7):3617–3623, 2006.
[21] Martin A Nowak, Robert M May, and Karl Sigmund. Immune responses against
multiple epitopes. Journal of Theoretical Biology, 175(3):325–353, 1995.
[22] Hyung-June Woo and Jaques Reifman. A quantitative quasispecies theory-based
model of virus escape mutation under immune selection. Proceedings of the National
Academy of Sciences, 109(32):12980–12985, 2012.
[23] Simeone Marino, Nielson T Baxter, Gary B Huﬀnagle, Joseph F Petrosino, and
Patrick D Schloss. Mathematical modeling of primary succession of murine intesti-
nal microbiota. Proceedings of the National Academy of Sciences, 111(1):439–444,
2014.
[24] Vanni Bucci, Belinda Tzen, Ning Li, Matt Simmons, Takeshi Tanoue, Elijah Bog-
art, Luxue Deng, Vladimir Yeliseyev, Mary L Delaney, Qing Liu, et al. MDSINE:

123
Microbial dynamical systems inference engine for microbiome time-series analyses.
Genome Biology, 17(1):121, 2016.
[25] Fr´ed´eric Fabre, Josselin Montarry, J´erˆome Coville, Rachid Senoussi, Vincent Si-
mon, and Benoˆıt Moury. Modelling the evolutionary dynamics of viruses within
their hosts: a case study using high-throughput sequencing.
PLoS Pathogens,
8(4):e1002654, 2012.
[26] Jinal N Bhiman, Colin Anthony, Nicole A Doria-Rose, Owen Karimanzira,
Chaim A Schramm, Thandeka Khoza, Dale Kitchin, Gordon Botha, Jason Gorman,
Nigel J Garrett, et al. Viral variants that initiate and drive maturation of V1V2-
directed HIV-1 broadly neutralizing antibodies.
Nature Medicine, 21(11):1332–
1336, 2015.
[27] Fernando Mart´ınez, Guillaume Laﬀorgue, Marco J Morelli, Fernando Gonz´alez-
Candelas, Nam-Hai Chua, Jos´e-Antonio Dar`os, and Santiago F Elena. Ultradeep
sequencing analysis of population dynamics of virus escape mutants in RNAi-
mediated resistant plants.
Molecular Biology and Evolution, 29(11):3297–3307,
2012.
[28] Severine Margeridon-Thermet, Sophie Le Pogam, Lewyn Li, Tommy F Liu, Nancy
Shulman, Robert W Shafer, and Isabel Najera.
Similar prevalence of low-
abundance drug-resistant variants in treatment-naive patients with genotype 1a
and 1b hepatitis C virus infections as determined by ultradeep pyrosequencing.
PloS One, 9(8):e105569, 2014.
[29] John Archer, Andrew Rambaut, Bruce E Taillon, P Richard Harrigan, Marilyn
Lewis, and David L Robertson. The evolutionary analysis of emerging low fre-
quency HIV-1 CXCR4 using variants through time - an ultra-deep approach. PLoS
Computational Biology, 6(12):e1001022, 2010.

124
[30] Cornell Kortenhoeven, Fourie Joubert, Armanda DS Bastos, and Celia Abolnik.
Virus genome dynamics under diﬀerent propagation pressures: reconstruction of
whole genome haplotypes of West Nile viruses from NGS data. BMC Genomics,
16(1):118, 2015.
[31] Will Fischer, Vitaly V Ganusov, Elena E Giorgi, Peter T Hraber, Brandon F
Keele, Thomas Leitner, CliﬀS Han, Cheryl D Gleasner, Lance Green, Chien-Chi
Lo, et al. Transmission of single HIV-1 genomes and dynamics of early immune
escape revealed by ultra-deep sequencing. PloS One, 5(8):e12303, 2010.
[32] Matthew R Henn, Christian L Boutwell, Patrick Charlebois, Niall J Lennon,
Karen A Power, Alexander R Macalalad, Aaron M Berlin, Christine M Malboeuf,
Elizabeth M Ryan, Sante Gnerre, et al. Whole genome deep sequencing of HIV-1
reveals the impact of early minor variants upon immune recognition during acute
infection. PLoS Pathogens, 8(3):e1002529, 2012.
[33] MR Capobianchi, E Giombini, and G Rozera. Next-generation sequencing tech-
nology in clinical virology. Clinical Microbiology and Infection, 19(1):15–22, 2013.
[34] Antonio V Border´ıa, Ofer Isakov, Gonzalo Moratorio, Rasmus Henningsson, So-
nia Ag¨uera-Gonz´alez, Lindsey Organtini, Nina F Gn¨adig, Herv´e Blanc, Andr´es
Alcover, Susan Hafenstein, et al. Group selection and contribution of minority
variants during virus adaptation determines virus ﬁtness and phenotype. PLoS
Pathogens, 11(5):e1004838, 2015.
[35] Nathan D Grubaugh, Darci R Smith, Doug E Brackney, Angela M Bosco-Lauth,
Joseph R Fauver, Corey L Campbell, Todd A Felix, Hannah Romo, Nisha K Dug-
gal, Elizabeth A Dietrich, et al. Experimental evolution of an RNA virus in wild
birds: evidence for host-dependent impacts on population structure and competi-
tive ﬁtness. PLoS Pathogens, 11(5):e1004874, 2015.

125
[36] Samuel Alizon, Fabio Luciani, and Roland R Regoes. Epidemiological and clinical
consequences of within-host evolution. Trends in Microbiology, 19(1):24–32, 2011.
[37] Debrah I Boeras, Peter T Hraber, Mackenzie Hurlston, Tammy Evans-Strickfaden,
Tanmoy Bhattacharya, Elena E Giorgi, Joseph Mulenga, Etienne Karita, Bette T
Korber, Susan Allen, et al.
Role of donor genital tract HIV-1 diversity in
the transmission bottleneck.
Proceedings of the National Academy of Sciences,
108(46):E1156–E1163, 2011.
[38] Fabio Luciani, Rowena A Bull, and Andrew R Lloyd.
Next generation deep
sequencing and vaccine design: today and tomorrow. Trends in Biotechnology,
30(9):443–452, 2012.
[39] Rowena A Bull, Preston Leung, Silvana Gaudieri, Pooja Deshpande, Barbara
Cameron, Melanie Walker, Abha Chopra, Andrew R Lloyd, and Fabio Luciani.
Transmitted/founder viruses rapidly escape from CD8+ T cell responses in acute
hepatitis C virus infection. Journal of Virology, 89(10):5478–5490, 2015.
[40] Rafael Sanju´an, Andr´es Moya, and Santiago F Elena. The distribution of ﬁtness
eﬀects caused by single-nucleotide substitutions in an RNA virus. Proceedings of
the National Academy of Sciences of the United States of America, 101(22):8396–
8401, 2004.
[41] Joan B Peris, Paulina Davis, Jos´e M Cuevas, Miguel R Nebot, and Rafael Sanju´an.
Distribution of ﬁtness eﬀects caused by single-nucleotide substitutions in bacterio-
phage f1. Genetics, 185(2):603–609, 2010.
[42] Jasna Lali´c, Jos´e M Cuevas, and Santiago F Elena.
Eﬀect of host species on
the distribution of mutational ﬁtness eﬀects for an RNA virus. PLoS Genetics,
7(11):e1002378, 2011.

126
[43] Rafael Sanju´an, Andr´es Moya, and Santiago F Elena. The contribution of epistasis
to the architecture of ﬁtness in an RNA virus. Proceedings of the National Academy
of Sciences of the United States of America, 101(43):15376–15379, 2004.
[44] Santiago F Elena, Ricard V Sol´e, and Josep Sardany´es. Simple genomes, com-
plex interactions: epistasis in RNA virus. Chaos: An Interdisciplinary Journal of
Nonlinear Science, 20(2):026106, 2010.
[45] Ashley Acevedo, Leonid Brodsky, and Raul Andino.
Mutational and ﬁtness
landscapes of an RNA virus revealed through population sequencing.
Nature,
505(7485):686–690, 2014.
[46] Nicholas C Wu, Arthur P Young, Laith Q Al-Mawsawi, C Anders Olson, Jun Feng,
Hangfei Qi, Harding H Luan, Xinmin Li, Ting-Ting Wu, and Ren Sun. High-
throughput identiﬁcation of loss-of-function mutations for anti-interferon activity
in the inﬂuenza A virus NS segment. Journal of Virology, 88(17):10157–10164,
2014.
[47] Christopher J. R. Illingworth and Ville Mustonen. Distinguishing driver and pas-
senger mutations in an evolutionary history categorized by interference. Genetics,
189(3):989–1000, 2011.
[48] Christopher JR Illingworth. Fitness inference from short-read data: within-host
evolution of a reassortant H5N1 inﬂuenza virus. Molecular Biology and Evolution,
32(11):3012–3026, 2015.
[49] Ziheng Yang and Rasmus Nielsen. Mutation-selection models of codon substitution
and their use to estimate selective strengths on codon usage. Molecular Biology
and Evolution, 25(3):568–579, 2008.

127
[50] Asif U Tamuri, Mario dos Reis, and Richard A Goldstein. Estimating the dis-
tribution of selection coeﬃcients from phylogenetic data using sitewise mutation-
selection models. Genetics, 190(3):1101–1115, 2012.
[51] Andrew L Ferguson, Jaclyn K Mann, Saleha Omarjee, Thumbi Ndungu, Bruce D
Walker, and Arup K Chakraborty. Translating HIV sequences into quantitative
ﬁtness landscapes predicts viral vulnerabilities for rational immunogen design. Im-
munity, 38(3):606–617, 2013.
[52] Trevor Hinkley, Jo˜ao Martins, Colombe Chappey, Mojgan Haddad, Eric Stawiski,
Jeannette M Whitcomb, Christos J Petropoulos, and Sebastian Bonhoeﬀer.
A
systems analysis of mutational eﬀects in HIV-1 protease and reverse transcriptase.
Nature Genetics, 43(5):487–489, 2011.
[53] Manfred Eigen and Peter Schuster. A principle of natural self-organization. Natur-
wissenschaften, 64(11):541–565, 1977.
[54] David B Saakian, E Munoz, Chin-Kun Hu, and MW Deem. Quasispecies theory
for multiple-peak ﬁtness landscapes. Physical Review E, 73(4):041913, 2006.
[55] David Seifert and Niko Beerenwinkel. Quasispecies: From Theory to Experimental
Systems, chapter Estimating Fitness of Viral Quasispecies from Next-Generation
Sequencing Data, pages 181–200. Springer International Publishing, Cham, 2016.
[56] Daniel M Weinreich, Yinghong Lan, C Scott Wylie, and Robert B Heckendorn.
Should evolutionary geneticists worry about higher-order epistasis? Current Opin-
ion in Genetics & Development, 23(6):700–707, 2013.
[57] Roger D Kouyos, Gabriel E Leventhal, Trevor Hinkley, Mojgan Haddad, Jean-
nette M Whitcomb, Christos J Petropoulos, and Sebastian Bonhoeﬀer. Exploring
the complexity of the HIV-1 ﬁtness landscape. PLoS Genetics, 8(3):e1002551, 2012.

128
[58] Laith Q Al-Mawsawi, Nicholas C Wu, Justin De La Cruz, Vivian Cai Shi, Ting-
Ting Wu, Eric S Daar, Martha J Lewis, Otto O Yang, and Ren Sun. Short com-
munication: HIV-1 gag genetic variation in a single acutely infected participant
deﬁned by high-resolution deep sequencing. AIDS Research and Human Retro-
viruses, 30(8):806–811, 2014.
[59] Gabor Csardi and Tamas Nepusz. The igraph software package for complex network
research. InterJournal, Complex Systems:1695, 2006.
[60] Yuri S Semenov, Alexander S Bratus, and Artem S Novozhilov. On the behav-
ior of the leading eigenvalue of Eigen’s evolutionary matrices.
arXiv preprint
arXiv:1405.6411, 2014.
[61] Yoav Benjamini and Yosef Hochberg. Controlling the false discovery rate: a prac-
tical and powerful approach to multiple testing. Journal of the Royal Statistical
Society Series B, 57:289–300, 1995.
[62] CF JeﬀWu and Michael S Hamada. Experiments: planning, analysis, and opti-
mization, volume 552. John Wiley & Sons, 2011.
[63] Jonathan Goodman and Jonathan Weare.
Ensemble samplers with aﬃne in-
variance. Communications in Applied Mathematics and Computational Science,
5(1):65–80, 2010.
[64] Daniel Foreman-Mackey, David W Hogg, Dustin Lang, and Jonathan Goodman.
emcee: The MCMC hammer.
Publications of the Astronomical Society of the
Paciﬁc, 125(925):306–312, 2013.
[65] Andrew Gelman, John B Carlin, Donald B Rubin, and Hal S Stern. Bayesian data
analysis. Chapman and Hall, 2004.

129
[66] Louis M Mansky. The mutation rate of human immunodeﬁciency virus type 1 is
inﬂuenced by the Vpr gene. Virology, 222(2):391–400, 1996.
[67] Heng Li and Richard Durbin.
Fast and accurate short read alignment with
Burrows–Wheeler transform. Bioinformatics, 25(14):1754–1760, 2009.
[68] Raquel Assis. Strong epistatic selection on the RNA secondary structure of HIV.
PLoS Pathogens, 10(9):e1004363, 2014.
[69] Joseph M Watts, Kristen K Dang, Robert J Gorelick, Christopher W Leonard,
Julian W Bess Jr, Ronald Swanstrom, Christina L Burch, and Kevin M Weeks.
Architecture and secondary structure of an entire HIV-1 RNA genome. Nature,
460(7256):711–716, 2009.
[70] Martyn Plummer, Nicky Best, Kate Cowles, and Karen Vines. CODA: Convergence
diagnosis and output analysis for MCMC. R News, 6(1):7–11, 2006.
[71] Elaine R Mardis. Next-generation sequencing platforms. Annual Review of Ana-
lytical Chemistry, 6:287–303, 2013.
[72] Nicholas C Wu, Justin De La Cruz, Laith Q Al-Mawsawi, C Anders Olson, Hangfei
Qi, Harding H Luan, Nguyen Nguyen, Yushen Du, Shuai Le, Ting-Ting Wu,
et al. HIV-1 quasispecies delineation by tag linkage deep sequencing. PloS One,
9(5):e97505, 2014.
[73] Osvaldo Zagordi, Arnab Bhattacharya, Nicholas Eriksson, and Niko Beerenwinkel.
ShoRAH: estimating the genetic diversity of a mixed sample from next-generation
sequencing data. BMC Bioinformatics, 12(1):119, 2011.
[74] Christopher JR Illingworth, Andrej Fischer, and Ville Mustonen. Identifying se-
lection in the within-host evolution of inﬂuenza using viral sequence data. PLoS
Computational Biology, 10(7):e1003755, 2014.

130
[75] Alberto L´opez-Bueno, A Rastrojo, R Peir´o, M Arenas, and A Alcam´ı. Ecological
connectivity shapes quasispecies structure of RNA viruses in an Antarctic lake.
Molecular Ecology, 24(19):4812–4825, 2015.
[76] Adam S Lauring and Raul Andino. Quasispecies theory and the behavior of RNA
viruses. PLoS Pathogens, 6(7):e1001005, 2010.
[77] J¨org Swetina and Peter Schuster. Self-replication with errors: A model for polynu-
cleotide replication. Biophysical Chemistry, 16(4):329–345, 1982.
[78] Fabio Zanini and Richard A Neher.
Quantifying selection against synonymous
mutations in HIV-1 env evolution. Journal of Virology, 87(21):11843–11850, 2013.
[79] Itay Mayrose, Adi Stern, Ela O Burdelova, Yosef Sabo, Nihay Laham-Karam,
Rachel Zamostiano, Eran Bacharach, and Tal Pupko. Synonymous site conserva-
tion in the HIV-1 genome. BMC Evolutionary Biology, 13(1):164, 2013.
[80] Rasmus Nielsen and Ziheng Yang. Likelihood models for detecting positively se-
lected amino acid sites and applications to the HIV-1 envelope gene. Genetics,
148(3):929–936, 1998.
[81] Ziheng Yang. Maximum likelihood analysis of adaptive evolution in HIV-1 gp120
env gene. In Paciﬁc Symposium on Biocomputing, volume 6, pages 226–237. Cite-
seer, 2001.
[82] Fegn Xiao-Li, Li Yu-Xiao, Gu Jian-Zhong, and Zhuo Yi-Zhong. Relaxation prop-
erty and stability analysis of the quasispecies models. Communications in Theo-
retical Physics, 52(4):726, 2009.
[83] Christel Kamp. A quasispecies approach to viral evolution in the context of an
adaptive immune system. Microbes and Infection, 5(15):1397–1405, 2003.

131
[84] Vladimir Redko and Yuri Tsoy. Estimation of the evolution speed for the quasis-
pecies model: Arbitrary alphabet case. In International Conference on Artiﬁcial
Intelligence and Soft Computing, pages 460–469. Springer, 2006.
[85] Peter Schuster. Molecular insight into the evolution of phenotypes. Evolutionary
Dynamics–Exploring the Interplay of Accident, Selection, Neutrality, and Function,
pages 163–215, 2003.
[86] Arturo Mar´ın, H´ector Tejero, Juan Carlos Nu˜no, and Francisco Montero. Charac-
teristic time in quasispecies evolution. Journal of Theoretical Biology, 303:25–32,
2012.
[87] Jos´e M Cuevas, Ron Geller, Raquel Garijo, Jos´e L´opez-Aldeguer, and Rafael
Sanju´an.
Extremely high mutation rate of HIV-1 in vivo.
PLoS Biology,
13(9):e1002251, 2015.
[88] Ruy M Ribeiro, Li Qin, Leslie L Chavez, Dongfeng Li, Steven G Self, and Alan S
Perelson. Estimation of the initial viral growth rate and basic reproductive number
during acute HIV-1 infection. Journal of Virology, 84(12):6096–6102, 2010.
[89] Edward C Holmes and Andr´es Moya. Is the quasispecies concept relevant to RNA
viruses? Journal of Virology, 76(1):460–462, 2002.
[90] Susan J Little, Angela R McLean, Celsa A Spina, Douglas D Richman, and Diane V
Havlir. Viral dynamics of acute HIV-1 infection. Journal of Experimental Medicine,
190(6):841–850, 1999.
[91] Esteban Domingo and Peter Schuster. What is a quasispecies? Historical origins
and current scope. In Quasispecies: From Theory to Experimental Systems, pages
1–22. Springer, 2015.

132
[92] Celia Perales and Esteban Domingo. Antiviral strategies based on lethal mutage-
nesis and error threshold. In Quasispecies: From Theory to Experimental Systems,
pages 323–339. Springer, 2015.
[93] Christopher JR Illingworth and Ville Mustonen. Components of selection in the
evolution of the inﬂuenza virus: linkage eﬀects beat inherent selection.
PLoS
Pathogens, 8(12):e1003091, 2012.
[94] Marco Vignuzzi, Jeﬀrey K Stone, Jamie J Arnold, Craig E Cameron, and Raul
Andino. Quasispecies diversity determines pathogenesis through cooperative inter-
actions in a viral population. Nature, 439(7074):344–348, 2006.
[95] Juan Arbiza, Santiago Mirazo, and Hugo Fort. Viral quasispecies proﬁles as the
result of the interplay of competition and cooperation. BMC Evolutionary Biology,
10(1):137, 2010.
[96] Julie Overbaugh and Lynn Morris. The antibody response against HIV-1. Cold
Spring Harbor Perspectives in Medicine, 2(1):a007039, 2012.
[97] Dennis R Burton and Lars Hangartner. Broadly neutralizing antibodies to HIV
and their role in vaccine design. Annual Review of Immunology, 34:635–659, 2016.
[98] Mattia Bonsignori, Hua-Xin Liao, Feng Gao, Wilton B Williams, S Munir Alam,
David C Monteﬁori, and Barton F Haynes. Antibody-virus co-evolution in HIV
infection: paths for HIV vaccine development. Immunological Reviews, 275(1):145–
160, 2017.
[99] Inbal Sela-Culang, Yanay Ofran, and Bjoern Peters. Antibody speciﬁc epitope
prediction-emergence of a new paradigm. Current Opinion in Virology, 11:98–102,
2015.

133
[100] Konrad Krawczyk, Xiaofeng Liu, Terry Baker, Jiye Shi, and Charlotte M Deane.
Improving B-cell epitope prediction and its application to global antibody-antigen
docking. Bioinformatics, 30(16):2288–2294, 2014.
[101] Lorenzo Asti, Guido Uguzzoni, Paolo Marcatili, and Andrea Pagnani. Maximum-
entropy models of sequenced immune repertoires predict antigen-antibody aﬃnity.
PLoS Computational Biology, 12(4):e1004870, 2016.
[102] Catherine AA Beauchemin and Andreas Handel. A review of mathematical models
of inﬂuenza A infections within a host or cell culture: lessons learned and challenges
ahead. BMC Public Health, 11(1):S7, 2011.
[103] Kasia A Pawelek, Giao T Huynh, Michelle Quinlivan, Ann Cullinane, Libin Rong,
and Alan S Perelson. Modeling within-host dynamics of inﬂuenza virus infection
including immune responses. PLoS Computational Biology, 8(6):e1002588, 2012.
[104] Hana M Dobrovolny, Micaela B Reddy, Mohamed A Kamal, Craig R Rayner, and
Catherine AA Beauchemin. Assessing mathematical models of inﬂuenza infections
using features of the immune response. PloS One, 8(2):e57088, 2013.
[105] Hannah E Clapham, Than Ha Quyen, Duong Thi Hue Kien, Ilaria Dorigatti,
Cameron P Simmons, and Neil M Ferguson. Modelling virus and antibody dynam-
ics during dengue virus infection suggests a role for antibody in virus clearance.
PLoS Computational Biology, 12(5):e1004951, 2016.
[106] Nicolas B Strauli and Ryan D Hernandez. Statistical inference of a convergent
antibody repertoire response to inﬂuenza vaccine. Genome Medicine, 8(1):60, 2016.
[107] Nicole A Doria-Rose, Chaim A Schramm, Jason Gorman, Penny L Moore, Jinal N
Bhiman, Brandon J DeKosky, Michael J Ernandes, Ivelin S Georgiev, Helen J
Kim, Marie Pancera, et al.
Developmental pathway for potent V1V2-directed
HIV-neutralizing antibodies. Nature, 509(7498):55–62, 2014.

134
[108] Francois van Loggerenberg, Koleka Mlisana, Carolyn Williamson, Sara C Auld,
Lynn Morris, Clive M Gray, Quarraisha Abdool Karim, Anneke Grobler, Nomam-
pondo Barnabas, Itua Iriogbe, et al. Establishing a cohort at high risk of HIV
infection in South Africa: challenges and experiences of the CAPRISA 002 acute
infection study. PloS One, 3(4):e1954, 2008.
[109] Nicole A Doria-Rose, Jinal N Bhiman, Ryan S Roark, Chaim A Schramm, Ja-
son Gorman, Gwo-Yu Chuang, Marie Pancera, Evan M Cale, Michael J Ernandes,
Mark K Louder, et al. New member of the V1V2-directed CAP256-VRC26 lin-
eage that shows increased breadth and exceptional potency. Journal of Virology,
90(1):76–91, 2016.
[110] Suzanne Willey, Marl´en MI Aasa-Chapman, Stephen O’Farrell, Pierre Pellegrino,
Ian Williams, Robin A Weiss, and Stuart JD Neil.
Extensive complement-
dependent enhancement of HIV-1 by autologous non-neutralising antibodies at
early stages of infection. Retrovirology, 8(1):16, 2011.
[111] Jim O Ramsay, G Hooker, D Campbell, and J Cao. Parameter estimation for
diﬀerential equations: a generalized smoothing approach. Journal of the Royal
Statistical Society: Series B (Statistical Methodology), 69(5):741–796, 2007.
[112] Hua Liang and Hulin Wu. Parameter estimation for diﬀerential equation models
using a framework of measurement error in regression models.
Journal of the
American Statistical Association, 103(484):1570–1583, 2008.
[113] Ian Holmes, Keith Harris, and Christopher Quince. Dirichlet multinomial mixtures:
generative models for microbial metagenomics. PloS One, 7(2):e30126, 2012.
[114] Stan Development Team. Cmdstan: the command-line interface to stan.
[115] David M Allen. The relationship between variable selection and data agumentation
and a method for prediction. Technometrics, 16(1):125–127, 1974.

135
[116] R Core Team.
R: A Language and Environment for Statistical Computing.
R
Foundation for Statistical Computing, Vienna, Austria, 2016.
[117] MJ Betancourt, Simon Byrne, and Mark Girolami. Optimizing the integrator step
size for Hamiltonian Monte Carlo. arXiv preprint arXiv:1411.6669, 2014.
[118] Stan Development Team.
Stan Modeling Language Users Guide and Reference
Manual, Version 2.14.0, 2016.
[119] Dmitriy A Bolotin, Stanislav Poslavsky, Igor Mitrophanov, Mikhail Shugay, Ilgar Z
Mamedov, Ekaterina V Putintseva, and Dmitriy M Chudakov. MiXCR: software
for comprehensive adaptive immunity proﬁling. Nature Methods, 12(5):380–381,
2015.
[120] Benjamin J Callahan, Paul J McMurdie, Michael J Rosen, Andrew W Han, Amy
Jo A Johnson, and Susan P Holmes. DADA2: high-resolution sample inference
from illumina amplicon data. Nature Methods, 2016.
[121] Kazutaka Katoh and Daron M Standley. MAFFT multiple sequence alignment
software version 7: improvements in performance and usability. Molecular Biology
and Evolution, 30(4):772–780, 2013.
[122] Stan Development Team. RStan: the R interface to Stan, 2016. R package version
2.14.1.
[123] Nicolas Molinari, Jean-Fran¸cois Durand, and Robert Sabatier. Bounded optimal
knots for regression splines. Computational Statistics & Data Analysis, 45(2):159–
178, 2004.
[124] Mary J Lindstrom. Penalized estimation of free-knot splines. Journal of Compu-
tational and Graphical Statistics, 8(2):333–352, 1999.

136
[125] Akemi G´alvez and Andr´es Iglesias. Eﬃcient particle swarm optimization approach
for data ﬁtting with free knot b-splines. Computer-Aided Design, 43(12):1683–1692,
2011.
[126] Ching-Lan Lu, Dariusz K Murakowski, Stylianos Bournazos, Till Schoofs, Debolina
Sarkar, Ariel Halper-Stromberg, Joshua A Horwitz, Lilian Nogueira, Jovana Goli-
janin, Anna Gazumyan, et al.
Enhanced clearance of HIV-1–infected cells by
broadly neutralizing antibodies against HIV-1 in vivo. Science, 352(6288):1001–
1004, 2016.
[127] Poornima Parameswaran, Yi Liu, Krishna M Roskin, Katherine KL Jackson,
Vaishali P Dixit, Ji-Yeun Lee, Karen L Artiles, Simona Zompi, Maria Jos´e Vargas,
Birgitte B Simen, et al. Convergent antibody signatures in human dengue. Cell
Host & Microbe, 13(6):691–700, 2013.
[128] Eric A Wan and Rudolph Van Der Merwe. The unscented Kalman ﬁlter for nonlin-
ear estimation. In Adaptive Systems for Signal Processing, Communications, and
Control Symposium 2000. AS-SPCC. The IEEE 2000, pages 153–158. Ieee, 2000.
[129] Hua Liang, Hongyu Miao, and Hulin Wu. Estimation of constant and time-varying
dynamic parameters of HIV infection in a nonlinear diﬀerential equation model.
The Annals of Applied Statistics, 4(1):460, 2010.
[130] Yanni Xiao, Hongyu Miao, Sanyi Tang, and Hulin Wu. Modeling antiretroviral drug
responses for HIV-1 infected patients using diﬀerential equation models. Advanced
Drug Delivery Reviews, 65.
[131] Mukesh Bansal, Vincenzo Belcastro, Alberto Ambesi-Impiombato, and Diego
Di Bernardo.
How to infer gene networks from expression proﬁles.
Molecular
Systems Biology, 3(1):78, 2007.

137
[132] Karline Soetaert, Karel Van den Meersche, and Dick van Oevelen. limSolve: Solving
Linear Inverse Models, 2009. R package 1.5.1.
[133] David Huijser, Jesse Goodman, and Brendon J Brewer. Properties of the aﬃne
invariant ensemble sampler in high dimensions. arXiv preprint arXiv:1509.02230,
2015.
[134] Stephen P Brooks and Andrew Gelman. General methods for monitoring conver-
gence of iterative simulations. Journal of Computational and Graphical Statistics,
7(4):434–455, 1998.
[135] Katharine Mullen, David Ardia, David Gil, Donald Windover, and James Cline.
DEoptim: An R package for global optimization by Diﬀerential Evolution. Journal
of Statistical Software, 40(6):1–26, 2011.
[136] Rafael Sanju´an.
Mutational ﬁtness eﬀects in RNA and single-stranded DNA
viruses: common patterns revealed by site-directed mutagenesis studies. Philosoph-
ical Transactions of the Royal Society B: Biological Sciences, 365(1548):1975–1982,
2010.
[137] Limin Fu, Beifang Niu, Zhengwei Zhu, Sitao Wu, and Weizhong Li.
CD-HIT:
accelerated for clustering the next-generation sequencing data.
Bioinformatics,
28(23):3150–3152, 2012.
[138] H. Pags, P. Aboyoun, R. Gentleman, and S. DebRoy. Biostrings: String objects
representing biological sequences, and matching algorithms, 2016. R package version
2.40.2.
[139] Steve Leeds and Alan E Gelfand. Estimation for Dirichlet mixed models. Technical
report, DTIC Document, 1990.

138
APPENDIX A.
QUASISPECIES EQUILIBRIUM
SUPPLEMENTARY METHODS AND RESULTS
A.1
MCMC starting values
The aﬃne-invariant ensemble sampler implementation (emcee) we use for inference
on the ﬁtness eﬀects β requires a cloud of starting values around a good initial estimate
of β. We start with an estimate of the ﬁtness landscape ˆw calculated from Eq. (2.6),
which is similar to how QuasiFit is initialized [14]. To estimate ˆβ from ˆw, we employ
constrained, weighted least-squares on the linear relationship (2.4). To generate the many
distinct starting values required for emcee to mix, random perturbations are added to
the point estimate, favoring perturbations that do not decrease the posterior probability.
The details of this initialization approach are described in the remainder of this section.
Solving the quasispecies equilibrium (2.2) when mean ﬁtness is one at equilibrium
yields w as a function of p in Eq. (2.6), which suggests mapping the observed haplotype
relative frequencies to an estimate of the ﬁtness landscape. We call the mapping h : p →
w. Unfortunately, not all p in the simplex, and none of the points on the boundary,
map to valid ﬁtness landscapes [14]. If ˆp is the vector of observed haplotype relative
frequencies with one pseudocount added to each count to eliminate zero values, then
h( ˆp) is a valid ﬁtness landscape if all elements are positive. If some elements of h( ˆp) are
negative or zero, we set those elements to 0.5, an arbitrary value substantially less than 1.
Call this value ˆw. If ˆw is close to w, Eq. (2.4) suggests rescaling so the reference ﬁtness
is 1 and using a least squares ﬁt to obtain ˆβ from ˆw, but in practice, this procedure

139
yields ﬁtness estimates with overly simple equilibria dominated by a single haplotype
and inconsistent with complex datasets.
To improve the procedure, we 1) constrain
haplotype ﬁtnesses by theoretical bounds, 2) constrain nonestimable main eﬀects to a
ﬁxed value governed by the prior, and 3) use constrained weighted least squares instead of
ordinary least squares to obtain estimates of remaining parameters subject to constraints
on ﬁtness, all as detailed below. We use limSolve [132] in R to accomplish the constrained
weighted linear regression and produce estimates ˆβ.
1) Since the weighted least squares places a low weight on the ﬁtness residuals of
rare haplotypes, their ﬁtnesses may be overestimated enough for them to dominate
the quasispecies equilibrium. Fortunately, the quasispecies equilibrium equation
implies bounds on haplotype ﬁtnesses that can be computed from their relative
frequency. . By constraining the starting values to satisfy these bounds prior to
rescaling, the resulting estimates perform better as starting values.
2) In addition, the weighted least squares estimate of w does not use prior informa-
tion, which in this heavily parametrized model leads to overly negative main eﬀects
compensated by overly positive interaction parameters. To impose prior beliefs in
the estimation, we ﬁx the value of nonestimable (not expressible as a linear com-
bination of observed haplotype ﬁtnesses) main eﬀects or nonestimable parameters
produced by aliasing that contain main eﬀects. To choose the value, we ﬁt a qua-
sispecies model to data consisting of N occurrences of the reference haplotype and
zero occurrences of all variants, then set the nonestimable eﬀect to the estimated
ﬁtness of the unobserved variant.
3) Frequently observed haplotypes have better-constrained ﬁtnesses, so they should
be weighted more heavily. A weighting scheme that works well is to set the weight
of haplotype i to vi = y2
i + c, where yi is the count of haplotype i, and c is a
pseudocount to prevent zero weights. Before performing weighted least squares,

140
target ﬁtnesses and ﬁtness bounds are renormalized so the reference haplotype
ﬁtness is 1.
Finally, the ensemble sampler needs distinct initial values for each walker. Generally,
we sample the starting values for the kth sampler as
β(0)
k
∼N

ˆβ, σ2I

,
but choice of σ depends on whether the site group is a singleton or multi-site group.
In addition, we allow for the possibility of updates to ˆβ. Speciﬁcally, for singletons,
we simulate normally distributed point clouds with standard deviation 10−3. For multi-
site groups, a more complex approach is required for reasonable sampler mixing. The
procedure is motivated by two observations. First, if starting values are simulated from a
normal distribution with excess variance, most will yield a very low posterior probability
and poor mixing because of low exchange between walkers. Once the standard deviation
is low enough, mixing improves, but the ensemble may converge only very slowly, with
walkers starting at low posterior probability often failing to mix with others. Second,
sporadically, we observe starting values that produce large improvements in posterior
probability. Thus, we use the following adaptive procedure to generate multi-site group
starting values for the ensemble:
1. Set σ = 10−3 and ptarget to the current posterior p( ˆβ | y).
2. Simulate β(0)
k
∼N

ˆβ, σ2I

for each walker k.
3. If p(β(0)
k
| y) < ptarget discard and resimulate initial values β(0)
k
up to 10 times.
4. If p(β(0)
k
| y) ≥ptarget for all k, initialization is complete.
Otherwise, if any
p(β(0)
k
| y) > ptarget reset ˆβ = arg maxβ(0)
k p(β(0)
k
| y) and σ = σ/5. If σ < 10−10,
initialization is complete.
Otherwise, repeat with the updated σ and updated
ptarget.

141
A.2
Run settings and convergence diagnostics
MCMC run parameters (run length, burn-in, subsample rate, number of walkers,
and tuning parameter a) were chosen diﬀerently for single site and for multi-site subsets
because convergence of single sites tends to be much faster. For single sites, we ran 200
walkers for 30,000 iterations, retaining every 10th sample. For multi-site quasispecies, we
ran 200 walkers for 300,000 iterations, retaining every 100th sample. Generally, we set
tuning parameter a = 2, but for multi-site quasispecies in datasets of sample size 10,000
we set a = 1.2, to improve acceptance ratios in the most complex datasets.
A challenge in high dimensions is that poor mixing between walkers is not detectable
by the acceptance fraction, although it is visible in trace plots of individual walkers [133].
Instead, we propose to use the multivariate potential scale reduction factor [134] from
the ﬁrst half of iterations to be discarded as burn-in, treating each walker as a separate
chain. The single variable potential scale reduction factor has been used to determine
burn-in in Diﬀerential Evolution MCMC [16], another ensemble MCMC scheme. There it
is justiﬁed by the independence of walker positions at a given iteration in the stationary
distribution, which also applies for the aﬃne invariant ensemble sampler [63]. We accept
a run if this number is less than 1.2 for each site subset. If convergence criteria are not
met, chain acceptance rates are used to diagnose and resolve the convergence problem.
If walker acceptance rates are all within the acceptable range (0.2 to 0.5), the algorithm
is simply run for more iterations. If all walkers have similar acceptance rates outside the
acceptable range, then the tuning parameter is appropriately adjusted before running for
more iterations. If most chains have acceptance rates within the acceptable range but a
subset have very low acceptance rates, MCMC is restarted with improved initial values
drawn near the best value from the previous iteration using the starting value procedure
described in §A.1. Multivariate potential scale reduction factors for each cluster in the
HIV analysis presented in 2.3.1 are given in A.1.

142
Table A.1: Maximum value of Gelman Rubin multivariate potential scale reduction factor
across site groups for each dataset and cluster. Diagnostic is computed using the 50% of
iterations discarded as burnin.
Region
Cluster
Max. Gelman Diag.
gag
1
1.0058
gag
2
1.0070
gag
3
1.0070
V3 loop
1
1.1400
V3 loop
2
1.0099
A.3
Simulation procedure
We simulated 49 datasets under the pairwise-only epistasis assumption (2.4) to test
the performance of our model. Our goal in simulation was to obtain biologically realistic
haplotype ﬁtnesses, so we emulated haplotype distributions observed in the HIV data
of [58]. This section describes how we chose the simulation values β and veriﬁed their
agreement with the real, observed data. Simulated datasets were generated from four
site subsets of amplicons 2, 4, 5, 6, 10, and 11 of the HIV-gag dataset from which a
smaller region is later analyzed in §2.3.1.1. §2.2.4 provides details on the selection of
these four site subsets. For each four site subset, we obtained an initial point estimate
of the parameter vector β using the weighted-least squares method used to initialize
emcee (A.1), except haplotypes were formed from all combinations of observed alleles
plus all single nucleotide mutants from the reference background were retained in the
model. As explained in §2.4, the data may constrain the signs of some parameters that
cannot be estimated from the ﬁtnesses of observed haplotypes. Inclusion of unobserved
haplotypes is necessary to ensure the signs of these parameter estimates are consistent
with the data.
This starting value was reﬁned using DEoptim [135] to maximize the
posterior probability, assuming the prior parameter λ=10, the same value used later
during estimation. DEoptim was initialize from normally distributed starting values with
standard deviation 10−4. Interactions between absent alleles were set to zero.

143
Next, the quasispecies equilibrium over the full set of 44 haplotypes was checked
for closeness to the observed haplotype frequencies. Two criteria were used to indicate
an adequate ﬁt. First, we checked if elements pi of p computed from the ﬁtted value
of β were in the 99% conﬁdence interval of the observed proportion as determined by
independently applying the binom.test function in R to each haplotype count. This ﬁrst
criterion is ambitious since the real data may satisfy neither the pairwise-only epistasis
nor the quasispecies equilibrium assumption. For pi outside their conﬁdence intervals,
we set criterion
| log10(pdata
i
) −log10(pﬁtted
i
)| ≤0.25,
where pdata are the frequencies of observed haplotypes and pﬁtted are the ﬁt frequencies
of observed haplotypes. This criterion only applies to observed haplotypes. This second
criterion is not applicable to the frequencies of unobserved haplotypes, so unobserved
haplotype frequencies were required to satisfy the credible interval criterion. If this cri-
terion was not met, another round of DEoptim was initialized with independent samples
from a normal distribution at the best value from the previous iteration with ten-fold
lower starting variance. This procedure was repeated until the maximum deviation cri-
terion was met or the variance of the initial population was less than 10−7.
Usually, the maximum deviation criterion was met. In one set of 49, it failed. In this
dataset, the maximum deviation among haplotypes outside their credible interval was
0.47. The largest deviations tended to be among the rarest haplotypes. The maximum
Euclidean distance between the modeled and dataset haplotype proportions was 0.0045
(median 0.0004). Correlation between log10 pdata and log10 pﬁtted of present haplotypes
was in all cases very high (minimum correlation 0.93).

144
A.4
Processing HIV-1 gag dataset
The main processing steps were:
1. Download the dataset using sra-toolkit.
2. Process the fastq ﬁles to separate tag from the remainder of the read.
3. Match ﬁrst part of each read to an amplicon primer, if possible.
4. Align reads minus tags to HIV reference HXB2 using bwa mem.
5. Create an index for the output sam ﬁle giving positions of read pairs associated
with a unique amplicon-tag combination.
6. Create a consensus sequence from each amplicon-tag combination that meets cer-
tain ﬁltering criteria.
Almost no reads contained the constant portion of the primer or the adaptor, so we
expected the reads to consist of a 6 nucleotide tag, then an amplicon-speciﬁc primer
matching HIV-1 gag, followed by the amplicon sequence. For each read, we determined
whether it matched any of the amplicon primers starting at base 7, with up to one
mismatch allowed using a custom python script. If so, it was assigned to that amplicon.
We kept track of the tag and amplicon assignment for each read, but removed tags from
reads before alignment. For a small number of read pairs, the forward and reverse reads
matched diﬀerent primers. These read pairs were discarded.
Table A.2 shows the number of read pairs containing primers at the expected position
by amplicon. Only 18.7% of reads contained a primer in the expected position on both
ends. A further 1.8% of read pairs had exactly one read, more often the forward read,
matching an amplicon primer in the expected position. In extremely rare cases, both
reads in a pair matched a primer, but for diﬀerent amplicons.
There were no cases
in which the reads in a pair both matched the forward primer or both matched the

145
reverse primer for the same amplicon. A further 0.1% of read pairs were not used due
to ambiguous bases in the tag (not shown in table).
After removing tags, we aligned the remaining portion of each read to a standard HIV
reference (HXB2, GenBank accession number K03455.1) using bwa mem.The sequence to
which the original authors aligned their data was not publicly available. We increased the
gap penalty to 12, as we found that with its default settings bwa mem output numerous
reads with nearby insertions and deletions of equal length that could also be explained
by substitution. Otherwise, we used default settings.
Table A.3 compares the number of reads mapped to each amplicon using bwa mem to
the number having the correct primer structure. A read was considered mapped to an
amplicon if it overlapped the boundaries of that amplicon more than any other amplicon.
There were 60,992,605 total read pairs in the dataset. 2% were unmapped by bwa mem
and 1% were mapped, but mapped outside of any amplicon. Most reads did not contain
a primer in the expected position, but there was great variation across amplicons. Over
90% of reads mapped to amplicons 1 and 2 contained a primer in the expected position,
but only 3% of reads mapped to amplicon 7 did.
We grouped paired reads by amplicon assignment and tag. Paired reads were con-
sidered to have the same tag if both the forward and the reverse strand tags matched
exactly. We discarded all unmapped reads and soft-clipped reads. Amplicon-tag groups
containing fewer than four reads in each direction were discarded. From the remaining
amplicon-tag groups, a consensus haplotype sequence was generated separately for for-
ward and reverse reads. The consensus sequence was accepted if 90% of the reads agreed
at each site. Then the two consensus sequences were concatenated, using a placeholder
for each unsequenced position if the regions covered by the forward and reverse reads
were not contiguous. In some amplicons, forward and reverse reads overlapped. If the
two consensus sequences did not agree on their overlap, that consensus was not used.
Any consensus read containing an indel variant relative to the reference sequence was

146
discarded. Table A.4 gives the numbers of accepted and rejected tags mapping to each
amplicon.
Table A.2: Number of read pairs accepted and rejected in each amplicon when ﬁltering
based on matching a primer sequence at the expected position with up to one mismatch.
Row names are the names of the amplicon.
accepted=number of read pairs with a
forward primer on one read and a reverse primer on the other for that amplicon. only
fwd and only rev: number of read pairs with a forward or reverse primer only respectively
for that amplicon. Neither=number of read pairs not matching any amplicon primer,
diﬀerent primer=number of read pairs in which the two parts of the read match two
diﬀerent amplicon primers. same direction=number of read pairs in which both parts of
the read match the same amplicon, but in the same direction.
accepted
only fwd
only rev
neither
diﬀerent primer
1
1,156,113
24,807
35,294
2
896,413
34,011
31,582
3
640
112
45
4
827,539
21,219
23,417
5
2,024,651
60,397
63,230
6
1,382,536
53,440
25,957
7
167,055
12,878
14,554
8
645,706
46,950
18,569
9
807,232
40,091
15,337
10
969,679
371,622
50,765
11
966,354
63,121
29,063
12
1,548,916
43,006
25,639
total
11,392,834
771,654
333,452
48,494,049
616
Table A.4 shows that diﬀerent amplicons varied greatly in the number and proportion
of unique tags for which consensus sequences were formed. Across all amplicons, 25-30%
of unique tags were rejected because they had too few read pairs. Amplicon 3 had low
coverage of mapped reads as well as a high proportion of rejected tags. Amplicons 1,
8, 9, and 12 had a large numbers of primer-assigned reads, but most of them were soft-
clipped or unmapped. Soft-clipped regions are frequently a large fraction of the read,
and many reads within an amplicon share the same length and position of soft-clipped
bases. We suspect soft-clipping in this dataset mostly reﬂects regions of reads that are
not HIV. Many of these soft-clipped reads align well with each other, but do not align
to HIV in the soft-clipped region (as determined by a BLAST search). For the most
part, insertions and deletions in the consensus sequences were rare, but they were almost

147
Table A.3: Reads mapped to each amplicon. Row names are the names of the amplicon.
A read was deﬁned to be mapped to the amplicon if it overlapped the amplicon and
overlapped it more than any other amplicon. “None” row indicates the number of reads
mapped outside of any amplicon and the number of unmapped reads respectively. primer
prop is the number of reads with primers for each amplicon divided by the number of
reads mapping to the amplicon
Mapped
unmapped
primer prop
1
2,434,668
0.95
2
1,918,641
0.93
3
2,964
0.43
4
7,119,438
0.23
5
14,824,069
0.27
6
18,794,370
0.15
7
11,435,266
0.03
8
12,155,796
0.11
9
8,611,323
0.19
10
12,099,476
0.16
11
16,761,737
0.12
12
11,989,461
0.26
None
1,297,976
2,540,025
universal in Amplicon 1. It was common for reads from this amplicon to align to the
reference except for a two nucleotide deletion near the center of the read.
We have very few error-corrected consensus sequences from amplicons 1,3,8, and
12. Al-Mawsawi et al. similarly report few error-corrected consensus sequences from
amplicons 1 and 3 [58], but they report many consensus sequences from amplicons 8 and
12 in the sample we analyzed from 43 days post symptom onset. However, they report
few consensus sequences from these amplicons in the sample from 36 days post symptom
onset. Accepted consensus sequences from amplicons 2, 4, 5, 6, 10, and 11 were used as
models for simulated datasets. We also considering using amplicon 7, but after clustering
reads (see Methods §2.2.4) no cluster had suﬃciently high coverage. The portion of the
reads containing the amplicon primer was not used in simulated dataset generation.
We analyzed a 45 nucleotide epitope in Amplicon 4 as one of the real datasets.
Although many reads mapped to the Amplicon 4 region did not containing a primer
(Table A.3), few of them spanned the epitope region. Encouragingly, 98% of mapped
reads spanning the epitope region contained an Amplicon 4 primer in the expected

148
Table A.4: Number of tags accepted and rejected for formation of error-corrected reads
and reason for rejection for each amplicon. Row names are the names of the amplicon.
Few reads enumerates the number of tags associated with fewer than 4 read pairs. Few
mapped enumerates those tags with enough read pairs, but not enough read pairs mapped
without soft-clipping. No consensus counts tags with fewer than 90 percent of reads
having the consensus variant at some site. Invalid var counts tags with invalid consensus
variants (anything other than A, C, G, or T). Overlap counts tags for which the consensus
generated from the forward and reverse strands disagreed on their overlap. Table will not
add up to total number of accepted tags from primer-containing sequences because some
tags have both invalid consensus variants and too low frequency of consensus variants.
Accepted
Few Reads
Few Mapped
No consensus
Invalid var
Overlap
1
131
37,534
85,079
5,162
15,088
0
2
57,432
30,088
202
21,187
75
0
3
8
29
49
3
0
0
4
47,234
27,065
2,730
18,693
45
0
5
112,300
62,214
759
51,902
2,189
0
6
89,688
38,244
141
25,320
23
0
7
12,121
6,079
141
2,630
14
0
8
10
25,724
56,747
1
0
0
9
7,387
29,515
61,618
3,378
13
0
10
32,175
31,301
40,734
11,775
85
1
11
60,608
37,183
677
25,836
638
0
12
557
46,718
126,530
524
2
0
position. Therefore, we believe that our decision to remove reads from consideration if
they do not contain primers in the expected position will have a relatively small impact
on counts of epitope variants.
A.5
Complete parameter estimates for HIV-1 datasets
Table A.5: All estimated eﬀects for variable sites in the HIV-1 gag epitopes dataset,
cluster 1.
Parameter
Variant
Median
Lower
Upper
Present
σ355,A
A119T
-8.56E-02
-3.33E-01
-2.20E-02
yes
σ355,T
A119S
-8.53E-02
-3.29E-01
-2.19E-02
yes
σ356,T
A119V
-3.35E-02
-1.35E-01
-1.16E-02
yes
σ359,A
A120D
-8.51E-02
-3.30E-01
-2.19E-02
yes
σ360,C
.
-8.52E-02
-3.31E-01
-2.20E-02
yes

149
Table A.5 continued
σ368,G
E123G
-8.50E-02
-3.28E-01
-2.19E-02
yes
σ370,A
G124S
-4.15E-05
-4.45E-05
-3.87E-05
yes
ρ(370,A),(373,G)
G124S,N125D
1.39E-02
-4.13E-03
1.37E-01
yes
ρ(370,A),(395,A)
G124S,F132Y
5.32E-03
2.97E-03
1.08E-02
yes
σ370,T
G124C
-8.17E-02
-3.21E-01
-2.06E-02
yes
σ371,A
G124D
-8.56E-02
-3.33E-01
-2.21E-02
yes
σ371,T
G124V
-8.54E-02
-3.32E-01
-2.21E-02
yes
σ373,G = ρ(373,G),(395,A)
N125D,F132Y
-1.38E-02
-1.36E-01
4.27E-03
yes
σ395,A
F132Y
-5.42E-03
-1.09E-02
-3.07E-03
yes
σ355,C
-1.37E-01
-4.56E-01
-3.40E-02
no
σ356,A
-1.37E-01
-4.57E-01
-3.37E-02
no
σ356,G
-1.37E-01
-4.58E-01
-3.40E-02
no
σ359,G
-1.37E-01
-4.57E-01
-3.38E-02
no
σ359,T
-1.37E-01
-4.58E-01
-3.38E-02
no
σ360,A
-1.36E-01
-4.54E-01
-3.38E-02
no
σ360,G
-1.37E-01
-4.58E-01
-3.38E-02
no
σ368,C
-1.37E-01
-4.58E-01
-3.38E-02
no
σ368,T
-1.38E-01
-4.59E-01
-3.38E-02
no
σ371,C
-1.37E-01
-4.55E-01
-3.39E-02
no
Table A.6: All estimated eﬀects for variable sites in the HIV-1 gag epitopes dataset,
cluster 2.
Parameter
Variant
Median
Lower
Upper
Present
σ355,A
A119T
-1.98E-01
-5.11E-01
-7.73E-02
yes
σ355,T
A119S
-7.19E-02
-1.75E-01
-3.47E-02
yes
σ356,T
A119V
-2.39E-02
-4.10E-02
-1.52E-02
yes
σ357,G
.
-1.28E-01
-3.42E-01
-5.32E-02
yes
σ358,A
A120T
-1.99E-01
-5.11E-01
-7.73E-02
yes
σ358,T
A120S
-1.04E-01
-2.74E-01
-4.54E-02
yes
σ359,A
A120D
-1.47E-01
-4.03E-01
-5.78E-02
yes

150
Table A.6 continued
σ359,T = ρ(359,T ),(376,A)
A120V,H126N
-9.11E-03
-2.60E-02
-4.11E-03
yes
σ360,C
.
-1.03E-01
-2.71E-01
-4.55E-02
yes
σ361,A
D121N
-1.99E-01
-5.14E-01
-7.77E-02
yes
σ361,T
D121Y
-1.98E-01
-5.10E-01
-7.72E-02
yes
σ362,G
D121G
-1.98E-01
-5.11E-01
-7.74E-02
yes
σ363,T
.
-1.99E-01
-5.11E-01
-7.72E-02
yes
σ364,G
K122E
-1.98E-01
-5.08E-01
-7.72E-02
yes
σ365,G
K122R
-1.04E-01
-2.75E-01
-4.54E-02
yes
σ369,A
D123E
-1.98E-01
-5.11E-01
-7.75E-02
yes
σ370,C
S124R
-1.98E-01
-5.08E-01
-7.75E-02
yes
σ370,G
S124G
-1.27E-01
-3.42E-01
-5.34E-02
yes
σ371,A
S124N
-1.98E-01
-5.09E-01
-7.74E-02
yes
σ371,T
S124I
-7.18E-02
-1.75E-01
-3.47E-02
yes
σ374,A
S125N
-1.99E-01
-5.08E-01
-7.72E-02
yes
σ375,C
.
-1.59E-01
-4.21E-01
-6.37E-02
yes
σ376,A
H126N
-7.70E-05
-7.96E-05
-7.45E-05
yes
ρ(376,A),(395,T )
H126N,Y132F
1.31E-01
5.67E-02
2.97E-01
yes
σ376,T
H126Y
-1.98E-01
-5.09E-01
-7.71E-02
yes
σ386,A = ρ(376,A),(386,A)
H126N,S129N
-1.59E-02
-6.57E-02
-5.86E-03
yes
σ395,G = ρ(376,A),(395,G)
H126N,Y132C
-9.19E-02
-3.96E-01
-1.78E-02
yes
σ378,A
H126Q
-1.03E-01
-2.72E-01
-4.55E-02
yes
σ382,T
V128F
-1.99E-01
-5.10E-01
-7.74E-02
yes
σ385,G
S129G
-1.98E-01
-5.08E-01
-7.73E-02
yes
σ388,A
Q130K
-1.99E-01
-5.08E-01
-7.72E-02
yes
σ395,T
Y132F
-1.31E-01
-2.98E-01
-5.71E-02
yes
σ397,A
P133T
-1.59E-01
-4.21E-01
-6.40E-02
yes
σ398,A
P133H
-1.27E-01
-3.39E-01
-5.34E-02
yes
σ355,C
-2.46E-01
-6.04E-01
-9.48E-02
no
σ356,A
-2.45E-01
-6.00E-01
-9.49E-02
no
σ356,G
-2.45E-01
-6.02E-01
-9.47E-02
no
σ357,C
-2.47E-01
-6.03E-01
-9.53E-02
no

151
Table A.6 continued
σ357,T
-2.46E-01
-6.01E-01
-9.48E-02
no
σ358,C
-2.46E-01
-6.01E-01
-9.44E-02
no
σ360,A
-2.45E-01
-6.02E-01
-9.45E-02
no
σ360,G
-2.46E-01
-6.02E-01
-9.45E-02
no
σ361,C
-2.46E-01
-5.99E-01
-9.48E-02
no
σ362,C
-2.45E-01
-6.02E-01
-9.46E-02
no
σ362,T
-2.45E-01
-6.02E-01
-9.47E-02
no
σ363,A
-2.46E-01
-6.03E-01
-9.49E-02
no
σ363,G
-2.45E-01
-6.01E-01
-9.48E-02
no
σ364,C
-2.46E-01
-6.05E-01
-9.47E-02
no
σ364,T
-2.46E-01
-6.03E-01
-9.49E-02
no
σ365,C
-2.46E-01
-6.02E-01
-9.45E-02
no
σ365,T
-2.46E-01
-5.99E-01
-9.50E-02
no
σ369,C
-2.45E-01
-6.00E-01
-9.46E-02
no
σ369,G
-2.45E-01
-6.00E-01
-9.46E-02
no
σ370,T
-2.45E-01
-6.03E-01
-9.46E-02
no
σ371,C
-2.44E-01
-5.99E-01
-9.43E-02
no
σ374,C
-2.46E-01
-5.99E-01
-9.47E-02
no
σ374,T
-2.46E-01
-6.03E-01
-9.46E-02
no
σ375,A
-2.45E-01
-6.06E-01
-9.43E-02
no
σ375,G
-2.44E-01
-5.99E-01
-9.44E-02
no
σ378,G
-2.46E-01
-6.03E-01
-9.50E-02
no
σ378,T
-2.46E-01
-6.04E-01
-9.47E-02
no
σ382,A
-2.46E-01
-6.02E-01
-9.48E-02
no
σ382,C
-2.46E-01
-6.04E-01
-9.47E-02
no
σ385,C
-2.45E-01
-6.03E-01
-9.47E-02
no
σ385,T
-2.46E-01
-6.03E-01
-9.46E-02
no
σ388,G
-2.46E-01
-6.04E-01
-9.46E-02
no
σ388,T
-2.45E-01
-6.00E-01
-9.47E-02
no
σ397,G
-2.46E-01
-6.02E-01
-9.46E-02
no
σ397,T
-2.46E-01
-6.01E-01
-9.49E-02
no

152
Table A.6 continued
σ398,G
-2.46E-01
-6.03E-01
-9.51E-02
no
σ398,T
-2.46E-01
-6.02E-01
-9.48E-02
no
Table A.7: All estimated eﬀects for variable sites in the HIV-1 gag epitopes dataset,
cluster 3.
Parameter
Variant
Median
Lower
Upper
Present
σ355,A
A119T
-5.21E-02
-2.69E-01
-1.01E-02
yes
σ356,T
A119V
-2.48E-02
-1.43E-01
-6.25E-03
yes
σ359,T
A120V
-9.28E-03
-3.61E-02
-3.50E-03
yes
σ360,C
.
-2.48E-02
-1.43E-01
-6.27E-03
yes
σ363,T
.
-5.19E-02
-2.70E-01
-1.00E-02
yes
σ366,G
.
-1.39E-02
-6.87E-02
-4.46E-03
yes
σ372,T
.
-5.22E-02
-2.69E-01
-1.01E-02
yes
σ382,T
V128F
-5.19E-02
-2.69E-01
-1.00E-02
yes
σ386,A
S129N
-4.49E-03
-1.15E-02
-2.19E-03
yes
σ398,A
P133H
-5.19E-02
-2.67E-01
-9.97E-03
yes
σ355,C
-1.06E-01
-4.13E-01
-1.90E-02
no
σ355,T
-1.07E-01
-4.18E-01
-1.89E-02
no
σ356,A
-1.07E-01
-4.20E-01
-1.90E-02
no
σ356,G
-1.07E-01
-4.18E-01
-1.91E-02
no
σ359,A
-1.07E-01
-4.18E-01
-1.91E-02
no
σ359,G
-1.07E-01
-4.18E-01
-1.90E-02
no
σ360,A
-1.06E-01
-4.10E-01
-1.90E-02
no
σ360,G
-1.06E-01
-4.19E-01
-1.90E-02
no
σ363,A
-1.07E-01
-4.15E-01
-1.91E-02
no
σ363,G
-1.07E-01
-4.18E-01
-1.91E-02
no
σ366,C
-1.06E-01
-4.15E-01
-1.89E-02
no
σ366,T
-1.07E-01
-4.16E-01
-1.90E-02
no
σ372,A
-1.07E-01
-4.15E-01
-1.92E-02
no
σ372,G
-1.07E-01
-4.16E-01
-1.90E-02
no

153
Table A.7 continued
σ382,A
-1.07E-01
-4.15E-01
-1.91E-02
no
σ382,C
-1.06E-01
-4.15E-01
-1.90E-02
no
σ386,C
-1.06E-01
-4.13E-01
-1.90E-02
no
σ386,T
-1.06E-01
-4.17E-01
-1.91E-02
no
σ398,G
-1.07E-01
-4.18E-01
-1.90E-02
no
σ398,T
-1.07E-01
-4.18E-01
-1.92E-02
no
Table A.8: All estimated eﬀects for variable sites in the HIV-1 V3 loop dataset, cluster
1.
Parameter
Variant
Median
Lower
Upper
Present
σ1,C
C1R
-3.53E-02
-2.34E-01
-5.35E-03
yes
σ2,A
C1Y
-3.55E-02
-2.36E-01
-5.37E-03
yes
σ3,C
.
-2.37E-05
-3.34E-05
-1.56E-05
yes
ρ(3,C),(15,T )
.
7.33E-04
6.77E-05
1.31E-02
yes
ρ(3,C),(54,G)
.
-1.29E-03
-1.03E-02
-2.77E-04
yes
ρ(3,C),(60,C)
.
7.47E-05
-8.21E-06
1.65E-04
yes
ρ(3,C),(75,C)
.
-2.55E-05
-5.63E-05
-5.69E-07
yes
ρ(3,C),(78,C)
.
-6.45E-04
-4.78E-03
7.65E-03
yes
ρ(3,C),(87,C)
.
1.26E-03
4.29E-04
5.43E-03
yes
ρ(3,C),(93,G)
.
-9.02E-05
-1.98E-04
-3.03E-05
yes
σ6,G
.
-3.54E-02
-2.33E-01
-5.35E-03
yes
σ7,G
R3G
-3.54E-02
-2.34E-01
-5.32E-03
yes
σ9,G
.
-3.23E-03
-1.07E-02
-1.35E-03
yes
σ10,T
P4S
-3.56E-02
-2.35E-01
-5.35E-03
yes
σ11,T
P4L
-3.54E-02
-2.34E-01
-5.36E-03
yes
σ12,C = ρ(12,C),(75,C)
.
-8.76E-05
-1.55E-04
-4.84E-05
yes
σ13,G
N5D
-3.55E-02
-2.33E-01
-5.35E-03
yes
σ14,G
N5S
-4.37E-03
-1.79E-02
-1.63E-03
yes
σ15,T
.
-7.73E-04
-1.31E-02
-1.02E-04
yes
ρ(15,T ),(54,G) = ρ(15,T ),(75,C)
.
-1.71E-03
-2.11E-01
6.99E-03
yes

154
Table A.8 continued
ρ(15,T ),(60,C)
.
1.16E-04
5.76E-05
1.98E-04
yes
ρ(15,T ),(93,G)
.
-5.15E-03
-9.81E-02
-6.94E-05
yes
σ16,G
N6D
-4.40E-03
-1.83E-02
-1.64E-03
yes
σ17,G
N6S
-3.54E-02
-2.34E-01
-5.36E-03
yes
σ18,A
N6K
-3.53E-02
-2.33E-01
-5.34E-03
yes
σ20,G
N7S
-6.76E-03
-3.78E-02
-2.10E-03
yes
σ25,G
R9G
-6.76E-03
-3.79E-02
-2.10E-03
yes
σ29,G
K10R
-3.54E-02
-2.33E-01
-5.38E-03
yes
σ30,G
.
-3.54E-02
-2.34E-01
-5.36E-03
yes
σ31,G
S11G
-1.32E-02
-1.00E-01
-3.02E-03
yes
σ33,C
.
-3.52E-02
-2.33E-01
-5.34E-03
yes
σ35,C
I12T
-1.33E-02
-1.01E-01
-3.01E-03
yes
σ36,G
I12M
-1.78E-03
-4.22E-03
-9.05E-04
yes
σ42,G
I14M
-3.58E-02
-2.36E-01
-5.38E-03
yes
σ44,A
G15E
-1.32E-02
-9.81E-02
-3.01E-03
yes
σ45,G
.
-1.32E-02
-9.99E-02
-3.02E-03
yes
σ46,T
P16S
-1.31E-02
-9.96E-02
-3.02E-03
yes
σ47,T
P16L
-1.32E-02
-9.97E-02
-3.02E-03
yes
σ52,G
R18G
-3.54E-02
-2.33E-01
-5.34E-03
yes
σ54,G
.
-1.52E-03
-5.31E-03
-6.00E-04
yes
ρ(54,G),(75,C)
.
1.52E-03
6.01E-04
5.32E-03
yes
ρ(54,G),(93,G)
.
-5.33E-03
-1.58E-01
2.56E-02
yes
σ55,A
A19T
-1.33E-02
-1.01E-01
-3.01E-03
yes
σ56,T
A19V
-3.53E-02
-2.34E-01
-5.30E-03
yes
σ57,G
.
-3.54E-02
-2.35E-01
-5.35E-03
yes
σ59,C
F20S
-3.53E-02
-2.33E-01
-5.32E-03
yes
σ60,C
.
-1.29E-04
-2.05E-04
-8.34E-05
yes
ρ(60,C),(93,G)
.
-6.89E-04
-1.43E-01
6.77E-02
yes
σ63,C
.
-3.52E-02
-2.32E-01
-5.32E-03
yes
σ64,A
A22T
-1.32E-02
-9.96E-02
-3.02E-03
yes
σ65,T
A22V
-3.55E-02
-2.35E-01
-5.34E-03
yes

155
Table A.8 continued
σ67,G
T23A
-6.77E-03
-3.82E-02
-2.11E-03
yes
σ68,T
T23I
-3.54E-02
-2.34E-01
-5.33E-03
yes
σ69,G
.
-1.32E-02
-9.96E-02
-3.03E-03
yes
σ70,A
G24R
-6.74E-03
-3.80E-02
-2.10E-03
yes
σ72,G
.
-1.32E-02
-9.90E-02
-3.01E-03
yes
σ73,A
D25N
-3.57E-02
-2.36E-01
-5.34E-03
yes
σ73,T
D25Y
-3.52E-02
-2.35E-01
-5.31E-03
yes
σ74,G
D25G
-6.76E-03
-3.78E-02
-2.11E-03
yes
σ75,C
.
-8.31E-06
-1.37E-05
-3.34E-06
yes
ρ(75,C),(93,G)
.
-4.36E-03
-4.50E-02
-8.84E-04
yes
σ76,G
I26V
-6.78E-03
-3.83E-02
-2.10E-03
yes
σ77,C
I26T
-1.32E-02
-9.95E-02
-3.01E-03
yes
σ78,C = ρ(78,C),(87,C)
.
7.21E-04
-7.57E-03
4.85E-03
yes
σ79,G
I27V
-1.32E-02
-1.01E-01
-3.03E-03
yes
σ81,G
I27M
-3.56E-02
-2.36E-01
-5.32E-03
yes
σ82,A
G28R
-3.56E-02
-2.36E-01
-5.32E-03
yes
σ84,G
.
-3.55E-02
-2.34E-01
-5.36E-03
yes
σ85,G
N29D
-1.33E-02
-9.96E-02
-3.02E-03
yes
σ86,G
N29S
-1.32E-02
-1.01E-01
-3.02E-03
yes
σ87,C
.
-1.31E-03
-5.48E-03
-4.81E-04
yes
σ90,G
I30M
-3.53E-02
-2.34E-01
-5.33E-03
yes
σ91,G
R31G
-3.56E-02
-2.34E-01
-5.36E-03
yes
σ93,G
.
-1.72E-05
-2.61E-05
-9.74E-06
yes
σ95,G
Q32R
-3.55E-02
-2.36E-01
-5.35E-03
yes
σ96,G
.
-2.53E-03
-7.21E-03
-1.16E-03
yes
σ96,T
Q32H
-3.54E-02
-2.36E-01
-5.35E-03
yes
σ98,T
A33V
-4.39E-03
-1.81E-02
-1.63E-03
yes
σ101,G
H34R
-6.76E-03
-3.80E-02
-2.10E-03
yes
σ103,C
C35R
-1.78E-03
-4.22E-03
-9.07E-04
yes
σ103,G
C35G
-3.53E-02
-2.34E-01
-5.33E-03
yes
σ1,A
-9.20E-02
-3.95E-01
-1.25E-02
no

156
Table A.8 continued
σ1,G
-9.25E-02
-4.00E-01
-1.26E-02
no
σ2,C
-9.18E-02
-3.97E-01
-1.27E-02
no
σ2,T
-9.21E-02
-3.96E-01
-1.26E-02
no
σ6,C
-9.13E-02
-3.95E-01
-1.26E-02
no
σ6,T
-9.15E-02
-3.97E-01
-1.26E-02
no
σ7,C
-9.23E-02
-3.96E-01
-1.26E-02
no
σ7,T
-9.23E-02
-3.98E-01
-1.27E-02
no
σ9,C
-9.21E-02
-3.97E-01
-1.25E-02
no
σ9,T
-9.16E-02
-3.96E-01
-1.26E-02
no
σ10,A
-9.20E-02
-3.96E-01
-1.27E-02
no
σ10,G
-9.22E-02
-3.98E-01
-1.26E-02
no
σ11,A
-9.25E-02
-3.98E-01
-1.26E-02
no
σ11,G
-9.21E-02
-3.97E-01
-1.26E-02
no
σ13,C
-9.18E-02
-3.99E-01
-1.26E-02
no
σ13,T
-9.25E-02
-3.98E-01
-1.26E-02
no
σ14,C
-9.18E-02
-3.97E-01
-1.26E-02
no
σ14,T
-9.17E-02
-3.96E-01
-1.25E-02
no
σ16,C
-9.21E-02
-3.97E-01
-1.26E-02
no
σ16,T
-9.20E-02
-3.96E-01
-1.27E-02
no
σ17,C
-9.14E-02
-3.95E-01
-1.26E-02
no
σ17,T
-9.21E-02
-3.96E-01
-1.27E-02
no
σ18,G
-9.21E-02
-3.96E-01
-1.26E-02
no
σ18,T
-9.22E-02
-3.99E-01
-1.26E-02
no
σ20,C
-9.16E-02
-3.95E-01
-1.26E-02
no
σ20,T
-9.20E-02
-3.98E-01
-1.26E-02
no
σ25,C
-9.23E-02
-3.95E-01
-1.27E-02
no
σ25,T
-9.21E-02
-3.98E-01
-1.26E-02
no
σ29,C
-9.21E-02
-3.98E-01
-1.26E-02
no
σ29,T
-9.19E-02
-3.98E-01
-1.26E-02
no
σ30,C
-9.25E-02
-3.97E-01
-1.27E-02
no
σ30,T
-9.21E-02
-3.96E-01
-1.26E-02
no

157
Table A.8 continued
σ31,C
-9.22E-02
-3.98E-01
-1.26E-02
no
σ31,T
-9.16E-02
-3.95E-01
-1.26E-02
no
σ33,A
-9.21E-02
-3.97E-01
-1.26E-02
no
σ33,G
-9.16E-02
-3.96E-01
-1.26E-02
no
σ35,A
-9.16E-02
-3.95E-01
-1.25E-02
no
σ35,G
-9.23E-02
-3.98E-01
-1.27E-02
no
σ36,C
-9.20E-02
-3.98E-01
-1.26E-02
no
σ36,T
-9.17E-02
-3.95E-01
-1.26E-02
no
σ42,C
-9.16E-02
-3.97E-01
-1.26E-02
no
σ42,T
-9.19E-02
-3.98E-01
-1.26E-02
no
σ44,C
-9.19E-02
-3.95E-01
-1.26E-02
no
σ44,T
-9.21E-02
-3.95E-01
-1.25E-02
no
σ45,C
-9.15E-02
-3.98E-01
-1.25E-02
no
σ45,T
-9.24E-02
-3.96E-01
-1.27E-02
no
σ46,A
-9.21E-02
-3.97E-01
-1.26E-02
no
σ46,G
-9.21E-02
-3.96E-01
-1.27E-02
no
σ47,A
-9.17E-02
-3.96E-01
-1.26E-02
no
σ47,G
-9.17E-02
-3.96E-01
-1.26E-02
no
σ52,C
-9.17E-02
-3.97E-01
-1.25E-02
no
σ52,T
-9.19E-02
-3.97E-01
-1.26E-02
no
σ55,C
-9.17E-02
-3.97E-01
-1.25E-02
no
σ55,T
-9.21E-02
-3.97E-01
-1.27E-02
no
σ56,A
-9.22E-02
-3.97E-01
-1.26E-02
no
σ56,G
-9.15E-02
-3.97E-01
-1.26E-02
no
σ57,C
-9.23E-02
-3.95E-01
-1.26E-02
no
σ57,T
-9.19E-02
-3.96E-01
-1.26E-02
no
σ59,A
-9.20E-02
-3.97E-01
-1.26E-02
no
σ59,G
-9.20E-02
-3.97E-01
-1.26E-02
no
σ63,A
-9.21E-02
-3.97E-01
-1.26E-02
no
σ63,G
-9.23E-02
-3.97E-01
-1.26E-02
no
σ64,C
-9.23E-02
-3.98E-01
-1.27E-02
no

158
Table A.8 continued
σ64,T
-9.19E-02
-3.98E-01
-1.26E-02
no
σ65,A
-9.15E-02
-3.94E-01
-1.25E-02
no
σ65,G
-9.21E-02
-3.98E-01
-1.26E-02
no
σ67,C
-9.22E-02
-3.97E-01
-1.27E-02
no
σ67,T
-9.21E-02
-3.98E-01
-1.26E-02
no
σ68,A
-9.17E-02
-3.96E-01
-1.26E-02
no
σ68,G
-9.14E-02
-3.93E-01
-1.25E-02
no
σ69,C
-9.20E-02
-3.95E-01
-1.26E-02
no
σ69,T
-9.20E-02
-3.96E-01
-1.26E-02
no
σ70,C
-9.18E-02
-3.96E-01
-1.26E-02
no
σ70,T
-9.22E-02
-3.97E-01
-1.26E-02
no
σ72,C
-9.18E-02
-3.96E-01
-1.26E-02
no
σ72,T
-9.19E-02
-3.98E-01
-1.26E-02
no
σ73,C
-9.23E-02
-3.98E-01
-1.25E-02
no
σ74,C
-9.23E-02
-3.98E-01
-1.26E-02
no
σ74,T
-9.21E-02
-3.99E-01
-1.26E-02
no
σ76,C
-9.17E-02
-3.97E-01
-1.26E-02
no
σ76,T
-9.21E-02
-3.97E-01
-1.26E-02
no
σ77,A
-9.23E-02
-3.97E-01
-1.26E-02
no
σ77,G
-9.22E-02
-3.98E-01
-1.26E-02
no
σ79,C
-9.20E-02
-3.96E-01
-1.26E-02
no
σ79,T
-9.18E-02
-3.98E-01
-1.27E-02
no
σ81,C
-9.26E-02
-3.97E-01
-1.27E-02
no
σ81,T
-9.16E-02
-3.98E-01
-1.26E-02
no
σ82,C
-9.22E-02
-3.97E-01
-1.26E-02
no
σ82,T
-9.22E-02
-3.98E-01
-1.27E-02
no
σ84,C
-9.13E-02
-3.95E-01
-1.25E-02
no
σ84,T
-9.19E-02
-3.97E-01
-1.26E-02
no
σ85,C
-9.23E-02
-3.97E-01
-1.26E-02
no
σ85,T
-9.25E-02
-3.97E-01
-1.26E-02
no
σ86,C
-9.22E-02
-3.98E-01
-1.26E-02
no

159
Table A.8 continued
σ86,T
-9.20E-02
-3.97E-01
-1.26E-02
no
σ90,C
-9.22E-02
-3.98E-01
-1.26E-02
no
σ90,T
-9.21E-02
-3.97E-01
-1.26E-02
no
σ91,C
-9.18E-02
-3.96E-01
-1.26E-02
no
σ91,T
-9.16E-02
-3.97E-01
-1.25E-02
no
σ95,C
-9.17E-02
-3.95E-01
-1.26E-02
no
σ95,T
-9.18E-02
-3.96E-01
-1.25E-02
no
σ96,C
-9.18E-02
-3.98E-01
-1.26E-02
no
σ98,A
-9.21E-02
-4.00E-01
-1.27E-02
no
σ98,G
-9.20E-02
-3.97E-01
-1.26E-02
no
σ101,C
-9.24E-02
-3.99E-01
-1.26E-02
no
σ101,T
-9.20E-02
-3.96E-01
-1.26E-02
no
σ103,A
-9.20E-02
-3.98E-01
-1.26E-02
no
Table A.9: All estimated eﬀects for variable sites in the HIV-1 V3 loop dataset, cluster
2.
Parameter
Variant
Median
Lower
Upper
Present
σ7,G
R3G
-1.67E-02
-1.90E-01
-1.42E-03
yes
σ9,G
.
-1.63E-02
-1.87E-01
-1.41E-03
yes
σ10,T
P4S
-1.63E-02
-1.86E-01
-1.43E-03
yes
σ17,G
H6R
-1.64E-02
-1.86E-01
-1.43E-03
yes
σ19,C
Y7H
-9.26E-04
-3.99E-03
-3.40E-04
yes
σ24,G
.
-1.61E-02
-1.87E-01
-1.41E-03
yes
σ30,G
.
-1.63E-02
-1.86E-01
-1.44E-03
yes
σ32,A
R11H
-1.77E-05
-2.58E-05
-1.12E-05
yes
σ40,G
I14V
-1.64E-02
-1.89E-01
-1.42E-03
yes
σ45,G
.
-1.66E-02
-1.91E-01
-1.43E-03
yes
σ54,G
.
-3.29E-03
-4.24E-02
-6.61E-04
yes
σ65,C
V22A
-1.61E-02
-1.87E-01
-1.40E-03
yes
σ78,G
I26M
-1.64E-02
-1.88E-01
-1.42E-03
yes

160
Table A.9 continued
σ80,C
I27T
-1.63E-02
-1.88E-01
-1.41E-03
yes
σ81,G
I27M
-9.30E-04
-4.03E-03
-3.40E-04
yes
σ88,G
M30V
-1.63E-02
-1.86E-01
-1.42E-03
yes
σ91,G
R31G
-1.48E-03
-9.74E-03
-4.45E-04
yes
σ93,G
.
-1.63E-02
-1.87E-01
-1.42E-03
yes
σ96,C
Q32H
-3.29E-03
-4.37E-02
-6.62E-04
yes
σ96,G
.
-1.63E-02
-1.89E-01
-1.42E-03
yes
σ98,C
V33A
-1.63E-02
-1.87E-01
-1.41E-03
yes
σ102,C
.
-1.62E-02
-1.88E-01
-1.42E-03
yes
σ7,C
-7.69E-02
-3.78E-01
-6.24E-03
no
σ7,T
-7.64E-02
-3.76E-01
-6.14E-03
no
σ9,C
-7.71E-02
-3.75E-01
-6.10E-03
no
σ9,T
-7.72E-02
-3.77E-01
-6.08E-03
no
σ10,A
-7.75E-02
-3.80E-01
-6.29E-03
no
σ10,G
-7.74E-02
-3.79E-01
-6.18E-03
no
σ17,C
-7.76E-02
-3.80E-01
-6.17E-03
no
σ17,T
-7.71E-02
-3.76E-01
-6.11E-03
no
σ19,A
-7.73E-02
-3.78E-01
-6.12E-03
no
σ19,G
-7.72E-02
-3.79E-01
-6.15E-03
no
σ24,C
-7.66E-02
-3.75E-01
-6.18E-03
no
σ24,T
-7.72E-02
-3.80E-01
-6.14E-03
no
σ30,C
-7.78E-02
-3.78E-01
-6.22E-03
no
σ30,T
-7.80E-02
-3.81E-01
-6.26E-03
no
σ32,C
-7.65E-02
-3.76E-01
-6.16E-03
no
σ32,T
-7.62E-02
-3.75E-01
-6.11E-03
no
σ40,C
-7.71E-02
-3.77E-01
-6.23E-03
no
σ40,T
-7.78E-02
-3.77E-01
-6.19E-03
no
σ45,C
-7.70E-02
-3.78E-01
-6.17E-03
no
σ45,T
-7.68E-02
-3.77E-01
-6.19E-03
no
σ54,C
-7.77E-02
-3.79E-01
-6.15E-03
no
σ54,T
-7.68E-02
-3.75E-01
-6.20E-03
no

161
Table A.9 continued
σ65,A
-7.74E-02
-3.78E-01
-6.03E-03
no
σ65,G
-7.69E-02
-3.75E-01
-6.17E-03
no
σ78,C
-7.68E-02
-3.77E-01
-6.11E-03
no
σ78,T
-7.73E-02
-3.77E-01
-6.26E-03
no
σ80,A
-7.66E-02
-3.78E-01
-6.21E-03
no
σ80,G
-7.73E-02
-3.79E-01
-6.24E-03
no
σ81,C
-7.66E-02
-3.81E-01
-6.15E-03
no
σ81,T
-7.63E-02
-3.74E-01
-6.11E-03
no
σ88,C
-7.65E-02
-3.74E-01
-6.11E-03
no
σ88,T
-7.64E-02
-3.77E-01
-6.18E-03
no
σ91,C
-7.63E-02
-3.74E-01
-6.17E-03
no
σ91,T
-7.65E-02
-3.74E-01
-6.14E-03
no
σ93,C
-7.71E-02
-3.75E-01
-6.16E-03
no
σ93,T
-7.73E-02
-3.80E-01
-6.14E-03
no
σ96,T
-7.80E-02
-3.79E-01
-6.22E-03
no
σ98,A
-7.74E-02
-3.80E-01
-6.22E-03
no
σ98,G
-7.76E-02
-3.77E-01
-6.15E-03
no
σ102,A
-7.68E-02
-3.79E-01
-6.16E-03
no
σ102,G
-7.65E-02
-3.78E-01
-6.10E-03
no
A.6
Alternative values of ﬁxed parameters for HIV-1 datasets
Posterior predictive checks of HIV-1 datasets using default PEQuasi settings reveal
areas of concern §2.3.1 and suggest alternative values of ﬁxed parameters. In the HIV-
1 V3 loop dataset, many pairs of sites exhibit lower levels of linkage disequilibrium
in simulated datasets than in the observed dataset. Increasing the value of the linkage
disequilibrium p-value cutoﬀαLD from 0.1 to 0.5 should reduce the discrepancy in linkage
disequilibrium in the posterior predictive distribution and the observed data. We will

162
be more likely to include truly nonzero interactions, while also probably adding other
interaction terms that do not diﬀer in a practical sense from zero.
In the HIV-1 gag dataset, there was an excess of rare haplotypes in datasets simulated
from the posterior predictive distribution relative to the observed dataset. Excessive
numbers of rare haplotypes in simulated datasets could be caused by excessive shrinkage
of the ﬁtness eﬀects of absent alleles towards zero, pulling haplotype ﬁtness estimates
towards neutrality. Even if the per site upward bias in estimating the relative frequency
of rare alleles is modest, the probability of at least one unobserved mutation over a long
genetic region can be substantial. To bias ﬁtness estimates of absent alleles towards
lethality instead of neutrality, we reanalyzed the HIV-1 gag epitopes dataset decreasing
the prior parameter λ to 0.1 from the original value of 10. Though to a lesser extent than
in the V3 loop dataset, there were rare combinations of alleles occurring unexpectedly
often. Therefore we also increased the LD p-value cutoﬀαLD from 0.1 to 0.5 in this
dataset.
An alternative explanation for low posterior predictive p-values is that although spe-
ciﬁc rare allele combinations are not being replicated in the posterior predictive distri-
bution, it is not unusual to see some rare allele combinations. This is related to the
rationale for using multiple testing correction in determining site groups, and seems es-
pecially plausible for singleton haplotypes. As before, let y be the vector of haplotype
counts and ns be the number of singletons in the sample. To investigate whether rare
allele combinations observed in the real data are more unusual than those observed in
the posterior predictive distribution, we introduce a new statistic Ts(y).
Ts(y) = 1
ns
X
j:yj>1
X
i:yi=1
qij
yj
P
k yk
(A.1)
The statistic is the sum of mutation rates from haplotypes appearing more than once
to singleton haplotypes weighted by abundance. It is intended to quantify the mutational

163
ﬂow from other sampled haplotypes to singletons, though it does not do so exactly as it
neglects ﬁtness diﬀerences. Which haplotypes are singletons will vary by sample. If the
singleton haplotypes in the data are unusually distinct from what would be predicted by
mutational ﬂow, we might expect this statistic to be lower in the observed data than in
simulated datasets. .
y may contain positive counts of haplotypes containing unobserved subhaplotypes.
Counts and mutational distances of these haplotypes are unknown.
We make some
simplifying assumptions to accommodate this scenario. First, we assume each unobserved
subhaplotype is Hamming distance 1 from some observed subhaplotype in the original
data. We expect single nucleotide mutants of common sequences to contribute most to
unobserved subhaplotypes. Second, we assume each unobserved haplotype is a singleton.
Let nu be the sample count of unobserved haplotypes with sequence u in the observed
positions. Let C(u) be the set of haplotypes with sequence u in observed positions, and
each unobserved subhaplotype Hamming distance 1 from some observed subhaplotype.
Then for all h ∈C(u) compute
t(h) =
X
j:yj>1
qhj
yj
P
k yk
Assign the unobserved haplotypes the nu sequences with the largest values of t(h). Re-
peat for all values of u observed in the data. Because all unobserved haplotypes are
assumed to be singletons (and therefore mutation probabilities between them do not
enter into Eq. (A.1)), this procedure will maximize Ts(y) under our two assumptions.
Setting the prior parameter λ = 0.1 in the HIV-1 gag dataset results in posterior
distributions of ﬁtness eﬀects of absent alleles concentrated near 0, while setting this
parameter equal to 10 concentrates the posterior distribution close to one (Figure A.1).
Very rare alleles are similarly aﬀected. In reality, the distribution of allele ﬁtness eﬀects
probably has peaks both near zero and near one [136]. The posterior distribution of the

164
Table A.10: Site partitions used in the original analysis (αLD = 0.1) and the new analysis
(αLD = 0.5). Singleton partition elements are omitted. Sites in a partition are permitted
nonzero interaction terms.
Region
Cluster
αLD
Partition
gag
1
0.1
{370,373,395}
gag
1
0.5
{370,373,395}
gag
2
0.1
{359,376,386,395}
gag
2
0.5
{359,375,376,386,395,398}
gag
3
0.1
gag
3
0.5
V3 loop
1
0.1
{3,12,15,54,60,75,78,87,93}
V3 loop
1
0.5
{3,12,15,54,60,75,78,87,93,103}{69,101}{90,98}
V3 loop
2
0.1
V3 loop
2
0.5
ﬁtness eﬀect of an allele occurring six times is more sharply peaked at the higher value of
λ but otherwise similar. Using a prior distribution of allele ﬁtness eﬀects heavily favoring
near lethality reduces (in Cluster 2) or eliminates (in Clusters 1 and 3) the discrepancy
between the number of sampled haplotypes in the real dataset and datasets simulated
from the posterior predictive distribution (Table A.11). Increasing αLD resulted in two
new sites, 375 and 398, added to the multisite group in Cluster 2, and did not aﬀect the
site groups in any other cluster (Table A.10). Only one interaction parameter was added,
and this had an 80% credible interval including zero. Posterior predictive p-values asso-
ciated with the sites newly added to the multisite group increased. However, posterior
predictive p-values for some other linkage disequilibrium statistics decreased. This may
be because biasing estimates of rare allele ﬁtness towards zero will mean they occur in
fewer datasets simulated from the posterior predictive distribution, which leads to more
unnormalized LD values of zero. Of the eﬀects highlighted in Table 2.4, those estimable
from ﬁtnesses of haplotypes with counts greater than 1 were nearly unchanged (maxi-
mum diﬀerence 0.0004). The point estimate of one interaction parameter (ρ(376,A),(395,T))
dramatically changed (Figure A.2). This interaction became nonestimable in the new
analysis because of additional sites added to the site group. Likely because of this change

165
Table A.11: Posterior predictive p-values under the new settings λ = 0.1 and αLD = 0.5
in the HIV gag dataset. All quantities with posterior predictive p-value less than 0.01
in the HIV gag epitope dataset under either the default or new settings are shown.
Haplotypes are denoted by their nucleotide variants from the cluster reference separated
by commas.
Cluster
X
p-value
xobs
(Xrep)0.5
1
nh
0.647
15
17
1
ns
0.655
9
11
1
D359A,395A
0.005
0.00013
0
1
D359A,373G
0.007
0.00013
0
2
ns
< 0.001
19
37
2
nh
< 0.001
38
56
2
D375C,395T
0.045
0.000026
0
2
375C,395T
0.053
1
0
2
D376A,398A
0.468
0.00007
0.000024
2
D376A,397A
< 0.001
0.000047
0
2
376A,397A
0.005
2
0
3
REF
0.373
2545
2552
3
nh
0.447
11
8
3
D363T,398A
0.008
-0.00000015
0
in estimability, in the new analysis the 95% credible interval for this interaction includes
zero.
When αLD is increased in the HIV-1 V3 loop dataset, some pairs of alleles that
previously showed strong evidence for lack of ﬁt (e.g. 90T and 98T in Cluster 1) no
longer do so (Table A.12). However, it does not eliminate evidence of lack of ﬁt. This is
unsurprising as not all of these site pairs display evidence of LD even using a cutoﬀof 0.5.
Changing the cutoﬀonly aﬀected the site group membership of sites 69, 90, 98, 101, and
103 in Cluster 1, and did not aﬀect Cluster 2 site group membership at all (Table A.10).
All 80% credible intervals for interaction parameters omitted with αLD = 0.1 included
zero when using αLD = 0.5. It may be surprising that some lack of ﬁt is alleviated
without any clearly nonzero interaction terms being added. Sites in diﬀerent site subsets
are always unlinked in the ﬁtted model, though LD may not be precisely zero in posterior
predictive samples because of sampling variation. This need not be true of sites within a
site subset even when no interaction term involving these alleles is present. Nonzero LD
may be caused by other interaction terms involving the alleles and by only modeling the

166
Table A.12: Posterior predictive p−values under the new setting αLD = 0.5 in the HIV
V3 loop dataset cluster 1. All quantities with posterior predictive p-value less than 0.01
under either the original or new settings are shown. Haplotypes are denoted by their
nucleotide variants from the cluster reference separated by commas. Cluster 2 results
not shown as they are unchanged.
X
p-value
xobs
(Xrep)0.5
16G,60C
0.002
2
0
6G,78C,87C
0.002
1
0
3C,17G,54G,75C
0.002
1
0
D6G,78C
0.003
0.00082
0
D6G,87C
0.005
0.0008
0
20G,36G,75C
0.007
1
0
D3C,25G
0.01
0.0018
0
D33C,87C
0.01
0.0008
0
D20G,36G
0.013
0.00082
-0.0000063
3C,69G,101G
0.018
1
0
D78C,86G
0.032
0.0008
-0.000015
75C,90G,98T
0.037
1
0
D90G,98T
0.125
0.00083
0
D69G,101G
0.132
0.00083
0
15T,60C,103C
0.165
1
0
93G,103C
0.622
5
3
D93G,103C
0.722
0.0034
0.0026
3C,42G,93G
0.008
1
0
D33C,78C
0.008
0.00082
0
ﬁtness of some subhaplotypes, absorbing all others into Hu. For the most part, estimates
of featured parameters common to both analyses were close (Figure A.2). Of the three
parameters with large changes, one was the main eﬀect σ(101,G). The other two parameters
were σ(15,T) and ρ(3,C),(15,T). Estimates of these parameters might have been aﬀected by
the addition of 103C because of the occurrence of 15T and 103C on the same haplotype.
Diﬀerences in the posterior medians of these parameters are still no more than 33% of
the credible interval width. None of the signs of the parameters featured in Table 2.6
changed. However, in the original analysis, the parameter sign of 90G was inferred to
be negative as it corresponded to an allele occurring only once in the data. This allele
co-occurred with allele 98T. The aliased parameter σ(90,G) = ρ(90,G),(98,T) had uncertain
sign in the reanalysis. Cluster 2 results are not reported as this analysis was completely
unchanged by the new value of αLD.

167
λ = 0.1
λ = 10
0
1
6
0.00
0.25
0.50
0.75
1.00
0.00
0.25
0.50
0.75
1.00
0
5
10
15
20
0
5
10
15
20
0
5
10
15
20
Multiplicative Fitness Effect
density
Figure A.1: Example posterior distribution of allele multiplicative ﬁtness eﬀects using
the HIV-1 gag dataset (cluster 2 , site 1) when λ = 0.1 (left) and λ = 10 (right). Minor
alleles at this site have counts 0, 1, and 6 out of 37,653 total haplotypes. Diﬀerent rows
correspond to the posterior distribution of diﬀerent alleles, labeled by count.
The posterior predictive statistic Ts indicates some evidence of singletons unusually
distant from more common haplotypes in HIV-1 gag cluster 2 using the original analysis
strategy (Table A.13). This statistic was higher in the observed data than the simulated
data in Clusters 3. Ts computed from posterior predictive samples increased on average
in the reanalysis of HIV-1 gag dataset, perhaps because of the lower estimated relative
frequency of unobserved alleles in the posterior distribution. This reduced the posterior
predictive p-value for Cluster 2 but increased it for Cluster 3. Although the observed
data tend to have rare variants that are more unusual given rates of mutation from
common variants than we see in the posterior predictive datasets, they still fall within
the range of posterior predictive samples. For the HIV-1 V3 loop, Ts tends to be higher in
posterior predictive samples, but the observed value falls within their range of variation.

168
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G G
G
G
G
G
G
G G G
V3 loop
gag
−0.0050
−0.0025
0.0000
0.00
0.05
0.10
0.0
0.1
0.2
0.3
0.4
−0.005
0.000
0.005
Original Analysis
Reanalysis
Figure A.2: Comparison of featured HIV-1 dataset parameter posterior medians with
results obtained by reanalysis. Both datasets were reanalyzed with a higher value of the
linkage disequilibrium cutoﬀαLD, and the gag dataset was reanalyzed with a lower value
of the prior parameter λ.

169
Table A.13: Posterior predictive statistic Ts computed in the original analysis (1) and
the reanalysis (2). No reanalysis for V3 loop cluster 2 as changing αLD did not change
the original site groups.
Analysis
Dataset
Cluster
X
p-value
xobs
(Xrep)0.5
1
gag
1
Ts
0.608
0.0000048
0.000005
1
gag
2
Ts
0.04
0.0000048
0.0000059
1
gag
3
Ts
0.005
0.0000099
0.0000095
2
gag
1
Ts
0.275
0.0000048
0.0000059
2
gag
2
Ts
0.025
0.0000048
0.0000075
2
gag
3
Ts
0.193
0.0000099
0.0000099
1
V3 loop
1
Ts
0.182
0.0000011
0.0000012
2
V3 loop
1
Ts
0.095
0.0000011
0.0000013
1
V3 loop
2
Ts
0.79
0.0000042
0.0000044
A.7
Robustness to violations of pairwise-only epistasis
In this section we explore the consequences of violating the pairwise-only epistasis
(PE) assumption. The QuasiFit model is fully saturated and should be robust to such
violations, but the PEQuasi method may produce misleading estimates of remaining
parameters by forcing the PE structure. We examine the eﬀect on parameter estimation
and check whether the assumption violation may be detected.
As before, simulated datasets were modeled on the HIV-1 gag dataset [58] with
sequences clustered by connectedness in Hamming space (see §2.2.5.1). For most of the 35
clusters within the seven amplicons, the PE model restricted to observed subhaplotypes
within site groups was saturated, a reparametrization of QuasiFit’s model. However,
there were four clusters in three amplicons for which the rank of the PE design matrix
was less than the rank of the saturated model design matrix. We identiﬁed nine non-
overlapping combinations of four sites from these clusters that retained this diﬀerence
in rank. For each of these four-site combinations, datasets were simulated as described
in §2.2.4 with adjustment to allow higher order epistasis terms detailed below.
After relaxing the PE condition, haplotype ﬁtnesses are arbitrary positive numbers.
Retaining all 256 possible four-site haplotypes, we used the procedure discussed in A.1
to estimate a ﬁtness landscape ˆw consistent with the data.
Due to the use of the

170
same pseudocount for each haplotype, unobserved haplotypes will be equally common
regardless of their Hamming distance from common haplotypes. This not expected if they
are generated primarily by random mutation from more common haplotypes. We address
this problem by setting the ﬁtnesses of all unobserved haplotypes to 0.5. We then veriﬁed
the match between the implied quasispecies equilibrium p and the observed sample
relative frequencies. The highest Euclidean distance between the modeled and observed
haplotype relative frequencies was 0.0042 (median 3 × 10−4). Correlation between log10
modeled and observed relative frequencies of present haplotypes was very high in all
cases (minimum 0.997).
We discovered that rare haplotypes are important in increasing the rank of the satu-
rated model relative to the PE model, so we simulated with sample size set to 100,000.
Under these conditions, all simulated datasets had the desired reduced rank property.
Table A.14 gives total haplotype counts across datasets.
The nine simulated datasets were ﬁt with the same procedure used for all simulated
and real datasets (see §2.2.3). All pairwise epistasis terms were retained because there
was evidence of nonrandom association of alleles between all pairs of sites. For two of
these simulated datasets, the sampler initially failed to converge. In one case, failure
to converge could be attributed to ﬁve isolated low posterior probability walkers failing
to mix with others or with each other and addressed through a lower variance starting
distribution centered at the higher mode. In the other dataset, the posterior distribu-
tion appeared to have two well populated modes with similar posterior probability, and
walkers never moved between modes. We reanalyzed the latter dataset using the Aﬃne
Invariant Ensemble sampler in combination with parallel tempering, also implemented
in emcee [64], to improve exchange between walkers at the two modes. The sampler was
initialized with 100 walkers at each mode. The Gelman diagnostic for this dataset using
parallel tempering was 1.001. The chain converged on a solution with 0.002% mass at
the lower mode and the rest at the higher mode. Parameter estimates were very similar

171
to a solution produced without parallel tempering and all walkers initialized near the
higher mode.
For comparison, we ﬁt the model using the procedure outlined in §2.2.3, but retained
higher order epistasis terms in the model, a method we will call “PEQuasi-Sat”. Other
features of PEQuasi that diﬀer from QuasiFit were retained, namely the Laplace prior on
all ﬁtness eﬀects and the use of the composite subhaplotype. Performance comparisons
focus on the parameters common to both PEQuasi and PEQuasi-Sat; we do not include
higher order interaction parameters in the calculations of rank correlation, absolute error
and credible interval coverage. We also compare PEQuasi to QuasiFit implemented as
described in §2.3.2.3.
Table A.14: Total number of haplotypes and parameters in 9 simulated datasets.
Number of
Eﬀects In Model
pmax(θ)
Haplotypes
Total
Main
Interaction
Mixed
< 0.01
171
166
82
77
7
≥0.01
25
16
12
4
0
Table A.15: Fitness eﬀect estimation using the PEQuasi and PEQuasi-Sat methods on
datasets simulated with higher order epistasis. Table shows coverage of 95% credible
intervals, Kendall’s Tau between true and posterior median parameters, the percent of
95% credible intervals excluding zero, and the proportion of the former for which the
inferred parameter sign matched the truth. In the ﬁrst four rows, a single value of each
statistic is computed for all parameters ignoring dataset membership. The last row gives
the mean and standard error across datasets.
Coverage
Sign
Type
Method
95%
Tau
% Inferred
% Correct
< 0.01-estble
PEQuasi
0.48
0.71
77.71
96.39
≥0.01-estble
PEQuasi
0.94
1
100
100
< 0.01-estble
PEQuasi-Sat
0.62
0.77
74.1
100
≥0.01-estble
PEQuasi-Sat
0.94
1
100
100
Dataset Mean (SE)
PEQuasi
0.51 (0.05)
0.75 (0.02)
80.22 (2.3)
96.42 (1.34)
Dataset Mean (SE)
PEQuasi-Sat
0.64 (0.03)
0.78 (0.03)
76.69 (1.99)
100 (0)
Excluding higher order interactions from a model may or may not bias estimates
of the remaining parameters.
The bias of least squares estimates can be computed
exactly for linear models when the true parameter value is known [62], but there is no

172
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
1e−06
1e−04
1e−02
1e+00
1e−05
1e−03
1e−01
pmax(θ)
|θ−θ^|
Figure A.3: Absolute diﬀerence between posterior median ˆθ and parameter value θ used
in simulation versus pmax(θ). pmax(θ) is deﬁned as the maximum value of p such that the
parameter is estimable under the pairwise-only epistasis model from the set of ﬁtnesses
of haplotypes with equilibrium relative frequency at least p. Parameter estimates from
nine datasets simulated with higher order epistasis.

173
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
100000
1e−06
1e−03
1e+00
1e−07
1e−05
1e−03
1e−01
|θ−θ^|PEQuasi
|θ−θ^|QuasiFit
0.1
0.2
0.3
p
Figure A.4: Absolute error in posterior median haplotype ﬁtnesses using the QuasiFit
and PEQuasi methods when simulating with higher order epistasis terms. Nine datasets
for each number of simulated haplotypes. Color scale shows the haplotype equilibrium
relative frequency.

174
Table A.16: Haplotype ﬁtness estimation using PEQuasi, PEQuasi-Sat and QuasiFit on
datasets simulated with higher order epistasis. Table shows coverage of 95% credible
intervals and Kendall’s Tau between true and posterior median ﬁtnesses. The last rows
give the mean and standard error across the nine datasets.
Coverage
Method
Type
95%
Tau
PEQuasi-Sat
< 0.01-estble
0.63
0.77
PEQuasi
< 0.01-estble
0.53
0.72
Quasiﬁt
< 0.01-estble
0.89
0.75
PEQuasi-Sat
≥0.01-estble
0.88
1
PEQuasi
≥0.01-estble
0.84
1
Quasiﬁt
≥0.01-estble
0.12
0.84
PEQuasi-Sat
Dataset Avg.
0.66 (0.03)
0.84 (0.02)
PEQuasi
Dataset Avg.
0.57 (0.04)
0.8 (0.02)
Quasiﬁt
Dataset Avg.
0.8 (0.02)
0.83 (0.02)
equivalent formula for the quasispecies equilibrium model. Though we cannot compute
the bias, we can detect when it will be nonzero under the PE-restricted model. In the
following demonstration, we consider unconstrained (full) and PE-restricted models for
the ﬁtnesses of present haplotypes, where all terms involving alleles in the reference
haplotype, AAA, are set to zero.
If the full model includes no higher order terms, as is the case if the collection of
observed haplotypes is {AAA, CAA, ACA, ACC}, then clearly, parameter estimates un-
der the PE and full models are identical. It is also possible that higher order terms
are present in the full model, but completely aliased with lower order terms. For exam-
ple, in the collection of observed haplotypes {AAA, CAA, CCA, CCC}, the three-way
interaction β(1,C),(2,C),(3,C) is completely aliased with σ3C = ρ(1,C),(3,C) = ρ(2,C),(3,C). The
parameter σ3C has exactly the same role as β(1,C),(2,C),(3,C) in the full model. Except
for diﬀerences caused by the prior distribution, estimates of these two parameters and
all other parameters will be the same in both models. Finally, it is possible to have
higher order terms present without complete aliasing. If the set of observed haplotypes
is {AAA, CAA, ACA, AAC, CCA, CAC, ACC, CCC}, all parameter estimates are po-
tentially diﬀerent under the two models as there is no longer a one-to-one map between
their parameters.

175
In the previous examples, it is also clear that high order biological interactions may
simply be undetectable in some datasets. The data to detect a non-zero three-way inter-
action β(1,C),(2,C),(3,C) is missing in the ﬁrst and second examples. In the ﬁrst example,
the absence of CCC haplotypes may suggest a negative three-way interaction, but could
also be explained by a negative value of ρ(1,C),(3,C) or ρ(1,C),(2,C). In the second example,
the three-way interaction eﬀect would be absorbed in the estimate of the main eﬀect
σ3C. Because eﬀects estimated from uncommon haplotypes are poorly estimated (see
Figs. 2.5 and A.3), we argue that little concrete information is lost by restricting to
present haplotypes, even if we have lost the ability to estimate a three-way interaction.
In essence, the three-way interaction may exist, but we could not estimate it anyway.
In both cases, without further data, the PE model would lead to the parsimonious con-
clusion that there is no three-way interaction. The risk of undetected bias and false
conclusions is disconcerting, but a proper application of the scientiﬁc method. In these
cases, the PE assumption is not detectably wrong, but it makes precise predictions about
pairwise interactions that can be tested in targeted experiments or larger datasets.
Coverage of credible intervals for ﬁtness eﬀect parameters is reduced well below the
nominal level when simulating without the PE constraint (Table A.15). Additionally,
incorrect parameter signs are sometimes inferred. Comparison of PEQuasi and PEQuasi-
Sat results indicates that including higher order terms improves credible interval cover-
age, rank correlation, and correct inference of parameter size, but coverage remains
below the nominal level. One explanation of this diﬀerence could be the large number of
rare haplotypes with parameter estimates strongly inﬂuenced by the prior occurring in
datasets simulated at sample size 100,000. Performance in estimating these haplotype
ﬁtnesses could be particularly poor in this set of simulated datasets because haplotypes
absent in the model dataset were assigned log ﬁtness -0.7. The mass of our Laplace
prior parameter was concentrated above this value. Poorly estimated eﬀects tend to

176
occur in rare haplotypes. Importantly, the 0.01-estimable eﬀects are still well-estimated
(Table A.16)
Comparing the ability of the PEQuasi and QuasiFit methods to estimate haplotype
ﬁtnesses, we conclude PEQuasi still has the edge over QuasiFit for common haplotypes.
Rank correlations between true and estimated haplotype ﬁtnesses were similar, though
QuasiFit had a small advantage (Table A.16). However, PEQuasi-Sat had a small advan-
tage over QuasiFit in rank correlation. Credible interval coverage using both methods
is below the nominal level. Overall, QuasiFit has higher credible interval coverage than
PEQuasi. Though PEQuasi retains its advantage for common haplotypes, at this high
sample size, there are large numbers of sampled rare haplotypes whose ﬁtnesses are better
estimated by QuasiFit (Figure A.4 and Table A.16). Including higher order interactions
improves PEQuasi performance, but it still does not match QuasiFit on rare haplotypes.
Table A.17: Posterior predictive p-values for haplotype counts. Dataset is the dataset
index. xobs is the observed count, (Xrep)0.5 is the median count across datasets simulated
from the posterior predictive distribution.
Dataset
Haplotype
p-value
xobs
(Xrep)0.5
1
GAAG
0.003
1
10
3
AGCA
< 0.001
6
62
3
AACC
< 0.001
27
184
3
AGCC
< 0.001
259
2
3
AGTC
< 0.001
1479
1717
5
ATGA
< 0.001
5
30
5
GTTA
< 0.001
7
0
5
GCGC
< 0.001
46
12
5
Hu
0.002
0
7
9
TGAG
< 0.001
17
0
9
TGAC
0.002
5
19
To check if violations of the PE assumption can be detected when using the PEQuasi
model, we checked for evidence of lack of ﬁt in our nine simulated datasets violating
this assumption (see Methods §2.2.3). Posterior predictive checks reveal lack of ﬁt of
the PEQuasi model to observed haplotype counts in four of nine datasets (Table A.17).
None of the datasets had omitted pairwise interactions, making failure to include higher
order interactions a likely explanation.
The number of haplotype counts displaying

177
G
G
G
G
G
GG
G
G
0.025
0.050
0.075
0
1
2
3
4
Number of haplotype counts with lack of fit
τPEQuasiSat −τPEQuasi
Figure A.5: Diﬀerence in rank correlation of true and posterior median haplotype ﬁt-
nesses between PEQuasi and PEQuasi-Sat as a function of the number of haplotypes
with posterior predictive p-values less than 0.01 using PEQuasi.

178
lack of ﬁt in a dataset correlates with the reduction in rank correlation between true
and estimated haplotype ﬁtnesses relative to PEQuasi-Sat, which includes higher order
interactions (Figure A.5). For all ﬁve datasets without strong evidence for lack of ﬁt in
any haplotype count, the rank correlation diﬀerence was less than 0.02. This suggests
posterior predictive checks are eﬀective in detecting the presence of important higher
order interaction terms.
A.8
Sensitivity to ﬁxed parameters
Sensitivity to the prior parameter λ and sensitivity to the mutation rate q were
assessed using the same 14 simulated datasets. Methods for mutation rate sensitivity
analysis were presented in §2.3.2.2. We assessed sensitivity to λ in datasets simulated
using both the N = 1, 000 and N = 10, 000 sample sizes. We reﬁt the PEQuasi model
using four values of λ ranging from 1 to 100. Table A.18 gives characteristics of simulated
datasets used in the sensitivity analysis.
Table A.18: Characteristics of simulated datasets. Cells give the total number of pa-
rameters across 14 simulated datasets at each of two sample sizes. Separate parameter
counts are given for three diﬀerent p-estimability bins. Total is the total number of ﬁt-
ness eﬀect parameters appearing in the ﬁtnesses of observed haplotypes. Columns Main,
Interaction, and Mixed subdivide ﬁtness eﬀect parameters into main eﬀects, interaction
eﬀects, and groups of aliased parameters including both main eﬀects and interactions.
Number of
Eﬀects In Model
N
pmax(θ)
Haplotypes
Total
Main
Interaction
Mixed
1000
< 0.001
25
30
21
6
3
1000
0.001 −0.01
27
27
18
5
4
1000
≥0.01
20
14
12
1
1
10000
< 0.001
100
100
74
23
3
10000
0.001 −0.01
32
28
20
6
2
10000
≥0.01
20
13
12
1
0
Results on mutation rate sensitivity are given in §2.3.2. Table A.20 shows posterior
predictive checks on datasets with misspeciﬁed mutation rates, and is discussed in the
main text §2.3.2.

179
G
G
G
G
GG
G
G
G
G
G
GG
GG
GG
GG
G
G
G
G
G
G
G
G
G
G
G
GGG
G
G
G
G
G
G
G
GG
G
G
GGG
G
GG
GG
G
G
G
GGGGGGG
GG
G
G
GGGGGG
G
G
G
G
G
G
G
G
G
G
G
G
GG
GG
GG
G
G
G
GG
G
G
G
G
G
G
GGG
G
G
G
G
G
G
G
G
G
G
G
GGG
G
GG
GG
G
G
G
GG
GGGGG
GG
G
G
GGGGG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
GG
G
G
GGG
G
G
G
G
G
G
GGG
G
G
G
G
G
G
G
G
G
G
G
GGG
G
GG
GG
G
G
G
GG
GG
G
G
G
GG
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
GG
GG
GG
G
G
G
GG
G
G
G
G
G
G
GGG
G
G
G
G
G
G
G
G
G
G
G
GGG
G
GG
GG
G
G
G
GGGGGGG
GG
G
G
GGGGG
G
G
G
G
G
GG
G
G
G
G
G
GG
GG
GG
GG
G
G
G
G
G
G
G
G
G
G
G
GGG
G
G
G
G
G
G
G
GG
G
G
GGG
G
GG
GG
G
G
G
GGGGGGG
GG
G
G
GGGGGG
G
G
G
G
G
G
G
G
G
G
G
G
GG
GG
GG
G
G
G
GG
G
G
G
G
G
G
GGG
G
G
G
G
G
G
G
G
G
G
G
GGG
G
GG
GG
G
G
G
GG
GGGGG
GG
G
G
GGGGG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
GG
G
G
GGG
G
G
G
G
G
G
GGG
G
G
G
G
G
G
G
G
G
G
G
GGG
G
GG
GG
G
G
G
GG
GG
G
G
G
GG
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
GG
GG
GG
G
G
G
GG
G
G
G
G
G
G
GGG
G
G
G
G
G
G
G
G
G
G
G
GGG
G
GG
GG
G
G
G
GGGGGGG
GG
G
G
GGGGG
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
GG
G
G
G
GG
G
G
G
G
G
G
GG
G
G
G
G
G
G
GGG
GGGG
G
G
G
G
G
G
G
G
G
G
G
G
G
GGG
GG
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
GG
G
GG
G
G
G
G
G
GGG
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
GG
G
G
GG
G
G
GG
G
G
G
G
G
G
GGG
GGGG
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
GG
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
GG
G
GG
G
G
G
G
G
GGG
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
GG
G
G
GG
G
G
GG
G
G
G
G
G
G
GGG
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
GGG
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
GG
G
G
GG
G
G
GG
G
G
G
G
G
G
GGG
GGGG
G
G
G
G
G
G
G
G
G
G
G
G
G
GGG
GG
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
GG
G
GG
G
G
G
G
G
G
G
G
G
GG
G
GG
G
G
G
G
G
GGG
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
GG
G
G
G
GG
G
G
G
G
G
G
GG
G
G
G
G
G
G
GGG
GGGG
G
G
G
G
G
G
G
G
G
G
G
G
G
GGG
GG
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
GG
G
GG
G
G
G
G
G
GGG
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
GG
G
G
GG
G
G
GG
G
G
G
G
G
G
GGG
GGGG
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
GG
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
GG
G
GG
G
G
G
G
G
GGG
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
GG
G
G
GG
G
G
GG
G
G
G
G
G
G
GGG
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
GGG
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
GG
G
G
GG
G
G
GG
G
G
G
G
G
G
GGG
GGGG
G
G
G
G
G
G
G
G
G
G
G
G
G
GGG
GG
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
GG
G
GG
G
G
G
G
G
G
G
G
G
GG
G
GG
G
G
G
G
G
GGG
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
N=1000
N=10000
1
10
100
1
10
100
0.00
0.25
0.50
0.75
1.00
λ
θ^ θ^
λ1
pmax(θ)
G
G
G
<  0.001
0.001−0.01
≥ 0.01
Figure A.6: Scaled posterior median of parameters appearing in the ﬁtness of present
haplotypes as function of the Laplace prior parameter λ. Posterior medians are scaled
relative to their value when λ = 1. Each line is a diﬀerent parameter.

180
λ = 1
λ = 5
λ = 10
λ = 20
λ = 100
N = 1000
N = 10000
0.00
0.25
0.50
0.75
1.00 0.00
0.25
0.50
0.75
1.00 0.00
0.25
0.50
0.75
1.00 0.00
0.25
0.50
0.75
1.00 0.00
0.25
0.50
0.75
1.00
0
50000
100000
150000
200000
250000
0
50000
100000
150000
200000
250000
Fitness
count
Figure A.7: Posterior distribution of the ﬁtness of a zero-count single nucleotide mutant
from the reference haplotype for diﬀerent values of prior parameter λ and sample size
N.

181
Table A.19 shows how performance varies as a function of λ and is discussed in
§2.3.2.
Figure A.6 shows how estimates of each parameter vary as a function of λ.
Estimates are scaled relative to the estimate at the lowest value of λ. This ﬁgure shows
estimates of 0.01-estimable parameters are minimally impacted by choice of λ, while
estimates < 0.001-estimable parameters are pulled towards zero as λ increases. Because
we plot estimates on a relative scale, this cannot be explained solely by the fact that
0.01-estimable ﬁtness eﬀects are smaller in magnitude.
In understanding the eﬀect of changing the prior parameter λ, it is informative to look
at what diﬀerent values imply about the ﬁtness of unobserved haplotypes. Figure A.7
shows the posterior distribution of the ﬁtness of a single nucleotide mutant from the
reference haplotype appearing zero times in the sample. We see that the distribution is
fairly uniform over suﬃciently low ﬁtness values. We can see why this might be math-
ematically, if we assume the posterior probability that an unobserved single nucleotide
mutant is ﬁtter than the reference haplotype is essentially zero. Let X have the distri-
bution of a Laplace random variable truncated to the interval (−∞, 0) and let fX(x) be
its pdf. Using our parameterization,
fX(x) =
λ
2e−λ|x|I(x < 0)
1
2
= λeλxI(x < 0)
(A.2)
Let Y = eX. Using a change of variables,
fY (y) = λy(λ−1)I(0 < y < 1)
(A.3)
For λ = 1, Eq. (A.3) gives a uniform distribution over the interval (0,1). We do not
expect the posterior distribution of the ﬁtness of a single nucleotide mutant to be exactly
uniform, as its absence generally provides more information than the fact it is less ﬁt
than the reference, but this may explain why the posterior distributions when λ = 1 are
more uniform than those produced with higher values of λ.

182
A.9
Eﬀect of composite haplotype
PEQuasi and QuasiFit account for haplotypes with unmodeled ﬁtness diﬀerently. In
PEQuasi, a composite haplotype assigned a ﬁxed, low ﬁtness is created to stand in for all
unobserved haplotypes within multisite site subsets (§2.2.2). We will refer to this as the
composite haplotype method. QuasiFit does not include a composite haplotype. After
computing the mutation matrix between modeled haplotypes from the product of single
site mutation probabilities, mass is added to the matrix diagonal to ensure a column
stochastic mutation matrix.
The composite haplotype method and the diagonal method may both be viewed as
methods to approximate the quasispecies equilibrium over the full haplotype space by a
quasispecies equilibrium over a smaller set of haplotypes (usually, observed haplotypes).
To assess the approximation, for each of the 49 datasets simulated under the PE model
at sample size 10,000 (§2.2.4) we compared the full equilibrium computed from the true
ﬁtness values to the equilibrium restricted to the set of observed haplotypes using the
diagonal and composite haplotype methods, again using the true ﬁtness values. Equi-
librium relative frequencies were normalized to the set of observed haplotypes. The log
ﬁtness of the composite haplotype was set to -1, as this value was used in all our analyses.
Large errors in approximating relative frequencies for a ﬁxed ﬁtness vector need not
produce large errors in estimating ﬁtnesses from an observed count vector, our problem
of interest. To assess the impact of the composite haplotype on parameter estimation,
we reran PEQuasi on the simulated datasets without the composite haplotype using
mutation matrices generated using QuasiFit’s diagonal method. This will be referred to
as PEQuasi-Diagonal, and the original method will be referred to as PEQuasi-Composite.
We used all 21 datasets simulated at a sample size of 10,000 for which there were detected
groups of linked sites, to which the composite haplotype method applies. We compare
haplotype ﬁtness estimation on these datasets.

183
In all but one of the 49 simulated datasets, the composite haplotype approximation
to the equilibrium relative frequency was closer in Euclidean distance to the renormal-
ized true equilibrium relative frequency than was the diagonal approximation. For this
dataset, the composite haplotype approximate relative frequency was still very close to
the true relative frequency (Euclidean distance 0.00004). Composite haplotype relative
frequencies are generally very close to the true value. The distance between the compos-
ite haplotype relative frequency and the true relative frequency was less than 0.01 on all
but one dataset. This dataset had two ﬁtness peaks separated by a Hamming distance
of 3, making ﬁtnesses of unobserved haplotypes in mutant clouds surrounding the two
peaks important in determining the equilibrium. Relative frequencies approximated by
the diagonal method are frequently far from the true value (Figure A.8).
Table A.21 gives counts of total present haplotypes in the 21 datasets including a
composite haplotype. Credible interval coverage and rank correlation between posterior
median and true ﬁtness values are on average highest for PEQuasi-Composite. Using
QuasiFit or the PEQuasi-diagonal results in similar decreased performance (Table A.22).
The eﬀect of the choice of the composite haplotype or diagonal method is small relative to
estimation error for most haplotypes, but for haplotypes with lower estimation error (gen-
erally common haplotypes), the diﬀerence between the two methods is relatively larger,
usually favoring PEQuasi-Composite (Figure A.9). The pattern for low error haplotypes
is qualitatively similar to the comparison between PEQuasi and QuasiFit(Figure 2.7).
A.10
Assessing lack of ﬁt from omitted interactions
In this analysis, we investigate the eﬀect of partitioning sites by linkage disequilib-
rium (LD) p-value and omitting interactions between site subsets from the model. We
reanalyze all 44 datasets simulated under the PE ﬁtness model at sample size 10,000 in
which there was more than one site subset. By setting the LD p-value cutoﬀαLD greater

184
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
GGG
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GGG
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
Composite
Diagonal
1e−05
1e−03
1e−01
1e−05
1e−03
1e−01
1e−07
1e−04
1e−01
Exact p
Approximate p
Figure A.8: Approximate equilibrium haplotype relative frequencies versus the relative
frequency as calculated from the full set of haplotypes. Left: approximation computed
using PEQuasi composite method. Right: approximation computed using QuasiFit di-
agonal method.

185
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
GGG
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
10000
1e−07
1e−04
1e−01
1e−06
1e−04
1e−02
|θ−θ^|Composite
|θ−θ^|Diagonal
0.1
0.2
0.3
0.4
p
Figure A.9: Absolute error in posterior median haplotype ﬁtnesses using the native
PEQuasi composite haplotype method compared to the PEQuasi method with QuasiFit’s
diagonal method replacing the composite haplotype method.
21 simulated datasets.
Color scale shows the haplotype equilibrium relative frequency.

186
than 1, and comparing results to those obtained using our original value of αLD = 0.1, we
investigate the eﬀect of omitting interaction terms. We also examine whether posterior
predictive analysis can detect lack of ﬁt from omitted interactions when αLD = 0.1.
The posterior distribution of epistatic interactions omitted using our original value
αLD = 0.1 support our claim that zero is a plausible value for these interactions. Of 33
95% credible intervals for interactions omitted with αLD = 0.1, only one excluded zero.
All 99% credible intervals for such parameters included zero.
Haplotype counts for this analysis are provided in Table A.23. Partitioning sites by
LD p-value has the largest impact on ﬁtness estimates for haplotypes with equilibrium
relative frequency less than 0.001 (Figure A.10).
Median absolute deviation (MAD)
was slightly higher when sites were not partitioned (Table A.24). Credible intervals for
ﬁtnesses of haplotypes with population frequency less than 0.1% were on average narrower
when grouping sites, perhaps accounting for the small observed drop in credible interval
coverage. Rank correlation between true parameter values and the posterior median is
not negatively impacted by grouping sites.
We might expect omitting important interaction terms to lead to samples from the
posterior predictive distribution showing lower linkage disequilibrium than the observed
dataset. Table A.25 shows posterior predictive p-values for unnormalized linkage dise-
quilibrium with αLD = 0.1. When lack of ﬁt was detected, simulated datasets from the
posterior predictive distribution had unnormalized linkage disequilibrium closer to zero
than the original dataset. Of 21 simulated datasets in which omitting the interaction
term changed the modeled haplotype ﬁtness space, nine showed evidence of lack of ﬁt
in the posterior predictive distribution of unnormalized linkage disequilibrium. All of
these datasets had nonzero, omitted interaction terms. One dataset showed evidence for
lack of ﬁt despite a saturated model for observed haplotype ﬁtnesses. The same dataset
did not show lack of ﬁt in QuasiFit or using PEQuasi with a single site subset. This
diﬀerence is possible because when haplotypes are split into more than one site subset,

187
unobserved combinations of alleles may be sampled from the posterior predictive dis-
tribution. Although the ﬁtness model for observed haplotypes is saturated, the ﬁtness
model for all potentially sampled haplotypes need not be.

188
G
G
G
G
G
G
G
GG
G
GG
G
G
G
G
G
G
G
G
G
G
G G
G
G
G
G
G
G
GG
G
G
G
G
G
G
GGG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
p < 0.001
p ≥0.001
0.900
0.925
0.950
0.975
1.000
0.980
0.985
0.990
0.995
1.000
0.980
0.985
0.990
0.995
1.000
0.900
0.925
0.950
0.975
1.000
θ^, αLD > 1
θ^, αLD = 0.1
Figure A.10: Eﬀect of partitioning sites by LD p-value on posterior median haplotype
ﬁtness, grouped by haplotype relative frequency. 44 simulated datasets.

189
Table A.19: Performance of PEQuasi as a function of Laplace prior parameter λ. Tau
is Kendall’s Tau rank correlation between true and posterior median parameter values.
MAD is median absolute deviation.
Coverage is coverage of 95% credible intervals.
Width of 95% credible intervals (θ0.975−θ0.025) is a mean across parameters in 14 simulated
datasets.
N
pmax(θ)
λ
Tau
Coverage
MAD
θ0.975 −θ0.025
1000
< 0.001
1
0.35
0.97
8.06 × 10−2
2.12 × 100
1000
< 0.001
5
0.32
0.90
6.40 × 10−2
3.87 × 10−1
1000
< 0.001
10
0.26
0.80
7.58 × 10−2
2.04 × 10−1
1000
< 0.001
20
0.30
0.50
8.05 × 10−2
1.11 × 10−1
1000
< 0.001
100
0.21
0.33
8.45 × 10−2
2.87 × 10−2
1000
0.001 −0.01
1
0.69
0.89
2.02 × 10−3
3.27 × 10−1
1000
0.001 −0.01
5
0.69
0.96
1.92 × 10−3
7.78 × 10−2
1000
0.001 −0.01
10
0.70
0.96
1.76 × 10−3
4.69 × 10−2
1000
0.001 −0.01
20
0.69
1.00
1.47 × 10−3
3.00 × 10−2
1000
0.001 −0.01
100
0.69
1.00
8.40 × 10−4
1.12 × 10−2
1000
≥0.01
1
0.89
0.93
1.37 × 10−5
5.09 × 10−4
1000
≥0.01
5
0.89
0.93
1.34 × 10−5
5.08 × 10−4
1000
≥0.01
10
0.89
0.93
1.31 × 10−5
5.07 × 10−4
1000
≥0.01
20
0.89
0.93
1.28 × 10−5
5.07 × 10−4
1000
≥0.01
100
0.89
0.93
1.30 × 10−5
4.93 × 10−4
10000
< 0.001
1
0.52
0.91
7.44 × 10−2
1.75 × 100
10000
< 0.001
5
0.55
0.95
4.03 × 10−2
3.81 × 10−1
10000
< 0.001
10
0.56
0.89
4.92 × 10−2
2.17 × 10−1
10000
< 0.001
20
0.56
0.71
5.34 × 10−2
1.27 × 10−1
10000
< 0.001
100
0.54
0.29
7.19 × 10−2
3.87 × 10−2
10000
0.001 −0.01
1
0.88
0.93
4.36 × 10−4
4.92 × 10−3
10000
0.001 −0.01
5
0.88
0.93
4.34 × 10−4
4.86 × 10−3
10000
0.001 −0.01
10
0.89
0.93
4.22 × 10−4
4.77 × 10−3
10000
0.001 −0.01
20
0.88
0.93
3.92 × 10−4
4.63 × 10−3
10000
0.001 −0.01
100
0.89
0.96
3.56 × 10−4
3.86 × 10−3
10000
≥0.01
1
1.00
1.00
1.65 × 10−5
1.48 × 10−4
10000
≥0.01
5
1.00
1.00
1.65 × 10−5
1.48 × 10−4
10000
≥0.01
10
1.00
1.00
1.66 × 10−5
1.47 × 10−4
10000
≥0.01
20
1.00
1.00
1.67 × 10−5
1.47 × 10−4
10000
≥0.01
100
1.00
1.00
1.70 × 10−5
1.47 × 10−4

190
Table A.20: Posterior predictive checks for misspeciﬁed mutation rate. All quantities
with p-value < 0.01.
q
Set
X
p-value
xobs
(Xrep)0.5
3.0 × 10−6
19
ns
< 0.001
7
1
3.0 × 10−6
19
nh
< 0.001
17
12
3.0 × 10−6
20
nh
< 0.001
12
8
3.0 × 10−6
20
ns
0.002
5
1
3.0 × 10−6
43
nh
0.005
17
12
1.0 × 10−5
19
ns
0.005
7
2
1.0 × 10−5
19
nh
0.008
17
13
1.0 × 10−5
20
ns
0.008
5
1
1.5 × 10−5
19
ns
0.003
7
2
1.5 × 10−5
20
ns
0.005
5
1
1.5 × 10−5
42
D1A,2G
0.008
-0.00046
-0.000023
3.0 × 10−5
19
ns
< 0.001
7
2
6.0 × 10−5
19
ns
< 0.001
7
2
6.0 × 10−5
42
D1A,2G
0.005
-0.00046
-0.00001
9.0 × 10−5
19
ns
0.003
7
2
3.0 × 10−4
12
nh
< 0.001
8
13
3.0 × 10−4
19
Hu
< 0.001
0
7
3.0 × 10−4
19
ns
< 0.001
7
1
3.0 × 10−4
20
Hu
< 0.001
0
9
3.0 × 10−4
20
ns
< 0.001
5
1
3.0 × 10−4
27
nh
< 0.001
8
12
3.0 × 10−4
28
Hu
< 0.001
0
10
3.0 × 10−4
33
TCAT
< 0.001
9977
9950
3.0 × 10−4
48
Hu
0.002
0
6
3.0 × 10−4
2
Hu
0.003
0
7
3.0 × 10−4
4
nh
0.005
10
18
3.0 × 10−4
27
Hu
0.007
0
6
3.0 × 10−4
38
nh
0.007
10
14
3.0 × 10−4
33
nh
0.008
8
11
3.0 × 10−4
42
D1A,2G
0.008
-0.00046
-0.000017
Table A.21: Characteristics of simulated datasets. Cells give the total number of distinct
haplotypes at the dataset level across 21 simulated datasets of 10,000 haplotypes.
pmax(θ)
Haplotypes
< 0.01
184
≥0.01
29

191
Table A.22: Haplotype ﬁtness estimation using PEQuasi with either the composite hap-
lotype or diagonal method and QuasiFit. Parameters separated by estimability. Table
shows coverage of 80 and 95% credible intervals and rank correlation between true and
estimated ﬁtnesses. Mean and standard error across datasets also shown. 21 simulated
datasets of 10,000 haplotypes.
Coverage
Method
Type
80%
95%
Tau
PEQuasi-Composite
< 0.01-estble
0.7
0.91
0.68
PEQuasi-Diagonal
< 0.01-estble
0.67
0.89
0.68
QuasiFit
< 0.01-estble
0.77
0.9
0.65
PEQuasi-Composite
≥0.01-estble
0.69
0.97
0.96
PEQuasi-Diagonal
≥0.01-estble
0.24
0.41
0.81
QuasiFit
≥0.01-estble
0.21
0.28
0.79
PEQuasi-Composite
Dataset Mean (SE)
0.69 (0.19)
0.91 (0.08)
0.76 (0.16)
PEQuasi-Diagonal
Dataset Mean (SE)
0.61 (0.22)
0.83 (0.1)
0.76 (0.16)
QuasiFit
Dataset Mean (SE)
0.69 (0.12)
0.81 (0.09)
0.73 (0.17)
Table A.23: Characteristics of simulated datasets. Cells give the total number of dis-
tinct haplotypes at the dataset level across 44 simulated datasets of 10,000 haplotypes.
Separate counts are given by estimability class.
pmax(θ)
Haplotypes
< 0.001
288
0.001 −0.01
67
≥0.01
32
Table A.24: Haplotype ﬁtness estimation using PEQuasi with two diﬀerent values of αLD.
αLD > 1 ensures all sites are potentially interacting. Table shows Kendall’s Tau between
true and posterior median haplotype ﬁtness, median absolute deviation, coverage of 95%
credible intervals, and mean width of 95% credible interval averaged across haplotypes.
21 simulated datasets of 10,000 haplotypes.
αLD
pmax(θ)
Tau
MAD
Coverage
[θ]0.975 −[θ]0.025
0.1
< 0.001
0.54
2.75 × 10−2
0.92
1.73 × 10−1
> 1
< 0.001
0.52
2.78 × 10−2
0.96
1.89 × 10−1
0.1
0.001 −0.01
0.83
5.08 × 10−4
0.90
6.20 × 10−3
> 1
0.001 −0.01
0.83
5.30 × 10−4
0.93
6.18 × 10−3
0.1
≥0.01
0.96
2.69 × 10−6
0.91
7.41 × 10−5
> 1
≥0.01
0.96
3.30 × 10−6
0.91
7.39 × 10−5

192
Table A.25: Evidence of lack of ﬁt from unnormalized linkage disequilibrium posterior
predictive p-values when αLD = 0.1. Table shows all statistics with two-sided posterior
predictive p-value less than 0.05.
Set
X
p-value
xobs
(Xrep)0.5
Saturated
5
D2G,3G
0.038
-0.00019
0.00000086
no
14
D1T,2C
0.042
0.00016
0
yes
21
D2C,4C
0.033
-0.0003
0.00000002
no
22
D3T,4A
0.045
-0.00025
-0.0000081
no
32
D1A,3G
0.038
0.000095
-0.0000039
no
36
D1C,4G
0.043
-0.00029
-0.000019
no
36
D3A,4G
0.008
-0.00051
-0.000018
no
39
D2C,4A
0.047
0.000094
-0.000005
no
42
D1A,2G
0.008
-0.00046
-0.000015
no
48
D1T,3G
0.048
0.000093
-0.0000045
no
49
D2A,4A
0.022
-0.00029
-0.0000025
no

193
APPENDIX B.
VIRUS-ANTIBODY LOTKA-VOLTERRA
SUPPLEMENTARY METHODS AND RESULTS
B.1
Starting values
The starting values of β and φA were obtained through maximum likelihood estima-
tion from a multivariate normal distribution with mean ˜µa, variance-covariance matrix
˜Σa(φA), and data log ˜Ai(tk) from Eq. (4.14). We set
˜µa = X′
aβ.
Let ˜Σaik,jl(φA) be the element of ˜Σa(φA) corresponding to the covariance between
log ˜ai(tk) and log ˜aj(tl). We set
˜Σaik,jl =















Na(tk)+φA
(1+φA)Na(tk)

1
˜pAi(tk) −1

i = j, k = l
−
Na(tk)+φA
(1+φA)Na(tk)
i ̸= j, k = l
0
otherwise
This equation is derived using the delta method to approximate the variance-covariance
matrix of log ai(tk)/Na(tk) with ˜pAi(tk) in place of the unknown pAi(tk). For ﬁxed φA,
β =

X′
a ˜Σa(φA)−1Xa
−1
X′
a ˜Σa(φA)−1 log ˜Ai(tk)

194
maximizes the multivariate normal likelihood. Therefore, we can maximize the likelihood
by proﬁling in φA.
Conditional on our starting value βstart of β, we determine starting values of γ, φV
and σL through maximum likelihood estimation from a multivariate normal distribution
with mean ˜µv, variance-covariance matrix ˜Σv(φv, σL), and data log ˜Vj(tk) from Eq. (4.13).
We set
˜µv = Xvγ.
Let ˜Σvik,jl(φV , σL) be the element of ˜Σv(φV , σL) corresponding to the covariance between
log ˜Vi(tk), log ˜Vj(tl). We set
˜Σvik,jl = Cov(log vi(tk), log vj(tl)) =















Nv(tk)+φV
(1+φV )Nv(tk)

1
˜pVi(tk) −1

+ σ2
L
i = j, k = l
−
Nv(tk)+φV
(1+φV )Nv(tk) + σ2
L
i ̸= j, k = l
0
otherwise
This equation is derived using the delta method to approximate the variance-covariance
matrix of log (vj(tk)/Nv(tk)) and the relationship between the log normal and normal
distribution to obtain the variance of log L(t). From this we compute an approximate
variance-covariance matrix of log (vj(tk)/Nv(tk)) + log L(tk) with ˜pVj(tk) in place of the
unknown pVj(tk). Similar to our approach for ﬁnding βstart and φAstart, we proﬁle in φV
and σ2
L to obtain γstart, φV start and σ2
Lstart.
B.2
Processing CAP256 NGS datasets
The antibody dataset was originally collected and analyzed by Doria Rose et al.
[107]. 454 reads from heavy chain variable regions at seven time points (SRR1057693,

195
SRR1057695, SRR1057699, SRR1057701, SRR1057703, SRR1057705, and SRR1057707)
were downloaded from SRA using sratoolkit.2.8.1-3-ubuntu64 utilities prefetch
and fastq-dump with default settings. Reads from weeks 34, 69, and 176 were omitted
because of diﬀerences in sequencing methodology. In particular, week 176 reads were
sequenced using primers for all VH families rather than only VH3 [107] and week 34 and
69 reads were only available using paired VH : VL sequencing.
We removed reads less than 300 nucleotides or greater than 600 nucleotides, as this
was done in the original dataset analysis [107].
Most (87%) of reads were retained.
These reads were written to a single fastq ﬁle, aligned, and assigned V and J genes
using mixcr-2.0 [119]. Most (96.96%) of the reads were successfully aligned. 0.01%
failed because of no hits, 0.01% failed because of low alignment score, and 3.03% failed
because lack of J-chain hits. We discarded an additional 66 reads not assigned to IGH
(less than 0.01% of total reads). The remaining reads will provide the total antibody
read count for each time point. Otherwise, subsequent analysis will involve only those
heavy chain reads assigned V gene VH3-30 and J gene JH3 as these are the genes in the
CAP256-VRC26 lineage. There are 55,252 such reads.
Doria-Rose et al. [107] assigned germline genes using BLAST, then selected reads
with V and J genes matching CAP256-VRC26 with similar levels of germline divergence
for further analysis. These reads were clustered at 97.25% sequence identity using CD-
HIT [137].
Lineage members were identiﬁed by phylogenetic analysis of the earliest
representatives from each cluster.
They deposited all unique reconstructed antibody
sequences in GenBank (GenBank Accession KJ33708-KJ34387). In all there were 680
unique heavy chain sequences.
The function nwhamming from the dada2 R package [120] was used to compute the
Hamming distance between each unique read with matching V and J gene to each known
CAP256-VRC26 heavy chain sequence. This function performs pairwise alignment using
the Needleman-Wunsch algorithm and then computes a Hamming distance between the

196
aligned sequences along their overlap. A read was considered to belong to the CAP256
lineage if at least one distance was less than 24. The cutoﬀvalue was chosen because of
the original authors’ choice of a 97.25% similarity clustering threshold and the average
read length.
Additionally, a threshold near this value is supported by the bimodal
distribution of these distances (Figure B.1).
In agreement with Doria-Rose et al., we do not detect any lineage members until Week
38. Although our lineage member counts at other time points do not precisely match
those of Bhiman et al., they are highly correlated (R2 =0.93).
Translated CAP256-
VRC26 sequences were aligned to the CAP256-VRC26 UCA sequence (GenBank Acces-
sion KJ134860) using the Needleman-Wunsch algorithm with the BLOSUM50 scoring
matrix using the function pairwiseAlignment in the Biostrings R package [138].
The virus dataset was originally collected and analyzed by Bhiman et al. [26]. Il-
lumina MiSeq 2 × 300 paired end reads from 28 time points were downloaded from
SRA (SRR2241766-88 and SRR2441790-94) using sratoolkit.2.7.0-ubuntu64 utilities
prefetch and fastq-dump. Except for using the --split-files option in fastq-dump
to create separate ﬁles for forward and reverse reads, we used default settings.
Bhiman et al. used a random 9mer tag to label each cDNA molecule. The goal of
the tagging approach is to separate sequencing errors from biological variation. Reads
sharing a tag should come from a single cDNA molecule, so ideally any variation is due
to sequencing error. The original authors generated error corrected consensus sequences
from reads sharing a tag, and we tried to perform a similar analysis. We found reverse
reads sharing a tag were much more similar on average than reverse reads with diﬀerent
tags, as expected. However, forward reads paired with reverse reads sharing a tag were
barely more similar on average than those not sharing a tag, suggesting that the tag
does not actually correspond to a unique biological sequence for forward reads. The
likely explanation is rampant recombination during library prep, and additional analysis

197
0
1000
2000
3000
4000
5000
0
50
100
Hamming Distance to closest CAP256−VRC26
count
Figure B.1: Histogram of the Hamming distance of reads with matching V and J genes
to the closest CAP256-VRC26 sequence in GenBank. The ﬁrst mode is likely CAP256-
VRC26 derived, while the second mode is likely antibodies from other lineages with the
same V and J genes as CAP256-VRC26.

198
G
G
G
G
G G G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GGG
G
GG
G
0
50
100
150
200
0.00
0.02
0.04
0.06
0.08
Week
Proportion of denoised sample discarded
G
G
GGG G G G
G
G
G
G
G
G
G
G
G
G
G
G
G
GGGG GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
20000
40000
60000
80000
100000
120000
140000
Sequencing depth
Figure
B.2:
Proportion
of
denoised
sample
discarded
and
sequencing
depth.
Black=Proportion discarded due to stop codons.
Red=Proportion discarded due to
not aligning with HIV-1. Blue=Sequencing depth.

199
is consistent with this explanation (data not shown). We elected to use an alternative
error correction approach.
Reads were error-corrected using the R package dada2 [120]. The pipeline consisted
of three steps: quality ﬁltering and trimming using fastqFilter, dereplication using
derepFastq, and clustering using dada. We only analyzed forward reads as these con-
tained the V1V2 region.
Using the dada2 package requires all reads to be of the same length, so fastqFilter
truncates reads to the same length and discards any reads that are too short. We set this
length to 294 to balance retaining reads and covering the V1V2 region. The length of this
region is variable because of the large number of indel variants. Additionally, we clipped
42 bases from the beginning of each read (3 random nucleotides + 27 primer nucleotides
+ 12 initial residues not part of V1V2). We set the parameter maxEE to 2. This removes
any read with more than two expected errors based on quality scores. We also discarded
any read containing an N base. derepFastq was used with its default settings. dada
was used with options selfConsist and pool. Option selfConsist iterates between
inferring clusters and error rate estimation until convergence. Option pool pools data
for all samples, so information from multiple samples is used when determining whether
or not a given sequence can be explained by sequencing error. This greatly increases the
number of haplotypes detected in each sample.
dada2 output count vectors of error corrected nucleotide sequences at each time point.
Nucleotide sequences were translated. Excluding sequences with stop codons, there were
905 unique amino acid sequences. We performed a blastp search in GenBank restricted
to HIV-1 sequences (txid11676) but otherwise using default parameters on all unique
amino acid sequences in the sample. Twenty sequences were not found to have signiﬁcant
similarity to HIV-1. The corresponding nucleotide sequences also did not have signiﬁcant
similarity. Figure B.2 shows the proportion of the denoised sample discarded at each time
point due to containing stop codons and to not aligning to HIV-1. In most cases, less

200
than 1% of the sample was aﬀected, but there are a few samples with larger values.
After ﬁltering amino acid sequences not aligning to HIV-1, there remained 885 clusters.
A multiple sequence alignment of these sequences was produced in mafft v7.123b using
default settings. Five sequences did not align with the rest. We veriﬁed they aligned to
C2-V3 rather than V1V2, so they were removed.
B.3
Identiﬁability
In this appendix, we give conditions for identiﬁability of the antibody spline model
and sketch a proof. Let
γ =


log V (0)′
r′
−B


.
The likelihood from §4.2.4 is
p(a, v, l|β, γ, φA, φV , σL) =
Y
k∈Tl
log −norm(l(tk); log µL(β, γ), σL)
Y
k∈Tv
Diri −Mult(v(tk); Nv(tk), αV (tk; β, γ, φV ))
Y
k∈Ta
Diri −Mult(a(ta); Na(tk), αA(tk; β, φA)).
The notation αA(tk; β, φA), αV (tk; β, γ, φV ) and µL(β, γ) emphasizes the depen-
dence of these quantities on model parameters. We will say the model is identiﬁable
if
p(S|β1, γ1, φA1, φV 1, σV L1) = p(S|β2, γ2, φA2, φV 2, σV L2)
for all subsets S of R|Tl| × N(na+1)|Ta|+nv|Tv| with positive probability implies
(β1, γ1, φA1, φV 1, σV L1) = (β2, γ2, φA2, φV 2, σV L2).

201
This will not by itself imply a unique maximizer of the likelihood function for particular
observation vectors, but it is a desirable property.
Assume
1. Antibody design matrix Xa from Eq. (4.11) is full column rank.
2. Xc(β1) and Xl(β1) are full column rank, where Xc(β1) is the set of rows of Xv
from Eq. (4.12) corresponding to times in Tv and Xl(β1) is the set of rows of Xv
corresponding to times in Tl.
3. Nv(tk) > 1 ∀k ∈Tv, and
4. Na(tk) > 1 ∀k ∈Ta.
Then we claim the identiﬁability condition holds. Note condition (2) depends on β1,
which is not very desirable. Unfortunately, there are some β1 for which this does not hold.
For example, let β(i) be the elements of β corresponding to antibody i. If β(i)
1 = β(k)
1
for
some k ̸= i or if β(i)
1 = k1 for some k ∈R, this will not hold.
The Dirichlet-multinomial distribution is identiﬁable for n > 1 [139], where n is the
sum of the count vector. Also, the log normal distribution is identiﬁable in the standard
parameterization we use here. l, v and a are independent conditional on the parameter
values. Therefore,
p(S|β1, γ1, φA1, φV 1, σL1) = p(S|β2, γ2, φA2, φV 2, σL2)
for all subsets S with positive probability combined with the 1-1 maps between
(pA(β)′, φA)′ and αA(βA, φA) and between (pV (β)′, φV )′ and αV (β, γ, φV ) implies
φA1 = φA2
φV 1 = φV 2

202
σL1 = σL2
µL(β1, γ1) = µL(β2, γ2)
(B.1)
pA(β1) = pA(β2)
(B.2)
pV (β1, γ1) = pV (β2, γ2).
(B.3)
There is a 1-1 map between Xaβ and pa(β). Let x′
a,i,k be the row of Xa corresponding
to log Ai(tk). By our constraint An+1(t) = CAB = 1, Eq. (4.10) and Eq. (4.11),
pAi(tk; β) =
ex′
a,i,kβ
1 + Pna
j=1 ex′
a,j,kβ
x′
a,i,kβ = log
pAi(tk; β)
1 −Pna
j=1 pAj(tk; β).
So Eq. (B.2) implies
Xaβ1 = Xaβ2.
If Xa is full column rank, then β1 = β2.
Also, let xv,k(β) be the row of Xv(β) corresponding to time k in Tv.
exv,k(β1)′γ1i
Pnv
j=1 exv,k(β1)′γ1j =
exv,k(β1)′γ2i
Pnv
j=1 exv,k(β1)′γ2j ∀i = 1, . . . , nv k ∈Tv
(B.4)
where γj is column j of γ by Eq. (B.3).
xv,k(β1)′γ1i −xv,k(β1)′γ2i = log exv,k(β1)′γ1i
exv,k(β1)′γ2i = log
Pnv
j=1 exv,k(β1)′γ1j
Pnv
j=1 exv,k(β1)′γ2j ≡bk ∀k ∈Tv

203
The second equality is by Eq. (B.4). Note bk does not depend on i. Also note bk is the
diﬀerence of log viral load vectors produced by parameter vectors 1 and 2 at time tk,
k ∈Tv. Then,
Xc(β1)(γ1i −γ2i) = b ∀i
(B.5)
Because Xc(β1) has full column rank by assumption, there is at most one value c of
γ1i −γ2i satisfying Eq. (B.5) that does not depend on i. From Eq. (B.1)
nv
X
i=1
exv,l(β1)′γi1 =
nv
X
i=1
exv,l(β1)′γi2 =
nv
X
i=1
exv,l(β1)′(γi1−c) = e−xv,l(β1)′c
nv
X
i=1
exv,l(β1)′γi1 ∀l ∈Tl.
Then
Xl(β1)c = 0.
If Xl(β1) is full column rank, then c = 0 i.e. γi1 = γi2 for all i.
B.4
Additional ﬁgures

204
GGGGGG
G
G
G
G
GGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGG
G
G
G
G
G
G
G
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
G
G
GGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GG
G
G
G
G
G
G G
G
GG
G
G
G GG G
G
G GG G
G
G
G
G
G
G
G
G
G
G
G G
G G
G
GG
G
G
G GG
G
G
GG
G
G
G G
G G
G
GG
G
G
G GG
G
G GG G
G
GG
G
G
G
G
G
G G
G
GG
G
G
G GG G
G
G GG G
G
G
G
G
G
G
G
G
G
G
G G
G G
G
GG
G
G
G GG
G
G
GG
G
G
G G
G G
G
GG
G
G
G GG
G
G GG G
G
GGGGGGG
G
G
GGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GG
G
G
G
G
G
G G
G
GG
G
G
G GG G
G
G GG G
G
G
G
G
G
G
G
G
G
G
G G
G G
G
GG
G
G
G GG
G
G GG
G
G
G
G
G G
G
GG
G
G
G
GG
G
G GG G
G
GG
G
G
G
G
G
G G
G
GG
G
G
G GG G
G
G GG G
G
G
G
G
G
G
G
G
G
G
G G
G G
G
GG
G
G
G GG
G
G GG
G
G
G
G
G G
G
GG
G
G
G
GG
G
G GG G
G
pA1
pA2
0
5
10
15
0
5
10
15
0.000
0.002
0.004
0.006
Time
pA
Type
G
G
Truth
Median
GGGGGGG
GGGGG
G
G
GG
G
GGGGGG
GGGGG
G
G
G GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G GGGG
G
GGGG
GGGGGG
G G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGG
G
G
GG
G
GGGGGG
GGGGG
G
G
G GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G GGGG
G
GGGG
GGGGGG
G G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GG
G
G
G
G
G
GG
G
GG
G
G GGGG
G GGGG
G
G
G
G
G
G
G
G
G
G
GG
GG
G
GG
G
G GGG
G GGGG
G GG
GG
G
GG
G
G GGG
G GGGG
G
GG
G
G
G
G
G
GG
G
GG
G
G GGGG
G GGGG
G
G
G
G
G
G
G
G
G
G
GG
GG
G
GG
G
G GGG
G GGGG
G GG
GG
G
GG
G
G GGG
G GGGG
G
GGGGGGG
GGGGG
G
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGG
G
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GG
G
G
G
G
G
GG
G
GG
G
G
G
GG
G
G
GGG
G
G
G
G
G
G
G
G
G
G
G
GG
GG
G
GG
G
G GGG
G GGGG
G GG
GG
G
GG
G
G
GGG
G
G
GGG
G
GG
G
G
G
G
G
GG
G
GG
G
G
G
GG
G
G
GGG
G
G
G
G
G
G
G
G
G
G
G
GG
GG
G
GG
G
G GGG
G GGGG
G GG
GG
G
GG
G
G
GGG
G
G
GGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GG
G
G
G
G
G
GG
G
GG
G
G
G
GG
G
G
GGG
G
G
G
G
G
G
G
G
G
G
G GG
GG
G
GG
G
G GGG
G GGGG
G GG
GG
G
GG
G
G
GGG
G
G
GGG
G
GG
G
G
G
G
G
GG
G
GG
G
G
G
GG
G
G
GGG
G
G
G
G
G
G
G
G
G
G
G GG
GG
G
GG
G
G GGG
G GGGG
G GG
GG
G
GG
G
G
GGG
G
G
GGG
G
pV1
pV2
pV3
0
5
10
15
0
5
10
15
0
5
10
15
0.00
0.25
0.50
0.75
1.00
Time
pV
Type
G
G
Truth
Median
G
G
G
GGGG
GG
G
G
G
G
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
G
GGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
G
G
G
GGGG
G
G
G
G
G
G
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
G
GGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
G
GGGGG
G
GGGGGGG
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GG
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
GG
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
GG
G
G
GG
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
GG
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
GG
G
G
0.01
1.00
0
5
10
15
Time
log L
Type
G
G
Truth
Median
Figure B.3: Randomly chosen ﬁtted trajectory for Simulation Condition Q. Blue: pos-
terior median, Red: Truth, Black: data, shaded: trajectory 95% credible interval.

205
GGGGGGG
GGG
G
G
G
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
G
G
G
G
G
G
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
GGGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGG
G
G
G
G
G
G
G
GGG
G
GGG
G
GGGG
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
GG
GG
G
GGGG
G
GGG
G
G
G
G
G
G
G
GGG
G
GGG
G
GGGG
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
GG
GG
G
GGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
G
GGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
G
GGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
G
GG
G
G
G
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGG
G
GG
G
G
G
G
G
GG
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
GG
G
G
G
G
G
GGG
G
G
GGG
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
GG
G
G
GGG
G
GG
G
G
G
G
G
GG
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
GG
G
G
G
G
G
GGG
G
G
GGG
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
GG
G
G
pA1
pA2
0
5
10
15
0
5
10
15
0.000
0.002
0.004
Time
pA
Type
G
G
Truth
Median
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G GGGG
G
GGGG
GGGGGG
G G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G GGGGGGG
GGG
G
GGG
G GGGGGGG
G
G
GGGGGG
G GGGG
G
GGGG
GGGGGG
G G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GGG
G
GG
G
G
G
G
GGG
G
GGG
G GGGG
G
GGG
G
G
G
G
G
G
G
GG
GG
G
GG
G GGGG
G GGGG
G
GG
GG
G
GGG
G GGGG
G GGGG
G
GGG
G
GG
G
G
G
G
GGG
G
GGG
G GGGG
G
GGG
G
G
G
G
G
G
G
GG
GG
G
GG
G GGGG
G GGGG
G
GG
GG
G
GGG
G GGGG
G GGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
G
G
G
G
G
G
G
G
G
G
G
GGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
G
G
G
G
G
G
G
G
G
G
G
GGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGG
G
GG
G
G
G
G
G
GG
G
GGG
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
GG
GG
G
GG
G GGGG
G GGGG
G
GG
GG
G
G
G
G
G
GG
GG
G
G
GGG
G
GGG
G
GG
G
G
G
G
G
GG
G
GGG
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
GG
GG
G
GG
G GGGG
G GGGG
G
GG
GG
G
G
G
G
G
GG
GG
G
G
GGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
G
G
G
G
G
G
G
G
G
G
G
GGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
G
G
G
G
G
G
G
G
G
G
G
GGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G GGGGGGGG
GGGGGG
G GGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGG
G
GG
G
G
G
G
G
GG
G
GGG
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
GG
GG
G
GG
G GGGG
G GGGG
G
GG
GG
G
G
G
G
G
GG
GG
G
G
GGG
G
GGG
G
GG
G
G
G
G
G
GG
G
GGG
G
G
GG
G
G
G
GG
G
G
G
G
G
G
G
GG
GG
G
GG
G GGGG
G GGGG
G
GG
GG
G
G
G
G
G
GG
GG
G
G
GGG
G
pV1
pV2
pV3
0
5
10
15
0
5
10
15
0
5
10
15
0.00
0.25
0.50
0.75
1.00
Time
pV
Type
G
G
Truth
Median
GGGGGGG
G
GGGG
G
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
G
GGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GG
G
GGGGGG
GGGGG
G
G
G
GGGGGGG
GGG
G
GGG
G
GGGGGGG
G
G
GGGGGG
G
GGGG
G
GGGG
G
GGGGG
G
G
G
GGGGGG
GGGGG
G
GG
G
G
G
G
GGGGG
G
GGGGGGGG
G
GGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GG
G
G
G
GGG
G
GGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GGGGGGGG
GGGGGG
G
GG
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
GG
G
G
G G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
GG
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
GG
G
G
G G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
G
G
G
G
G
G
G
G
G
GG
G
G
G
GG
G
G
1e−02
1e+00
1e+02
0
5
10
15
Time
log L
Type
G
G
Truth
Median
Figure B.4: Randomly chosen ﬁtted trajectory for Simulation Condition L. Blue: poste-
rior median, Red: Truth, Black: data, shaded: trajectory 95% credible interval.

206
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
G
BXZ
φA
φV
σVL
BCS
BXS
BCK
BXK
BCZ
rS
rK
rZ
BCR
BXR
 log VR(0)
 log VS(0)
 log VK(0)
 log VZ(0)
rR
1
2
1
2
1
2
1
2
1
2
−0.075
−0.050
−0.025
0.000
0.025
−2000
−1000
0
1000
2000
−7500
−5000
−2500
0
2500
7
8
9
10
11
−10000
−5000
0
5000
−4000
−2000
0
2000
4000
0.5
0.6
0.7
0.8
0.9
4
6
8
10
−0.10
−0.05
0.00
0.05
−10000
0
10000
20000
20
30
−2
0
2
4
6
−0.15
−0.10
−0.05
0.00
0.05
0.10
−2000
0
2000
4000
200
300
400
500
13
14
15
0.0
0.1
0.2
0.3
0
5000
10000
−1000
0
1000
Mode
Posterior median and 95% credible interval
Figure B.5: Posterior median and 95% credible intervals for each parameter from two
diﬀerent modes. Viruses labeled by their position 166 amino acid. Z is all amino acids
other than R,S,K. Antibodies labeled according to whether they possess a double cysteine
(C) or not (X).

