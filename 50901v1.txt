 
 
 
  
1 
A GENETIC, GENOMIC, AND COMPUTATIONAL RESOURCE FOR EXPLORING 
2 
NEURAL CIRCUIT FUNCTION 
3 
 
4 
 
5 
Fred P. Davis1,2,^,X*, Aljoscha Nern1*, Serge Picard1, Michael B. Reiser1, Gerald M. Rubin1, 
6 
Sean R. Eddy1,3, Gilbert L. Henry1,4,X 
7 
 
8 
 
9 
1. Janelia Research Campus, Howard Hughes Medical Institute, Ashburn, VA 20147, USA 
10 
 
11 
2. Molecular Immunology and Inflammation Branch, National Institute of Arthritis and 
12 
Musculoskeletal and Skin Diseases, National Institutes of Health, Bethesda, MD 20892, USA 
13 
 
14 
3. Howard Hughes Medical Institute and Department of Molecular and Cellular Biology, Harvard 
15 
University, Cambridge, MA 02138, USA. John A. Paulson School of Engineering and Applied 
16 
Sciences, Harvard University, Cambridge, MA 02138, USA 
17 
 
18 
4. Cold Spring Harbor Laboratory, Cold Spring Harbor, NY 11724, USA 
19 
 
20 
^ Present address: Celsius Therapeutics, Cambridge, MA 02139, USA. 
21 
 
22 
* Contributed equally. 
23 
x Correspondence: fredpdavis@gmail.com (FPD), henry@cshl.edu (GLH) 
24 
 
 
25 

 
 
 
Page 2 of 83 
2019 Dec 27 
ABSTRACT: The anatomy of many neural circuits is being characterized with increasing 
26 
resolution, but their molecular properties remain mostly unknown. Here, we characterize gene 
27 
expression patterns in distinct neural cell types of the Drosophila visual system using genetic 
28 
lines to access individual cell types, the TAPIN-seq method to measure their transcriptomes, 
29 
and a probabilistic method to interpret these measurements. We used these tools to build a 
30 
resource of high-resolution transcriptomes for 100 driver lines covering 67 cell types, available 
31 
at http://www.opticlobe.com. Combining these transcriptomes with recently reported 
32 
connectomes helps characterize how information is transmitted and processed across a range 
33 
of scales, from individual synapses to circuit pathways. We describe examples that include 
34 
identifying neurotransmitters, including cases of apparent co-release, generating functional 
35 
hypotheses based on receptor expression, as well as identifying strong commonalities between 
36 
different cell types. 
37 
 
38 
KEYWORDS: neural circuit, gene expression, visual system 
39 
 
 
40 

 
 
 
Page 3 of 83 
2019 Dec 27 
INTRODUCTION 
41 
The anatomy of neural circuits is being characterized with increasing resolution and throughput, 
42 
in part following a dramatic increase in the size of circuits amenable to detailed electron 
43 
microscopy reconstruction (Swanson and Lichtman, 2016) and the development of genetic tools 
44 
to access individual cell types (Luo et al., 2018). These efforts reveal anatomy at unprecedented 
45 
detail, but not the molecular properties of cells. In principle, the genes expressed in each cell of 
46 
a neural circuit should serve as a molecular proxy for cell physiology. However, most genomic 
47 
efforts have focused on surveying neuronal diversity rather than characterizing circuit function 
48 
(Ecker et al., 2017). To develop a resource exploring molecular correlates of circuit function, 
49 
here we use an approach that genetically targets cell types within a well-characterized brain 
50 
region to measure high-quality transcriptomes that can be integrated with connectomes. 
51 
 
52 
Drosophila affords an ideal system to study neural circuits in detail, as both excellent genetic 
53 
tools and high resolution connectomes are available. Here we focus on the repeating columnar 
54 
circuits of the visual system, found in the optic lobes, a widely used model for studying circuit 
55 
development and function with an extensive genetic toolbox and well-described anatomy 
56 
(Figure 1A; Neriec and Desplan, 2016. Silies et al., 2014. Apitz and Salecker 2014). This 
57 
network begins with photoreceptor neurons and contains several layers of connected neurons 
58 
which process incoming luminance signals into multiple parallel streams of visual information 
59 
(Figure 1B). Many of its cellular components have been described by light microscopy, 
60 
including classical Golgi studies (Fischbach and Dittrich, 1989) and recent analyses using 
61 
genetic methods (Morante and Desplan, 2008. Otsuna and Ito, 2006. Nern et al., 2015. Wu et 
62 
al, 2016). Electron microscopy reconstruction work has characterized the synaptic connections 
63 
of many optic lobe neurons (Meinertzhagen and O’Neil, 1991; Meinertzhagen and Sorra, 2001; 
64 
Rivera-Alba et al., 2011, Takemura et al., 2013; 2015; 2017; Shinomiya et al., 2019). 
65 

 
 
 
Page 4 of 83 
2019 Dec 27 
Comparative studies have also explored the evolution of this ancient brain structure (Strausfeld, 
66 
2009). Despite this wealth of information, many of its fundamental properties remain unknown, 
67 
including the neurotransmitters used at many of its synapses. 
68 
 
69 
Measuring the genes expressed in specific cells of the brain is challenging due to its compact 
70 
and complex organization. RNA sequencing (RNA-seq) addresses this challenge by profiling 
71 
either single cells or genetically labeled populations of cells (Ecker et al., 2017). The latter 
72 
approach requires genetic tools to access individual cell types but provides more direct access 
73 
to cells of interests than sampling of unmarked single cells, especially for sparse cell types. 
74 
Profiling identified cell types provides a direct link to previous work on the anatomy and 
75 
physiology of those cell types. Cell type-specific drivers also facilitate follow-up experiments, for 
76 
example evaluating the role of individual genes in individual cells. In Drosophila, large 
77 
collections of GAL4 driver lines (Jenett et al., 2012; Tirian and Dickson, 2017) and the possibility 
78 
to further refine these patterns with intersectional methods such as split-GAL4 (Luan et al., 
79 
2006; Dionne et al., 2018) enable genetic access to many neuronal populations (see, for 
80 
example, Tuthill et al., 2013; Aso et al., 2014; Wu et al., 2016). We therefore chose the genetic, 
81 
rather than single cell, approach to build a genomics resource to explore circuit function. 
82 
 
83 
We previously developed an Isolation of Nuclei Tagged in a specific Cell Type (INTACT) 
84 
method (Deal and Henikoff, 2010) to measure transcriptomes and epigenomes of genetically-
85 
marked neuronal populations in Drosophila (Henry et al., 2012) and mouse (Mo et al., 2015). 
86 
Here, we develop a tandem affinity purification of INTACT nuclei (TAPIN) method with 
87 
increased specificity, sensitivity, and throughput. By combining this method with an extensive 
88 
set of new driver lines with predominant expression in specific cell types and a new probabilistic 
89 
method to interpret transcript abundance, we build a resource of high-quality transcriptomes for 
90 

 
 
 
Page 5 of 83 
2019 Dec 27 
one hundred driver lines. We selected drivers that expressed in cell types constituting the 
91 
lamina (Fischbach and Dittrich 1989; Tuthill et al., 2013; Edwards et al., 2012) as well as the 
92 
major cell types of the circuits that compute the direction of visual motion (Mauss et al., 2017) 
93 
(Figure 1C). We further included neuronal populations in two central brain regions, the 
94 
mushroom body and central complex, primarily to serve as informative outgroups. 
95 
 
96 
By profiling these driver lines, we develop an expression catalog for 67 Drosophila cell types as 
97 
well as several broader cell populations. Through validation experiments and comparisons to 
98 
the literature we demonstrate that this resource is useful both for identifying individual genes 
99 
expressed in specific cell types and for revealing broader patterns such as the expression of all 
100 
members of a gene family across many cell types. As an example, we describe the expression 
101 
of neurotransmitters and their receptors and use this information to interpret synaptic 
102 
connectivity. For example, we unexpectedly found that the R8 photoreceptors express 
103 
acetylcholine in addition to histamine and show that this apparent co-transmitter phenotype is 
104 
further supported by differential expression of neurotransmitter receptors in R8 postsynaptic 
105 
partners. Our results demonstrate that combining expression and connectomes leads to specific 
106 
testable hypotheses about circuit mechanisms that are inaccessible to either approach alone. 
107 
 
108 
RESULTS 
109 
 
110 
Genetic tools for labeling the visual system 
111 
To enable transcriptome analyses of defined cell populations, we first assembled a collection of 
112 
genetic drivers to access them. For this study, we combined drivers from existing collections for 
113 
cell types in the lamina (Tuthill 2013), the mushroom body (Aso et al., 2014), and the lobula (Wu 
114 
et al 2016) with new driver lines for many additional optic lobe cell types and also some neurons 
115 

 
 
 
Page 6 of 83 
2019 Dec 27 
of the central complex (Wolff et al., 2018, T. Wolff, personal communication). Nearly all of these 
116 
drivers were generated using an intersectional method, split-GAL4, to refine expression patterns 
117 
of GAL4 driver lines. To characterize new driver lines, we imaged expression patterns across 
118 
the entire fly brain to determine overall driver specificity (Figure 1D, Figure 1 - Supplemental 
119 
1) and examined anatomical features such as layer patterns in higher resolution images to 
120 
identify specific cell types (Table S1, Figure 1 - Supplemental 2). For most lines, we further 
121 
confirmed the identity of labeled cells by examining the morphology of individual cells using 
122 
stochastic labeling (Figure 1 - Supplemental 2). Although we noted that a few patterns also 
123 
include some additional contaminating cells (Table S1), these driver lines are the most specific 
124 
tools currently available to access individual cell types in the optic lobe. 
125 
 
126 
Purifying nuclei with TAPIN 
127 
Next, we employed an improved INTACT method to measure nuclear transcriptomes in 
128 
genetically defined cell populations (Henry et al., 2012), and we also developed a new variant of 
129 
the method that permits higher throughput with increased purity and sensitivity. In both 
130 
approaches, nuclei are purified using a nuclear tag whose expression is driven in a cell 
131 
population of interest by either a standard or split GAL4 driver (Figure 2A). The new variant 
132 
protocol, tandem affinity purification of INTACT nuclei (TAPIN), uses a bacterial protease (IdeZ) 
133 
to specifically cleave antibodies in the hinge region separating their Fc and antigen binding 
134 
F(ab’)2 fragments (Figure 2B, Figure 2 - Supplemental 1B). Treating protein A magnetic bead-
135 
bound nuclei with this protease generates both nucleus-F(ab’)2 and bead-Fc complexes. Soluble 
136 
nucleus-F(ab’)2 is then recaptured on protein G magnetic beads, removing non-specifically 
137 
bound material from the first capture. INTACT successfully profiled many of the abundant cell 
138 
types in the optic lobe (> 1000 cells per brain), but failed for sparser cell types and those whose 
139 

 
 
 
Page 7 of 83 
2019 Dec 27 
nuclei were difficult to purify by differential centrifugation (photoreceptors, glia, T4, T5). We 
140 
solved these problems with TAPIN, which does not purify nuclei prior to bead capture.  
141 
 
142 
The greatest advantage of TAPIN is its ability to purify nuclei from sparse cell types (< 50 
143 
cells/brain) (Table S1). INTACT is not suitable for these lines because of loss during differential 
144 
centrifugation. This difficulty cannot be overcome by processing more brains per experiment 
145 
because differential centrifugation is difficult to scale. TAPIN solves this problem by running a 
146 
first capture on crude extracts generated from hundreds to thousands of fly heads. The 
147 
substantial background in this first capture is reduced 5- to 6- fold in a second capture with only 
148 
a modest decline in both the yield of nuclei and amplified cDNA (Figure 2C).  
149 
 
150 
Measuring transcriptomes with INTACT- and TAPIN-seq 
151 
We applied INTACT and TAPIN to the cell populations defined by the genetic drivers we 
152 
described above (Table S2). Most drivers express in a single anatomically defined cell type or a 
153 
small group of related cell types. We note that a few of our cell types are strictly groups of 
154 
related cell types (for example, the muscle cells or, at a different level of a cell type hierarchy, 
155 
the T4 and T5 cells, with four subtypes each). Additional drivers target more heterogeneous cell 
156 
populations sharing a common property (e.g., driver lines aimed at recapitulating the expression 
157 
of a neurotransmitter marker). Altogether, we built 250 RNA-seq libraries from 242 samples of 
158 
purified nuclei (46 using INTACT and 196 using TAPIN) and 8 manually dissected samples 
159 
(Table S2). We estimated relative transcript abundance in each library using kallisto (Bray et al., 
160 
2015). Libraries built from more nuclei yielded more cDNA (Figure 2D), allowed more genes to 
161 
be detected (Figure 2E), had more estimated transcripts (Figure 2 - Supplemental 1C), more 
162 
reproducible transcript abundance (Figure 2F), and less bias in coverage across gene bodies 
163 
(Figure 2 - Supplemental 1D,E). We focused on 203 libraries that had at least 8,500 genes 
164 

 
 
 
Page 8 of 83 
2019 Dec 27 
detected, 3�g cDNA yield, and 0.85 Pearson’s correlation of transcript abundances in two 
165 
biological replicates. These 203 libraries consist of at least two biological replicates built from 
166 
100 drivers that covered 67 cell types (53 visual system, 7 mushroom body, 5 central complex, 
167 
2 muscle), 6 broader cell populations (ChAT, Gad1, VGlut, Kdm2, Crz, and NPF), and 2 
168 
manually dissected tissues (the lamina and remainder of the optic lobe) (METHODS). We 
169 
provide the read and abundance data for the remaining sub-optimal libraries (47 libraries 
170 
covering 24 cell types) in the event they may be informative, but we do not consider these to be 
171 
of sufficient quality and do not consider them further here. We did not sort the sex of flies when 
172 
preparing TAPIN-seq libraries, as we did not observe large differences in male and female 
173 
expression profiles (Figure 2 - Supplemental 1F). 
174 
 
175 
We were encouraged by the clear enrichment of previously identified markers in cell types 
176 
where they were expected. For example, we recovered transcription factors (TFs) previously 
177 
found in the developing monopolar interneurons and inner photoreceptors (Tan et al., 2015; 
178 
Figure 2G). We further confirmed our measurements by comparing TAPIN-seq results for 
179 
twelve cell types that were also recently profiled by FACS-seq (Konstantinides et al., 2018; 
180 
Figure 2 - Supplemental 2A,B) and found concordant expression of cell type-enriched genes. 
181 
This concordance also argues against major differences between nuclear and cytoplasmic 
182 
transcriptomes. In combination with the technical quality of our libraries, this confirmation by 
183 
independent gene expression measurements validated our approach, and also motivated us to 
184 
explore how to best interpret a large dataset of relative abundances. 
185 
 
186 
Interpreting transcript abundance with mixture modeling 
187 
Deriving biological insights from a matrix of transcript abundances is not straightforward. While 
188 
a cell’s expression of a gene can be used to infer a specific functional property of that cell, the 
189 

 
 
 
Page 9 of 83 
2019 Dec 27 
level of expression that is needed to establish confidence in such an inference is much less 
190 
clear. For example, expressing the vesicular acetylcholine transporter (VAChT) implies that a 
191 
neuron is cholinergic. However, VAChT transcript abundance exhibits a wide distribution and it 
192 
is not clear, a priori, what level is necessary to conclude that a cell is cholinergic (Figure 3A). 
193 
 
194 
We used mixture modeling to address this challenge by describing the expression levels of each 
195 
gene as arising from a mixture of two log-normal distributions representing binary “on” and “off” 
196 
states (Figure 3A; METHODS). Genes can of course express in more than two states, but we 
197 
show through extensive validation that this simplifying assumption is a useful one. Modelling 
198 
VAChT expression in the high-quality TAPIN/INTACT-seq libraries unambiguously inferred 
199 
VAChT states for all drivers (Figure 3B). We also found that the model was useful for 
200 
addressing transcript-carryover, evident in our data (as well as published bulk and single cell 
201 
studies in the fly (Davie et al, 2018) and mouse (Siegert et al., 2012; Macosko et al, 2015)) as 
202 
photoreceptor transcripts detected in non-photoreceptor cells (Figure 3 - Supplemental 1A). 
203 
For example, the model correctly inferred that only R1-6 photoreceptors expressed the primary 
204 
rhodopsin ninaE, although ninaE abundance in other cells reached as high as 2,702 TPM (the 
205 
mushroom body cell type PAM_1) (Figure 3 - Supplement 1 B,C). We used this method to 
206 
transform our catalog of transcript abundances to probabilities of expression (Figure 3C), 
207 
observing a wide spectrum of on levels and dynamic ranges between on and off states (Figure 
208 
3 - Supplemental 1D,E). To further simplify these probabilities, we discretized them into on (p 
209 
>= 0.8) and off (p <= 0.2) states, and otherwise considered them to be ambiguous (0.2 < p < 
210 
0.8). The expression states inferred for replicates had a median 95% concordance (Figure 3 - 
211 
Supplemental 1F). We combined information from replicates to infer expression at the driver 
212 
and cell type levels (METHODS). 
213 
 
214 

 
 
 
Page 10 of 83 
2019 Dec 27 
We found many genes that express in all cell types, and many that express in only one, with a 
215 
range in between (Figure 3D,E). As expected, given their roles in specifying identity, homeobox 
216 
transcription factors (TF) expressed more specifically than transcription factors in general 
217 
(Figure 3E). Neuropeptides also expressed specifically, while genes with the more general 
218 
function of synaptic vesicle endocytosis were broadly expressed. We explore these functional 
219 
properties in more detail later (Figure 4C). 
220 
 
221 
Evaluating accuracy of TAPIN-seq measurements 
222 
To validate our TAPIN-seq measurements, we first compared our inferred expression states to 
223 
FlyBase curated reports of protein expression (n=197 data points of gene/cell pairs; 4 negative 
224 
points, 193 positive points; n=22 cells; n=69 genes, Table S3). Protein expression can of course 
225 
differ from that of the corresponding mRNA due to post-transcriptional regulation. However, 
226 
since most functional interpretations of transcriptome data are implicitly about protein 
227 
expression, we used this as a more stringent and practical test of our model. We found 93% 
228 
concordance (183 matches; 14 mismatches from six genes; 0 mismatches for negative 
229 
benchmark points; Figure 3 - Supplemental 1G). The benchmark mismatches fell into three 
230 
categories: expression levels near the transition between inferred on and off components (veli, 
231 
verm, para; Figure 3 - Supplemental 1H-J), genes with a wide dynamic range of expression 
232 
(Syx, Rab11; Figure 3 - Supplemental 1K,L), and genes with undetected transcript but 
233 
previously detected protein (Myo61F; Figure 3 - Supplemental 1M). The first two categories 
234 
likely arise from imprecision in the model’s fitted components and its representation of transcript 
235 
abundance as bimodal, rather than continuous. The third category (conflicting transcript and 
236 
protein levels) could reflect either technical issues (low sensitivity in our measurements, or false 
237 
positives in the prior work due to antibody cross-reaction) or biological complexities (e.g., long-
238 
lived transcripts, subcellular localization, post-transcriptional regulation). 
239 

 
 
 
Page 11 of 83 
2019 Dec 27 
 
240 
To further evaluate our results for genes expressed across a wide range of levels, we compared 
241 
the model output to protein expression patterns for two transcription factors: Forkhead (fkh) and 
242 
Ets65A. We visualized each protein using a C-terminal GFP tag; the tagged proteins were 
243 
expressed from BAC transgenes with large flanking sequences to ensure a near native genomic 
244 
context (Kudron et al., 2018). From the transcript data, we inferred fkh gene expression in 14 
245 
cell types across a 35-fold range of abundance (60 to 2,103 TPM). Of 28 cell types that we 
246 
visualized at the protein level, fkh was detected in all but one that we expected from TAPIN-seq 
247 
(Figure 3F, G, Supplemental 2A). The sole exception, Tm4, has a fkh abundance (60 TPM) 
248 
near the border between the inferred off and on states (Figure 3F). However, we did detect 
249 
protein in Dm9, which had a near identical raw transcript abundance (61 TPM). Similarly 
250 
evaluating Ets65A expression identified two mismatches out of 11 tested cells (Figure 3H, 
251 
Supplemental 2B). Ets65a protein was not detected in Tm20 (70 TPM) and epithelial glia (161 
252 
TPM), while it was weakly detected in Dm3 (77 TPM). These results further support the 
253 
accuracy of TAPIN-seq and our statistical model even for genes with a wide dynamic range. 
254 
The agreement between our transcript on/off calls and protein expression encouraged us to use 
255 
the discretized on/off calls for all further analyses; the unprocessed relative abundances in TPM 
256 
are reserved for deeper analysis when needed. 
257 
 
258 
Examining the relation between cell types using transcriptomes 
259 
To study the relation between cell types, we built a dendrogram based on the expression states 
260 
we inferred for the whole transcriptome and estimated the support for each branch point with 
261 
bootstrap resampling (Figure 4A). The broad groupings were well supported and mostly 
262 
intuitive: muscle were outgroups, followed by a mushroom body cell type (PAM_4), the glia, the 
263 
photoreceptors, and the remaining neurons. Several fine groupings of anatomically closely 
264 

 
 
 
Page 12 of 83 
2019 Dec 27 
related neurons were also well supported (e.g., Kenyon cells; C2, C3; Lawf1, Lawf2; T4, T5; 
265 
LPLC1, LPLC2). However, mid-level branchings were not well supported, indicating the lack of a 
266 
simple hierarchical relationship. Neurons were generally grouped by region: central complex, 
267 
mushroom body, and optic lobe. One surprise was the grouping of Tm20 and Dm1, away from 
268 
all other optic lobe cell types. Upon closer examination, the identity of genes expressed 
269 
exclusively in these two lines (lz, Pdh, bw) suggest that this grouping is driven by shared 
270 
pigment cell contamination in the GAL4-tagged patterns of these driver lines. Similarly, the 
271 
unusual position of PAM_4 is likely due to some unidentified non-neuronal cells in the driver. 
272 
These are examples of imperfections in the GAL4 driver lines. While they can lead to some 
273 
false positives for the main target cell types, they can also provide additional information. For 
274 
example, analyzing the overlap between Dm1 and Tm20 allowed us to infer marker genes 
275 
expressed in the pigment cell population. 
276 
 
277 
Identifying genes that mark cell types and groups 
278 
We next identified genes that marked cell groups in the tree, using three criteria: genes that 
279 
expressed in all the cells within a group, at most two cells outside this group, and with transcript 
280 
abundance higher than all cells outside the group (For simplicity, we will hereon refer to cell type 
281 
as just cell. This is not meant to exclude the possibility of heterogeneity within the individual 
282 
cells of a profiled population.). We used these criteria to identify markers for photoreceptors 
283 
(n=108), glia (n=60), and muscle (n = 76) (Figure 4B, Table S4). These genes included many 
284 
known as well as new markers. For example, genes enriched in photoreceptors include 
285 
signaling components (Arr2, Galphaq) and transporters (trpl, Eaat2) with known physiological 
286 
roles as well as uncharacterized orphan transporters (e.g., CG8468). We also identified 18 
287 
markers for pigment cells using the Tm20 and Dm1 profiles. In addition to the three types of 
288 
lamina glia we profiled, several other glia types are present in both the lamina and the medulla. 
289 

 
 
 
Page 13 of 83 
2019 Dec 27 
Genes expressed exclusively in the dissected samples (lamina, remainder of optic lobe) and not 
290 
in the TAPIN libraries identified marker genes for optic lobe cells that we did not directly profile, 
291 
such as medulla glia. Indeed, the genes identified in this way included several known markers 
292 
for astrocytes (alrm, wun2, Obp44a) (Huang et al., 2012). 
293 
 
294 
We examined the breadth of expression of different functional groups of genes, as defined by 
295 
FlyBase gene group curation. HOX-like homeobox TFs were among the most specifically 
296 
expressed group, while groups of core cellular machinery (e.g., beta importins, mitochondrial 
297 
complexes) were among the most broadly expressed groups (Figure 4C). Some groups 
298 
included both broadly and very specifically expressed genes. For example, among cell adhesion 
299 
molecules, we noted an interesting distribution for three gene groups proposed to be involved in 
300 
protein-protein interactions that underlie synaptic connectivity (Ozkan et al., 2013; Tan et al., 
301 
2015; Carillo et al., 2015). While 11 DPR-interacting proteins (DIP) were among the most 
302 
specifically expressed genes (expressed in a median of 6 cells), beat (median, 25.5 cells) and 
303 
DPR (median, 51 cells) genes were more broadly expressed (Figure 4 - Supplemental 1A-D). 
304 
As physical interactions among these and other extracellular proteins have been systematically 
305 
characterized (Ozkan et al., 2013), we combined their expression and interaction patterns to 
306 
estimate the number of potential interaction between cells in the lamina (Figure 4 - 
307 
Supplemental 1E), many of which are in actual contact (Figure 4 - Supplemental 1F). Except 
308 
for a clear paucity of transcripts encoding interacting protein pairs expressed by glia, these 
309 
global expression-based patterns did not correlate well with connectivity in the lamina. However, 
310 
we found that every pair of lamina cells expressed mRNAs for tens of interacting protein pairs, 
311 
highlighting the broad potential for cell-cell interactions not only in the developing (Tan et al 
312 
2015) but also adult optic lobe. 
313 

 
 
 
Page 14 of 83 
2019 Dec 27 
 
314 
Transcriptomes can distinguish closely related cell types and subtypes 
315 
To ask whether we could identify genes distinguishing closely related cell types, we examined 
316 
T4 and T5. These cells had similar transcriptomes and were neighbors in the phylogenetic tree, 
317 
but we found one transcription factor, TfAP-2, that was expressed nearly two orders of 
318 
magnitude higher in T4 (390 TPM) than T5 (6 TPM) (Figure 4D). We confirmed this pattern at 
319 
the protein level (Figure 4E,F). 
320 
 
321 
T4 and T5 cells can each be further divided into four subtypes that preferentially respond to 
322 
motion in one of four cardinal directions and differ in anatomical details such as the lobula plate 
323 
layer to which they project axons. While our split-GAL4 lines do not isolate single T4/T5 
324 
subtypes, the T5_d1 and T5_d2 drivers show differences in subtype expression (Figure 1 - 
325 
Supplemental 1 B,B’,C,C’). Comparing the transcriptomes of these two drivers confirmed 
326 
previously described markers (Con, bi, dac; Apitz and Salecker, 2018) that distinguish T4/T5 
327 
cells of lobula plate layers 1/2 and 3/4, and indicated additional genes, including a transcription 
328 
factor (dysf) and cell adhesion molecules (klg, Dscam3) with selective expression in these 
329 
subtypes (Figure 4G). As a further confirmation of this finding, we verified that a tagged klg 
330 
protein showed layer-specific expression in the lobula-plate consistent with these T4/T5 
331 
subtypes (Figure 4H). 
332 
 
333 
Reference bulk transcriptomes help interpret single cell transcriptomes 
334 
Single cell RNA-seq (scRNA-seq) was recently used to map the optic lobe (Konstantinides et 
335 
al., 2018) and brain (Davie et al., 2018). Despite its routine use, interpreting scRNA-seq 
336 
measurements – clustering single cell transcriptomes and labeling these clusters as known cell 
337 
types – remains challenging. For example, the 52 single cell clusters found in the optic lobe (23 
338 

 
 
 
Page 15 of 83 
2019 Dec 27 
labeled as known cell types, including 7 types of glia; Konstantinides et al., 2018) and the 87 
339 
clusters found in the whole brain (41 labeled, also including 7 glia; Davie et al., 2018) far under-
340 
estimate the expected diversity of cell types – over one hundred anatomically distinct neuronal 
341 
cell types have been described in the optic lobe alone (Fischbach and Dittrich, 1989; Morante 
342 
and Desplan, 2008; Otsuna and Ito, 2006; Nern et al., 2015; Wu et al., 2016). Furthermore, 
343 
comparing the number of single cells in each optic lobe cluster to the true abundance of each 
344 
cell type (as established by neuroanatomical studies) reveals that the single cell map does not 
345 
proportionally represent abundance (ranging from ~5 times fewer Dm8/Tm5c cells to ~7 times 
346 
more Dm12 cells than expected in the optic lobe map; Figure 5A). The whole brain map, 
347 
measured using the more sensitive 10X scRNA-seq platform rather than Drop-seq used for the 
348 
optic lobe map (Svensson et al., 2017), showed similar cell type abundances (Figure 5B). 
349 
Without detailed neuroanatomy to serve as ground-truth, this similarity could be interpreted as 
350 
reproducibility across platforms. Instead, our results suggest caution when interpreting cell type 
351 
frequencies from scRNA-seq maps, as they can be skewed by experimental artifacts such as 
352 
cell type-specific differences in RNA isolation yields, computational over-clustering, or 
353 
inaccurate cell type labeling. Given the known number of cell types and their frequencies, it is 
354 
clear that interpreting single cell measurements is challenging. 
355 
 
356 
Comparison with our data reveals additional challenges in mapping scRNA-seq clusters to 
357 
known cell types. To compare our data to the brain map, we used non-negative least squares 
358 
regression to model each TAPIN-seq transcriptome as a linear weighted sum of single cell 
359 
cluster transcriptomes, assuming that large regression coefficients reflect matching cell types 
360 
(Davie et al., 2018, Cao et al., 2019). We interpreted the results of this comparison against an 
361 
ideal scenario where single cell clusters were perfectly resolved and accurately labeled, and 
362 
assuming that the driver lines used for TAPIN-seq profiling had minimal expression outside of 
363 

 
 
 
Page 16 of 83 
2019 Dec 27 
the main target cell type. In this scenario, we would expect a unique cluster matching each of 
364 
our TAPIN-seq profiles of cell type-specific driver lines, as well as many unmatched clusters, 
365 
reflecting cell types that we did not profile. However, we observed few one-to-one matching 
366 
clusters for our TAPIN-seq profiles (e.g., T1, Tm1, Dm8, Dm9, Pm3), several one-to-many 
367 
matches (e.g., photoreceptor cluster #53 matching our R1-6, R7, R8-Rh5, and R8-Rh6 profiles; 
368 
also, L1-5 cluster #20, Lawf1/2 cluster #58, and T4/T5 cluster #24), clusters with no TAPIN-seq 
369 
matches (e.g., clusters #7, 15, 23), as well as TAPIN-seq cell types without a matching cluster 
370 
(e.g., Dm4, Dm11, Mi4, Tm2, Tm20, LPLC1) (Figure 5C). The matches confirmed several 
371 
clusters labeled as single cell types (e.g., Tm1, Mi1) or multiple cell types (e.g., photoreceptors, 
372 
L1-5, Lawf1/2, T4/5, Kenyon cells) and also suggested possible labels for previously unlabeled 
373 
clusters (e.g., Dm8 cluster #52, Dm9 cluster #74, pigment cell cluster #76) and alternative labels 
374 
for previously labeled clusters (e.g., TmY5a TAPIN matches the TmY14 cluster #11; Lai TAPIN 
375 
matches Dm8/Tm5c cluster #39). We observed similar results when analyzing the optic lobe 
376 
map, with few apparent single cell – TAPIN-seq matches (Figure 5 - Supplemental 1). 
377 
Although this result could arise from major errors in our TAPIN-seq profiles, this possibility is 
378 
unlikely given our earlier validation results and the concordance between our TAPIN-seq 
379 
profiles and cell type-enriched genes identified from independent FACS-seq measurements 
380 
(Figure 2 - Supplemental 2). 
381 
 
382 
As a separate comparison of the bulk and single cell profiles, we examined the bulk expression 
383 
of genes marking each single cell cluster (Figure 5 - Supplemental 2). Confirming the 
384 
regression results, this analysis also found few one-to-one matches in which single cell cluster 
385 
markers were enriched in only a single TAPIN-seq profile. Instead, most cluster markers were 
386 
either enriched in multiple bulk cell types (over-clustering), or were not enriched in our data (cell 
387 
types we did not profile by TAPIN-seq). As before, many TAPIN-seq profiles were not enriched 
388 

 
 
 
Page 17 of 83 
2019 Dec 27 
for cluster markers, reflecting cell types that were either missing or clustered with other cell 
389 
types in the single cell map. 
390 
 
391 
We further explored specific examples where the TAPIN-seq data offered new insight into the 
392 
single cell maps by suggesting alternative labels or labeling unannotated clusters. The single 
393 
cell clusters labeled as TmY14 matched the TmY5a TAPIN profile (Figure 5C). The cluster was 
394 
originally labeled based on the expression of a single transcription factor, knot (kn), as 
395 
determined using a kn-GAL4 reporter. We also observed kn expression in our TmY5a 
396 
measurements and further confirmed its expression in both TmY14 and TmY5a cells using the 
397 
kn-GAL4 reporter line, suggesting that the cluster likely includes not only TmY14 cells, but also 
398 
TmY5a and other kn-expressing cells (Figure 5 - Supplemental 3). Similarly, we found that the 
399 
Dm2 cluster (optic lobe cluster #55), which was labeled based on a Dm2 FACS-seq profile, 
400 
matched our Mi15 profile (Figure 5 - Supplemental 2A). This observation is concordant with 
401 
previous reports that the line used to FACS sort Dm2 also expresses in Mi15 (Supplementary 
402 
Figure 2 in Takemura et al., 2013, Table S4 in Nern et al., 2015). Finally, we found that the 
403 
Dm8/Tm5c cluster (brain cluster #39) matches our Lai TAPIN-seq profile, while unlabeled 
404 
clusters match our Dm8 and Dm9 TAPIN-seq profiles (Figure 5D). Our measurements also 
405 
suggest labels for other previously unannotated clusters, such as brain cluster #76 which likely 
406 
reflects pigment cell, as demonstrated by enrichment of its marker genes in both Dm1 and 
407 
Tm20 profiles – both measured with lines that also express in pigment cells (Figure 5 - 
408 
Supplemental 2B). As expected, the genes marking this cluster include known pigment cell 
409 
markers (e.g., Pdh, rdhB). Altogether, our results demonstrate that cell type-identified data, such 
410 
as bulk transcriptomes, can help interpret single cell RNA-seq measurements. 
411 
 
412 

 
 
 
Page 18 of 83 
2019 Dec 27 
Profiles identify candidate neurotransmitter output for most neuron types 
413 
The proteins that synthesize and transport neurotransmitters are well known, enabling us to use 
414 
their expression to predict neurotransmitter phenotype. We used histamine decarboxylase 
415 
(Hdc), glutamate decarboxylase (Gad1), the vesicular acetylcholine transporter (VAChT), and 
416 
the vesicular glutamate transporter (VGlut) to identify potential histaminergic, GABAergic, 
417 
cholinergic, and glutamatergic cell types, respectively (Figure 6A). Our model unambiguously 
418 
inferred expression states for these genes and indicated a single transmitter (from this group) 
419 
for nearly all neurons we profiled. A second cholinergic marker, choline acetyltransferase 
420 
(ChaT), matched VAChT expression almost perfectly (the two genes also share an exon). The 
421 
sole exception, apparent expression of ChAT but not VAChT in R7 photoreceptors, likely results 
422 
from a subset of dorsal rim R8 cells labeled by the R7 driver line (further discussed below, also 
423 
see Table S1). 
424 
 
425 
Besides these four neurotransmitters that we identified by one or two marker genes, we also 
426 
identified candidate dopaminergic neurons based on the combined expression of tyrosine 
427 
hydroxylase (ple), dopa decarboxylase (ddc), vesicular monoamine transporter (Vmat) and 
428 
dopamine transporter (DAT). While DAT, ple, and ddc were also expressed individually in 
429 
several cell types that did not express Vmat, only known dopaminergic cell types and one 
430 
medulla neuron (Mi15) expressed this combination (Figure 6A). 
431 
 
432 
One neuronal cell type, T1, expressed none of the neurotransmitter markers VGlut, VAChT, 
433 
Vmat, and Gad1 (Figure 6A). Although T1 does express most pan-neuronal genes, it does not 
434 
express bruchpilot (brp), a key component of presynaptic active zones. Consistent with this 
435 
result, EM reconstruction has identified very few T1 presynaptic specializations (Takemura et 
436 
al., 2008). 
437 

 
 
 
Page 19 of 83 
2019 Dec 27 
 
438 
Transmitters for nearly half of our cell types have been previously proposed and generally agree 
439 
with our results. For example, VAChT/ChAT expression in Kenyon cells supports recent reports 
440 
showing they are cholinergic (Barnstedt et al., 2016; Crocker et al., 2016). Fluorescence in situ 
441 
hybridization and immunolabeling guided by our measurements confirmed the expression of 
442 
ChAT, Gad1, and VGlut in Mi1, Mi4, and Mi9, respectively (Long et al., 2017; Takemura et al 
443 
2017). However, we see considerable differences between our assignments and some previous 
444 
work that used reporter transgenes (Raghu et al., 2011a, 2011b; Raghu et al., 2013), which we 
445 
generally attribute to unfaithful transgene expression patterns. We believe our assignments to 
446 
be more reliable, however they are not without problems. For example, one assignment inferred 
447 
by our model that seems unlikely and is not supported by other available data is the presence of 
448 
Gad1 in Mi9, which was not detected in the FISH or antibody experiments mentioned above. 
449 
Given the presence of some contaminating Mi4 cells in at least one Mi9 driver and the lower 
450 
Gad1 abundance (mean 276 TPM in Mi9; 2165 TPM in Mi4; 1870 mean TPM in predicted 
451 
GABAergic cells), we attribute the Mi9 Gad1 signal to contaminating contributions from other 
452 
GABAergic cells such as Mi4. 
453 
 
454 
Transcriptional regulation of neurotransmitter output 
455 
We next tried to identify transcriptional regulators of neurotransmitter output, by searching for 
456 
TF genes expressed in strong correlation with transmitter phenotype. However, we only found 
457 
such TFs for histaminergic output (Figure 6 - Supplemental 1A), which in our dataset is only 
458 
represented by photoreceptor neurons. This observation agrees with work on neuronal identity 
459 
showing that single TFs rarely encode transmitter identity, but rather different TF and TF 
460 
combinations are used to specify the same neurotransmitter output (Hobert, 2016). We thus 
461 
expanded our search to TFs whose expression was informative about transmitter phenotype 
462 

 
 
 
Page 20 of 83 
2019 Dec 27 
(i.e., cells expressing TF A are likely to produce neurotransmitter B; even if not all cells 
463 
producing neurotransmitter B express TF A; Figure 6 - Supplemental 1A). This search 
464 
identified candidate TFs for nearly all neurotransmitter types. For example, the 19 neuronal 
465 
types (including the broad chat-GAL4 line) expressing apterous (ap) are cholinergic. Its worm 
466 
ortholog, ttx-3, regulates the cholinergic phenotype of the AIY neuron (Wenick and Hobert, 
467 
2004). Several other TFs we identified also have worm or mouse orthologs implicated in 
468 
neuronal identity (Figure 6 - Supplemental 1B). Several TFs appeared to identify a transmitter 
469 
phenotype within a group of cell types but not across the entire dataset. For example, Lim3 
470 
distinguishes the GABAergic Dm10 from the other Dm cell types in our dataset and is also 
471 
expressed in several other GABAergic cells (Mi4, Pm3, Pm4) but was also detected in the 
472 
cholinergic LC4 and the glutamatergic TmY5a and Tm29. We confirmed the differential Lim3 
473 
protein expression in Dm10 and Dm12 cells (Figure 6 - Supplemental 1C). Several of the 
474 
transcription factors that we found to be informative of neurotransmitter output were also 
475 
implicated by single cell RNA-seq data, including ap (cholinergic), tj (glutamatergic), and Lim3 
476 
(GABAergic) (Konstantinides et al., 2018). Our data also indicate exceptions to these patterns 
477 
(i.e., neurons expressing tj and Lim3 but with a different neurotransmitter phenotype; Figure 6 - 
478 
Supplemental 1A). These observations indicate that neuronal features are likely regulated in a 
479 
context-dependent and combinatorial manner, and that transcriptomes can identify putative 
480 
regulators.  
481 
 
482 
Co-expression of canonical small molecule transmitters with non-canonical transmitters 
483 
is widespread 
484 
Co-release of multiple neurotransmitters can enhance the signaling capacity of neurons and 
485 
neural circuits. For example, the same cell type might release different transmitters under 
486 
distinct conditions or use them to elicit distinct responses in different target cells. In addition to 
487 

 
 
 
Page 21 of 83 
2019 Dec 27 
Mi9 (discussed above as being likely due to contamination), we observed two cases of potential 
488 
co-transmission involving the canonical small molecule neurotransmitters. Both Mi15 drivers 
489 
express dopaminergic and cholinergic markers, and both R8 drivers expressed cholinergic and 
490 
histaminergic markers. We confirmed expression of Vmat protein in Mi15 (Figure 6B), the first 
491 
identified columnar dopaminergic cell type within the optic lobe, and further below we confirm 
492 
the unexpected VAChT expression in R8 (Figure 8A).  
493 
 
494 
Evidence for co-transmission involving additional molecules, such as neuropeptides or nitric 
495 
oxide, appears frequently in our data set. Nitric oxide is a widely conserved signaling molecule 
496 
that can act on many kinds of cells, including neurons (Lowenstein and Snyder, 1992). We 
497 
observed very specific expression of its synthesizing enzyme, nitric oxide synthase (Nos), in the 
498 
lamina (C2, C3, and Lawf2) and medulla (Mi4, Pm4, Tm4 and Mi15). To further validate these 
499 
results, we confirmed Nos expression at the protein level in C3 neurons (Figure 6C). Nitric 
500 
oxide can be released extra-synaptically, potentially enabling signaling between neurons that 
501 
are not synaptic partners. 
502 
 
503 
Several neuropeptides and their receptors were also expressed in distinct patterns suggesting 
504 
widespread yet specific peptidergic signaling in the visual system (Figure 6D). For example, 
505 
AstA was observed in just one cell type (Pm3; confirmed at the protein level; Figure 6E), while 
506 
AstC was expressed in several cell types, and pigment-dispersing factor (Pdf) was expressed in 
507 
none of the optic lobe cells we profiled. The receptors for all three of these neuropeptides were 
508 
more broadly expressed (Figure 6D). The broad expression of Pdf receptor (Pdfr) is consistent 
509 
with the extensive arborization previously observed for Pdf-expressing neurons at the surface of 
510 
the medulla. 
511 
 
512 

 
 
 
Page 22 of 83 
2019 Dec 27 
While we focused on genes with well-known functions, our expression patterns also suggest 
513 
new functions for poorly characterized genes (Figure 6A). For example, photoreceptors 
514 
specifically expressed CG8468, an orphan transporter in the solute carrier 16 (SLC16) family of 
515 
monocarboxylate transporters. This gene might represent a candidate vesicular or plasma 
516 
membrane transporter of histamine, which remains unidentified in any species. We also 
517 
observed photoreceptor-specific expression of CG45782 (lovit), a member of the SLC45 
518 
sucrose transporter family recently reported as a putative histamine transporter (Xu and Wang, 
519 
2019). 
520 
 
521 
Broad and patterned expression of neurotransmitter receptors 
522 
Since the functional consequences of the release of a neurotransmitter depend on which 
523 
receptors for this transmitter are expressed in the receiving cell, measuring the expression of 
524 
both neurotransmitter input and output genes is necessary to assign potential synaptic signs to 
525 
connectomes. For example, glutamatergic transmission in Drosophila may be either inhibitory or 
526 
excitatory, depending on the receptors.  
527 
 
528 
In general, neurotransmitter receptors are broadly expressed, qualifying each cell type to detect 
529 
multiple neurotransmitters (Figure 7A). Patterns for individual receptors (or receptor subunits) 
530 
varied widely. Some receptors, such as the GluClalpha glutamate-gated chloride channel, 
531 
thought to be the main mediator of inhibitory glutamatergic transmission in flies, were expressed 
532 
in most but not all cell types (Figure 7A,B). Expression of others was much more restricted, 
533 
such as the EKAR glutamate receptor subunit detected only in photoreceptor neurons, 
534 
consistent with previous work (Hu et al., 2015). Nearly all cells expressed receptors for 
535 
acetylcholine, GABA, and glutamate, as expected from the combination of predicted transmitter 
536 
phenotypes and connectomics data. Receptors for neuromodulators such as serotonin, 
537 

 
 
 
Page 23 of 83 
2019 Dec 27 
dopamine, octopamine, and neuropeptides in general were also widespread (Figure 6D). For 
538 
example, octopamine receptors were expressed in broad, yet gene- and cell-type specific 
539 
patterns, consistent with widespread octopaminergic modulation of visual processing (for 
540 
example, Arenz et al., 2017, Strother et al 2018, Tuthill et al., 2014). We confirmed Oamb 
541 
expression at the protein level in specific lamina neurons and glia, including Lawf2 cells 
542 
previously shown to be octopamine sensitive (Tuthill et al., 2014) (Figure 7C).  
543 
 
544 
Combining transcriptomes and connectomes 
545 
A principal goal of our work is to provide a foundation for combining molecular data such as 
546 
neurotransmitter and receptor expression patterns with anatomical or functional connectivity 
547 
data. One application of expression information is to constrain mechanistic models of neural 
548 
circuits such as the extensively studied motion detection circuit in the fly eye (reviewed in Mauss 
549 
et al., 2017; Figure 7 - Supplemental 1A). The combined availability of expression and 
550 
connectomics data for many cell types in a brain region also makes it possible to systematically 
551 
identify and further explore unusual patterns of receptor or transmitter expression; for example, 
552 
cell types in which an otherwise widely expressed receptor is absent or cells with unusual 
553 
combinations of receptor subunits. Below we discuss three examples, focused on potential 
554 
signs of synaptic transmission, of how such patterns can lead to specific and unexpected 
555 
hypotheses about circuit function. As we illustrate, combining expression data with synapse-
556 
level anatomy permits analyses which are inaccessible to either approach alone. 
557 
 
558 
Presynaptic cholinergic markers and absence of histamine receptors in some 
559 
postsynaptic targets: R8 photoreceptors may signal via two fast transmitters 
560 
Fly photoreceptors have long been known to release histamine (Hardie 1987; Sarthy, 1991). 
561 
Our data indicate that inner (color vision) R8 photoreceptors also express the cholinergic 
562 

 
 
 
Page 24 of 83 
2019 Dec 27 
markers ChAT and VAChT, suggesting an unexpected additional cholinergic phenotype (Figure 
563 
6A). To confirm these results, we visualized a tagged VAChT protein (VAChT-HA; Pankova and 
564 
Borst, 2017), expressed from the endogenous locus, selectively in photoreceptor cells. These 
565 
experiments showed VAChT-HA labeling in medulla terminals of R8 but not R7 cells (Figure 
566 
8A,A’,A’’,B), including the specialized polarized light-responsive R8-cells in the dorsal rim of the 
567 
medulla. The latter express the rhodopsin Rh3 (which is otherwise expressed in R7s; Fortini and 
568 
Rubin, 1990), consistent with the presence of ChAT and VAChT transcripts in the R7 driver line 
569 
(for which the model inferred expression for VAChT but not ChAT).  
570 
 
571 
We asked whether the apparent co-transmitter phenotype of R8 neurons was reflected in the 
572 
expression of neurotransmitter receptors in their different postsynaptic partners. Postsynaptic 
573 
partners of R8 cells identified by electron microscopy reconstructions include seven cell types in 
574 
our dataset: Dm9, Mi1, Mi4, Mi15, R7, L1 and Tm20 (Figure 8C) (Takemura et al., 2013, 2015). 
575 
All of these express one or more nAChR subunits (Figure 7A). By contrast, expression of the 
576 
histamine-gated chloride channels HisCl1 and ort, which mediate histaminergic transmission by 
577 
photoreceptors (Pantazis et al., 2008), was more selective (Figure 8C,D): L1, Tm20 and Dm9 
578 
express ort, consistent with previous reports (Gao et al., 2008), while HisCl1 transcripts were 
579 
detected in the R7 as well as R8 driver lines, in agreement with another recent report 
580 
(Schnaitman et al., 2018; Tan et al., 2015). However, we did not find evidence of expression of 
581 
ort or HisCl1 in Mi4, Mi1 and Mi15, further supporting R8 signaling via a transmitter other than 
582 
histamine. 
583 
 
584 
We were interested in whether release of ACh and histamine might occur at spatially distinct 
585 
locations. Insect synapses often consist of multiple postsynaptic sites apposed to the same 
586 
presynapse. For cells that release more than one transmitter, two general distributions of 
587 

 
 
 
Page 25 of 83 
2019 Dec 27 
postsynaptic processes at such multicomponent synapses are possible (Figure 8E). 
588 
Postsynaptic cells with different receptors could be grouped at different sites based on receptor 
589 
expression (Figure 8E-left) or occur together at the same locations (Figure 8E-right). To 
590 
distinguish these possibilities for R8 cells, we used EM reconstruction data (Takemura 2013) to 
591 
map the predicted expression of histamine receptors in postsynaptic cells at the single synapse 
592 
level for all presynaptic sites of one reconstructed R8 cell (Figure 8F). The resulting pattern 
593 
indicates that processes of cell types with and without histamine receptor expression are often 
594 
located near the same R8 presynapse (Figure 8F), whereas this is not the case for a 
595 
reconstructed R7 cell (Figure 8G). This is consistent with the VAChT-HA labeling observed 
596 
throughout the medulla terminals of R8s (Figure 8A). This spatial pattern is compatible with 
597 
either co-release of histamine and ACh or independently regulated release from different 
598 
vesicles at the same sites. 
599 
 
600 
A combined cholinergic and histaminergic phenotype has been reported for a small group of 
601 
extraretinal photoreceptors (the Hofbauer-Buchner eyelet) located near the lamina (Yasuyama 
602 
and Meinertzhagen, 1999) but was unexpected for R-cells of the compound eye. Establishing 
603 
the functional significance of potential acetylcholine release by R8 cells will require further 
604 
experiments. However, we note that double mutants lacking both histamine receptors are not 
605 
completely blind (Gao et al., 2008), consistent with histamine-independent transmission by 
606 
photoreceptor neurons. In addition, a very recent study suggests a role of cholinergic R8 
607 
signaling in the entrainment of the fly’s circadian rhythm to light-dark cycles (Alejevski et al., 
608 
2019), perhaps similar to that of ACh-release from the Hofbauer-Buchner eyelet (Schlichting et 
609 
al., 2016). 
610 
 
611 

 
 
 
Page 26 of 83 
2019 Dec 27 
Potentially excitatory GABA-A receptors in lamina monopolar cells 
612 
Fast GABAergic transmission via GABA-A receptors is a major source of inhibition in the 
613 
nervous system. However, some GABA-A subunit combinations could mediate depolarizing 
614 
GABA-signaling: in vitro assays indicate that homomeric Rdl or heteromeric Rdl/Lcch3 receptors 
615 
are typical GABA-gated chloride channels (Zhang et al., 1995), while Lcch3/Grd form GABA-
616 
gated cation channels (Gisselmann et al., 2004). However, the in vivo significance of this 
617 
difference is unknown. Rdl and Lcch3 were expressed in nearly all neurons in our dataset 
618 
(Figure 7A, Figure 9A,B), consistent with the general inhibitory nature of GABA signaling. By 
619 
contrast, Grd and another predicted GABA-A receptor subunit, CG8916, were expressed in a 
620 
minority of cell types (Figure 7A, Figure 9A,B). Photoreceptor neurons, for which no major 
621 
GABAergic inputs have been identified by connectomics, expressed none of the four transcripts 
622 
(Figure 9B). Lamina monopolar L1 and L2 were the only neurons other than photoreceptors 
623 
that did not express significant levels of Rdl. However, both express Grd, Lcch3 and also 
624 
CG8916. Together with the in vitro findings mentioned above, this result suggests that some or 
625 
all GABA-A receptors in L1 and L2 may be cation rather than chloride channels. Remarkably, 
626 
lamina monopolar cells in the housefly Musca, which are thought to have very similar functional 
627 
properties to those in Drosophila, depolarize in response to GABA (Hardie, 1987) but 
628 
hyperpolarize in response to histamine (via ort-containing chloride channels). Thus our data 
629 
identify a potential link between in vivo electrophysiology, in vitro receptor properties and cell 
630 
type differences in GABA-A subunit (Rdl or Grd) expression. 
631 
 
632 
We next asked whether depolarizing GABA-signaling to L1 and L2 was plausible given their 
633 
synaptic connectivity. Based on synapse counts and our transmitter data, the main GABAergic 
634 
inputs to L1 and L2 are C2 and C3 neurons (Meinertzhagen and O’Neill, Rivera-Alba et al, 
635 
Takemura 2013, Takemura 2015). Conversely, L1 is the main input to both C2 and C3 cells, 
636 

 
 
 
Page 27 of 83 
2019 Dec 27 
followed by the cholinergic L1 targets L5 and Mi1. These strong connections (illustrated for C2 
637 
in Figure 9C) indicate that the effective sign of GABA input to L1 and L2 is almost certainly of 
638 
functional significance. In the illustrated circuit (Figure 9C), L1 cells hyperpolarize in response 
639 
to luminance increases (as histamine from photoreceptors opens ort chloride channels). The 
640 
resulting reduced secretion of glutamate is thought to depolarize L1 targets such as Mi1 (via 
641 
closing of GluClalpha channels). One plausible, though speculative, scenario, is that, similar to 
642 
Mi1, C2 cells also depolarize in response to light. In this case, GABA-gated cation channels in 
643 
L1 (formed by Grd and Lcch3) would enable negative feedback (counter-acting) from C2 to L1, 
644 
which for example could return the membrane potential closer to resting levels – speeding up 
645 
the response to subsequent luminance changes. By contrast, opening of conventional GABA-A 
646 
receptors (GABA-gated chloride channels) in L1 would resemble a light response (opening of 
647 
histamine-gated chloride channels), and thus provide positive (reinforcing) feedback in this 
648 
case. The latter possibility appears less consistent with the transient nature of the L1 (and L2) 
649 
response to light (Järvilehto and Zettler, 1971; Laughlin and Hardie, 1978). Distinguishing these 
650 
and other possibilities will of course require future experimental work. 
651 
 
652 
Similar to the findings for histamine receptors described above (Figure 8F), again using 
653 
connectivity data for the medulla, we observed that cells with different GABA-A profiles can be 
654 
postsynaptic at the same synapse (Figure 9D). In addition to L1 and L2, Grd expression 
655 
indicated several other candidates for cells with unusual GABA responses (Figure 7A, 9B). In 
656 
these neurons (e.g., Dm8 or Mi4), Rdl and Grd were detected together, raising questions such 
657 
as whether their subcellular distribution is synapse-specific or whether these subunits might co-
658 
assemble into channels with yet unexplored properties. 
659 
 
660 

 
 
 
Page 28 of 83 
2019 Dec 27 
Diverse patterns of glutamate receptor expression in the targets of a single local 
661 
interneuron type in the lamina 
662 
The diverse expression of glutamate receptor subunits, which can mediate both inhibitory and 
663 
excitatory signaling, was particularly striking in the lamina (Figure 7A, 9E,F). Notable patterns 
664 
include the photoreceptor-specific expression of EKAR, the predicted absence of GluClalpha, 
665 
otherwise broadly expressed in neurons, from some cell types, including photoreceptors (Figure 
666 
7A, 9F) and its strong expression in epithelial glia. CG3822, a Kainate-type receptor subunit 
667 
recently reported to function in presynaptic homeostatic control at the neuromuscular junction 
668 
(Kiragasi et al., 2017), was strongly enriched in the lamina intrinsic Lai cells. Since Lai neurons 
669 
are the only known source of vesicular glutamate release in the lamina, CG3822 function in Lai 
670 
is predicted to be also be pre- or perhaps extrasynaptic. T1 and L3, while not expressing VGlut, 
671 
might also influence glutamate levels in the lamina via the Eaat1 plasma membrane glutamate 
672 
transporter. The strong expression of this transporter in T1 rather than glia is another unusual 
673 
feature of glutamatergic signaling in the lamina and may be a clue to the enigmatic function of 
674 
T1 cells (Tuthill et al., 2013). These examples further highlight how a transmitter released by 
675 
one neuron type, here Lai, is predicted to have very different effects on target cells due to the 
676 
receptors they express. 
677 
 
678 
Comparisons of cell shape, synaptic connectivity and receptor expression reveal 
679 
multiple similarities between local interneurons Lai in the lamina and Dm9 in the medulla 
680 
The combination of highly specific EKAR expression and the unusual absence of GluClalpha in 
681 
photoreceptors prompted us to further explore cellular sources and potential functions for 
682 
glutamatergic signaling to photoreceptor neurons. 
683 
 
684 

 
 
 
Page 29 of 83 
2019 Dec 27 
Photoreceptor neurons function over an extremely wide range of light levels, from moonlight to 
685 
bright sunlight. One mechanism proposed to enable this behavior is a depolarizing feedback 
686 
signal from photoreceptor targets that increases photoreceptor output under low light conditions, 
687 
but reduces output at higher light intensities (Zheng et al., 2009). As Lai cells express ort, and 
688 
thus, like other ort-expressing photoreceptor targets, are thought to hyperpolarize in response to 
689 
light, increased glutamate release from Lai could provide such light-dependent feedback via 
690 
EKAR in R-cells. This scenario is consistent with reduced photoreceptor responses at low light 
691 
intensities after reduction of Lai output or EKAR function (Hu et al., 2015). EKAR is also 
692 
expressed in R7 and R8 cells, which project to the medulla and are not postsynaptic to Lai. We 
693 
therefore asked whether there might be a medulla counterpart of Lai neurons. 
694 
 
695 
Synaptic connectivity data identify Dm9 as a strong candidate for such a role: Dm9 is both a 
696 
major pre- and postsynaptic partner of R7 and R8; it is the only identified R7/R8 target with 
697 
these properties (other known R7 or R8 targets appear to form few if any feedback synapses on 
698 
these cells). Remarkably, the overall anatomy of Dm9 cells is also very similar to Lai (Figure 
699 
9G,H): Both Lai and Dm9 cells span multiple visual columns but the precise number and 
700 
distribution of columns innervated by each individual cell is variable. Finally, Lai and Dm9 share 
701 
key molecular properties: for example, both are glutamatergic and express ort histamine 
702 
receptors. Based on connectivity and gene expression (Figure 9F,J), Dm9 cells are predicted to 
703 
receive hyperpolarizing R7 and R8 input via ort and excitatory input from the photoreceptor 
704 
targets L3 and Dm8. Thus, similar to Lai (Figure 9G,I), Dm9 appears qualified to increase 
705 
photoreceptor output in the medulla under low light conditions, similar to a proposed function of 
706 
Lai in the lamina.  
707 
 
708 

 
 
 
Page 30 of 83 
2019 Dec 27 
One notable difference between Lai and Dm9 is that in contrast to Lai, Dm9 cells receive input 
709 
from photoreceptor neurons with different spectral tuning. This input involves direct (R7, R8) 
710 
and indirect pathways (R7 via Dm8, R1-6 via L3) (Figure 9J). This integration of multiple 
711 
spectral inputs could support a role of Dm9 in color processing. Indeed, the anatomical and 
712 
predicted functional properties of Dm9 match those of an as yet unidentified ort expressing cell 
713 
type proposed to contribute to color opponent signaling between R7 and R8 cells (Schnaitmann 
714 
et al., 2018). 
715 
 
716 
 
717 
DISCUSSION 
718 
We present an approach to characterize the function of neural circuits by combining genetic 
719 
tools to access their component cells, TAPIN-seq to measure their transcriptomes, and a 
720 
probabilistic model to interpret these measurements (Figure 1, 2, 3). We used this approach to 
721 
establish an extensive resource of the genes expressed in 67 Drosophila cell types, including 53 
722 
in the visual system, covering photoreceptors, lamina, and components of the motion detection 
723 
circuit (Figure 4) and systematically compare our results to single cell RNA-seq (Figure 5). Our 
724 
approach enables an extensive analysis of neurotransmission in the Drosophila visual system, 
725 
including the neurotransmitters sent and received across the network  as well as transcription 
726 
factors that potentially regulate neurotransmitter identity (Figure 6, 7). We also provide specific 
727 
examples of integrating transcriptomes and connectomes to illuminate circuit function (Figure 8, 
728 
9). 
729 
 
730 
Many recent studies have explored gene expression in neurons. However, only a few of these 
731 
were aimed at neurons in genetically tractable organisms and brain regions for which detailed 
732 
anatomical data, especially at the level of synaptic connections, are available. Previous work in 
733 

 
 
 
Page 31 of 83 
2019 Dec 27 
the mouse retina has used both genetic (Siegerts et al., 2012) and single cell approaches 
734 
(Macosko et al., 2015) to characterize transcriptional regulators as well as classify cell types. 
735 
More recent work in Drosophila used single cell RNA-sequencing to characterize heterogeneity 
736 
in olfactory projection neurons (Li et al., 2017), the midbrain (Croset et al., 2018), the optic lobe 
737 
(Konstantinides et al., 2018), and the whole brain (Davie et al., 2018). The expression patterns 
738 
of many genes have also been mapped in C. elegans neurons, whose connectivity has long 
739 
been known, although these studies typically focus on individual genes rather than genome-
740 
wide catalogs (Hobert et al., 2016). The unique combination of an extensive genetic toolbox to 
741 
access individual cell types in the Drosophila visual system and systematic efforts to map its 
742 
connectivity, make it well suited for exploring whether a comprehensive catalog of gene 
743 
expression is useful for understanding circuit function. Towards this end, we profiled a diverse 
744 
array of cell types including all of the neuronal cell types that populate the lamina and a subset 
745 
of cell types in the medulla and lobula complex including those known to play a central role in 
746 
the detection of motion. We also analyzed a number of cell types residing in deeper brain 
747 
structures such as the mushroom body and central complex. 
748 
 
749 
Our approach requires genetic driver lines to obtain transcriptomes of specific cell populations. 
750 
The recent availability of large collections of reagents for split-GAL4 intersections (Dionne et al 
751 
2018; Tirian and Dickson, 2017) make it possible to obtain such lines for virtually any cell type of 
752 
interest. This expanding genetic toolbox works well with our TAPIN-seq method to profile 
753 
transcriptomes.  
754 
 
755 
In some cases, available driver lines, including some used in this study (see Table S1), may 
756 
label some additional cell types. In addition to the presence of different, anatomically distinct cell 
757 
types in a driver pattern, heterogeneity could also result from as yet unrecognized 
758 

 
 
 
Page 32 of 83 
2019 Dec 27 
subpopulations within a seemingly uniform group of cells. For example, R7 and R8 
759 
photoreceptor neurons each include two major subtypes (pale and yellow) with different 
760 
rhodopsin expression but very similar, if not identical, cell morphology.  While drivers with even 
761 
higher specificity could be obtained through testing of additional split-GAL4 intersections or 
762 
perhaps triple intersections (Dolan et al., 2017), we did not find the contributions of small 
763 
numbers of “off-target” cells to be a major limitation for many applications of expression data. In 
764 
general, the transcriptomes support the high specificity of the intersectional lines we used to 
765 
access visual system cells (Figure 1). For example, we found specific expression of known 
766 
marker genes (Figure 2G, 4B) and also that most neurons only express genes for a single 
767 
neurotransmitter type (Figure 6A). In general, the expression patterns observed in our 
768 
validation experiments (for example, Figure 3G and Figure 3-Supplemental 2) were highly 
769 
consistent within a cell type. This suggests that individual cells of many if not all of the 
770 
anatomical cell types we profile do indeed share specific molecular signatures, even if 
771 
subdivisions within some types might exist.  The availability of specific driver lines makes such 
772 
validation at cellular resolution possible in a way that is otherwise difficult, for example in single 
773 
cell RNA-seq studies. Driver lines also permit repeated access to the same cell type in multiple 
774 
animals at defined time points, enabling the study of behavioral or circadian conditions in 
775 
individual cell types without having to sequence the whole brain or dissected brain regions.  
776 
 
777 
Modifying the one-step affinity capture in the original INTACT method to a two-step capture in 
778 
TAPIN-seq increased its specificity, sensitivity, and throughput without the need for time-
779 
consuming and labor-intensive centrifugation steps (Figure 1). We initially tried improving the 
780 
original INTACT method by using density gradient centrifugation to purify nuclei prior to the 
781 
bead capture step, but this was cumbersome, low throughput, and ineffective for cell types with 
782 
few nuclei per brain. In addition, for reasons that remain unclear, both photoreceptors and T4 
783 

 
 
 
Page 33 of 83 
2019 Dec 27 
cells consistently yielded few nuclei with this approach. Even with TAPIN, the libraries obtained 
784 
with some sparser driver lines did not meet the quality control standards we applied. We 
785 
suspect that the quality of these sub-optimal libraries can be improved by starting with more 
786 
flies, which is simplified by TAPIN-seq’s ability to use frozen material, enabling the collection of 
787 
many flies on multiple days at defined time points. In contrast, manual or FACS sorting of 
788 
dissociated cells is more challenging to scale up, because these more labor-intensive tissue 
789 
procurement schemes cannot be simplified in the same way. It is also worth noting that our 
790 
tandem affinity purification approach can improve the specificity of any immunopurification 
791 
method that uses a capture antibody that is cleavable by IdeZ (all IgG subclasses), without 
792 
requiring expression of a traditional TAP tag (Rigaut et al., 1999). 
793 
 
794 
TAPIN-seq complements single-cell RNA-seq studies of neurons in several ways (Ecker et al., 
795 
2017. Konstantinides et al., 2018). First, our high-resolution transcriptomes will serve as a 
796 
reference for interpreting single-cell measurements. In particular, comparing our expression 
797 
catalog to recent single cell maps of the optic lobe and whole brain highlights the challenges in 
798 
interpreting single cell measurements. Several cell types that we profiled don’t appear as 
799 
clusters in the single cell map, while others are grouped into the same cluster. The well-
800 
established neuroanatomy of the optic lobe makes it an ideal setting to evaluate the accuracy of 
801 
single cell RNA-seq measurements and raises a broader caution when interpreting scRNA-seq 
802 
surveys of less well-characterized tissues: the composition of cell types (or states or clusters) 
803 
observed by scRNA-seq can deviate significantly from their true abundance and requires 
804 
validation with independent methods. While we analyze fly neurons here, the cautions may also 
805 
be worth considering in other tissues and species (e.g., the Human Cell Atlas effort; Regev et 
806 
al., 2017). Having both deep bulk transcriptomes and single cell maps of the same tissue also 
807 
provides an opportunity for developing new analytical tools that can harness available cell type-
808 

 
 
 
Page 34 of 83 
2019 Dec 27 
identified information while clustering single cell data. Second, combining our approach with 
809 
single-cell profiling could more efficiently profile heterogeneity within a brain region or 
810 
genetically defined cell population. Such a combined approach could also help to characterize 
811 
known cell types for which specific driver lines are not yet available or help to identify and 
812 
exclude contributions from “off-target” cells to a bulk profile. Finally, the complementarity 
813 
between bulk and single-cell measurements extends to other genomic features that can be 
814 
measured in TAPIN-seq purified nuclei, including accessible chromatin and modified histones. 
815 
We expect this combination of genomic tools to help decipher the transcriptional and epigenetic 
816 
regulation of neuronal expression programs. 
817 
 
818 
Transcriptome measurements can be of limited utility because it is challenging to interpret 
819 
relative transcript abundance. In this study we developed a probabilistic mixture modeling 
820 
approach to classify relative abundances into binary on and off states. This model was a useful 
821 
guide for interpreting our measurements; most genes are readily described with the two-state 
822 
model, although the expression of some genes is not (e.g., Rab11; Figure 3 - Supplemental 
823 
1L). Even for specific genes whose expression is more continuous than bimodal, the results still 
824 
offer a useful family-wide summary of expression patterns. For example, DPR family members 
825 
are more broadly expressed than DIP genes (Figure 4C; Figure 4 - Supplemental 1D), an 
826 
observation supported by two recent studies using different methods (Cosmanescu et al., 2018; 
827 
Venkatasubramanian et al., 2019). Despite our model’s utility, it is important to remember the 
828 
many potential sources of error (minor cell types in driver line patterns, transcript carry over 
829 
during TAPIN, biases in RNA-seq library construction and sequencing, etc.) that can affect 
830 
measurements of relative transcript abundance and the resulting model inferences. Having 
831 
observed most discrepancies between our modeling results and protein-level expression near 
832 
the boundary between on and off states, it is prudent to treat these cases more carefully. 
833 

 
 
 
Page 35 of 83 
2019 Dec 27 
 
834 
Our resource provides additional foundation for systematic functional and molecular studies of 
835 
the Drosophila visual system. We illustrated how the resource can characterize 
836 
neurotransmission 
in 
the 
network, 
particularly 
when 
combined 
with 
connectome 
837 
information detailing connectivity between cell types as well as the grouping of post-synaptic 
838 
partner cell types. We predict neurotransmitters used by every cell we profiled and found two 
839 
likely cases of co-transmission (Figure 6A). The expression patterns of the major fast-acting 
840 
transmitters histamine, acetylcholine, glutamate and GABA were comparatively simple: Nearly 
841 
all neuronal cell types in our catalogue appear to express exactly one of these four transmitters. 
842 
However, the transcriptomes suggest that many cells also have the potential to release specific 
843 
neuropeptides, other chemical messengers such as nitric oxide, or form gap junctions with other 
844 
cells.  
845 
 
846 
While selected transmitter markers (e.g., Gad1 or VGlut) could also be assigned to cell types 
847 
using methods such as immunolabeling or FISH, these approaches are not practical for 
848 
comprehensive sampling of markers across these different modes of cell-cell communication. 
849 
This is particularly clear when the expression patterns of neurotransmitter receptors are also 
850 
considered (Figure 7A). Our results suggest that, for canonical small molecule transmitters, 
851 
neurotransmitter output space is tightly tuned while input space is not: neurons typically send 
852 
just one type of signal but can receive many (Figures 6,7). The expression patterns of 
853 
neurotransmitter receptors provide further context for determining circuit mechanisms (Figure 7 
854 
– Supplemental 1, Figure 8, 9). Our results also implicate transcription factors involved in 
855 
regulating neurotransmitter phenotype, including several that appear to have conserved roles in 
856 
specifying neuronal identity in other species (Figure 6 - Supplemental 1). 
857 
 
858 

 
 
 
Page 36 of 83 
2019 Dec 27 
The availability of connectivity data for many neurons in the visual system allowed us to 
859 
interpret neurotransmitter use and receptor distribution in the context of circuit architecture 
860 
(Takemura et al., 2013; Takemura et al., 2015; Rivera-Alba et al., 2011). For example, our data 
861 
show expression of both histaminergic and cholinergic markers in R8 photoreceptors. We 
862 
further find that some major synaptic targets of R8 cells, as identified by electron microscopy, do 
863 
not express known receptors for histamine (Figure 8F). Given that R7 and R8 cells were 
864 
previously thought to be exclusively histaminergic both results are unexpected and individually 
865 
might appear difficult to explain (Gao et al., 2008). However, in combination, these findings 
866 
make a strong case for a dual histaminergic and cholinergic transmitter phenotype of R8 cells. 
867 
In contrast, R7 only expresses the histaminergic marker Hdc, and all of its targets express a 
868 
histamine receptor (Figure 8G). 
869 
 
870 
Finally, our approach especially complements ongoing efforts to map circuit connectivity, which 
871 
is complete for C. elegans, and is becoming accessible on a whole brain level for Drosophila 
872 
(Zheng et al., 2018), and for portions of the mouse brain such as the retina. Methods to obtain 
873 
and interpret serial electron micrographs, array tomography and other methods for mapping 
874 
connectivity are rapidly progressing (Swanson and Lichtman, 2017. Micheva and Smith, 2007 
875 
Kebschull et al 2016). All told, we are entering a period in neuroscience where connectomics 
876 
will become pivotal. We expect that genomic approaches, such as the methods for data 
877 
collection and analysis that we describe here, will enhance these efforts by using transcriptomes 
878 
to provide, at high-throughput, a molecular proxy for physiological features that are otherwise 
879 
inaccessible to connectomic methods. 
880 
 
881 
 
882 

 
 
 
Page 37 of 83 
2019 Dec 27 
METHODS 
883 
All reagents and other resources are listed in the Key Resource Table (Supplementary File 2). A 
884 
detailed 
description 
of 
split-GAL4 
hemidrivers 
885 
(https://bdsc.indiana.edu/stocks/gal4/split_intro.html ) and cell-type specific split-GAl4 lines is 
886 
available online (https://www.janelia.org/split-GAL4). 
887 
 
888 
EXPERIMENTAL MODELS AND SUBJECT DETAILS 
889 
Flies were reared on standard cornmeal/molasses food at 25°C. For profiling experiments 
890 
adults, 4-7 days of age, were entrained to a 12:12 light:dark cycle and anesthetized by CO2 at 
891 
ZT8 - ZT12. Samples can be stored indefinitely at -80°C after flash freezing in liquid N2. We 
892 
used female flies for all anatomical characterizations. 
893 
 
894 
METHOD DETAILS 
895 
Anatomical analyses 
896 
Details of individual genotypes and labeling methods used in the characterization of the driver 
897 
lines and other anatomical experiments are summarized in Table S5. Details of the driver lines 
898 
are provided in Table S1. For the naming of RNA-seq samples, we identified all drivers with a 
899 
main cell type or cell types (e.g., Mi9_d1). Most of these cell types have been described in detail 
900 
and were identified based on prior descriptions (for details see Table S1; Takemura et al., 2013; 
901 
Gao et al., 2008; Nern et al., 2015; Fischbach and Dittrich 1989; Tuthill et al., 2013; Aso et al., 
902 
2014; Wu et al., 2016; Wolff and Rubin 2018; Wolff et al., 2015; Edwards et al., 2012; Helfrich-
903 
Förster et al., 2007; Panser et al., 2016; Mauss et al., 2015). The driver names do not attempt to 
904 
include additional cells present in some drivers. A few of our cell types are strictly groups of 
905 
related cell types (for example, the muscle cells or, at a different level of a cell type hierarchy, 
906 

 
 
 
Page 38 of 83 
2019 Dec 27 
the T4 and T5 cells, with four subtypes each, or R7 photoreceptor neurons, which include R7s 
907 
of pale and yellow ommatidia). 
908 
 
909 
Generation and characterization of new driver lines 
910 
Split-GAL4 and GAL4 driver lines (Table S1) were used to express UNC84-2XGFP in defined 
911 
cell populations. Previously published driver lines were from the following studies (see Table S1 
912 
for details; Tuthill et al., 2013; Diao et al., 2014; Aso et al., 2014; Wu et al., 2016; Strother et al., 
913 
2017; Park et al., 2003; Rulifson et al., 2002; Tayler et al., 2012; Taghert et al., 2001; Brand and 
914 
Perrimon, 1993; Wu et al., 2003; Park et al., 2000; Sweeney et al., 1995; Wolff and Rubin 2018; 
915 
von Reyn et al., 2017).  New split-GAl4 lines were generated as in previous work (Tuthill et al 
916 
2013, Wu et al 2016). Briefly, we first identified GAL4 lines with expression in the cell type of 
917 
interest by screening images of the expression patterns of large collections of such lines (Jenett 
918 
et al., 2012; Tirian and Dickson, 2017). Typically, several candidate combinations of AD- and 
919 
DBD-hemidrivers were tested to identify lines with sufficient specificity. 
920 
 
921 
To characterize new driver lines, we examined both overall expression pattern in the brain and 
922 
optic lobe and, for most lines, confirmed the identity of the main cell type or types using 
923 
MultiColor FlpOut (MCFO)-labeled single cells (Nern et al 2015). Since details of the expression 
924 
patterns of GAL4 or split-GAL4 driver lines can depend on the particular UAS reporter used, we 
925 
re-imaged 20 drivers with the TAPIN nuclear marker used for the profiling experiments (Figure 
926 
2A). In general, the distribution of labeled nuclei in these images appeared to match the 
927 
expression patterns and specificity expected from the driver line’s original characterization using 
928 
a membrane marker. As expected, a small number of off-target cells were detectable (often 
929 
more weakly labeled) in many driver lines. 
930 

 
 
 
Page 39 of 83 
2019 Dec 27 
 
931 
Validation experiments 
932 
For validation experiments, we examined expression patterns of tagged proteins expressed in a 
933 
near native genomic context using either large BAC-transgenes or modifications of the 
934 
endogenous loci (Nagarkar-Jaiswal et al., 2015; Diao et al., 2015; Kudron et al., 2018; Lee et 
935 
al., 2018).  
936 
 
937 
We classified fkh-GFP and Ets65A-GFP as expressed or not expressed by visually comparing 
938 
nuclear GFP signal in cells of interest (identified using a split-GAL4 driver) to background 
939 
labeling in surrounding cells. Because of considerable differences in the GFP signal for different 
940 
cell types, confocal settings and post-imaging adjustments were done individually for different 
941 
cell types for these experiments.  
942 
 
943 
The following transgenes were used (also see Table S5):  
944 
PBac{y[+mDint2] w[+mC]=fkh-GFP.FPTB}VK00037 (RRID:BDSC_43951), 
945 
 PBac{y[+mDint2] w[+mC]=Ets65A-GFP.FLAG}VK00037 (RRID:BDSC_38640), Mi{PT-
946 
GFSTF.0}Nos[MI09718-GFSTF.0] (RRID:BDSC_60278), Mi{Trojan-GAL4.1}Oamb[MI12417-
947 
TG4.1] (RRID:BDSC_67506), Mi{Trojan-GAL4.1}Lim3[MI03817-TG4.1] (RRID:BDSC_67450), 
948 
Mi{PT-GFSTF.1}klg[MI02135-GFSTF.1] (RRID:BDSC_59787), Mi{PT-
949 
GFSTF.2}GluClalpha[MI02890-GFSTF.2] (RRID:BDSC_60533), Mi{PT-GFSTF.0}TfAP-
950 
2[MI04611-GFSTF.0] (RRID:BDSC_61776),  
951 
Mi{Trojan-GAL4.2}kn[MI15480-TG4.2] (RRID:BDSC_67516) 
952 
pJFRC12-10XUAS-IVS-myr::GFP in attP2 (RRID:BDSC_32197), pJFRC19-13XLexAop2-IVS-
953 
myr::GFP in su(Hw)attP8 (RRID:BDSC_32211), 
954 
 and pJFRC21-10XUAS-IVS-mCD8::RFP in attP18. 
955 

 
 
 
Page 40 of 83 
2019 Dec 27 
 
956 
The 
VAChT-FRT-STOP-FRT-HA 
transgene 
(TI{TI}VAChT[FRT-STOP-FRT.HA] 
957 
(RRID:BDSC_76021) described in (Pankova and Borst, 2017) was used to examine VAChT 
958 
expression in photoreceptor neurons. Flp-recombinase, either sens-FLP (expressed in R8 cells; 
959 
Chen et al., 2014) ( fly stock w[*] P{y[+t7.7] w[+mC]=sens-FLPG5.C}attP18; wg[Sp-1]/CyO; 
960 
sens[Ly-1]/TM6B, Tb[1] (RRID:BDSC_55768) or ey3.5FLP (expressed in all R-cells; Bazigou et 
961 
al., 2007) (fly stock P{w[+mC]=ey3.5-FLP.B}1, y[1] w[*]; CyO/In(2LR)Gla, wg[Gla-1] PPO1[Bc] 
962 
(RRID:BDSC_35542) was used to induce VAChT stop-cassette excision. 
963 
 
964 
Histology 
965 
Visualization of split-GAL4 driver line expression patterns with pJFRC51-3XUAS-IVS-Syt::smHA 
966 
in su(Hw)attP1 and pJFRC225-5XUAS-IVS-myr::smFLAG in VK00005 (Nern et al., 2015) or, in 
967 
a few cases, 20XUAS-CsChrimson-mVenus in attP18 (Klapoetke et al., 2014) as reporters was 
968 
performed as described (Aso et al., 2014; Wu et al, 2016). Detailed protocols are also available 
969 
online (https://www.janelia.org/project-team/flylight/protocols under “IHC - Anti-GFP”, “IHC - 
970 
Polarity Sequential” and “DPX mounting”). Multicolor Flp-out (MCFO) markers were detected by 
971 
immunolabeling with antibodies against HA, FLAG and V5 epitopes as described (Nern et al., 
972 
2015). 
Detailed 
protocols 
are 
also 
available 
online 
(https://www.janelia.org/project-
973 
team/flylight/protocols under “IHC - MCFO”. 
974 
 
975 
For other experiments, brains of female flies were dissected in insect cell culture medium 
976 
(Schneider’s Insect Medium, Sigma Aldrich, #S0146) and fixed with 2% PFA (w/v) (prepared 
977 
from a 20% stock solution, Electron Microscopy Sciences: 15713) also in cell culture medium for 
978 
1 h at room temperature. Brains were washed with 0.5 % (v/v) TX-100 (Sigma Aldrich: X100) in 
979 
PBS and incubated in PBT-NGS (5% Goat Serum [ThermoFisher: 16210-064] in PBT) for at 
980 

 
 
 
Page 41 of 83 
2019 Dec 27 
least 30 min. Incubations with primary antibodies and subsequently, after additional PBT 
981 
washes, secondary antibodies, were in PBT-NGS at 4°C overnight. After additional washes with 
982 
PBT and then PBS, brains were mounted in SlowFadeGold (ThermoFisher: S36937) and 
983 
imaged on a Zeiss LSM 710 confocal microscope using 20x 0.8 NA, 40x NA 1.3 or 63x 1.4 NA 
984 
objectives. A few specimens were mounted in DPX following the protocol described in Nern et 
985 
al., 2015. For experiments using only native fluorescence, brains were fixed as above and 
986 
mounted and imaged after the initial post-fixation washes. 
987 
 
988 
Primary antibodies used in each experiment are indicated in Table S5. Primary antibodies were 
989 
anti-GFP rabbit polyclonal (ThermoFisher: A-11122, RRID:AB_221569; used at 1:1000 dilution), 
990 
anti-GFP mouse monoclonal 3E6 (ThermoFisher: A-11120, RRID:AB_221568; dilution 1:100), 
991 
anti-dsRed rabbit polyclonal (Clontech Laboratories, Inc.: 632496, RRID:AB_10013483; dilution 
992 
1:1000), anti-HA rabbit monoclonal C29F4 (Cell Signaling Technologies: 3724S, 
993 
RRID:AB_1549585; dilution 1:300), anti-FLAG rat monoclonal (DYKDDDDK Epitope Tag 
994 
Antibody [L5], Novus Biologicals: NBP1-06712, RRID:AB_1625981; 1:200), DyLight 549 or 
995 
DyLight 550 conjugated anti-V5 mouse monoclonals (AbD Serotec: MCA1360D549GA or 
996 
MCA1360D550GA, RRID:AB_10850329 or RRID:AB_2687576; 1:500 dilution), anti-cockroach 
997 
allatostatin (Ast7) mouse monoclonal 5F10 (Stay et al., 1992) (also detects Drosophila AstA 
998 
(Hergarden et al., 2012); Developmental Studies Hybridoma Bank (DSHB): RRID:AB_528076; 
999 
dilution 1:5), anti-CadN rat monoclonal DN-Ex #8 (DSHB: RRID:AB_528121; dilution 1:20) (Iwai 
1000 
et al., 1997), anti-chaoptin mouse monoclonal 24B10 (DSHB: RRID:AB_528161, dilution 1:20. 
1001 
Fujita et al., 1982) and anti-Brp mouse monoclonal nc82 (Wagh et al., 2006) (DSHB: 
1002 
RRID:AB_2314866; dilution 1:30).  
1003 
  
1004 

 
 
 
Page 42 of 83 
2019 Dec 27 
Secondary antibodies (all from Jackson ImmunoResearch Laboratories, Inc) were DyLight 488-
1005 
AffiniPure Donkey Anti-Mouse IgG (H+L): 715-485-151, 1:500 dilution; DyLight 594 AffiniPure 
1006 
Donkey anti Rabbit IgG (H+L): 711-515-152, 1:300 dilution; Alexa Fluor® 647 AffiniPure Donkey 
1007 
Anti-Rat IgG (H+L): 712-605-153, 1:300 dilution; Alexa Fluor® 594 AffiniPure Donkey Anti-
1008 
Mouse IgG (H+L): 715-585-151,1:300 dilution; Alexa Fluor® 647 AffiniPure Donkey Anti-Mouse 
1009 
IgG (H+L): 715-605-151, 1:300 dilution and Alexa Fluor® 488 AffiniPure Donkey Anti-Rabbit IgG 
1010 
(H+L): 711-545-152, 1:1000 dilution. 
1011 
 
1012 
Image processing 
1013 
Image analyses and processing were mainly done using Fiji (http://fiji.sc) and Vaa3D (Peng et 
1014 
al., 2010). Brightness and contrast were adjusted separately for individual images and channels. 
1015 
Figure panels were assembled using Adobe Indesign. This included selection of fields of view 
1016 
and adjustments of image size. Some images were rotated or mirrored. In some panels with 
1017 
rotated images, empty space outside the original image was filled in with zero pixels. Most of 
1018 
the images in Figure 1 - Supplemental 1C,C’ and Figure 1 - Supplemental 2 show resampled 
1019 
views that were generated from three dimensional image stacks using the Neuronannotator 
1020 
mode of Vaa3D and exported as TIFF format screenshots.  
1021 
 
1022 
INTACT purification of nuclei 
1023 
Frozen adult flies were decapitated by vigorous vortexing. Heads or wings/appendages were 
1024 
then collected on cooled metal sieves (H&C Sieving Systems: 1296, 1297, 1298, 1301). Both 
1025 
flies and purified frozen material can be stored indefinitely at -80°C. In a typical experiment 100-
1026 
500 frozen heads were added to 5ml of 20mM �-glycerophosphate pH7, 200mM NaCl, 2mM 
1027 
EDTA, 0.5% NP40, 0.5mM spermidine, 0.15mM spermine, 1mM DTT, 1X complete protease 
1028 
inhibitor (Sigma: 5056489001), 3mg/ml BSA (ThermoFisher: AM2618), 1mg/ml torula yeast 
1029 

 
 
 
Page 43 of 83 
2019 Dec 27 
RNA (ThermoFisher: AM7118), 0.6mg/ml carboxyl coated Dynabeads (ThermoFisher: 14306D) 
1030 
and 2�g anti-GFP antibody (ThermoFisher: G10362, RRID:AB_2536526). Homogenization was 
1031 
carried out on ice by 50 tractions in a Dounce homogenizer using the tight pestle followed by 
1032 
filtration over a 10�m cup filter (Partec: 0400422314). Released chromatin and broken nuclei 
1033 
were adsorbed to carboxyl coated magnetic beads for 30 minutes at 4°C with constant rotation. 
1034 
Beads were removed on a magnetic stand and the supernatant was diluted to 50ml with 20mM 
1035 
�-glycerophosphate pH7, 200mM NaCl, 2mM EDTA, 0.5% NP40, 0.5mM spermidine, 0.15mM 
1036 
spermine, 1mM DTT and 1X complete protease inhibitor (Sigma: 5056489001), filtered over a 
1037 
1�m cup filter (Pluriselect: 435000103) and split into two equal volumes. A 40% Optiprep 
1038 
(Sigma: D1556), 20mM �-glycerophosphate pH7, 2mM EDTA and 0.5% NP40 solution was 
1039 
then gently placed under each aliquot, followed by a lower layer of 50% Optiprep, 20mM �-
1040 
glycerophosphate pH7, 2mM EDTA and 0.5% NP40. Nuclei were then pelleted on to the 50% 
1041 
layer for 30 minutes at 2300Xg. Purified nuclei were passed over a 10�m cup filter, diluted to 
1042 
10ml with 20mM �-glycerophosphate pH7, 200mM NaCl, 2mM EDTA, 0.5% NP40, 0.5mM 
1043 
spermidine, 0.15mM spermine, 1mM DTT and 1X complete protease inhibitor and incubated 
1044 
with 30�l of protein G Dynabeads (ThermoFisher: 10004D) for 40 minutes on ice with 
1045 
occasional agitation. Bead-bound nuclei were recovered on a magnet stand followed by a 20 
1046 
minute incubation on ice in 9mls of 20mM �-glycerophosphate pH7, 300mM NaCl, 1M urea, 
1047 
0.5% NP40, 2mM EDTA, 0.5mM spermidine, 0.15mM spermine, 1mM DTT, 1X complete 
1048 
protease inhibitor, 0.075mg/ml torula RNA and 0.05U/ml Superasin (ThermoFisher: AM2696). 
1049 
Nuclei were then recovered on a magnet stand, resuspended in 1ml of the previous buffer, 
1050 
passed over a 10�m cup filter, a 5�l aliquot was withdrawn for quantitation and the remainder 
1051 
of the sample solubilized in Arcturus Picopure RNA extraction buffer (ThermoFisher: KIT0204). 
1052 
 
1053 

 
 
 
Page 44 of 83 
2019 Dec 27 
TAPIN purification of nuclei 
1054 
100-3000 frozen heads were added to 5ml of 20mM sodium acetate pH8.5, 2.5mM MgCl2, 
1055 
250mM sucrose, 0.5% NP-40, 0.6mM spermidine, 0.2mM spermine, 1mM DTT, 1X complete 
1056 
protease inhibitor, 0.5mg/ml torula RNA, 0.6mg/ml carboxyl coated Dynabeads and 2�g anti-
1057 
GFP antibody (Table S6). Homogenization was carried out on ice by 50 tractions in a Dounce 
1058 
homogenizer using the tight pestle followed by filtration over either a 10 or 20�m cup filter 
1059 
(Partec: 0400422314 or 040042315). Released chromatin and broken nuclei were adsorbed to 
1060 
carboxyl coated magnetic beads for 30 minutes at 4°C with constant rotation. Unbound antibody 
1061 
was removed by incubating the sample on ice for 20 minutes with 100�l of UNOsphere SUPra 
1062 
resin (Biorad: 1560218), which was previously washed 2X with 500mM sodium acetate 
1063 
ph8.5/0.5% NP40 and 2X 20mM sodium acetate ph8.5/0.5% NP40. After the resin was removed 
1064 
on a 10�m cup filter and the carboxyl beads on a magnet stand, the nuclei-containing 
1065 
supernatant was mixed with an equal volume of 500mM sodium acetate pH8.5, 250mM 
1066 
sucrose, 6mM EGTA, 6mM EDTA, 0.6mM spermidine, 0.2mM spermine, 1mM DTT, 1X 
1067 
complete protease inhibitor, 0.25mg/ml torula yeast RNA and 30�l Protein A Dynabeads 
1068 
(ThermoFisher: 10002D) (Table S6). A 2 hour incubation on ice with occasional agitation was 
1069 
used to recover tagged nuclei. Bead-bound nuclei were then recovered on a magnet stand and 
1070 
washed twice with 250mM sodium acetate ph8.5, 250mM sucrose and 0.1% NP40 (Table S6). 
1071 
Nuclei were then released at 37°C for 1 hour by incubation in 50�l of 10mM Tris pH7.5, 2.5mM 
1072 
MgCl2, 0.5mM CaCl2, 250mM sucrose, 0.1% NP40, 1mg/ml torula RNA, 40 units RNAsin 
1073 
(Promega: N2515), 2 units DNAseI (NEB: M0303L), 320 units IdeZ protease (NEB: P0770S) 
1074 
(Table S6). The sample was diluted to 100�l with 10mM Tris pH7.5, 2.5mM MgCl2, 0.5mM 
1075 
CaCl2, 250mM sucrose and 0.1% NP40, EGTA was added to 1mM and the suspension was 
1076 
rapidly triturated 100 times. After returning the sample to a magnet stand, 90�ls of buffer 
1077 
containing released nuclei was removed and added to 1.5�l of Protein G Dynabeads that were 
1078 

 
 
 
Page 45 of 83 
2019 Dec 27 
previously resuspended in 10�l of 10mM Tris pH7.5, 2.5mM MgCl2, 0.5mM CaCl2, 250mM 
1079 
sucrose and 0.1% NP40. The second binding reaction was run for 1-3 hours on ice with 
1080 
occasional agitation, followed by two 250�l washes in 10mM Tris pH7.5, 2.5mM MgCl2, 0.5mM 
1081 
CaCl2, 250mM sucrose and 0.1% NP40. Prior to the last wash a 5�l aliquot was removed for 
1082 
quantitation and the remainder of the sample was solubilized in Arcturus Picopure RNA 
1083 
extraction buffer. 
1084 
 
1085 
RNA-seq library construction 
1086 
Nuclear RNA was DNAseI (Qiagen: 79254) treated and purified using the Arcturus PicoPure 
1087 
(ThermoFisher: KIT0204) system as instructed by the supplier. Purified RNA was mixed with a 
1088 
1:100,000 dilution of ERCC standard RNA mix #1 (ThermoFisher: 4456740) and amplified using 
1089 
the Nugen Ovation v2 system (Nugen: 7102-32). cDNA was then blunted, ligated to barcoded 
1090 
linkers (Nugen: 0319-32, 0320-32) and sequenced on an Illumina Hiseq 2500 to 50bp read 
1091 
length using Rapid Run flow cells.  
1092 
 
1093 
In total we built 266 RNA-seq libraries, including 46 INTACT-seq, 196 TAPIN-seq, 8 total RNA 
1094 
libraries from dissected tissues, and 16 control libraries that we used to characterize each 
1095 
INTACT/TAPIN-seq step (Figure 2C, Table S1). 
1096 
 
1097 
RNA-seq data processing 
1098 
We trimmed five nucleotides from the 5’ end of reads using seqtk (https://github.com/lh3/seqtk) 
1099 
to remove potential contaminating adapter sequence from the NuGen Ovation kit. We estimated 
1100 
the abundance of annotated genes using kallisto (v0.43.1; Bray et al., 2015) to pseudo-align 
1101 
trimmed reads to the fly transcriptome (cDNA and ncRNA transcript sequences from ENSEMBL 
1102 
release 91, based on FlyBase release 2017_04), ERCC spike-ins, and the INTACT construct 
1103 

 
 
 
Page 46 of 83 
2019 Dec 27 
sequences GAL4-DBD, p65-AD, and UNC84_2XGFP. ERCC, INTACT tag constructs, and 
1104 
rRNA genes were removed from the abundance tables and the estimated abundances of the 
1105 
remaining genes were renormalized to one million total transcripts. The ERCC spike-ins and 
1106 
nuclear yield values allowed us to convert relative transcript abundance (in Transcripts Per 
1107 
Million, TPM) to absolute abundance (Figure 3 - Supplemental 1G). However, we only used 
1108 
relative abundance for our analyses. We also aligned the trimmed reads to the genome using 
1109 
STAR (v2.5.3c; Dobin et al., 2013) and evaluated gene body coverage bias using Picard (v 
1110 
1.9.1; http://broadinstitute.github.io/picard). 
1111 
 
1112 
We used three criteria to quantify the quality of each library: the number of genes detected, the 
1113 
pearson correlation between transcript abundances measured in replicates, and the cDNA yield. 
1114 
We used only high-quality libraries (at least 8,500 genes detected, 3�g cDNA yield, and 0.85 
1115 
Pearson’s correlation of transcript abundances in two biological replicates) as input to the model 
1116 
described below. 
1117 
 
1118 
Comparison to published single cell and FACS-seq datasets 
1119 
We obtained genes reported to mark the single cell clusters in a recent scRNA-seq study of the 
1120 
optic lobe (Konstantinides et al., 2018). We also obtained the cluster assignments for each 
1121 
single cell in this dataset from the SCope database (Davie et al., 2018), using Seurat clustering 
1122 
resolution 4.0, as reported by the authors. We analyzed FACS-sorted RNA-seq samples 
1123 
reported by Konstantinides et al. by downloading the raw sequencing reads from the NCBI 
1124 
Sequence Read Archive (https://www.ncbi.nlm.nih.gov/sra) and estimating transcript abundance 
1125 
using kallisto and the same transcriptome index as above. 
1126 
 
1127 

 
 
 
Page 47 of 83 
2019 Dec 27 
To compare actual and predicted cluster sizes, we used the following numbers for cells per 
1128 
type: Cell types that are thought to be present once (L1, L2, L3, L4, L5, T1, Mi1, T2, T3, Tm2, 
1129 
Tm9, C2,C3, T4a,T4b,T4c,T4d,T5a,T5b,T5c,T5d) or approximately once (Dm8, Tm3) per 
1130 
medulla column based on EM studies (Takemura et al., 2013, 2015, 2017) and light microscopy 
1131 
of specific driver lines (for example, T4/T5 Mauss et al., 2014; lamina cells Tuthill et al., 2013, 
1132 
T4 inputs Strother et al. 2017, Dm8 Nern et al., 2015) were estimated as 1 cell/column * 750 
1133 
columns/medulla * 2 hemispheres = 1500 cells per brain. Estimates for Dm12 (~120 x 2 cells 
1134 
per brain. Nern et al., 2015) and Lawf2 (~140 x 2 cells per brain, Tuthill et al., 2014) were as 
1135 
published. We performed new counts for Pm3 (mean +/- SD 37 +/- 3 cells per optic lobe ; n = 4 
1136 
optic lobes; driver line SS00328) and Lawf1 (151+/-7 cells per optic lobe; n=4 optic lobes; 2 
1137 
optic lobes each for driver lines SS00689 and SS00800). No precise count was available for 
1138 
Tm5c; since this cell type is known to be present in many but not all medulla columns, we used 
1139 
an estimate of 400 cells per optic lobe x 2 hemispheres = 800 cells per brain (Takemura et al., 
1140 
2013; Melnattur et al., 2014; Karuppudurai et al., 2014). 
1141 
 
1142 
To compare our bulk TAPIN-seq profiles to published single cell datasets, we used non-
1143 
negative least squares regression to model each bulk TAPIN-seq profile as a linear weighted 
1144 
sum of single cell clusters and a profile-specific residual (TAPIN ~ cluster). We began with 
1145 
single-cell expression matrices extracted from the loom files deposited in the SCope database, 
1146 
using the SCopeLoomR package (Davie et al., 2018). After normalizing the transcriptome of 
1147 
each cell from transcript counts to counts per million, we calculated the mean transcriptome for 
1148 
each single cell cluster. We then selected genes that were enriched in either single cell clusters 
1149 
or TAPIN-seq cell types, using the following criteria (adapted from Cai et al., 2019): union of the 
1150 
top-50 genes that were most enriched relative to the average of all other clusters (or TAPIN-seq 
1151 
cell types) and the top-50 genes that were most enriched relative to the maximum level in all 
1152 

 
 
 
Page 48 of 83 
2019 Dec 27 
other clusters (or TAPIN-seq cell types). We then performed NNLS regression using the 
1153 
Lawson-Hanson implementation (Lawson and Hanson, 1974) available through the nnls R 
1154 
package (Mullen and van Stokkum, 2012). To visualize the results, we created heatmaps of the 
1155 
regression coefficients, normalizing the values for each single cell cluster across TAPIN-seq cell 
1156 
types. 
1157 
 
1158 
We also performed the NNLS regression in the opposite direction (cluster ~ TAPIN, explaining 
1159 
single cell clusters as combination of TAPIN-seq profiles), as we thought this direction would 
1160 
more naturally describe mixed clusters composed of multiple cell types (e.g., all photoreceptors, 
1161 
or all monopolar cells). In practice however, this regression assigned coefficients of exactly zero 
1162 
to several TAPIN-seq profiles – as expected given the power of NNLS to recover sparse 
1163 
solutions (Slawski and Hein, 2013) and the collinearity amongst TAPIN-seq profiles (e.g., highly 
1164 
correlated expression amongst photoreceptor subtypes). In contrast, the TAPIN ~ cluster 
1165 
regression correctly matched mixed clusters with the corresponding TAPIN-seq profiles. 
1166 
 
1167 
Inferring expression state from transcript abundance 
1168 
We begin with a catalog of S RNA-seq samples generated from nuclei isolated from cell type 
1169 
cell(s) and the estimated abundance (in TPM), 
 of transcripts from gene  in each sample . 
1170 
We consider only protein-coding genes with at least 10 TPM abundance in at least one sample 
1171 
(n=12,377 of 13,931 total coding genes). 
1172 
 
1173 
To interpret 
, we assume that all genes express in either an 'on' or an 'off' state. Our goal is 
1174 
to infer from these abundances the probability that each gene is expressed in each cell type, 
1175 
. Depending on the cell types in our catalog, we will observe some genes in both on 
1176 

 
 
 
Page 49 of 83 
2019 Dec 27 
and off states (bimodal), while others are exclusively off (unimodal-off) or on (unimodal-on). We 
1177 
deal with these scenarios in turn below. 
1178 
 
1179 
Assuming that a gene is bimodal, we model its expression as arising from a mixture of two 
1180 
gene-specific log-normal distributions describing expression in cells where the gene is off, 
1181 
, and those where the gene is on, 
, combined with a mixing weight, 
1182 
. We use the same standard deviation for both on and off distributions to ensure a monotonic 
1183 
relationship between transcript abundance and the posterior probability of the on state. If we 
1184 
use different standard deviations for each component distribution, the wider one would become 
1185 
more probable than the narrower one at both low and high expression levels. 
1186 
 
1187 
 
1188 
 
1189 
We estimate the posterior probability of the on state (assuming bimodal expression): 
1190 
 
1191 
 
1192 
 
1193 
We treated each replicate sample of the same driver as an independent probe of the same 
1194 
underlying driver-line expression state. To combine replicates of the same driver we sum over 
1195 
their likelihoods: 
1196 
 
1197 
 
1198 
Similarly, to combine samples from the same cell type we sum over their likelihoods: 
1199 

 
 
 
Page 50 of 83 
2019 Dec 27 
 
1200 
 
1201 
We estimated parameters for each gene-specific mixture model by maximizing the likelihood for 
1202 
the observed sample-level data: 
1203 
 
1204 
 
1205 
 
1206 
Because we assume independence of genes, we separately optimized the model parameters 
1207 
for each gene. To model the possibility that a gene is unimodally expressed across the cell 
1208 
types we analyzed, we also model the data using a single log-normal distribution, estimating the 
1209 
distribution parameters μ and σ and estimating the data likelihood as: 
1210 
 
1211 
 
1212 
 
1213 
Deciding whether a gene is bimodally or unimodally expressed is an example of the model 
1214 
selection problem in statistics. To compare the quality of the unimodal and bimodal models for 
1215 
each gene, we used a recently developed approach to leave-one-out cross-validation that uses 
1216 
Pareto-smoothed importance sampling (PSIS-LOO; Vehtari et al., 2016). Specifically, we 
1217 
performed 10-fold cross validation, by randomly holding out 1/10 of the samples as a “test” set 
1218 
(requiring that at least one replicate of each driver exist in the remaining “training” set), fitting the 
1219 
models using only the training data, and then evaluating the likelihood of the test data using the 
1220 
fitted parameters. Each of the ten cross-validation fits, i, returns an ensemble of S=500 draws 
1221 
from the posterior distribution of the model parameters. We estimated the expected log 
1222 

 
 
 
Page 51 of 83 
2019 Dec 27 
pointwise predictive density (elpd) of each cross-validation fit by evaluating the likelihood of 
1223 
each held-out dataset i using each parameter draw s : 
1224 
 
1225 
 
1226 
We then combined the pointwise log-likelihoods for each cross-validation fit to calculate a single 
1227 
estimate 
for 
each 
model: 
1228 
 
1229 
 
1230 
To compare the unimodal and bimodal models, we calculated the difference in elpd as well as 
1231 
its standard error: 
1232 
 
1233 
 
1234 
 
1235 
We then picked the model with the higher elpd, unless the difference in elpd was within two 
1236 
multiples of its standard error (
, corresponding approximately to the 
1237 
half-width of a 95% confidence interval in a normal sampling distribution) in which case we 
1238 
considered the two models’ performance to be indistinguishable and chose the simpler 
1239 
unimodal model. 
1240 
 
1241 
If we decide a gene is unimodal, we must still decide if it is expressed or not. To model the 
1242 
expression state of unimodal genes, we created two separate log-normal distributions of 
1243 
abundances of confidently bimodal genes (
) using samples where they were either 
1244 
estimated to be on according to the bimodal model (
 > 0.9) and where they 
1245 

 
 
 
Page 52 of 83 
2019 Dec 27 
were estimated to be off (
 < 0.1), combined with a mixing weight, , set to 
1246 
the fraction of datapoints that were estimated to be “on” according to the bimodal model. 
1247 
 
1248 
 
1249 
 
1250 
We estimate the posterior probability of the on state assuming unimodal expression as: 
1251 
 
1252 
 
1253 
To build the final matrix of 
 calls, we used bimodal estimates for genes where the 
1254 
bimodal model was a better fit than the unimodal model, and the unimodal estimates for the 
1255 
remaining genes. 
1256 
 
1257 
  
1258 
 
1259 
We did not include the transcriptomes of the dissected samples in the mixture models because 
1260 
we were concerned that their cellular heterogeneity would violate our assumption of binary gene 
1261 
expression in each sample. That is, genes expressed in a subset of the cells of a dissected 
1262 
sample would give rise to transcript abundance intermediate between the off and on states, and 
1263 
thus make it more difficult to accurately infer the component distributions. However, in some 
1264 
cases the dissected samples could be useful for interpreting transcript levels in the cells that we 
1265 
profiled, by providing examples that extend the observed dynamic range. For example, in the 
1266 
case of a gene expressed in a dissected tissue, but not in the cells that we specifically profiled, 
1267 
the dissected levels would add “on” examples that would make it easier to interpret the levels in 
1268 

 
 
 
Page 53 of 83 
2019 Dec 27 
the cell types as “off”. To use the dissected samples to better model dynamic range, we added 
1269 
two “dummy” samples to each model: the minimum and maximum observed level across both 
1270 
the cell catalog and the dissected samples. This choice allowed us to use the dissected levels if 
1271 
they in fact outflanked the cell type-specific levels, while not confusing the model with 
1272 
intermediate abundance levels. Once the models were fit, we could use the inferred parameters 
1273 
to estimate expression probabilities for samples that were not used in the model fit. For 
1274 
example, we estimated the probabilities of expression in the dissected samples to search for 
1275 
genes expressed exclusively in the dissected samples and not in the anatomically defined cell 
1276 
type libraries, indicating potential markers for cells that we did not specifically profile. 
1277 
 
1278 
We implemented all models using RStan (Stan Development Team, 2017; Carpenter et al., 
1279 
2017) to infer the posterior distribution of unknown parameters using hamiltonian Markov chain 
1280 
Monte Carlo. We used the same weak prior (N(7,5)) for the mean log-expression levels of both 
1281 
on and off components, allowing us to use Stan’s positive_ordered data type to describe the 
1282 
location of the two components. The models were sampled using 4 independent Markov chains, 
1283 
each run for 500 iterations. Additional details of the model fitting procedure can be found in the 
1284 
STAN files specifying the model and the R code that calls the model fitting procedures (github 
1285 
repository http://github.com/fredpdavis/opticlobe). 
1286 
 
1287 
Evaluating model accuracy 
1288 
To evaluate the accuracy of the mixture modeling approach we created a benchmark set of 
1289 
expression data extracted from FlyBase. Specifically, we queried the FlyBase website 
1290 
(http://flybase.org) for genes expressed in the optic lobe or the photoreceptor. The resulting 
1291 
benchmark set included 193 positive and 4 negative expression datapoints. We quantified the 
1292 
model’s accuracy on this benchmark in two ways. First, we quantified concordance between the 
1293 

 
 
 
Page 54 of 83 
2019 Dec 27 
benchmark expression state and our model’s inferred state. Second, we computed the 
1294 
cumulative distribution function of the inferred probabilities of expression for the positive 
1295 
benchmark datapoints. 
1296 
 
1297 
Expression-based tree of cell types 
1298 
To study cell relationships, we used phylogenetic tree-building to compare their expression 
1299 
profiles. We first selected a subset of genes with on-component means of at least exp(3) ~ 21 
1300 
TPM and difference between on and off components of at least exp(1.5) ~ 4.5 fold. We then 
1301 
encoded the expression profile of each cell as a “sequence” of expression states, where each 
1302 
position represents a gene, and the character indicates the gene is expressed (“A”, P(z_gc=on 
1303 
> 0.8)), not expressed (“C”, P(z_gc=on < 0.2)), or its expression is uncertain (“N”; 0.2 < P(z_gc 
1304 
= on) < 0.8). We computed the Hamming distance between pairs of expression “sequences” 
1305 
considering only unambiguous positions, using the dist.dna() routine in the ape R package 
1306 
(Paradis et al., 2004). We then used the minimum evolution approach to estimate the 
1307 
“phylogeny” of the cells, using the balanced weighting scheme (Desper and Gascuel, 2002), as 
1308 
implemented in the ape fastme.bal() routine. We then built trees from 1000 bootstrapped 
1309 
replicates and quantified the support for each branch on the original tree. We visualized the tree 
1310 
using the phytools R package (Revell 2012). 
1311 
 
1312 
Identifying marker genes 
1313 
We identified marker genes specifically enriched in individual cell types and groups of cells 
1314 
(photoreceptor, glia, muscle, neuron) by searching for genes inferred to be almost exclusively 
1315 
expressed in a single cell type or cell group (p(on) >= 0.9 for all cells within a group, and at most 
1316 
two cells outside a group) and with transcript abundance higher than all cells outside the group. 
1317 
 
1318 

 
 
 
Page 55 of 83 
2019 Dec 27 
Evaluating expression patterns for genes with different functions 
1319 
We used FlyBase Gene Groups (release 2018_02) to assign functions to genes, and 
1320 
considered the most terminal groups in the hierarchy that had at least 10 genes. 
1321 
 
1322 
Mapping receptor expression onto synapses 
1323 
To map receptor expression onto synaptic connectivity, we first obtained synapse pairs from 
1324 
Takemura et al., to identify synaptic targets of R8 (cell #111), R7 (cell #205), and C2 (cell #214) 
1325 
cells in the medulla (Takemura et al., 2013). When multiple instances of a cell type were 
1326 
available in the synaptic table, we chose the one with the greatest number of synaptic partners. 
1327 
For target cell types that we profiled with TAPIN/INTACT-seq, we discretized their expression as 
1328 
either on (p(on) >= 0.8) or off (p(on) < 0.8). For cell types that we did not profile, we classified 
1329 
them as unknown receptor expression. 
1330 
 
1331 
DATA AND SOFTWARE AVAILABILITY 
1332 
All raw and processed transcriptome data is available from NCBI GEO (accession GSE116969). 
1333 
The shell scripts used to process the raw RNA-seq data, and the R and Stan programs that 
1334 
implement the mixture model as well as generate all figures and tables in this paper are 
1335 
available at github (http://github.com/fredpdavis/opticlobe). The cell type-level expression table 
1336 
can be explored interactively at http://www.opticlobe.com.  
1337 
 
1338 
ACKNOWLEDGEMENTS 
1339 
This project was supported by the Howard Hughes Medical Institute. FPD was supported in part 
1340 
by the Intramural Research Program of the National Institute of Arthritis and Musculoskeletal 
1341 
and Skin Diseases of the National Institutes of Health. We would like to thank Teresa Tian and 
1342 
all members of the Janelia Fly Facility for their help in maintaining and rearing flies, Tanya Wolff 
1343 

 
 
 
Page 56 of 83 
2019 Dec 27 
and Arnim Jenett for the central complex and Heather Dionne for the l-LNv split-GAL4 lines, and 
1344 
the FlyLight Project Team for imaging of split-GAL4 expression patterns. 
1345 
 
 
1346 

 
 
 
Page 57 of 83 
2019 Dec 27 
 
1347 
REFERENCES 
1348 
Alejevski, F., Saint-Charles, A., Michard-Vanhée, C., Martin, B., Galant, S., Vasiliauskas, D., 
1349 
and Rouyer, F. (2019). The HisCl1 histamine receptor acts in photoreceptors to synchronize 
1350 
Drosophila behavioral rhythms with light-dark cycles. Nature Communications 10, 252. 
1351 
Amrein, H., and Axel, R. (1997). Genes expressed in neurons of adult male Drosophila. Cell 88, 
1352 
459–469. 
1353 
Apitz, H., and Salecker, I. (2014). A challenge of numbers and diversity: neurogenesis in the 
1354 
Drosophila optic lobe. J. Neurogenet. 28, 233–249. 
1355 
Apitz, H., and Salecker, I. (2018). Spatio-temporal relays control layer identity of direction-
1356 
selective neuron subtypes in Drosophila. Nature Communications 9, 2295. 
1357 
Arenz, A., Drews, M.S., Richter, F.G., Ammer, G., and Borst, A. (2017). The Temporal Tuning of 
1358 
the Drosophila Motion Detectors Is Determined by the Dynamics of Their Input Elements. Curr. 
1359 
Biol. 27, 929–944. 
1360 
Aso, Y., Hattori, D., Yu, Y., Johnston, R.M., Iyer, N.A., Ngo, T.-T.B., Dionne, H., Abbott, L.F., 
1361 
Axel, R., Tanimoto, H., et al. (2014). The neuronal architecture of the mushroom body provides 
1362 
a logic for associative learning. Elife 3, e04577. 
1363 
Barnstedt, O., Owald, D., Felsenberg, J., Brain, R., Moszynski, J.-P., Talbot, C.B., Perrat, P.N., 
1364 
and Waddell, S. (2016). Memory-Relevant Mushroom Body Output Synapses Are Cholinergic. 
1365 
Neuron 89, 1237–1247. 
1366 
Bazigou, E., Apitz, H., Johansson, J., Lorén, C.E., Hirst, E.M.A., Chen, P.-L., Palmer, R.H., and 
1367 
Salecker, I. (2007). Anterograde Jelly belly and Alk receptor tyrosine kinase signaling mediates 
1368 
retinal axon targeting in Drosophila. Cell 128, 961–975. 
1369 
Belote, J.M., Handler, A.M., Wolfner, M.F., Livak, K.J., and Baker, B.S. (1985). Sex-specific 
1370 
regulation of yolk protein gene expression in Drosophila. Cell 40, 339–348. 
1371 
Brand, A.H., and Perrimon, N. (1993). Targeted gene expression as a means of altering cell 
1372 
fates and generating dominant phenotypes. Development 118, 401–415. 
1373 

 
 
 
Page 58 of 83 
2019 Dec 27 
Cao, J., Spielmann, M., Qiu, X., Huang, X., Ibrahim, D.M., Hill, A.J., Zhang, F., Mundlos, S., 
1374 
Christiansen, L., Steemers, F.J., et al. (2019). The single-cell transcriptional landscape of 
1375 
mammalian organogenesis. Nature 566, 496–502. 
1376 
Carpenter, B., Gelman, A., Hoffman, M.D., Lee, D., Goodrich, B., Betancourt, M., Brubaker, M., 
1377 
Guo, J., Li, P., and Riddell, A. (2017). Stan: A Probabilistic Programming Language. Journal of 
1378 
Statistical Software 76, 1–32. 
1379 
Carrillo, R.A., Özkan, E., Menon, K.P., Nagarkar-Jaiswal, S., Lee, P.-T., Jeon, M., Birnbaum, 
1380 
M.E., Bellen, H.J., Garcia, K.C., and Zinn, K. (2015). Control of Synaptic Connectivity by a 
1381 
Network of Drosophila IgSF Cell Surface Proteins. Cell 163, 1770–1782. 
1382 
Chen, Y., Akin, O., Nern, A., Tsui, C.Y.K., Pecot, M.Y., and Zipursky, S.L. (2014). Cell-type-
1383 
specific labeling of synapses in vivo through synaptic tagging with recombination. Neuron 81, 
1384 
280–293. 
1385 
Cosmanescu, F., Katsamba, P.S., Sergeeva, A.P., Ahlsen, G., Patel, S.D., Brewer, J.J., Tan, L., 
1386 
Xu, S., Xiao, Q., Nagarkar-Jaiswal, S., et al. (2018). Neuron-Subtype-Specific Expression, 
1387 
Interaction Affinities, and Specificity Determinants of DIP/Dpr Cell Recognition Proteins. Neuron 
1388 
100, 1385-1400.e6. 
1389 
Crocker, A., Guan, X.-J., Murphy, C.T., and Murthy, M. (2016). Cell-Type-Specific 
1390 
Transcriptome Analysis in the Drosophila Mushroom Body Reveals Memory-Related Changes 
1391 
in Gene Expression. Cell Rep 15, 1580–1596. 
1392 
Croset, V., Treiber, C.D., and Waddell, S. (2018). Cellular diversity in the Drosophila midbrain 
1393 
revealed by single-cell transcriptomics. Elife 7. 
1394 
Davie, K., Janssens, J., Koldere, D., De Waegeneer, M., Pech, U., Kreft, Ł., Aibar, S., 
1395 
Makhzami, S., Christiaens, V., Bravo González-Blas, C., et al. (2018). A Single-Cell 
1396 
Transcriptome Atlas of the Aging Drosophila Brain. Cell. doi:10.1016/j.cell.2018.05.057 
1397 
Deal, R.B., and Henikoff, S. (2010). A simple method for gene expression and chromatin 
1398 
profiling of individual cell types within a tissue. Dev. Cell 18, 1030–1040. 
1399 
Desper, R., and Gascuel, O. (2002). Fast and Accurate Phylogeny Reconstruction Algorithms 
1400 
Based on the Minimum-Evolution Principle. Journal of Computational Biology 9, 687–705. 
1401 

 
 
 
Page 59 of 83 
2019 Dec 27 
Diao, F., Ironfield, H., Luan, H., Diao, F., Shropshire, W.C., Ewer, J., Marr, E., Potter, C.J., 
1402 
Landgraf, M., and White, B.H. (2015). Plug-and-play genetic access to drosophila cell types 
1403 
using exchangeable exon cassettes. Cell Rep 10, 1410–1421. 
1404 
Dionne, H., Hibbard, K.L., Cavallaro, A., Kao, J.-C., and Rubin, G.M. (2018). Genetic Reagents 
1405 
for Making Split-GAL4 Lines in Drosophila. Genetics 209, 31–35. 
1406 
Dobin, A., Davis, C.A., Schlesinger, F., Drenkow, J., Zaleski, C., Jha, S., Batut, P., Chaisson, 
1407 
M., and Gingeras, T.R. (2013). STAR: ultrafast universal RNA-seq aligner. Bioinformatics 29, 
1408 
15–21. 
1409 
Dolan, M.-J., Luan, H., Shropshire, W.C., Sutcliffe, B., Cocanougher, B., Scott, R.L., Frechter, 
1410 
S., Zlatic, M., Jefferis, G.S.X.E., and White, B.H. (2017). Facilitating Neuron-Specific Genetic 
1411 
Manipulations in Drosophila melanogaster Using a Split GAL4 Repressor. Genetics 206, 775–
1412 
784. 
1413 
Ecker, J.R., Geschwind, D.H., Kriegstein, A.R., Ngai, J., Osten, P., Polioudakis, D., Regev, A., 
1414 
Sestan, N., Wickersham, I.R., and Zeng, H. (2017). The BRAIN Initiative Cell Census 
1415 
Consortium: Lessons Learned toward Generating a Comprehensive Brain Cell Atlas. Neuron 
1416 
96, 542–557. 
1417 
Edwards, T.N., Nuschke, A.C., Nern, A., and Meinertzhagen, I.A. (2012). Organization and 
1418 
metamorphosis of glia in the Drosophila visual system. J. Comp. Neurol. 520, 2067–2085. 
1419 
Fischbach, K.F., and Dittrich, A.P.M. (1989). The optic lobe of Drosophila melanogaster. I. A 
1420 
Golgi analysis of wild-type structure. Cell and Tissue Research 258, 441–475. 
1421 
Fujita, S.C., Zipursky, S.L., Benzer, S., Ferrús, A., and Shotwell, S.L. (1982). Monoclonal 
1422 
antibodies against the Drosophila nervous system. Proc. Natl. Acad. Sci. U.S.A. 79, 7929–7933. 
1423 
Gao, S., Takemura, S., Ting, C.-Y., Huang, S., Lu, Z., Luan, H., Rister, J., Thum, A.S., Yang, 
1424 
M., Hong, S.-T., et al. (2008). The Neural Substrate of Spectral Preference in Drosophila. 
1425 
Neuron 60, 328–342. 
1426 
Gisselmann, G., Plonka, J., Pusch, H., and Hatt, H. (2004). Drosophila melanogaster GRD and 
1427 
LCCH3 subunits form heteromultimeric GABA-gated cation channels. Br. J. Pharmacol. 142, 
1428 
409–413. 
1429 
Hardie, R.C. (1987). Is histamine a neurotransmitter in insect photoreceptors? J. Comp. Physiol. 
1430 
A 161, 201–213. 
1431 

 
 
 
Page 60 of 83 
2019 Dec 27 
Helfrich-Förster, C., Shafer, O.T., Wülbeck, C., Grieshaber, E., Rieger, D., and Taghert, P. 
1432 
(2007). Development and morphology of the clock-gene-expressing lateral neurons of 
1433 
Drosophila melanogaster. J. Comp. Neurol. 500, 47–70. 
1434 
Henry, G.L., Davis, F.P., Picard, S., and Eddy, S.R. (2012). Cell type-specific genomics of 
1435 
Drosophila neurons. Nucleic Acids Res. 40, 9691–9704. 
1436 
Hergarden, A.C., Tayler, T.D., and Anderson, D.J. (2012). Allatostatin-A neurons inhibit feeding 
1437 
behavior in adult Drosophila. Proc. Natl. Acad. Sci. U.S.A. 109, 3967–3972. 
1438 
Hobert, O. (2016). Terminal Selectors of Neuronal Identity. Curr. Top. Dev. Biol. 116, 455–475. 
1439 
Hu, W., Wang, T., Wang, X., and Han, J. (2015). Ih Channels Control Feedback Regulation 
1440 
from Amacrine Cells to Photoreceptors. PLOS Biology 13, e1002115. 
1441 
Huang, Y., Ng, F.S., and Jackson, F.R. (2015). Comparison of Larval and Adult Drosophila 
1442 
Astrocytes Reveals Stage-Specific Gene Expression Profiles. G3 (Bethesda) 5, 551–558. 
1443 
Iwai, Y., Usui, T., Hirano, S., Steward, R., Takeichi, M., and Uemura, T. (1997). Axon patterning 
1444 
requires DN-cadherin, a novel neuronal adhesion receptor, in the Drosophila embryonic CNS. 
1445 
Neuron 19, 77–89. 
1446 
Järvilehto, M., and Zettler, F. (1971). Localized intracellular potentials from pre- and 
1447 
postsynaptic components in the external plexiform layer of an insect retina. Z. Vergl. Physiol. 
1448 
75, 422–440. 
1449 
Jenett, A., Rubin, G.M., Ngo, T.-T.B., Shepherd, D., Murphy, C., Dionne, H., Pfeiffer, B.D., 
1450 
Cavallaro, A., Hall, D., Jeter, J., et al. (2012). A GAL4-driver line resource for Drosophila 
1451 
neurobiology. Cell Rep 2, 991–1001. 
1452 
Karuppudurai, T., Lin, T.-Y., Ting, C.-Y., Pursley, R., Melnattur, K.V., Diao, F., White, B.H., 
1453 
Macpherson, L.J., Gallio, M., Pohida, T., et al. (2014). A hard-wired glutamatergic circuit pools 
1454 
and relays UV signals to mediate spectral preference in Drosophila. Neuron 81, 603–615. 
1455 
Kebschull, J.M., Garcia da Silva, P., Reid, A.P., Peikon, I.D., Albeanu, D.F., and Zador, A.M. 
1456 
(2016). High-Throughput Mapping of Single-Neuron Projections by Sequencing of Barcoded 
1457 
RNA. Neuron 91, 975–987. 
1458 
Kiragasi, B., Wondolowski, J., Li, Y., and Dickman, D.K. (2017). A Presynaptic Glutamate 
1459 
Receptor Subunit Confers Robustness to Neurotransmission and Homeostatic Potentiation. Cell 
1460 
Rep 19, 2694–2706. 
1461 

 
 
 
Page 61 of 83 
2019 Dec 27 
Klapoetke, N.C., Murata, Y., Kim, S.S., Pulver, S.R., Birdsey-Benson, A., Cho, Y.K., Morimoto, 
1462 
T.K., Chuong, A.S., Carpenter, E.J., Tian, Z., et al. (2014). Independent optical excitation of 
1463 
distinct neural populations. Nat. Methods 11, 338–346. 
1464 
Kolodziejczyk, A.A., Kim, J.K., Svensson, V., Marioni, J.C., and Teichmann, S.A. (2015). The 
1465 
Technology and Biology of Single-Cell RNA Sequencing. Molecular Cell 58, 610–620. 
1466 
Konstantinides, N., Kapuralin, K., Fadil, C., Barboza, L., Satija, R., and Desplan, C. (2018). 
1467 
Phenotypic Convergence: Distinct Transcription Factors Regulate Common Terminal Features. 
1468 
Cell. doi:10.1016/j.cell.2018.05.021 
1469 
Kudron, M.M., Victorsen, A., Gevirtzman, L., Hillier, L.W., Fisher, W.W., Vafeados, D., Kirkey, 
1470 
M., Hammonds, A.S., Gersch, J., Ammouri, H., et al. (2018). The ModERN Resource: Genome-
1471 
Wide Binding Profiles for Hundreds of Drosophila and Caenorhabditis elegans Transcription 
1472 
Factors. Genetics 208, 937–949. 
1473 
Laughlin, S.B., and Hardie, R.C. (1978). Common strategies for light adaptation in the 
1474 
peripheral visual systems of fly and dragonfly. J. Comp. Physiol. 128, 319–340. 
1475 
Lawson, C., and Hanson, R. (1974). Solving Least Squares Problems (Society for Industrial and 
1476 
Applied Mathematics). 
1477 
Lee, P.-T., Zirin, J., Kanca, O., Lin, W.-W., Schulze, K.L., Li-Kroeger, D., Tao, R., Devereaux, 
1478 
C., Hu, Y., Chung, V., et al. (2018). A gene-specific T2A-GAL4 library for Drosophila. Elife 7. 
1479 
Long, X., Colonell, J., Wong, A.M., Singer, R.H., and Lionnet, T. (2017). Quantitative mRNA 
1480 
imaging throughout the entire Drosophila brain. Nat. Methods 14, 703–706. 
1481 
Lowenstein, C.J., and Snyder, S.H. (1992). Nitric oxide, a novel biologic messenger. Cell 70, 
1482 
705–707. 
1483 
Luan, H., Peabody, N.C., Vinson, C.R., and White, B.H. (2006). Refined spatial manipulation of 
1484 
neuronal function by combinatorial restriction of transgene expression. Neuron 52, 425–436. 
1485 
Luo, L., Callaway, E.M., and Svoboda, K. (2018). Genetic Dissection of Neural Circuits: A 
1486 
Decade of Progress. Neuron 98, 256–281. 
1487 
Macosko, E.Z., Basu, A., Satija, R., Nemesh, J., Shekhar, K., Goldman, M., Tirosh, I., Bialas, 
1488 
A.R., Kamitaki, N., Martersteck, E.M., et al. (2015). Highly Parallel Genome-wide Expression 
1489 
Profiling of Individual Cells Using Nanoliter Droplets. Cell 161, 1202–1214. 
1490 

 
 
 
Page 62 of 83 
2019 Dec 27 
Mauss, A.S., Meier, M., Serbe, E., and Borst, A. (2014). Optogenetic and pharmacologic 
1491 
dissection of feedforward inhibition in Drosophila motion vision. J. Neurosci. 34, 2254–2263. 
1492 
Mauss, A.S., Pankova, K., Arenz, A., Nern, A., Rubin, G.M., and Borst, A. (2015). Neural Circuit 
1493 
to Integrate Opposing Motions in the Visual Field. Cell 162, 351–362. 
1494 
Mauss, A.S., Vlasits, A., Borst, A., and Feller, M. (2017). Visual Circuits for Direction Selectivity. 
1495 
Annu. Rev. Neurosci. 40, 211–230. 
1496 
Meinertzhagen, I.A., and O’Neil, S.D. (1991). Synaptic organization of columnar elements in the 
1497 
lamina of the wild type in Drosophila melanogaster. J. Comp. Neurol. 305, 232–263. 
1498 
Meinertzhagen, I.A., and Sorra, K.E. (2001). Synaptic organization in the fly’s optic lamina: few 
1499 
cells, many synapses and divergent microcircuits. Prog. Brain Res. 131, 53–69. 
1500 
Melnattur, K.V., Pursley, R., Lin, T.-Y., Ting, C.-Y., Smith, P.D., Pohida, T., and Lee, C.-H. 
1501 
(2014). Multiple redundant medulla projection neurons mediate color vision in Drosophila. J. 
1502 
Neurogenet. 28, 374–388. 
1503 
Micheva, K.D., and Smith, S.J. (2007). Array tomography. Neuron 55, 25–36. 
1504 
Mo, A., Mukamel, E.A., Davis, F.P., Luo, C., Henry, G.L., Picard, S., Urich, M.A., Nery, J.R., 
1505 
Sejnowski, T.J., Lister, R., et al. (2015). Epigenomic Signatures of Neuronal Diversity in the 
1506 
Mammalian Brain. Neuron 86, 1369–84. 
1507 
Morante, J., and Desplan, C. (2008). The color-vision circuit in the medulla of Drosophila. Curr. 
1508 
Biol. 18, 553–565. 
1509 
Mullen, K.M., and Stokkum, I.H.M. van (2012). nnls: The Lawson-Hanson algorithm for non-
1510 
negative least squares (NNLS). 
1511 
Nagarkar-Jaiswal, S., Lee, P.-T., Campbell, M.E., Chen, K., Anguiano-Zarate, S., Gutierrez, 
1512 
M.C., Busby, T., Lin, W.-W., He, Y., Schulze, K.L., et al. (2015). A library of MiMICs allows 
1513 
tagging of genes and reversible, spatial and temporal knockdown of proteins in Drosophila. Elife 
1514 
4. 
1515 
Nériec, N., and Desplan, C. (2016). From the Eye to the Brain: Development of the Drosophila 
1516 
Visual System. Curr. Top. Dev. Biol. 116, 247–271. 
1517 

 
 
 
Page 63 of 83 
2019 Dec 27 
Nern, A., Pfeiffer, B.D., and Rubin, G.M. (2015). Optimized tools for multicolor stochastic 
1518 
labeling reveal diverse stereotyped cell arrangements in the fly visual system. PNAS 112, 
1519 
E2967–E2976. 
1520 
Otsuna, H., and Ito, K. (2006). Systematic analysis of the visual projection neurons of 
1521 
Drosophila melanogaster. I. Lobula-specific pathways. J. Comp. Neurol. 497, 928–958. 
1522 
Özkan, E., Carrillo, R.A., Eastman, C.L., Weiszmann, R., Waghray, D., Johnson, K.G., Zinn, K., 
1523 
Celniker, S.E., and Garcia, K.C. (2013). An extracellular interactome of immunoglobulin and 
1524 
LRR proteins reveals receptor-ligand networks. Cell 154, 228–239. 
1525 
Pankova, K., and Borst, A. (2017). Transgenic line for the identification of cholinergic release 
1526 
sites in Drosophila melanogaster. J. Exp. Biol. 220, 1405–1410. 
1527 
Panser, K., Tirian, L., Schulze, F., Villalba, S., Jefferis, G.S.X.E., Bühler, K., and Straw, A.D. 
1528 
(2016). Automatic Segmentation of Drosophila Neural Compartments Using GAL4 Expression 
1529 
Data Reveals Novel Visual Pathways. Curr. Biol. 26, 1943–1954. 
1530 
Pantazis, A., Segaran, A., Liu, C.-H., Nikolaev, A., Rister, J., Thum, A.S., Roeder, T., Semenov, 
1531 
E., Juusola, M., and Hardie, R.C. (2008). Distinct roles for two histamine receptors (hclA and 
1532 
hclB) at the Drosophila photoreceptor synapse. J. Neurosci. 28, 7250–7259. 
1533 
Paradis, E., Claude, J., and Strimmer, K. (2004). APE: Analyses of Phylogenetics and Evolution 
1534 
in R language. Bioinformatics 20, 289–290. 
1535 
Park, J.H., Helfrich-Förster, C., Lee, G., Liu, L., Rosbash, M., and Hall, J.C. (2000). Differential 
1536 
regulation of circadian pacemaker output by separate clock genes in Drosophila. Proc. Natl. 
1537 
Acad. Sci. U.S.A. 97, 3608–3613. 
1538 
Park, J.H., Schroeder, A.J., Helfrich-Förster, C., Jackson, F.R., and Ewer, J. (2003). Targeted 
1539 
ablation of CCAP neuropeptide-containing neurons of Drosophila causes specific defects in 
1540 
execution and circadian timing of ecdysis behavior. Development 130, 2645–2656. 
1541 
Raghu, S.V., and Borst, A. (2011). Candidate glutamatergic neurons in the visual system of 
1542 
Drosophila. PLoS ONE 6, e19472. 
1543 
Raghu, S.V., Reiff, D.F., and Borst, A. (2011). Neurons with cholinergic phenotype in the visual 
1544 
system of Drosophila. J. Comp. Neurol. 519, 162–176. 
1545 
Raghu, S.V., Claussen, J., and Borst, A. (2013). Neurons with GABAergic phenotype in the 
1546 
visual system of Drosophila. J. Comp. Neurol. 521, 252–265. 
1547 

 
 
 
Page 64 of 83 
2019 Dec 27 
Regev, A., Teichmann, S.A., Lander, E.S., Amit, I., Benoist, C., Birney, E., Bodenmiller, B., 
1548 
Campbell, P., Carninci, P., Clatworthy, M., et al. The Human Cell Atlas. ELife 6. 
1549 
Revell, L.J. (2012). phytools: an R package for phylogenetic comparative biology (and other 
1550 
things). Methods in Ecology and Evolution 3, 217–223. 
1551 
Rigaut, G., Shevchenko, A., Rutz, B., Wilm, M., Mann, M., and Séraphin, B. (1999). A generic 
1552 
protein purification method for protein complex characterization and proteome exploration. Nat. 
1553 
Biotechnol. 17, 1030–1032. 
1554 
Rivera-Alba, M., Vitaladevuni, S.N., Mishchenko, Y., Mischenko, Y., Lu, Z., Takemura, S.-Y., 
1555 
Scheffer, L., Meinertzhagen, I.A., Chklovskii, D.B., and Polavieja, G.G. de (2011). Wiring 
1556 
economy and volume exclusion determine neuronal placement in the Drosophila brain. Curr Biol 
1557 
21, 2000–5. 
1558 
Rulifson, E.J., Kim, S.K., and Nusse, R. (2002). Ablation of insulin-producing neurons in flies: 
1559 
growth and diabetic phenotypes. Science 296, 1118–1120. 
1560 
Schlichting, M., Menegazzi, P., Lelito, K.R., Yao, Z., Buhl, E., Dalla Benetta, E., Bahle, A., 
1561 
Denike, J., Hodge, J.J., Helfrich-Förster, C., et al. (2016). A Neural Network Underlying 
1562 
Circadian Entrainment and Photoperiodic Adjustment of Sleep and Activity in Drosophila. J. 
1563 
Neurosci. 36, 9084–9096. 
1564 
Schnaitmann, C., Haikala, V., Abraham, E., Oberhauser, V., Thestrup, T., Griesbeck, O., and 
1565 
Reiff, D.F. (2018). Color Processing in the Early Visual System of Drosophila. Cell 172, 318–
1566 
330.e18. 
1567 
Shinomiya, K., Huang, G., Lu, Z., Parag, T., Xu, C.S., Aniceto, R., Ansari, N., Cheatham, N., 
1568 
Lauchie, S., Neace, E., et al. (2019). Comparisons between the ON- and OFF-edge motion 
1569 
pathways in the Drosophila brain. ELife 8, e40025. 
1570 
Siegert, S., Cabuy, E., Scherf, B.G., Kohler, H., Panda, S., Le, Y.-Z., Fehling, H.J., Gaidatzis, 
1571 
D., Stadler, M.B., and Roska, B. (2012). Transcriptional code and disease map for adult retinal 
1572 
cell types. Nat Neurosci 15, 487–495. 
1573 
Silies, M., Gohl, D.M., and Clandinin, T.R. (2014). Motion-detecting circuits in flies: coming into 
1574 
view. Annu. Rev. Neurosci. 37, 307–327. 
1575 

 
 
 
Page 65 of 83 
2019 Dec 27 
Slawski, M., and Hein, M. (2013). Non-negative least squares for high-dimensional linear 
1576 
models: Consistency and sparse recovery without regularization. Electron. J. Statist. 7, 3004–
1577 
3056. 
1578 
Stan Development Team. (2017). RStan: the R interface to Stan. http://mc-stan.org  
1579 
Stay, B., Chan, K.K., and Woodhead, A.P. (1992). Allatostatin-immunoreactive neurons 
1580 
projecting to the corpora allata of adult Diploptera punctata. Cell Tissue Res. 270, 15–23. 
1581 
Strausfeld, N.J. (2009). Brain organization and the origin of insects: an assessment. Proc. Biol. 
1582 
Sci. 276, 1929–1937. 
1583 
Strother, J.A., Wu, S.-T., Wong, A.M., Nern, A., Rogers, E.M., Le, J.Q., Rubin, G.M., and 
1584 
Reiser, M.B. (2017). The Emergence of Directional Selectivity in the Visual Motion Pathway of 
1585 
Drosophila. Neuron 94, 168–182.e10. 
1586 
Strother, J.A., Wu, S.-T., Rogers, E.M., Eliason, J.L.M., Wong, A.M., Nern, A., and Reiser, M.B. 
1587 
(2018). Behavioral state modulates the ON visual motion pathway of Drosophila. Proc. Natl. 
1588 
Acad. Sci. U.S.A. 115, E102–E111. 
1589 
Svensson, V., Natarajan, K.N., Ly, L.-H., Miragaia, R.J., Labalette, C., Macaulay, I.C., Cvejic, 
1590 
A., and Teichmann, S.A. (2017). Power analysis of single-cell RNA-sequencing experiments. 
1591 
Nature Methods 14, 381–387. 
1592 
Swanson, L.W., and Lichtman, J.W. (2016). From Cajal to Connectome and Beyond. Annu. 
1593 
Rev. Neurosci. 39, 197–216. 
1594 
Sweeney, S.T., Broadie, K., Keane, J., Niemann, H., and O’Kane, C.J. (1995). Targeted 
1595 
expression of tetanus toxin light chain in Drosophila specifically eliminates synaptic transmission 
1596 
and causes behavioral defects. Neuron 14, 341–351. 
1597 
Takemura, S.-Y., Bharioke, A., Lu, Z., Nern, A., Vitaladevuni, S., Rivlin, P.K., Katz, W.T., Olbris, 
1598 
D.J., Plaza, S.M., Winston, P., et al. (2013). A visual motion detection circuit suggested by 
1599 
Drosophila connectomics. Nature 500, 175–81. 
1600 
Takemura, S., Xu, C.S., Lu, Z., Rivlin, P.K., Parag, T., Olbris, D.J., Plaza, S., Zhao, T., Katz, 
1601 
W.T., Umayam, L., et al. (2015). Synaptic circuits and their variations within different columns in 
1602 
the visual system of Drosophila. PNAS 112, 13711–13716. 
1603 

 
 
 
Page 66 of 83 
2019 Dec 27 
Takemura, S.-Y., Nern, A., Chklovskii, D.B., Scheffer, L.K., Rubin, G.M., and Meinertzhagen, 
1604 
I.A. (2017). The comprehensive connectome of a neural substrate for “ON” motion detection in 
1605 
Drosophila. Elife 6. 
1606 
Taghert, P.H., Hewes, R.S., Park, J.H., O’Brien, M.A., Han, M., and Peck, M.E. (2001). Multiple 
1607 
amidated neuropeptides are required for normal circadian locomotor rhythms in Drosophila. J. 
1608 
Neurosci. 21, 6673–6686. 
1609 
Tayler, T.D., Pacheco, D.A., Hergarden, A.C., Murthy, M., and Anderson, D.J. (2012). A 
1610 
neuropeptide circuit that coordinates sperm transfer and copulation duration in Drosophila. Proc. 
1611 
Natl. Acad. Sci. U.S.A. 109, 20697–20702. 
1612 
Tirian, L., and Dickson, B. (2017). The VT GAL4, LexA, and split-GAL4 driver line collections for 
1613 
targeted expression in the Drosophila nervous system. bioRxiv 198648. 
1614 
Tuthill, J.C., Nern, A., Holtz, S.L., Rubin, G.M., and Reiser, M.B. (2013). Contributions of the 12 
1615 
neuron classes in the fly lamina to motion vision. Neuron 79, 128–140. 
1616 
Tuthill, J.C., Nern, A., Rubin, G.M., and Reiser, M.B. (2014). Wide-field feedback neurons 
1617 
dynamically tune early visual processing. Neuron 82, 887–895. 
1618 
 
1619 
Vehtari, A., Gelman, A., and Gabry, J. (2016). Practical Bayesian model evaluation using leave-
1620 
one-out cross-validation and WAIC. Statistics and Computing. 
1621 
 
1622 
Wagh, D.A., Rasse, T.M., Asan, E., Hofbauer, A., Schwenkert, I., Dürrbeck, H., Buchner, S., 
1623 
Dabauvalle, M.-C., Schmidt, M., Qin, G., et al. (2006). Bruchpilot, a protein with homology to 
1624 
ELKS/CAST, is required for structural integrity and function of synaptic active zones in 
1625 
Drosophila. Neuron 49, 833–844. 
1626 
 
1627 
Venkatasubramanian, L., Guo, Z., Xu, S., Tan, L., Xiao, Q., Nagarkar-Jaiswal, S., and Mann, 
1628 
R.S. (2019). Stereotyped terminal axon branching of leg motor neurons mediated by IgSF 
1629 
proteins DIP-α and Dpr10. Elife 8. 
1630 
 
1631 
von Reyn, C.R., Nern, A., Williamson, W.R., Breads, P., Wu, M., Namiki, S., and Card, G.M. 
1632 
(2017). Feature Integration Drives Probabilistic Behavior in the Drosophila Escape Response. 
1633 
Neuron 94, 1190-1204.e6. 
1634 
 
1635 

 
 
 
Page 67 of 83 
2019 Dec 27 
Wolff, T., and Rubin, G.M. (2018). Neuroarchitecture of the Drosophila central complex: A 
1636 
catalog of nodulus and asymmetrical body neurons and a revision of the protocerebral bridge 
1637 
catalog. J. Comp. Neurol. 526, 2585–2611. 
1638 
 
1639 
Wu, M., Nern, A., Williamson, W.R., Morimoto, M.M., Reiser, M.B., Card, G.M., and Rubin, G.M. 
1640 
(2016). Visual projection neurons in the Drosophila lobula link feature detection to distinct 
1641 
behavioral programs. Elife 5. 
1642 
 
1643 
Wu, Q., Wen, T., Lee, G., Park, J.H., Cai, H.N., and Shen, P. (2003). Developmental control of 
1644 
foraging and social behavior by the Drosophila neuropeptide Y-like system. Neuron 39, 147–
1645 
161. 
1646 
 
1647 
Xu, Y., and Wang, T. (2019). LOVIT Is a Putative Vesicular Histamine Transporter Required in 
1648 
Drosophila for Vision. Cell Rep 27, 1327-1333.e3. 
1649 
 
1650 
Yasuyama, K., and Meinertzhagen, I.A. (1999). Extraretinal photoreceptors at the compound 
1651 
eye’s posterior margin in Drosophila melanogaster. J. Comp. Neurol. 412, 193–202. 
1652 
 
1653 
Zhang, H.G., Lee, H.J., Rocheleau, T., ffrench-Constant, R.H., and Jackson, M.B. (1995). 
1654 
Subunit composition determines picrotoxin and bicuculline sensitivity of Drosophila gamma-
1655 
aminobutyric acid receptors. Mol Pharmacol 48, 835–840. 
1656 
 
1657 
Zhang, F., Bhattacharya, A., Nelson, J.C., Abe, N., Gordon, P., Lloret-Fernandez, C., Maicas, 
1658 
M., Flames, N., Mann, R.S., Colón-Ramos, D.A., et al. (2014). The LIM and POU homeobox 
1659 
genes ttx-3 and unc-86 act as terminal selectors in distinct cholinergic and serotonergic neuron 
1660 
types. Development 141, 422–435. 
1661 
 
1662 
Zheng, L., Nikolaev, A., Wardill, T.J., O’Kane, C.J., Polavieja, G.G. de, and Juusola, M. (2009). 
1663 
Network Adaptation Improves Temporal Representation of Naturalistic Stimuli in Drosophila 
1664 
Eye: I Dynamics. PLOS ONE 4, e4307. 
1665 
 
1666 
Zheng, Z., Lauritzen, J.S., Perlman, E., Robinson, C.G., Nichols, M., Milkie, D., Torrens, O., 
1667 
Price, J., Fisher, C.B., Sharifi, N., et al. (2018). A Complete Electron Microscopy Volume of the 
1668 
Brain of Adult Drosophila melanogaster. Cell 174, 730-743.e22. 
1669 
 
1670 
 
1671 

 
 
 
Page 68 of 83 
2019 Dec 27 
 
 
1672 

 
 
 
Page 69 of 83 
2019 Dec 27 
 
1673 
FIGURE LEGENDS 
1674 
 
1675 
FIGURE 1. Genetic tools to access cell types in the Drosophila visual system  
1676 
A. Major brain regions profiled in this study (brain image from Jenett et al., 2012). The optic 
1677 
lobes have a repetitive structure of ~750 retinotopically arranged visual columns of similar 
1678 
cellular composition. B,C Examples of single cells in the optic lobe. B. Left, subregions of the fly 
1679 
visual system. Right, examples of layers and neuropil patterns of various classes of visual 
1680 
system neurons. C. We profiled cell types arborizing in the lamina (blue), medulla (purple) and 
1681 
lobula complex (green) of the visual system. Many cells contribute to multiple neuropiles so 
1682 
other groupings are possible. Note, some cell types are present at one cell per column, while 
1683 
others are less numerous with cells that each contribute to several columns. For example, the 
1684 
main synaptic region of the first optic lobe layer, the lamina, contains processes of some 13,000 
1685 
cells but these belong to only 17 main cell types: 14 neuronal and 3 glial (Figure 1C, top row). A 
1686 
small number of additional neurons (lamina tangential cells, Lat) project to a region just distal to 
1687 
the main lamina neuropile. D. Representative expression patterns of driver lines that target 
1688 
specific cell types. Each image is a maximum intensity projection of a whole brain confocal 
1689 
stack (only one optic lobe is shown). In each image the brain is counter-stained (magenta) with 
1690 
a neuropil marker and both the targeted cell type and the driver are indicated in the lower left 
1691 
and right corner, respectively. Additional images (focusing on drivers first described in this 
1692 
study) are shown in Figures 1 - Supplemental 1 and 2. Imaging parameters and brightness and 
1693 
contrast were adjusted individually for each image. For genotypes and image details see Table 
1694 
S5. 
1695 
 
1696 

 
 
 
Page 70 of 83 
2019 Dec 27 
FIGURE 2. Tandem-affinity purification of INTACT nuclei (TAPIN) enables neuronal 
1697 
genomics 
1698 
A. Cell type-specific drivers enable expression of the UNC84-2XGFP nuclear tag (green) in 
1699 
specific populations of cells. Both the targeted cell type and driver are indicated in the lower left 
1700 
and right corner, respectively. B. Following nuclei harvest, two rounds of magnetic bead capture 
1701 
serially purify target nuclei. After the first round of protein A bead capture, bacterial protease 
1702 
IdeZ cleaves the anti-GFP antibody in the flexible hinge region, allowing a second round of bead 
1703 
capture with protein G, which recognizes the F(ab’)2 region. Protein G, unlike Protein A, can 
1704 
bind both the Fc and F(ab’)2 regions of an immunoglobulin. C. Two capture rounds reduce the 
1705 
level of non-specific background (grey bars, mock IgG control) while maintaining the cDNA yield 
1706 
from the captured target nuclei (green bars). Bars represent the mean of two replicates (shown 
1707 
as points). D. RNA-seq libraries created with more nuclei yield more cDNA (circles). TAPIN 
1708 
libraries had lower non-specific background than INTACT (blue vs orange triangles). E. Libraries 
1709 
with more cDNA detect more genes. F. Libraries with more cDNA have more reproducible 
1710 
transcript abundances. G. Previously identified markers of lamina monopolar and inner 
1711 
photoreceptor neurons (Tan et al., 2015) are enriched in the expected cells. 
1712 
 
1713 
FIGURE 3. Mixture modeling accurately interprets TAPIN-seq measurements 
1714 
A. The distribution of Vesicular acetylcholine transporter (VAChT) abundance fit with a mixture 
1715 
of two log-normal components. B. Interpreting these components as “off” and “on” states 
1716 
unambiguously infers expression state in essentially all drivers. C. Mixture modeling transforms 
1717 
our catalog of relative transcript abundances (top) to discretized expression states (bottom). D. 
1718 
Histogram of expression breadth per gene. E. Cumulative distributions of expression breadth for 
1719 
all genes (gray), transcription factors (black), homeobox TFs (orange; InterPro domain 
1720 
IPR001356), neuropeptides (red), and genes involved in synaptic vesicle endocytosis (blue). 
1721 

 
 
 
Page 71 of 83 
2019 Dec 27 
F,G. The fkh modeling results were compared to its protein expression pattern as evaluated with 
1722 
a BAC transgenic (See Figure 3 - Supplemental 2A). F. Histogram bars represent raw 
1723 
abundance of all cells in our catalog. Blue and orange curves represent the inferred off and on 
1724 
components, respectively. Points represent the cells tested for transgene expression showing 
1725 
either detectable GFP (Green) or no signal (Black). The points’ vertical position reflect the 
1726 
estimated probability of gene expression. G. Forkhead-GFP expression in selected cell types. 
1727 
Fkh-GFP (mainly nuclear, in green) and cell type-specific expression of a membrane marker (in 
1728 
magenta) are shown. Because of the wide range of fkh expression levels, imaging parameters 
1729 
and brightness and contrast adjustments are not identical for different panels. Cells with 
1730 
detectable nuclear GFP signal above the background in the same image were scored as 
1731 
expressing fkh. H. As in J, to evaluate Ets65A modeling results (See Figure 3 - Supplemental 
1732 
2B). 
1733 
 
1734 
FIGURE 4. TAPIN-seq profiles identify genes enriched in cell types and groups 
1735 
A. Cells grouped by a minimum evolution tree of their inferred expression states. B. Heatmap of 
1736 
marker genes enriched in photoreceptors, glia, muscle, and pigment cells. C. Distribution of 
1737 
expression breadth for genes in “terminal” FlyBase gene groups with more than 10 members in 
1738 
our expression probability matrix. The least- and most- broadly expressed gene groups are 
1739 
labeled, along with the DPR-interacting, beat and DPR family of extracellular proteins. D. TfAP-
1740 
2 transcription factor distinguishes closely related cell types T4 and T5. E,F. TfAP-2 protein is 
1741 
specifically expressed in T4 and not in T5, confirming this detection of differential expression 
1742 
levels. GFP-tagged Tfap-2 (mainly nuclear, in green; see Table S5 and Methods) is shown 
1743 
together with a membrane marker (magenta) expressed in T4 (E) or T5 (F) cells. G. 
1744 
Comparison of genes with differential expression in two driver lines for T5 neurons expressing in 
1745 
different subtypes, identify genes that differentially label layers of the lobula plate 
1746 

 
 
 
Page 72 of 83 
2019 Dec 27 
(corresponding to different subtypes of T5 cells). H. Confirming the TAPIN-seq identification, klg 
1747 
protein (detected using a GFP tag (green); see Table S5 and Methods) is expressed in T4/T5 
1748 
cells with the expected layer specificity (layers 3 and 4) in the lobula plate (LP). A neuropil 
1749 
marker is shown in magenta. 
1750 
 
1751 
FIGURE 5. TAPIN-seq complements single cell RNA-seq profiling 
1752 
A,B. We evaluated whether single cell RNA-seq of the optic lobe (A, Konstantinides et al., 
1753 
2018) and brain (B, Davie et al., 2018) proportionally represents cell types found in the optic 
1754 
lobe. By comparing the single cell cluster sizes to the true abundance of each cell type 
1755 
(estimated as described in the methods) we found that the scRNA-seq map can both under- and 
1756 
over-estimate the abundance of each cell type (assuming accurate cell type labels), or that the 
1757 
cell type is incorrectly assigned (i.e. contains different or additional cell types). To estimate the 
1758 
true cell count, we made use of known anatomy (for example, several cell types are known to 
1759 
be present exactly once in each of the ~ 2 x 750 medulla columns per brain) or relied on 
1760 
published counts. In addition, we performed some new counts. (See methods for details.) 
1761 
Observed/expected ratio = ( (size of cluster labeled as cell type X / size of cluster labeled as T1) 
1762 
/ (true abundance of cell type X / true abundance of T1)). C. We used non-negative least 
1763 
squares regression to model each TAPIN-seq profile as a linear weighted sum of single cell 
1764 
clusters in the whole brain scRNA-seq map. The heatmap represents the regression coefficients 
1765 
of each single cell cluster (rows) contributing to the TAPIN-seq profile of each cell type, 
1766 
normalized within rows. D. We evaluated expression of genes that mark selected single cell 
1767 
clusters (Davie et al., 2018) in our TAPIN-seq profiles of visual system neurons. (see Figure 5 - 
1768 
Supplemental 2 for the complete heatmap). 
1769 
 
1770 

 
 
 
Page 73 of 83 
2019 Dec 27 
FIGURE 6. Expression of synthesis and transport genes indicate neurotransmitter 
1771 
phenotypes 
1772 
A. Expression of neurotransmitter marker genes indicate the neurotransmitters produced in 
1773 
nearly all profiled cells. With few exceptions, nearly all cell types express only one fast 
1774 
neurotransmitter. B,C. We confirm TAPIN-seq results at the protein level (green) for (B) 
1775 
Vesicular monoamine transporter (Vmat) expressed in Mi15 (magenta) and (C) Nitric oxide 
1776 
synthase (Nos) in C3 (magenta). Top panel in (C) shows a section through the optic lobe, lower 
1777 
panels C3 cell bodies. D. Several neuropeptides and receptors also express specifically 
1778 
(examples). E. Allatostatin A (AstA) protein expression in the medulla as an example of a 
1779 
neuropeptide with a very specific optic lobe expression pattern. The AstA distribution in the optic 
1780 
lobe matches the distribution and layer pattern of Pm3 cells, consistent with the TAPIN-Seq 
1781 
data. 
1782 
 
1783 
FIGURE 7. Patterns of neurotransmitter receptor expression 
1784 
A. Neurotransmitter receptors are widely expressed in specific patterns. With the exception of 
1785 
histamine, most cells express receptors or receptor subunits for nearly all neurotransmitters. B. 
1786 
Expression of the glutamate-gated chloride channel (GluClalpha), detected using a GFP-tag 
1787 
(green), in the optic lobe. The lamina pattern includes many neurons as well as proximal 
1788 
satellite, epithelial and marginal glia. A glia-specific nuclear marker (anti-repo) is shown in 
1789 
magenta. C. Octopamine receptor (Oamb) expressing cells in the optic lobe detected with a 
1790 
protein-trap GAL4 driving expression of a membrane targeted GFP (green). Anti-repo 
1791 
(magenta). In the lamina (to the top and left of the image), Lawf1/2 and L5 neurons and 
1792 
marginal glia are recognizable.  
1793 
 
1794 

 
 
 
Page 74 of 83 
2019 Dec 27 
FIGURE 8. Molecular and connectomics analyses suggest R8 photoreceptors signal via 
1795 
both histaminergic and cholinergic neurotransmission 
1796 
(A,A’,A’’,B). Expression of VAChT in R8 cells. Expression of a HA-tagged VAChT was induced 
1797 
in R8 cells by recombinase-mediated excision of an interruption cassette from a modified 
1798 
genomic copy of the VAChT gene (Pankova and Borst, 2017). R7 and R8 cells project to 
1799 
different layers of the medulla (A, schematic). Single confocal sections show R7 and R8 cells in 
1800 
magenta and anti-HA immunolabeling in green. R7 and R8 cells (labeled with mAb 24B10) are 
1801 
shown in magenta. Stop-cassette excision in R8 photoreceptors (using sens-FLP) results in 
1802 
VAChT-HA labeling of R8 terminals in both the main medulla (A’) and the dorsal rim (where R7 
1803 
and R8 cells project to very similar layer positions) (A’’). Stop-cassette excision in all 
1804 
photoreceptors (using ey3.5-FLP) also produces VAChT-HA labeling in R8 while expression in 
1805 
R7 was not detected (B). Scale bar, 10 µm. C. Heatmap of receptor expression probabilities 
1806 
(color) and relative abundance (numbers; transcripts per million) in R8 targets identified by EM 
1807 
(at least 5 synapses in Takemura et al., 2013). D. Connectivity network for R8 cells, overlaid 
1808 
with receptor expression. E. Possible distributions of postsynaptic receptors at R8 synapses. 
1809 
Individual active zones can interact with multiple postsynaptic cells which could be grouped in 
1810 
distinct ways. F. Classification of postsynaptic cells at individual R8 active zones (Takemura et 
1811 
al., 2013) based on histamine receptor expression. G. Same analysis as in E but for an R7 cell.  
1812 
 
1813 
 
1814 
FIGURE 9. Using gene expression to functionally interpret circuit structure 
1815 
A. Different properties of GABA-A receptors in Drosophila observed in in vitro studies. GABA-A 
1816 
receptor subunits can form either cation or anion channels depending on subunit composition. 
1817 
B. Expression of GABA-A subunits in selected cell types. C. L1 and two of its target cells form 
1818 
strong reciprocal connections with C2 neurons. D. Distribution of Rdl and Grd expressing cells 
1819 

 
 
 
Page 75 of 83 
2019 Dec 27 
at individual C2 synapses. E. Glutamate receptors can also be excitatory or inhibitory. F. 
1820 
Examples of expression patterns for selected glutamate receptors and transporters. G, H. 
1821 
Morphology of Lai (G) and Dm9 (H) cells. Illustrations based on MCFO images of single cells. I, 
1822 
J. Analysis of the input and output pathways of Lai (I) and Dm9 (J) neurons suggests a 
1823 
potentially similar functional role for these cells. The predicted absence of GluCl-alpha in Dm9 
1824 
suggests that glutamatergic input from Dm8 to Dm9 may be excitatory. 
1825 
 
1826 
 
 
1827 

 
 
 
Page 76 of 83 
2019 Dec 27 
SUPPLEMENTAL FIGURE LEGENDS 
1828 
 
1829 
FIGURE 1 - Supplemental 1. Whole brain expression patterns of new driver lines 
1830 
generated in this study 
1831 
A. Maximum intensity projection of confocal stacks taken from whole fly brains (only one optic 
1832 
lobe is shown). Expression patterns of the driver lines (myristoylated-GFP) are in green and a 
1833 
neuropil marker is in magneta. Imaging parameters and brightness and contrast were 
1834 
individually adjusted for each sample. B, B’. T4 and T5 cells comprise four subtypes (a,b,c,d) 
1835 
each of which project to specific layers of the lobula plate (B’). C, C’. Individual T4 and T5 driver 
1836 
lines label combinations of subtypes but show preferential expression in some subtypes. 
1837 
Subtypes were identified by their projections to specific layers in the lobula plate (C,C’). For 
1838 
example, T5_d2 mainly labels lobula plate layers one and two, indicating expression in T5a and 
1839 
T5b. Each of the lower panels is a higher magnification view of the lobula plate region (C’). In 
1840 
(C) both the driver and the split identifier are indicated in the lower left and right corner 
1841 
respectively.  
1842 
 
1843 
FIGURE 1 - Supplemental 2. Optic lobe patterns of driver lines 
1844 
A. Optic lobe expression patterns of new driver lines used in this study. All images orient the 
1845 
mediolateral axis of the brain vertically and are resampled substack projections generated from 
1846 
high resolution (63x) confocal stacks. B. Examples of segmented single cells illustrating cell 
1847 
morphology (left), the complete optic lobe expression pattern (middle) or individual cells labeled 
1848 
by MultiColor FlpOut (MCFO, right). In all images the neuropil marker is in gray and both the 
1849 
targeted cell type and driver are indicated in the lower left and right corner respectively. 
1850 
 
1851 

 
 
 
Page 77 of 83 
2019 Dec 27 
FIGURE 2 - Supplemental 1. Two variants of nuclei capture, INTACT and TAPIN. 
1852 
A. We used an INTACT-seq variant, that we originally developed for mouse (Mo et al., 2015), 
1853 
that purifies nuclei by differential centrifugation. B. TAPIN-seq replaces the space- and time-
1854 
intensive centrifugation with a two-step capture enabled by antibody hinge cleavage with the 
1855 
bacterial protease IdeZ. Both protein A and protein G bind the Fc region, while only protein G is 
1856 
able to bind F(ab’)2. C. Libraries built from more nuclei have more transcript molecules 
1857 
(estimated using synthetic spike-ins). D. Nearly all libraries showed relatively unbiased 
1858 
positional coverage across gene bodies. E. The maximum bias in positional coverage observed 
1859 
in each library was inversely correlated with cDNA yield, although with large variance in bias for 
1860 
lower yield libraries. F. T4.T5 transcriptomes of female (y-axis) and male (x-axis) flies are well 
1861 
correlated, but also recover known sex-specific genes including RNA on X 1 (roX1) and roX2 
1862 
(Amrein and Axel, 1997) and yolk protein 1 (Yp1) and Yp3 (Belote et al., 1985). G. Estimated 
1863 
transcript abundances were reproducible as evaluated by Pearson correlation (of log-
1864 
transformed transcript abundance) between biological replicates (black), alternative drivers for 
1865 
the same cell type (orange), or comparing TAPIN to INTACT profiles (blue). 
1866 
 
1867 
FIGURE 2 - Supplemental 2. TAPIN-seq vs FACS-seq comparison  
1868 
A. TAPIN-seq expression of marker genes identified from an independent FACS-seq dataset 
1869 
covering 12 cell types we also profiled (Konstantinides et al., 2018). We defined marker genes 
1870 
for each cell type as the top-10 most highly expressed genes relative to the mean of all cell 
1871 
types, requiring at least 4x higher abundance than the mean and a relative abundance of at 
1872 
least 50 TPM. B. We more broadly compared the TAPIN-seq and FACS-seq datasets by first 
1873 
identifying cell type-enriched genes within each dataset (at least two-fold higher than mean 
1874 
expression; at least 50 TPM in one sample) and then quantifying the degree of overlap between 
1875 

 
 
 
Page 78 of 83 
2019 Dec 27 
datasets using the overlap coefficient: 100 * (# genes enriched in both TAPIN-seq AND FACS-
1876 
seq) / minimum(# genes enriched in TAPIN-seq, # genes enriched in FACS-seq )). 
1877 
 
1878 
FIGURE 3 - Supplemental 1. Overview of INTACT-seq and TAPIN-seq libraries 
1879 
A. Libraries with fewer nuclei had greater carry-over of ninaE transcript, which encodes the 
1880 
abundant rhodopsin in the fly eye. The upper outliers are libraries made from R1-6 
1881 
photoreceptors, the only cells that express ninaE. The lower outliers are appendage muscle 
1882 
libraries created after heads are removed from the fly bodies, effectively eliminating ninaE carry-
1883 
over from photoreceptors. B,C. Modeling the distribution of ninaE correctly distinguishes true 
1884 
expression by R1-6 from transcript carry-over in the remaining samples. D. Distribution of mean 
1885 
on-state transcript abundance across all modeled genes. E. Distribution of dynamic range 
1886 
across all modeled genes. F. Concordance of inferred expression states between replicates. 
1887 
Concordance was computed as the number of genes predicted to express (p(on) >= 0.8) or not 
1888 
(p(on) <= 0.2) in both replicates divided by the number of genes predicted to express or not in 
1889 
either replicate. G. Cumulative distribution of inferred expression probabilities for gene/cell pairs 
1890 
reported to express in FlyBase (n=193 positive benchmark points). Our mixture model correctly 
1891 
inferred expression of 179 of the 193 gene/cell pairs. The 14 discordant pairs involved six genes 
1892 
(labeled in black). H-M. Modeling results for the six genes with benchmark mismatches. The on 
1893 
and off components are represented as orange and blue curves, respectively. Black points 
1894 
represent the inferred probabilities of expression for all drivers. Red points highlight the drivers 
1895 
where the model results disagreed with the benchmark. The transcript abundance (x-axis) 
1896 
reflects the average of all “high quality” replicates (minimum two per cell type). 
1897 
 
1898 

 
 
 
Page 79 of 83 
2019 Dec 27 
FIGURE 3 - Supplemental 2. Validation of fkh and Ets65A model inferences. 
1899 
A,B. To evaluate our modeling results for fkh and Ets65A we evaluated protein expression in 
1900 
several cell types (related to Figures 3F-H) using GFP-fusion proteins (METHODS). The 
1901 
indicated cell types (lower left corner) were visualized with a membrane marker (magenta). The 
1902 
second Mi15 panel (in B) includes examples of occasional cells without detectable Ets65-GFP 
1903 
expression (arrows). 
1904 
 
1905 
FIGURE 4 - Supplemental 1. TAPIN-seq profiles identify genes enriched in cell types and 
1906 
groups 
1907 
A. Cell adhesion molecules specifically expressed across our transcriptome catalog. B-D. The 
1908 
expression pattern of all beat, DIP, and Dpr family members depicted as heatmaps of 
1909 
probabilities of expression (left), heatmaps of relative transcript abundance (middle), or 
1910 
cumulative density curves of normalized expression level (right). The density curves, each 
1911 
depicting a bimodally expressed gene in the gene family, show expression levels that were 
1912 
normalized using the mean expression levels of the modeled off an on states for each gene; 
1913 
normalized level = (logE - mu_off) / (mu_on - mu_off). The density curves illustrate that DIP 
1914 
genes are sparsely expressed, followed by beat and Dpr genes. Of the three families, the Dpr 
1915 
genes exhibit transcript abundance that appears more continuous between the estimated off 
1916 
and on states rather than discretely bimodal. E,F. The number of interacting pairs of 
1917 
extracellular protein pairs (Ozkan et al., 2013) expressed by pairs of cells in the lamina (E) is not 
1918 
sufficient to predict the synaptic connectivity of these cells (F; data from Rivera-Alba et al., 
1919 
2011). To match our expression data, we summed the synapse counts for the individual R1-R6 
1920 
photoreceptors originally reported by Rivera-Alba et al., 2011. For the same reason, we also 
1921 
duplicated the subtype-unidentified Lawf synapse counts as separate Lawf1 and Lawf2 entries 
1922 
in the connectome matrix. 
1923 

 
 
 
Page 80 of 83 
2019 Dec 27 
 
1924 
FIGURE 5 - Supplemental 1. Regressing TAPIN-seq profiles against optic lobe single cell 
1925 
clusters 
1926 
A. We used non-negative least squares regression to model each TAPIN-seq profile as a linear 
1927 
weighted sum of optic lobe single cell clusters (Konstantinides et al., 2018). The heatmap 
1928 
represents the regression coefficients of each single cell cluster (rows) contributing to the 
1929 
TAPIN-seq profile of each cell type, normalized within rows.  
1930 
 
1931 
FIGURE 5 - Supplemental 2. TAPIN-seq expression of genes marking single cell clusters 
1932 
A. We evaluated expression of marker genes for each optic lobe single cell cluster (as reported 
1933 
in Konstantinides et al., 2018) in our TAPIN-seq profiles of visual system neurons. If a single cell 
1934 
cluster marker corresponds to one of our identified cell types, we expect to see its marker genes 
1935 
highly enriched in the corresponding cell type’s expression. Note that some of the single cell 
1936 
clusters with the best apparent cell type matches (e.g., cluster 15/TmY5a, cluster 55/Mi15) were 
1937 
originally reported with a different annotation. B. Expression of marker genes for each brain 
1938 
single cell cluster (as reported in Davie et al., 2018), as in A. 
1939 
 
1940 
FIGURE 5 - Supplemental 3. kn-GAL4 expression 
1941 
A. kn-GAL4 driven expression of a membrane-targeted GFP (green) in the optic lobe. Single 
1942 
confocal section with a reference marker (anti-Brp) in magenta. TmY14 cell bodies are unusual 
1943 
in that they are found only in a subregion of the medulla cell body rind (see 
1944 
http://flweb.janelia.org/cgi-bin/view_flew_imagery.cgi?line=R10G02 for an image of a GAL4 line 
1945 
that in the optic lobe expresses mainly in TmY14). Both the cell body distribution and optic lobe 
1946 
layer pattern (compare cells in (C)) indicate that kn-GAL4 is expressed in optic lobe cell types 
1947 
other than TmY14. B. Stochastic labeling of kn-GAL4 neurons using MCFO. A TmY5a cell and 
1948 

 
 
 
Page 81 of 83 
2019 Dec 27 
an LC4 cell are indicated. Other cell types, including several TmY14, are also labeled. Image 
1949 
shows a single confocal section without a reference marker. C,D. Examples of TmY14 (C) and 
1950 
TmY5a (D) cells. Reconstructed views generated from confocal stacks of MCFO-labeled cells 
1951 
using the indicated driver lines.  
1952 
 
1953 
FIGURE 6 - Supplemental 1. Transcriptional regulators of neurotransmitter identity 
1954 
A. Transcription factors whose expression is predictive of neurotransmitter phenotype (i.e., 
1955 
P(neurotransmitter output | transcription factor expressed)). The ten most predictive 
1956 
transcription factors are shown for each neurotransmitter output marker. B. Summary of 
1957 
orthologous transcription factors in worm and mouse and their association with specific 
1958 
neurotransmitter types. C. The Gad1-associated gene Lim3 does not express in cholinergic 
1959 
Dm12 neurons, but does in the GABA-ergic Dm10 neurons. Double labeling using LexA-
1960 
markers for Dm12 and Dm10 (green) with a Lim3 protein-trap-GAL4 driving RFP (magenta). 
1961 
This example highlights a case where Lim3 expression identifies a cell type in a group of similar 
1962 
cells (the Dm cells profiled in this study) that is GABAergic (all other Dms in this group are 
1963 
glutamatergic.) 
1964 
 
1965 
FIGURE 7 - Supplemental 1. Patterns of neurotransmitter receptor expression 
1966 
complement connectomics 
1967 
A. Transcriptomes reveal the neurotransmitters in core cell types of the ON and OFF 
1968 
components of the motion detection pathway. The ON and OFF motion detection pathways 
1969 
supply inputs to directionally sensitive T4 and T5 neurons, respectively (Takemura et al., 2017; 
1970 
Shinomiya et al., 2019). Our results show that all of the inputs to T5 (Tm1, Tm2, Tm4, and Tm9) 
1971 
are cholinergic, whereas the inputs to T4 are a mixture of GABAergic (C3, Mi4), cholinergic 
1972 
(Mi1, Tm3), and glutamatergic (Mi9), suggesting different input signs. Discovering the functional 
1973 

 
 
 
Page 82 of 83 
2019 Dec 27 
signs of inputs to the directionally selective neurons is an essential step in understanding the 
1974 
mechanism of this long-studied neuronal computation (Strother et al., 2017). In addition, our 
1975 
data reveals aspects of the motion pathway that have not yet been functionally examined, such 
1976 
as the identification of other signaling components (see B). B. Examples of the expression of 
1977 
genes involved in neuropeptide, non-canonical small molecule (nitric oxide), or gap junction 
1978 
communication in the cell types in (A).  
1979 
 
1980 
 
1981 
 
 
1982 

 
 
 
Page 83 of 83 
2019 Dec 27 
SUPPLEMENTARY FILES 
1983 
 
1984 
SUPPLEMENTARY FILE 1. SUPPLEMENTAL TABLES S1-S6. 
1985 
TABLE S1. Genetic drivers used to create INTACT/TAPIN-seq libraries. 
1986 
TABLE S2. RNA-seq samples. 
1987 
TABLE S3. Benchmark expression data obtained from FlyBase. 
1988 
TABLE S4. Marker genes enriched in photoreceptors, glia, muscle, and pigment cells. 
1989 
TABLE S5. Details of genotypes and labeling for all anatomy figures. 
1990 
TABLE S6. Details of TAPIN-seq buffers. 
1991 
 
1992 
SUPPLEMENTARY FILE 2. Key Resource Table. 
1993 
List of key resources and reagents used in this study. 
1994 

Lamina (La)
Outer Medulla (oMe)
Lobula 
(Lo)
A
Lobula 
plate
(Lp)
Inner Medulla (iMe)
B
D
C
R1-6
R8
R7
L1
L4
L2
Lawf2
L5
L3
Lawf1
Lai
Eg
Mg
Psg
Lat
Photoreceptor neurons
Lamina monopolar cells
Medulla to lamina feedback neurons
Glia
Mi1
Mi4
Mi15
Mi9
Distal medulla (Dm) neurons
Dm1
Dm3
Dm8
Dm4
Dm9
Dm10
Dm11
Dm12
Pm4
Pm3
T4
T5
LPi-34
LPLC1
LPTC VS
LPLC2
LLPC1
LPC1
LC16
LC10a
LC10b
LC6
LC4
Tm4
Tm20
TmY3
Tm1
Tm9
Tm2
Tm3
TmY5a
T1
C2
C3
Central
Brain
 (CB)
Photoreceptor
LMC
Glia
Tm(Y)
Dm
Mi
VPN
PB_1_d1
SS00116
Dm1_d1
SS00309
Tm4_d1
SS00320
LPC1_d1
SS02575
PB_4_d2
SS02302
Pm3_d1
SS00328
TmY3_d1
SS00331
Tm20_d1
SS00355
MB312B
PAM_4_d1
lLNv
SS00645
Lat
SS00657
Lawf1_d2
SS00689
SS00691
L1_d2
Tm1_d1
SS00796
LPTC_HS.VS_d1 SS04438
Dm4_d1
SS02361
R1-6_d1
Glia_Mg_d1
SS55437
Glia_Eg_d2
SS55438
Lai_d1
SS55442
Dm3_d1
SS00974
T4_d1
SS02344
Lat_d1
SS00657
Mi15_d1
SS02425
T5_d1
SS25175
KC_gd_d1
MB419B
B
Tm29
LC10d
Proximal medulla (Pm) 
neurons
T4/T5 neurons
Transmedullary (Tm/TmY) neurons
Medulla intrinsic (Mi) neurons
Lobula plate-
intrinsic (LPi)
 neurons
Visual projection neurons
FIGURE 1
optic lobe
mushroom body
central complex

LLPC1_d1
SS02437
Tm29_d1
SS00308
Pm4_d1
SS00317
Mi15_d1
SS00321
lLNv_d1
SS00645
TmY5a_d1
SS02594
Dm4_d2
SS02592
Mi9_d2
SS02448
Dm11_d1
SS03159
Dm8_d1
SS00323
Dm10_d1
SS00327
Dm12_d1
SS00384
Dm9_d1
SS02427
T4_d2
SS23866
T5_d2
SS23757
T4.T5_d2
SS21452
LPi-34_d1
SS03656
LPC1_d2
SS02700
Tm2_d1
SS00811
LC10b_d1
SS03723
Glia_Psg_d1
SS55440
Glia_Eg_d1
SS55439
Glia_Eg_d3
SS08909
A
Tm9_d1
SS00307
Glia_Psg_d2
SS55441
PB_3_d1
SS02268
PB_6_d1
SS00078
PB_2_d1
SS00090
PB_4_d1
SS02204
PB_5_d1
SS02255
T4_d1
SS02344
T4_d2
SS23866
T5_d1
SS25175
SS23757
T5_d2
C
1
2 3  4
C’
B’
1
2
3
4
1
2
3
4
1
2
3
4
1
2
3
4
B
LP layers
T4/T5 subtypes
a b c d
T4a
T4b
T4c
T4d
T5a
T5b
T5c
T5d
FIGURE 1 - Supplemental 1

Tm9
Mi15
LPi3-4
Single cells (MCFO)
Optic lobe pattern
B
TmY5a
Dm10
Tm29
Single cells (MCFO)
Optic lobe pattern
Tm29_d1
SS00308
LPi3-4_d1
SS03656
Mi15_d1
SS00321
Tm9_d1
SS00307
Dm10_d1
SS00327
TmY5a_d1
SS02594
Glia_Mg_d1
SS55437
Dm1_d1
SS00309
Dm3_d1
SS00974
Dm4_d1
SS02361 Dm4_d2
SS02592
SS02427
Dm9_d1
Tm1_d1
SS00796
Tm2_d1
SS00811
Tm4_d1
SS00320
Tm20_d1
SS00355
TmY3_d1
SS00331
Dm11_d1
SS03159
Dm12_d1
SS00384
Pm4_d1
SS00317
Mi9_d2
SS02448
SS00328
Pm3_d1
Dm8_d1
SS00323
T4.T5_d2
SS21452
SS00689
Lawf1_d2
LPTC_HS.VS
SS04438
LC10b_d1
SS03723
LPC1_d1
SS02575
LPC1_d2
SS02700 LLPC1_d1
SS02437
Lat_d1
SS00657
R1-6_d1
Glia_Eg_d1
Glia_Eg_d2
Glia_Eg_d3
Glia_Psg_d1
SS55439
SS55438
SS55440
Lai_d1
SS55442
SS08909
Glia_Psg_d2
SS55441
A
L1_d2
SS00691
lLNv_d1
SS00645
Mi15_d2
SS02425
FIGURE 1 - Supplemental 2

A
C
B
D
E
F
G
FIGURE 2
Harvest
nuclei
Bind
antibody
Capture 1
IdeZ
cleavage
Capture 2
Y
Y
A
A
G
G
v
v
v
v
Y
Y
L4_d1
   SS00789
Lai_d1
         SS55442
Lawf1_d2
       SS00689
LC6_d2
 OL00218B
Pm4_d1
   SS00317
(mock)
Capture 2
(mock)
Capture 1
Input
0
1
2
3
4
5
6
7
●●
●
●
●
●
●
●
●
●
cDNA yield (ug)
●
●●
●
●
●
●
●
●●
●
●
●●
●●
●
●
●●●●
●
●
●
●●●
●
●
●
●
●
●
●●
●●
●●
●●
●●
●
●
●●
●●
●●
●
●
●●
●
●
●
●
●●
●●
●
●
●●
●●
●●●●●
●
●
●●
●
●●
●
●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●
●●
●
●
●
●●●
●
●
●
●●
●●
●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●●
●●
●
●
●
●●●
●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●●●
●●
●
●
●
●
●
●
●●
●●
●●
●
●
●
●
●
●
●
●●
●
●
●
●●
●●
●
●●●
●
●
●
●
●
●
●●
●●
●
●
●
●
●
●
●●
●●
●●
●●
●●
●●
nuclear yield (thousands)
cDNA yield (ug)
1
5
10
mock
control
1
5
50
200
INTACT
TAPIN
●
●
●
●
●●
●
●
●
●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●
●
●●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●●
●
●
●
●
●
●
●
●
●●
●●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●
●●
●●
●
●
6000
8000
10000
12000
0.5
1.0
2.0
5.0
10.0
cDNA yield (ug)
genes detected
●●
●
●●●
●
●
●
●
●
●
●
●●
●
●
●
●
●●
●
●
●●
●●
●
●
●
●
●
●
●●
●
●
●●
●●
●●
●●
●
●
●
●●●
●
●
●
●●
●
●
●●
●
●
●
●
●
●
●
●
●●
●
●
●●●
●●
●
●
●
●
●
●
●
●
●●
●
●
●
●●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●●
●●
●●●
●
●●
●●
●
●
●
●
●●
●
●●●
●
●
●
●
●●
●
●
●●
●●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●●
●
●●●
●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●
●
●
●
●●●
●
●
●●
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●●
●●
●●
cDNA yield (ug)
Replicate correlation
(max pearson R)
0.5
1.0
2.0
5.0
10.0
0.65
0.70
0.75
0.80
0.85
0.90
0.95
1.00
1244
44
7
6
4
16
0
2
186
3
2
1
5
1
3
7
2175
3
1
6
0
1
23
27
532
9
11
1
1
12
0
7
1356
21
0
8
47
1
8
23
610
11
4
14
1
9
5
40
127
7
27
0
5
3
36
150
L1
L2
L3
L4
L5
R7
R8_Rh5
R8_Rh6
svp
bab2
erm
ap
pdm3
pros
sens
Relative transcript abundance
(Transcripts Per Million)
0
0.2
0.4
0.6
0.8
1
fraction of max abundance

Y 
Y 
Y 
Y 
Y 
Y 
Y 
Y 
Y 
Y 
Y 
Y 
A
A
A
A
G
G
A. INTACT-seq
B. TAPIN-seq
FIGURE 2 - Supplemental 1
Clear released DNA
and bind antibody
Capture nuclei on
protein A beads
Cleave Ab with IdeZ
Reacquire nuclei on
protein G beads
Clear released DNA
and bind antibody
Differential centrifugation
Capture nuclei on
protein A beads
Y 
Y 
C
G
D
E
Gene body position (%)
Coverage bias
0.5
1.0
1.5
2.0
0
20
40
60
80
100
0.65
0.75
0.85
0.95
0
2
4
6
8
10
Correlation (pearson R, logTPM)
Density
Replicates
Alt Drivers
Alt Protocols
●
●
●●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●
●●
●●
●●
●●
●
●
●●
●●
●●
●●
●
●
●●
●
●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●●●
●
●
●
●
●
●
●●
●●
●
●
●
●
●
●
●●
●
●
●●
●●
●●●●
5e+06
1e+07
5e+07
1e+08
5e+08
1e+09
5e+09
1e+10
5e+10
1
2
5
20
50
200
nuclear yield (thousands)
transcript molecules
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●
●
cDNA yield (ug)
Maximum coverage bias
1.2
1.4
1.6
1.8
2.0
2
4
6
8
F
T4T5 male expr (TPM+1)
T4T5 female expr
(TPM+1)
1
10
100
10000
1
10
100
1000
10000
Pearson r = 0.97
roX2
Yp3
roX1
Yp1

FIGURE 2 - Supplemental 2
A. TAPIN-seq expression of top-10 cell type-enriched genes identified by
     FACS-seq (Konstantinides et al., 2018)
B. Similarity of cell type-enriched genes identified by
     TAPIN-seq vs FACS-seq (Konstantinides et al., 2018)
C2
C3
Dm8
Dm12
Lawf1
Lawf2
Mi1
T1
T5
Tm2
Tm3
Tm9
C2
C3
Dm8
Dm12
Lawf1
Lawf2
Mi1
T1
T5
Tm2
Tm3
Tm9
FACS-seq cell types
TAPIN-seq
cell type
FACS−seq
INTACT/TAPIN−seq
C2
C3
Dm8
Dm12
Lawf1
Lawf2
Mi1
T1
T5
Tm2
Tm3
Tm9
C2
C3
Dm8
Dm12
Lawf1
Lawf2
Mi1
T1
T5
Tm2
Tm3
Tm9
overlap
coefficient
60
40
20
0
log2( TPM/mean )
2.5 =
enriched
-2.5 =
depleted
0 = mean

FIGURE 3
A
B
log2( TPM/mean )
Relative abundance
Probability of expression
mixture modeling
genes
drivers
p(zgd = on)
2.5 =
enriched
-2.5 =
depleted
0 = mean
1 = on
0 = off
0.5 =
uncertain
E
LPLC1 
Dm12 
 
Lai 
 
LC4
 
Dm9  
Dm10 
Pm4
 
Tm4 
T4T5
fkh-GFP
fkh-GFP
fkh-GFP
fkh-GFP
fkh-GFP
fkh-GFP
fkh-GFP
fkh-GFP
fkh-GFP
fkh-GFP
 
Dm8  
F
D
G
H
fkh-GFP detected:
●
●
Yes
No
Ets65A-GFP detected:
●
●
Yes
No
5
20
50
200
1000
0
2
4
6
8
VAChT abundance (TPM+1)
# drivers
on
off
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●●
●
●
●
●
●●
●
●
●●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●●
●●
●
●
●●
●
●
●
●
●●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●●
●
●●
●●●●●
●
●
●
●
●
●
●
●
●
●
●
VAChT abundance (TPM+1)
0.0
0.2
0.4
0.6
0.8
1.0
5
20
50
200
1000
P(expression)
●
●
●
●
●
●
●
●
●
●
●
●●●●
●●●●●●●●●
●●●
●
●●●●●●
●
●●●●
●●
●
●
●●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●●●●●●●●●●●●●●●●●●●●●●●●●●●●●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
Number of expressing cells
Cumulative fraction
0
20
40
60
0.0
0.2
0.4
0.6
0.8
1.0
all
TF
homeodomain
synaptic vesicle endocytosis
neuropeptide
1
5
20
100
500
0
5
10
15
fkh abundance (TPM+1)
# cells
0.0
0.2
0.4
0.6
0.8
1.0
P(expression)
●
●●●
●
●
●
●●●
●
●
●
●●●
●●●
●
●
●●
●●●
●
●
Pm4
Dm10
L1
L2 L3
L4
L5
Glia_Eg
Glia_Mg
Glia_Psg
T1
LC10a Dm3
C3
LC6
LC4
LPLC1
T4
T5
Dm8
Dm9
Dm12
Lai
LPLC2
Dm11
Dm1
Dm4
Tm4
1
5
20
100
500
0
1
2
3
4
5
6
7
Ets65A abundance (TPM+1)
# cells
0.0
0.2
0.4
0.6
0.8
1.0
P(expression)
●
●
●●
●
●●
●
●
●
●
Mi1
LPLC2
Lai
Tm9
Mi15
T1
C2
C3
Dm3
Glia_Eg
Tm20
*
Mismatch
*
*
*
Mismatch
*
0
20
40
60
0
500
1000
1500
# genes
Number of expressing cells
C

FIGURE 3 - Supplemental 1
F
G
H
I
J
K
L
M
benchmark mismatch
20
50
100
0
1
2
3
4
5
6
7
veli abundance (TPM+1)
# drivers
on
off
●●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●●
●
●
●
0.0
0.2
0.4
0.6
0.8
1.0
P(expression)
●
●
●
R1−6_d1
R7_d1
R8_Rh5_d1
1
2
5
10
50
200
0
2
4
6
8
10
verm abundance (TPM+1)
# drivers
on
off
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●●
0.0
0.2
0.4
0.6
0.8
1.0
P(expression)
●
R8_Rh6_d1
50
200
1000
5000
0
2
4
6
8
para abundance (TPM+1)
# drivers
on
off
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●
●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
0.0
0.2
0.4
0.6
0.8
1.0
P(expression)
●
R1−6_d1
500
1000
2000
0
1
2
3
4
5
6
7
Syx1A abundance (TPM+1)
# drivers
on
off
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
0.0
0.2
0.4
0.6
0.8
1.0
P(expression)
●
R1−6_d1
100
200
500
0
2
4
6
8
10
Rab11 abundance (TPM+1)
# drivers
on
off
●
●
●
●
●
●
●●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●●
●
●
●
●
●
0.0
0.2
0.4
0.6
0.8
1.0
P(expression)
●
●
●
●
R1−6_d1
R7_d1
R8_Rh6_d1
R8_Rh5_d1
1
2
5
0
2
4
6
8
10
Myo61F abundance (TPM+1)
# drivers
on
off
●
●
●●
●●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
0.0
0.2
0.4
0.6
0.8
1.0
P(expression)
●
●●
R1−6_d1
R7_d1 R8_Rh5_d1
R8_Rh6_d1
B
A
C
D
E
10
50
200
2000
50000
0
2
4
6
8
10
12
ninaE abundance (TPM+1)
# drivers
on
off
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●●
●
●
●
●●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●●
●
●
●
●●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●
●
●
●
●
●
ninaE abundance (TPM+1)
0.0
0.2
0.4
0.6
0.8
1.0
10
50
200
2000
50000
P(expression)
●
R1−6_d1
1
10
100
1000
0
100
200
300
400
500
600
# genes
On−state abundance
(TPM + 1)
P(expression)
Cumulative fraction of
positive benchmark genes
0.0
0.2
0.4
0.6
0.8
1.0
0.0
0.2
0.4
0.6
0.8
1.0
Myo61F (x4)
para
Rab11 (x2)
Rab11
Rab11
Syx1A
veli
veli (x2)
verm
Observed
Perfect
Random
0.80
0.85
0.90
0.95
1.00
0
5
10
15
20
Concordance of inferred state
Replicate pairs
1
5
20
100
500
0
200
400
600
800
1000
1200
# genes
On/Off dynamic range
(TPM/TPM)
R1-6
photoreceptor
appendage
muscle
●
●
●
●
●
●
●
●
●●
●●
●●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●●
●●
●●
●●
●●
●
●
●●
●●
●●
●
●
●●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●●
●
●●
●
●
●
●
●
●
●
●●
●
●
●
●●●
●
●
●
●
●
●●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●●
nuclear yield (thousands)
ninaE abundance (TPM+1)
10
50
100
500
1000
5000
10000
2
5
10
50
200
INTACT
TAPIN

FIGURE 3 - Supplemental 2
A
B
Dm11 
C3 
LPLC2
Dm1
fkh-GFP
 
LC10
LC6 
Dm3
T1 
Dm4 
           
           
           
           
           
           
           
           
           
fkh-GFP
fkh-GFP
fkh-GFP
fkh-GFP
fkh-GFP
fkh-GFP
fkh-GFP
fkh-GFP
C2
Ets65A-GFP
 
C3 
T1 
Mi15 
Tm20  
Eg 
Dm3 
Mi1 
Tm9 
LPLC2     
Lai    
Mi15 
Ets65A-GFP
Ets65A-GFP
Ets65A-GFP
Ets65A-GFP
Ets65A-GFP
Ets65A-GFP
Ets65A-GFP
Ets65A-GFP
Ets65A-GFP
Ets65A-GFP
Ets65A-GFP

R1−6
R7
R8_Rh5
R8_Rh6
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
KC_ab_c
KC_ab_p
KC_ab_s
KC_gd
PAM_1
PAM_3
PAM_4
PB_1
PB_2
PB_3
PB_4
PB_5
Muscles_Head
Muscles_App
FIGURE 4
B
G
F
H
C
A
Cell group markers
D
●
●
●
●
●
●
●
●●●
●
●●●●●
●●
●
●
●
●
●
●
●●
●●
●
●
●
●
●
●●●
●
●
●
●●
●●
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
C2
L4
L1
L1.L2
L2
L5
L3
T4
T4.T5
T5
Tm1
Tm4
Tm2
Tm9
Mi1
Tm3
Mi15
Dm11
Pm3
Mi4
Dm10
Pm4
Mi9
TmY5a
Tm29
LPi−34
TmY3
KC_ab_c
KC_ab_s
KC_ab_c.p.s
KC_ab_p
KC_gd
Dm3
Dm8
PB_4
PB_5
PB_2
LC4
PB_3
PAM_1
PAM_3
LC10a
LC10b
LLPC1
LPC1
LC16
LC6
LPLC1
LPLC2
PB_1
Dm4
Dm12
Dm9
Lai
Crz
Kdm2
NPF
Glia_Eg
Glia_Mg
Glia_Psg
Muscles_App
Muscles_Head
PAM_4
R1−6
R7
R8_Rh5
R8_Rh6
Dm1
Tm20
T1
Lawf1
Lawf2
C3
C2.C3
Bootstrap
support
0%
100%
(pigment cell)
T4 expr (TPM+1)
T5 expr (TPM+1)
1
10
100
10000
1
10
100
1000
10000
Pearson r = 0.94
TF
TfAP−2
T5_d1 expr (TPM+1)
T5_d2 expr (TPM+1)
1
10
100
10000
1
10
100
1000
10000
Pearson r = 0.93
TF
bi
Con
dac
Dscam3
klg
dysf
T4 (SS02344)
Tfap-2-GFP
E
T5 (SS23757)  
Tfap-2-GFP
LP layers 
T4 dendrites
1   2   3   4
T5 dendrites
klg-GFP
CadN
Odorant receptors
SLC22 organic ion transporter
Osiris
Hox-like homeobox TF
GT1 UDP-glycosyltransferases
BEAT family
Large ribosomal proteins
Polycomb repressive complex 1
Mitochondrial complex III
Mitochondrial complex IV
Beta importins
DPR family
●
●
gene
group median
108
Photoreceptors
Glia
Muscle
Pigment cell
60
76
18
n
marker genes
0
0.2
0.4
0.6
0.8
1
probability of expression
Number of expressing cells
0
20
40
60
FlyBase gene groups (n=148)
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●●
●●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●●
●●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●●
●●
●
●
●●
●
●
●
●
●
●
●●
●
●
●●
●
●●
●
●●
●
●
●
●
●
●
●
●
●●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●●
●●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●●
●
●●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●●●
●
●
●
●
●
●
●●●
●
●
●●
●
●
●●
●
●
●
●
●
●
●
●●●
●●
●
●
●●
●
●
●
●●
●
●●●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●
●
●●●
●
●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●●
●
●●
●
●
●
●
●
●
●
●
●●●
●
●●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●●●
●
●
●
●
●●
●
●●
●
●●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●●●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●●
●
●
●●
●
●●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●●●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●●
●●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
DPR-interacting proteins

DIP−epsilon
DIP−gamma
DIP−theta
DIP−alpha
DIP−eta
DIP−beta
DIP−zeta
DIP−iota
DIP−delta
CG45781
CG31814
R1−6
R7
R8_Rh5
R8_Rh6
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
KC_ab_c
KC_ab_p
KC_ab_s
KC_gd
PAM_1
PAM_3
PAM_4
PB_1
PB_2
PB_3
PB_4
PB_5
beat−Ia
beat−Ib
beat−Ic
beat−IIa
beat−IIb
beat−IIIa
beat−IIIb
beat−IIIc
beat−IV
beat−Va
beat−Vb
beat−Vc
beat−VI
beat−VII
R1−6
R7
R8_Rh5
R8_Rh6
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
KC_ab_c
KC_ab_p
KC_ab_s
KC_gd
PAM_1
PAM_3
PAM_4
PB_1
PB_2
PB_3
PB_4
PB_5
beat−IIa
stan
Con
CadN2
Dscam3
beat−IIIb
beat−IIIa
hbs
beat−Ib
beat−Ic
beat−VI
beat−Vb
beat−Vc
beat−Va
klg
beat−IV
beat−VII
Cad87A
beat−IIIc
Wnt4
bib
pbl
egh
NijC
rhea
Hml
Ndg
mys
mesh
Vinc
crq
shg
flw
chp
ninaD
Mp20
CG2736
uif
CG40006
RhoL
alpha−Spec
ImpL2
Tig
bdl
tx
how
CG10345
N
Dl
dsb
18w
if
NijA
Mmp1
ft
Cad86C
emp
Invadolysin
m
Timp
Bsg
boi
nrv2
pnt
rho
Snmp2
DIP−iota
baz
Gli
NijB
Egfr
fw
Tsp
Cad99C
pes
Cad74A
santa−maria
otk
CG9095
lox
Pitslre
Flo2
CycE
Lectin−galC1
dyl
SPARC
CG3829
zye
Cad96Cb
Apc2
brn
Itgbn
lox2
Liprin−alpha
scb
ItgaPS4
Cad88C
CG6788
rst
mew
Lac
p120ctn
CG10163
O−fut1
R1−6
R7
R8_Rh5
R8_Rh6
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
KC_ab_c
KC_ab_p
KC_ab_s
KC_gd
PAM_1
PAM_3
PAM_4
PB_1
PB_2
PB_3
PB_4
PB_5
FIGURE 4 - Supplemental 1
A. Cell adhesion molecules
B
beat genes
DIP genes
dpr genes
C
D
E. Interacting extracellular proteins
F. Laminar connectivity (Rivera-Alba 2011)
sparse cell adhesion molecules
cell types
dpr1
dpr2
dpr3
dpr4
dpr5
dpr6
dpr7
dpr8
dpr9
dpr10
dpr11
dpr13
dpr14
dpr15
dpr16
dpr17
dpr18
dpr19
dpr20
dpr12
dpr21
R1−6
R7
R8_Rh5
R8_Rh6
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
KC_ab_c
KC_ab_p
KC_ab_s
KC_gd
PAM_1
PAM_3
PAM_4
PB_1
PB_2
PB_3
PB_4
PB_5
dpr1
dpr2
dpr3
dpr4
dpr5
dpr6
dpr7
dpr8
dpr9
dpr10
dpr11
dpr13
dpr14
dpr15
dpr16
dpr17
dpr18
dpr19
dpr20
dpr12
dpr21
R1−6
R7
R8_Rh5
R8_Rh6
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
KC_ab_c
KC_ab_p
KC_ab_s
KC_gd
PAM_1
PAM_3
PAM_4
PB_1
PB_2
PB_3
PB_4
PB_5
DIP−epsilon
DIP−gamma
DIP−theta
DIP−alpha
DIP−eta
DIP−beta
DIP−zeta
DIP−iota
DIP−delta
CG45781
CG31814
R1−6
R7
R8_Rh5
R8_Rh6
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
KC_ab_c
KC_ab_p
KC_ab_s
KC_gd
PAM_1
PAM_3
PAM_4
PB_1
PB_2
PB_3
PB_4
PB_5
beat−Ia
beat−Ib
beat−Ic
beat−IIa
beat−IIb
beat−IIIa
beat−IIIb
beat−IIIc
beat−IV
beat−Va
beat−Vb
beat−Vc
beat−VI
beat−VII
R1−6
R7
R8_Rh5
R8_Rh6
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
KC_ab_c
KC_ab_p
KC_ab_s
KC_gd
PAM_1
PAM_3
PAM_4
PB_1
PB_2
PB_3
PB_4
PB_5
log2( TPM/mean )
2.5 =
enriched
-2.5 =
depleted
0 = mean
p(zgd = on)
1 = on
0 = off
0.5 =
uncertain
Cell type 1
Cell type 2
R1 6
L1
L2
L3
L4
L5
Lai
T1
C2
C3
Lawf1
Lawf2
Glia_Eg
Glia_Mg
Glia_Psg
R1 6
L1
L2
L3
L4
L5
Lai
T1
C2
C3
Lawf1
Lawf2
Glia_Eg
Glia_Mg
Glia_Psg
Extracellular
interacting
protein pairs
70
60
50
40
30
Post−synaptic cell
Pre−synaptic cell
R1−6
L1
L2
L3
L4
L5
Lai
T1
C2
C3
Lawf1
Lawf2
Glia_Eg
Glia_Mg
Glia_Psg
R1−6
L1
L2
L3
L4
L5
Lai
T1
C2
C3
Lawf1
Lawf2
Glia_Eg
Glia_Mg
Glia_Psg
Laminar
Synapses
(log10 1+n)
2
1.5
1
0.5
0
Expression
Cum. Density
off on
Expression
Cum. Density
off on
Expression
Cum. Density
off on

FIGURE 5
C. TAPIN-seq profiles modeled as weighted sum of brain scRNA-seq clusters
D. TAPIN-seq expression of genes marking selected brain single cell clusters
cluster 39 (Dm8/Tm5c)
matches Lai 
cluster 52 (unknown)
matches Dm8, Dm11
cluster 74 (unknown)
matches Dm9
A 
B 
TAPIN-seq cell types
brain scRNA-seq clusters
NNLS
regression
coefficient
(/ row max)
log2( TPM/mean )
2.5 =
enriched
-2.5 =
depleted
0 = mean
TAPIN-seq cell types
top-100 genes marking
brain scRNA-seq clusters
PB_5
PB_4
PB_3
PB_2
PB_1
PAM_4
PAM_3
PAM_1
KC_gd
KC_ab_s
KC_ab_p
KC_ab_c
LPi−34
LPLC2
LPLC1
LPC1
LLPC1
LC16
LC10b
LC10a
LC6
LC4
TmY5a
TmY3
Tm29
Tm20
Tm9
Tm4
Tm3
Tm2
Tm1
T5
T4
Pm4
Pm3
Mi15
Mi9
Mi4
Mi1
Dm12
Dm11
Dm10
Dm9
Dm8
Dm4
Dm3
Dm1
Glia_Psg
Glia_Mg
Glia_Eg
T1
Lai
Lawf2
Lawf1
L5
L4
L3
L2
L1
C3
C2
R8_Rh6
R8_Rh5
R7
R1−6
R1−6
R7
R8_Rh5
R8_Rh6
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
KC_ab_c
KC_ab_p
KC_ab_s
KC_gd
PAM_1
PAM_3
PAM_4
PB_1
PB_2
PB_3
PB_4
PB_5
No Direct Annotation − Cluster 0
No Direct Annotation − Cluster 1
No Direct Annotation − Cluster 2
No Direct Annotation − Cluster 3
No Direct Annotation − Cluster 4
No Direct Annotation − Cluster 5
No Direct Annotation − Cluster 6
No Direct Annotation − Cluster 7
G−KC − Cluster 8
No Direct Annotation − Cluster 9
Astrocyte−like − Cluster 10
TmY14 − Cluster 11
Pm1/Pm2 − Cluster 12
No Direct Annotation − Cluster 13
Ensheathing glia − Cluster 14
No Direct Annotation − Cluster 15
No Direct Annotation − Cluster 16
Mip − Cluster 17
Tm9 − Cluster 18
No Direct Annotation − Cluster 19
L1/L2/L3/L4/L5 − Cluster 20
No Direct Annotation − Cluster 21
a/b−KC − Cluster 22
No Direct Annotation − Cluster 23
T4/T5 − Cluster 24
No Direct Annotation − Cluster 25
Mi1 − Cluster 26
OPN: adPN and lPN − Cluster 27
a'/b'−KC − Cluster 28
No Direct Annotation − Cluster 29
No Direct Annotation − Cluster 30
T2/T3 − Cluster 31
No Direct Annotation − Cluster 32
No Direct Annotation − Cluster 33
No Direct Annotation − Cluster 34
Ensheathing Glia − Cluster 35
Clock neurons − Cluster 36
T1 − Cluster 37
Serotonergic − Cluster 38
Dm8/Tm5c − Cluster 39
No Direct Annotation − Cluster 40
No Direct Annotation − Cluster 41
Dopaminergic − Cluster 42
Hemocytes − Cluster 43
No Direct Annotation − Cluster 44
Tm1/TmY8 − Cluster 45
Peptidergic − Cluster 46
No Direct Annotation − Cluster 47
Pm1/Pm2/Pm3 − Cluster 48
No Direct Annotation − Cluster 49
No Direct Annotation − Cluster 50
Mt1 − Cluster 51
No Direct Annotation − Cluster 52
Photoreceptors − Cluster 53
No Direct Annotation − Cluster 54
No Direct Annotation − Cluster 55
No Direct Annotation − Cluster 56
MBON − Cluster 57
Lawf1/Lawf2 − Cluster 58
No Direct Annotation − Cluster 59
Cortex Glia − Cluster 60
dFB − Cluster 61
No Direct Annotation − Cluster 62
No Direct Annotation − Cluster 63
Octopaminergic−Tyraminergic − Cluster 64
C2/C3 − Cluster 65
Subperineurial Glia − Cluster 66
No Direct Annotation − Cluster 67
No Direct Annotation − Cluster 68
No Direct Annotation − Cluster 69
Perineurial glia − Cluster 70
No Direct Annotation − Cluster 71
No Direct Annotation − Cluster 72
Pm3 − Cluster 73
No Direct Annotation − Cluster 74
No Direct Annotation − Cluster 75
No Direct Annotation − Cluster 76
No Direct Annotation − Cluster 77
No Direct Annotation − Cluster 78
No Direct Annotation − Cluster 79
Poxn − Cluster 80
No Direct Annotation − Cluster 81
Chiasm Glia − Cluster 82
No Direct Annotation − Cluster 83
No Direct Annotation − Cluster 84
Subperineurial Glia − Cluster 85
DN1 − Cluster 86
0
0.2
0.4
0.6
0.8
1
●
●
●
●
●
●
●
●
●
●
0.2
0.5
1.0
2.0
5.0
Dm8/Tm5c
T4/T5
Mi1/Tm2/Tm3
C2/C3
T2/T3
T1
Tm9
Lawf1/Lawf2
Pm3
Dm12
Observed / Expected
abundance
Optic lobe single cell clusters
 Normalized to T1
●
●
●
●
●
●
●
●
●
●
●
0.2
0.5
1.0
2.0
5.0
T4/T5
C2/C3
L1/L2/L3/L4/L5
Dm8/Tm5c
T2/T3
T1
Mi1
Tm9
Lawf2
Lawf1
Pm3
Observed / Expected
abundance
Brain single cell clusters
 Normalized to T1

FIGURE 5 - Supplemental 1
A. TAPIN-seq profiles modeled as weighted sum of optic lobe scRNA-seq clusters
NNLS
regression
coefficient
(/ row max)
TAPIN-seq cell types
optic lobe scRNA-seq clusters
R1−6
R7
R8_Rh5
R8_Rh6
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
KC_ab_c
KC_ab_p
KC_ab_s
KC_gd
PAM_1
PAM_3
PAM_4
PB_1
PB_2
PB_3
PB_4
PB_5
'No Direct Annotation − Cluster 0
'No Direct Annotation − Cluster 1
T4/T5 − Cluster 2
'No Direct Annotation − Cluster 3
'No Direct Annotation − Cluster 4
'No Direct Annotation − Cluster 5
T2/T3 − Cluster 6
'No Direct Annotation − Cluster 7
C2/C3 − Cluster 8
Tm9 − Cluster 9
'No Direct Annotation − Cluster 10
'No Direct Annotation − Cluster 11
Tm1/TmY8 − Cluster 12
'No Direct Annotation − Cluster 13
'No Direct Annotation − Cluster 14
TmY14 − Cluster 15
'No Direct Annotation − Cluster 16
Mi1/Tm2/Tm3 − Cluster 17
Dm12 − Cluster 18
'No Direct Annotation − Cluster 19
'No Direct Annotation − Cluster 20
'No Direct Annotation − Cluster 21
'No Direct Annotation − Cluster 22
T1 − Cluster 23
'No Direct Annotation − Cluster 24
Lawf1/Lawf2 − Cluster 25
Neuropile glia − Cluster 26
'No Direct Annotation − Cluster 27
'No Direct Annotation − Cluster 28
'No Direct Annotation − Cluster 29
Ensheathing glia − Cluster 30
'No Direct Annotation − Cluster 31
'No Direct Annotation − Cluster 32
'No Direct Annotation − Cluster 33
'No Direct Annotation − Cluster 36
Tm5ab − Cluster 37
Astrocyte−like glia − Cluster 38
'No Direct Annotation − Cluster 39
'No Direct Annotation − Cluster 42
'No Direct Annotation − Cluster 43
'No Direct Annotation − Cluster 44
Mt1 − Cluster 45
'No Direct Annotation − Cluster 46
Dm8/Tm5c − Cluster 47
'No Direct Annotation − Cluster 48
Perineurial glia − Cluster 49
'No Direct Annotation − Cluster 51
Pm3 − Cluster 52
'No Direct Annotation − Cluster 53
'No Direct Annotation − Cluster 54
Dm2 − Cluster 55
Cortex glia − Cluster 56
Chasm glia − Cluster 57
Subperineurial glia − Cluster 58
'No Direct Annotation − Cluster 59
'No Direct Annotation − Cluster 60
0
0.2
0.4
0.6
0.8
1

FIGURE 5 - Supplemental 2
log2( TPM/mean )
2.5 =
enriched
-2.5 =
depleted
0 = mean
A. TAPIN-seq expression of optic lobe scRNA-seq cluster markers
single cell cluster ID
TAPIN-seq cell type
B. TAPIN-seq expression of brain scRNA-seq cluster markers
0
1
2
3
4
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
25
26
27
28
29
30
31
32
33
37
38
39
42
43
44
45
46
47
48
49
51
52
53
54
55
56
57
58
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
R1−6
R7
R8_Rh5
R8_Rh6
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
KC_ab_c
KC_ab_p
KC_ab_s
KC_gd
PAM_1
PAM_3
PAM_4
PB_1
PB_2
PB_3
PB_4
PB_5
single cell cluster ID
TAPIN-seq cell type

TmY5a
TmY5a
LC4
kn-GAL4
UAS myrGFP
kn-GAL4
MCFO
TmY5a
(SS02594  MCFO)
TmY14
(VT012292 MCFO)
A
B
C
D
FIGURE 5 - Supplemental 3

FIGURE 6
D
B
C
E
A
Mi15 (SS00321)
VMAT-GFP
Pm3 processes
in layer M9 
Pm3 cell bodies
anti-AstA
Nos
Nos
Nos
C3
AstA
AstA−R1
AstA−R2
AstC
AstC−R1
AstC−R2
Pdf
Pdfr
R1−6
R7
R8_Rh5
R8_Rh6
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
KC_ab_c
KC_ab_p
KC_ab_s
KC_gd
PAM_1
PAM_3
PAM_4
PB_1
PB_2
PB_3
PB_4
PB_5
GABA
Histamine
Acetylcholine
Glutamate
Dopamine
other
0
0.2
0.4
0.6
0.8
1
probability of expression
neurotransmitter genes (markers)
neuropepide genes
synaptic
machinery
inferred 
NT
brp
nSyb
Syt1
Snap25
cpx
Hdc
t
CarT
e
CG3790
Gad1
VAChT
ChAT
VGlut
Eaat1
ple
Vmat
DAT
CG8468
CG45782
Eaat2
prt
Nos
NT call1
NT call2
NT call3
R1−6
R7
R8_Rh5
R8_Rh6
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
KC_ab_c
KC_ab_p
KC_ab_s
KC_gd
PAM_1
PAM_3
PAM_4
PB_1
PB_2
PB_3
PB_4
PB_5
(BalaT)
(lovit)

Hdc
peb
seq
BuGZ
eyg
Pph13
Sox100B
fd3F
sens
CG15336
Crg−1
Gad1
RunxB
CG11294
Lim3
run
tup
ey
D
Sox21b
Dll
Vsx2
VAChT
ap
sim
Hesr
Sox102F
zld
HHEX
dac
CG4730
erm
CG34031
VGlut
Lmx1a
CG4328
svp
kn
fd59A
tai
Met
ouib
fkh
tj
Vmat
tsh
Fer2
odd
kni
Scr
ase
sc
ci
hkb
Ets98B
prt
Hr51
Mef2
unc−4
ase
Poxn
Vsx1
ey
Vsx2
otp
ss
R1−6
R7
R8_Rh5
R8_Rh6
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
KC_ab_c
KC_ab_p
KC_ab_s
KC_gd
PAM_1
PAM_3
PAM_4
PB_1
PB_2
PB_3
PB_4
PB_5
ChAT
Gad1
VGlut
FIGURE 6 - Supplemental 1
A
0
0.2
0.4
0.6
0.8
1
probability of expression
Acetylcholine
Dopamine
GABA
Glutamate
Histamine
Kenyon cell
B
C
Transcription factors correlated with neurotransmitter output
NT
marker correlated TFs
sens
Lim3
Dll
ap
svp
tj
Fer2
Mouse
Worm
Acetylcholine
Dopamine
GABA
Glutamate
Histamine
pag-3
ceh-14
ceh-43
ttx-3
unc-55
maf-1
hlh-13
Gfi1b
Lhx3, Lhx4
Dlx
Lhx2, Lhx9
Nr2f1, Nr2f2
Mafb, Maf, Nrl
Bhlha9
Orthologs
*
*
*
*
*
*
*
*
*
*
*
*
*
*
*
*
*
*
Lim3-GAL4 UAS RFP
Dm12-LexA LexOP2-GFP
Lim3-GAL4 UAS RFP 
Dm10-LexA LexOP2-GFP

FIGURE 7
A
0
0.2
0.4
0.6
0.8
1
probability of expression
Serotonin
Acetylcholine
Dopamine
GABA
Glutamate
Histamine
Octopamine
B
C
Neurotransmitter input
*
*
L5 cell bodies
marginal glia
presynaptic 
terminals of 
Lawf1/2 cells
*
Eg cell bodies
oamb-GAL4 UAS myrGFP
anti-repo (glia)
GluCl-GFP
anti-repo (glia)
ort
HisCl1
Grd
Rdl
Lcch3
CG8916
GABA−B−R1
GABA−B−R2
GABA−B−R3
nAChRalpha1
nAChRalpha2
nAChRalpha3
nAChRalpha4
nAChRalpha5
nAChRalpha6
nAChRalpha7
nAChRbeta1
nAChRbeta2
nAChRbeta3
mAChR−A
mAChR−B
GluClalpha
GluRIA
GluRIB
GluRIIA
GluRIIB
GluRIIC
GluRIID
GluRIIE
Nmdar1
Nmdar2
mGluR
mtt
clumsy
CG3822
Grik
Ekar
CG11155
Dop1R1
Dop1R2
Dop2R
DopEcR
Oamb
Oct−TyrR
Octbeta1R
Octbeta2R
Octbeta3R
5−HT2A
5−HT2B
5−HT1A
5−HT1B
5−HT7
R1−6
R7
R8_Rh5
R8_Rh6
C2
C3
L1
L2
L3
L4
L5
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm1
Dm3
Dm4
Dm8
Dm9
Dm10
Dm11
Dm12
Mi1
Mi4
Mi9
Mi15
Pm3
Pm4
T4
T5
Tm1
Tm2
Tm3
Tm4
Tm9
Tm20
Tm29
TmY3
TmY5a
LC4
LC6
LC10a
LC10b
LC16
LLPC1
LPC1
LPLC1
LPLC2
LPi−34
KC_ab_c
KC_ab_p
KC_ab_s
KC_gd
PAM_1
PAM_3
PAM_4
PB_1
PB_2
PB_3
PB_4
PB_5

FIGURE 7 - Supplemental 1
A.
B.
Motion detection pathway
R1-6
T4
T5
Mi4
Tm1
Tm2
Tm4
Tm9
Mi9
Tm3
Mi1
C3
L1
L2
L3
Histamine
Acetylcholine
GABA
Glutamate
0
0.2
0.4
0.6
0.8
1
probability of expression
TPM
4
5
1
818
23
2519
96
0
1
9
1
3
3
3
120
87
1
3
6
14
39
2
5
1
6
601
6
15
1707
2
1
3
166
36
249
533
3498
3329
18
68
88
53
Tk
TkR86C
TkR99D
sNPF
Nos
shakB
C3
L1
L2
Mi1
Mi4
Tm1
Tm4

FIGURE 8
D
E
Model 1.
Clustered by
Neurotransmitter
receptor type
Model 2.
Interspersed
Neurotransmitter
receptor type
(Supported by F)
Possible R8 post-synaptic receptor patterns
G
F
Histamine receptor
Ort
HisCl1 Neither
Dm9
L1
Tm20
Mi1
Mi4
Mi15
R8
R7
post−synaptic
expression
R8  active zones
neither
ort+ HisCl1−
ort− HisCl1+
unknown
lateral
medial
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
post−synaptic
expression
R7 active zones
neither
ort+ HisCl1−
ort− HisCl1+
unknown
lateral
medial
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
0
0.2
0.4
0.6
0.8
1
probability of expression
TPM
2
2
1
647
425
329
1
6
2
255
230
295
37
11
74
32
35
13
ort
HisCl1
R7
R8_Rh5
R8_Rh6
L1
Dm9
Tm20
Mi1
Mi4
Mi15
Pre Post
Pre Post
VAChT-HA  (R8)
R7,R8
VAChT-HA  (R8)
R7,R8 DR
VAChT-HA  (R7,R8)
R7,R8
R7
R8
R7
R8,
R7
R8
A’’
B
A’
R7
R8
C
A

FIGURE 9
A
B
C
D
+
–
GABA
GABA
Lcch3
Grd
Lcch3
Rdl
GABA receptor
Grd
Rdl
Neither
3
3
0
1
121
66
8
39
4
6
30
3
4
3
3
1
0
0
11
3
2
115
38
3
3
1
0
375
469
109
22
2
3
1
1
3
1
0
12
4
6
164
1
0
36
8
278
198
35
17
24
12
315
548
728
1023
984
3076
3038
673
518
99
43
52
577
1148
1265
1431
5583
21
8
11
14
222
180
97
131
137
130
203
185
101
118
168
11
6
13
130
128
90
165
97
CG8916
Grd
Rdl
Lcch3
R1−6
R7
R8_Rh5
R8_Rh6
L1
L2
L3
L4
L5
C2
C3
Lai
Lawf1
Lawf2
T1
Glia_Eg
Glia_Mg
Glia_Psg
Dm8
Dm9
Mi1
Mi4
Mi9
post−synaptic
expression
C2 active zones
Grd+ Rdl−
Grd− Rdl+
Grd+ Rdl+
unknown
lateral
medial
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
R1-6
C2
L5
Mi1
L1
GABA
Glu
Hist
ACh
Transmitter output
GABA
Glu
Hist ACh
E
F
G
+
–
Glu
Glu
CG3822
Ekar
GluClα
H
I
J
R1-6
Lawf
C2/3
L3
Eg
Lai
T1
GABA
Glu
Hist
ACh
R7
R8
R1-6
L3
Dm9
Dm8
Glu
Hist
ACh
0
0.2
0.4
0.6
0.8
1
probability of expression
TPM
383
631
723
728
18
15
4
23
20
18
8
15
15
9
7
24
11
19
20
6
224
121
28
24
52
1577
578
248
547
1630
703
1846
682
408
14
11684
2669
5893
319
184
8
6
2
1
46
47
76
82
75
49
66
74
99
2507
94
3
1
3
33
71
24
34
28
7
13
2
149
3
4
4
3
10
10
27
513
6
97
10
4
4
Ekar
GluClalpha
CG3822
Eaat1
R1−6
R7
R8_Rh5
R8_Rh6
L1
L2
L3
L4
L5
C2
C3
Lawf1
Lawf2
Lai
T1
Glia_Eg
Glia_Psg
Glia_Mg
Dm8
Dm9

